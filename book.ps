%!PS-Adobe-2.0
%%Creator: dvips(k) 5.98 Copyright 2009 Radical Eye Software
%%Title: book.dvi
%%CreationDate: Wed Oct 17 16:48:56 2012
%%Pages: 453
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Helvetica-Bold Times-Roman Courier Times-Bold
%%+ Times-Italic Times-BoldItalic Courier-Bold
%%DocumentPaperSizes: Letter
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -R -q -t letter book.dvi -o book.ps
%DVIPSParameters: dpi=600
%DVIPSSource:  TeX output 2012.10.17:1648
%%BeginProcSet: tex.pro 0 0
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/CharBuilder{save 3 1 roll S A/base get 2 index get S
/BitMaps get S get/Cd X pop/ctr 0 N Cdx 0 Cx Cy Ch sub Cx Cw add Cy
setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx sub Cy .1 sub]{Ci}imagemask
restore}B/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc 0 0
% File 8r.enc  TeX Base 1 Encoding  Revision 2.0  2002-10-30
%
% @@psencodingfile@{
%   author    = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry,
%                W. Schmidt, P. Lehman",
%   version   = "2.0",
%   date      = "27nov06",
%   filename  = "8r.enc",
%   email     = "tex-fonts@@tug.org",
%   docstring = "This is the encoding vector for Type1 and TrueType
%                fonts to be used with TeX.  This file is part of the
%                PSNFSS bundle, version 9"
% @}
% 
% The idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard encoding, ISO Latin 1, Windows ANSI including the euro symbol,
% MacRoman, and some extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% These are /dotlessj /ff /ffi /ffl.
% 
% (4) hyphen appears twice for compatibility with both ASCII and Windows.
%
% (5) /Euro was assigned to 128, as in Windows ANSI
%
% (6) Missing characters from MacRoman encoding incorporated as follows:
%
%     PostScript      MacRoman        TeXBase1
%     --------------  --------------  --------------
%     /notequal       173             0x16
%     /infinity       176             0x17
%     /lessequal      178             0x18
%     /greaterequal   179             0x19
%     /partialdiff    182             0x1A
%     /summation      183             0x1B
%     /product        184             0x1C
%     /pi             185             0x1D
%     /integral       186             0x81
%     /Omega          189             0x8D
%     /radical        195             0x8E
%     /approxequal    197             0x8F
%     /Delta          198             0x9D
%     /lozenge        215             0x9E
%
/TeXBase1Encoding [
% 0x00
 /.notdef /dotaccent /fi /fl
 /fraction /hungarumlaut /Lslash /lslash
 /ogonek /ring /.notdef /breve
 /minus /.notdef /Zcaron /zcaron
% 0x10
 /caron /dotlessi /dotlessj /ff
 /ffi /ffl /notequal /infinity
 /lessequal /greaterequal /partialdiff /summation
 /product /pi /grave /quotesingle
% 0x20
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus
 /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three
 /four /five /six /seven
 /eight /nine /colon /semicolon
 /less /equal /greater /question
% 0x40
 /at /A /B /C
 /D /E /F /G
 /H /I /J /K
 /L /M /N /O
% 0x50
 /P /Q /R /S
 /T /U /V /W
 /X /Y /Z /bracketleft
 /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c
 /d /e /f /g
 /h /i /j /k
 /l /m /n /o
% 0x70
 /p /q /r /s
 /t /u /v /w
 /x /y /z /braceleft
 /bar /braceright /asciitilde /.notdef
% 0x80
 /Euro /integral /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /Omega /radical /approxequal
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /Delta /lozenge /Ydieresis
% 0xA0
 /.notdef /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot /hyphen /registered /macron
% 0xB0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde
 /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def


%%EndProcSet
%%BeginProcSet: texps.pro 0 0
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]FontType 0
ne{/Metrics exch def dict begin Encoding{exch dup type/integertype ne{
pop pop 1 sub dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get
div def}ifelse}forall Metrics/Metrics currentdict end def}{{1 index type
/nametype eq{exit}if exch pop}loop}ifelse[2 index currentdict end
definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{dup
sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1 roll
mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def dup[
exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}if}
forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}def
end

%%EndProcSet
%%BeginProcSet: special.pro 0 0
%!
TeXDict begin/SDict 200 dict N SDict begin/@SpecialDefaults{/hs 612 N
/vs 792 N/ho 0 N/vo 0 N/hsc 1 N/vsc 1 N/ang 0 N/CLIP 0 N/rwiSeen false N
/rhiSeen false N/letter{}N/note{}N/a4{}N/legal{}N}B/@scaleunit 100 N
/@hscale{@scaleunit div/hsc X}B/@vscale{@scaleunit div/vsc X}B/@hsize{
/hs X/CLIP 1 N}B/@vsize{/vs X/CLIP 1 N}B/@clip{/CLIP 2 N}B/@hoffset{/ho
X}B/@voffset{/vo X}B/@angle{/ang X}B/@rwi{10 div/rwi X/rwiSeen true N}B
/@rhi{10 div/rhi X/rhiSeen true N}B/@llx{/llx X}B/@lly{/lly X}B/@urx{
/urx X}B/@ury{/ury X}B/magscale true def end/@MacSetUp{userdict/md known
{userdict/md get type/dicttype eq{userdict begin md length 10 add md
maxlength ge{/md md dup length 20 add dict copy def}if end md begin
/letter{}N/note{}N/legal{}N/od{txpose 1 0 mtx defaultmatrix dtransform S
atan/pa X newpath clippath mark{transform{itransform moveto}}{transform{
itransform lineto}}{6 -2 roll transform 6 -2 roll transform 6 -2 roll
transform{itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll
curveto}}{{closepath}}pathforall newpath counttomark array astore/gc xdf
pop ct 39 0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}
if}N/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1
-1 scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3
get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip
yflip not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub
neg 0 TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{
noflips{TR pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop
90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get
neg sub neg TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr
1 get neg sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr
2 get ppr 0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4
-1 roll add 2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S
TR}if}N/cp{pop pop showpage pm restore}N end}if}if}N/normalscale{
Resolution 72 div VResolution 72 div neg scale magscale{DVImag dup scale
}if 0 setgray}N/psfts{S 65781.76 div N}N/startTexFig{/psf$SavedState
save N userdict maxlength dict begin/magscale true def normalscale
currentpoint TR/psf$ury psfts/psf$urx psfts/psf$lly psfts/psf$llx psfts
/psf$y psfts/psf$x psfts currentpoint/psf$cy X/psf$cx X/psf$sx psf$x
psf$urx psf$llx sub div N/psf$sy psf$y psf$ury psf$lly sub div N psf$sx
psf$sy scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub
TR/showpage{}N/erasepage{}N/setpagedevice{pop}N/copypage{}N/p 3 def
@MacSetUp}N/doclip{psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll
newpath 4 copy 4 2 roll moveto 6 -1 roll S lineto S lineto S lineto
closepath clip newpath moveto}N/endTexFig{end psf$SavedState restore}N
/@beginspecial{SDict begin/SpecialSave save N gsave normalscale
currentpoint TR @SpecialDefaults count/ocount X/dcount countdictstack N}
N/@setspecial{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs
neg 0 rlineto closepath clip}if ho vo TR hsc vsc scale ang rotate
rwiSeen{rwi urx llx sub div rhiSeen{rhi ury lly sub div}{dup}ifelse
scale llx neg lly neg TR}{rhiSeen{rhi ury lly sub div dup scale llx neg
lly neg TR}if}ifelse CLIP 2 eq{newpath llx lly moveto urx lly lineto urx
ury lineto llx ury lineto closepath clip}if/showpage{}N/erasepage{}N
/setpagedevice{pop}N/copypage{}N newpath}N/@endspecial{count ocount sub{
pop}repeat countdictstack dcount sub{end}repeat grestore SpecialSave
restore end}N/@defspecial{SDict begin}N/@fedspecial{end}B/li{lineto}B
/rl{rlineto}B/rc{rcurveto}B/np{/SaveX currentpoint/SaveY X N 1
setlinecap newpath}N/st{stroke SaveX SaveY moveto}N/fil{fill SaveX SaveY
moveto}N/ellipse{/endangle X/startangle X/yrad X/xrad X/savematrix
matrix currentmatrix N TR xrad yrad scale 0 0 1 startangle endangle arc
savematrix setmatrix}N end

%%EndProcSet
%%BeginProcSet: color.pro 0 0
%!
TeXDict begin/setcmykcolor where{pop}{/setcmykcolor{dup 10 eq{pop
setrgbcolor}{1 sub 4 1 roll 3{3 index add neg dup 0 lt{pop 0}if 3 1 roll
}repeat setrgbcolor pop}ifelse}B}ifelse/TeXcolorcmyk{setcmykcolor}def
/TeXcolorrgb{setrgbcolor}def/TeXcolorgrey{setgray}def/TeXcolorgray{
setgray}def/TeXcolorhsb{sethsbcolor}def/currentcmykcolor where{pop}{
/currentcmykcolor{currentrgbcolor 10}B}ifelse/DC{exch dup userdict exch
known{pop pop}{X}ifelse}B/GreenYellow{0.15 0 0.69 0 setcmykcolor}DC
/Yellow{0 0 1 0 setcmykcolor}DC/Goldenrod{0 0.10 0.84 0 setcmykcolor}DC
/Dandelion{0 0.29 0.84 0 setcmykcolor}DC/Apricot{0 0.32 0.52 0
setcmykcolor}DC/Peach{0 0.50 0.70 0 setcmykcolor}DC/Melon{0 0.46 0.50 0
setcmykcolor}DC/YellowOrange{0 0.42 1 0 setcmykcolor}DC/Orange{0 0.61
0.87 0 setcmykcolor}DC/BurntOrange{0 0.51 1 0 setcmykcolor}DC
/Bittersweet{0 0.75 1 0.24 setcmykcolor}DC/RedOrange{0 0.77 0.87 0
setcmykcolor}DC/Mahogany{0 0.85 0.87 0.35 setcmykcolor}DC/Maroon{0 0.87
0.68 0.32 setcmykcolor}DC/BrickRed{0 0.89 0.94 0.28 setcmykcolor}DC/Red{
0 1 1 0 setcmykcolor}DC/OrangeRed{0 1 0.50 0 setcmykcolor}DC/RubineRed{
0 1 0.13 0 setcmykcolor}DC/WildStrawberry{0 0.96 0.39 0 setcmykcolor}DC
/Salmon{0 0.53 0.38 0 setcmykcolor}DC/CarnationPink{0 0.63 0 0
setcmykcolor}DC/Magenta{0 1 0 0 setcmykcolor}DC/VioletRed{0 0.81 0 0
setcmykcolor}DC/Rhodamine{0 0.82 0 0 setcmykcolor}DC/Mulberry{0.34 0.90
0 0.02 setcmykcolor}DC/RedViolet{0.07 0.90 0 0.34 setcmykcolor}DC
/Fuchsia{0.47 0.91 0 0.08 setcmykcolor}DC/Lavender{0 0.48 0 0
setcmykcolor}DC/Thistle{0.12 0.59 0 0 setcmykcolor}DC/Orchid{0.32 0.64 0
0 setcmykcolor}DC/DarkOrchid{0.40 0.80 0.20 0 setcmykcolor}DC/Purple{
0.45 0.86 0 0 setcmykcolor}DC/Plum{0.50 1 0 0 setcmykcolor}DC/Violet{
0.79 0.88 0 0 setcmykcolor}DC/RoyalPurple{0.75 0.90 0 0 setcmykcolor}DC
/BlueViolet{0.86 0.91 0 0.04 setcmykcolor}DC/Periwinkle{0.57 0.55 0 0
setcmykcolor}DC/CadetBlue{0.62 0.57 0.23 0 setcmykcolor}DC
/CornflowerBlue{0.65 0.13 0 0 setcmykcolor}DC/MidnightBlue{0.98 0.13 0
0.43 setcmykcolor}DC/NavyBlue{0.94 0.54 0 0 setcmykcolor}DC/RoyalBlue{1
0.50 0 0 setcmykcolor}DC/Blue{1 1 0 0 setcmykcolor}DC/Cerulean{0.94 0.11
0 0 setcmykcolor}DC/Cyan{1 0 0 0 setcmykcolor}DC/ProcessBlue{0.96 0 0 0
setcmykcolor}DC/SkyBlue{0.62 0 0.12 0 setcmykcolor}DC/Turquoise{0.85 0
0.20 0 setcmykcolor}DC/TealBlue{0.86 0 0.34 0.02 setcmykcolor}DC
/Aquamarine{0.82 0 0.30 0 setcmykcolor}DC/BlueGreen{0.85 0 0.33 0
setcmykcolor}DC/Emerald{1 0 0.50 0 setcmykcolor}DC/JungleGreen{0.99 0
0.52 0 setcmykcolor}DC/SeaGreen{0.69 0 0.50 0 setcmykcolor}DC/Green{1 0
1 0 setcmykcolor}DC/ForestGreen{0.91 0 0.88 0.12 setcmykcolor}DC
/PineGreen{0.92 0 0.59 0.25 setcmykcolor}DC/LimeGreen{0.50 0 1 0
setcmykcolor}DC/YellowGreen{0.44 0 0.74 0 setcmykcolor}DC/SpringGreen{
0.26 0 0.76 0 setcmykcolor}DC/OliveGreen{0.64 0 0.95 0.40 setcmykcolor}
DC/RawSienna{0 0.72 1 0.45 setcmykcolor}DC/Sepia{0 0.83 1 0.70
setcmykcolor}DC/Brown{0 0.81 1 0.60 setcmykcolor}DC/Tan{0.14 0.42 0.56 0
setcmykcolor}DC/Gray{0 0 0 0.50 setcmykcolor}DC/Black{0 0 0 1
setcmykcolor}DC/White{0 0 0 0 setcmykcolor}DC end

%%EndProcSet
TeXDict begin @defspecial

 systemdict /pdfmark known{userdict /?pdfmark systemdict /exec get
put}{userdict /?pdfmark systemdict /pop get put userdict /pdfmark systemdict
/cleartomark get put}ifelse

 /DvipsToPDF{72.27 mul Resolution div} def/PDFToDvips{72.27 div Resolution
mul} def/BPToDvips{72 div Resolution mul}def/BorderArrayPatch{[exch{dup
dup type/integertype eq exch type/realtype eq or{BPToDvips}if}forall]}def/HyperBorder
{1 PDFToDvips} def/H.V {pdf@hoff pdf@voff null} def/H.B {/Rect[pdf@llx
pdf@lly pdf@urx pdf@ury]} def/H.S {currentpoint HyperBorder add /pdf@lly
exch def dup DvipsToPDF 72 add /pdf@hoff exch def HyperBorder sub /pdf@llx
exch def} def/H.L {2 sub dup/HyperBasePt exch def PDFToDvips /HyperBaseDvips
exch def currentpoint HyperBaseDvips sub /pdf@ury exch def/pdf@urx
exch def} def/H.A {H.L currentpoint exch pop vsize 72 sub exch DvipsToPDF
HyperBasePt sub sub /pdf@voff exch def} def/H.R {currentpoint HyperBorder
sub /pdf@ury exch def HyperBorder add /pdf@urx exch def currentpoint
exch pop vsize 72 sub exch DvipsToPDF sub /pdf@voff exch def} def
 
@fedspecial end TeXDict begin
40258431 52099146 1000 600 600 (book.dvi) @start /Fa
133[33 37 37 54 37 37 21 29 25 37 37 37 37 58 21 37 21
21 37 37 25 33 37 33 37 33 7[54 54 71 54 54 46 42 50
54 42 54 54 66 46 2[25 54 54 42 46 54 50 50 54 5[21 21
37 37 3[37 37 37 37 37 21 19 25 19 2[25 25 5[30 31[42
2[{TeXBase1Encoding ReEncodeFont}66 74.7198 /Times-Roman
rf /Fb 39[93 93[60 66 66 93 66 73 40 66 47 73 73 73 73
106 33 66 1[33 73 73 40 66 73 66 73 66 7[80 1[113 80
86 73 80 86 93 80 93 86 100 73 86 66 33 86 93 73 80 86
86 86 86 1[73 4[40 66 66 66 66 66 66 66 66 66 66 1[33
40 33 4[33 35[73 73 2[{TeXBase1Encoding ReEncodeFont}68
119.552 /Helvetica-Bold rf /Fc 139[45 1[45 1[45 45 45
4[45 5[45 99[{TeXBase1Encoding ReEncodeFont}7 74.7198
/Courier-Bold rf /Fd 136[55 1[46 23 32 32 1[42 42 46
1[23 2[23 46 2[37 1[37 42 42 97[{TeXBase1Encoding ReEncodeFont}15
83.022 /Times-BoldItalic rf /Fe 60[45 25[45 20[45 21[45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 1[45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45
45 45 45 33[{TeXBase1Encoding ReEncodeFont}96 74.7198
/Courier rf /Ff 7[42 31[60 93[32 37 37 55 37 42 23 32
32 42 42 42 42 60 23 37 23 23 42 42 23 37 42 37 42 42
1[42 1[32 1[32 3[69 1[60 46 42 51 60 51 60 55 69 46 55
1[28 60 60 51 51 60 55 51 51 1[42 4[28 42 42 42 42 42
42 42 42 42 42 1[21 28 21 4[28 4[35 28 29[42 42 2[{
TeXBase1Encoding ReEncodeFont}72 83.022 /Times-Italic
rf /Fg 39[65 93[37 42 42 60 42 46 28 32 37 46 46 42 46
69 23 46 28 23 46 42 28 37 46 37 46 42 1[42 1[28 1[28
55 60 1[83 60 60 55 46 60 65 51 65 60 78 55 65 42 32
65 65 51 55 60 60 55 60 7[42 42 42 42 42 42 42 42 42
42 23 21 28 21 2[28 28 28 35[46 46 2[{TeXBase1Encoding ReEncodeFont}74
83.022 /Times-Bold rf /Fh 39[134 94[96 2[96 105 57 96
67 105 105 105 105 153 48 2[48 105 105 57 96 105 96 105
96 11[124 105 115 124 134 115 2[143 105 2[48 124 1[105
1[124 124 124 124 7[96 96 96 96 96 96 96 96 96 2[48 57
45[{TeXBase1Encoding ReEncodeFont}48 172.154 /Helvetica-Bold
rf /Fi 134[36 4[36 1[36 1[36 36 1[36 36 2[36 3[36 1[36
1[36 32[36 17[36 46[{TeXBase1Encoding ReEncodeFont}13
59.7758 /Courier rf /Fj 106[23 27[33 1[48 33 33 18 26
22 1[33 33 33 52 18 33 1[18 33 33 22 29 33 29 33 29 3[22
1[22 3[63 1[48 41 37 44 1[37 48 48 59 41 2[22 48 1[37
4[48 1[29 37 37 37 1[18 33 33 4[33 2[33 18 17 22 17 2[22
22 22 5[22 33[{TeXBase1Encoding ReEncodeFont}56 66.4176
/Times-Roman rf /Fk 7[42 1[42 13[37 15[60 14[51 3[60
27[63 20[37 25[37 42 42 60 42 42 23 32 28 42 42 42 42
65 23 42 23 23 42 42 28 37 42 37 42 37 1[42 1[28 1[28
51 60 60 78 60 60 51 46 55 60 46 60 60 74 51 60 32 28
60 60 46 51 60 55 55 60 76 37 1[47 1[23 23 42 42 42 42
42 42 42 42 42 42 23 21 28 21 47 42 28 28 28 65 69 42
42 34 28 29[46 46 2[{TeXBase1Encoding ReEncodeFont}95
83.022 /Times-Roman rf /Fl 134[46 3[51 28 1[32 2[51 51
4[23 1[51 1[46 51 46 8[51 8[65 3[69 9[60 21[28 45[{
TeXBase1Encoding ReEncodeFont}16 83.022 /Helvetica-Bold
rf /Fm 134[55 4[33 10[28 3[55 61 1[61 28[66 69[{
TeXBase1Encoding ReEncodeFont}7 99.6264 /Helvetica-Bold
rf /Fn 39[112 93[72 80 80 112 80 88 48 80 56 88 88 88
88 128 40 80 40 40 88 88 48 80 88 80 88 80 6[88 96 1[135
96 104 88 96 104 112 96 112 104 120 88 104 1[40 104 112
88 96 104 104 104 104 1[88 4[48 80 80 80 80 80 80 80
80 80 80 40 40 48 40 2[48 48 5[68 48 33[{TeXBase1Encoding ReEncodeFont}
71 143.462 /Helvetica-Bold rf /Fo 134[115 3[126 69 1[80
2[126 126 4[57 1[126 1[115 126 115 8[126 8[161 3[172
9[149 21[69 45[{TeXBase1Encoding ReEncodeFont}16 206.584
/Helvetica-Bold rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%BeginPaperSize: Letter
/setpagedevice where
{ pop << /PageSize [612 792] >> setpagedevice }
{ /letter where { pop letter } if }
ifelse
%%EndPaperSize
 end
%%EndSetup
%%Page: 1 1
TeXDict begin 1 0 bop -600 -600 a
SDict begin [/Producer (dvips + Distiller)/Title ()/Subject ()/Creator
(LaTeX with hyperref package)/Author ()/Keywords () /DOCINFO pdfmark
end
 -600 -600 a -600 -600
a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray -611 -810 a
SDict begin H.S end
 -611 -810 a
0 TeXcolorgray 0 TeXcolorgray -611 -810 a
SDict begin H.R end
 -611 -810 a
-611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.1) cvn /DEST pdfmark end
 -611 -810 a Black Black Black -2 -11 a
SDict begin [/Count -0/Dest (1.0) cvn/Title (ZeroMQ Connecting your Code)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (2.0) cvn/Title (Dedication) /OUT pdfmark
end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (3.0) cvn/Title (Table of Contents) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (4.0) cvn/Title (List of Figures) /OUT
pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -4/Dest (5.0) cvn/Title (Preface) /OUT pdfmark
end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (5.1.1) cvn/Title (1. Audience) /OUT pdfmark
end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (5.2.1) cvn/Title (2. Conventions Used in This Book)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (5.3.1) cvn/Title (3. Using the Code Examples)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (5.4.1) cvn/Title (4. Acknowledgements)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -17/Dest (6.0) cvn/Title (Chapter 1. Basic Stuff)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.5.1) cvn/Title (1.1. Fixing the World)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.6.1) cvn/Title (1.2. \330MQ in a Hundred Words)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.7.1) cvn/Title (1.3. Some Assumptions)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.8.1) cvn/Title (1.4. Getting the Examples)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.9.1) cvn/Title (1.5. Ask and Ye Shall Receive)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.10.1) cvn/Title (1.6. A Minor Note on Strings)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.11.1) cvn/Title (1.7. Version Reporting)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.12.1) cvn/Title (1.8. Getting the Message Out)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.13.1) cvn/Title (1.9. Divide and Conquer)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.14.1) cvn/Title (1.10. Programming with \330MQ)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.15.1) cvn/Title (1.11. Getting the Context Right)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.16.1) cvn/Title (1.12. Making a Clean Exit)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.17.1) cvn/Title (1.13. Why We Needed \330MQ)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.18.1) cvn/Title (1.14. Socket Scalability)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.19.1) cvn/Title (1.15. Missing Message Problem Solver)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (6.20.1) cvn/Title (1.16. Upgrading from \330MQ/2.2 to \330MQ/3.2)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (6.21.1) cvn/Title (1.17. Warning Unstable Paradigms!)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -24/Dest (7.0) cvn/Title (Chapter 2. Intermediate Stuff)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.22.1) cvn/Title (2.1. The Zen of Zero)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.23.1) cvn/Title (2.2. The Socket API)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.24.1) cvn/Title (2.3. Plugging Sockets Into the Topology)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.25.1) cvn/Title (2.4. Using Sockets to Carry Data)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.26.1) cvn/Title (2.5. Unicast Transports)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.27.1) cvn/Title (2.6. \330MQ is Not a Neutral Carrier)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.28.1) cvn/Title (2.7. I/O Threads) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.29.1) cvn/Title (2.8. Limiting Socket Use)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.30.1) cvn/Title (2.9. Core Messaging Patterns)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.31.1) cvn/Title (2.10. Highlevel Messaging Patterns)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.32.1) cvn/Title (2.11. Working with Messages)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.33.1) cvn/Title (2.12. Handling Multiple Sockets)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.34.1) cvn/Title (2.13. Handling Errors and ETERM)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.35.1) cvn/Title (2.14. Handling Interrupt Signals)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.36.1) cvn/Title (2.15. Detecting Memory Leaks)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.37.1) cvn/Title (2.16. Multipart Messages)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -4/Dest (7.38.1) cvn/Title (2.17. Intermediaries and Proxies)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.38.1.2) cvn/Title (2.17.1. The Dynamic Discovery Problem)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.38.2.2) cvn/Title (2.17.2. The Shared Queue Problem)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.38.3.2) cvn/Title (2.17.3. \330MQ's Builtin Proxy Function)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.38.4.2) cvn/Title (2.17.4. The Transport Bridging Problem)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.39.1) cvn/Title (2.18. Multithreading with \330MQ)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.40.1) cvn/Title (2.19. Signaling between Threads)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.41.1) cvn/Title (2.20. Node Coordination)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.42.1) cvn/Title (2.21. Zero Copy) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.43.1) cvn/Title (2.22. PubSub Message Envelopes)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (7.44.1) cvn/Title (2.23. High Water Marks)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (7.45.1) cvn/Title (2.24. A Bare Necessity)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -9/Dest (8.0) cvn/Title (Chapter 3. Advanced RequestReply Patterns)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.46.1) cvn/Title (3.1. RequestReply Envelopes)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.47.1) cvn/Title (3.2. Custom RequestReply Routing)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.48.1) cvn/Title (3.3. ROUTERtoDEALER Routing)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.49.1) cvn/Title (3.4. LeastRecently Used Routing \(LRU Pattern\))
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.50.1) cvn/Title (3.5. Addressbased Routing)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.51.1) cvn/Title (3.6. A RequestReply Message Broker)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.52.1) cvn/Title (3.7. A HighLevel API for \330MQ)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.53.1) cvn/Title (3.8. Asynchronous ClientServer)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -8/Dest (8.54.1) cvn/Title (3.9. Worked Example: InterBroker Routing)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.5.2) cvn/Title (3.9.1. Establishing the Details)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.6.2) cvn/Title (3.9.2. Architecture of a Single Cluster)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.7.2) cvn/Title (3.9.3. Scaling to Multiple Clusters)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.8.2) cvn/Title (3.9.4. Federation vs. Peering)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.9.2) cvn/Title (3.9.5. The Naming Ceremony)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.10.2) cvn/Title (3.9.6. Prototyping the State Flow)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.11.2) cvn/Title (3.9.7. Prototyping the Local and Cloud Flows)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (8.54.12.2) cvn/Title (3.9.8. Putting it All Together)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -15/Dest (9.0) cvn/Title (Chapter 4. Reliable RequestReply)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.55.1) cvn/Title (4.1. What is "Reliability"?)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.56.1) cvn/Title (4.2. Designing Reliability)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.57.1) cvn/Title (4.3. Clientside Reliability \(Lazy Pirate Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.58.1) cvn/Title (4.4. Basic Reliable Queuing \(Simple Pirate Pattern\))
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.59.1) cvn/Title (4.5. Robust Reliable Queuing \(Paranoid Pirate Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.60.1) cvn/Title (4.6. Heartbeating)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.61.1) cvn/Title (4.7. Contracts and Protocols)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.62.1) cvn/Title (4.8. ServiceOriented Reliable Queuing \(Majordomo Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.63.1) cvn/Title (4.9. Asynchronous Majordomo Pattern)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.64.1) cvn/Title (4.10. Service Discovery)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.65.1) cvn/Title (4.11. Idempotent Services)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.66.1) cvn/Title (4.12. Disconnected Reliability \(Titanic Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -5/Dest (9.67.1) cvn/Title (4.13. Highavailability Pair \(Binary Star Pattern\))
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.67.13.2) cvn/Title (4.13.1. Overview)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.67.14.2) cvn/Title (4.13.2. Detailed Requirements)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.67.15.2) cvn/Title (4.13.3. Preventing SplitBrain Syndrome)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.67.16.2) cvn/Title (4.13.4. Binary Star Implementation)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.67.17.2) cvn/Title (4.13.5. Binary Star Reactor)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -3/Dest (9.68.1) cvn/Title (4.14. Brokerless Reliability \(Freelance Pattern\))
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.68.18.2) cvn/Title (4.14.1. Model One Simple Retry and Failover)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.68.19.2) cvn/Title (4.14.2. Model Two Brutal Shotgun Massacre)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (9.68.20.2) cvn/Title (4.14.3. Model Three Complex and Nasty)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (9.69.1) cvn/Title (4.15. Conclusion) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -5/Dest (10.0) cvn/Title (Chapter 5. Advanced PublishSubscribe)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.70.1) cvn/Title (5.1. Slow Subscriber Detection \(Suicidal Snail Pattern\))
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (10.71.1) cvn/Title (5.2. Highspeed Subscribers \(Black Box Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -7/Dest (10.72.1) cvn/Title (5.3. A Shared KeyValue Cache \(Clone Pattern\))
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.21.2) cvn/Title (5.3.1. Distributing KeyValue Updates)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.22.2) cvn/Title (5.3.2. Getting a Snapshot)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.23.2) cvn/Title (5.3.3. Republishing Updates)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.24.2) cvn/Title (5.3.4. Clone Subtrees)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.25.2) cvn/Title (5.3.5. Ephemeral Values)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.26.2) cvn/Title (5.3.6. Clone Server Reliability)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.72.27.2) cvn/Title (5.3.7. Clone Protocol Specification)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (10.73.1) cvn/Title (5.4. The Espresso Pattern)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (10.74.1) cvn/Title (5.5. Last Value Caching)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -14/Dest (11.0) cvn/Title (Chapter 6. The Human Scale)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.75.1) cvn/Title (6.1. The Tale of Two Bridges)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.76.1) cvn/Title (6.2. Code on the Human Scale)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.77.1) cvn/Title (6.3. Psychology of Software Development)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -3/Dest (11.78.1) cvn/Title (6.4. The Bad, the Ugly, and the Delicious)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.78.28.2) cvn/Title (6.4.1. TrashOriented Design)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.78.29.2) cvn/Title (6.4.2. ComplexityOriented Design)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.78.30.2) cvn/Title (6.4.3. SimplicityOriented Design)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -5/Dest (11.79.1) cvn/Title (6.5. Message Oriented Pattern for Elastic Design)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.79.31.2) cvn/Title (6.5.1. Step 1: Internalize the Semantics)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.79.32.2) cvn/Title (6.5.2. Step 2: Draw a Rough Architecture)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.79.33.2) cvn/Title (6.5.3. Step 3: Decide on the Contracts)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.79.34.2) cvn/Title (6.5.4. Step 4: Write a Minimal EndtoEnd Solution)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.79.35.2) cvn/Title (6.5.5. Step 5: Solve One Problem and Repeat)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -4/Dest (11.80.1) cvn/Title (6.6. Unprotocols)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.80.36.2) cvn/Title (6.6.1. Why Unprotocols?)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.80.37.2) cvn/Title (6.6.2. How to Write Unprotocols)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.80.38.2) cvn/Title (6.6.3. Why use the GPLv3 for Public Specifications?)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.80.39.2) cvn/Title (6.6.4. Using ABNF)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -6/Dest (11.81.1) cvn/Title (6.7. Serializing your Data)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.40.2) cvn/Title (6.7.1. Cheap and Nasty)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.41.2) cvn/Title (6.7.2. \330MQ Framing)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.42.2) cvn/Title (6.7.3. Serialization Languages)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.43.2) cvn/Title (6.7.4. Serialization Libraries)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.44.2) cvn/Title (6.7.5. Handwritten Binary Serialization)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.81.45.2) cvn/Title (6.7.6. Code Generation)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.82.1) cvn/Title (6.8. Transferring Files)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -3/Dest (11.83.1) cvn/Title (6.9. Heartbeating)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.83.46.2) cvn/Title (6.9.1. Shrugging It Off)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.83.47.2) cvn/Title (6.9.2. OneWay Heartbeats)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.83.48.2) cvn/Title (6.9.3. PingPong Heartbeats)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.84.1) cvn/Title (6.10. State Machines)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.85.1) cvn/Title (6.11. Authentication using SASL)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -9/Dest (11.86.1) cvn/Title (6.12. Largescale File Publishing)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.49.2) cvn/Title (6.12.1. Why make FileMQ?)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.50.2) cvn/Title (6.12.2. Initial Design Cut the API)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.51.2) cvn/Title (6.12.3. Initial Design Cut the Protocol)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.52.2) cvn/Title (6.12.4. Building and Trying FileMQ)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.53.2) cvn/Title (6.12.5. Internal Architecture)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.54.2) cvn/Title (6.12.6. Public API)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.55.2) cvn/Title (6.12.7. Design Notes)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.56.2) cvn/Title (6.12.8. Reliabilty)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.86.57.2) cvn/Title (6.12.9. Configuration)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (11.87.1) cvn/Title (6.13. File Stability)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (11.88.1) cvn/Title (6.14. Test Use Case)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -8/Dest (12.0) cvn/Title (Chapter 7. The \330MQ Community)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.89.1) cvn/Title (7.1. Architecture of the \330MQ Community)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -7/Dest (12.90.1) cvn/Title (7.2. How to Make Really Large Architectures)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.58.2) cvn/Title (7.2.1. The Game)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.59.2) cvn/Title (7.2.2. The Contract)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.60.2) cvn/Title (7.2.3. The Process)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.61.2) cvn/Title (7.2.4. Crazy, Beautiful, and Easy)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.62.2) cvn/Title (7.2.5. Stranger, meet Stranger)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.63.2) cvn/Title (7.2.6. Infinite Property)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.90.64.2) cvn/Title (7.2.7. Care and Feeding)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -8/Dest (12.91.1) cvn/Title (7.3. The \330MQ Process C4)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.65.2) cvn/Title (7.3.1. Language)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.66.2) cvn/Title (7.3.2. Goals) /OUT
pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.67.2) cvn/Title (7.3.3. Preliminaries)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.68.2) cvn/Title (7.3.4. Licensing and Ownership)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.69.2) cvn/Title (7.3.5. Patch Requirements)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.70.2) cvn/Title (7.3.6. Development Process)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.71.2) cvn/Title (7.3.7. Creating Stable Releases)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.91.72.2) cvn/Title (7.3.8. Evolution of Public Contracts)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.92.1) cvn/Title (7.4. Worked Example)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -12/Dest (12.93.1) cvn/Title (7.5. Git Branches Considered Harmful)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.73.2) cvn/Title (7.5.1. Simplicity vs. Complexity)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.74.2) cvn/Title (7.5.2. Change Latency)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.75.2) cvn/Title (7.5.3. Learning Curve)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.76.2) cvn/Title (7.5.4. Cost of Failure)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.77.2) cvn/Title (7.5.5. Upfront Coordination)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.78.2) cvn/Title (7.5.6. Scalability)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.79.2) cvn/Title (7.5.7. Surprise and Expectations)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.80.2) cvn/Title (7.5.8. Economics of Participation)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.81.2) cvn/Title (7.5.9. Robustness in Conflict)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.82.2) cvn/Title (7.5.10. Guarantees of Isolation)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.83.2) cvn/Title (7.5.11. Visibility)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.93.84.2) cvn/Title (7.5.12. Conclusions)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.94.1) cvn/Title (7.6. The Myth of Intelligent Design)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.95.1) cvn/Title (7.7. Burnout) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -16/Dest (12.96.1) cvn/Title (7.8. Patterns for The Game)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.85.2) cvn/Title (7.8.1. The Lazy Perfectionist)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.86.2) cvn/Title (7.8.2. The Benevolent Tyrant)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.87.2) cvn/Title (7.8.3. The Earth and Sky)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.88.2) cvn/Title (7.8.4. The Open Door)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.89.2) cvn/Title (7.8.5. The Laughing Clown)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.90.2) cvn/Title (7.8.6. The Mindful General)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.91.2) cvn/Title (7.8.7. The Social Engineer)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.92.2) cvn/Title (7.8.8. The Constant Gardener)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.93.2) cvn/Title (7.8.9. The Rolling Stone)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.94.2) cvn/Title (7.8.10. The Pirate Gang)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.95.2) cvn/Title (7.8.11. The Flash Mob)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.96.2) cvn/Title (7.8.12. The Canary Watcher)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.97.2) cvn/Title (7.8.13. The Hangman)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.98.2) cvn/Title (7.8.14. The Historian)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.99.2) cvn/Title (7.8.15. The Provocateur)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (12.96.100.2) cvn/Title (7.8.16. The Mystic)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -3/Dest (13.0) cvn/Title (Chapter 8. A Universe of Moving Pieces)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.97.1) cvn/Title (8.1. Design for The Real World)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -4/Dest (13.98.1) cvn/Title (8.2. The Secret Life of WiFi)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (13.98.101.2) cvn/Title (8.2.1. Why Mesh isn't Here Yet)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.98.102.2) cvn/Title (8.2.2. Some Physics)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.98.103.2) cvn/Title (8.2.3. What's the Current Status?)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (13.98.104.2) cvn/Title (8.2.4. Conclusions)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -6/Dest (13.99.1) cvn/Title (8.3. Promixitybased Networking)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.105.2) cvn/Title (8.3.1. Preemptive Discovery over Raw Sockets)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.106.2) cvn/Title (8.3.2. Cooperative Discovery using UDP Broadcasts)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.107.2) cvn/Title (8.3.3. Multiple Nodes on One Device)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.108.2) cvn/Title (8.3.4. Designing the API)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.109.2) cvn/Title (8.3.5. More about UDP)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (13.99.110.2) cvn/Title (8.3.6. Designing the Topology Layer)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -4/Dest (14.0) cvn/Title (Chapter 9. Postface)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -4/Dest (14.100.1) cvn/Title (9.1. Tales from Out There)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (14.100.111.2) cvn/Title (9.1.1. Rob Gagnon's Story)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (14.100.112.2) cvn/Title (9.1.2. Tom van Leeuwen's Story)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (14.100.113.2) cvn/Title (9.1.3. Michael Jakl's Story)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (14.100.114.2) cvn/Title (9.1.4. Vadim Shalts's Story)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (14.101.1) cvn/Title (9.2. How the Guide Happened)
/OUT pdfmark end
 -2
-11 a -2 -11 a
SDict begin [/Count -0/Dest (14.102.1) cvn/Title (9.3. Removing Friction)
/OUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/Count -0/Dest (14.103.1) cvn/Title (9.4. Licensing) /OUT
pdfmark end
 -2 -11 a -2 -11 a
SDict begin [/PageMode /UseOutlines/Page 1/View [/Fit] /DOCVIEW pdfmark
end
 -2
-11 a -2 -11 a
SDict begin [ {Catalog}<<>> /PUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 12 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (Doc-Start) cvn /DEST pdfmark end
 -2 -11 a -2 -11 a
SDict begin [ {Catalog} << /PageLabels<</Nums[0<</P(1)>>1<</P(2)>>2<</P(3)>>3<</P(iv)>>4<</P(v)>>5<</P(vi)>>6<</P(vii)>>7<</P(viii)>>8<</P(ix)>>9<</P(x)>>10<</P(xi)>>11<</P(xii)>>12<</P(xiii)>>13<</P(1)>>14<</P(2)>>15<</P(3)>>16<</P(4)>>17<</P(5)>>18<</P(6)>>19<</P(7)>>20<</P(8)>>21<</P(9)>>22<</P(10)>>23<</P(11)>>24<</P(12)>>25<</P(13)>>26<</P(14)>>27<</P(15)>>28<</P(16)>>29<</P(17)>>30<</P(18)>>31<</P(19)>>32<</P(20)>>33<</P(21)>>34<</P(22)>>35<</P(23)>>36<</P(24)>>37<</P(25)>>38<</P(26)>>39<</P(27)>>40<</P(28)>>41<</P(29)>>42<</P(30)>>43<</P(31)>>44<</P(32)>>45<</P(33)>>46<</P(34)>>47<</P(35)>>48<</P(36)>>49<</P(37)>>50<</P(38)>>51<</P(39)>>52<</P(40)>>53<</P(41)>>54<</P(42)>>55<</P(43)>>56<</P(44)>>57<</P(45)>>58<</P(46)>>59<</P(47)>>60<</P(48)>>61<</P(49)>>62<</P(50)>>63<</P(51)>>64<</P(52)>>65<</P(53)>>66<</P(54)>>67<</P(55)>>68<</P(56)>>69<</P(57)>>70<</P(58)>>71<</P(59)>>72<</P(60)>>73<</P(61)>>74<</P(62)>>75<</P(63)>>76<</P(64)>>77<</P(65)>>78<</P(66)>>79<</P(67)>>80<</P(68)>>81<</P(69)>>82<</P(70)>>83<</P(71)>>84<</P(72)>>85<</P(73)>>86<</P(74)>>87<</P(75)>>88<</P(76)>>89<</P(77)>>90<</P(78)>>91<</P(79)>>92<</P(80)>>93<</P(81)>>94<</P(82)>>95<</P(83)>>96<</P(84)>>97<</P(85)>>98<</P(86)>>99<</P(87)>>100<</P(88)>>101<</P(89)>>102<</P(90)>>103<</P(91)>>104<</P(92)>>105<</P(93)>>106<</P(94)>>107<</P(95)>>108<</P(96)>>109<</P(97)>>110<</P(98)>>111<</P(99)>>112<</P(100)>>113<</P(101)>>114<</P(102)>>115<</P(103)>>116<</P(104)>>117<</P(105)>>118<</P(106)>>119<</P(107)>>120<</P(108)>>121<</P(109)>>122<</P(110)>>123<</P(111)>>124<</P(112)>>125<</P(113)>>126<</P(114)>>127<</P(115)>>128<</P(116)>>129<</P(117)>>130<</P(118)>>131<</P(119)>>132<</P(120)>>133<</P(121)>>134<</P(122)>>135<</P(123)>>136<</P(124)>>137<</P(125)>>138<</P(126)>>139<</P(127)>>140<</P(128)>>141<</P(129)>>142<</P(130)>>143<</P(131)>>144<</P(132)>>145<</P(133)>>146<</P(134)>>147<</P(135)>>148<</P(136)>>149<</P(137)>>150<</P(138)>>151<</P(139)>>152<</P(140)>>153<</P(141)>>154<</P(142)>>155<</P(143)>>156<</P(144)>>157<</P(145)>>158<</P(146)>>159<</P(147)>>160<</P(148)>>161<</P(149)>>162<</P(150)>>163<</P(151)>>164<</P(152)>>165<</P(153)>>166<</P(154)>>167<</P(155)>>168<</P(156)>>169<</P(157)>>170<</P(158)>>171<</P(159)>>172<</P(160)>>173<</P(161)>>174<</P(162)>>175<</P(163)>>176<</P(164)>>177<</P(165)>>178<</P(166)>>179<</P(167)>>180<</P(168)>>181<</P(169)>>182<</P(170)>>183<</P(171)>>184<</P(172)>>185<</P(173)>>186<</P(174)>>187<</P(175)>>188<</P(176)>>189<</P(177)>>190<</P(178)>>191<</P(179)>>192<</P(180)>>193<</P(181)>>194<</P(182)>>195<</P(183)>>196<</P(184)>>197<</P(185)>>198<</P(186)>>199<</P(187)>>200<</P(188)>>201<</P(189)>>202<</P(190)>>203<</P(191)>>204<</P(192)>>205<</P(193)>>206<</P(194)>>207<</P(195)>>208<</P(196)>>209<</P(197)>>210<</P(198)>>211<</P(199)>>212<</P(200)>>213<</P(201)>>214<</P(202)>>215<</P(203)>>216<</P(204)>>217<</P(205)>>218<</P(206)>>219<</P(207)>>220<</P(208)>>221<</P(209)>>222<</P(210)>>223<</P(211)>>224<</P(212)>>225<</P(213)>>226<</P(214)>>227<</P(215)>>228<</P(216)>>229<</P(217)>>230<</P(218)>>231<</P(219)>>232<</P(220)>>233<</P(221)>>234<</P(222)>>235<</P(223)>>236<</P(224)>>237<</P(225)>>238<</P(226)>>239<</P(227)>>240<</P(228)>>241<</P(229)>>242<</P(230)>>243<</P(231)>>244<</P(232)>>245<</P(233)>>246<</P(234)>>247<</P(235)>>248<</P(236)>>249<</P(237)>>250<</P(238)>>251<</P(239)>>252<</P(240)>>253<</P(241)>>254<</P(242)>>255<</P(243)>>256<</P(244)>>257<</P(245)>>258<</P(246)>>259<</P(247)>>260<</P(248)>>261<</P(249)>>262<</P(250)>>263<</P(251)>>264<</P(252)>>265<</P(253)>>266<</P(254)>>267<</P(255)>>268<</P(256)>>269<</P(257)>>270<</P(258)>>271<</P(259)>>272<</P(260)>>273<</P(261)>>274<</P(262)>>275<</P(263)>>276<</P(264)>>277<</P(265)>>278<</P(266)>>279<</P(267)>>280<</P(268)>>281<</P(269)>>282<</P(270)>>283<</P(271)>>284<</P(272)>>285<</P(273)>>286<</P(274)>>287<</P(275)>>288<</P(276)>>289<</P(277)>>290<</P(278)>>291<</P(279)>>292<</P(280)>>293<</P(281)>>294<</P(282)>>295<</P(283)>>296<</P(284)>>297<</P(285)>>298<</P(286)>>299<</P(287)>>300<</P(288)>>301<</P(289)>>302<</P(290)>>303<</P(291)>>304<</P(292)>>305<</P(293)>>306<</P(294)>>307<</P(295)>>308<</P(296)>>309<</P(297)>>310<</P(298)>>311<</P(299)>>312<</P(300)>>313<</P(301)>>314<</P(302)>>315<</P(303)>>316<</P(304)>>317<</P(305)>>318<</P(306)>>319<</P(307)>>320<</P(308)>>321<</P(309)>>322<</P(310)>>323<</P(311)>>324<</P(312)>>325<</P(313)>>326<</P(314)>>327<</P(315)>>328<</P(316)>>329<</P(317)>>330<</P(318)>>331<</P(319)>>332<</P(320)>>333<</P(321)>>334<</P(322)>>335<</P(323)>>336<</P(324)>>337<</P(325)>>338<</P(326)>>339<</P(327)>>340<</P(328)>>341<</P(329)>>342<</P(330)>>343<</P(331)>>344<</P(332)>>345<</P(333)>>346<</P(334)>>347<</P(335)>>348<</P(336)>>349<</P(337)>>350<</P(338)>>351<</P(339)>>352<</P(340)>>353<</P(341)>>354<</P(342)>>355<</P(343)>>356<</P(344)>>357<</P(345)>>358<</P(346)>>359<</P(347)>>360<</P(348)>>361<</P(349)>>362<</P(350)>>363<</P(351)>>364<</P(352)>>365<</P(353)>>366<</P(354)>>367<</P(355)>>368<</P(356)>>369<</P(357)>>370<</P(358)>>371<</P(359)>>372<</P(360)>>373<</P(361)>>374<</P(362)>>375<</P(363)>>376<</P(364)>>377<</P(365)>>378<</P(366)>>379<</P(367)>>380<</P(368)>>381<</P(369)>>382<</P(370)>>383<</P(371)>>384<</P(372)>>385<</P(373)>>386<</P(374)>>387<</P(375)>>388<</P(376)>>389<</P(377)>>390<</P(378)>>391<</P(379)>>392<</P(380)>>393<</P(381)>>394<</P(382)>>395<</P(383)>>396<</P(384)>>397<</P(385)>>398<</P(386)>>399<</P(387)>>400<</P(388)>>401<</P(389)>>402<</P(390)>>403<</P(391)>>404<</P(392)>>405<</P(393)>>406<</P(394)>>407<</P(395)>>408<</P(396)>>409<</P(397)>>410<</P(398)>>411<</P(399)>>412<</P(400)>>413<</P(401)>>414<</P(402)>>415<</P(403)>>416<</P(404)>>417<</P(405)>>418<</P(406)>>419<</P(407)>>420<</P(408)>>421<</P(409)>>422<</P(410)>>423<</P(411)>>424<</P(412)>>425<</P(413)>>426<</P(414)>>427<</P(415)>>428<</P(416)>>429<</P(417)>>430<</P(418)>>431<</P(419)>>432<</P(420)>>433<</P(421)>>434<</P(422)>>435<</P(423)>>436<</P(424)>>437<</P(425)>>438<</P(426)>>439<</P(427)>>440<</P(428)>>441<</P(429)>>442<</P(430)>>443<</P(431)>>444<</P(432)>>445<</P(433)>>446<</P(434)>>447<</P(435)>>448<</P(436)>>449<</P(437)>>450<</P(438)>>451<</P(439)>>452<</P(440)>>]>>
>> /PUT pdfmark end
 -2 -11 a -2 -11 a
SDict begin H.S end
 -2
-11 a -2 -11 a
SDict begin 12 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:0) cvn /DEST pdfmark end
 -2 -11 a 355 140 a Fo(Zer)l(oMQ)58
b(-)f(Connecting)i(y)-5 b(our)58 b(Code)3525 140 y
SDict begin H.S end
 3525
140 a 3525 140 a
SDict begin 32.348 H.A end
 3525 140 a 3525 140 a
SDict begin [/View [/XYZ H.V]/Dest (1.0) cvn /DEST pdfmark end
 3525 140 a 1438
765 a Fn(Pieter)39 b(Hintjens)1717 1433 y Fm(Edited)28
b(b)n(y)1555 1619 y Fn(And)n(y)38 b(Oram)p Black Black
eop end
%%Page: 2 2
TeXDict begin 2 1 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.2) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 72 a Fl(Zer)n(oMQ)23 b(-)g(Connecting)e(y)n(our)i(Code)
-2 180 y Fk(by)d(Pieter)g(Hintjens)-2 396 y(Edited)f(by)h(Andy)f(Oram)
-2 612 y(Edited)g(by)-2 828 y(Edited)g(by)-2 1044 y(1)h(Edition)-2
1152 y(Cop)o(yright)e(\251)j(2010)e(O'Reilly)h(Media)-2
1343 y Fj(Printed)e(in)g(the)f(United)i(States)f(of)f(America.)-2
1725 y([?])-2 2107 y(O'Reilly)i(books)e(may)g(be)g(purchased)i(for)e
(educational,)k(b)o(usiness,)c(or)g(sales)g(promotional)j(use.)c
(Online)j(editions)g(are)e(also)h(a)o(v)n(ailable)i(for)d(most)g
(titles)-2 2214 y(\(http://my)l(.saf)o(aribooksonline.co)q(m)22
b(\(http://my)l(.saf)o(aribooksonline.c)q(om/?p)q(orta)q(l=)q(ore)q(il)
q(ly\)\).)h(F)o(or)17 b(more)g(information,)h(contact)i(our)d
(corporate/institutio)q(nal)-2 2322 y(sales)g(department:)j
(800-998-9938)f(or)e(<)p Fi(corporate@oreilly.com)p Fj(>.)-2
2704 y(Nutshell)h(Handbook,)g(the)g(Nutshell)h(Handbook)f(logo,)f(and)h
(the)g(O'Reilly)h(logo)e(are)h(re)o(gistered)i(trademarks)e(of)f
(O'Reilly)i(Media,)f(Inc.)f(!!FILL)f(THIS)g(IN!!)h(and)-2
2812 y(related)i(trade)f(dress)g(are)f(trademarks)i(of)e(O'Reilly)i
(Media,)f(Inc.)-2 2920 y(Man)o(y)f(of)g(the)h(designations)i(used)d(by)
g(manuf)o(acturers)j(and)d(sellers)i(to)e(distinguish)i(their)g
(products)f(are)g(claimed)g(as)f(trademarks.)i(Where)e(those)h
(designations)-2 3028 y(appear)g(in)g(this)f(book,)g(and)h(O'Reilly)h
(Media,)f(Inc.,)e(w)o(as)i(a)o(w)o(are)g(of)f(a)g(trademark)i(claim,)f
(the)g(designations)h(ha)o(v)o(e)f(been)g(printed)h(in)e(caps)h(or)e
(initial)k(caps.)-2 3410 y(While)e(e)n(v)o(ery)g(precaution)i(has)d
(been)h(tak)o(en)h(in)e(the)h(preparation)i(of)d(this)h(book,)f(the)g
(publisher)i(and)f(authors)g(assume)f(no)g(responsibility)j(for)d
(errors)h(or)f(omissions,)-2 3518 y(or)g(for)g(damages)h(resulting)h
(from)e(the)g(use)g(of)g(the)h(information)h(contained)h(herein.)-2
3924 y Fk(Re)n(vision)g(History)-2 3980 y
SDict begin H.S end
 -2 3980 a -2
3980 a
SDict begin 0 H.A end
 -2 3980 a -2 3980 a
SDict begin [/View [/XYZ H.V]/Dest (table.1) cvn /DEST pdfmark end
 -2 3980 a 74 x Fk(2012-06-25)-2
4130 y(Early)f(release)i(re)n(vision)e(1)p Black Black
eop end
%%Page: 3 3
TeXDict begin 3 2 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.3) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 115 a Fh(Dedication)878 115 y
SDict begin H.S end
 878 115
a 878 115 a
SDict begin 26.957 H.A end
 878 115 a 878 115 a
SDict begin [/View [/XYZ H.V]/Dest (2.0) cvn /DEST pdfmark end
 878 115 a 396 443 a Fg(By)21
b(Pieter)f(Hintjens)396 717 y Fk(T)-7 b(o)21 b(my)e(children.)p
Black Black eop end
%%Page: 4 4
TeXDict begin 4 3 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.iv) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 115 a Fh(T)-14 b(ab)n(le)48 b(of)g(Contents)1435
115 y
SDict begin H.S end
 1435 115 a 1435 115 a
SDict begin 26.957 H.A end
 1435 115 a 1435 115 a
SDict begin [/View [/XYZ H.V]/Dest (3.0) cvn /DEST pdfmark end
 1435
115 a 0 TeXcolorgray 396 257 a
SDict begin H.S end
 396 257 a Fg(Pr)o(eface)664
257 y
SDict begin 13 H.L end
 664 257 a 664 257 a
SDict begin [/Subtype /Link/Dest (0:69) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 664 257 a Black Black 19 w
Fg(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black 0 TeXcolorgray 3819 257 a
SDict begin H.S end
 3819 257 a
Fg(xi)3884 257 y
SDict begin 13 H.L end
 3884 257 a 3884 257 a
SDict begin [/Subtype /Link/Dest (0:69) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 257 a Black
0 TeXcolorgray 596 385 a
SDict begin H.S end
 596 385 a Fk(1.)20 b(Audience)999
385 y
SDict begin 13 H.L end
 999 385 a 999 385 a
SDict begin [/Subtype /Link/Dest (0:80) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 999 385 a Black Black 16 w
Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3796 385 a
SDict begin H.S end
 3796
385 a Fk(xii)3884 385 y
SDict begin 13 H.L end
 3884 385 a 3884 385 a
SDict begin [/Subtype /Link/Dest (0:80) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 385
a Black 0 TeXcolorgray 596 493 a
SDict begin H.S end
 596 493 a Fk(2.)g(Con)m(v)o(entions)d
(Used)k(in)f(This)h(Book)1741 493 y
SDict begin 13 H.L end
 1741 493 a 1741 493
a
SDict begin [/Subtype /Link/Dest (0:83) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1741 493 a Black Black Fk(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3796 493 a
SDict begin H.S end
 3796 493 a Fk(xii)3884 493 y
SDict begin 13 H.L end
 3884 493 a 3884
493 a
SDict begin [/Subtype /Link/Dest (0:83) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 493 a Black 0 TeXcolorgray 596 601 a
SDict begin H.S end
 596 601
a Fk(3.)f(Using)g(the)g(Code)g(Examples)1545 601 y
SDict begin 13 H.L end
 1545
601 a 1545 601 a
SDict begin [/Subtype /Link/Dest (0:86) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1545 601 a Black Black 9 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3796 601 a
SDict begin H.S end
 3796 601 a Fk(xii)3884 601 y
SDict begin 13 H.L end
 3884 601 a 3884
601 a
SDict begin [/Subtype /Link/Dest (0:86) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 601 a Black 0 TeXcolorgray 596 709 a
SDict begin H.S end
 596 709
a Fk(4.)g(Ackno)n(wledgements)1340 709 y
SDict begin 13 H.L end
 1340 709 a 1340
709 a
SDict begin [/Subtype /Link/Dest (0:89) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1340 709 a Black Black 7 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3796 709 a
SDict begin H.S end
 3796 709 a Fk(xii)3884 709
y
SDict begin 13 H.L end
 3884 709 a 3884 709 a
SDict begin [/Subtype /Link/Dest (0:89) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 709 a Black 0 TeXcolorgray
396 837 a
SDict begin H.S end
 396 837 a Fg(1.)g(Basic)h(Stuff)865 837 y
SDict begin 13 H.L end
 865
837 a 865 837 a
SDict begin [/Subtype /Link/Dest (0:96) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 865 837 a Black Black 4 w Fg(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3842 837 a
SDict begin H.S end
 3842
837 a Fg(1)3884 837 y
SDict begin 13 H.L end
 3884 837 a 3884 837 a
SDict begin [/Subtype /Link/Dest (0:96) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 837
a Black 0 TeXcolorgray 596 965 a
SDict begin H.S end
 596 965 a Fk(1.1.)e(Fixing)g(the)i(W)
-7 b(orld)1307 965 y
SDict begin 13 H.L end
 1307 965 a 1307 965 a
SDict begin [/Subtype /Link/Dest (0:98) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1307 965 a
Black Black 19 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3842 965 a
SDict begin H.S end
 3842 965 a Fk(1)3884 965 y
SDict begin 13 H.L end

3884 965 a 3884 965 a
SDict begin [/Subtype /Link/Dest (0:98) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 965 a Black 0 TeXcolorgray
596 1073 a
SDict begin H.S end
 596 1073 a Fk(1.2.)19 b(\330MQ)h(in)h(a)f(Hundred)e(W)-7
b(ords)1624 1073 y
SDict begin 13 H.L end
 1624 1073 a 1624 1073 a
SDict begin [/Subtype /Link/Dest (0:119) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1624 1073
a Black Black 13 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3842 1073 a
SDict begin H.S end
 3842 1073 a Fk(2)3884
1073 y
SDict begin 13 H.L end
 3884 1073 a 3884 1073 a
SDict begin [/Subtype /Link/Dest (0:119) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1073 a Black 0 TeXcolorgray
596 1181 a
SDict begin H.S end
 596 1181 a Fk(1.3.)19 b(Some)h(Assumptions)1386
1181 y
SDict begin 13 H.L end
 1386 1181 a 1386 1181 a
SDict begin [/Subtype /Link/Dest (0:123) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1386 1181 a Black Black
2 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3842 1181 a
SDict begin H.S end
 3842 1181 a Fk(2)3884 1181 y
SDict begin 13 H.L end
 3884 1181 a
3884 1181 a
SDict begin [/Subtype /Link/Dest (0:123) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1181 a Black 0 TeXcolorgray 596 1289
a
SDict begin H.S end
 596 1289 a Fk(1.4.)f(Getting)h(the)g(Examples)1462
1289 y
SDict begin 13 H.L end
 1462 1289 a 1462 1289 a
SDict begin [/Subtype /Link/Dest (0:126) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1462 1289 a Black Black
9 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3842 1289 a
SDict begin H.S end
 3842
1289 a Fk(2)3884 1289 y
SDict begin 13 H.L end
 3884 1289 a 3884 1289 a
SDict begin [/Subtype /Link/Dest (0:126) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
1289 a Black 0 TeXcolorgray 596 1396 a
SDict begin H.S end
 596 1396 a Fk(1.5.)f(Ask)h(and)g
(Y)-8 b(e)20 b(Shall)h(Recei)n(v)o(e)1602 1396 y
SDict begin 13 H.L end
 1602
1396 a 1602 1396 a
SDict begin [/Subtype /Link/Dest (0:133) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1602 1396 a Black Black 15 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3842 1396 a
SDict begin H.S end
 3842 1396 a Fk(3)3884
1396 y
SDict begin 13 H.L end
 3884 1396 a 3884 1396 a
SDict begin [/Subtype /Link/Dest (0:133) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1396 a Black 0 TeXcolorgray
596 1504 a
SDict begin H.S end
 596 1504 a Fk(1.6.)e(A)i(Minor)e(Note)h(on)g(Strings)1572
1504 y
SDict begin 13 H.L end
 1572 1504 a 1572 1504 a
SDict begin [/Subtype /Link/Dest (0:170) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1572 1504 a Black Black
3 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3842 1504 a
SDict begin H.S end
 3842 1504 a Fk(8)3884 1504 y
SDict begin 13 H.L end
 3884 1504 a
3884 1504 a
SDict begin [/Subtype /Link/Dest (0:170) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1504 a Black 0 TeXcolorgray 596 1612
a
SDict begin H.S end
 596 1612 a Fk(1.7.)f(V)-9 b(ersion)19 b(Reporting)1349
1612 y
SDict begin 13 H.L end
 1349 1612 a 1349 1612 a
SDict begin [/Subtype /Link/Dest (0:195) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1349 1612 a Black Black
19 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3842 1612 a
SDict begin H.S end
 3842 1612 a Fk(9)3884
1612 y
SDict begin 13 H.L end
 3884 1612 a 3884 1612 a
SDict begin [/Subtype /Link/Dest (0:195) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1612 a Black 0 TeXcolorgray
596 1720 a
SDict begin H.S end
 596 1720 a Fk(1.8.)g(Getting)h(the)g(Message)g(Out)1569
1720 y
SDict begin 13 H.L end
 1569 1720 a 1569 1720 a
SDict begin [/Subtype /Link/Dest (0:202) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1569 1720 a Black Black
6 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 1720 a
SDict begin H.S end
 3800 1720 a
Fk(10)3884 1720 y
SDict begin 13 H.L end
 3884 1720 a 3884 1720 a
SDict begin [/Subtype /Link/Dest (0:202) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1720 a
Black 0 TeXcolorgray 596 1828 a
SDict begin H.S end
 596 1828 a Fk(1.9.)f(Di)n(vide)g(and)h
(Conquer)1414 1828 y
SDict begin 13 H.L end
 1414 1828 a 1414 1828 a
SDict begin [/Subtype /Link/Dest (0:249) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1414 1828
a Black Black 16 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 1828 a
SDict begin H.S end
 3800 1828 a Fk(14)3884 1828 y
SDict begin 13 H.L end
 3884 1828 a
3884 1828 a
SDict begin [/Subtype /Link/Dest (0:249) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1828 a Black 0 TeXcolorgray 596 1936
a
SDict begin H.S end
 596 1936 a Fk(1.10.)e(Programming)g(with)i(\330MQ)1622
1936 y
SDict begin 13 H.L end
 1622 1936 a 1622 1936 a
SDict begin [/Subtype /Link/Dest (0:299) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1622 1936 a Black Black
15 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 1936 a
SDict begin H.S end
 3800 1936 a
Fk(19)3884 1936 y
SDict begin 13 H.L end
 3884 1936 a 3884 1936 a
SDict begin [/Subtype /Link/Dest (0:299) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1936 a
Black 0 TeXcolorgray 596 2044 a
SDict begin H.S end
 596 2044 a Fk(1.11.)e(Getting)i(the)g
(Conte)o(xt)g(Right)1642 2044 y
SDict begin 13 H.L end
 1642 2044 a 1642 2044
a
SDict begin [/Subtype /Link/Dest (0:319) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1642 2044 a Black Black 16 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 2044 a
SDict begin H.S end

3800 2044 a Fk(21)3884 2044 y
SDict begin 13 H.L end
 3884 2044 a 3884 2044 a
SDict begin [/Subtype /Link/Dest (0:319) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3884 2044 a Black 0 TeXcolorgray 596 2152 a
SDict begin H.S end
 596 2152
a Fk(1.12.)e(Making)h(a)i(Clean)f(Exit)1472 2152 y
SDict begin 13 H.L end
 1472
2152 a 1472 2152 a
SDict begin [/Subtype /Link/Dest (0:327) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1472 2152 a Black Black 20 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 2152 a
SDict begin H.S end
 3800
2152 a Fk(22)3884 2152 y
SDict begin 13 H.L end
 3884 2152 a 3884 2152 a
SDict begin [/Subtype /Link/Dest (0:327) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
2152 a Black 0 TeXcolorgray 596 2260 a
SDict begin H.S end
 596 2260 a Fk(1.13.)e(Why)i(W)-7
b(e)21 b(Needed)f(\330MQ)1562 2260 y
SDict begin 13 H.L end
 1562 2260 a 1562
2260 a
SDict begin [/Subtype /Link/Dest (0:345) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1562 2260 a Black Black 13 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 2260 a
SDict begin H.S end
 3800 2260 a Fk(23)3884 2260 y
SDict begin 13 H.L end
 3884 2260 a
3884 2260 a
SDict begin [/Subtype /Link/Dest (0:345) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2260 a Black 0 TeXcolorgray 596 2368
a
SDict begin H.S end
 596 2368 a Fk(1.14.)e(Sock)o(et)i(Scalability)1384
2368 y
SDict begin 13 H.L end
 1384 2368 a 1384 2368 a
SDict begin [/Subtype /Link/Dest (0:422) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1384 2368 a Black Black
4 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 2368 a
SDict begin H.S end
 3800 2368 a Fk(27)3884
2368 y
SDict begin 13 H.L end
 3884 2368 a 3884 2368 a
SDict begin [/Subtype /Link/Dest (0:422) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2368 a Black 0 TeXcolorgray
596 2476 a
SDict begin H.S end
 596 2476 a Fk(1.15.)e(Missing)j(Message)f(Problem)f(Solv)o
(er)1901 2476 y
SDict begin 13 H.L end
 1901 2476 a 1901 2476 a
SDict begin [/Subtype /Link/Dest (0:429) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1901 2476 a Black
Black 6 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 2476 a
SDict begin H.S end
 3800 2476 a
Fk(28)3884 2476 y
SDict begin 13 H.L end
 3884 2476 a 3884 2476 a
SDict begin [/Subtype /Link/Dest (0:429) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2476 a
Black 0 TeXcolorgray 596 2584 a
SDict begin H.S end
 596 2584 a Fk(1.16.)f(Upgrading)g(from)
h(\330MQ/2.2)h(to)g(\330MQ/3.2)2089 2584 y
SDict begin 13 H.L end
 2089 2584
a 2089 2584 a
SDict begin [/Subtype /Link/Dest (0:441) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2089 2584 a Black Black 5 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 2584 a
SDict begin H.S end
 3800 2584 a Fk(30)3884 2584
y
SDict begin 13 H.L end
 3884 2584 a 3884 2584 a
SDict begin [/Subtype /Link/Dest (0:441) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2584 a Black 0 TeXcolorgray
596 2692 a
SDict begin H.S end
 596 2692 a Fk(1.17.)e(W)-7 b(arning)20 b(-)g(Unstable)g(P)o
(aradigms!)1830 2692 y
SDict begin 13 H.L end
 1830 2692 a 1830 2692 a
SDict begin [/Subtype /Link/Dest (0:449) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1830 2692
a Black Black 15 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 2692 a
SDict begin H.S end
 3800
2692 a Fk(30)3884 2692 y
SDict begin 13 H.L end
 3884 2692 a 3884 2692 a
SDict begin [/Subtype /Link/Dest (0:449) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
2692 a Black 0 TeXcolorgray 396 2819 a
SDict begin H.S end
 396 2819 a Fg(2.)g(Intermediate)
g(Stuff)1137 2819 y
SDict begin 13 H.L end
 1137 2819 a 1137 2819 a
SDict begin [/Subtype /Link/Dest (0:457) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1137 2819
a Black Black 2 w Fg(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 2819 a
SDict begin H.S end
 3800 2819 a
Fg(32)3884 2819 y
SDict begin 13 H.L end
 3884 2819 a 3884 2819 a
SDict begin [/Subtype /Link/Dest (0:457) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2819 a
Black 0 TeXcolorgray 596 2947 a
SDict begin H.S end
 596 2947 a Fk(2.1.)f(The)h(Zen)g(of)f
(Zero)1288 2947 y
SDict begin 13 H.L end
 1288 2947 a 1288 2947 a
SDict begin [/Subtype /Link/Dest (0:494) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1288 2947 a
Black Black 17 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
2947 a
SDict begin H.S end
 3800 2947 a Fk(32)3884 2947 y
SDict begin 13 H.L end
 3884 2947 a 3884
2947 a
SDict begin [/Subtype /Link/Dest (0:494) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 2947 a Black 0 TeXcolorgray 596 3055 a
SDict begin H.S end
 596
3055 a Fk(2.2.)g(The)h(Sock)o(et)g(API)1271 3055 y
SDict begin 13 H.L end
 1271
3055 a 1271 3055 a
SDict begin [/Subtype /Link/Dest (0:499) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1271 3055 a Black Black 14 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
3055 a
SDict begin H.S end
 3800 3055 a Fk(32)3884 3055 y
SDict begin 13 H.L end
 3884 3055 a 3884
3055 a
SDict begin [/Subtype /Link/Dest (0:499) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3055 a Black 0 TeXcolorgray 596 3163 a
SDict begin H.S end
 596
3163 a Fk(2.3.)f(Plugging)f(Sock)o(ets)j(Into)e(the)h(T)-7
b(opology)1935 3163 y
SDict begin 13 H.L end
 1935 3163 a 1935 3163 a
SDict begin [/Subtype /Link/Dest (0:517) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1935 3163
a Black Black 14 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 3163 a
SDict begin H.S end
 3800 3163 a Fk(34)3884 3163 y
SDict begin 13 H.L end
 3884 3163 a
3884 3163 a
SDict begin [/Subtype /Link/Dest (0:517) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3163 a Black 0 TeXcolorgray 596 3271
a
SDict begin H.S end
 596 3271 a Fk(2.4.)19 b(Using)h(Sock)o(ets)g(to)g(Carry)g(Data)1690
3271 y
SDict begin 13 H.L end
 1690 3271 a 1690 3271 a
SDict begin [/Subtype /Link/Dest (0:553) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1690 3271 a Black Black
10 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 3271 a
SDict begin H.S end
 3800
3271 a Fk(35)3884 3271 y
SDict begin 13 H.L end
 3884 3271 a 3884 3271 a
SDict begin [/Subtype /Link/Dest (0:553) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
3271 a Black 0 TeXcolorgray 596 3379 a
SDict begin H.S end
 596 3379 a Fk(2.5.)f(Unicast)h
(T)m(ransports)1369 3379 y
SDict begin 13 H.L end
 1369 3379 a 1369 3379 a
SDict begin [/Subtype /Link/Dest (0:580) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1369
3379 a Black Black -1 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 3379 a
SDict begin H.S end
 3800 3379 a Fk(37)3884 3379 y
SDict begin 13 H.L end
 3884 3379 a
3884 3379 a
SDict begin [/Subtype /Link/Dest (0:580) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3379 a Black 0 TeXcolorgray 596 3487
a
SDict begin H.S end
 596 3487 a Fk(2.6.)f(\330MQ)h(is)h(Not)g(a)f(Neutral)g(Carrier)1740
3487 y
SDict begin 13 H.L end
 1740 3487 a 1740 3487 a
SDict begin [/Subtype /Link/Dest (0:607) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1740 3487 a Black Black
1 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
3487 a
SDict begin H.S end
 3800 3487 a Fk(38)3884 3487 y
SDict begin 13 H.L end
 3884 3487 a 3884
3487 a
SDict begin [/Subtype /Link/Dest (0:607) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3487 a Black 0 TeXcolorgray 596 3595 a
SDict begin H.S end
 596
3595 a Fk(2.7.)f(I/O)h(Threads)1141 3595 y
SDict begin 13 H.L end
 1141 3595
a 1141 3595 a
SDict begin [/Subtype /Link/Dest (0:628) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1141 3595 a Black Black 19 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 3595 a
SDict begin H.S end
 3800
3595 a Fk(39)3884 3595 y
SDict begin 13 H.L end
 3884 3595 a 3884 3595 a
SDict begin [/Subtype /Link/Dest (0:628) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
3595 a Black 0 TeXcolorgray 596 3703 a
SDict begin H.S end
 596 3703 a Fk(2.8.)f(Limiting)g
(Sock)o(et)h(Use)1427 3703 y
SDict begin 13 H.L end
 1427 3703 a 1427 3703 a
SDict begin [/Subtype /Link/Dest (0:635) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

1427 3703 a Black Black 3 w Fk(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 3703 a
SDict begin H.S end
 3800 3703 a Fk(39)3884 3703
y
SDict begin 13 H.L end
 3884 3703 a 3884 3703 a
SDict begin [/Subtype /Link/Dest (0:635) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3703 a Black 0 TeXcolorgray
596 3811 a
SDict begin H.S end
 596 3811 a Fk(2.9.)f(Core)h(Messaging)f(P)o(atterns)1570
3811 y
SDict begin 13 H.L end
 1570 3811 a 1570 3811 a
SDict begin [/Subtype /Link/Dest (0:639) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1570 3811 a Black Black
5 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 3811 a
SDict begin H.S end
 3800 3811 a
Fk(40)3884 3811 y
SDict begin 13 H.L end
 3884 3811 a 3884 3811 a
SDict begin [/Subtype /Link/Dest (0:639) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3811 a
Black 0 TeXcolorgray 596 3919 a
SDict begin H.S end
 596 3919 a Fk(2.10.)f(High-le)n(v)o(el)
h(Messaging)g(P)o(atterns)1802 3919 y
SDict begin 13 H.L end
 1802 3919 a 1802
3919 a
SDict begin [/Subtype /Link/Dest (0:684) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1802 3919 a Black Black 1 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 3919 a
SDict begin H.S end
 3800 3919 a
Fk(41)3884 3919 y
SDict begin 13 H.L end
 3884 3919 a 3884 3919 a
SDict begin [/Subtype /Link/Dest (0:684) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 3919 a
Black 0 TeXcolorgray 596 4027 a
SDict begin H.S end
 596 4027 a Fk(2.11.)f(W)-7
b(orking)20 b(with)g(Messages)1583 4027 y
SDict begin 13 H.L end
 1583 4027 a
1583 4027 a
SDict begin [/Subtype /Link/Dest (0:690) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1583 4027 a Black Black 13 w Fk(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
4027 a
SDict begin H.S end
 3800 4027 a Fk(42)3884 4027 y
SDict begin 13 H.L end
 3884 4027 a 3884
4027 a
SDict begin [/Subtype /Link/Dest (0:690) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4027 a Black 0 TeXcolorgray 596 4135 a
SDict begin H.S end
 596
4135 a Fk(2.12.)e(Handling)h(Multiple)h(Sock)o(ets)1677
4135 y
SDict begin 13 H.L end
 1677 4135 a 1677 4135 a
SDict begin [/Subtype /Link/Dest (0:728) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1677 4135 a Black Black
2 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
4135 a
SDict begin H.S end
 3800 4135 a Fk(43)3884 4135 y
SDict begin 13 H.L end
 3884 4135 a 3884
4135 a
SDict begin [/Subtype /Link/Dest (0:728) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4135 a Black 0 TeXcolorgray 596 4242 a
SDict begin H.S end
 596
4242 a Fk(2.13.)e(Handling)h(Errors)g(and)h(ETERM)1763
4242 y
SDict begin 13 H.L end
 1763 4242 a 1763 4242 a
SDict begin [/Subtype /Link/Dest (0:751) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1763 4242 a Black Black
20 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 4242 a
SDict begin H.S end
 3800 4242 a Fk(46)3884
4242 y
SDict begin 13 H.L end
 3884 4242 a 3884 4242 a
SDict begin [/Subtype /Link/Dest (0:751) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4242 a Black 0 TeXcolorgray
596 4350 a
SDict begin H.S end
 596 4350 a Fk(2.14.)e(Handling)h(Interrupt)f(Signals)1668
4350 y
SDict begin 13 H.L end
 1668 4350 a 1668 4350 a
SDict begin [/Subtype /Link/Dest (0:806) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1668 4350 a Black Black
11 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
4350 a
SDict begin H.S end
 3800 4350 a Fk(51)3884 4350 y
SDict begin 13 H.L end
 3884 4350 a 3884
4350 a
SDict begin [/Subtype /Link/Dest (0:806) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4350 a Black 0 TeXcolorgray 596 4458 a
SDict begin H.S end
 596
4458 a Fk(2.15.)g(Detecting)i(Memory)f(Leaks)1632 4458
y
SDict begin 13 H.L end
 1632 4458 a 1632 4458 a
SDict begin [/Subtype /Link/Dest (0:826) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1632 4458 a Black Black 5 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 4458 a
SDict begin H.S end
 3800 4458 a
Fk(53)3884 4458 y
SDict begin 13 H.L end
 3884 4458 a 3884 4458 a
SDict begin [/Subtype /Link/Dest (0:826) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4458 a
Black 0 TeXcolorgray 596 4566 a
SDict begin H.S end
 596 4566 a Fk(2.16.)f(Multi-part)h
(Messages)1467 4566 y
SDict begin 13 H.L end
 1467 4566 a 1467 4566 a
SDict begin [/Subtype /Link/Dest (0:847) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1467 4566
a Black Black 4 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 4566 a
SDict begin H.S end
 3800 4566 a Fk(54)3884
4566 y
SDict begin 13 H.L end
 3884 4566 a 3884 4566 a
SDict begin [/Subtype /Link/Dest (0:847) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4566 a Black 0 TeXcolorgray
596 4674 a
SDict begin H.S end
 596 4674 a Fk(2.17.)f(Intermediaries)h(and)g(Proxies)1673
4674 y
SDict begin 13 H.L end
 1673 4674 a 1673 4674 a
SDict begin [/Subtype /Link/Dest (0:872) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1673 4674 a Black Black
6 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
4674 a
SDict begin H.S end
 3800 4674 a Fk(55)3884 4674 y
SDict begin 13 H.L end
 3884 4674 a 3884
4674 a
SDict begin [/Subtype /Link/Dest (0:872) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4674 a Black 0 TeXcolorgray 795 4782 a
SDict begin H.S end
 795
4782 a Fk(2.17.1.)f(The)i(Dynamic)f(Disco)o(v)o(ery)f(Problem)2161
4782 y
SDict begin 13 H.L end
 2161 4782 a 2161 4782 a
SDict begin [/Subtype /Link/Dest (0:876) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2161 4782 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 4782 a
SDict begin H.S end
 3800 4782 a Fk(55)3884 4782
y
SDict begin 13 H.L end
 3884 4782 a 3884 4782 a
SDict begin [/Subtype /Link/Dest (0:876) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4782 a Black 0 TeXcolorgray
795 4890 a
SDict begin H.S end
 795 4890 a Fk(2.17.2.)g(The)i(Shared)f(Queue)g(Problem)1965
4890 y
SDict begin 13 H.L end
 1965 4890 a 1965 4890 a
SDict begin [/Subtype /Link/Dest (0:903) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1965 4890 a Black Black
5 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 4890 a
SDict begin H.S end
 3800 4890 a
Fk(58)3884 4890 y
SDict begin 13 H.L end
 3884 4890 a 3884 4890 a
SDict begin [/Subtype /Link/Dest (0:903) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4890 a
Black 0 TeXcolorgray 795 4998 a
SDict begin H.S end
 795 4998 a Fk(2.17.3.)f(\330MQ')-5
b(s)21 b(Built-in)f(Proxy)f(Function)2109 4998 y
SDict begin 13 H.L end
 2109
4998 a 2109 4998 a
SDict begin [/Subtype /Link/Dest (0:945) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2109 4998 a Black Black 6 w Fk(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 4998 a
SDict begin H.S end
 3800 4998 a Fk(64)3884 4998 y
SDict begin 13 H.L end
 3884 4998 a
3884 4998 a
SDict begin [/Subtype /Link/Dest (0:945) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 4998 a Black 0 TeXcolorgray 795 5106
a
SDict begin H.S end
 795 5106 a Fk(2.17.4.)f(The)i(T)m(ransport)e(Bridging)h(Problem)2133
5106 y
SDict begin 13 H.L end
 2133 5106 a 2133 5106 a
SDict begin [/Subtype /Link/Dest (0:954) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2133 5106 a Black Black
3 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
5106 a
SDict begin H.S end
 3800 5106 a Fk(65)3884 5106 y
SDict begin 13 H.L end
 3884 5106 a 3884
5106 a
SDict begin [/Subtype /Link/Dest (0:954) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 5106 a Black Black 3823 5569 a Ff(iv)p Black
eop end
%%Page: 5 5
TeXDict begin 5 4 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.v) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black 0 TeXcolorgray 596 72 a
SDict begin H.S end
 596 72 a Fk(2.18.)18
b(Multithreading)g(with)j(\330MQ)1664 72 y
SDict begin 13 H.L end
 1664 72 a
1664 72 a
SDict begin [/Subtype /Link/Dest (0:967) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1664 72 a Black Black 15 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 72 a
SDict begin H.S end
 3800 72 a Fk(67)3884
72 y
SDict begin 13 H.L end
 3884 72 a 3884 72 a
SDict begin [/Subtype /Link/Dest (0:967) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 72 a Black 0 TeXcolorgray
596 180 a
SDict begin H.S end
 596 180 a Fk(2.19.)d(Signaling)h(between)h(Threads)1688
180 y
SDict begin 13 H.L end
 1688 180 a 1688 180 a
SDict begin [/Subtype /Link/Dest (0:1024) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1688 180 a Black Black 12
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 180 a
SDict begin H.S end
 3800 180 a Fk(71)3884
180 y
SDict begin 13 H.L end
 3884 180 a 3884 180 a
SDict begin [/Subtype /Link/Dest (0:1024) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 180 a Black 0 TeXcolorgray
596 288 a
SDict begin H.S end
 596 288 a Fk(2.20.)e(Node)i(Coordination)1424
288 y
SDict begin 13 H.L end
 1424 288 a 1424 288 a
SDict begin [/Subtype /Link/Dest (0:1066) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1424 288 a Black Black 6
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 288 a
SDict begin H.S end
 3800 288
a Fk(75)3884 288 y
SDict begin 13 H.L end
 3884 288 a 3884 288 a
SDict begin [/Subtype /Link/Dest (0:1066) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 288 a Black
0 TeXcolorgray 596 396 a
SDict begin H.S end
 596 396 a Fk(2.21.)e(Zero)i(Cop)o(y)1140
396 y
SDict begin 13 H.L end
 1140 396 a 1140 396 a
SDict begin [/Subtype /Link/Dest (0:1106) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1140 396 a Black Black -1
w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 396 a
SDict begin H.S end
 3800 396 a Fk(79)3884 396 y
SDict begin 13 H.L end

3884 396 a 3884 396 a
SDict begin [/Subtype /Link/Dest (0:1106) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 396 a Black 0 TeXcolorgray
596 504 a
SDict begin H.S end
 596 504 a Fk(2.22.)e(Pub-Sub)h(Message)h(En)m(v)o(elopes)1744
504 y
SDict begin 13 H.L end
 1744 504 a 1744 504 a
SDict begin [/Subtype /Link/Dest (0:1114) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1744 504 a Black Black 18
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 504 a
SDict begin H.S end
 3800 504 a Fk(80)3884
504 y
SDict begin 13 H.L end
 3884 504 a 3884 504 a
SDict begin [/Subtype /Link/Dest (0:1114) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 504 a Black 0 TeXcolorgray
596 612 a
SDict begin H.S end
 596 612 a Fk(2.23.)e(High)i(W)-7 b(ater)21
b(Marks)1399 612 y
SDict begin 13 H.L end
 1399 612 a 1399 612 a
SDict begin [/Subtype /Link/Dest (0:1144) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1399 612 a Black
Black 10 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 612 a
SDict begin H.S end
 3800 612 a Fk(82)3884 612 y
SDict begin 13 H.L end

3884 612 a 3884 612 a
SDict begin [/Subtype /Link/Dest (0:1144) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 612 a Black 0 TeXcolorgray
596 720 a
SDict begin H.S end
 596 720 a Fk(2.24.)d(A)j(Bare)g(Necessity)1364
720 y
SDict begin 13 H.L end
 1364 720 a 1364 720 a
SDict begin [/Subtype /Link/Dest (0:1157) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1364 720 a Black Black 4
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 720 a
SDict begin H.S end
 3800 720
a Fk(83)3884 720 y
SDict begin 13 H.L end
 3884 720 a 3884 720 a
SDict begin [/Subtype /Link/Dest (0:1157) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 720 a Black
0 TeXcolorgray 396 848 a
SDict begin H.S end
 396 848 a Fg(3.)f(Adv)o(anced)g(Request-Reply)
g(P)o(atter)o(ns)1695 848 y
SDict begin 13 H.L end
 1695 848 a 1695 848 a
SDict begin [/Subtype /Link/Dest (0:1167) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1695
848 a Black Black 5 w Fg(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
848 a
SDict begin H.S end
 3800 848 a Fg(85)3884 848 y
SDict begin 13 H.L end
 3884 848 a 3884 848
a
SDict begin [/Subtype /Link/Dest (0:1167) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 848 a Black 0 TeXcolorgray 596 976 a
SDict begin H.S end
 596 976 a
Fk(3.1.)f(Request-Reply)g(En)m(v)o(elopes)1599 976 y
SDict begin 13 H.L end

1599 976 a 1599 976 a
SDict begin [/Subtype /Link/Dest (0:1194) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1599 976 a Black Black 18 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 976 a
SDict begin H.S end

3800 976 a Fk(85)3884 976 y
SDict begin 13 H.L end
 3884 976 a 3884 976 a
SDict begin [/Subtype /Link/Dest (0:1194) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884
976 a Black 0 TeXcolorgray 596 1084 a
SDict begin H.S end
 596 1084 a Fk(3.2.)g(Custom)h
(Request-Reply)f(Routing)1803 1084 y
SDict begin 13 H.L end
 1803 1084 a 1803
1084 a
SDict begin [/Subtype /Link/Dest (0:1261) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1803 1084 a Black Black Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 1084 a
SDict begin H.S end
 3800 1084 a
Fk(89)3884 1084 y
SDict begin 13 H.L end
 3884 1084 a 3884 1084 a
SDict begin [/Subtype /Link/Dest (0:1261) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1084 a
Black 0 TeXcolorgray 596 1192 a
SDict begin H.S end
 596 1192 a Fk(3.3.)g(R)m
(OUTER-to-DEALER)g(Routing)1807 1192 y
SDict begin 13 H.L end
 1807 1192 a 1807
1192 a
SDict begin [/Subtype /Link/Dest (0:1287) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1807 1192 a Black Black 17 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 1192 a
SDict begin H.S end
 3800 1192 a Fk(90)3884 1192
y
SDict begin 13 H.L end
 3884 1192 a 3884 1192 a
SDict begin [/Subtype /Link/Dest (0:1287) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1192 a Black 0 TeXcolorgray
596 1300 a
SDict begin H.S end
 596 1300 a Fk(3.4.)g(Least-Recently)g(Used)i(Routing)e(\(LR)
m(U)h(P)o(attern\))2218 1300 y
SDict begin 13 H.L end
 2218 1300 a 2218 1300
a
SDict begin [/Subtype /Link/Dest (0:1323) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2218 1300 a Black Black 1 w Fk(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 1300 a
SDict begin H.S end
 3800 1300 a Fk(94)3884 1300 y
SDict begin 13 H.L end
 3884 1300 a
3884 1300 a
SDict begin [/Subtype /Link/Dest (0:1323) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1300 a Black 0 TeXcolorgray 596 1407
a
SDict begin H.S end
 596 1407 a Fk(3.5.)f(Address-based)f(Routing)1519 1407
y
SDict begin 13 H.L end
 1519 1407 a 1519 1407 a
SDict begin [/Subtype /Link/Dest (0:1372) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1519 1407 a Black Black 15
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 1407 a
SDict begin H.S end
 3800 1407 a Fk(98)3884 1407 y
SDict begin 13 H.L end
 3884 1407 a
3884 1407 a
SDict begin [/Subtype /Link/Dest (0:1372) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3884 1407 a Black 0 TeXcolorgray 596 1515
a
SDict begin H.S end
 596 1515 a Fk(3.6.)h(A)i(Request-Reply)e(Message)h(Brok)o(er)1878
1515 y
SDict begin 13 H.L end
 1878 1515 a 1878 1515 a
SDict begin [/Subtype /Link/Dest (0:1431) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1878 1515 a Black Black
9 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1515 a
SDict begin H.S end
 3759 1515 a Fk(101)3885 1515 y
SDict begin 13 H.L end
 3885 1515
a 3885 1515 a
SDict begin [/Subtype /Link/Dest (0:1431) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1515 a Black 0 TeXcolorgray 596 1623
a
SDict begin H.S end
 596 1623 a Fk(3.7.)f(A)i(High-Le)n(v)o(el)d(API)i(for)g(\330MQ)1688
1623 y
SDict begin 13 H.L end
 1688 1623 a 1688 1623 a
SDict begin [/Subtype /Link/Dest (0:1525) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1688 1623 a Black Black
12 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1623 a
SDict begin H.S end
 3759 1623 a Fk(110)3885 1623 y
SDict begin 13 H.L end
 3885 1623
a 3885 1623 a
SDict begin [/Subtype /Link/Dest (0:1525) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1623 a Black 0 TeXcolorgray 596 1731
a
SDict begin H.S end
 596 1731 a Fk(3.8.)f(Asynchronous)e(Client-Serv)o(er)1689
1731 y
SDict begin 13 H.L end
 1689 1731 a 1689 1731 a
SDict begin [/Subtype /Link/Dest (0:1605) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1689 1731 a Black Black
11 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1731 a
SDict begin H.S end
 3759 1731 a Fk(118)3885 1731 y
SDict begin 13 H.L end
 3885 1731
a 3885 1731 a
SDict begin [/Subtype /Link/Dest (0:1605) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1731 a Black 0 TeXcolorgray 596 1839
a
SDict begin H.S end
 596 1839 a Fk(3.9.)i(W)-7 b(ork)o(ed)20 b(Example:)e(Inter)n(-Brok)o
(er)h(Routing)2063 1839 y
SDict begin 13 H.L end
 2063 1839 a 2063 1839 a
SDict begin [/Subtype /Link/Dest (0:1669) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2063
1839 a Black Black 10 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1839 a
SDict begin H.S end
 3759 1839
a Fk(124)3885 1839 y
SDict begin 13 H.L end
 3885 1839 a 3885 1839 a
SDict begin [/Subtype /Link/Dest (0:1669) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1839
a Black 0 TeXcolorgray 795 1947 a
SDict begin H.S end
 795 1947 a Fk(3.9.1.)f(Establishing)i
(the)g(Details)1791 1947 y
SDict begin 13 H.L end
 1791 1947 a 1791 1947 a
SDict begin [/Subtype /Link/Dest (0:1673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1791
1947 a Black Black 12 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1947 a
SDict begin H.S end
 3759
1947 a Fk(124)3885 1947 y
SDict begin 13 H.L end
 3885 1947 a 3885 1947 a
SDict begin [/Subtype /Link/Dest (0:1673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
1947 a Black 0 TeXcolorgray 795 2055 a
SDict begin H.S end
 795 2055 a Fk(3.9.2.)e
(Architecture)h(of)h(a)h(Single)f(Cluster)2059 2055 y
SDict begin 13 H.L end

2059 2055 a 2059 2055 a
SDict begin [/Subtype /Link/Dest (0:1697) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2059 2055 a Black Black 14 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2055 a
SDict begin H.S end
 3759 2055 a Fk(125)3885 2055 y
SDict begin 13 H.L end
 3885 2055
a 3885 2055 a
SDict begin [/Subtype /Link/Dest (0:1697) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2055 a Black 0 TeXcolorgray 795 2163
a
SDict begin H.S end
 795 2163 a Fk(3.9.3.)e(Scaling)i(to)g(Multiple)g(Clusters)1936
2163 y
SDict begin 13 H.L end
 1936 2163 a 1936 2163 a
SDict begin [/Subtype /Link/Dest (0:1707) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1936 2163 a Black Black
13 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2163 a
SDict begin H.S end
 3759 2163 a Fk(126)3885 2163 y
SDict begin 13 H.L end
 3885 2163
a 3885 2163 a
SDict begin [/Subtype /Link/Dest (0:1707) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2163 a Black 0 TeXcolorgray 795 2271
a
SDict begin H.S end
 795 2271 a Fk(3.9.4.)e(Federation)h(vs.)h(Peering)1748
2271 y
SDict begin 13 H.L end
 1748 2271 a 1748 2271 a
SDict begin [/Subtype /Link/Dest (0:1756) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1748 2271 a Black Black
14 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2271 a
SDict begin H.S end
 3759 2271 a Fk(129)3885 2271 y
SDict begin 13 H.L end
 3885 2271
a 3885 2271 a
SDict begin [/Subtype /Link/Dest (0:1756) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2271 a Black 0 TeXcolorgray 795 2379
a
SDict begin H.S end
 795 2379 a Fk(3.9.5.)e(The)i(Naming)f(Ceremon)o(y)1787
2379 y
SDict begin 13 H.L end
 1787 2379 a 1787 2379 a
SDict begin [/Subtype /Link/Dest (0:1778) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1787 2379 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2379 a
SDict begin H.S end
 3759 2379 a Fk(130)3885 2379
y
SDict begin 13 H.L end
 3885 2379 a 3885 2379 a
SDict begin [/Subtype /Link/Dest (0:1778) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2379 a Black 0 TeXcolorgray
795 2487 a
SDict begin H.S end
 795 2487 a Fk(3.9.6.)f(Prototyping)g(the)i(State)h(Flo)n(w)
1893 2487 y
SDict begin 13 H.L end
 1893 2487 a 1893 2487 a
SDict begin [/Subtype /Link/Dest (0:1828) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1893 2487 a Black
Black 14 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 2487
a
SDict begin H.S end
 3759 2487 a Fk(132)3885 2487 y
SDict begin 13 H.L end
 3885 2487 a 3885 2487
a
SDict begin [/Subtype /Link/Dest (0:1828) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2487 a Black 0 TeXcolorgray 795 2595 a
SDict begin H.S end
 795 2595
a Fk(3.9.7.)d(Prototyping)g(the)i(Local)g(and)g(Cloud)g(Flo)n(ws)2313
2595 y
SDict begin 13 H.L end
 2313 2595 a 2313 2595 a
SDict begin [/Subtype /Link/Dest (0:1866) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2313 2595 a Black Black
9 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2595 a
SDict begin H.S end
 3759 2595 a Fk(135)3885 2595
y
SDict begin 13 H.L end
 3885 2595 a 3885 2595 a
SDict begin [/Subtype /Link/Dest (0:1866) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2595 a Black 0 TeXcolorgray
795 2703 a
SDict begin H.S end
 795 2703 a Fk(3.9.8.)e(Putting)i(it)h(All)g(T)-7
b(ogether)1752 2703 y
SDict begin 13 H.L end
 1752 2703 a 1752 2703 a
SDict begin [/Subtype /Link/Dest (0:1922) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1752 2703
a Black Black 10 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2703 a
SDict begin H.S end
 3759 2703 a Fk(142)3885 2703
y
SDict begin 13 H.L end
 3885 2703 a 3885 2703 a
SDict begin [/Subtype /Link/Dest (0:1922) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2703 a Black 0 TeXcolorgray
396 2830 a
SDict begin H.S end
 396 2830 a Fg(4.)20 b(Reliable)h(Request-Reply)1313
2830 y
SDict begin 13 H.L end
 1313 2830 a 1313 2830 a
SDict begin [/Subtype /Link/Dest (0:1980) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1313 2830 a Black Black
13 w Fg(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2830 a
SDict begin H.S end
 3759
2830 a Fg(150)3885 2830 y
SDict begin 13 H.L end
 3885 2830 a 3885 2830 a
SDict begin [/Subtype /Link/Dest (0:1980) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2830 a Black 0 TeXcolorgray 596 2958 a
SDict begin H.S end
 596 2958 a Fk(4.1.)e(What)h(is)i
("Reliability"?)1474 2958 y
SDict begin 13 H.L end
 1474 2958 a 1474 2958 a
SDict begin [/Subtype /Link/Dest (0:2006) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1474
2958 a Black Black 18 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2958 a
SDict begin H.S end
 3759 2958
a Fk(150)3885 2958 y
SDict begin 13 H.L end
 3885 2958 a 3885 2958 a
SDict begin [/Subtype /Link/Dest (0:2006) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2958
a Black 0 TeXcolorgray 596 3066 a
SDict begin H.S end
 596 3066 a Fk(4.2.)d(Designing)g
(Reliability)1454 3066 y
SDict begin 13 H.L end
 1454 3066 a 1454 3066 a
SDict begin [/Subtype /Link/Dest (0:2028) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1454
3066 a Black Black 17 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3066
a
SDict begin H.S end
 3759 3066 a Fk(151)3885 3066 y
SDict begin 13 H.L end
 3885 3066 a 3885 3066
a
SDict begin [/Subtype /Link/Dest (0:2028) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3066 a Black 0 TeXcolorgray 596 3174 a
SDict begin H.S end
 596 3174
a Fk(4.3.)g(Client-side)h(Reliability)g(\(Lazy)g(Pirate)g(P)o(attern\))
2189 3174 y
SDict begin 13 H.L end
 2189 3174 a 2189 3174 a
SDict begin [/Subtype /Link/Dest (0:2052) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2189 3174 a Black
Black 9 w Fk(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3174 a
SDict begin H.S end
 3759 3174 a Fk(152)3885
3174 y
SDict begin 13 H.L end
 3885 3174 a 3885 3174 a
SDict begin [/Subtype /Link/Dest (0:2052) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3174 a Black 0 TeXcolorgray
596 3282 a
SDict begin H.S end
 596 3282 a Fk(4.4.)f(Basic)i(Reliable)f(Queuing)f(\(Simple)h
(Pirate)g(P)o(attern\))2311 3282 y
SDict begin 13 H.L end
 2311 3282 a 2311 3282
a
SDict begin [/Subtype /Link/Dest (0:2097) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2311 3282 a Black Black 11 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3282
a
SDict begin H.S end
 3759 3282 a Fk(156)3885 3282 y
SDict begin 13 H.L end
 3885 3282 a 3885 3282
a
SDict begin [/Subtype /Link/Dest (0:2097) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3282 a Black 0 TeXcolorgray 596 3390 a
SDict begin H.S end
 596 3390
a Fk(4.5.)f(Rob)n(ust)h(Reliable)h(Queuing)d(\(P)o(aranoid)h(Pirate)h
(P)o(attern\))2419 3390 y
SDict begin 13 H.L end
 2419 3390 a 2419 3390 a
SDict begin [/Subtype /Link/Dest (0:2118) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2419
3390 a Black Black 7 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3390 a
SDict begin H.S end
 3759 3390 a Fk(159)3885 3390 y
SDict begin 13 H.L end
 3885 3390
a 3885 3390 a
SDict begin [/Subtype /Link/Dest (0:2118) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3390 a Black 0 TeXcolorgray 596 3498
a
SDict begin H.S end
 596 3498 a Fk(4.6.)f(Heartbeating)1172 3498 y
SDict begin 13 H.L end
 1172
3498 a 1172 3498 a
SDict begin [/Subtype /Link/Dest (0:2192) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1172 3498 a Black Black 9 w Fk(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3498
a
SDict begin H.S end
 3759 3498 a Fk(168)3885 3498 y
SDict begin 13 H.L end
 3885 3498 a 3885 3498
a
SDict begin [/Subtype /Link/Dest (0:2192) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3498 a Black 0 TeXcolorgray 596 3606 a
SDict begin H.S end
 596 3606
a Fk(4.7.)g(Contracts)h(and)f(Protocols)1535 3606 y
SDict begin 13 H.L end
 1535
3606 a 1535 3606 a
SDict begin [/Subtype /Link/Dest (0:2220) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1535 3606 a Black Black 19 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3606 a
SDict begin H.S end
 3759 3606 a Fk(169)3885 3606 y
SDict begin 13 H.L end
 3885 3606
a 3885 3606 a
SDict begin [/Subtype /Link/Dest (0:2220) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3606 a Black 0 TeXcolorgray 596 3714
a
SDict begin H.S end
 596 3714 a Fk(4.8.)g(Service-Oriented)f(Reliable)i(Queuing)f
(\(Majordomo)e(P)o(attern\))2636 3714 y
SDict begin 13 H.L end
 2636 3714 a 2636
3714 a
SDict begin [/Subtype /Link/Dest (0:2239) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2636 3714 a Black Black 18 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3714 a
SDict begin H.S end
 3759
3714 a Fk(170)3885 3714 y
SDict begin 13 H.L end
 3885 3714 a 3885 3714 a
SDict begin [/Subtype /Link/Dest (0:2239) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3714 a Black 0 TeXcolorgray 596 3822 a
SDict begin H.S end
 596 3822 a Fk(4.9.)i
(Asynchronous)e(Majordomo)h(P)o(attern)1889 3822 y
SDict begin 13 H.L end
 1889
3822 a 1889 3822 a
SDict begin [/Subtype /Link/Dest (0:2400) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1889 3822 a Black Black 18 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 3822 a
SDict begin H.S end
 3759 3822
a Fk(193)3885 3822 y
SDict begin 13 H.L end
 3885 3822 a 3885 3822 a
SDict begin [/Subtype /Link/Dest (0:2400) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3822
a Black 0 TeXcolorgray 596 3930 a
SDict begin H.S end
 596 3930 a Fk(4.10.)g(Service)i
(Disco)o(v)o(ery)1393 3930 y
SDict begin 13 H.L end
 1393 3930 a 1393 3930 a
SDict begin [/Subtype /Link/Dest (0:2451) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

1393 3930 a Black Black 16 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3930
a
SDict begin H.S end
 3759 3930 a Fk(198)3885 3930 y
SDict begin 13 H.L end
 3885 3930 a 3885 3930
a
SDict begin [/Subtype /Link/Dest (0:2451) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3930 a Black 0 TeXcolorgray 596 4038 a
SDict begin H.S end
 596 4038
a Fk(4.11.)e(Idempotent)g(Services)1463 4038 y
SDict begin 13 H.L end
 1463 4038
a 1463 4038 a
SDict begin [/Subtype /Link/Dest (0:2461) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1463 4038 a Black Black 8 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4038 a
SDict begin H.S end
 3759 4038 a Fk(199)3885 4038 y
SDict begin 13 H.L end
 3885 4038
a 3885 4038 a
SDict begin [/Subtype /Link/Dest (0:2461) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4038 a Black 0 TeXcolorgray 596 4146
a
SDict begin H.S end
 596 4146 a Fk(4.12.)g(Disconnected)h(Reliability)h(\(T)m(itanic)g(P)o
(attern\))2170 4146 y
SDict begin 13 H.L end
 2170 4146 a 2170 4146 a
SDict begin [/Subtype /Link/Dest (0:2487) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2170 4146
a Black Black 7 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4146
a
SDict begin H.S end
 3759 4146 a Fk(200)3885 4146 y
SDict begin 13 H.L end
 3885 4146 a 3885 4146
a
SDict begin [/Subtype /Link/Dest (0:2487) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4146 a Black 0 TeXcolorgray 596 4253 a
SDict begin H.S end
 596 4253
a Fk(4.13.)e(High-a)n(v)n(ailability)h(P)o(air)h(\(Binary)f(Star)i(P)o
(attern\))2212 4253 y
SDict begin 13 H.L end
 2212 4253 a 2212 4253 a
SDict begin [/Subtype /Link/Dest (0:2615) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2212 4253
a Black Black 7 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4253 a
SDict begin H.S end
 3759 4253 a Fk(212)3885 4253 y
SDict begin 13 H.L end
 3885 4253
a 3885 4253 a
SDict begin [/Subtype /Link/Dest (0:2615) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4253 a Black 0 TeXcolorgray 795 4361
a
SDict begin H.S end
 795 4361 a Fk(4.13.1.)d(Ov)o(ervie)n(w)1370 4361 y
SDict begin 13 H.L end

1370 4361 a 1370 4361 a
SDict begin [/Subtype /Link/Dest (0:2617) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1370 4361 a Black Black 18 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4361 a
SDict begin H.S end
 3759
4361 a Fk(212)3885 4361 y
SDict begin 13 H.L end
 3885 4361 a 3885 4361 a
SDict begin [/Subtype /Link/Dest (0:2617) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4361 a Black 0 TeXcolorgray 795 4469 a
SDict begin H.S end
 795 4469 a Fk(4.13.2.)g
(Detailed)i(Requirements)1809 4469 y
SDict begin 13 H.L end
 1809 4469 a 1809
4469 a
SDict begin [/Subtype /Link/Dest (0:2673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1809 4469 a Black Black 15 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4469 a
SDict begin H.S end
 3759 4469
a Fk(214)3885 4469 y
SDict begin 13 H.L end
 3885 4469 a 3885 4469 a
SDict begin [/Subtype /Link/Dest (0:2673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4469
a Black 0 TeXcolorgray 795 4577 a
SDict begin H.S end
 795 4577 a Fk(4.13.3.)e(Pre)n(v)o
(enting)g(Split-Brain)i(Syndrome)2155 4577 y
SDict begin 13 H.L end
 2155 4577
a 2155 4577 a
SDict begin [/Subtype /Link/Dest (0:2766) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2155 4577 a Black Black 1 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4577 a
SDict begin H.S end
 3759 4577
a Fk(216)3885 4577 y
SDict begin 13 H.L end
 3885 4577 a 3885 4577 a
SDict begin [/Subtype /Link/Dest (0:2766) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4577
a Black 0 TeXcolorgray 795 4685 a
SDict begin H.S end
 795 4685 a Fk(4.13.4.)e(Binary)i
(Star)g(Implementation)1974 4685 y
SDict begin 13 H.L end
 1974 4685 a 1974 4685
a
SDict begin [/Subtype /Link/Dest (0:2774) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1974 4685 a Black Black 16 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4685 a
SDict begin H.S end
 3759 4685 a Fk(217)3885 4685 y
SDict begin 13 H.L end
 3885 4685
a 3885 4685 a
SDict begin [/Subtype /Link/Dest (0:2774) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4685 a Black 0 TeXcolorgray 795 4793
a
SDict begin H.S end
 795 4793 a Fk(4.13.5.)e(Binary)i(Star)g(Reactor)1704
4793 y
SDict begin 13 H.L end
 1704 4793 a 1704 4793 a
SDict begin [/Subtype /Link/Dest (0:2829) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1704 4793 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4793 a
SDict begin H.S end
 3759 4793
a Fk(224)3885 4793 y
SDict begin 13 H.L end
 3885 4793 a 3885 4793 a
SDict begin [/Subtype /Link/Dest (0:2829) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4793
a Black 0 TeXcolorgray 596 4901 a
SDict begin H.S end
 596 4901 a Fk(4.14.)e(Brok)o(erless)i
(Reliability)h(\(Freelance)e(P)o(attern\))2163 4901 y
SDict begin 13 H.L end

2163 4901 a 2163 4901 a
SDict begin [/Subtype /Link/Dest (0:2871) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2163 4901 a Black Black 14 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4901 a
SDict begin H.S end
 3759 4901
a Fk(229)3885 4901 y
SDict begin 13 H.L end
 3885 4901 a 3885 4901 a
SDict begin [/Subtype /Link/Dest (0:2871) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4901
a Black 0 TeXcolorgray 795 5009 a
SDict begin H.S end
 795 5009 a Fk(4.14.1.)f(Model)h(One)h
(-)h(Simple)f(Retry)g(and)g(F)o(ailo)o(v)o(er)2366 5009
y
SDict begin 13 H.L end
 2366 5009 a 2366 5009 a
SDict begin [/Subtype /Link/Dest (0:2902) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2366 5009 a Black Black -2
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 5009 a
SDict begin H.S end
 3759 5009
a Fk(231)3885 5009 y
SDict begin 13 H.L end
 3885 5009 a 3885 5009 a
SDict begin [/Subtype /Link/Dest (0:2902) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 5009
a Black 0 TeXcolorgray 795 5117 a
SDict begin H.S end
 795 5117 a Fk(4.14.2.)e(Model)h(T)-7
b(w)o(o)21 b(-)f(Brutal)h(Shotgun)d(Massacre)2335 5117
y
SDict begin 13 H.L end
 2335 5117 a 2335 5117 a
SDict begin [/Subtype /Link/Dest (0:2926) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2335 5117 a Black Black 8 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 5117 a
SDict begin H.S end
 3759 5117 a Fk(234)3885 5117 y
SDict begin 13 H.L end
 3885 5117
a 3885 5117 a
SDict begin [/Subtype /Link/Dest (0:2926) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 5117 a Black Black 3846 5569 a Ff(v)p
Black eop end
%%Page: 6 6
TeXDict begin 6 5 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.vi) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black 0 TeXcolorgray 795 72 a
SDict begin H.S end
 795 72 a Fk(4.14.3.)18
b(Model)h(Three)h(-)g(Comple)o(x)f(and)h(Nasty)2203 72
y
SDict begin 13 H.L end
 2203 72 a 2203 72 a
SDict begin [/Subtype /Link/Dest (0:2979) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2203 72 a Black Black 16 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 72
a
SDict begin H.S end
 3759 72 a Fk(239)3885 72 y
SDict begin 13 H.L end
 3885 72 a 3885 72 a
SDict begin [/Subtype /Link/Dest (0:2979) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
72 a Black 0 TeXcolorgray 596 180 a
SDict begin H.S end
 596 180 a Fk(4.15.)e(Conclusion)
1162 180 y
SDict begin 13 H.L end
 1162 180 a 1162 180 a
SDict begin [/Subtype /Link/Dest (0:3047) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1162 180 a Black Black
19 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 180 a
SDict begin H.S end
 3759 180 a Fk(250)3885 180 y
SDict begin 13 H.L end
 3885 180 a 3885
180 a
SDict begin [/Subtype /Link/Dest (0:3047) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 180 a Black 0 TeXcolorgray 396 308 a
SDict begin H.S end
 396 308
a Fg(5.)i(Adv)o(anced)g(Publish-Subscribe)1499 308 y
SDict begin 13 H.L end

1499 308 a 1499 308 a
SDict begin [/Subtype /Link/Dest (0:3050) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1499 308 a Black Black 14 w Fg(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 308 a
SDict begin H.S end
 3759
308 a Fg(251)3885 308 y
SDict begin 13 H.L end
 3885 308 a 3885 308 a
SDict begin [/Subtype /Link/Dest (0:3050) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 308
a Black 0 TeXcolorgray 596 436 a
SDict begin H.S end
 596 436 a Fk(5.1.)f(Slo)n(w)h
(Subscriber)f(Detection)h(\(Suicidal)f(Snail)i(P)o(attern\))2425
436 y
SDict begin 13 H.L end
 2425 436 a 2425 436 a
SDict begin [/Subtype /Link/Dest (0:3071) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2425 436 a Black Black 1
w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 436 a
SDict begin H.S end
 3759
436 a Fk(251)3885 436 y
SDict begin 13 H.L end
 3885 436 a 3885 436 a
SDict begin [/Subtype /Link/Dest (0:3071) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 436
a Black 0 TeXcolorgray 596 544 a
SDict begin H.S end
 596 544 a Fk(5.2.)e(High-speed)f
(Subscribers)h(\(Black)i(Box)f(P)o(attern\))2217 544
y
SDict begin 13 H.L end
 2217 544 a 2217 544 a
SDict begin [/Subtype /Link/Dest (0:3111) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2217 544 a Black Black 2 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 544
a
SDict begin H.S end
 3759 544 a Fk(254)3885 544 y
SDict begin 13 H.L end
 3885 544 a 3885 544 a
SDict begin [/Subtype /Link/Dest (0:3111) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3885 544 a Black 0 TeXcolorgray 596 652 a
SDict begin H.S end
 596 652 a Fk(5.3.)f(A)i
(Shared)e(K)n(e)o(y-V)-9 b(alue)18 b(Cache)i(\(Clone)g(P)o(attern\))
2183 652 y
SDict begin 13 H.L end
 2183 652 a 2183 652 a
SDict begin [/Subtype /Link/Dest (0:3160) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2183 652 a Black Black
15 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 652 a
SDict begin H.S end
 3759 652 a Fk(256)3885 652
y
SDict begin 13 H.L end
 3885 652 a 3885 652 a
SDict begin [/Subtype /Link/Dest (0:3160) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 652 a Black 0 TeXcolorgray
795 760 a
SDict begin H.S end
 795 760 a Fk(5.3.1.)e(Distrib)n(uting)i(K)n(e)o(y-V)-9
b(alue)18 b(Updates)2068 760 y
SDict begin 13 H.L end
 2068 760 a 2068 760 a
SDict begin [/Subtype /Link/Dest (0:3199) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

2068 760 a Black Black 5 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 760 a
SDict begin H.S end
 3759 760 a
Fk(258)3885 760 y
SDict begin 13 H.L end
 3885 760 a 3885 760 a
SDict begin [/Subtype /Link/Dest (0:3199) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 760 a Black
0 TeXcolorgray 795 868 a
SDict begin H.S end
 795 868 a Fk(5.3.2.)g(Getting)i(a)h(Snapshot)
1636 868 y
SDict begin 13 H.L end
 1636 868 a 1636 868 a
SDict begin [/Subtype /Link/Dest (0:3273) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1636 868 a Black Black
1 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 868
a
SDict begin H.S end
 3759 868 a Fk(268)3885 868 y
SDict begin 13 H.L end
 3885 868 a 3885 868 a
SDict begin [/Subtype /Link/Dest (0:3273) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3885 868 a Black 0 TeXcolorgray 795 976 a
SDict begin H.S end
 795 976 a Fk(5.3.3.)d
(Republishing)h(Updates)1739 976 y
SDict begin 13 H.L end
 1739 976 a 1739 976
a
SDict begin [/Subtype /Link/Dest (0:3321) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1739 976 a Black Black 2 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 976 a
SDict begin H.S end
 3759
976 a Fk(273)3885 976 y
SDict begin 13 H.L end
 3885 976 a 3885 976 a
SDict begin [/Subtype /Link/Dest (0:3321) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 976
a Black 0 TeXcolorgray 795 1084 a
SDict begin H.S end
 795 1084 a Fk(5.3.4.)f(Clone)i
(Subtrees)1508 1084 y
SDict begin 13 H.L end
 1508 1084 a 1508 1084 a
SDict begin [/Subtype /Link/Dest (0:3364) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1508 1084
a Black Black 5 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1084 a
SDict begin H.S end
 3759 1084 a Fk(278)3885 1084 y
SDict begin 13 H.L end
 3885 1084
a 3885 1084 a
SDict begin [/Subtype /Link/Dest (0:3364) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1084 a Black 0 TeXcolorgray 795 1192
a
SDict begin H.S end
 795 1192 a Fk(5.3.5.)e(Ephemeral)h(V)-9 b(alues)1605
1192 y
SDict begin 13 H.L end
 1605 1192 a 1605 1192 a
SDict begin [/Subtype /Link/Dest (0:3382) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1605 1192 a Black Black
12 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 1192 a
SDict begin H.S end
 3759 1192 a Fk(280)3885 1192
y
SDict begin 13 H.L end
 3885 1192 a 3885 1192 a
SDict begin [/Subtype /Link/Dest (0:3382) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1192 a Black 0 TeXcolorgray
795 1300 a
SDict begin H.S end
 795 1300 a Fk(5.3.6.)18 b(Clone)i(Serv)o(er)g(Reliability)
1809 1300 y
SDict begin 13 H.L end
 1809 1300 a 1809 1300 a
SDict begin [/Subtype /Link/Dest (0:3452) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1809 1300 a Black
Black 15 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1300 a
SDict begin H.S end
 3759 1300 a Fk(292)3885 1300 y
SDict begin 13 H.L end
 3885 1300
a 3885 1300 a
SDict begin [/Subtype /Link/Dest (0:3452) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1300 a Black 0 TeXcolorgray 795 1407
a
SDict begin H.S end
 795 1407 a Fk(5.3.7.)e(Clone)i(Protocol)g(Speci\002cation)1959
1407 y
SDict begin 13 H.L end
 1959 1407 a 1959 1407 a
SDict begin [/Subtype /Link/Dest (0:3641) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1959 1407 a Black Black
11 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 1407
a
SDict begin H.S end
 3759 1407 a Fk(312)3885 1407 y
SDict begin 13 H.L end
 3885 1407 a 3885 1407
a
SDict begin [/Subtype /Link/Dest (0:3641) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1407 a Black 0 TeXcolorgray 596 1515 a
SDict begin H.S end
 596 1515
a Fk(5.4.)f(The)h(Espresso)g(P)o(attern)1442 1515 y
SDict begin 13 H.L end
 1442
1515 a 1442 1515 a
SDict begin [/Subtype /Link/Dest (0:3648) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1442 1515 a Black Black 9 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1515 a
SDict begin H.S end
 3759
1515 a Fk(313)3885 1515 y
SDict begin 13 H.L end
 3885 1515 a 3885 1515 a
SDict begin [/Subtype /Link/Dest (0:3648) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
1515 a Black 0 TeXcolorgray 596 1623 a
SDict begin H.S end
 596 1623 a Fk(5.5.)f(Last)i(V)-9
b(alue)19 b(Caching)1392 1623 y
SDict begin 13 H.L end
 1392 1623 a 1392 1623
a
SDict begin [/Subtype /Link/Dest (0:3666) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1392 1623 a Black Black 17 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1623 a
SDict begin H.S end
 3759 1623 a Fk(315)3885 1623 y
SDict begin 13 H.L end
 3885 1623
a 3885 1623 a
SDict begin [/Subtype /Link/Dest (0:3666) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1623 a Black 0 TeXcolorgray 396 1751
a
SDict begin H.S end
 396 1751 a Fg(6.)h(The)h(Human)g(Scale)1112 1751 y
SDict begin 13 H.L end

1112 1751 a 1112 1751 a
SDict begin [/Subtype /Link/Dest (0:3702) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1112 1751 a Black Black 7 w Fg(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 1751
a
SDict begin H.S end
 3759 1751 a Fg(320)3885 1751 y
SDict begin 13 H.L end
 3885 1751 a 3885 1751
a
SDict begin [/Subtype /Link/Dest (0:3702) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1751 a Black 0 TeXcolorgray 596 1879 a
SDict begin H.S end
 596 1879
a Fk(6.1.)e(The)h(T)-7 b(ale)20 b(of)g(T)-7 b(w)o(o)21
b(Bridges)1567 1879 y
SDict begin 13 H.L end
 1567 1879 a 1567 1879 a
SDict begin [/Subtype /Link/Dest (0:3733) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1567 1879
a Black Black 8 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1879 a
SDict begin H.S end
 3759 1879 a Fk(320)3885 1879 y
SDict begin 13 H.L end
 3885 1879
a 3885 1879 a
SDict begin [/Subtype /Link/Dest (0:3733) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1879 a Black 0 TeXcolorgray 596 1987
a
SDict begin H.S end
 596 1987 a Fk(6.2.)e(Code)h(on)g(the)g(Human)f(Scale)1608
1987 y
SDict begin 13 H.L end
 1608 1987 a 1608 1987 a
SDict begin [/Subtype /Link/Dest (0:3739) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1608 1987 a Black Black
9 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 1987 a
SDict begin H.S end
 3759 1987 a Fk(321)3885 1987
y
SDict begin 13 H.L end
 3885 1987 a 3885 1987 a
SDict begin [/Subtype /Link/Dest (0:3739) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1987 a Black 0 TeXcolorgray
596 2095 a
SDict begin H.S end
 596 2095 a Fk(6.3.)g(Psychology)f(of)i(Softw)o(are)g(De)n(v)
o(elopment)2006 2095 y
SDict begin 13 H.L end
 2006 2095 a 2006 2095 a
SDict begin [/Subtype /Link/Dest (0:3749) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2006 2095
a Black Black 5 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2095 a
SDict begin H.S end
 3759 2095 a Fk(322)3885
2095 y
SDict begin 13 H.L end
 3885 2095 a 3885 2095 a
SDict begin [/Subtype /Link/Dest (0:3749) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2095 a Black 0 TeXcolorgray
596 2203 a
SDict begin H.S end
 596 2203 a Fk(6.4.)f(The)h(Bad,)g(the)g(Ugly)-5
b(,)19 b(and)h(the)g(Delicious)1972 2203 y
SDict begin 13 H.L end
 1972 2203
a 1972 2203 a
SDict begin [/Subtype /Link/Dest (0:3792) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1972 2203 a Black Black 18 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2203 a
SDict begin H.S end
 3759 2203 a Fk(323)3885 2203 y
SDict begin 13 H.L end
 3885 2203
a 3885 2203 a
SDict begin [/Subtype /Link/Dest (0:3792) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2203 a Black 0 TeXcolorgray 795 2311
a
SDict begin H.S end
 795 2311 a Fk(6.4.1.)e(T)m(rash-Oriented)g(Design)1763
2311 y
SDict begin 13 H.L end
 1763 2311 a 1763 2311 a
SDict begin [/Subtype /Link/Dest (0:3800) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1763 2311 a Black Black
20 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2311 a
SDict begin H.S end
 3759
2311 a Fk(324)3885 2311 y
SDict begin 13 H.L end
 3885 2311 a 3885 2311 a
SDict begin [/Subtype /Link/Dest (0:3800) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2311 a Black 0 TeXcolorgray 795 2419 a
SDict begin H.S end
 795 2419 a Fk(6.4.2.)g(Comple)o
(xity-Oriented)f(Design)1968 2419 y
SDict begin 13 H.L end
 1968 2419 a 1968
2419 a
SDict begin [/Subtype /Link/Dest (0:3831) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1968 2419 a Black Black 2 w Fk(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2419 a
SDict begin H.S end
 3759 2419 a Fk(325)3885
2419 y
SDict begin 13 H.L end
 3885 2419 a 3885 2419 a
SDict begin [/Subtype /Link/Dest (0:3831) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2419 a Black 0 TeXcolorgray
795 2527 a
SDict begin H.S end
 795 2527 a Fk(6.4.3.)h(Simplicity-Oriented)g(Design)1923
2527 y
SDict begin 13 H.L end
 1923 2527 a 1923 2527 a
SDict begin [/Subtype /Link/Dest (0:3862) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1923 2527 a Black Black
5 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2527 a
SDict begin H.S end
 3759 2527 a Fk(327)3885
2527 y
SDict begin 13 H.L end
 3885 2527 a 3885 2527 a
SDict begin [/Subtype /Link/Dest (0:3862) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2527 a Black 0 TeXcolorgray
596 2635 a
SDict begin H.S end
 596 2635 a Fk(6.5.)h(Message)h(Oriented)f(P)o(attern)h(for)g
(Elastic)g(Design)2218 2635 y
SDict begin 13 H.L end
 2218 2635 a 2218 2635 a
SDict begin [/Subtype /Link/Dest (0:3891) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

2218 2635 a Black Black 1 w Fk(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2635 a
SDict begin H.S end
 3759 2635 a Fk(328)3885
2635 y
SDict begin 13 H.L end
 3885 2635 a 3885 2635 a
SDict begin [/Subtype /Link/Dest (0:3891) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2635 a Black 0 TeXcolorgray
795 2742 a
SDict begin H.S end
 795 2742 a Fk(6.5.1.)e(Step)j(1:)f(Internalize)f(the)h
(Semantics)2096 2742 y
SDict begin 13 H.L end
 2096 2742 a 2096 2742 a
SDict begin [/Subtype /Link/Dest (0:3912) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2096 2742
a Black Black 19 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 2742
a
SDict begin H.S end
 3759 2742 a Fk(329)3885 2742 y
SDict begin 13 H.L end
 3885 2742 a 3885 2742
a
SDict begin [/Subtype /Link/Dest (0:3912) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2742 a Black 0 TeXcolorgray 795 2850 a
SDict begin H.S end
 795 2850
a Fk(6.5.2.)e(Step)j(2:)f(Dra)o(w)g(a)h(Rough)e(Architecture)2177
2850 y
SDict begin 13 H.L end
 2177 2850 a 2177 2850 a
SDict begin [/Subtype /Link/Dest (0:3918) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2177 2850 a Black Black
Fk(.)p Black Black(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2850 a
SDict begin H.S end
 3759 2850
a Fk(329)3885 2850 y
SDict begin 13 H.L end
 3885 2850 a 3885 2850 a
SDict begin [/Subtype /Link/Dest (0:3918) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2850
a Black 0 TeXcolorgray 795 2958 a
SDict begin H.S end
 795 2958 a Fk(6.5.3.)f(Step)j(3:)f
(Decide)g(on)g(the)g(Contracts)2057 2958 y
SDict begin 13 H.L end
 2057 2958
a 2057 2958 a
SDict begin [/Subtype /Link/Dest (0:3923) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2057 2958 a Black Black 16 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 2958
a
SDict begin H.S end
 3759 2958 a Fk(329)3885 2958 y
SDict begin 13 H.L end
 3885 2958 a 3885 2958
a
SDict begin [/Subtype /Link/Dest (0:3923) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2958 a Black 0 TeXcolorgray 795 3066 a
SDict begin H.S end
 795 3066
a Fk(6.5.4.)e(Step)j(4:)f(Write)h(a)f(Minimal)g(End-to-End)d(Solution)
2521 3066 y
SDict begin 13 H.L end
 2521 3066 a 2521 3066 a
SDict begin [/Subtype /Link/Dest (0:3938) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2521 3066 a Black
Black 9 w Fk(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 3066 a
SDict begin H.S end
 3759 3066 a Fk(330)3885 3066
y
SDict begin 13 H.L end
 3885 3066 a 3885 3066 a
SDict begin [/Subtype /Link/Dest (0:3938) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3066 a Black 0 TeXcolorgray
795 3174 a
SDict begin H.S end
 795 3174 a Fk(6.5.5.)h(Step)j(5:)f(Solv)o(e)g(One)g(Problem)
f(and)g(Repeat)2297 3174 y
SDict begin 13 H.L end
 2297 3174 a 2297 3174 a
SDict begin [/Subtype /Link/Dest (0:3945) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2297
3174 a Black Black 5 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3174 a
SDict begin H.S end
 3759 3174 a Fk(331)3885 3174 y
SDict begin 13 H.L end
 3885 3174
a 3885 3174 a
SDict begin [/Subtype /Link/Dest (0:3945) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3174 a Black 0 TeXcolorgray 596 3282
a
SDict begin H.S end
 596 3282 a Fk(6.6.)g(Unprotocols)1154 3282 y
SDict begin 13 H.L end
 1154 3282
a 1154 3282 a
SDict begin [/Subtype /Link/Dest (0:3950) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1154 3282 a Black Black 6 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3282 a
SDict begin H.S end
 3759 3282 a Fk(331)3885 3282 y
SDict begin 13 H.L end
 3885 3282
a 3885 3282 a
SDict begin [/Subtype /Link/Dest (0:3950) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3282 a Black 0 TeXcolorgray 795 3390
a
SDict begin H.S end
 795 3390 a Fk(6.6.1.)f(Why)i(Unprotocols?)1634 3390
y
SDict begin 13 H.L end
 1634 3390 a 1634 3390 a
SDict begin [/Subtype /Link/Dest (0:3952) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1634 3390 a Black Black 3 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3390
a
SDict begin H.S end
 3759 3390 a Fk(331)3885 3390 y
SDict begin 13 H.L end
 3885 3390 a 3885 3390
a
SDict begin [/Subtype /Link/Dest (0:3952) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3390 a Black 0 TeXcolorgray 795 3498 a
SDict begin H.S end
 795 3498
a Fk(6.6.2.)e(Ho)n(w)i(to)h(Write)g(Unprotocols)1891
3498 y
SDict begin 13 H.L end
 1891 3498 a 1891 3498 a
SDict begin [/Subtype /Link/Dest (0:3961) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1891 3498 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3498 a
SDict begin H.S end
 3759
3498 a Fk(332)3885 3498 y
SDict begin 13 H.L end
 3885 3498 a 3885 3498 a
SDict begin [/Subtype /Link/Dest (0:3961) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3498 a Black 0 TeXcolorgray 795 3606 a
SDict begin H.S end
 795 3606 a Fk(6.6.3.)d(Why)i
(use)g(the)h(GPLv3)e(for)h(Public)g(Speci\002cations?)2553
3606 y
SDict begin 13 H.L end
 2553 3606 a 2553 3606 a
SDict begin [/Subtype /Link/Dest (0:3999) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2553 3606 a Black Black
18 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3606 a
SDict begin H.S end
 3759 3606 a Fk(333)3885
3606 y
SDict begin 13 H.L end
 3885 3606 a 3885 3606 a
SDict begin [/Subtype /Link/Dest (0:3999) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3606 a Black 0 TeXcolorgray
795 3714 a
SDict begin H.S end
 795 3714 a Fk(6.6.4.)e(Using)i(ABNF)1442 3714
y
SDict begin 13 H.L end
 1442 3714 a 1442 3714 a
SDict begin [/Subtype /Link/Dest (0:4009) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1442 3714 a Black Black 9 w
Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3714 a
SDict begin H.S end
 3759
3714 a Fk(333)3885 3714 y
SDict begin 13 H.L end
 3885 3714 a 3885 3714 a
SDict begin [/Subtype /Link/Dest (0:4009) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3714 a Black 0 TeXcolorgray 596 3822 a
SDict begin H.S end
 596 3822 a Fk(6.7.)f
(Serializing)g(your)g(Data)1451 3822 y
SDict begin 13 H.L end
 1451 3822 a 1451
3822 a
SDict begin [/Subtype /Link/Dest (0:4020) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1451 3822 a Black Black 20 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3822 a
SDict begin H.S end
 3759 3822 a Fk(334)3885 3822 y
SDict begin 13 H.L end
 3885 3822
a 3885 3822 a
SDict begin [/Subtype /Link/Dest (0:4020) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3822 a Black 0 TeXcolorgray 795 3930
a
SDict begin H.S end
 795 3930 a Fk(6.7.1.)f(Cheap)i(and)g(Nasty)1570 3930
y
SDict begin 13 H.L end
 1570 3930 a 1570 3930 a
SDict begin [/Subtype /Link/Dest (0:4024) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1570 3930 a Black Black 5 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3930
a
SDict begin H.S end
 3759 3930 a Fk(335)3885 3930 y
SDict begin 13 H.L end
 3885 3930 a 3885 3930
a
SDict begin [/Subtype /Link/Dest (0:4024) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3930 a Black 0 TeXcolorgray 795 4038 a
SDict begin H.S end
 795 4038
a Fk(6.7.2.)e(\330MQ)j(Framing)1500 4038 y
SDict begin 13 H.L end
 1500 4038
a 1500 4038 a
SDict begin [/Subtype /Link/Dest (0:4060) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1500 4038 a Black Black 13 w Fk(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4038 a
SDict begin H.S end
 3759 4038
a Fk(336)3885 4038 y
SDict begin 13 H.L end
 3885 4038 a 3885 4038 a
SDict begin [/Subtype /Link/Dest (0:4060) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4038
a Black 0 TeXcolorgray 795 4146 a
SDict begin H.S end
 795 4146 a Fk(6.7.3.)d(Serialization)
i(Languages)1805 4146 y
SDict begin 13 H.L end
 1805 4146 a 1805 4146 a
SDict begin [/Subtype /Link/Dest (0:4070) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1805
4146 a Black Black -2 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4146 a
SDict begin H.S end
 3759
4146 a Fk(337)3885 4146 y
SDict begin 13 H.L end
 3885 4146 a 3885 4146 a
SDict begin [/Subtype /Link/Dest (0:4070) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4146 a Black 0 TeXcolorgray 795 4253 a
SDict begin H.S end
 795 4253 a Fk(6.7.4.)e
(Serialization)i(Libraries)1744 4253 y
SDict begin 13 H.L end
 1744 4253 a 1744
4253 a
SDict begin [/Subtype /Link/Dest (0:4084) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1744 4253 a Black Black 18 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4253 a
SDict begin H.S end
 3759 4253
a Fk(338)3885 4253 y
SDict begin 13 H.L end
 3885 4253 a 3885 4253 a
SDict begin [/Subtype /Link/Dest (0:4084) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4253
a Black 0 TeXcolorgray 795 4361 a
SDict begin H.S end
 795 4361 a Fk(6.7.5.)e(Hand-written)h
(Binary)g(Serialization)2133 4361 y
SDict begin 13 H.L end
 2133 4361 a 2133
4361 a
SDict begin [/Subtype /Link/Dest (0:4098) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2133 4361 a Black Black 3 w Fk(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4361
a
SDict begin H.S end
 3759 4361 a Fk(339)3885 4361 y
SDict begin 13 H.L end
 3885 4361 a 3885 4361
a
SDict begin [/Subtype /Link/Dest (0:4098) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4361 a Black 0 TeXcolorgray 795 4469 a
SDict begin H.S end
 795 4469
a Fk(6.7.6.)f(Code)i(Generation)1569 4469 y
SDict begin 13 H.L end
 1569 4469
a 1569 4469 a
SDict begin [/Subtype /Link/Dest (0:4131) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1569 4469 a Black Black 6 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4469 a
SDict begin H.S end
 3759 4469
a Fk(340)3885 4469 y
SDict begin 13 H.L end
 3885 4469 a 3885 4469 a
SDict begin [/Subtype /Link/Dest (0:4131) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4469
a Black 0 TeXcolorgray 596 4577 a
SDict begin H.S end
 596 4577 a Fk(6.8.)f(T)m(ransferring)
f(Files)1335 4577 y
SDict begin 13 H.L end
 1335 4577 a 1335 4577 a
SDict begin [/Subtype /Link/Dest (0:4211) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1335 4577
a Black Black 12 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4577 a
SDict begin H.S end
 3759
4577 a Fk(346)3885 4577 y
SDict begin 13 H.L end
 3885 4577 a 3885 4577 a
SDict begin [/Subtype /Link/Dest (0:4211) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4577 a Black 0 TeXcolorgray 596 4685 a
SDict begin H.S end
 596 4685 a Fk(6.9.)h
(Heartbeating)1172 4685 y
SDict begin 13 H.L end
 1172 4685 a 1172 4685 a
SDict begin [/Subtype /Link/Dest (0:4309) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1172
4685 a Black Black 9 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4685 a
SDict begin H.S end
 3759 4685 a Fk(356)3885 4685
y
SDict begin 13 H.L end
 3885 4685 a 3885 4685 a
SDict begin [/Subtype /Link/Dest (0:4309) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4685 a Black 0 TeXcolorgray
795 4793 a
SDict begin H.S end
 795 4793 a Fk(6.9.1.)f(Shrugging)g(It)j(Of)n(f)1555
4793 y
SDict begin 13 H.L end
 1555 4793 a 1555 4793 a
SDict begin [/Subtype /Link/Dest (0:4313) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1555 4793 a Black Black
-1 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4793 a
SDict begin H.S end
 3759 4793 a Fk(357)3885 4793 y
SDict begin 13 H.L end
 3885 4793
a 3885 4793 a
SDict begin [/Subtype /Link/Dest (0:4313) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4793 a Black 0 TeXcolorgray 795 4901
a
SDict begin H.S end
 795 4901 a Fk(6.9.2.)d(One-W)-7 b(ay)20 b(Heartbeats)1695
4901 y
SDict begin 13 H.L end
 1695 4901 a 1695 4901 a
SDict begin [/Subtype /Link/Dest (0:4323) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1695 4901 a Black Black
5 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4901 a
SDict begin H.S end
 3759 4901 a Fk(357)3885 4901 y
SDict begin 13 H.L end
 3885 4901
a 3885 4901 a
SDict begin [/Subtype /Link/Dest (0:4323) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4901 a Black 0 TeXcolorgray 795 5009
a
SDict begin H.S end
 795 5009 a Fk(6.9.3.)e(Ping-Pong)h(Heartbeats)1730
5009 y
SDict begin 13 H.L end
 1730 5009 a 1730 5009 a
SDict begin [/Subtype /Link/Dest (0:4337) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1730 5009 a Black Black
11 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 5009 a
SDict begin H.S end
 3759 5009 a Fk(358)3885 5009
y
SDict begin 13 H.L end
 3885 5009 a 3885 5009 a
SDict begin [/Subtype /Link/Dest (0:4337) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 5009 a Black 0 TeXcolorgray
596 5117 a
SDict begin H.S end
 596 5117 a Fk(6.10.)f(State)j(Machines)1293
5117 y
SDict begin 13 H.L end
 1293 5117 a 1293 5117 a
SDict begin [/Subtype /Link/Dest (0:4341) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1293 5117 a Black Black
12 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 5117 a
SDict begin H.S end
 3759 5117 a Fk(358)3885 5117 y
SDict begin 13 H.L end
 3885 5117
a 3885 5117 a
SDict begin [/Subtype /Link/Dest (0:4341) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 5117 a Black Black 3823 5569 a Ff(vi)p
Black eop end
%%Page: 7 7
TeXDict begin 7 6 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.vii) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black 0 TeXcolorgray 596 72 a
SDict begin H.S end
 596 72 a Fk(6.11.)18
b(Authentication)h(using)g(SASL)1700 72 y
SDict begin 13 H.L end
 1700 72 a 1700
72 a
SDict begin [/Subtype /Link/Dest (0:4443) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1700 72 a Black Black 20 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 72 a
SDict begin H.S end
 3759 72 a Fk(365)3885 72 y
SDict begin 13 H.L end
 3885 72 a 3885 72
a
SDict begin [/Subtype /Link/Dest (0:4443) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 72 a Black 0 TeXcolorgray 596 180 a
SDict begin H.S end
 596 180 a
Fk(6.12.)f(Lar)o(ge-scale)h(File)i(Publishing)1696 180
y
SDict begin 13 H.L end
 1696 180 a 1696 180 a
SDict begin [/Subtype /Link/Dest (0:4468) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1696 180 a Black Black 4 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 180
a
SDict begin H.S end
 3759 180 a Fk(366)3885 180 y
SDict begin 13 H.L end
 3885 180 a 3885 180 a
SDict begin [/Subtype /Link/Dest (0:4468) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3885 180 a Black 0 TeXcolorgray 795 288 a
SDict begin H.S end
 795 288 a Fk(6.12.1.)d(Why)i
(mak)o(e)f(FileMQ?)1725 288 y
SDict begin 13 H.L end
 1725 288 a 1725 288 a
SDict begin [/Subtype /Link/Dest (0:4472) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1725
288 a Black Black 16 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 288 a
SDict begin H.S end
 3759 288 a
Fk(366)3885 288 y
SDict begin 13 H.L end
 3885 288 a 3885 288 a
SDict begin [/Subtype /Link/Dest (0:4472) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 288 a Black
0 TeXcolorgray 795 396 a
SDict begin H.S end
 795 396 a Fk(6.12.2.)f(Initial)i(Design)g(Cut)
h(-)f(the)g(API)1964 396 y
SDict begin 13 H.L end
 1964 396 a 1964 396 a
SDict begin [/Subtype /Link/Dest (0:4480) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1964
396 a Black Black 6 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 396 a
SDict begin H.S end
 3759 396 a Fk(367)3885 396 y
SDict begin 13 H.L end
 3885 396 a 3885
396 a
SDict begin [/Subtype /Link/Dest (0:4480) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 396 a Black 0 TeXcolorgray 795 504 a
SDict begin H.S end
 795 504
a Fk(6.12.3.)e(Initial)i(Design)g(Cut)h(-)f(the)g(Protocol)2113
504 y
SDict begin 13 H.L end
 2113 504 a 2113 504 a
SDict begin [/Subtype /Link/Dest (0:4487) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2113 504 a Black Black 2
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 504 a
SDict begin H.S end
 3759 504 a Fk(368)3885
504 y
SDict begin 13 H.L end
 3885 504 a 3885 504 a
SDict begin [/Subtype /Link/Dest (0:4487) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 504 a Black 0 TeXcolorgray
795 612 a
SDict begin H.S end
 795 612 a Fk(6.12.4.)e(Building)h(and)h(T)m(rying)f(FileMQ)
2003 612 y
SDict begin 13 H.L end
 2003 612 a 2003 612 a
SDict begin [/Subtype /Link/Dest (0:4497) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2003 612 a Black Black
8 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 612 a
SDict begin H.S end
 3759 612 a Fk(369)3885 612 y
SDict begin 13 H.L end
 3885 612 a 3885
612 a
SDict begin [/Subtype /Link/Dest (0:4497) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 612 a Black 0 TeXcolorgray 795 720 a
SDict begin H.S end
 795 720
a Fk(6.12.5.)f(Internal)h(Architecture)1740 720 y
SDict begin 13 H.L end
 1740
720 a 1740 720 a
SDict begin [/Subtype /Link/Dest (0:4509) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1740 720 a Black Black 1 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 720 a
SDict begin H.S end
 3759 720 a Fk(370)3885 720 y
SDict begin 13 H.L end
 3885 720 a 3885
720 a
SDict begin [/Subtype /Link/Dest (0:4509) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 720 a Black 0 TeXcolorgray 795 828 a
SDict begin H.S end
 795 828
a Fk(6.12.6.)f(Public)i(API)1411 828 y
SDict begin 13 H.L end
 1411 828 a 1411
828 a
SDict begin [/Subtype /Link/Dest (0:4545) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1411 828 a Black Black 19 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 828 a
SDict begin H.S end
 3759
828 a Fk(371)3885 828 y
SDict begin 13 H.L end
 3885 828 a 3885 828 a
SDict begin [/Subtype /Link/Dest (0:4545) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 828
a Black 0 TeXcolorgray 795 936 a
SDict begin H.S end
 795 936 a Fk(6.12.7.)e(Design)i(Notes)
1494 936 y
SDict begin 13 H.L end
 1494 936 a 1494 936 a
SDict begin [/Subtype /Link/Dest (0:4556) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1494 936 a Black Black
19 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 936
a
SDict begin H.S end
 3759 936 a Fk(372)3885 936 y
SDict begin 13 H.L end
 3885 936 a 3885 936 a
SDict begin [/Subtype /Link/Dest (0:4556) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3885 936 a Black 0 TeXcolorgray 795 1044 a
SDict begin H.S end
 795 1044 a
Fk(6.12.8.)e(Reliabilty)1372 1044 y
SDict begin 13 H.L end
 1372 1044 a 1372
1044 a
SDict begin [/Subtype /Link/Dest (0:4574) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1372 1044 a Black Black 16 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 1044 a
SDict begin H.S end
 3759 1044 a Fk(373)3885 1044
y
SDict begin 13 H.L end
 3885 1044 a 3885 1044 a
SDict begin [/Subtype /Link/Dest (0:4574) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1044 a Black 0 TeXcolorgray
795 1152 a
SDict begin H.S end
 795 1152 a Fk(6.12.9.)g(Con\002guration)1508
1152 y
SDict begin 13 H.L end
 1508 1152 a 1508 1152 a
SDict begin [/Subtype /Link/Dest (0:4582) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1508 1152 a Black Black
5 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 1152
a
SDict begin H.S end
 3759 1152 a Fk(373)3885 1152 y
SDict begin 13 H.L end
 3885 1152 a 3885 1152
a
SDict begin [/Subtype /Link/Dest (0:4582) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1152 a Black 0 TeXcolorgray 596 1260 a
SDict begin H.S end
 596 1260
a Fk(6.13.)g(File)j(Stability)1214 1260 y
SDict begin 13 H.L end
 1214 1260 a
1214 1260 a
SDict begin [/Subtype /Link/Dest (0:4600) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1214 1260 a Black Black 8 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1260 a
SDict begin H.S end
 3759 1260 a Fk(374)3885 1260 y
SDict begin 13 H.L end
 3885 1260
a 3885 1260 a
SDict begin [/Subtype /Link/Dest (0:4600) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1260 a Black 0 TeXcolorgray 596 1368
a
SDict begin H.S end
 596 1368 a Fk(6.14.)d(T)-6 b(est)21 b(Use)g(Case)1251
1368 y
SDict begin 13 H.L end
 1251 1368 a 1251 1368 a
SDict begin [/Subtype /Link/Dest (0:4605) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1251 1368 a Black Black
13 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1368 a
SDict begin H.S end
 3759
1368 a Fk(374)3885 1368 y
SDict begin 13 H.L end
 3885 1368 a 3885 1368 a
SDict begin [/Subtype /Link/Dest (0:4605) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
1368 a Black 0 TeXcolorgray 396 1495 a
SDict begin H.S end
 396 1495 a Fg(7.)f(The)h(\330MQ)
g(Community)1292 1495 y
SDict begin 13 H.L end
 1292 1495 a 1292 1495 a
SDict begin [/Subtype /Link/Dest (0:4613) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1292
1495 a Black Black 13 w Fg(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1495 a
SDict begin H.S end
 3759 1495 a Fg(377)3885
1495 y
SDict begin 13 H.L end
 3885 1495 a 3885 1495 a
SDict begin [/Subtype /Link/Dest (0:4613) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1495 a Black 0 TeXcolorgray
596 1623 a
SDict begin H.S end
 596 1623 a Fk(7.1.)e(Architecture)f(of)i(the)h(\330MQ)f
(Community)2002 1623 y
SDict begin 13 H.L end
 2002 1623 a 2002 1623 a
SDict begin [/Subtype /Link/Dest (0:4645) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2002 1623
a Black Black 9 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1623 a
SDict begin H.S end
 3759 1623 a Fk(378)3885
1623 y
SDict begin 13 H.L end
 3885 1623 a 3885 1623 a
SDict begin [/Subtype /Link/Dest (0:4645) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1623 a Black 0 TeXcolorgray
596 1731 a
SDict begin H.S end
 596 1731 a Fk(7.2.)f(Ho)n(w)h(to)g(Mak)o(e)g(Really)h(Lar)o
(ge)e(Architectures)2115 1731 y
SDict begin 13 H.L end
 2115 1731 a 2115 1731
a
SDict begin [/Subtype /Link/Dest (0:4664) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2115 1731 a Black Black Fk(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1731 a
SDict begin H.S end
 3759 1731 a Fk(379)3885 1731 y
SDict begin 13 H.L end
 3885 1731
a 3885 1731 a
SDict begin [/Subtype /Link/Dest (0:4664) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1731 a Black 0 TeXcolorgray 795 1839
a
SDict begin H.S end
 795 1839 a Fk(7.2.1.)f(The)i(Game)1351 1839 y
SDict begin 13 H.L end
 1351
1839 a 1351 1839 a
SDict begin [/Subtype /Link/Dest (0:4673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1351 1839 a Black Black 17 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1839 a
SDict begin H.S end
 3759 1839 a Fk(379)3885 1839 y
SDict begin 13 H.L end
 3885 1839
a 3885 1839 a
SDict begin [/Subtype /Link/Dest (0:4673) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1839 a Black 0 TeXcolorgray 795 1947
a
SDict begin H.S end
 795 1947 a Fk(7.2.2.)e(The)i(Contract)1439 1947 y
SDict begin 13 H.L end
 1439
1947 a 1439 1947 a
SDict begin [/Subtype /Link/Dest (0:4678) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1439 1947 a Black Black 12 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1947 a
SDict begin H.S end
 3759
1947 a Fk(380)3885 1947 y
SDict begin 13 H.L end
 3885 1947 a 3885 1947 a
SDict begin [/Subtype /Link/Dest (0:4678) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
1947 a Black 0 TeXcolorgray 795 2055 a
SDict begin H.S end
 795 2055 a Fk(7.2.3.)e(The)i
(Process)1406 2055 y
SDict begin 13 H.L end
 1406 2055 a 1406 2055 a
SDict begin [/Subtype /Link/Dest (0:4695) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1406 2055
a Black Black 3 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2055 a
SDict begin H.S end
 3759
2055 a Fk(381)3885 2055 y
SDict begin 13 H.L end
 3885 2055 a 3885 2055 a
SDict begin [/Subtype /Link/Dest (0:4695) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2055 a Black 0 TeXcolorgray 795 2163 a
SDict begin H.S end
 795 2163 a Fk(7.2.4.)e(Crazy)-5
b(,)20 b(Beautiful,)f(and)h(Easy)1890 2163 y
SDict begin 13 H.L end
 1890 2163
a 1890 2163 a
SDict begin [/Subtype /Link/Dest (0:4701) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1890 2163 a Black Black 17 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2163 a
SDict begin H.S end
 3759 2163 a Fk(382)3885
2163 y
SDict begin 13 H.L end
 3885 2163 a 3885 2163 a
SDict begin [/Subtype /Link/Dest (0:4701) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2163 a Black 0 TeXcolorgray
795 2271 a
SDict begin H.S end
 795 2271 a Fk(7.2.5.)e(Stranger)m(,)h(meet)h(Stranger)1787
2271 y
SDict begin 13 H.L end
 1787 2271 a 1787 2271 a
SDict begin [/Subtype /Link/Dest (0:4708) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1787 2271 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2271 a
SDict begin H.S end
 3759 2271 a Fk(382)3885 2271
y
SDict begin 13 H.L end
 3885 2271 a 3885 2271 a
SDict begin [/Subtype /Link/Dest (0:4708) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2271 a Black 0 TeXcolorgray
795 2379 a
SDict begin H.S end
 795 2379 a Fk(7.2.6.)e(In\002nite)i(Property)1551
2379 y
SDict begin 13 H.L end
 1551 2379 a 1551 2379 a
SDict begin [/Subtype /Link/Dest (0:4716) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1551 2379 a Black Black
3 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2379 a
SDict begin H.S end
 3759 2379 a Fk(383)3885 2379 y
SDict begin 13 H.L end
 3885 2379
a 3885 2379 a
SDict begin [/Subtype /Link/Dest (0:4716) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2379 a Black 0 TeXcolorgray 795 2487
a
SDict begin H.S end
 795 2487 a Fk(7.2.7.)e(Care)j(and)e(Feeding)1589 2487
y
SDict begin 13 H.L end
 1589 2487 a 1589 2487 a
SDict begin [/Subtype /Link/Dest (0:4723) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1589 2487 a Black Black 7 w
Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2487 a
SDict begin H.S end
 3759 2487 a Fk(383)3885
2487 y
SDict begin 13 H.L end
 3885 2487 a 3885 2487 a
SDict begin [/Subtype /Link/Dest (0:4723) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2487 a Black 0 TeXcolorgray
596 2595 a
SDict begin H.S end
 596 2595 a Fk(7.3.)g(The)h(\330MQ)g(Process)g(-)h(C4)1525
2595 y
SDict begin 13 H.L end
 1525 2595 a 1525 2595 a
SDict begin [/Subtype /Link/Dest (0:4738) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1525 2595 a Black Black
9 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2595 a
SDict begin H.S end
 3759 2595
a Fk(384)3885 2595 y
SDict begin 13 H.L end
 3885 2595 a 3885 2595 a
SDict begin [/Subtype /Link/Dest (0:4738) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2595
a Black 0 TeXcolorgray 795 2703 a
SDict begin H.S end
 795 2703 a Fk(7.3.1.)d(Language)1332
2703 y
SDict begin 13 H.L end
 1332 2703 a 1332 2703 a
SDict begin [/Subtype /Link/Dest (0:4744) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1332 2703 a Black Black
15 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 2703 a
SDict begin H.S end
 3759 2703 a Fk(384)3885
2703 y
SDict begin 13 H.L end
 3885 2703 a 3885 2703 a
SDict begin [/Subtype /Link/Dest (0:4744) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2703 a Black 0 TeXcolorgray
795 2811 a
SDict begin H.S end
 795 2811 a Fk(7.3.2.)g(Goals)1196 2811 y
SDict begin 13 H.L end
 1196
2811 a 1196 2811 a
SDict begin [/Subtype /Link/Dest (0:4751) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1196 2811 a Black Black 6 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2811 a
SDict begin H.S end
 3759 2811
a Fk(385)3885 2811 y
SDict begin 13 H.L end
 3885 2811 a 3885 2811 a
SDict begin [/Subtype /Link/Dest (0:4751) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2811
a Black 0 TeXcolorgray 795 2918 a
SDict begin H.S end
 795 2918 a Fk(7.3.3.)g(Preliminaries)
1446 2918 y
SDict begin 13 H.L end
 1446 2918 a 1446 2918 a
SDict begin [/Subtype /Link/Dest (0:4779) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1446 2918 a Black
Black 5 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2918 a
SDict begin H.S end
 3759 2918 a Fk(387)3885 2918 y
SDict begin 13 H.L end
 3885 2918
a 3885 2918 a
SDict begin [/Subtype /Link/Dest (0:4779) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2918 a Black 0 TeXcolorgray 795 3026
a
SDict begin H.S end
 795 3026 a Fk(7.3.4.)g(Licensing)i(and)f(Ownership)1857
3026 y
SDict begin 13 H.L end
 1857 3026 a 1857 3026 a
SDict begin [/Subtype /Link/Dest (0:4806) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1857 3026 a Black Black
9 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3026 a
SDict begin H.S end
 3759 3026 a Fk(388)3885
3026 y
SDict begin 13 H.L end
 3885 3026 a 3885 3026 a
SDict begin [/Subtype /Link/Dest (0:4806) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3026 a Black 0 TeXcolorgray
795 3134 a
SDict begin H.S end
 795 3134 a Fk(7.3.5.)f(P)o(atch)i(Requirements)1669
3134 y
SDict begin 13 H.L end
 1669 3134 a 1669 3134 a
SDict begin [/Subtype /Link/Dest (0:4823) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1669 3134 a Black Black
10 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 3134 a
SDict begin H.S end
 3759 3134 a Fk(389)3885 3134
y
SDict begin 13 H.L end
 3885 3134 a 3885 3134 a
SDict begin [/Subtype /Link/Dest (0:4823) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3134 a Black 0 TeXcolorgray
795 3242 a
SDict begin H.S end
 795 3242 a Fk(7.3.6.)e(De)n(v)o(elopment)g(Process)1721
3242 y
SDict begin 13 H.L end
 1721 3242 a 1721 3242 a
SDict begin [/Subtype /Link/Dest (0:4849) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1721 3242 a Black Black
20 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 3242 a
SDict begin H.S end
 3759 3242 a Fk(390)3885 3242
y
SDict begin 13 H.L end
 3885 3242 a 3885 3242 a
SDict begin [/Subtype /Link/Dest (0:4849) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3242 a Black 0 TeXcolorgray
795 3350 a
SDict begin H.S end
 795 3350 a Fk(7.3.7.)g(Creating)i(Stable)g(Releases)1827
3350 y
SDict begin 13 H.L end
 1827 3350 a 1827 3350 a
SDict begin [/Subtype /Link/Dest (0:4903) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1827 3350 a Black Black
18 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3350 a
SDict begin H.S end
 3759
3350 a Fk(393)3885 3350 y
SDict begin 13 H.L end
 3885 3350 a 3885 3350 a
SDict begin [/Subtype /Link/Dest (0:4903) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3350 a Black 0 TeXcolorgray 795 3458 a
SDict begin H.S end
 795 3458 a Fk(7.3.8.)e(Ev)n
(olution)h(of)h(Public)g(Contracts)1991 3458 y
SDict begin 13 H.L end
 1991 3458
a 1991 3458 a
SDict begin [/Subtype /Link/Dest (0:4927) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1991 3458 a Black Black -1 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3458 a
SDict begin H.S end
 3759 3458 a Fk(394)3885 3458 y
SDict begin 13 H.L end
 3885 3458
a 3885 3458 a
SDict begin [/Subtype /Link/Dest (0:4927) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3458 a Black 0 TeXcolorgray 596 3566
a
SDict begin H.S end
 596 3566 a Fk(7.4.)f(W)-7 b(ork)o(ed)20 b(Example)1319
3566 y
SDict begin 13 H.L end
 1319 3566 a 1319 3566 a
SDict begin [/Subtype /Link/Dest (0:4962) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1319 3566 a Black Black
7 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3566 a
SDict begin H.S end
 3759
3566 a Fk(396)3885 3566 y
SDict begin 13 H.L end
 3885 3566 a 3885 3566 a
SDict begin [/Subtype /Link/Dest (0:4962) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3566 a Black 0 TeXcolorgray 596 3674 a
SDict begin H.S end
 596 3674 a Fk(7.5.)f(Git)i
(Branches)e(Considered)g(Harmful)1879 3674 y
SDict begin 13 H.L end
 1879 3674
a 1879 3674 a
SDict begin [/Subtype /Link/Dest (0:4997) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1879 3674 a Black Black 8 w Fk(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3674
a
SDict begin H.S end
 3759 3674 a Fk(399)3885 3674 y
SDict begin 13 H.L end
 3885 3674 a 3885 3674
a
SDict begin [/Subtype /Link/Dest (0:4997) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3674 a Black 0 TeXcolorgray 795 3782 a
SDict begin H.S end
 795 3782
a Fk(7.5.1.)f(Simplicity)i(vs.)g(Comple)o(xity)1877 3782
y
SDict begin 13 H.L end
 1877 3782 a 1877 3782 a
SDict begin [/Subtype /Link/Dest (0:5011) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1877 3782 a Black Black 10
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3782 a
SDict begin H.S end
 3759 3782 a Fk(400)3885 3782 y
SDict begin 13 H.L end
 3885 3782
a 3885 3782 a
SDict begin [/Subtype /Link/Dest (0:5011) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3782 a Black 0 TeXcolorgray 795 3890
a
SDict begin H.S end
 795 3890 a Fk(7.5.2.)e(Change)i(Latenc)o(y)1545 3890
y
SDict begin 13 H.L end
 1545 3890 a 1545 3890 a
SDict begin [/Subtype /Link/Dest (0:5017) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1545 3890 a Black Black 9 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3890 a
SDict begin H.S end
 3759 3890 a Fk(400)3885 3890 y
SDict begin 13 H.L end
 3885 3890
a 3885 3890 a
SDict begin [/Subtype /Link/Dest (0:5017) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3890 a Black 0 TeXcolorgray 795 3998
a
SDict begin H.S end
 795 3998 a Fk(7.5.3.)e(Learning)h(Curv)o(e)1526 3998
y
SDict begin 13 H.L end
 1526 3998 a 1526 3998 a
SDict begin [/Subtype /Link/Dest (0:5022) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1526 3998 a Black Black 8 w
Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3998 a
SDict begin H.S end
 3759 3998 a Fk(400)3885
3998 y
SDict begin 13 H.L end
 3885 3998 a 3885 3998 a
SDict begin [/Subtype /Link/Dest (0:5022) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3998 a Black 0 TeXcolorgray
795 4106 a
SDict begin H.S end
 795 4106 a Fk(7.5.4.)f(Cost)j(of)f(F)o(ailure)1500
4106 y
SDict begin 13 H.L end
 1500 4106 a 1500 4106 a
SDict begin [/Subtype /Link/Dest (0:5027) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1500 4106 a Black Black
13 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4106
a
SDict begin H.S end
 3759 4106 a Fk(401)3885 4106 y
SDict begin 13 H.L end
 3885 4106 a 3885 4106
a
SDict begin [/Subtype /Link/Dest (0:5027) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4106 a Black 0 TeXcolorgray 795 4214 a
SDict begin H.S end
 795 4214
a Fk(7.5.5.)e(Upfront)h(Coordination)1727 4214 y
SDict begin 13 H.L end
 1727
4214 a 1727 4214 a
SDict begin [/Subtype /Link/Dest (0:5032) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1727 4214 a Black Black 14 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4214 a
SDict begin H.S end
 3759 4214 a Fk(401)3885 4214 y
SDict begin 13 H.L end
 3885 4214
a 3885 4214 a
SDict begin [/Subtype /Link/Dest (0:5032) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4214 a Black 0 TeXcolorgray 795 4322
a
SDict begin H.S end
 795 4322 a Fk(7.5.6.)f(Scalability)1358 4322 y
SDict begin 13 H.L end
 1358
4322 a 1358 4322 a
SDict begin [/Subtype /Link/Dest (0:5037) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1358 4322 a Black Black 10 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4322 a
SDict begin H.S end
 3759 4322 a Fk(401)3885 4322 y
SDict begin 13 H.L end
 3885 4322
a 3885 4322 a
SDict begin [/Subtype /Link/Dest (0:5037) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4322 a Black 0 TeXcolorgray 795 4429
a
SDict begin H.S end
 795 4429 a Fk(7.5.7.)g(Surprise)i(and)f(Expectations)1871
4429 y
SDict begin 13 H.L end
 1871 4429 a 1871 4429 a
SDict begin [/Subtype /Link/Dest (0:5043) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1871 4429 a Black Black
16 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4429 a
SDict begin H.S end
 3759 4429 a Fk(401)3885 4429 y
SDict begin 13 H.L end
 3885 4429
a 3885 4429 a
SDict begin [/Subtype /Link/Dest (0:5043) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4429 a Black 0 TeXcolorgray 795 4537
a
SDict begin H.S end
 795 4537 a Fk(7.5.8.)f(Economics)h(of)h(P)o(articipation)1907
4537 y
SDict begin 13 H.L end
 1907 4537 a 1907 4537 a
SDict begin [/Subtype /Link/Dest (0:5049) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1907 4537 a Black Black
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4537 a
SDict begin H.S end
 3759
4537 a Fk(401)3885 4537 y
SDict begin 13 H.L end
 3885 4537 a 3885 4537 a
SDict begin [/Subtype /Link/Dest (0:5049) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4537 a Black 0 TeXcolorgray 795 4645 a
SDict begin H.S end
 795 4645 a Fk(7.5.9.)e(Rob)n
(ustness)j(in)f(Con\003ict)1753 4645 y
SDict begin 13 H.L end
 1753 4645 a 1753
4645 a
SDict begin [/Subtype /Link/Dest (0:5054) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1753 4645 a Black Black 9 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4645 a
SDict begin H.S end
 3759 4645
a Fk(402)3885 4645 y
SDict begin 13 H.L end
 3885 4645 a 3885 4645 a
SDict begin [/Subtype /Link/Dest (0:5054) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4645
a Black 0 TeXcolorgray 795 4753 a
SDict begin H.S end
 795 4753 a Fk(7.5.10.)e(Guarantees)h
(of)h(Isolation)1820 4753 y
SDict begin 13 H.L end
 1820 4753 a 1820 4753 a
SDict begin [/Subtype /Link/Dest (0:5059) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1820
4753 a Black Black 4 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4753 a
SDict begin H.S end
 3759 4753 a Fk(402)3885 4753
y
SDict begin 13 H.L end
 3885 4753 a 3885 4753 a
SDict begin [/Subtype /Link/Dest (0:5059) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4753 a Black 0 TeXcolorgray
795 4861 a
SDict begin H.S end
 795 4861 a Fk(7.5.11.)e(V)-5 b(isibility)1353
4861 y
SDict begin 13 H.L end
 1353 4861 a 1353 4861 a
SDict begin [/Subtype /Link/Dest (0:5064) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1353 4861 a Black Black
15 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4861 a
SDict begin H.S end
 3759 4861 a Fk(402)3885 4861 y
SDict begin 13 H.L end
 3885 4861
a 3885 4861 a
SDict begin [/Subtype /Link/Dest (0:5064) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4861 a Black 0 TeXcolorgray 795 4969
a
SDict begin H.S end
 795 4969 a Fk(7.5.12.)18 b(Conclusions)1456 4969 y
SDict begin 13 H.L end

1456 4969 a 1456 4969 a
SDict begin [/Subtype /Link/Dest (0:5069) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1456 4969 a Black Black 15 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 4969 a
SDict begin H.S end
 3759 4969 a Fk(402)3885
4969 y
SDict begin 13 H.L end
 3885 4969 a 3885 4969 a
SDict begin [/Subtype /Link/Dest (0:5069) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4969 a Black 0 TeXcolorgray
596 5077 a
SDict begin H.S end
 596 5077 a Fk(7.6.)h(The)h(Myth)f(of)h(Intelligent)f(Design)
1779 5077 y
SDict begin 13 H.L end
 1779 5077 a 1779 5077 a
SDict begin [/Subtype /Link/Dest (0:5074) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1779 5077 a Black
Black 4 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 5077
a
SDict begin H.S end
 3759 5077 a Fk(403)3885 5077 y
SDict begin 13 H.L end
 3885 5077 a 3885 5077
a
SDict begin [/Subtype /Link/Dest (0:5074) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 5077 a Black Black 3800 5569 a Ff(vii)p Black
eop end
%%Page: 8 8
TeXDict begin 8 7 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.viii) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black 0 TeXcolorgray 596 72 a
SDict begin H.S end
 596 72 a Fk(7.7.)19
b(Burnout)1015 72 y
SDict begin 13 H.L end
 1015 72 a 1015 72 a
SDict begin [/Subtype /Link/Dest (0:5117) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1015 72 a Black
Black Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 72 a
SDict begin H.S end
 3759 72 a Fk(405)3885
72 y
SDict begin 13 H.L end
 3885 72 a 3885 72 a
SDict begin [/Subtype /Link/Dest (0:5117) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 72 a Black 0 TeXcolorgray
596 180 a
SDict begin H.S end
 596 180 a Fk(7.8.)g(P)o(atterns)h(for)f(The)h(Game)1494
180 y
SDict begin 13 H.L end
 1494 180 a 1494 180 a
SDict begin [/Subtype /Link/Dest (0:5141) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1494 180 a Black Black 19
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 180 a
SDict begin H.S end
 3759
180 a Fk(406)3885 180 y
SDict begin 13 H.L end
 3885 180 a 3885 180 a
SDict begin [/Subtype /Link/Dest (0:5141) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 180
a Black 0 TeXcolorgray 795 288 a
SDict begin H.S end
 795 288 a Fk(7.8.1.)e(The)i(Lazy)g
(Perfectionist)1760 288 y
SDict begin 13 H.L end
 1760 288 a 1760 288 a
SDict begin [/Subtype /Link/Dest (0:5144) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1760
288 a Black Black 2 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 288 a
SDict begin H.S end
 3759 288 a Fk(406)3885 288
y
SDict begin 13 H.L end
 3885 288 a 3885 288 a
SDict begin [/Subtype /Link/Dest (0:5144) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 288 a Black 0 TeXcolorgray
795 396 a
SDict begin H.S end
 795 396 a Fk(7.8.2.)e(The)i(Bene)n(v)n(olent)f(T)-7
b(yrant)1763 396 y
SDict begin 13 H.L end
 1763 396 a 1763 396 a
SDict begin [/Subtype /Link/Dest (0:5150) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1763 396 a Black
Black 20 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 396
a
SDict begin H.S end
 3759 396 a Fk(406)3885 396 y
SDict begin 13 H.L end
 3885 396 a 3885 396 a
SDict begin [/Subtype /Link/Dest (0:5150) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

3885 396 a Black 0 TeXcolorgray 795 504 a
SDict begin H.S end
 795 504 a Fk(7.8.3.)18
b(The)i(Earth)g(and)f(Sk)o(y)1622 504 y
SDict begin 13 H.L end
 1622 504 a 1622
504 a
SDict begin [/Subtype /Link/Dest (0:5155) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1622 504 a Black Black 15 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 504 a
SDict begin H.S end
 3759 504 a Fk(407)3885
504 y
SDict begin 13 H.L end
 3885 504 a 3885 504 a
SDict begin [/Subtype /Link/Dest (0:5155) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 504 a Black 0 TeXcolorgray
795 612 a
SDict begin H.S end
 795 612 a Fk(7.8.4.)f(The)i(Open)g(Door)1525
612 y
SDict begin 13 H.L end
 1525 612 a 1525 612 a
SDict begin [/Subtype /Link/Dest (0:5160) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1525 612 a Black Black 9
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 612 a
SDict begin H.S end
 3759 612 a Fk(407)3885
612 y
SDict begin 13 H.L end
 3885 612 a 3885 612 a
SDict begin [/Subtype /Link/Dest (0:5160) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 612 a Black 0 TeXcolorgray
795 720 a
SDict begin H.S end
 795 720 a Fk(7.8.5.)e(The)i(Laughing)e(Clo)n(wn)1711
720 y
SDict begin 13 H.L end
 1711 720 a 1711 720 a
SDict begin [/Subtype /Link/Dest (0:5165) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1711 720 a Black Black 9
w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 720 a
SDict begin H.S end
 3759 720 a
Fk(407)3885 720 y
SDict begin 13 H.L end
 3885 720 a 3885 720 a
SDict begin [/Subtype /Link/Dest (0:5165) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 720 a Black
0 TeXcolorgray 795 828 a
SDict begin H.S end
 795 828 a Fk(7.8.6.)g(The)i(Mindful)f(General)
1709 828 y
SDict begin 13 H.L end
 1709 828 a 1709 828 a
SDict begin [/Subtype /Link/Dest (0:5170) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1709 828 a Black Black
11 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 828 a
SDict begin H.S end
 3759 828 a
Fk(407)3885 828 y
SDict begin 13 H.L end
 3885 828 a 3885 828 a
SDict begin [/Subtype /Link/Dest (0:5170) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 828 a Black
0 TeXcolorgray 795 936 a
SDict begin H.S end
 795 936 a Fk(7.8.7.)f(The)i(Social)g(Engineer)
1682 936 y
SDict begin 13 H.L end
 1682 936 a 1682 936 a
SDict begin [/Subtype /Link/Dest (0:5175) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1682 936 a Black Black
18 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 936 a
SDict begin H.S end
 3759 936 a Fk(408)3885 936 y
SDict begin 13 H.L end
 3885 936 a 3885
936 a
SDict begin [/Subtype /Link/Dest (0:5175) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 936 a Black 0 TeXcolorgray 795 1044 a
SDict begin H.S end
 795
1044 a Fk(7.8.8.)e(The)i(Constant)g(Gardener)1779 1044
y
SDict begin 13 H.L end
 1779 1044 a 1779 1044 a
SDict begin [/Subtype /Link/Dest (0:5180) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1779 1044 a Black Black 4 w
Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1044 a
SDict begin H.S end
 3759 1044
a Fk(408)3885 1044 y
SDict begin 13 H.L end
 3885 1044 a 3885 1044 a
SDict begin [/Subtype /Link/Dest (0:5180) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1044
a Black 0 TeXcolorgray 795 1152 a
SDict begin H.S end
 795 1152 a Fk(7.8.9.)e(The)i(Rolling)
g(Stone)1612 1152 y
SDict begin 13 H.L end
 1612 1152 a 1612 1152 a
SDict begin [/Subtype /Link/Dest (0:5185) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1612 1152
a Black Black 5 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1152 a
SDict begin H.S end
 3759 1152 a Fk(408)3885
1152 y
SDict begin 13 H.L end
 3885 1152 a 3885 1152 a
SDict begin [/Subtype /Link/Dest (0:5185) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1152 a Black 0 TeXcolorgray
795 1260 a
SDict begin H.S end
 795 1260 a Fk(7.8.10.)e(The)i(Pirate)g(Gang)1589
1260 y
SDict begin 13 H.L end
 1589 1260 a 1589 1260 a
SDict begin [/Subtype /Link/Dest (0:5190) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1589 1260 a Black Black
7 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1260 a
SDict begin H.S end
 3759 1260
a Fk(408)3885 1260 y
SDict begin 13 H.L end
 3885 1260 a 3885 1260 a
SDict begin [/Subtype /Link/Dest (0:5190) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1260
a Black 0 TeXcolorgray 795 1368 a
SDict begin H.S end
 795 1368 a Fk(7.8.11.)e(The)i(Flash)g
(Mob)1552 1368 y
SDict begin 13 H.L end
 1552 1368 a 1552 1368 a
SDict begin [/Subtype /Link/Dest (0:5195) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1552 1368 a
Black Black 2 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1368 a
SDict begin H.S end
 3759 1368 a Fk(408)3885
1368 y
SDict begin 13 H.L end
 3885 1368 a 3885 1368 a
SDict begin [/Subtype /Link/Dest (0:5195) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1368 a Black 0 TeXcolorgray
795 1476 a
SDict begin H.S end
 795 1476 a Fk(7.8.12.)e(The)i(Canary)f(W)-7
b(atcher)1729 1476 y
SDict begin 13 H.L end
 1729 1476 a 1729 1476 a
SDict begin [/Subtype /Link/Dest (0:5200) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1729 1476
a Black Black 12 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1476 a
SDict begin H.S end
 3759 1476
a Fk(409)3885 1476 y
SDict begin 13 H.L end
 3885 1476 a 3885 1476 a
SDict begin [/Subtype /Link/Dest (0:5200) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1476
a Black 0 TeXcolorgray 795 1583 a
SDict begin H.S end
 795 1583 a Fk(7.8.13.)18
b(The)i(Hangman)1519 1583 y
SDict begin 13 H.L end
 1519 1583 a 1519 1583 a
SDict begin [/Subtype /Link/Dest (0:5205) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1519
1583 a Black Black 15 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 1583
a
SDict begin H.S end
 3759 1583 a Fk(409)3885 1583 y
SDict begin 13 H.L end
 3885 1583 a 3885 1583
a
SDict begin [/Subtype /Link/Dest (0:5205) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1583 a Black 0 TeXcolorgray 795 1691 a
SDict begin H.S end
 795 1691
a Fk(7.8.14.)e(The)i(Historian)1504 1691 y
SDict begin 13 H.L end
 1504 1691
a 1504 1691 a
SDict begin [/Subtype /Link/Dest (0:5210) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1504 1691 a Black Black 9 w Fk(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1691 a
SDict begin H.S end
 3759 1691
a Fk(409)3885 1691 y
SDict begin 13 H.L end
 3885 1691 a 3885 1691 a
SDict begin [/Subtype /Link/Dest (0:5210) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1691
a Black 0 TeXcolorgray 795 1799 a
SDict begin H.S end
 795 1799 a Fk(7.8.15.)e(The)i(Pro)o
(v)n(ocateur)1595 1799 y
SDict begin 13 H.L end
 1595 1799 a 1595 1799 a
SDict begin [/Subtype /Link/Dest (0:5215) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1595
1799 a Black Black 1 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 1799
a
SDict begin H.S end
 3759 1799 a Fk(409)3885 1799 y
SDict begin 13 H.L end
 3885 1799 a 3885 1799
a
SDict begin [/Subtype /Link/Dest (0:5215) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 1799 a Black 0 TeXcolorgray 795 1907 a
SDict begin H.S end
 795 1907
a Fk(7.8.16.)e(The)i(Mystic)1425 1907 y
SDict begin 13 H.L end
 1425 1907 a 1425
1907 a
SDict begin [/Subtype /Link/Dest (0:5221) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1425 1907 a Black Black 5 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1907 a
SDict begin H.S end
 3759
1907 a Fk(410)3885 1907 y
SDict begin 13 H.L end
 3885 1907 a 3885 1907 a
SDict begin [/Subtype /Link/Dest (0:5221) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
1907 a Black 0 TeXcolorgray 396 2035 a
SDict begin H.S end
 396 2035 a Fg(8.)g(A)h(Uni)o(v)o
(erse)g(of)f(Mo)o(ving)g(Pieces)1492 2035 y
SDict begin 13 H.L end
 1492 2035
a 1492 2035 a
SDict begin [/Subtype /Link/Dest (0:5226) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1492 2035 a Black Black Fg(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2035 a
SDict begin H.S end
 3759
2035 a Fg(411)3885 2035 y
SDict begin 13 H.L end
 3885 2035 a 3885 2035 a
SDict begin [/Subtype /Link/Dest (0:5226) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2035 a Black 0 TeXcolorgray 596 2163 a
SDict begin H.S end
 596 2163 a Fk(8.1.)f(Design)h
(for)f(The)h(Real)h(W)-7 b(orld)1643 2163 y
SDict begin 13 H.L end
 1643 2163
a 1643 2163 a
SDict begin [/Subtype /Link/Dest (0:5239) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1643 2163 a Black Black 15 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2163 a
SDict begin H.S end
 3759 2163 a Fk(411)3885 2163
y
SDict begin 13 H.L end
 3885 2163 a 3885 2163 a
SDict begin [/Subtype /Link/Dest (0:5239) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2163 a Black 0 TeXcolorgray
596 2271 a
SDict begin H.S end
 596 2271 a Fk(8.2.)19 b(The)h(Secret)g(Life)g(of)g(W)m(iFi)
1535 2271 y
SDict begin 13 H.L end
 1535 2271 a 1535 2271 a
SDict begin [/Subtype /Link/Dest (0:5283) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1535 2271 a Black
Black 19 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2271 a
SDict begin H.S end
 3759 2271 a Fk(413)3885 2271
y
SDict begin 13 H.L end
 3885 2271 a 3885 2271 a
SDict begin [/Subtype /Link/Dest (0:5283) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2271 a Black 0 TeXcolorgray
795 2379 a
SDict begin H.S end
 795 2379 a Fk(8.2.1.)e(Why)i(Mesh)g(isn')o(t)g(Here)g(Y)-8
b(et)1850 2379 y
SDict begin 13 H.L end
 1850 2379 a 1850 2379 a
SDict begin [/Subtype /Link/Dest (0:5286) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1850 2379 a
Black Black 16 w Fk(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2379 a
SDict begin H.S end
 3759
2379 a Fk(413)3885 2379 y
SDict begin 13 H.L end
 3885 2379 a 3885 2379 a
SDict begin [/Subtype /Link/Dest (0:5286) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2379 a Black 0 TeXcolorgray 795 2487 a
SDict begin H.S end
 795 2487 a Fk(8.2.2.)18
b(Some)i(Physics)1466 2487 y
SDict begin 13 H.L end
 1466 2487 a 1466 2487 a
SDict begin [/Subtype /Link/Dest (0:5295) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end

1466 2487 a Black Black 5 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 2487
a
SDict begin H.S end
 3759 2487 a Fk(414)3885 2487 y
SDict begin 13 H.L end
 3885 2487 a 3885 2487
a
SDict begin [/Subtype /Link/Dest (0:5295) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2487 a Black 0 TeXcolorgray 795 2595 a
SDict begin H.S end
 795 2595
a Fk(8.2.3.)e(What')-5 b(s)21 b(the)f(Current)g(Status?)1895
2595 y
SDict begin 13 H.L end
 1895 2595 a 1895 2595 a
SDict begin [/Subtype /Link/Dest (0:5310) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1895 2595 a Black Black
12 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 2595 a
SDict begin H.S end
 3759
2595 a Fk(415)3885 2595 y
SDict begin 13 H.L end
 3885 2595 a 3885 2595 a
SDict begin [/Subtype /Link/Dest (0:5310) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
2595 a Black 0 TeXcolorgray 795 2703 a
SDict begin H.S end
 795 2703 a Fk(8.2.4.)e
(Conclusions)1414 2703 y
SDict begin 13 H.L end
 1414 2703 a 1414 2703 a
SDict begin [/Subtype /Link/Dest (0:5322) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1414
2703 a Black Black 16 w Fk(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2703 a
SDict begin H.S end
 3759 2703
a Fk(416)3885 2703 y
SDict begin 13 H.L end
 3885 2703 a 3885 2703 a
SDict begin [/Subtype /Link/Dest (0:5322) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2703
a Black 0 TeXcolorgray 596 2811 a
SDict begin H.S end
 596 2811 a Fk(8.3.)h(Promixity-based)
e(Netw)o(orking)1708 2811 y
SDict begin 13 H.L end
 1708 2811 a 1708 2811 a
SDict begin [/Subtype /Link/Dest (0:5326) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1708
2811 a Black Black 12 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2811 a
SDict begin H.S end
 3759 2811 a Fk(417)3885 2811 y
SDict begin 13 H.L end
 3885 2811
a 3885 2811 a
SDict begin [/Subtype /Link/Dest (0:5326) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2811 a Black 0 TeXcolorgray 795 2918
a
SDict begin H.S end
 795 2918 a Fk(8.3.1.)h(Preempti)n(v)o(e)h(Disco)o(v)o(ery)f(o)o(v)o
(er)h(Ra)o(w)i(Sock)o(ets)2353 2918 y
SDict begin 13 H.L end
 2353 2918 a 2353
2918 a
SDict begin [/Subtype /Link/Dest (0:5332) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2353 2918 a Black Black 11 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2918 a
SDict begin H.S end
 3759 2918 a Fk(417)3885 2918
y
SDict begin 13 H.L end
 3885 2918 a 3885 2918 a
SDict begin [/Subtype /Link/Dest (0:5332) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 2918 a Black 0 TeXcolorgray
795 3026 a
SDict begin H.S end
 795 3026 a Fk(8.3.2.)d(Cooperati)n(v)o(e)h(Disco)o(v)o(ery)f
(using)i(UDP)h(Broadcasts)2538 3026 y
SDict begin 13 H.L end
 2538 3026 a 2538
3026 a
SDict begin [/Subtype /Link/Dest (0:5353) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2538 3026 a Black Black 13 w Fk(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3026 a
SDict begin H.S end
 3759 3026 a Fk(419)3885
3026 y
SDict begin 13 H.L end
 3885 3026 a 3885 3026 a
SDict begin [/Subtype /Link/Dest (0:5353) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3026 a Black 0 TeXcolorgray
795 3134 a
SDict begin H.S end
 795 3134 a Fk(8.3.3.)d(Multiple)i(Nodes)g(on)g(One)g(De)n
(vice)2039 3134 y
SDict begin 13 H.L end
 2039 3134 a 2039 3134 a
SDict begin [/Subtype /Link/Dest (0:5390) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2039 3134 a
Black Black 14 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 3134 a
SDict begin H.S end
 3759
3134 a Fk(423)3885 3134 y
SDict begin 13 H.L end
 3885 3134 a 3885 3134 a
SDict begin [/Subtype /Link/Dest (0:5390) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
3134 a Black 0 TeXcolorgray 795 3242 a
SDict begin H.S end
 795 3242 a Fk(8.3.4.)e
(Designing)h(the)i(API)1621 3242 y
SDict begin 13 H.L end
 1621 3242 a 1621 3242
a
SDict begin [/Subtype /Link/Dest (0:5398) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1621 3242 a Black Black 16 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3242 a
SDict begin H.S end
 3759 3242 a Fk(424)3885
3242 y
SDict begin 13 H.L end
 3885 3242 a 3885 3242 a
SDict begin [/Subtype /Link/Dest (0:5398) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3242 a Black 0 TeXcolorgray
795 3350 a
SDict begin H.S end
 795 3350 a Fk(8.3.5.)d(More)i(about)f(UDP)1574
3350 y
SDict begin 13 H.L end
 1574 3350 a 1574 3350 a
SDict begin [/Subtype /Link/Dest (0:5474) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1574 3350 a Black Black
1 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3350
a
SDict begin H.S end
 3759 3350 a Fk(432)3885 3350 y
SDict begin 13 H.L end
 3885 3350 a 3885 3350
a
SDict begin [/Subtype /Link/Dest (0:5474) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3350 a Black 0 TeXcolorgray 795 3458 a
SDict begin H.S end
 795 3458
a Fk(8.3.6.)f(Designing)h(the)i(T)-7 b(opology)18 b(Layer)2019
3458 y
SDict begin 13 H.L end
 2019 3458 a 2019 3458 a
SDict begin [/Subtype /Link/Dest (0:5482) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 2019 3458 a Black Black
13 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 3458
a
SDict begin H.S end
 3759 3458 a Fk(433)3885 3458 y
SDict begin 13 H.L end
 3885 3458 a 3885 3458
a
SDict begin [/Subtype /Link/Dest (0:5482) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3458 a Black 0 TeXcolorgray 396 3586 a
SDict begin H.S end
 396 3586
a Fg(9.)i(P)n(ostface)774 3586 y
SDict begin 13 H.L end
 774 3586 a 774 3586
a
SDict begin [/Subtype /Link/Dest (0:5505) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 774 3586 a Black Black 12 w Fg(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 3586 a
SDict begin H.S end
 3759 3586
a Fg(435)3885 3586 y
SDict begin 13 H.L end
 3885 3586 a 3885 3586 a
SDict begin [/Subtype /Link/Dest (0:5505) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3586
a Black 0 TeXcolorgray 596 3714 a
SDict begin H.S end
 596 3714 a Fk(9.1.)f(T)-7
b(ales)21 b(from)e(Out)h(There)1457 3714 y
SDict begin 13 H.L end
 1457 3714
a 1457 3714 a
SDict begin [/Subtype /Link/Dest (0:5507) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1457 3714 a Black Black 14 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3714 a
SDict begin H.S end
 3759 3714 a Fk(435)3885 3714 y
SDict begin 13 H.L end
 3885 3714
a 3885 3714 a
SDict begin [/Subtype /Link/Dest (0:5507) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3714 a Black 0 TeXcolorgray 795 3822
a
SDict begin H.S end
 795 3822 a Fk(9.1.1.)e(Rob)i(Gagnon')-5 b(s)19 b(Story)1681
3822 y
SDict begin 13 H.L end
 1681 3822 a 1681 3822 a
SDict begin [/Subtype /Link/Dest (0:5510) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1681 3822 a Black Black
19 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 3822 a
SDict begin H.S end
 3759 3822 a Fk(435)3885 3822 y
SDict begin 13 H.L end
 3885 3822
a 3885 3822 a
SDict begin [/Subtype /Link/Dest (0:5510) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3822 a Black 0 TeXcolorgray 795 3930
a
SDict begin H.S end
 795 3930 a Fk(9.1.2.)f(T)-7 b(om)20 b(v)n(an)g(Leeuwen')-5
b(s)19 b(Story)1873 3930 y
SDict begin 13 H.L end
 1873 3930 a 1873 3930 a
SDict begin [/Subtype /Link/Dest (0:5514) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1873
3930 a Black Black 14 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 3930 a
SDict begin H.S end
 3759 3930 a Fk(435)3885
3930 y
SDict begin 13 H.L end
 3885 3930 a 3885 3930 a
SDict begin [/Subtype /Link/Dest (0:5514) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 3930 a Black 0 TeXcolorgray
795 4038 a
SDict begin H.S end
 795 4038 a Fk(9.1.3.)f(Michael)i(Jakl')-5
b(s)21 b(Story)1686 4038 y
SDict begin 13 H.L end
 1686 4038 a 1686 4038 a
SDict begin [/Subtype /Link/Dest (0:5519) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1686
4038 a Black Black 14 w Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4038 a
SDict begin H.S end
 3759 4038 a Fk(435)3885 4038
y
SDict begin 13 H.L end
 3885 4038 a 3885 4038 a
SDict begin [/Subtype /Link/Dest (0:5519) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4038 a Black 0 TeXcolorgray
795 4146 a
SDict begin H.S end
 795 4146 a Fk(9.1.4.)d(V)-9 b(adim)20 b(Shalts')-5
b(s)21 b(Story)1700 4146 y
SDict begin 13 H.L end
 1700 4146 a 1700 4146 a
SDict begin [/Subtype /Link/Dest (0:5523) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1700
4146 a Black Black Fk(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4146 a
SDict begin H.S end
 3759 4146 a Fk(436)3885 4146
y
SDict begin 13 H.L end
 3885 4146 a 3885 4146 a
SDict begin [/Subtype /Link/Dest (0:5523) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4146 a Black 0 TeXcolorgray
596 4253 a
SDict begin H.S end
 596 4253 a Fk(9.2.)e(Ho)n(w)h(the)g(Guide)g(Happened)1606
4253 y
SDict begin 13 H.L end
 1606 4253 a 1606 4253 a
SDict begin [/Subtype /Link/Dest (0:5528) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1606 4253 a Black Black
11 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4253 a
SDict begin H.S end
 3759 4253 a Fk(436)3885 4253
y
SDict begin 13 H.L end
 3885 4253 a 3885 4253 a
SDict begin [/Subtype /Link/Dest (0:5528) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885 4253 a Black 0 TeXcolorgray
596 4361 a
SDict begin H.S end
 596 4361 a Fk(9.3.)f(Remo)o(ving)f(Friction)1370
4361 y
SDict begin 13 H.L end
 1370 4361 a 1370 4361 a
SDict begin [/Subtype /Link/Dest (0:5539) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1370 4361 a Black Black
18 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4361 a
SDict begin H.S end
 3759
4361 a Fk(437)3885 4361 y
SDict begin 13 H.L end
 3885 4361 a 3885 4361 a
SDict begin [/Subtype /Link/Dest (0:5539) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4361 a Black 0 TeXcolorgray 596 4469 a
SDict begin H.S end
 596 4469 a Fk(9.4.)h(Licensing)
1070 4469 y
SDict begin 13 H.L end
 1070 4469 a 1070 4469 a
SDict begin [/Subtype /Link/Dest (0:5582) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 1070 4469 a Black
Black 7 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4469 a
SDict begin H.S end
 3759
4469 a Fk(439)3885 4469 y
SDict begin 13 H.L end
 3885 4469 a 3885 4469 a
SDict begin [/Subtype /Link/Dest (0:5582) cvn/H /I/Border [0 0 0]BorderArrayPatch/Color
[1 0 0] H.B /ANN pdfmark end
 3885
4469 a Black Black 3777 5569 a Ff(viii)p Black eop end
%%Page: 9 9
TeXDict begin 9 8 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.ix) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 115 a Fh(List)48 b(of)g(Figures)1184 115
y
SDict begin H.S end
 1184 115 a 1184 115 a
SDict begin 26.957 H.A end
 1184 115 a 1184 115 a
SDict begin [/View [/XYZ H.V]/Dest (4.0) cvn /DEST pdfmark end
 1184 115
a 0 TeXcolorgray 396 257 a
SDict begin H.S end
 396 257 a Fk(1-1.)19 b(Request-Reply)1043
257 y
SDict begin 13 H.L end
 1043 257 a 1043 257 a
SDict begin [/Subtype /Link/Dest (0:figure-1) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1043 257 a Black Black 13
w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3842 257 a
SDict begin H.S end
 3842 257 a Fk(4)3884 257 y
SDict begin 13 H.L end
 3884 257 a 3884
257 a
SDict begin [/Subtype /Link/Dest (0:figure-1) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 257 a Black 0 TeXcolorgray 396 365 a
SDict begin H.S end
 396 365
a Fk(1-2.)g(A)i(terrible)f(accident...)1231 365 y
SDict begin 13 H.L end
 1231
365 a 1231 365 a
SDict begin [/Subtype /Link/Dest (0:figure-2) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1231 365 a Black Black 12 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3842 365 a
SDict begin H.S end
 3842 365 a Fk(7)3884 365 y
SDict begin 13 H.L end
 3884 365 a 3884
365 a
SDict begin [/Subtype /Link/Dest (0:figure-2) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 365 a Black 0 TeXcolorgray 396 473 a
SDict begin H.S end
 396 473
a Fk(1-3.)f(A)i(\330MQ)g(string)1034 473 y
SDict begin 13 H.L end
 1034 473 a
1034 473 a
SDict begin [/Subtype /Link/Dest (0:figure-3) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1034 473 a Black Black 2 w Fk(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3842 473 a
SDict begin H.S end
 3842 473 a Fk(8)3884 473 y
SDict begin 13 H.L end
 3884 473 a 3884
473 a
SDict begin [/Subtype /Link/Dest (0:figure-3) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 473 a Black 0 TeXcolorgray 396 581 a
SDict begin H.S end
 396 581
a Fk(1-4.)e(Publish-Subscribe)1155 581 y
SDict begin 13 H.L end
 1155 581 a 1155
581 a
SDict begin [/Subtype /Link/Dest (0:figure-4) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1155 581 a Black Black 5 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 581 a
SDict begin H.S end
 3800 581 a Fk(11)3884
581 y
SDict begin 13 H.L end
 3884 581 a 3884 581 a
SDict begin [/Subtype /Link/Dest (0:figure-4) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 581 a Black 0 TeXcolorgray
396 689 a
SDict begin H.S end
 396 689 a Fk(1-5.)g(P)o(arallel)i(Pipeline)1095
689 y
SDict begin 13 H.L end
 1095 689 a 1095 689 a
SDict begin [/Subtype /Link/Dest (0:figure-5) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1095 689 a Black Black 3
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 689 a
SDict begin H.S end

3800 689 a Fk(15)3884 689 y
SDict begin 13 H.L end
 3884 689 a 3884 689 a
SDict begin [/Subtype /Link/Dest (0:figure-5) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884
689 a Black 0 TeXcolorgray 396 797 a
SDict begin H.S end
 396 797 a Fk(1-6.)e(F)o(air)i
(Queuing)990 797 y
SDict begin 13 H.L end
 990 797 a 990 797 a
SDict begin [/Subtype /Link/Dest (0:figure-6) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 990 797 a Black
Black 4 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 797 a
SDict begin H.S end
 3800 797
a Fk(19)3884 797 y
SDict begin 13 H.L end
 3884 797 a 3884 797 a
SDict begin [/Subtype /Link/Dest (0:figure-6) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 797 a Black
0 TeXcolorgray 396 905 a
SDict begin H.S end
 396 905 a Fk(1-7.)e(Messaging)h(as)h(it)g
(Starts)1275 905 y
SDict begin 13 H.L end
 1275 905 a 1275 905 a
SDict begin [/Subtype /Link/Dest (0:figure-7) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1275 905 a Black
Black 10 w Fk(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 905 a
SDict begin H.S end
 3800 905 a Fk(24)3884 905 y
SDict begin 13 H.L end

3884 905 a 3884 905 a
SDict begin [/Subtype /Link/Dest (0:figure-7) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 905 a Black 0 TeXcolorgray
396 1013 a
SDict begin H.S end
 396 1013 a Fk(1-8.)e(Messaging)h(as)h(it)g(Becomes)1391
1013 y
SDict begin 13 H.L end
 1391 1013 a 1391 1013 a
SDict begin [/Subtype /Link/Dest (0:figure-8) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1391 1013 a Black Black
18 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 1013 a
SDict begin H.S end
 3800 1013 a Fk(25)3884 1013 y
SDict begin 13 H.L end
 3884 1013 a
3884 1013 a
SDict begin [/Subtype /Link/Dest (0:figure-8) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1013 a Black 0 TeXcolorgray 396 1121
a
SDict begin H.S end
 396 1121 a Fk(1-9.)e(Missing)i(Message)f(Problem)f(Solv)o(er)1667
1121 y
SDict begin 13 H.L end
 1667 1121 a 1667 1121 a
SDict begin [/Subtype /Link/Dest (0:figure-9) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1667 1121 a Black Black
12 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
1121 a
SDict begin H.S end
 3800 1121 a Fk(28)3884 1121 y
SDict begin 13 H.L end
 3884 1121 a 3884
1121 a
SDict begin [/Subtype /Link/Dest (0:figure-9) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1121 a Black 0 TeXcolorgray 396 1229 a
SDict begin H.S end
 396
1229 a Fk(2-1.)g(TCP)i(sock)o(ets)g(are)f(1)g(to)h(1)1298
1229 y
SDict begin 13 H.L end
 1298 1229 a 1298 1229 a
SDict begin [/Subtype /Link/Dest (0:figure-10) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1298 1229 a Black Black
7 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 1229 a
SDict begin H.S end
 3800
1229 a Fk(35)3884 1229 y
SDict begin 13 H.L end
 3884 1229 a 3884 1229 a
SDict begin [/Subtype /Link/Dest (0:figure-10) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884
1229 a Black 0 TeXcolorgray 396 1337 a
SDict begin H.S end
 396 1337 a Fk(2-2.)e(\330MQ)i
(Sock)o(ets)f(are)g(N)h(to)f(N)1389 1337 y
SDict begin 13 H.L end
 1389 1337
a 1389 1337 a
SDict begin [/Subtype /Link/Dest (0:figure-11) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1389 1337 a Black Black 20 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 1337 a
SDict begin H.S end

3800 1337 a Fk(36)3884 1337 y
SDict begin 13 H.L end
 3884 1337 a 3884 1337 a
SDict begin [/Subtype /Link/Dest (0:figure-11) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3884 1337 a Black 0 TeXcolorgray 396 1445 a
SDict begin H.S end
 396 1445
a Fk(2-3.)f(HTTP)i(On)f(the)g(W)m(ire)1184 1445 y
SDict begin 13 H.L end
 1184
1445 a 1184 1445 a
SDict begin [/Subtype /Link/Dest (0:figure-12) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1184 1445 a Black Black 18 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 1445 a
SDict begin H.S end
 3800 1445 a Fk(38)3884 1445
y
SDict begin 13 H.L end
 3884 1445 a 3884 1445 a
SDict begin [/Subtype /Link/Dest (0:figure-12) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1445 a Black 0 TeXcolorgray
396 1553 a
SDict begin H.S end
 396 1553 a Fk(2-4.)f(\330MQ)i(On)f(the)g(W)m(ire)1170
1553 y
SDict begin 13 H.L end
 1170 1553 a 1170 1553 a
SDict begin [/Subtype /Link/Dest (0:figure-13) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1170 1553 a Black Black
11 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 1553 a
SDict begin H.S end
 3800
1553 a Fk(38)3884 1553 y
SDict begin 13 H.L end
 3884 1553 a 3884 1553 a
SDict begin [/Subtype /Link/Dest (0:figure-13) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884
1553 a Black 0 TeXcolorgray 396 1660 a
SDict begin H.S end
 396 1660 a Fk(2-5.)f(P)o
(arallel)i(Pipeline)e(with)i(Kill)g(Signaling)1753 1660
y
SDict begin 13 H.L end
 1753 1660 a 1753 1660 a
SDict begin [/Subtype /Link/Dest (0:figure-14) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1753 1660 a Black Black 9 w
Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 1660 a
SDict begin H.S end
 3800 1660 a
Fk(48)3884 1660 y
SDict begin 13 H.L end
 3884 1660 a 3884 1660 a
SDict begin [/Subtype /Link/Dest (0:figure-14) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1660 a
Black 0 TeXcolorgray 396 1768 a
SDict begin H.S end
 396 1768 a Fk(2-6.)e(Small-scale)i
(Pub-Sub)d(Netw)o(ork)1554 1768 y
SDict begin 13 H.L end
 1554 1768 a 1554 1768
a
SDict begin [/Subtype /Link/Dest (0:figure-15) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1554 1768 a Black Black Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 1768 a
SDict begin H.S end
 3800 1768 a Fk(55)3884 1768
y
SDict begin 13 H.L end
 3884 1768 a 3884 1768 a
SDict begin [/Subtype /Link/Dest (0:figure-15) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1768 a Black 0 TeXcolorgray
396 1876 a
SDict begin H.S end
 396 1876 a Fk(2-7.)h(Pub-Sub)g(Netw)o(ork)h(with)g(a)h
(Proxy)1592 1876 y
SDict begin 13 H.L end
 1592 1876 a 1592 1876 a
SDict begin [/Subtype /Link/Dest (0:figure-16) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1592 1876
a Black Black 4 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 1876 a
SDict begin H.S end
 3800 1876 a
Fk(56)3884 1876 y
SDict begin 13 H.L end
 3884 1876 a 3884 1876 a
SDict begin [/Subtype /Link/Dest (0:figure-16) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1876 a
Black 0 TeXcolorgray 396 1984 a
SDict begin H.S end
 396 1984 a Fk(2-8.)e(Extended)g
(Publish-Subscribe)1490 1984 y
SDict begin 13 H.L end
 1490 1984 a 1490 1984
a
SDict begin [/Subtype /Link/Dest (0:figure-17) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1490 1984 a Black Black 2 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 1984 a
SDict begin H.S end
 3800 1984 a Fk(57)3884
1984 y
SDict begin 13 H.L end
 3884 1984 a 3884 1984 a
SDict begin [/Subtype /Link/Dest (0:figure-17) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 1984 a Black 0 TeXcolorgray
396 2092 a
SDict begin H.S end
 396 2092 a Fk(2-9.)g(Load-balancing)e(of)j(Requests)1480
2092 y
SDict begin 13 H.L end
 1480 2092 a 1480 2092 a
SDict begin [/Subtype /Link/Dest (0:figure-18) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1480 2092 a Black Black
12 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 2092 a
SDict begin H.S end

3800 2092 a Fk(58)3884 2092 y
SDict begin 13 H.L end
 3884 2092 a 3884 2092 a
SDict begin [/Subtype /Link/Dest (0:figure-18) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3884 2092 a Black 0 TeXcolorgray 396 2200 a
SDict begin H.S end
 396 2200
a Fk(2-10.)f(Extended)f(Request-reply)1392 2200 y
SDict begin 13 H.L end
 1392
2200 a 1392 2200 a
SDict begin [/Subtype /Link/Dest (0:figure-19) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1392 2200 a Black Black 17 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
2200 a
SDict begin H.S end
 3800 2200 a Fk(60)3884 2200 y
SDict begin 13 H.L end
 3884 2200 a 3884
2200 a
SDict begin [/Subtype /Link/Dest (0:figure-19) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 2200 a Black 0 TeXcolorgray 396 2308 a
SDict begin H.S end
 396
2308 a Fk(2-11.)h(Request-reply)f(Brok)o(er)1307 2308
y
SDict begin 13 H.L end
 1307 2308 a 1307 2308 a
SDict begin [/Subtype /Link/Dest (0:figure-20) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1307 2308 a Black Black 19
w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 2308 a
SDict begin H.S end
 3800 2308 a Fk(63)3884
2308 y
SDict begin 13 H.L end
 3884 2308 a 3884 2308 a
SDict begin [/Subtype /Link/Dest (0:figure-20) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 2308 a Black 0 TeXcolorgray
396 2416 a
SDict begin H.S end
 396 2416 a Fk(2-12.)h(Pub-Sub)g(F)o(orw)o(arder)f(Proxy)1461
2416 y
SDict begin 13 H.L end
 1461 2416 a 1461 2416 a
SDict begin [/Subtype /Link/Dest (0:figure-21) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1461 2416 a Black Black
10 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray
3800 2416 a
SDict begin H.S end
 3800 2416 a Fk(66)3884 2416 y
SDict begin 13 H.L end
 3884 2416 a
3884 2416 a
SDict begin [/Subtype /Link/Dest (0:figure-21) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 2416 a Black 0 TeXcolorgray 396 2524
a
SDict begin H.S end
 396 2524 a Fk(2-13.)h(Multithreaded)f(Serv)o(er)1298
2524 y
SDict begin 13 H.L end
 1298 2524 a 1298 2524 a
SDict begin [/Subtype /Link/Dest (0:figure-22) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1298 2524 a Black Black
7 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 2524 a
SDict begin H.S end
 3800
2524 a Fk(70)3884 2524 y
SDict begin 13 H.L end
 3884 2524 a 3884 2524 a
SDict begin [/Subtype /Link/Dest (0:figure-22) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884
2524 a Black 0 TeXcolorgray 396 2632 a
SDict begin H.S end
 396 2632 a Fk(2-14.)h(The)h
(Relay)g(Race)1120 2632 y
SDict begin 13 H.L end
 1120 2632 a 1120 2632 a
SDict begin [/Subtype /Link/Dest (0:figure-23) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1120
2632 a Black Black 19 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black 0 TeXcolorgray 3800 2632 a
SDict begin H.S end
 3800
2632 a Fk(73)3884 2632 y
SDict begin 13 H.L end
 3884 2632 a 3884 2632 a
SDict begin [/Subtype /Link/Dest (0:figure-23) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884
2632 a Black 0 TeXcolorgray 396 2740 a
SDict begin H.S end
 396 2740 a Fk(2-15.)f(Pub-Sub)g
(Synchronization)1445 2740 y
SDict begin 13 H.L end
 1445 2740 a 1445 2740 a
SDict begin [/Subtype /Link/Dest (0:figure-24) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

1445 2740 a Black Black 6 w Fk(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
2740 a
SDict begin H.S end
 3800 2740 a Fk(77)3884 2740 y
SDict begin 13 H.L end
 3884 2740 a 3884
2740 a
SDict begin [/Subtype /Link/Dest (0:figure-24) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 2740 a Black 0 TeXcolorgray 396 2848 a
SDict begin H.S end
 396
2848 a Fk(2-16.)g(Pub-Sub)g(En)m(v)o(elope)e(with)k(Separate)e(K)n(e)o
(y)1837 2848 y
SDict begin 13 H.L end
 1837 2848 a 1837 2848 a
SDict begin [/Subtype /Link/Dest (0:figure-25) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1837 2848 a Black
Black 8 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 2848 a
SDict begin H.S end
 3800 2848 a
Fk(80)3884 2848 y
SDict begin 13 H.L end
 3884 2848 a 3884 2848 a
SDict begin [/Subtype /Link/Dest (0:figure-25) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 2848 a
Black 0 TeXcolorgray 396 2956 a
SDict begin H.S end
 396 2956 a Fk(2-17.)g(Pub-Sub)g(En)m(v)
o(elope)e(with)k(Sender)e(Address)1919 2956 y
SDict begin 13 H.L end
 1919 2956
a 1919 2956 a
SDict begin [/Subtype /Link/Dest (0:figure-26) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1919 2956 a Black Black 9 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 2956 a
SDict begin H.S end

3800 2956 a Fk(82)3884 2956 y
SDict begin 13 H.L end
 3884 2956 a 3884 2956 a
SDict begin [/Subtype /Link/Dest (0:figure-26) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3884 2956 a Black 0 TeXcolorgray 396 3064 a
SDict begin H.S end
 396 3064
a Fk(3-1.)g(Single-hop)g(Request-reply)f(En)m(v)o(elope)1732
3064 y
SDict begin 13 H.L end
 1732 3064 a 1732 3064 a
SDict begin [/Subtype /Link/Dest (0:figure-27) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1732 3064 a Black Black
9 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
3064 a
SDict begin H.S end
 3800 3064 a Fk(86)3884 3064 y
SDict begin 13 H.L end
 3884 3064 a 3884
3064 a
SDict begin [/Subtype /Link/Dest (0:figure-27) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3064 a Black 0 TeXcolorgray 396 3171 a
SDict begin H.S end
 396
3171 a Fk(3-2.)h(Multihop)g(Request-reply)g(En)m(v)o(elope)1677
3171 y
SDict begin 13 H.L end
 1677 3171 a 1677 3171 a
SDict begin [/Subtype /Link/Dest (0:figure-28) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1677 3171 a Black Black
2 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
3171 a
SDict begin H.S end
 3800 3171 a Fk(86)3884 3171 y
SDict begin 13 H.L end
 3884 3171 a 3884
3171 a
SDict begin [/Subtype /Link/Dest (0:figure-28) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3171 a Black 0 TeXcolorgray 396 3279 a
SDict begin H.S end
 396
3279 a Fk(3-3.)g(R)m(OUTER)i(In)m(v)o(ents)e(a)h(UUID)1424
3279 y
SDict begin 13 H.L end
 1424 3279 a 1424 3279 a
SDict begin [/Subtype /Link/Dest (0:figure-29) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1424 3279 a Black Black
6 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black 0 TeXcolorgray 3800 3279 a
SDict begin H.S end

3800 3279 a Fk(87)3884 3279 y
SDict begin 13 H.L end
 3884 3279 a 3884 3279 a
SDict begin [/Subtype /Link/Dest (0:figure-29) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3884 3279 a Black 0 TeXcolorgray 396 3387 a
SDict begin H.S end
 396 3387
a Fk(3-4.)f(R)m(OUTER)i(uses)g(Identity)e(If)h(It)g(kno)n(ws)g(It)1775
3387 y
SDict begin 13 H.L end
 1775 3387 a 1775 3387 a
SDict begin [/Subtype /Link/Dest (0:figure-30) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1775 3387 a Black Black
8 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 3387 a
SDict begin H.S end
 3800 3387 a Fk(88)3884
3387 y
SDict begin 13 H.L end
 3884 3387 a 3884 3387 a
SDict begin [/Subtype /Link/Dest (0:figure-30) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3387 a Black 0 TeXcolorgray
396 3495 a
SDict begin H.S end
 396 3495 a Fk(3-5.)f(R)m(OUTER-to-DEALER)g(Custom)h(Routing)
1893 3495 y
SDict begin 13 H.L end
 1893 3495 a 1893 3495 a
SDict begin [/Subtype /Link/Dest (0:figure-31) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1893 3495 a Black
Black 14 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 3495 a
SDict begin H.S end
 3800 3495 a
Fk(91)3884 3495 y
SDict begin 13 H.L end
 3884 3495 a 3884 3495 a
SDict begin [/Subtype /Link/Dest (0:figure-31) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3495 a
Black 0 TeXcolorgray 396 3603 a
SDict begin H.S end
 396 3603 a Fk(3-6.)f(Routing)h(En)m(v)o
(elope)e(for)h(DEALER)1612 3603 y
SDict begin 13 H.L end
 1612 3603 a 1612 3603
a
SDict begin [/Subtype /Link/Dest (0:figure-32) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1612 3603 a Black Black 5 w Fk(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black 0 TeXcolorgray 3800 3603 a
SDict begin H.S end
 3800 3603 a Fk(94)3884
3603 y
SDict begin 13 H.L end
 3884 3603 a 3884 3603 a
SDict begin [/Subtype /Link/Dest (0:figure-32) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3603 a Black 0 TeXcolorgray
396 3711 a
SDict begin H.S end
 396 3711 a Fk(3-7.)g(R)m(OUTER)i(to)f(REQ)h(Custom)f
(Routing)1718 3711 y
SDict begin 13 H.L end
 1718 3711 a 1718 3711 a
SDict begin [/Subtype /Link/Dest (0:figure-33) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1718 3711
a Black Black 2 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black 0 TeXcolorgray 3800 3711 a
SDict begin H.S end
 3800 3711 a
Fk(95)3884 3711 y
SDict begin 13 H.L end
 3884 3711 a 3884 3711 a
SDict begin [/Subtype /Link/Dest (0:figure-33) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3711 a
Black 0 TeXcolorgray 396 3819 a
SDict begin H.S end
 396 3819 a Fk(3-8.)f(Routing)h(En)m(v)o
(elope)e(for)h(REQ)1450 3819 y
SDict begin 13 H.L end
 1450 3819 a 1450 3819
a
SDict begin [/Subtype /Link/Dest (0:figure-34) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1450 3819 a Black Black 1 w Fk(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black 0 TeXcolorgray 3800
3819 a
SDict begin H.S end
 3800 3819 a Fk(98)3884 3819 y
SDict begin 13 H.L end
 3884 3819 a 3884
3819 a
SDict begin [/Subtype /Link/Dest (0:figure-34) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3819 a Black 0 TeXcolorgray 396 3927 a
SDict begin H.S end
 396
3927 a Fk(3-9.)g(R)m(OUTER-to-REP)h(Custom)g(Routing)1718
3927 y
SDict begin 13 H.L end
 1718 3927 a 1718 3927 a
SDict begin [/Subtype /Link/Dest (0:figure-35) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1718 3927 a Black Black
2 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
0 TeXcolorgray 3800 3927 a
SDict begin H.S end
 3800 3927 a Fk(98)3884 3927
y
SDict begin 13 H.L end
 3884 3927 a 3884 3927 a
SDict begin [/Subtype /Link/Dest (0:figure-35) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3884 3927 a Black 0 TeXcolorgray
396 4035 a
SDict begin H.S end
 396 4035 a Fk(3-10.)f(Routing)g(En)m(v)o(elope)f(for)i(REP)
1478 4035 y
SDict begin 13 H.L end
 1478 4035 a 1478 4035 a
SDict begin [/Subtype /Link/Dest (0:figure-36) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1478 4035 a Black
Black 14 w Fk(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 4035 a
SDict begin H.S end
 3759 4035 a Fk(101)3885 4035
y
SDict begin 13 H.L end
 3885 4035 a 3885 4035 a
SDict begin [/Subtype /Link/Dest (0:figure-36) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4035 a Black 0 TeXcolorgray
396 4143 a
SDict begin H.S end
 396 4143 a Fk(3-11.)f(Basic)i(Request-reply)1263
4143 y
SDict begin 13 H.L end
 1263 4143 a 1263 4143 a
SDict begin [/Subtype /Link/Dest (0:figure-37) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1263 4143 a Black Black
1 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 4143 a
SDict begin H.S end
 3759
4143 a Fk(101)3885 4143 y
SDict begin 13 H.L end
 3885 4143 a 3885 4143 a
SDict begin [/Subtype /Link/Dest (0:figure-37) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885
4143 a Black 0 TeXcolorgray 396 4251 a
SDict begin H.S end
 396 4251 a Fk(3-12.)e(Stretched)
g(Request-reply)1392 4251 y
SDict begin 13 H.L end
 1392 4251 a 1392 4251 a
SDict begin [/Subtype /Link/Dest (0:figure-38) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1392
4251 a Black Black 17 w Fk(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4251
a
SDict begin H.S end
 3759 4251 a Fk(102)3885 4251 y
SDict begin 13 H.L end
 3885 4251 a 3885 4251
a
SDict begin [/Subtype /Link/Dest (0:figure-38) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4251 a Black 0 TeXcolorgray 396 4359 a
SDict begin H.S end
 396 4359
a Fk(3-13.)g(Stretched)g(Request-reply)g(with)h(LR)m(U)1742
4359 y
SDict begin 13 H.L end
 1742 4359 a 1742 4359 a
SDict begin [/Subtype /Link/Dest (0:figure-39) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1742 4359 a Black Black
20 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 4359 a
SDict begin H.S end
 3759 4359 a Fk(103)3885 4359 y
SDict begin 13 H.L end
 3885 4359
a 3885 4359 a
SDict begin [/Subtype /Link/Dest (0:figure-39) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4359 a Black 0 TeXcolorgray 396 4467
a
SDict begin H.S end
 396 4467 a Fk(3-14.)f(Message)h(that)g(Client)h(Sends)1469
4467 y
SDict begin 13 H.L end
 1469 4467 a 1469 4467 a
SDict begin [/Subtype /Link/Dest (0:figure-40) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1469 4467 a Black Black
2 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 4467 a
SDict begin H.S end
 3759 4467 a Fk(108)3885
4467 y
SDict begin 13 H.L end
 3885 4467 a 3885 4467 a
SDict begin [/Subtype /Link/Dest (0:figure-40) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4467 a Black 0 TeXcolorgray
396 4575 a
SDict begin H.S end
 396 4575 a Fk(3-15.)e(Message)h(Coming)g(in)g(on)g(Frontend)
1681 4575 y
SDict begin 13 H.L end
 1681 4575 a 1681 4575 a
SDict begin [/Subtype /Link/Dest (0:figure-41) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1681 4575 a Black
Black -2 w Fk(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 4575 a
SDict begin H.S end
 3759 4575 a Fk(108)3885
4575 y
SDict begin 13 H.L end
 3885 4575 a 3885 4575 a
SDict begin [/Subtype /Link/Dest (0:figure-41) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4575 a Black 0 TeXcolorgray
396 4682 a
SDict begin H.S end
 396 4682 a Fk(3-16.)f(Message)h(Sent)h(to)f(Back)o(end)1446
4682 y
SDict begin 13 H.L end
 1446 4682 a 1446 4682 a
SDict begin [/Subtype /Link/Dest (0:figure-42) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1446 4682 a Black Black
5 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4682
a
SDict begin H.S end
 3759 4682 a Fk(109)3885 4682 y
SDict begin 13 H.L end
 3885 4682 a 3885 4682
a
SDict begin [/Subtype /Link/Dest (0:figure-42) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4682 a Black 0 TeXcolorgray 396 4790 a
SDict begin H.S end
 396 4790
a Fk(3-17.)f(Message)h(Deli)n(v)o(ered)f(to)h(W)-7 b(ork)o(er)1578
4790 y
SDict begin 13 H.L end
 1578 4790 a 1578 4790 a
SDict begin [/Subtype /Link/Dest (0:figure-43) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1578 4790 a Black Black
18 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 4790 a
SDict begin H.S end
 3759 4790
a Fk(109)3885 4790 y
SDict begin 13 H.L end
 3885 4790 a 3885 4790 a
SDict begin [/Subtype /Link/Dest (0:figure-43) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4790
a Black 0 TeXcolorgray 396 4898 a
SDict begin H.S end
 396 4898 a Fk(3-18.)19
b(Asynchronous)e(Client-Serv)o(er)1538 4898 y
SDict begin 13 H.L end
 1538 4898
a 1538 4898 a
SDict begin [/Subtype /Link/Dest (0:figure-44) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1538 4898 a Black Black 16 w Fk(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 4898
a
SDict begin H.S end
 3759 4898 a Fk(118)3885 4898 y
SDict begin 13 H.L end
 3885 4898 a 3885 4898
a
SDict begin [/Subtype /Link/Dest (0:figure-44) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 4898 a Black 0 TeXcolorgray 396 5006 a
SDict begin H.S end
 396 5006
a Fk(3-19.)i(Detail)i(of)f(Asynchronous)d(Serv)o(er)1621
5006 y
SDict begin 13 H.L end
 1621 5006 a 1621 5006 a
SDict begin [/Subtype /Link/Dest (0:figure-45) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1621 5006 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 5006
a
SDict begin H.S end
 3759 5006 a Fk(122)3885 5006 y
SDict begin 13 H.L end
 3885 5006 a 3885 5006
a
SDict begin [/Subtype /Link/Dest (0:figure-45) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 5006 a Black 0 TeXcolorgray 396 5114 a
SDict begin H.S end
 396 5114
a Fk(3-20.)i(Cluster)i(Architecture)1268 5114 y
SDict begin 13 H.L end
 1268
5114 a 1268 5114 a
SDict begin [/Subtype /Link/Dest (0:figure-46) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1268 5114 a Black Black 17 w Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 5114 a
SDict begin H.S end
 3759 5114 a Fk(125)3885 5114
y
SDict begin 13 H.L end
 3885 5114 a 3885 5114 a
SDict begin [/Subtype /Link/Dest (0:figure-46) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 5114 a Black Black 3823
5569 a Ff(ix)p Black eop end
%%Page: 10 10
TeXDict begin 10 9 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.x) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black 0 TeXcolorgray 396 72 a
SDict begin H.S end
 396 72 a Fk(3-21.)19
b(Multiple)h(Clusters)1169 72 y
SDict begin 13 H.L end
 1169 72 a 1169 72 a
SDict begin [/Subtype /Link/Dest (0:figure-47) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1169
72 a Black Black 12 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 72 a
SDict begin H.S end
 3759 72 a Fk(126)3885 72 y
SDict begin 13 H.L end
 3885
72 a 3885 72 a
SDict begin [/Subtype /Link/Dest (0:figure-47) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 72 a Black 0 TeXcolorgray 396 180
a
SDict begin H.S end
 396 180 a Fk(3-22.)f(Idea)h(1)g(-)g(Cross-connected)e(W)-7
b(ork)o(ers)1717 180 y
SDict begin 13 H.L end
 1717 180 a 1717 180 a
SDict begin [/Subtype /Link/Dest (0:figure-48) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1717 180
a Black Black 3 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 180
a
SDict begin H.S end
 3759 180 a Fk(127)3885 180 y
SDict begin 13 H.L end
 3885 180 a 3885 180 a
SDict begin [/Subtype /Link/Dest (0:figure-48) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3885 180 a Black 0 TeXcolorgray 396 288 a
SDict begin H.S end
 396 288 a Fk(3-23.)19
b(Idea)h(2)g(-)g(Brok)o(ers)g(T)-7 b(alking)19 b(to)i(Each)e(Other)1881
288 y
SDict begin 13 H.L end
 1881 288 a 1881 288 a
SDict begin [/Subtype /Link/Dest (0:figure-49) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1881 288 a Black Black 6
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 288 a
SDict begin H.S end
 3759 288 a Fk(128)3885 288 y
SDict begin 13 H.L end
 3885 288 a 3885
288 a
SDict begin [/Subtype /Link/Dest (0:figure-49) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 288 a Black 0 TeXcolorgray 396 396 a
SDict begin H.S end
 396 396
a Fk(3-24.)g(Cross-connected)f(Brok)o(ers)i(in)g(Federation)f(Model)
2126 396 y
SDict begin 13 H.L end
 2126 396 a 2126 396 a
SDict begin [/Subtype /Link/Dest (0:figure-50) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2126 396 a Black Black
10 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 396 a
SDict begin H.S end
 3759 396 a Fk(129)3885 396
y
SDict begin 13 H.L end
 3885 396 a 3885 396 a
SDict begin [/Subtype /Link/Dest (0:figure-50) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 396 a Black 0 TeXcolorgray
396 504 a
SDict begin H.S end
 396 504 a Fk(3-25.)g(Brok)o(er)g(Sock)o(et)h(Arrangement)1527
504 y
SDict begin 13 H.L end
 1527 504 a 1527 504 a
SDict begin [/Subtype /Link/Dest (0:figure-51) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1527 504 a Black Black 7
w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 504 a
SDict begin H.S end
 3759 504 a Fk(131)3885
504 y
SDict begin 13 H.L end
 3885 504 a 3885 504 a
SDict begin [/Subtype /Link/Dest (0:figure-51) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 504 a Black 0 TeXcolorgray
396 612 a
SDict begin H.S end
 396 612 a Fk(3-26.)f(The)h(State)h(Flo)n(w)1096
612 y
SDict begin 13 H.L end
 1096 612 a 1096 612 a
SDict begin [/Subtype /Link/Dest (0:figure-52) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1096 612 a Black Black 2
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 612 a
SDict begin H.S end
 3759 612 a Fk(132)3885 612 y
SDict begin 13 H.L end
 3885 612 a 3885
612 a
SDict begin [/Subtype /Link/Dest (0:figure-52) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 612 a Black 0 TeXcolorgray 396 720 a
SDict begin H.S end
 396 720
a Fk(3-27.)e(The)h(Flo)n(w)g(of)g(T)-7 b(asks)1206 720
y
SDict begin 13 H.L end
 1206 720 a 1206 720 a
SDict begin [/Subtype /Link/Dest (0:figure-53) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1206 720 a Black Black 16 w Fk(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 720 a
SDict begin H.S end
 3759 720 a Fk(136)3885 720 y
SDict begin 13 H.L end
 3885 720 a 3885
720 a
SDict begin [/Subtype /Link/Dest (0:figure-53) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 720 a Black 0 TeXcolorgray 396 828 a
SDict begin H.S end
 396 828
a Fk(4-1.)19 b(The)h(Lazy)g(Pirate)g(P)o(attern)1334
828 y
SDict begin 13 H.L end
 1334 828 a 1334 828 a
SDict begin [/Subtype /Link/Dest (0:figure-54) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1334 828 a Black Black 13
w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 828 a
SDict begin H.S end
 3759 828 a Fk(152)3885 828
y
SDict begin 13 H.L end
 3885 828 a 3885 828 a
SDict begin [/Subtype /Link/Dest (0:figure-54) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 828 a Black 0 TeXcolorgray
396 936 a
SDict begin H.S end
 396 936 a Fk(4-2.)f(The)h(Simple)g(Pirate)h(P)o(attern)1404
936 y
SDict begin 13 H.L end
 1404 936 a 1404 936 a
SDict begin [/Subtype /Link/Dest (0:figure-55) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1404 936 a Black Black 5
w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 936 a
SDict begin H.S end
 3759 936 a Fk(157)3885
936 y
SDict begin 13 H.L end
 3885 936 a 3885 936 a
SDict begin [/Subtype /Link/Dest (0:figure-55) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 936 a Black 0 TeXcolorgray
396 1044 a
SDict begin H.S end
 396 1044 a Fk(4-3.)e(The)h(P)o(aranoid)f(Pirate)h(P)o
(attern)1462 1044 y
SDict begin 13 H.L end
 1462 1044 a 1462 1044 a
SDict begin [/Subtype /Link/Dest (0:figure-56) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1462 1044
a Black Black 9 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1044 a
SDict begin H.S end
 3759
1044 a Fk(160)3885 1044 y
SDict begin 13 H.L end
 3885 1044 a 3885 1044 a
SDict begin [/Subtype /Link/Dest (0:figure-56) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885
1044 a Black 0 TeXcolorgray 396 1152 a
SDict begin H.S end
 396 1152 a Fk(4-4.)f(The)h
(Majordomo)e(P)o(attern)1346 1152 y
SDict begin 13 H.L end
 1346 1152 a 1346
1152 a
SDict begin [/Subtype /Link/Dest (0:figure-57) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1346 1152 a Black Black 1 w Fk(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1152 a
SDict begin H.S end
 3759 1152 a Fk(170)3885 1152 y
SDict begin 13 H.L end
 3885 1152
a 3885 1152 a
SDict begin [/Subtype /Link/Dest (0:figure-57) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1152 a Black 0 TeXcolorgray 396 1260
a
SDict begin H.S end
 396 1260 a Fk(4-5.)h(The)h(T)m(itanic)g(P)o(attern)1186
1260 y
SDict begin 13 H.L end
 1186 1260 a 1186 1260 a
SDict begin [/Subtype /Link/Dest (0:figure-58) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1186 1260 a Black Black
16 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black 0 TeXcolorgray 3759 1260 a
SDict begin H.S end
 3759
1260 a Fk(201)3885 1260 y
SDict begin 13 H.L end
 3885 1260 a 3885 1260 a
SDict begin [/Subtype /Link/Dest (0:figure-58) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885
1260 a Black 0 TeXcolorgray 396 1368 a
SDict begin H.S end
 396 1368 a Fk(4-6.)f(High-a)n(v)
n(ailability)g(P)o(air)m(,)g(Normal)h(Operation)1912
1368 y
SDict begin 13 H.L end
 1912 1368 a 1912 1368 a
SDict begin [/Subtype /Link/Dest (0:figure-59) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1912 1368 a Black Black
16 w Fk(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1368 a
SDict begin H.S end
 3759 1368 a Fk(212)3885
1368 y
SDict begin 13 H.L end
 3885 1368 a 3885 1368 a
SDict begin [/Subtype /Link/Dest (0:figure-59) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1368 a Black 0 TeXcolorgray
396 1476 a
SDict begin H.S end
 396 1476 a Fk(4-7.)f(High-a)n(v)n(ailability)g(P)o(air)h
(During)f(F)o(ailo)o(v)o(er)1817 1476 y
SDict begin 13 H.L end
 1817 1476 a 1817
1476 a
SDict begin [/Subtype /Link/Dest (0:figure-60) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1817 1476 a Black Black 7 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 1476 a
SDict begin H.S end
 3759 1476
a Fk(213)3885 1476 y
SDict begin 13 H.L end
 3885 1476 a 3885 1476 a
SDict begin [/Subtype /Link/Dest (0:figure-60) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1476
a Black 0 TeXcolorgray 396 1583 a
SDict begin H.S end
 396 1583 a Fk(4-8.)g(Binary)h(Star)h
(Finite)f(State)h(Machine)1643 1583 y
SDict begin 13 H.L end
 1643 1583 a 1643
1583 a
SDict begin [/Subtype /Link/Dest (0:figure-61) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1643 1583 a Black Black 15 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1583 a
SDict begin H.S end
 3759 1583 a Fk(223)3885 1583 y
SDict begin 13 H.L end
 3885 1583
a 3885 1583 a
SDict begin [/Subtype /Link/Dest (0:figure-61) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1583 a Black 0 TeXcolorgray 396 1691
a
SDict begin H.S end
 396 1691 a Fk(4-9.)e(The)h(Freelance)g(P)o(attern)1277
1691 y
SDict begin 13 H.L end
 1277 1691 a 1277 1691 a
SDict begin [/Subtype /Link/Dest (0:figure-62) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1277 1691 a Black Black
8 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1691 a
SDict begin H.S end
 3759 1691 a Fk(230)3885
1691 y
SDict begin 13 H.L end
 3885 1691 a 3885 1691 a
SDict begin [/Subtype /Link/Dest (0:figure-62) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1691 a Black 0 TeXcolorgray
396 1799 a
SDict begin H.S end
 396 1799 a Fk(5-1.)f(The)h(Simple)g(Black)h(Box)f(P)o
(attern)1563 1799 y
SDict begin 13 H.L end
 1563 1799 a 1563 1799 a
SDict begin [/Subtype /Link/Dest (0:figure-63) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1563 1799
a Black Black 12 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 1799 a
SDict begin H.S end
 3759 1799 a Fk(255)3885 1799 y
SDict begin 13 H.L end
 3885 1799
a 3885 1799 a
SDict begin [/Subtype /Link/Dest (0:figure-63) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1799 a Black 0 TeXcolorgray 396 1907
a
SDict begin H.S end
 396 1907 a Fk(5-2.)f(Mad)h(Black)h(Box)f(P)o(attern)1330
1907 y
SDict begin 13 H.L end
 1330 1907 a 1330 1907 a
SDict begin [/Subtype /Link/Dest (0:figure-64) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1330 1907 a Black Black
17 w Fk(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black 0 TeXcolorgray 3759 1907 a
SDict begin H.S end
 3759 1907 a Fk(256)3885
1907 y
SDict begin 13 H.L end
 3885 1907 a 3885 1907 a
SDict begin [/Subtype /Link/Dest (0:figure-64) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 1907 a Black 0 TeXcolorgray
396 2015 a
SDict begin H.S end
 396 2015 a Fk(5-3.)f(Simplest)i(Clone)f(Model)1297
2015 y
SDict begin 13 H.L end
 1297 2015 a 1297 2015 a
SDict begin [/Subtype /Link/Dest (0:figure-65) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1297 2015 a Black Black
8 w Fk(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2015 a
SDict begin H.S end
 3759 2015 a Fk(258)3885 2015 y
SDict begin 13 H.L end
 3885 2015
a 3885 2015 a
SDict begin [/Subtype /Link/Dest (0:figure-65) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2015 a Black 0 TeXcolorgray 396 2123
a
SDict begin H.S end
 396 2123 a Fk(5-4.)f(State)i(Replication)1119 2123
y
SDict begin 13 H.L end
 1119 2123 a 1119 2123 a
SDict begin [/Subtype /Link/Dest (0:figure-66) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1119 2123 a Black Black Fk(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black 0 TeXcolorgray 3759 2123
a
SDict begin H.S end
 3759 2123 a Fk(268)3885 2123 y
SDict begin 13 H.L end
 3885 2123 a 3885 2123
a
SDict begin [/Subtype /Link/Dest (0:figure-66) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2123 a Black 0 TeXcolorgray 396 2231 a
SDict begin H.S end
 396 2231
a Fk(5-5.)e(Republishing)g(Updates)1285 2231 y
SDict begin 13 H.L end
 1285 2231
a 1285 2231 a
SDict begin [/Subtype /Link/Dest (0:figure-67) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1285 2231 a Black Black Fk(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2231 a
SDict begin H.S end
 3759 2231 a Fk(273)3885 2231 y
SDict begin 13 H.L end
 3885 2231
a 3885 2231 a
SDict begin [/Subtype /Link/Dest (0:figure-67) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2231 a Black 0 TeXcolorgray 396 2339
a
SDict begin H.S end
 396 2339 a Fk(5-6.)g(Clone)i(Client)f(Finite)h(State)g(Machine)1685
2339 y
SDict begin 13 H.L end
 1685 2339 a 1685 2339 a
SDict begin [/Subtype /Link/Dest (0:figure-68) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1685 2339 a Black Black
15 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2339 a
SDict begin H.S end
 3759 2339 a Fk(294)3885 2339 y
SDict begin 13 H.L end
 3885 2339
a 3885 2339 a
SDict begin [/Subtype /Link/Dest (0:figure-68) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2339 a Black 0 TeXcolorgray 396 2447
a
SDict begin H.S end
 396 2447 a Fk(5-7.)e(High-a)n(v)n(ailability)g(Clone)h(Serv)o(er)f(P)
o(air)1721 2447 y
SDict begin 13 H.L end
 1721 2447 a 1721 2447 a
SDict begin [/Subtype /Link/Dest (0:figure-69) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1721 2447 a
Black Black 20 w Fk(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2447 a
SDict begin H.S end
 3759 2447
a Fk(295)3885 2447 y
SDict begin 13 H.L end
 3885 2447 a 3885 2447 a
SDict begin [/Subtype /Link/Dest (0:figure-69) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2447
a Black 0 TeXcolorgray 396 2555 a
SDict begin H.S end
 396 2555 a Fk(6-1.)g(The)h('Start')g
(State)1097 2555 y
SDict begin 13 H.L end
 1097 2555 a 1097 2555 a
SDict begin [/Subtype /Link/Dest (0:figure-70) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1097 2555
a Black Black 1 w Fk(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black 0 TeXcolorgray 3759 2555 a
SDict begin H.S end
 3759 2555
a Fk(360)3885 2555 y
SDict begin 13 H.L end
 3885 2555 a 3885 2555 a
SDict begin [/Subtype /Link/Dest (0:figure-70) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2555
a Black 0 TeXcolorgray 396 2663 a
SDict begin H.S end
 396 2663 a Fk(6-2.)f(The)h
('Authenticated')e(State)1406 2663 y
SDict begin 13 H.L end
 1406 2663 a 1406
2663 a
SDict begin [/Subtype /Link/Dest (0:figure-71) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1406 2663 a Black Black 3 w Fk(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2663 a
SDict begin H.S end
 3759 2663 a Fk(360)3885 2663 y
SDict begin 13 H.L end
 3885 2663
a 3885 2663 a
SDict begin [/Subtype /Link/Dest (0:figure-71) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2663 a Black 0 TeXcolorgray 396 2771
a
SDict begin H.S end
 396 2771 a Fk(6-3.)h(The)h('Ready')f(State)1152 2771
y
SDict begin 13 H.L end
 1152 2771 a 1152 2771 a
SDict begin [/Subtype /Link/Dest (0:figure-72) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1152 2771 a Black Black 8 w
Fk(.)p Black Black(.)p Black Black(.)p Black Black -1
w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
0 TeXcolorgray 3759 2771 a
SDict begin H.S end
 3759 2771 a Fk(360)3885 2771
y
SDict begin 13 H.L end
 3885 2771 a 3885 2771 a
SDict begin [/Subtype /Link/Dest (0:figure-72) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2771 a Black 0 TeXcolorgray
396 2879 a
SDict begin H.S end
 396 2879 a Fk(8-1.)g(ZRE)i(disco)o(v)o(ery)d(message)1349
2879 y
SDict begin 13 H.L end
 1349 2879 a 1349 2879 a
SDict begin [/Subtype /Link/Dest (0:figure-73) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1349 2879 a Black Black
19 w Fk(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black Black
-1 w(.)p Black Black(.)p Black Black(.)p Black Black(.)p
Black Black -1 w(.)p Black Black(.)p Black Black(.)p
Black Black(.)p Black Black -1 w(.)p Black Black(.)p
Black Black(.)p Black Black(.)p Black Black -1 w(.)p
Black Black(.)p Black Black(.)p Black Black(.)p Black
Black -1 w(.)p Black Black(.)p Black Black(.)p Black
Black(.)p Black Black -1 w(.)p Black Black(.)p Black
Black(.)p Black Black(.)p Black Black -1 w(.)p Black
Black(.)p Black Black(.)p Black Black(.)p Black 0 TeXcolorgray
3759 2879 a
SDict begin H.S end
 3759 2879 a Fk(433)3885 2879 y
SDict begin 13 H.L end
 3885 2879
a 3885 2879 a
SDict begin [/Subtype /Link/Dest (0:figure-73) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3885 2879 a Black Black 3846 5569 a Ff(x)p
Black eop end
%%Page: 11 11
TeXDict begin 11 10 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.xi) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:69) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Preface)621 115 y
SDict begin H.S end
 621 115 a 621 115
a
SDict begin 26.957 H.A end
 621 115 a 621 115 a
SDict begin [/View [/XYZ H.V]/Dest (5.0) cvn /DEST pdfmark end
 621 115 a -2 337 a
SDict begin H.S end
 -2 337 a -2
337 a
SDict begin 13 H.A end
 -2 337 a -2 337 a
SDict begin [/View [/XYZ H.V]/Dest (0:71) cvn /DEST pdfmark end
 -2 337 a 396 443 a Fk(In)20 b(the)g(summer)g
(of)g(2010,)e(\330MQ)j(w)o(as)g(still)g(a)g(little-kno)n(wn)d(niche)i
(library)f(described)g(by)g(its)j(rather)d(terse)i(man)396
551 y(pages)f(and)g(a)g(li)n(ving)g(b)n(ut)g(sparse)g(wiki.)g(Martin)g
(Sustrik)g(and)g(myself)f(\(Pieter)i(Hintjens\))e(were)h(sitting)h(in)f
(the)g(bar)g(of)396 659 y(the)g(Hotel)g(K)n(yje)n(v)f(in)h(Bratisla)n
(v)n(a)h(planning)d(ho)n(w)h(to)h(mak)o(e)f(\330MQ)i(more)e(widely)g
(popular)-5 b(.)18 b(Martin)i(had)f(written)h(most)396
767 y(of)g(the)g(\330MQ)h(code,)e(and)h(I')l(d)f(put)h(up)g(the)g
(funding)e(and)i(or)o(ganized)d(the)j(community)-5 b(.)17
b(Ov)o(er)j(some)g(Zlaty)g(Bazants,)396 875 y(we)h(agreed)e(that)h
(\330MQ)h(needed)d(a)j(ne)n(w)-5 b(,)19 b(simpler)h(web)g(site,)h(and)f
(a)g(basic)h(guide)e(to)h(ne)n(w)g(users.)-2 1059 y
SDict begin H.S end
 -2
1059 a -2 1059 a
SDict begin 13 H.A end
 -2 1059 a -2 1059 a
SDict begin [/View [/XYZ H.V]/Dest (0:72) cvn /DEST pdfmark end
 -2 1059 a 396 1149
a Fk(Martin)g(collected)f(some)h(ideas)h(for)e(topics)h(to)h(e)o
(xplain.)e(I')l(d)g(ne)n(v)o(er)g(written)h(a)g(line)h(of)f(\330MQ)g
(code)f(before)g(this,)i(so)f(it)396 1256 y(became)g(a)g(li)n(v)o(e)g
(learning)f(documentary)-5 b(.)17 b(As)k(I)f(w)o(ork)o(ed)f(through)f
(simple)i(e)o(xamples)f(to)i(more)e(comple)o(x)f(ones)i(I)h(tried)396
1364 y(to)g(answer)e(man)o(y)g(of)h(the)h(questions)e(I')l(d)g(seen)i
(on)e(the)i(mailing)e(list.)i(Since)f(I')l(v)o(e)f(been)h(b)n(uilding)f
(lar)o(ge-scale)396 1472 y(architectures)g(for)h(30)g(years,)f(there)h
(were)g(a)h(lot)f(of)g(problems)f(I)h(w)o(as)h(k)o(een)f(to)g(thro)n(w)
f(\330MQ)i(at.)f(Amazingly)f(the)396 1580 y(results)h(were)g(mostly)g
(simple)f(and)h(ele)o(gant,)e(e)n(v)o(en)h(w)o(orking)f(in)i(C.)h(I)f
(felt)g(a)g(pure)f(jo)o(y)h(learning)e(\330MQ)i(and)g(using)f(it)i(to)
396 1688 y(solv)o(e)f(real)g(problems,)f(which)g(brought)f(me)j(back)e
(to)h(programming)d(after)j(a)h(fe)n(w)f(years')f(pause.)h(And)g
(often,)f(not)396 1796 y(kno)n(wing)g(ho)n(w)g(it)i(w)o(as)g
("supposed")e(to)h(be)g(done,)f(we)i(impro)o(v)o(ed)c(\330MQ)j(as)h(we)
g(went)f(along.)-2 1980 y
SDict begin H.S end
 -2 1980 a -2 1980 a
SDict begin 13 H.A end
 -2 1980
a -2 1980 a
SDict begin [/View [/XYZ H.V]/Dest (0:73) cvn /DEST pdfmark end
 -2 1980 a 396 2070 a Fk(From)g(the)g(start)h(I)f(w)o(anted)
g(the)g(Guide)g(to)g(be)g(a)h(community)d(project,)h(so)i(I)f(put)g(it)
h(onto)e(github)g(and)h(let)g(others)396 2178 y(contrib)n(ute)f(with)h
(pull)g(requests.)g(This)g(w)o(as)h(considered)e(a)h(radical,)g(e)n(v)o
(en)f(vulgar)f(approach)g(by)i(some.)g(W)-7 b(e)21 b(came)f(to)396
2286 y(a)h(di)n(vision)e(of)h(labor:)f(I')l(d)h(do)g(the)g(writing)f
(and)h(mak)o(e)g(the)g(original)f(C)i(e)o(xamples,)e(and)h(others)f(w)o
(ould)h(help)g(\002x)g(the)396 2394 y(te)o(xt)g(and)g(translate)g(the)g
(e)o(xamples)f(into)h(other)g(languages.)-2 2578 y
SDict begin H.S end
 -2
2578 a -2 2578 a
SDict begin 13 H.A end
 -2 2578 a -2 2578 a
SDict begin [/View [/XYZ H.V]/Dest (0:74) cvn /DEST pdfmark end
 -2 2578 a 396 2668
a Fk(This)h(w)o(ork)o(ed)e(better)h(than)f(I)i(dared)e(hope:)g(you)g
(can)h(no)n(w)g(\002nd)g(all)h(the)f(e)o(xamples)f(in)h(se)n(v)o(eral)g
(languages)f(and)g(man)o(y)396 2776 y(in)i(a)f(dozen)f(languages.)g
(It')-5 b(s)21 b(a)f(kind)g(of)g(programming)c(language)j(Rosetta)i
(stone)f(and)f(a)i(v)n(aluable)e(outcome)f(in)396 2884
y(itself.)j(W)-7 b(e)21 b(set-up)f(a)g(high-score:)f(reach)g(80\045)h
(translation)f(and)h(your)f(language)f(got)i(its)i(o)n(wn)d(Guide.)h
(PHP)-9 b(,)20 b(Python,)396 2992 y(Lua,)g(and)g(Hax)o(e)f(reached)g
(this)i(goal.)e(People)h(ask)o(ed)g(for)g(PDFs,)h(and)e(we)i(made)e
(that.)h(People)g(ask)o(ed)g(for)g(ebooks,)396 3100 y(and)g(got)g
(those.)g(About)f(a)h(hundred)e(people)h(contrib)n(uted)g(to)h(the)g
(Guide)g(to)g(date.)-2 3284 y
SDict begin H.S end
 -2 3284 a -2 3284 a
SDict begin 13 H.A end
 -2
3284 a -2 3284 a
SDict begin [/View [/XYZ H.V]/Dest (0:75) cvn /DEST pdfmark end
 -2 3284 a 396 3373 a Fk(The)g(Guide)g(achie)n(v)o(ed)e
(its)j(goal)f(of)g(popularizing)e(\330MQ.)i(The)g(style)g(pleases)h
(most)f(and)g(anno)o(ys)f(some,)g(which)h(is)396 3481
y(ho)n(w)g(it)h(should)e(be.)h(In)g(December)f(2010)f(my)i(w)o(ork)g
(on)g(\330MQ)g(and)g(the)g(Guide)g(stopped,)e(as)j(I)g(found)d(myself)i
(going)396 3589 y(through)e(late-stage)i(cancer)m(,)f(hea)n(vy)g(sur)o
(gery)-5 b(,)18 b(and)i(six)g(months)f(of)h(chemotherap)o(y)-5
b(.)17 b(When)j(I)g(pick)o(ed)g(up)f(w)o(ork)h(again)396
3697 y(in)h(mid-2011,)c(it)k(w)o(as)g(to)f(start)h(using)f(\330MQ)g(in)
g(anger)g(for)f(one)h(of)g(the)g(lar)o(gest)f(use-cases)i(imagineable:)
d(on)i(the)396 3805 y(mobile)g(phones)f(and)g(tablets)i(of)f(the)g(w)o
(orld')-5 b(s)20 b(biggest)f(electronics)h(compan)o(y)-5
b(.)-2 3989 y
SDict begin H.S end
 -2 3989 a -2 3989 a
SDict begin 13 H.A end
 -2 3989 a -2 3989 a
SDict begin [/View [/XYZ H.V]/Dest (0:76) cvn /DEST pdfmark end

-2 3989 a 396 4079 a Fk(But)21 b(the)f(goal)g(of)g(the)g(Guide)g(w)o
(as,)g(from)g(the)g(start,)g(a)h(printed)e(book.)f(So)j(it)g(w)o(as)g
(e)o(xciting)e(to)h(get)g(an)g(email)h(from)e(Bill)396
4187 y(Lubano)o(vic)f(in)i(January)f(2012)g(introducing)f(me)i(to)g
(his)h(editor)e(Andy)g(Oram)h(at)h(O'Reilly)-5 b(,)20
b(suggesting)e(a)j(\330MQ)396 4295 y(book.)d(Of)h(course!)g(Where)g(do)
g(I)g(sign?)h(Ho)n(w)f(much)f(do)h(I)h(ha)n(v)o(e)e(to)i(pay?)f(Oh,)g
(I)2720 4295 y
SDict begin H.S end
 2720 4295 a 2720 4295 a
SDict begin 13 H.A end
 2720 4295 a 2720
4295 a
SDict begin [/View [/XYZ H.V]/Dest (0:77) cvn /DEST pdfmark end
 2720 4295 a Ff(g)o(et)h(mone)n(y)e Fk(for)h(this?)g(All)h(I)g
(ha)n(v)o(e)f(to)g(do)396 4403 y(is)i(\002nish)g(it?)-2
4570 y
SDict begin H.S end
 -2 4570 a -2 4570 a
SDict begin 13 H.A end
 -2 4570 a -2 4570 a
SDict begin [/View [/XYZ H.V]/Dest (0:78) cvn /DEST pdfmark end
 -2 4570
a 396 4677 a Fk(Of)g(course)e(as)i(soon)f(as)g(O'Reilly)h(announced)c
(a)k(\330MQ)f(book,)f(other)g(publishers)g(started)h(sending)f(out)h
(emails)h(to)396 4785 y(potential)e(authors.)f(Y)-9 b(ou')o(ll)19
b(probably)f(see)i(a)g(rash)g(of)f(\330MQ)h(books)f(coming)f(out)h(ne)o
(xt)g(year)-5 b(.)19 b(That')-5 b(s)20 b(good:)e(our)h(niche)396
4893 y(library)g(has)i(hit)f(the)g(mainstream)g(and)f(deserv)o(es)h
(its)h(six)f(inches)g(of)g(shelf)g(space.)g(My)g(apologies)f(to)i(the)f
(other)f(\330MQ)396 5001 y(authors:)h(we')l(v)o(e)f(set)i(the)f(bar)g
(horribly)e(high,)h(and)h(my)g(advice)f(is)i(to)f(mak)o(e)g(your)f
(books)g(complimentary)-5 b(.)17 b(Perhaps)396 5109 y(focus)j(on)g(a)g
(speci\002c)h(language,)d(platform,)g(or)i(pattern.)p
Black 3823 5569 a Ff(xi)p Black eop end
%%Page: 12 12
TeXDict begin 12 11 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.xii) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3628 -132 a Ff(Pr)m(eface)p Black -2 -11 a
SDict begin H.S end
 -2 -11
a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:79) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(This)21
b(is)g(the)f(magic)g(and)f(po)n(wer)g(of)h(communities:)f(be)h(the)g
(\002rst)h(community)d(in)j(a)f(space,)g(stay)h(healthy)-5
b(,)18 b(and)i(you)396 180 y(o)n(wn)g(that)g(space)g(for)g(e)n(v)o(er)
-5 b(.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:80) cvn /DEST pdfmark end
 -2
198 a 360 x Fn(1.)39 b(A)l(udience)801 558 y
SDict begin H.S end
 801 558
a 801 558 a
SDict begin 22.464 H.A end
 801 558 a 801 558 a
SDict begin [/View [/XYZ H.V]/Dest (5.1.1) cvn /DEST pdfmark end
 801 558 a -2 725 a
SDict begin H.S end
 -2
725 a -2 725 a
SDict begin 13 H.A end
 -2 725 a -2 725 a
SDict begin [/View [/XYZ H.V]/Dest (0:82) cvn /DEST pdfmark end
 -2 725 a 396 831 a Fk(This)21
b(book)d(is)k(written)e(for)f(professional)g(programmers)e(who)j(w)o
(ant)g(to)g(learn)g(ho)n(w)g(to)g(mak)o(e)g(the)g(massi)n(v)o(ely)396
939 y(distrib)n(uted)g(softw)o(are)f(that)i(will)g(dominate)d(the)i
(future)f(of)h(computing.)e(W)-7 b(e)21 b(assume)g(you)e(can)h(read)g
(C)h(code,)396 1047 y(because)f(most)g(of)g(the)g(e)o(xamples)f(here)h
(are)g(in)g(C)h(e)n(v)o(en)f(though)e(\330MQ)i(is)i(used)e(in)g(man)o
(y)f(languages.)f(W)-7 b(e)22 b(assume)396 1155 y(you)e(care)g(about)f
(scale,)h(because)g(\330MQ)g(solv)o(es)g(that)h(problem)d(abo)o(v)o(e)h
(all)h(others.)g(W)-7 b(e)21 b(assume)f(you)g(need)f(the)h(best)396
1263 y(possible)g(results)h(with)f(the)g(least)h(possible)f(cost,)g
(because)g(otherwise)f(you)h(w)o(on')o(t)f(appreciate)g(the)h(trade-of)
n(fs)e(that)396 1371 y(\330MQ)j(mak)o(es.)f(Other)f(than)h(that)g
(basic)h(background,)16 b(we)21 b(try)f(to)g(present)g(all)g(the)h
(concepts)e(in)h(netw)o(orking)e(and)396 1479 y(distrib)n(uted)i
(computing)d(you)j(will)h(need)e(to)i(use)f(\330MQ.)-2
1507 y
SDict begin H.S end
 -2 1507 a -2 1507 a
SDict begin 13 H.A end
 -2 1507 a -2 1507 a
SDict begin [/View [/XYZ H.V]/Dest (0:83) cvn /DEST pdfmark end
 -2 1507
a 360 x Fn(2.)39 b(Con)-6 b(ventions)37 b(Used)i(in)g(This)g(Book)2313
1867 y
SDict begin H.S end
 2313 1867 a 2313 1867 a
SDict begin 22.464 H.A end
 2313 1867 a 2313 1867
a
SDict begin [/View [/XYZ H.V]/Dest (5.2.1) cvn /DEST pdfmark end
 2313 1867 a -2 2034 a
SDict begin H.S end
 -2 2034 a -2 2034 a
SDict begin 13 H.A end
 -2 2034 a
-2 2034 a
SDict begin [/View [/XYZ H.V]/Dest (0:85) cvn /DEST pdfmark end
 -2 2034 a 396 2141 a Fk(W)-7 b(e)22 b(tried)e(to)g(be)g(as)h
(uncon)m(v)o(entional)16 b(as)21 b(possible.)-2 2169
y
SDict begin H.S end
 -2 2169 a -2 2169 a
SDict begin 13 H.A end
 -2 2169 a -2 2169 a
SDict begin [/View [/XYZ H.V]/Dest (0:86) cvn /DEST pdfmark end
 -2 2169 a 359
x Fn(3.)39 b(Using)g(the)g(Code)f(Examples)1921 2528
y
SDict begin H.S end
 1921 2528 a 1921 2528 a
SDict begin 22.464 H.A end
 1921 2528 a 1921 2528 a
SDict begin [/View [/XYZ H.V]/Dest (5.3.1) cvn /DEST pdfmark end
 1921
2528 a -2 2726 a
SDict begin H.S end
 -2 2726 a -2 2726 a
SDict begin 13 H.A end
 -2 2726 a -2 2726
a
SDict begin [/View [/XYZ H.V]/Dest (0:88) cvn /DEST pdfmark end
 -2 2726 a 396 2802 a Fk(The)20 b(code)g(e)o(xamples)f(are)h(all)h
(online)e(in)h(the)g(Guide)g(repository)f(at)396 2910
y(https://github)m(.com/imatix/zguide/tree/m)o(aster/e)o(x)o(amp)o
(les/.)c(Y)-9 b(ou')o(ll)20 b(\002nd)g(each)g(e)o(xample)e(translated)i
(into)g(se)n(v)o(eral,)396 3018 y(often)g(a)g(dozen)f(other)h
(languages.)e(The)i(e)o(xamples)f(are)h(licensed)g(under)f(MIT/X11;)g
(see)i(the)f(LICENSE)g(\002le)h(in)f(that)396 3126 y(directory)-5
b(.)18 b(The)i(te)o(xt)g(of)g(the)g(Guide)g(e)o(xplains)f(in)h(each)g
(case)h(ho)n(w)e(to)i(run)e(each)h(e)o(xample.)-2 3154
y
SDict begin H.S end
 -2 3154 a -2 3154 a
SDict begin 13 H.A end
 -2 3154 a -2 3154 a
SDict begin [/View [/XYZ H.V]/Dest (0:89) cvn /DEST pdfmark end
 -2 3154 a 359
x Fn(4.)39 b(Ac)m(kno)n(wledg)q(ements)1505 3513 y
SDict begin H.S end
 1505
3513 a 1505 3513 a
SDict begin 22.464 H.A end
 1505 3513 a 1505 3513 a
SDict begin [/View [/XYZ H.V]/Dest (5.4.1) cvn /DEST pdfmark end
 1505 3513
a -2 3711 a
SDict begin H.S end
 -2 3711 a -2 3711 a
SDict begin 13 H.A end
 -2 3711 a -2 3711 a
SDict begin [/View [/XYZ H.V]/Dest (0:91) cvn /DEST pdfmark end
 -2
3711 a 396 3787 a Fk(Thanks)19 b(to)i(Andy)e(Oram)h(for)f(making)g
(this)i(happen)d(in)j(O'Reilly)f(and)g(editing)f(the)h(book.)-2
3971 y
SDict begin H.S end
 -2 3971 a -2 3971 a
SDict begin 13 H.A end
 -2 3971 a -2 3971 a
SDict begin [/View [/XYZ H.V]/Dest (0:92) cvn /DEST pdfmark end
 -2 3971
a 396 4061 a Fk(Thanks)f(to)i(Bill)g(Desmarais,)f(Brian)g(Dorse)o(y)-5
b(,)19 b(Daniel)h(Lin,)g(Eric)g(Desgranges,)f(Gonzalo)g(Diethelm,)g
(Guido)396 4169 y(Goldstein,)h(Hunter)f(F)o(ord,)g(Kamil)h(Shakiro)o(v)
-5 b(,)18 b(Martin)i(Sustrik,)g(Mik)o(e)g(Castleman,)g(Na)n(v)o(een)f
(Cha)o(wla,)h(Nicola)396 4277 y(Peduzzi,)g(Oli)n(v)o(er)f(Smith,)h(Oli)
n(vier)g(Chamoux,)e(Peter)j(Ale)o(xander)m(,)c(Pierre)j(Rouleau,)g
(Randy)f(Dryb)n(ur)o(gh,)e(John)396 4385 y(Unwin,)j(Ale)o(x)g(Thomas,)f
(Mihail)h(Mink)o(o)o(v)-5 b(,)18 b(Jeremy)h(A)-6 b(vnet,)20
b(Michael)f(Compton,)g(Kamil)h(Kisiel,)h(Mark)396 4493
y(Kharitono)o(v)-5 b(,)17 b(Guillaume)j(Aubert,)f(Ian)g(Barber)m(,)g
(Mik)o(e)i(Sheridan,)d(F)o(aruk)i(Akgul,)f(Ole)o(g)g(Sidoro)o(v)-5
b(,)18 b(Le)n(v)i(Gi)n(v)n(on,)396 4601 y(Allister)h(MacLeod,)e(Ale)o
(xander)f(D'Archangel,)g(Andreas)h(Hoelzl)o(wimmer)m(,)g(Han)h(Holl,)g
(Robert)g(G.)g(Jakabosk)o(y)-5 b(,)396 4709 y(Felipe)21
b(Cruz,)e(Marcus)h(McCurdy)-5 b(,)19 b(Mikhail)g(K)o(ulemin,)g(Dr)-5
b(.)21 b(Ger)o(g\366)d(\311rdi,)i(P)o(a)n(v)o(el)g(Zhuk)o(o)o(v)-5
b(,)17 b(Ale)o(xander)i(Else,)396 4817 y(Gio)o(v)n(anni)g(Ruggiero,)f
(Rick)j("T)-6 b(echno)n(weenie",)17 b(Daniel)j(Lundin,)f(Da)n(v)o(e)h
(Hoo)o(v)o(er)m(,)d(Simon)j(Jef)n(ford,)f(Benjamin)396
4925 y(Peterson,)h(Justin)g(Case,)h(De)n(v)n(on)e(W)-7
b(eller)m(,)21 b(Richard)f(Smith,)f(Ale)o(xander)g(Morland,)f(W)-7
b(adim)21 b(Grasza,)f(Michael)g(Jakl,)396 5033 y(Uwe)h(Dauernheim,)d
(Sebastian)i(No)n(wicki,)f(Simone)g(Deponti,)g(Aaron)h(Raddon,)e(Dan)j
(Colish,)f(Markus)f(Schirp,)396 5141 y(Benoit)h(Larroque,)e(Jonathan)h
(P)o(alardy)-5 b(,)19 b(Isaiah)h(Peng,)f(Arkadiusz)g(Orzecho)n(wski,)g
(Umut)g(A)-8 b(ydin,)20 b(Matthe)n(w)p Black 3800 5569
a Ff(xii)p Black eop end
%%Page: 13 13
TeXDict begin 13 12 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.xiii) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3628 -132 a Ff(Pr)m(eface)p Black 396 72 a Fk(Horsf)o(all,)20
b(Jeremy)g(W)-8 b(.)21 b(Sherman,)d(Eric)i(Pugh,)g(T)-7
b(yler)20 b(Sellon,)f(John)h(E.)g(V)-5 b(incent,)20 b(P)o(a)n(v)o(el)g
(Mitin,)g(Min)g(RK,)h(Igor)396 180 y(W)m(iedler)m(,)f(Olof)f(\305k)o
(esson,)h(P)o(atrick)g(Lucas,)g(Heo)n(w)f(Goodman,)f(Senthil)i(P)o
(alanisami,)g(John)g(Gallagher)m(,)e(T)-7 b(omas)396
288 y(Roos,)20 b(Stephen)g(McQuay)-5 b(,)18 b(Erik)i(Allik,)g(Arnaud)f
(Cogolu\350gnes,)f(Rob)i(Gagnon,)f(Dan)h(W)m(illiams,)g(Edw)o(ard)f
(Smith,)396 396 y(James)i(T)l(uck)o(er)m(,)e(Kristian)h(Kristensen,)g
(V)-9 b(adim)19 b(Shalts,)i(Martin)e(T)m(rojer)m(,)g(T)-7
b(om)20 b(v)n(an)g(Leeuwen,)e(P)o(andya)h(Hiten,)h(Harm)396
504 y(Aarts,)h(Marc)f(Harter)m(,)f(Iskren)g(Iv)n(o)o(v)g(Cherne)n(v)-5
b(,)18 b(Jay)j(Han,)f(Sonia)f(Hamilton,)h(Nathan)f(Stocks,)h(Na)n(v)o
(een)f(P)o(alli,)i(and)396 612 y(Zed)f(Sha)o(w)g(for)g(their)g(contrib)
n(utions.)-2 779 y
SDict begin H.S end
 -2 779 a -2 779 a
SDict begin 13 H.A end
 -2 779 a -2 779
a
SDict begin [/View [/XYZ H.V]/Dest (0:93) cvn /DEST pdfmark end
 -2 779 a 396 886 a Fk(Thanks)f(to)i(Stathis)g(Sideris)f(for)1363
886 y
SDict begin H.S end
 1363 886 a 1363 886 a
SDict begin 13 H.A end
 1363 886 a 1363 886 a
SDict begin [/View [/XYZ H.V]/Dest (0:94) cvn /DEST pdfmark end
 1363
886 a Fk(Ditaa)g(\(http://www)-5 b(.ditaa.or)o(g\).)-2
1070 y
SDict begin H.S end
 -2 1070 a -2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:95) cvn /DEST pdfmark end
 -2 1070
a 396 1160 a Fk(And)20 b(\002nally)-5 b(,)19 b(thanks)h(to)g(Allen)g
(Ding,)g(Mikk)o(o)f(K)m(oppanen,)f(and)i(y'all)g(in)g(Dallas)h(for)e
(your)g(support.)p Black 3777 5569 a Ff(xiii)p Black
eop end
%%Page: 1 14
TeXDict begin 1 13 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.1) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:96) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(1.)f(Basic)h(Stuff)1786
115 y
SDict begin H.S end
 1786 115 a 1786 115 a
SDict begin 26.957 H.A end
 1786 115 a 1786 115 a
SDict begin [/View [/XYZ H.V]/Dest (6.0) cvn /DEST pdfmark end
 1786
115 a -2 204 a
SDict begin H.S end
 -2 204 a -2 204 a
SDict begin 13 H.A end
 -2 204 a -2 204 a
SDict begin [/View [/XYZ H.V]/Dest (0:98) cvn /DEST pdfmark end
 -2
204 a 342 x Fn(1.1.)39 b(Fixing)f(the)h(W)-9 b(orld)1392
546 y
SDict begin H.S end
 1392 546 a 1392 546 a
SDict begin 22.464 H.A end
 1392 546 a 1392 546 a
SDict begin [/View [/XYZ H.V]/Dest (6.5.1) cvn /DEST pdfmark end
 1392
546 a -2 744 a
SDict begin H.S end
 -2 744 a -2 744 a
SDict begin 13 H.A end
 -2 744 a -2 744 a
SDict begin [/View [/XYZ H.V]/Dest (0:100) cvn /DEST pdfmark end
 -2
744 a 396 820 a Fk(Ho)n(w)20 b(to)h(e)o(xplain)e(\330MQ?)h(Some)g(of)g
(us)g(start)h(by)f(saying)f(all)i(the)f(w)o(onderful)e(things)i(it)h
(does.)3148 820 y
SDict begin H.S end
 3148 820 a 3148 820 a
SDict begin 13 H.A end
 3148 820 a 3148
820 a
SDict begin [/View [/XYZ H.V]/Dest (0:101) cvn /DEST pdfmark end
 3148 820 a Ff(It')m(s)f(soc)n(k)o(ets)h(on)396
928 y(ster)l(oids.)f(It')m(s)f(lik)o(e)h(mailboxes)f(with)h(r)l(outing)
o(.)e(It')m(s)h(fast!)h Fk(Others)f(try)g(to)h(share)f(their)g(moment)f
(of)h(enlightenment,)e(that)396 1036 y(zap-po)n(w-kaboom)f(satori)k
(paradigm-shift)e(moment)h(when)g(it)i(all)g(became)e(ob)o(vious.)2952
1036 y
SDict begin H.S end
 2952 1036 a 2952 1036 a
SDict begin 13 H.A end
 2952 1036 a 2952 1036
a
SDict begin [/View [/XYZ H.V]/Dest (0:102) cvn /DEST pdfmark end
 2952 1036 a Ff(Things)h(just)h(become)e(simpler)-9
b(.)396 1144 y(Comple)n(xity)21 b(goes)e(away)-5 b(.)21
b(It)f(opens)g(the)g(mind.)f Fk(Others)h(try)g(to)h(e)o(xplain)e(by)g
(comparison.)3031 1144 y
SDict begin H.S end
 3031 1144 a 3031 1144 a
SDict begin 13 H.A end
 3031
1144 a 3031 1144 a
SDict begin [/View [/XYZ H.V]/Dest (0:103) cvn /DEST pdfmark end
 3031 1144 a Ff(It')m(s)h(smaller)-9
b(,)21 b(simpler)-9 b(,)20 b(b)n(ut)396 1252 y(still)i(looks)e
(familiar)-9 b(.)20 b Fk(Personally)-5 b(,)18 b(I)j(lik)o(e)f(to)g
(remember)f(why)g(we)i(made)e(\330MQ)i(at)f(all,)h(because)e(that')-5
b(s)21 b(most)f(lik)o(ely)396 1360 y(where)g(you,)f(the)h(reader)m(,)f
(still)i(are)f(today)-5 b(.)-2 1544 y
SDict begin H.S end
 -2 1544 a -2 1544
a
SDict begin 13 H.A end
 -2 1544 a -2 1544 a
SDict begin [/View [/XYZ H.V]/Dest (0:104) cvn /DEST pdfmark end
 -2 1544 a 396 1634 a Fk(Programming)18
b(is)j(a)f(science)g(dressed)g(up)g(as)h(art,)f(because)g(most)g(of)g
(us)g(don')o(t)f(understand)f(the)i(physics)f(of)h(softw)o(are,)396
1741 y(and)g(it')-5 b(s)21 b(rarely)f(if)g(e)n(v)o(er)f(taught.)g(The)h
(physics)g(of)g(softw)o(are)f(is)i(not)f(algorithms,)f(data)h
(structures,)f(languages)g(and)396 1849 y(abstractions.)g(These)h(are)g
(just)h(tools)f(we)h(mak)o(e,)f(use,)g(thro)n(w)f(a)o(w)o(ay)-5
b(.)19 b(The)h(real)g(physics)g(of)g(softw)o(are)f(is)j(the)e(physics)
396 1957 y(of)g(people.)-2 2141 y
SDict begin H.S end
 -2 2141 a -2 2141 a
SDict begin 13 H.A end

-2 2141 a -2 2141 a
SDict begin [/View [/XYZ H.V]/Dest (0:105) cvn /DEST pdfmark end
 -2 2141 a 396 2231 a Fk(Speci\002cally)-5
b(,)19 b(our)h(limitations)g(when)f(it)i(comes)f(to)h(comple)o(xity)-5
b(,)17 b(and)j(our)f(desire)h(to)g(w)o(ork)g(together)f(to)h(solv)o(e)g
(lar)o(ge)396 2339 y(problems)f(in)h(pieces.)g(This)h(is)g(the)f
(science)g(of)g(programming:)d(mak)o(e)j(b)n(uilding)e(blocks)i(that)g
(people)f(can)396 2447 y(understand)f(and)i(use)1053
2447 y
SDict begin H.S end
 1053 2447 a 1053 2447 a
SDict begin 13 H.A end
 1053 2447 a 1053 2447
a
SDict begin [/View [/XYZ H.V]/Dest (0:106) cvn /DEST pdfmark end
 1053 2447 a Ff(easily)p Fk(,)h(and)e(people)g(will)i(w)o(ork)f
(together)f(to)h(solv)o(e)g(the)g(v)o(ery)f(lar)o(gest)h(problems.)-2
2631 y
SDict begin H.S end
 -2 2631 a -2 2631 a
SDict begin 13 H.A end
 -2 2631 a -2 2631 a
SDict begin [/View [/XYZ H.V]/Dest (0:107) cvn /DEST pdfmark end
 -2 2631
a 396 2721 a Fk(W)-7 b(e)22 b(li)n(v)o(e)e(in)g(a)h(connected)d(w)o
(orld,)h(and)h(modern)e(softw)o(are)i(has)g(to)h(na)n(vigate)e(this)h
(w)o(orld.)g(So)g(the)g(b)n(uilding)f(blocks)h(for)396
2829 y(tomorro)n(w')-5 b(s)19 b(v)o(ery)g(lar)o(gest)g(solutions)h(are)
g(connected)e(and)i(massi)n(v)o(ely)g(parallel.)f(It')-5
b(s)21 b(not)f(enough)e(for)i(code)f(to)h(be)396 2937
y("strong)f(and)h(silent")h(an)o(y)e(more.)g(Code)h(has)h(to)f(talk)g
(to)h(code.)e(Code)h(has)g(to)h(be)f(chatty)-5 b(,)19
b(sociable,)g(well-connected.)396 3045 y(Code)h(has)h(to)f(run)f(lik)o
(e)i(the)f(human)f(brain,)g(trillions)h(of)g(indi)n(vidual)e(neurons)h
(\002ring)h(of)n(f)f(messages)i(to)f(each)g(other)m(,)e(a)396
3153 y(massi)n(v)o(ely)h(parallel)h(netw)o(ork)e(with)i(no)f(central)h
(control,)e(no)h(single)h(point)f(of)g(f)o(ailure,)g(yet)h(able)g(to)f
(solv)o(e)h(immensely)396 3261 y(dif)n(\002cult)g(problems.)e(And)i
(it')-5 b(s)21 b(no)f(accident)g(that)g(the)g(future)f(of)h(code)f
(looks)h(lik)o(e)h(the)f(human)f(brain,)g(because)g(the)396
3369 y(endpoints)g(of)h(e)n(v)o(ery)f(netw)o(ork)g(are,)g(at)i(some)f
(le)n(v)o(el,)g(human)f(brains.)-2 3553 y
SDict begin H.S end
 -2 3553 a -2
3553 a
SDict begin 13 H.A end
 -2 3553 a -2 3553 a
SDict begin [/View [/XYZ H.V]/Dest (0:108) cvn /DEST pdfmark end
 -2 3553 a 396 3643 a Fk(If)h(you')l(v)o(e)e
(done)h(an)o(y)h(w)o(ork)f(with)i(threads,)e(protocols,)f(or)i(netw)o
(orks,)f(you')o(ll)h(realize)g(this)g(is)i(pretty)d(much)396
3751 y(impossible.)h(It')-5 b(s)20 b(a)h(dream.)e(Ev)o(en)g(connecting)
f(a)j(fe)n(w)f(programs)e(across)j(a)f(fe)n(w)g(sock)o(ets)h(is)g
(plain)f(nasty)-5 b(,)19 b(when)g(you)396 3859 y(start)i(to)f(handle)f
(real)i(life)f(situations.)g(T)m(rillions?)g(The)f(cost)i(w)o(ould)e
(be)i(unimaginable.)c(Connecting)i(computers)f(is)396
3966 y(so)j(dif)n(\002cult)e(that)i(softw)o(are)e(and)h(services)g(to)h
(do)e(this)i(is)g(a)g(multi-billion)d(dollar)i(b)n(usiness.)-2
4133 y
SDict begin H.S end
 -2 4133 a -2 4133 a
SDict begin 13 H.A end
 -2 4133 a -2 4133 a
SDict begin [/View [/XYZ H.V]/Dest (0:109) cvn /DEST pdfmark end
 -2 4133
a 396 4240 a Fk(So)h(we)f(li)n(v)o(e)g(in)h(a)f(w)o(orld)g(where)f(the)
i(wiring)e(is)i(years)f(ahead)g(of)f(our)h(ability)g(to)g(use)h(it.)f
(W)-7 b(e)22 b(had)d(a)i(softw)o(are)f(crisis)h(in)396
4348 y(the)f(1980s,)f(when)h(leading)f(softw)o(are)h(engineers)f(lik)o
(e)h(Fred)g(Brooks)g(belie)n(v)o(ed)2745 4348 y
SDict begin H.S end
 2745
4348 a 2745 4348 a
SDict begin 13 H.A end
 2745 4348 a 2745 4348 a
SDict begin [/View [/XYZ H.V]/Dest (0:110) cvn /DEST pdfmark end
 2745 4348
a Fk(there)g(w)o(as)h(no)f("Silv)o(er)g(Bullet")396 4456
y(\(http://en.wikipedia.or)o(g/wiki/No_Silv)n(er_)o(Bullet\))15
b(to)20 b("promise)f(e)n(v)o(en)g(one)h(order)f(of)h(magnitude)e(of)396
4564 y(impro)o(v)o(ement)f(in)k(producti)n(vity)-5 b(,)17
b(reliability)-5 b(,)19 b(or)g(simplicity".)-2 4748 y
SDict begin H.S end

-2 4748 a -2 4748 a
SDict begin 13 H.A end
 -2 4748 a -2 4748 a
SDict begin [/View [/XYZ H.V]/Dest (0:111) cvn /DEST pdfmark end
 -2 4748 a 396
4838 a Fk(Brooks)h(missed)g(free)g(and)g(open)f(source)g(softw)o(are,)h
(which)f(solv)o(ed)h(that)g(crisis,)h(enabling)d(us)j(to)f(share)g(kno)
n(wledge)396 4946 y(ef)n(\002ciently)-5 b(.)19 b(T)-7
b(oday)19 b(we)h(f)o(ace)g(another)e(softw)o(are)i(crisis,)g(b)n(ut)g
(it')-5 b(s)21 b(one)f(we)g(don')o(t)e(talk)i(about)f(much.)g(Only)h
(the)g(lar)o(gest,)396 5054 y(richest)g(\002rms)h(can)f(af)n(ford)e(to)
j(create)f(connected)e(applications.)h(There)g(is)i(a)g(cloud,)e(b)n
(ut)h(it')-5 b(s)21 b(proprietary)-5 b(.)17 b(Our)j(data,)p
Black -2 5569 a
SDict begin H.S end
 -2 5569 a -2 5569 a
SDict begin 13 H.A end
 -2 5569 a -2 5569
a
SDict begin [/View [/XYZ H.V]/Dest (0:112) cvn /DEST pdfmark end
 -2 5569 a 3842 5638 a Ff(1)p Black eop end
%%Page: 2 15
TeXDict begin 2 14 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.2) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fk(our)g(kno)n(wledge)e(is)j(disappearing)d(from)h(our)g
(personal)g(computers)g(into)h(clouds)f(that)i(we)f(cannot)f(access,)i
(cannot)396 180 y(compete)e(with.)h(Who)h(o)n(wns)f(our)f(social)h
(netw)o(orks?)g(It)g(is)h(lik)o(e)g(the)f(mainframe-PC)e(re)n(v)n
(olution)h(in)h(re)n(v)o(erse.)396 454 y(W)-7 b(e)22
b(can)e(lea)n(v)o(e)g(the)g(political)g(philosophy)d(for)j(another)e
(book)h(\(http://swsi.info\).)g(The)g(point)h(is)h(that)f(while)g(the)
396 562 y(Internet)f(of)n(fers)f(the)i(potential)e(of)i(massi)n(v)o
(ely)f(connected)e(code,)i(the)g(reality)h(is)g(that)g(this)g(is)g(out)
f(of)h(reach)f(for)f(most)i(of)396 670 y(us,)h(and)e(so,)i(lar)o(ge)e
(interesting)g(problems)g(\(in)h(health,)f(education,)f(economics,)h
(transport,)g(and)g(so)i(on\))e(remain)396 778 y(unsolv)o(ed)g(because)
g(there)h(is)h(no)f(w)o(ay)g(to)g(connect)f(the)h(code,)g(and)f(thus)h
(no)g(w)o(ay)h(to)f(connect)f(the)h(brains)g(that)g(could)396
886 y(w)o(ork)g(together)f(to)h(solv)o(e)g(these)g(problems.)-2
1070 y
SDict begin H.S end
 -2 1070 a -2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:114) cvn /DEST pdfmark end
 -2 1070
a 396 1160 a Fk(There)g(ha)n(v)o(e)f(been)h(man)o(y)f(attempts)h(to)g
(solv)o(e)g(the)g(challenge)f(of)h(connected)e(softw)o(are.)i(There)f
(are)h(thousands)f(of)396 1268 y(IETF)h(speci\002cations,)f(each)g
(solving)g(part)g(of)g(the)h(puzzle.)e(F)o(or)i(application)e(de)n(v)o
(elopers,)f(HTTP)j(is)g(perhaps)f(the)g(one)396 1376
y(solution)h(to)g(ha)n(v)o(e)g(been)f(simple)h(enough)e(to)j(w)o(ork,)e
(b)n(ut)h(it)h(ar)o(guably)d(mak)o(es)i(the)g(problem)f(w)o(orse,)h(by)
f(encouraging)396 1484 y(de)n(v)o(elopers)f(and)i(architects)g(to)g
(think)g(in)g(terms)g(of)g(big)g(serv)o(ers)g(and)f(thin,)h(stupid)g
(clients.)-2 1668 y
SDict begin H.S end
 -2 1668 a -2 1668 a
SDict begin 13 H.A end
 -2 1668 a -2
1668 a
SDict begin [/View [/XYZ H.V]/Dest (0:115) cvn /DEST pdfmark end
 -2 1668 a 396 1758 a Fk(So)h(today)e(people)g(are)h(still)i
(connecting)c(applications)h(using)g(ra)o(w)h(UDP)h(and)f(TCP)-9
b(,)20 b(proprietary)e(protocols,)g(HTTP)-9 b(,)396 1866
y(W)i(ebsock)o(ets.)20 b(It)h(remains)f(painful,)e(slo)n(w)-5
b(,)20 b(hard)f(to)i(scale,)f(and)g(essentially)g(centralized.)f
(Distrib)n(uted)h(P2P)396 1974 y(architectures)f(are)h(mostly)g(for)g
(play)-5 b(,)19 b(not)h(w)o(ork.)f(Ho)n(w)h(man)o(y)f(applications)g
(use)h(Sk)o(ype)f(or)h(Bittorrent)g(to)g(e)o(xchange)396
2082 y(data?)-2 2248 y
SDict begin H.S end
 -2 2248 a -2 2248 a
SDict begin 13 H.A end
 -2 2248 a
-2 2248 a
SDict begin [/View [/XYZ H.V]/Dest (0:116) cvn /DEST pdfmark end
 -2 2248 a 396 2356 a Fk(Which)g(brings)g(us)g(back)g(to)g
(the)g(science)g(of)g(programming.)d(T)-7 b(o)20 b(\002x)h(the)f(w)o
(orld,)f(we)i(needed)e(to)h(do)g(tw)o(o)g(things.)g(One,)396
2464 y(to)h(solv)o(e)e(the)i(general)e(problem)f(of)i("ho)n(w)g(to)g
(connect)f(an)o(y)g(code)h(to)g(an)o(y)f(code,)h(an)o(ywhere".)e(T)-7
b(w)o(o,)20 b(to)g(wrap)g(that)g(up)396 2571 y(in)h(the)f(simplest)g
(possible)g(b)n(uilding)f(blocks)h(that)g(people)f(could)g(understand)f
(and)i(use)2977 2571 y
SDict begin H.S end
 2977 2571 a 2977 2571 a
SDict begin 13 H.A end
 2977 2571
a 2977 2571 a
SDict begin [/View [/XYZ H.V]/Dest (0:117) cvn /DEST pdfmark end
 2977 2571 a Ff(easily)p Fk(.)-2 2755 y
SDict begin H.S end

-2 2755 a -2 2755 a
SDict begin 13 H.A end
 -2 2755 a -2 2755 a
SDict begin [/View [/XYZ H.V]/Dest (0:118) cvn /DEST pdfmark end
 -2 2755 a 396
2845 a Fk(It)h(sounds)e(ridiculously)g(simple.)g(And)h(maybe)f(it)i
(is.)g(That')-5 b(s)20 b(kind)g(of)g(the)g(whole)g(point.)-2
2874 y
SDict begin H.S end
 -2 2874 a -2 2874 a
SDict begin 13 H.A end
 -2 2874 a -2 2874 a
SDict begin [/View [/XYZ H.V]/Dest (0:119) cvn /DEST pdfmark end
 -2 2874
a 359 x Fn(1.2.)39 b(\330MQ)g(in)g(a)h(Hundred)d(W)-9
b(or)m(ds)2011 3233 y
SDict begin H.S end
 2011 3233 a 2011 3233 a
SDict begin 22.464 H.A end
 2011 3233
a 2011 3233 a
SDict begin [/View [/XYZ H.V]/Dest (6.6.1) cvn /DEST pdfmark end
 2011 3233 a -2 3406 a
SDict begin H.S end
 -2 3406 a -2 3406
a
SDict begin 13 H.A end
 -2 3406 a -2 3406 a
SDict begin [/View [/XYZ H.V]/Dest (0:121) cvn /DEST pdfmark end
 -2 3406 a 396 3507 a Fk(\330MQ)21
b(\(ZeroMQ,)d(\330MQ,)j(zmq\))e(looks)h(lik)o(e)g(an)g(embeddable)e
(netw)o(orking)g(library)h(b)n(ut)h(acts)h(lik)o(e)g(a)f(concurrenc)o
(y)396 3615 y(frame)n(w)o(ork.)e(It)j(gi)n(v)o(es)e(you)h(sock)o(ets)g
(that)g(carry)f(atomic)h(messages)h(across)f(v)n(arious)f(transports)g
(lik)o(e)h(in-process,)396 3723 y(inter)n(-process,)f(TCP)-9
b(,)20 b(and)g(multicast.)g(Y)-9 b(ou)20 b(can)g(connect)f(sock)o(ets)h
(N-to-N)f(with)i(patterns)e(lik)o(e)i(f)o(anout,)e(pub-sub,)396
3831 y(task)i(distrib)n(ution,)e(and)g(request-reply)-5
b(.)17 b(It')-5 b(s)21 b(f)o(ast)g(enough)d(to)i(be)h(the)f(f)o(abric)f
(for)h(clustered)f(products.)g(Its)396 3939 y(asynchronous)f(I/O)i
(model)f(gi)n(v)o(es)h(you)f(scalable)h(multicore)f(applications,)g(b)n
(uilt)i(as)f(asynchronous)396 4047 y(message-processing)e(tasks.)j(It)f
(has)g(a)h(score)f(of)g(language)e(APIs)j(and)f(runs)g(on)f(most)i
(operating)d(systems.)i(\330MQ)h(is)396 4154 y(from)578
4154 y
SDict begin H.S end
 578 4154 a 578 4154 a
SDict begin 13 H.A end
 578 4154 a 578 4154 a
SDict begin [/View [/XYZ H.V]/Dest (0:122) cvn /DEST pdfmark end
 578
4154 a Fk(iMatix)g(\(http://www)-5 b(.imatix.com\))16
b(and)k(is)h(LGPLv3)e(open)g(source.)-2 4183 y
SDict begin H.S end
 -2 4183
a -2 4183 a
SDict begin 13 H.A end
 -2 4183 a -2 4183 a
SDict begin [/View [/XYZ H.V]/Dest (0:123) cvn /DEST pdfmark end
 -2 4183 a 359 x Fn(1.3.)39
b(Some)f(Assumptions)1619 4542 y
SDict begin H.S end
 1619 4542 a 1619 4542
a
SDict begin 22.464 H.A end
 1619 4542 a 1619 4542 a
SDict begin [/View [/XYZ H.V]/Dest (6.7.1) cvn /DEST pdfmark end
 1619 4542 a -2 4738 a
SDict begin H.S end
 -2 4738
a -2 4738 a
SDict begin 13 H.A end
 -2 4738 a -2 4738 a
SDict begin [/View [/XYZ H.V]/Dest (0:125) cvn /DEST pdfmark end
 -2 4738 a 396 4816 a
Fk(W)-7 b(e)22 b(assume)e(you)f(are)h(using)g(the)g(latest)h(3.2)f
(release)g(of)g(\330MQ.)g(W)-7 b(e)21 b(assume)f(you)g(are)g(using)g(a)
g(Linux)f(box)h(or)396 4924 y(something)f(similar)-5
b(.)21 b(W)-7 b(e)21 b(assume)f(you)f(can)h(read)g(C)h(code,)e(more)h
(or)g(less,)h(that')-5 b(s)20 b(the)h(def)o(ault)e(language)f(for)i
(the)396 5032 y(e)o(xamples.)f(W)-7 b(e)21 b(assume)g(that)f(when)f(we)
i(write)f(constants)g(lik)o(e)h(PUSH)g(or)e(SUBSCRIBE)j(you)e(can)g
(imagine)f(the)o(y)396 5140 y(are)h(really)g(called)g(ZMQ_PUSH)g(or)g
(ZMQ_SUBSCRIBE)h(if)f(the)h(programming)16 b(language)j(needs)h(it.)-2
5168 y
SDict begin H.S end
 -2 5168 a -2 5168 a
SDict begin 13 H.A end
 -2 5168 a -2 5168 a
SDict begin [/View [/XYZ H.V]/Dest (0:126) cvn /DEST pdfmark end
 -2 5168
a Black 3842 5569 a Ff(2)p Black eop end
%%Page: 3 16
TeXDict begin 3 15 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.3) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 94 a Fn(1.4.)39 b(Getting)f(the)h(Examples)1746
94 y
SDict begin H.S end
 1746 94 a 1746 94 a
SDict begin 22.464 H.A end
 1746 94 a 1746 94 a
SDict begin [/View [/XYZ H.V]/Dest (6.8.1) cvn /DEST pdfmark end
 1746 94
a -2 292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:128) cvn /DEST pdfmark end
 -2 292
a 396 368 a Fk(The)20 b(Guide)g(e)o(xamples)f(li)n(v)o(e)h(in)g(the)g
(Guide')-5 b(s)1731 368 y
SDict begin H.S end
 1731 368 a 1731 368 a
SDict begin 13 H.A end
 1731
368 a 1731 368 a
SDict begin [/View [/XYZ H.V]/Dest (0:129) cvn /DEST pdfmark end
 1731 368 a Fk(git)21 b(repository)d(\(https://github)m
(.com/imatix/zguide\).)c(The)20 b(simplest)396 476 y(w)o(ay)h(to)f(get)
g(all)h(the)f(e)o(xamples)f(is)i(to)g(clone)e(this)i(repository:)-2
577 y
SDict begin H.S end
 -2 577 a -2 577 a
SDict begin 11.7 H.A end
 -2 577 a -2 577 a
SDict begin [/View [/XYZ H.V]/Dest (0:130) cvn /DEST pdfmark end
 -2 577 a 396
656 a Fe(git)45 b(clone)f(--depth=1)f
(git://github.com/imatix/zguide.git)-2 834 y
SDict begin H.S end
 -2 834 a
-2 834 a
SDict begin 13 H.A end
 -2 834 a -2 834 a
SDict begin [/View [/XYZ H.V]/Dest (0:131) cvn /DEST pdfmark end
 -2 834 a 396 930 a Fk(And)20
b(then)g(bro)n(wse)f(the)h(e)o(xamples)f(subdirectory)-5
b(.)18 b(Y)-9 b(ou')o(ll)19 b(\002nd)h(e)o(xamples)f(by)h(language.)e
(If)i(there)g(are)g(e)o(xamples)396 1038 y(missing)g(in)h(a)f(language)
f(you)g(use,)h(you')l(re)f(encouraged)e(to)2158 1038
y
SDict begin H.S end
 2158 1038 a 2158 1038 a
SDict begin 13 H.A end
 2158 1038 a 2158 1038 a
SDict begin [/View [/XYZ H.V]/Dest (0:132) cvn /DEST pdfmark end
 2158
1038 a Fk(submit)j(a)h(translation)396 1146 y
(\(http://zguide.zeromq.or)o(g)o(/main)o(:translate\))o(.)15
b(This)20 b(is)h(ho)n(w)f(the)g(Guide)g(became)f(so)i(useful,)e(thanks)
h(to)g(the)g(w)o(ork)g(of)396 1254 y(man)o(y)f(people.)g(All)i(e)o
(xamples)e(are)h(licensed)g(under)f(MIT/X11.)-2 1282
y
SDict begin H.S end
 -2 1282 a -2 1282 a
SDict begin 13 H.A end
 -2 1282 a -2 1282 a
SDict begin [/View [/XYZ H.V]/Dest (0:133) cvn /DEST pdfmark end
 -2 1282 a 359
x Fn(1.5.)39 b(Ask)g(and)g(Y)-11 b(e)39 b(Shall)f(Receive)2005
1641 y
SDict begin H.S end
 2005 1641 a 2005 1641 a
SDict begin 22.464 H.A end
 2005 1641 a 2005 1641
a
SDict begin [/View [/XYZ H.V]/Dest (6.9.1) cvn /DEST pdfmark end
 2005 1641 a -2 1809 a
SDict begin H.S end
 -2 1809 a -2 1809 a
SDict begin 13 H.A end
 -2 1809 a
-2 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:135) cvn /DEST pdfmark end
 -2 1809 a 396 1915 a Fk(So)21 b(let')-5 b(s)21
b(start)g(with)f(some)g(code.)f(W)-7 b(e)22 b(start)e(of)g(course)g
(with)g(a)h(Hello)f(W)-7 b(orld)20 b(e)o(xample.)f(W)-7
b(e')o(ll)21 b(mak)o(e)f(a)g(client)h(and)e(a)396 2023
y(serv)o(er)-5 b(.)20 b(The)g(client)g(sends)g("Hello")g(to)g(the)h
(serv)o(er)m(,)d(which)i(replies)g(with)h("W)-7 b(orld"\()p
0 TeXcolorgray 2852 2023 a
SDict begin H.S end
 2852 2023 a Fk(Figure)18 b(1-1)3200
2023 y
SDict begin 13 H.L end
 3200 2023 a 3200 2023 a
SDict begin [/Subtype /Link/Dest (0:figure-1) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3200 2023 a Black -1 w
Fk(\).)i(Here')-5 b(s)20 b(the)g(serv)o(er)396 2131 y(in)h(C,)f(which)g
(opens)g(a)g(&Oslash;MQ)g(sock)o(et)g(on)g(port)g(5555,)e(reads)i
(requests)g(on)g(it,)g(and)g(replies)g(with)h("W)-7 b(orld")20
b(to)396 2239 y(each)g(request:)-2 2257 y
SDict begin H.S end
 -2 2257 a -2
2257 a
SDict begin 13 H.A end
 -2 2257 a -2 2257 a
SDict begin [/View [/XYZ H.V]/Dest (0:hwserver-c) cvn /DEST pdfmark
end
 -2 2257 a 396 2441 a Fg(Example)h(1-1.)e
(Hello)h(W)-6 b(orld)20 b(ser)o(v)o(er)g(\(hwser)o(v)o(er)-8
b(.c\))-2 2540 y
SDict begin H.S end
 -2 2540 a -2 2540 a
SDict begin 11.7 H.A end
 -2 2540 a -2 2540
a
SDict begin [/View [/XYZ H.V]/Dest (0:139) cvn /DEST pdfmark end
 -2 2540 a 396 2621 a Fe(//)396 2718 y(//)90 b(Hello)44
b(World)g(server)396 2815 y(//)90 b(Binds)44 b(REP)g(socket)g(to)g
(tcp://)1742 2828 y(*)1787 2815 y(:5555)396 2912 y(//)90
b(Expects)43 b("Hello")h(from)g(client,)g(replies)f(with)i("World")396
3009 y(//)396 3106 y(#include)f(<zmq.h>)396 3203 y(#include)g
(<stdio.h>)396 3301 y(#include)g(<unistd.h>)396 3398
y(#include)g(<string.h>)396 3592 y(int)h(main)f(\(void\))396
3689 y({)576 3786 y(void)800 3799 y(*)845 3786 y(context)f(=)i
(zmq_ctx_new)e(\(\);)576 3981 y(//)89 b(Socket)44 b(to)g(talk)g(to)h
(clients)576 4078 y(void)800 4091 y(*)845 4078 y(responder)e(=)i
(zmq_socket)e(\(context,)g(ZMQ_REP\);)576 4175 y(zmq_bind)g
(\(responder,)g("tcp://)1832 4188 y(*)1877 4175 y(:5555"\);)576
4369 y(while)h(\(true\))f({)755 4466 y(//)89 b(Wait)44
b(for)h(next)f(request)g(from)g(client)755 4563 y(zmq_msg_t)f(request;)
755 4661 y(zmq_msg_init)g(\(&request\);)755 4758 y(zmq_msg_recv)g
(\(&request,)g(responder,)g(0\);)755 4855 y(printf)h(\("Received)f
(Hello\\n"\);)755 4952 y(zmq_msg_close)g(\(&request\);)755
5146 y(//)89 b(Do)45 b(some)f('work')p Black 3842 5569
a Ff(3)p Black eop end
%%Page: 4 17
TeXDict begin 4 16 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.4) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 755 72 a Fe(sleep)44 b(\(1\);)755 267 y(//)89 b(Send)44
b(reply)g(back)h(to)f(client)755 364 y(zmq_msg_t)f(reply;)755
461 y(zmq_msg_init_size)f(\(&reply,)h(5\);)755 558 y(memcpy)h
(\(zmq_msg_data)e(\(&reply\),)i("World",)f(5\);)755 655
y(zmq_msg_send)g(\(&reply,)g(responder,)g(0\);)755 752
y(zmq_msg_close)g(\(&reply\);)576 850 y(})576 947 y(//)89
b(We)44 b(never)g(get)h(here)f(but)g(if)h(we)f(did,)g(this)h(would)f
(be)g(how)g(we)h(end)576 1044 y(zmq_close)e(\(responder\);)576
1141 y(zmq_ctx_destroy)f(\(context\);)576 1238 y(return)h(0;)396
1335 y(})-2 1343 y
SDict begin H.S end
 -2 1343 a -2 1343 a
SDict begin 13 H.A end
 -2 1343 a -2 1343
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-1) cvn /DEST pdfmark end
 -2 1343 a 396 1609 a Fg(Figur)o(e)20 b(1-1.)f(Request-Reply)-2
1709 y
SDict begin H.S end
 -2 1709 a -2 1709 a
SDict begin 13 H.A end
 -2 1709 a -2 1709 a
SDict begin [/View [/XYZ H.V]/Dest (0:142) cvn /DEST pdfmark end
 -2 1709
a 396 4434 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4434 a @beginspecial 0 @llx -322 @lly
200 @urx 0 @ury 2000 @rwi @setspecial
%%BeginDocument: images/fig1.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -322 200 0
%%HiResBoundingBox: 0.0 -322.0 200.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
38.000301361083984 -38.000301361083984 moveto
38.000301361083984 -92.00029754638672 lineto
168.00030517578125 -92.00029754638672 lineto
168.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
38.000301361083984 -96.00029754638672 moveto
38.000301361083984 -115.00029754638672 lineto
38.000301361083984 -119.66696421305339 39.66696802775065 -122.00029754638672 43.000301361083984 -122.00029754638672 curveto
163.00030517578125 -122.00029754638672 lineto
163.00030517578125 -122.00029754638672 lineto
166.3336385091146 -122.00029754638672 168.00030517578125 -119.66696421305339 168.00030517578125 -115.00029754638672 curveto
168.00030517578125 -96.00029754638672 lineto
168.00030517578125 -96.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
43.000301361083984 -206.00030517578125 moveto
39.66696802775065 -206.00030517578125 38.000301361083984 -208.3336385091146 38.000301361083984 -213.00030517578125 curveto
38.000301361083984 -232.00030517578125 lineto
168.00030517578125 -232.00030517578125 lineto
168.00030517578125 -213.00030517578125 lineto
168.00030517578125 -208.3336385091146 166.3336385091146 -206.00030517578125 163.00030517578125 -206.00030517578125 curveto
43.000301361083984 -206.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
38.000301361083984 -236.00030517578125 moveto
38.000301361083984 -290.00030517578125 lineto
168.00030517578125 -290.00030517578125 lineto
168.00030517578125 -236.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
35.0 -35.0 moveto
35.0 -89.0 lineto
165.0 -89.0 lineto
165.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
35.0 -35.0 moveto
35.0 -89.0 lineto
165.0 -89.0 lineto
165.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
35.0 -93.0 moveto
35.0 -112.0 lineto
35.0 -116.66666666666667 36.666666666666664 -119.0 40.0 -119.0 curveto
160.0 -119.0 lineto
160.0 -119.0 lineto
163.33333333333334 -119.0 165.0 -116.66666666666667 165.0 -112.0 curveto
165.0 -93.0 lineto
165.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
35.0 -93.0 moveto
35.0 -112.0 lineto
35.0 -116.66666666666667 36.666666666666664 -119.0 40.0 -119.0 curveto
160.0 -119.0 lineto
160.0 -119.0 lineto
163.33333333333334 -119.0 165.0 -116.66666666666667 165.0 -112.0 curveto
165.0 -93.0 lineto
165.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -203.0 moveto
36.666666666666664 -203.0 35.0 -205.33333333333334 35.0 -210.0 curveto
35.0 -229.0 lineto
165.0 -229.0 lineto
165.0 -210.0 lineto
165.0 -205.33333333333334 163.33333333333334 -203.0 160.0 -203.0 curveto
40.0 -203.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -203.0 moveto
36.666666666666664 -203.0 35.0 -205.33333333333334 35.0 -210.0 curveto
35.0 -229.0 lineto
165.0 -229.0 lineto
165.0 -210.0 lineto
165.0 -205.33333333333334 163.33333333333334 -203.0 160.0 -203.0 curveto
40.0 -203.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
35.0 -233.0 moveto
35.0 -287.0 lineto
165.0 -287.0 lineto
165.0 -233.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
35.0 -233.0 moveto
35.0 -287.0 lineto
165.0 -287.0 lineto
165.0 -233.0 lineto
closepath
stroke
newpath
75.0 -119.0 moveto
75.0 -189.0 lineto
stroke
newpath
125.0 -133.0 moveto
125.0 -203.0 lineto
stroke
newpath
125.0 -126.0 moveto
120.0 -140.0 lineto
130.0 -140.0 lineto
closepath
fill
newpath
70.0 -182.0 moveto
75.0 -196.0 lineto
80.0 -182.0 lineto
closepath
fill
/Helvetica findfont
15 scalefont setfont
77.0 -68.0 moveto
(Client) show
80.0 -110.0 moveto
(REQ) show
27.0 -166.0 moveto
("Hello") show
113.0 -166.0 moveto
("World") show
81.0 -222.0 moveto
(REP) show
73.0 -264.0 moveto
(Server) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4434 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4434 a -2 4600 a
SDict begin H.S end
 -2 4600
a -2 4600 a
SDict begin 13 H.A end
 -2 4600 a -2 4600 a
SDict begin [/View [/XYZ H.V]/Dest (0:145) cvn /DEST pdfmark end
 -2 4600 a 396 4708 a
Fk(The)h(REQ-REP)h(sock)o(et)f(pair)g(is)h(lockstep.)e(The)h(client)g
(does)g(zmq_msg_send[3])c(and)k(then)g(zmq_msg_recv[3],)15
b(in)396 4816 y(a)21 b(loop)e(\(or)h(once)f(if)i(that')-5
b(s)20 b(all)h(it)g(needs\).)e(Doing)h(an)o(y)f(other)g(sequence)g
(\(e.g.)h(sending)f(tw)o(o)h(messages)h(in)f(a)g(ro)n(w\))g(will)396
4924 y(result)g(in)h(a)f(return)f(code)h(of)g(-1)g(from)f(the)h(send)g
(or)g(recv)g(call.)g(Similarly)g(the)g(service)g(does)g
(zmq_msg_recv[3])c(and)396 5032 y(then)k(zmq_msg_send[3])c(in)k(that)h
(order)m(,)d(and)i(as)h(often)e(as)i(it)g(needs)f(to.)p
Black 3842 5569 a Ff(4)p Black eop end
%%Page: 5 18
TeXDict begin 5 17 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.5) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:146) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(\330MQ)h(uses)f(C)i(as)e(its)i(reference)c(language)h
(and)g(this)i(is)g(the)f(main)g(language)f(we')o(ll)h(use)h(for)e(e)o
(xamples.)g(If)h(you')l(re)396 180 y(reading)f(this)i(on-line,)d(the)j
(link)f(belo)n(w)f(the)h(e)o(xample)f(tak)o(es)i(you)e(to)h
(translations)g(into)g(other)f(programming)396 288 y(languages.)g(Let')
-5 b(s)21 b(compare)d(the)i(same)h(serv)o(er)e(in)h(C++:)-2
306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:hwserver-cpp) cvn /DEST pdfmark
end
 -2 306 a 396
490 a Fg(Example)h(1-2.)e(Hello)h(W)-6 b(orld)20 b(ser)o(v)o(er)g
(\(hwser)o(v)o(er)-8 b(.cpp\))-2 590 y
SDict begin H.S end
 -2 590 a -2 590
a
SDict begin 11.7 H.A end
 -2 590 a -2 590 a
SDict begin [/View [/XYZ H.V]/Dest (0:149) cvn /DEST pdfmark end
 -2 590 a 396 670 a Fe(//)396 767
y(//)90 b(Hello)44 b(World)g(server)f(in)i(C++)396 864
y(//)90 b(Binds)44 b(REP)g(socket)g(to)g(tcp://)1742
877 y(*)1787 864 y(:5555)396 961 y(//)90 b(Expects)43
b("Hello")h(from)g(client,)g(replies)f(with)i("World")396
1058 y(//)396 1156 y(#include)f(<zmq.hpp>)396 1253 y(#include)g
(<string>)396 1350 y(#include)g(<iostream>)396 1447 y(#include)g
(<unistd.h>)396 1641 y(int)h(main)f(\(\))g({)576 1738
y(//)89 b(Prepare)44 b(our)g(context)g(and)g(socket)576
1835 y(zmq::context_t)e(context)i(\(1\);)576 1933 y(zmq::socket_t)e
(socket)i(\(context,)f(ZMQ_REP\);)576 2030 y(socket.bind)g(\("tcp://)
1474 2043 y(*)1519 2030 y(:5555"\);)576 2224 y(while)h(\(true\))f({)755
2321 y(zmq::message_t)f(request;)755 2515 y(//)89 b(Wait)44
b(for)h(next)f(request)g(from)g(client)755 2613 y(socket.recv)f
(\(&request\);)755 2710 y(std::cout)g(<<)i("Received)e(Hello")h(<<)g
(std::endl;)755 2904 y(//)89 b(Do)45 b(some)f('work')755
3001 y(sleep)g(\(1\);)755 3195 y(//)89 b(Send)44 b(reply)g(back)h(to)f
(client)755 3292 y(zmq::message_t)e(reply)i(\(5\);)755
3390 y(memcpy)g(\(\(void)1383 3403 y(*)1428 3390 y(\))g(reply.data)f
(\(\),)i("World",)e(5\);)755 3487 y(socket.send)g(\(reply\);)576
3584 y(})576 3681 y(return)g(0;)396 3778 y(})-2 3952
y
SDict begin H.S end
 -2 3952 a -2 3952 a
SDict begin 13 H.A end
 -2 3952 a -2 3952 a
SDict begin [/View [/XYZ H.V]/Dest (0:150) cvn /DEST pdfmark end
 -2 3952 a 396
4052 a Fk(Y)-9 b(ou)20 b(can)g(see)h(that)f(the)g(\330MQ)h(API)f(is)h
(similar)g(in)f(C)h(and)f(C++.)g(In)g(a)h(language)d(lik)o(e)j(PHP)-9
b(,)20 b(we)h(can)f(hide)f(e)n(v)o(en)h(more)396 4160
y(and)g(the)g(code)g(becomes)f(e)n(v)o(en)g(easier)h(to)h(read:)-2
4161 y
SDict begin H.S end
 -2 4161 a -2 4161 a
SDict begin 13 H.A end
 -2 4161 a -2 4161 a
SDict begin [/View [/XYZ H.V]/Dest (0:hwserver-php) cvn /DEST pdfmark
end
 -2 4161
a 396 4361 a Fg(Example)g(1-3.)e(Hello)h(W)-6 b(orld)20
b(ser)o(v)o(er)g(\(hwser)o(v)o(er)-8 b(.php\))-2 4461
y
SDict begin H.S end
 -2 4461 a -2 4461 a
SDict begin 11.7 H.A end
 -2 4461 a -2 4461 a
SDict begin [/View [/XYZ H.V]/Dest (0:153) cvn /DEST pdfmark end
 -2 4461 a 396
4542 a Fe(<?php)396 4639 y(/)441 4652 y(*)441 4749 y(*)576
4736 y(Hello)44 b(World)g(server)441 4846 y(*)576 4833
y(Binds)g(REP)g(socket)g(to)g(tcp://)1742 4846 y(*)1787
4833 y(:5555)441 4943 y(*)576 4930 y(Expects)f("Hello")h(from)g
(client,)g(replies)f(with)i("World")441 5040 y(*)531
5027 y(@author)e(Ian)i(Barber)f
(<ian\(dot\)barber\(at\)gmail\(dot\)com>)441 5137 y(*)486
5124 y(/)p Black 3842 5569 a Ff(5)p Black eop end
%%Page: 6 19
TeXDict begin 6 18 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.6) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 170 a Fe($context)44 b(=)g(new)h(ZMQContext\(1\);)396
364 y(//)90 b(Socket)43 b(to)i(talk)f(to)h(clients)396
461 y($responder)e(=)i(new)f(ZMQSocket\($context,)e(ZMQ::SOCKET_REP\);)
396 558 y($responder->bind\("tcp://)1476 571 y(*)1521
558 y(:5555"\);)396 752 y(while\(true\))h({)441 850 y(//)89
b(Wait)45 b(for)f(next)g(request)g(from)g(client)441
947 y($request)g(=)g($responder->recv\(\);)441 1044 y(printf)g
(\("Received)f(request:)h([\045s]\\n",)f($request\);)441
1238 y(//)89 b(Do)45 b(some)f('work')441 1335 y(sleep)g(\(1\);)441
1530 y(//)89 b(Send)45 b(reply)f(back)g(to)g(client)441
1627 y($responder->send\("World"\);)-2 1804 y
SDict begin H.S end
 -2 1804
a -2 1804 a
SDict begin 13 H.A end
 -2 1804 a -2 1804 a
SDict begin [/View [/XYZ H.V]/Dest (0:154) cvn /DEST pdfmark end
 -2 1804 a 396 1901 a
Fk(Here')-5 b(s)21 b(the)f(client)g(code)g(\(click)f(the)i(link)f(belo)
n(w)f(the)h(source)g(to)g(look)g(at,)g(or)g(contrib)n(ute)f(a)h
(translation)g(in)g(your)396 2009 y(f)o(a)n(v)n(orite)g(programming)d
(language\):)-2 2027 y
SDict begin H.S end
 -2 2027 a -2 2027 a
SDict begin 13 H.A end
 -2 2027 a
-2 2027 a
SDict begin [/View [/XYZ H.V]/Dest (0:hwclient-c) cvn /DEST pdfmark
end
 -2 2027 a 396 2210 a Fg(Example)k(1-4.)e(Hello)h(W)-6
b(orld)20 b(client)g(\(hwclient.c\))-2 2310 y
SDict begin H.S end
 -2 2310
a -2 2310 a
SDict begin 11.7 H.A end
 -2 2310 a -2 2310 a
SDict begin [/View [/XYZ H.V]/Dest (0:157) cvn /DEST pdfmark end
 -2 2310 a 396 2390 a
Fe(//)396 2487 y(//)90 b(Hello)44 b(World)g(client)396
2584 y(//)90 b(Connects)43 b(REQ)h(socket)g(to)h(tcp://localhost:5555)
396 2681 y(//)90 b(Sends)44 b("Hello")f(to)i(server,)e(expects)h
("World")g(back)396 2779 y(//)396 2876 y(#include)g(<zmq.h>)396
2973 y(#include)g(<string.h>)396 3070 y(#include)g(<stdio.h>)396
3167 y(#include)g(<unistd.h>)396 3361 y(int)h(main)f(\(void\))396
3459 y({)576 3556 y(void)800 3569 y(*)845 3556 y(context)f(=)i
(zmq_ctx_new)e(\(\);)576 3750 y(//)89 b(Socket)44 b(to)g(talk)g(to)h
(server)576 3847 y(printf)e(\("Connecting)g(to)i(hello)f(world)g
(server...\\n"\);)576 3944 y(void)800 3957 y(*)845 3944
y(requester)f(=)i(zmq_socket)e(\(context,)g(ZMQ_REQ\);)576
4041 y(zmq_connect)g(\(requester,)g("tcp://localhost:5555"\);)576
4236 y(int)h(request_nbr;)576 4333 y(for)g(\(request_nbr)f(=)h(0;)h
(request_nbr)e(!=)h(10;)h(request_nbr++\))d({)755 4430
y(zmq_msg_t)h(request;)755 4527 y(zmq_msg_init_size)f(\(&request,)h
(5\);)755 4624 y(memcpy)h(\(zmq_msg_data)e(\(&request\),)h("Hello",)h
(5\);)755 4721 y(printf)g(\("Sending)f(Hello)h(\045d...\\n",)f
(request_nbr\);)755 4818 y(zmq_msg_send)g(\(&request,)g(requester,)g
(0\);)755 4916 y(zmq_msg_close)g(\(&request\);)755 5110
y(zmq_msg_t)g(reply;)p Black 3840 5569 a Ff(6)p Black
eop end
%%Page: 7 20
TeXDict begin 7 19 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.7) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 755 72 a Fe(zmq_msg_init)43 b(\(&reply\);)755 170
y(zmq_msg_recv)g(\(&reply,)g(requester,)g(0\);)755 267
y(printf)h(\("Received)f(World)h(\045d\\n",)g(request_nbr\);)755
364 y(zmq_msg_close)f(\(&reply\);)576 461 y(})576 558
y(zmq_close)g(\(requester\);)576 655 y(zmq_ctx_destroy)f(\(context\);)
576 752 y(return)h(0;)396 850 y(})-2 1024 y
SDict begin H.S end
 -2 1024 a
-2 1024 a
SDict begin 13 H.A end
 -2 1024 a -2 1024 a
SDict begin [/View [/XYZ H.V]/Dest (0:158) cvn /DEST pdfmark end
 -2 1024 a 396 1124 a Fk(No)n(w)20
b(this)f(looks)g(too)g(simple)h(to)f(be)g(realistic,)h(b)n(ut)f(a)h
(\330MQ)g(sock)o(et)f(is)h(what)g(you)e(get)h(when)g(you)g(tak)o(e)g(a)
h(normal)e(TCP)396 1231 y(sock)o(et,)i(inject)g(it)h(with)g(a)f(mix)g
(of)g(radioacti)n(v)o(e)e(isotopes)i(stolen)g(from)f(a)i(secret)f(So)o
(viet)g(atomic)g(research)f(project,)396 1339 y(bombard)f(it)j(with)f
(1950-era)e(cosmic)i(rays,)g(and)g(put)g(it)g(into)g(the)h(hands)e(of)h
(a)h(drug-addled)16 b(comic)k(book)f(author)g(with)396
1447 y(a)i(badly-disguised)c(fetish)k(for)e(b)n(ulging)g(muscles)h
(clad)g(in)h(spande)o(x\()p 0 TeXcolorgray 2430 1447
a
SDict begin H.S end
 2430 1447 a Fk(Figure)c(1-2)2777 1447 y
SDict begin 13 H.L end
 2777 1447 a
2777 1447 a
SDict begin [/Subtype /Link/Dest (0:figure-2) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2777 1447 a Black -2 w Fk(\).)j(Y)-8 b(es,)21
b(&Oslash;MQ)f(sock)o(ets)g(are)396 1555 y(the)g(w)o(orld-sa)n(ving)f
(superheroes)f(of)i(the)g(netw)o(orking)e(w)o(orld.)-2
1573 y
SDict begin H.S end
 -2 1573 a -2 1573 a
SDict begin 13 H.A end
 -2 1573 a -2 1573 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-2) cvn /DEST pdfmark end
 -2 1573
a 396 1757 a Fg(Figur)o(e)i(1-2.)f(A)i(terrible)f(accident...)-2
1856 y
SDict begin H.S end
 -2 1856 a -2 1856 a
SDict begin 13 H.A end
 -2 1856 a -2 1856 a
SDict begin [/View [/XYZ H.V]/Dest (0:162) cvn /DEST pdfmark end
 -2 1856
a 396 3398 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3398 a @beginspecial 0 @llx -180 @lly
282 @urx 0 @ury 2820 @rwi @setspecial
%%BeginDocument: images/fig2.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -180 282 0
%%HiResBoundingBox: 0.0 -180.0 282.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -59.80017852783203 lineto
94.80017852783203 -59.80017852783203 lineto
94.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
148.80018615722656 -23.800180435180664 moveto
148.80018615722656 -59.80017852783203 lineto
226.80018615722656 -59.80017852783203 lineto
226.80018615722656 -23.800180435180664 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -58.0 lineto
93.0 -58.0 lineto
93.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -58.0 lineto
93.0 -58.0 lineto
93.0 -22.0 lineto
closepath
stroke
0.7529411764705882 0.0 0.0 setrgbcolor
newpath
147.0 -22.0 moveto
147.0 -58.0 lineto
225.0 -58.0 lineto
225.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
147.0 -22.0 moveto
147.0 -58.0 lineto
225.0 -58.0 lineto
225.0 -22.0 lineto
closepath
stroke
newpath
27.0 -67.0 moveto
27.0 -108.0 lineto
stroke
newpath
57.0 -67.0 moveto
57.0 -103.0 lineto
123.0 -103.0 lineto
123.0 -153.0 lineto
stroke
newpath
87.0 -67.0 moveto
87.0 -85.0 lineto
147.0 -85.0 lineto
147.0 -135.0 lineto
stroke
newpath
93.0 -40.0 moveto
141.0 -40.0 lineto
stroke
newpath
138.0 -36.0 moveto
144.0 -40.0 lineto
138.0 -45.0 lineto
closepath
fill
newpath
27.0 -63.0 moveto
24.0 -72.0 lineto
30.0 -72.0 lineto
closepath
fill
newpath
57.0 -63.0 moveto
54.0 -72.0 lineto
60.0 -72.0 lineto
closepath
fill
newpath
87.0 -63.0 moveto
84.0 -72.0 lineto
90.0 -72.0 lineto
closepath
fill
/Helvetica findfont
9 scalefont setfont
235.0 -35.0 moveto
(Zap!) show
27.0 -44.0 moveto
(TCP socket) show
158.0 -44.0 moveto
(0MQ socket) show
104.0 -53.0 moveto
(BOOM!) show
243.0 -53.0 moveto
(POW!!) show
18.0 -116.0 moveto
(Illegal) show
18.0 -125.0 moveto
(radioisotopes) show
18.0 -134.0 moveto
(from secret) show
18.0 -143.0 moveto
(Soviet atomic) show
18.0 -152.0 moveto
(city) show
132.0 -143.0 moveto
(Spandex) show
100.0 -161.0 moveto
(Cosmic rays) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3398 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3398 a -2 3564 a
SDict begin H.S end
 -2 3564
a -2 3564 a
SDict begin 13 H.A end
 -2 3564 a -2 3564 a
SDict begin [/View [/XYZ H.V]/Dest (0:165) cvn /DEST pdfmark end
 -2 3564 a 396 3672 a
Fk(Y)-9 b(ou)20 b(could)f(literally)h(thro)n(w)f(thousands)g(of)h
(clients)h(at)f(this)h(serv)o(er)m(,)e(all)i(at)f(once,)g(and)f(it)i(w)
o(ould)f(continue)e(to)j(w)o(ork)396 3780 y(happily)e(and)h(quickly)-5
b(.)18 b(F)o(or)i(fun,)f(try)h(starting)g(the)g(client)g(and)2230
3780 y
SDict begin H.S end
 2230 3780 a 2230 3780 a
SDict begin 13 H.A end
 2230 3780 a 2230 3780
a
SDict begin [/View [/XYZ H.V]/Dest (0:166) cvn /DEST pdfmark end
 2230 3780 a Ff(then)g Fk(starting)f(the)i(serv)o(er)m(,)d(see)j(ho)n
(w)f(it)h(all)f(still)i(w)o(orks,)396 3888 y(then)e(think)f(for)h(a)h
(second)e(what)h(this)h(means.)-2 4055 y
SDict begin H.S end
 -2 4055 a -2
4055 a
SDict begin 13 H.A end
 -2 4055 a -2 4055 a
SDict begin [/View [/XYZ H.V]/Dest (0:167) cvn /DEST pdfmark end
 -2 4055 a 396 4162 a Fk(Let)g(me)f(e)o
(xplain)f(brie\003y)g(what)h(these)h(tw)o(o)f(programs)f(are)h
(actually)f(doing.)g(The)o(y)g(create)h(a)h(\330MQ)f(conte)o(xt)f(to)h
(w)o(ork)396 4270 y(with,)g(and)g(a)h(sock)o(et.)e(Don')o(t)g(w)o(orry)
h(what)g(the)g(w)o(ords)g(mean.)f(Y)-9 b(ou')o(ll)20
b(pick)f(it)i(up.)f(The)g(serv)o(er)f(binds)h(its)h(REP)g(\(reply\))396
4378 y(sock)o(et)f(to)h(port)e(5555.)g(The)h(serv)o(er)f(w)o(aits)i
(for)f(a)g(request,)g(in)g(a)g(loop,)g(and)f(responds)g(each)h(time)g
(with)h(a)f(reply)-5 b(.)19 b(The)396 4486 y(client)h(sends)h(a)f
(request)g(and)f(reads)h(the)h(reply)e(back)g(from)h(the)g(serv)o(er)-5
b(.)-2 4670 y
SDict begin H.S end
 -2 4670 a -2 4670 a
SDict begin 13 H.A end
 -2 4670 a -2 4670 a
SDict begin [/View [/XYZ H.V]/Dest (0:168) cvn /DEST pdfmark end

-2 4670 a 396 4760 a Fk(If)20 b(you)g(kill)g(the)g(serv)o(er)g
(\(Ctrl-C\))g(and)g(restart)g(it,)g(the)h(client)f(w)o(on')o(t)f(reco)o
(v)o(er)f(properly)-5 b(.)18 b(Reco)o(v)o(ering)g(from)h(crashing)396
4867 y(processes)h(isn')o(t)g(quite)g(that)g(easy)-5
b(.)20 b(Making)f(a)h(reliable)g(request-reply)e(\003o)n(w)i(is)h
(comple)o(x)d(enough)h(that)h(I)g(w)o(on')o(t)f(co)o(v)o(er)396
4975 y(it)i(until)f(Chapter)g(F)o(our)-5 b(.)p Black
3839 5569 a Ff(7)p Black eop end
%%Page: 8 21
TeXDict begin 8 20 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.8) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:169) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(There)g(is)h(a)f(lot)h(happening)c(behind)i(the)h
(scenes)h(b)n(ut)f(what)g(matters)g(to)h(us)f(programmers)e(is)j(ho)n
(w)e(short)h(and)g(sweet)396 180 y(the)g(code)g(is,)h(and)e(ho)n(w)h
(often)g(it)g(doesn')o(t)f(crash,)h(e)n(v)o(en)f(under)g(hea)n(vy)g
(load.)h(This)g(is)h(the)f(request-reply)e(pattern,)396
288 y(probably)g(the)i(simplest)h(w)o(ay)f(to)g(use)h(\330MQ.)f(It)h
(maps)f(to)g(RPC)i(and)d(the)h(classic)i(client-serv)o(er)c(model.)-2
317 y
SDict begin H.S end
 -2 317 a -2 317 a
SDict begin 13 H.A end
 -2 317 a -2 317 a
SDict begin [/View [/XYZ H.V]/Dest (0:170) cvn /DEST pdfmark end
 -2 317 a 359
x Fn(1.6.)39 b(A)g(Minor)g(Note)f(on)i(Strings)1921 676
y
SDict begin H.S end
 1921 676 a 1921 676 a
SDict begin 22.464 H.A end
 1921 676 a 1921 676 a
SDict begin [/View [/XYZ H.V]/Dest (6.10.1) cvn /DEST pdfmark end
 1921 676
a -2 874 a
SDict begin H.S end
 -2 874 a -2 874 a
SDict begin 13 H.A end
 -2 874 a -2 874 a
SDict begin [/View [/XYZ H.V]/Dest (0:172) cvn /DEST pdfmark end
 -2 874
a 396 950 a Fk(\330MQ)21 b(doesn')o(t)d(kno)n(w)i(an)o(ything)e(about)h
(the)h(data)g(you)f(send)h(e)o(xcept)g(its)h(size)g(in)f(bytes.)g(That)
g(means)g(you)f(are)396 1058 y(responsible)g(for)h(formatting)e(it)j
(safely)f(so)g(that)h(applications)e(can)h(read)f(it)i(back.)f(Doing)f
(this)i(for)e(objects)h(and)396 1166 y(comple)o(x)f(data)h(types)g(is)h
(a)g(job)e(for)h(specialized)g(libraries)f(lik)o(e)i(Protocol)e(Buf)n
(fers.)g(But)i(e)n(v)o(en)e(for)h(strings)g(you)f(need)396
1274 y(to)i(tak)o(e)f(care.)-2 1440 y
SDict begin H.S end
 -2 1440 a -2 1440
a
SDict begin 13 H.A end
 -2 1440 a -2 1440 a
SDict begin [/View [/XYZ H.V]/Dest (0:173) cvn /DEST pdfmark end
 -2 1440 a 396 1548 a Fk(In)g(C)h(and)f(some)g
(other)f(languages,)g(strings)h(are)g(terminated)f(with)h(a)h(null)f
(byte.)f(W)-7 b(e)22 b(could)d(send)h(a)g(string)g(lik)o(e)396
1655 y("HELLO")g(with)g(that)g(e)o(xtra)g(null)g(byte:)-2
1756 y
SDict begin H.S end
 -2 1756 a -2 1756 a
SDict begin 11.7 H.A end
 -2 1756 a -2 1756 a
SDict begin [/View [/XYZ H.V]/Dest (0:174) cvn /DEST pdfmark end
 -2 1756
a 396 1836 a Fe(zmq_msg_init_data)42 b(\(&request,)h("Hello",)h(6,)g
(NULL,)g(NULL\);)-2 2013 y
SDict begin H.S end
 -2 2013 a -2 2013 a
SDict begin 13 H.A end
 -2 2013
a -2 2013 a
SDict begin [/View [/XYZ H.V]/Dest (0:175) cvn /DEST pdfmark end
 -2 2013 a 396 2110 a Fk(Ho)n(we)n(v)o(er)19
b(if)h(you)g(send)g(a)g(string)g(from)f(another)g(language)f(it)j
(probably)d(will)j(not)f(include)f(that)h(null)g(byte.)g(F)o(or)396
2218 y(e)o(xample,)f(when)g(we)i(send)f(that)g(same)h(string)e(in)i
(Python,)e(we)h(do)g(this:)-2 2319 y
SDict begin H.S end
 -2 2319 a -2 2319
a
SDict begin 11.7 H.A end
 -2 2319 a -2 2319 a
SDict begin [/View [/XYZ H.V]/Dest (0:176) cvn /DEST pdfmark end
 -2 2319 a 396 2398 a Fe(socket.send)43
b(\("Hello"\))-2 2572 y
SDict begin H.S end
 -2 2572 a -2 2572 a
SDict begin 13 H.A end
 -2 2572 a
-2 2572 a
SDict begin [/View [/XYZ H.V]/Dest (0:177) cvn /DEST pdfmark end
 -2 2572 a 396 2672 a Fk(Then)20 b(what)g(goes)g(onto)f(the)h
(wire)h(is)g(a)f(length)g(\(one)f(byte)h(for)f(shorter)g(strings\))h
(and)g(the)g(string)g(contents,)f(as)396 2780 y(indi)n(vidual)g
(characters\()p 0 TeXcolorgray 1118 2780 a
SDict begin H.S end
 1118 2780
a Fk(Figure)e(1-3)1465 2780 y
SDict begin 13 H.L end
 1465 2780 a 1465 2780 a
SDict begin [/Subtype /Link/Dest (0:figure-3) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

1465 2780 a Black -1 w Fk(\).)-2 2798 y
SDict begin H.S end
 -2 2798 a -2
2798 a
SDict begin 13 H.A end
 -2 2798 a -2 2798 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-3) cvn /DEST pdfmark end
 -2 2798 a 396 2981 a Fg(Figur)o(e)j(1-3.)f
(A)i(\330MQ)f(string)-2 3081 y
SDict begin H.S end
 -2 3081 a -2 3081 a
SDict begin 13 H.A end
 -2
3081 a -2 3081 a
SDict begin [/View [/XYZ H.V]/Dest (0:181) cvn /DEST pdfmark end
 -2 3081 a 396 3706 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3706 a @beginspecial
0 @llx -70 @lly 322 @urx 0 @ury 3220 @rwi @setspecial
%%BeginDocument: images/fig3.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -70 322 0
%%HiResBoundingBox: 0.0 -70.0 322.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -27.100210189819336 moveto
19.100210189819336 -47.1002082824707 lineto
61.1002082824707 -47.1002082824707 lineto
61.1002082824707 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
96.10021209716797 -27.100210189819336 moveto
96.10021209716797 -47.1002082824707 lineto
136.10020446777344 -47.1002082824707 lineto
136.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
139.10020446777344 -27.100210189819336 moveto
139.10020446777344 -47.1002082824707 lineto
178.10020446777344 -47.1002082824707 lineto
178.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
181.10020446777344 -27.100210189819336 moveto
181.10020446777344 -47.1002082824707 lineto
220.10020446777344 -47.1002082824707 lineto
220.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.10020446777344 -27.100210189819336 moveto
223.10020446777344 -47.1002082824707 lineto
262.1002197265625 -47.1002082824707 lineto
262.1002197265625 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
265.1002197265625 -27.100210189819336 moveto
265.1002197265625 -47.1002082824707 lineto
306.1002197265625 -47.1002082824707 lineto
306.1002197265625 -27.100210189819336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -25.0 moveto
17.0 -45.0 lineto
59.0 -45.0 lineto
59.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -25.0 moveto
17.0 -45.0 lineto
59.0 -45.0 lineto
59.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
94.0 -25.0 moveto
94.0 -45.0 lineto
134.0 -45.0 lineto
134.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
94.0 -25.0 moveto
94.0 -45.0 lineto
134.0 -45.0 lineto
134.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
137.0 -25.0 moveto
137.0 -45.0 lineto
176.0 -45.0 lineto
176.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
137.0 -25.0 moveto
137.0 -45.0 lineto
176.0 -45.0 lineto
176.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
179.0 -25.0 moveto
179.0 -45.0 lineto
218.0 -45.0 lineto
218.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
179.0 -25.0 moveto
179.0 -45.0 lineto
218.0 -45.0 lineto
218.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
221.0 -25.0 moveto
221.0 -45.0 lineto
260.0 -45.0 lineto
260.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
221.0 -25.0 moveto
221.0 -45.0 lineto
260.0 -45.0 lineto
260.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
263.0 -25.0 moveto
263.0 -45.0 lineto
304.0 -45.0 lineto
304.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
263.0 -25.0 moveto
263.0 -45.0 lineto
304.0 -45.0 lineto
304.0 -25.0 lineto
closepath
stroke
/Helvetica findfont
10 scalefont setfont
37.0 -39.0 moveto
(5 ) show
114.0 -39.0 moveto
(H ) show
156.0 -39.0 moveto
(e ) show
200.0 -39.0 moveto
(l ) show
242.0 -39.0 moveto
(l ) show
282.0 -39.0 moveto
(o ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3706 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3706 a -2 3872 a
SDict begin H.S end
 -2 3872
a -2 3872 a
SDict begin 13 H.A end
 -2 3872 a -2 3872 a
SDict begin [/View [/XYZ H.V]/Dest (0:184) cvn /DEST pdfmark end
 -2 3872 a 396 3980 a
Fk(And)g(if)g(you)g(read)f(this)i(from)e(a)i(C)g(program,)d(you)h(will)
i(get)f(something)f(that)h(looks)g(lik)o(e)g(a)h(string,)f(and)f(might)
h(by)396 4088 y(accident)g(act)g(lik)o(e)h(a)f(string)g(\(if)g(by)g
(luck)g(the)g(\002)n(v)o(e)g(bytes)g(\002nd)g(themselv)o(es)f(follo)n
(wed)g(by)h(an)g(innocently)e(lurking)396 4195 y(null\),)i(b)n(ut)g
(isn')o(t)g(a)g(proper)f(string.)g(Which)h(means)g(that)h(your)e
(client)h(and)f(serv)o(er)h(don')o(t)e(agree)i(on)g(the)g(string)g
(format,)396 4303 y(you)g(will)g(get)h(weird)e(results.)-2
4487 y
SDict begin H.S end
 -2 4487 a -2 4487 a
SDict begin 13 H.A end
 -2 4487 a -2 4487 a
SDict begin [/View [/XYZ H.V]/Dest (0:185) cvn /DEST pdfmark end
 -2 4487
a 396 4577 a Fk(When)h(you)g(recei)n(v)o(e)f(string)h(data)g(from)f
(\330MQ,)h(in)g(C,)h(you)e(simply)h(cannot)f(trust)i(that)f(it')-5
b(s)21 b(safely)f(terminated.)f(Ev)o(ery)396 4685 y(single)h(time)h
(you)e(read)h(a)g(string)g(you)f(should)h(allocate)g(a)g(ne)n(w)g(b)n
(uf)n(fer)f(with)h(space)h(for)e(an)h(e)o(xtra)g(byte,)f(cop)o(y)g(the)
396 4793 y(string,)h(and)g(terminate)f(it)i(properly)d(with)i(a)h
(null.)p Black 3842 5569 a Ff(8)p Black eop end
%%Page: 9 22
TeXDict begin 9 21 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.9) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:186) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(So)h(let')-5 b(s)21 b(establish)f(the)g(rule)g(that)
1393 72 y
SDict begin H.S end
 1393 72 a 1393 72 a
SDict begin 13 H.A end
 1393 72 a 1393 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:187) cvn /DEST pdfmark end
 1393
72 a Fg(\330MQ)g(strings)g(ar)o(e)g(length-speci\002ed,)g(and)h(ar)o(e)
e(sent)i(on)f(the)h(wir)o(e)3480 72 y
SDict begin H.S end
 3480 72 a 3480
72 a
SDict begin 13 H.A end
 3480 72 a 3480 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:188) cvn /DEST pdfmark end
 3480 72 a Fd(without)g Fg(a)396
180 y(trailing)f(null)p Fk(.)h(In)f(the)g(simplest)h(case)f(\(and)g
(we')o(ll)g(do)g(this)h(in)f(our)f(e)o(xamples\))g(a)i(\330MQ)f(string)
g(maps)g(neatly)g(to)g(a)396 288 y(\330MQ)h(message)f(frame,)f(which)h
(looks)f(lik)o(e)i(the)f(abo)o(v)o(e)e(\002gure,)i(a)g(length)f(and)h
(some)g(bytes.)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2
472 a
SDict begin [/View [/XYZ H.V]/Dest (0:189) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(Here)g(is)h(what)g(we)f(need)g(to)g(do,)g
(in)g(C,)h(to)f(recei)n(v)o(e)f(a)i(\330MQ)f(string)g(and)g(deli)n(v)o
(er)f(it)i(to)f(the)g(application)f(as)i(a)f(v)n(alid)g(C)396
670 y(string:)-2 771 y
SDict begin H.S end
 -2 771 a -2 771 a
SDict begin 11.7 H.A end
 -2 771 a -2
771 a
SDict begin [/View [/XYZ H.V]/Dest (0:190) cvn /DEST pdfmark end
 -2 771 a 396 850 a Fe(//)90 b(Receive)43 b(0MQ)i(string)e(from)i
(socket)e(and)i(convert)e(into)i(C)f(string)396 948 y(static)g(char)934
961 y(*)396 1045 y(s_recv)g(\(void)979 1058 y(*)1024
1045 y(socket\))g({)576 1142 y(zmq_msg_t)f(message;)576
1239 y(zmq_msg_init)f(\(&message\);)576 1336 y(int)i(size)g(=)h
(zmq_msg_recv)e(\(&message,)g(socket,)g(0\);)576 1433
y(if)h(\(size)g(==)h(-1\))755 1530 y(return)f(NULL;)576
1627 y(char)800 1640 y(*)845 1627 y(string)f(=)i(malloc)f(\(size)g(+)h
(1\);)576 1725 y(memcpy)e(\(string,)h(zmq_msg_data)f(\(&message\),)g
(size\);)576 1822 y(zmq_msg_close)f(\(&message\);)576
1919 y(string)h([size])h(=)h(0;)576 2016 y(return)e(\(string\);)396
2113 y(})-2 2287 y
SDict begin H.S end
 -2 2287 a -2 2287 a
SDict begin 13 H.A end
 -2 2287 a -2 2287
a
SDict begin [/View [/XYZ H.V]/Dest (0:191) cvn /DEST pdfmark end
 -2 2287 a 396 2387 a Fk(This)21 b(mak)o(es)f(a)g(v)o(ery)f(handy)g
(helper)g(function)g(and)g(in)i(the)f(spirit)g(of)g(making)f(things)h
(we)g(can)g(reuse)g(pro\002tably)-5 b(,)18 b(let')-5
b(s)396 2495 y(write)21 b(a)f(similar)h(')-5 b(s_send')19
b(function)g(that)h(sends)g(strings)g(in)h(the)f(correct)f(\330MQ)h
(format,)f(and)h(package)f(this)h(into)g(a)396 2603 y(header)f(\002le)i
(we)g(can)f(reuse.)-2 2770 y
SDict begin H.S end
 -2 2770 a -2 2770 a
SDict begin 13 H.A end
 -2 2770
a -2 2770 a
SDict begin [/View [/XYZ H.V]/Dest (0:192) cvn /DEST pdfmark end
 -2 2770 a 396 2877 a Fk(The)g(result)g(is)827
2877 y
SDict begin H.S end
 827 2877 a 827 2877 a
SDict begin 13 H.A end
 827 2877 a 827 2877 a
SDict begin [/View [/XYZ H.V]/Dest (0:193) cvn /DEST pdfmark end
 827
2877 a Fe(zhelpers.h)p Fk(,)f(which)h(lets)h(us)g(write)f(sweeter)g
(and)g(shorter)f(\330MQ)i(applications)e(in)h(C.)h(It)f(is)h(a)g(f)o
(airly)396 2985 y(long)f(source,)f(and)g(only)h(fun)f(for)h(C)h(de)n(v)
o(elopers,)d(so)1949 2985 y
SDict begin H.S end
 1949 2985 a 1949 2985 a
SDict begin 13 H.A end
 1949
2985 a 1949 2985 a
SDict begin [/View [/XYZ H.V]/Dest (0:194) cvn /DEST pdfmark end
 1949 2985 a Fk(read)i(it)h(at)g(leisure)396
3093 y(\(https://github)m(.com/imatix/zguide/blo)o(b/m)o(aster/e)o(x)o
(amp)o(les/C/zhelper)o(s.h\))o(.)-2 3121 y
SDict begin H.S end
 -2 3121 a
-2 3121 a
SDict begin 13 H.A end
 -2 3121 a -2 3121 a
SDict begin [/View [/XYZ H.V]/Dest (0:195) cvn /DEST pdfmark end
 -2 3121 a 359 x Fn(1.7.)39
b(V)-7 b(er)n(sion)38 b(Repor)s(ting)1517 3480 y
SDict begin H.S end
 1517
3480 a 1517 3480 a
SDict begin 22.464 H.A end
 1517 3480 a 1517 3480 a
SDict begin [/View [/XYZ H.V]/Dest (6.11.1) cvn /DEST pdfmark end
 1517 3480
a -2 3678 a
SDict begin H.S end
 -2 3678 a -2 3678 a
SDict begin 13 H.A end
 -2 3678 a -2 3678 a
SDict begin [/View [/XYZ H.V]/Dest (0:197) cvn /DEST pdfmark end
 -2
3678 a 396 3754 a Fk(\330MQ)21 b(does)f(come)f(in)i(se)n(v)o(eral)e(v)o
(ersions)g(and)h(quite)g(often,)f(if)h(you)g(hit)g(a)h(problem,)d(it')o
(ll)j(be)f(something)f(that')-5 b(s)20 b(been)396 3862
y(\002x)o(ed)g(in)g(a)h(later)f(v)o(ersion.)f(So)h(it')-5
b(s)21 b(a)g(useful)f(trick)g(to)g(kno)n(w)2151 3862
y
SDict begin H.S end
 2151 3862 a 2151 3862 a
SDict begin 13 H.A end
 2151 3862 a 2151 3862 a
SDict begin [/View [/XYZ H.V]/Dest (0:198) cvn /DEST pdfmark end
 2151
3862 a Ff(e)n(xactly)g Fk(what)h(v)o(ersion)d(of)i(\330MQ)h(you')l(re)d
(actually)396 3970 y(linking)h(with.)h(Here)g(is)i(a)e(tin)o(y)g
(program)e(that)i(does)g(that:)-2 3988 y
SDict begin H.S end
 -2 3988 a -2
3988 a
SDict begin 13 H.A end
 -2 3988 a -2 3988 a
SDict begin [/View [/XYZ H.V]/Dest (0:version-c) cvn /DEST pdfmark
end
 -2 3988 a 396 4171 a Fg(Example)h(1-5.)e
(\330MQ)h(v)o(ersion)g(r)o(eporting)f(\(v)o(ersion.c\))-2
4271 y
SDict begin H.S end
 -2 4271 a -2 4271 a
SDict begin 11.7 H.A end
 -2 4271 a -2 4271 a
SDict begin [/View [/XYZ H.V]/Dest (0:201) cvn /DEST pdfmark end
 -2 4271
a 396 4352 a Fe(//)396 4449 y(//)90 b(Report)43 b(0MQ)i(version)396
4546 y(//)396 4643 y(#include)f("zhelpers.h")396 4837
y(int)h(main)f(\(void\))396 4934 y({)576 5032 y(int)g(major,)g(minor,)g
(patch;)576 5129 y(zmq_version)f(\(&major,)g(&minor,)h(&patch\);)p
Black 3842 5569 a Ff(9)p Black eop end
%%Page: 10 23
TeXDict begin 10 22 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.10) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 72 a Fe(printf)43 b(\("Current)h(0MQ)g(version)g(is)g
(\045d.\045d.\045d\\n",)f(major,)h(minor,)g(patch\);)576
267 y(return)f(EXIT_SUCCESS;)396 364 y(})-2 455 y
SDict begin H.S end
 -2
455 a -2 455 a
SDict begin 13 H.A end
 -2 455 a -2 455 a
SDict begin [/View [/XYZ H.V]/Dest (0:202) cvn /DEST pdfmark end
 -2 455 a 369 x Fn(1.8.)c(Getting)f
(the)h(Messa)o(g)q(e)f(Out)1968 824 y
SDict begin H.S end
 1968 824 a 1968
824 a
SDict begin 22.464 H.A end
 1968 824 a 1968 824 a
SDict begin [/View [/XYZ H.V]/Dest (6.12.1) cvn /DEST pdfmark end
 1968 824 a -2 1022 a
SDict begin H.S end
 -2 1022
a -2 1022 a
SDict begin 13 H.A end
 -2 1022 a -2 1022 a
SDict begin [/View [/XYZ H.V]/Dest (0:204) cvn /DEST pdfmark end
 -2 1022 a 396 1098 a
Fk(The)20 b(second)f(classic)j(pattern)d(is)i(one-w)o(ay)e(data)h
(distrib)n(ution,)f(in)h(which)g(a)g(serv)o(er)f(pushes)h(updates)g(to)
g(a)h(set)g(of)396 1206 y(clients.)g(Let')-5 b(s)20 b(see)h(an)f(e)o
(xample)f(that)h(pushes)g(out)g(weather)f(updates)h(consisting)f(of)h
(a)h(zip)f(code,)f(temperature,)f(and)396 1314 y(relati)n(v)o(e)i
(humidity)-5 b(.)18 b(W)-7 b(e')o(ll)21 b(generate)e(random)f(v)n
(alues,)i(just)h(lik)o(e)f(the)g(real)g(weather)g(stations)g(do.)-2
1498 y
SDict begin H.S end
 -2 1498 a -2 1498 a
SDict begin 13 H.A end
 -2 1498 a -2 1498 a
SDict begin [/View [/XYZ H.V]/Dest (0:205) cvn /DEST pdfmark end
 -2 1498
a 396 1588 a Fk(Here')-5 b(s)21 b(the)f(serv)o(er)-5
b(.)19 b(W)-7 b(e')o(ll)22 b(use)e(port)g(5556)e(for)i(this)h
(application:)-2 1606 y
SDict begin H.S end
 -2 1606 a -2 1606 a
SDict begin 13 H.A end
 -2 1606 a
-2 1606 a
SDict begin [/View [/XYZ H.V]/Dest (0:wuserver-c) cvn /DEST pdfmark
end
 -2 1606 a 396 1789 a Fg(Example)g(1-6.)e(W)-5
b(eather)19 b(update)h(ser)o(v)o(er)h(\(wuser)o(v)o(er)-8
b(.c\))-2 1889 y
SDict begin H.S end
 -2 1889 a -2 1889 a
SDict begin 11.7 H.A end
 -2 1889 a -2 1889
a
SDict begin [/View [/XYZ H.V]/Dest (0:208) cvn /DEST pdfmark end
 -2 1889 a 396 1969 a Fe(//)396 2066 y(//)90 b(Weather)43
b(update)h(server)396 2164 y(//)90 b(Binds)44 b(PUB)g(socket)g(to)g
(tcp://)1742 2177 y(*)1787 2164 y(:5556)396 2261 y(//)90
b(Publishes)43 b(random)h(weather)f(updates)396 2358
y(//)396 2455 y(#include)h("zhelpers.h")396 2649 y(int)h(main)f
(\(void\))396 2746 y({)576 2844 y(//)89 b(Prepare)44
b(our)g(context)g(and)g(publisher)576 2941 y(void)800
2954 y(*)845 2941 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
3038 y(void)800 3051 y(*)845 3038 y(publisher)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PUB\);)576 3135 y(int)h(rc)g(=)h(zmq_bind)f
(\(publisher,)f("tcp://)2236 3148 y(*)2281 3135 y(:5556"\);)576
3232 y(assert)g(\(rc)i(==)f(0\);)576 3329 y(rc)g(=)h(zmq_bind)e
(\(publisher,)g("ipc://weather.ipc"\);)576 3426 y(assert)g(\(rc)i(==)f
(0\);)576 3621 y(//)89 b(Initialize)43 b(random)h(number)g(generator)
576 3718 y(srandom)f(\(\(unsigned\))g(time)h(\(NULL\)\);)576
3815 y(while)g(\(true\))f({)755 3912 y(//)89 b(Get)45
b(values)e(that)i(will)f(fool)g(the)g(boss)755 4009 y(int)g(zipcode,)g
(temperature,)f(relhumidity;)755 4106 y(zipcode)223 b(=)45
b(randof)e(\(100000\);)755 4203 y(temperature)g(=)i(randof)e(\(215\))h
(-)h(80;)755 4301 y(relhumidity)e(=)i(randof)e(\(50\))i(+)f(10;)755
4495 y(//)89 b(Send)44 b(message)g(to)h(all)f(subscribers)755
4592 y(char)g(update)g([20];)755 4689 y(sprintf)g(\(update,)f("\04505d)
h(\045d)h(\045d",)f(zipcode,)f(temperature,)g(relhumidity\);)755
4786 y(s_send)h(\(publisher,)f(update\);)576 4883 y(})576
4981 y(zmq_close)g(\(publisher\);)576 5078 y(zmq_ctx_destroy)f
(\(context\);)p Black 3800 5569 a Ff(10)p Black eop end
%%Page: 11 24
TeXDict begin 11 23 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.11) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 72 a Fe(return)43 b(0;)396 170 y(})-2 344 y
SDict begin H.S end

-2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:209) cvn /DEST pdfmark end
 -2 344 a 396 444
a Fk(There')-5 b(s)20 b(no)g(start,)g(and)g(no)g(end)f(to)i(this)f
(stream)g(of)g(updates,)g(it')-5 b(s)21 b(lik)o(e)f(a)h(ne)n(v)o(er)e
(ending)f(broadcast\()p 0 TeXcolorgray 3313 444 a
SDict begin H.S end
 3313
444 a Fk(Figure)g(1-4)3661 444 y
SDict begin 13 H.L end
 3661 444 a 3661 444
a
SDict begin [/Subtype /Link/Dest (0:figure-4) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3661 444 a Black -2 w Fk(\).)-2 462 y
SDict begin H.S end
 -2 462 a -2 462
a
SDict begin 13 H.A end
 -2 462 a -2 462 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-4) cvn /DEST pdfmark end
 -2 462 a 396 645 a Fg(Figur)o(e)i(1-4.)f
(Publish-Subscribe)-2 745 y
SDict begin H.S end
 -2 745 a -2 745 a
SDict begin 13 H.A end
 -2 745
a -2 745 a
SDict begin [/View [/XYZ H.V]/Dest (0:213) cvn /DEST pdfmark end
 -2 745 a 396 3036 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3036 a @beginspecial
0 @llx -270 @lly 300 @urx 0 @ury 3000 @rwi @setspecial
%%BeginDocument: images/fig4.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -270 300 0
%%HiResBoundingBox: 0.0 -270.0 300.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -23.800180435180664 moveto
106.80017852783203 -57.80017852783203 lineto
190.80018615722656 -57.80017852783203 lineto
190.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -60.80017852783203 moveto
106.80017852783203 -73.80017852783203 lineto
106.80017852783203 -76.4668451944987 107.80017852783203 -77.80017852783203 109.80017852783203 -77.80017852783203 curveto
187.80018615722656 -77.80017852783203 lineto
187.80018615722656 -77.80017852783203 lineto
189.80018615722656 -77.80017852783203 190.80018615722656 -76.4668451944987 190.80018615722656 -73.80017852783203 curveto
190.80018615722656 -61.000179290771484 lineto
190.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -194.80018615722656 moveto
17.800180435180664 -194.80018615722656 16.800180435180664 -196.46685282389322 16.800180435180664 -199.80018615722656 curveto
16.800180435180664 -210.80018615722656 lineto
94.80017852783203 -210.80018615722656 lineto
94.80017852783203 -199.80018615722656 lineto
94.80017852783203 -196.46685282389322 93.80017852783203 -194.80018615722656 91.80017852783203 -194.80018615722656 curveto
19.800180435180664 -194.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -213.80018615722656 moveto
16.800180435180664 -248.80018615722656 lineto
94.80017852783203 -248.80018615722656 lineto
94.80017852783203 -213.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -194.80018615722656 moveto
113.80017852783203 -194.80018615722656 112.80017852783203 -196.46685282389322 112.80017852783203 -199.80018615722656 curveto
112.80017852783203 -210.80018615722656 lineto
190.80018615722656 -210.80018615722656 lineto
190.80018615722656 -199.80018615722656 lineto
190.80018615722656 -196.46685282389322 189.80018615722656 -194.80018615722656 187.80018615722656 -194.80018615722656 curveto
115.80017852783203 -194.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -213.80018615722656 moveto
112.80017852783203 -248.80018615722656 lineto
190.80018615722656 -248.80018615722656 lineto
190.80018615722656 -213.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -194.80018615722656 moveto
209.80018615722656 -194.80018615722656 208.80018615722656 -196.46685282389322 208.80018615722656 -199.80018615722656 curveto
208.80018615722656 -210.80018615722656 lineto
286.8001708984375 -210.80018615722656 lineto
286.8001708984375 -199.80018615722656 lineto
286.8001708984375 -196.46685282389322 285.8001708984375 -194.80018615722656 283.8001708984375 -194.80018615722656 curveto
211.80018615722656 -194.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -213.80018615722656 moveto
208.80018615722656 -248.80018615722656 lineto
286.8001708984375 -248.80018615722656 lineto
286.8001708984375 -213.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -193.0 moveto
16.0 -193.0 15.0 -194.66666666666666 15.0 -198.0 curveto
15.0 -209.0 lineto
93.0 -209.0 lineto
93.0 -198.0 lineto
93.0 -194.66666666666666 92.0 -193.0 90.0 -193.0 curveto
18.0 -193.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -193.0 moveto
16.0 -193.0 15.0 -194.66666666666666 15.0 -198.0 curveto
15.0 -209.0 lineto
93.0 -209.0 lineto
93.0 -198.0 lineto
93.0 -194.66666666666666 92.0 -193.0 90.0 -193.0 curveto
18.0 -193.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -212.0 moveto
15.0 -247.0 lineto
93.0 -247.0 lineto
93.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -212.0 moveto
15.0 -247.0 lineto
93.0 -247.0 lineto
93.0 -212.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -193.0 moveto
112.0 -193.0 111.0 -194.66666666666666 111.0 -198.0 curveto
111.0 -209.0 lineto
189.0 -209.0 lineto
189.0 -198.0 lineto
189.0 -194.66666666666666 188.0 -193.0 186.0 -193.0 curveto
114.0 -193.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -193.0 moveto
112.0 -193.0 111.0 -194.66666666666666 111.0 -198.0 curveto
111.0 -209.0 lineto
189.0 -209.0 lineto
189.0 -198.0 lineto
189.0 -194.66666666666666 188.0 -193.0 186.0 -193.0 curveto
114.0 -193.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -212.0 moveto
111.0 -247.0 lineto
189.0 -247.0 lineto
189.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -212.0 moveto
111.0 -247.0 lineto
189.0 -247.0 lineto
189.0 -212.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -193.0 moveto
208.0 -193.0 207.0 -194.66666666666666 207.0 -198.0 curveto
207.0 -209.0 lineto
285.0 -209.0 lineto
285.0 -198.0 lineto
285.0 -194.66666666666666 284.0 -193.0 282.0 -193.0 curveto
210.0 -193.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -193.0 moveto
208.0 -193.0 207.0 -194.66666666666666 207.0 -198.0 curveto
207.0 -209.0 lineto
285.0 -209.0 lineto
285.0 -198.0 lineto
285.0 -194.66666666666666 284.0 -193.0 282.0 -193.0 curveto
210.0 -193.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -212.0 moveto
207.0 -247.0 lineto
285.0 -247.0 lineto
285.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -212.0 moveto
207.0 -247.0 lineto
285.0 -247.0 lineto
285.0 -212.0 lineto
closepath
stroke
newpath
48.0 -171.0 moveto
51.0 -180.0 lineto
54.0 -171.0 lineto
closepath
fill
newpath
144.0 -171.0 moveto
147.0 -180.0 lineto
150.0 -171.0 lineto
closepath
fill
newpath
240.0 -171.0 moveto
243.0 -180.0 lineto
246.0 -171.0 lineto
closepath
fill
newpath
147.0 -94.0 moveto
147.0 -130.0 lineto
stroke
newpath
51.0 -175.0 moveto
51.0 -130.0 lineto
147.0 -130.0 lineto
stroke
newpath
147.0 -175.0 moveto
147.0 -130.0 lineto
stroke
newpath
243.0 -175.0 moveto
243.0 -130.0 lineto
147.0 -130.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
125.0 -44.0 moveto
(Publisher) show
139.0 -71.0 moveto
(PUB) show
134.0 -89.0 moveto
(bind) show
128.0 -116.0 moveto
(updates) show
32.0 -152.0 moveto
(updates) show
128.0 -152.0 moveto
(updates) show
224.0 -152.0 moveto
(updates) show
32.0 -188.0 moveto
(connect) show
128.0 -188.0 moveto
(connect) show
224.0 -188.0 moveto
(connect) show
43.0 -206.0 moveto
(SUB) show
139.0 -206.0 moveto
(SUB) show
235.0 -206.0 moveto
(SUB) show
29.0 -233.0 moveto
(Subscriber) show
125.0 -233.0 moveto
(Subscriber) show
221.0 -233.0 moveto
(Subscriber) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3036 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3036 a -2 3202 a
SDict begin H.S end
 -2 3202
a -2 3202 a
SDict begin 13 H.A end
 -2 3202 a -2 3202 a
SDict begin [/View [/XYZ H.V]/Dest (0:216) cvn /DEST pdfmark end
 -2 3202 a 396 3310 a
Fk(Here)h(is)h(client)g(application,)d(which)i(listens)h(to)f(the)g
(stream)g(of)g(updates)g(and)f(grabs)h(an)o(ything)e(to)i(do)g(with)g
(a)396 3418 y(speci\002ed)g(zip)g(code,)g(by)f(def)o(ault)h(Ne)n(w)g(Y)
-9 b(ork)20 b(City)g(because)g(that')-5 b(s)21 b(a)f(great)g(place)g
(to)g(start)h(an)o(y)e(adv)o(enture:)-2 3436 y
SDict begin H.S end
 -2 3436
a -2 3436 a
SDict begin 13 H.A end
 -2 3436 a -2 3436 a
SDict begin [/View [/XYZ H.V]/Dest (0:wuclient-c) cvn /DEST pdfmark
end
 -2 3436 a 396 3620 a
Fg(Example)i(1-7.)e(W)-5 b(eather)19 b(update)h(client)h
(\(wuclient.c\))-2 3719 y
SDict begin H.S end
 -2 3719 a -2 3719 a
SDict begin 11.7 H.A end
 -2 3719
a -2 3719 a
SDict begin [/View [/XYZ H.V]/Dest (0:219) cvn /DEST pdfmark end
 -2 3719 a 396 3800 a Fe(//)396 3897 y(//)90
b(Weather)43 b(update)h(client)396 3994 y(//)90 b(Connects)43
b(SUB)h(socket)g(to)h(tcp://localhost:5556)396 4091 y(//)90
b(Collects)43 b(weather)h(updates)f(and)i(finds)f(avg)g(temp)g(in)h
(zipcode)396 4188 y(//)396 4285 y(#include)f("zhelpers.h")396
4480 y(int)h(main)f(\(int)g(argc,)g(char)1517 4493 y(*)1562
4480 y(argv)g([]\))396 4577 y({)576 4674 y(void)800 4687
y(*)845 4674 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
4868 y(//)89 b(Socket)44 b(to)g(talk)g(to)h(server)576
4965 y(printf)e(\("Collecting)g(updates)h(from)g(weather)g
(server...\\n"\);)576 5062 y(void)800 5075 y(*)845 5062
y(subscriber)f(=)h(zmq_socket)g(\(context,)f(ZMQ_SUB\);)576
5160 y(int)h(rc)g(=)h(zmq_connect)e(\(subscriber,)g
("tcp://localhost:5556"\);)p Black 3800 5569 a Ff(11)p
Black eop end
%%Page: 12 25
TeXDict begin 12 24 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.12) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 72 a Fe(assert)43 b(\(rc)i(==)f(0\);)576 267
y(//)89 b(Subscribe)43 b(to)i(zipcode,)e(default)h(is)g(NYC,)h(10001)
576 364 y(char)800 377 y(*)845 364 y(filter)e(=)i(\(argc)f(>)h(1\)?)f
(argv)g([1]:)g("10001)g(";)576 461 y(rc)g(=)h(zmq_setsockopt)d
(\(subscriber,)h(ZMQ_SUBSCRIBE,)g(filter,)g(strlen)h(\(filter\)\);)576
558 y(assert)f(\(rc)i(==)f(0\);)576 752 y(//)89 b(Process)44
b(100)g(updates)576 850 y(int)g(update_nbr;)576 947 y(long)g
(total_temp)f(=)i(0;)576 1044 y(for)f(\(update_nbr)f(=)i(0;)f
(update_nbr)f(<)i(100;)f(update_nbr++\))f({)755 1141
y(char)979 1154 y(*)1024 1141 y(string)h(=)g(s_recv)g(\(subscriber\);)
755 1335 y(int)g(zipcode,)g(temperature,)f(relhumidity;)755
1432 y(sscanf)h(\(string,)f("\045d)i(\045d)f(\045d",)934
1530 y(&zipcode,)g(&temperature,)e(&relhumidity\);)755
1627 y(total_temp)h(+=)i(temperature;)755 1724 y(free)f(\(string\);)576
1821 y(})576 1918 y(printf)f(\("Average)h(temperature)f(for)h(zipcode)g
('\045s')g(was)g(\045dF\\n",)755 2015 y(filter,)g(\(int\))g
(\(total_temp)f(/)h(update_nbr\)\);)576 2209 y(zmq_close)f
(\(subscriber\);)576 2307 y(zmq_ctx_destroy)f(\(context\);)576
2404 y(return)h(0;)396 2501 y(})-2 2675 y
SDict begin H.S end
 -2 2675 a -2
2675 a
SDict begin 13 H.A end
 -2 2675 a -2 2675 a
SDict begin [/View [/XYZ H.V]/Dest (0:220) cvn /DEST pdfmark end
 -2 2675 a 396 2775 a Fk(Note)20
b(that)h(when)e(you)h(use)g(a)h(SUB)g(sock)o(et)f(you)1818
2775 y
SDict begin H.S end
 1818 2775 a 1818 2775 a
SDict begin 13 H.A end
 1818 2775 a 1818 2775
a
SDict begin [/View [/XYZ H.V]/Dest (0:221) cvn /DEST pdfmark end
 1818 2775 a Fg(must)h Fk(set)g(a)g(subscription)d(using)i
(zmq_setsock)o(opt[3])d(and)396 2883 y(SUBSCRIBE,)22
b(as)f(in)f(this)h(code.)e(If)h(you)f(don')o(t)g(set)i(an)o(y)e
(subscription,)g(you)g(w)o(on')o(t)g(get)h(an)o(y)g(messages.)g(It')-5
b(s)21 b(a)396 2991 y(common)e(mistak)o(e)h(for)f(be)o(ginners.)f(The)i
(subscriber)f(can)h(set)h(man)o(y)e(subscriptions,)g(which)h(are)g
(added)f(together)-5 b(.)396 3099 y(That)20 b(is,)h(if)g(a)f(update)f
(matches)h(ANY)h(subscription,)d(the)i(subscriber)f(recei)n(v)o(es)h
(it.)g(The)g(subscriber)f(can)h(also)396 3207 y(unsubscribe)f
(speci\002c)h(subscriptions.)f(Subscriptions)f(are)j
(length-speci\002ed)d(blobs.)h(See)i(zmq_setsock)o(opt[3])16
b(for)396 3314 y(ho)n(w)k(this)h(w)o(orks.)-2 3481 y
SDict begin H.S end

-2 3481 a -2 3481 a
SDict begin 13 H.A end
 -2 3481 a -2 3481 a
SDict begin [/View [/XYZ H.V]/Dest (0:222) cvn /DEST pdfmark end
 -2 3481 a 396
3588 a Fk(The)f(PUB-SUB)h(sock)o(et)g(pair)e(is)i(asynchronous.)d(The)h
(client)i(does)f(zmq_msg_recv[3],)15 b(in)20 b(a)h(loop)e(\(or)h(once)g
(if)396 3696 y(that')-5 b(s)21 b(all)g(it)g(needs\).)e(T)m(rying)g(to)h
(send)g(a)h(message)f(to)g(a)h(SUB)g(sock)o(et)f(will)h(cause)f(an)g
(error)-5 b(.)19 b(Similarly)h(the)g(service)396 3804
y(does)g(zmq_msg_send[3])c(as)21 b(often)f(as)h(it)f(needs)g(to,)g(b)n
(ut)h(must)f(not)g(do)f(zmq_msg_recv[3])d(on)k(a)h(PUB)g(sock)o(et.)-2
3988 y
SDict begin H.S end
 -2 3988 a -2 3988 a
SDict begin 13 H.A end
 -2 3988 a -2 3988 a
SDict begin [/View [/XYZ H.V]/Dest (0:223) cvn /DEST pdfmark end
 -2 3988
a 396 4078 a Fk(In)f(theory)f(with)h(\330MQ)h(sock)o(ets,)f(it)h(does)f
(not)g(matter)g(which)f(end)h(connects,)f(and)g(which)h(end)g(binds.)f
(Ho)n(we)n(v)o(er)g(in)396 4186 y(practice)h(there)f(are)i
(undocumented)16 b(dif)n(ferences)j(that)h(I')o(ll)g(come)g(to)g(later)
-5 b(.)21 b(F)o(or)f(no)n(w)-5 b(,)19 b(bind)g(the)h(PUB)h(and)f
(connect)396 4294 y(the)g(SUB,)h(unless)g(your)e(netw)o(ork)g(design)g
(mak)o(es)h(that)h(impossible.)-2 4478 y
SDict begin H.S end
 -2 4478 a -2
4478 a
SDict begin 13 H.A end
 -2 4478 a -2 4478 a
SDict begin [/View [/XYZ H.V]/Dest (0:224) cvn /DEST pdfmark end
 -2 4478 a 396 4568 a Fk(There)f(is)h(one)e
(more)h(important)e(thing)i(to)g(kno)n(w)f(about)h(PUB-SUB)h(sock)o
(ets:)f(you)g(do)f(not)h(kno)n(w)f(precisely)h(when)f(a)396
4676 y(subscriber)g(starts)i(to)f(get)g(messages.)g(Ev)o(en)e(if)j(you)
e(start)h(a)h(subscriber)m(,)d(w)o(ait)i(a)h(while,)e(and)h(then)f
(start)i(the)f(publisher)m(,)396 4784 y
SDict begin H.S end
 396 4784 a 396
4784 a
SDict begin 13 H.A end
 396 4784 a 396 4784 a
SDict begin [/View [/XYZ H.V]/Dest (0:225) cvn /DEST pdfmark end
 396 4784 a Fg(the)h(subscriber)g(will)g
(always)f(miss)h(the)g(\002rst)f(messages)h(that)f(the)g(publisher)i
(sends)p Fk(.)f(This)f(is)h(because)f(as)h(the)396 4892
y(subscriber)e(connects)g(to)i(the)f(publisher)f(\(something)f(that)i
(tak)o(es)h(a)g(small)f(b)n(ut)g(non-zero)e(time\),)i(the)g(publisher)f
(may)396 5000 y(already)g(be)h(sending)g(messages)g(out.)p
Black 3800 5569 a Ff(12)p Black eop end
%%Page: 13 26
TeXDict begin 13 25 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.13) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:248) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:226) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(This)h("slo)n(w)f(joiner")f(symptom)g(hits)i(enough)d
(people,)h(often)g(enough,)f(that)i(I'm)g(going)f(to)h(e)o(xplain)f(it)
i(in)g(detail.)396 180 y(Remember)e(that)i(\330MQ)f(does)g
(asynchronous)d(I/O,)j(i.e.)h(in)f(the)g(background.)d(Say)j(you)f(ha)n
(v)o(e)h(tw)o(o)g(nodes)g(doing)f(this,)396 288 y(in)i(this)f(order:)-2
289 y
SDict begin H.S end
 -2 289 a -2 289 a
SDict begin 13 H.A end
 -2 289 a -2 289 a
SDict begin [/View [/XYZ H.V]/Dest (0:227) cvn /DEST pdfmark end
 -2 289 a -2
299 a
SDict begin H.S end
 -2 299 a -2 299 a
SDict begin 13 H.A end
 -2 299 a -2 299 a
SDict begin [/View [/XYZ H.V]/Dest (0:228) cvn /DEST pdfmark end
 -2 299 a Black
396 459 a Fj(\225)p Black 479 459 a
SDict begin H.S end
 479 459 a 479 459
a
SDict begin 13 H.A end
 479 459 a 479 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:229) cvn /DEST pdfmark end
 479 459 a Fk(Subscriber)f(connects)g(to)i(an)f
(endpoint)e(and)i(recei)n(v)o(es)f(and)h(counts)f(messages.)-2
477 y
SDict begin H.S end
 -2 477 a -2 477 a
SDict begin 13 H.A end
 -2 477 a -2 477 a
SDict begin [/View [/XYZ H.V]/Dest (0:230) cvn /DEST pdfmark end
 -2 477 a Black
396 608 a Fj(\225)p Black 479 608 a
SDict begin H.S end
 479 608 a 479 608
a
SDict begin 13 H.A end
 479 608 a 479 608 a
SDict begin [/View [/XYZ H.V]/Dest (0:231) cvn /DEST pdfmark end
 479 608 a Fk(Publisher)h(binds)f(to)i(an)f
(endpoint)e(and)i(immediately)f(sends)h(1,000)e(messages.)-2
792 y
SDict begin H.S end
 -2 792 a -2 792 a
SDict begin 13 H.A end
 -2 792 a -2 792 a
SDict begin [/View [/XYZ H.V]/Dest (0:232) cvn /DEST pdfmark end
 -2 792 a 396
882 a Fk(Then)i(the)g(subscriber)f(will)i(most)f(lik)o(ely)g(not)g
(recei)n(v)o(e)f(an)o(ything.)f(Y)-9 b(ou')o(ll)19 b(blink,)h(check)f
(that)h(you)g(set)h(a)f(correct)f(\002lter)m(,)396 990
y(and)h(try)g(again,)f(and)g(the)i(subscriber)e(will)i(still)g(not)f
(recei)n(v)o(e)f(an)o(ything.)-2 1174 y
SDict begin H.S end
 -2 1174 a -2
1174 a
SDict begin 13 H.A end
 -2 1174 a -2 1174 a
SDict begin [/View [/XYZ H.V]/Dest (0:233) cvn /DEST pdfmark end
 -2 1174 a 396 1264 a Fk(Making)g(a)i(TCP)g
(connection)d(in)m(v)n(olv)o(es)h(to)h(and)g(fro)f(handshaking)f(that)i
(tak)o(es)h(se)n(v)o(eral)e(milliseconds)h(depending)d(on)396
1372 y(your)i(netw)o(ork)g(and)h(the)g(number)e(of)i(hops)g(between)f
(peers.)h(In)g(that)g(time,)g(\330MQ)h(can)f(send)g(v)o(ery)f(man)o(y)g
(messages.)396 1480 y(F)o(or)h(sak)o(e)h(of)e(ar)o(gument)f(assume)i
(it)h(tak)o(es)g(5)f(msecs)h(to)f(establish)h(a)f(connection,)e(and)i
(that)g(same)g(link)g(can)g(handle)396 1588 y(1M)g(messages)h(per)e
(second.)g(During)g(the)i(5)f(msecs)h(that)f(the)g(subscriber)f(is)i
(connecting)d(to)j(the)f(publisher)m(,)e(it)j(tak)o(es)396
1696 y(the)f(publisher)f(only)h(1)g(msec)g(to)h(send)f(out)f(those)h
(1K)h(messages.)-2 1880 y
SDict begin H.S end
 -2 1880 a -2 1880 a
SDict begin 13 H.A end
 -2 1880
a -2 1880 a
SDict begin [/View [/XYZ H.V]/Dest (0:234) cvn /DEST pdfmark end
 -2 1880 a 396 1970 a Fk(In)f(Chapter)g(T)-7
b(w)o(o)20 b(I')o(ll)h(e)o(xplain)e(ho)n(w)g(to)i(synchronize)c(a)k
(publisher)e(and)g(subscribers)h(so)g(that)h(you)e(don')o(t)f(start)j
(to)396 2077 y(publish)f(data)g(until)g(the)g(subscriber\(s\))e(really)
i(are)g(connected)f(and)g(ready)-5 b(.)19 b(There)g(is)i(a)g(simple)f
(and)g(stupid)f(w)o(ay)i(to)396 2185 y(delay)f(the)g(publisher)m(,)e
(which)i(is)h(to)f(sleep.)g(I')l(d)f(ne)n(v)o(er)g(do)h(this)g(in)h(a)f
(real)g(application)f(though,)f(it)j(is)g(e)o(xtremely)e(fragile)396
2293 y(as)i(well)g(as)g(inele)o(gant)d(and)i(slo)n(w)-5
b(.)20 b(Use)h(sleeps)f(to)h(pro)o(v)o(e)d(to)i(yourself)f(what')-5
b(s)21 b(happening,)c(and)j(then)f(w)o(ait)i(for)396
2401 y(Chapter)f(2)g(to)g(see)h(ho)n(w)f(to)g(do)g(this)h(right.)-2
2585 y
SDict begin H.S end
 -2 2585 a -2 2585 a
SDict begin 13 H.A end
 -2 2585 a -2 2585 a
SDict begin [/View [/XYZ H.V]/Dest (0:235) cvn /DEST pdfmark end
 -2 2585
a 396 2675 a Fk(The)f(alternati)n(v)o(e)f(to)h(synchronization)d(is)22
b(to)e(simply)g(assume)g(that)g(the)g(published)f(data)h(stream)g(is)h
(in\002nite)f(and)g(has)396 2783 y(no)g(start,)h(and)e(no)h(end.)f
(This)i(is)g(ho)n(w)e(we)i(b)n(uilt)f(our)g(weather)f(client)i(e)o
(xample.)-2 2967 y
SDict begin H.S end
 -2 2967 a -2 2967 a
SDict begin 13 H.A end
 -2 2967 a -2 2967
a
SDict begin [/View [/XYZ H.V]/Dest (0:236) cvn /DEST pdfmark end
 -2 2967 a 396 3057 a Fk(So)g(the)f(client)g(subscribes)g(to)g(its)h
(chosen)f(zip)g(code)f(and)h(collects)g(a)h(thousand)d(updates)i(for)f
(that)i(zip)f(code.)f(That)396 3165 y(means)h(about)f(ten)i(million)e
(updates)h(from)f(the)h(serv)o(er)m(,)f(if)h(zip)g(codes)g(are)g
(randomly)e(distrib)n(uted.)h(Y)-9 b(ou)20 b(can)g(start)h(the)396
3273 y(client,)f(and)g(then)g(the)g(serv)o(er)m(,)f(and)g(the)h(client)
h(will)g(k)o(eep)e(w)o(orking.)g(Y)-9 b(ou)19 b(can)h(stop)g(and)g
(restart)g(the)g(serv)o(er)g(as)h(often)396 3381 y(as)g(you)e(lik)o(e,)
i(and)e(the)i(client)f(will)h(k)o(eep)e(w)o(orking.)g(When)h(the)g
(client)g(has)h(collected)e(its)i(thousand)e(updates,)g(it)396
3489 y(calculates)h(the)h(a)n(v)o(erage,)d(prints)i(it,)h(and)e(e)o
(xits.)-2 3673 y
SDict begin H.S end
 -2 3673 a -2 3673 a
SDict begin 13 H.A end
 -2 3673 a -2 3673
a
SDict begin [/View [/XYZ H.V]/Dest (0:237) cvn /DEST pdfmark end
 -2 3673 a 396 3763 a Fk(Some)h(points)g(about)f(the)h
(publish-subscribe)e(pattern:)-2 3781 y
SDict begin H.S end
 -2 3781 a -2
3781 a
SDict begin 13 H.A end
 -2 3781 a -2 3781 a
SDict begin [/View [/XYZ H.V]/Dest (0:238) cvn /DEST pdfmark end
 -2 3781 a -2 3791 a
SDict begin H.S end
 -2 3791
a -2 3791 a
SDict begin 13 H.A end
 -2 3791 a -2 3791 a
SDict begin [/View [/XYZ H.V]/Dest (0:239) cvn /DEST pdfmark end
 -2 3791 a Black 396 3933
a Fj(\225)p Black 479 3933 a
SDict begin H.S end
 479 3933 a 479 3933 a
SDict begin 13 H.A end
 479
3933 a 479 3933 a
SDict begin [/View [/XYZ H.V]/Dest (0:240) cvn /DEST pdfmark end
 479 3933 a Fk(A)j(subscriber)e(can)h(connect)f(to)h
(more)g(than)f(one)h(publisher)m(,)e(using)i(one)f('connect')g(call)h
(each)g(time.)g(Data)h(will)479 4041 y(then)f(arri)n(v)o(e)f(and)h(be)g
(interlea)n(v)o(ed)f(\("f)o(air)n(-queued"\))d(so)21
b(that)f(no)g(single)g(publisher)f(dro)n(wns)g(out)h(the)g(others.)-2
4059 y
SDict begin H.S end
 -2 4059 a -2 4059 a
SDict begin 13 H.A end
 -2 4059 a -2 4059 a
SDict begin [/View [/XYZ H.V]/Dest (0:241) cvn /DEST pdfmark end
 -2 4059
a Black 396 4190 a Fj(\225)p Black 479 4190 a
SDict begin H.S end
 479 4190
a 479 4190 a
SDict begin 13 H.A end
 479 4190 a 479 4190 a
SDict begin [/View [/XYZ H.V]/Dest (0:242) cvn /DEST pdfmark end
 479 4190 a Fk(If)g(a)h(publisher)e
(has)h(no)g(connected)e(subscribers,)h(then)h(it)h(will)g(simply)f
(drop)f(all)h(messages.)-2 4208 y
SDict begin H.S end
 -2 4208 a -2 4208 a
SDict begin 13 H.A end

-2 4208 a -2 4208 a
SDict begin [/View [/XYZ H.V]/Dest (0:243) cvn /DEST pdfmark end
 -2 4208 a Black 396 4340 a Fj(\225)p
Black 479 4340 a
SDict begin H.S end
 479 4340 a 479 4340 a
SDict begin 13 H.A end
 479 4340 a 479
4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:244) cvn /DEST pdfmark end
 479 4340 a Fk(If)g(you')l(re)f(using)g(TCP)-9
b(,)21 b(and)e(a)i(subscriber)e(is)i(slo)n(w)-5 b(,)20
b(messages)g(will)h(queue)e(up)h(on)g(the)g(publisher)-5
b(.)19 b(W)-7 b(e')o(ll)21 b(look)f(at)479 4448 y(ho)n(w)g(to)g
(protect)g(publishers)f(against)g(this,)i(using)e(the)i("high-w)o(ater)
d(mark")h(later)-5 b(.)-2 4466 y
SDict begin H.S end
 -2 4466 a -2 4466 a
SDict begin 13 H.A end

-2 4466 a -2 4466 a
SDict begin [/View [/XYZ H.V]/Dest (0:245) cvn /DEST pdfmark end
 -2 4466 a Black 396 4597 a Fj(\225)p
Black 479 4597 a
SDict begin H.S end
 479 4597 a 479 4597 a
SDict begin 13 H.A end
 479 4597 a 479
4597 a
SDict begin [/View [/XYZ H.V]/Dest (0:246) cvn /DEST pdfmark end
 479 4597 a Fk(From)20 b(\330MQ)g(3.x,)g(\002ltering)f(happens)g
(at)i(the)f(publisher)f(side,)h(when)g(using)f(a)i(connected)d
(protocol)h(\(tcp://)h(or)479 4705 y(ipc://\).)g(Using)g(the)g(epgm://)
g(protocol,)e(\002ltering)i(happens)f(at)h(the)h(subscriber)d(side.)j
(In)f(\330MQ/2.x,)f(all)h(\002ltering)479 4813 y(happened)e(at)j(the)f
(subscriber)f(side.)p Black 3800 5569 a Ff(13)p Black
eop end
%%Page: 14 27
TeXDict begin 14 26 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.14) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:247) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(This)h(is)g(ho)n(w)e(long)h(it)h(tak)o(es)f(to)h
(recei)n(v)o(e)e(and)g(\002lter)i(10M)e(messages)i(on)f(my)f(laptop,)h
(which)f(is)i(an)f(2011-era)e(Intel)i(I7,)396 180 y(f)o(ast)h(b)n(ut)f
(nothing)f(special:)396 361 y Fe
(ph@nb201103:~/work/git/zguide/examples/c$)38 b(time)44
b(wuclient)396 458 y(Collecting)f(updates)h(from)g(weather)g(server...)
396 555 y(Average)g(temperature)f(for)h(zipcode)g('10001)g(')g(was)h
(28F)396 749 y(real)179 b(0m4.470s)396 846 y(user)g(0m0.000s)396
943 y(sys)224 b(0m0.008s)-2 1038 y
SDict begin H.S end
 -2 1038 a -2 1038
a
SDict begin 13 H.A end
 -2 1038 a -2 1038 a
SDict begin [/View [/XYZ H.V]/Dest (0:249) cvn /DEST pdfmark end
 -2 1038 a 366 x Fn(1.9.)39 b(Divide)f(and)h
(Conquer)1634 1404 y
SDict begin H.S end
 1634 1404 a 1634 1404 a
SDict begin 22.464 H.A end
 1634 1404
a 1634 1404 a
SDict begin [/View [/XYZ H.V]/Dest (6.13.1) cvn /DEST pdfmark end
 1634 1404 a -2 1599 a
SDict begin H.S end
 -2 1599 a -2 1599
a
SDict begin 13 H.A end
 -2 1599 a -2 1599 a
SDict begin [/View [/XYZ H.V]/Dest (0:251) cvn /DEST pdfmark end
 -2 1599 a 396 1677 a Fk(As)21 b(a)g(\002nal)f(e)o
(xample)f(\(you)g(are)h(surely)g(getting)f(tired)h(of)g(juic)o(y)g
(code)f(and)h(w)o(ant)g(to)g(delv)o(e)g(back)f(into)h(philological)396
1785 y(discussions)g(about)f(comparati)n(v)o(e)f(abstracti)n(v)o(e)h
(norms\),)g(let')-5 b(s)21 b(do)f(a)h(little)g(supercomputing.)16
b(Then)k(cof)n(fee.)e(Our)396 1893 y(supercomputing)f(application)i(is)
i(a)f(f)o(airly)g(typical)g(parallel)g(processing)f(model\()p
0 TeXcolorgray 2805 1893 a
SDict begin H.S end
 2805 1893 a Fk(Figure)e(1-5)3152
1893 y
SDict begin 13 H.L end
 3152 1893 a 3152 1893 a
SDict begin [/Subtype /Link/Dest (0:figure-5) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3152 1893 a Black -1 w
Fk(\):)-2 1911 y
SDict begin H.S end
 -2 1911 a -2 1911 a
SDict begin 13 H.A end
 -2 1911 a -2 1911
a
SDict begin [/View [/XYZ H.V]/Dest (0:253) cvn /DEST pdfmark end
 -2 1911 a -2 1921 a
SDict begin H.S end
 -2 1921 a -2 1921 a
SDict begin 13 H.A end
 -2 1921 a -2
1921 a
SDict begin [/View [/XYZ H.V]/Dest (0:254) cvn /DEST pdfmark end
 -2 1921 a Black 396 2064 a Fj(\225)p Black 479
2064 a
SDict begin H.S end
 479 2064 a 479 2064 a
SDict begin 13 H.A end
 479 2064 a 479 2064 a
SDict begin [/View [/XYZ H.V]/Dest (0:255) cvn /DEST pdfmark end
 479
2064 a Fk(W)-7 b(e)22 b(ha)n(v)o(e)d(a)i(v)o(entilator)e(that)h
(produces)e(tasks)j(that)f(can)g(be)h(done)e(in)h(parallel.)-2
2082 y
SDict begin H.S end
 -2 2082 a -2 2082 a
SDict begin 13 H.A end
 -2 2082 a -2 2082 a
SDict begin [/View [/XYZ H.V]/Dest (0:256) cvn /DEST pdfmark end
 -2 2082
a Black 396 2213 a Fj(\225)p Black 479 2213 a
SDict begin H.S end
 479 2213
a 479 2213 a
SDict begin 13 H.A end
 479 2213 a 479 2213 a
SDict begin [/View [/XYZ H.V]/Dest (0:257) cvn /DEST pdfmark end
 479 2213 a Fk(W)-7
b(e)22 b(ha)n(v)o(e)d(a)i(set)g(of)f(w)o(ork)o(ers)f(that)i(process)e
(tasks.)-2 2231 y
SDict begin H.S end
 -2 2231 a -2 2231 a
SDict begin 13 H.A end
 -2 2231 a -2 2231
a
SDict begin [/View [/XYZ H.V]/Dest (0:258) cvn /DEST pdfmark end
 -2 2231 a Black 396 2362 a Fj(\225)p Black 479 2362
a
SDict begin H.S end
 479 2362 a 479 2362 a
SDict begin 13 H.A end
 479 2362 a 479 2362 a
SDict begin [/View [/XYZ H.V]/Dest (0:259) cvn /DEST pdfmark end
 479 2362
a Fk(W)-7 b(e)22 b(ha)n(v)o(e)d(a)i(sink)f(that)g(collects)h(results)f
(back)g(from)f(the)h(w)o(ork)o(er)f(processes.)-2 2546
y
SDict begin H.S end
 -2 2546 a -2 2546 a
SDict begin 13 H.A end
 -2 2546 a -2 2546 a
SDict begin [/View [/XYZ H.V]/Dest (0:260) cvn /DEST pdfmark end
 -2 2546 a 396
2636 a Fk(In)h(reality)-5 b(,)19 b(w)o(ork)o(ers)h(run)f(on)h(superf)o
(ast)g(box)o(es,)f(perhaps)g(using)g(GPUs)i(\(graphic)e(processing)g
(units\))h(to)g(do)g(the)g(hard)396 2744 y(maths.)g(Here)g(is)h(the)g
(v)o(entilator)-5 b(.)18 b(It)j(generates)e(100)g(tasks,)i(each)f(is)h
(a)g(message)f(telling)g(the)g(w)o(ork)o(er)f(to)h(sleep)h(for)396
2852 y(some)f(number)f(of)h(milliseconds:)-2 2853 y
SDict begin H.S end
 -2
2853 a -2 2853 a
SDict begin 13 H.A end
 -2 2853 a -2 2853 a
SDict begin [/View [/XYZ H.V]/Dest (0:taskvent-c) cvn /DEST pdfmark
end
 -2 2853 a 396 3054
a Fg(Example)h(1-8.)e(P)o(arallel)g(task)i(v)o(entilator)e(\(taskv)o
(ent.c\))-2 3153 y
SDict begin H.S end
 -2 3153 a -2 3153 a
SDict begin 11.7 H.A end
 -2 3153 a -2 3153
a
SDict begin [/View [/XYZ H.V]/Dest (0:263) cvn /DEST pdfmark end
 -2 3153 a 396 3234 a Fe(//)396 3331 y(//)90 b(Task)44
b(ventilator)396 3428 y(//)90 b(Binds)44 b(PUSH)g(socket)g(to)g
(tcp://localhost:5557)396 3525 y(//)90 b(Sends)44 b(batch)g(of)g(tasks)
g(to)h(workers)e(via)i(that)f(socket)396 3622 y(//)396
3719 y(#include)g("zhelpers.h")396 3914 y(int)h(main)f(\(void\))396
4011 y({)576 4108 y(void)800 4121 y(*)845 4108 y(context)f(=)i
(zmq_ctx_new)e(\(\);)576 4302 y(//)89 b(Socket)44 b(to)g(send)g
(messages)g(on)576 4399 y(void)800 4412 y(*)845 4399
y(sender)f(=)i(zmq_socket)e(\(context,)h(ZMQ_PUSH\);)576
4497 y(zmq_bind)f(\(sender,)h("tcp://)1698 4510 y(*)1743
4497 y(:5557"\);)576 4691 y(//)89 b(Socket)44 b(to)g(send)g(start)g(of)
h(batch)f(message)g(on)576 4788 y(void)800 4801 y(*)845
4788 y(sink)g(=)g(zmq_socket)g(\(context,)f(ZMQ_PUSH\);)576
4885 y(zmq_connect)g(\(sink,)g("tcp://localhost:5558"\);)576
5079 y(printf)g(\("Press)h(Enter)g(when)g(the)h(workers)e(are)i(ready:)
e("\);)p Black 3800 5569 a Ff(14)p Black eop end
%%Page: 15 28
TeXDict begin 15 27 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.15) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:269) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 72 a Fe(getchar)43 b(\(\);)576 170 y(printf)g(\("Sending)h
(tasks)g(to)g(workers...\\n"\);)576 364 y(//)89 b(The)44
b(first)g(message)g(is)g("0")h(and)f(signals)g(start)g(of)g(batch)576
461 y(s_send)f(\(sink,)h("0"\);)576 655 y(//)89 b(Initialize)43
b(random)h(number)g(generator)576 752 y(srandom)f(\(\(unsigned\))g
(time)h(\(NULL\)\);)576 947 y(//)89 b(Send)44 b(100)g(tasks)576
1044 y(int)g(task_nbr;)576 1141 y(int)g(total_msec)f(=)i(0;)224
b(//)89 b(Total)44 b(expected)f(cost)i(in)f(msecs)576
1238 y(for)g(\(task_nbr)f(=)i(0;)f(task_nbr)g(<)h(100;)f(task_nbr++\))f
({)755 1335 y(int)h(workload;)755 1432 y(//)89 b(Random)44
b(workload)g(from)g(1)g(to)h(100msecs)755 1530 y(workload)e(=)i(randof)
f(\(100\))g(+)h(1;)755 1627 y(total_msec)e(+=)i(workload;)755
1724 y(char)f(string)g([10];)755 1821 y(sprintf)g(\(string,)f("\045d",)
h(workload\);)755 1918 y(s_send)g(\(sender,)f(string\);)576
2015 y(})576 2112 y(printf)g(\("Total)h(expected)g(cost:)g(\045d)g
(msec\\n",)g(total_msec\);)576 2209 y(sleep)g(\(1\);)627
b(//)89 b(Give)44 b(0MQ)g(time)h(to)f(deliver)576 2404
y(zmq_close)f(\(sink\);)576 2501 y(zmq_close)g(\(sender\);)576
2598 y(zmq_ctx_destroy)f(\(context\);)576 2695 y(return)h(0;)396
2792 y(})-2 2800 y
SDict begin H.S end
 -2 2800 a -2 2800 a
SDict begin 13 H.A end
 -2 2800 a -2 2800
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-5) cvn /DEST pdfmark end
 -2 2800 a Black 3800 5569 a Ff(15)p Black eop end
%%Page: 16 29
TeXDict begin 16 28 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.16) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)g(1-5.)f(P)o(arallel)h(Pipeline)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:266) cvn /DEST pdfmark end
 -2 172 a 396
3439 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3439 a @beginspecial 0 @llx -387 @lly 300
@urx 0 @ury 3000 @rwi @setspecial
%%BeginDocument: images/fig5.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -387 300 0
%%HiResBoundingBox: 0.0 -387.0 300.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -23.800180435180664 moveto
106.80017852783203 -57.80017852783203 lineto
190.80018615722656 -57.80017852783203 lineto
190.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -60.80017852783203 moveto
106.80017852783203 -73.80017852783203 lineto
106.80017852783203 -76.4668451944987 107.80017852783203 -77.80017852783203 109.80017852783203 -77.80017852783203 curveto
187.80018615722656 -77.80017852783203 lineto
187.80018615722656 -77.80017852783203 lineto
189.80018615722656 -77.80017852783203 190.80018615722656 -76.4668451944987 190.80018615722656 -73.80017852783203 curveto
190.80018615722656 -61.000179290771484 lineto
190.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -158.80018615722656 moveto
17.800180435180664 -158.80018615722656 16.800180435180664 -160.46685282389322 16.800180435180664 -163.80018615722656 curveto
16.800180435180664 -174.80018615722656 lineto
94.80017852783203 -174.80018615722656 lineto
94.80017852783203 -163.80018615722656 lineto
94.80017852783203 -160.46685282389322 93.80017852783203 -158.80018615722656 91.80017852783203 -158.80018615722656 curveto
19.800180435180664 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -158.80018615722656 moveto
113.80017852783203 -158.80018615722656 112.80017852783203 -160.46685282389322 112.80017852783203 -163.80018615722656 curveto
112.80017852783203 -174.80018615722656 lineto
190.80018615722656 -174.80018615722656 lineto
190.80018615722656 -163.80018615722656 lineto
190.80018615722656 -160.46685282389322 189.80018615722656 -158.80018615722656 187.80018615722656 -158.80018615722656 curveto
115.80017852783203 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -158.80018615722656 moveto
209.80018615722656 -158.80018615722656 208.80018615722656 -160.46685282389322 208.80018615722656 -163.80018615722656 curveto
208.80018615722656 -174.80018615722656 lineto
286.8001708984375 -174.80018615722656 lineto
286.8001708984375 -163.80018615722656 lineto
286.8001708984375 -160.46685282389322 285.8001708984375 -158.80018615722656 283.8001708984375 -158.80018615722656 curveto
211.80018615722656 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -177.80018615722656 moveto
16.800180435180664 -210.80018615722656 lineto
94.80017852783203 -210.80018615722656 lineto
94.80017852783203 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -177.80018615722656 moveto
112.80017852783203 -210.80018615722656 lineto
190.80018615722656 -210.80018615722656 lineto
190.80018615722656 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -177.80018615722656 moveto
208.80018615722656 -210.80018615722656 lineto
286.8001708984375 -210.80018615722656 lineto
286.8001708984375 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -213.80018615722656 moveto
16.800180435180664 -226.80018615722656 lineto
16.800180435180664 -229.46685282389322 17.800180435180664 -230.80018615722656 19.800180435180664 -230.80018615722656 curveto
91.80017852783203 -230.80018615722656 lineto
91.80017852783203 -230.80018615722656 lineto
93.80017852783203 -230.80018615722656 94.80017852783203 -229.46685282389322 94.80017852783203 -226.80018615722656 curveto
94.80017852783203 -214.00018310546875 lineto
94.80017852783203 -213.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -213.80018615722656 moveto
112.80017852783203 -226.80018615722656 lineto
112.80017852783203 -229.46685282389322 113.80017852783203 -230.80018615722656 115.80017852783203 -230.80018615722656 curveto
187.80018615722656 -230.80018615722656 lineto
187.80018615722656 -230.80018615722656 lineto
189.80018615722656 -230.80018615722656 190.80018615722656 -229.46685282389322 190.80018615722656 -226.80018615722656 curveto
190.80018615722656 -214.00018310546875 lineto
190.80018615722656 -213.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -213.80018615722656 moveto
208.80018615722656 -226.80018615722656 lineto
208.80018615722656 -229.46685282389322 209.80018615722656 -230.80018615722656 211.80018615722656 -230.80018615722656 curveto
283.8001708984375 -230.80018615722656 lineto
283.8001708984375 -230.80018615722656 lineto
285.8001708984375 -230.80018615722656 286.8001708984375 -229.46685282389322 286.8001708984375 -226.80018615722656 curveto
286.8001708984375 -214.00018310546875 lineto
286.8001708984375 -213.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
109.80017852783203 -311.8001708984375 moveto
107.80017852783203 -311.8001708984375 106.80017852783203 -313.4668375651042 106.80017852783203 -316.8001708984375 curveto
106.80017852783203 -327.8001708984375 lineto
190.80018615722656 -327.8001708984375 lineto
190.80018615722656 -316.8001708984375 lineto
190.80018615722656 -313.4668375651042 189.80018615722656 -311.8001708984375 187.80018615722656 -311.8001708984375 curveto
109.80017852783203 -311.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -330.8001708984375 moveto
106.80017852783203 -365.8001708984375 lineto
190.80018615722656 -365.8001708984375 lineto
190.80018615722656 -330.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -157.0 moveto
16.0 -157.0 15.0 -158.66666666666666 15.0 -162.0 curveto
15.0 -173.0 lineto
93.0 -173.0 lineto
93.0 -162.0 lineto
93.0 -158.66666666666666 92.0 -157.0 90.0 -157.0 curveto
18.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -157.0 moveto
16.0 -157.0 15.0 -158.66666666666666 15.0 -162.0 curveto
15.0 -173.0 lineto
93.0 -173.0 lineto
93.0 -162.0 lineto
93.0 -158.66666666666666 92.0 -157.0 90.0 -157.0 curveto
18.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -157.0 moveto
112.0 -157.0 111.0 -158.66666666666666 111.0 -162.0 curveto
111.0 -173.0 lineto
189.0 -173.0 lineto
189.0 -162.0 lineto
189.0 -158.66666666666666 188.0 -157.0 186.0 -157.0 curveto
114.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -157.0 moveto
112.0 -157.0 111.0 -158.66666666666666 111.0 -162.0 curveto
111.0 -173.0 lineto
189.0 -173.0 lineto
189.0 -162.0 lineto
189.0 -158.66666666666666 188.0 -157.0 186.0 -157.0 curveto
114.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -157.0 moveto
208.0 -157.0 207.0 -158.66666666666666 207.0 -162.0 curveto
207.0 -173.0 lineto
285.0 -173.0 lineto
285.0 -162.0 lineto
285.0 -158.66666666666666 284.0 -157.0 282.0 -157.0 curveto
210.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -157.0 moveto
208.0 -157.0 207.0 -158.66666666666666 207.0 -162.0 curveto
207.0 -173.0 lineto
285.0 -173.0 lineto
285.0 -162.0 lineto
285.0 -158.66666666666666 284.0 -157.0 282.0 -157.0 curveto
210.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -209.0 lineto
93.0 -209.0 lineto
93.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -209.0 lineto
93.0 -209.0 lineto
93.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -209.0 lineto
189.0 -209.0 lineto
189.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -209.0 lineto
189.0 -209.0 lineto
189.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -176.0 moveto
207.0 -209.0 lineto
285.0 -209.0 lineto
285.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -176.0 moveto
207.0 -209.0 lineto
285.0 -209.0 lineto
285.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -212.0 moveto
15.0 -225.0 lineto
15.0 -227.66666666666666 16.0 -229.0 18.0 -229.0 curveto
90.0 -229.0 lineto
90.0 -229.0 lineto
92.0 -229.0 93.0 -227.66666666666666 93.0 -225.0 curveto
93.0 -212.1999969482422 lineto
93.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -212.0 moveto
15.0 -225.0 lineto
15.0 -227.66666666666666 16.0 -229.0 18.0 -229.0 curveto
90.0 -229.0 lineto
90.0 -229.0 lineto
92.0 -229.0 93.0 -227.66666666666666 93.0 -225.0 curveto
93.0 -212.1999969482422 lineto
93.0 -212.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -212.0 moveto
111.0 -225.0 lineto
111.0 -227.66666666666666 112.0 -229.0 114.0 -229.0 curveto
186.0 -229.0 lineto
186.0 -229.0 lineto
188.0 -229.0 189.0 -227.66666666666666 189.0 -225.0 curveto
189.0 -212.1999969482422 lineto
189.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -212.0 moveto
111.0 -225.0 lineto
111.0 -227.66666666666666 112.0 -229.0 114.0 -229.0 curveto
186.0 -229.0 lineto
186.0 -229.0 lineto
188.0 -229.0 189.0 -227.66666666666666 189.0 -225.0 curveto
189.0 -212.1999969482422 lineto
189.0 -212.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -212.0 moveto
207.0 -225.0 lineto
207.0 -227.66666666666666 208.0 -229.0 210.0 -229.0 curveto
282.0 -229.0 lineto
282.0 -229.0 lineto
284.0 -229.0 285.0 -227.66666666666666 285.0 -225.0 curveto
285.0 -212.1999969482422 lineto
285.0 -212.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -212.0 moveto
207.0 -225.0 lineto
207.0 -227.66666666666666 208.0 -229.0 210.0 -229.0 curveto
282.0 -229.0 lineto
282.0 -229.0 lineto
284.0 -229.0 285.0 -227.66666666666666 285.0 -225.0 curveto
285.0 -212.1999969482422 lineto
285.0 -212.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -310.0 moveto
106.0 -310.0 105.0 -311.6666666666667 105.0 -315.0 curveto
105.0 -326.0 lineto
189.0 -326.0 lineto
189.0 -315.0 lineto
189.0 -311.6666666666667 188.0 -310.0 186.0 -310.0 curveto
108.0 -310.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -310.0 moveto
106.0 -310.0 105.0 -311.6666666666667 105.0 -315.0 curveto
105.0 -326.0 lineto
189.0 -326.0 lineto
189.0 -315.0 lineto
189.0 -311.6666666666667 188.0 -310.0 186.0 -310.0 curveto
108.0 -310.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -329.0 moveto
105.0 -364.0 lineto
189.0 -364.0 lineto
189.0 -329.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -329.0 moveto
105.0 -364.0 lineto
189.0 -364.0 lineto
189.0 -329.0 lineto
closepath
stroke
newpath
48.0 -144.0 moveto
51.0 -153.0 lineto
54.0 -144.0 lineto
closepath
fill
newpath
144.0 -144.0 moveto
147.0 -153.0 lineto
150.0 -144.0 lineto
closepath
fill
newpath
240.0 -144.0 moveto
243.0 -153.0 lineto
246.0 -144.0 lineto
closepath
fill
newpath
144.0 -297.0 moveto
147.0 -306.0 lineto
150.0 -297.0 lineto
closepath
fill
newpath
147.0 -76.0 moveto
147.0 -112.0 lineto
stroke
newpath
51.0 -148.0 moveto
51.0 -112.0 lineto
147.0 -112.0 lineto
stroke
newpath
147.0 -148.0 moveto
147.0 -112.0 lineto
stroke
newpath
243.0 -148.0 moveto
243.0 -112.0 lineto
147.0 -112.0 lineto
stroke
newpath
51.0 -229.0 moveto
51.0 -265.0 lineto
147.0 -265.0 lineto
stroke
newpath
147.0 -229.0 moveto
147.0 -265.0 lineto
stroke
newpath
243.0 -229.0 moveto
243.0 -265.0 lineto
147.0 -265.0 lineto
stroke
newpath
147.0 -301.0 moveto
147.0 -265.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
126.0 -44.0 moveto
(Ventilator) show
133.0 -71.0 moveto
(PUSH) show
134.0 -98.0 moveto
(tasks) show
38.0 -134.0 moveto
(task) show
134.0 -134.0 moveto
(task) show
236.0 -134.0 moveto
(task) show
43.0 -170.0 moveto
(PULL) show
139.0 -170.0 moveto
(PULL) show
235.0 -170.0 moveto
(PULL) show
36.0 -197.0 moveto
(Worker) show
132.0 -197.0 moveto
(Worker) show
228.0 -197.0 moveto
(Worker) show
43.0 -224.0 moveto
(PUSH) show
139.0 -224.0 moveto
(PUSH) show
235.0 -224.0 moveto
(PUSH) show
40.0 -251.0 moveto
(result) show
136.0 -251.0 moveto
(result) show
232.0 -251.0 moveto
(result) show
131.0 -287.0 moveto
(results) show
133.0 -323.0 moveto
(PULL) show
134.0 -350.0 moveto
(Sink) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3439 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3439 a 274 x Fk(Here)g(is)h(the)g(w)o(ork)o
(er)e(application.)f(It)j(recei)n(v)o(es)e(a)i(message,)f(sleeps)g(for)
g(that)g(number)f(of)g(seconds,)h(then)g(signals)g(that)396
3821 y(it')-5 b(s)22 b(\002nished:)-2 3822 y
SDict begin H.S end
 -2 3822
a -2 3822 a
SDict begin 13 H.A end
 -2 3822 a -2 3822 a
SDict begin [/View [/XYZ H.V]/Dest (0:taskwork-c) cvn /DEST pdfmark
end
 -2 3822 a 396 4022 a
Fg(Example)f(1-9.)e(P)o(arallel)g(task)i(w)o(ork)o(er)f(\(taskw)o
(ork.c\))-2 4122 y
SDict begin H.S end
 -2 4122 a -2 4122 a
SDict begin 11.7 H.A end
 -2 4122 a -2 4122
a
SDict begin [/View [/XYZ H.V]/Dest (0:272) cvn /DEST pdfmark end
 -2 4122 a 396 4202 a Fe(//)396 4299 y(//)90 b(Task)44
b(worker)396 4397 y(//)90 b(Connects)43 b(PULL)h(socket)g(to)h
(tcp://localhost:5557)396 4494 y(//)90 b(Collects)43
b(workloads)g(from)i(ventilator)e(via)h(that)g(socket)396
4591 y(//)90 b(Connects)43 b(PUSH)h(socket)g(to)h(tcp://localhost:5558)
396 4688 y(//)90 b(Sends)44 b(results)f(to)i(sink)f(via)g(that)g
(socket)396 4785 y(//)396 4882 y(#include)g("zhelpers.h")396
5076 y(int)h(main)f(\(void\))p Black 3798 5569 a Ff(16)p
Black eop end
%%Page: 17 30
TeXDict begin 17 29 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.17) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fe({)576 170 y(void)800 183 y(*)845 170
y(context)43 b(=)i(zmq_ctx_new)e(\(\);)576 364 y(//)89
b(Socket)44 b(to)g(receive)g(messages)f(on)576 461 y(void)800
474 y(*)845 461 y(receiver)g(=)i(zmq_socket)e(\(context,)g(ZMQ_PULL\);)
576 558 y(zmq_connect)g(\(receiver,)g("tcp://localhost:5557"\);)576
752 y(//)89 b(Socket)44 b(to)g(send)g(messages)g(to)576
850 y(void)800 863 y(*)845 850 y(sender)f(=)i(zmq_socket)e(\(context,)h
(ZMQ_PUSH\);)576 947 y(zmq_connect)f(\(sender,)g
("tcp://localhost:5558"\);)576 1141 y(//)89 b(Process)44
b(tasks)g(forever)576 1238 y(while)g(\(true\))f({)755
1335 y(char)979 1348 y(*)1024 1335 y(string)h(=)g(s_recv)g
(\(receiver\);)755 1432 y(//)89 b(Simple)44 b(progress)g(indicator)f
(for)h(the)h(viewer)755 1530 y(fflush)f(\(stdout\);)755
1627 y(printf)g(\("\045s.",)f(string\);)755 1821 y(//)89
b(Do)45 b(the)f(work)755 1918 y(s_sleep)g(\(atoi)g(\(string\)\);)755
2015 y(free)g(\(string\);)755 2209 y(//)89 b(Send)44
b(results)g(to)h(sink)755 2307 y(s_send)f(\(sender,)f(""\);)576
2404 y(})576 2501 y(zmq_close)g(\(receiver\);)576 2598
y(zmq_close)g(\(sender\);)576 2695 y(zmq_ctx_destroy)f(\(context\);)576
2792 y(return)h(0;)396 2889 y(})-2 3064 y
SDict begin H.S end
 -2 3064 a -2
3064 a
SDict begin 13 H.A end
 -2 3064 a -2 3064 a
SDict begin [/View [/XYZ H.V]/Dest (0:273) cvn /DEST pdfmark end
 -2 3064 a 396 3163 a Fk(Here)20
b(is)h(the)g(sink)f(application.)e(It)j(collects)f(the)g(100)g(tasks,)g
(then)g(calculates)g(ho)n(w)g(long)f(the)h(o)o(v)o(erall)f(processing)
396 3271 y(took,)g(so)i(we)g(can)e(con\002rm)h(that)g(the)g(w)o(ork)o
(ers)g(really)f(were)h(running)e(in)j(parallel,)e(if)i(there)e(are)i
(more)e(than)h(one)f(of)396 3379 y(them:)-2 3380 y
SDict begin H.S end
 -2
3380 a -2 3380 a
SDict begin 13 H.A end
 -2 3380 a -2 3380 a
SDict begin [/View [/XYZ H.V]/Dest (0:tasksink-c) cvn /DEST pdfmark
end
 -2 3380 a 396 3581
a Fg(Example)i(1-10.)d(P)o(arallel)i(task)g(sink)i(\(tasksink.c\))-2
3680 y
SDict begin H.S end
 -2 3680 a -2 3680 a
SDict begin 11.7 H.A end
 -2 3680 a -2 3680 a
SDict begin [/View [/XYZ H.V]/Dest (0:276) cvn /DEST pdfmark end
 -2 3680
a 396 3761 a Fe(//)396 3858 y(//)90 b(Task)44 b(sink)396
3955 y(//)90 b(Binds)44 b(PULL)g(socket)g(to)g(tcp://localhost:5558)396
4052 y(//)90 b(Collects)43 b(results)h(from)g(workers)g(via)g(that)g
(socket)396 4149 y(//)396 4246 y(#include)g("zhelpers.h")396
4441 y(int)h(main)f(\(void\))396 4538 y({)576 4635 y(//)89
b(Prepare)44 b(our)g(context)g(and)g(socket)576 4732
y(void)800 4745 y(*)845 4732 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
4829 y(void)800 4842 y(*)845 4829 y(receiver)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PULL\);)576 4926 y(zmq_bind)g(\(receiver,)g("tcp://)
1787 4939 y(*)1832 4926 y(:5558"\);)576 5121 y(//)89
b(Wait)44 b(for)g(start)g(of)h(batch)p Black 3797 5569
a Ff(17)p Black eop end
%%Page: 18 31
TeXDict begin 18 30 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.18) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 72 a Fe(char)800 85 y(*)845 72 y(string)43
b(=)i(s_recv)f(\(receiver\);)576 170 y(free)g(\(string\);)576
364 y(//)89 b(Start)44 b(our)g(clock)g(now)576 461 y(int64_t)f
(start_time)g(=)i(s_clock)f(\(\);)576 655 y(//)89 b(Process)44
b(100)g(confirmations)576 752 y(int)g(task_nbr;)576 850
y(for)g(\(task_nbr)f(=)i(0;)f(task_nbr)g(<)h(100;)f(task_nbr++\))f({)
755 947 y(char)979 960 y(*)1024 947 y(string)h(=)g(s_recv)g
(\(receiver\);)755 1044 y(free)g(\(string\);)755 1141
y(if)g(\(\(task_nbr)g(/)g(10\))1652 1154 y(*)1741 1141
y(10)h(==)f(task_nbr\))934 1238 y(printf)g(\(":"\);)755
1335 y(else)934 1432 y(printf)g(\("."\);)755 1530 y(fflush)g
(\(stdout\);)576 1627 y(})576 1724 y(//)89 b(Calculate)43
b(and)i(report)e(duration)h(of)g(batch)576 1821 y(printf)f(\("Total)h
(elapsed)g(time:)g(\045d)g(msec\\n",)755 1918 y(\(int\))g(\(s_clock)f
(\(\))i(-)g(start_time\)\);)576 2112 y(zmq_close)e(\(receiver\);)576
2209 y(zmq_ctx_destroy)f(\(context\);)576 2307 y(return)h(0;)396
2404 y(})-2 2578 y
SDict begin H.S end
 -2 2578 a -2 2578 a
SDict begin 13 H.A end
 -2 2578 a -2 2578
a
SDict begin [/View [/XYZ H.V]/Dest (0:277) cvn /DEST pdfmark end
 -2 2578 a 396 2678 a Fk(The)20 b(a)n(v)o(erage)f(cost)i(of)e(a)i
(batch)f(is)h(5)f(seconds.)f(When)h(we)h(start)g(1,)f(2,)g(4)g(w)o(ork)
o(ers)g(we)g(get)g(results)h(lik)o(e)f(this)h(from)e(the)396
2786 y(sink:)-2 2869 y
SDict begin H.S end
 -2 2869 a -2 2869 a
SDict begin 11.7 H.A end
 -2 2869 a
-2 2869 a
SDict begin [/View [/XYZ H.V]/Dest (0:278) cvn /DEST pdfmark end
 -2 2869 a 396 2966 a Fe(#)135 b(1)44 b(worker)396
3063 y(Total)g(elapsed)g(time:)g(5034)g(msec)396 3160
y(#)135 b(2)44 b(workers)396 3257 y(Total)g(elapsed)g(time:)g(2421)g
(msec)396 3354 y(#)135 b(4)44 b(workers)396 3451 y(Total)g(elapsed)g
(time:)g(1018)g(msec)-2 3629 y
SDict begin H.S end
 -2 3629 a -2 3629 a
SDict begin 13 H.A end
 -2
3629 a -2 3629 a
SDict begin [/View [/XYZ H.V]/Dest (0:279) cvn /DEST pdfmark end
 -2 3629 a 396 3725 a Fk(Let')-5 b(s)21
b(look)e(at)i(some)f(aspects)h(of)f(this)g(code)g(in)g(more)f(detail:)
-2 3743 y
SDict begin H.S end
 -2 3743 a -2 3743 a
SDict begin 13 H.A end
 -2 3743 a -2 3743 a
SDict begin [/View [/XYZ H.V]/Dest (0:280) cvn /DEST pdfmark end
 -2
3743 a -2 3753 a
SDict begin H.S end
 -2 3753 a -2 3753 a
SDict begin 13 H.A end
 -2 3753 a -2 3753
a
SDict begin [/View [/XYZ H.V]/Dest (0:281) cvn /DEST pdfmark end
 -2 3753 a Black 396 3896 a Fj(\225)p Black 479 3896
a
SDict begin H.S end
 479 3896 a 479 3896 a
SDict begin 13 H.A end
 479 3896 a 479 3896 a
SDict begin [/View [/XYZ H.V]/Dest (0:282) cvn /DEST pdfmark end
 479 3896
a Fk(The)h(w)o(ork)o(ers)g(connect)f(upstream)g(to)h(the)g(v)o
(entilator)m(,)e(and)i(do)n(wnstream)f(to)h(the)g(sink.)g(This)g(means)
g(you)g(can)g(add)479 4004 y(w)o(ork)o(ers)g(arbitrarily)-5
b(.)18 b(If)i(the)g(w)o(ork)o(ers)g(bound)e(to)i(their)g(endpoints,)f
(you)g(w)o(ould)g(need)h(\(a\))g(more)f(endpoints)g(and)479
4111 y(\(b\))h(to)g(modify)f(the)h(v)o(entilator)f(and/or)g(the)h(sink)
g(each)g(time)g(you)f(added)g(a)i(w)o(ork)o(er)-5 b(.)19
b(W)-7 b(e)22 b(say)e(that)h(the)f(v)o(entilator)479
4219 y(and)g(sink)g(are)g(')-5 b(stable')20 b(parts)h(of)e(our)h
(architecture)e(and)i(the)g(w)o(ork)o(ers)g(are)g(')l(dynamic')e(parts)
i(of)g(it.)-2 4237 y
SDict begin H.S end
 -2 4237 a -2 4237 a
SDict begin 13 H.A end
 -2 4237 a -2
4237 a
SDict begin [/View [/XYZ H.V]/Dest (0:283) cvn /DEST pdfmark end
 -2 4237 a Black 396 4369 a Fj(\225)p Black 479
4369 a
SDict begin H.S end
 479 4369 a 479 4369 a
SDict begin 13 H.A end
 479 4369 a 479 4369 a
SDict begin [/View [/XYZ H.V]/Dest (0:284) cvn /DEST pdfmark end
 479
4369 a Fk(W)-7 b(e)22 b(ha)n(v)o(e)d(to)i(synchronize)c(the)k(start)f
(of)g(the)h(batch)e(with)h(all)h(w)o(ork)o(ers)f(being)f(up)h(and)f
(running.)f(This)j(is)g(a)f(f)o(airly)479 4477 y(common)f(gotcha)g(in)h
(\330MQ)g(and)g(there)g(is)h(no)f(easy)g(solution.)f(The)h('connect')e
(method)h(tak)o(es)i(a)f(certain)g(time.)g(So)479 4585
y(when)g(a)g(set)h(of)f(w)o(ork)o(ers)g(connect)f(to)h(the)g(v)o
(entilator)m(,)f(the)h(\002rst)h(one)e(to)i(successfully)e(connect)g
(will)i(get)f(a)h(whole)479 4693 y(load)f(of)g(messages)g(in)h(that)f
(short)g(time)g(while)g(the)g(others)g(are)g(also)h(connecting.)d(If)i
(you)f(don')o(t)f(synchronize)g(the)479 4801 y(start)j(of)f(the)g
(batch)g(someho)n(w)-5 b(,)18 b(the)i(system)h(w)o(on')o(t)e(run)g(in)h
(parallel)g(at)h(all.)f(T)m(ry)g(remo)o(ving)e(the)i(w)o(ait,)h(and)e
(see.)-2 4819 y
SDict begin H.S end
 -2 4819 a -2 4819 a
SDict begin 13 H.A end
 -2 4819 a -2 4819
a
SDict begin [/View [/XYZ H.V]/Dest (0:285) cvn /DEST pdfmark end
 -2 4819 a Black 396 4950 a Fj(\225)p Black 479 4950
a
SDict begin H.S end
 479 4950 a 479 4950 a
SDict begin 13 H.A end
 479 4950 a 479 4950 a
SDict begin [/View [/XYZ H.V]/Dest (0:286) cvn /DEST pdfmark end
 479 4950
a Fk(The)h(v)o(entilator')-5 b(s)19 b(PUSH)i(sock)o(et)f(distrib)n
(utes)g(tasks)h(to)f(w)o(ork)o(ers)g(\(assuming)f(the)o(y)g(are)i(all)f
(connected)3519 4950 y
SDict begin H.S end
 3519 4950 a 3519 4950 a
SDict begin 13 H.A end
 3519 4950
a 3519 4950 a
SDict begin [/View [/XYZ H.V]/Dest (0:287) cvn /DEST pdfmark end
 3519 4950 a Ff(befor)m(e)f Fk(the)479 5058
y(batch)h(starts)h(going)e(out\))g(e)n(v)o(enly)-5 b(.)18
b(This)j(is)g(called)1958 5058 y
SDict begin H.S end
 1958 5058 a 1958 5058
a
SDict begin 13 H.A end
 1958 5058 a 1958 5058 a
SDict begin [/View [/XYZ H.V]/Dest (0:288) cvn /DEST pdfmark end
 1958 5058 a Ff(load-balancing)16
b Fk(and)k(it')-5 b(s)21 b(something)e(we')o(ll)h(look)g(at)g(again)f
(in)479 5166 y(more)h(detail.)-2 5167 y
SDict begin H.S end
 -2 5167 a -2
5167 a
SDict begin 13 H.A end
 -2 5167 a -2 5167 a
SDict begin [/View [/XYZ H.V]/Dest (0:289) cvn /DEST pdfmark end
 -2 5167 a Black 3800 5569
a Ff(18)p Black eop end
%%Page: 19 32
TeXDict begin 19 31 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.19) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:315) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:290) cvn /DEST pdfmark end
 479 72 a Fk(The)g(sink')-5
b(s)21 b(PULL)f(sock)o(et)g(collects)g(results)h(from)e(w)o(ork)o(ers)h
(e)n(v)o(enly)-5 b(.)18 b(This)i(is)h(called)3002 72
y
SDict begin H.S end
 3002 72 a 3002 72 a
SDict begin 13 H.A end
 3002 72 a 3002 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:291) cvn /DEST pdfmark end
 3002 72 a Ff(fair)n(-queuing)
p Fk(\()p 0 TeXcolorgray 3446 72 a
SDict begin H.S end
 3446 72 a Fk(Figure)c(1-6)3793
72 y
SDict begin 13 H.L end
 3793 72 a 3793 72 a
SDict begin [/Subtype /Link/Dest (0:figure-6) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3793 72 a Black -2 w Fk(\).)-2
90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-6) cvn /DEST pdfmark end
 -2 90 a 396 305
a Fg(Figur)o(e)j(1-6.)f(F)n(air)h(Queuing)-2 405 y
SDict begin H.S end
 -2
405 a -2 405 a
SDict begin 13 H.A end
 -2 405 a -2 405 a
SDict begin [/View [/XYZ H.V]/Dest (0:295) cvn /DEST pdfmark end
 -2 405 a 396 2030 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate

396 2030 a @beginspecial 0 @llx -190 @lly 301 @urx 0
@ury 3010 @rwi @setspecial
%%BeginDocument: images/fig6.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -190 301 0
%%HiResBoundingBox: 0.0 -190.0 301.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -27.100210189819336 moveto
19.100210189819336 -42.1002082824707 lineto
19.100210189819336 -45.43354161580404 20.433543523152668 -47.1002082824707 23.100210189819336 -47.1002082824707 curveto
86.10021209716797 -47.1002082824707 lineto
86.10021209716797 -47.1002082824707 lineto
88.10021209716797 -47.1002082824707 89.10021209716797 -45.43354161580404 89.10021209716797 -42.1002082824707 curveto
89.10021209716797 -27.100210189819336 lineto
89.10021209716797 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -27.100210189819336 moveto
117.10021209716797 -42.1002082824707 lineto
117.10021209716797 -45.43354161580404 118.4335454305013 -47.1002082824707 121.10021209716797 -47.1002082824707 curveto
184.10020446777344 -47.1002082824707 lineto
184.10020446777344 -47.1002082824707 lineto
186.10020446777344 -47.1002082824707 187.10020446777344 -45.43354161580404 187.10020446777344 -42.1002082824707 curveto
187.10020446777344 -27.100210189819336 lineto
187.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -27.100210189819336 moveto
215.10020446777344 -42.1002082824707 lineto
215.10020446777344 -45.43354161580404 216.43353780110678 -47.1002082824707 219.10020446777344 -47.1002082824707 curveto
282.1002197265625 -47.1002082824707 lineto
282.1002197265625 -47.1002082824707 lineto
284.1002197265625 -47.1002082824707 285.1002197265625 -45.43354161580404 285.1002197265625 -42.1002082824707 curveto
285.1002197265625 -27.100210189819336 lineto
285.1002197265625 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
107.10021209716797 -147.10020446777344 moveto
104.4335454305013 -147.10020446777344 103.10021209716797 -148.7668711344401 103.10021209716797 -152.10020446777344 curveto
103.10021209716797 -167.10020446777344 lineto
201.10020446777344 -167.10020446777344 lineto
201.10020446777344 -152.10020446777344 lineto
201.10020446777344 -148.7668711344401 200.10020446777344 -147.10020446777344 198.10020446777344 -147.10020446777344 curveto
107.10021209716797 -147.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -145.0 moveto
102.33333333333333 -145.0 101.0 -146.66666666666666 101.0 -150.0 curveto
101.0 -165.0 lineto
199.0 -165.0 lineto
199.0 -150.0 lineto
199.0 -146.66666666666666 198.0 -145.0 196.0 -145.0 curveto
105.0 -145.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -145.0 moveto
102.33333333333333 -145.0 101.0 -146.66666666666666 101.0 -150.0 curveto
101.0 -165.0 lineto
199.0 -165.0 lineto
199.0 -150.0 lineto
199.0 -146.66666666666666 198.0 -145.0 196.0 -145.0 curveto
105.0 -145.0 lineto
closepath
stroke
newpath
133.0 -105.0 moveto
139.0 -105.0 lineto
stroke
newpath
150.0 -120.0 moveto
150.0 -135.0 lineto
stroke
newpath
248.0 -45.0 moveto
248.0 -59.0 lineto
stroke
newpath
147.0 -130.0 moveto
150.0 -140.0 lineto
154.0 -130.0 lineto
closepath
fill
newpath
52.0 -45.0 moveto
52.0 -85.0 lineto
150.0 -85.0 lineto
stroke
newpath
150.0 -45.0 moveto
150.0 -85.0 lineto
stroke
newpath
248.0 -75.0 moveto
248.0 -85.0 lineto
150.0 -85.0 lineto
stroke
newpath
150.0 -95.0 moveto
150.0 -85.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
36.0 -38.0 moveto
(PUSH) show
134.0 -38.0 moveto
(PUSH) show
232.0 -38.0 moveto
(PUSH) show
27.0 -69.0 moveto
(R1, R2, R3) show
141.0 -68.0 moveto
(R4) show
234.0 -69.0 moveto
(R5, R6) show
105.0 -109.0 moveto
(fair queuing) show
92.0 -119.0 moveto
(R1, R4, R5, R2, R6, R3) show
141.0 -159.0 moveto
(PULL) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2030 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2030 a -2 2196 a
SDict begin H.S end
 -2 2196
a -2 2196 a
SDict begin 13 H.A end
 -2 2196 a -2 2196 a
SDict begin [/View [/XYZ H.V]/Dest (0:298) cvn /DEST pdfmark end
 -2 2196 a 396 2304 a
Fk(The)g(pipeline)f(pattern)h(also)g(e)o(xhibits)g(the)g("slo)n(w)g
(joiner")g(syndrome,)d(leading)j(to)g(accusations)f(that)i(PUSH)g(sock)
o(ets)396 2412 y(don')o(t)e(load)h(balance)f(properly)-5
b(.)17 b(If)j(you)g(are)g(using)f(PUSH)i(and)f(PULL,)g(and)g(one)f(of)h
(your)f(w)o(ork)o(ers)h(gets)g(w)o(ay)g(more)396 2519
y(messages)h(than)e(the)i(others,)e(it')-5 b(s)21 b(because)f(that)g
(PULL)g(sock)o(et)g(has)h(joined)e(f)o(aster)h(than)g(the)g(others,)g
(and)f(grabs)h(a)h(lot)396 2627 y(of)f(messages)h(before)d(the)j
(others)e(manage)g(to)h(connect.)-2 2656 y
SDict begin H.S end
 -2 2656 a
-2 2656 a
SDict begin 13 H.A end
 -2 2656 a -2 2656 a
SDict begin [/View [/XYZ H.V]/Dest (0:299) cvn /DEST pdfmark end
 -2 2656 a 359 x Fn(1.10.)39
b(Pr)m(ogramming)d(with)j(\330MQ)1997 3015 y
SDict begin H.S end
 1997 3015
a 1997 3015 a
SDict begin 22.464 H.A end
 1997 3015 a 1997 3015 a
SDict begin [/View [/XYZ H.V]/Dest (6.14.1) cvn /DEST pdfmark end
 1997 3015 a -2
3213 a
SDict begin H.S end
 -2 3213 a -2 3213 a
SDict begin 13 H.A end
 -2 3213 a -2 3213 a
SDict begin [/View [/XYZ H.V]/Dest (0:301) cvn /DEST pdfmark end
 -2 3213
a 396 3289 a Fk(Ha)n(ving)20 b(seen)g(some)g(e)o(xamples,)f(you')l(re)f
(eager)i(to)g(start)h(using)e(\330MQ)i(in)f(some)g(apps.)g(Before)g
(you)f(start)i(that,)f(tak)o(e)g(a)396 3397 y(deep)g(breath,)f
(chillax,)g(and)h(re\003ect)g(on)g(some)g(basic)g(advice)g(that)g(will)
h(sa)n(v)o(e)f(you)g(stress)h(and)e(confusion.)-2 3415
y
SDict begin H.S end
 -2 3415 a -2 3415 a
SDict begin 13 H.A end
 -2 3415 a -2 3415 a
SDict begin [/View [/XYZ H.V]/Dest (0:302) cvn /DEST pdfmark end
 -2 3415 a -2
3425 a
SDict begin H.S end
 -2 3425 a -2 3425 a
SDict begin 13 H.A end
 -2 3425 a -2 3425 a
SDict begin [/View [/XYZ H.V]/Dest (0:303) cvn /DEST pdfmark end
 -2 3425
a Black 396 3567 a Fj(\225)p Black 479 3567 a
SDict begin H.S end
 479 3567
a 479 3567 a
SDict begin 13 H.A end
 479 3567 a 479 3567 a
SDict begin [/View [/XYZ H.V]/Dest (0:304) cvn /DEST pdfmark end
 479 3567 a Fk(Learn)h(\330MQ)g(step)
h(by)e(step.)i(It')-5 b(s)20 b(just)h(one)f(simple)g(API)h(b)n(ut)f(it)
h(hides)f(a)g(w)o(orld)g(of)g(possibilities.)g(T)-7 b(ak)o(e)20
b(the)479 3675 y(possibilities)h(slo)n(wly)-5 b(,)19
b(master)h(each)g(one.)-2 3693 y
SDict begin H.S end
 -2 3693 a -2 3693 a
SDict begin 13 H.A end

-2 3693 a -2 3693 a
SDict begin [/View [/XYZ H.V]/Dest (0:305) cvn /DEST pdfmark end
 -2 3693 a Black 396 3824 a Fj(\225)p
Black 479 3824 a
SDict begin H.S end
 479 3824 a 479 3824 a
SDict begin 13 H.A end
 479 3824 a 479
3824 a
SDict begin [/View [/XYZ H.V]/Dest (0:306) cvn /DEST pdfmark end
 479 3824 a Fk(Write)h(nice)f(code.)f(Ugly)h(code)g(hides)g
(problems)e(and)i(mak)o(es)g(it)h(hard)e(for)h(others)g(to)g(help)g
(you.)f(Y)-9 b(ou)19 b(might)h(get)479 3932 y(used)g(to)h(meaningless)e
(v)n(ariable)g(names,)g(b)n(ut)i(people)e(reading)g(your)f(code)i(w)o
(on')o(t.)f(Use)i(names)f(that)g(are)g(real)479 4040
y(w)o(ords,)g(that)g(say)h(something)d(other)i(than)f("I'm)h(too)g
(careless)g(to)h(tell)f(you)g(what)g(this)h(v)n(ariable)e(is)i(really)f
(for".)f(Use)479 4148 y(consistent)h(indentation,)e(clean)i(layout.)f
(Write)i(nice)f(code)g(and)f(your)g(w)o(orld)h(will)h(be)f(more)f
(comfortable.)-2 4166 y
SDict begin H.S end
 -2 4166 a -2 4166 a
SDict begin 13 H.A end
 -2 4166 a
-2 4166 a
SDict begin [/View [/XYZ H.V]/Dest (0:307) cvn /DEST pdfmark end
 -2 4166 a Black 396 4298 a Fj(\225)p Black
479 4298 a
SDict begin H.S end
 479 4298 a 479 4298 a
SDict begin 13 H.A end
 479 4298 a 479 4298
a
SDict begin [/View [/XYZ H.V]/Dest (0:308) cvn /DEST pdfmark end
 479 4298 a Fk(T)-6 b(est)21 b(what)f(you)g(mak)o(e)f(as)i(you)f(mak)o
(e)f(it.)i(When)f(your)f(program)f(doesn')o(t)h(w)o(ork,)g(you)g
(should)g(kno)n(w)h(what)g(\002)n(v)o(e)479 4406 y(lines)h(are)f(to)g
(blame.)g(This)g(is)h(especially)f(true)g(when)f(you)h(do)g(\330MQ)g
(magic,)f(which)h(just)3129 4406 y
SDict begin H.S end
 3129 4406 a 3129 4406
a
SDict begin 13 H.A end
 3129 4406 a 3129 4406 a
SDict begin [/View [/XYZ H.V]/Dest (0:309) cvn /DEST pdfmark end
 3129 4406 a Ff(won')n(t)h Fk(w)o(ork)e(the)h
(\002rst)479 4513 y(fe)n(w)g(times)h(you)e(try)h(it.)-2
4531 y
SDict begin H.S end
 -2 4531 a -2 4531 a
SDict begin 13 H.A end
 -2 4531 a -2 4531 a
SDict begin [/View [/XYZ H.V]/Dest (0:310) cvn /DEST pdfmark end
 -2 4531
a Black 396 4663 a Fj(\225)p Black 479 4663 a
SDict begin H.S end
 479 4663
a 479 4663 a
SDict begin 13 H.A end
 479 4663 a 479 4663 a
SDict begin [/View [/XYZ H.V]/Dest (0:311) cvn /DEST pdfmark end
 479 4663 a Fk(When)g(you)g(\002nd)g
(that)g(things)g(don')o(t)e(w)o(ork)i(as)h(e)o(xpected,)d(break)h(your)
g(code)g(into)h(pieces,)g(test)h(each)f(one,)g(see)479
4771 y(which)g(one)g(is)h(not)f(w)o(orking.)e(\330MQ)i(lets)h(you)f
(mak)o(e)g(essentially)g(modular)e(code,)i(use)g(that)g(to)h(your)d
(adv)n(antage.)-2 4789 y
SDict begin H.S end
 -2 4789 a -2 4789 a
SDict begin 13 H.A end
 -2 4789
a -2 4789 a
SDict begin [/View [/XYZ H.V]/Dest (0:312) cvn /DEST pdfmark end
 -2 4789 a Black 396 4920 a Fj(\225)p Black
479 4920 a
SDict begin H.S end
 479 4920 a 479 4920 a
SDict begin 13 H.A end
 479 4920 a 479 4920
a
SDict begin [/View [/XYZ H.V]/Dest (0:313) cvn /DEST pdfmark end
 479 4920 a Fk(Mak)o(e)i(abstractions)g(\(classes,)g(methods,)f(whate)
n(v)o(er\))g(as)h(you)g(need)f(them.)h(If)g(you)f(cop)o(y/paste)g(a)i
(lot)f(of)g(code)479 5028 y(you')l(re)f(going)f(to)j(cop)o(y/paste)e
(errors)g(too.)p Black 3800 5569 a Ff(19)p Black eop
end
%%Page: 20 33
TeXDict begin 20 32 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.20) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:314) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(T)-7 b(o)21 b(illustrate,)f(here)f(is)i(a)g(fragment)
e(of)g(code)h(someone)f(ask)o(ed)h(me)g(to)g(help)g(\002x:)396
253 y Fe(//)90 b(NOTE:)44 b(do)g(NOT)g(reuse)g(this)h(example)e(code!)
396 350 y(static)h(char)934 363 y(*)979 350 y(topic_str)f(=)i
("msg.x|";)396 544 y(void)576 557 y(*)665 544 y(pub_worker\(void)1340
557 y(*)1427 544 y(arg\){)576 641 y(void)800 654 y(*)845
641 y(ctx)f(=)h(arg;)576 738 y(assert\(ctx\);)576 933
y(void)800 946 y(*)845 933 y(qskt)f(=)g(zmq_socket\(ctx,)f(ZMQ_REP\);)
576 1030 y(assert\(qskt\);)576 1224 y(int)h(rc)g(=)h
(zmq_connect\(qskt,)d("inproc://querys"\);)576 1321 y(assert\(rc)h(==)h
(0\);)576 1515 y(void)800 1528 y(*)845 1515 y(pubskt)f(=)i
(zmq_socket\(ctx,)d(ZMQ_PUB\);)576 1613 y(assert\(pubskt\);)576
1807 y(rc)i(=)h(zmq_bind\(pubskt,)d("inproc://publish"\);)576
1904 y(assert\(rc)h(==)h(0\);)576 2098 y(uint8_t)f(cmd;)576
2195 y(uint32_t)g(nb;)576 2292 y(zmq_msg_t)g(topic_msg,)g(cmd_msg,)h
(nb_msg,)f(resp_msg;)576 2487 y(zmq_msg_init_data\(&topic_msg,)d
(topic_str,)j(strlen\(topic_str\))f(,)i(NULL,)g(NULL\);)576
2681 y(fprintf\(stdout,"WORKER:)d(ready)j(to)g(receive)g
(messages\\n"\);)576 2778 y(//)89 b(NOTE:)44 b(do)g(NOT)h(reuse)f(this)
g(example)g(code,)g(It's)g(broken.)576 2875 y(//)89 b(e.g.)44
b(topic_msg)f(will)i(be)f(invalid)g(the)g(second)g(time)g(through)576
2972 y(while)g(\(1\){)576 3070 y(zmq_msg_send\(pubskt,)d(&topic_msg,)i
(ZMQ_SNDMORE\);)576 3264 y(zmq_msg_init\(&cmd_msg\);)576
3361 y(zmq_msg_recv\(qskt,)e(&cmd_msg,)j(0\);)576 3458
y(memcpy\(&cmd,)e(zmq_msg_data\(&cmd_msg\),)f(sizeof\(uint8_t\)\);)576
3555 y(zmq_msg_send\(pubskt,)g(&cmd_msg,)i(ZMQ_SNDMORE\);)576
3652 y(zmq_msg_close\(&cmd_msg\);)576 3847 y(fprintf\(stdout,)f
("received)h(cmd)i(\045u\\n",)e(cmd\);)576 4041 y
(zmq_msg_init\(&nb_msg\);)576 4138 y(zmq_msg_recv\(qskt,)e(&nb_msg,)j
(0\);)576 4235 y(memcpy\(&nb,)f(zmq_msg_data\(&nb_msg\),)e
(sizeof\(uint32_t\)\);)576 4332 y(zmq_msg_send\(pubskt,)g(&nb_msg,)j
(0\);)576 4429 y(zmq_msg_close\(&nb_msg\);)576 4624 y(fprintf\(stdout,)
e("received)h(nb)i(\045u\\n",)f(nb\);)576 4818 y
(zmq_msg_init_size\(&resp_msg,)c(sizeof\(uint8_t\)\);)576
4915 y(memset\(zmq_msg_data\(&resp_msg\),)f(0,)45 b
(sizeof\(uint8_t\)\);)576 5012 y(zmq_msg_send\(qskt,)c(&resp_msg,)j
(0\);)576 5109 y(zmq_msg_close\(&resp_msg\);)p Black
3800 5569 a Ff(20)p Black eop end
%%Page: 21 34
TeXDict begin 21 33 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.21) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:326) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 576 170 a Fe(})576 267 y(return)43 b(NULL;)396
364 y(})-2 538 y
SDict begin H.S end
 -2 538 a -2 538 a
SDict begin 13 H.A end
 -2 538 a -2 538 a
SDict begin [/View [/XYZ H.V]/Dest (0:316) cvn /DEST pdfmark end

-2 538 a 396 638 a Fk(This)21 b(is)g(what)f(I)g(re)n(wrote)g(it)g(to,)h
(as)f(part)g(of)g(\002nding)f(the)h(b)n(ug:)-2 739 y
SDict begin H.S end

-2 739 a -2 739 a
SDict begin 11.7 H.A end
 -2 739 a -2 739 a
SDict begin [/View [/XYZ H.V]/Dest (0:317) cvn /DEST pdfmark end
 -2 739 a 396 818
a Fe(static)44 b(void)934 831 y(*)396 915 y(worker_thread)f(\(void)1293
928 y(*)1338 915 y(arg\))h({)576 1012 y(void)800 1025
y(*)845 1012 y(context)f(=)i(arg;)576 1109 y(void)800
1122 y(*)845 1109 y(worker)e(=)i(zmq_socket)e(\(context,)h(ZMQ_REP\);)
576 1207 y(assert)f(\(worker\);)576 1304 y(int)h(rc;)576
1401 y(rc)g(=)h(zmq_connect)e(\(worker,)g("ipc://worker"\);)576
1498 y(assert)g(\(rc)i(==)f(0\);)576 1692 y(void)800
1705 y(*)845 1692 y(broadcast)f(=)i(zmq_socket)e(\(context,)g
(ZMQ_PUB\);)576 1789 y(assert)g(\(broadcast\);)576 1887
y(rc)h(=)h(zmq_bind)e(\(broadcast,)g("ipc://publish"\);)576
1984 y(assert)g(\(rc)i(==)f(0\);)576 2178 y(while)g(\(1\))g({)755
2275 y(char)979 2288 y(*)1024 2275 y(part1)g(=)h(s_recv)e(\(worker\);)
755 2372 y(char)979 2385 y(*)1024 2372 y(part2)h(=)h(s_recv)e
(\(worker\);)755 2469 y(printf)h(\("Worker)f(got)i([\045s][\045s]\\n",)
d(part1,)i(part2\);)755 2566 y(s_sendmore)f(\(broadcast,)g("msg"\);)755
2664 y(s_sendmore)g(\(broadcast,)g(part1\);)755 2761
y(s_send)223 b(\(broadcast,)43 b(part2\);)755 2858 y(free)h(\(part1\);)
755 2955 y(free)g(\(part2\);)755 3149 y(s_send)g(\(worker,)f("OK"\);)
576 3246 y(})576 3344 y(return)g(NULL;)396 3441 y(})-2
3615 y
SDict begin H.S end
 -2 3615 a -2 3615 a
SDict begin 13 H.A end
 -2 3615 a -2 3615 a
SDict begin [/View [/XYZ H.V]/Dest (0:318) cvn /DEST pdfmark end
 -2 3615
a 396 3715 a Fk(In)20 b(the)g(end,)g(the)g(problem)e(w)o(as)j(that)g
(the)f(application)f(w)o(as)i(passing)f(sock)o(ets)g(between)f
(threads,)h(which)f(crashes)396 3823 y(weirdly)-5 b(.)19
b(Sock)o(ets)h(are)g(not)g(threadsafe.)f(It)h(became)g(le)o(gal)f(beha)
n(vior)g(to)h(migrate)f(sock)o(ets)i(from)e(one)h(thread)f(to)396
3931 y(another)g(in)h(\330MQ/2.1,)f(b)n(ut)i(this)f(remains)g
(dangerous)e(unless)i(you)f(use)i(a)g("full)e(memory)g(barrier".)g(If)h
(you)f(don')o(t)396 4038 y(kno)n(w)g(what)i(that)f(means,)f(don')o(t)g
(attempt)h(sock)o(et)g(migration.)-2 4067 y
SDict begin H.S end
 -2 4067 a
-2 4067 a
SDict begin 13 H.A end
 -2 4067 a -2 4067 a
SDict begin [/View [/XYZ H.V]/Dest (0:319) cvn /DEST pdfmark end
 -2 4067 a 359 x Fn(1.11.)39
b(Getting)f(the)h(Conte)n(xt)e(Right)2093 4426 y
SDict begin H.S end
 2093
4426 a 2093 4426 a
SDict begin 22.464 H.A end
 2093 4426 a 2093 4426 a
SDict begin [/View [/XYZ H.V]/Dest (6.15.1) cvn /DEST pdfmark end
 2093 4426
a -2 4624 a
SDict begin H.S end
 -2 4624 a -2 4624 a
SDict begin 13 H.A end
 -2 4624 a -2 4624 a
SDict begin [/View [/XYZ H.V]/Dest (0:321) cvn /DEST pdfmark end
 -2
4624 a 396 4700 a Fk(\330MQ)21 b(applications)e(al)o(w)o(ays)h(start)h
(by)f(creating)f(a)1896 4700 y
SDict begin H.S end
 1896 4700 a 1896 4700
a
SDict begin 13 H.A end
 1896 4700 a 1896 4700 a
SDict begin [/View [/XYZ H.V]/Dest (0:322) cvn /DEST pdfmark end
 1896 4700 a Ff(conte)n(xt)q
Fk(,)h(and)f(then)h(using)g(that)g(for)g(creating)f(sock)o(ets.)h(In)g
(C,)h(it')-5 b(s)396 4808 y(the)20 b(zmq_ctx_ne)n(w[3])c(call.)21
b(Y)-9 b(ou)19 b(should)g(create)h(and)g(use)g(e)o(xactly)f(one)g
(conte)o(xt)g(in)h(your)f(process.)h(T)-6 b(echnically)h(,)18
b(the)396 4916 y(conte)o(xt)h(is)i(the)g(container)d(for)i(all)h(sock)o
(ets)f(in)g(a)h(single)f(process,)f(and)h(acts)h(as)g(the)f(transport)f
(for)3262 4916 y
SDict begin H.S end
 3262 4916 a 3262 4916 a
SDict begin 13 H.A end
 3262 4916 a
3262 4916 a
SDict begin [/View [/XYZ H.V]/Dest (0:323) cvn /DEST pdfmark end
 3262 4916 a Fe(inproc)h Fk(sock)o(ets,)396
5024 y(which)g(are)g(the)g(f)o(astest)h(w)o(ay)g(to)f(connect)f
(threads)g(in)i(one)e(process.)h(If)g(at)h(runtime)e(a)h(process)g(has)
g(tw)o(o)h(conte)o(xts,)396 5132 y(these)g(are)f(lik)o(e)g(separate)g
(\330MQ)g(instances.)g(If)g(that')-5 b(s)21 b(e)o(xplicitly)e(what)h
(you)g(w)o(ant,)g(OK,)g(b)n(ut)g(otherwise)g(remember:)p
Black 3800 5569 a Ff(21)p Black eop end
%%Page: 22 35
TeXDict begin 22 34 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.22) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:324) cvn /DEST pdfmark end
 -2
-11 a -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:325) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fg(Do)g(one)g(zmq_ctx_new[3])d(at)i(the)h(start)f(of)g
(y)n(our)g(main)h(line)h(code,)e(and)h(one)g(zmq_ctx_destr)o(oy[3])15
b(at)k(the)h(end.)396 346 y Fk(If)g(you')l(re)f(using)g(the)h(fork\(\))
f(system)h(call,)h(each)e(process)h(needs)g(its)h(o)n(wn)f(conte)o(xt.)
f(If)h(you)f(do)h(zmq_ctx_ne)n(w[3])c(in)396 454 y(the)k(main)g
(process)g(before)f(calling)h(fork\(\),)e(the)i(child)g(processes)g
(get)g(their)g(o)n(wn)f(conte)o(xts.)g(In)h(general)f(you)h(w)o(ant)g
(to)396 562 y(do)g(the)g(interesting)g(stuf)n(f)f(in)i(the)f(child)g
(processes,)f(and)h(just)h(manage)e(these)h(from)f(the)h(parent)g
(process.)-2 591 y
SDict begin H.S end
 -2 591 a -2 591 a
SDict begin 13 H.A end
 -2 591 a -2 591
a
SDict begin [/View [/XYZ H.V]/Dest (0:327) cvn /DEST pdfmark end
 -2 591 a 359 x Fn(1.12.)39 b(Making)f(a)h(Clean)g(Exit)1705
950 y
SDict begin H.S end
 1705 950 a 1705 950 a
SDict begin 22.464 H.A end
 1705 950 a 1705 950 a
SDict begin [/View [/XYZ H.V]/Dest (6.16.1) cvn /DEST pdfmark end
 1705
950 a -2 1148 a
SDict begin H.S end
 -2 1148 a -2 1148 a
SDict begin 13 H.A end
 -2 1148 a -2 1148
a
SDict begin [/View [/XYZ H.V]/Dest (0:329) cvn /DEST pdfmark end
 -2 1148 a 396 1224 a Fk(Classy)21 b(programmers)d(share)i(the)g(same)
g(motto)g(as)h(classy)f(hit)h(men:)f(al)o(w)o(ays)g(clean-up)f(when)g
(you)h(\002nish)g(the)g(job)m(.)396 1332 y(When)g(you)g(use)g(\330MQ)g
(in)h(a)f(language)f(lik)o(e)h(Python,)f(stuf)n(f)h(gets)g
(automatically)f(freed)g(for)h(you.)f(But)i(when)e(using)h(C)396
1440 y(you)g(ha)n(v)o(e)f(to)h(carefully)f(free)h(objects)g(when)g
(you')l(re)e(\002nished)i(with)g(them,)g(or)f(you)h(get)g(memory)e
(leaks,)i(unstable)396 1548 y(applications,)f(and)h(generally)e(bad)i
(karma.)-2 1732 y
SDict begin H.S end
 -2 1732 a -2 1732 a
SDict begin 13 H.A end
 -2 1732 a -2 1732
a
SDict begin [/View [/XYZ H.V]/Dest (0:330) cvn /DEST pdfmark end
 -2 1732 a 396 1822 a Fk(Memory)f(leaks)h(are)g(one)g(thing,)f(b)n(ut)
h(\330MQ)h(is)g(quite)f(\002nick)o(y)f(about)g(ho)n(w)h(you)f(e)o(xit)h
(an)g(application.)f(The)h(reasons)396 1929 y(are)g(technical)g(and)f
(painful)g(b)n(ut)i(the)f(upshot)f(is)i(that)f(if)h(you)e(lea)n(v)o(e)h
(an)o(y)g(sock)o(ets)g(open,)f(the)h(zmq_ctx_destro)o(y[3])396
2037 y(function)f(will)i(hang)e(fore)n(v)o(er)-5 b(.)18
b(And)i(e)n(v)o(en)f(if)i(you)e(close)h(all)h(sock)o(ets,)f
(zmq_ctx_destro)o(y[3])c(will)21 b(by)e(def)o(ault)h(w)o(ait)396
2145 y(fore)n(v)o(er)e(if)j(there)f(are)g(pending)e(connects)h(or)h
(sends.)g(Unless)h(you)e(set)i(the)f(LINGER)g(to)h(zero)e(on)h(those)g
(sock)o(ets)396 2253 y(before)f(closing)h(them.)-2 2437
y
SDict begin H.S end
 -2 2437 a -2 2437 a
SDict begin 13 H.A end
 -2 2437 a -2 2437 a
SDict begin [/View [/XYZ H.V]/Dest (0:331) cvn /DEST pdfmark end
 -2 2437 a 396
2527 a Fk(The)g(\330MQ)h(objects)f(we)g(need)g(to)g(w)o(orry)f(about)g
(are)h(messages,)h(sock)o(ets,)f(and)f(conte)o(xts.)g(Luckily)g(it')-5
b(s)22 b(quite)d(simple,)396 2635 y(at)i(least)g(in)f(simple)g
(programs:)-2 2653 y
SDict begin H.S end
 -2 2653 a -2 2653 a
SDict begin 13 H.A end
 -2 2653 a -2
2653 a
SDict begin [/View [/XYZ H.V]/Dest (0:332) cvn /DEST pdfmark end
 -2 2653 a -2 2663 a
SDict begin H.S end
 -2 2663 a -2 2663 a
SDict begin 13 H.A end
 -2 2663
a -2 2663 a
SDict begin [/View [/XYZ H.V]/Dest (0:333) cvn /DEST pdfmark end
 -2 2663 a Black 396 2805 a Fj(\225)p Black
479 2805 a
SDict begin H.S end
 479 2805 a 479 2805 a
SDict begin 13 H.A end
 479 2805 a 479 2805
a
SDict begin [/View [/XYZ H.V]/Dest (0:334) cvn /DEST pdfmark end
 479 2805 a Fk(Al)o(w)o(ays)h(close)f(a)h(message)f(the)g(moment)f
(you)g(are)i(done)e(with)h(it,)h(using)e(zmq_msg_close[3].)-2
2823 y
SDict begin H.S end
 -2 2823 a -2 2823 a
SDict begin 13 H.A end
 -2 2823 a -2 2823 a
SDict begin [/View [/XYZ H.V]/Dest (0:335) cvn /DEST pdfmark end
 -2 2823
a Black 396 2955 a Fj(\225)p Black 479 2955 a
SDict begin H.S end
 479 2955
a 479 2955 a
SDict begin 13 H.A end
 479 2955 a 479 2955 a
SDict begin [/View [/XYZ H.V]/Dest (0:336) cvn /DEST pdfmark end
 479 2955 a Fk(If)h(you)g(are)g
(opening)e(and)i(closing)f(a)i(lot)f(of)g(sock)o(ets,)g(that')-5
b(s)21 b(probably)d(a)i(sign)h(you)e(need)g(to)i(redesign)e(your)479
3063 y(application.)-2 3081 y
SDict begin H.S end
 -2 3081 a -2 3081 a
SDict begin 13 H.A end
 -2
3081 a -2 3081 a
SDict begin [/View [/XYZ H.V]/Dest (0:337) cvn /DEST pdfmark end
 -2 3081 a Black 396 3212 a Fj(\225)p
Black 479 3212 a
SDict begin H.S end
 479 3212 a 479 3212 a
SDict begin 13 H.A end
 479 3212 a 479
3212 a
SDict begin [/View [/XYZ H.V]/Dest (0:338) cvn /DEST pdfmark end
 479 3212 a Fk(When)h(you)g(e)o(xit)g(the)g(program,)e(close)i
(your)f(sock)o(ets)h(and)g(then)g(call)g(zmq_ctx_destro)o(y[3].)c(This)
k(destro)o(ys)g(the)479 3320 y(conte)o(xt.)-2 3487 y
SDict begin H.S end

-2 3487 a -2 3487 a
SDict begin 13 H.A end
 -2 3487 a -2 3487 a
SDict begin [/View [/XYZ H.V]/Dest (0:339) cvn /DEST pdfmark end
 -2 3487 a 396
3594 a Fk(If)g(you')l(re)f(doing)f(multithreaded)g(w)o(ork,)i(it)h
(gets)f(rather)f(more)h(comple)o(x)e(than)i(this.)g(W)-7
b(e')o(ll)22 b(get)e(to)g(multithreading)e(in)396 3702
y(the)i(ne)o(xt)g(chapter)m(,)e(b)n(ut)j(because)e(some)h(of)g(you)f
(will,)i(despite)f(w)o(arnings,)f(will)i(try)f(to)g(run)g(before)f(you)
g(can)h(safely)396 3810 y(w)o(alk,)g(belo)n(w)g(is)h(the)f(quick)f(and)
h(dirty)g(guide)f(to)h(making)f(a)i(clean)f(e)o(xit)g(in)g(a)2643
3810 y
SDict begin H.S end
 2643 3810 a 2643 3810 a
SDict begin 13 H.A end
 2643 3810 a 2643 3810
a
SDict begin [/View [/XYZ H.V]/Dest (0:340) cvn /DEST pdfmark end
 2643 3810 a Ff(multithr)m(eaded)g Fk(\330MQ)h(application.)-2
3994 y
SDict begin H.S end
 -2 3994 a -2 3994 a
SDict begin 13 H.A end
 -2 3994 a -2 3994 a
SDict begin [/View [/XYZ H.V]/Dest (0:341) cvn /DEST pdfmark end
 -2 3994
a 396 4084 a Fk(First,)g(do)f(not)g(try)g(to)g(use)g(the)h(same)f(sock)
o(et)g(from)f(multiple)h(threads.)f(No,)h(don')o(t)e(e)o(xplain)h(why)h
(you)f(think)g(this)396 4192 y(w)o(ould)h(be)g(e)o(xcellent)f(fun,)g
(just)i(please)f(don')o(t)f(do)h(it.)g(Ne)o(xt,)g(you)f(need)h(to)g
(shut)g(do)n(wn)f(each)h(sock)o(et)g(that)g(has)h(ongoing)396
4300 y(requests.)f(The)g(proper)e(w)o(ay)i(is)h(to)g(set)g(a)f(lo)n(w)h
(LINGER)f(v)n(alue)f(\(1)h(second\),)f(then)h(close)g(the)g(sock)o(et.)
g(If)g(your)396 4408 y(language)f(binding)f(doesn')o(t)g(do)i(this)g
(for)g(you)f(automatically)f(when)i(you)f(destro)o(y)g(a)h(conte)o(xt,)
f(I')l(d)g(suggest)h(sending)e(a)396 4516 y(patch.)-2
4700 y
SDict begin H.S end
 -2 4700 a -2 4700 a
SDict begin 13 H.A end
 -2 4700 a -2 4700 a
SDict begin [/View [/XYZ H.V]/Dest (0:342) cvn /DEST pdfmark end
 -2 4700
a 396 4790 a Fk(Finally)-5 b(,)20 b(destro)o(y)f(the)h(conte)o(xt.)f
(This)h(will)h(cause)f(an)o(y)g(blocking)e(recei)n(v)o(es)h(or)h(polls)
h(or)f(sends)g(in)g(attached)f(threads)396 4898 y(\(i.e.)h(which)g
(share)g(the)g(same)g(conte)o(xt\))f(to)h(return)f(with)i(an)f(error)-5
b(.)19 b(Catch)h(that)h(error)m(,)d(and)i(then)g(set)h(linger)e(on,)h
(and)396 5005 y(close)h(sock)o(ets)f(in)937 5005 y
SDict begin H.S end
 937
5005 a 937 5005 a
SDict begin 13 H.A end
 937 5005 a 937 5005 a
SDict begin [/View [/XYZ H.V]/Dest (0:343) cvn /DEST pdfmark end
 937 5005 a Ff(that)i
Fk(thread,)d(and)g(e)o(xit.)h(Do)g(not)g(destro)o(y)f(the)h(same)h
(conte)o(xt)e(twice.)h(The)g(zmq_ctx_destro)o(y)c(in)21
b(the)396 5113 y(main)f(thread)f(will)i(block)e(until)h(all)h(sock)o
(ets)g(it)f(kno)n(ws)g(about)f(are)h(safely)g(closed.)p
Black 3800 5569 a Ff(22)p Black eop end
%%Page: 23 36
TeXDict begin 23 35 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.23) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:344) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(V)-11 b(oila!)20 b(It')-5 b(s)21 b(comple)o(x)e(and)g
(painful)g(enough)f(that)j(an)o(y)e(language)g(binding)f(author)h(w)o
(orth)h(his)g(or)g(her)g(salt)h(will)g(do)f(this)396
180 y(automatically)f(and)h(mak)o(e)f(the)i(sock)o(et)f(closing)f
(dance)h(unnecessary)-5 b(.)-2 209 y
SDict begin H.S end
 -2 209 a -2 209
a
SDict begin 13 H.A end
 -2 209 a -2 209 a
SDict begin [/View [/XYZ H.V]/Dest (0:345) cvn /DEST pdfmark end
 -2 209 a 359 x Fn(1.13.)39 b(Wh)m(y)h(W)-5
b(e)40 b(Needed)e(\330MQ)1849 568 y
SDict begin H.S end
 1849 568 a 1849 568
a
SDict begin 22.464 H.A end
 1849 568 a 1849 568 a
SDict begin [/View [/XYZ H.V]/Dest (6.17.1) cvn /DEST pdfmark end
 1849 568 a -2 764 a
SDict begin H.S end
 -2 764 a
-2 764 a
SDict begin 13 H.A end
 -2 764 a -2 764 a
SDict begin [/View [/XYZ H.V]/Dest (0:347) cvn /DEST pdfmark end
 -2 764 a 396 842 a Fk(No)n(w)20
b(that)h(you')l(v)o(e)d(seen)i(\330MQ)g(in)h(action,)e(let')-5
b(s)21 b(go)f(back)f(to)i(the)f("why".)-2 1026 y
SDict begin H.S end
 -2 1026
a -2 1026 a
SDict begin 13 H.A end
 -2 1026 a -2 1026 a
SDict begin [/View [/XYZ H.V]/Dest (0:348) cvn /DEST pdfmark end
 -2 1026 a 396 1116 a
Fk(Man)o(y)f(applications)g(these)i(days)f(consist)g(of)g(components)e
(that)i(stretch)g(across)h(some)f(kind)f(of)h(netw)o(ork,)f(either)g(a)
396 1224 y(LAN)i(or)f(the)g(Internet.)e(So)j(man)o(y)e(application)g
(de)n(v)o(elopers)f(end)h(up)h(doing)f(some)h(kind)f(of)h(messaging.)f
(Some)396 1332 y(de)n(v)o(elopers)f(use)i(message)f(queuing)f
(products,)f(b)n(ut)j(most)f(of)h(the)f(time)h(the)o(y)f(do)g(it)h
(themselv)o(es,)f(using)g(TCP)h(or)g(UDP)-9 b(.)396 1440
y(These)20 b(protocols)f(are)g(not)h(hard)f(to)h(use,)g(b)n(ut)g(there)
g(is)g(a)h(great)e(dif)n(ference)f(between)h(sending)g(a)i(fe)n(w)e
(bytes)h(from)f(A)i(to)396 1548 y(B,)g(and)f(doing)f(messaging)g(in)h
(an)o(y)g(kind)f(of)h(reliable)g(w)o(ay)-5 b(.)-2 1732
y
SDict begin H.S end
 -2 1732 a -2 1732 a
SDict begin 13 H.A end
 -2 1732 a -2 1732 a
SDict begin [/View [/XYZ H.V]/Dest (0:349) cvn /DEST pdfmark end
 -2 1732 a 396
1822 a Fk(Let')g(s)21 b(look)e(at)i(the)f(typical)g(problems)f(we)h(f)o
(ace)h(when)e(we)i(start)f(to)h(connect)e(pieces)h(using)g(ra)o(w)g
(TCP)-9 b(.)20 b(An)o(y)g(reusable)396 1929 y(messaging)g(layer)f(w)o
(ould)h(need)f(to)i(solv)o(e)e(all)i(or)f(most)g(these:)-2
1947 y
SDict begin H.S end
 -2 1947 a -2 1947 a
SDict begin 13 H.A end
 -2 1947 a -2 1947 a
SDict begin [/View [/XYZ H.V]/Dest (0:350) cvn /DEST pdfmark end
 -2 1947
a -2 1957 a
SDict begin H.S end
 -2 1957 a -2 1957 a
SDict begin 13 H.A end
 -2 1957 a -2 1957 a
SDict begin [/View [/XYZ H.V]/Dest (0:351) cvn /DEST pdfmark end
 -2
1957 a Black 396 2100 a Fj(\225)p Black 479 2100 a
SDict begin H.S end
 479
2100 a 479 2100 a
SDict begin 13 H.A end
 479 2100 a 479 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:352) cvn /DEST pdfmark end
 479 2100 a Fk(Ho)n(w)g(do)g(we)
h(handle)e(I/O?)h(Does)g(our)g(application)f(block,)g(or)g(do)h(we)h
(handle)e(I/O)h(in)h(the)f(background?)c(This)21 b(is)g(a)479
2208 y(k)o(e)o(y)f(design)f(decision.)h(Blocking)f(I/O)h(creates)g
(architectures)f(that)i(do)e(not)h(scale)h(well.)f(But)h(background)c
(I/O)j(can)479 2316 y(be)g(v)o(ery)f(hard)h(to)g(do)g(right.)-2
2333 y
SDict begin H.S end
 -2 2333 a -2 2333 a
SDict begin 13 H.A end
 -2 2333 a -2 2333 a
SDict begin [/View [/XYZ H.V]/Dest (0:353) cvn /DEST pdfmark end
 -2 2333
a Black 396 2465 a Fj(\225)p Black 479 2465 a
SDict begin H.S end
 479 2465
a 479 2465 a
SDict begin 13 H.A end
 479 2465 a 479 2465 a
SDict begin [/View [/XYZ H.V]/Dest (0:354) cvn /DEST pdfmark end
 479 2465 a Fk(Ho)n(w)g(do)g(we)h
(handle)e(dynamic)f(components,)g(i.e.)i(pieces)h(that)f(go)g(a)o(w)o
(ay)g(temporarily?)e(Do)i(we)g(formally)f(split)479 2573
y(components)f(into)i("clients")g(and)g("serv)o(ers")f(and)h(mandate)f
(that)h(serv)o(ers)g(cannot)f(disappear?)g(What)i(then)e(if)i(we)479
2681 y(w)o(ant)g(to)f(connect)f(serv)o(ers)h(to)g(serv)o(ers?)f(Do)i
(we)f(try)g(to)g(reconnect)f(e)n(v)o(ery)g(fe)n(w)h(seconds?)-2
2699 y
SDict begin H.S end
 -2 2699 a -2 2699 a
SDict begin 13 H.A end
 -2 2699 a -2 2699 a
SDict begin [/View [/XYZ H.V]/Dest (0:355) cvn /DEST pdfmark end
 -2 2699
a Black 396 2830 a Fj(\225)p Black 479 2830 a
SDict begin H.S end
 479 2830
a 479 2830 a
SDict begin 13 H.A end
 479 2830 a 479 2830 a
SDict begin [/View [/XYZ H.V]/Dest (0:356) cvn /DEST pdfmark end
 479 2830 a Fk(Ho)n(w)g(do)f(we)h
(represent)f(a)h(message)g(on)f(the)h(wire?)g(Ho)n(w)f(do)h(we)g(frame)
f(data)h(so)g(it')-5 b(s)21 b(easy)e(to)h(write)g(and)g(read,)f(safe)
479 2938 y(from)g(b)n(uf)n(fer)g(o)o(v)o(er\003o)n(ws,)f(ef)n
(\002cient)i(for)f(small)i(messages,)f(yet)g(adequate)e(for)i(the)g(v)o
(ery)f(lar)o(gest)g(videos)h(of)f(dancing)479 3046 y(cats)i(wearing)e
(party)h(hats?)-2 3064 y
SDict begin H.S end
 -2 3064 a -2 3064 a
SDict begin 13 H.A end
 -2 3064
a -2 3064 a
SDict begin [/View [/XYZ H.V]/Dest (0:357) cvn /DEST pdfmark end
 -2 3064 a Black 396 3196 a Fj(\225)p Black
479 3196 a
SDict begin H.S end
 479 3196 a 479 3196 a
SDict begin 13 H.A end
 479 3196 a 479 3196
a
SDict begin [/View [/XYZ H.V]/Dest (0:358) cvn /DEST pdfmark end
 479 3196 a Fk(Ho)n(w)g(do)g(we)h(handle)e(messages)h(that)g(we)h
(can')o(t)e(deli)n(v)o(er)g(immediately?)g(P)o(articularly)-5
b(,)18 b(if)j(we')l(re)e(w)o(aiting)h(for)g(a)479 3303
y(component)e(to)i(come)g(back)f(on-line?)g(Do)h(we)h(discard)f
(messages,)g(put)f(them)h(into)g(a)h(database,)e(or)h(into)g(a)479
3411 y(memory)f(queue?)-2 3429 y
SDict begin H.S end
 -2 3429 a -2 3429 a
SDict begin 13 H.A end

-2 3429 a -2 3429 a
SDict begin [/View [/XYZ H.V]/Dest (0:359) cvn /DEST pdfmark end
 -2 3429 a Black 396 3561 a Fj(\225)p
Black 479 3561 a
SDict begin H.S end
 479 3561 a 479 3561 a
SDict begin 13 H.A end
 479 3561 a 479
3561 a
SDict begin [/View [/XYZ H.V]/Dest (0:360) cvn /DEST pdfmark end
 479 3561 a Fk(Where)h(do)g(we)h(store)f(message)g(queues?)f
(What)i(happens)d(if)j(the)f(component)e(reading)g(from)i(a)g(queue)f
(is)i(v)o(ery)479 3669 y(slo)n(w)-5 b(,)20 b(and)g(causes)g(our)g
(queues)f(to)h(b)n(uild)g(up?)g(What')-5 b(s)21 b(our)e(strate)o(gy)g
(then?)-2 3687 y
SDict begin H.S end
 -2 3687 a -2 3687 a
SDict begin 13 H.A end
 -2 3687 a -2 3687
a
SDict begin [/View [/XYZ H.V]/Dest (0:361) cvn /DEST pdfmark end
 -2 3687 a Black 396 3818 a Fj(\225)p Black 479 3818
a
SDict begin H.S end
 479 3818 a 479 3818 a
SDict begin 13 H.A end
 479 3818 a 479 3818 a
SDict begin [/View [/XYZ H.V]/Dest (0:362) cvn /DEST pdfmark end
 479 3818
a Fk(Ho)n(w)h(do)g(we)h(handle)e(lost)i(messages?)f(Do)g(we)g(w)o(ait)h
(for)f(fresh)g(data,)f(request)h(a)h(resend,)e(or)h(do)f(we)i(b)n(uild)
f(some)479 3926 y(kind)g(of)g(reliability)f(layer)h(that)g(ensures)g
(messages)g(cannot)f(be)h(lost?)h(What)g(if)f(that)g(layer)g(itself)h
(crashes?)-2 3944 y
SDict begin H.S end
 -2 3944 a -2 3944 a
SDict begin 13 H.A end
 -2 3944 a -2
3944 a
SDict begin [/View [/XYZ H.V]/Dest (0:363) cvn /DEST pdfmark end
 -2 3944 a Black 396 4076 a Fj(\225)p Black 479
4076 a
SDict begin H.S end
 479 4076 a 479 4076 a
SDict begin 13 H.A end
 479 4076 a 479 4076 a
SDict begin [/View [/XYZ H.V]/Dest (0:364) cvn /DEST pdfmark end
 479
4076 a Fk(What)g(if)f(we)h(need)e(to)i(use)f(a)h(dif)n(ferent)d(netw)o
(ork)h(transport.)g(Say)-5 b(,)20 b(multicast)g(instead)g(of)g(TCP)h
(unicast?)e(Or)i(IPv6?)479 4184 y(Do)f(we)h(need)f(to)g(re)n(write)g
(the)g(applications,)f(or)h(is)h(the)f(transport)f(abstracted)g(in)h
(some)g(layer?)-2 4201 y
SDict begin H.S end
 -2 4201 a -2 4201 a
SDict begin 13 H.A end
 -2 4201
a -2 4201 a
SDict begin [/View [/XYZ H.V]/Dest (0:365) cvn /DEST pdfmark end
 -2 4201 a Black 396 4333 a Fj(\225)p Black
479 4333 a
SDict begin H.S end
 479 4333 a 479 4333 a
SDict begin 13 H.A end
 479 4333 a 479 4333
a
SDict begin [/View [/XYZ H.V]/Dest (0:366) cvn /DEST pdfmark end
 479 4333 a Fk(Ho)n(w)g(do)g(we)h(route)e(messages?)h(Can)h(we)f(send)
g(the)g(same)h(message)f(to)g(multiple)g(peers?)g(Can)g(we)h(send)f
(replies)479 4441 y(back)g(to)g(an)g(original)f(requester?)-2
4459 y
SDict begin H.S end
 -2 4459 a -2 4459 a
SDict begin 13 H.A end
 -2 4459 a -2 4459 a
SDict begin [/View [/XYZ H.V]/Dest (0:367) cvn /DEST pdfmark end
 -2 4459
a Black 396 4590 a Fj(\225)p Black 479 4590 a
SDict begin H.S end
 479 4590
a 479 4590 a
SDict begin 13 H.A end
 479 4590 a 479 4590 a
SDict begin [/View [/XYZ H.V]/Dest (0:368) cvn /DEST pdfmark end
 479 4590 a Fk(Ho)n(w)h(do)g(we)h
(write)f(an)g(API)h(for)e(another)g(language?)f(Do)j(we)f(re-implement)
e(a)j(wire-le)n(v)o(el)e(protocol)f(or)i(do)g(we)479
4698 y(repackage)f(a)h(library?)f(If)h(the)g(former)m(,)e(ho)n(w)i(can)
g(we)h(guarantee)d(ef)n(\002cient)i(and)f(stable)i(stacks?)f(If)g(the)h
(latter)m(,)e(ho)n(w)479 4806 y(can)h(we)h(guarantee)d
(interoperability?)-2 4824 y
SDict begin H.S end
 -2 4824 a -2 4824 a
SDict begin 13 H.A end
 -2 4824
a -2 4824 a
SDict begin [/View [/XYZ H.V]/Dest (0:369) cvn /DEST pdfmark end
 -2 4824 a Black 3800 5569 a Ff(23)p Black
eop end
%%Page: 24 37
TeXDict begin 24 36 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.24) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:370) cvn /DEST pdfmark end
 479 72 a Fk(Ho)n(w)g(do)g(we)h(represent)e
(data)h(so)g(that)h(it)g(can)f(be)g(read)f(between)h(dif)n(ferent)e
(architectures?)h(Do)h(we)h(enforce)d(a)479 180 y(particular)h
(encoding)e(for)i(data)h(types?)f(Ho)n(w)g(f)o(ar)h(is)h(this)f(the)f
(job)h(of)f(the)h(messaging)e(system)i(rather)f(than)g(a)h(higher)479
288 y(layer?)-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306
a
SDict begin [/View [/XYZ H.V]/Dest (0:371) cvn /DEST pdfmark end
 -2 306 a Black 396 438 a Fj(\225)p Black 479 438 a
SDict begin H.S end

479 438 a 479 438 a
SDict begin 13 H.A end
 479 438 a 479 438 a
SDict begin [/View [/XYZ H.V]/Dest (0:372) cvn /DEST pdfmark end
 479 438 a Fk(Ho)n(w)g(do)g(we)h
(handle)e(netw)o(ork)g(errors?)g(Do)h(we)h(w)o(ait)g(and)e(retry)-5
b(,)19 b(ignore)g(them)h(silently)-5 b(,)19 b(or)h(abort?)-2
622 y
SDict begin H.S end
 -2 622 a -2 622 a
SDict begin 13 H.A end
 -2 622 a -2 622 a
SDict begin [/View [/XYZ H.V]/Dest (0:373) cvn /DEST pdfmark end
 -2 622 a 396
712 a Fk(T)-7 b(ak)o(e)21 b(a)f(typical)g(open)f(source)g(project)h
(lik)o(e)1695 712 y
SDict begin H.S end
 1695 712 a 1695 712 a
SDict begin 13 H.A end
 1695 712 a
1695 712 a
SDict begin [/View [/XYZ H.V]/Dest (0:374) cvn /DEST pdfmark end
 1695 712 a Fk(Hadoop)f(Zook)o(eeper)f
(\(http://hadoop.apache.or)n(g)o(/zoo)o(k)o(eep)o(er/\))c(and)396
820 y(read)20 b(the)g(C)h(API)g(code)e(in)1176 820 y
SDict begin H.S end

1176 820 a 1176 820 a
SDict begin 13 H.A end
 1176 820 a 1176 820 a
SDict begin [/View [/XYZ H.V]/Dest (0:375) cvn /DEST pdfmark end
 1176 820
a Fk(src/c/src/zook)o(eeper)-5 b(.c)396 928 y(\(http://github)m
(.com/apache/zoo)o(k)o(eep)o(er/b)o(lob/tr)o(un)o(k/src/c/src/zo)o(ok)n
(eep)o(er)g(.c\).)14 b(As)21 b(I)g(write)f(this,)g(in)h(2010,)d(the)j
(code)396 1036 y(is)g(3,200)e(lines)i(of)e(mystery)h(and)f(in)i(there)e
(is)j(an)e(undocumented,)c(client-serv)o(er)i(netw)o(ork)h
(communication)396 1143 y(protocol.)f(I)j(see)g(it')-5
b(s)21 b(ef)n(\002cient)f(because)f(it)i(uses)g(poll\(\))e(instead)h
(of)g(select\(\).)g(But)g(really)-5 b(,)20 b(Zook)o(eeper)e(should)h
(be)396 1251 y(using)h(a)h(generic)e(messaging)g(layer)h(and)f(an)h(e)o
(xplicitly)g(documented)d(wire)j(le)n(v)o(el)g(protocol.)e(It)j(is)g
(incredibly)396 1359 y(w)o(asteful)f(for)g(teams)g(to)h(be)f(b)n
(uilding)f(this)i(particular)d(wheel)i(o)o(v)o(er)f(and)h(o)o(v)o(er)-5
b(.)-2 1377 y
SDict begin H.S end
 -2 1377 a -2 1377 a
SDict begin 13 H.A end
 -2 1377 a -2 1377 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-7) cvn /DEST pdfmark end

-2 1377 a 396 1561 a Fg(Figur)o(e)20 b(1-7.)f(Messaging)h(as)h(it)f
(Starts)-2 1661 y
SDict begin H.S end
 -2 1661 a -2 1661 a
SDict begin 13 H.A end
 -2 1661 a -2 1661
a
SDict begin [/View [/XYZ H.V]/Dest (0:378) cvn /DEST pdfmark end
 -2 1661 a 396 3919 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3919 a @beginspecial 0 @llx
-266 @lly 180 @urx 0 @ury 1800 @rwi @setspecial
%%BeginDocument: images/fig7.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -266 180 0
%%HiResBoundingBox: 0.0 -266.0 180.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -94.00029754638672 lineto
158.00030517578125 -94.00029754638672 lineto
158.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -178.00030517578125 moveto
28.00029945373535 -234.00030517578125 lineto
158.00030517578125 -234.00030517578125 lineto
158.00030517578125 -178.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -91.0 lineto
155.0 -91.0 lineto
155.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -91.0 lineto
155.0 -91.0 lineto
155.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -175.0 moveto
25.0 -231.0 lineto
155.0 -231.0 lineto
155.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -175.0 moveto
25.0 -231.0 lineto
155.0 -231.0 lineto
155.0 -175.0 lineto
closepath
stroke
newpath
85.0 -105.0 moveto
85.0 -161.0 lineto
stroke
newpath
85.0 -98.0 moveto
80.0 -112.0 lineto
90.0 -112.0 lineto
closepath
fill
newpath
80.0 -154.0 moveto
85.0 -168.0 lineto
90.0 -154.0 lineto
closepath
fill
/Helvetica findfont
15 scalefont setfont
55.0 -68.0 moveto
(Piece A) show
71.0 -138.0 moveto
(TCP) show
55.0 -208.0 moveto
(Piece B) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3919 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3919 a -2 4085 a
SDict begin H.S end
 -2 4085
a -2 4085 a
SDict begin 13 H.A end
 -2 4085 a -2 4085 a
SDict begin [/View [/XYZ H.V]/Dest (0:381) cvn /DEST pdfmark end
 -2 4085 a 396 4193 a
Fk(But)h(ho)n(w)f(to)g(mak)o(e)g(a)g(reusable)g(messaging)f(layer?)h
(Why)-5 b(,)19 b(when)g(so)i(man)o(y)e(projects)g(need)h(this)h
(technology)-5 b(,)17 b(are)396 4301 y(people)i(still)j(doing)d(it)i
(the)f(hard)f(w)o(ay)-5 b(,)20 b(by)f(dri)n(ving)g(TCP)i(sock)o(ets)f
(in)h(their)f(code,)f(and)g(solving)h(the)g(problems)f(in)h(that)396
4409 y(long)g(list,)h(o)o(v)o(er)d(and)i(o)o(v)o(er?)-2
4593 y
SDict begin H.S end
 -2 4593 a -2 4593 a
SDict begin 13 H.A end
 -2 4593 a -2 4593 a
SDict begin [/View [/XYZ H.V]/Dest (0:382) cvn /DEST pdfmark end
 -2 4593
a 396 4683 a Fk(It)h(turns)f(out)f(that)i(b)n(uilding)e(reusable)g
(messaging)g(systems)i(is)g(really)f(dif)n(\002cult,)f(which)h(is)h
(why)e(fe)n(w)h(FOSS)i(projects)396 4790 y(e)n(v)o(er)e(tried,)f(and)h
(why)f(commercial)g(messaging)g(products)g(are)h(comple)o(x,)e(e)o
(xpensi)n(v)o(e,)g(in\003e)o(xible,)h(and)h(brittle.)g(In)396
4898 y(2006)f(iMatix)h(designed)1141 4898 y
SDict begin H.S end
 1141 4898
a 1141 4898 a
SDict begin 13 H.A end
 1141 4898 a 1141 4898 a
SDict begin [/View [/XYZ H.V]/Dest (0:383) cvn /DEST pdfmark end
 1141 4898 a Fk(AMQP)h
(\(http://www)-5 b(.amqp.or)o(g\))15 b(which)k(started)i(to)f(gi)n(v)o
(e)f(FOSS)i(de)n(v)o(elopers)e(perhaps)f(the)396 5006
y(\002rst)j(reusable)f(recipe)f(for)h(a)g(messaging)g(system.)g(AMQP)g
(w)o(orks)g(better)g(than)g(man)o(y)f(other)g(designs)3408
5006 y
SDict begin H.S end
 3408 5006 a 3408 5006 a
SDict begin 13 H.A end
 3408 5006 a 3408 5006
a
SDict begin [/View [/XYZ H.V]/Dest (0:384) cvn /DEST pdfmark end
 3408 5006 a Fk(b)n(ut)h(remains)396 5114 y(relati)n(v)o(ely)f(comple)
o(x,)f(e)o(xpensi)n(v)o(e,)g(and)i(brittle)g(\(http://www)-5
b(.imatix.com/articles:whats-wrong-)o(with-a)o(mqp)o(\).)14
b(It)p Black 3800 5569 a Ff(24)p Black eop end
%%Page: 25 38
TeXDict begin 25 37 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.25) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:393) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fk(tak)o(es)h(weeks)f(to)g(learn)g(to)g(use,)h(and)e
(months)g(to)i(create)f(stable)g(architectures)f(that)h(don')o(t)f
(crash)h(when)f(things)h(get)396 180 y(hairy)-5 b(.)-2
364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:385) cvn /DEST pdfmark end
 -2 364 a 396
454 a Fk(Most)21 b(messaging)e(projects,)g(lik)o(e)i(AMQP)-9
b(,)20 b(that)g(try)g(to)h(solv)o(e)e(this)i(long)e(list)j(of)e
(problems)e(in)j(a)f(reusable)g(w)o(ay)g(do)g(so)396
562 y(by)g(in)m(v)o(enting)e(a)j(ne)n(w)e(concept,)g(the)h("brok)o
(er",)f(that)h(does)g(addressing,)e(routing,)h(and)g(queuing.)f(This)j
(results)f(in)h(a)396 670 y(client-serv)o(er)e(protocol)f(or)i(a)h(set)
g(of)f(APIs)g(on)g(top)g(of)g(some)g(undocumented)d(protocol,)h(that)i
(let)h(applications)e(speak)396 778 y(to)i(this)f(brok)o(er)-5
b(.)19 b(Brok)o(ers)h(are)g(an)g(e)o(xcellent)f(thing)h(in)g(reducing)e
(the)j(comple)o(xity)d(of)i(lar)o(ge)f(netw)o(orks.)g(But)i(adding)396
886 y(brok)o(er)n(-based)d(messaging)h(to)i(a)f(product)f(lik)o(e)h
(Zook)o(eeper)e(w)o(ould)h(mak)o(e)h(it)h(w)o(orse,)f(not)g(better)-5
b(.)20 b(It)g(w)o(ould)g(mean)396 994 y(adding)f(an)h(additional)f(big)
h(box,)f(and)h(a)g(ne)n(w)g(single)g(point)g(of)g(f)o(ailure.)f(A)i
(brok)o(er)d(rapidly)h(becomes)g(a)i(bottleneck)396 1102
y(and)f(a)h(ne)n(w)f(risk)g(to)g(manage.)f(If)h(the)g(softw)o(are)g
(supports)f(it,)i(we)f(can)g(add)g(a)g(second,)g(third,)f(fourth)g
(brok)o(er)f(and)i(mak)o(e)396 1210 y(some)g(f)o(ail-o)o(v)o(er)f
(scheme.)g(People)h(do)g(this.)g(It)h(creates)f(more)f(mo)o(ving)f
(pieces,)i(more)g(comple)o(xity)-5 b(,)17 b(more)i(things)h(to)396
1318 y(break.)-2 1485 y
SDict begin H.S end
 -2 1485 a -2 1485 a
SDict begin 13 H.A end
 -2 1485 a
-2 1485 a
SDict begin [/View [/XYZ H.V]/Dest (0:386) cvn /DEST pdfmark end
 -2 1485 a 396 1592 a Fk(And)g(a)h(brok)o(er)n(-centric)c
(set-up)j(needs)g(its)h(o)n(wn)e(operations)g(team.)h(Y)-9
b(ou)20 b(literally)g(need)f(to)h(w)o(atch)h(the)f(brok)o(ers)f(day)396
1700 y(and)h(night,)f(and)h(beat)g(them)g(with)g(a)h(stick)f(when)g
(the)o(y)f(start)i(misbeha)n(ving.)d(Y)-9 b(ou)20 b(need)f(box)o(es,)g
(and)h(you)f(need)396 1808 y(backup)g(box)o(es,)g(and)g(you)h(need)f
(people)g(to)i(manage)e(those)h(box)o(es.)f(It)h(is)h(only)f(w)o(orth)f
(doing)g(for)h(lar)o(ge)f(applications)396 1916 y(with)i(man)o(y)e(mo)o
(ving)f(pieces,)i(b)n(uilt)g(by)g(se)n(v)o(eral)g(teams)g(of)g(people,)
f(o)o(v)o(er)f(se)n(v)o(eral)i(years.)-2 2100 y
SDict begin H.S end
 -2 2100
a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:387) cvn /DEST pdfmark end
 -2 2100 a 396 2190 a
Fk(So)h(small)f(to)h(medium)e(application)f(de)n(v)o(elopers)g(are)j
(trapped.)d(Either)i(the)o(y)f(a)n(v)n(oid)h(netw)o(ork)f(programming,)
d(and)396 2297 y(mak)o(e)k(monolithic)f(applications)g(that)h(do)g(not)
f(scale.)i(Or)f(the)o(y)g(jump)f(into)h(netw)o(ork)f(programming)e(and)
j(mak)o(e)396 2405 y(brittle,)g(comple)o(x)f(applications)g(that)h(are)
g(hard)f(to)i(maintain.)e(Or)h(the)o(y)f(bet)i(on)e(a)i(messaging)e
(product,)f(and)i(end)g(up)396 2513 y(with)h(scalable)f(applications)f
(that)h(depend)f(on)g(e)o(xpensi)n(v)o(e,)f(easily)j(brok)o(en)d
(technology)-5 b(.)17 b(There)j(has)g(been)g(no)f(really)396
2621 y(good)g(choice,)g(which)h(is)h(maybe)e(why)g(messaging)h(is)h
(lar)o(gely)e(stuck)h(in)g(the)g(last)h(century)e(and)h(stirs)h(strong)
396 2729 y(emotions.)e(Ne)o(gati)n(v)o(e)g(ones)h(for)f(users,)h
(gleeful)g(jo)o(y)g(for)f(those)h(selling)g(support)f(and)h(licenses.)
-2 2747 y
SDict begin H.S end
 -2 2747 a -2 2747 a
SDict begin 13 H.A end
 -2 2747 a -2 2747 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-8) cvn /DEST pdfmark end
 -2
2747 a Black 3800 5569 a Ff(25)p Black eop end
%%Page: 26 39
TeXDict begin 26 38 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.26) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)g(1-8.)f(Messaging)h(as)h(it)f(Becomes)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:390) cvn /DEST pdfmark end
 -2 172 a 396
3114 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3114 a @beginspecial 0 @llx -348 @lly 304
@urx 0 @ury 3040 @rwi @setspecial
%%BeginDocument: images/fig8.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -348 304 0
%%HiResBoundingBox: 0.0 -348.0 304.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
86.40023803710938 -32.40024185180664 moveto
86.40023803710938 -68.40023803710938 lineto
118.40023803710938 -68.40023803710938 lineto
118.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
230.40023803710938 -32.40024185180664 moveto
230.40023803710938 -68.40023803710938 lineto
262.4002380371094 -68.40023803710938 lineto
262.4002380371094 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -44.40024185180664 moveto
22.400239944458008 -80.40023803710938 lineto
54.40024185180664 -80.40023803710938 lineto
54.40024185180664 -44.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
150.40023803710938 -44.40024185180664 moveto
150.40023803710938 -80.40023803710938 lineto
182.40023803710938 -80.40023803710938 lineto
182.40023803710938 -44.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
150.40023803710938 -188.40023803710938 moveto
150.40023803710938 -224.40023803710938 lineto
182.40023803710938 -224.40023803710938 lineto
182.40023803710938 -188.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -176.40023803710938 moveto
22.400239944458008 -212.40023803710938 lineto
54.40024185180664 -212.40023803710938 lineto
54.40024185180664 -176.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
86.40023803710938 -176.40023803710938 moveto
86.40023803710938 -212.40023803710938 lineto
118.40023803710938 -212.40023803710938 lineto
118.40023803710938 -176.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -176.40023803710938 moveto
214.40023803710938 -212.40023803710938 lineto
246.40023803710938 -212.40023803710938 lineto
246.40023803710938 -176.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
86.40023803710938 -272.4002380371094 moveto
86.40023803710938 -308.4002380371094 lineto
118.40023803710938 -308.4002380371094 lineto
118.40023803710938 -272.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -272.4002380371094 moveto
214.40023803710938 -308.4002380371094 lineto
246.40023803710938 -308.4002380371094 lineto
246.40023803710938 -272.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -284.4002380371094 moveto
22.400239944458008 -320.4002380371094 lineto
54.40024185180664 -320.4002380371094 lineto
54.40024185180664 -284.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
150.40023803710938 -284.4002380371094 moveto
150.40023803710938 -320.4002380371094 lineto
182.40023803710938 -320.4002380371094 lineto
182.40023803710938 -284.4002380371094 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
84.0 -30.0 moveto
84.0 -66.0 lineto
116.0 -66.0 lineto
116.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
84.0 -30.0 moveto
84.0 -66.0 lineto
116.0 -66.0 lineto
116.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
228.0 -30.0 moveto
228.0 -66.0 lineto
260.0 -66.0 lineto
260.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
228.0 -30.0 moveto
228.0 -66.0 lineto
260.0 -66.0 lineto
260.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -42.0 moveto
20.0 -78.0 lineto
52.0 -78.0 lineto
52.0 -42.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -42.0 moveto
20.0 -78.0 lineto
52.0 -78.0 lineto
52.0 -42.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -42.0 moveto
148.0 -78.0 lineto
180.0 -78.0 lineto
180.0 -42.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -42.0 moveto
148.0 -78.0 lineto
180.0 -78.0 lineto
180.0 -42.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -186.0 moveto
148.0 -222.0 lineto
180.0 -222.0 lineto
180.0 -186.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -186.0 moveto
148.0 -222.0 lineto
180.0 -222.0 lineto
180.0 -186.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -174.0 moveto
20.0 -210.0 lineto
52.0 -210.0 lineto
52.0 -174.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -174.0 moveto
20.0 -210.0 lineto
52.0 -210.0 lineto
52.0 -174.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
84.0 -174.0 moveto
84.0 -210.0 lineto
116.0 -210.0 lineto
116.0 -174.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
84.0 -174.0 moveto
84.0 -210.0 lineto
116.0 -210.0 lineto
116.0 -174.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -174.0 moveto
212.0 -210.0 lineto
244.0 -210.0 lineto
244.0 -174.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -174.0 moveto
212.0 -210.0 lineto
244.0 -210.0 lineto
244.0 -174.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
84.0 -270.0 moveto
84.0 -306.0 lineto
116.0 -306.0 lineto
116.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
84.0 -270.0 moveto
84.0 -306.0 lineto
116.0 -306.0 lineto
116.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -270.0 moveto
212.0 -306.0 lineto
244.0 -306.0 lineto
244.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -270.0 moveto
212.0 -306.0 lineto
244.0 -306.0 lineto
244.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -282.0 moveto
20.0 -318.0 lineto
52.0 -318.0 lineto
52.0 -282.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -282.0 moveto
20.0 -318.0 lineto
52.0 -318.0 lineto
52.0 -282.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -282.0 moveto
148.0 -318.0 lineto
180.0 -318.0 lineto
180.0 -282.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -282.0 moveto
148.0 -318.0 lineto
180.0 -318.0 lineto
180.0 -282.0 lineto
closepath
stroke
newpath
204.0 -24.0 moveto
204.0 -96.0 lineto
stroke
newpath
164.0 -108.0 moveto
164.0 -119.0 lineto
stroke
newpath
204.0 -108.0 moveto
204.0 -119.0 lineto
stroke
newpath
100.0 -132.0 moveto
100.0 -162.0 lineto
stroke
newpath
104.0 -150.0 moveto
160.0 -150.0 lineto
stroke
newpath
232.0 -150.0 moveto
284.0 -150.0 lineto
284.0 -234.0 lineto
268.0 -234.0 lineto
268.0 -294.0 lineto
252.0 -294.0 lineto
stroke
newpath
244.0 -66.0 moveto
244.0 -102.0 lineto
100.0 -102.0 lineto
100.0 -120.0 lineto
stroke
newpath
52.0 -54.0 moveto
76.0 -54.0 lineto
stroke
newpath
36.0 -78.0 moveto
36.0 -126.0 lineto
228.0 -126.0 lineto
228.0 -162.0 lineto
stroke
newpath
164.0 -78.0 moveto
164.0 -95.0 lineto
stroke
newpath
164.0 -132.0 moveto
164.0 -186.0 lineto
stroke
newpath
96.0 -150.0 moveto
36.0 -150.0 lineto
36.0 -174.0 lineto
stroke
newpath
124.0 -294.0 moveto
148.0 -294.0 lineto
stroke
newpath
72.0 -48.0 moveto
80.0 -54.0 lineto
72.0 -60.0 lineto
closepath
fill
newpath
96.0 -156.0 moveto
100.0 -168.0 lineto
104.0 -156.0 lineto
closepath
fill
newpath
224.0 -156.0 moveto
228.0 -168.0 lineto
232.0 -156.0 lineto
closepath
fill
newpath
100.0 -216.0 moveto
96.0 -228.0 lineto
104.0 -228.0 lineto
closepath
fill
newpath
228.0 -216.0 moveto
224.0 -228.0 lineto
232.0 -228.0 lineto
closepath
fill
newpath
164.0 -228.0 moveto
160.0 -240.0 lineto
168.0 -240.0 lineto
closepath
fill
newpath
32.0 -264.0 moveto
36.0 -276.0 lineto
40.0 -264.0 lineto
closepath
fill
newpath
160.0 -264.0 moveto
164.0 -276.0 lineto
168.0 -264.0 lineto
closepath
fill
newpath
128.0 -288.0 moveto
120.0 -294.0 lineto
128.0 -300.0 lineto
closepath
fill
newpath
256.0 -288.0 moveto
248.0 -294.0 lineto
256.0 -300.0 lineto
closepath
fill
newpath
204.0 -138.0 moveto
204.0 -150.0 lineto
stroke
newpath
172.0 -150.0 moveto
204.0 -150.0 lineto
stroke
newpath
220.0 -150.0 moveto
204.0 -150.0 lineto
stroke
newpath
100.0 -222.0 moveto
100.0 -246.0 lineto
stroke
newpath
228.0 -222.0 moveto
228.0 -246.0 lineto
164.0 -246.0 lineto
stroke
newpath
36.0 -270.0 moveto
36.0 -246.0 lineto
100.0 -246.0 lineto
stroke
newpath
100.0 -270.0 moveto
100.0 -246.0 lineto
stroke
newpath
164.0 -270.0 moveto
164.0 -234.0 lineto
stroke
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3114 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3114 a 274 x Fk(What)h(we)f(need)g(is)h
(something)e(that)h(does)g(the)g(job)g(of)g(messaging)f(b)n(ut)h(does)g
(it)h(in)g(such)f(a)g(simple)g(and)g(cheap)f(w)o(ay)396
3496 y(that)i(it)f(can)g(w)o(ork)g(in)g(an)o(y)g(application,)e(with)j
(close)f(to)g(zero)g(cost.)g(It)h(should)e(be)h(a)h(library)e(that)h
(you)f(just)i(link)f(with,)396 3604 y(without)g(an)o(y)f(other)g
(dependencies.)f(No)i(additional)f(mo)o(ving)g(pieces,)g(so)i(no)f
(additional)f(risk.)h(It)g(should)f(run)h(on)g(an)o(y)396
3712 y(OS)h(and)f(w)o(ork)f(with)i(an)o(y)e(programming)e(language.)-2
3896 y
SDict begin H.S end
 -2 3896 a -2 3896 a
SDict begin 13 H.A end
 -2 3896 a -2 3896 a
SDict begin [/View [/XYZ H.V]/Dest (0:394) cvn /DEST pdfmark end
 -2 3896
a 396 3986 a Fk(And)j(this)h(is)g(\330MQ:)f(an)g(ef)n(\002cient,)g
(embeddable)e(library)h(that)h(solv)o(es)g(most)h(of)e(the)i(problems)d
(an)j(application)d(needs)396 4094 y(to)j(become)e(nicely)g(elastic)i
(across)f(a)h(netw)o(ork,)e(without)g(much)g(cost.)-2
4278 y
SDict begin H.S end
 -2 4278 a -2 4278 a
SDict begin 13 H.A end
 -2 4278 a -2 4278 a
SDict begin [/View [/XYZ H.V]/Dest (0:395) cvn /DEST pdfmark end
 -2 4278
a 396 4367 a Fk(Speci\002cally:)-2 4385 y
SDict begin H.S end
 -2 4385 a -2
4385 a
SDict begin 13 H.A end
 -2 4385 a -2 4385 a
SDict begin [/View [/XYZ H.V]/Dest (0:396) cvn /DEST pdfmark end
 -2 4385 a -2 4395 a
SDict begin H.S end
 -2 4395
a -2 4395 a
SDict begin 13 H.A end
 -2 4395 a -2 4395 a
SDict begin [/View [/XYZ H.V]/Dest (0:397) cvn /DEST pdfmark end
 -2 4395 a Black 396 4538
a Fj(\225)p Black 479 4538 a
SDict begin H.S end
 479 4538 a 479 4538 a
SDict begin 13 H.A end
 479
4538 a 479 4538 a
SDict begin [/View [/XYZ H.V]/Dest (0:398) cvn /DEST pdfmark end
 479 4538 a Fk(It)i(handles)e(I/O)i(asynchronously)-5
b(,)16 b(in)k(background)d(threads.)i(These)h(communicate)e(with)j
(application)d(threads)479 4646 y(using)i(lock-free)e(data)i
(structures,)g(so)g(concurrent)e(\330MQ)i(applications)f(need)h(no)g
(locks,)f(semaphores,)g(or)h(other)479 4754 y(w)o(ait)h(states.)-2
4755 y
SDict begin H.S end
 -2 4755 a -2 4755 a
SDict begin 13 H.A end
 -2 4755 a -2 4755 a
SDict begin [/View [/XYZ H.V]/Dest (0:399) cvn /DEST pdfmark end
 -2 4755
a Black 396 4903 a Fj(\225)p Black 479 4903 a
SDict begin H.S end
 479 4903
a 479 4903 a
SDict begin 13 H.A end
 479 4903 a 479 4903 a
SDict begin [/View [/XYZ H.V]/Dest (0:400) cvn /DEST pdfmark end
 479 4903 a Fk(Components)e(can)h
(come)f(and)h(go)g(dynamically)e(and)i(\330MQ)g(will)h(automatically)e
(reconnect.)f(This)i(means)g(you)479 5011 y(can)g(start)h(components)d
(in)i(an)o(y)g(order)-5 b(.)19 b(Y)-9 b(ou)19 b(can)h(create)g
("service-oriented)e(architectures")h(\(SO)m(As\))h(where)479
5119 y(services)g(can)g(join)g(and)g(lea)n(v)o(e)g(the)g(netw)o(ork)f
(at)i(an)o(y)e(time.)-2 5137 y
SDict begin H.S end
 -2 5137 a -2 5137 a
SDict begin 13 H.A end
 -2
5137 a -2 5137 a
SDict begin [/View [/XYZ H.V]/Dest (0:401) cvn /DEST pdfmark end
 -2 5137 a Black 3798 5569 a Ff(26)p
Black eop end
%%Page: 27 40
TeXDict begin 27 39 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.27) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:427) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:402) cvn /DEST pdfmark end
 479 72 a Fk(It)h(queues)e(messages)h
(automatically)f(when)h(needed.)e(It)j(does)f(this)g(intelligently)-5
b(,)19 b(pushing)g(messages)h(as)h(close)f(as)479 180
y(possible)g(to)h(the)f(recei)n(v)o(er)e(before)h(queuing)g(them.)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:403) cvn /DEST pdfmark end
 -2 198 a Black
396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330
a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:404) cvn /DEST pdfmark end
 479 330 a Fk(It)i(has)f(w)o(ays)h(of)f(dealing)f
(with)h(o)o(v)o(er)n(-full)e(queues)i(\(called)f("high)g(w)o(ater)i
(mark"\).)d(When)i(a)h(queue)e(is)i(full,)f(\330MQ)479
438 y(automatically)f(blocks)h(senders,)f(or)h(thro)n(ws)g(a)o(w)o(ay)f
(messages,)i(depending)c(on)j(the)g(kind)g(of)f(messaging)h(you)f(are)
479 546 y(doing)g(\(the)h(so-called)f("pattern"\).)-2
564 y
SDict begin H.S end
 -2 564 a -2 564 a
SDict begin 13 H.A end
 -2 564 a -2 564 a
SDict begin [/View [/XYZ H.V]/Dest (0:405) cvn /DEST pdfmark end
 -2 564 a Black
396 695 a Fj(\225)p Black 479 695 a
SDict begin H.S end
 479 695 a 479 695
a
SDict begin 13 H.A end
 479 695 a 479 695 a
SDict begin [/View [/XYZ H.V]/Dest (0:406) cvn /DEST pdfmark end
 479 695 a Fk(It)i(lets)g(your)e(applications)g
(talk)h(to)g(each)g(other)g(o)o(v)o(er)e(arbitrary)h(transports:)g(TCP)
-9 b(,)21 b(multicast,)f(in-process,)479 803 y(inter)n(-process.)f(Y)-9
b(ou)20 b(don')o(t)e(need)i(to)g(change)f(your)g(code)g(to)i(use)f(a)h
(dif)n(ferent)d(transport.)-2 821 y
SDict begin H.S end
 -2 821 a -2 821 a
SDict begin 13 H.A end

-2 821 a -2 821 a
SDict begin [/View [/XYZ H.V]/Dest (0:407) cvn /DEST pdfmark end
 -2 821 a Black 396 953 a Fj(\225)p
Black 479 953 a
SDict begin H.S end
 479 953 a 479 953 a
SDict begin 13 H.A end
 479 953 a 479 953
a
SDict begin [/View [/XYZ H.V]/Dest (0:408) cvn /DEST pdfmark end
 479 953 a Fk(It)j(handles)e(slo)n(w/block)o(ed)g(readers)g(safely)-5
b(,)20 b(using)f(dif)n(ferent)g(strate)o(gies)h(that)g(depend)f(on)g
(the)i(messaging)e(pattern.)-2 970 y
SDict begin H.S end
 -2 970 a -2 970
a
SDict begin 13 H.A end
 -2 970 a -2 970 a
SDict begin [/View [/XYZ H.V]/Dest (0:409) cvn /DEST pdfmark end
 -2 970 a Black 396 1102 a Fj(\225)p
Black 479 1102 a
SDict begin H.S end
 479 1102 a 479 1102 a
SDict begin 13 H.A end
 479 1102 a 479
1102 a
SDict begin [/View [/XYZ H.V]/Dest (0:410) cvn /DEST pdfmark end
 479 1102 a Fk(It)i(lets)g(you)e(route)g(messages)i(using)e(a)i
(v)n(ariety)e(of)h(patterns)g(such)g(as)h(request-reply)c(and)j
(publish-subscribe.)479 1210 y(These)g(patterns)g(are)g(ho)n(w)g(you)f
(create)h(the)g(topology)-5 b(,)17 b(the)k(structure)e(of)h(your)f
(netw)o(ork.)-2 1228 y
SDict begin H.S end
 -2 1228 a -2 1228 a
SDict begin 13 H.A end
 -2 1228 a
-2 1228 a
SDict begin [/View [/XYZ H.V]/Dest (0:411) cvn /DEST pdfmark end
 -2 1228 a Black 396 1359 a Fj(\225)p Black
479 1359 a
SDict begin H.S end
 479 1359 a 479 1359 a
SDict begin 13 H.A end
 479 1359 a 479 1359
a
SDict begin [/View [/XYZ H.V]/Dest (0:412) cvn /DEST pdfmark end
 479 1359 a Fk(It)i(lets)g(you)e(create)h(proxies)f(to)i(queue,)d
(forw)o(ard,)h(or)h(capture)f(messages)h(with)g(a)h(single)f(call.)h
(Proxies)e(can)h(reduce)479 1467 y(the)g(interconnection)e(comple)o
(xity)g(of)i(a)g(netw)o(ork.)-2 1485 y
SDict begin H.S end
 -2 1485 a -2 1485
a
SDict begin 13 H.A end
 -2 1485 a -2 1485 a
SDict begin [/View [/XYZ H.V]/Dest (0:413) cvn /DEST pdfmark end
 -2 1485 a Black 396 1617 a Fj(\225)p
Black 479 1617 a
SDict begin H.S end
 479 1617 a 479 1617 a
SDict begin 13 H.A end
 479 1617 a 479
1617 a
SDict begin [/View [/XYZ H.V]/Dest (0:414) cvn /DEST pdfmark end
 479 1617 a Fk(It)h(deli)n(v)o(ers)e(whole)h(messages)g(e)o
(xactly)f(as)i(the)o(y)f(were)g(sent,)g(using)g(a)g(simple)g(framing)f
(on)h(the)g(wire.)g(If)g(you)f(write)479 1725 y(a)i(10k)e(message,)h
(you)f(will)i(recei)n(v)o(e)e(a)i(10k)e(message.)-2 1743
y
SDict begin H.S end
 -2 1743 a -2 1743 a
SDict begin 13 H.A end
 -2 1743 a -2 1743 a
SDict begin [/View [/XYZ H.V]/Dest (0:415) cvn /DEST pdfmark end
 -2 1743 a Black
396 1874 a Fj(\225)p Black 479 1874 a
SDict begin H.S end
 479 1874 a 479
1874 a
SDict begin 13 H.A end
 479 1874 a 479 1874 a
SDict begin [/View [/XYZ H.V]/Dest (0:416) cvn /DEST pdfmark end
 479 1874 a Fk(It)i(does)f(not)g(impose)f
(an)o(y)h(format)f(on)g(messages.)i(The)o(y)e(are)h(blobs)f(of)h(zero)g
(to)g(gigabytes)f(lar)o(ge.)g(When)h(you)f(w)o(ant)479
1982 y(to)i(represent)e(data)h(you)f(choose)g(some)h(other)g(product)e
(on)i(top,)f(such)h(as)h(Google')-5 b(s)20 b(protocol)e(b)n(uf)n(fers,)
h(XDR,)i(and)479 2090 y(others.)-2 2091 y
SDict begin H.S end
 -2 2091 a -2
2091 a
SDict begin 13 H.A end
 -2 2091 a -2 2091 a
SDict begin [/View [/XYZ H.V]/Dest (0:417) cvn /DEST pdfmark end
 -2 2091 a Black 396 2239 a
Fj(\225)p Black 479 2239 a
SDict begin H.S end
 479 2239 a 479 2239 a
SDict begin 13 H.A end
 479
2239 a 479 2239 a
SDict begin [/View [/XYZ H.V]/Dest (0:418) cvn /DEST pdfmark end
 479 2239 a Fk(It)g(handles)e(netw)o(ork)g(errors)g
(intelligently)-5 b(.)19 b(Sometimes)h(it)h(retries,)f(sometimes)g(it)g
(tells)i(you)d(an)h(operation)e(f)o(ailed.)-2 2257 y
SDict begin H.S end

-2 2257 a -2 2257 a
SDict begin 13 H.A end
 -2 2257 a -2 2257 a
SDict begin [/View [/XYZ H.V]/Dest (0:419) cvn /DEST pdfmark end
 -2 2257 a Black
396 2389 a Fj(\225)p Black 479 2389 a
SDict begin H.S end
 479 2389 a 479
2389 a
SDict begin 13 H.A end
 479 2389 a 479 2389 a
SDict begin [/View [/XYZ H.V]/Dest (0:420) cvn /DEST pdfmark end
 479 2389 a Fk(It)i(reduces)e(your)h
(carbon)e(footprint.)h(Doing)g(more)h(with)g(less)i(CPU)f(means)f(your)
g(box)o(es)f(use)i(less)g(po)n(wer)m(,)e(and)h(you)479
2497 y(can)h(k)o(eep)g(your)f(old)h(box)o(es)f(in)h(use)h(for)e(longer)
-5 b(.)19 b(Al)i(Gore)f(w)o(ould)f(lo)o(v)o(e)h(\330MQ.)-2
2681 y
SDict begin H.S end
 -2 2681 a -2 2681 a
SDict begin 13 H.A end
 -2 2681 a -2 2681 a
SDict begin [/View [/XYZ H.V]/Dest (0:421) cvn /DEST pdfmark end
 -2 2681
a 396 2771 a Fk(Actually)g(\330MQ)g(does)g(rather)g(more)f(than)h
(this.)g(It)h(has)f(a)h(sub)o(v)o(ersi)n(v)o(e)d(ef)n(fect)h(on)h(ho)n
(w)g(you)f(de)n(v)o(elop)396 2879 y(netw)o(ork-capable)e(applications.)
i(Super\002cially)g(it')-5 b(s)22 b(a)e(sock)o(et-inspired)e(API)j(on)f
(which)f(you)h(do)396 2987 y(zmq_msg_recv[3])c(and)k(zmq_msg_send[3].)c
(But)k(message)g(processing)f(rapidly)g(becomes)g(the)i(central)e
(loop,)g(and)396 3094 y(your)g(application)g(soon)g(breaks)h(do)n(wn)f
(into)h(a)h(set)g(of)f(message)g(processing)e(tasks.)j(It)f(is)i(ele)o
(gant)c(and)i(natural.)f(And)396 3202 y(it)i(scales:)g(each)f(of)g
(these)g(tasks)h(maps)f(to)h(a)f(node,)f(and)h(the)g(nodes)f(talk)i(to)
f(each)g(other)f(across)h(arbitrary)f(transports.)396
3310 y(T)-7 b(w)o(o)21 b(nodes)e(in)i(one)e(process)h(\(node)f(is)i(a)f
(thread\),)f(tw)o(o)i(nodes)e(on)h(one)f(box)h(\(node)e(is)k(a)e
(process\),)f(or)h(tw)o(o)h(box)o(es)e(on)396 3418 y(one)h(netw)o(ork)f
(\(node)g(is)i(a)f(box\))f(-)i(it')-5 b(s)21 b(all)g(the)f(same,)g
(with)h(no)e(application)g(code)h(changes.)-2 3447 y
SDict begin H.S end

-2 3447 a -2 3447 a
SDict begin 13 H.A end
 -2 3447 a -2 3447 a
SDict begin [/View [/XYZ H.V]/Dest (0:422) cvn /DEST pdfmark end
 -2 3447 a 359
x Fn(1.14.)39 b(Soc)m(ket)f(Scalability)1576 3806 y
SDict begin H.S end
 1576
3806 a 1576 3806 a
SDict begin 22.464 H.A end
 1576 3806 a 1576 3806 a
SDict begin [/View [/XYZ H.V]/Dest (6.18.1) cvn /DEST pdfmark end
 1576 3806
a -2 4002 a
SDict begin H.S end
 -2 4002 a -2 4002 a
SDict begin 13 H.A end
 -2 4002 a -2 4002 a
SDict begin [/View [/XYZ H.V]/Dest (0:424) cvn /DEST pdfmark end
 -2
4002 a 396 4080 a Fk(Let')-5 b(s)21 b(see)g(\330MQ')-5
b(s)21 b(scalability)f(in)g(action.)f(Here)i(is)g(a)f(shell)h(script)f
(that)g(starts)h(the)g(weather)e(serv)o(er)g(and)h(then)g(a)396
4188 y(b)n(unch)f(of)h(clients)h(in)f(parallel:)-2 4289
y
SDict begin H.S end
 -2 4289 a -2 4289 a
SDict begin 11.7 H.A end
 -2 4289 a -2 4289 a
SDict begin [/View [/XYZ H.V]/Dest (0:425) cvn /DEST pdfmark end
 -2 4289 a 396
4368 a Fe(wuserver)44 b(&)396 4465 y(wuclient)g(12345)g(&)396
4562 y(wuclient)g(23456)g(&)396 4659 y(wuclient)g(34567)g(&)396
4756 y(wuclient)g(45678)g(&)396 4853 y(wuclient)g(56789)g(&)p
Black 3797 5569 a Ff(27)p Black eop end
%%Page: 28 41
TeXDict begin 28 40 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.28) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:438) cvn /DEST pdfmark end
 -2 -201 a 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:426) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(As)h(the)f(clients)h(run,)e(we)i(tak)o(e)f(a)h(look)e
(at)i(the)f(acti)n(v)o(e)g(processes)f(using)h(')o(top',)f(and)g(we)i
(see)f(something)f(lik)o(e)i(\(on)e(a)396 180 y(4-core)g(box\):)486
361 y Fe(PID)44 b(USER)269 b(PR)89 b(NI)g(VIRT)g(RES)g(SHR)45
b(S)f(\045CPU)h(\045MEM)178 b(TIME+)89 b(COMMAND)441
458 y(7136)44 b(ph)359 b(20)134 b(0)44 b(1040m)g(959m)h(1156)f(R)89
b(157)45 b(12.0)89 b(16:25.47)43 b(wuserver)441 555 y(7966)h(ph)359
b(20)134 b(0)44 b(98608)g(1804)h(1372)f(S)134 b(33)89
b(0.0)134 b(0:03.94)44 b(wuclient)441 652 y(7963)g(ph)359
b(20)134 b(0)44 b(33116)g(1748)h(1372)f(S)134 b(14)89
b(0.0)134 b(0:00.76)44 b(wuclient)441 749 y(7965)g(ph)359
b(20)134 b(0)44 b(33116)g(1784)h(1372)f(S)179 b(6)89
b(0.0)134 b(0:00.47)44 b(wuclient)441 846 y(7964)g(ph)359
b(20)134 b(0)44 b(33116)g(1788)h(1372)f(S)179 b(5)89
b(0.0)134 b(0:00.25)44 b(wuclient)441 943 y(7967)g(ph)359
b(20)134 b(0)44 b(33072)g(1740)h(1372)f(S)179 b(5)89
b(0.0)134 b(0:00.35)44 b(wuclient)-2 1121 y
SDict begin H.S end
 -2 1121 a
-2 1121 a
SDict begin 13 H.A end
 -2 1121 a -2 1121 a
SDict begin [/View [/XYZ H.V]/Dest (0:428) cvn /DEST pdfmark end
 -2 1121 a 396 1217 a Fk(Let')-5
b(s)21 b(think)f(for)f(a)i(second)e(about)g(what)h(is)h(happening)d
(here.)i(The)f(weather)h(serv)o(er)f(has)i(a)f(single)g(sock)o(et,)g
(and)g(yet)396 1325 y(here)g(we)g(ha)n(v)o(e)g(it)h(sending)e(data)h
(to)g(\002)n(v)o(e)g(clients)h(in)f(parallel.)g(W)-7
b(e)21 b(could)e(ha)n(v)o(e)h(thousands)f(of)h(concurrent)d(clients.)
396 1433 y(The)j(serv)o(er)f(application)g(doesn')o(t)f(see)j(them,)e
(doesn')o(t)g(talk)h(to)g(them)g(directly)-5 b(.)19 b(So)h(the)g
(\330MQ)g(sock)o(et)g(is)h(acting)f(lik)o(e)g(a)396 1541
y(little)h(serv)o(er)m(,)e(silently)h(accepting)f(client)h(requests)g
(and)g(sho)o(ving)e(data)i(out)g(to)h(them)e(as)i(f)o(ast)g(as)g(the)f
(netw)o(ork)f(can)396 1649 y(handle)g(it.)i(And)f(it')-5
b(s)21 b(a)g(multithreaded)d(serv)o(er)m(,)g(squeezing)h(more)g(juice)i
(out)e(of)h(your)f(CPU.)-2 1677 y
SDict begin H.S end
 -2 1677 a -2 1677 a
SDict begin 13 H.A end

-2 1677 a -2 1677 a
SDict begin [/View [/XYZ H.V]/Dest (0:429) cvn /DEST pdfmark end
 -2 1677 a 360 x Fn(1.15.)39 b(Missing)f(Messa)o(g)q
(e)g(Pr)m(ob)o(lem)f(Solver)2626 2037 y
SDict begin H.S end
 2626 2037 a 2626
2037 a
SDict begin 22.464 H.A end
 2626 2037 a 2626 2037 a
SDict begin [/View [/XYZ H.V]/Dest (6.19.1) cvn /DEST pdfmark end
 2626 2037 a -2 2235 a
SDict begin H.S end

-2 2235 a -2 2235 a
SDict begin 13 H.A end
 -2 2235 a -2 2235 a
SDict begin [/View [/XYZ H.V]/Dest (0:431) cvn /DEST pdfmark end
 -2 2235 a 396
2311 a Fk(As)21 b(you)f(start)g(to)h(program)d(with)i(\330MQ)g(you)g
(will)h(come)e(across)h(one)g(problem)f(more)g(than)h(once:)f(you)h
(lose)396 2418 y(messages)h(that)f(you)f(e)o(xpect)g(to)i(recei)n(v)o
(e.)e(Here)h(is)h(a)f(basic)h(problem)d(solv)o(er\()p
0 TeXcolorgray 2656 2418 a
SDict begin H.S end
 2656 2418 a Fk(Figure)g(1-9)3004
2418 y
SDict begin 13 H.L end
 3004 2418 a 3004 2418 a
SDict begin [/Subtype /Link/Dest (0:figure-9) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3004 2418 a Black -1 w
Fk(\))i(that)g(w)o(alks)h(through)d(the)396 2526 y(most)i(common)f
(causes)h(for)g(this.)g(Don')o(t)f(w)o(orry)g(if)i(some)f(of)g(the)g
(terminology)e(is)j(unf)o(amiliar)e(still,)i(it')o(ll)g(become)396
2634 y(clearer)f(in)g(the)g(ne)o(xt)g(chapters.)-2 2652
y
SDict begin H.S end
 -2 2652 a -2 2652 a
SDict begin 13 H.A end
 -2 2652 a -2 2652 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-9) cvn /DEST pdfmark end
 -2 2652 a Black
3800 5569 a Ff(28)p Black eop end
%%Page: 29 42
TeXDict begin 29 41 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.29) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)g(1-9.)f(Missing)i(Message)g(Pr)o(oblem)f
(Solv)o(er)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172
a
SDict begin [/View [/XYZ H.V]/Dest (0:435) cvn /DEST pdfmark end
 -2 172 a 396 4047 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4047 a @beginspecial 0 @llx
-460 @lly 243 @urx 0 @ury 2430 @rwi @setspecial
%%BeginDocument: images/fig9.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -460 243 0
%%HiResBoundingBox: 0.0 -460.0 243.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -12.900090217590332 moveto
7.900090217590332 -32.900089263916016 lineto
61.900089263916016 -32.900089263916016 lineto
61.900089263916016 -12.900090217590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -17.900089263916016 moveto
88.90009307861328 -42.900089263916016 lineto
142.90008544921875 -42.900089263916016 lineto
142.90008544921875 -17.900089263916016 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.90008544921875 -17.900089263916016 moveto
169.90008544921875 -42.900089263916016 lineto
220.90008544921875 -42.900089263916016 lineto
220.90008544921875 -17.900089263916016 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -47.900089263916016 moveto
7.900090217590332 -72.90009307861328 lineto
61.900089263916016 -72.90009307861328 lineto
61.900089263916016 -47.900089263916016 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -57.900089263916016 moveto
88.90009307861328 -82.90009307861328 lineto
142.90008544921875 -82.90009307861328 lineto
142.90008544921875 -57.900089263916016 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.90008544921875 -57.900089263916016 moveto
169.90008544921875 -87.90009307861328 lineto
220.90008544921875 -87.90009307861328 lineto
220.90008544921875 -57.900089263916016 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
85.90009307861328 -97.90009307861328 moveto
85.90009307861328 -117.90009307861328 lineto
148.90008544921875 -117.90009307861328 lineto
148.90008544921875 -97.90009307861328 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -112.90009307861328 moveto
7.900090217590332 -142.90008544921875 lineto
61.900089263916016 -142.90008544921875 lineto
61.900089263916016 -112.90009307861328 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
166.90008544921875 -112.90009307861328 moveto
166.90008544921875 -142.90008544921875 lineto
229.90008544921875 -142.90008544921875 lineto
229.90008544921875 -112.90009307861328 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -152.90008544921875 moveto
88.90009307861328 -182.90008544921875 lineto
154.90008544921875 -182.90008544921875 lineto
154.90008544921875 -152.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
181.90008544921875 -152.90008544921875 moveto
181.90008544921875 -182.90008544921875 lineto
235.90008544921875 -182.90008544921875 lineto
235.90008544921875 -152.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -157.90008544921875 moveto
7.900090217590332 -177.90008544921875 lineto
61.900089263916016 -177.90008544921875 lineto
61.900089263916016 -157.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -192.90008544921875 moveto
7.900090217590332 -217.90008544921875 lineto
61.900089263916016 -217.90008544921875 lineto
61.900089263916016 -192.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -192.90008544921875 moveto
88.90009307861328 -217.90008544921875 lineto
142.90008544921875 -217.90008544921875 lineto
142.90008544921875 -192.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -232.90008544921875 moveto
7.900090217590332 -257.90008544921875 lineto
61.900089263916016 -257.90008544921875 lineto
61.900089263916016 -232.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -232.90008544921875 moveto
88.90009307861328 -257.90008544921875 lineto
142.90008544921875 -257.90008544921875 lineto
142.90008544921875 -232.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.90008544921875 -232.90008544921875 moveto
169.90008544921875 -257.90008544921875 lineto
226.90008544921875 -257.90008544921875 lineto
226.90008544921875 -232.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -277.90008544921875 moveto
88.90009307861328 -302.90008544921875 lineto
142.90008544921875 -302.90008544921875 lineto
142.90008544921875 -277.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.90008544921875 -277.90008544921875 moveto
169.90008544921875 -302.90008544921875 lineto
226.90008544921875 -302.90008544921875 lineto
226.90008544921875 -277.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -282.90008544921875 moveto
7.900090217590332 -307.90008544921875 lineto
61.900089263916016 -307.90008544921875 lineto
61.900089263916016 -282.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -317.90008544921875 moveto
88.90009307861328 -337.90008544921875 lineto
142.90008544921875 -337.90008544921875 lineto
142.90008544921875 -317.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -347.90008544921875 moveto
7.900090217590332 -372.90008544921875 lineto
61.900089263916016 -372.90008544921875 lineto
61.900089263916016 -347.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -347.90008544921875 moveto
88.90009307861328 -377.90008544921875 lineto
142.90008544921875 -377.90008544921875 lineto
142.90008544921875 -347.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.90008544921875 -347.90008544921875 moveto
169.90008544921875 -377.90008544921875 lineto
223.90008544921875 -377.90008544921875 lineto
223.90008544921875 -347.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -387.90008544921875 moveto
7.900090217590332 -412.90008544921875 lineto
61.900089263916016 -412.90008544921875 lineto
61.900089263916016 -387.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.90009307861328 -387.90008544921875 moveto
88.90009307861328 -417.90008544921875 lineto
151.90008544921875 -417.90008544921875 lineto
151.90008544921875 -387.90008544921875 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
7.900090217590332 -427.90008544921875 moveto
7.900090217590332 -447.90008544921875 lineto
61.900089263916016 -447.90008544921875 lineto
61.900089263916016 -427.90008544921875 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -12.0 moveto
7.0 -32.0 lineto
61.0 -32.0 lineto
61.0 -12.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.3 setlinewidth
1 setlinecap
[] 0 setdash
newpath
7.0 -12.0 moveto
7.0 -32.0 lineto
61.0 -32.0 lineto
61.0 -12.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -17.0 moveto
88.0 -42.0 lineto
142.0 -42.0 lineto
142.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -17.0 moveto
88.0 -42.0 lineto
142.0 -42.0 lineto
142.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
169.0 -17.0 moveto
169.0 -42.0 lineto
220.0 -42.0 lineto
220.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
169.0 -17.0 moveto
169.0 -42.0 lineto
220.0 -42.0 lineto
220.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -47.0 moveto
7.0 -72.0 lineto
61.0 -72.0 lineto
61.0 -47.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -47.0 moveto
7.0 -72.0 lineto
61.0 -72.0 lineto
61.0 -47.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -57.0 moveto
88.0 -82.0 lineto
142.0 -82.0 lineto
142.0 -57.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -57.0 moveto
88.0 -82.0 lineto
142.0 -82.0 lineto
142.0 -57.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
169.0 -57.0 moveto
169.0 -87.0 lineto
220.0 -87.0 lineto
220.0 -57.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
169.0 -57.0 moveto
169.0 -87.0 lineto
220.0 -87.0 lineto
220.0 -57.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
85.0 -97.0 moveto
85.0 -117.0 lineto
148.0 -117.0 lineto
148.0 -97.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
85.0 -97.0 moveto
85.0 -117.0 lineto
148.0 -117.0 lineto
148.0 -97.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -112.0 moveto
7.0 -142.0 lineto
61.0 -142.0 lineto
61.0 -112.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -112.0 moveto
7.0 -142.0 lineto
61.0 -142.0 lineto
61.0 -112.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
166.0 -112.0 moveto
166.0 -142.0 lineto
229.0 -142.0 lineto
229.0 -112.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
166.0 -112.0 moveto
166.0 -142.0 lineto
229.0 -142.0 lineto
229.0 -112.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -152.0 moveto
88.0 -182.0 lineto
154.0 -182.0 lineto
154.0 -152.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -152.0 moveto
88.0 -182.0 lineto
154.0 -182.0 lineto
154.0 -152.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
181.0 -152.0 moveto
181.0 -182.0 lineto
235.0 -182.0 lineto
235.0 -152.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
181.0 -152.0 moveto
181.0 -182.0 lineto
235.0 -182.0 lineto
235.0 -152.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -157.0 moveto
7.0 -177.0 lineto
61.0 -177.0 lineto
61.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -157.0 moveto
7.0 -177.0 lineto
61.0 -177.0 lineto
61.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -192.0 moveto
7.0 -217.0 lineto
61.0 -217.0 lineto
61.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -192.0 moveto
7.0 -217.0 lineto
61.0 -217.0 lineto
61.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -192.0 moveto
88.0 -217.0 lineto
142.0 -217.0 lineto
142.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -192.0 moveto
88.0 -217.0 lineto
142.0 -217.0 lineto
142.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -232.0 moveto
7.0 -257.0 lineto
61.0 -257.0 lineto
61.0 -232.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -232.0 moveto
7.0 -257.0 lineto
61.0 -257.0 lineto
61.0 -232.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -232.0 moveto
88.0 -257.0 lineto
142.0 -257.0 lineto
142.0 -232.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -232.0 moveto
88.0 -257.0 lineto
142.0 -257.0 lineto
142.0 -232.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
169.0 -232.0 moveto
169.0 -257.0 lineto
226.0 -257.0 lineto
226.0 -232.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
169.0 -232.0 moveto
169.0 -257.0 lineto
226.0 -257.0 lineto
226.0 -232.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -277.0 moveto
88.0 -302.0 lineto
142.0 -302.0 lineto
142.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -277.0 moveto
88.0 -302.0 lineto
142.0 -302.0 lineto
142.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
169.0 -277.0 moveto
169.0 -302.0 lineto
226.0 -302.0 lineto
226.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
169.0 -277.0 moveto
169.0 -302.0 lineto
226.0 -302.0 lineto
226.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -282.0 moveto
7.0 -307.0 lineto
61.0 -307.0 lineto
61.0 -282.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -282.0 moveto
7.0 -307.0 lineto
61.0 -307.0 lineto
61.0 -282.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -317.0 moveto
88.0 -337.0 lineto
142.0 -337.0 lineto
142.0 -317.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -317.0 moveto
88.0 -337.0 lineto
142.0 -337.0 lineto
142.0 -317.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -347.0 moveto
7.0 -372.0 lineto
61.0 -372.0 lineto
61.0 -347.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -347.0 moveto
7.0 -372.0 lineto
61.0 -372.0 lineto
61.0 -347.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -347.0 moveto
88.0 -377.0 lineto
142.0 -377.0 lineto
142.0 -347.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -347.0 moveto
88.0 -377.0 lineto
142.0 -377.0 lineto
142.0 -347.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
169.0 -347.0 moveto
169.0 -377.0 lineto
223.0 -377.0 lineto
223.0 -347.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
169.0 -347.0 moveto
169.0 -377.0 lineto
223.0 -377.0 lineto
223.0 -347.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -387.0 moveto
7.0 -412.0 lineto
61.0 -412.0 lineto
61.0 -387.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -387.0 moveto
7.0 -412.0 lineto
61.0 -412.0 lineto
61.0 -387.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -387.0 moveto
88.0 -417.0 lineto
151.0 -417.0 lineto
151.0 -387.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -387.0 moveto
88.0 -417.0 lineto
151.0 -417.0 lineto
151.0 -387.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
7.0 -427.0 moveto
7.0 -447.0 lineto
61.0 -447.0 lineto
61.0 -427.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
7.0 -427.0 moveto
7.0 -447.0 lineto
61.0 -447.0 lineto
61.0 -427.0 lineto
closepath
stroke
newpath
34.0 -32.0 moveto
34.0 -42.0 lineto
stroke
newpath
142.0 -27.0 moveto
166.0 -27.0 lineto
stroke
newpath
115.0 -42.0 moveto
115.0 -52.0 lineto
stroke
newpath
85.0 -27.0 moveto
75.0 -27.0 lineto
73.66666666666667 -27.0 73.0 -28.0 73.0 -30.0 curveto
73.0 -55.0 lineto
73.0 -55.0 lineto
73.0 -56.333333333333336 72.66666666666667 -57.0 72.0 -57.0 curveto
61.0 -57.0 lineto
61.0 -57.0 lineto
stroke
newpath
34.0 -72.0 moveto
34.0 -110.0 lineto
stroke
newpath
142.0 -67.0 moveto
166.0 -67.0 lineto
stroke
newpath
115.0 -82.0 moveto
115.0 -92.0 lineto
stroke
newpath
61.0 -127.0 moveto
163.0 -127.0 lineto
stroke
newpath
34.0 -142.0 moveto
34.0 -152.0 lineto
stroke
newpath
154.0 -167.0 moveto
178.0 -167.0 lineto
stroke
newpath
61.0 -167.0 moveto
85.0 -167.0 lineto
stroke
newpath
34.0 -177.0 moveto
34.0 -187.0 lineto
stroke
newpath
61.0 -202.0 moveto
85.0 -202.0 lineto
stroke
newpath
34.0 -217.0 moveto
34.0 -227.0 lineto
stroke
newpath
61.0 -242.0 moveto
85.0 -242.0 lineto
stroke
newpath
142.0 -242.0 moveto
166.0 -242.0 lineto
stroke
newpath
142.0 -287.0 moveto
166.0 -287.0 lineto
stroke
newpath
115.0 -302.0 moveto
115.0 -312.0 lineto
stroke
newpath
61.0 -292.0 moveto
85.0 -292.0 lineto
stroke
newpath
34.0 -307.0 moveto
34.0 -342.0 lineto
stroke
newpath
61.0 -362.0 moveto
85.0 -362.0 lineto
stroke
newpath
34.0 -372.0 moveto
34.0 -382.0 lineto
stroke
newpath
142.0 -362.0 moveto
166.0 -362.0 lineto
stroke
newpath
61.0 -397.0 moveto
85.0 -397.0 lineto
stroke
newpath
34.0 -412.0 moveto
34.0 -422.0 lineto
stroke
newpath
84.0 -25.0 moveto
87.0 -27.0 lineto
84.0 -30.0 lineto
closepath
fill
newpath
165.0 -25.0 moveto
168.0 -27.0 lineto
165.0 -30.0 lineto
closepath
fill
newpath
33.0 -40.0 moveto
34.0 -45.0 lineto
36.0 -40.0 lineto
closepath
fill
newpath
114.0 -50.0 moveto
115.0 -55.0 lineto
117.0 -50.0 lineto
closepath
fill
newpath
165.0 -65.0 moveto
168.0 -67.0 lineto
165.0 -70.0 lineto
closepath
fill
newpath
114.0 -90.0 moveto
115.0 -95.0 lineto
117.0 -90.0 lineto
closepath
fill
newpath
162.0 -125.0 moveto
165.0 -127.0 lineto
162.0 -130.0 lineto
closepath
fill
newpath
33.0 -150.0 moveto
34.0 -155.0 lineto
36.0 -150.0 lineto
closepath
fill
newpath
84.0 -165.0 moveto
87.0 -167.0 lineto
84.0 -170.0 lineto
closepath
fill
newpath
177.0 -165.0 moveto
180.0 -167.0 lineto
177.0 -170.0 lineto
closepath
fill
newpath
33.0 -185.0 moveto
34.0 -190.0 lineto
36.0 -185.0 lineto
closepath
fill
newpath
84.0 -200.0 moveto
87.0 -202.0 lineto
84.0 -205.0 lineto
closepath
fill
newpath
33.0 -225.0 moveto
34.0 -230.0 lineto
36.0 -225.0 lineto
closepath
fill
newpath
84.0 -240.0 moveto
87.0 -242.0 lineto
84.0 -245.0 lineto
closepath
fill
newpath
165.0 -240.0 moveto
168.0 -242.0 lineto
165.0 -245.0 lineto
closepath
fill
newpath
33.0 -275.0 moveto
34.0 -280.0 lineto
36.0 -275.0 lineto
closepath
fill
newpath
165.0 -285.0 moveto
168.0 -287.0 lineto
165.0 -290.0 lineto
closepath
fill
newpath
84.0 -290.0 moveto
87.0 -292.0 lineto
84.0 -295.0 lineto
closepath
fill
newpath
114.0 -310.0 moveto
115.0 -315.0 lineto
117.0 -310.0 lineto
closepath
fill
newpath
33.0 -340.0 moveto
34.0 -345.0 lineto
36.0 -340.0 lineto
closepath
fill
newpath
84.0 -360.0 moveto
87.0 -362.0 lineto
84.0 -365.0 lineto
closepath
fill
newpath
165.0 -360.0 moveto
168.0 -362.0 lineto
165.0 -365.0 lineto
closepath
fill
newpath
33.0 -380.0 moveto
34.0 -385.0 lineto
36.0 -380.0 lineto
closepath
fill
newpath
84.0 -395.0 moveto
87.0 -397.0 lineto
84.0 -400.0 lineto
closepath
fill
newpath
33.0 -420.0 moveto
34.0 -425.0 lineto
36.0 -420.0 lineto
closepath
fill
newpath
34.0 -257.0 moveto
34.0 -267.0 lineto
stroke
newpath
115.0 -257.0 moveto
115.0 -267.0 lineto
34.0 -267.0 lineto
stroke
newpath
34.0 -277.0 moveto
34.0 -267.0 lineto
stroke
/Helvetica findfont
4 scalefont setfont
18.0 -19.0 moveto
(I'm not getting) show
24.0 -24.0 moveto
(my data!) show
96.0 -24.0 moveto
(Do you set a) show
96.0 -29.0 moveto
(subscription) show
96.0 -34.0 moveto
(for messages?) show
174.0 -24.0 moveto
(Use the) show
174.0 -29.0 moveto
(zmq_setsockopt) show
174.0 -34.0 moveto
(ZMQ_SUBSCRIBE) show
174.0 -39.0 moveto
(\(""\) option) show
147.0 -34.0 moveto
(No) show
120.0 -49.0 moveto
(Yes) show
22.0 -54.0 moveto
(Are you losing) show
23.0 -59.0 moveto
(messages in a) show
21.0 -64.0 moveto
(SUB socket?) show
66.0 -64.0 moveto
(Yes) show
96.0 -64.0 moveto
(Do you start) show
96.0 -69.0 moveto
(the SUB socket) show
96.0 -74.0 moveto
(after the PUB?) show
174.0 -64.0 moveto
(Start all SUB) show
174.0 -69.0 moveto
(sockets first,) show
174.0 -74.0 moveto
(then the PUB) show
174.0 -79.0 moveto
(sockets to) show
174.0 -84.0 moveto
(avoid loss) show
147.0 -74.0 moveto
(Yes) show
39.0 -79.0 moveto
(No) show
120.0 -89.0 moveto
(No) show
90.0 -104.0 moveto
(See explanation of) show
90.0 -109.0 moveto
(the "slow joiner") show
90.0 -114.0 moveto
(syndrome in text.) show
171.0 -119.0 moveto
(With REQ, send and) show
171.0 -124.0 moveto
(recv in a loop and) show
171.0 -129.0 moveto
(check the return) show
171.0 -134.0 moveto
(codes. With REP) show
171.0 -139.0 moveto
(it's recv + send.) show
19.0 -124.0 moveto
(Are you using) show
20.0 -129.0 moveto
(REQ and REP) show
27.0 -134.0 moveto
(sockets?) show
66.0 -134.0 moveto
(Yes) show
39.0 -149.0 moveto
(No) show
93.0 -159.0 moveto
(The 1st PULL socket) show
93.0 -164.0 moveto
(to connect can grab) show
93.0 -169.0 moveto
(1000's of messages) show
93.0 -174.0 moveto
(before the others) show
93.0 -179.0 moveto
(get there.) show
186.0 -159.0 moveto
(You may need to) show
186.0 -164.0 moveto
(do extra work to) show
186.0 -169.0 moveto
(synchronize your) show
186.0 -174.0 moveto
(sockets before) show
186.0 -179.0 moveto
(sending tasks.) show
19.0 -164.0 moveto
(Are you using) show
18.0 -169.0 moveto
(PUSH sockets?) show
66.0 -174.0 moveto
(Yes) show
39.0 -184.0 moveto
(No) show
18.0 -199.0 moveto
(Do you check) show
16.0 -204.0 moveto
(return codes on) show
19.0 -209.0 moveto
(all methods?) show
95.0 -199.0 moveto
(Check every 0MQ) show
99.0 -204.0 moveto
(method call. In) show
99.0 -209.0 moveto
(C, use asserts.) show
66.0 -209.0 moveto
(No) show
39.0 -224.0 moveto
(Yes) show
16.0 -239.0 moveto
(Are you using) show
12.0 -244.0 moveto
(threads in your) show
21.0 -249.0 moveto
(app already?) show
102.0 -239.0 moveto
(Do you pass) show
96.0 -244.0 moveto
(sockets between) show
104.0 -249.0 moveto
(threads?) show
174.0 -239.0 moveto
(Create a socket) show
174.0 -244.0 moveto
(in the thread) show
174.0 -249.0 moveto
(where you use it) show
66.0 -249.0 moveto
(Yes) show
147.0 -249.0 moveto
(Yes) show
39.0 -264.0 moveto
(No) show
120.0 -264.0 moveto
(No) show
99.0 -284.0 moveto
(Are you calling) show
100.0 -289.0 moveto
(zmq_ctx_new) show
96.0 -294.0 moveto
(more than once?) show
174.0 -284.0 moveto
(Call zmq_ctx_new) show
174.0 -289.0 moveto
(exactly once in) show
174.0 -294.0 moveto
(every process.) show
19.0 -289.0 moveto
(Are you using) show
22.0 -294.0 moveto
(the inproc) show
21.0 -299.0 moveto
(transport?) show
147.0 -294.0 moveto
(Yes) show
66.0 -299.0 moveto
(Yes) show
120.0 -309.0 moveto
(No) show
39.0 -314.0 moveto
(No) show
93.0 -324.0 moveto
(Check that you) show
93.0 -329.0 moveto
(bind before you) show
93.0 -334.0 moveto
(connect.) show
93.0 -354.0 moveto
(Check that the) show
93.0 -359.0 moveto
(reply address) show
93.0 -364.0 moveto
(is valid. 0MQ) show
93.0 -369.0 moveto
(drops messages) show
93.0 -374.0 moveto
(it can't route.) show
174.0 -354.0 moveto
(If you're using) show
174.0 -359.0 moveto
(identities make) show
174.0 -364.0 moveto
(sure to set them) show
174.0 -369.0 moveto
(before not after) show
174.0 -374.0 moveto
(you connect.) show
19.0 -359.0 moveto
(Are you using) show
15.0 -364.0 moveto
(ROUTER sockets?) show
66.0 -369.0 moveto
(Yes) show
39.0 -379.0 moveto
(No) show
17.0 -394.0 moveto
(Are you losing) show
19.0 -399.0 moveto
(one message) show
23.0 -404.0 moveto
(in two?) show
93.0 -394.0 moveto
(You probably have) show
93.0 -399.0 moveto
(a client running) show
93.0 -404.0 moveto
(in the background.) show
93.0 -409.0 moveto
(Kill it and start) show
93.0 -414.0 moveto
(again.) show
66.0 -404.0 moveto
(Yes) show
39.0 -419.0 moveto
(No) show
12.0 -434.0 moveto
(Make a minimal) show
12.0 -439.0 moveto
(test case, ask) show
12.0 -444.0 moveto
(on IRC channel.) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4047 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4047 a 274 x Fk(If)g(you')l(re)f(using)g
(\330MQ)i(in)f(a)h(conte)o(xt)e(where)g(f)o(ailures)h(are)g(e)o(xpensi)
n(v)o(e,)e(then)i(you)f(w)o(ant)h(to)h(plan)f(properly)-5
b(.)17 b(First,)396 4429 y(b)n(uild)j(prototypes)e(that)j(let)f(you)g
(learn)f(and)h(test)h(the)f(dif)n(ferent)f(aspects)h(of)g(your)f
(design.)g(Stress)j(them)d(until)h(the)o(y)396 4537 y(break,)f(so)i
(that)f(you)f(kno)n(w)g(e)o(xactly)h(ho)n(w)f(strong)h(your)f(designs)g
(are.)h(Second,)f(in)m(v)o(est)h(in)g(testing.)g(This)g(means)396
4645 y(b)n(uilding)f(test)i(frame)n(w)o(orks,)d(ensuring)h(you)g(ha)n
(v)o(e)h(access)h(to)f(realistic)h(setups)f(with)g(suf)n(\002cient)g
(computer)e(po)n(wer)m(,)396 4753 y(and)i(getting)f(time)i(or)f(help)f
(to)i(actually)e(test)i(seriously)-5 b(.)19 b(Ideally)-5
b(,)19 b(one)h(team)g(writes)g(the)h(code,)e(a)h(second)g(team)g(tries)
396 4861 y(to)h(break)e(it.)h(Lastly)-5 b(,)20 b(do)g(get)g(your)f(or)o
(ganization)e(to)j(contact)g(iMatix)g(\(http://www)-5
b(.imatix.com/contact\))15 b(to)21 b(discuss)396 4969
y(ho)n(w)f(we)g(can)g(help)g(to)h(mak)o(e)e(sure)h(things)g(w)o(ork)g
(properly)-5 b(,)17 b(and)j(can)g(be)g(\002x)o(ed)f(rapidly)g(if)i(the)
o(y)e(break.)p Black 3800 5569 a Ff(29)p Black eop end
%%Page: 30 43
TeXDict begin 30 42 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.30) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:440) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(In)g(short:)g(if)h(you)e(ha)n(v)o(e)g(not)h(pro)o(v)o
(en)e(an)i(architecture)f(w)o(orks)h(in)g(realistic)h(conditions,)d(it)
j(will)g(most)f(lik)o(ely)g(break)f(at)396 180 y(the)h(w)o(orst)h
(possible)f(moment.)-2 209 y
SDict begin H.S end
 -2 209 a -2 209 a
SDict begin 13 H.A end
 -2 209
a -2 209 a
SDict begin [/View [/XYZ H.V]/Dest (0:441) cvn /DEST pdfmark end
 -2 209 a 359 x Fn(1.16.)39 b(Upgrading)e(fr)m(om)i
(\330MQ/2.2)f(to)h(\330MQ/3.2)2851 568 y
SDict begin H.S end
 2851 568 a 2851
568 a
SDict begin 22.464 H.A end
 2851 568 a 2851 568 a
SDict begin [/View [/XYZ H.V]/Dest (6.20.1) cvn /DEST pdfmark end
 2851 568 a -2 766 a
SDict begin H.S end
 -2 766
a -2 766 a
SDict begin 13 H.A end
 -2 766 a -2 766 a
SDict begin [/View [/XYZ H.V]/Dest (0:443) cvn /DEST pdfmark end
 -2 766 a 396 842 a Fk(In)20
b(early)g(2012,)e(\330MQ/3.2)i(became)f(stable)h(enough)f(for)g(li)n(v)
o(e)h(use)h(and)e(by)h(the)g(time)h(you')l(re)d(reading)h(this,)h(it')
-5 b(s)21 b(what)396 950 y(you)f(really)f(should)h(be)g(using.)f(If)h
(you)f(are)i(still)g(using)f(2.2,)f(here')-5 b(s)20 b(a)g(quick)g
(summary)e(of)i(the)h(changes,)e(and)g(ho)n(w)h(to)396
1058 y(migrate)g(your)f(code.)-2 1242 y
SDict begin H.S end
 -2 1242 a -2
1242 a
SDict begin 13 H.A end
 -2 1242 a -2 1242 a
SDict begin [/View [/XYZ H.V]/Dest (0:444) cvn /DEST pdfmark end
 -2 1242 a 396 1332 a Fk(The)g(main)g(change)
f(in)i(3.x)e(is)j(that)e(PUB-SUB)i(w)o(orks)e(properly)-5
b(,)16 b(as)k(in,)f(the)h(publisher)e(only)g(sends)i(subscribers)e
(stuf)n(f)396 1440 y(the)o(y)i(actually)f(w)o(ant.)h(In)g(2.x,)g
(publishers)f(send)h(e)n(v)o(erything)d(and)j(the)g(subscribers)f
(\002lter)-5 b(.)21 b(Simple,)f(b)n(ut)g(not)g(ideal)g(for)396
1548 y(performance)e(on)h(a)i(TCP)g(netw)o(ork.)-2 1732
y
SDict begin H.S end
 -2 1732 a -2 1732 a
SDict begin 13 H.A end
 -2 1732 a -2 1732 a
SDict begin [/View [/XYZ H.V]/Dest (0:445) cvn /DEST pdfmark end
 -2 1732 a 396
1822 a Fk(Most)g(of)f(the)g(API)g(is)h(backw)o(ards)e(compatible,)g(e)o
(xcept)g(a)i(fe)n(w)f(blockheaded)d(changes)i(that)i(went)f(into)g(3.0)
f(with)i(no)396 1929 y(real)f(re)o(gard)f(to)h(the)g(cost)h(of)f
(breaking)e(e)o(xisting)h(code.)h(The)f(syntax)h(of)g(zmq_send[3])d
(and)j(zmq_recv[3])d(changed,)396 2037 y(and)j(ZMQ_NOBLOCK)g(got)g
(rebaptised)f(to)h(ZMQ_DONTW)-10 b(AIT)k(.)19 b(So)h(although)e(I')l(d)
i(lo)o(v)o(e)f(to)h(say)-5 b(,)20 b("you)f(just)396 2145
y(recompile)g(your)g(code)g(with)i(the)f(latest)h(libzmq)e(and)h(e)n(v)
o(erything)e(will)j(w)o(ork",)e(that')-5 b(s)20 b(not)g(ho)n(w)g(it)h
(is.)g(F)o(or)e(what)i(it')-5 b(s)396 2253 y(w)o(orth,)20
b(we)g(banned)f(such)h(API)g(breakage)f(afterw)o(ards.)-2
2437 y
SDict begin H.S end
 -2 2437 a -2 2437 a
SDict begin 13 H.A end
 -2 2437 a -2 2437 a
SDict begin [/View [/XYZ H.V]/Dest (0:446) cvn /DEST pdfmark end
 -2 2437
a 396 2527 a Fk(So)i(the)f(minimal)f(change)g(for)h(C/C++)h(apps)f
(that)g(use)h(the)f(lo)n(w-le)n(v)o(el)f(libzmq)g(API)i(is)g(to)f
(replace)g(all)g(calls)h(to)396 2635 y(zmq_send)e(with)h(zmq_msg_send,)
d(and)j(zmq_recv)e(with)i(zmq_msg_recv)-5 b(.)17 b(In)j(other)f
(languages,)f(your)h(binding)396 2743 y(author)g(may)h(ha)n(v)o(e)f
(done)h(the)g(w)o(ork)f(already)-5 b(.)19 b(Note)h(that)g(these)h(tw)o
(o)f(functions)f(no)n(w)g(return)g(-1)h(in)h(case)f(of)g(error)m(,)f
(and)396 2851 y(zero)h(or)g(more)f(according)f(to)j(ho)n(w)e(man)o(y)g
(bytes)h(were)g(sent)h(or)f(recei)n(v)o(ed.)-2 3035 y
SDict begin H.S end

-2 3035 a -2 3035 a
SDict begin 13 H.A end
 -2 3035 a -2 3035 a
SDict begin [/View [/XYZ H.V]/Dest (0:447) cvn /DEST pdfmark end
 -2 3035 a 396
3125 a Fk(Other)g(parts)g(of)g(the)g(libzmq)g(API)g(became)g(more)f
(consistent.)g(W)-7 b(e)22 b(deprecated)c(zmq_init[3])g(and)i
(zmq_term[3],)396 3233 y(replacing)f(them)h(with)g(zmq_ctx_ne)n(w[3])c
(and)k(zmq_ctx_destro)o(y[3].)15 b(W)-7 b(e)22 b(added)d
(zmq_ctx_set[3])e(to)j(let)h(you)396 3341 y(con\002gure)e(a)h(conte)o
(xt)f(before)g(starting)h(to)g(w)o(ork)g(with)g(it.)-2
3525 y
SDict begin H.S end
 -2 3525 a -2 3525 a
SDict begin 13 H.A end
 -2 3525 a -2 3525 a
SDict begin [/View [/XYZ H.V]/Dest (0:448) cvn /DEST pdfmark end
 -2 3525
a 396 3615 a Fk(Finally)-5 b(,)20 b(we)g(added)f(conte)o(xt)g
(monitoring)f(via)i(the)g(zmq_ctx_set_monitor[3])15 b(call,)20
b(which)g(lets)h(you)e(track)396 3723 y(connections)g(and)g
(disconnections,)f(and)i(other)f(e)n(v)o(ents)h(on)g(sock)o(ets.)-2
3745 y
SDict begin H.S end
 -2 3745 a -2 3745 a
SDict begin 13 H.A end
 -2 3745 a -2 3745 a
SDict begin [/View [/XYZ H.V]/Dest (0:449) cvn /DEST pdfmark end
 -2 3745
a 365 x Fn(1.17.)39 b(W)-6 b(arning)39 b(-)g(Unstab)o(le)f(P)l
(aradigms!)2477 4110 y
SDict begin H.S end
 2477 4110 a 2477 4110 a
SDict begin 22.464 H.A end
 2477 4110
a 2477 4110 a
SDict begin [/View [/XYZ H.V]/Dest (6.21.1) cvn /DEST pdfmark end
 2477 4110 a -2 4308 a
SDict begin H.S end
 -2 4308 a -2 4308
a
SDict begin 13 H.A end
 -2 4308 a -2 4308 a
SDict begin [/View [/XYZ H.V]/Dest (0:451) cvn /DEST pdfmark end
 -2 4308 a 396 4384 a Fk(T)m(raditional)19
b(netw)o(ork)g(programming)e(is)k(b)n(uilt)f(on)g(the)g(general)f
(assumption)g(that)i(one)e(sock)o(et)h(talks)h(to)f(one)396
4492 y(connection,)e(one)i(peer)-5 b(.)20 b(There)f(are)h(multicast)g
(protocols)f(b)n(ut)h(these)h(are)f(e)o(xotic.)f(When)h(we)g(assume)h
("one)e(sock)o(et)h(=)396 4600 y(one)f(connection",)f(we)i(scale)g(our)
f(architectures)g(in)h(certain)f(w)o(ays.)h(W)-7 b(e)21
b(create)e(threads)g(of)h(logic)f(where)g(each)h(thread)396
4708 y(w)o(ork)g(with)g(one)g(sock)o(et,)g(one)f(peer)-5
b(.)20 b(W)-7 b(e)21 b(place)f(intelligence)f(and)h(state)h(in)f(these)
h(threads.)-2 4892 y
SDict begin H.S end
 -2 4892 a -2 4892 a
SDict begin 13 H.A end
 -2 4892 a -2
4892 a
SDict begin [/View [/XYZ H.V]/Dest (0:452) cvn /DEST pdfmark end
 -2 4892 a 396 4982 a Fk(In)f(the)g(\330MQ)h(uni)n(v)o(erse,)d
(sock)o(ets)j(are)f(doorw)o(ays)e(to)j(f)o(ast)g(little)g(background)16
b(communications)i(engines)h(that)396 5090 y(manage)g(a)i(whole)e(set)i
(of)f(connections)f(automagically)f(for)h(you.)g(Y)-9
b(ou)20 b(can')o(t)f(see,)i(w)o(ork)e(with,)h(open,)f(close,)i(or)p
Black 3800 5569 a Ff(30)p Black eop end
%%Page: 31 44
TeXDict begin 31 43 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.31) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3139 -132 a Ff(Chapter)20 b(1.)g(Basic)g(Stuf)o(f)p
Black 396 72 a Fk(attach)g(state)h(to)g(these)f(connections.)e(Whether)
i(you)f(use)h(blocking)f(send)h(or)g(recei)n(v)o(e,)e(or)i(poll,)g(all)
h(you)e(can)h(talk)g(to)h(is)396 180 y(the)f(sock)o(et,)g(not)g(the)g
(connections)f(it)i(manages)e(for)g(you.)g(The)h(connections)f(are)h
(pri)n(v)n(ate)f(and)h(in)m(visible,)f(and)g(this)i(is)396
288 y(the)f(k)o(e)o(y)g(to)g(\330MQ')-5 b(s)21 b(scalability)-5
b(.)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:453) cvn /DEST pdfmark end
 -2 472
a 396 562 a Fk(Because)21 b(your)e(code,)g(talking)g(to)i(a)f(sock)o
(et,)g(can)g(then)g(handle)f(an)o(y)g(number)g(of)g(connections)g
(across)h(whate)n(v)o(er)396 670 y(netw)o(ork)f(protocols)g(are)h
(around,)e(without)i(change.)e(A)j(messaging)e(pattern)h(sitting)g(in)g
(\330MQ)h(can)f(scale)g(more)396 778 y(cheaply)f(than)h(a)h(messaging)e
(pattern)g(sitting)i(in)f(your)f(application)f(code.)-2
962 y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:454) cvn /DEST pdfmark end
 -2 962 a 396
1052 a Fk(So)j(the)f(general)f(assumption)g(no)h(longer)f(applies.)g
(As)i(you)f(read)f(the)h(code)g(e)o(xamples,)f(your)g(brain)g(will)i
(try)f(to)g(map)396 1160 y(them)g(to)g(what)h(you)e(kno)n(w)-5
b(.)18 b(Y)-9 b(ou)20 b(will)h(read)f("sock)o(et")f(and)h(think)f("ah,)
h(that)g(represents)g(a)g(connection)e(to)j(another)396
1268 y(node".)e(That)h(is)h(wrong.)e(Y)-9 b(ou)19 b(will)i(read)f
("thread")f(and)h(your)e(brain)i(will)h(again)e(think,)g("ah,)h(a)g
(thread)g(represents)f(a)396 1376 y(connection)f(to)j(another)d(node",)
h(and)h(again)f(your)g(brain)g(will)i(be)f(wrong.)-2
1560 y
SDict begin H.S end
 -2 1560 a -2 1560 a
SDict begin 13 H.A end
 -2 1560 a -2 1560 a
SDict begin [/View [/XYZ H.V]/Dest (0:455) cvn /DEST pdfmark end
 -2 1560
a 396 1650 a Fk(If)g(you')l(re)f(reading)f(this)j(Guide)f(for)f(the)h
(\002rst)h(time,)g(realize)f(that)g(until)g(you)f(actually)h(write)g
(\330MQ)h(code)e(for)h(a)g(day)g(or)396 1758 y(tw)o(o)h(\(and)e(maybe)g
(three)h(or)g(four)f(days\),)g(you)g(may)h(feel)g(confused,)f
(especially)g(by)h(ho)n(w)g(simple)g(\330MQ)g(mak)o(es)396
1866 y(things)f(for)g(you,)f(and)h(you)g(may)g(try)g(to)g(impose)g
(that)h(general)e(assumption)g(on)h(\330MQ,)g(and)g(it)h(w)o(on')o(t)f
(w)o(ork.)f(And)h(then)396 1974 y(you)h(will)g(e)o(xperience)e(your)h
(moment)g(of)h(enlightenment)e(and)h(trust,)h(that)2597
1974 y
SDict begin H.S end
 2597 1974 a 2597 1974 a
SDict begin 13 H.A end
 2597 1974 a 2597 1974
a
SDict begin [/View [/XYZ H.V]/Dest (0:456) cvn /DEST pdfmark end
 2597 1974 a Ff(zap-pow-kaboom)c Fk(satori)k(paradigm-shift)396
2082 y(moment)f(when)h(it)h(all)f(becomes)g(clear)-5
b(.)p Black 3800 5569 a Ff(31)p Black eop end
%%Page: 32 45
TeXDict begin 32 44 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.32) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:457) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(2.)f(Intermediate)h(Stuff)2350
115 y
SDict begin H.S end
 2350 115 a 2350 115 a
SDict begin 26.957 H.A end
 2350 115 a 2350 115 a
SDict begin [/View [/XYZ H.V]/Dest (7.0) cvn /DEST pdfmark end
 2350
115 a -2 371 a
SDict begin H.S end
 -2 371 a -2 371 a
SDict begin 13 H.A end
 -2 371 a -2 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:459) cvn /DEST pdfmark end
 -2
371 a 396 443 a Fk(In)20 b(Chapter)g(One)g(we)g(took)g(\330MQ)g(for)g
(a)g(dri)n(v)o(e,)f(with)i(some)f(basic)g(e)o(xamples)f(of)h(the)g
(main)g(\330MQ)g(patterns:)396 551 y(request-reply)-5
b(,)17 b(publish-subscribe,)h(and)h(pipeline.)g(In)h(this)h(chapter)e
(we')l(re)h(going)e(to)j(get)f(our)f(hands)h(dirty)f(and)h(start)396
659 y(to)h(learn)e(ho)n(w)h(to)g(use)h(these)f(tools)g(in)h(real)f
(programs.)-2 843 y
SDict begin H.S end
 -2 843 a -2 843 a
SDict begin 13 H.A end
 -2 843 a -2 843
a
SDict begin [/View [/XYZ H.V]/Dest (0:460) cvn /DEST pdfmark end
 -2 843 a 396 933 a Fk(W)-7 b(e')o(ll)22 b(co)o(v)o(er:)-2
934 y
SDict begin H.S end
 -2 934 a -2 934 a
SDict begin 13 H.A end
 -2 934 a -2 934 a
SDict begin [/View [/XYZ H.V]/Dest (0:461) cvn /DEST pdfmark end
 -2 934 a -2
944 a
SDict begin H.S end
 -2 944 a -2 944 a
SDict begin 13 H.A end
 -2 944 a -2 944 a
SDict begin [/View [/XYZ H.V]/Dest (0:462) cvn /DEST pdfmark end
 -2 944 a Black
396 1103 a Fj(\225)p Black 479 1103 a
SDict begin H.S end
 479 1103 a 479
1103 a
SDict begin 13 H.A end
 479 1103 a 479 1103 a
SDict begin [/View [/XYZ H.V]/Dest (0:463) cvn /DEST pdfmark end
 479 1103 a Fk(Ho)n(w)e(to)h(create)f(and)f
(w)o(ork)h(with)g(\330MQ)h(sock)o(ets.)-2 1118 y
SDict begin H.S end
 -2 1118
a -2 1118 a
SDict begin 13 H.A end
 -2 1118 a -2 1118 a
SDict begin [/View [/XYZ H.V]/Dest (0:464) cvn /DEST pdfmark end
 -2 1118 a Black 396 1252
a Fj(\225)p Black 479 1252 a
SDict begin H.S end
 479 1252 a 479 1252 a
SDict begin 13 H.A end
 479
1252 a 479 1252 a
SDict begin [/View [/XYZ H.V]/Dest (0:465) cvn /DEST pdfmark end
 479 1252 a Fk(Ho)n(w)f(to)h(send)f(and)f(recei)n(v)o
(e)g(messages)i(on)e(sock)o(ets.)-2 1270 y
SDict begin H.S end
 -2 1270 a
-2 1270 a
SDict begin 13 H.A end
 -2 1270 a -2 1270 a
SDict begin [/View [/XYZ H.V]/Dest (0:466) cvn /DEST pdfmark end
 -2 1270 a Black 396 1402
a Fj(\225)p Black 479 1402 a
SDict begin H.S end
 479 1402 a 479 1402 a
SDict begin 13 H.A end
 479
1402 a 479 1402 a
SDict begin [/View [/XYZ H.V]/Dest (0:467) cvn /DEST pdfmark end
 479 1402 a Fk(Ho)n(w)h(to)h(b)n(uild)e(your)g(apps)h
(around)f(\330MQ')-5 b(s)20 b(asynchronous)e(I/O)i(model.)-2
1420 y
SDict begin H.S end
 -2 1420 a -2 1420 a
SDict begin 13 H.A end
 -2 1420 a -2 1420 a
SDict begin [/View [/XYZ H.V]/Dest (0:468) cvn /DEST pdfmark end
 -2 1420
a Black 396 1551 a Fj(\225)p Black 479 1551 a
SDict begin H.S end
 479 1551
a 479 1551 a
SDict begin 13 H.A end
 479 1551 a 479 1551 a
SDict begin [/View [/XYZ H.V]/Dest (0:469) cvn /DEST pdfmark end
 479 1551 a Fk(Ho)n(w)g(to)h(handle)e
(multiple)g(sock)o(ets)i(in)f(one)g(thread.)-2 1569 y
SDict begin H.S end

-2 1569 a -2 1569 a
SDict begin 13 H.A end
 -2 1569 a -2 1569 a
SDict begin [/View [/XYZ H.V]/Dest (0:470) cvn /DEST pdfmark end
 -2 1569 a Black
396 1701 a Fj(\225)p Black 479 1701 a
SDict begin H.S end
 479 1701 a 479
1701 a
SDict begin 13 H.A end
 479 1701 a 479 1701 a
SDict begin [/View [/XYZ H.V]/Dest (0:471) cvn /DEST pdfmark end
 479 1701 a Fk(Ho)n(w)g(to)h(handle)e(f)o
(atal)h(and)g(non-f)o(atal)f(errors)g(properly)-5 b(.)-2
1719 y
SDict begin H.S end
 -2 1719 a -2 1719 a
SDict begin 13 H.A end
 -2 1719 a -2 1719 a
SDict begin [/View [/XYZ H.V]/Dest (0:472) cvn /DEST pdfmark end
 -2 1719
a Black 396 1850 a Fj(\225)p Black 479 1850 a
SDict begin H.S end
 479 1850
a 479 1850 a
SDict begin 13 H.A end
 479 1850 a 479 1850 a
SDict begin [/View [/XYZ H.V]/Dest (0:473) cvn /DEST pdfmark end
 479 1850 a Fk(Ho)n(w)20
b(to)h(handle)e(interrupt)f(signals)j(lik)o(e)f(Ctrl-C.)-2
1868 y
SDict begin H.S end
 -2 1868 a -2 1868 a
SDict begin 13 H.A end
 -2 1868 a -2 1868 a
SDict begin [/View [/XYZ H.V]/Dest (0:474) cvn /DEST pdfmark end
 -2 1868
a Black 396 1999 a Fj(\225)p Black 479 1999 a
SDict begin H.S end
 479 1999
a 479 1999 a
SDict begin 13 H.A end
 479 1999 a 479 1999 a
SDict begin [/View [/XYZ H.V]/Dest (0:475) cvn /DEST pdfmark end
 479 1999 a Fk(Ho)n(w)g(to)h(shutdo)n
(wn)d(a)j(\330MQ)f(application)f(cleanly)-5 b(.)-2 2017
y
SDict begin H.S end
 -2 2017 a -2 2017 a
SDict begin 13 H.A end
 -2 2017 a -2 2017 a
SDict begin [/View [/XYZ H.V]/Dest (0:476) cvn /DEST pdfmark end
 -2 2017 a Black
396 2149 a Fj(\225)p Black 479 2149 a
SDict begin H.S end
 479 2149 a 479
2149 a
SDict begin 13 H.A end
 479 2149 a 479 2149 a
SDict begin [/View [/XYZ H.V]/Dest (0:477) cvn /DEST pdfmark end
 479 2149 a Fk(Ho)n(w)20
b(to)h(check)e(a)i(\330MQ)f(application)f(for)g(memory)g(leaks.)-2
2167 y
SDict begin H.S end
 -2 2167 a -2 2167 a
SDict begin 13 H.A end
 -2 2167 a -2 2167 a
SDict begin [/View [/XYZ H.V]/Dest (0:478) cvn /DEST pdfmark end
 -2 2167
a Black 396 2298 a Fj(\225)p Black 479 2298 a
SDict begin H.S end
 479 2298
a 479 2298 a
SDict begin 13 H.A end
 479 2298 a 479 2298 a
SDict begin [/View [/XYZ H.V]/Dest (0:479) cvn /DEST pdfmark end
 479 2298 a Fk(Ho)n(w)h(to)h(send)f
(and)f(recei)n(v)o(e)g(multi-part)g(messages.)-2 2316
y
SDict begin H.S end
 -2 2316 a -2 2316 a
SDict begin 13 H.A end
 -2 2316 a -2 2316 a
SDict begin [/View [/XYZ H.V]/Dest (0:480) cvn /DEST pdfmark end
 -2 2316 a Black
396 2448 a Fj(\225)p Black 479 2448 a
SDict begin H.S end
 479 2448 a 479
2448 a
SDict begin 13 H.A end
 479 2448 a 479 2448 a
SDict begin [/View [/XYZ H.V]/Dest (0:481) cvn /DEST pdfmark end
 479 2448 a Fk(Ho)n(w)h(to)h(forw)o(ard)d
(messages)j(across)f(netw)o(orks.)-2 2466 y
SDict begin H.S end
 -2 2466 a
-2 2466 a
SDict begin 13 H.A end
 -2 2466 a -2 2466 a
SDict begin [/View [/XYZ H.V]/Dest (0:482) cvn /DEST pdfmark end
 -2 2466 a Black 396 2597
a Fj(\225)p Black 479 2597 a
SDict begin H.S end
 479 2597 a 479 2597 a
SDict begin 13 H.A end
 479
2597 a 479 2597 a
SDict begin [/View [/XYZ H.V]/Dest (0:483) cvn /DEST pdfmark end
 479 2597 a Fk(Ho)n(w)g(to)h(b)n(uild)e(a)i(simple)f
(message)g(queuing)f(brok)o(er)-5 b(.)-2 2615 y
SDict begin H.S end
 -2 2615
a -2 2615 a
SDict begin 13 H.A end
 -2 2615 a -2 2615 a
SDict begin [/View [/XYZ H.V]/Dest (0:484) cvn /DEST pdfmark end
 -2 2615 a Black 396 2747
a Fj(\225)p Black 479 2747 a
SDict begin H.S end
 479 2747 a 479 2747 a
SDict begin 13 H.A end
 479
2747 a 479 2747 a
SDict begin [/View [/XYZ H.V]/Dest (0:485) cvn /DEST pdfmark end
 479 2747 a Fk(Ho)n(w)20 b(to)h(write)f(multithreaded)
e(applications)h(with)h(\330MQ.)-2 2765 y
SDict begin H.S end
 -2 2765 a -2
2765 a
SDict begin 13 H.A end
 -2 2765 a -2 2765 a
SDict begin [/View [/XYZ H.V]/Dest (0:486) cvn /DEST pdfmark end
 -2 2765 a Black 396 2896 a
Fj(\225)p Black 479 2896 a
SDict begin H.S end
 479 2896 a 479 2896 a
SDict begin 13 H.A end
 479
2896 a 479 2896 a
SDict begin [/View [/XYZ H.V]/Dest (0:487) cvn /DEST pdfmark end
 479 2896 a Fk(Ho)n(w)g(to)h(use)f(\330MQ)h(to)f
(signal)g(between)f(threads.)-2 2914 y
SDict begin H.S end
 -2 2914 a -2 2914
a
SDict begin 13 H.A end
 -2 2914 a -2 2914 a
SDict begin [/View [/XYZ H.V]/Dest (0:488) cvn /DEST pdfmark end
 -2 2914 a Black 396 3046 a Fj(\225)p
Black 479 3046 a
SDict begin H.S end
 479 3046 a 479 3046 a
SDict begin 13 H.A end
 479 3046 a 479
3046 a
SDict begin [/View [/XYZ H.V]/Dest (0:489) cvn /DEST pdfmark end
 479 3046 a Fk(Ho)n(w)h(to)h(use)f(\330MQ)h(to)f(coordinate)e(a)j
(netw)o(ork)e(of)h(nodes.)-2 3061 y
SDict begin H.S end
 -2 3061 a -2 3061
a
SDict begin 13 H.A end
 -2 3061 a -2 3061 a
SDict begin [/View [/XYZ H.V]/Dest (0:490) cvn /DEST pdfmark end
 -2 3061 a Black 396 3195 a Fj(\225)p
Black 479 3195 a
SDict begin H.S end
 479 3195 a 479 3195 a
SDict begin 13 H.A end
 479 3195 a 479
3195 a
SDict begin [/View [/XYZ H.V]/Dest (0:491) cvn /DEST pdfmark end
 479 3195 a Fk(Ho)n(w)g(to)h(create)f(and)f(use)i(message)f(en)m
(v)o(elopes)e(for)h(publish-subscribe.)-2 3213 y
SDict begin H.S end
 -2 3213
a -2 3213 a
SDict begin 13 H.A end
 -2 3213 a -2 3213 a
SDict begin [/View [/XYZ H.V]/Dest (0:492) cvn /DEST pdfmark end
 -2 3213 a Black 396 3344
a Fj(\225)p Black 479 3344 a
SDict begin H.S end
 479 3344 a 479 3344 a
SDict begin 13 H.A end
 479
3344 a 479 3344 a
SDict begin [/View [/XYZ H.V]/Dest (0:493) cvn /DEST pdfmark end
 479 3344 a Fk(Using)h(the)h(high-w)o(ater)d(mark)i
(\(HWM\))g(to)g(protect)f(against)h(memory)e(o)o(v)o(er\003o)n(ws.)-2
3362 y
SDict begin H.S end
 -2 3362 a -2 3362 a
SDict begin 13 H.A end
 -2 3362 a -2 3362 a
SDict begin [/View [/XYZ H.V]/Dest (0:494) cvn /DEST pdfmark end
 -2 3362
a 360 x Fn(2.1.)39 b(The)g(Zen)g(of)g(Zer)m(o)1351 3722
y
SDict begin H.S end
 1351 3722 a 1351 3722 a
SDict begin 22.464 H.A end
 1351 3722 a 1351 3722 a
SDict begin [/View [/XYZ H.V]/Dest (7.22.1) cvn /DEST pdfmark end
 1351
3722 a -2 3889 a
SDict begin H.S end
 -2 3889 a -2 3889 a
SDict begin 13 H.A end
 -2 3889 a -2 3889
a
SDict begin [/View [/XYZ H.V]/Dest (0:496) cvn /DEST pdfmark end
 -2 3889 a 396 3996 a Fk(The)20 b(\330)h(in)f(\330MQ)h(is)g(all)g
(about)e(tradeof)n(fs.)f(On)i(the)h(one)e(hand)g(this)i(strange)f(name)
f(lo)n(wers)h(\330MQ')-5 b(s)21 b(visibility)f(on)396
4103 y(Google)f(and)h(T)-7 b(witter)i(.)21 b(On)f(the)g(other)g(hand)f
(it)i(anno)o(ys)e(the)h(heck)f(out)h(of)g(some)g(Danish)g(folk)g(who)f
(write)i(us)f(things)396 4211 y(lik)o(e)h("\330MG)f(r\370t\003",)g(and)
f("\330)i(is)g(not)f(a)h(funn)o(y)d(looking)g(zero!")h(and)h(")2406
4211 y
SDict begin H.S end
 2406 4211 a 2406 4211 a
SDict begin 13 H.A end
 2406 4211 a 2406 4211
a
SDict begin [/View [/XYZ H.V]/Dest (0:497) cvn /DEST pdfmark end
 2406 4211 a Ff(R\370dgr)l(\370d)f(med)h(Fl\370de!)p
Fk(",)e(which)i(is)h(apparently)396 4319 y(an)f(insult)g(that)f(means)h
("may)f(your)f(neighbours)f(be)j(the)f(direct)g(descendants)g(of)g
(Grendel!")f(Seems)i(lik)o(e)g(a)g(f)o(air)f(trade.)-2
4503 y
SDict begin H.S end
 -2 4503 a -2 4503 a
SDict begin 13 H.A end
 -2 4503 a -2 4503 a
SDict begin [/View [/XYZ H.V]/Dest (0:498) cvn /DEST pdfmark end
 -2 4503
a 396 4593 a Fk(Originally)g(the)i(zero)e(in)i(\330MQ)f(w)o(as)h(meant)
f(as)h("zero)e(brok)o(er")g(and)g(\(as)i(close)f(to\))g("zero)g(latenc)
o(y")f(\(as)h(possible\).)g(In)396 4701 y(the)g(meantime)g(it)h(has)f
(come)g(to)g(co)o(v)o(er)f(dif)n(ferent)f(goals:)i(zero)g
(administration,)e(zero)i(cost,)g(zero)g(w)o(aste.)g(More)396
4809 y(generally)-5 b(,)18 b("zero")i(refers)f(to)i(the)f(culture)f(of)
h(minimalism)g(that)g(permeates)f(the)h(project.)g(W)-7
b(e)21 b(add)f(po)n(wer)f(by)396 4917 y(remo)o(ving)f(comple)o(xity)g
(rather)h(than)h(e)o(xposing)e(ne)n(w)i(functionality)-5
b(.)-2 4945 y
SDict begin H.S end
 -2 4945 a -2 4945 a
SDict begin 13 H.A end
 -2 4945 a -2 4945 a
SDict begin [/View [/XYZ H.V]/Dest (0:499) cvn /DEST pdfmark end

-2 4945 a Black 3800 5569 a Ff(32)p Black eop end
%%Page: 33 46
TeXDict begin 33 45 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.33) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 94 a Fn(2.2.)39 b(The)g(Soc)m(ket)f(API)1319
94 y
SDict begin H.S end
 1319 94 a 1319 94 a
SDict begin 22.464 H.A end
 1319 94 a 1319 94 a
SDict begin [/View [/XYZ H.V]/Dest (7.23.1) cvn /DEST pdfmark end
 1319 94
a -2 262 a
SDict begin H.S end
 -2 262 a -2 262 a
SDict begin 13 H.A end
 -2 262 a -2 262 a
SDict begin [/View [/XYZ H.V]/Dest (0:501) cvn /DEST pdfmark end
 -2 262
a 396 368 a Fk(T)-7 b(o)21 b(be)f(perfectly)f(honest,)g(\330MQ)h(does)g
(a)h(kind)e(of)h(switch-and-bait)e(on)i(you.)f(Which)h(we)h(don')o(t)d
(apologize)h(for)m(,)g(it')-5 b(s)396 476 y(for)20 b(your)f(o)n(wn)g
(good)g(and)h(hurts)g(us)g(more)g(than)f(it)i(hurts)f(you.)f(It)i
(presents)e(a)i(f)o(amiliar)f(sock)o(et-based)e(API)j(b)n(ut)f(that)396
584 y(hides)g(a)h(b)n(unch)e(of)h(message-processing)e(engines)h(that)h
(will)h(slo)n(wly)f(\002x)h(your)e(w)o(orld-vie)n(w)f(about)h(ho)n(w)h
(to)g(design)396 692 y(and)g(write)g(distrib)n(uted)g(softw)o(are.)-2
859 y
SDict begin H.S end
 -2 859 a -2 859 a
SDict begin 13 H.A end
 -2 859 a -2 859 a
SDict begin [/View [/XYZ H.V]/Dest (0:502) cvn /DEST pdfmark end
 -2 859 a 396
966 a Fk(Sock)o(ets)g(are)h(the)f(de-f)o(acto)f(standard)g(API)h(for)g
(netw)o(ork)f(programming,)d(as)21 b(well)g(as)g(being)e(useful)h(for)f
(stopping)396 1074 y(your)g(e)o(yes)h(from)f(f)o(alling)h(onto)f(your)g
(cheeks.)h(One)g(thing)f(that)i(mak)o(es)f(\330MQ)g(especially)g(tasty)
g(to)h(de)n(v)o(elopers)d(is)396 1182 y(that)i(it)h(uses)f(sock)o(ets)g
(and)f(messages)h(instead)g(of)f(some)h(other)f(arbitrary)f(set)j(of)e
(concepts.)g(K)o(udos)g(to)h(Martin)f(Sustrik)396 1290
y(for)g(pulling)f(this)i(of)n(f.)f(It)h(turns)f("Message)g(Oriented)g
(Middle)n(w)o(are",)f(a)i(phrase)e(guaranteed)g(to)h(send)g(the)h
(whole)f(room)396 1398 y(of)n(f)h(to)g(Catatonia,)g(into)g("Extra)f
(Spic)o(y)h(Sock)o(ets!")g(which)f(lea)n(v)o(es)i(us)f(with)g(a)h
(strange)f(cra)n(ving)f(for)g(pizza,)h(and)g(a)396 1505
y(desire)g(to)h(kno)n(w)e(more.)-2 1672 y
SDict begin H.S end
 -2 1672 a -2
1672 a
SDict begin 13 H.A end
 -2 1672 a -2 1672 a
SDict begin [/View [/XYZ H.V]/Dest (0:503) cvn /DEST pdfmark end
 -2 1672 a 396 1779 a Fk(Lik)o(e)h(a)h(nice)f
(pepperoni)e(pizza,)h(\330MQ)i(sock)o(ets)f(are)g(easy)h(to)f(digest.)g
(Sock)o(ets)g(ha)n(v)o(e)g(a)g(life)h(in)f(four)f(parts,)h(just)h(lik)o
(e)396 1887 y(BSD)g(sock)o(ets:)-2 1888 y
SDict begin H.S end
 -2 1888 a -2
1888 a
SDict begin 13 H.A end
 -2 1888 a -2 1888 a
SDict begin [/View [/XYZ H.V]/Dest (0:504) cvn /DEST pdfmark end
 -2 1888 a -2 1898 a
SDict begin H.S end
 -2 1898
a -2 1898 a
SDict begin 13 H.A end
 -2 1898 a -2 1898 a
SDict begin [/View [/XYZ H.V]/Dest (0:505) cvn /DEST pdfmark end
 -2 1898 a Black 396 2058
a Fj(\225)p Black 479 2058 a
SDict begin H.S end
 479 2058 a 479 2058 a
SDict begin 13 H.A end
 479
2058 a 479 2058 a
SDict begin [/View [/XYZ H.V]/Dest (0:506) cvn /DEST pdfmark end
 479 2058 a Fk(Creating)f(and)g(destro)o(ying)e(sock)o
(ets,)i(which)g(go)g(together)e(to)j(form)e(a)i(karmic)e(circle)h(of)g
(sock)o(et)g(life)g(\(see)479 2166 y(zmq_sock)o(et[3],)d
(zmq_close[3]\).)-2 2183 y
SDict begin H.S end
 -2 2183 a -2 2183 a
SDict begin 13 H.A end
 -2 2183
a -2 2183 a
SDict begin [/View [/XYZ H.V]/Dest (0:507) cvn /DEST pdfmark end
 -2 2183 a Black 396 2315 a Fj(\225)p Black
479 2315 a
SDict begin H.S end
 479 2315 a 479 2315 a
SDict begin 13 H.A end
 479 2315 a 479 2315
a
SDict begin [/View [/XYZ H.V]/Dest (0:508) cvn /DEST pdfmark end
 479 2315 a Fk(Con\002guring)h(sock)o(ets)j(by)e(setting)i(options)e
(on)h(them)f(and)h(checking)f(them)g(if)i(necessary)e(\(see)479
2423 y(zmq_setsock)o(opt[3],)e(zmq_getsock)o(opt[3]\).)-2
2441 y
SDict begin H.S end
 -2 2441 a -2 2441 a
SDict begin 13 H.A end
 -2 2441 a -2 2441 a
SDict begin [/View [/XYZ H.V]/Dest (0:509) cvn /DEST pdfmark end
 -2 2441
a Black 396 2572 a Fj(\225)p Black 479 2572 a
SDict begin H.S end
 479 2572
a 479 2572 a
SDict begin 13 H.A end
 479 2572 a 479 2572 a
SDict begin [/View [/XYZ H.V]/Dest (0:510) cvn /DEST pdfmark end
 479 2572 a Fk(Plugging)i(sock)o(ets)
h(onto)g(the)g(netw)o(ork)f(topology)f(by)i(creating)f(\330MQ)h
(connections)f(to)h(and)g(from)f(them)g(\(see)479 2680
y(zmq_bind[3],)e(zmq_connect[3]\).)-2 2698 y
SDict begin H.S end
 -2 2698
a -2 2698 a
SDict begin 13 H.A end
 -2 2698 a -2 2698 a
SDict begin [/View [/XYZ H.V]/Dest (0:511) cvn /DEST pdfmark end
 -2 2698 a Black 396 2830
a Fj(\225)p Black 479 2830 a
SDict begin H.S end
 479 2830 a 479 2830 a
SDict begin 13 H.A end
 479
2830 a 479 2830 a
SDict begin [/View [/XYZ H.V]/Dest (0:512) cvn /DEST pdfmark end
 479 2830 a Fk(Using)j(the)h(sock)o(ets)f(to)g(carry)g
(data)g(by)f(writing)h(and)g(recei)n(ving)e(messages)j(on)e(them)h
(\(see)h(zmq_msg_send[3],)479 2938 y(zmq_msg_recv[3]\).)-2
3122 y
SDict begin H.S end
 -2 3122 a -2 3122 a
SDict begin 13 H.A end
 -2 3122 a -2 3122 a
SDict begin [/View [/XYZ H.V]/Dest (0:513) cvn /DEST pdfmark end
 -2 3122
a 396 3212 a Fk(Which)f(looks)g(lik)o(e)g(this,)h(in)f(C:)-2
3307 y
SDict begin H.S end
 -2 3307 a -2 3307 a
SDict begin 11.7 H.A end
 -2 3307 a -2 3307 a
SDict begin [/View [/XYZ H.V]/Dest (0:514) cvn /DEST pdfmark end
 -2 3307
a 396 3392 a Fe(void)620 3405 y(*)665 3392 y(mousetrap;)396
3586 y(//)90 b(Create)43 b(socket)h(for)h(catching)e(mice)396
3683 y(mousetrap)h(=)g(zmq_socket)f(\(context,)h(ZMQ_PULL\);)396
3877 y(//)90 b(Configure)43 b(the)h(socket)396 3975 y(int64_t)g
(jawsize)g(=)g(10000;)396 4072 y(zmq_setsockopt)f(\(mousetrap,)g
(ZMQ_HWM,)g(&jawsize,)h(sizeof)f(jawsize\);)396 4266
y(//)90 b(Plug)44 b(socket)g(into)g(mouse)g(hole)396
4363 y(zmq_connect)f(\(mousetrap,)g("tcp://192.168.55.221:5001"\);)396
4557 y(//)90 b(Wait)44 b(for)g(juicy)g(mouse)g(to)h(arrive)396
4655 y(zmq_msg_t)f(mouse;)396 4752 y(zmq_msg_init)f(\(&mouse\);)396
4849 y(zmq_msg_recv)g(\(&mouse,)h(mousetrap,)f(0\);)396
4946 y(//)90 b(Destroy)43 b(the)i(mouse)396 5043 y(zmq_msg_close)e
(\(&mouse\);)p Black 3800 5569 a Ff(33)p Black eop end
%%Page: 34 47
TeXDict begin 34 46 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.34) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe(//)90 b(Destroy)43 b(the)i(socket)396
170 y(zmq_close)f(\(mousetrap\);)-2 347 y
SDict begin H.S end
 -2 347 a -2
347 a
SDict begin 13 H.A end
 -2 347 a -2 347 a
SDict begin [/View [/XYZ H.V]/Dest (0:515) cvn /DEST pdfmark end
 -2 347 a 396 444 a Fk(Note)20
b(that)h(sock)o(ets)f(are)g(al)o(w)o(ays)h(v)n(oid)f(pointers,)f(and)g
(messages)h(\(which)g(we')o(ll)g(come)g(to)g(v)o(ery)f(soon\))h(are)g
(structures.)396 552 y(So)h(in)f(C)h(you)e(pass)i(sock)o(ets)g
(as-such,)e(b)n(ut)h(you)f(pass)i(addresses)f(of)g(messages)g(in)h(all)
f(functions)f(that)h(w)o(ork)g(with)396 659 y(messages,)g(lik)o(e)h
(zmq_msg_send[3])16 b(and)k(zmq_msg_recv[3].)15 b(As)21
b(a)g(mnemonic,)d(realize)i(that)g("in)g(\330MQ)h(all)f(your)396
767 y(sock)o(ets)h(are)f(belong)e(to)j(us",)f(b)n(ut)g(messages)h(are)f
(things)f(you)h(actually)f(o)n(wn)h(in)g(your)f(code.)-2
951 y
SDict begin H.S end
 -2 951 a -2 951 a
SDict begin 13 H.A end
 -2 951 a -2 951 a
SDict begin [/View [/XYZ H.V]/Dest (0:516) cvn /DEST pdfmark end
 -2 951 a 396
1041 a Fk(Creating,)h(destro)o(ying,)e(and)i(con\002guring)d(sock)o
(ets)j(w)o(orks)g(as)h(you')l(d)d(e)o(xpect)i(for)f(an)o(y)h(object.)f
(But)i(remember)d(that)396 1149 y(\330MQ)j(is)g(an)f(asynchronous,)d
(elastic)k(f)o(abric.)e(This)i(has)f(some)g(impact)g(on)f(ho)n(w)h(we)h
(plug)e(sock)o(ets)h(into)g(the)h(netw)o(ork)396 1257
y(topology)-5 b(,)18 b(and)h(ho)n(w)h(we)g(use)h(the)f(sock)o(ets)g
(after)g(that.)-2 1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286
a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:517) cvn /DEST pdfmark end
 -2 1286 a 359 x Fn(2.3.)39 b(Plug)o(ging)e(Soc)m(kets)h
(Into)h(the)g(T)-11 b(opology)2711 1645 y
SDict begin H.S end
 2711 1645 a
2711 1645 a
SDict begin 22.464 H.A end
 2711 1645 a 2711 1645 a
SDict begin [/View [/XYZ H.V]/Dest (7.24.1) cvn /DEST pdfmark end
 2711 1645 a -2 1843
a
SDict begin H.S end
 -2 1843 a -2 1843 a
SDict begin 13 H.A end
 -2 1843 a -2 1843 a
SDict begin [/View [/XYZ H.V]/Dest (0:519) cvn /DEST pdfmark end
 -2 1843 a 396
1919 a Fk(T)k(o)21 b(create)f(a)g(connection)e(between)i(tw)o(o)g
(nodes)f(you)h(use)g(zmq_bind[3])d(in)j(one)g(node,)f(and)g
(zmq_connect[3])e(in)j(the)396 2027 y(other)-5 b(.)20
b(As)h(a)f(general)g(rule)f(of)h(thumb,)f(the)h(node)f(which)h(does)g
(zmq_bind[3])d(is)k(a)f("serv)o(er",)f(sitting)i(on)e(a)396
2135 y(well-kno)n(wn)g(netw)o(ork)g(address,)g(and)h(the)g(node)f
(which)h(does)g(zmq_connect[3])c(is)21 b(a)g("client",)e(with)i(unkno)n
(wn)c(or)396 2242 y(arbitrary)i(netw)o(ork)g(addresses.)g(Thus)h(we)h
(say)f(that)h(we)f("bind)f(a)i(sock)o(et)f(to)g(an)g(endpoint")f(and)g
("connect)g(a)i(sock)o(et)f(to)396 2350 y(an)g(endpoint",)e(the)j
(endpoint)d(being)h(that)h(well-kno)n(wn)f(netw)o(ork)g(address.)-2
2534 y
SDict begin H.S end
 -2 2534 a -2 2534 a
SDict begin 13 H.A end
 -2 2534 a -2 2534 a
SDict begin [/View [/XYZ H.V]/Dest (0:520) cvn /DEST pdfmark end
 -2 2534
a 396 2624 a Fk(\330MQ)i(connections)d(are)i(some)n(what)g(dif)n
(ferent)e(from)h(old-f)o(ashioned)f(TCP)j(connections.)d(The)i(main)f
(notable)396 2732 y(dif)n(ferences)g(are:)-2 2733 y
SDict begin H.S end
 -2
2733 a -2 2733 a
SDict begin 13 H.A end
 -2 2733 a -2 2733 a
SDict begin [/View [/XYZ H.V]/Dest (0:521) cvn /DEST pdfmark end
 -2 2733 a -2 2743
a
SDict begin H.S end
 -2 2743 a -2 2743 a
SDict begin 13 H.A end
 -2 2743 a -2 2743 a
SDict begin [/View [/XYZ H.V]/Dest (0:522) cvn /DEST pdfmark end
 -2 2743 a Black
396 2902 a Fj(\225)p Black 479 2902 a
SDict begin H.S end
 479 2902 a 479
2902 a
SDict begin 13 H.A end
 479 2902 a 479 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:523) cvn /DEST pdfmark end
 479 2902 a Fk(The)o(y)g(go)h(across)g(an)h
(arbitrary)d(transport)h(\()1751 2902 y
SDict begin H.S end
 1751 2902 a 1751
2902 a
SDict begin 13 H.A end
 1751 2902 a 1751 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:524) cvn /DEST pdfmark end
 1751 2902 a Fe(inproc)p
Fk(,)2061 2902 y
SDict begin H.S end
 2061 2902 a 2061 2902 a
SDict begin 13 H.A end
 2061 2902 a
2061 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:525) cvn /DEST pdfmark end
 2061 2902 a Fe(ipc)p Fk(,)2237 2902 y
SDict begin H.S end
 2237
2902 a 2237 2902 a
SDict begin 13 H.A end
 2237 2902 a 2237 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:526) cvn /DEST pdfmark end
 2237 2902
a Fe(tcp)p Fk(,)2413 2902 y
SDict begin H.S end
 2413 2902 a 2413 2902 a
SDict begin 13 H.A end
 2413
2902 a 2413 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:527) cvn /DEST pdfmark end
 2413 2902 a Fe(pgm)h Fk(or)2658 2902
y
SDict begin H.S end
 2658 2902 a 2658 2902 a
SDict begin 13 H.A end
 2658 2902 a 2658 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:528) cvn /DEST pdfmark end
 2658
2902 a Fe(epgm)p Fk(\).)g(See)g(zmq_inproc[7],)479 3010
y(zmq_ipc[7],)e(zmq_tcp[7],)f(zmq_pgm[7],)f(and)k(zmq_epgm[7].)-2
3028 y
SDict begin H.S end
 -2 3028 a -2 3028 a
SDict begin 13 H.A end
 -2 3028 a -2 3028 a
SDict begin [/View [/XYZ H.V]/Dest (0:529) cvn /DEST pdfmark end
 -2 3028
a Black 396 3160 a Fj(\225)p Black 479 3160 a
SDict begin H.S end
 479 3160
a 479 3160 a
SDict begin 13 H.A end
 479 3160 a 479 3160 a
SDict begin [/View [/XYZ H.V]/Dest (0:530) cvn /DEST pdfmark end
 479 3160 a Fk(The)o(y)f(e)o(xist)i
(when)e(a)i(client)f(does)g(zmq_connect[3])c(to)21 b(an)f(endpoint,)e
(whether)h(or)h(not)g(a)g(serv)o(er)g(has)g(already)479
3268 y(done)f(zmq_bind[3])e(to)j(that)h(endpoint.)-2
3286 y
SDict begin H.S end
 -2 3286 a -2 3286 a
SDict begin 13 H.A end
 -2 3286 a -2 3286 a
SDict begin [/View [/XYZ H.V]/Dest (0:531) cvn /DEST pdfmark end
 -2 3286
a Black 396 3417 a Fj(\225)p Black 479 3417 a
SDict begin H.S end
 479 3417
a 479 3417 a
SDict begin 13 H.A end
 479 3417 a 479 3417 a
SDict begin [/View [/XYZ H.V]/Dest (0:532) cvn /DEST pdfmark end
 479 3417 a Fk(The)o(y)e(are)i
(asynchronous,)c(and)i(ha)n(v)o(e)h(queues)f(that)h(magically)g(e)o
(xist)g(where)g(and)f(when)h(needed.)-2 3435 y
SDict begin H.S end
 -2 3435
a -2 3435 a
SDict begin 13 H.A end
 -2 3435 a -2 3435 a
SDict begin [/View [/XYZ H.V]/Dest (0:533) cvn /DEST pdfmark end
 -2 3435 a Black 396 3567
a Fj(\225)p Black 479 3567 a
SDict begin H.S end
 479 3567 a 479 3567 a
SDict begin 13 H.A end
 479
3567 a 479 3567 a
SDict begin [/View [/XYZ H.V]/Dest (0:534) cvn /DEST pdfmark end
 479 3567 a Fk(The)o(y)f(may)h(e)o(xpress)g(a)g
(certain)g("messaging)f(pattern",)g(according)f(to)i(the)h(type)e(of)h
(sock)o(et)g(used)g(at)h(each)f(end.)-2 3585 y
SDict begin H.S end
 -2 3585
a -2 3585 a
SDict begin 13 H.A end
 -2 3585 a -2 3585 a
SDict begin [/View [/XYZ H.V]/Dest (0:535) cvn /DEST pdfmark end
 -2 3585 a Black 396 3716
a Fj(\225)p Black 479 3716 a
SDict begin H.S end
 479 3716 a 479 3716 a
SDict begin 13 H.A end
 479
3716 a 479 3716 a
SDict begin [/View [/XYZ H.V]/Dest (0:536) cvn /DEST pdfmark end
 479 3716 a Fk(One)g(sock)o(et)g(may)g(ha)n(v)o(e)g
(man)o(y)f(outgoing)f(and)h(man)o(y)g(incoming)g(connections.)-2
3734 y
SDict begin H.S end
 -2 3734 a -2 3734 a
SDict begin 13 H.A end
 -2 3734 a -2 3734 a
SDict begin [/View [/XYZ H.V]/Dest (0:537) cvn /DEST pdfmark end
 -2 3734
a Black 396 3866 a Fj(\225)p Black 479 3866 a
SDict begin H.S end
 479 3866
a 479 3866 a
SDict begin 13 H.A end
 479 3866 a 479 3866 a
SDict begin [/View [/XYZ H.V]/Dest (0:538) cvn /DEST pdfmark end
 479 3866 a Fk(There)h(is)h(no)f
(zmq_accept\(\))d(method.)i(When)h(a)g(sock)o(et)g(is)h(bound)e(to)h
(an)g(endpoint)f(it)i(automatically)d(starts)479 3973
y(accepting)h(connections.)-2 3991 y
SDict begin H.S end
 -2 3991 a -2 3991
a
SDict begin 13 H.A end
 -2 3991 a -2 3991 a
SDict begin [/View [/XYZ H.V]/Dest (0:539) cvn /DEST pdfmark end
 -2 3991 a Black 396 4123 a Fj(\225)p
Black 479 4123 a
SDict begin H.S end
 479 4123 a 479 4123 a
SDict begin 13 H.A end
 479 4123 a 479
4123 a
SDict begin [/View [/XYZ H.V]/Dest (0:540) cvn /DEST pdfmark end
 479 4123 a Fk(Y)-9 b(our)20 b(application)e(code)i(cannot)f(w)o
(ork)g(with)i(these)f(connections)e(directly;)i(the)o(y)f(are)h
(encapsulated)f(under)g(the)479 4231 y(sock)o(et.)-2
4398 y
SDict begin H.S end
 -2 4398 a -2 4398 a
SDict begin 13 H.A end
 -2 4398 a -2 4398 a
SDict begin [/View [/XYZ H.V]/Dest (0:541) cvn /DEST pdfmark end
 -2 4398
a 396 4505 a Fk(Man)o(y)g(architectures)g(follo)n(w)h(some)g(kind)f(of)
h(client-serv)o(er)f(model,)g(where)g(the)h(serv)o(er)g(is)h(the)f
(component)e(that)i(is)396 4613 y(most)g(static,)h(and)f(the)g(clients)
h(are)f(the)g(components)e(that)i(are)g(most)h(dynamic,)d(i.e.)i(the)o
(y)g(come)f(and)h(go)g(the)g(most.)396 4721 y(There)g(are)g(sometimes)g
(issues)h(of)f(addressing:)f(serv)o(ers)g(will)i(be)f(visible)g(to)h
(clients,)f(b)n(ut)g(not)g(necessarily)396 4829 y(vice-v)o(ersa.)f(So)h
(mostly)g(it')-5 b(s)21 b(ob)o(vious)e(which)g(node)g(should)h(be)g
(doing)f(zmq_bind[3])d(\(the)k(serv)o(er\))f(and)h(which)396
4937 y(should)f(be)i(doing)d(zmq_connect[3])f(\(the)j(client\).)f(It)i
(also)f(depends)f(on)h(the)g(kind)f(of)h(sock)o(ets)h(you')l(re)d
(using,)h(with)396 5044 y(some)h(e)o(xceptions)f(for)g(unusual)g(netw)o
(ork)g(architectures.)g(W)-7 b(e')o(ll)21 b(look)f(at)g(sock)o(et)h
(types)f(later)-5 b(.)p Black 3800 5569 a Ff(34)p Black
eop end
%%Page: 35 48
TeXDict begin 35 47 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.35) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:542) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(No)n(w)-5 b(,)19 b(imagine)g(we)i(start)f(the)g
(client)1487 72 y
SDict begin H.S end
 1487 72 a 1487 72 a
SDict begin 13 H.A end
 1487 72 a 1487
72 a
SDict begin [/View [/XYZ H.V]/Dest (0:543) cvn /DEST pdfmark end
 1487 72 a Ff(befor)m(e)f Fk(we)h(start)h(the)f(serv)o(er)-5
b(.)19 b(In)g(traditional)g(netw)o(orking)f(we)i(get)g(a)g(big)g(red)f
(F)o(ail)396 180 y(\003ag.)h(But)h(\330MQ)f(lets)i(us)e(start)h(and)e
(stop)i(pieces)f(arbitrarily)-5 b(.)18 b(As)j(soon)f(as)g(the)h(client)
f(node)f(does)h(zmq_connect[3])396 288 y(the)g(connection)f(e)o(xists)h
(and)g(that)g(node)f(can)h(start)h(to)f(write)h(messages)f(to)g(the)h
(sock)o(et.)e(At)i(some)f(stage)g(\(hopefully)396 396
y(before)f(messages)h(queue)f(up)h(so)g(much)g(that)g(the)o(y)f(start)i
(to)f(get)g(discarded,)f(or)h(the)g(client)g(blocks\),)f(the)h(serv)o
(er)f(comes)396 504 y(ali)n(v)o(e,)h(does)g(a)g(zmq_bind[3])d(and)j
(\330MQ)g(starts)h(to)f(deli)n(v)o(er)f(messages.)-2
688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:544) cvn /DEST pdfmark end
 -2 688 a 396
778 a Fk(A)i(serv)o(er)e(node)g(can)h(bind)g(to)g(man)o(y)f(endpoints)g
(and)g(it)i(can)f(do)g(this)h(using)e(a)i(single)f(sock)o(et.)g(This)g
(means)g(it)h(will)396 886 y(accept)f(connections)e(across)j(dif)n
(ferent)d(transports:)-2 987 y
SDict begin H.S end
 -2 987 a -2 987 a
SDict begin 11.7 H.A end
 -2 987
a -2 987 a
SDict begin [/View [/XYZ H.V]/Dest (0:545) cvn /DEST pdfmark end
 -2 987 a 396 1066 a Fe(zmq_bind)44 b(\(socket,)f("tcp://)
1518 1079 y(*)1563 1066 y(:5555"\);)396 1163 y(zmq_bind)h(\(socket,)f
("tcp://)1518 1176 y(*)1563 1163 y(:9999"\);)396 1261
y(zmq_bind)h(\(socket,)f("ipc://myserver.ipc"\);)-2 1438
y
SDict begin H.S end
 -2 1438 a -2 1438 a
SDict begin 13 H.A end
 -2 1438 a -2 1438 a
SDict begin [/View [/XYZ H.V]/Dest (0:546) cvn /DEST pdfmark end
 -2 1438 a 396
1534 a Fk(Y)-9 b(ou)20 b(cannot)f(bind)g(to)i(the)f(same)g(endpoint)f
(twice,)h(that)g(will)h(cause)f(an)g(e)o(xception.)-2
1719 y
SDict begin H.S end
 -2 1719 a -2 1719 a
SDict begin 13 H.A end
 -2 1719 a -2 1719 a
SDict begin [/View [/XYZ H.V]/Dest (0:547) cvn /DEST pdfmark end
 -2 1719
a 396 1808 a Fk(Each)g(time)g(a)h(client)f(node)f(does)h(a)h
(zmq_connect[3])16 b(to)k(an)o(y)g(of)g(these)g(endpoints,)f(the)h
(serv)o(er)f(node')-5 b(s)20 b(sock)o(et)g(gets)396 1916
y(another)f(connection.)f(There)h(is)i(no)f(inherent)f(limit)i(to)f(ho)
n(w)g(man)o(y)f(connections)f(a)i(sock)o(et)h(can)f(ha)n(v)o(e.)f(A)i
(client)f(node)396 2024 y(can)g(also)h(connect)e(to)h(man)o(y)f
(endpoints)g(using)g(a)i(single)f(sock)o(et.)-2 2208
y
SDict begin H.S end
 -2 2208 a -2 2208 a
SDict begin 13 H.A end
 -2 2208 a -2 2208 a
SDict begin [/View [/XYZ H.V]/Dest (0:548) cvn /DEST pdfmark end
 -2 2208 a 396
2298 a Fk(In)g(most)g(cases,)h(which)f(node)f(acts)i(as)g(client,)f
(and)f(which)h(as)h(serv)o(er)m(,)e(is)i(about)e(netw)o(ork)g(topology)
f(rather)h(than)396 2406 y(message)h(\003o)n(w)-5 b(.)20
b(Ho)n(we)n(v)o(er)m(,)e(there)1404 2406 y
SDict begin H.S end
 1404 2406
a 1404 2406 a
SDict begin 13 H.A end
 1404 2406 a 1404 2406 a
SDict begin [/View [/XYZ H.V]/Dest (0:549) cvn /DEST pdfmark end
 1404 2406 a Ff(ar)m(e)i
Fk(cases)h(\(resending)d(when)i(connections)e(are)i(brok)o(en\))e
(where)i(the)g(same)h(sock)o(et)396 2514 y(type)f(will)h(beha)n(v)o(e)e
(dif)n(ferently)f(if)i(it')-5 b(s)22 b(a)e(serv)o(er)g(or)g(if)g(it')-5
b(s)21 b(a)g(client.)-2 2698 y
SDict begin H.S end
 -2 2698 a -2 2698 a
SDict begin 13 H.A end
 -2
2698 a -2 2698 a
SDict begin [/View [/XYZ H.V]/Dest (0:550) cvn /DEST pdfmark end
 -2 2698 a 396 2788 a Fk(What)g(this)g(means)e(is)j
(that)e(you)f(should)g(al)o(w)o(ays)i(think)e(in)i(terms)f(of)g("serv)o
(ers")f(as)i(static)g(parts)f(of)g(your)f(topology)-5
b(,)396 2896 y(with)21 b(more-or)n(-less)d(\002x)o(ed)i(endpoint)e
(addresses,)i(and)f("clients")i(as)g(dynamic)d(parts)i(that)h(come)e
(and)h(go.)g(Then,)396 3004 y(design)g(your)f(application)f(around)h
(this)h(model.)g(The)f(chances)h(that)g(it)h(will)g("just)g(w)o(ork")e
(are)h(much)f(better)h(lik)o(e)h(that.)-2 3188 y
SDict begin H.S end
 -2 3188
a -2 3188 a
SDict begin 13 H.A end
 -2 3188 a -2 3188 a
SDict begin [/View [/XYZ H.V]/Dest (0:551) cvn /DEST pdfmark end
 -2 3188 a 396 3278 a
Fk(Sock)o(ets)f(ha)n(v)o(e)g(types.)g(The)g(sock)o(et)g(type)f
(de\002nes)h(the)h(semantics)f(of)g(the)g(sock)o(et,)g(its)h(policies)f
(for)g(routing)e(messages)396 3386 y(inw)o(ards)i(and)g(outw)o(ards,)f
(queuing,)f(etc.)i(Y)-9 b(ou)20 b(can)g(connect)f(certain)g(types)h(of)
g(sock)o(et)g(together)m(,)e(e.g.)i(a)h(publisher)396
3494 y(sock)o(et)f(and)g(a)h(subscriber)e(sock)o(et.)g(Sock)o(ets)i(w)o
(ork)e(together)g(in)h("messaging)f(patterns".)h(W)-7
b(e')o(ll)21 b(look)e(at)i(this)g(in)f(more)396 3602
y(detail)g(later)-5 b(.)-2 3769 y
SDict begin H.S end
 -2 3769 a -2 3769 a
SDict begin 13 H.A end

-2 3769 a -2 3769 a
SDict begin [/View [/XYZ H.V]/Dest (0:552) cvn /DEST pdfmark end
 -2 3769 a 396 3876 a Fk(It')g(s)21
b(the)f(ability)g(to)h(connect)e(sock)o(ets)h(in)g(these)h(dif)n
(ferent)d(w)o(ays)j(that)f(gi)n(v)o(es)g(\330MQ)g(its)h(basic)g(po)n
(wer)e(as)i(a)f(message)396 3984 y(queuing)f(system.)h(There)f(are)h
(layers)g(on)g(top)g(of)g(this,)g(such)g(as)h(proxies,)e(which)h(we')o
(ll)g(get)g(to)h(later)-5 b(.)20 b(But)h(essentially)-5
b(,)396 4092 y(with)21 b(\330MQ)f(you)f(de\002ne)h(your)f(netw)o(ork)g
(architecture)g(by)g(plugging)f(pieces)j(together)d(lik)o(e)j(a)f
(child')-5 b(s)21 b(construction)396 4200 y(to)o(y)-5
b(.)-2 4228 y
SDict begin H.S end
 -2 4228 a -2 4228 a
SDict begin 13 H.A end
 -2 4228 a -2 4228 a
SDict begin [/View [/XYZ H.V]/Dest (0:553) cvn /DEST pdfmark end

-2 4228 a 359 x Fn(2.4.)39 b(Using)f(Soc)m(kets)h(to)g(Carr)q(y)g(Data)
2206 4587 y
SDict begin H.S end
 2206 4587 a 2206 4587 a
SDict begin 22.464 H.A end
 2206 4587 a 2206
4587 a
SDict begin [/View [/XYZ H.V]/Dest (7.25.1) cvn /DEST pdfmark end
 2206 4587 a -2 4785 a
SDict begin H.S end
 -2 4785 a -2 4785 a
SDict begin 13 H.A end
 -2 4785
a -2 4785 a
SDict begin [/View [/XYZ H.V]/Dest (0:555) cvn /DEST pdfmark end
 -2 4785 a 396 4861 a Fk(T)-7 b(o)20 b(send)f(and)g(recei)n
(v)o(e)g(messages)h(you)e(use)i(the)g(zmq_msg_send[3])15
b(and)k(zmq_msg_recv[3])d(methods.)i(The)h(names)396
4969 y(are)h(con)m(v)o(entional)c(b)n(ut)k(\330MQ')-5
b(s)20 b(I/O)g(model)e(is)j(dif)n(ferent)d(enough)f(from)i(the)g(TCP)i
(model\()p 0 TeXcolorgray 3071 4969 a
SDict begin H.S end
 3071 4969 a Fk(Figure)c(2-1)3418
4969 y
SDict begin 13 H.L end
 3418 4969 a 3418 4969 a
SDict begin [/Subtype /Link/Dest (0:figure-10) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3418 4969 a Black -1 w
Fk(\))j(that)f(you)g(will)396 5077 y(need)h(time)g(to)g(get)h(your)e
(head)g(around)f(it.)-2 5095 y
SDict begin H.S end
 -2 5095 a -2 5095 a
SDict begin 13 H.A end
 -2
5095 a -2 5095 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-10) cvn /DEST pdfmark
end
 -2 5095 a Black 3800 5569 a Ff(35)p
Black eop end
%%Page: 36 49
TeXDict begin 36 48 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.36) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:578) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-1.)f(TCP)i(sock)o(ets)f(ar)o(e)g(1)g
(to)g(1)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:559) cvn /DEST pdfmark end

-2 172 a 396 2897 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2897 a @beginspecial 0 @llx -322
@lly 180 @urx 0 @ury 1800 @rwi @setspecial
%%BeginDocument: images/fig10.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -322 180 0
%%HiResBoundingBox: 0.0 -322.0 180.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -92.00029754638672 lineto
158.00030517578125 -92.00029754638672 lineto
158.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -96.00029754638672 moveto
28.00029945373535 -115.00029754638672 lineto
28.00029945373535 -119.66696421305339 29.666966756184895 -122.00029754638672 33.000301361083984 -122.00029754638672 curveto
153.00030517578125 -122.00029754638672 lineto
153.00030517578125 -122.00029754638672 lineto
156.3336385091146 -122.00029754638672 158.00030517578125 -119.66696421305339 158.00030517578125 -115.00029754638672 curveto
158.00030517578125 -96.00029754638672 lineto
158.00030517578125 -96.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
33.000301361083984 -206.00030517578125 moveto
29.666966756184895 -206.00030517578125 28.00029945373535 -208.3336385091146 28.00029945373535 -213.00030517578125 curveto
28.00029945373535 -232.00030517578125 lineto
158.00030517578125 -232.00030517578125 lineto
158.00030517578125 -213.00030517578125 lineto
158.00030517578125 -208.3336385091146 156.3336385091146 -206.00030517578125 153.00030517578125 -206.00030517578125 curveto
33.000301361083984 -206.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -236.00030517578125 moveto
28.00029945373535 -290.00030517578125 lineto
158.00030517578125 -290.00030517578125 lineto
158.00030517578125 -236.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
155.0 -89.0 lineto
155.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
155.0 -89.0 lineto
155.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
150.0 -119.0 lineto
150.0 -119.0 lineto
153.33333333333334 -119.0 155.0 -116.66666666666667 155.0 -112.0 curveto
155.0 -93.0 lineto
155.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
150.0 -119.0 lineto
150.0 -119.0 lineto
153.33333333333334 -119.0 155.0 -116.66666666666667 155.0 -112.0 curveto
155.0 -93.0 lineto
155.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
30.0 -203.0 moveto
26.666666666666668 -203.0 25.0 -205.33333333333334 25.0 -210.0 curveto
25.0 -229.0 lineto
155.0 -229.0 lineto
155.0 -210.0 lineto
155.0 -205.33333333333334 153.33333333333334 -203.0 150.0 -203.0 curveto
30.0 -203.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
30.0 -203.0 moveto
26.666666666666668 -203.0 25.0 -205.33333333333334 25.0 -210.0 curveto
25.0 -229.0 lineto
155.0 -229.0 lineto
155.0 -210.0 lineto
155.0 -205.33333333333334 153.33333333333334 -203.0 150.0 -203.0 curveto
30.0 -203.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -233.0 moveto
25.0 -287.0 lineto
155.0 -287.0 lineto
155.0 -233.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -233.0 moveto
25.0 -287.0 lineto
155.0 -287.0 lineto
155.0 -233.0 lineto
closepath
stroke
newpath
85.0 -133.0 moveto
85.0 -189.0 lineto
stroke
newpath
85.0 -126.0 moveto
80.0 -140.0 lineto
90.0 -140.0 lineto
closepath
fill
newpath
80.0 -182.0 moveto
85.0 -196.0 lineto
90.0 -182.0 lineto
closepath
fill
/Helvetica findfont
13 scalefont setfont
71.0 -68.0 moveto
(Node) show
62.0 -110.0 moveto
(Socket) show
57.0 -166.0 moveto
(1 to 1) show
62.0 -222.0 moveto
(Socket) show
71.0 -264.0 moveto
(Node) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2897 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2897 a -2 3063 a
SDict begin H.S end
 -2 3063
a -2 3063 a
SDict begin 13 H.A end
 -2 3063 a -2 3063 a
SDict begin [/View [/XYZ H.V]/Dest (0:562) cvn /DEST pdfmark end
 -2 3063 a 396 3171 a
Fk(Let')-5 b(s)21 b(look)e(at)i(the)f(main)g(dif)n(ferences)f(between)g
(TCP)i(sock)o(ets)f(and)g(\330MQ)g(sock)o(ets)h(when)e(it)i(comes)f(to)
g(carrying)396 3279 y(data:)-2 3280 y
SDict begin H.S end
 -2 3280 a -2 3280
a
SDict begin 13 H.A end
 -2 3280 a -2 3280 a
SDict begin [/View [/XYZ H.V]/Dest (0:563) cvn /DEST pdfmark end
 -2 3280 a -2 3290 a
SDict begin H.S end
 -2 3290 a -2
3290 a
SDict begin 13 H.A end
 -2 3290 a -2 3290 a
SDict begin [/View [/XYZ H.V]/Dest (0:564) cvn /DEST pdfmark end
 -2 3290 a Black 396 3449 a
Fj(\225)p Black 479 3449 a
SDict begin H.S end
 479 3449 a 479 3449 a
SDict begin 13 H.A end
 479
3449 a 479 3449 a
SDict begin [/View [/XYZ H.V]/Dest (0:565) cvn /DEST pdfmark end
 479 3449 a Fk(\330MQ)h(sock)o(ets)f(carry)f
(messages,)h(rather)g(than)g(bytes)g(\(as)g(in)g(TCP\))h(or)f(frames)g
(\(as)g(in)h(UDP\).)f(A)g(message)g(is)i(a)479 3557 y
(length-speci\002ed)c(blob)i(of)g(binary)f(data.)g(W)-7
b(e')o(ll)22 b(come)d(to)i(messages)f(shortly)-5 b(,)19
b(their)h(design)f(is)i(optimized)e(for)479 3665 y(performance)f(and)h
(thus)h(some)n(what)g(trick)o(y)f(to)h(understand.)-2
3683 y
SDict begin H.S end
 -2 3683 a -2 3683 a
SDict begin 13 H.A end
 -2 3683 a -2 3683 a
SDict begin [/View [/XYZ H.V]/Dest (0:566) cvn /DEST pdfmark end
 -2 3683
a Black 396 3815 a Fj(\225)p Black 479 3815 a
SDict begin H.S end
 479 3815
a 479 3815 a
SDict begin 13 H.A end
 479 3815 a 479 3815 a
SDict begin [/View [/XYZ H.V]/Dest (0:567) cvn /DEST pdfmark end
 479 3815 a Fk(\330MQ)h(sock)o(ets)f
(do)g(their)g(I/O)g(in)h(a)f(background)d(thread.)i(This)h(means)g
(that)g(messages)h(arri)n(v)o(e)e(in)h(a)h(local)f(input)479
3923 y(queue,)f(and)h(are)g(sent)g(from)f(a)i(local)f(output)f(queue,)g
(no)h(matter)g(what)g(your)f(application)f(is)k(b)n(usy)d(doing.)g
(These)479 4030 y(are)h(con\002gurable)e(memory)h(queues,)g(by)g(the)i
(w)o(ay)-5 b(.)-2 4048 y
SDict begin H.S end
 -2 4048 a -2 4048 a
SDict begin 13 H.A end
 -2 4048
a -2 4048 a
SDict begin [/View [/XYZ H.V]/Dest (0:568) cvn /DEST pdfmark end
 -2 4048 a Black 396 4180 a Fj(\225)p Black
479 4180 a
SDict begin H.S end
 479 4180 a 479 4180 a
SDict begin 13 H.A end
 479 4180 a 479 4180
a
SDict begin [/View [/XYZ H.V]/Dest (0:569) cvn /DEST pdfmark end
 479 4180 a Fk(\330MQ)21 b(sock)o(ets)f(can,)g(depending)d(on)j(the)g
(sock)o(et)g(type,)g(be)g(connected)e(to)j(\(or)e(from,)g(it')-5
b(s)21 b(the)g(same\))f(man)o(y)f(other)479 4288 y(sock)o(ets.)h(Where)
g(TCP)h(emulates)f(a)h(one-to-one)c(phone)i(call,)h(\330MQ)h
(implements)e(one-to-man)o(y)e(\(lik)o(e)j(a)g(radio)479
4396 y(broadcast\),)f(man)o(y-to-man)o(y)d(\(lik)o(e)k(a)g(post)h(of)n
(\002ce\),)e(man)o(y-to-one)d(\(lik)o(e)21 b(a)f(mail)h(box\),)d(and)i
(e)n(v)o(en)f(one-to-one.)-2 4414 y
SDict begin H.S end
 -2 4414 a -2 4414
a
SDict begin 13 H.A end
 -2 4414 a -2 4414 a
SDict begin [/View [/XYZ H.V]/Dest (0:570) cvn /DEST pdfmark end
 -2 4414 a Black 396 4545 a Fj(\225)p
Black 479 4545 a
SDict begin H.S end
 479 4545 a 479 4545 a
SDict begin 13 H.A end
 479 4545 a 479
4545 a
SDict begin [/View [/XYZ H.V]/Dest (0:571) cvn /DEST pdfmark end
 479 4545 a Fk(\330MQ)i(sock)o(ets)f(can)g(send)g(to)g(man)o(y)f
(endpoints)g(\(creating)g(a)h(f)o(an-out)f(model\),)g(or)h(recei)n(v)o
(e)f(from)g(man)o(y)g(endpoints)479 4653 y(\(creating)g(a)i(f)o(an-in)e
(model\)\()p 0 TeXcolorgray 1336 4653 a
SDict begin H.S end
 1336 4653 a Fk(Figure)e(2-2)
1683 4653 y
SDict begin 13 H.L end
 1683 4653 a 1683 4653 a
SDict begin [/Subtype /Link/Dest (0:figure-11) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1683 4653 a Black
-1 w Fk(\).)-2 4671 y
SDict begin H.S end
 -2 4671 a -2 4671 a
SDict begin 13 H.A end
 -2 4671 a -2
4671 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-11) cvn /DEST pdfmark
end
 -2 4671 a Black 3798 5569 a Ff(36)p Black eop
end
%%Page: 37 50
TeXDict begin 37 49 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.37) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-2.)f(\330MQ)h(Sock)o(ets)h(ar)o(e)e(N)i
(to)f(N)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:575) cvn /DEST pdfmark end

-2 172 a 396 2014 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2014 a @beginspecial 0 @llx -216
@lly 282 @urx 0 @ury 2820 @rwi @setspecial
%%BeginDocument: images/fig11.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -216 282 0
%%HiResBoundingBox: 0.0 -216.0 282.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
34.80017852783203 -23.800180435180664 moveto
34.80017852783203 -57.80017852783203 lineto
112.80017852783203 -57.80017852783203 lineto
112.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
184.80018615722656 -23.800180435180664 moveto
184.80018615722656 -57.80017852783203 lineto
262.8001708984375 -57.80017852783203 lineto
262.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
34.80017852783203 -60.80017852783203 moveto
34.80017852783203 -73.80017852783203 lineto
34.80017852783203 -76.4668451944987 35.80017852783203 -77.80017852783203 37.80017852783203 -77.80017852783203 curveto
109.80017852783203 -77.80017852783203 lineto
109.80017852783203 -77.80017852783203 lineto
111.80017852783203 -77.80017852783203 112.80017852783203 -76.4668451944987 112.80017852783203 -73.80017852783203 curveto
112.80017852783203 -61.000179290771484 lineto
112.80017852783203 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
184.80018615722656 -60.80017852783203 moveto
184.80018615722656 -73.80017852783203 lineto
184.80018615722656 -76.4668451944987 185.80018615722656 -77.80017852783203 187.80018615722656 -77.80017852783203 curveto
259.8001708984375 -77.80017852783203 lineto
259.8001708984375 -77.80017852783203 lineto
261.8001708984375 -77.80017852783203 262.8001708984375 -76.4668451944987 262.8001708984375 -73.80017852783203 curveto
262.8001708984375 -61.000179290771484 lineto
262.8001708984375 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
37.80017852783203 -140.80018615722656 moveto
35.80017852783203 -140.80018615722656 34.80017852783203 -142.46685282389322 34.80017852783203 -145.80018615722656 curveto
34.80017852783203 -156.80018615722656 lineto
112.80017852783203 -156.80018615722656 lineto
112.80017852783203 -145.80018615722656 lineto
112.80017852783203 -142.46685282389322 111.80017852783203 -140.80018615722656 109.80017852783203 -140.80018615722656 curveto
37.80017852783203 -140.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
34.80017852783203 -159.80018615722656 moveto
34.80017852783203 -194.80018615722656 lineto
112.80017852783203 -194.80018615722656 lineto
112.80017852783203 -159.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
187.80018615722656 -140.80018615722656 moveto
185.80018615722656 -140.80018615722656 184.80018615722656 -142.46685282389322 184.80018615722656 -145.80018615722656 curveto
184.80018615722656 -156.80018615722656 lineto
262.8001708984375 -156.80018615722656 lineto
262.8001708984375 -145.80018615722656 lineto
262.8001708984375 -142.46685282389322 261.8001708984375 -140.80018615722656 259.8001708984375 -140.80018615722656 curveto
187.80018615722656 -140.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
184.80018615722656 -159.80018615722656 moveto
184.80018615722656 -194.80018615722656 lineto
262.8001708984375 -194.80018615722656 lineto
262.8001708984375 -159.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
33.0 -22.0 moveto
33.0 -56.0 lineto
111.0 -56.0 lineto
111.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
33.0 -22.0 moveto
33.0 -56.0 lineto
111.0 -56.0 lineto
111.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
183.0 -22.0 moveto
183.0 -56.0 lineto
261.0 -56.0 lineto
261.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
183.0 -22.0 moveto
183.0 -56.0 lineto
261.0 -56.0 lineto
261.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
33.0 -59.0 moveto
33.0 -72.0 lineto
33.0 -74.66666666666667 34.0 -76.0 36.0 -76.0 curveto
108.0 -76.0 lineto
108.0 -76.0 lineto
110.0 -76.0 111.0 -74.66666666666667 111.0 -72.0 curveto
111.0 -59.20000076293945 lineto
111.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
33.0 -59.0 moveto
33.0 -72.0 lineto
33.0 -74.66666666666667 34.0 -76.0 36.0 -76.0 curveto
108.0 -76.0 lineto
108.0 -76.0 lineto
110.0 -76.0 111.0 -74.66666666666667 111.0 -72.0 curveto
111.0 -59.20000076293945 lineto
111.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
183.0 -59.0 moveto
183.0 -72.0 lineto
183.0 -74.66666666666667 184.0 -76.0 186.0 -76.0 curveto
258.0 -76.0 lineto
258.0 -76.0 lineto
260.0 -76.0 261.0 -74.66666666666667 261.0 -72.0 curveto
261.0 -59.20000076293945 lineto
261.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
183.0 -59.0 moveto
183.0 -72.0 lineto
183.0 -74.66666666666667 184.0 -76.0 186.0 -76.0 curveto
258.0 -76.0 lineto
258.0 -76.0 lineto
260.0 -76.0 261.0 -74.66666666666667 261.0 -72.0 curveto
261.0 -59.20000076293945 lineto
261.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
36.0 -139.0 moveto
34.0 -139.0 33.0 -140.66666666666666 33.0 -144.0 curveto
33.0 -155.0 lineto
111.0 -155.0 lineto
111.0 -144.0 lineto
111.0 -140.66666666666666 110.0 -139.0 108.0 -139.0 curveto
36.0 -139.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
36.0 -139.0 moveto
34.0 -139.0 33.0 -140.66666666666666 33.0 -144.0 curveto
33.0 -155.0 lineto
111.0 -155.0 lineto
111.0 -144.0 lineto
111.0 -140.66666666666666 110.0 -139.0 108.0 -139.0 curveto
36.0 -139.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
33.0 -158.0 moveto
33.0 -193.0 lineto
111.0 -193.0 lineto
111.0 -158.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
33.0 -158.0 moveto
33.0 -193.0 lineto
111.0 -193.0 lineto
111.0 -158.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
186.0 -139.0 moveto
184.0 -139.0 183.0 -140.66666666666666 183.0 -144.0 curveto
183.0 -155.0 lineto
261.0 -155.0 lineto
261.0 -144.0 lineto
261.0 -140.66666666666666 260.0 -139.0 258.0 -139.0 curveto
186.0 -139.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
186.0 -139.0 moveto
184.0 -139.0 183.0 -140.66666666666666 183.0 -144.0 curveto
183.0 -155.0 lineto
261.0 -155.0 lineto
261.0 -144.0 lineto
261.0 -140.66666666666666 260.0 -139.0 258.0 -139.0 curveto
186.0 -139.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
183.0 -158.0 moveto
183.0 -193.0 lineto
261.0 -193.0 lineto
261.0 -158.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
183.0 -158.0 moveto
183.0 -193.0 lineto
261.0 -193.0 lineto
261.0 -158.0 lineto
closepath
stroke
newpath
60.0 -126.0 moveto
63.0 -135.0 lineto
66.0 -126.0 lineto
closepath
fill
newpath
210.0 -126.0 moveto
213.0 -135.0 lineto
216.0 -126.0 lineto
closepath
fill
newpath
222.0 -126.0 moveto
225.0 -135.0 lineto
228.0 -126.0 lineto
closepath
fill
newpath
63.0 -76.0 moveto
63.0 -112.0 lineto
stroke
newpath
63.0 -130.0 moveto
63.0 -112.0 lineto
stroke
newpath
213.0 -130.0 moveto
213.0 -112.0 lineto
63.0 -112.0 lineto
stroke
newpath
75.0 -76.0 moveto
75.0 -94.0 lineto
225.0 -94.0 lineto
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
225.0 -76.0 moveto
225.0 -94.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
225.0 -130.0 moveto
225.0 -94.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
62.0 -44.0 moveto
(Node) show
212.0 -44.0 moveto
(Node) show
56.0 -71.0 moveto
(Socket) show
206.0 -71.0 moveto
(Socket) show
12.0 -98.0 moveto
(1 to N) show
12.0 -107.0 moveto
(Fan out) show
238.0 -116.0 moveto
(N to 1) show
237.0 -125.0 moveto
(Fan in) show
56.0 -152.0 moveto
(Socket) show
206.0 -152.0 moveto
(Socket) show
62.0 -179.0 moveto
(Node) show
212.0 -179.0 moveto
(Node) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2014 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2014 a 274 x Fk(So)h(writing)e(a)i(message)
f(to)g(a)h(sock)o(et)f(may)g(send)g(the)g(message)g(to)g(one)g(or)g
(man)o(y)f(other)g(places)h(at)h(once,)e(and)396 2396
y(con)m(v)o(ersely)-5 b(,)17 b(one)j(sock)o(et)g(will)h(collect)f
(messages)g(from)g(all)g(connections)f(sending)g(messages)h(to)g(it.)h
(The)396 2504 y(zmq_msg_recv[3])16 b(method)j(uses)i(a)f(f)o(air)n
(-queuing)e(algorithm)g(so)j(each)f(sender)f(gets)i(an)f(e)n(v)o(en)f
(chance.)-2 2688 y
SDict begin H.S end
 -2 2688 a -2 2688 a
SDict begin 13 H.A end
 -2 2688 a -2 2688
a
SDict begin [/View [/XYZ H.V]/Dest (0:579) cvn /DEST pdfmark end
 -2 2688 a 396 2778 a Fk(The)h(zmq_msg_send[3])c(method)j(does)h(not)g
(actually)f(send)h(the)h(message)f(to)g(the)g(sock)o(et)g
(connection\(s\).)e(It)i(queues)396 2886 y(the)g(message)g(so)g(that)g
(the)f(I/O)h(thread)f(can)h(send)f(it)i(asynchronously)-5
b(.)16 b(It)k(does)f(not)h(block)e(e)o(xcept)h(in)h(some)g(e)o
(xception)396 2994 y(cases.)h(So)f(the)h(message)f(is)h(not)f
(necessarily)f(sent)i(when)e(zmq_msg_send[3])d(returns)k(to)g(your)f
(application.)f(If)j(you)396 3101 y(created)f(a)g(message)g(using)g
(zmq_msg_init_data[3])c(you)j(cannot)g(reuse)h(the)g(data)g(or)g(free)g
(it,)g(otherwise)g(the)g(I/O)396 3209 y(thread)f(will)i(rapidly)e
(\002nd)h(itself)h(writing)f(o)o(v)o(erwritten)e(or)i(unallocated)e
(garbage.)g(This)i(is)h(a)g(common)d(mistak)o(e)j(for)396
3317 y(be)o(ginners.)d(W)-7 b(e')o(ll)22 b(see)e(a)h(little)g(later)f
(ho)n(w)g(to)g(properly)e(w)o(ork)i(with)g(messages.)-2
3346 y
SDict begin H.S end
 -2 3346 a -2 3346 a
SDict begin 13 H.A end
 -2 3346 a -2 3346 a
SDict begin [/View [/XYZ H.V]/Dest (0:580) cvn /DEST pdfmark end
 -2 3346
a 359 x Fn(2.5.)39 b(Unicast)f(T)-11 b(ranspor)s(ts)1579
3705 y
SDict begin H.S end
 1579 3705 a 1579 3705 a
SDict begin 22.464 H.A end
 1579 3705 a 1579 3705
a
SDict begin [/View [/XYZ H.V]/Dest (7.26.1) cvn /DEST pdfmark end
 1579 3705 a -2 3901 a
SDict begin H.S end
 -2 3901 a -2 3901 a
SDict begin 13 H.A end
 -2 3901 a
-2 3901 a
SDict begin [/View [/XYZ H.V]/Dest (0:582) cvn /DEST pdfmark end
 -2 3901 a 396 3979 a Fk(\330MQ)21 b(pro)o(vides)d(a)j(set)g
(of)f(unicast)g(transports)f(\()1809 3979 y
SDict begin H.S end
 1809 3979
a 1809 3979 a
SDict begin 13 H.A end
 1809 3979 a 1809 3979 a
SDict begin [/View [/XYZ H.V]/Dest (0:583) cvn /DEST pdfmark end
 1809 3979 a Fe(inproc)p
Fk(,)2119 3979 y
SDict begin H.S end
 2119 3979 a 2119 3979 a
SDict begin 13 H.A end
 2119 3979 a
2119 3979 a
SDict begin [/View [/XYZ H.V]/Dest (0:584) cvn /DEST pdfmark end
 2119 3979 a Fe(ipc)p Fk(,)h(and)2436 3979
y
SDict begin H.S end
 2436 3979 a 2436 3979 a
SDict begin 13 H.A end
 2436 3979 a 2436 3979 a
SDict begin [/View [/XYZ H.V]/Dest (0:585) cvn /DEST pdfmark end
 2436
3979 a Fe(tcp)p Fk(\))f(and)h(multicast)g(transports)g(\(epgm,)e
(pgm\).)396 4087 y(Multicast)j(is)g(an)f(adv)n(anced)e(technique)h
(that)h(we')o(ll)g(come)g(to)g(later)-5 b(.)21 b(Don')o(t)e(e)n(v)o(en)
g(start)i(using)e(it)i(unless)g(you)e(kno)n(w)396 4195
y(that)i(your)d(f)o(anout)i(ratios)g(will)h(mak)o(e)e(1-to-N)h(unicast)
f(impossible.)-2 4379 y
SDict begin H.S end
 -2 4379 a -2 4379 a
SDict begin 13 H.A end
 -2 4379 a
-2 4379 a
SDict begin [/View [/XYZ H.V]/Dest (0:586) cvn /DEST pdfmark end
 -2 4379 a 396 4469 a Fk(F)o(or)h(most)g(common)f(cases,)h
(use)1373 4469 y
SDict begin H.S end
 1373 4469 a 1373 4469 a
SDict begin 13 H.A end
 1373 4469 a
1373 4469 a
SDict begin [/View [/XYZ H.V]/Dest (0:587) cvn /DEST pdfmark end
 1373 4469 a 1373 4469 a
SDict begin H.S end
 1373 4469 a 1373
4469 a
SDict begin 13 H.A end
 1373 4469 a 1373 4469 a
SDict begin [/View [/XYZ H.V]/Dest (0:588) cvn /DEST pdfmark end
 1373 4469 a Fc(tcp)p Fk(,)g(which)f(is)j
(a)1906 4469 y
SDict begin H.S end
 1906 4469 a 1906 4469 a
SDict begin 13 H.A end
 1906 4469 a 1906
4469 a
SDict begin [/View [/XYZ H.V]/Dest (0:589) cvn /DEST pdfmark end
 1906 4469 a Ff(disconnected)c(TCP)j Fk(transport.)e(It)i(is)g
(elastic,)f(portable,)f(and)g(f)o(ast)396 4577 y(enough)f(for)i(most)g
(cases.)g(W)-7 b(e)22 b(call)e(this)h(')l(disconnected')c(because)j
(\330MQ')-5 b(s)2646 4577 y
SDict begin H.S end
 2646 4577 a 2646 4577 a
SDict begin 13 H.A end
 2646
4577 a 2646 4577 a
SDict begin [/View [/XYZ H.V]/Dest (0:590) cvn /DEST pdfmark end
 2646 4577 a Fe(tcp)20 b Fk(transport)f(doesn')o(t)g
(require)g(that)h(the)396 4684 y(endpoint)e(e)o(xists)i(before)f(you)g
(connect)f(to)i(it.)h(Clients)f(and)g(serv)o(ers)f(can)g(connect)g(and)
g(bind)g(at)i(an)o(y)e(time,)g(can)h(go)f(and)396 4792
y(come)h(back,)f(and)h(it)h(remains)e(transparent)g(to)h(applications.)
-2 4976 y
SDict begin H.S end
 -2 4976 a -2 4976 a
SDict begin 13 H.A end
 -2 4976 a -2 4976 a
SDict begin [/View [/XYZ H.V]/Dest (0:591) cvn /DEST pdfmark end
 -2
4976 a 396 5066 a Fk(The)g(inter)n(-process)f(transport,)1331
5066 y
SDict begin H.S end
 1331 5066 a 1331 5066 a
SDict begin 13 H.A end
 1331 5066 a 1331 5066
a
SDict begin [/View [/XYZ H.V]/Dest (0:592) cvn /DEST pdfmark end
 1331 5066 a 1331 5066 a
SDict begin H.S end
 1331 5066 a 1331 5066 a
SDict begin 13 H.A end
 1331
5066 a 1331 5066 a
SDict begin [/View [/XYZ H.V]/Dest (0:593) cvn /DEST pdfmark end
 1331 5066 a Fc(ipc)p Fk(,)h(is)h(lik)o(e)1727
5066 y
SDict begin H.S end
 1727 5066 a 1727 5066 a
SDict begin 13 H.A end
 1727 5066 a 1727 5066
a
SDict begin [/View [/XYZ H.V]/Dest (0:594) cvn /DEST pdfmark end
 1727 5066 a Fe(tcp)g Fk(e)o(xcept)e(that)h(it)h(is)g(abstracted)e
(from)h(the)g(LAN,)g(so)g(you)g(don')o(t)e(need)p Black
3797 5569 a Ff(37)p Black eop end
%%Page: 38 51
TeXDict begin 38 50 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.38) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:625) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(to)i(specify)e(IP)i(addresses)f(or)f(domain)g(names.)
h(This)g(mak)o(es)g(it)h(better)f(for)g(some)g(purposes,)e(and)i(we)g
(use)h(it)g(quite)396 180 y(often)f(in)g(the)g(e)o(xamples)f(in)i(this)
f(book.)f(\330MQ')-5 b(s)1832 180 y
SDict begin H.S end
 1832 180 a 1832 180
a
SDict begin 13 H.A end
 1832 180 a 1832 180 a
SDict begin [/View [/XYZ H.V]/Dest (0:595) cvn /DEST pdfmark end
 1832 180 a Fe(ipc)20 b Fk(transport)f(is)i
(disconnected,)d(lik)o(e)2998 180 y
SDict begin H.S end
 2998 180 a 2998 180
a
SDict begin 13 H.A end
 2998 180 a 2998 180 a
SDict begin [/View [/XYZ H.V]/Dest (0:596) cvn /DEST pdfmark end
 2998 180 a Fe(tcp)p Fk(.)i(It)h(has)f(one)g
(limitation:)396 288 y(it)h(does)f(not)g(w)o(ork)g(on)f(W)m(indo)n(ws.)
h(This)g(may)g(be)g(\002x)o(ed)f(in)i(future)e(v)o(ersions)g(of)h
(\330MQ.)g(By)h(con)m(v)o(ention)c(we)j(use)396 396 y(endpoint)f(names)
g(with)i(an)f(".ipc")g(e)o(xtension)e(to)j(a)n(v)n(oid)f(potential)f
(con\003ict)h(with)g(other)g(\002le)g(names.)g(On)g(UNIX)396
504 y(systems,)h(if)f(you)f(use)1049 504 y
SDict begin H.S end
 1049 504 a
1049 504 a
SDict begin 13 H.A end
 1049 504 a 1049 504 a
SDict begin [/View [/XYZ H.V]/Dest (0:597) cvn /DEST pdfmark end
 1049 504 a Fe(ipc)h
Fk(endpoints)f(you)g(need)h(to)g(create)g(these)g(with)h(appropriate)c
(permissions)j(otherwise)f(the)o(y)396 612 y(may)h(not)g(be)g
(shareable)f(between)h(processes)f(running)g(under)f(dif)n(ferent)h
(user)h(ids.)g(Y)-9 b(ou)20 b(must)g(also)h(mak)o(e)e(sure)h(all)396
720 y(processes)g(can)g(access)h(the)f(\002les,)h(e.g.)f(by)f(running)f
(in)j(the)f(same)g(w)o(orking)f(directory)-5 b(.)-2 904
y
SDict begin H.S end
 -2 904 a -2 904 a
SDict begin 13 H.A end
 -2 904 a -2 904 a
SDict begin [/View [/XYZ H.V]/Dest (0:598) cvn /DEST pdfmark end
 -2 904 a 396 994
a Fk(The)20 b(inter)n(-thread)f(transport,)1289 994 y
SDict begin H.S end

1289 994 a 1289 994 a
SDict begin 13 H.A end
 1289 994 a 1289 994 a
SDict begin [/View [/XYZ H.V]/Dest (0:599) cvn /DEST pdfmark end
 1289 994
a 1289 994 a
SDict begin H.S end
 1289 994 a 1289 994 a
SDict begin 13 H.A end
 1289 994 a 1289 994
a
SDict begin [/View [/XYZ H.V]/Dest (0:600) cvn /DEST pdfmark end
 1289 994 a Fc(inproc)p Fk(,)h(is)h(a)f(connected)f(signaling)g
(transport.)g(It)h(is)h(much)e(f)o(aster)i(than)3473
994 y
SDict begin H.S end
 3473 994 a 3473 994 a
SDict begin 13 H.A end
 3473 994 a 3473 994 a
SDict begin [/View [/XYZ H.V]/Dest (0:601) cvn /DEST pdfmark end
 3473
994 a Fe(tcp)g Fk(or)3719 994 y
SDict begin H.S end
 3719 994 a 3719 994 a
SDict begin 13 H.A end

3719 994 a 3719 994 a
SDict begin [/View [/XYZ H.V]/Dest (0:602) cvn /DEST pdfmark end
 3719 994 a Fe(ipc)p Fk(.)396 1102
y(This)g(transport)e(has)h(a)h(speci\002c)f(limitation)g(compared)e(to)
2121 1102 y
SDict begin H.S end
 2121 1102 a 2121 1102 a
SDict begin 13 H.A end
 2121 1102 a 2121
1102 a
SDict begin [/View [/XYZ H.V]/Dest (0:603) cvn /DEST pdfmark end
 2121 1102 a Fe(ipc)i Fk(and)2417 1102 y
SDict begin H.S end
 2417 1102
a 2417 1102 a
SDict begin 13 H.A end
 2417 1102 a 2417 1102 a
SDict begin [/View [/XYZ H.V]/Dest (0:604) cvn /DEST pdfmark end
 2417 1102 a Fe(tcp)p
Fk(:)2595 1102 y
SDict begin H.S end
 2595 1102 a 2595 1102 a
SDict begin 13 H.A end
 2595 1102 a
2595 1102 a
SDict begin [/View [/XYZ H.V]/Dest (0:605) cvn /DEST pdfmark end
 2595 1102 a Fg(y)n(ou)g(must)h(do)g(bind)g(bef)n(or)o(e)e
(connect)p Fk(.)396 1210 y(This)i(is)g(something)d(future)h(v)o
(ersions)h(of)g(\330MQ)g(may)g(\002x,)g(b)n(ut)g(at)h(present)e(this)i
(de\002nes)f(you)f(use)3260 1210 y
SDict begin H.S end
 3260 1210 a 3260 1210
a
SDict begin 13 H.A end
 3260 1210 a 3260 1210 a
SDict begin [/View [/XYZ H.V]/Dest (0:606) cvn /DEST pdfmark end
 3260 1210 a Fe(inproc)g Fk(sock)o(ets.)396
1318 y(W)-7 b(e)22 b(create)e(and)f(bind)h(one)f(sock)o(et,)h(start)h
(the)f(child)g(threads,)f(which)h(create)g(and)f(connect)g(the)h(other)
g(sock)o(ets.)-2 1340 y
SDict begin H.S end
 -2 1340 a -2 1340 a
SDict begin 13 H.A end
 -2 1340 a
-2 1340 a
SDict begin [/View [/XYZ H.V]/Dest (0:607) cvn /DEST pdfmark end
 -2 1340 a 365 x Fn(2.6.)39 b(\330MQ)g(is)g(Not)g(a)h(Neutral)
e(Carrier)2224 1705 y
SDict begin H.S end
 2224 1705 a 2224 1705 a
SDict begin 22.464 H.A end
 2224 1705
a 2224 1705 a
SDict begin [/View [/XYZ H.V]/Dest (7.27.1) cvn /DEST pdfmark end
 2224 1705 a -2 1879 a
SDict begin H.S end
 -2 1879 a -2 1879
a
SDict begin 13 H.A end
 -2 1879 a -2 1879 a
SDict begin [/View [/XYZ H.V]/Dest (0:609) cvn /DEST pdfmark end
 -2 1879 a 396 1979 a Fk(A)21 b(common)d(question)
h(that)i(ne)n(wcomers)d(to)j(\330MQ)f(ask)h(\(it')-5
b(s)21 b(one)e(I)i(ask)o(ed)f(myself\))f(is)i(something)e(lik)o(e,)h
("ho)n(w)g(do)f(I)396 2087 y(write)i(a)f(XYZ)h(serv)o(er)e(in)h
(\330MQ?")g(F)o(or)g(e)o(xample,)f("ho)n(w)g(do)h(I)h(write)f(an)g
(HTTP)g(serv)o(er)g(in)g(\330MQ?")-2 2271 y
SDict begin H.S end
 -2 2271 a
-2 2271 a
SDict begin 13 H.A end
 -2 2271 a -2 2271 a
SDict begin [/View [/XYZ H.V]/Dest (0:610) cvn /DEST pdfmark end
 -2 2271 a 396 2361 a Fk(The)g
(implication)f(is)i(that)g(if)f(we)h(use)f(normal)f(sock)o(ets)h(to)h
(carry)e(HTTP)h(requests)g(and)g(responses,)f(we)i(should)e(be)396
2469 y(able)h(to)h(use)f(\330MQ)h(sock)o(ets)f(to)g(do)g(the)g(same,)g
(only)g(much)f(f)o(aster)h(and)g(better)-5 b(.)-2 2653
y
SDict begin H.S end
 -2 2653 a -2 2653 a
SDict begin 13 H.A end
 -2 2653 a -2 2653 a
SDict begin [/View [/XYZ H.V]/Dest (0:611) cvn /DEST pdfmark end
 -2 2653 a 396
2743 a Fk(Sadly)20 b(the)g(answer)g(is)h("this)g(is)g(not)f(ho)n(w)g
(it)g(w)o(orks".)g(\330MQ)g(is)i(not)d(a)i(neutral)e(carrier)m(,)g(it)i
(imposes)f(a)h(framing)d(on)i(the)396 2851 y(transport)e(protocols)g
(it)j(uses.)e(This)h(framing)e(is)i(not)f(compatible)f(with)i(e)o
(xisting)e(protocols,)g(which)h(tend)g(to)g(use)h(their)396
2959 y(o)n(wn)g(framing.)e(F)o(or)i(e)o(xample,)f(compare)f(an)i(HTTP)h
(request\()p 0 TeXcolorgray 2222 2959 a
SDict begin H.S end
 2222 2959 a Fk(Figure)d(2-3)
2570 2959 y
SDict begin 13 H.L end
 2570 2959 a 2570 2959 a
SDict begin [/Subtype /Link/Dest (0:figure-12) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2570 2959 a Black
-2 w Fk(\),)i(and)g(a)h(&Oslash;MQ)f(request,)f(both)396
3067 y(o)o(v)o(er)g(TCP/IP)-9 b(.)-2 3068 y
SDict begin H.S end
 -2 3068 a
-2 3068 a
SDict begin 13 H.A end
 -2 3068 a -2 3068 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-12) cvn /DEST pdfmark
end
 -2 3068 a 396 3268 a Fg(Figur)o(e)20
b(2-3.)f(HTTP)i(On)f(the)h(W)o(ir)o(e)-2 3368 y
SDict begin H.S end
 -2 3368
a -2 3368 a
SDict begin 13 H.A end
 -2 3368 a -2 3368 a
SDict begin [/View [/XYZ H.V]/Dest (0:615) cvn /DEST pdfmark end
 -2 3368 a 396 4051 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate

396 4051 a @beginspecial 0 @llx -77 @lly 294 @urx 0 @ury
2940 @rwi @setspecial
%%BeginDocument: images/fig12.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -77 294 0
%%HiResBoundingBox: 0.0 -77.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -29.100210189819336 moveto
19.100210189819336 -51.1002082824707 lineto
136.10020446777344 -51.1002082824707 lineto
136.10020446777344 -29.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
139.10020446777344 -29.100210189819336 moveto
139.10020446777344 -51.1002082824707 lineto
171.10020446777344 -51.1002082824707 lineto
171.10020446777344 -29.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
174.10020446777344 -29.100210189819336 moveto
174.10020446777344 -51.1002082824707 lineto
206.10020446777344 -51.1002082824707 lineto
206.10020446777344 -29.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
209.10020446777344 -29.100210189819336 moveto
209.10020446777344 -51.1002082824707 lineto
241.10020446777344 -51.1002082824707 lineto
241.10020446777344 -29.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
244.10020446777344 -29.100210189819336 moveto
244.10020446777344 -51.1002082824707 lineto
278.1002197265625 -51.1002082824707 lineto
278.1002197265625 -29.100210189819336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -27.0 moveto
17.0 -49.0 lineto
134.0 -49.0 lineto
134.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -27.0 moveto
17.0 -49.0 lineto
134.0 -49.0 lineto
134.0 -27.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
137.0 -27.0 moveto
137.0 -49.0 lineto
169.0 -49.0 lineto
169.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
137.0 -27.0 moveto
137.0 -49.0 lineto
169.0 -49.0 lineto
169.0 -27.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
172.0 -27.0 moveto
172.0 -49.0 lineto
204.0 -49.0 lineto
204.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
172.0 -27.0 moveto
172.0 -49.0 lineto
204.0 -49.0 lineto
204.0 -27.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -27.0 moveto
207.0 -49.0 lineto
239.0 -49.0 lineto
239.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -27.0 moveto
207.0 -49.0 lineto
239.0 -49.0 lineto
239.0 -27.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
242.0 -27.0 moveto
242.0 -49.0 lineto
276.0 -49.0 lineto
276.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
242.0 -27.0 moveto
242.0 -49.0 lineto
276.0 -49.0 lineto
276.0 -27.0 lineto
closepath
stroke
/Helvetica findfont
11 scalefont setfont
30.0 -43.0 moveto
(GET /index.html) show
148.0 -42.0 moveto
(13) show
183.0 -42.0 moveto
(10) show
218.0 -42.0 moveto
(13) show
253.0 -42.0 moveto
(10) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4051 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4051 a -2 4217 a
SDict begin H.S end
 -2 4217
a -2 4217 a
SDict begin 13 H.A end
 -2 4217 a -2 4217 a
SDict begin [/View [/XYZ H.V]/Dest (0:618) cvn /DEST pdfmark end
 -2 4217 a 396 4325 a
Fk(Where)f(the)g(HTTP)h(request)e(uses)i(CR-LF)g(as)g(its)g(simplest)f
(framing)f(delimiter)m(,)g(and)g(\330MQ)i(uses)f(a)h
(length-speci\002ed)396 4433 y(frame\()p 0 TeXcolorgray
619 4433 a
SDict begin H.S end
 619 4433 a Fk(Figure)d(2-4)967 4433 y
SDict begin 13 H.L end
 967
4433 a 967 4433 a
SDict begin [/Subtype /Link/Dest (0:figure-13) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 967 4433 a Black -1 w Fk(\).)-2 4451
y
SDict begin H.S end
 -2 4451 a -2 4451 a
SDict begin 13 H.A end
 -2 4451 a -2 4451 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-13) cvn /DEST pdfmark
end
 -2 4451 a Black
3800 5569 a Ff(38)p Black eop end
%%Page: 39 52
TeXDict begin 39 51 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.39) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-4.)f(\330MQ)h(On)h(the)f(W)o(ir)o(e)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:622) cvn /DEST pdfmark end
 -2 172 a 396
1031 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1031 a @beginspecial 0 @llx -98 @lly 290 @urx
0 @ury 2900 @rwi @setspecial
%%BeginDocument: images/fig13.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -98 290 0
%%HiResBoundingBox: 0.0 -98.0 290.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -66.00029754638672 lineto
66.00029754638672 -66.00029754638672 lineto
66.00029754638672 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
70.00029754638672 -38.000301361083984 moveto
70.00029754638672 -66.00029754638672 lineto
106.00029754638672 -66.00029754638672 lineto
106.00029754638672 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.00029754638672 -38.000301361083984 moveto
110.00029754638672 -66.00029754638672 lineto
146.00030517578125 -66.00029754638672 lineto
146.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
150.00030517578125 -38.000301361083984 moveto
150.00030517578125 -66.00029754638672 lineto
186.00030517578125 -66.00029754638672 lineto
186.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
190.00030517578125 -38.000301361083984 moveto
190.00030517578125 -66.00029754638672 lineto
226.00030517578125 -66.00029754638672 lineto
226.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
230.00030517578125 -38.000301361083984 moveto
230.00030517578125 -66.00029754638672 lineto
268.00030517578125 -66.00029754638672 lineto
268.00030517578125 -38.000301361083984 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -63.0 lineto
63.0 -63.0 lineto
63.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -63.0 lineto
63.0 -63.0 lineto
63.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
67.0 -35.0 moveto
67.0 -63.0 lineto
103.0 -63.0 lineto
103.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
67.0 -35.0 moveto
67.0 -63.0 lineto
103.0 -63.0 lineto
103.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
107.0 -35.0 moveto
107.0 -63.0 lineto
143.0 -63.0 lineto
143.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
107.0 -35.0 moveto
107.0 -63.0 lineto
143.0 -63.0 lineto
143.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
147.0 -35.0 moveto
147.0 -63.0 lineto
183.0 -63.0 lineto
183.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
147.0 -35.0 moveto
147.0 -63.0 lineto
183.0 -63.0 lineto
183.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
187.0 -35.0 moveto
187.0 -63.0 lineto
223.0 -63.0 lineto
223.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
187.0 -35.0 moveto
187.0 -63.0 lineto
223.0 -63.0 lineto
223.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
227.0 -35.0 moveto
227.0 -63.0 lineto
265.0 -63.0 lineto
265.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
227.0 -35.0 moveto
227.0 -63.0 lineto
265.0 -63.0 lineto
265.0 -35.0 lineto
closepath
stroke
/Helvetica findfont
15 scalefont setfont
43.0 -54.0 moveto
(5 ) show
82.0 -54.0 moveto
(H ) show
123.0 -54.0 moveto
(E ) show
163.0 -54.0 moveto
(L ) show
203.0 -54.0 moveto
(L ) show
241.0 -54.0 moveto
(O ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1031 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1031 a 274 x Fk(So)h(you)e(could)g(write)i
(a)f(HTTP-lik)o(e)g(protocol)e(using)i(\330MQ,)g(using)g(for)f(e)o
(xample)g(the)h(request-reply)e(sock)o(et)396 1412 y(pattern.)h(But)i
(it)g(w)o(ould)e(not)h(be)g(HTTP)-9 b(.)-2 1596 y
SDict begin H.S end
 -2
1596 a -2 1596 a
SDict begin 13 H.A end
 -2 1596 a -2 1596 a
SDict begin [/View [/XYZ H.V]/Dest (0:626) cvn /DEST pdfmark end
 -2 1596 a 396 1686
a Fk(There)20 b(is)h(ho)n(we)n(v)o(er)d(a)j(good)d(answer)i(to)h(the)f
(question,)f("Ho)n(w)h(can)g(I)g(mak)o(e)g(pro\002table)f(use)h(of)g
(\330MQ)h(when)e(making)396 1794 y(my)h(ne)n(w)g(XYZ)g(serv)o(er?")g(Y)
-9 b(ou)19 b(need)h(to)g(implement)f(whate)n(v)o(er)g(protocol)f(you)h
(w)o(ant)i(to)f(speak)g(in)g(an)o(y)g(case,)g(b)n(ut)g(you)396
1902 y(can)g(connect)f(that)h(protocol)f(serv)o(er)g(\(which)h(can)g
(be)g(e)o(xtremely)e(thin\))i(to)g(a)h(\330MQ)f(back)o(end)f(that)h
(does)g(the)g(real)396 2010 y(w)o(ork.)g(The)f(beautiful)g(part)h(here)
g(is)h(that)f(you)f(can)h(then)g(e)o(xtend)f(your)g(back)o(end)g(with)h
(code)f(in)i(an)o(y)e(language,)396 2118 y(running)f(locally)h(or)h
(remotely)-5 b(,)18 b(as)i(you)f(wish.)h(Zed)f(Sha)o(w')-5
b(s)2182 2118 y
SDict begin H.S end
 2182 2118 a 2182 2118 a
SDict begin 13 H.A end
 2182 2118 a 2182
2118 a
SDict begin [/View [/XYZ H.V]/Dest (0:627) cvn /DEST pdfmark end
 2182 2118 a Fk(Mongrel2)18 b(\(http://www)-5 b(.mongrel2.or)o(g)
o(\))14 b(web)20 b(serv)o(er)f(is)396 2226 y(a)i(great)f(e)o(xample)e
(of)i(such)g(an)g(architecture.)-2 2254 y
SDict begin H.S end
 -2 2254 a -2
2254 a
SDict begin 13 H.A end
 -2 2254 a -2 2254 a
SDict begin [/View [/XYZ H.V]/Dest (0:628) cvn /DEST pdfmark end
 -2 2254 a 360 x Fn(2.7.)39
b(I/O)g(Threads)1068 2614 y
SDict begin H.S end
 1068 2614 a 1068 2614 a
SDict begin 22.464 H.A end
 1068
2614 a 1068 2614 a
SDict begin [/View [/XYZ H.V]/Dest (7.28.1) cvn /DEST pdfmark end
 1068 2614 a -2 2781 a
SDict begin H.S end
 -2 2781 a -2
2781 a
SDict begin 13 H.A end
 -2 2781 a -2 2781 a
SDict begin [/View [/XYZ H.V]/Dest (0:630) cvn /DEST pdfmark end
 -2 2781 a 396 2888 a Fk(W)-7
b(e)22 b(said)e(that)g(\330MQ)h(does)f(I/O)g(in)h(a)f(background)d
(thread.)i(One)h(I/O)g(thread)g(\(for)f(all)i(sock)o(ets\))f(is)h(suf)n
(\002cient)e(for)h(all)396 2995 y(b)n(ut)g(the)h(most)f(e)o(xtreme)f
(applications.)g(When)h(you)f(create)h(a)g(ne)n(w)g(conte)o(xt)f(it)i
(starts)g(with)g(one)e(I/O)i(thread.)e(The)396 3103 y(general)g(rule)h
(of)g(thumb)f(is)i(to)g(allo)n(w)f(one)f(I/O)i(thread)e(per)h(gigabyte)
e(of)i(data)g(in)g(or)g(out)g(per)g(second.)f(T)-7 b(o)20
b(raise)h(the)396 3211 y(number)e(of)h(I/O)g(threads,)f(use)i(the)f
(zmq_ctx_set[3])d(call)2105 3211 y
SDict begin H.S end
 2105 3211 a 2105 3211
a
SDict begin 13 H.A end
 2105 3211 a 2105 3211 a
SDict begin [/View [/XYZ H.V]/Dest (0:631) cvn /DEST pdfmark end
 2105 3211 a Ff(befor)m(e)j
Fk(creating)f(an)o(y)g(sock)o(ets:)-2 3312 y
SDict begin H.S end
 -2 3312
a -2 3312 a
SDict begin 11.7 H.A end
 -2 3312 a -2 3312 a
SDict begin [/View [/XYZ H.V]/Dest (0:632) cvn /DEST pdfmark end
 -2 3312 a 396 3391 a
Fe(int)45 b(io_threads)e(=)h(4;)396 3489 y(void)620 3502
y(*)665 3489 y(context)g(=)h(zmq_ctx_new)e(\(\);)396
3586 y(zmq_ctx_set)g(\(context,)h(ZMQ_IO_THREADS,)e(io_threads\);)396
3683 y(assert)i(\(zmq_ctx_get)f(\(context,)g(ZMQ_IO_THREADS\))g(==)h
(io_threads\);)-2 3860 y
SDict begin H.S end
 -2 3860 a -2 3860 a
SDict begin 13 H.A end
 -2 3860
a -2 3860 a
SDict begin [/View [/XYZ H.V]/Dest (0:633) cvn /DEST pdfmark end
 -2 3860 a 396 3957 a Fk(There)20 b(is)h(a)f(major)g(dif)n
(ference)e(between)h(a)i(\330MQ)f(application)f(and)h(a)g(con)m(v)o
(entional)d(netw)o(ork)o(ed)i(application,)396 4065 y(which)h(is)h
(that)f(you)g(don')o(t)e(create)i(one)g(sock)o(et)g(per)g(connection.)d
(One)j(sock)o(et)g(handles)g(all)h(incoming)d(and)i(outgoing)396
4173 y(connections)f(for)g(a)i(particular)e(point)g(of)h(w)o(ork.)f
(E.g.)h(when)f(you)h(publish)f(to)h(a)h(thousand)d(subscribers,)h(it')
-5 b(s)22 b(via)e(one)396 4281 y(sock)o(et.)g(When)g(you)f(distrib)n
(ute)h(w)o(ork)g(among)e(twenty)i(services,)g(it')-5
b(s)21 b(via)g(one)e(sock)o(et.)h(When)g(you)f(collect)h(data)396
4389 y(from)f(a)i(thousand)e(web)h(applications,)e(it')-5
b(s)22 b(via)e(one)g(sock)o(et.)-2 4573 y
SDict begin H.S end
 -2 4573 a -2
4573 a
SDict begin 13 H.A end
 -2 4573 a -2 4573 a
SDict begin [/View [/XYZ H.V]/Dest (0:634) cvn /DEST pdfmark end
 -2 4573 a 396 4663 a Fk(This)h(has)f(a)h
(fundamental)c(impact)j(on)g(ho)n(w)g(you)f(write)h(applications.)f(A)i
(traditional)e(netw)o(ork)o(ed)f(application)h(has)396
4770 y(one)h(process)g(or)g(one)f(thread)g(per)h(remote)f(connection,)f
(and)i(that)g(process)g(or)g(thread)f(handles)g(one)h(sock)o(et.)g
(\330MQ)396 4878 y(lets)h(you)f(collapse)f(this)i(entire)f(structure)f
(into)h(a)h(single)f(thread,)f(and)g(then)h(break)f(it)i(up)f(as)h
(necessary)e(for)h(scaling.)-2 4907 y
SDict begin H.S end
 -2 4907 a -2 4907
a
SDict begin 13 H.A end
 -2 4907 a -2 4907 a
SDict begin [/View [/XYZ H.V]/Dest (0:635) cvn /DEST pdfmark end
 -2 4907 a Black 3800 5569 a Ff(39)p
Black eop end
%%Page: 40 53
TeXDict begin 40 52 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.40) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:657) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 94 a Fn(2.8.)39 b(Limiting)f(Soc)m(ket)g(Use)1646
94 y
SDict begin H.S end
 1646 94 a 1646 94 a
SDict begin 22.464 H.A end
 1646 94 a 1646 94 a
SDict begin [/View [/XYZ H.V]/Dest (7.29.1) cvn /DEST pdfmark end
 1646 94
a -2 292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:637) cvn /DEST pdfmark end
 -2 292
a 396 368 a Fk(By)21 b(def)o(ault,)e(a)i(\330MQ)f(sock)o(et)g(will)h
(continue)e(to)h(accept)g(connections)e(until)i(your)f(operating)g
(system)h(runs)g(out)g(of)396 476 y(\002le)h(handles.)e(This)i(isn')o
(t)e(al)o(w)o(ays)i(the)f(best)h(polic)o(y)e(for)g(public-f)o(acing)f
(services)i(as)h(it)g(lea)n(v)o(es)f(you)g(open)f(to)h(a)h(simple)396
584 y(denial-of-service)c(attack.)j(Y)-9 b(ou)20 b(can)g(set)h(a)f
(limit)h(using)f(another)e(zmq_ctx_set[3])g(call:)-2
685 y
SDict begin H.S end
 -2 685 a -2 685 a
SDict begin 11.7 H.A end
 -2 685 a -2 685 a
SDict begin [/View [/XYZ H.V]/Dest (0:638) cvn /DEST pdfmark end
 -2 685 a 396
764 a Fe(int)45 b(max_sockets)e(=)h(1024;)396 861 y(void)620
874 y(*)665 861 y(context)g(=)h(zmq_ctx_new)e(\(\);)396
958 y(zmq_ctx_get)g(\(context,)h(ZMQ_MAX_SOCKETS,)e(max_sockets\);)396
1056 y(assert)i(\(zmq_ctx_get)f(\(context,)g(ZMQ_MAX_SOCKETS\))f(==)j
(max_sockets\);)-2 1150 y
SDict begin H.S end
 -2 1150 a -2 1150 a
SDict begin 13 H.A end
 -2 1150
a -2 1150 a
SDict begin [/View [/XYZ H.V]/Dest (0:639) cvn /DEST pdfmark end
 -2 1150 a 366 x Fn(2.9.)39 b(Core)g(Messa)o(ging)d(P)l
(atterns)1995 1516 y
SDict begin H.S end
 1995 1516 a 1995 1516 a
SDict begin 22.464 H.A end
 1995 1516
a 1995 1516 a
SDict begin [/View [/XYZ H.V]/Dest (7.30.1) cvn /DEST pdfmark end
 1995 1516 a -2 1714 a
SDict begin H.S end
 -2 1714 a -2 1714
a
SDict begin 13 H.A end
 -2 1714 a -2 1714 a
SDict begin [/View [/XYZ H.V]/Dest (0:641) cvn /DEST pdfmark end
 -2 1714 a 396 1790 a Fk(Underneath)18
b(the)j(bro)n(wn)d(paper)h(wrapping)g(of)h(\330MQ')-5
b(s)21 b(sock)o(et)f(API)g(lies)h(the)f(w)o(orld)g(of)g(messaging)f
(patterns.)h(If)g(you)396 1898 y(ha)n(v)o(e)g(a)g(background)d(in)k
(enterprise)e(messaging,)g(or)h(kno)n(w)f(UDP)i(well,)f(these)g(will)h
(be)f(v)n(aguely)f(f)o(amiliar)-5 b(.)20 b(But)h(to)396
2005 y(most)f(\330MQ)h(ne)n(wcomers)e(the)o(y)g(are)h(a)h(surprise,)e
(we')l(re)h(so)g(used)g(to)h(the)f(TCP)h(paradigm)d(where)i(a)g(sock)o
(et)g(maps)396 2113 y(one-to-one)e(to)i(another)f(node.)-2
2280 y
SDict begin H.S end
 -2 2280 a -2 2280 a
SDict begin 13 H.A end
 -2 2280 a -2 2280 a
SDict begin [/View [/XYZ H.V]/Dest (0:642) cvn /DEST pdfmark end
 -2 2280
a 396 2387 a Fk(Let')-5 b(s)21 b(recap)f(brie\003y)f(what)h(\330MQ)h
(does)f(for)f(you.)g(It)i(deli)n(v)o(ers)e(blobs)h(of)g(data)g
(\(messages\))f(to)i(nodes,)e(quickly)g(and)396 2495
y(ef)n(\002ciently)-5 b(.)19 b(Y)-9 b(ou)20 b(can)g(map)f(nodes)h(to)g
(threads,)f(processes,)h(or)g(box)o(es.)f(It)h(gi)n(v)o(es)g(your)f
(applications)g(a)i(single)f(sock)o(et)396 2603 y(API)h(to)f(w)o(ork)g
(with,)g(no)g(matter)f(what)i(the)f(actual)g(transport)f(\(lik)o(e)h
(in-process,)f(inter)n(-process,)f(TCP)-9 b(,)21 b(or)f(multicast\).)
396 2711 y(It)h(automatically)d(reconnects)h(to)i(peers)e(as)i(the)o(y)
f(come)f(and)h(go.)g(It)g(queues)f(messages)i(at)f(both)g(sender)f(and)
h(recei)n(v)o(er)m(,)396 2819 y(as)h(needed.)e(It)h(manages)g(these)g
(queues)f(carefully)g(to)h(ensure)g(processes)g(don')o(t)e(run)i(out)f
(of)h(memory)-5 b(,)18 b(o)o(v)o(er\003o)n(wing)396 2927
y(to)j(disk)f(when)f(appropriate.)f(It)i(handles)g(sock)o(et)g(errors.)
f(It)h(does)g(all)h(I/O)g(in)f(background)d(threads.)i(It)h(uses)h
(lock-free)396 3035 y(techniques)e(for)h(talking)f(between)g(nodes,)h
(so)g(there)g(are)g(ne)n(v)o(er)f(locks,)h(w)o(aits,)h(semaphores,)d
(or)i(deadlocks.)-2 3219 y
SDict begin H.S end
 -2 3219 a -2 3219 a
SDict begin 13 H.A end
 -2 3219
a -2 3219 a
SDict begin [/View [/XYZ H.V]/Dest (0:643) cvn /DEST pdfmark end
 -2 3219 a 396 3309 a Fk(But)h(cutting)e(through)f(that,)i
(it)h(routes)f(and)g(queues)f(messages)h(according)e(to)j(precise)f
(recipes)f(called)3414 3309 y
SDict begin H.S end
 3414 3309 a 3414 3309 a
SDict begin 13 H.A end

3414 3309 a 3414 3309 a
SDict begin [/View [/XYZ H.V]/Dest (0:644) cvn /DEST pdfmark end
 3414 3309 a Ff(patterns)p Fk(.)h(It)h(is)396
3417 y(these)g(patterns)e(that)i(pro)o(vide)d(\330MQ')-5
b(s)20 b(intelligence.)f(The)o(y)g(encapsulate)h(our)f(hard-earned)e(e)
o(xperience)h(of)i(the)g(best)396 3525 y(w)o(ays)h(to)f(distrib)n(ute)g
(data)g(and)g(w)o(ork.)f(\330MQ')-5 b(s)21 b(patterns)e(are)h
(hard-coded)e(b)n(ut)i(future)f(v)o(ersions)g(may)h(allo)n(w)396
3633 y(user)n(-de\002nable)f(patterns.)-2 3817 y
SDict begin H.S end
 -2 3817
a -2 3817 a
SDict begin 13 H.A end
 -2 3817 a -2 3817 a
SDict begin [/View [/XYZ H.V]/Dest (0:645) cvn /DEST pdfmark end
 -2 3817 a 396 3907 a
Fk(\330MQ)i(patterns)e(are)h(implemented)f(by)g(pairs)i(of)f(sock)o
(ets)g(with)g(matching)f(types.)h(In)g(other)f(w)o(ords,)h(to)g
(understand)396 4015 y(\330MQ)h(patterns)e(you)h(need)f(to)h
(understand)e(sock)o(et)j(types)f(and)f(ho)n(w)h(the)o(y)f(w)o(ork)h
(together)-5 b(.)19 b(Mostly)h(this)h(just)f(tak)o(es)396
4123 y(learning,)f(there)h(is)h(little)g(that)f(is)h(ob)o(vious)e(at)h
(this)h(le)n(v)o(el.)-2 4307 y
SDict begin H.S end
 -2 4307 a -2 4307 a
SDict begin 13 H.A end
 -2
4307 a -2 4307 a
SDict begin [/View [/XYZ H.V]/Dest (0:646) cvn /DEST pdfmark end
 -2 4307 a 396 4397 a Fk(The)f(b)n(uilt-in)g(core)f
(\330MQ)i(patterns)e(are:)-2 4414 y
SDict begin H.S end
 -2 4414 a -2 4414
a
SDict begin 13 H.A end
 -2 4414 a -2 4414 a
SDict begin [/View [/XYZ H.V]/Dest (0:647) cvn /DEST pdfmark end
 -2 4414 a -2 4424 a
SDict begin H.S end
 -2 4424 a -2
4424 a
SDict begin 13 H.A end
 -2 4424 a -2 4424 a
SDict begin [/View [/XYZ H.V]/Dest (0:648) cvn /DEST pdfmark end
 -2 4424 a Black 396 4567 a
Fj(\225)p Black 479 4567 a
SDict begin H.S end
 479 4567 a 479 4567 a
SDict begin 13 H.A end
 479
4567 a 479 4567 a
SDict begin [/View [/XYZ H.V]/Dest (0:649) cvn /DEST pdfmark end
 479 4567 a 479 4567 a
SDict begin H.S end
 479 4567 a 479
4567 a
SDict begin 13 H.A end
 479 4567 a 479 4567 a
SDict begin [/View [/XYZ H.V]/Dest (0:650) cvn /DEST pdfmark end
 479 4567 a Fg(Request-r)o(eply)p
Fk(,)g(which)h(connects)f(a)i(set)g(of)f(clients)g(to)h(a)f(set)h(of)f
(services.)g(This)g(is)i(a)e(remote)f(procedure)f(call)j(and)479
4675 y(task)g(distrib)n(ution)e(pattern.)-2 4693 y
SDict begin H.S end
 -2
4693 a -2 4693 a
SDict begin 13 H.A end
 -2 4693 a -2 4693 a
SDict begin [/View [/XYZ H.V]/Dest (0:651) cvn /DEST pdfmark end
 -2 4693 a Black
396 4824 a Fj(\225)p Black 479 4824 a
SDict begin H.S end
 479 4824 a 479
4824 a
SDict begin 13 H.A end
 479 4824 a 479 4824 a
SDict begin [/View [/XYZ H.V]/Dest (0:652) cvn /DEST pdfmark end
 479 4824 a 479 4824 a
SDict begin H.S end
 479
4824 a 479 4824 a
SDict begin 13 H.A end
 479 4824 a 479 4824 a
SDict begin [/View [/XYZ H.V]/Dest (0:653) cvn /DEST pdfmark end
 479 4824 a Fg
(Publish-subscribe)p Fk(,)j(which)d(connects)h(a)g(set)h(of)f
(publishers)f(to)i(a)f(set)h(of)f(subscribers.)f(This)i(is)g(a)f(data)
479 4932 y(distrib)n(ution)f(pattern.)-2 4950 y
SDict begin H.S end
 -2 4950
a -2 4950 a
SDict begin 13 H.A end
 -2 4950 a -2 4950 a
SDict begin [/View [/XYZ H.V]/Dest (0:654) cvn /DEST pdfmark end
 -2 4950 a Black 3800
5569 a Ff(40)p Black eop end
%%Page: 41 54
TeXDict begin 41 53 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.41) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:655) cvn /DEST pdfmark end
 479 72 a 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:656) cvn /DEST pdfmark end
 479 72 a Fg(Pipeline)p Fk(,)i(connects)e
(nodes)g(in)i(a)f(f)o(an-out)f(/)i(f)o(an-in)e(pattern)g(that)i(can)f
(ha)n(v)o(e)f(multiple)h(steps,)g(and)g(loops.)f(This)i(is)g(a)479
180 y(parallel)f(task)h(distrib)n(ution)e(and)g(collection)g(pattern.)
396 454 y(W)-7 b(e)22 b(look)o(ed)d(at)h(each)g(of)g(these)g(in)h(the)f
(\002rst)h(chapter)-5 b(.)19 b(There')-5 b(s)20 b(one)f(more)h(pattern)
f(that)h(people)g(tend)f(to)i(try)f(to)g(use)396 562
y(when)g(the)o(y)f(still)j(think)d(of)h(\330MQ)g(in)h(terms)f(of)g
(traditional)f(TCP)i(sock)o(ets:)-2 580 y
SDict begin H.S end
 -2 580 a -2
580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:658) cvn /DEST pdfmark end
 -2 580 a -2 590 a
SDict begin H.S end
 -2 590 a -2
590 a
SDict begin 13 H.A end
 -2 590 a -2 590 a
SDict begin [/View [/XYZ H.V]/Dest (0:659) cvn /DEST pdfmark end
 -2 590 a Black 396 733 a Fj(\225)p
Black 479 733 a
SDict begin H.S end
 479 733 a 479 733 a
SDict begin 13 H.A end
 479 733 a 479 733
a
SDict begin [/View [/XYZ H.V]/Dest (0:660) cvn /DEST pdfmark end
 479 733 a 479 733 a
SDict begin H.S end
 479 733 a 479 733 a
SDict begin 13 H.A end
 479 733 a 479
733 a
SDict begin [/View [/XYZ H.V]/Dest (0:661) cvn /DEST pdfmark end
 479 733 a Fg(Exclusi)o(v)o(e)g(pair)p Fk(,)f(which)g(connects)f
(tw)o(o)i(sock)o(ets)f(in)g(an)g(e)o(xclusi)n(v)o(e)f(pair)-5
b(.)20 b(This)h(is)g(a)f(pattern)g(you)f(should)g(use)i(only)479
840 y(to)g(connect)e(tw)o(o)h(threads)g(in)g(a)h(process.)e(W)-7
b(e')o(ll)21 b(see)g(an)f(e)o(xample)f(at)i(the)f(end)g(of)f(this)i
(chapter)-5 b(.)-2 1024 y
SDict begin H.S end
 -2 1024 a -2 1024 a
SDict begin 13 H.A end
 -2 1024
a -2 1024 a
SDict begin [/View [/XYZ H.V]/Dest (0:662) cvn /DEST pdfmark end
 -2 1024 a 396 1114 a Fk(The)20 b(zmq_sock)o(et[3])d(man)j
(page)g(is)h(f)o(airly)f(clear)g(about)f(the)h(patterns,)f(it')-5
b(s)22 b(w)o(orth)d(reading)g(se)n(v)o(eral)h(times)g(until)g(it)396
1222 y(starts)h(to)g(mak)o(e)e(sense.)i(These)f(are)g(the)g(sock)o(et)g
(combinations)e(that)j(are)f(v)n(alid)f(for)h(a)h(connect-bind)c(pair)j
(\(either)f(side)396 1330 y(can)h(bind\):)-2 1345 y
SDict begin H.S end
 -2
1345 a -2 1345 a
SDict begin 13 H.A end
 -2 1345 a -2 1345 a
SDict begin [/View [/XYZ H.V]/Dest (0:663) cvn /DEST pdfmark end
 -2 1345 a -2 1355
a
SDict begin H.S end
 -2 1355 a -2 1355 a
SDict begin 13 H.A end
 -2 1355 a -2 1355 a
SDict begin [/View [/XYZ H.V]/Dest (0:664) cvn /DEST pdfmark end
 -2 1355 a Black
396 1500 a Fj(\225)p Black 479 1500 a
SDict begin H.S end
 479 1500 a 479
1500 a
SDict begin 13 H.A end
 479 1500 a 479 1500 a
SDict begin [/View [/XYZ H.V]/Dest (0:665) cvn /DEST pdfmark end
 479 1500 a Fk(PUB)i(and)d(SUB)-2
1501 y
SDict begin H.S end
 -2 1501 a -2 1501 a
SDict begin 13 H.A end
 -2 1501 a -2 1501 a
SDict begin [/View [/XYZ H.V]/Dest (0:666) cvn /DEST pdfmark end
 -2 1501
a Black 396 1650 a Fj(\225)p Black 479 1650 a
SDict begin H.S end
 479 1650
a 479 1650 a
SDict begin 13 H.A end
 479 1650 a 479 1650 a
SDict begin [/View [/XYZ H.V]/Dest (0:667) cvn /DEST pdfmark end
 479 1650 a Fk(REQ)i(and)f(REP)-2
1665 y
SDict begin H.S end
 -2 1665 a -2 1665 a
SDict begin 13 H.A end
 -2 1665 a -2 1665 a
SDict begin [/View [/XYZ H.V]/Dest (0:668) cvn /DEST pdfmark end
 -2 1665
a Black 396 1799 a Fj(\225)p Black 479 1799 a
SDict begin H.S end
 479 1799
a 479 1799 a
SDict begin 13 H.A end
 479 1799 a 479 1799 a
SDict begin [/View [/XYZ H.V]/Dest (0:669) cvn /DEST pdfmark end
 479 1799 a Fk(REQ)h(and)f(R)m(OUTER)
-2 1814 y
SDict begin H.S end
 -2 1814 a -2 1814 a
SDict begin 13 H.A end
 -2 1814 a -2 1814 a
SDict begin [/View [/XYZ H.V]/Dest (0:670) cvn /DEST pdfmark end
 -2
1814 a Black 396 1949 a Fj(\225)p Black 479 1949 a
SDict begin H.S end
 479
1949 a 479 1949 a
SDict begin 13 H.A end
 479 1949 a 479 1949 a
SDict begin [/View [/XYZ H.V]/Dest (0:671) cvn /DEST pdfmark end
 479 1949 a Fk(DEALER)g(and)g
(REP)-2 1950 y
SDict begin H.S end
 -2 1950 a -2 1950 a
SDict begin 13 H.A end
 -2 1950 a -2 1950
a
SDict begin [/View [/XYZ H.V]/Dest (0:672) cvn /DEST pdfmark end
 -2 1950 a Black 396 2098 a Fj(\225)p Black 479 2098
a
SDict begin H.S end
 479 2098 a 479 2098 a
SDict begin 13 H.A end
 479 2098 a 479 2098 a
SDict begin [/View [/XYZ H.V]/Dest (0:673) cvn /DEST pdfmark end
 479 2098
a Fk(DEALER)g(and)g(R)m(OUTER)-2 2099 y
SDict begin H.S end
 -2 2099 a -2
2099 a
SDict begin 13 H.A end
 -2 2099 a -2 2099 a
SDict begin [/View [/XYZ H.V]/Dest (0:674) cvn /DEST pdfmark end
 -2 2099 a Black 396 2248 a
Fj(\225)p Black 479 2248 a
SDict begin H.S end
 479 2248 a 479 2248 a
SDict begin 13 H.A end
 479
2248 a 479 2248 a
SDict begin [/View [/XYZ H.V]/Dest (0:675) cvn /DEST pdfmark end
 479 2248 a Fk(DEALER)g(and)g(DEALER)-2
2249 y
SDict begin H.S end
 -2 2249 a -2 2249 a
SDict begin 13 H.A end
 -2 2249 a -2 2249 a
SDict begin [/View [/XYZ H.V]/Dest (0:676) cvn /DEST pdfmark end
 -2 2249
a Black 396 2397 a Fj(\225)p Black 479 2397 a
SDict begin H.S end
 479 2397
a 479 2397 a
SDict begin 13 H.A end
 479 2397 a 479 2397 a
SDict begin [/View [/XYZ H.V]/Dest (0:677) cvn /DEST pdfmark end
 479 2397 a Fk(R)m(OUTER)h(and)e(R)m
(OUTER)-2 2398 y
SDict begin H.S end
 -2 2398 a -2 2398 a
SDict begin 13 H.A end
 -2 2398 a -2 2398
a
SDict begin [/View [/XYZ H.V]/Dest (0:678) cvn /DEST pdfmark end
 -2 2398 a Black 396 2547 a Fj(\225)p Black 479 2547
a
SDict begin H.S end
 479 2547 a 479 2547 a
SDict begin 13 H.A end
 479 2547 a 479 2547 a
SDict begin [/View [/XYZ H.V]/Dest (0:679) cvn /DEST pdfmark end
 479 2547
a Fk(PUSH)i(and)f(PULL)-2 2548 y
SDict begin H.S end
 -2 2548 a -2 2548 a
SDict begin 13 H.A end

-2 2548 a -2 2548 a
SDict begin [/View [/XYZ H.V]/Dest (0:680) cvn /DEST pdfmark end
 -2 2548 a Black 396 2696 a Fj(\225)p
Black 479 2696 a
SDict begin H.S end
 479 2696 a 479 2696 a
SDict begin 13 H.A end
 479 2696 a 479
2696 a
SDict begin [/View [/XYZ H.V]/Dest (0:681) cvn /DEST pdfmark end
 479 2696 a Fk(P)-8 b(AIR)22 b(and)d(P)-8 b(AIR)-2
2863 y
SDict begin H.S end
 -2 2863 a -2 2863 a
SDict begin 13 H.A end
 -2 2863 a -2 2863 a
SDict begin [/View [/XYZ H.V]/Dest (0:682) cvn /DEST pdfmark end
 -2 2863
a 396 2970 a Fk(Y)f(ou')o(ll)20 b(also)g(see)h(references)e(to)h(XPUB)h
(and)f(XSUB)h(sock)o(ets,)f(which)g(we')o(ll)h(come)e(to)h(later)h
(\(the)o(y')l(re)d(lik)o(e)i(ra)o(w)396 3078 y(v)o(ersions)f(of)h(PUB)i
(and)d(SUB\).)i(An)o(y)e(other)h(combination)e(will)j(produce)d
(undocumented)e(and)k(unreliable)f(results)396 3186 y(and)h(future)f(v)
o(ersions)g(of)h(\330MQ)g(will)h(probably)d(return)h(errors)h(if)g(you)
f(try)h(them.)g(Y)-9 b(ou)20 b(can)g(and)f(will)i(of)f(course)396
3294 y(bridge)f(other)h(sock)o(et)g(types)1249 3294 y
SDict begin H.S end

1249 3294 a 1249 3294 a
SDict begin 13 H.A end
 1249 3294 a 1249 3294 a
SDict begin [/View [/XYZ H.V]/Dest (0:683) cvn /DEST pdfmark end
 1249
3294 a Ff(via)g(code)p Fk(,)f(i.e.)h(read)g(from)f(one)h(sock)o(et)g
(type)f(and)h(write)g(to)h(another)-5 b(.)-2 3322 y
SDict begin H.S end
 -2
3322 a -2 3322 a
SDict begin 13 H.A end
 -2 3322 a -2 3322 a
SDict begin [/View [/XYZ H.V]/Dest (0:684) cvn /DEST pdfmark end
 -2 3322 a 359 x
Fn(2.10.)39 b(High-le)n(vel)e(Messa)o(ging)g(P)l(atterns)2432
3681 y
SDict begin H.S end
 2432 3681 a 2432 3681 a
SDict begin 22.464 H.A end
 2432 3681 a 2432 3681
a
SDict begin [/View [/XYZ H.V]/Dest (7.31.1) cvn /DEST pdfmark end
 2432 3681 a -2 3879 a
SDict begin H.S end
 -2 3879 a -2 3879 a
SDict begin 13 H.A end
 -2 3879 a
-2 3879 a
SDict begin [/View [/XYZ H.V]/Dest (0:686) cvn /DEST pdfmark end
 -2 3879 a 396 3955 a Fk(These)20 b(four)f(core)h(patterns)f
(are)h(cook)o(ed-in)e(to)i(\330MQ.)g(The)o(y)f(are)i(part)e(of)h(the)g
(\330MQ)h(API,)f(implemented)e(in)i(the)g(core)396 4063
y(C++)h(library)-5 b(,)18 b(and)i(guaranteed)e(to)i(be)h(a)n(v)n
(ailable)e(in)i(all)f(\002ne)h(retail)f(stores.)-2 4247
y
SDict begin H.S end
 -2 4247 a -2 4247 a
SDict begin 13 H.A end
 -2 4247 a -2 4247 a
SDict begin [/View [/XYZ H.V]/Dest (0:687) cvn /DEST pdfmark end
 -2 4247 a 396
4337 a Fk(On)g(top,)g(we)h(add)924 4337 y
SDict begin H.S end
 924 4337 a
924 4337 a
SDict begin 13 H.A end
 924 4337 a 924 4337 a
SDict begin [/View [/XYZ H.V]/Dest (0:688) cvn /DEST pdfmark end
 924 4337 a Ff(high-le)o(vel)e
(patterns)p Fk(.)g(W)-7 b(e)22 b(b)n(uild)e(these)g(high-le)n(v)o(el)e
(patterns)i(on)f(top)h(of)g(\330MQ)h(and)e(implement)396
4445 y(them)h(in)g(whate)n(v)o(er)f(language)g(we')l(re)g(using)h(for)f
(our)h(application.)e(The)o(y)h(are)h(not)g(part)g(of)g(the)g(core)g
(library)-5 b(,)18 b(do)i(not)396 4553 y(come)g(with)g(the)g(\330MQ)h
(package,)d(and)i(e)o(xist)g(in)h(their)f(o)n(wn)f(space,)h(as)h(part)f
(of)g(the)g(\330MQ)g(community)-5 b(.)18 b(F)o(or)i(e)o(xample)396
4661 y(the)g(Majordomo)e(pattern,)h(which)h(we)h(e)o(xplore)d(in)i
(Chapter)g(F)o(our)m(,)f(sits)i(in)g(the)f(github)f(Majordomo)f
(project)h(in)h(the)396 4769 y(ZeroMQ)g(or)o(ganization.)-2
4953 y
SDict begin H.S end
 -2 4953 a -2 4953 a
SDict begin 13 H.A end
 -2 4953 a -2 4953 a
SDict begin [/View [/XYZ H.V]/Dest (0:689) cvn /DEST pdfmark end
 -2 4953
a 396 5043 a Fk(One)g(of)g(the)g(things)g(we)h(aim)f(to)g(pro)o(vide)f
(you)g(with)h(this)h(guide)e(are)h(a)h(set)g(of)f(such)g(high-le)n(v)o
(el)e(patterns,)h(both)h(small)396 5151 y(\(ho)n(w)g(to)g(handle)f
(messages)h(sanely\))g(to)g(lar)o(ge)f(\(ho)n(w)h(to)g(mak)o(e)g(a)g
(reliable)g(publish-subscribe)e(architecture\).)p Black
3800 5569 a Ff(41)p Black eop end
%%Page: 42 55
TeXDict begin 42 54 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.42) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:690) cvn /DEST pdfmark end
 -2
-11 a 105 x Fn(2.11.)39 b(W)-9 b(orking)39 b(with)g(Messa)o(g)q(es)1977
94 y
SDict begin H.S end
 1977 94 a 1977 94 a
SDict begin 22.464 H.A end
 1977 94 a 1977 94 a
SDict begin [/View [/XYZ H.V]/Dest (7.32.1) cvn /DEST pdfmark end
 1977 94
a -2 292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:692) cvn /DEST pdfmark end
 -2 292
a 396 368 a Fk(On)20 b(the)h(wire,)f(\330MQ)g(messages)g(are)h(blobs)e
(of)h(an)o(y)g(size)g(from)g(zero)f(upw)o(ards,)g(\002tting)h(in)h
(memory)-5 b(.)18 b(Y)-9 b(ou)19 b(do)h(your)396 476
y(o)n(wn)g(serialization)f(using)h(protob)n(ufs,)e(msgpack,)h(JSON,)i
(or)f(whate)n(v)o(er)e(else)j(your)e(applications)g(need)h(to)g(speak.)
f(It')-5 b(s)396 584 y(wise)21 b(to)f(choose)g(a)g(data)g
(representation)e(that)j(is)g(portable)d(and)i(f)o(ast,)g(b)n(ut)h(you)
e(can)h(mak)o(e)g(your)e(o)n(wn)i(decisions)g(about)396
692 y(trade-of)n(fs.)-2 859 y
SDict begin H.S end
 -2 859 a -2 859 a
SDict begin 13 H.A end
 -2 859
a -2 859 a
SDict begin [/View [/XYZ H.V]/Dest (0:693) cvn /DEST pdfmark end
 -2 859 a 396 966 a Fk(In)g(memory)-5 b(,)18
b(\330MQ)i(messages)g(are)g(zmq_msg_t)e(structures)h(\(or)h(classes)h
(depending)c(on)j(your)e(language\).)g(Here)i(are)396
1074 y(the)g(basic)h(ground)d(rules)i(for)f(using)h(\330MQ)h(messages)f
(in)g(C:)-2 1092 y
SDict begin H.S end
 -2 1092 a -2 1092 a
SDict begin 13 H.A end
 -2 1092 a -2 1092
a
SDict begin [/View [/XYZ H.V]/Dest (0:694) cvn /DEST pdfmark end
 -2 1092 a -2 1102 a
SDict begin H.S end
 -2 1102 a -2 1102 a
SDict begin 13 H.A end
 -2 1102 a -2
1102 a
SDict begin [/View [/XYZ H.V]/Dest (0:695) cvn /DEST pdfmark end
 -2 1102 a Black 396 1244 a Fj(\225)p Black 479
1244 a
SDict begin H.S end
 479 1244 a 479 1244 a
SDict begin 13 H.A end
 479 1244 a 479 1244 a
SDict begin [/View [/XYZ H.V]/Dest (0:696) cvn /DEST pdfmark end
 479
1244 a Fk(Y)-9 b(ou)20 b(create)g(and)f(pass)i(around)d(zmq_msg_t)h
(objects,)g(not)h(blocks)g(of)g(data.)-2 1262 y
SDict begin H.S end
 -2 1262
a -2 1262 a
SDict begin 13 H.A end
 -2 1262 a -2 1262 a
SDict begin [/View [/XYZ H.V]/Dest (0:697) cvn /DEST pdfmark end
 -2 1262 a Black 396 1393
a Fj(\225)p Black 479 1393 a
SDict begin H.S end
 479 1393 a 479 1393 a
SDict begin 13 H.A end
 479
1393 a 479 1393 a
SDict begin [/View [/XYZ H.V]/Dest (0:698) cvn /DEST pdfmark end
 479 1393 a Fk(T)-7 b(o)21 b(read)e(a)i(message)f(you)
f(use)i(zmq_msg_init[3])16 b(to)21 b(create)f(an)g(empty)f(message,)h
(and)f(then)h(you)f(pass)i(that)f(to)479 1501 y(zmq_msg_recv[3].)-2
1519 y
SDict begin H.S end
 -2 1519 a -2 1519 a
SDict begin 13 H.A end
 -2 1519 a -2 1519 a
SDict begin [/View [/XYZ H.V]/Dest (0:699) cvn /DEST pdfmark end
 -2 1519
a Black 396 1651 a Fj(\225)p Black 479 1651 a
SDict begin H.S end
 479 1651
a 479 1651 a
SDict begin 13 H.A end
 479 1651 a 479 1651 a
SDict begin [/View [/XYZ H.V]/Dest (0:700) cvn /DEST pdfmark end
 479 1651 a Fk(T)-7
b(o)21 b(write)f(a)h(message)f(from)f(ne)n(w)h(data,)g(you)f(use)h
(zmq_msg_init_size[3])d(to)j(create)g(a)h(message)f(and)f(at)i(the)f
(same)479 1759 y(time)h(allocate)f(a)g(block)f(of)h(data)g(of)g(some)g
(size.)h(Y)-9 b(ou)20 b(then)f(\002ll)i(that)g(data)f(using)f(memcp)o
(y[3],)f(and)h(pass)i(the)479 1867 y(message)f(to)h(zmq_msg_send[3].)-2
1885 y
SDict begin H.S end
 -2 1885 a -2 1885 a
SDict begin 13 H.A end
 -2 1885 a -2 1885 a
SDict begin [/View [/XYZ H.V]/Dest (0:701) cvn /DEST pdfmark end
 -2 1885
a Black 396 2016 a Fj(\225)p Black 479 2016 a
SDict begin H.S end
 479 2016
a 479 2016 a
SDict begin 13 H.A end
 479 2016 a 479 2016 a
SDict begin [/View [/XYZ H.V]/Dest (0:702) cvn /DEST pdfmark end
 479 2016 a Fk(T)-7
b(o)21 b(release)f(\(not)f(destro)o(y\))g(a)i(message)f(you)f(call)i
(zmq_msg_close[3].)16 b(This)21 b(drops)e(a)h(reference,)f(and)g(e)n(v)
o(entually)479 2124 y(\330MQ)i(will)g(destro)o(y)e(the)h(message.)-2
2142 y
SDict begin H.S end
 -2 2142 a -2 2142 a
SDict begin 13 H.A end
 -2 2142 a -2 2142 a
SDict begin [/View [/XYZ H.V]/Dest (0:703) cvn /DEST pdfmark end
 -2 2142
a Black 396 2273 a Fj(\225)p Black 479 2273 a
SDict begin H.S end
 479 2273
a 479 2273 a
SDict begin 13 H.A end
 479 2273 a 479 2273 a
SDict begin [/View [/XYZ H.V]/Dest (0:704) cvn /DEST pdfmark end
 479 2273 a Fk(T)-7
b(o)21 b(access)f(the)h(message)f(content)f(you)g(use)i
(zmq_msg_data[3].)16 b(T)-7 b(o)20 b(kno)n(w)f(ho)n(w)h(much)f(data)h
(the)g(message)479 2381 y(contains,)g(use)g(zmq_msg_size[3].)-2
2399 y
SDict begin H.S end
 -2 2399 a -2 2399 a
SDict begin 13 H.A end
 -2 2399 a -2 2399 a
SDict begin [/View [/XYZ H.V]/Dest (0:705) cvn /DEST pdfmark end
 -2 2399
a Black 396 2531 a Fj(\225)p Black 479 2531 a
SDict begin H.S end
 479 2531
a 479 2531 a
SDict begin 13 H.A end
 479 2531 a 479 2531 a
SDict begin [/View [/XYZ H.V]/Dest (0:706) cvn /DEST pdfmark end
 479 2531 a Fk(Do)g(not)g(use)h
(zmq_msg_mo)o(v)o(e[3],)14 b(zmq_msg_cop)o(y[3],)i(or)k
(zmq_msg_init_data[3])15 b(unless)20 b(you)g(read)f(the)i(man)479
2639 y(pages)f(and)g(kno)n(w)f(precisely)g(why)h(you)f(need)g(these.)-2
2823 y
SDict begin H.S end
 -2 2823 a -2 2823 a
SDict begin 13 H.A end
 -2 2823 a -2 2823 a
SDict begin [/View [/XYZ H.V]/Dest (0:707) cvn /DEST pdfmark end
 -2 2823
a 396 2913 a Fk(Here)h(is)h(a)g(typical)f(chunk)e(of)i(code)g(w)o
(orking)f(with)h(messages,)g(which)g(should)f(be)h(f)o(amiliar)g(if)g
(you)f(ha)n(v)o(e)h(been)396 3021 y(paying)f(attention.)g(This)h(is)i
(from)d(the)h(zhelpers.h)f(\002le)h(we)h(use)f(in)h(all)g(the)f(e)o
(xamples:)-2 3122 y
SDict begin H.S end
 -2 3122 a -2 3122 a
SDict begin 11.7 H.A end
 -2 3122 a -2
3122 a
SDict begin [/View [/XYZ H.V]/Dest (0:708) cvn /DEST pdfmark end
 -2 3122 a 396 3201 a Fe(//)90 b(Receive)43 b(0MQ)i(string)e
(from)i(socket)e(and)i(convert)e(into)i(C)f(string)396
3298 y(static)g(char)934 3311 y(*)396 3395 y(s_recv)g(\(void)979
3408 y(*)1024 3395 y(socket\))g({)576 3492 y(zmq_msg_t)f(message;)576
3589 y(zmq_msg_init)f(\(&message\);)576 3686 y(int)i(size)g(=)h
(zmq_msg_recv)e(\(&message,)g(socket,)g(0\);)576 3784
y(if)h(\(size)g(==)h(-1\))755 3881 y(return)f(NULL;)576
3978 y(char)800 3991 y(*)845 3978 y(string)f(=)i(malloc)f(\(size)g(+)h
(1\);)576 4075 y(memcpy)e(\(string,)h(zmq_msg_data)f(\(&message\),)g
(size\);)576 4172 y(zmq_msg_close)f(\(&message\);)576
4269 y(string)h([size])h(=)h(0;)576 4366 y(return)e(\(string\);)396
4464 y(})396 4658 y(//)90 b(Convert)43 b(C)i(string)f(to)g(0MQ)h
(string)e(and)i(send)f(to)g(socket)396 4755 y(static)g(int)396
4852 y(s_send)g(\(void)979 4865 y(*)1024 4852 y(socket,)g(char)1607
4865 y(*)1652 4852 y(string\))f({)576 4949 y(zmq_msg_t)g(message;)576
5046 y(zmq_msg_init_size)f(\(&message,)h(strlen)h(\(string\)\);)576
5144 y(memcpy)f(\(zmq_msg_data)g(\(&message\),)g(string,)h(strlen)g
(\(string\)\);)p Black 3800 5569 a Ff(42)p Black eop
end
%%Page: 43 56
TeXDict begin 43 55 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.43) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:738) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(int)44 b(size)g(=)h(zmq_msg_send)e(\(&message,)g
(socket,)g(0\);)576 170 y(zmq_msg_close)f(\(&message\);)576
267 y(return)h(\(size\);)396 364 y(})-2 538 y
SDict begin H.S end
 -2 538
a -2 538 a
SDict begin 13 H.A end
 -2 538 a -2 538 a
SDict begin [/View [/XYZ H.V]/Dest (0:709) cvn /DEST pdfmark end
 -2 538 a 396 638 a Fk(Y)-9
b(ou)20 b(can)g(easily)g(e)o(xtend)f(this)i(code)e(to)i(send)f(and)f
(recei)n(v)o(e)g(blobs)h(of)g(arbitrary)f(length.)-2
822 y
SDict begin H.S end
 -2 822 a -2 822 a
SDict begin 13 H.A end
 -2 822 a -2 822 a
SDict begin [/View [/XYZ H.V]/Dest (0:710) cvn /DEST pdfmark end
 -2 822 a -2
822 a
SDict begin H.S end
 -2 822 a -2 822 a
SDict begin 13 H.A end
 -2 822 a -2 822 a
SDict begin [/View [/XYZ H.V]/Dest (0:711) cvn /DEST pdfmark end
 -2 822 a 396
912 a Fg(Note)h(than)g(when)h(y)n(ou)f(ha)n(v)o(e)g(passed)h(a)f
(message)g(to)g(zmq_msg_send\(3\),)f(\330MQ)i(will)g(clear)e(the)i
(message,)f(i.e.)396 1020 y(set)h(the)f(size)h(to)f(zer)o(o.)f(Y)-9
b(ou)20 b(cannot)g(send)h(the)g(same)f(message)g(twice,)g(and)h(y)n(ou)
f(cannot)f(access)i(the)f(message)396 1128 y(data)g(after)f(sending)i
(it.)-2 1311 y
SDict begin H.S end
 -2 1311 a -2 1311 a
SDict begin 13 H.A end
 -2 1311 a -2 1311
a
SDict begin [/View [/XYZ H.V]/Dest (0:712) cvn /DEST pdfmark end
 -2 1311 a 396 1402 a Fk(If)f(you)g(w)o(ant)g(to)g(send)g(the)g(same)h
(message)f(more)f(than)h(once,)f(create)h(a)h(second)e(message,)h
(initialize)g(it)h(using)396 1510 y(zmq_msg_init[3])c(and)j(then)f(use)
i(zmq_msg_cop)o(y[3])15 b(to)21 b(create)f(a)g(cop)o(y)f(of)h(the)h
(\002rst)f(message.)g(This)h(does)f(not)396 1618 y(cop)o(y)g(the)g
(data)g(b)n(ut)g(the)g(reference.)f(Y)-9 b(ou)19 b(can)h(then)g(send)g
(the)g(message)g(twice)h(\(or)e(more,)g(if)i(you)e(create)h(more)396
1725 y(copies\))g(and)f(the)i(message)f(will)h(only)e(be)h(\002nally)g
(destro)o(yed)f(when)g(the)i(last)g(cop)o(y)e(is)i(sent)g(or)e(closed.)
-2 1909 y
SDict begin H.S end
 -2 1909 a -2 1909 a
SDict begin 13 H.A end
 -2 1909 a -2 1909 a
SDict begin [/View [/XYZ H.V]/Dest (0:713) cvn /DEST pdfmark end
 -2
1909 a 396 1999 a Fk(\330MQ)i(also)f(supports)1067 1999
y
SDict begin H.S end
 1067 1999 a 1067 1999 a
SDict begin 13 H.A end
 1067 1999 a 1067 1999 a
SDict begin [/View [/XYZ H.V]/Dest (0:714) cvn /DEST pdfmark end
 1067
1999 a Ff(multi-part)h Fk(messages,)f(which)g(let)h(you)e(send)h(or)g
(recei)n(v)o(e)f(a)i(list)g(of)f(frames)g(as)g(a)h(single)396
2107 y(on-the-wire)d(message.)i(This)g(is)i(widely)d(used)h(in)h(real)f
(applications)f(and)g(we')o(ll)i(look)e(at)i(that)f(later)h(in)f(this)h
(chapter)396 2215 y(and)f(in)g(Chapter)g(Three.)-2 2399
y
SDict begin H.S end
 -2 2399 a -2 2399 a
SDict begin 13 H.A end
 -2 2399 a -2 2399 a
SDict begin [/View [/XYZ H.V]/Dest (0:715) cvn /DEST pdfmark end
 -2 2399 a 396
2489 a Fk(Some)g(other)g(things)f(that)i(are)f(w)o(orth)f(kno)n(wing)g
(about)g(messages:)-2 2507 y
SDict begin H.S end
 -2 2507 a -2 2507 a
SDict begin 13 H.A end
 -2 2507
a -2 2507 a
SDict begin [/View [/XYZ H.V]/Dest (0:716) cvn /DEST pdfmark end
 -2 2507 a -2 2517 a
SDict begin H.S end
 -2 2517 a -2 2517 a
SDict begin 13 H.A end
 -2
2517 a -2 2517 a
SDict begin [/View [/XYZ H.V]/Dest (0:717) cvn /DEST pdfmark end
 -2 2517 a Black 396 2659 a Fj(\225)p
Black 479 2659 a
SDict begin H.S end
 479 2659 a 479 2659 a
SDict begin 13 H.A end
 479 2659 a 479
2659 a
SDict begin [/View [/XYZ H.V]/Dest (0:718) cvn /DEST pdfmark end
 479 2659 a Fk(\330MQ)i(sends)f(and)g(recei)n(v)o(es)f(them)h
(atomically)-5 b(,)18 b(i.e.)j(you)e(get)h(a)h(whole)e(message,)h(or)g
(you)f(don')o(t)g(get)h(it)h(at)g(all.)f(This)479 2767
y(is)h(also)g(true)f(for)f(multi-part)g(messages.)-2
2785 y
SDict begin H.S end
 -2 2785 a -2 2785 a
SDict begin 13 H.A end
 -2 2785 a -2 2785 a
SDict begin [/View [/XYZ H.V]/Dest (0:719) cvn /DEST pdfmark end
 -2 2785
a Black 396 2917 a Fj(\225)p Black 479 2917 a
SDict begin H.S end
 479 2917
a 479 2917 a
SDict begin 13 H.A end
 479 2917 a 479 2917 a
SDict begin [/View [/XYZ H.V]/Dest (0:720) cvn /DEST pdfmark end
 479 2917 a Fk(\330MQ)i(does)f(not)g
(send)f(a)i(message)f(right)g(a)o(w)o(ay)g(b)n(ut)g(at)g(some)g
(indeterminate)f(later)h(time.)-2 2935 y
SDict begin H.S end
 -2 2935 a -2
2935 a
SDict begin 13 H.A end
 -2 2935 a -2 2935 a
SDict begin [/View [/XYZ H.V]/Dest (0:721) cvn /DEST pdfmark end
 -2 2935 a Black 396 3066 a
Fj(\225)p Black 479 3066 a
SDict begin H.S end
 479 3066 a 479 3066 a
SDict begin 13 H.A end
 479
3066 a 479 3066 a
SDict begin [/View [/XYZ H.V]/Dest (0:722) cvn /DEST pdfmark end
 479 3066 a Fk(Y)-9 b(ou)20 b(may)g(send)g
(zero-length)d(messages,)j(e.g.)g(for)g(sending)f(a)h(signal)g(from)g
(one)f(thread)g(to)i(another)-5 b(.)-2 3084 y
SDict begin H.S end
 -2 3084
a -2 3084 a
SDict begin 13 H.A end
 -2 3084 a -2 3084 a
SDict begin [/View [/XYZ H.V]/Dest (0:723) cvn /DEST pdfmark end
 -2 3084 a Black 396 3216
a Fj(\225)p Black 479 3216 a
SDict begin H.S end
 479 3216 a 479 3216 a
SDict begin 13 H.A end
 479
3216 a 479 3216 a
SDict begin [/View [/XYZ H.V]/Dest (0:724) cvn /DEST pdfmark end
 479 3216 a Fk(A)21 b(message)f(must)g(\002t)h(in)g
(memory)-5 b(.)17 b(If)j(you)g(w)o(ant)g(to)g(send)g(\002les)h(of)f
(arbitrary)f(sizes,)i(you)e(should)g(break)h(them)f(into)479
3324 y(pieces)i(and)e(send)h(each)g(piece)g(as)h(a)f(separate)g
(message.)-2 3342 y
SDict begin H.S end
 -2 3342 a -2 3342 a
SDict begin 13 H.A end
 -2 3342 a -2
3342 a
SDict begin [/View [/XYZ H.V]/Dest (0:725) cvn /DEST pdfmark end
 -2 3342 a Black 396 3473 a Fj(\225)p Black 479
3473 a
SDict begin H.S end
 479 3473 a 479 3473 a
SDict begin 13 H.A end
 479 3473 a 479 3473 a
SDict begin [/View [/XYZ H.V]/Dest (0:726) cvn /DEST pdfmark end
 479
3473 a Fk(Y)-9 b(ou)20 b(must)g(call)h(zmq_msg_close[3])16
b(when)k(\002nished)g(with)g(a)h(message,)e(in)i(languages)d(that)j
(don')o(t)d(automatically)479 3581 y(destro)o(y)i(objects)g(when)f(a)i
(scope)f(closes.)-2 3765 y
SDict begin H.S end
 -2 3765 a -2 3765 a
SDict begin 13 H.A end
 -2 3765
a -2 3765 a
SDict begin [/View [/XYZ H.V]/Dest (0:727) cvn /DEST pdfmark end
 -2 3765 a 396 3855 a Fk(And)g(to)g(be)g(necessarily)g
(repetiti)n(v)o(e,)f(do)h(not)f(use)i(zmq_msg_init_data[3],)15
b(yet.)20 b(This)g(is)i(a)e(zero-cop)o(y)e(method)h(and)396
3963 y(guaranteed)f(to)j(create)f(trouble)e(for)i(you.)f(There)g(are)i
(f)o(ar)f(more)f(important)g(things)g(to)i(learn)e(about)h(\330MQ)g
(before)f(you)396 4071 y(start)i(to)f(w)o(orry)g(about)f(sha)n(ving)g
(of)n(f)h(microseconds.)-2 4099 y
SDict begin H.S end
 -2 4099 a -2 4099 a
SDict begin 13 H.A end

-2 4099 a -2 4099 a
SDict begin [/View [/XYZ H.V]/Dest (0:728) cvn /DEST pdfmark end
 -2 4099 a 359 x Fn(2.12.)39 b(Handling)e(Multiple)h
(Soc)m(kets)2141 4458 y
SDict begin H.S end
 2141 4458 a 2141 4458 a
SDict begin 22.464 H.A end
 2141
4458 a 2141 4458 a
SDict begin [/View [/XYZ H.V]/Dest (7.33.1) cvn /DEST pdfmark end
 2141 4458 a -2 4656 a
SDict begin H.S end
 -2 4656 a -2
4656 a
SDict begin 13 H.A end
 -2 4656 a -2 4656 a
SDict begin [/View [/XYZ H.V]/Dest (0:730) cvn /DEST pdfmark end
 -2 4656 a 396 4732 a Fk(In)20
b(all)h(the)f(e)o(xamples)f(so)i(f)o(ar)m(,)e(the)i(main)e(loop)h(of)g
(most)g(e)o(xamples)f(has)h(been:)-2 4750 y
SDict begin H.S end
 -2 4750 a
-2 4750 a
SDict begin 13 H.A end
 -2 4750 a -2 4750 a
SDict begin [/View [/XYZ H.V]/Dest (0:731) cvn /DEST pdfmark end
 -2 4750 a -2 4760 a
SDict begin H.S end
 -2
4760 a -2 4760 a
SDict begin 13 H.A end
 -2 4760 a -2 4760 a
SDict begin [/View [/XYZ H.V]/Dest (0:732) cvn /DEST pdfmark end
 -2 4760 a Black
463 4902 a Fk(1.)p Black 546 4902 a
SDict begin H.S end
 546 4902 a 546 4902
a
SDict begin 13 H.A end
 546 4902 a 546 4902 a
SDict begin [/View [/XYZ H.V]/Dest (0:733) cvn /DEST pdfmark end
 546 4902 a Fk(w)o(ait)h(for)e(message)h(on)g
(sock)o(et)-2 4920 y
SDict begin H.S end
 -2 4920 a -2 4920 a
SDict begin 13 H.A end
 -2 4920 a -2
4920 a
SDict begin [/View [/XYZ H.V]/Dest (0:734) cvn /DEST pdfmark end
 -2 4920 a Black 463 5052 a Fk(2.)p Black 546 5052
a
SDict begin H.S end
 546 5052 a 546 5052 a
SDict begin 13 H.A end
 546 5052 a 546 5052 a
SDict begin [/View [/XYZ H.V]/Dest (0:735) cvn /DEST pdfmark end
 546 5052
a Fk(process)f(message)-2 5070 y
SDict begin H.S end
 -2 5070 a -2 5070 a
SDict begin 13 H.A end

-2 5070 a -2 5070 a
SDict begin [/View [/XYZ H.V]/Dest (0:736) cvn /DEST pdfmark end
 -2 5070 a Black 3800 5569 a Ff(43)p
Black eop end
%%Page: 44 57
TeXDict begin 44 56 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.44) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black Black 463 72 a Fk(3.)p Black 546 72 a
SDict begin H.S end
 546 72 a
546 72 a
SDict begin 13 H.A end
 546 72 a 546 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:737) cvn /DEST pdfmark end
 546 72 a Fk(repeat)396 346
y(What)i(if)f(we)h(w)o(ant)f(to)h(read)e(from)g(multiple)h(sock)o(ets)g
(at)h(the)f(same)g(time?)h(The)f(simplest)g(w)o(ay)g(is)h(to)g(connect)
e(one)396 454 y(sock)o(et)h(to)h(multiple)e(endpoints)g(and)g(get)i
(\330MQ)f(to)g(do)g(the)g(f)o(an-in)g(for)f(us.)h(This)h(is)g(le)o(gal)
e(if)i(the)f(remote)f(endpoints)396 562 y(are)h(in)h(the)f(same)g
(pattern)g(b)n(ut)g(it)h(w)o(ould)e(be)h(wrong)f(to)i(e.g.)e(connect)g
(a)i(PULL)f(sock)o(et)g(to)g(a)h(PUB)g(endpoint.)-2 746
y
SDict begin H.S end
 -2 746 a -2 746 a
SDict begin 13 H.A end
 -2 746 a -2 746 a
SDict begin [/View [/XYZ H.V]/Dest (0:739) cvn /DEST pdfmark end
 -2 746 a 396 836
a Fk(The)f(right)g(w)o(ay)g(is)h(to)f(use)h(zmq_poll[3].)c(An)j(e)n(v)o
(en)f(better)h(w)o(ay)g(might)g(be)g(to)g(wrap)g(zmq_poll[3])d(in)j(a)h
(frame)n(w)o(ork)396 944 y(that)g(turns)e(it)i(into)f(a)h(nice)f(e)n(v)
o(ent-dri)n(v)o(en)1596 944 y
SDict begin H.S end
 1596 944 a 1596 944 a
SDict begin 13 H.A end
 1596
944 a 1596 944 a
SDict begin [/View [/XYZ H.V]/Dest (0:740) cvn /DEST pdfmark end
 1596 944 a Ff(r)m(eactor)r Fk(,)f(b)n(ut)i(it')-5
b(s)21 b(signi\002cantly)e(more)g(w)o(ork)h(than)g(we)g(w)o(ant)h(to)f
(co)o(v)o(er)f(here.)-2 1128 y
SDict begin H.S end
 -2 1128 a -2 1128 a
SDict begin 13 H.A end
 -2
1128 a -2 1128 a
SDict begin [/View [/XYZ H.V]/Dest (0:741) cvn /DEST pdfmark end
 -2 1128 a 396 1218 a Fk(Let')-5 b(s)21
b(start)g(with)f(a)h(dirty)e(hack,)h(partly)f(for)h(the)g(fun)f(of)h
(not)g(doing)f(it)i(right,)e(b)n(ut)h(mainly)g(because)f(it)i(lets)g
(me)f(sho)n(w)396 1326 y(you)g(ho)n(w)f(to)i(do)e(non-blocking)e(sock)o
(et)j(reads.)g(Here)g(is)h(a)f(simple)h(e)o(xample)d(of)i(reading)f
(from)g(tw)o(o)i(sock)o(ets)f(using)396 1434 y(non-blocking)d(reads.)i
(This)i(rather)e(confused)g(program)f(acts)j(both)e(as)i(a)f
(subscriber)f(to)i(weather)e(updates,)g(and)h(a)396 1542
y(w)o(ork)o(er)f(for)h(parallel)g(tasks:)-2 1560 y
SDict begin H.S end
 -2
1560 a -2 1560 a
SDict begin 13 H.A end
 -2 1560 a -2 1560 a
SDict begin [/View [/XYZ H.V]/Dest (0:msreader-c) cvn /DEST pdfmark
end
 -2 1560 a 396 1743
a Fg(Example)h(2-1.)e(Multiple)i(sock)o(et)f(r)o(eader)g(\(msr)o(eader)
-8 b(.c\))-2 1843 y
SDict begin H.S end
 -2 1843 a -2 1843 a
SDict begin 11.7 H.A end
 -2 1843 a -2
1843 a
SDict begin [/View [/XYZ H.V]/Dest (0:744) cvn /DEST pdfmark end
 -2 1843 a 396 1923 a Fe(//)396 2021 y(//)90 b(Reading)43
b(from)h(multiple)g(sockets)396 2118 y(//)90 b(This)44
b(version)f(uses)i(a)f(simple)g(recv)g(loop)396 2215
y(//)396 2312 y(#include)g("zhelpers.h")396 2506 y(int)h(main)f
(\(void\))396 2603 y({)576 2701 y(//)89 b(Prepare)44
b(our)g(context)g(and)g(sockets)576 2798 y(void)800 2811
y(*)845 2798 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
2992 y(//)89 b(Connect)44 b(to)g(task)g(ventilator)576
3089 y(void)800 3102 y(*)845 3089 y(receiver)f(=)i(zmq_socket)e
(\(context,)g(ZMQ_PULL\);)576 3186 y(zmq_connect)g(\(receiver,)g
("tcp://localhost:5557"\);)576 3380 y(//)89 b(Connect)44
b(to)g(weather)g(server)576 3478 y(void)800 3491 y(*)845
3478 y(subscriber)f(=)h(zmq_socket)g(\(context,)f(ZMQ_SUB\);)576
3575 y(zmq_connect)g(\(subscriber,)f("tcp://localhost:5556"\);)576
3672 y(zmq_setsockopt)g(\(subscriber,)h(ZMQ_SUBSCRIBE,)f("10001)i(",)h
(6\);)576 3866 y(//)89 b(Process)44 b(messages)f(from)h(both)g(sockets)
576 3963 y(//)89 b(We)44 b(prioritize)g(traffic)f(from)h(the)h(task)f
(ventilator)576 4060 y(while)g(\(true\))f({)755 4158
y(//)89 b(Process)44 b(any)g(waiting)g(tasks)755 4255
y(int)g(rc;)755 4352 y(for)g(\(rc)h(=)f(0;)h(!rc;)f(\))h({)934
4449 y(zmq_msg_t)f(task;)934 4546 y(zmq_msg_init)f(\(&task\);)934
4643 y(if)i(\(\(rc)f(=)h(zmq_msg_recv)d(\(&task,)i(receiver,)f
(ZMQ_DONTWAIT\)\))g(!=)h(-1\))h({)1114 4740 y(//)89 b(process)44
b(task)934 4838 y(})934 4935 y(zmq_msg_close)f(\(&task\);)755
5032 y(})755 5129 y(//)89 b(Process)44 b(any)g(waiting)g(weather)g
(updates)p Black 3800 5569 a Ff(44)p Black eop end
%%Page: 45 58
TeXDict begin 45 57 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.45) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 755 72 a Fe(for)44 b(\(rc)h(=)f(0;)h(!rc;)f(\))h({)934
170 y(zmq_msg_t)f(update;)934 267 y(zmq_msg_init)f(\(&update\);)934
364 y(if)i(\(\(rc)f(=)h(zmq_msg_recv)d(\(&update,)i(subscriber,)f
(ZMQ_DONTWAIT\)\))f(!=)j(-1\))f({)1114 461 y(//)89 b(process)44
b(weather)f(update)934 558 y(})934 655 y(zmq_msg_close)g(\(&update\);)
755 752 y(})755 850 y(//)89 b(No)45 b(activity,)e(so)i(sleep)f(for)g(1)
h(msec)755 947 y(s_sleep)f(\(1\);)576 1044 y(})576 1141
y(//)89 b(We)44 b(never)g(get)h(here)f(but)g(clean)g(up)h(anyhow)576
1238 y(zmq_close)e(\(receiver\);)576 1335 y(zmq_close)g
(\(subscriber\);)576 1432 y(zmq_ctx_destroy)f(\(context\);)576
1530 y(return)h(0;)396 1627 y(})-2 1801 y
SDict begin H.S end
 -2 1801 a -2
1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:745) cvn /DEST pdfmark end
 -2 1801 a 396 1901 a Fk(The)20
b(cost)h(of)e(this)i(approach)d(is)j(some)f(additional)f(latenc)o(y)g
(on)h(the)g(\002rst)h(message)f(\(the)g(sleep)g(at)h(the)f(end)g(of)g
(the)g(loop,)396 2009 y(when)g(there)g(are)g(no)f(w)o(aiting)h
(messages)h(to)f(process\).)f(This)i(w)o(ould)e(be)h(a)h(problem)d(in)j
(applications)e(where)396 2116 y(sub-millisecond)f(latenc)o(y)i(w)o(as)
h(vital.)f(Also,)g(you)f(need)h(to)g(check)g(the)g(documentation)d(for)
j(nanosleep\(\))e(or)396 2224 y(whate)n(v)o(er)h(function)f(you)i(use)g
(to)g(mak)o(e)g(sure)g(it)h(does)f(not)g(b)n(usy-loop.)-2
2408 y
SDict begin H.S end
 -2 2408 a -2 2408 a
SDict begin 13 H.A end
 -2 2408 a -2 2408 a
SDict begin [/View [/XYZ H.V]/Dest (0:746) cvn /DEST pdfmark end
 -2 2408
a 396 2498 a Fk(Y)-9 b(ou)20 b(can)g(treat)g(the)g(sock)o(ets)h(f)o
(airly)e(by)h(reading)f(\002rst)i(from)e(one,)g(then)h(the)g(second)g
(rather)f(than)h(prioritizing)e(them)i(as)396 2606 y(we)h(did)f(in)g
(this)h(e)o(xample.)d(This)j(is)g(called)f("f)o(air)n(-queuing",)d
(something)i(that)h(\330MQ)g(does)g(automatically)f(when)h(one)396
2714 y(sock)o(et)g(recei)n(v)o(es)g(messages)g(from)f(more)h(than)f
(one)h(source.)-2 2898 y
SDict begin H.S end
 -2 2898 a -2 2898 a
SDict begin 13 H.A end
 -2 2898
a -2 2898 a
SDict begin [/View [/XYZ H.V]/Dest (0:747) cvn /DEST pdfmark end
 -2 2898 a 396 2988 a Fk(No)n(w)g(let')-5
b(s)21 b(see)g(the)f(same)h(little)g(senseless)g(application)e(done)g
(right,)g(using)h(zmq_poll[3]:)-2 3006 y
SDict begin H.S end
 -2 3006 a -2
3006 a
SDict begin 13 H.A end
 -2 3006 a -2 3006 a
SDict begin [/View [/XYZ H.V]/Dest (0:mspoller-c) cvn /DEST pdfmark
end
 -2 3006 a 396 3190 a Fg(Example)h(2-2.)e
(Multiple)i(sock)o(et)f(poller)h(\(mspoller)-8 b(.c\))-2
3289 y
SDict begin H.S end
 -2 3289 a -2 3289 a
SDict begin 11.7 H.A end
 -2 3289 a -2 3289 a
SDict begin [/View [/XYZ H.V]/Dest (0:750) cvn /DEST pdfmark end
 -2 3289
a 396 3370 a Fe(//)396 3467 y(//)90 b(Reading)43 b(from)h(multiple)g
(sockets)396 3564 y(//)90 b(This)44 b(version)f(uses)i(zmq_poll\(\))396
3661 y(//)396 3758 y(#include)f("zhelpers.h")396 3953
y(int)h(main)f(\(void\))396 4050 y({)576 4147 y(void)800
4160 y(*)845 4147 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
4341 y(//)89 b(Connect)44 b(to)g(task)g(ventilator)576
4438 y(void)800 4451 y(*)845 4438 y(receiver)f(=)i(zmq_socket)e
(\(context,)g(ZMQ_PULL\);)576 4535 y(zmq_connect)g(\(receiver,)g
("tcp://localhost:5557"\);)576 4730 y(//)89 b(Connect)44
b(to)g(weather)g(server)576 4827 y(void)800 4840 y(*)845
4827 y(subscriber)f(=)h(zmq_socket)g(\(context,)f(ZMQ_SUB\);)576
4924 y(zmq_connect)g(\(subscriber,)f("tcp://localhost:5556"\);)576
5021 y(zmq_setsockopt)g(\(subscriber,)h(ZMQ_SUBSCRIBE,)f("10001)i(",)h
(6\);)p Black 3800 5569 a Ff(45)p Black eop end
%%Page: 46 59
TeXDict begin 46 58 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.46) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(//)89 b(Initialize)43 b(poll)h(set)576
170 y(zmq_pollitem_t)e(items)i([])h(=)f({)755 267 y({)h(receiver,)e(0,)
h(ZMQ_POLLIN,)f(0)i(},)755 364 y({)g(subscriber,)e(0,)h(ZMQ_POLLIN,)f
(0)i(})576 461 y(};)576 558 y(//)89 b(Process)44 b(messages)f(from)h
(both)g(sockets)576 655 y(while)g(\(true\))f({)755 752
y(zmq_msg_t)g(message;)755 850 y(zmq_poll)g(\(items,)h(2,)h(-1\);)755
947 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
1044 y(zmq_msg_init)g(\(&message\);)934 1141 y(zmq_msg_recv)g
(\(&message,)g(receiver,)h(0\);)934 1238 y(//)90 b(Process)43
b(task)934 1335 y(zmq_msg_close)g(\(&message\);)755 1432
y(})755 1530 y(if)h(\(items)g([1].revents)f(&)i(ZMQ_POLLIN\))e({)934
1627 y(zmq_msg_init)g(\(&message\);)934 1724 y(zmq_msg_recv)g
(\(&message,)g(subscriber,)g(0\);)934 1821 y(//)90 b(Process)43
b(weather)h(update)934 1918 y(zmq_msg_close)f(\(&message\);)755
2015 y(})576 2112 y(})576 2209 y(//)89 b(We)44 b(never)g(get)h(here)576
2307 y(zmq_close)e(\(receiver\);)576 2404 y(zmq_close)g
(\(subscriber\);)576 2501 y(zmq_ctx_destroy)f(\(context\);)576
2598 y(return)h(0;)396 2695 y(})-2 2786 y
SDict begin H.S end
 -2 2786 a -2
2786 a
SDict begin 13 H.A end
 -2 2786 a -2 2786 a
SDict begin [/View [/XYZ H.V]/Dest (0:751) cvn /DEST pdfmark end
 -2 2786 a 369 x Fn(2.13.)c(Handling)e(Err)m
(or)n(s)i(and)g(ETERM)2275 3155 y
SDict begin H.S end
 2275 3155 a 2275 3155
a
SDict begin 22.464 H.A end
 2275 3155 a 2275 3155 a
SDict begin [/View [/XYZ H.V]/Dest (7.34.1) cvn /DEST pdfmark end
 2275 3155 a -2 3353 a
SDict begin H.S end
 -2 3353
a -2 3353 a
SDict begin 13 H.A end
 -2 3353 a -2 3353 a
SDict begin [/View [/XYZ H.V]/Dest (0:753) cvn /DEST pdfmark end
 -2 3353 a 396 3429 a
Fk(\330MQ')-5 b(s)21 b(error)e(handling)f(philosophy)g(is)j(a)g(mix)f
(of)f(f)o(ail-f)o(ast)i(and)e(resilience.)h(Processes,)g(we)h(belie)n
(v)o(e,)e(should)g(be)h(as)396 3537 y(vulnerable)e(as)j(possible)f(to)h
(internal)e(errors,)g(and)h(as)h(rob)n(ust)e(as)i(possible)f(against)g
(e)o(xternal)f(attacks)h(and)g(errors.)f(T)-7 b(o)396
3645 y(gi)n(v)o(e)20 b(an)g(analogy)-5 b(,)18 b(a)i(li)n(ving)g(cell)g
(will)h(self-destruct)f(if)g(it)h(detects)f(a)h(single)f(internal)f
(error)m(,)g(yet)h(it)h(will)g(resist)g(attack)396 3753
y(from)e(the)i(outside)e(by)h(all)h(means)f(possible.)-2
3937 y
SDict begin H.S end
 -2 3937 a -2 3937 a
SDict begin 13 H.A end
 -2 3937 a -2 3937 a
SDict begin [/View [/XYZ H.V]/Dest (0:754) cvn /DEST pdfmark end
 -2 3937
a 396 4027 a Fk(Assertions,)g(which)g(pepper)f(the)h(\330MQ)g(code,)g
(are)g(absolutely)f(vital)h(to)g(rob)n(ust)g(code,)f(the)o(y)h(just)g
(ha)n(v)o(e)g(to)g(be)h(on)e(the)396 4135 y(right)h(side)g(of)g(the)g
(cellular)g(w)o(all.)h(And)f(there)f(should)g(be)i(such)f(a)g(w)o(all.)
h(If)f(it)h(is)g(unclear)e(whether)g(a)i(f)o(ault)f(is)h(internal)396
4243 y(or)f(e)o(xternal,)f(that)h(is)h(a)g(design)e(\003a)o(w)i(to)f
(be)g(\002x)o(ed.)g(In)g(C/C++,)h(assertions)f(stop)g(the)g
(application)f(immediately)g(with)396 4351 y(an)h(error)-5
b(.)20 b(In)g(other)f(languages)g(you)g(may)h(get)g(e)o(xceptions)e(or)
i(halts.)-2 4535 y
SDict begin H.S end
 -2 4535 a -2 4535 a
SDict begin 13 H.A end
 -2 4535 a -2 4535
a
SDict begin [/View [/XYZ H.V]/Dest (0:755) cvn /DEST pdfmark end
 -2 4535 a 396 4625 a Fk(When)g(\330MQ)h(detects)f(an)g(e)o(xternal)f
(f)o(ault)h(it)h(returns)e(an)i(error)e(to)h(the)g(calling)g(code.)f
(In)h(some)g(rare)g(cases)h(it)g(drops)396 4733 y(messages)g(silently)
-5 b(,)19 b(if)i(there)e(is)j(no)d(ob)o(vious)g(strate)o(gy)g(for)h
(reco)o(v)o(ering)d(from)i(the)h(error)-5 b(.)-2 4917
y
SDict begin H.S end
 -2 4917 a -2 4917 a
SDict begin 13 H.A end
 -2 4917 a -2 4917 a
SDict begin [/View [/XYZ H.V]/Dest (0:756) cvn /DEST pdfmark end
 -2 4917 a 396
5007 a Fk(In)20 b(most)g(of)g(the)h(C)g(e)o(xamples)e(we')l(v)o(e)g
(seen)h(so)h(f)o(ar)f(there')-5 b(s)20 b(been)f(no)h(error)f(handling.)
2920 5007 y
SDict begin H.S end
 2920 5007 a 2920 5007 a
SDict begin 13 H.A end
 2920 5007 a 2920
5007 a
SDict begin [/View [/XYZ H.V]/Dest (0:757) cvn /DEST pdfmark end
 2920 5007 a Fg(Real)i(code)f(should)h(do)f(err)o(or)396
5115 y(handling)h(on)f(e)o(v)o(ery)g(single)g(\330MQ)h(call)p
Fk(.)f(If)g(you')l(re)e(using)i(a)g(language)f(binding)f(other)i(than)f
(C,)i(the)f(binding)f(may)p Black 3798 5569 a Ff(46)p
Black eop end
%%Page: 47 60
TeXDict begin 47 59 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.47) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:791) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(handle)g(errors)h(for)f(you.)g(In)h(C)h(you)f(do)f
(need)h(to)g(do)g(this)h(yourself.)d(There)i(are)g(some)g(simple)g
(rules,)g(starting)g(with)396 180 y(POSIX)h(con)m(v)o(entions:)-2
181 y
SDict begin H.S end
 -2 181 a -2 181 a
SDict begin 13 H.A end
 -2 181 a -2 181 a
SDict begin [/View [/XYZ H.V]/Dest (0:758) cvn /DEST pdfmark end
 -2 181 a -2
191 a
SDict begin H.S end
 -2 191 a -2 191 a
SDict begin 13 H.A end
 -2 191 a -2 191 a
SDict begin [/View [/XYZ H.V]/Dest (0:759) cvn /DEST pdfmark end
 -2 191 a Black
396 351 a Fj(\225)p Black 479 351 a
SDict begin H.S end
 479 351 a 479 351
a
SDict begin 13 H.A end
 479 351 a 479 351 a
SDict begin [/View [/XYZ H.V]/Dest (0:760) cvn /DEST pdfmark end
 479 351 a Fk(Methods)f(that)g(create)g(objects)g
(will)h(return)e(NULL)h(if)g(the)o(y)g(f)o(ail.)-2 369
y
SDict begin H.S end
 -2 369 a -2 369 a
SDict begin 13 H.A end
 -2 369 a -2 369 a
SDict begin [/View [/XYZ H.V]/Dest (0:761) cvn /DEST pdfmark end
 -2 369 a Black
396 500 a Fj(\225)p Black 479 500 a
SDict begin H.S end
 479 500 a 479 500
a
SDict begin 13 H.A end
 479 500 a 479 500 a
SDict begin [/View [/XYZ H.V]/Dest (0:762) cvn /DEST pdfmark end
 479 500 a Fk(Methods)g(that)g(process)g(data)g
(may)f(return)g(the)i(number)d(of)i(bytes)g(processed,)f(or)h(-1)g(on)f
(an)i(error)e(or)h(f)o(ailure.)-2 518 y
SDict begin H.S end
 -2 518 a -2 518
a
SDict begin 13 H.A end
 -2 518 a -2 518 a
SDict begin [/View [/XYZ H.V]/Dest (0:763) cvn /DEST pdfmark end
 -2 518 a Black 396 649 a Fj(\225)p
Black 479 649 a
SDict begin H.S end
 479 649 a 479 649 a
SDict begin 13 H.A end
 479 649 a 479 649
a
SDict begin [/View [/XYZ H.V]/Dest (0:764) cvn /DEST pdfmark end
 479 649 a Fk(Other)g(methods)f(will)i(return)e(0)h(on)g(success)h
(and)f(-1)f(on)h(an)g(error)f(or)h(f)o(ailure.)-2 650
y
SDict begin H.S end
 -2 650 a -2 650 a
SDict begin 13 H.A end
 -2 650 a -2 650 a
SDict begin [/View [/XYZ H.V]/Dest (0:765) cvn /DEST pdfmark end
 -2 650 a Black
396 799 a Fj(\225)p Black 479 799 a
SDict begin H.S end
 479 799 a 479 799
a
SDict begin 13 H.A end
 479 799 a 479 799 a
SDict begin [/View [/XYZ H.V]/Dest (0:766) cvn /DEST pdfmark end
 479 799 a Fk(The)g(error)f(code)h(is)h(pro)o
(vided)c(in)1465 799 y
SDict begin H.S end
 1465 799 a 1465 799 a
SDict begin 13 H.A end
 1465 799
a 1465 799 a
SDict begin [/View [/XYZ H.V]/Dest (0:767) cvn /DEST pdfmark end
 1465 799 a Fe(errno)j Fk(or)g(zmq_errno[3].)-2
817 y
SDict begin H.S end
 -2 817 a -2 817 a
SDict begin 13 H.A end
 -2 817 a -2 817 a
SDict begin [/View [/XYZ H.V]/Dest (0:768) cvn /DEST pdfmark end
 -2 817 a Black
396 948 a Fj(\225)p Black 479 948 a
SDict begin H.S end
 479 948 a 479 948
a
SDict begin 13 H.A end
 479 948 a 479 948 a
SDict begin [/View [/XYZ H.V]/Dest (0:769) cvn /DEST pdfmark end
 479 948 a Fk(A)h(descripti)n(v)o(e)e(error)g(te)o
(xt)h(for)f(logging)g(is)i(pro)o(vided)d(by)h(zmq_strerror[3].)-2
1132 y
SDict begin H.S end
 -2 1132 a -2 1132 a
SDict begin 13 H.A end
 -2 1132 a -2 1132 a
SDict begin [/View [/XYZ H.V]/Dest (0:770) cvn /DEST pdfmark end
 -2 1132
a 396 1222 a Fk(There)h(are)g(tw)o(o)g(main)g(e)o(xceptional)e
(conditions)h(that)h(you)g(may)f(w)o(ant)i(to)f(handle)f(as)i(non-f)o
(atal:)-2 1240 y
SDict begin H.S end
 -2 1240 a -2 1240 a
SDict begin 13 H.A end
 -2 1240 a -2 1240
a
SDict begin [/View [/XYZ H.V]/Dest (0:771) cvn /DEST pdfmark end
 -2 1240 a -2 1250 a
SDict begin H.S end
 -2 1250 a -2 1250 a
SDict begin 13 H.A end
 -2 1250 a -2
1250 a
SDict begin [/View [/XYZ H.V]/Dest (0:772) cvn /DEST pdfmark end
 -2 1250 a Black 396 1393 a Fj(\225)p Black 479
1393 a
SDict begin H.S end
 479 1393 a 479 1393 a
SDict begin 13 H.A end
 479 1393 a 479 1393 a
SDict begin [/View [/XYZ H.V]/Dest (0:773) cvn /DEST pdfmark end
 479
1393 a Fk(When)f(a)h(thread)e(calls)i(zmq_msg_recv[3])16
b(with)k(the)g(ZMQ_DONTW)-10 b(AIT)19 b(option)g(and)h(there)g(is)h(no)
f(w)o(aiting)479 1500 y(data.)g(\330MQ)h(will)f(return)f(-1)h(and)g
(set)h(errno)e(to)h(EA)m(GAIN.)-2 1515 y
SDict begin H.S end
 -2 1515 a -2
1515 a
SDict begin 13 H.A end
 -2 1515 a -2 1515 a
SDict begin [/View [/XYZ H.V]/Dest (0:774) cvn /DEST pdfmark end
 -2 1515 a Black 396 1650 a
Fj(\225)p Black 479 1650 a
SDict begin H.S end
 479 1650 a 479 1650 a
SDict begin 13 H.A end
 479
1650 a 479 1650 a
SDict begin [/View [/XYZ H.V]/Dest (0:775) cvn /DEST pdfmark end
 479 1650 a Fk(When)g(a)h(thread)e(calls)i
(zmq_ctx_destro)o(y[3])16 b(and)j(other)h(threads)f(are)h(doing)f
(blocking)g(w)o(ork.)g(The)479 1758 y(zmq_ctx_destro)o(y[3])14
b(call)20 b(closes)f(the)f(conte)o(xt)g(and)g(all)h(blocking)e(calls)j
(e)o(xit)e(with)h(-1,)f(and)g(errno)g(set)h(to)g(ETERM.)-2
1942 y
SDict begin H.S end
 -2 1942 a -2 1942 a
SDict begin 13 H.A end
 -2 1942 a -2 1942 a
SDict begin [/View [/XYZ H.V]/Dest (0:776) cvn /DEST pdfmark end
 -2 1942
a 396 2032 a Fk(What)i(this)g(boils)f(do)n(wn)f(to)h(is)h(that)g(in)f
(most)g(cases)h(you)f(can)f(use)i(assertions)f(on)g(\330MQ)g(calls,)h
(lik)o(e)f(this,)h(in)f(C:)-2 2133 y
SDict begin H.S end
 -2 2133 a -2 2133
a
SDict begin 11.7 H.A end
 -2 2133 a -2 2133 a
SDict begin [/View [/XYZ H.V]/Dest (0:777) cvn /DEST pdfmark end
 -2 2133 a 396 2212 a Fe(void)620
2225 y(*)665 2212 y(context)44 b(=)h(zmq_ctx_new)e(\(\);)396
2309 y(assert)h(\(context\);)396 2406 y(void)620 2419
y(*)665 2406 y(socket)g(=)h(zmq_socket)e(\(context,)g(ZMQ_REP\);)396
2503 y(assert)h(\(socket\);)396 2600 y(int)h(rc)f(=)h(zmq_bind)e
(\(socket,)h("tcp://)1922 2613 y(*)1967 2600 y(:5555"\);)396
2698 y(if)h(\(rc)f(!=)h(0\))f({)576 2795 y(printf)f(\("E:)i(bind)f
(failed:)f(\045s\\n",)h(strerror)g(\(errno\)\);)576 2892
y(return)f(-1;)396 2989 y(})-2 3163 y
SDict begin H.S end
 -2 3163 a -2 3163
a
SDict begin 13 H.A end
 -2 3163 a -2 3163 a
SDict begin [/View [/XYZ H.V]/Dest (0:778) cvn /DEST pdfmark end
 -2 3163 a 396 3263 a Fk(In)20 b(C/C++,)h(asserts)
g(can)f(be)g(remo)o(v)o(ed)e(entirely)i(in)g(optimized)f(code,)g(so)i
(don')o(t)d(mak)o(e)i(the)g(mistak)o(e)g(of)g(wrapping)e(the)396
3371 y(whole)i(\330MQ)g(call)h(in)f(an)g(assert\(\).)g(It)h(looks)e
(neat,)h(then)g(the)g(optimizer)f(remo)o(v)o(es)g(all)i(the)f(asserts)h
(and)e(the)i(calls)g(you)396 3479 y(w)o(ant)g(to)f(mak)o(e,)f(and)h
(your)f(application)g(breaks)g(in)h(impressi)n(v)o(e)g(w)o(ays.)-2
3663 y
SDict begin H.S end
 -2 3663 a -2 3663 a
SDict begin 13 H.A end
 -2 3663 a -2 3663 a
SDict begin [/View [/XYZ H.V]/Dest (0:779) cvn /DEST pdfmark end
 -2 3663
a 396 3753 a Fk(Let')-5 b(s)21 b(see)g(ho)n(w)e(to)i(shut)f(do)n(wn)f
(a)i(process)e(cleanly)-5 b(.)19 b(W)-7 b(e')o(ll)22
b(tak)o(e)e(the)g(parallel)g(pipeline)f(e)o(xample)g(from)g(the)h(pre)n
(vious)396 3861 y(section.)g(If)g(we')l(v)o(e)f(started)h(a)h(whole)f
(lot)g(of)g(w)o(ork)o(ers)f(in)i(the)f(background,)c(we)21
b(no)n(w)f(w)o(ant)g(to)g(kill)h(them)f(when)f(the)396
3969 y(batch)h(is)h(\002nished.)e(Let')-5 b(s)21 b(do)f(this)h(by)e
(sending)h(a)g(kill)h(message)f(to)g(the)g(w)o(ork)o(ers.)f(The)h(best)
h(place)f(to)g(do)g(this)h(is)g(the)396 4077 y(sink,)f(since)h(it)f
(really)g(kno)n(ws)g(when)f(the)h(batch)g(is)h(done.)-2
4261 y
SDict begin H.S end
 -2 4261 a -2 4261 a
SDict begin 13 H.A end
 -2 4261 a -2 4261 a
SDict begin [/View [/XYZ H.V]/Dest (0:780) cvn /DEST pdfmark end
 -2 4261
a 396 4351 a Fk(Ho)n(w)f(do)g(we)h(connect)e(the)h(sink)g(to)g(the)h(w)
o(ork)o(ers?)e(The)h(PUSH/PULL)g(sock)o(ets)h(are)f(one-w)o(ay)f(only)
-5 b(.)18 b(The)i(standard)396 4459 y(\330MQ)h(answer)f(is:)h(create)f
(a)g(ne)n(w)g(sock)o(et)g(\003o)n(w)h(for)e(each)h(type)g(of)g(problem)
e(you)h(need)h(to)g(solv)o(e.)g(W)-7 b(e')o(ll)21 b(use)g(a)396
4566 y(publish-subscribe)d(model)h(to)h(send)g(kill)h(messages)f(to)g
(the)h(w)o(ork)o(ers\()p 0 TeXcolorgray 2458 4566 a
SDict begin H.S end
 2458
4566 a Fk(Figure)d(2-5)2806 4566 y
SDict begin 13 H.L end
 2806 4566 a 2806 4566
a
SDict begin [/Subtype /Link/Dest (0:figure-14) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2806 4566 a Black -2 w Fk(\):)-2 4584 y
SDict begin H.S end
 -2 4584 a -2
4584 a
SDict begin 13 H.A end
 -2 4584 a -2 4584 a
SDict begin [/View [/XYZ H.V]/Dest (0:782) cvn /DEST pdfmark end
 -2 4584 a -2 4594 a
SDict begin H.S end
 -2 4594
a -2 4594 a
SDict begin 13 H.A end
 -2 4594 a -2 4594 a
SDict begin [/View [/XYZ H.V]/Dest (0:783) cvn /DEST pdfmark end
 -2 4594 a Black 396 4737
a Fj(\225)p Black 479 4737 a
SDict begin H.S end
 479 4737 a 479 4737 a
SDict begin 13 H.A end
 479
4737 a 479 4737 a
SDict begin [/View [/XYZ H.V]/Dest (0:784) cvn /DEST pdfmark end
 479 4737 a Fk(The)i(sink)g(creates)h(a)f(PUB)h(sock)o
(et)f(on)g(a)h(ne)n(w)f(endpoint.)-2 4755 y
SDict begin H.S end
 -2 4755 a
-2 4755 a
SDict begin 13 H.A end
 -2 4755 a -2 4755 a
SDict begin [/View [/XYZ H.V]/Dest (0:785) cvn /DEST pdfmark end
 -2 4755 a Black 396 4886
a Fj(\225)p Black 479 4886 a
SDict begin H.S end
 479 4886 a 479 4886 a
SDict begin 13 H.A end
 479
4886 a 479 4886 a
SDict begin [/View [/XYZ H.V]/Dest (0:786) cvn /DEST pdfmark end
 479 4886 a Fk(W)-7 b(ork)o(ers)20 b(bind)g(their)g
(input)f(sock)o(et)h(to)h(this)f(endpoint.)-2 4904 y
SDict begin H.S end

-2 4904 a -2 4904 a
SDict begin 13 H.A end
 -2 4904 a -2 4904 a
SDict begin [/View [/XYZ H.V]/Dest (0:787) cvn /DEST pdfmark end
 -2 4904 a Black
396 5036 a Fj(\225)p Black 479 5036 a
SDict begin H.S end
 479 5036 a 479
5036 a
SDict begin 13 H.A end
 479 5036 a 479 5036 a
SDict begin [/View [/XYZ H.V]/Dest (0:788) cvn /DEST pdfmark end
 479 5036 a Fk(When)g(the)h(sink)f(detects)
g(the)g(end)g(of)g(the)g(batch)g(it)g(sends)h(a)f(kill)h(to)f(its)h
(PUB)h(sock)o(et.)-2 5037 y
SDict begin H.S end
 -2 5037 a -2 5037 a
SDict begin 13 H.A end
 -2 5037
a -2 5037 a
SDict begin [/View [/XYZ H.V]/Dest (0:789) cvn /DEST pdfmark end
 -2 5037 a Black 3797 5569 a Ff(47)p Black
eop end
%%Page: 48 61
TeXDict begin 48 60 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.48) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:790) cvn /DEST pdfmark end
 479 72 a Fk(When)h(a)h(w)o(ork)o(er)e
(detects)h(this)h(kill)g(message,)e(it)i(e)o(xits.)396
346 y(It)g(doesn')o(t)d(tak)o(e)j(much)e(ne)n(w)h(code)f(in)i(the)f
(sink:)-2 430 y
SDict begin H.S end
 -2 430 a -2 430 a
SDict begin 11.7 H.A end
 -2 430 a -2 430 a
SDict begin [/View [/XYZ H.V]/Dest (0:792) cvn /DEST pdfmark end
 -2
430 a 576 527 a Fe(void)800 540 y(*)845 527 y(control)43
b(=)i(zmq_socket)e(\(context,)g(ZMQ_PUB\);)576 624 y(zmq_bind)g
(\(control,)g("tcp://)1742 637 y(*)1787 624 y(:5559"\);)576
721 y(...)576 818 y(//)89 b(Send)44 b(kill)g(signal)g(to)h(workers)576
915 y(zmq_msg_init_data)d(\(&message,)h("KILL",)g(5\);)576
1012 y(zmq_msg_send)f(\(control,)i(&message,)f(0\);)576
1109 y(zmq_msg_close)f(\(&message\);)-2 1121 y
SDict begin H.S end
 -2 1121
a -2 1121 a
SDict begin 13 H.A end
 -2 1121 a -2 1121 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-14) cvn /DEST pdfmark
end
 -2 1121 a 396 1383 a
Fg(Figur)o(e)20 b(2-5.)f(P)o(arallel)h(Pipeline)g(with)h(Kill)f
(Signaling)-2 1483 y
SDict begin H.S end
 -2 1483 a -2 1483 a
SDict begin 13 H.A end
 -2 1483 a -2
1483 a
SDict begin [/View [/XYZ H.V]/Dest (0:795) cvn /DEST pdfmark end
 -2 1483 a 396 4858 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4858 a @beginspecial
0 @llx -400 @lly 324 @urx 0 @ury 3240 @rwi @setspecial
%%BeginDocument: images/fig14.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -400 324 0
%%HiResBoundingBox: 0.0 -400.0 324.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
94.80017852783203 -21.800180435180664 moveto
94.80017852783203 -51.80017852783203 lineto
178.80018615722656 -51.80017852783203 lineto
178.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
94.80017852783203 -54.80017852783203 moveto
94.80017852783203 -65.80017852783203 lineto
94.80017852783203 -68.4668451944987 95.80017852783203 -69.80017852783203 97.80017852783203 -69.80017852783203 curveto
175.80018615722656 -69.80017852783203 lineto
175.80018615722656 -69.80017852783203 lineto
177.80018615722656 -69.80017852783203 178.80018615722656 -68.4668451944987 178.80018615722656 -65.80017852783203 curveto
178.80018615722656 -55.000179290771484 lineto
178.80018615722656 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
109.80017852783203 -285.8001708984375 moveto
107.80017852783203 -285.8001708984375 106.80017852783203 -287.1335042317708 106.80017852783203 -289.8001708984375 curveto
106.80017852783203 -299.8001708984375 lineto
190.80018615722656 -299.8001708984375 lineto
190.80018615722656 -289.8001708984375 lineto
190.80018615722656 -287.1335042317708 189.80018615722656 -285.8001708984375 187.80018615722656 -285.8001708984375 curveto
109.80017852783203 -285.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -302.8001708984375 moveto
106.80017852783203 -331.8001708984375 lineto
190.80018615722656 -331.8001708984375 lineto
190.80018615722656 -302.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -334.8001708984375 moveto
106.80017852783203 -345.8001708984375 lineto
106.80017852783203 -348.4668375651042 107.80017852783203 -349.8001708984375 109.80017852783203 -349.8001708984375 curveto
187.80018615722656 -349.8001708984375 lineto
187.80018615722656 -349.8001708984375 lineto
189.80018615722656 -349.8001708984375 190.80018615722656 -348.4668375651042 190.80018615722656 -345.8001708984375 curveto
190.80018615722656 -335.00018310546875 lineto
190.80018615722656 -334.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -149.80018615722656 moveto
17.800180435180664 -149.80018615722656 16.800180435180664 -151.1335194905599 16.800180435180664 -153.80018615722656 curveto
16.800180435180664 -165.80018615722656 lineto
56.80017852783203 -165.80018615722656 lineto
56.80017852783203 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
59.80017852783203 -149.80018615722656 moveto
59.80017852783203 -165.80018615722656 lineto
94.80017852783203 -165.80018615722656 lineto
94.80017852783203 -153.80018615722656 lineto
94.80017852783203 -151.1335194905599 93.80017852783203 -149.80018615722656 91.80017852783203 -149.80018615722656 curveto
60.000179290771484 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -149.80018615722656 moveto
113.80017852783203 -149.80018615722656 112.80017852783203 -151.1335194905599 112.80017852783203 -153.80018615722656 curveto
112.80017852783203 -165.80018615722656 lineto
152.80018615722656 -165.80018615722656 lineto
152.80018615722656 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
155.80018615722656 -149.80018615722656 moveto
155.80018615722656 -165.80018615722656 lineto
190.80018615722656 -165.80018615722656 lineto
190.80018615722656 -153.80018615722656 lineto
190.80018615722656 -151.1335194905599 189.80018615722656 -149.80018615722656 187.80018615722656 -149.80018615722656 curveto
156.00018310546875 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -149.80018615722656 moveto
209.80018615722656 -149.80018615722656 208.80018615722656 -151.1335194905599 208.80018615722656 -153.80018615722656 curveto
208.80018615722656 -165.80018615722656 lineto
248.80018615722656 -165.80018615722656 lineto
248.80018615722656 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
251.80018615722656 -149.80018615722656 moveto
251.80018615722656 -165.80018615722656 lineto
286.8001708984375 -165.80018615722656 lineto
286.8001708984375 -153.80018615722656 lineto
286.8001708984375 -151.1335194905599 285.8001708984375 -149.80018615722656 283.8001708984375 -149.80018615722656 curveto
252.00018310546875 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -165.80018615722656 moveto
16.800180435180664 -195.80018615722656 lineto
94.80017852783203 -195.80018615722656 lineto
94.80017852783203 -165.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -165.80018615722656 moveto
112.80017852783203 -195.80018615722656 lineto
190.80018615722656 -195.80018615722656 lineto
190.80018615722656 -165.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -165.80018615722656 moveto
208.80018615722656 -195.80018615722656 lineto
286.8001708984375 -195.80018615722656 lineto
286.8001708984375 -165.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -198.80018615722656 moveto
16.800180435180664 -209.80018615722656 lineto
16.800180435180664 -212.46685282389322 17.800180435180664 -213.80018615722656 19.800180435180664 -213.80018615722656 curveto
91.80017852783203 -213.80018615722656 lineto
91.80017852783203 -213.80018615722656 lineto
93.80017852783203 -213.80018615722656 94.80017852783203 -212.46685282389322 94.80017852783203 -209.80018615722656 curveto
94.80017852783203 -199.00018310546875 lineto
94.80017852783203 -198.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -198.80018615722656 moveto
112.80017852783203 -209.80018615722656 lineto
112.80017852783203 -212.46685282389322 113.80017852783203 -213.80018615722656 115.80017852783203 -213.80018615722656 curveto
187.80018615722656 -213.80018615722656 lineto
187.80018615722656 -213.80018615722656 lineto
189.80018615722656 -213.80018615722656 190.80018615722656 -212.46685282389322 190.80018615722656 -209.80018615722656 curveto
190.80018615722656 -199.00018310546875 lineto
190.80018615722656 -198.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -198.80018615722656 moveto
208.80018615722656 -209.80018615722656 lineto
208.80018615722656 -212.46685282389322 209.80018615722656 -213.80018615722656 211.80018615722656 -213.80018615722656 curveto
283.8001708984375 -213.80018615722656 lineto
283.8001708984375 -213.80018615722656 lineto
285.8001708984375 -213.80018615722656 286.8001708984375 -212.46685282389322 286.8001708984375 -209.80018615722656 curveto
286.8001708984375 -199.00018310546875 lineto
286.8001708984375 -198.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
93.0 -20.0 moveto
93.0 -50.0 lineto
177.0 -50.0 lineto
177.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
93.0 -20.0 moveto
93.0 -50.0 lineto
177.0 -50.0 lineto
177.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
93.0 -53.0 moveto
93.0 -64.0 lineto
93.0 -66.66666666666667 94.0 -68.0 96.0 -68.0 curveto
174.0 -68.0 lineto
174.0 -68.0 lineto
176.0 -68.0 177.0 -66.66666666666667 177.0 -64.0 curveto
177.0 -53.20000076293945 lineto
177.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
93.0 -53.0 moveto
93.0 -64.0 lineto
93.0 -66.66666666666667 94.0 -68.0 96.0 -68.0 curveto
174.0 -68.0 lineto
174.0 -68.0 lineto
176.0 -68.0 177.0 -66.66666666666667 177.0 -64.0 curveto
177.0 -53.20000076293945 lineto
177.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -284.0 moveto
106.0 -284.0 105.0 -285.3333333333333 105.0 -288.0 curveto
105.0 -298.0 lineto
189.0 -298.0 lineto
189.0 -288.0 lineto
189.0 -285.3333333333333 188.0 -284.0 186.0 -284.0 curveto
108.0 -284.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -284.0 moveto
106.0 -284.0 105.0 -285.3333333333333 105.0 -288.0 curveto
105.0 -298.0 lineto
189.0 -298.0 lineto
189.0 -288.0 lineto
189.0 -285.3333333333333 188.0 -284.0 186.0 -284.0 curveto
108.0 -284.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -301.0 moveto
105.0 -330.0 lineto
189.0 -330.0 lineto
189.0 -301.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -301.0 moveto
105.0 -330.0 lineto
189.0 -330.0 lineto
189.0 -301.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -333.0 moveto
105.0 -344.0 lineto
105.0 -346.6666666666667 106.0 -348.0 108.0 -348.0 curveto
186.0 -348.0 lineto
186.0 -348.0 lineto
188.0 -348.0 189.0 -346.6666666666667 189.0 -344.0 curveto
189.0 -333.20001220703125 lineto
189.0 -333.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -333.0 moveto
105.0 -344.0 lineto
105.0 -346.6666666666667 106.0 -348.0 108.0 -348.0 curveto
186.0 -348.0 lineto
186.0 -348.0 lineto
188.0 -348.0 189.0 -346.6666666666667 189.0 -344.0 curveto
189.0 -333.20001220703125 lineto
189.0 -333.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -148.0 moveto
16.0 -148.0 15.0 -149.33333333333334 15.0 -152.0 curveto
15.0 -164.0 lineto
55.0 -164.0 lineto
55.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -148.0 moveto
16.0 -148.0 15.0 -149.33333333333334 15.0 -152.0 curveto
15.0 -164.0 lineto
55.0 -164.0 lineto
55.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
58.0 -148.0 moveto
58.0 -164.0 lineto
93.0 -164.0 lineto
93.0 -152.0 lineto
93.0 -149.33333333333334 92.0 -148.0 90.0 -148.0 curveto
58.20000076293945 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
58.0 -148.0 moveto
58.0 -164.0 lineto
93.0 -164.0 lineto
93.0 -152.0 lineto
93.0 -149.33333333333334 92.0 -148.0 90.0 -148.0 curveto
58.20000076293945 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -148.0 moveto
112.0 -148.0 111.0 -149.33333333333334 111.0 -152.0 curveto
111.0 -164.0 lineto
151.0 -164.0 lineto
151.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -148.0 moveto
112.0 -148.0 111.0 -149.33333333333334 111.0 -152.0 curveto
111.0 -164.0 lineto
151.0 -164.0 lineto
151.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
154.0 -148.0 moveto
154.0 -164.0 lineto
189.0 -164.0 lineto
189.0 -152.0 lineto
189.0 -149.33333333333334 188.0 -148.0 186.0 -148.0 curveto
154.1999969482422 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
154.0 -148.0 moveto
154.0 -164.0 lineto
189.0 -164.0 lineto
189.0 -152.0 lineto
189.0 -149.33333333333334 188.0 -148.0 186.0 -148.0 curveto
154.1999969482422 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -148.0 moveto
208.0 -148.0 207.0 -149.33333333333334 207.0 -152.0 curveto
207.0 -164.0 lineto
247.0 -164.0 lineto
247.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -148.0 moveto
208.0 -148.0 207.0 -149.33333333333334 207.0 -152.0 curveto
207.0 -164.0 lineto
247.0 -164.0 lineto
247.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
250.0 -148.0 moveto
250.0 -164.0 lineto
285.0 -164.0 lineto
285.0 -152.0 lineto
285.0 -149.33333333333334 284.0 -148.0 282.0 -148.0 curveto
250.1999969482422 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
250.0 -148.0 moveto
250.0 -164.0 lineto
285.0 -164.0 lineto
285.0 -152.0 lineto
285.0 -149.33333333333334 284.0 -148.0 282.0 -148.0 curveto
250.1999969482422 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -164.0 moveto
15.0 -194.0 lineto
93.0 -194.0 lineto
93.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -164.0 moveto
15.0 -194.0 lineto
93.0 -194.0 lineto
93.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -164.0 moveto
111.0 -194.0 lineto
189.0 -194.0 lineto
189.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -164.0 moveto
111.0 -194.0 lineto
189.0 -194.0 lineto
189.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -164.0 moveto
207.0 -194.0 lineto
285.0 -194.0 lineto
285.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -164.0 moveto
207.0 -194.0 lineto
285.0 -194.0 lineto
285.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -197.0 moveto
15.0 -208.0 lineto
15.0 -210.66666666666666 16.0 -212.0 18.0 -212.0 curveto
90.0 -212.0 lineto
90.0 -212.0 lineto
92.0 -212.0 93.0 -210.66666666666666 93.0 -208.0 curveto
93.0 -197.1999969482422 lineto
93.0 -197.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -197.0 moveto
15.0 -208.0 lineto
15.0 -210.66666666666666 16.0 -212.0 18.0 -212.0 curveto
90.0 -212.0 lineto
90.0 -212.0 lineto
92.0 -212.0 93.0 -210.66666666666666 93.0 -208.0 curveto
93.0 -197.1999969482422 lineto
93.0 -197.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -197.0 moveto
111.0 -208.0 lineto
111.0 -210.66666666666666 112.0 -212.0 114.0 -212.0 curveto
186.0 -212.0 lineto
186.0 -212.0 lineto
188.0 -212.0 189.0 -210.66666666666666 189.0 -208.0 curveto
189.0 -197.1999969482422 lineto
189.0 -197.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -197.0 moveto
111.0 -208.0 lineto
111.0 -210.66666666666666 112.0 -212.0 114.0 -212.0 curveto
186.0 -212.0 lineto
186.0 -212.0 lineto
188.0 -212.0 189.0 -210.66666666666666 189.0 -208.0 curveto
189.0 -197.1999969482422 lineto
189.0 -197.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -197.0 moveto
207.0 -208.0 lineto
207.0 -210.66666666666666 208.0 -212.0 210.0 -212.0 curveto
282.0 -212.0 lineto
282.0 -212.0 lineto
284.0 -212.0 285.0 -210.66666666666666 285.0 -208.0 curveto
285.0 -197.1999969482422 lineto
285.0 -197.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -197.0 moveto
207.0 -208.0 lineto
207.0 -210.66666666666666 208.0 -212.0 210.0 -212.0 curveto
282.0 -212.0 lineto
282.0 -212.0 lineto
284.0 -212.0 285.0 -210.66666666666666 285.0 -208.0 curveto
285.0 -197.1999969482422 lineto
285.0 -197.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
132.0 -116.0 moveto
78.0 -116.0 lineto
76.0 -116.0 75.0 -117.33333333333333 75.0 -120.0 curveto
75.0 -140.0 lineto
75.0 -140.0 lineto
stroke
newpath
36.0 -136.0 moveto
39.0 -144.0 lineto
42.0 -136.0 lineto
closepath
fill
newpath
72.0 -136.0 moveto
75.0 -144.0 lineto
78.0 -136.0 lineto
closepath
fill
newpath
132.0 -136.0 moveto
135.0 -144.0 lineto
138.0 -136.0 lineto
closepath
fill
newpath
168.0 -136.0 moveto
171.0 -144.0 lineto
174.0 -136.0 lineto
closepath
fill
newpath
228.0 -136.0 moveto
231.0 -144.0 lineto
234.0 -136.0 lineto
closepath
fill
newpath
264.0 -136.0 moveto
267.0 -144.0 lineto
270.0 -136.0 lineto
closepath
fill
newpath
144.0 -272.0 moveto
147.0 -280.0 lineto
150.0 -272.0 lineto
closepath
fill
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
141.0 -116.0 moveto
171.0 -116.0 lineto
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
225.0 -116.0 moveto
171.0 -116.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
171.0 -140.0 moveto
171.0 -116.0 lineto
stroke
newpath
135.0 -68.0 moveto
135.0 -100.0 lineto
stroke
newpath
39.0 -140.0 moveto
39.0 -100.0 lineto
135.0 -100.0 lineto
stroke
newpath
135.0 -140.0 moveto
135.0 -100.0 lineto
stroke
newpath
231.0 -140.0 moveto
231.0 -100.0 lineto
135.0 -100.0 lineto
stroke
newpath
237.0 -116.0 moveto
267.0 -116.0 lineto
stroke
newpath
267.0 -140.0 moveto
267.0 -116.0 lineto
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
147.0 -348.0 moveto
147.0 -376.0 lineto
147.0 -378.6666666666667 148.0 -380.0 150.0 -380.0 curveto
306.0 -380.0 lineto
306.0 -380.0 lineto
308.0 -380.0 309.0 -378.6666666666667 309.0 -376.0 curveto
309.0 -120.0 lineto
309.0 -120.0 lineto
309.0 -117.33333333333333 308.0 -116.0 306.0 -116.0 curveto
267.0 -116.0 lineto
267.0 -116.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
51.0 -212.0 moveto
51.0 -244.0 lineto
147.0 -244.0 lineto
stroke
newpath
147.0 -212.0 moveto
147.0 -244.0 lineto
stroke
newpath
243.0 -212.0 moveto
243.0 -244.0 lineto
147.0 -244.0 lineto
stroke
newpath
147.0 -276.0 moveto
147.0 -244.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
115.0 -39.0 moveto
(Ventilator) show
121.0 -63.0 moveto
(PUSH) show
123.0 -87.0 moveto
(tasks) show
27.0 -127.0 moveto
(task) show
123.0 -127.0 moveto
(task) show
225.0 -127.0 moveto
(task) show
25.0 -159.0 moveto
(PULL) show
67.0 -159.0 moveto
(SUB) show
121.0 -159.0 moveto
(PULL) show
163.0 -159.0 moveto
(SUB) show
217.0 -159.0 moveto
(PULL) show
259.0 -159.0 moveto
(SUB) show
38.0 -183.0 moveto
(Worker) show
134.0 -183.0 moveto
(Worker) show
230.0 -183.0 moveto
(Worker) show
43.0 -207.0 moveto
(PUSH) show
139.0 -207.0 moveto
(PUSH) show
235.0 -207.0 moveto
(PUSH) show
41.0 -231.0 moveto
(result) show
137.0 -231.0 moveto
(result) show
233.0 -231.0 moveto
(result) show
131.0 -263.0 moveto
(results) show
133.0 -295.0 moveto
(PULL) show
134.0 -319.0 moveto
(Sink) show
139.0 -343.0 moveto
(PUB) show
122.0 -367.0 moveto
(KILL signal) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4858 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4858 a Black 3800 5569 a
Ff(48)p Black eop end
%%Page: 49 62
TeXDict begin 49 61 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.49) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:798) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Here)h(is)h(the)g(w)o(ork)o(er)e(process,)g(which)h
(manages)f(tw)o(o)i(sock)o(ets)f(\(a)g(PULL)h(sock)o(et)f(getting)f
(tasks,)i(and)e(a)i(SUB)g(sock)o(et)396 180 y(getting)f(control)f
(commands\))f(using)h(the)i(zmq_poll[3])c(technique)h(we)j(sa)o(w)g
(earlier:)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198
a
SDict begin [/View [/XYZ H.V]/Dest (0:taskwork2-c) cvn /DEST pdfmark
end
 -2 198 a 396 382 a Fg(Example)g(2-3.)e(P)o(arallel)g(task)i(w)o(ork)o
(er)f(with)h(kill)g(signaling)f(\(taskw)o(ork2.c\))-2
482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:801) cvn /DEST pdfmark end
 -2 482 a 396
562 a Fe(//)396 659 y(//)90 b(Task)44 b(worker)g(-)g(design)g(2)396
756 y(//)90 b(Adds)44 b(pub-sub)f(flow)i(to)f(receive)g(and)g(respond)g
(to)g(kill)g(signal)396 853 y(//)396 950 y(#include)g("zhelpers.h")396
1145 y(int)h(main)f(\(void\))396 1242 y({)576 1339 y(void)800
1352 y(*)845 1339 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
1533 y(//)89 b(Socket)44 b(to)g(receive)g(messages)f(on)576
1630 y(void)800 1643 y(*)845 1630 y(receiver)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PULL\);)576 1728 y(zmq_connect)g(\(receiver,)g
("tcp://localhost:5557"\);)576 1922 y(//)89 b(Socket)44
b(to)g(send)g(messages)g(to)576 2019 y(void)800 2032
y(*)845 2019 y(sender)f(=)i(zmq_socket)e(\(context,)h(ZMQ_PUSH\);)576
2116 y(zmq_connect)f(\(sender,)g("tcp://localhost:5558"\);)576
2310 y(//)89 b(Socket)44 b(for)g(control)g(input)576
2407 y(void)800 2420 y(*)845 2407 y(controller)f(=)h(zmq_socket)g
(\(context,)f(ZMQ_SUB\);)576 2505 y(zmq_connect)g(\(controller,)f
("tcp://localhost:5559"\);)576 2602 y(zmq_setsockopt)g(\(controller,)h
(ZMQ_SUBSCRIBE,)f("",)j(0\);)576 2796 y(//)89 b(Process)44
b(messages)f(from)h(receiver)g(and)g(controller)576 2893
y(zmq_pollitem_t)e(items)i([])h(=)f({)755 2990 y({)h(receiver,)e(0,)h
(ZMQ_POLLIN,)f(0)i(},)755 3087 y({)g(controller,)e(0,)h(ZMQ_POLLIN,)f
(0)i(})576 3185 y(};)576 3282 y(//)89 b(Process)44 b(messages)f(from)h
(both)g(sockets)576 3379 y(while)g(\(true\))f({)755 3476
y(zmq_msg_t)g(message;)755 3573 y(zmq_poll)g(\(items,)h(2,)h(-1\);)755
3670 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
3767 y(zmq_msg_init)g(\(&message\);)934 3865 y(zmq_msg_recv)g
(\(&message,)g(receiver,)h(0\);)934 4059 y(//)90 b(Do)44
b(the)g(work)934 4156 y(s_sleep)g(\(atoi)g(\(\(char)1876
4169 y(*)1921 4156 y(\))g(zmq_msg_data)f(\(&message\)\)\);)934
4350 y(//)90 b(Send)44 b(results)f(to)i(sink)934 4447
y(zmq_msg_init)e(\(&message\);)934 4544 y(zmq_msg_send)g(\(&message,)g
(sender,)h(0\);)934 4739 y(//)90 b(Simple)43 b(progress)h(indicator)f
(for)i(the)f(viewer)934 4836 y(printf)g(\("."\);)934
4933 y(fflush)g(\(stdout\);)934 5127 y(zmq_msg_close)f(\(&message\);)p
Black 3800 5569 a Ff(49)p Black eop end
%%Page: 50 63
TeXDict begin 50 62 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.50) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 755 72 a Fe(})755 170 y(//)89 b(Any)45 b(waiting)e(controller)g
(command)h(acts)g(as)h('KILL')755 267 y(if)f(\(items)g([1].revents)f(&)
i(ZMQ_POLLIN\))934 364 y(break;)986 b(//)89 b(Exit)44
b(loop)576 461 y(})576 558 y(//)89 b(Finished)576 655
y(zmq_close)43 b(\(receiver\);)576 752 y(zmq_close)g(\(sender\);)576
850 y(zmq_close)g(\(controller\);)576 947 y(zmq_ctx_destroy)f
(\(context\);)576 1044 y(return)h(0;)396 1141 y(})-2
1315 y
SDict begin H.S end
 -2 1315 a -2 1315 a
SDict begin 13 H.A end
 -2 1315 a -2 1315 a
SDict begin [/View [/XYZ H.V]/Dest (0:802) cvn /DEST pdfmark end
 -2 1315
a 396 1415 a Fk(Here)20 b(is)h(the)g(modi\002ed)e(sink)h(application.)e
(When)i(it')-5 b(s)22 b(\002nished)d(collecting)g(results)i(it)g
(broadcasts)e(a)i(KILL)e(message)396 1523 y(to)i(all)f(w)o(ork)o(ers:)
-2 1524 y
SDict begin H.S end
 -2 1524 a -2 1524 a
SDict begin 13 H.A end
 -2 1524 a -2 1524 a
SDict begin [/View [/XYZ H.V]/Dest (0:tasksink2-c) cvn /DEST pdfmark
end
 -2
1524 a 396 1724 a Fg(Example)h(2-4.)e(P)o(arallel)g(task)i(sink)g(with)
g(kill)g(signaling)f(\(tasksink2.c\))-2 1824 y
SDict begin H.S end
 -2 1824
a -2 1824 a
SDict begin 11.7 H.A end
 -2 1824 a -2 1824 a
SDict begin [/View [/XYZ H.V]/Dest (0:805) cvn /DEST pdfmark end
 -2 1824 a 396 1904 a
Fe(//)396 2001 y(//)90 b(Task)44 b(sink)g(-)h(design)e(2)396
2099 y(//)90 b(Adds)44 b(pub-sub)f(flow)i(to)f(send)g(kill)g(signal)g
(to)h(workers)396 2196 y(//)396 2293 y(#include)f("zhelpers.h")396
2487 y(int)h(main)f(\(void\))396 2584 y({)576 2681 y(void)800
2694 y(*)845 2681 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
2876 y(//)89 b(Socket)44 b(to)g(receive)g(messages)f(on)576
2973 y(void)800 2986 y(*)845 2973 y(receiver)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PULL\);)576 3070 y(zmq_bind)g(\(receiver,)g("tcp://)
1787 3083 y(*)1832 3070 y(:5558"\);)576 3264 y(//)89
b(Socket)44 b(for)g(worker)g(control)576 3361 y(void)800
3374 y(*)845 3361 y(controller)f(=)h(zmq_socket)g(\(context,)f
(ZMQ_PUB\);)576 3459 y(zmq_bind)g(\(controller,)g("tcp://)1877
3472 y(*)1922 3459 y(:5559"\);)576 3653 y(//)89 b(Wait)44
b(for)g(start)g(of)h(batch)576 3750 y(char)800 3763 y(*)845
3750 y(string)e(=)i(s_recv)f(\(receiver\);)576 3847 y(free)g
(\(string\);)576 4041 y(//)89 b(Start)44 b(our)g(clock)g(now)576
4138 y(int64_t)f(start_time)g(=)i(s_clock)f(\(\);)576
4333 y(//)89 b(Process)44 b(100)g(confirmations)576 4430
y(int)g(task_nbr;)576 4527 y(for)g(\(task_nbr)f(=)i(0;)f(task_nbr)g(<)h
(100;)f(task_nbr++\))f({)755 4624 y(char)979 4637 y(*)1024
4624 y(string)h(=)g(s_recv)g(\(receiver\);)755 4721 y(free)g
(\(string\);)755 4818 y(if)g(\(\(task_nbr)g(/)g(10\))1652
4831 y(*)1741 4818 y(10)h(==)f(task_nbr\))934 4916 y(printf)g(\(":"\);)
755 5013 y(else)934 5110 y(printf)g(\("."\);)p Black
3800 5569 a Ff(50)p Black eop end
%%Page: 51 64
TeXDict begin 51 63 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.51) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 755 72 a Fe(fflush)44 b(\(stdout\);)576 170 y(})576
267 y(printf)f(\("Total)h(elapsed)g(time:)g(\045d)g(msec\\n",)755
364 y(\(int\))g(\(s_clock)f(\(\))i(-)g(start_time\)\);)576
558 y(//)89 b(Send)44 b(kill)g(signal)g(to)h(workers)576
655 y(s_send)e(\(controller,)g("KILL"\);)576 850 y(//)89
b(Finished)576 947 y(sleep)44 b(\(1\);)627 b(//)89 b(Give)44
b(0MQ)g(time)h(to)f(deliver)576 1141 y(zmq_close)f(\(receiver\);)576
1238 y(zmq_close)g(\(controller\);)576 1335 y(zmq_ctx_destroy)f
(\(context\);)576 1432 y(return)h(0;)396 1530 y(})-2
1621 y
SDict begin H.S end
 -2 1621 a -2 1621 a
SDict begin 13 H.A end
 -2 1621 a -2 1621 a
SDict begin [/View [/XYZ H.V]/Dest (0:806) cvn /DEST pdfmark end
 -2 1621
a 369 x Fn(2.14.)c(Handling)e(Interrupt)h(Signals)2152
1990 y
SDict begin H.S end
 2152 1990 a 2152 1990 a
SDict begin 22.464 H.A end
 2152 1990 a 2152 1990
a
SDict begin [/View [/XYZ H.V]/Dest (7.35.1) cvn /DEST pdfmark end
 2152 1990 a -2 2188 a
SDict begin H.S end
 -2 2188 a -2 2188 a
SDict begin 13 H.A end
 -2 2188 a
-2 2188 a
SDict begin [/View [/XYZ H.V]/Dest (0:808) cvn /DEST pdfmark end
 -2 2188 a 396 2264 a Fk(Realistic)22 b(applications)d(need)g
(to)h(shutdo)n(wn)f(cleanly)h(when)f(interrupted)f(with)i(Ctrl-C)h(or)f
(another)f(signal)h(such)g(as)396 2372 y(SIGTERM.)g(By)h(def)o(ault,)e
(these)h(simply)g(kill)h(the)f(process,)f(meaning)g(messages)h(w)o(on')
o(t)g(be)g(\003ushed,)f(\002les)i(w)o(on')o(t)e(be)396
2479 y(closed)h(cleanly)-5 b(,)19 b(etc.)-2 2664 y
SDict begin H.S end
 -2
2664 a -2 2664 a
SDict begin 13 H.A end
 -2 2664 a -2 2664 a
SDict begin [/View [/XYZ H.V]/Dest (0:809) cvn /DEST pdfmark end
 -2 2664 a 396 2753
a Fk(Here)h(is)h(ho)n(w)f(we)h(handle)e(a)h(signal)g(in)h(v)n(arious)e
(languages:)-2 2771 y
SDict begin H.S end
 -2 2771 a -2 2771 a
SDict begin 13 H.A end
 -2 2771 a -2
2771 a
SDict begin [/View [/XYZ H.V]/Dest (0:interrupt-c) cvn /DEST pdfmark
end
 -2 2771 a 396 2955 a Fg(Example)i(2-5.)e(Handling)h(Ctrl-C)g
(cleanly)g(\(interrupt.c\))-2 3055 y
SDict begin H.S end
 -2 3055 a -2 3055
a
SDict begin 11.7 H.A end
 -2 3055 a -2 3055 a
SDict begin [/View [/XYZ H.V]/Dest (0:812) cvn /DEST pdfmark end
 -2 3055 a 396 3135 a Fe(//)396
3232 y(//)90 b(Shows)44 b(how)g(to)g(handle)g(Ctrl-C)396
3329 y(//)396 3426 y(#include)g(<zmq.h>)396 3523 y(#include)g
(<stdio.h>)396 3621 y(#include)g(<signal.h>)396 3815
y(//)90 b(-------------------------------------)o(------)o(------)o
(------)o(------)o(-----)o(---)396 3912 y(//)g(Signal)43
b(handling)396 4009 y(//)396 4106 y(//)90 b(Call)44 b
(s_catch_signals\(\))e(in)i(your)g(application)f(at)i(startup,)e(and)i
(then)f(exit)396 4203 y(//)90 b(your)44 b(main)g(loop)g(if)h
(s_interrupted)d(is)j(ever)f(1.)g(Works)g(especially)g(well)g(with)396
4301 y(//)90 b(zmq_poll.)396 4495 y(static)44 b(int)g(s_interrupted)f
(=)i(0;)396 4592 y(static)f(void)g(s_signal_handler)e(\(int)j
(signal_value\))396 4689 y({)576 4786 y(s_interrupted)d(=)j(1;)396
4883 y(})396 5078 y(static)f(void)g(s_catch_signals)f(\(void\))p
Black 3800 5569 a Ff(51)p Black eop end
%%Page: 52 65
TeXDict begin 52 64 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.52) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe({)576 170 y(struct)43 b(sigaction)h(action;)576
267 y(action.sa_handler)e(=)i(s_signal_handler;)576 364
y(action.sa_flags)e(=)j(0;)576 461 y(sigemptyset)e
(\(&action.sa_mask\);)576 558 y(sigaction)g(\(SIGINT,)g(&action,)h
(NULL\);)576 655 y(sigaction)f(\(SIGTERM,)g(&action,)h(NULL\);)396
752 y(})396 947 y(int)h(main)f(\(void\))396 1044 y({)576
1141 y(void)800 1154 y(*)845 1141 y(context)f(=)i(zmq_ctx_new)e(\(\);)
576 1238 y(void)800 1251 y(*)845 1238 y(socket)g(=)i(zmq_socket)e
(\(context,)h(ZMQ_REP\);)576 1335 y(zmq_bind)f(\(socket,)h("tcp://)1698
1348 y(*)1743 1335 y(:5555"\);)576 1530 y(s_catch_signals)e(\(\);)576
1627 y(while)i(\(true\))f({)755 1724 y(//)89 b(Blocking)44
b(read)g(will)g(exit)g(on)h(a)f(signal)755 1821 y(zmq_msg_t)f(message;)
755 1918 y(zmq_msg_init)g(\(&message\);)755 2015 y(zmq_msg_recv)g
(\(&message,)g(socket,)h(0\);)755 2209 y(if)g(\(s_interrupted\))f({)934
2307 y(printf)h(\("W:)g(interrupt)g(received,)f(killing)h
(server...\\n"\);)934 2404 y(break;)755 2501 y(})576
2598 y(})576 2695 y(zmq_close)f(\(socket\);)576 2792
y(zmq_ctx_destroy)f(\(context\);)576 2889 y(return)h(0;)396
2987 y(})-2 3161 y
SDict begin H.S end
 -2 3161 a -2 3161 a
SDict begin 13 H.A end
 -2 3161 a -2 3161
a
SDict begin [/View [/XYZ H.V]/Dest (0:813) cvn /DEST pdfmark end
 -2 3161 a 396 3261 a Fk(The)20 b(program)e(pro)o(vides)h
(s_catch_signals\(\),)f(which)h(traps)h(Ctrl-C)h(\(SIGINT\))e(and)h
(SIGTERM.)g(When)g(either)g(of)396 3368 y(these)h(signals)f(arri)n(v)o
(e,)f(the)h(s_catch_signals\(\))e(handler)h(sets)i(the)f(global)g(v)n
(ariable)f(s_interrupted.)e(Y)-9 b(our)20 b(application)396
3476 y(will)h(not)f(die)g(automatically)-5 b(,)18 b(you)i(ha)n(v)o(e)f
(to)i(no)n(w)e(e)o(xplicitly)g(check)h(for)f(an)h(interrupt,)f(and)g
(handle)h(it)h(properly)-5 b(.)396 3584 y(Here')g(s)21
b(ho)n(w:)-2 3585 y
SDict begin H.S end
 -2 3585 a -2 3585 a
SDict begin 13 H.A end
 -2 3585 a -2
3585 a
SDict begin [/View [/XYZ H.V]/Dest (0:814) cvn /DEST pdfmark end
 -2 3585 a -2 3595 a
SDict begin H.S end
 -2 3595 a -2 3595 a
SDict begin 13 H.A end
 -2 3595
a -2 3595 a
SDict begin [/View [/XYZ H.V]/Dest (0:815) cvn /DEST pdfmark end
 -2 3595 a Black 396 3755 a Fj(\225)p Black
479 3755 a
SDict begin H.S end
 479 3755 a 479 3755 a
SDict begin 13 H.A end
 479 3755 a 479 3755
a
SDict begin [/View [/XYZ H.V]/Dest (0:816) cvn /DEST pdfmark end
 479 3755 a Fk(Call)g(s_catch_signals\(\))e(\(cop)o(y)g(this)h(from)f
(interrupt.c\))f(at)j(the)f(start)h(of)f(your)f(main)h(code.)f(This)h
(sets-up)g(the)479 3862 y(signal)g(handling.)-2 3880
y
SDict begin H.S end
 -2 3880 a -2 3880 a
SDict begin 13 H.A end
 -2 3880 a -2 3880 a
SDict begin [/View [/XYZ H.V]/Dest (0:817) cvn /DEST pdfmark end
 -2 3880 a Black
396 4012 a Fj(\225)p Black 479 4012 a
SDict begin H.S end
 479 4012 a 479
4012 a
SDict begin 13 H.A end
 479 4012 a 479 4012 a
SDict begin [/View [/XYZ H.V]/Dest (0:818) cvn /DEST pdfmark end
 479 4012 a Fk(If)g(your)f(code)h(is)h
(blocking)d(in)j(zmq_msg_recv[3],)15 b(zmq_poll[3],)i(or)j
(zmq_msg_send[3],)c(when)j(a)i(signal)479 4120 y(arri)n(v)o(es,)e(the)i
(call)f(will)h(return)e(with)i(EINTR.)-2 4132 y
SDict begin H.S end
 -2 4132
a -2 4132 a
SDict begin 13 H.A end
 -2 4132 a -2 4132 a
SDict begin [/View [/XYZ H.V]/Dest (0:819) cvn /DEST pdfmark end
 -2 4132 a Black 396 4269
a Fj(\225)p Black 479 4269 a
SDict begin H.S end
 479 4269 a 479 4269 a
SDict begin 13 H.A end
 479
4269 a 479 4269 a
SDict begin [/View [/XYZ H.V]/Dest (0:820) cvn /DEST pdfmark end
 479 4269 a Fk(Wrappers)f(lik)o(e)g(s_recv\(\))f
(return)g(NULL)h(if)h(the)o(y)e(are)h(interrupted.)-2
4287 y
SDict begin H.S end
 -2 4287 a -2 4287 a
SDict begin 13 H.A end
 -2 4287 a -2 4287 a
SDict begin [/View [/XYZ H.V]/Dest (0:821) cvn /DEST pdfmark end
 -2 4287
a Black 396 4419 a Fj(\225)p Black 479 4419 a
SDict begin H.S end
 479 4419
a 479 4419 a
SDict begin 13 H.A end
 479 4419 a 479 4419 a
SDict begin [/View [/XYZ H.V]/Dest (0:822) cvn /DEST pdfmark end
 479 4419 a Fk(So,)g(your)f
(application)g(checks)h(for)f(an)h(EINTR)h(return)e(code,)g(a)h(NULL)h
(return,)d(and/or)h(s_interrupted.)-2 4603 y
SDict begin H.S end
 -2 4603
a -2 4603 a
SDict begin 13 H.A end
 -2 4603 a -2 4603 a
SDict begin [/View [/XYZ H.V]/Dest (0:823) cvn /DEST pdfmark end
 -2 4603 a 396 4693 a
Fk(Here)h(is)h(a)g(typical)f(code)f(fragment:)-2 4794
y
SDict begin H.S end
 -2 4794 a -2 4794 a
SDict begin 11.7 H.A end
 -2 4794 a -2 4794 a
SDict begin [/View [/XYZ H.V]/Dest (0:824) cvn /DEST pdfmark end
 -2 4794 a 396
4873 a Fe(s_catch_signals)43 b(\(\);)396 4970 y(client)h(=)h
(zmq_socket)e(\(...\);)396 5067 y(while)h(\(!s_interrupted\))e({)576
5164 y(char)800 5177 y(*)845 5164 y(message)h(=)i(s_recv)f(\(client\);)
p Black 3800 5569 a Ff(52)p Black eop end
%%Page: 53 66
TeXDict begin 53 65 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.53) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(if)44 b(\(!message\))755 170 y(break;)447
b(//)90 b(Ctrl-C)43 b(used)396 267 y(})396 364 y(zmq_close)h
(\(client\);)-2 541 y
SDict begin H.S end
 -2 541 a -2 541 a
SDict begin 13 H.A end
 -2 541 a -2 541
a
SDict begin [/View [/XYZ H.V]/Dest (0:825) cvn /DEST pdfmark end
 -2 541 a 396 638 a Fk(If)20 b(you)g(call)g(s_catch_signals\(\))e(and)
i(don')o(t)f(test)i(for)e(interrupts,)g(the)h(your)f(application)g
(will)i(become)e(immune)g(to)396 746 y(Ctrl-C)i(and)f(SIGTERM,)g(which)
f(may)h(be)g(useful,)g(b)n(ut)g(is)h(usually)f(not.)-2
774 y
SDict begin H.S end
 -2 774 a -2 774 a
SDict begin 13 H.A end
 -2 774 a -2 774 a
SDict begin [/View [/XYZ H.V]/Dest (0:826) cvn /DEST pdfmark end
 -2 774 a 359
x Fn(2.15.)39 b(Detecting)e(Memor)q(y)i(Leaks)2050 1133
y
SDict begin H.S end
 2050 1133 a 2050 1133 a
SDict begin 22.464 H.A end
 2050 1133 a 2050 1133 a
SDict begin [/View [/XYZ H.V]/Dest (7.36.1) cvn /DEST pdfmark end
 2050
1133 a -2 1331 a
SDict begin H.S end
 -2 1331 a -2 1331 a
SDict begin 13 H.A end
 -2 1331 a -2 1331
a
SDict begin [/View [/XYZ H.V]/Dest (0:828) cvn /DEST pdfmark end
 -2 1331 a 396 1407 a Fk(An)o(y)20 b(long-running)c(application)j(has)
h(to)h(manage)d(memory)h(correctly)-5 b(,)18 b(or)i(e)n(v)o(entually)e
(it')o(ll)j(use)g(up)e(all)i(a)n(v)n(ailable)396 1515
y(memory)e(and)g(crash.)h(If)g(you)f(use)i(a)f(language)f(that)h
(handles)g(this)g(automatically)f(for)h(you,)f(congratulations.)e(If)j
(you)396 1623 y(program)e(in)j(C)g(or)f(C++)g(or)g(an)o(y)g(other)f
(language)g(where)g(you')l(re)f(responsible)h(for)h(memory)e
(management,)g(here')-5 b(s)20 b(a)396 1731 y(short)g(tutorial)g(on)f
(using)h(v)n(algrind,)e(which)i(among)f(other)g(things)h(will)h(report)
e(on)g(an)o(y)h(leaks)g(your)f(programs)f(ha)n(v)o(e.)-2
1749 y
SDict begin H.S end
 -2 1749 a -2 1749 a
SDict begin 13 H.A end
 -2 1749 a -2 1749 a
SDict begin [/View [/XYZ H.V]/Dest (0:829) cvn /DEST pdfmark end
 -2 1749
a -2 1759 a
SDict begin H.S end
 -2 1759 a -2 1759 a
SDict begin 13 H.A end
 -2 1759 a -2 1759 a
SDict begin [/View [/XYZ H.V]/Dest (0:830) cvn /DEST pdfmark end
 -2
1759 a Black 396 1901 a Fj(\225)p Black 479 1901 a
SDict begin H.S end
 479
1901 a 479 1901 a
SDict begin 13 H.A end
 479 1901 a 479 1901 a
SDict begin [/View [/XYZ H.V]/Dest (0:831) cvn /DEST pdfmark end
 479 1901 a Fk(T)-7
b(o)21 b(install)f(v)n(algrind,)f(e.g.)g(on)h(Ub)n(untu)f(or)h(Debian:)
2012 1901 y
SDict begin H.S end
 2012 1901 a 2012 1901 a
SDict begin 13 H.A end
 2012 1901 a 2012
1901 a
SDict begin [/View [/XYZ H.V]/Dest (0:832) cvn /DEST pdfmark end
 2012 1901 a Fe(sudo)44 b(apt-get)f(install)h(valgrind)p
Fk(.)-2 1919 y
SDict begin H.S end
 -2 1919 a -2 1919 a
SDict begin 13 H.A end
 -2 1919 a -2 1919
a
SDict begin [/View [/XYZ H.V]/Dest (0:833) cvn /DEST pdfmark end
 -2 1919 a Black 396 2051 a Fj(\225)p Black 479 2051
a
SDict begin H.S end
 479 2051 a 479 2051 a
SDict begin 13 H.A end
 479 2051 a 479 2051 a
SDict begin [/View [/XYZ H.V]/Dest (0:834) cvn /DEST pdfmark end
 479 2051
a Fk(By)21 b(def)o(ault,)e(\330MQ)i(will)g(cause)f(v)n(algrind)e(to)i
(complain)f(a)i(lot.)f(T)-7 b(o)20 b(remo)o(v)o(e)f(these)h(w)o
(arnings,)f(create)h(a)h(\002le)479 2159 y
SDict begin H.S end
 479 2159 a
479 2159 a
SDict begin 13 H.A end
 479 2159 a 479 2159 a
SDict begin [/View [/XYZ H.V]/Dest (0:835) cvn /DEST pdfmark end
 479 2159 a Fe(valgrind.supp)e
Fk(that)h(contains)g(this:)-2 2253 y
SDict begin H.S end
 -2 2253 a -2 2253
a
SDict begin 11.7 H.A end
 -2 2253 a -2 2253 a
SDict begin [/View [/XYZ H.V]/Dest (0:836) cvn /DEST pdfmark end
 -2 2253 a 396 2339 a Fe({)531 2436
y(<socketcall_sendto>)531 2533 y(Memcheck:Param)531 2630
y(socketcall.sendto\(msg\))531 2727 y(fun:send)531 2824
y(...)396 2922 y(})396 3019 y({)531 3116 y(<socketcall_sendto>)531
3213 y(Memcheck:Param)531 3310 y(socketcall.send\(msg\))531
3407 y(fun:send)531 3504 y(...)396 3602 y(})-2 3610 y
SDict begin H.S end

-2 3610 a -2 3610 a
SDict begin 13 H.A end
 -2 3610 a -2 3610 a
SDict begin [/View [/XYZ H.V]/Dest (0:837) cvn /DEST pdfmark end
 -2 3610 a -2
3693 a
SDict begin H.S end
 -2 3693 a -2 3693 a
SDict begin 13 H.A end
 -2 3693 a -2 3693 a
SDict begin [/View [/XYZ H.V]/Dest (0:838) cvn /DEST pdfmark end
 -2 3693
a Black 396 3959 a Fj(\225)p Black 479 3959 a
SDict begin H.S end
 479 3959
a 479 3959 a
SDict begin 13 H.A end
 479 3959 a 479 3959 a
SDict begin [/View [/XYZ H.V]/Dest (0:839) cvn /DEST pdfmark end
 479 3959 a Fk(Fix)h(your)e
(applications)g(to)h(e)o(xit)g(cleanly)g(after)f(Ctrl-C.)i(F)o(or)f(an)
o(y)f(application)g(that)h(e)o(xits)h(by)f(itself,)g(that')-5
b(s)21 b(not)479 4066 y(needed,)e(b)n(ut)h(for)g(long-running)c
(applications,)j(this)h(is)i(essential,)e(otherwise)g(v)n(algrind)e
(will)j(complain)e(about)g(all)479 4174 y(currently)g(allocated)g
(memory)-5 b(.)-2 4192 y
SDict begin H.S end
 -2 4192 a -2 4192 a
SDict begin 13 H.A end
 -2 4192
a -2 4192 a
SDict begin [/View [/XYZ H.V]/Dest (0:840) cvn /DEST pdfmark end
 -2 4192 a Black 396 4324 a Fj(\225)p Black
479 4324 a
SDict begin H.S end
 479 4324 a 479 4324 a
SDict begin 13 H.A end
 479 4324 a 479 4324
a
SDict begin [/View [/XYZ H.V]/Dest (0:841) cvn /DEST pdfmark end
 479 4324 a Fk(Build)21 b(your)e(application)f(with)j(-DDEB)o(UG,)f
(if)g(it')-5 b(s)22 b(not)d(your)g(def)o(ault)h(setting.)g(That)g
(ensures)f(v)n(algrind)g(can)h(tell)479 4432 y(you)g(e)o(xactly)f
(where)g(memory)g(is)i(being)e(leak)o(ed.)-2 4450 y
SDict begin H.S end
 -2
4450 a -2 4450 a
SDict begin 13 H.A end
 -2 4450 a -2 4450 a
SDict begin [/View [/XYZ H.V]/Dest (0:842) cvn /DEST pdfmark end
 -2 4450 a Black
396 4581 a Fj(\225)p Black 479 4581 a
SDict begin H.S end
 479 4581 a 479
4581 a
SDict begin 13 H.A end
 479 4581 a 479 4581 a
SDict begin [/View [/XYZ H.V]/Dest (0:843) cvn /DEST pdfmark end
 479 4581 a Fk(Finally)-5
b(,)20 b(run)f(v)n(algrind)f(thus:)-2 4682 y
SDict begin H.S end
 -2 4682
a -2 4682 a
SDict begin 11.7 H.A end
 -2 4682 a -2 4682 a
SDict begin [/View [/XYZ H.V]/Dest (0:844) cvn /DEST pdfmark end
 -2 4682 a 396 4761 a
Fe(valgrind)44 b(--tool=memcheck)e(--leak-check=full)g
(--suppressions=valgrind.supp)e(someprog)-2 4939 y
SDict begin H.S end
 -2
4939 a -2 4939 a
SDict begin 13 H.A end
 -2 4939 a -2 4939 a
SDict begin [/View [/XYZ H.V]/Dest (0:845) cvn /DEST pdfmark end
 -2 4939 a 396 5035
a Fk(And)20 b(after)g(\002xing)f(an)o(y)h(errors)f(it)i(reported,)d
(you)h(should)h(get)g(the)g(pleasant)g(message:)p Black
3800 5569 a Ff(53)p Black eop end
%%Page: 54 67
TeXDict begin 54 66 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.54) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:846) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fe(==30536==)44 b(ERROR)g(SUMMARY:)f(0)i(errors)f(from)g
(0)g(contexts...)-2 157 y
SDict begin H.S end
 -2 157 a -2 157 a
SDict begin 13 H.A end
 -2 157 a
-2 157 a
SDict begin [/View [/XYZ H.V]/Dest (0:847) cvn /DEST pdfmark end
 -2 157 a 376 x Fn(2.16.)39 b(Multi-par)s(t)e(Messa)o(g)q(es)
1741 533 y
SDict begin H.S end
 1741 533 a 1741 533 a
SDict begin 22.464 H.A end
 1741 533 a 1741 533
a
SDict begin [/View [/XYZ H.V]/Dest (7.37.1) cvn /DEST pdfmark end
 1741 533 a -2 731 a
SDict begin H.S end
 -2 731 a -2 731 a
SDict begin 13 H.A end
 -2 731 a -2 731
a
SDict begin [/View [/XYZ H.V]/Dest (0:849) cvn /DEST pdfmark end
 -2 731 a 396 807 a Fk(\330MQ)21 b(lets)g(us)f(compose)f(a)i(message)f
(out)g(of)g(se)n(v)o(eral)f(frames,)h(gi)n(ving)e(us)j(a)g('multi-part)
d(message'.)i(Realistic)396 915 y(applications)f(use)i(multi-part)e
(messages)h(hea)n(vily)-5 b(,)19 b(both)g(for)h(wrapping)e(messages)i
(with)h(address)e(information,)f(and)396 1022 y(for)i(simple)g
(serialization.)f(W)-7 b(e')o(ll)22 b(look)d(at)i(address)e(en)m(v)o
(elopes)g(later)-5 b(.)-2 1206 y
SDict begin H.S end
 -2 1206 a -2 1206 a
SDict begin 13 H.A end

-2 1206 a -2 1206 a
SDict begin [/View [/XYZ H.V]/Dest (0:850) cvn /DEST pdfmark end
 -2 1206 a 396 1296 a Fk(What)21 b(we')o(ll)f(learn)
g(no)n(w)g(is)h(simply)f(ho)n(w)f(to)i(safely)f(\(b)n(ut)g(blindly\))e
(read)i(and)f(write)i(multi-part)e(messages)h(in)g(an)o(y)396
1404 y(application)f(\(lik)o(e)h(a)h(proxy\))d(that)i(needs)g(to)g
(forw)o(ard)f(messages)h(without)g(inspecting)f(them.)-2
1588 y
SDict begin H.S end
 -2 1588 a -2 1588 a
SDict begin 13 H.A end
 -2 1588 a -2 1588 a
SDict begin [/View [/XYZ H.V]/Dest (0:851) cvn /DEST pdfmark end
 -2 1588
a 396 1678 a Fk(When)h(you)g(w)o(ork)f(with)h(multi-part)f(messages,)h
(each)g(part)g(is)h(a)g(zmq_msg)d(item.)j(E.g.)e(if)i(you)e(are)h
(sending)f(a)396 1786 y(message)h(with)h(\002)n(v)o(e)f(parts,)g(you)f
(must)h(construct,)f(send,)h(and)f(destro)o(y)h(\002)n(v)o(e)g(zmq_msg)
e(items.)j(Y)-9 b(ou)19 b(can)h(do)g(this)h(in)396 1894
y(adv)n(ance)e(\(and)g(store)h(the)h(zmq_msg)d(items)j(in)f(an)g(array)
g(or)g(structure\),)e(or)i(as)h(you)e(send)h(them,)g(one)f(by)h(one.)-2
2078 y
SDict begin H.S end
 -2 2078 a -2 2078 a
SDict begin 13 H.A end
 -2 2078 a -2 2078 a
SDict begin [/View [/XYZ H.V]/Dest (0:852) cvn /DEST pdfmark end
 -2 2078
a 396 2168 a Fk(Here)g(is)h(ho)n(w)f(we)h(send)f(the)g(frames)f(in)i(a)
f(multi-part)f(message)h(\(we)g(recei)n(v)o(e)g(each)f(frame)h(into)g
(a)g(message)g(object\):)-2 2269 y
SDict begin H.S end
 -2 2269 a -2 2269
a
SDict begin 11.7 H.A end
 -2 2269 a -2 2269 a
SDict begin [/View [/XYZ H.V]/Dest (0:853) cvn /DEST pdfmark end
 -2 2269 a 396 2348 a Fe(zmq_msg_send)43
b(\(socket,)h(&message,)f(ZMQ_SNDMORE\);)396 2445 y(...)396
2543 y(zmq_msg_send)g(\(socket,)h(&message,)f(ZMQ_SNDMORE\);)396
2640 y(...)396 2737 y(zmq_msg_send)g(\(socket,)h(&message,)f(0\);)-2
2914 y
SDict begin H.S end
 -2 2914 a -2 2914 a
SDict begin 13 H.A end
 -2 2914 a -2 2914 a
SDict begin [/View [/XYZ H.V]/Dest (0:854) cvn /DEST pdfmark end
 -2 2914
a 396 3011 a Fk(Here)20 b(is)h(ho)n(w)f(we)h(recei)n(v)o(e)e(and)g
(process)h(all)h(the)f(parts)g(in)h(a)f(message,)g(be)g(it)h(single)f
(part)g(or)g(multi-part:)-2 3112 y
SDict begin H.S end
 -2 3112 a -2 3112
a
SDict begin 11.7 H.A end
 -2 3112 a -2 3112 a
SDict begin [/View [/XYZ H.V]/Dest (0:855) cvn /DEST pdfmark end
 -2 3112 a 396 3191 a Fe(while)44
b(\(1\))h({)576 3288 y(zmq_msg_t)e(message;)576 3385
y(zmq_msg_init)f(\(&message\);)576 3482 y(zmq_msg_recv)g(\(socket,)i
(&message,)f(0\);)576 3580 y(//)89 b(Process)44 b(the)g(message)g
(frame)576 3677 y(zmq_msg_close)e(\(&message\);)576 3774
y(int64_t)h(more;)576 3871 y(size_t)g(more_size)h(=)g(sizeof)g
(\(more\);)576 3968 y(zmq_getsockopt)e(\(socket,)i(ZMQ_RCVMORE,)e
(&more,)i(&more_size\);)576 4065 y(if)g(\(!more\))755
4162 y(break;)268 b(//)89 b(Last)44 b(message)g(frame)396
4259 y(})-2 4434 y
SDict begin H.S end
 -2 4434 a -2 4434 a
SDict begin 13 H.A end
 -2 4434 a -2 4434
a
SDict begin [/View [/XYZ H.V]/Dest (0:856) cvn /DEST pdfmark end
 -2 4434 a 396 4533 a Fk(Some)20 b(things)g(to)g(kno)n(w)f(about)h
(multi-part)e(messages:)-2 4551 y
SDict begin H.S end
 -2 4551 a -2 4551 a
SDict begin 13 H.A end

-2 4551 a -2 4551 a
SDict begin [/View [/XYZ H.V]/Dest (0:857) cvn /DEST pdfmark end
 -2 4551 a -2 4561 a
SDict begin H.S end
 -2 4561 a -2
4561 a
SDict begin 13 H.A end
 -2 4561 a -2 4561 a
SDict begin [/View [/XYZ H.V]/Dest (0:858) cvn /DEST pdfmark end
 -2 4561 a Black 396 4704 a
Fj(\225)p Black 479 4704 a
SDict begin H.S end
 479 4704 a 479 4704 a
SDict begin 13 H.A end
 479
4704 a 479 4704 a
SDict begin [/View [/XYZ H.V]/Dest (0:859) cvn /DEST pdfmark end
 479 4704 a Fk(When)i(you)g(send)g(a)g(multi-part)f
(message,)h(the)g(\002rst)h(part)f(\(and)f(all)i(follo)n(wing)d
(parts\))i(are)g(only)g(actually)f(sent)i(on)479 4812
y(the)f(wire)h(when)e(you)h(send)g(the)g(\002nal)g(part.)-2
4830 y
SDict begin H.S end
 -2 4830 a -2 4830 a
SDict begin 13 H.A end
 -2 4830 a -2 4830 a
SDict begin [/View [/XYZ H.V]/Dest (0:860) cvn /DEST pdfmark end
 -2 4830
a Black 396 4961 a Fj(\225)p Black 479 4961 a
SDict begin H.S end
 479 4961
a 479 4961 a
SDict begin 13 H.A end
 479 4961 a 479 4961 a
SDict begin [/View [/XYZ H.V]/Dest (0:861) cvn /DEST pdfmark end
 479 4961 a Fk(If)g(you)g(are)g
(using)f(zmq_poll[3],)e(when)j(you)f(recei)n(v)o(e)g(the)i(\002rst)g
(part)e(of)h(a)h(message,)f(all)g(the)h(rest)f(has)h(also)f(arri)n(v)o
(ed.)-2 4979 y
SDict begin H.S end
 -2 4979 a -2 4979 a
SDict begin 13 H.A end
 -2 4979 a -2 4979
a
SDict begin [/View [/XYZ H.V]/Dest (0:862) cvn /DEST pdfmark end
 -2 4979 a Black 396 5110 a Fj(\225)p Black 479 5110
a
SDict begin H.S end
 479 5110 a 479 5110 a
SDict begin 13 H.A end
 479 5110 a 479 5110 a
SDict begin [/View [/XYZ H.V]/Dest (0:863) cvn /DEST pdfmark end
 479 5110
a Fk(Y)-9 b(ou)20 b(will)h(recei)n(v)o(e)e(all)i(parts)f(of)g(a)g
(message,)g(or)g(none)f(at)i(all.)-2 5128 y
SDict begin H.S end
 -2 5128 a
-2 5128 a
SDict begin 13 H.A end
 -2 5128 a -2 5128 a
SDict begin [/View [/XYZ H.V]/Dest (0:864) cvn /DEST pdfmark end
 -2 5128 a Black 3800 5569
a Ff(54)p Black eop end
%%Page: 55 68
TeXDict begin 55 67 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.55) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:887) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:865) cvn /DEST pdfmark end
 479 72 a Fk(Each)h(part)g(of)g(a)g
(message)g(is)i(a)e(separate)g(zmq_msg)f(item.)-2 90
y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:866) cvn /DEST pdfmark end
 -2 90 a Black 396 222
a Fj(\225)p Black 479 222 a
SDict begin H.S end
 479 222 a 479 222 a
SDict begin 13 H.A end
 479 222
a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:867) cvn /DEST pdfmark end
 479 222 a Fk(Y)-9 b(ou)20 b(will)h(recei)n(v)o(e)e(all)i
(parts)f(of)g(a)g(message)g(whether)g(or)f(not)h(you)g(check)f(the)h
(RCVMORE)h(option.)-2 240 y
SDict begin H.S end
 -2 240 a -2 240 a
SDict begin 13 H.A end
 -2 240
a -2 240 a
SDict begin [/View [/XYZ H.V]/Dest (0:868) cvn /DEST pdfmark end
 -2 240 a Black 396 371 a Fj(\225)p Black 479
371 a
SDict begin H.S end
 479 371 a 479 371 a
SDict begin 13 H.A end
 479 371 a 479 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:869) cvn /DEST pdfmark end
 479 371
a Fk(On)f(sending,)f(\330MQ)i(queues)e(message)h(frames)g(in)g(memory)f
(until)h(the)g(last)h(is)g(recei)n(v)o(ed,)d(then)i(sends)g(them)g
(all.)-2 389 y
SDict begin H.S end
 -2 389 a -2 389 a
SDict begin 13 H.A end
 -2 389 a -2 389 a
SDict begin [/View [/XYZ H.V]/Dest (0:870) cvn /DEST pdfmark end
 -2
389 a Black 396 521 a Fj(\225)p Black 479 521 a
SDict begin H.S end
 479 521
a 479 521 a
SDict begin 13 H.A end
 479 521 a 479 521 a
SDict begin [/View [/XYZ H.V]/Dest (0:871) cvn /DEST pdfmark end
 479 521 a Fk(There)g(is)h(no)f(w)o(ay)g
(to)g(cancel)g(a)h(partially)e(sent)i(message,)e(e)o(xcept)g(by)h
(closing)g(the)g(sock)o(et.)-2 580 y
SDict begin H.S end
 -2 580 a -2 580
a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:872) cvn /DEST pdfmark end
 -2 580 a 359 x Fn(2.17.)39 b(Intermediaries)d(and)j
(Pr)m(o)l(xies)2185 939 y
SDict begin H.S end
 2185 939 a 2185 939 a
SDict begin 22.464 H.A end
 2185
939 a 2185 939 a
SDict begin [/View [/XYZ H.V]/Dest (7.38.1) cvn /DEST pdfmark end
 2185 939 a -2 1107 a
SDict begin H.S end
 -2 1107 a -2 1107
a
SDict begin 13 H.A end
 -2 1107 a -2 1107 a
SDict begin [/View [/XYZ H.V]/Dest (0:874) cvn /DEST pdfmark end
 -2 1107 a 396 1213 a Fk(\330MQ)21
b(aims)f(for)g(decentralized)e(intelligence)h(b)n(ut)i(that)f(doesn')o
(t)e(mean)i(your)f(netw)o(ork)g(is)i(empty)e(space)i(in)f(the)396
1321 y(middle.)f(It')-5 b(s)21 b(\002lled)g(with)f(message-a)o(w)o(are)
f(infrastructure)f(and)h(quite)h(often,)f(we)i(b)n(uild)f(that)g
(infrastructure)e(with)396 1429 y(\330MQ.)i(The)g(\330MQ)h(plumbing)d
(can)i(range)f(from)g(tin)o(y)h(pipes)g(to)g(full-blo)n(wn)e
(service-oriented)g(brok)o(ers.)h(The)396 1537 y(messaging)g(industry)f
(calls)i(this)g("intermediation",)c(meaning)i(that)i(the)f(stuf)n(f)g
(in)h(the)f(middle)g(deals)g(with)h(either)f(side.)396
1645 y(In)h(\330MQ)h(we)f(call)h(these)f(proxies,)f(queues,)g(forw)o
(arders,)f(de)n(vice,)i(or)f(brok)o(ers,)g(depending)f(on)i(the)g
(conte)o(xt.)-2 1829 y
SDict begin H.S end
 -2 1829 a -2 1829 a
SDict begin 13 H.A end
 -2 1829 a
-2 1829 a
SDict begin [/View [/XYZ H.V]/Dest (0:875) cvn /DEST pdfmark end
 -2 1829 a 396 1919 a Fk(This)h(pattern)e(is)i(e)o(xtremely)e
(common)f(in)i(the)g(real)h(w)o(orld)e(and)h(is)h(why)e(our)h
(societies)g(and)g(economies)f(are)h(\002lled)396 2027
y(with)h(intermediaries)d(who)i(ha)n(v)o(e)g(no)f(other)h(real)g
(function)e(than)i(to)h(reduce)e(the)h(comple)o(xity)e(and)h(scaling)h
(costs)h(of)396 2135 y(lar)o(ger)e(netw)o(orks.)g(Real-w)o(orld)h
(intermediaries)e(are)i(typically)g(called)g(wholesalers,)f(distrib)n
(utors,)g(managers,)g(etc.)-2 2153 y
SDict begin H.S end
 -2 2153 a -2 2153
a
SDict begin 13 H.A end
 -2 2153 a -2 2153 a
SDict begin [/View [/XYZ H.V]/Dest (0:876) cvn /DEST pdfmark end
 -2 2153 a 396 2463 a Fb(2.17.1.)36
b(The)e(Dynamic)h(Disco)n(ver)q(y)h(Pr)n(ob)o(lem)2651
2463 y
SDict begin H.S end
 2651 2463 a 2651 2463 a
SDict begin 18.72 H.A end
 2651 2463 a 2651 2463
a
SDict begin [/View [/XYZ H.V]/Dest (7.38.1.2) cvn /DEST pdfmark end
 2651 2463 a -2 2654 a
SDict begin H.S end
 -2 2654 a -2 2654 a
SDict begin 13 H.A end
 -2 2654 a
-2 2654 a
SDict begin [/View [/XYZ H.V]/Dest (0:878) cvn /DEST pdfmark end
 -2 2654 a 396 2737 a Fk(One)20 b(of)g(the)g(problems)f(you)h
(will)g(hit)h(as)g(you)e(design)h(lar)o(ger)e(distrib)n(uted)i
(architectures)f(is)i(disco)o(v)o(ery)-5 b(.)17 b(That)j(is,)h(ho)n(w)
396 2845 y(do)f(pieces)g(kno)n(w)f(about)h(each)f(other?)h(It')-5
b(s)21 b(especially)e(dif)n(\002cult)h(if)g(pieces)h(come)e(and)h(go,)f
(thus)i(we)f(can)g(call)h(this)f(the)396 2953 y("dynamic)f(disco)o(v)o
(ery)f(problem".)-2 3137 y
SDict begin H.S end
 -2 3137 a -2 3137 a
SDict begin 13 H.A end
 -2 3137
a -2 3137 a
SDict begin [/View [/XYZ H.V]/Dest (0:879) cvn /DEST pdfmark end
 -2 3137 a 396 3227 a Fk(There)i(are)g(se)n(v)o(eral)f
(solutions)h(to)g(dynamic)f(disco)o(v)o(ery)-5 b(.)17
b(The)j(simplest)h(is)g(to)f(entirely)g(a)n(v)n(oid)g(it)g(by)g
(hard-coding)d(\(or)396 3335 y(con\002guring\))g(the)k(netw)o(ork)e
(architecture)f(so)j(disco)o(v)o(ery)d(is)j(done)e(by)h(hand.)f(That)h
(is,)h(when)e(you)h(add)f(a)i(ne)n(w)f(piece,)396 3443
y(you)g(recon\002gure)d(the)k(netw)o(ork)e(to)h(kno)n(w)f(about)g(it.)
-2 3627 y
SDict begin H.S end
 -2 3627 a -2 3627 a
SDict begin 13 H.A end
 -2 3627 a -2 3627 a
SDict begin [/View [/XYZ H.V]/Dest (0:880) cvn /DEST pdfmark end
 -2
3627 a 396 3717 a Fk(In)h(practice)g(this)g(leads)h(to)f(increasingly)f
(fragile)g(and)h(hard-to-manage)c(architectures.)j(Let')-5
b(s)21 b(say)f(you)f(ha)n(v)o(e)h(one)396 3825 y(publisher)f(and)h(a)g
(hundred)e(subscribers.)h(Y)-9 b(ou)20 b(connect)f(each)h(subscriber)e
(to)j(the)f(publisher)f(by)h(con\002guring)d(a)396 3933
y(publisher)i(endpoint)f(in)j(each)f(subscriber)-5 b(.)19
b(That')-5 b(s)20 b(easy\()p 0 TeXcolorgray 2078 3933
a
SDict begin H.S end
 2078 3933 a Fk(Figure)f(2-6)2427 3933 y
SDict begin 13 H.L end
 2427 3933 a
2427 3933 a
SDict begin [/Subtype /Link/Dest (0:figure-15) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2427 3933 a Black -2 w Fk(\).)i(Subscribers)e(are)h
(dynamic,)e(the)i(publisher)f(is)396 4040 y(static.)i(No)n(w)f(say)h
(you)e(add)g(more)h(publishers.)f(Suddenly)f(it')-5 b(s)21
b(not)f(so)h(easy)f(an)o(y)f(more.)h(If)g(you)f(continue)g(to)h
(connect)396 4148 y(each)g(subscriber)f(to)h(each)g(publisher)m(,)e
(the)j(cost)f(of)g(a)n(v)n(oiding)f(dynamic)g(disco)o(v)o(ery)f(gets)i
(higher)f(and)h(higher)-5 b(.)-2 4166 y
SDict begin H.S end
 -2 4166 a -2
4166 a
SDict begin 13 H.A end
 -2 4166 a -2 4166 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-15) cvn /DEST pdfmark
end
 -2 4166 a Black 3800 5569
a Ff(55)p Black eop end
%%Page: 56 69
TeXDict begin 56 68 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.56) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:896) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-6.)f(Small-scale)h(Pub-Sub)h(Netw)o
(ork)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:884) cvn /DEST pdfmark end
 -2
172 a 396 1947 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1947 a @beginspecial 0 @llx -208
@lly 312 @urx 0 @ury 3120 @rwi @setspecial
%%BeginDocument: images/fig15.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -208 312 0
%%HiResBoundingBox: 0.0 -208.0 312.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -21.800180435180664 moveto
118.80017852783203 -51.80017852783203 lineto
190.80018615722656 -51.80017852783203 lineto
190.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -54.80017852783203 moveto
118.80017852783203 -65.80017852783203 lineto
118.80017852783203 -68.4668451944987 119.80017852783203 -69.80017852783203 121.80017852783203 -69.80017852783203 curveto
187.80018615722656 -69.80017852783203 lineto
187.80018615722656 -69.80017852783203 lineto
189.80018615722656 -69.80017852783203 190.80018615722656 -68.4668451944987 190.80018615722656 -65.80017852783203 curveto
190.80018615722656 -55.000179290771484 lineto
190.80018615722656 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -141.80018615722656 moveto
17.800180435180664 -141.80018615722656 16.800180435180664 -143.1335194905599 16.800180435180664 -145.80018615722656 curveto
16.800180435180664 -155.80018615722656 lineto
94.80017852783203 -155.80018615722656 lineto
94.80017852783203 -145.80018615722656 lineto
94.80017852783203 -143.1335194905599 93.80017852783203 -141.80018615722656 91.80017852783203 -141.80018615722656 curveto
19.800180435180664 -141.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -158.80018615722656 moveto
16.800180435180664 -189.80018615722656 lineto
94.80017852783203 -189.80018615722656 lineto
94.80017852783203 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.80017852783203 -141.80018615722656 moveto
119.80017852783203 -141.80018615722656 118.80017852783203 -143.1335194905599 118.80017852783203 -145.80018615722656 curveto
118.80017852783203 -155.80018615722656 lineto
196.80018615722656 -155.80018615722656 lineto
196.80018615722656 -145.80018615722656 lineto
196.80018615722656 -143.1335194905599 195.80018615722656 -141.80018615722656 193.80018615722656 -141.80018615722656 curveto
121.80017852783203 -141.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -158.80018615722656 moveto
118.80017852783203 -189.80018615722656 lineto
196.80018615722656 -189.80018615722656 lineto
196.80018615722656 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.80018615722656 -141.80018615722656 moveto
221.80018615722656 -141.80018615722656 220.80018615722656 -143.1335194905599 220.80018615722656 -145.80018615722656 curveto
220.80018615722656 -155.80018615722656 lineto
298.8001708984375 -155.80018615722656 lineto
298.8001708984375 -145.80018615722656 lineto
298.8001708984375 -143.1335194905599 297.8001708984375 -141.80018615722656 295.8001708984375 -141.80018615722656 curveto
223.80018615722656 -141.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
220.80018615722656 -158.80018615722656 moveto
220.80018615722656 -189.80018615722656 lineto
298.8001708984375 -189.80018615722656 lineto
298.8001708984375 -158.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -20.0 moveto
117.0 -50.0 lineto
189.0 -50.0 lineto
189.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
117.0 -20.0 moveto
117.0 -50.0 lineto
189.0 -50.0 lineto
189.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -53.0 moveto
117.0 -64.0 lineto
117.0 -66.66666666666667 118.0 -68.0 120.0 -68.0 curveto
186.0 -68.0 lineto
186.0 -68.0 lineto
188.0 -68.0 189.0 -66.66666666666667 189.0 -64.0 curveto
189.0 -53.20000076293945 lineto
189.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -53.0 moveto
117.0 -64.0 lineto
117.0 -66.66666666666667 118.0 -68.0 120.0 -68.0 curveto
186.0 -68.0 lineto
186.0 -68.0 lineto
188.0 -68.0 189.0 -66.66666666666667 189.0 -64.0 curveto
189.0 -53.20000076293945 lineto
189.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -140.0 moveto
16.0 -140.0 15.0 -141.33333333333334 15.0 -144.0 curveto
15.0 -154.0 lineto
93.0 -154.0 lineto
93.0 -144.0 lineto
93.0 -141.33333333333334 92.0 -140.0 90.0 -140.0 curveto
18.0 -140.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -140.0 moveto
16.0 -140.0 15.0 -141.33333333333334 15.0 -144.0 curveto
15.0 -154.0 lineto
93.0 -154.0 lineto
93.0 -144.0 lineto
93.0 -141.33333333333334 92.0 -140.0 90.0 -140.0 curveto
18.0 -140.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -157.0 moveto
15.0 -188.0 lineto
93.0 -188.0 lineto
93.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -157.0 moveto
15.0 -188.0 lineto
93.0 -188.0 lineto
93.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
120.0 -140.0 moveto
118.0 -140.0 117.0 -141.33333333333334 117.0 -144.0 curveto
117.0 -154.0 lineto
195.0 -154.0 lineto
195.0 -144.0 lineto
195.0 -141.33333333333334 194.0 -140.0 192.0 -140.0 curveto
120.0 -140.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
120.0 -140.0 moveto
118.0 -140.0 117.0 -141.33333333333334 117.0 -144.0 curveto
117.0 -154.0 lineto
195.0 -154.0 lineto
195.0 -144.0 lineto
195.0 -141.33333333333334 194.0 -140.0 192.0 -140.0 curveto
120.0 -140.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -157.0 moveto
117.0 -188.0 lineto
195.0 -188.0 lineto
195.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -157.0 moveto
117.0 -188.0 lineto
195.0 -188.0 lineto
195.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
222.0 -140.0 moveto
220.0 -140.0 219.0 -141.33333333333334 219.0 -144.0 curveto
219.0 -154.0 lineto
297.0 -154.0 lineto
297.0 -144.0 lineto
297.0 -141.33333333333334 296.0 -140.0 294.0 -140.0 curveto
222.0 -140.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
222.0 -140.0 moveto
220.0 -140.0 219.0 -141.33333333333334 219.0 -144.0 curveto
219.0 -154.0 lineto
297.0 -154.0 lineto
297.0 -144.0 lineto
297.0 -141.33333333333334 296.0 -140.0 294.0 -140.0 curveto
222.0 -140.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
219.0 -157.0 moveto
219.0 -188.0 lineto
297.0 -188.0 lineto
297.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
219.0 -157.0 moveto
219.0 -188.0 lineto
297.0 -188.0 lineto
297.0 -157.0 lineto
closepath
stroke
newpath
153.0 -92.0 moveto
153.0 -108.0 lineto
stroke
newpath
51.0 -124.0 moveto
51.0 -108.0 lineto
153.0 -108.0 lineto
stroke
newpath
153.0 -124.0 moveto
153.0 -108.0 lineto
stroke
newpath
255.0 -124.0 moveto
255.0 -108.0 lineto
153.0 -108.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
131.0 -39.0 moveto
(Publisher) show
145.0 -63.0 moveto
(PUB) show
140.0 -79.0 moveto
(bind) show
90.0 -87.0 moveto
(tcp //192.168.55.210 5556) show
33.0 -135.0 moveto
(connect) show
141.0 -135.0 moveto
(connect) show
243.0 -135.0 moveto
(connect) show
43.0 -151.0 moveto
(SUB) show
145.0 -151.0 moveto
(SUB) show
247.0 -151.0 moveto
(SUB) show
29.0 -175.0 moveto
(Subscriber) show
131.0 -175.0 moveto
(Subscriber) show
233.0 -175.0 moveto
(Subscriber) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1947 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1947 a 274 x Fk(There)f(are)g(quite)g(a)g
(fe)n(w)g(answers)g(to)h(this)g(b)n(ut)f(the)g(v)o(ery)f(simplest)i
(answer)e(is)j(to)e(add)f(an)i(intermediary)-5 b(,)17
b(that)j(is,)h(a)396 2329 y(static)g(point)f(in)g(the)g(netw)o(ork)f
(to)i(which)e(all)i(other)e(nodes)h(connect.)f(In)g(classic)j
(messaging,)d(this)h(is)h(the)g(job)e(of)h(the)396 2437
y("message)g(brok)o(er".)e(\330MQ)j(doesn')o(t)e(come)g(with)h(a)h
(message)f(brok)o(er)f(as)i(such,)e(b)n(ut)i(it)f(lets)i(us)e(b)n(uild)
g(intermediaries)396 2545 y(quite)g(easily)-5 b(.)-2
2729 y
SDict begin H.S end
 -2 2729 a -2 2729 a
SDict begin 13 H.A end
 -2 2729 a -2 2729 a
SDict begin [/View [/XYZ H.V]/Dest (0:888) cvn /DEST pdfmark end
 -2 2729
a 396 2819 a Fk(Y)c(ou)20 b(might)f(w)o(onder)m(,)g(if)h(all)h(netw)o
(orks)e(e)n(v)o(entually)g(get)h(lar)o(ge)f(enough)f(to)j(need)e
(intermediaries,)f(why)i(don')o(t)e(we)396 2927 y(simply)i(al)o(w)o
(ays)h(design)e(around)g(a)h(message)g(brok)o(er?)f(F)o(or)h(be)o
(ginners,)e(it')-5 b(s)21 b(a)f(f)o(air)h(compromise.)d(Just)j(al)o(w)o
(ays)f(use)h(a)396 3035 y(star)g(topology)-5 b(,)17 b(for)o(get)i
(about)g(performance,)e(and)j(things)f(will)i(usually)f(w)o(ork.)f(Ho)n
(we)n(v)o(er)g(message)h(brok)o(ers)f(are)396 3143 y(greedy)g(things;)h
(in)g(their)g(role)g(as)h(central)e(intermediaries,)g(the)o(y)g(become)
g(too)h(comple)o(x,)e(too)i(stateful,)g(and)396 3251
y(e)n(v)o(entually)f(a)h(problem.)-2 3435 y
SDict begin H.S end
 -2 3435 a
-2 3435 a
SDict begin 13 H.A end
 -2 3435 a -2 3435 a
SDict begin [/View [/XYZ H.V]/Dest (0:889) cvn /DEST pdfmark end
 -2 3435 a 396 3525 a Fk(It')-5
b(s)21 b(better)f(to)g(think)g(of)g(intermediaries)e(as)j(simple)f
(stateless)i(message)e(switches.)g(The)g(best)h(analogy)d(is)j(an)g
(HTTP)396 3633 y(proxy;)e(it')-5 b(s)21 b(there)f(b)n(ut)g(doesn')o(t)f
(ha)n(v)o(e)g(an)o(y)h(special)g(role.)g(Adding)e(a)j(pub-sub)d(proxy)h
(solv)o(es)h(the)g(dynamic)f(disco)o(v)o(ery)396 3740
y(problem)g(in)h(our)f(e)o(xample.)g(W)-7 b(e)21 b(set)g(the)g(proxy)d
(in)i(the)h("middle")e(of)h(the)g(netw)o(ork\()p 0 TeXcolorgray
2851 3740 a
SDict begin H.S end
 2851 3740 a Fk(Figure)d(2-7)3198 3740 y
SDict begin 13 H.L end
 3198
3740 a 3198 3740 a
SDict begin [/Subtype /Link/Dest (0:figure-16) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3198 3740 a Black -1 w Fk(\).)j(The)g(proxy)e(opens)
396 3848 y(an)i(XSUB)i(sock)o(et,)d(an)h(XPUB)i(sock)o(et,)d(and)h
(binds)g(each)g(to)g(well-kno)n(wn)e(IP)j(addresses)f(and)f(ports.)h
(Then)f(all)i(other)396 3956 y(processes)f(connect)f(to)h(the)h(proxy)
-5 b(,)17 b(instead)j(of)g(to)h(each)f(other)-5 b(.)19
b(It)i(becomes)e(tri)n(vial)h(to)g(add)g(more)f(subscribers)g(or)396
4064 y(publishers.)-2 4082 y
SDict begin H.S end
 -2 4082 a -2 4082 a
SDict begin 13 H.A end
 -2 4082
a -2 4082 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-16) cvn /DEST pdfmark
end
 -2 4082 a Black 3798 5569 a Ff(56)p Black
eop end
%%Page: 57 70
TeXDict begin 57 69 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.57) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:903) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-7.)f(Pub-Sub)i(Netw)o(ork)f(with)g(a)h
(Pr)o(oxy)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172
a
SDict begin [/View [/XYZ H.V]/Dest (0:893) cvn /DEST pdfmark end
 -2 172 a 396 2947 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2947 a @beginspecial 0 @llx
-328 @lly 312 @urx 0 @ury 3120 @rwi @setspecial
%%BeginDocument: images/fig16.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -328 312 0
%%HiResBoundingBox: 0.0 -328.0 312.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -21.800180435180664 moveto
16.800180435180664 -51.80017852783203 lineto
94.80017852783203 -51.80017852783203 lineto
94.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -54.80017852783203 moveto
16.800180435180664 -65.80017852783203 lineto
16.800180435180664 -68.4668451944987 17.800180435180664 -69.80017852783203 19.800180435180664 -69.80017852783203 curveto
91.80017852783203 -69.80017852783203 lineto
91.80017852783203 -69.80017852783203 lineto
93.80017852783203 -69.80017852783203 94.80017852783203 -68.4668451944987 94.80017852783203 -65.80017852783203 curveto
94.80017852783203 -55.000179290771484 lineto
94.80017852783203 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -21.800180435180664 moveto
118.80017852783203 -51.80017852783203 lineto
196.80018615722656 -51.80017852783203 lineto
196.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -54.80017852783203 moveto
118.80017852783203 -65.80017852783203 lineto
118.80017852783203 -68.4668451944987 119.80017852783203 -69.80017852783203 121.80017852783203 -69.80017852783203 curveto
193.80018615722656 -69.80017852783203 lineto
193.80018615722656 -69.80017852783203 lineto
195.80018615722656 -69.80017852783203 196.80018615722656 -68.4668451944987 196.80018615722656 -65.80017852783203 curveto
196.80018615722656 -55.000179290771484 lineto
196.80018615722656 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
220.80018615722656 -21.800180435180664 moveto
220.80018615722656 -51.80017852783203 lineto
298.8001708984375 -51.80017852783203 lineto
298.8001708984375 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
220.80018615722656 -54.80017852783203 moveto
220.80018615722656 -65.80017852783203 lineto
220.80018615722656 -68.4668451944987 221.80018615722656 -69.80017852783203 223.80018615722656 -69.80017852783203 curveto
295.8001708984375 -69.80017852783203 lineto
295.8001708984375 -69.80017852783203 lineto
297.8001708984375 -69.80017852783203 298.8001708984375 -68.4668451944987 298.8001708984375 -65.80017852783203 curveto
298.8001708984375 -55.000179290771484 lineto
298.8001708984375 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.80017852783203 -133.80018615722656 moveto
119.80017852783203 -133.80018615722656 118.80017852783203 -135.1335194905599 118.80017852783203 -137.80018615722656 curveto
118.80017852783203 -147.80018615722656 lineto
196.80018615722656 -147.80018615722656 lineto
196.80018615722656 -137.80018615722656 lineto
196.80018615722656 -135.1335194905599 195.80018615722656 -133.80018615722656 193.80018615722656 -133.80018615722656 curveto
121.80017852783203 -133.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -150.80018615722656 moveto
118.80017852783203 -179.80018615722656 lineto
196.80018615722656 -179.80018615722656 lineto
196.80018615722656 -150.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -182.80018615722656 moveto
118.80017852783203 -193.80018615722656 lineto
118.80017852783203 -196.46685282389322 119.80017852783203 -197.80018615722656 121.80017852783203 -197.80018615722656 curveto
193.80018615722656 -197.80018615722656 lineto
193.80018615722656 -197.80018615722656 lineto
195.80018615722656 -197.80018615722656 196.80018615722656 -196.46685282389322 196.80018615722656 -193.80018615722656 curveto
196.80018615722656 -183.00018310546875 lineto
196.80018615722656 -182.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -261.8001708984375 moveto
17.800180435180664 -261.8001708984375 16.800180435180664 -263.1335042317708 16.800180435180664 -265.8001708984375 curveto
16.800180435180664 -275.8001708984375 lineto
94.80017852783203 -275.8001708984375 lineto
94.80017852783203 -265.8001708984375 lineto
94.80017852783203 -263.1335042317708 93.80017852783203 -261.8001708984375 91.80017852783203 -261.8001708984375 curveto
19.800180435180664 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -278.8001708984375 moveto
16.800180435180664 -309.8001708984375 lineto
94.80017852783203 -309.8001708984375 lineto
94.80017852783203 -278.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.80017852783203 -261.8001708984375 moveto
119.80017852783203 -261.8001708984375 118.80017852783203 -263.1335042317708 118.80017852783203 -265.8001708984375 curveto
118.80017852783203 -275.8001708984375 lineto
196.80018615722656 -275.8001708984375 lineto
196.80018615722656 -265.8001708984375 lineto
196.80018615722656 -263.1335042317708 195.80018615722656 -261.8001708984375 193.80018615722656 -261.8001708984375 curveto
121.80017852783203 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -278.8001708984375 moveto
118.80017852783203 -309.8001708984375 lineto
196.80018615722656 -309.8001708984375 lineto
196.80018615722656 -278.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.80018615722656 -261.8001708984375 moveto
221.80018615722656 -261.8001708984375 220.80018615722656 -263.1335042317708 220.80018615722656 -265.8001708984375 curveto
220.80018615722656 -275.8001708984375 lineto
298.8001708984375 -275.8001708984375 lineto
298.8001708984375 -265.8001708984375 lineto
298.8001708984375 -263.1335042317708 297.8001708984375 -261.8001708984375 295.8001708984375 -261.8001708984375 curveto
223.80018615722656 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
220.80018615722656 -278.8001708984375 moveto
220.80018615722656 -309.8001708984375 lineto
298.8001708984375 -309.8001708984375 lineto
298.8001708984375 -278.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -20.0 moveto
15.0 -50.0 lineto
93.0 -50.0 lineto
93.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -20.0 moveto
15.0 -50.0 lineto
93.0 -50.0 lineto
93.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -53.0 moveto
15.0 -64.0 lineto
15.0 -66.66666666666667 16.0 -68.0 18.0 -68.0 curveto
90.0 -68.0 lineto
90.0 -68.0 lineto
92.0 -68.0 93.0 -66.66666666666667 93.0 -64.0 curveto
93.0 -53.20000076293945 lineto
93.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -53.0 moveto
15.0 -64.0 lineto
15.0 -66.66666666666667 16.0 -68.0 18.0 -68.0 curveto
90.0 -68.0 lineto
90.0 -68.0 lineto
92.0 -68.0 93.0 -66.66666666666667 93.0 -64.0 curveto
93.0 -53.20000076293945 lineto
93.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -20.0 moveto
117.0 -50.0 lineto
195.0 -50.0 lineto
195.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -20.0 moveto
117.0 -50.0 lineto
195.0 -50.0 lineto
195.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -53.0 moveto
117.0 -64.0 lineto
117.0 -66.66666666666667 118.0 -68.0 120.0 -68.0 curveto
192.0 -68.0 lineto
192.0 -68.0 lineto
194.0 -68.0 195.0 -66.66666666666667 195.0 -64.0 curveto
195.0 -53.20000076293945 lineto
195.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -53.0 moveto
117.0 -64.0 lineto
117.0 -66.66666666666667 118.0 -68.0 120.0 -68.0 curveto
192.0 -68.0 lineto
192.0 -68.0 lineto
194.0 -68.0 195.0 -66.66666666666667 195.0 -64.0 curveto
195.0 -53.20000076293945 lineto
195.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
219.0 -20.0 moveto
219.0 -50.0 lineto
297.0 -50.0 lineto
297.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
219.0 -20.0 moveto
219.0 -50.0 lineto
297.0 -50.0 lineto
297.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
219.0 -53.0 moveto
219.0 -64.0 lineto
219.0 -66.66666666666667 220.0 -68.0 222.0 -68.0 curveto
294.0 -68.0 lineto
294.0 -68.0 lineto
296.0 -68.0 297.0 -66.66666666666667 297.0 -64.0 curveto
297.0 -53.20000076293945 lineto
297.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
219.0 -53.0 moveto
219.0 -64.0 lineto
219.0 -66.66666666666667 220.0 -68.0 222.0 -68.0 curveto
294.0 -68.0 lineto
294.0 -68.0 lineto
296.0 -68.0 297.0 -66.66666666666667 297.0 -64.0 curveto
297.0 -53.20000076293945 lineto
297.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
120.0 -132.0 moveto
118.0 -132.0 117.0 -133.33333333333334 117.0 -136.0 curveto
117.0 -146.0 lineto
195.0 -146.0 lineto
195.0 -136.0 lineto
195.0 -133.33333333333334 194.0 -132.0 192.0 -132.0 curveto
120.0 -132.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
120.0 -132.0 moveto
118.0 -132.0 117.0 -133.33333333333334 117.0 -136.0 curveto
117.0 -146.0 lineto
195.0 -146.0 lineto
195.0 -136.0 lineto
195.0 -133.33333333333334 194.0 -132.0 192.0 -132.0 curveto
120.0 -132.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -149.0 moveto
117.0 -178.0 lineto
195.0 -178.0 lineto
195.0 -149.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -149.0 moveto
117.0 -178.0 lineto
195.0 -178.0 lineto
195.0 -149.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -181.0 moveto
117.0 -192.0 lineto
117.0 -194.66666666666666 118.0 -196.0 120.0 -196.0 curveto
192.0 -196.0 lineto
192.0 -196.0 lineto
194.0 -196.0 195.0 -194.66666666666666 195.0 -192.0 curveto
195.0 -181.1999969482422 lineto
195.0 -181.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -181.0 moveto
117.0 -192.0 lineto
117.0 -194.66666666666666 118.0 -196.0 120.0 -196.0 curveto
192.0 -196.0 lineto
192.0 -196.0 lineto
194.0 -196.0 195.0 -194.66666666666666 195.0 -192.0 curveto
195.0 -181.1999969482422 lineto
195.0 -181.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -260.0 moveto
16.0 -260.0 15.0 -261.3333333333333 15.0 -264.0 curveto
15.0 -274.0 lineto
93.0 -274.0 lineto
93.0 -264.0 lineto
93.0 -261.3333333333333 92.0 -260.0 90.0 -260.0 curveto
18.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -260.0 moveto
16.0 -260.0 15.0 -261.3333333333333 15.0 -264.0 curveto
15.0 -274.0 lineto
93.0 -274.0 lineto
93.0 -264.0 lineto
93.0 -261.3333333333333 92.0 -260.0 90.0 -260.0 curveto
18.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -277.0 moveto
15.0 -308.0 lineto
93.0 -308.0 lineto
93.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -277.0 moveto
15.0 -308.0 lineto
93.0 -308.0 lineto
93.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
120.0 -260.0 moveto
118.0 -260.0 117.0 -261.3333333333333 117.0 -264.0 curveto
117.0 -274.0 lineto
195.0 -274.0 lineto
195.0 -264.0 lineto
195.0 -261.3333333333333 194.0 -260.0 192.0 -260.0 curveto
120.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
120.0 -260.0 moveto
118.0 -260.0 117.0 -261.3333333333333 117.0 -264.0 curveto
117.0 -274.0 lineto
195.0 -274.0 lineto
195.0 -264.0 lineto
195.0 -261.3333333333333 194.0 -260.0 192.0 -260.0 curveto
120.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -277.0 moveto
117.0 -308.0 lineto
195.0 -308.0 lineto
195.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -277.0 moveto
117.0 -308.0 lineto
195.0 -308.0 lineto
195.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
222.0 -260.0 moveto
220.0 -260.0 219.0 -261.3333333333333 219.0 -264.0 curveto
219.0 -274.0 lineto
297.0 -274.0 lineto
297.0 -264.0 lineto
297.0 -261.3333333333333 296.0 -260.0 294.0 -260.0 curveto
222.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
222.0 -260.0 moveto
220.0 -260.0 219.0 -261.3333333333333 219.0 -264.0 curveto
219.0 -274.0 lineto
297.0 -274.0 lineto
297.0 -264.0 lineto
297.0 -261.3333333333333 296.0 -260.0 294.0 -260.0 curveto
222.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
219.0 -277.0 moveto
219.0 -308.0 lineto
297.0 -308.0 lineto
297.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
219.0 -277.0 moveto
219.0 -308.0 lineto
297.0 -308.0 lineto
297.0 -277.0 lineto
closepath
stroke
newpath
51.0 -84.0 moveto
51.0 -100.0 lineto
153.0 -100.0 lineto
stroke
newpath
153.0 -84.0 moveto
153.0 -100.0 lineto
stroke
newpath
255.0 -84.0 moveto
255.0 -100.0 lineto
153.0 -100.0 lineto
stroke
newpath
153.0 -116.0 moveto
153.0 -100.0 lineto
stroke
newpath
153.0 -212.0 moveto
153.0 -228.0 lineto
stroke
newpath
51.0 -244.0 moveto
51.0 -228.0 lineto
153.0 -228.0 lineto
stroke
newpath
153.0 -244.0 moveto
153.0 -228.0 lineto
stroke
newpath
255.0 -244.0 moveto
255.0 -228.0 lineto
153.0 -228.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
29.0 -39.0 moveto
(Publisher) show
131.0 -39.0 moveto
(Publisher) show
233.0 -39.0 moveto
(Publisher) show
43.0 -63.0 moveto
(PUB) show
145.0 -63.0 moveto
(PUB) show
247.0 -63.0 moveto
(PUB) show
33.0 -79.0 moveto
(connect) show
135.0 -79.0 moveto
(connect) show
237.0 -79.0 moveto
(connect) show
146.0 -127.0 moveto
(bind) show
146.0 -143.0 moveto
(XSUB) show
140.0 -167.0 moveto
(Proxy) show
146.0 -191.0 moveto
(XPUB) show
146.0 -207.0 moveto
(bind) show
33.0 -255.0 moveto
(connect) show
141.0 -255.0 moveto
(connect) show
243.0 -255.0 moveto
(connect) show
43.0 -271.0 moveto
(SUB) show
145.0 -271.0 moveto
(SUB) show
247.0 -271.0 moveto
(SUB) show
29.0 -295.0 moveto
(Subscriber) show
131.0 -295.0 moveto
(Subscriber) show
233.0 -295.0 moveto
(Subscriber) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2947 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2947 a 274 x Fk(W)-7 b(e)22
b(need)d(XPUB)i(and)f(XSUB)h(sock)o(ets)f(because)g(\330MQ)g(does)g
(subscription)f(forw)o(arding:)f(SUB)j(sock)o(ets)f(actually)396
3329 y(send)g(subscriptions)f(to)h(PUB)i(sock)o(ets)e(as)h(special)f
(messages.)g(The)g(proxy)f(has)h(to)g(forw)o(ard)f(these)h(as)h(well,)g
(by)396 3437 y(reading)e(them)h(from)f(the)h(XPUB)h(sock)o(et)f(and)g
(writing)g(them)f(to)i(the)f(XSUB)h(sock)o(et.)f(This)g(is)h(the)g
(main)e(use-case)h(for)396 3545 y(XSUB)h(and)f(XPUB\()p
0 TeXcolorgray 1028 3545 a
SDict begin H.S end
 1028 3545 a Fk(Figure)g(2-8)1378
3545 y
SDict begin 13 H.L end
 1378 3545 a 1378 3545 a
SDict begin [/Subtype /Link/Dest (0:figure-17) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1378 3545 a Black -2 w
Fk(\).)-2 3563 y
SDict begin H.S end
 -2 3563 a -2 3563 a
SDict begin 13 H.A end
 -2 3563 a -2 3563
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-17) cvn /DEST pdfmark
end
 -2 3563 a Black 3797 5569 a Ff(57)p Black eop end
%%Page: 58 71
TeXDict begin 58 70 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.58) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:913) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-8.)f(Extended)h(Publish-Subscribe)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:900) cvn /DEST pdfmark end
 -2 172 a 396
2464 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2464 a @beginspecial 0 @llx -270 @lly 301
@urx 0 @ury 3010 @rwi @setspecial
%%BeginDocument: images/fig17.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -270 301 0
%%HiResBoundingBox: 0.0 -270.0 301.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -27.100210189819336 moveto
19.100210189819336 -42.1002082824707 lineto
19.100210189819336 -45.43354161580404 20.433543523152668 -47.1002082824707 23.100210189819336 -47.1002082824707 curveto
86.10021209716797 -47.1002082824707 lineto
86.10021209716797 -47.1002082824707 lineto
88.10021209716797 -47.1002082824707 89.10021209716797 -45.43354161580404 89.10021209716797 -42.1002082824707 curveto
89.10021209716797 -27.100210189819336 lineto
89.10021209716797 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -27.100210189819336 moveto
117.10021209716797 -42.1002082824707 lineto
117.10021209716797 -45.43354161580404 118.4335454305013 -47.1002082824707 121.10021209716797 -47.1002082824707 curveto
184.10020446777344 -47.1002082824707 lineto
184.10020446777344 -47.1002082824707 lineto
186.10020446777344 -47.1002082824707 187.10020446777344 -45.43354161580404 187.10020446777344 -42.1002082824707 curveto
187.10020446777344 -27.100210189819336 lineto
187.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -27.100210189819336 moveto
215.10020446777344 -42.1002082824707 lineto
215.10020446777344 -45.43354161580404 216.43353780110678 -47.1002082824707 219.10020446777344 -47.1002082824707 curveto
282.1002197265625 -47.1002082824707 lineto
282.1002197265625 -47.1002082824707 lineto
284.1002197265625 -47.1002082824707 285.1002197265625 -45.43354161580404 285.1002197265625 -42.1002082824707 curveto
285.1002197265625 -27.100210189819336 lineto
285.1002197265625 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
114.10021209716797 -107.10021209716797 moveto
111.4335454305013 -107.10021209716797 110.10021209716797 -108.76687876383464 110.10021209716797 -112.10021209716797 curveto
110.10021209716797 -125.10021209716797 lineto
194.10020446777344 -125.10021209716797 lineto
194.10020446777344 -112.10021209716797 lineto
194.10020446777344 -108.76687876383464 193.10020446777344 -107.10021209716797 191.10020446777344 -107.10021209716797 curveto
114.10021209716797 -107.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -128.10020446777344 moveto
110.10021209716797 -145.10020446777344 lineto
194.10020446777344 -145.10020446777344 lineto
194.10020446777344 -128.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -148.10020446777344 moveto
110.10021209716797 -162.10020446777344 lineto
110.10021209716797 -165.43353780110678 111.4335454305013 -167.10020446777344 114.10021209716797 -167.10020446777344 curveto
191.10020446777344 -167.10020446777344 lineto
191.10020446777344 -167.10020446777344 lineto
193.10020446777344 -167.10020446777344 194.10020446777344 -165.43353780110678 194.10020446777344 -162.10020446777344 curveto
194.10020446777344 -148.5001983642578 lineto
194.10020446777344 -148.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.100210189819336 -227.10020446777344 moveto
20.433543523152668 -227.10020446777344 19.100210189819336 -228.7668711344401 19.100210189819336 -232.10020446777344 curveto
19.100210189819336 -247.10020446777344 lineto
89.10021209716797 -247.10020446777344 lineto
89.10021209716797 -232.10020446777344 lineto
89.10021209716797 -228.7668711344401 88.10021209716797 -227.10020446777344 86.10021209716797 -227.10020446777344 curveto
23.100210189819336 -227.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.10021209716797 -227.10020446777344 moveto
118.4335454305013 -227.10020446777344 117.10021209716797 -228.7668711344401 117.10021209716797 -232.10020446777344 curveto
117.10021209716797 -247.10020446777344 lineto
187.10020446777344 -247.10020446777344 lineto
187.10020446777344 -232.10020446777344 lineto
187.10020446777344 -228.7668711344401 186.10020446777344 -227.10020446777344 184.10020446777344 -227.10020446777344 curveto
121.10021209716797 -227.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
219.10020446777344 -227.10020446777344 moveto
216.43353780110678 -227.10020446777344 215.10020446777344 -228.7668711344401 215.10020446777344 -232.10020446777344 curveto
215.10020446777344 -247.10020446777344 lineto
285.1002197265625 -247.10020446777344 lineto
285.1002197265625 -232.10020446777344 lineto
285.1002197265625 -228.7668711344401 284.1002197265625 -227.10020446777344 282.1002197265625 -227.10020446777344 curveto
219.10020446777344 -227.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -105.0 moveto
109.33333333333333 -105.0 108.0 -106.66666666666667 108.0 -110.0 curveto
108.0 -123.0 lineto
192.0 -123.0 lineto
192.0 -110.0 lineto
192.0 -106.66666666666667 191.0 -105.0 189.0 -105.0 curveto
112.0 -105.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -105.0 moveto
109.33333333333333 -105.0 108.0 -106.66666666666667 108.0 -110.0 curveto
108.0 -123.0 lineto
192.0 -123.0 lineto
192.0 -110.0 lineto
192.0 -106.66666666666667 191.0 -105.0 189.0 -105.0 curveto
112.0 -105.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -126.0 moveto
108.0 -143.0 lineto
192.0 -143.0 lineto
192.0 -126.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -126.0 moveto
108.0 -143.0 lineto
192.0 -143.0 lineto
192.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -146.0 moveto
108.0 -160.0 lineto
108.0 -163.33333333333334 109.33333333333333 -165.0 112.0 -165.0 curveto
189.0 -165.0 lineto
189.0 -165.0 lineto
191.0 -165.0 192.0 -163.33333333333334 192.0 -160.0 curveto
192.0 -146.39999389648438 lineto
192.0 -146.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -146.0 moveto
108.0 -160.0 lineto
108.0 -163.33333333333334 109.33333333333333 -165.0 112.0 -165.0 curveto
189.0 -165.0 lineto
189.0 -165.0 lineto
191.0 -165.0 192.0 -163.33333333333334 192.0 -160.0 curveto
192.0 -146.39999389648438 lineto
192.0 -146.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
21.0 -225.0 moveto
18.333333333333332 -225.0 17.0 -226.66666666666666 17.0 -230.0 curveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -230.0 lineto
87.0 -226.66666666666666 86.0 -225.0 84.0 -225.0 curveto
21.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
21.0 -225.0 moveto
18.333333333333332 -225.0 17.0 -226.66666666666666 17.0 -230.0 curveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -230.0 lineto
87.0 -226.66666666666666 86.0 -225.0 84.0 -225.0 curveto
21.0 -225.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
119.0 -225.0 moveto
116.33333333333333 -225.0 115.0 -226.66666666666666 115.0 -230.0 curveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -230.0 lineto
185.0 -226.66666666666666 184.0 -225.0 182.0 -225.0 curveto
119.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
119.0 -225.0 moveto
116.33333333333333 -225.0 115.0 -226.66666666666666 115.0 -230.0 curveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -230.0 lineto
185.0 -226.66666666666666 184.0 -225.0 182.0 -225.0 curveto
119.0 -225.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
217.0 -225.0 moveto
214.33333333333334 -225.0 213.0 -226.66666666666666 213.0 -230.0 curveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -230.0 lineto
283.0 -226.66666666666666 282.0 -225.0 280.0 -225.0 curveto
217.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
217.0 -225.0 moveto
214.33333333333334 -225.0 213.0 -226.66666666666666 213.0 -230.0 curveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -230.0 lineto
283.0 -226.66666666666666 282.0 -225.0 280.0 -225.0 curveto
217.0 -225.0 lineto
closepath
stroke
newpath
52.0 -45.0 moveto
52.0 -75.0 lineto
150.0 -75.0 lineto
stroke
newpath
150.0 -45.0 moveto
150.0 -75.0 lineto
stroke
newpath
248.0 -45.0 moveto
248.0 -75.0 lineto
150.0 -75.0 lineto
stroke
newpath
150.0 -105.0 moveto
150.0 -75.0 lineto
stroke
newpath
150.0 -165.0 moveto
150.0 -195.0 lineto
stroke
newpath
52.0 -225.0 moveto
52.0 -195.0 lineto
150.0 -195.0 lineto
stroke
newpath
150.0 -225.0 moveto
150.0 -195.0 lineto
stroke
newpath
248.0 -225.0 moveto
248.0 -195.0 lineto
150.0 -195.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
43.0 -38.0 moveto
(PUB) show
141.0 -38.0 moveto
(PUB) show
239.0 -38.0 moveto
(PUB) show
134.0 -118.0 moveto
(XSUB) show
134.0 -139.0 moveto
(code) show
134.0 -158.0 moveto
(XPUB) show
43.0 -238.0 moveto
(SUB) show
141.0 -238.0 moveto
(SUB) show
239.0 -238.0 moveto
(SUB) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2464 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2464 a -2 2547 a
SDict begin H.S end
 -2 2547
a -2 2547 a
SDict begin 13 H.A end
 -2 2547 a -2 2547 a
SDict begin [/View [/XYZ H.V]/Dest (0:903) cvn /DEST pdfmark end
 -2 2547 a 396 2875 a
Fb(2.17.2.)36 b(The)e(Shared)f(Queue)i(Pr)n(ob)o(lem)2360
2875 y
SDict begin H.S end
 2360 2875 a 2360 2875 a
SDict begin 18.72 H.A end
 2360 2875 a 2360 2875
a
SDict begin [/View [/XYZ H.V]/Dest (7.38.2.2) cvn /DEST pdfmark end
 2360 2875 a -2 3047 a
SDict begin H.S end
 -2 3047 a -2 3047 a
SDict begin 13 H.A end
 -2 3047 a
-2 3047 a
SDict begin [/View [/XYZ H.V]/Dest (0:905) cvn /DEST pdfmark end
 -2 3047 a 396 3149 a Fk(In)20 b(the)g(Hello)h(W)-7
b(orld)20 b(client-serv)o(er)e(application)h(we)i(ha)n(v)o(e)e(one)h
(client)g(that)g(talks)h(to)f(one)g(service.)f(Ho)n(we)n(v)o(er)g(in)h
(real)396 3257 y(cases)h(we)g(usually)e(need)h(to)g(allo)n(w)g
(multiple)g(services)g(as)h(well)g(as)g(multiple)e(clients.)h(This)h
(lets)g(us)f(scale)h(up)f(the)396 3365 y(po)n(wer)f(of)h(the)g(service)
f(\(man)o(y)f(threads)h(or)h(processes)g(or)f(box)o(es)g(rather)g(than)
g(just)i(one\).)d(The)i(only)f(constraint)g(is)i(that)396
3473 y(services)f(must)h(be)f(stateless,)h(all)g(state)g(being)e(in)h
(the)g(request)g(or)g(in)g(some)g(shared)g(storage)f(such)h(as)h(a)g
(database.)-2 3657 y
SDict begin H.S end
 -2 3657 a -2 3657 a
SDict begin 13 H.A end
 -2 3657 a -2
3657 a
SDict begin [/View [/XYZ H.V]/Dest (0:906) cvn /DEST pdfmark end
 -2 3657 a 396 3747 a Fk(There)f(are)g(tw)o(o)g(w)o(ays)h(to)f
(connect)f(multiple)h(clients)g(to)g(multiple)g(serv)o(ers.)f(The)h
(brute-force)e(w)o(ay)i(is)h(to)f(connect)396 3855 y(each)g(client)g
(sock)o(et)g(to)h(multiple)e(service)h(endpoints.)f(One)h(client)g
(sock)o(et)g(can)g(connect)f(to)h(multiple)g(service)396
3963 y(sock)o(ets,)g(and)g(the)g(REQ)h(sock)o(et)f(will)h(then)f
(load-balance)e(requests)h(among)g(these)i(services.)e(Let')-5
b(s)21 b(say)g(you)e(connect)396 4071 y(a)i(client)e(sock)o(et)h(to)g
(three)f(service)h(endpoints,)e(A,)i(B,)h(and)e(C.)h(The)g(client)g
(mak)o(es)f(requests)h(R1,)g(R2,)g(R3,)g(R4.)g(R1)g(and)396
4178 y(R4)h(go)f(to)g(service)g(A,)g(R2)h(goes)f(to)g(B,)h(and)f(R3)g
(goes)g(to)h(service)f(C\()p 0 TeXcolorgray 2389 4178
a
SDict begin H.S end
 2389 4178 a Fk(Figure)f(2-9)2738 4178 y
SDict begin 13 H.L end
 2738 4178 a
2738 4178 a
SDict begin [/Subtype /Link/Dest (0:figure-18) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2738 4178 a Black -1 w Fk(\).)-2 4196 y
SDict begin H.S end
 -2
4196 a -2 4196 a
SDict begin 13 H.A end
 -2 4196 a -2 4196 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-18) cvn /DEST pdfmark
end
 -2 4196 a Black
3800 5569 a Ff(58)p Black eop end
%%Page: 59 72
TeXDict begin 59 71 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.59) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-9.)f(Load-balancing)g(of)h(Requests)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:910) cvn /DEST pdfmark end
 -2 172 a 396
2464 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2464 a @beginspecial 0 @llx -270 @lly 301
@urx 0 @ury 3010 @rwi @setspecial
%%BeginDocument: images/fig18.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -270 301 0
%%HiResBoundingBox: 0.0 -270.0 301.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -27.100210189819336 moveto
110.10021209716797 -65.10021209716797 lineto
194.10020446777344 -65.10021209716797 lineto
194.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -68.10021209716797 moveto
110.10021209716797 -82.10021209716797 lineto
110.10021209716797 -85.4335454305013 111.4335454305013 -87.10021209716797 114.10021209716797 -87.10021209716797 curveto
191.10020446777344 -87.10021209716797 lineto
191.10020446777344 -87.10021209716797 lineto
193.10020446777344 -87.10021209716797 194.10020446777344 -85.4335454305013 194.10020446777344 -82.10021209716797 curveto
194.10020446777344 -68.50021362304688 lineto
194.10020446777344 -68.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.100210189819336 -177.10020446777344 moveto
20.433543523152668 -177.10020446777344 19.100210189819336 -178.7668711344401 19.100210189819336 -182.10020446777344 curveto
19.100210189819336 -195.10020446777344 lineto
89.10021209716797 -195.10020446777344 lineto
89.10021209716797 -182.10020446777344 lineto
89.10021209716797 -178.7668711344401 88.10021209716797 -177.10020446777344 86.10021209716797 -177.10020446777344 curveto
23.100210189819336 -177.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -198.10020446777344 moveto
19.100210189819336 -247.10020446777344 lineto
89.10021209716797 -247.10020446777344 lineto
89.10021209716797 -198.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.10021209716797 -177.10020446777344 moveto
118.4335454305013 -177.10020446777344 117.10021209716797 -178.7668711344401 117.10021209716797 -182.10020446777344 curveto
117.10021209716797 -195.10020446777344 lineto
187.10020446777344 -195.10020446777344 lineto
187.10020446777344 -182.10020446777344 lineto
187.10020446777344 -178.7668711344401 186.10020446777344 -177.10020446777344 184.10020446777344 -177.10020446777344 curveto
121.10021209716797 -177.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -198.10020446777344 moveto
117.10021209716797 -247.10020446777344 lineto
187.10020446777344 -247.10020446777344 lineto
187.10020446777344 -198.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
219.10020446777344 -177.10020446777344 moveto
216.43353780110678 -177.10020446777344 215.10020446777344 -178.7668711344401 215.10020446777344 -182.10020446777344 curveto
215.10020446777344 -195.10020446777344 lineto
285.1002197265625 -195.10020446777344 lineto
285.1002197265625 -182.10020446777344 lineto
285.1002197265625 -178.7668711344401 284.1002197265625 -177.10020446777344 282.1002197265625 -177.10020446777344 curveto
219.10020446777344 -177.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -198.10020446777344 moveto
215.10020446777344 -247.10020446777344 lineto
285.1002197265625 -247.10020446777344 lineto
285.1002197265625 -198.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -25.0 moveto
108.0 -63.0 lineto
192.0 -63.0 lineto
192.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
108.0 -25.0 moveto
108.0 -63.0 lineto
192.0 -63.0 lineto
192.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -66.0 moveto
108.0 -80.0 lineto
108.0 -83.33333333333333 109.33333333333333 -85.0 112.0 -85.0 curveto
189.0 -85.0 lineto
189.0 -85.0 lineto
191.0 -85.0 192.0 -83.33333333333333 192.0 -80.0 curveto
192.0 -66.4000015258789 lineto
192.0 -66.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -66.0 moveto
108.0 -80.0 lineto
108.0 -83.33333333333333 109.33333333333333 -85.0 112.0 -85.0 curveto
189.0 -85.0 lineto
189.0 -85.0 lineto
191.0 -85.0 192.0 -83.33333333333333 192.0 -80.0 curveto
192.0 -66.4000015258789 lineto
192.0 -66.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
21.0 -175.0 moveto
18.333333333333332 -175.0 17.0 -176.66666666666666 17.0 -180.0 curveto
17.0 -193.0 lineto
87.0 -193.0 lineto
87.0 -180.0 lineto
87.0 -176.66666666666666 86.0 -175.0 84.0 -175.0 curveto
21.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
21.0 -175.0 moveto
18.333333333333332 -175.0 17.0 -176.66666666666666 17.0 -180.0 curveto
17.0 -193.0 lineto
87.0 -193.0 lineto
87.0 -180.0 lineto
87.0 -176.66666666666666 86.0 -175.0 84.0 -175.0 curveto
21.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -196.0 moveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -196.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
17.0 -196.0 moveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -196.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
119.0 -175.0 moveto
116.33333333333333 -175.0 115.0 -176.66666666666666 115.0 -180.0 curveto
115.0 -193.0 lineto
185.0 -193.0 lineto
185.0 -180.0 lineto
185.0 -176.66666666666666 184.0 -175.0 182.0 -175.0 curveto
119.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
119.0 -175.0 moveto
116.33333333333333 -175.0 115.0 -176.66666666666666 115.0 -180.0 curveto
115.0 -193.0 lineto
185.0 -193.0 lineto
185.0 -180.0 lineto
185.0 -176.66666666666666 184.0 -175.0 182.0 -175.0 curveto
119.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -196.0 moveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -196.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -196.0 moveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -196.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
217.0 -175.0 moveto
214.33333333333334 -175.0 213.0 -176.66666666666666 213.0 -180.0 curveto
213.0 -193.0 lineto
283.0 -193.0 lineto
283.0 -180.0 lineto
283.0 -176.66666666666666 282.0 -175.0 280.0 -175.0 curveto
217.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
217.0 -175.0 moveto
214.33333333333334 -175.0 213.0 -176.66666666666666 213.0 -180.0 curveto
213.0 -193.0 lineto
283.0 -193.0 lineto
283.0 -180.0 lineto
283.0 -176.66666666666666 282.0 -175.0 280.0 -175.0 curveto
217.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -196.0 moveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -196.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -196.0 moveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -196.0 lineto
closepath
stroke
newpath
52.0 -150.0 moveto
52.0 -165.0 lineto
stroke
newpath
150.0 -85.0 moveto
150.0 -99.0 lineto
stroke
newpath
49.0 -160.0 moveto
52.0 -170.0 lineto
56.0 -160.0 lineto
closepath
fill
newpath
147.0 -160.0 moveto
150.0 -170.0 lineto
154.0 -160.0 lineto
closepath
fill
newpath
245.0 -160.0 moveto
248.0 -170.0 lineto
252.0 -160.0 lineto
closepath
fill
newpath
150.0 -115.0 moveto
150.0 -125.0 lineto
stroke
newpath
52.0 -135.0 moveto
52.0 -125.0 lineto
150.0 -125.0 lineto
stroke
newpath
150.0 -165.0 moveto
150.0 -125.0 lineto
stroke
newpath
248.0 -165.0 moveto
248.0 -125.0 lineto
150.0 -125.0 lineto
stroke
/Helvetica findfont
10 scalefont setfont
138.0 -49.0 moveto
(Client) show
140.0 -78.0 moveto
(REQ) show
114.0 -109.0 moveto
(R1, R2, R3, R4) show
31.0 -149.0 moveto
(R1, R4) show
148.0 -148.0 moveto
(R2) show
246.0 -148.0 moveto
(R3) show
42.0 -189.0 moveto
(REP) show
140.0 -189.0 moveto
(REP) show
238.0 -189.0 moveto
(REP) show
31.0 -219.0 moveto
(Service) show
50.0 -229.0 moveto
(A ) show
129.0 -219.0 moveto
(Service) show
149.0 -229.0 moveto
(B ) show
227.0 -219.0 moveto
(Service) show
247.0 -229.0 moveto
(C ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2464 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2464 a 274 x Fk(This)h(design)e(lets)i(you)
f(add)f(more)h(clients)g(cheaply)-5 b(.)18 b(Y)-9 b(ou)20
b(can)g(also)g(add)g(more)f(services.)h(Each)g(client)g(will)396
2846 y(load-balance)e(its)j(requests)f(to)h(the)f(services.)g(But)g
(each)g(client)g(has)h(to)f(kno)n(w)f(the)i(service)e(topology)-5
b(.)18 b(If)i(you)f(ha)n(v)o(e)396 2954 y(100)h(clients)g(and)g(then)f
(you)h(decide)f(to)i(add)e(three)h(more)f(services,)h(you)f(need)h(to)g
(recon\002gure)e(and)i(restart)g(100)396 3062 y(clients)h(in)f(order)f
(for)h(the)g(clients)g(to)h(kno)n(w)e(about)g(the)h(three)g(ne)n(w)g
(services.)-2 3228 y
SDict begin H.S end
 -2 3228 a -2 3228 a
SDict begin 13 H.A end
 -2 3228 a -2
3228 a
SDict begin [/View [/XYZ H.V]/Dest (0:914) cvn /DEST pdfmark end
 -2 3228 a 396 3336 a Fk(That')-5 b(s)21 b(clearly)e(not)h(the)g
(kind)g(of)g(thing)f(we)i(w)o(ant)f(to)g(be)g(doing)f(at)i(3am)f(when)f
(our)h(supercomputing)c(cluster)k(has)h(run)396 3444
y(out)f(of)g(resources)f(and)h(we)g(desperately)f(need)h(to)g(add)g(a)g
(couple)f(of)h(hundred)e(ne)n(w)i(service)g(nodes.)f(T)-7
b(oo)20 b(man)o(y)f(static)396 3551 y(pieces)h(are)h(lik)o(e)f(liquid)g
(concrete:)f(kno)n(wledge)f(is)j(distrib)n(uted)e(and)h(the)g(more)f
(static)i(pieces)f(you)g(ha)n(v)o(e,)f(the)h(more)396
3659 y(ef)n(fort)f(it)i(is)g(to)g(change)e(the)h(topology)-5
b(.)17 b(What)k(we)f(w)o(ant)h(is)g(something)d(sitting)j(in)f(between)
g(clients)g(and)g(services)g(that)396 3767 y(centralizes)g(all)h(kno)n
(wledge)d(of)i(the)g(topology)-5 b(.)17 b(Ideally)-5
b(,)19 b(we)h(should)g(be)g(able)g(to)g(add)g(and)f(remo)o(v)o(e)g
(services)h(or)396 3875 y(clients)h(at)f(an)o(y)g(time)g(without)g
(touching)e(an)o(y)h(other)h(part)g(of)g(the)g(topology)-5
b(.)-2 4059 y
SDict begin H.S end
 -2 4059 a -2 4059 a
SDict begin 13 H.A end
 -2 4059 a -2 4059 a
SDict begin [/View [/XYZ H.V]/Dest (0:915) cvn /DEST pdfmark end

-2 4059 a 396 4149 a Fk(So)21 b(we')o(ll)f(write)h(a)f(little)h
(message)f(queuing)e(brok)o(er)h(that)h(gi)n(v)o(es)g(us)h(this)f
(\003e)o(xibility)-5 b(.)19 b(The)h(brok)o(er)f(binds)g(to)i(tw)o(o)396
4257 y(endpoints,)e(a)h(frontend)e(for)i(clients)g(and)g(a)h(back)o
(end)d(for)i(services.)g(It)g(then)g(uses)h(zmq_poll[3])c(to)j(monitor)
f(these)396 4365 y(tw)o(o)i(sock)o(ets)f(for)g(acti)n(vity)f(and)h
(when)g(it)g(has)h(some,)f(it)h(shuttles)f(messages)g(between)g(its)h
(tw)o(o)f(sock)o(ets.)h(It)f(doesn')o(t)396 4473 y(actually)g(manage)f
(an)o(y)g(queues)h(e)o(xplicitly)f(--)h(\330MQ)g(does)g(that)g
(automatically)f(on)h(each)g(sock)o(et.)-2 4657 y
SDict begin H.S end
 -2
4657 a -2 4657 a
SDict begin 13 H.A end
 -2 4657 a -2 4657 a
SDict begin [/View [/XYZ H.V]/Dest (0:916) cvn /DEST pdfmark end
 -2 4657 a 396 4747
a Fk(When)g(you)f(use)h(REQ)g(to)g(talk)g(to)g(REP)h(you)e(get)h(a)g
(strictly)g(synchronous)d(request-reply)g(dialog.)i(The)h(client)f
(sends)h(a)396 4855 y(request,)g(the)g(service)g(reads)g(the)g(request)
f(and)h(sends)g(a)h(reply)-5 b(.)18 b(The)i(client)h(then)e(reads)h
(the)g(reply)-5 b(.)19 b(If)h(either)g(the)g(client)396
4963 y(or)g(the)g(service)g(try)g(to)h(do)e(an)o(ything)f(else)j
(\(e.g.)f(sending)f(tw)o(o)h(requests)g(in)g(a)h(ro)n(w)f(without)f(w)o
(aiting)h(for)g(a)g(response\))396 5071 y(the)o(y)g(will)h(get)f(an)g
(error)-5 b(.)p Black 3800 5569 a Ff(59)p Black eop end
%%Page: 60 73
TeXDict begin 60 72 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.60) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:917) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(But)i(our)e(brok)o(er)g(has)h(to)h(be)f
(non-blocking.)c(Ob)o(viously)j(we)h(can)g(use)h(zmq_poll[3])c(to)j(w)o
(ait)h(for)f(acti)n(vity)f(on)h(either)396 180 y(sock)o(et,)g(b)n(ut)g
(we)h(can')o(t)e(use)h(REP)h(and)f(REQ.)-2 361 y
SDict begin H.S end
 -2 361
a -2 361 a
SDict begin 13 H.A end
 -2 361 a -2 361 a
SDict begin [/View [/XYZ H.V]/Dest (0:918) cvn /DEST pdfmark end
 -2 361 a 396 454 a Fk(Luckily)f(there)h
(are)g(tw)o(o)h(sock)o(ets)f(called)g(DEALER)g(and)g(R)m(OUTER)g(that)h
(let)f(you)g(do)f(non-blocking)396 562 y(request-response.)f(Y)-9
b(ou')o(ll)19 b(see)i(in)f(Chapter)g(Three)f(ho)n(w)h(DEALER)g(and)g(R)
m(OUTER)g(sock)o(ets)h(let)f(you)g(b)n(uild)g(all)396
670 y(kinds)g(of)g(asynchronous)d(request-reply)h(\003o)n(ws.)i(F)o(or)
g(no)n(w)-5 b(,)19 b(we')l(re)h(just)g(going)f(to)i(see)f(ho)n(w)g
(DEALER)g(and)396 778 y(R)m(OUTER)h(let)g(us)f(e)o(xtend)f(REQ-REP)i
(across)f(an)g(intermediary)-5 b(,)17 b(that)k(is,)g(our)e(little)i
(brok)o(er)-5 b(.)-2 962 y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a
-2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:919) cvn /DEST pdfmark end
 -2 962 a 396 1052 a Fk(In)20 b(this)h(simple)f(stretched)g
(request-reply)d(pattern,)i(REQ)i(talks)g(to)f(R)m(OUTER)h(and)e
(DEALER)h(talks)h(to)f(REP)-9 b(.)21 b(In)396 1160 y(between)f(the)g
(DEALER)g(and)g(R)m(OUTER)g(we)h(ha)n(v)o(e)e(to)i(ha)n(v)o(e)e(code)h
(\(lik)o(e)g(our)f(brok)o(er\))g(that)h(pulls)g(messages)g(of)n(f)g
(the)396 1268 y(one)g(sock)o(et)g(and)g(sho)o(v)o(es)f(them)h(onto)f
(the)h(other\()p 0 TeXcolorgray 1831 1268 a
SDict begin H.S end
 1831 1268
a Fk(Figure)e(2-10)2221 1268 y
SDict begin 13 H.L end
 2221 1268 a 2221 1268
a
SDict begin [/Subtype /Link/Dest (0:figure-19) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2221 1268 a Black -2 w Fk(\).)-2 1286 y
SDict begin H.S end
 -2 1286 a -2
1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-19) cvn /DEST pdfmark
end
 -2 1286 a 396 1469 a Fg(Figur)o(e)i(2-10.)e
(Extended)j(Request-r)o(eply)-2 1569 y
SDict begin H.S end
 -2 1569 a -2 1569
a
SDict begin 13 H.A end
 -2 1569 a -2 1569 a
SDict begin [/View [/XYZ H.V]/Dest (0:923) cvn /DEST pdfmark end
 -2 1569 a 396 3861 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3861 a
@beginspecial 0 @llx -270 @lly 301 @urx 0 @ury 3010 @rwi
@setspecial
%%BeginDocument: images/fig19.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -270 301 0
%%HiResBoundingBox: 0.0 -270.0 301.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -27.100210189819336 moveto
19.100210189819336 -42.1002082824707 lineto
19.100210189819336 -45.43354161580404 20.433543523152668 -47.1002082824707 23.100210189819336 -47.1002082824707 curveto
86.10021209716797 -47.1002082824707 lineto
86.10021209716797 -47.1002082824707 lineto
88.10021209716797 -47.1002082824707 89.10021209716797 -45.43354161580404 89.10021209716797 -42.1002082824707 curveto
89.10021209716797 -27.100210189819336 lineto
89.10021209716797 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -27.100210189819336 moveto
117.10021209716797 -42.1002082824707 lineto
117.10021209716797 -45.43354161580404 118.4335454305013 -47.1002082824707 121.10021209716797 -47.1002082824707 curveto
184.10020446777344 -47.1002082824707 lineto
184.10020446777344 -47.1002082824707 lineto
186.10020446777344 -47.1002082824707 187.10020446777344 -45.43354161580404 187.10020446777344 -42.1002082824707 curveto
187.10020446777344 -27.100210189819336 lineto
187.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -27.100210189819336 moveto
215.10020446777344 -42.1002082824707 lineto
215.10020446777344 -45.43354161580404 216.43353780110678 -47.1002082824707 219.10020446777344 -47.1002082824707 curveto
282.1002197265625 -47.1002082824707 lineto
282.1002197265625 -47.1002082824707 lineto
284.1002197265625 -47.1002082824707 285.1002197265625 -45.43354161580404 285.1002197265625 -42.1002082824707 curveto
285.1002197265625 -27.100210189819336 lineto
285.1002197265625 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
114.10021209716797 -107.10021209716797 moveto
111.4335454305013 -107.10021209716797 110.10021209716797 -108.76687876383464 110.10021209716797 -112.10021209716797 curveto
110.10021209716797 -125.10021209716797 lineto
194.10020446777344 -125.10021209716797 lineto
194.10020446777344 -112.10021209716797 lineto
194.10020446777344 -108.76687876383464 193.10020446777344 -107.10021209716797 191.10020446777344 -107.10021209716797 curveto
114.10021209716797 -107.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -128.10020446777344 moveto
110.10021209716797 -145.10020446777344 lineto
194.10020446777344 -145.10020446777344 lineto
194.10020446777344 -128.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -148.10020446777344 moveto
110.10021209716797 -162.10020446777344 lineto
110.10021209716797 -165.43353780110678 111.4335454305013 -167.10020446777344 114.10021209716797 -167.10020446777344 curveto
191.10020446777344 -167.10020446777344 lineto
191.10020446777344 -167.10020446777344 lineto
193.10020446777344 -167.10020446777344 194.10020446777344 -165.43353780110678 194.10020446777344 -162.10020446777344 curveto
194.10020446777344 -148.5001983642578 lineto
194.10020446777344 -148.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.100210189819336 -227.10020446777344 moveto
20.433543523152668 -227.10020446777344 19.100210189819336 -228.7668711344401 19.100210189819336 -232.10020446777344 curveto
19.100210189819336 -247.10020446777344 lineto
89.10021209716797 -247.10020446777344 lineto
89.10021209716797 -232.10020446777344 lineto
89.10021209716797 -228.7668711344401 88.10021209716797 -227.10020446777344 86.10021209716797 -227.10020446777344 curveto
23.100210189819336 -227.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.10021209716797 -227.10020446777344 moveto
118.4335454305013 -227.10020446777344 117.10021209716797 -228.7668711344401 117.10021209716797 -232.10020446777344 curveto
117.10021209716797 -247.10020446777344 lineto
187.10020446777344 -247.10020446777344 lineto
187.10020446777344 -232.10020446777344 lineto
187.10020446777344 -228.7668711344401 186.10020446777344 -227.10020446777344 184.10020446777344 -227.10020446777344 curveto
121.10021209716797 -227.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
219.10020446777344 -227.10020446777344 moveto
216.43353780110678 -227.10020446777344 215.10020446777344 -228.7668711344401 215.10020446777344 -232.10020446777344 curveto
215.10020446777344 -247.10020446777344 lineto
285.1002197265625 -247.10020446777344 lineto
285.1002197265625 -232.10020446777344 lineto
285.1002197265625 -228.7668711344401 284.1002197265625 -227.10020446777344 282.1002197265625 -227.10020446777344 curveto
219.10020446777344 -227.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -25.0 moveto
17.0 -40.0 lineto
17.0 -43.333333333333336 18.333333333333332 -45.0 21.0 -45.0 curveto
84.0 -45.0 lineto
84.0 -45.0 lineto
86.0 -45.0 87.0 -43.333333333333336 87.0 -40.0 curveto
87.0 -25.0 lineto
87.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -40.0 lineto
115.0 -43.333333333333336 116.33333333333333 -45.0 119.0 -45.0 curveto
182.0 -45.0 lineto
182.0 -45.0 lineto
184.0 -45.0 185.0 -43.333333333333336 185.0 -40.0 curveto
185.0 -25.0 lineto
185.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -40.0 lineto
213.0 -43.333333333333336 214.33333333333334 -45.0 217.0 -45.0 curveto
280.0 -45.0 lineto
280.0 -45.0 lineto
282.0 -45.0 283.0 -43.333333333333336 283.0 -40.0 curveto
283.0 -25.0 lineto
283.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -105.0 moveto
109.33333333333333 -105.0 108.0 -106.66666666666667 108.0 -110.0 curveto
108.0 -123.0 lineto
192.0 -123.0 lineto
192.0 -110.0 lineto
192.0 -106.66666666666667 191.0 -105.0 189.0 -105.0 curveto
112.0 -105.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -105.0 moveto
109.33333333333333 -105.0 108.0 -106.66666666666667 108.0 -110.0 curveto
108.0 -123.0 lineto
192.0 -123.0 lineto
192.0 -110.0 lineto
192.0 -106.66666666666667 191.0 -105.0 189.0 -105.0 curveto
112.0 -105.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -126.0 moveto
108.0 -143.0 lineto
192.0 -143.0 lineto
192.0 -126.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -126.0 moveto
108.0 -143.0 lineto
192.0 -143.0 lineto
192.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -146.0 moveto
108.0 -160.0 lineto
108.0 -163.33333333333334 109.33333333333333 -165.0 112.0 -165.0 curveto
189.0 -165.0 lineto
189.0 -165.0 lineto
191.0 -165.0 192.0 -163.33333333333334 192.0 -160.0 curveto
192.0 -146.39999389648438 lineto
192.0 -146.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -146.0 moveto
108.0 -160.0 lineto
108.0 -163.33333333333334 109.33333333333333 -165.0 112.0 -165.0 curveto
189.0 -165.0 lineto
189.0 -165.0 lineto
191.0 -165.0 192.0 -163.33333333333334 192.0 -160.0 curveto
192.0 -146.39999389648438 lineto
192.0 -146.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
21.0 -225.0 moveto
18.333333333333332 -225.0 17.0 -226.66666666666666 17.0 -230.0 curveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -230.0 lineto
87.0 -226.66666666666666 86.0 -225.0 84.0 -225.0 curveto
21.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
21.0 -225.0 moveto
18.333333333333332 -225.0 17.0 -226.66666666666666 17.0 -230.0 curveto
17.0 -245.0 lineto
87.0 -245.0 lineto
87.0 -230.0 lineto
87.0 -226.66666666666666 86.0 -225.0 84.0 -225.0 curveto
21.0 -225.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
119.0 -225.0 moveto
116.33333333333333 -225.0 115.0 -226.66666666666666 115.0 -230.0 curveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -230.0 lineto
185.0 -226.66666666666666 184.0 -225.0 182.0 -225.0 curveto
119.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
119.0 -225.0 moveto
116.33333333333333 -225.0 115.0 -226.66666666666666 115.0 -230.0 curveto
115.0 -245.0 lineto
185.0 -245.0 lineto
185.0 -230.0 lineto
185.0 -226.66666666666666 184.0 -225.0 182.0 -225.0 curveto
119.0 -225.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
217.0 -225.0 moveto
214.33333333333334 -225.0 213.0 -226.66666666666666 213.0 -230.0 curveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -230.0 lineto
283.0 -226.66666666666666 282.0 -225.0 280.0 -225.0 curveto
217.0 -225.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
217.0 -225.0 moveto
214.33333333333334 -225.0 213.0 -226.66666666666666 213.0 -230.0 curveto
213.0 -245.0 lineto
283.0 -245.0 lineto
283.0 -230.0 lineto
283.0 -226.66666666666666 282.0 -225.0 280.0 -225.0 curveto
217.0 -225.0 lineto
closepath
stroke
newpath
52.0 -45.0 moveto
52.0 -75.0 lineto
150.0 -75.0 lineto
stroke
newpath
150.0 -45.0 moveto
150.0 -75.0 lineto
stroke
newpath
248.0 -45.0 moveto
248.0 -75.0 lineto
150.0 -75.0 lineto
stroke
newpath
150.0 -105.0 moveto
150.0 -75.0 lineto
stroke
newpath
150.0 -165.0 moveto
150.0 -195.0 lineto
stroke
newpath
52.0 -225.0 moveto
52.0 -195.0 lineto
150.0 -195.0 lineto
stroke
newpath
150.0 -225.0 moveto
150.0 -195.0 lineto
stroke
newpath
248.0 -225.0 moveto
248.0 -195.0 lineto
150.0 -195.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
42.0 -38.0 moveto
(REQ) show
140.0 -38.0 moveto
(REQ) show
238.0 -38.0 moveto
(REQ) show
127.0 -118.0 moveto
(ROUTER) show
134.0 -139.0 moveto
(code) show
128.0 -158.0 moveto
(DEALER) show
42.0 -239.0 moveto
(REP) show
140.0 -239.0 moveto
(REP) show
238.0 -239.0 moveto
(REP) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3861 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3861 a -2 4027 a
SDict begin H.S end
 -2 4027
a -2 4027 a
SDict begin 13 H.A end
 -2 4027 a -2 4027 a
SDict begin [/View [/XYZ H.V]/Dest (0:926) cvn /DEST pdfmark end
 -2 4027 a 396 4135 a
Fk(The)f(request-reply)e(brok)o(er)h(binds)g(to)i(tw)o(o)f(endpoints,)e
(one)i(for)g(clients)g(to)g(connect)f(to)i(\(the)f(frontend)e(sock)o
(et\))h(and)396 4243 y(one)h(for)f(w)o(ork)o(ers)h(to)g(connect)f(to)i
(\(the)e(back)o(end\).)f(T)-7 b(o)21 b(test)g(this)g(brok)o(er)m(,)d
(you)h(will)i(w)o(ant)f(to)g(change)f(your)g(w)o(ork)o(ers)h(so)396
4351 y(the)o(y)g(connect)f(to)h(the)g(back)o(end)f(sock)o(et.)h(Here)g
(are)g(a)g(client)h(and)e(w)o(ork)o(er)g(that)i(sho)n(w)f(what)g(I)g
(mean:)-2 4369 y
SDict begin H.S end
 -2 4369 a -2 4369 a
SDict begin 13 H.A end
 -2 4369 a -2 4369
a
SDict begin [/View [/XYZ H.V]/Dest (0:rrclient-c) cvn /DEST pdfmark
end
 -2 4369 a 396 4552 a Fg(Example)h(2-6.)e(Request-r)o(eply)g(client)i
(\(rr)o(client.c\))-2 4652 y
SDict begin H.S end
 -2 4652 a -2 4652 a
SDict begin 11.7 H.A end
 -2 4652
a -2 4652 a
SDict begin [/View [/XYZ H.V]/Dest (0:929) cvn /DEST pdfmark end
 -2 4652 a 396 4732 a Fe(//)396 4829 y(//)90
b(Hello)44 b(World)g(client)396 4926 y(//)90 b(Connects)43
b(REQ)h(socket)g(to)h(tcp://localhost:5559)396 5023 y(//)90
b(Sends)44 b("Hello")f(to)i(server,)e(expects)h("World")g(back)396
5121 y(//)p Black 3800 5569 a Ff(60)p Black eop end
%%Page: 61 74
TeXDict begin 61 73 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.61) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe(#include)44 b("zhelpers.h")396 267
y(int)h(main)f(\(void\))396 364 y({)576 461 y(void)800
474 y(*)845 461 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
655 y(//)89 b(Socket)44 b(to)g(talk)g(to)h(server)576
752 y(void)800 765 y(*)845 752 y(requester)e(=)i(zmq_socket)e
(\(context,)g(ZMQ_REQ\);)576 850 y(zmq_connect)g(\(requester,)g
("tcp://localhost:5559"\);)576 1044 y(int)h(request_nbr;)576
1141 y(for)g(\(request_nbr)f(=)h(0;)h(request_nbr)e(!=)h(10;)h
(request_nbr++\))d({)755 1238 y(s_send)i(\(requester,)f("Hello"\);)755
1335 y(char)979 1348 y(*)1024 1335 y(string)h(=)g(s_recv)g
(\(requester\);)755 1432 y(printf)g(\("Received)f(reply)h(\045d)g
([\045s]\\n",)g(request_nbr,)f(string\);)755 1530 y(free)h(\(string\);)
576 1627 y(})576 1724 y(zmq_close)f(\(requester\);)576
1821 y(zmq_ctx_destroy)f(\(context\);)576 1918 y(return)h(0;)396
2015 y(})-2 2189 y
SDict begin H.S end
 -2 2189 a -2 2189 a
SDict begin 13 H.A end
 -2 2189 a -2 2189
a
SDict begin [/View [/XYZ H.V]/Dest (0:930) cvn /DEST pdfmark end
 -2 2189 a 396 2289 a Fk(Here)20 b(is)h(the)g(w)o(ork)o(er:)-2
2290 y
SDict begin H.S end
 -2 2290 a -2 2290 a
SDict begin 13 H.A end
 -2 2290 a -2 2290 a
SDict begin [/View [/XYZ H.V]/Dest (0:rrworker-c) cvn /DEST pdfmark
end
 -2 2290
a 396 2490 a Fg(Example)g(2-7.)e(Request-r)o(eply)g(w)o(ork)o(er)h
(\(rrw)o(ork)o(er)-8 b(.c\))-2 2590 y
SDict begin H.S end
 -2 2590 a -2 2590
a
SDict begin 11.7 H.A end
 -2 2590 a -2 2590 a
SDict begin [/View [/XYZ H.V]/Dest (0:933) cvn /DEST pdfmark end
 -2 2590 a 396 2671 a Fe(//)396
2768 y(//)90 b(Hello)44 b(World)g(worker)396 2865 y(//)90
b(Connects)43 b(REP)h(socket)g(to)h(tcp://)1877 2878
y(*)1922 2865 y(:5560)396 2962 y(//)90 b(Expects)43 b("Hello")h(from)g
(client,)g(replies)f(with)i("World")396 3059 y(//)396
3156 y(#include)f("zhelpers.h")396 3351 y(int)h(main)f(\(void\))396
3448 y({)576 3545 y(void)800 3558 y(*)845 3545 y(context)f(=)i
(zmq_ctx_new)e(\(\);)576 3739 y(//)89 b(Socket)44 b(to)g(talk)g(to)h
(clients)576 3836 y(void)800 3849 y(*)845 3836 y(responder)e(=)i
(zmq_socket)e(\(context,)g(ZMQ_REP\);)576 3933 y(zmq_connect)g
(\(responder,)g("tcp://localhost:5560"\);)576 4128 y(while)h(\(true\))f
({)755 4225 y(//)89 b(Wait)44 b(for)h(next)f(request)g(from)g(client)
755 4322 y(char)979 4335 y(*)1024 4322 y(string)g(=)g(s_recv)g
(\(responder\);)755 4419 y(printf)g(\("Received)f(request:)g
([\045s]\\n",)h(string\);)755 4516 y(free)g(\(string\);)755
4711 y(//)89 b(Do)45 b(some)f('work')755 4808 y(sleep)g(\(1\);)755
5002 y(//)89 b(Send)44 b(reply)g(back)h(to)f(client)755
5099 y(s_send)g(\(responder,)f("World"\);)p Black 3800
5569 a Ff(61)p Black eop end
%%Page: 62 75
TeXDict begin 62 74 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.62) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(})576 170 y(//)89 b(We)44 b(never)g(get)h(here)f(but)
g(clean)g(up)h(anyhow)576 267 y(zmq_close)e(\(responder\);)576
364 y(zmq_ctx_destroy)f(\(context\);)576 461 y(return)h(0;)396
558 y(})-2 732 y
SDict begin H.S end
 -2 732 a -2 732 a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:934) cvn /DEST pdfmark end

-2 732 a 396 832 a Fk(And)20 b(here)g(is)h(the)f(brok)o(er)m(,)e(which)
i(properly)e(handles)h(multi-part)g(messages:)-2 850
y
SDict begin H.S end
 -2 850 a -2 850 a
SDict begin 13 H.A end
 -2 850 a -2 850 a
SDict begin [/View [/XYZ H.V]/Dest (0:rrbroker-c) cvn /DEST pdfmark
end
 -2 850 a 396 1033
a Fg(Example)i(2-8.)e(Request-r)o(eply)g(br)o(ok)o(er)h(\(rrbr)o(ok)o
(er)-8 b(.c\))-2 1133 y
SDict begin H.S end
 -2 1133 a -2 1133 a
SDict begin 11.7 H.A end
 -2 1133 a
-2 1133 a
SDict begin [/View [/XYZ H.V]/Dest (0:937) cvn /DEST pdfmark end
 -2 1133 a 396 1214 a Fe(//)396 1311 y(//)90
b(Simple)43 b(request-reply)g(broker)396 1408 y(//)396
1505 y(#include)h("zhelpers.h")396 1699 y(int)h(main)f(\(void\))396
1796 y({)576 1894 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(sockets)
576 1991 y(void)800 2004 y(*)845 1991 y(context)f(=)i(zmq_ctx_new)e
(\(\);)576 2088 y(void)800 2101 y(*)845 2088 y(frontend)g(=)i
(zmq_socket)e(\(context,)g(ZMQ_ROUTER\);)576 2185 y(void)800
2198 y(*)845 2185 y(backend)88 b(=)45 b(zmq_socket)e(\(context,)g
(ZMQ_DEALER\);)576 2282 y(zmq_bind)g(\(frontend,)g("tcp://)1787
2295 y(*)1832 2282 y(:5559"\);)576 2379 y(zmq_bind)g(\(backend,)88
b("tcp://)1787 2392 y(*)1832 2379 y(:5560"\);)576 2574
y(//)h(Initialize)43 b(poll)h(set)576 2671 y(zmq_pollitem_t)e(items)i
([])h(=)f({)755 2768 y({)h(frontend,)e(0,)h(ZMQ_POLLIN,)f(0)i(},)755
2865 y({)g(backend,)88 b(0,)44 b(ZMQ_POLLIN,)f(0)i(})576
2962 y(};)576 3059 y(//)89 b(Switch)44 b(messages)f(between)h(sockets)
576 3156 y(while)g(\(true\))f({)755 3253 y(zmq_msg_t)g(message;)755
3351 y(int64_t)h(more;)492 b(//)89 b(Multipart)44 b(detection)755
3545 y(zmq_poll)f(\(items,)h(2,)h(-1\);)755 3642 y(if)f(\(items)g
([0].revents)f(&)i(ZMQ_POLLIN\))e({)934 3739 y(while)h(\(true\))g({)
1114 3836 y(//)89 b(Process)44 b(all)g(parts)g(of)g(the)h(message)1114
3933 y(zmq_msg_init)d(\(&message\);)1114 4031 y(zmq_msg_recv)g
(\(&message,)i(frontend,)f(0\);)1114 4128 y(size_t)g(more_size)h(=)g
(sizeof)g(\(more\);)1114 4225 y(zmq_getsockopt)e(\(frontend,)h
(ZMQ_RCVMORE,)g(&more,)h(&more_size\);)1114 4322 y(zmq_msg_send)e
(\(&message,)i(backend,)f(more?)h(ZMQ_SNDMORE:)f(0\);)1114
4419 y(zmq_msg_close)f(\(&message\);)1114 4516 y(if)i(\(!more\))1293
4613 y(break;)268 b(//)89 b(Last)44 b(message)g(part)934
4711 y(})755 4808 y(})755 4905 y(if)g(\(items)g([1].revents)f(&)i
(ZMQ_POLLIN\))e({)934 5002 y(while)h(\(true\))g({)1114
5099 y(//)89 b(Process)44 b(all)g(parts)g(of)g(the)h(message)p
Black 3800 5569 a Ff(62)p Black eop end
%%Page: 63 76
TeXDict begin 63 75 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.63) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:945) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 1114 72 a Fe(zmq_msg_init)42 b(\(&message\);)1114
170 y(zmq_msg_recv)g(\(&message,)i(backend,)f(0\);)1114
267 y(size_t)g(more_size)h(=)g(sizeof)g(\(more\);)1114
364 y(zmq_getsockopt)e(\(backend,)h(ZMQ_RCVMORE,)g(&more,)h
(&more_size\);)1114 461 y(zmq_msg_send)e(\(&message,)i(frontend,)f
(more?)h(ZMQ_SNDMORE:)f(0\);)1114 558 y(zmq_msg_close)f(\(&message\);)
1114 655 y(if)i(\(!more\))1293 752 y(break;)268 b(//)89
b(Last)44 b(message)g(part)934 850 y(})755 947 y(})576
1044 y(})576 1141 y(//)89 b(We)44 b(never)g(get)h(here)f(but)g(clean)g
(up)h(anyhow)576 1238 y(zmq_close)e(\(frontend\);)576
1335 y(zmq_close)g(\(backend\);)576 1432 y(zmq_ctx_destroy)f
(\(context\);)576 1530 y(return)h(0;)396 1627 y(})-2
1801 y
SDict begin H.S end
 -2 1801 a -2 1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:938) cvn /DEST pdfmark end
 -2 1801
a 396 1901 a Fk(Using)20 b(a)h(request-reply)d(brok)o(er)g(mak)o(es)i
(your)f(client-serv)o(er)g(architectures)g(easier)h(to)g(scale)h(since)
f(clients)h(don')o(t)e(see)396 2009 y(w)o(ork)o(ers,)h(and)f(w)o(ork)o
(ers)h(don')o(t)e(see)j(clients.)f(The)g(only)f(static)i(node)f(is)h
(the)f(brok)o(er)f(in)h(the)g(middle\()p 0 TeXcolorgray
3309 2009 a
SDict begin H.S end
 3309 2009 a Fk(Figure)e(2-11)3699 2009 y
SDict begin 13 H.L end

3699 2009 a 3699 2009 a
SDict begin [/Subtype /Link/Dest (0:figure-20) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3699 2009 a Black -2 w Fk(\).)-2
2027 y
SDict begin H.S end
 -2 2027 a -2 2027 a
SDict begin 13 H.A end
 -2 2027 a -2 2027 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-20) cvn /DEST pdfmark
end
 -2 2027
a Black 3800 5569 a Ff(63)p Black eop end
%%Page: 64 77
TeXDict begin 64 76 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.64) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:948) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-11.)e(Request-r)o(eply)i(Br)o(ok)o(er)
-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:942) cvn /DEST pdfmark end
 -2 172 a
396 4297 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4297 a @beginspecial 0 @llx -490 @lly
301 @urx 0 @ury 3010 @rwi @setspecial
%%BeginDocument: images/fig20.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -490 301 0
%%HiResBoundingBox: 0.0 -490.0 301.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -27.100210189819336 moveto
19.100210189819336 -65.10021209716797 lineto
89.10021209716797 -65.10021209716797 lineto
89.10021209716797 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -68.10021209716797 moveto
19.100210189819336 -82.10021209716797 lineto
19.100210189819336 -85.4335454305013 20.433543523152668 -87.10021209716797 23.100210189819336 -87.10021209716797 curveto
86.10021209716797 -87.10021209716797 lineto
86.10021209716797 -87.10021209716797 lineto
88.10021209716797 -87.10021209716797 89.10021209716797 -85.4335454305013 89.10021209716797 -82.10021209716797 curveto
89.10021209716797 -68.50021362304688 lineto
89.10021209716797 -68.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -27.100210189819336 moveto
117.10021209716797 -65.10021209716797 lineto
187.10020446777344 -65.10021209716797 lineto
187.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -68.10021209716797 moveto
117.10021209716797 -82.10021209716797 lineto
117.10021209716797 -85.4335454305013 118.4335454305013 -87.10021209716797 121.10021209716797 -87.10021209716797 curveto
184.10020446777344 -87.10021209716797 lineto
184.10020446777344 -87.10021209716797 lineto
186.10020446777344 -87.10021209716797 187.10020446777344 -85.4335454305013 187.10020446777344 -82.10021209716797 curveto
187.10020446777344 -68.50021362304688 lineto
187.10020446777344 -68.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -27.100210189819336 moveto
215.10020446777344 -65.10021209716797 lineto
285.1002197265625 -65.10021209716797 lineto
285.1002197265625 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -68.10021209716797 moveto
215.10020446777344 -82.10021209716797 lineto
215.10020446777344 -85.4335454305013 216.43353780110678 -87.10021209716797 219.10020446777344 -87.10021209716797 curveto
282.1002197265625 -87.10021209716797 lineto
282.1002197265625 -87.10021209716797 lineto
284.1002197265625 -87.10021209716797 285.1002197265625 -85.4335454305013 285.1002197265625 -82.10021209716797 curveto
285.1002197265625 -68.50021362304688 lineto
285.1002197265625 -68.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
114.10021209716797 -207.10020446777344 moveto
111.4335454305013 -207.10020446777344 110.10021209716797 -208.7668711344401 110.10021209716797 -212.10020446777344 curveto
110.10021209716797 -225.10020446777344 lineto
194.10020446777344 -225.10020446777344 lineto
194.10020446777344 -212.10020446777344 lineto
194.10020446777344 -208.7668711344401 193.10020446777344 -207.10020446777344 191.10020446777344 -207.10020446777344 curveto
114.10021209716797 -207.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -228.10020446777344 moveto
110.10021209716797 -265.1002197265625 lineto
194.10020446777344 -265.1002197265625 lineto
194.10020446777344 -228.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
110.10021209716797 -268.1002197265625 moveto
110.10021209716797 -282.1002197265625 lineto
110.10021209716797 -285.4335530598958 111.4335454305013 -287.1002197265625 114.10021209716797 -287.1002197265625 curveto
191.10020446777344 -287.1002197265625 lineto
191.10020446777344 -287.1002197265625 lineto
193.10020446777344 -287.1002197265625 194.10020446777344 -285.4335530598958 194.10020446777344 -282.1002197265625 curveto
194.10020446777344 -268.5002136230469 lineto
194.10020446777344 -268.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.100210189819336 -397.1002197265625 moveto
20.433543523152668 -397.1002197265625 19.100210189819336 -398.7668863932292 19.100210189819336 -402.1002197265625 curveto
19.100210189819336 -415.1002197265625 lineto
89.10021209716797 -415.1002197265625 lineto
89.10021209716797 -402.1002197265625 lineto
89.10021209716797 -398.7668863932292 88.10021209716797 -397.1002197265625 86.10021209716797 -397.1002197265625 curveto
23.100210189819336 -397.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -418.1002197265625 moveto
19.100210189819336 -467.1002197265625 lineto
89.10021209716797 -467.1002197265625 lineto
89.10021209716797 -418.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.10021209716797 -397.1002197265625 moveto
118.4335454305013 -397.1002197265625 117.10021209716797 -398.7668863932292 117.10021209716797 -402.1002197265625 curveto
117.10021209716797 -415.1002197265625 lineto
187.10020446777344 -415.1002197265625 lineto
187.10020446777344 -402.1002197265625 lineto
187.10020446777344 -398.7668863932292 186.10020446777344 -397.1002197265625 184.10020446777344 -397.1002197265625 curveto
121.10021209716797 -397.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
117.10021209716797 -418.1002197265625 moveto
117.10021209716797 -467.1002197265625 lineto
187.10020446777344 -467.1002197265625 lineto
187.10020446777344 -418.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
219.10020446777344 -397.1002197265625 moveto
216.43353780110678 -397.1002197265625 215.10020446777344 -398.7668863932292 215.10020446777344 -402.1002197265625 curveto
215.10020446777344 -415.1002197265625 lineto
285.1002197265625 -415.1002197265625 lineto
285.1002197265625 -402.1002197265625 lineto
285.1002197265625 -398.7668863932292 284.1002197265625 -397.1002197265625 282.1002197265625 -397.1002197265625 curveto
219.10020446777344 -397.1002197265625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
215.10020446777344 -418.1002197265625 moveto
215.10020446777344 -467.1002197265625 lineto
285.1002197265625 -467.1002197265625 lineto
285.1002197265625 -418.1002197265625 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -25.0 moveto
17.0 -63.0 lineto
87.0 -63.0 lineto
87.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
17.0 -25.0 moveto
17.0 -63.0 lineto
87.0 -63.0 lineto
87.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -66.0 moveto
17.0 -80.0 lineto
17.0 -83.33333333333333 18.333333333333332 -85.0 21.0 -85.0 curveto
84.0 -85.0 lineto
84.0 -85.0 lineto
86.0 -85.0 87.0 -83.33333333333333 87.0 -80.0 curveto
87.0 -66.4000015258789 lineto
87.0 -66.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
17.0 -66.0 moveto
17.0 -80.0 lineto
17.0 -83.33333333333333 18.333333333333332 -85.0 21.0 -85.0 curveto
84.0 -85.0 lineto
84.0 -85.0 lineto
86.0 -85.0 87.0 -83.33333333333333 87.0 -80.0 curveto
87.0 -66.4000015258789 lineto
87.0 -66.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -63.0 lineto
185.0 -63.0 lineto
185.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -25.0 moveto
115.0 -63.0 lineto
185.0 -63.0 lineto
185.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -66.0 moveto
115.0 -80.0 lineto
115.0 -83.33333333333333 116.33333333333333 -85.0 119.0 -85.0 curveto
182.0 -85.0 lineto
182.0 -85.0 lineto
184.0 -85.0 185.0 -83.33333333333333 185.0 -80.0 curveto
185.0 -66.4000015258789 lineto
185.0 -66.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -66.0 moveto
115.0 -80.0 lineto
115.0 -83.33333333333333 116.33333333333333 -85.0 119.0 -85.0 curveto
182.0 -85.0 lineto
182.0 -85.0 lineto
184.0 -85.0 185.0 -83.33333333333333 185.0 -80.0 curveto
185.0 -66.4000015258789 lineto
185.0 -66.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -63.0 lineto
283.0 -63.0 lineto
283.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -25.0 moveto
213.0 -63.0 lineto
283.0 -63.0 lineto
283.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -66.0 moveto
213.0 -80.0 lineto
213.0 -83.33333333333333 214.33333333333334 -85.0 217.0 -85.0 curveto
280.0 -85.0 lineto
280.0 -85.0 lineto
282.0 -85.0 283.0 -83.33333333333333 283.0 -80.0 curveto
283.0 -66.4000015258789 lineto
283.0 -66.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -66.0 moveto
213.0 -80.0 lineto
213.0 -83.33333333333333 214.33333333333334 -85.0 217.0 -85.0 curveto
280.0 -85.0 lineto
280.0 -85.0 lineto
282.0 -85.0 283.0 -83.33333333333333 283.0 -80.0 curveto
283.0 -66.4000015258789 lineto
283.0 -66.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -205.0 moveto
109.33333333333333 -205.0 108.0 -206.66666666666666 108.0 -210.0 curveto
108.0 -223.0 lineto
192.0 -223.0 lineto
192.0 -210.0 lineto
192.0 -206.66666666666666 191.0 -205.0 189.0 -205.0 curveto
112.0 -205.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -205.0 moveto
109.33333333333333 -205.0 108.0 -206.66666666666666 108.0 -210.0 curveto
108.0 -223.0 lineto
192.0 -223.0 lineto
192.0 -210.0 lineto
192.0 -206.66666666666666 191.0 -205.0 189.0 -205.0 curveto
112.0 -205.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -226.0 moveto
108.0 -263.0 lineto
192.0 -263.0 lineto
192.0 -226.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -226.0 moveto
108.0 -263.0 lineto
192.0 -263.0 lineto
192.0 -226.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -266.0 moveto
108.0 -280.0 lineto
108.0 -283.3333333333333 109.33333333333333 -285.0 112.0 -285.0 curveto
189.0 -285.0 lineto
189.0 -285.0 lineto
191.0 -285.0 192.0 -283.3333333333333 192.0 -280.0 curveto
192.0 -266.3999938964844 lineto
192.0 -266.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -266.0 moveto
108.0 -280.0 lineto
108.0 -283.3333333333333 109.33333333333333 -285.0 112.0 -285.0 curveto
189.0 -285.0 lineto
189.0 -285.0 lineto
191.0 -285.0 192.0 -283.3333333333333 192.0 -280.0 curveto
192.0 -266.3999938964844 lineto
192.0 -266.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
21.0 -395.0 moveto
18.333333333333332 -395.0 17.0 -396.6666666666667 17.0 -400.0 curveto
17.0 -413.0 lineto
87.0 -413.0 lineto
87.0 -400.0 lineto
87.0 -396.6666666666667 86.0 -395.0 84.0 -395.0 curveto
21.0 -395.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
21.0 -395.0 moveto
18.333333333333332 -395.0 17.0 -396.6666666666667 17.0 -400.0 curveto
17.0 -413.0 lineto
87.0 -413.0 lineto
87.0 -400.0 lineto
87.0 -396.6666666666667 86.0 -395.0 84.0 -395.0 curveto
21.0 -395.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -416.0 moveto
17.0 -465.0 lineto
87.0 -465.0 lineto
87.0 -416.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
17.0 -416.0 moveto
17.0 -465.0 lineto
87.0 -465.0 lineto
87.0 -416.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
119.0 -395.0 moveto
116.33333333333333 -395.0 115.0 -396.6666666666667 115.0 -400.0 curveto
115.0 -413.0 lineto
185.0 -413.0 lineto
185.0 -400.0 lineto
185.0 -396.6666666666667 184.0 -395.0 182.0 -395.0 curveto
119.0 -395.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
119.0 -395.0 moveto
116.33333333333333 -395.0 115.0 -396.6666666666667 115.0 -400.0 curveto
115.0 -413.0 lineto
185.0 -413.0 lineto
185.0 -400.0 lineto
185.0 -396.6666666666667 184.0 -395.0 182.0 -395.0 curveto
119.0 -395.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -416.0 moveto
115.0 -465.0 lineto
185.0 -465.0 lineto
185.0 -416.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -416.0 moveto
115.0 -465.0 lineto
185.0 -465.0 lineto
185.0 -416.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
217.0 -395.0 moveto
214.33333333333334 -395.0 213.0 -396.6666666666667 213.0 -400.0 curveto
213.0 -413.0 lineto
283.0 -413.0 lineto
283.0 -400.0 lineto
283.0 -396.6666666666667 282.0 -395.0 280.0 -395.0 curveto
217.0 -395.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
217.0 -395.0 moveto
214.33333333333334 -395.0 213.0 -396.6666666666667 213.0 -400.0 curveto
213.0 -413.0 lineto
283.0 -413.0 lineto
283.0 -400.0 lineto
283.0 -396.6666666666667 282.0 -395.0 280.0 -395.0 curveto
217.0 -395.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
213.0 -416.0 moveto
213.0 -465.0 lineto
283.0 -465.0 lineto
283.0 -416.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
213.0 -416.0 moveto
213.0 -465.0 lineto
283.0 -465.0 lineto
283.0 -416.0 lineto
closepath
stroke
newpath
133.0 -165.0 moveto
139.0 -165.0 lineto
stroke
newpath
147.0 -180.0 moveto
150.0 -190.0 lineto
154.0 -180.0 lineto
closepath
fill
newpath
49.0 -370.0 moveto
52.0 -380.0 lineto
56.0 -370.0 lineto
closepath
fill
newpath
147.0 -370.0 moveto
150.0 -380.0 lineto
154.0 -370.0 lineto
closepath
fill
newpath
245.0 -370.0 moveto
248.0 -380.0 lineto
252.0 -370.0 lineto
closepath
fill
newpath
52.0 -105.0 moveto
52.0 -145.0 lineto
150.0 -145.0 lineto
stroke
newpath
150.0 -105.0 moveto
150.0 -145.0 lineto
stroke
newpath
248.0 -105.0 moveto
248.0 -145.0 lineto
150.0 -145.0 lineto
stroke
newpath
150.0 -185.0 moveto
150.0 -145.0 lineto
stroke
newpath
150.0 -305.0 moveto
150.0 -335.0 lineto
stroke
newpath
52.0 -375.0 moveto
52.0 -335.0 lineto
150.0 -335.0 lineto
stroke
newpath
150.0 -375.0 moveto
150.0 -335.0 lineto
stroke
newpath
248.0 -375.0 moveto
248.0 -335.0 lineto
150.0 -335.0 lineto
stroke
/Helvetica findfont
10 scalefont setfont
33.0 -49.0 moveto
(Client) show
131.0 -49.0 moveto
(Client) show
229.0 -49.0 moveto
(Client) show
42.0 -78.0 moveto
(REQ) show
140.0 -78.0 moveto
(REQ) show
238.0 -78.0 moveto
(REQ) show
30.0 -99.0 moveto
(connect) show
128.0 -99.0 moveto
(connect) show
226.0 -99.0 moveto
(connect) show
30.0 -129.0 moveto
(request) show
128.0 -129.0 moveto
(request) show
226.0 -129.0 moveto
(request) show
114.0 -169.0 moveto
(fair queuing) show
135.0 -199.0 moveto
(bind) show
127.0 -218.0 moveto
(ROUTER) show
135.0 -249.0 moveto
(Broker) show
128.0 -278.0 moveto
(DEALER) show
135.0 -299.0 moveto
(bind) show
107.0 -319.0 moveto
(load balancing) show
30.0 -359.0 moveto
(request) show
128.0 -359.0 moveto
(request) show
226.0 -359.0 moveto
(request) show
30.0 -389.0 moveto
(connect) show
128.0 -389.0 moveto
(connect) show
226.0 -389.0 moveto
(connect) show
42.0 -409.0 moveto
(REP) show
140.0 -409.0 moveto
(REP) show
238.0 -409.0 moveto
(REP) show
31.0 -439.0 moveto
(Service) show
50.0 -449.0 moveto
(A ) show
129.0 -439.0 moveto
(Service) show
149.0 -449.0 moveto
(B ) show
227.0 -439.0 moveto
(Service) show
247.0 -449.0 moveto
(C ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4297 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4297 a -2 4380 a
SDict begin H.S end
 -2 4380
a -2 4380 a
SDict begin 13 H.A end
 -2 4380 a -2 4380 a
SDict begin [/View [/XYZ H.V]/Dest (0:945) cvn /DEST pdfmark end
 -2 4380 a 396 4708 a
Fb(2.17.3.)36 b(\330MQ')-7 b(s)33 b(Built-in)h(Pr)n(o)l(xy)g(Function)
2515 4708 y
SDict begin H.S end
 2515 4708 a 2515 4708 a
SDict begin 18.72 H.A end
 2515 4708 a 2515
4708 a
SDict begin [/View [/XYZ H.V]/Dest (7.38.3.2) cvn /DEST pdfmark end
 2515 4708 a -2 4899 a
SDict begin H.S end
 -2 4899 a -2 4899 a
SDict begin 13 H.A end
 -2 4899
a -2 4899 a
SDict begin [/View [/XYZ H.V]/Dest (0:947) cvn /DEST pdfmark end
 -2 4899 a 396 4982 a Fk(It)21 b(turns)f(out)f(that)i(that)f
(core)g(loop)f(in)h(rrbrok)o(er)e(is)j(v)o(ery)e(useful,)h(and)f
(reusable.)h(It)g(lets)h(us)g(b)n(uild)e(pub-sub)g(forw)o(arders)396
5090 y(and)h(shared)f(queues)h(and)f(other)h(little)h(intermediaries,)d
(with)j(v)o(ery)e(little)i(ef)n(fort.)d(\330MQ)j(wraps)f(this)h(up)e
(in)i(a)f(single)p Black 3800 5569 a Ff(64)p Black eop
end
%%Page: 65 78
TeXDict begin 65 77 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.65) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(method,)g(zmq_proxy[3]:)396 253 y Fe(zmq_proxy)44
b(\(frontend,)f(backend,)g(capture\);)-2 430 y
SDict begin H.S end
 -2 430
a -2 430 a
SDict begin 13 H.A end
 -2 430 a -2 430 a
SDict begin [/View [/XYZ H.V]/Dest (0:949) cvn /DEST pdfmark end
 -2 430 a 396 527 a Fk(The)20
b(tw)o(o)h(\(or)e(three)h(sock)o(ets,)g(if)g(we)h(w)o(ant)f(to)h
(capture)e(data\))g(must)i(be)f(properly)e(connected,)g(bound,)g
(con\002gured.)396 635 y(When)i(we)h(call)f(the)h(zmq_proxy)c(method)h
(it')-5 b(s)22 b(e)o(xactly)d(lik)o(e)h(starting)g(the)g(main)g(loop)g
(of)g(rrbrok)o(er)-5 b(.)18 b(Let')-5 b(s)20 b(re)n(write)g(the)396
742 y(request-reply)e(brok)o(er)h(to)h(call)h(zmq_proxy)-5
b(,)16 b(and)k(re-badge)e(this)i(as)h(an)f(e)o(xpensi)n(v)o(e-sounding)
c("message)k(queue")396 850 y(\(people)f(ha)n(v)o(e)h(char)o(ged)e
(houses)h(for)h(code)f(that)i(did)f(less\):)-2 868 y
SDict begin H.S end

-2 868 a -2 868 a
SDict begin 13 H.A end
 -2 868 a -2 868 a
SDict begin [/View [/XYZ H.V]/Dest (0:msgqueue-c) cvn /DEST pdfmark
end
 -2 868 a 396 1052
a Fg(Example)h(2-9.)e(Message)h(queue)h(br)o(ok)o(er)f(\(msgqueue.c\))
-2 1152 y
SDict begin H.S end
 -2 1152 a -2 1152 a
SDict begin 11.7 H.A end
 -2 1152 a -2 1152 a
SDict begin [/View [/XYZ H.V]/Dest (0:952) cvn /DEST pdfmark end
 -2
1152 a 396 1232 a Fe(//)396 1329 y(//)90 b(Simple)43
b(message)h(queuing)g(broker)396 1426 y(//)90 b(Same)44
b(as)g(request-reply)f(broker)h(but)g(using)g(QUEUE)g(device)396
1523 y(//)396 1620 y(#include)g("zhelpers.h")396 1815
y(int)h(main)f(\(void\))396 1912 y({)576 2009 y(void)800
2022 y(*)845 2009 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
2203 y(//)89 b(Socket)44 b(facing)g(clients)576 2300
y(void)800 2313 y(*)845 2300 y(frontend)f(=)i(zmq_socket)e(\(context,)g
(ZMQ_ROUTER\);)576 2398 y(int)h(rc)g(=)h(zmq_bind)f(\(frontend,)f
("tcp://)2191 2411 y(*)2236 2398 y(:5559"\);)576 2495
y(assert)g(\(rc)i(==)f(0\);)576 2689 y(//)89 b(Socket)44
b(facing)g(services)576 2786 y(void)800 2799 y(*)845
2786 y(backend)f(=)i(zmq_socket)e(\(context,)g(ZMQ_DEALER\);)576
2883 y(rc)h(=)h(zmq_bind)e(\(backend,)h("tcp://)1967
2896 y(*)2012 2883 y(:5560"\);)576 2980 y(assert)f(\(rc)i(==)f(0\);)576
3175 y(//)89 b(Start)44 b(the)g(proxy)576 3272 y(zmq_proxy)f
(\(frontend,)g(backend,)h(NULL\);)576 3466 y(//)89 b(We)44
b(never)g(get)h(here...)576 3563 y(zmq_close)e(\(frontend\);)576
3660 y(zmq_close)g(\(backend\);)576 3757 y(zmq_ctx_destroy)f
(\(context\);)576 3855 y(return)h(0;)396 3952 y(})-2
4126 y
SDict begin H.S end
 -2 4126 a -2 4126 a
SDict begin 13 H.A end
 -2 4126 a -2 4126 a
SDict begin [/View [/XYZ H.V]/Dest (0:953) cvn /DEST pdfmark end
 -2 4126
a 396 4226 a Fk(If)20 b(you')l(re)f(lik)o(e)h(most)g(\330MQ)h(users,)f
(at)h(this)f(stage)h(your)e(mind)g(is)i(starting)f(to)g(think,)g("what)
g(kind)f(of)h(e)n(vil)g(stuf)n(f)g(can)g(I)396 4334 y(do)g(if)h(I)f
(plug)f(random)g(sock)o(et)h(types)g(into)g(the)g(proxy?")e(The)i
(short)g(answer)g(is:)h(try)f(it)h(and)e(w)o(ork)h(out)g(what)g(is)396
4442 y(happening.)e(In)i(practice)f(you)g(w)o(ould)h(usually)f(stick)i
(to)f(R)m(OUTER/DEALER,)g(XSUB/XPUB,)i(or)e(PULL/PUSH.)-2
4470 y
SDict begin H.S end
 -2 4470 a -2 4470 a
SDict begin 13 H.A end
 -2 4470 a -2 4470 a
SDict begin [/View [/XYZ H.V]/Dest (0:954) cvn /DEST pdfmark end
 -2 4470
a 396 4780 a Fb(2.17.4.)36 b(The)e(T)-10 b(ranspor)r(t)34
b(Bridging)g(Pr)n(ob)o(lem)2625 4780 y
SDict begin H.S end
 2625 4780 a 2625
4780 a
SDict begin 18.72 H.A end
 2625 4780 a 2625 4780 a
SDict begin [/View [/XYZ H.V]/Dest (7.38.4.2) cvn /DEST pdfmark end
 2625 4780 a -2 4973 a
SDict begin H.S end

-2 4973 a -2 4973 a
SDict begin 13 H.A end
 -2 4973 a -2 4973 a
SDict begin [/View [/XYZ H.V]/Dest (0:956) cvn /DEST pdfmark end
 -2 4973 a 396
5054 a Fk(A)21 b(frequent)d(request)i(from)f(\330MQ)h(users)h(is)g("ho)
n(w)e(do)h(I)h(connect)e(my)g(\330MQ)i(netw)o(ork)e(with)h(technology)e
(X?")i(where)396 5162 y(X)h(is)g(some)f(other)f(netw)o(orking)g(or)g
(messaging)h(technology)-5 b(.)17 b(The)j(simple)g(answer)g(is)h(to)f
(b)n(uild)g(a)h("bridge".)d(A)j(bridge)p Black 3800 5569
a Ff(65)p Black eop end
%%Page: 66 79
TeXDict begin 66 78 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.66) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(is)i(a)g(small)g(application)d(that)j(speaks)f(one)f
(protocol)g(at)i(one)e(sock)o(et,)h(and)g(con)m(v)o(erts)e(to/from)h(a)
i(second)e(protocol)f(at)396 180 y(another)h(sock)o(et.)h(A)g(protocol)
f(interpreter)m(,)f(if)i(you)g(lik)o(e.)g(A)h(common)d(bridging)g
(problem)h(in)h(\330MQ)g(is)h(to)g(bridge)e(tw)o(o)396
288 y(transports)g(or)h(netw)o(orks.)-2 472 y
SDict begin H.S end
 -2 472
a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:957) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(As)h(e)o(xample,)e
(we')l(re)g(going)g(to)i(write)f(a)h(little)g(proxy)d(that)i(sits)i(in)
e(between)g(a)g(publisher)f(and)h(a)g(set)h(of)f(subscribers,)396
670 y(bridging)e(tw)o(o)j(netw)o(orks.)e(The)h(frontend)e(sock)o(et)i
(\(SUB\))g(f)o(aces)h(the)f(internal)f(netw)o(ork,)g(where)h(the)g
(weather)f(serv)o(er)396 778 y(is)i(sitting,)g(and)e(the)h(back)o(end)f
(\(PUB\))h(f)o(aces)h(subscribers)e(on)h(the)g(e)o(xternal)f(netw)o
(ork.)g(It)h(subscribes)g(to)g(the)g(weather)396 886
y(service)g(on)g(the)g(frontend)e(sock)o(et,)i(and)g(republishes)f(its)
i(data)f(on)g(the)g(back)o(end)e(sock)o(et\()p 0 TeXcolorgray
2993 886 a
SDict begin H.S end
 2993 886 a Fk(Figure)h(2-12)3384 886 y
SDict begin 13 H.L end
 3384
886 a 3384 886 a
SDict begin [/Subtype /Link/Dest (0:figure-21) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3384 886 a Black -2 w Fk(\).)-2 904
y
SDict begin H.S end
 -2 904 a -2 904 a
SDict begin 13 H.A end
 -2 904 a -2 904 a
SDict begin [/View [/XYZ H.V]/Dest (0:wuproxy-c) cvn /DEST pdfmark
end
 -2 904 a 396 1087
a Fg(Example)i(2-10.)d(W)-5 b(eather)20 b(update)g(pr)o(oxy)f(\(wupr)o
(oxy)-6 b(.c\))-2 1187 y
SDict begin H.S end
 -2 1187 a -2 1187 a
SDict begin 11.7 H.A end
 -2 1187
a -2 1187 a
SDict begin [/View [/XYZ H.V]/Dest (0:961) cvn /DEST pdfmark end
 -2 1187 a 396 1268 a Fe(//)396 1365 y(//)90
b(Weather)43 b(proxy)h(device)396 1462 y(//)396 1559
y(#include)g("zhelpers.h")396 1753 y(int)h(main)f(\(void\))396
1850 y({)576 1948 y(void)800 1961 y(*)845 1948 y(context)f(=)i
(zmq_ctx_new)e(\(\);)576 2142 y(//)89 b(This)44 b(is)h(where)f(the)g
(weather)g(server)f(sits)576 2239 y(void)800 2252 y(*)845
2239 y(frontend)g(=)i(zmq_socket)e(\(context,)g(ZMQ_XSUB\);)576
2336 y(zmq_connect)g(\(frontend,)g("tcp://192.168.55.210:5556"\);)576
2530 y(//)89 b(This)44 b(is)h(our)f(public)g(endpoint)f(for)i
(subscribers)576 2627 y(void)800 2640 y(*)845 2627 y(backend)e(=)i
(zmq_socket)e(\(context,)g(ZMQ_XPUB\);)576 2725 y(zmq_bind)g
(\(backend,)g("tcp://10.1.1.0:8100"\);)576 2919 y(//)89
b(Run)44 b(the)h(proxy)f(until)g(the)g(user)g(interrupts)f(us)576
3016 y(zmq_proxy)g(\(frontend,)g(backend,)h(NULL\);)576
3210 y(zmq_close)f(\(frontend\);)576 3307 y(zmq_close)g(\(backend\);)
576 3405 y(zmq_ctx_destroy)f(\(context\);)576 3502 y(return)h(0;)396
3599 y(})-2 3607 y
SDict begin H.S end
 -2 3607 a -2 3607 a
SDict begin 13 H.A end
 -2 3607 a -2 3607
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-21) cvn /DEST pdfmark
end
 -2 3607 a Black 3798 5569 a Ff(66)p Black eop end
%%Page: 67 80
TeXDict begin 67 79 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.67) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-12.)e(Pub-Sub)j(F)n(orwarder)e(Pr)o
(oxy)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:964) cvn /DEST pdfmark end
 -2
172 a 396 2781 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2781 a @beginspecial 0 @llx -308
@lly 305 @urx 0 @ury 3050 @rwi @setspecial
%%BeginDocument: images/fig21.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -308 305 0
%%HiResBoundingBox: 0.0 -308.0 305.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
98.50015258789062 -18.500150680541992 moveto
98.50015258789062 -45.50014877319336 lineto
158.50015258789062 -45.50014877319336 lineto
158.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
98.50015258789062 -47.50014877319336 moveto
98.50015258789062 -57.50014877319336 lineto
98.50015258789062 -59.50014877319336 99.50015258789062 -60.50014877319336 101.50015258789062 -60.50014877319336 curveto
156.50015258789062 -60.50014877319336 lineto
156.50015258789062 -60.50014877319336 lineto
157.83348592122397 -60.50014877319336 158.50015258789062 -59.50014877319336 158.50015258789062 -57.50014877319336 curveto
158.50015258789062 -47.50014877319336 lineto
158.50015258789062 -47.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -123.50015258789062 moveto
14.500150044759115 -123.50015258789062 13.500149726867676 -124.83348592122395 13.500149726867676 -127.50015258789062 curveto
13.500149726867676 -136.50015258789062 lineto
78.50015258789062 -136.50015258789062 lineto
78.50015258789062 -127.50015258789062 lineto
78.50015258789062 -124.83348592122395 77.83348592122395 -123.50015258789062 76.50015258789062 -123.50015258789062 curveto
16.500150680541992 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -138.50015258789062 moveto
13.500149726867676 -165.50015258789062 lineto
78.50015258789062 -165.50015258789062 lineto
78.50015258789062 -138.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.50015258789062 -123.50015258789062 moveto
99.50015258789062 -123.50015258789062 98.50015258789062 -124.83348592122395 98.50015258789062 -127.50015258789062 curveto
98.50015258789062 -136.50015258789062 lineto
163.50015258789062 -136.50015258789062 lineto
163.50015258789062 -127.50015258789062 lineto
163.50015258789062 -124.83348592122395 162.83348592122397 -123.50015258789062 161.50015258789062 -123.50015258789062 curveto
101.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
98.50015258789062 -138.50015258789062 moveto
98.50015258789062 -165.50015258789062 lineto
163.50015258789062 -165.50015258789062 lineto
163.50015258789062 -138.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
186.50015258789062 -130.50015258789062 moveto
184.50015258789062 -130.50015258789062 183.50015258789062 -131.83348592122397 183.50015258789062 -134.50015258789062 curveto
183.50015258789062 -143.50015258789062 lineto
248.50015258789062 -143.50015258789062 lineto
248.50015258789062 -134.50015258789062 lineto
248.50015258789062 -131.83348592122397 247.83348592122397 -130.50015258789062 246.50015258789062 -130.50015258789062 curveto
186.50015258789062 -130.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
183.50015258789062 -145.50015258789062 moveto
183.50015258789062 -171.50015258789062 lineto
248.50015258789062 -171.50015258789062 lineto
248.50015258789062 -145.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
183.50015258789062 -173.50015258789062 moveto
183.50015258789062 -183.50015258789062 lineto
183.50015258789062 -185.50015258789062 184.50015258789062 -186.50015258789062 186.50015258789062 -186.50015258789062 curveto
246.50015258789062 -186.50015258789062 lineto
246.50015258789062 -186.50015258789062 lineto
247.83348592122397 -186.50015258789062 248.50015258789062 -185.50015258789062 248.50015258789062 -183.50015258789062 curveto
248.50015258789062 -173.50015258789062 lineto
248.50015258789062 -173.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
141.50015258789062 -249.50015258789062 moveto
139.50015258789062 -249.50015258789062 138.50015258789062 -250.83348592122397 138.50015258789062 -253.50015258789062 curveto
138.50015258789062 -262.5001525878906 lineto
203.50015258789062 -262.5001525878906 lineto
203.50015258789062 -253.50015258789062 lineto
203.50015258789062 -250.83348592122397 202.83348592122397 -249.50015258789062 201.50015258789062 -249.50015258789062 curveto
141.50015258789062 -249.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
138.50015258789062 -264.5001525878906 moveto
138.50015258789062 -291.5001525878906 lineto
203.50015258789062 -291.5001525878906 lineto
203.50015258789062 -264.5001525878906 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
231.50015258789062 -249.50015258789062 moveto
229.50015258789062 -249.50015258789062 228.50015258789062 -250.83348592122397 228.50015258789062 -253.50015258789062 curveto
228.50015258789062 -262.5001525878906 lineto
293.5001525878906 -262.5001525878906 lineto
293.5001525878906 -253.50015258789062 lineto
293.5001525878906 -250.83348592122397 292.83348592122394 -249.50015258789062 291.5001525878906 -249.50015258789062 curveto
231.50015258789062 -249.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
228.50015258789062 -264.5001525878906 moveto
228.50015258789062 -291.5001525878906 lineto
293.5001525878906 -291.5001525878906 lineto
293.5001525878906 -264.5001525878906 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
97.0 -17.0 moveto
97.0 -44.0 lineto
157.0 -44.0 lineto
157.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
97.0 -17.0 moveto
97.0 -44.0 lineto
157.0 -44.0 lineto
157.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
97.0 -46.0 moveto
97.0 -56.0 lineto
97.0 -58.0 98.0 -59.0 100.0 -59.0 curveto
155.0 -59.0 lineto
155.0 -59.0 lineto
156.33333333333334 -59.0 157.0 -58.0 157.0 -56.0 curveto
157.0 -46.0 lineto
157.0 -46.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
97.0 -46.0 moveto
97.0 -56.0 lineto
97.0 -58.0 98.0 -59.0 100.0 -59.0 curveto
155.0 -59.0 lineto
155.0 -59.0 lineto
156.33333333333334 -59.0 157.0 -58.0 157.0 -56.0 curveto
157.0 -46.0 lineto
157.0 -46.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -135.0 lineto
77.0 -135.0 lineto
77.0 -126.0 lineto
77.0 -123.33333333333333 76.33333333333333 -122.0 75.0 -122.0 curveto
15.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -135.0 lineto
77.0 -135.0 lineto
77.0 -126.0 lineto
77.0 -123.33333333333333 76.33333333333333 -122.0 75.0 -122.0 curveto
15.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -137.0 moveto
12.0 -164.0 lineto
77.0 -164.0 lineto
77.0 -137.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -137.0 moveto
12.0 -164.0 lineto
77.0 -164.0 lineto
77.0 -137.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -122.0 moveto
98.0 -122.0 97.0 -123.33333333333333 97.0 -126.0 curveto
97.0 -135.0 lineto
162.0 -135.0 lineto
162.0 -126.0 lineto
162.0 -123.33333333333333 161.33333333333334 -122.0 160.0 -122.0 curveto
100.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -122.0 moveto
98.0 -122.0 97.0 -123.33333333333333 97.0 -126.0 curveto
97.0 -135.0 lineto
162.0 -135.0 lineto
162.0 -126.0 lineto
162.0 -123.33333333333333 161.33333333333334 -122.0 160.0 -122.0 curveto
100.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
97.0 -137.0 moveto
97.0 -164.0 lineto
162.0 -164.0 lineto
162.0 -137.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
97.0 -137.0 moveto
97.0 -164.0 lineto
162.0 -164.0 lineto
162.0 -137.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
185.0 -129.0 moveto
183.0 -129.0 182.0 -130.33333333333334 182.0 -133.0 curveto
182.0 -142.0 lineto
247.0 -142.0 lineto
247.0 -133.0 lineto
247.0 -130.33333333333334 246.33333333333334 -129.0 245.0 -129.0 curveto
185.0 -129.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
185.0 -129.0 moveto
183.0 -129.0 182.0 -130.33333333333334 182.0 -133.0 curveto
182.0 -142.0 lineto
247.0 -142.0 lineto
247.0 -133.0 lineto
247.0 -130.33333333333334 246.33333333333334 -129.0 245.0 -129.0 curveto
185.0 -129.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
182.0 -144.0 moveto
182.0 -170.0 lineto
247.0 -170.0 lineto
247.0 -144.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
182.0 -144.0 moveto
182.0 -170.0 lineto
247.0 -170.0 lineto
247.0 -144.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
182.0 -172.0 moveto
182.0 -182.0 lineto
182.0 -184.0 183.0 -185.0 185.0 -185.0 curveto
245.0 -185.0 lineto
245.0 -185.0 lineto
246.33333333333334 -185.0 247.0 -184.0 247.0 -182.0 curveto
247.0 -172.0 lineto
247.0 -172.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
182.0 -172.0 moveto
182.0 -182.0 lineto
182.0 -184.0 183.0 -185.0 185.0 -185.0 curveto
245.0 -185.0 lineto
245.0 -185.0 lineto
246.33333333333334 -185.0 247.0 -184.0 247.0 -182.0 curveto
247.0 -172.0 lineto
247.0 -172.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
140.0 -248.0 moveto
138.0 -248.0 137.0 -249.33333333333334 137.0 -252.0 curveto
137.0 -261.0 lineto
202.0 -261.0 lineto
202.0 -252.0 lineto
202.0 -249.33333333333334 201.33333333333334 -248.0 200.0 -248.0 curveto
140.0 -248.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
140.0 -248.0 moveto
138.0 -248.0 137.0 -249.33333333333334 137.0 -252.0 curveto
137.0 -261.0 lineto
202.0 -261.0 lineto
202.0 -252.0 lineto
202.0 -249.33333333333334 201.33333333333334 -248.0 200.0 -248.0 curveto
140.0 -248.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
137.0 -263.0 moveto
137.0 -290.0 lineto
202.0 -290.0 lineto
202.0 -263.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
137.0 -263.0 moveto
137.0 -290.0 lineto
202.0 -290.0 lineto
202.0 -263.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
230.0 -248.0 moveto
228.0 -248.0 227.0 -249.33333333333334 227.0 -252.0 curveto
227.0 -261.0 lineto
292.0 -261.0 lineto
292.0 -252.0 lineto
292.0 -249.33333333333334 291.3333333333333 -248.0 290.0 -248.0 curveto
230.0 -248.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
230.0 -248.0 moveto
228.0 -248.0 227.0 -249.33333333333334 227.0 -252.0 curveto
227.0 -261.0 lineto
292.0 -261.0 lineto
292.0 -252.0 lineto
292.0 -249.33333333333334 291.3333333333333 -248.0 290.0 -248.0 curveto
230.0 -248.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
227.0 -263.0 moveto
227.0 -290.0 lineto
292.0 -290.0 lineto
292.0 -263.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
227.0 -263.0 moveto
227.0 -290.0 lineto
292.0 -290.0 lineto
292.0 -263.0 lineto
closepath
stroke
newpath
15.0 -185.0 moveto
182.0 -185.0 lineto
stroke
newpath
247.0 -185.0 moveto
290.0 -185.0 lineto
stroke
newpath
127.0 -80.0 moveto
127.0 -94.0 lineto
stroke
newpath
42.0 -108.0 moveto
42.0 -94.0 lineto
127.0 -94.0 lineto
stroke
newpath
127.0 -108.0 moveto
127.0 -94.0 lineto
stroke
newpath
212.0 -115.0 moveto
212.0 -94.0 lineto
127.0 -94.0 lineto
stroke
newpath
212.0 -206.0 moveto
212.0 -220.0 lineto
stroke
newpath
167.0 -234.0 moveto
167.0 -220.0 lineto
212.0 -220.0 lineto
stroke
newpath
257.0 -234.0 moveto
257.0 -220.0 lineto
212.0 -220.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
109.0 -35.0 moveto
(Publisher) show
120.0 -55.0 moveto
(PUB) show
117.0 -70.0 moveto
(bind) show
74.0 -77.0 moveto
(tcp //192.168.55.210 5556) show
27.0 -119.0 moveto
(connect) show
117.0 -119.0 moveto
(connect) show
202.0 -126.0 moveto
(connect) show
35.0 -132.0 moveto
(SUB) show
120.0 -132.0 moveto
(SUB) show
206.0 -139.0 moveto
(XSUB) show
25.0 -154.0 moveto
(Subscriber) show
110.0 -154.0 moveto
(Subscriber) show
192.0 -161.0 moveto
(Forwarder) show
23.0 -182.0 moveto
(Internal network) show
206.0 -181.0 moveto
(XPUB) show
22.0 -196.0 moveto
(External network) show
207.0 -196.0 moveto
(bind) show
179.0 -203.0 moveto
(tcp //10.1.1.0 8100) show
152.0 -245.0 moveto
(connect) show
242.0 -245.0 moveto
(connect) show
160.0 -258.0 moveto
(SUB) show
250.0 -258.0 moveto
(SUB) show
150.0 -280.0 moveto
(Subscriber) show
240.0 -280.0 moveto
(Subscriber) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2781 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2781 a -2 2947 a
SDict begin H.S end
 -2 2947
a -2 2947 a
SDict begin 13 H.A end
 -2 2947 a -2 2947 a
SDict begin [/View [/XYZ H.V]/Dest (0:967) cvn /DEST pdfmark end
 -2 2947 a 377 x Fn(2.18.)39
b(Multithreading)d(with)j(\330MQ)2056 3324 y
SDict begin H.S end
 2056 3324
a 2056 3324 a
SDict begin 22.464 H.A end
 2056 3324 a 2056 3324 a
SDict begin [/View [/XYZ H.V]/Dest (7.39.1) cvn /DEST pdfmark end
 2056 3324 a -2
3522 a
SDict begin H.S end
 -2 3522 a -2 3522 a
SDict begin 13 H.A end
 -2 3522 a -2 3522 a
SDict begin [/View [/XYZ H.V]/Dest (0:969) cvn /DEST pdfmark end
 -2 3522
a 396 3598 a Fk(\330MQ)21 b(is)g(perhaps)e(the)h(nicest)g(w)o(ay)h(e)n
(v)o(er)e(to)h(write)h(multithreaded)d(\(MT\))h(applications.)g
(Whereas)h(as)h(\330MQ)f(sock)o(ets)396 3706 y(require)f(some)h
(readjustment)f(if)h(you)g(are)g(used)g(to)g(traditional)f(sock)o(ets,)
h(\330MQ)h(multithreading)c(will)k(tak)o(e)396 3814 y(e)n(v)o(erything)
d(you)h(kno)n(w)g(about)g(writing)h(MT)g(applications,)f(thro)n(w)g(it)
i(into)f(a)h(heap)e(in)i(the)f(garden,)e(pour)h(gasoline)396
3921 y(o)o(v)o(er)g(it,)i(and)e(set)i(it)g(alight.)f(It')-5
b(s)21 b(a)f(rare)g(book)f(that)h(deserv)o(es)g(b)n(urning,)e(b)n(ut)i
(most)g(books)f(on)h(concurrent)396 4029 y(programming)d(do.)-2
4213 y
SDict begin H.S end
 -2 4213 a -2 4213 a
SDict begin 13 H.A end
 -2 4213 a -2 4213 a
SDict begin [/View [/XYZ H.V]/Dest (0:970) cvn /DEST pdfmark end
 -2 4213
a 396 4303 a Fk(T)-7 b(o)21 b(mak)o(e)e(utterly)h(perfect)f(MT)h
(programs)f(\(and)g(I)h(mean)g(that)g(literally\))2540
4303 y
SDict begin H.S end
 2540 4303 a 2540 4303 a
SDict begin 13 H.A end
 2540 4303 a 2540 4303
a
SDict begin [/View [/XYZ H.V]/Dest (0:971) cvn /DEST pdfmark end
 2540 4303 a Fg(we)h(don't)e(need)i(mutexes,)f(locks,)h(or)f(any)396
4411 y(other)g(f)n(orm)g(of)g(inter)m(-thr)o(ead)e(communication)i
(except)g(messages)g(sent)h(acr)o(oss)f(\330MQ)g(sock)o(ets.)-2
4594 y
SDict begin H.S end
 -2 4594 a -2 4594 a
SDict begin 13 H.A end
 -2 4594 a -2 4594 a
SDict begin [/View [/XYZ H.V]/Dest (0:972) cvn /DEST pdfmark end
 -2 4594
a 396 4685 a Fk(By)h("perfect")e(MT)h(programs)e(I)j(mean)e(code)h
(that')-5 b(s)21 b(easy)f(to)g(write)h(and)e(understand,)f(that)i(w)o
(orks)g(with)h(one)e(design)396 4793 y(language)g(in)h(an)o(y)f
(programming)e(language,)h(and)i(on)g(an)o(y)f(operating)g(system,)h
(and)f(that)i(scales)g(across)f(an)o(y)f(number)396 4901
y(of)h(CPUs)i(with)e(zero)g(w)o(ait)h(states)g(and)e(no)h(point)g(of)g
(diminishing)e(returns.)p Black 3797 5569 a Ff(67)p Black
eop end
%%Page: 68 81
TeXDict begin 68 80 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.68) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:973) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(If)h(you')l(v)o(e)e(spent)i(years)g(learning)f
(tricks)h(to)h(mak)o(e)e(your)g(MT)i(code)e(w)o(ork)h(at)g(all,)h(let)g
(alone)e(rapidly)-5 b(,)18 b(with)j(locks)f(and)396 180
y(semaphores)f(and)h(critical)g(sections,)g(you)f(will)i(be)f
(disgusted)g(when)f(you)h(realize)g(it)g(w)o(as)h(all)g(for)f(nothing.)
e(If)i(there')-5 b(s)396 288 y(one)20 b(lesson)g(we')l(v)o(e)f(learned)
g(from)h(30+)f(years)h(of)g(concurrent)e(programming)f(it)j(is:)2882
288 y
SDict begin H.S end
 2882 288 a 2882 288 a
SDict begin 13 H.A end
 2882 288 a 2882 288 a
SDict begin [/View [/XYZ H.V]/Dest (0:974) cvn /DEST pdfmark end
 2882
288 a Ff(just)g(don')n(t)f(shar)m(e)h(state)p Fk(.)g(It')-5
b(s)21 b(lik)o(e)396 396 y(tw)o(o)g(drunkards)c(trying)j(to)g(share)g
(a)g(beer)-5 b(.)20 b(It)h(doesn')o(t)d(matter)i(if)h(the)o(y')l(re)d
(good)h(b)n(uddies.)g(Sooner)g(or)h(later)g(the)o(y')l(re)396
504 y(going)e(to)i(get)f(into)g(a)h(\002ght.)f(And)g(the)h(more)e
(drunkards)f(you)i(add)g(to)g(the)g(table,)h(the)f(more)g(the)o(y)f
(\002ght)i(each)f(other)f(o)o(v)o(er)396 612 y(the)i(beer)-5
b(.)20 b(The)g(tragic)g(majority)f(of)h(MT)g(applications)f(look)h(lik)
o(e)g(drunk)o(en)e(bar)i(\002ghts.)-2 796 y
SDict begin H.S end
 -2 796 a
-2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:975) cvn /DEST pdfmark end
 -2 796 a 396 886 a Fk(The)g(list)h(of)f
(weird)g(problems)f(that)h(you)f(need)h(to)g(\002ght)g(as)h(you)f
(write)g(classic)h(shared-state)e(MT)i(code)e(w)o(ould)g(be)396
994 y(hilarious)g(if)i(it)f(didn')o(t)f(translate)h(directly)f(into)h
(stress)h(and)e(risk,)h(as)h(code)e(that)h(seems)h(to)f(w)o(ork)f
(suddenly)f(f)o(ails)j(under)396 1102 y(pressure.)e(Here)h(is)i(a)e
(list)i(of)d("11)h(Lik)o(ely)g(Problems)f(In)h(Y)-9 b(our)19
b(Multithreaded)f(Code")i(from)f(a)i(lar)o(ge)e(\002rm)h(with)396
1210 y(w)o(orld-beating)e(e)o(xperience)g(in)i(b)n(uggy)f(code:)h(for)o
(gotten)d(synchronization,)g(incorrect)i(granularity)-5
b(,)17 b(read)j(and)g(write)396 1318 y(tearing,)f(lock-free)g
(reordering,)e(lock)j(con)m(v)n(o)o(ys,)e(tw)o(o-step)i(dance,)f(and)h
(priority)f(in)m(v)o(ersion.)-2 1502 y
SDict begin H.S end
 -2 1502 a -2 1502
a
SDict begin 13 H.A end
 -2 1502 a -2 1502 a
SDict begin [/View [/XYZ H.V]/Dest (0:976) cvn /DEST pdfmark end
 -2 1502 a 396 1592 a Fk(Y)-8 b(eah,)20
b(we)g(also)h(counted)d(se)n(v)o(en,)i(not)f(ele)n(v)o(en.)g(That')-5
b(s)21 b(not)e(the)i(point)e(though.)f(The)i(point)g(is,)g(do)g(you)f
(really)h(w)o(ant)396 1700 y(that)h(code)e(running)f(the)i(po)n(wer)f
(grid)h(or)g(stock)g(mark)o(et)f(to)i(start)f(getting)g(tw)o(o-step)g
(lock)f(con)m(v)n(o)o(ys)g(at)i(3pm)e(on)h(a)g(b)n(usy)396
1808 y(Thursday?)e(Who)j(cares)f(what)g(the)g(terms)g(actually)g(mean.)
f(This)i(is)g(not)f(what)g(turned)f(us)h(on)g(to)g(programming,)396
1916 y(\002ghting)f(e)n(v)o(er)h(more)f(comple)o(x)f(side-ef)n(fects)i
(with)g(e)n(v)o(er)f(more)h(comple)o(x)e(hacks.)-2 2100
y
SDict begin H.S end
 -2 2100 a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:977) cvn /DEST pdfmark end
 -2 2100 a 396
2190 a Fk(Some)i(widely)g(used)g(models,)f(despite)h(being)f(the)i
(basis)f(for)g(entire)g(industries,)f(are)h(fundamentally)e(brok)o(en,)
g(and)396 2297 y(shared)i(state)h(concurrenc)o(y)16 b(is)22
b(one)d(of)h(them.)g(Code)g(that)g(w)o(ants)h(to)f(scale)h(without)e
(limit)i(does)f(it)h(lik)o(e)f(the)g(Internet)396 2405
y(does,)g(by)g(sending)f(messages)h(and)g(sharing)f(nothing)f(e)o
(xcept)i(a)g(common)f(contempt)f(for)i(brok)o(en)e(programming)396
2513 y(models.)-2 2680 y
SDict begin H.S end
 -2 2680 a -2 2680 a
SDict begin 13 H.A end
 -2 2680
a -2 2680 a
SDict begin [/View [/XYZ H.V]/Dest (0:978) cvn /DEST pdfmark end
 -2 2680 a 396 2787 a Fk(Y)-9 b(ou)20 b(should)f(follo)n(w)g
(some)h(rules)h(to)f(write)g(happ)o(y)f(multithreaded)f(code)i(with)g
(\330MQ:)-2 2805 y
SDict begin H.S end
 -2 2805 a -2 2805 a
SDict begin 13 H.A end
 -2 2805 a -2 2805
a
SDict begin [/View [/XYZ H.V]/Dest (0:979) cvn /DEST pdfmark end
 -2 2805 a -2 2815 a
SDict begin H.S end
 -2 2815 a -2 2815 a
SDict begin 13 H.A end
 -2 2815 a -2
2815 a
SDict begin [/View [/XYZ H.V]/Dest (0:980) cvn /DEST pdfmark end
 -2 2815 a Black 396 2957 a Fj(\225)p Black 479
2957 a
SDict begin H.S end
 479 2957 a 479 2957 a
SDict begin 13 H.A end
 479 2957 a 479 2957 a
SDict begin [/View [/XYZ H.V]/Dest (0:981) cvn /DEST pdfmark end
 479
2957 a Fk(Y)-9 b(ou)20 b(MUST)g(NO)m(T)g(access)h(the)f(same)h(data)f
(from)f(multiple)g(threads.)h(Using)g(classic)h(MT)f(techniques)f(lik)o
(e)479 3065 y(mute)o(x)o(es)g(are)h(an)h(anti-pattern)d(in)i(\330MQ)h
(applications.)e(The)g(only)h(e)o(xception)e(to)i(this)h(is)g(a)g
(\330MQ)f(conte)o(xt)f(object,)479 3173 y(which)h(is)h(threadsafe.)-2
3174 y
SDict begin H.S end
 -2 3174 a -2 3174 a
SDict begin 13 H.A end
 -2 3174 a -2 3174 a
SDict begin [/View [/XYZ H.V]/Dest (0:982) cvn /DEST pdfmark end
 -2 3174
a Black 396 3323 a Fj(\225)p Black 479 3323 a
SDict begin H.S end
 479 3323
a 479 3323 a
SDict begin 13 H.A end
 479 3323 a 479 3323 a
SDict begin [/View [/XYZ H.V]/Dest (0:983) cvn /DEST pdfmark end
 479 3323 a Fk(Y)-9
b(ou)20 b(MUST)g(create)g(a)h(\330MQ)f(conte)o(xt)f(for)h(your)f
(process,)g(and)h(pass)h(that)f(to)g(all)h(threads)e(that)i(you)e(w)o
(ant)h(to)479 3431 y(connect)f(via)880 3431 y
SDict begin H.S end
 880 3431
a 880 3431 a
SDict begin 13 H.A end
 880 3431 a 880 3431 a
SDict begin [/View [/XYZ H.V]/Dest (0:984) cvn /DEST pdfmark end
 880 3431 a Fe(inproc)h
Fk(sock)o(ets.)-2 3443 y
SDict begin H.S end
 -2 3443 a -2 3443 a
SDict begin 13 H.A end
 -2 3443
a -2 3443 a
SDict begin [/View [/XYZ H.V]/Dest (0:985) cvn /DEST pdfmark end
 -2 3443 a Black 396 3580 a Fj(\225)p Black
479 3580 a
SDict begin H.S end
 479 3580 a 479 3580 a
SDict begin 13 H.A end
 479 3580 a 479 3580
a
SDict begin [/View [/XYZ H.V]/Dest (0:986) cvn /DEST pdfmark end
 479 3580 a Fk(Y)-9 b(ou)20 b(MA)-9 b(Y)21 b(treat)f(threads)f(as)i
(separate)f(tasks,)h(with)f(their)g(o)n(wn)g(conte)o(xt,)e(b)n(ut)i
(these)h(threads)e(cannot)479 3688 y(communicate)e(o)o(v)o(er)1111
3688 y
SDict begin H.S end
 1111 3688 a 1111 3688 a
SDict begin 13 H.A end
 1111 3688 a 1111 3688
a
SDict begin [/View [/XYZ H.V]/Dest (0:987) cvn /DEST pdfmark end
 1111 3688 a Fe(inproc)p Fk(.)i(Ho)n(we)n(v)o(er)f(the)o(y)g(will)i
(be)g(easier)f(to)h(break)e(into)h(standalone)f(processes)h(afterw)o
(ards.)-2 3706 y
SDict begin H.S end
 -2 3706 a -2 3706 a
SDict begin 13 H.A end
 -2 3706 a -2 3706
a
SDict begin [/View [/XYZ H.V]/Dest (0:988) cvn /DEST pdfmark end
 -2 3706 a Black 396 3838 a Fj(\225)p Black 479 3838
a
SDict begin H.S end
 479 3838 a 479 3838 a
SDict begin 13 H.A end
 479 3838 a 479 3838 a
SDict begin [/View [/XYZ H.V]/Dest (0:989) cvn /DEST pdfmark end
 479 3838
a Fk(Y)-9 b(ou)20 b(MUST)g(NO)m(T)g(share)g(\330MQ)h(sock)o(ets)f
(between)f(threads.)h(\330MQ)g(sock)o(ets)g(are)h(not)e(threadsafe.)g
(T)-6 b(echnically)479 3945 y(it')h(s)22 b(possible)d(to)i(do)f(this,)g
(b)n(ut)g(it)h(demands)e(semaphores,)g(locks,)g(or)h(mute)o(x)o(es.)f
(This)h(will)h(mak)o(e)f(your)f(application)479 4053
y(slo)n(w)i(and)e(fragile.)h(The)f(only)h(place)g(where)f(it')-5
b(s)22 b(remotely)d(sane)h(to)g(share)g(sock)o(ets)g(between)g(threads)
f(are)h(in)479 4161 y(language)f(bindings)g(that)h(need)f(to)i(do)e
(magic)h(lik)o(e)h(garbage)d(collection)h(on)h(sock)o(ets.)-2
4345 y
SDict begin H.S end
 -2 4345 a -2 4345 a
SDict begin 13 H.A end
 -2 4345 a -2 4345 a
SDict begin [/View [/XYZ H.V]/Dest (0:990) cvn /DEST pdfmark end
 -2 4345
a 396 4435 a Fk(If)g(you)f(need)g(to)h(start)g(more)f(than)g(one)h
(proxy)e(in)h(an)h(application,)e(for)h(e)o(xample,)f(you)h(will)i(w)o
(ant)f(to)g(run)f(each)g(in)h(their)396 4543 y(o)n(wn)g(thread.)f(It)h
(is)h(easy)f(to)h(mak)o(e)e(the)h(error)f(of)h(creating)f(the)i(proxy)d
(frontend)g(and)h(back)o(end)g(sock)o(ets)h(in)g(one)g(thread,)396
4651 y(and)g(then)g(passing)f(the)i(sock)o(ets)f(to)g(the)h(proxy)d(in)
i(another)f(thread.)g(This)h(may)g(appear)f(to)h(w)o(ork)g(b)n(ut)g
(will)h(f)o(ail)396 4759 y(randomly)-5 b(.)18 b(Remember:)1159
4759 y
SDict begin H.S end
 1159 4759 a 1159 4759 a
SDict begin 13 H.A end
 1159 4759 a 1159 4759
a
SDict begin [/View [/XYZ H.V]/Dest (0:991) cvn /DEST pdfmark end
 1159 4759 a Ff(Do)i(not)g(use)g(or)h(close)f(soc)n(k)o(ets)h(e)n
(xcept)f(in)h(the)f(thr)m(ead)f(that)h(cr)m(eated)g(them.)-2
4943 y
SDict begin H.S end
 -2 4943 a -2 4943 a
SDict begin 13 H.A end
 -2 4943 a -2 4943 a
SDict begin [/View [/XYZ H.V]/Dest (0:992) cvn /DEST pdfmark end
 -2 4943
a 396 5033 a Fk(If)g(you)g(follo)n(w)f(these)h(rules,)g(you)g(can)g
(quite)f(easily)i(split)g(threads)e(into)h(separate)g(processes,)f
(when)h(you)f(need)h(to.)396 5141 y(Application)f(logic)h(can)g(sit)h
(in)f(threads,)g(processes,)f(box)o(es:)h(whate)n(v)o(er)e(your)h
(scale)i(needs.)p Black 3800 5569 a Ff(68)p Black eop
end
%%Page: 69 82
TeXDict begin 69 81 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.69) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:993) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(\330MQ)i(uses)f(nati)n(v)o(e)g(OS)h(threads)e(rather)
h(than)f(virtual)h("green")f(threads.)g(The)h(adv)n(antage)e(is)j(that)
f(you)g(don')o(t)e(need)i(to)396 180 y(learn)g(an)o(y)f(ne)n(w)h
(threading)f(API,)h(and)g(that)g(\330MQ)g(threads)g(map)g(cleanly)f(to)
h(your)f(operating)g(system.)h(Y)-9 b(ou)19 b(can)h(use)396
288 y(standard)f(tools)i(lik)o(e)f(Intel')-5 b(s)20 b(ThreadCheck)o(er)
e(to)i(see)h(what)f(your)f(application)g(is)i(doing.)e(The)g(disadv)n
(antages)g(are)396 396 y(that)i(your)d(code,)i(when)f(it)i(for)f
(instance)g(starts)h(ne)n(w)f(threads,)f(w)o(on')o(t)g(be)h(portable,)f
(and)g(that)i(if)f(you)f(ha)n(v)o(e)h(a)h(huge)396 504
y(number)e(of)h(threads)f(\(thousands\),)f(some)i(operating)e(systems)j
(will)g(get)f(stressed.)-2 688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2
688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:994) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(Let')-5 b(s)21 b(see)g(ho)n(w)e
(this)i(w)o(orks)f(in)g(practice.)g(W)-7 b(e')o(ll)21
b(turn)e(our)h(old)g(Hello)g(W)-7 b(orld)20 b(serv)o(er)g(into)f
(something)g(more)h(capable.)396 886 y(The)g(original)f(serv)o(er)g(w)o
(as)j(a)e(single)g(thread.)f(If)h(the)g(w)o(ork)g(per)g(request)f(is)i
(lo)n(w)-5 b(,)20 b(that')-5 b(s)21 b(\002ne:)f(one)g(\330MQ)g(thread)f
(can)396 994 y(run)h(at)g(full)g(speed)g(on)g(a)h(CPU)g(core,)e(with)i
(no)e(w)o(aits,)i(doing)e(an)h(a)o(wful)g(lot)g(of)g(w)o(ork.)g(But)g
(realistic)h(serv)o(ers)e(ha)n(v)o(e)h(to)396 1102 y(do)g(non-tri)n
(vial)e(w)o(ork)h(per)g(request.)g(A)h(single)g(core)f(may)h(not)f(be)h
(enough)e(when)h(10,000)f(clients)i(hit)g(the)g(serv)o(er)f(all)h(at)
396 1210 y(once.)g(So)g(a)h(realistic)f(serv)o(er)f(must)i(start)f
(multiple)g(w)o(ork)o(er)f(threads.)g(It)i(then)f(accepts)g(requests)g
(as)g(f)o(ast)h(as)g(it)g(can,)396 1318 y(and)f(distrib)n(utes)g(these)
g(to)h(its)g(w)o(ork)o(er)e(threads.)g(The)h(w)o(ork)o(er)f(threads)h
(grind)f(through)f(the)i(w)o(ork,)f(and)h(e)n(v)o(entually)396
1426 y(send)g(their)g(replies)g(back.)-2 1610 y
SDict begin H.S end
 -2 1610
a -2 1610 a
SDict begin 13 H.A end
 -2 1610 a -2 1610 a
SDict begin [/View [/XYZ H.V]/Dest (0:995) cvn /DEST pdfmark end
 -2 1610 a 396 1700 a
Fk(Y)-9 b(ou)20 b(can)g(of)g(course)f(do)h(all)h(this)f(using)g(a)h
(proxy)d(brok)o(er)h(and)g(e)o(xternal)g(w)o(ork)o(er)h(processes,)f(b)
n(ut)h(often)g(it')-5 b(s)21 b(easier)f(to)396 1808 y(start)h(one)f
(process)f(that)i(gobbles)e(up)g(sixteen)h(cores,)g(than)g(sixteen)g
(processes,)f(each)h(gobbling)e(up)i(one)g(core.)396
1916 y(Further)m(,)f(running)f(w)o(ork)o(ers)h(as)i(threads)f(will)h
(cut)f(out)g(a)g(netw)o(ork)f(hop,)g(latenc)o(y)-5 b(,)19
b(and)h(netw)o(ork)f(traf)n(\002c.)-2 2100 y
SDict begin H.S end
 -2 2100
a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:996) cvn /DEST pdfmark end
 -2 2100 a 396 2190 a
Fk(The)h(MT)g(v)o(ersion)f(of)h(the)g(Hello)h(W)-7 b(orld)20
b(service)g(basically)g(collapses)g(the)g(brok)o(er)f(and)g(w)o(ork)o
(ers)h(into)g(a)g(single)396 2297 y(process:)-2 2315
y
SDict begin H.S end
 -2 2315 a -2 2315 a
SDict begin 13 H.A end
 -2 2315 a -2 2315 a
SDict begin [/View [/XYZ H.V]/Dest (0:mtserver-c) cvn /DEST pdfmark
end
 -2 2315 a 396
2499 a Fg(Example)h(2-11.)d(Multithr)o(eaded)i(ser)o(vice)g(\(mtser)o
(v)o(er)-8 b(.c\))-2 2599 y
SDict begin H.S end
 -2 2599 a -2 2599 a
SDict begin 11.7 H.A end
 -2 2599
a -2 2599 a
SDict begin [/View [/XYZ H.V]/Dest (0:999) cvn /DEST pdfmark end
 -2 2599 a 396 2679 a Fe(//)396 2776 y(//)90
b(Multithreaded)42 b(Hello)i(World)g(server)396 2873
y(//)396 2970 y(#include)g("zhelpers.h")396 3067 y(#include)g
(<pthread.h>)396 3262 y(static)g(void)934 3275 y(*)396
3359 y(worker_routine)f(\(void)1338 3372 y(*)1383 3359
y(context\))g({)576 3456 y(//)89 b(Socket)44 b(to)g(talk)g(to)h
(dispatcher)576 3553 y(void)800 3566 y(*)845 3553 y(receiver)e(=)i
(zmq_socket)e(\(context,)g(ZMQ_REP\);)576 3650 y(zmq_connect)g
(\(receiver,)g("inproc://workers"\);)576 3845 y(while)h(\(true\))f({)
755 3942 y(char)979 3955 y(*)1024 3942 y(string)h(=)g(s_recv)g
(\(receiver\);)755 4039 y(printf)g(\("Received)f(request:)g
([\045s]\\n",)h(string\);)755 4136 y(free)g(\(string\);)755
4233 y(//)89 b(Do)45 b(some)f('work')755 4330 y(sleep)g(\(1\);)755
4427 y(//)89 b(Send)44 b(reply)g(back)h(to)f(client)755
4525 y(s_send)g(\(receiver,)f("World"\);)576 4622 y(})576
4719 y(zmq_close)g(\(receiver\);)576 4816 y(return)g(NULL;)396
4913 y(})396 5107 y(int)i(main)f(\(void\))p Black 3800
5569 a Ff(69)p Black eop end
%%Page: 70 83
TeXDict begin 70 82 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.70) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1024) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe({)576 170 y(void)800 183 y(*)845 170
y(context)43 b(=)i(zmq_ctx_new)e(\(\);)576 364 y(//)89
b(Socket)44 b(to)g(talk)g(to)h(clients)576 461 y(void)800
474 y(*)845 461 y(clients)e(=)i(zmq_socket)e(\(context,)g
(ZMQ_ROUTER\);)576 558 y(zmq_bind)g(\(clients,)g("tcp://)1742
571 y(*)1787 558 y(:5555"\);)576 752 y(//)89 b(Socket)44
b(to)g(talk)g(to)h(workers)576 850 y(void)800 863 y(*)845
850 y(workers)e(=)i(zmq_socket)e(\(context,)g(ZMQ_DEALER\);)576
947 y(zmq_bind)g(\(workers,)g("inproc://workers"\);)576
1141 y(//)89 b(Launch)44 b(pool)g(of)g(worker)g(threads)576
1238 y(int)g(thread_nbr;)576 1335 y(for)g(\(thread_nbr)f(=)i(0;)f
(thread_nbr)f(<)i(5;)f(thread_nbr++\))f({)755 1432 y(pthread_t)g
(worker;)755 1530 y(pthread_create)f(\(&worker,)i(NULL,)g
(worker_routine,)e(context\);)576 1627 y(})576 1724 y(//)89
b(Connect)44 b(work)g(threads)f(to)i(client)f(threads)f(via)i(a)f
(queue)g(proxy)576 1821 y(zmq_proxy)f(\(clients,)g(workers,)h(NULL\);)
576 2015 y(//)89 b(We)44 b(never)g(get)h(here)f(but)g(clean)g(up)h
(anyhow)576 2112 y(zmq_close)e(\(clients\);)576 2209
y(zmq_close)g(\(workers\);)576 2307 y(zmq_ctx_destroy)f(\(context\);)
576 2404 y(return)h(0;)396 2501 y(})-2 2675 y
SDict begin H.S end
 -2 2675
a -2 2675 a
SDict begin 13 H.A end
 -2 2675 a -2 2675 a
SDict begin [/View [/XYZ H.V]/Dest (0:1000) cvn /DEST pdfmark end
 -2 2675 a 396 2775 a
Fk(All)21 b(the)f(code)g(should)f(be)h(recognizable)e(to)i(you)g(by)f
(no)n(w)-5 b(.)19 b(Ho)n(w)i(it)f(w)o(orks:)-2 2793 y
SDict begin H.S end

-2 2793 a -2 2793 a
SDict begin 13 H.A end
 -2 2793 a -2 2793 a
SDict begin [/View [/XYZ H.V]/Dest (0:1001) cvn /DEST pdfmark end
 -2 2793 a -2
2803 a
SDict begin H.S end
 -2 2803 a -2 2803 a
SDict begin 13 H.A end
 -2 2803 a -2 2803 a
SDict begin [/View [/XYZ H.V]/Dest (0:1002) cvn /DEST pdfmark end
 -2 2803
a Black 396 2945 a Fj(\225)p Black 479 2945 a
SDict begin H.S end
 479 2945
a 479 2945 a
SDict begin 13 H.A end
 479 2945 a 479 2945 a
SDict begin [/View [/XYZ H.V]/Dest (0:1003) cvn /DEST pdfmark end
 479 2945 a Fk(The)g(serv)o(er)f
(starts)i(a)g(set)g(of)f(w)o(ork)o(er)f(threads.)g(Each)h(w)o(ork)o(er)
f(thread)h(creates)g(a)g(REP)h(sock)o(et)g(and)e(then)h(processes)479
3053 y(requests)g(on)g(this)h(sock)o(et.)e(W)-7 b(ork)o(er)20
b(threads)g(are)g(just)h(lik)o(e)f(single-threaded)e(serv)o(ers.)h(The)
h(only)f(dif)n(ferences)g(are)479 3161 y(the)h(transport)f(\()945
3161 y
SDict begin H.S end
 945 3161 a 945 3161 a
SDict begin 13 H.A end
 945 3161 a 945 3161 a
SDict begin [/View [/XYZ H.V]/Dest (0:1004) cvn /DEST pdfmark end
 945
3161 a Fe(inproc)h Fk(instead)g(of)1581 3161 y
SDict begin H.S end
 1581 3161
a 1581 3161 a
SDict begin 13 H.A end
 1581 3161 a 1581 3161 a
SDict begin [/View [/XYZ H.V]/Dest (0:1005) cvn /DEST pdfmark end
 1581 3161 a Fe(tcp)p
Fk(\),)f(and)h(the)g(bind-connect)d(direction.)-2 3179
y
SDict begin H.S end
 -2 3179 a -2 3179 a
SDict begin 13 H.A end
 -2 3179 a -2 3179 a
SDict begin [/View [/XYZ H.V]/Dest (0:1006) cvn /DEST pdfmark end
 -2 3179 a Black
396 3310 a Fj(\225)p Black 479 3310 a
SDict begin H.S end
 479 3310 a 479
3310 a
SDict begin 13 H.A end
 479 3310 a 479 3310 a
SDict begin [/View [/XYZ H.V]/Dest (0:1007) cvn /DEST pdfmark end
 479 3310 a Fk(The)j(serv)o(er)f(creates)i
(a)f(R)m(OUTER)h(sock)o(et)f(to)g(talk)h(to)f(clients)g(and)g(binds)g
(this)g(to)h(its)g(e)o(xternal)e(interf)o(ace)g(\(o)o(v)o(er)479
3418 y
SDict begin H.S end
 479 3418 a 479 3418 a
SDict begin 13 H.A end
 479 3418 a 479 3418 a
SDict begin [/View [/XYZ H.V]/Dest (0:1008) cvn /DEST pdfmark end
 479
3418 a Fe(tcp)p Fk(\).)-2 3433 y
SDict begin H.S end
 -2 3433 a -2 3433 a
SDict begin 13 H.A end

-2 3433 a -2 3433 a
SDict begin [/View [/XYZ H.V]/Dest (0:1009) cvn /DEST pdfmark end
 -2 3433 a Black 396 3568 a Fj(\225)p
Black 479 3568 a
SDict begin H.S end
 479 3568 a 479 3568 a
SDict begin 13 H.A end
 479 3568 a 479
3568 a
SDict begin [/View [/XYZ H.V]/Dest (0:1010) cvn /DEST pdfmark end
 479 3568 a Fk(The)h(serv)o(er)f(creates)h(a)g(DEALER)g(sock)o
(et)g(to)g(talk)f(to)i(the)e(w)o(ork)o(ers)h(and)f(binds)g(this)i(to)f
(its)g(internal)g(interf)o(ace)f(\(o)o(v)o(er)479 3676
y
SDict begin H.S end
 479 3676 a 479 3676 a
SDict begin 13 H.A end
 479 3676 a 479 3676 a
SDict begin [/View [/XYZ H.V]/Dest (0:1011) cvn /DEST pdfmark end
 479 3676
a Fe(inproc)p Fk(\).)-2 3691 y
SDict begin H.S end
 -2 3691 a -2 3691 a
SDict begin 13 H.A end
 -2
3691 a -2 3691 a
SDict begin [/View [/XYZ H.V]/Dest (0:1012) cvn /DEST pdfmark end
 -2 3691 a Black 396 3825 a Fj(\225)p
Black 479 3825 a
SDict begin H.S end
 479 3825 a 479 3825 a
SDict begin 13 H.A end
 479 3825 a 479
3825 a
SDict begin [/View [/XYZ H.V]/Dest (0:1013) cvn /DEST pdfmark end
 479 3825 a Fk(The)h(serv)o(er)f(starts)i(a)g(proxy)e(that)h
(connects)f(the)h(tw)o(o)h(sock)o(ets.)f(The)g(proxy)e(pulls)i
(incoming)f(requests)h(f)o(airly)f(from)479 3933 y(all)i(clients,)f
(and)g(distrib)n(utes)g(those)g(out)g(to)g(w)o(ork)o(ers.)f(It)i(also)f
(routes)g(replies)g(back)g(to)g(their)g(origin.)-2 4117
y
SDict begin H.S end
 -2 4117 a -2 4117 a
SDict begin 13 H.A end
 -2 4117 a -2 4117 a
SDict begin [/View [/XYZ H.V]/Dest (0:1014) cvn /DEST pdfmark end
 -2 4117 a 396
4207 a Fk(Note)g(that)h(creating)e(threads)g(is)j(not)d(portable)g(in)i
(most)f(programming)c(languages.)j(The)h(POSIX)g(library)g(is)396
4315 y
SDict begin H.S end
 396 4315 a 396 4315 a
SDict begin 13 H.A end
 396 4315 a 396 4315 a
SDict begin [/View [/XYZ H.V]/Dest (0:1015) cvn /DEST pdfmark end
 396
4315 a Fe(pthreads)p Fk(,)f(b)n(ut)g(on)g(W)m(indo)n(ws)g(you)f(ha)n(v)
o(e)h(to)g(use)h(a)g(dif)n(ferent)d(API.)j(W)-7 b(e')o(ll)20
b(see)g(in)g(Chapter)f(Three)f(ho)n(w)h(to)g(wrap)g(this)396
4423 y(in)i(a)f(portable)f(API.)-2 4607 y
SDict begin H.S end
 -2 4607 a -2
4607 a
SDict begin 13 H.A end
 -2 4607 a -2 4607 a
SDict begin [/View [/XYZ H.V]/Dest (0:1016) cvn /DEST pdfmark end
 -2 4607 a 396 4697 a Fk(Here)h(the)h('w)o
(ork')d(is)j(just)g(a)g(one-second)d(pause.)h(W)-7 b(e)22
b(could)d(do)h(an)o(ything)e(in)i(the)g(w)o(ork)o(ers,)f(including)g
(talking)g(to)396 4805 y(other)h(nodes.)f(This)h(is)h(what)f(the)h(MT)f
(serv)o(er)f(looks)h(lik)o(e)g(in)h(terms)f(of)g(\330MQ)g(sock)o(ets)h
(and)e(nodes.)h(Note)g(ho)n(w)f(the)396 4913 y(request-reply)f(chain)i
(is)1132 4913 y
SDict begin H.S end
 1132 4913 a 1132 4913 a
SDict begin 13 H.A end
 1132 4913 a 1132
4913 a
SDict begin [/View [/XYZ H.V]/Dest (0:1017) cvn /DEST pdfmark end
 1132 4913 a Fe(REQ-ROUTER-queue-DEALER-REP)p Fk(\()p
0 TeXcolorgray 2375 4913 a
SDict begin H.S end
 2375 4913 a Fk(Figure)14 b(2-13)2761
4913 y
SDict begin 13 H.L end
 2761 4913 a 2761 4913 a
SDict begin [/Subtype /Link/Dest (0:figure-22) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2761 4913 a Black -1 w
Fk(\).)-2 4931 y
SDict begin H.S end
 -2 4931 a -2 4931 a
SDict begin 13 H.A end
 -2 4931 a -2 4931
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-22) cvn /DEST pdfmark
end
 -2 4931 a Black 3800 5569 a Ff(70)p Black eop end
%%Page: 71 84
TeXDict begin 71 83 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.71) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-13.)e(Multithr)o(eaded)i(Ser)o(v)o(er)
-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1021) cvn /DEST pdfmark end
 -2 172 a
396 3589 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3589 a @beginspecial 0 @llx -405 @lly
288 @urx 0 @ury 2880 @rwi @setspecial
%%BeginDocument: images/fig22.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -405 288 0
%%HiResBoundingBox: 0.0 -405.0 288.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -23.800180435180664 moveto
106.80017852783203 -57.80017852783203 lineto
184.80018615722656 -57.80017852783203 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -60.80017852783203 moveto
106.80017852783203 -73.80017852783203 lineto
106.80017852783203 -76.4668451944987 107.80017852783203 -77.80017852783203 109.80017852783203 -77.80017852783203 curveto
181.80018615722656 -77.80017852783203 lineto
181.80018615722656 -77.80017852783203 lineto
183.80018615722656 -77.80017852783203 184.80018615722656 -76.4668451944987 184.80018615722656 -73.80017852783203 curveto
184.80018615722656 -61.000179290771484 lineto
184.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
109.80017852783203 -140.80018615722656 moveto
107.80017852783203 -140.80018615722656 106.80017852783203 -142.46685282389322 106.80017852783203 -145.80018615722656 curveto
106.80017852783203 -156.80018615722656 lineto
184.80018615722656 -156.80018615722656 lineto
184.80018615722656 -145.80018615722656 lineto
184.80018615722656 -142.46685282389322 183.80018615722656 -140.80018615722656 181.80018615722656 -140.80018615722656 curveto
109.80017852783203 -140.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -159.80018615722656 moveto
106.80017852783203 -192.80018615722656 lineto
184.80018615722656 -192.80018615722656 lineto
184.80018615722656 -159.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -195.80018615722656 moveto
106.80017852783203 -237.80018615722656 lineto
184.80018615722656 -237.80018615722656 lineto
184.80018615722656 -195.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -240.80018615722656 moveto
106.80017852783203 -253.80018615722656 lineto
106.80017852783203 -256.4668426513672 107.80017852783203 -257.8001708984375 109.80017852783203 -257.8001708984375 curveto
181.80018615722656 -257.8001708984375 lineto
181.80018615722656 -257.8001708984375 lineto
183.80018615722656 -257.8001708984375 184.80018615722656 -256.4668426513672 184.80018615722656 -253.80018615722656 curveto
184.80018615722656 -241.00018310546875 lineto
184.80018615722656 -240.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
49.80017852783203 -311.8001708984375 moveto
47.80017852783203 -311.8001708984375 46.80017852783203 -313.4668375651042 46.80017852783203 -316.8001708984375 curveto
46.80017852783203 -327.8001708984375 lineto
100.80017852783203 -327.8001708984375 lineto
100.80017852783203 -316.8001708984375 lineto
100.80017852783203 -313.4668375651042 99.80017852783203 -311.8001708984375 97.80017852783203 -311.8001708984375 curveto
49.80017852783203 -311.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
46.80017852783203 -330.8001708984375 moveto
46.80017852783203 -365.8001708984375 lineto
100.80017852783203 -365.8001708984375 lineto
100.80017852783203 -330.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.80017852783203 -311.8001708984375 moveto
119.80017852783203 -311.8001708984375 118.80017852783203 -313.4668375651042 118.80017852783203 -316.8001708984375 curveto
118.80017852783203 -327.8001708984375 lineto
172.80018615722656 -327.8001708984375 lineto
172.80018615722656 -316.8001708984375 lineto
172.80018615722656 -313.4668375651042 171.80018615722656 -311.8001708984375 169.80018615722656 -311.8001708984375 curveto
121.80017852783203 -311.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -330.8001708984375 moveto
118.80017852783203 -365.8001708984375 lineto
172.80018615722656 -365.8001708984375 lineto
172.80018615722656 -330.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
193.80018615722656 -311.8001708984375 moveto
191.80018615722656 -311.8001708984375 190.80018615722656 -313.4668375651042 190.80018615722656 -316.8001708984375 curveto
190.80018615722656 -327.8001708984375 lineto
244.80018615722656 -327.8001708984375 lineto
244.80018615722656 -316.8001708984375 lineto
244.80018615722656 -313.4668375651042 243.80018615722656 -311.8001708984375 241.80018615722656 -311.8001708984375 curveto
193.80018615722656 -311.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
190.80018615722656 -330.8001708984375 moveto
190.80018615722656 -365.8001708984375 lineto
244.80018615722656 -365.8001708984375 lineto
244.80018615722656 -330.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -139.0 moveto
106.0 -139.0 105.0 -140.66666666666666 105.0 -144.0 curveto
105.0 -155.0 lineto
183.0 -155.0 lineto
183.0 -144.0 lineto
183.0 -140.66666666666666 182.0 -139.0 180.0 -139.0 curveto
108.0 -139.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -139.0 moveto
106.0 -139.0 105.0 -140.66666666666666 105.0 -144.0 curveto
105.0 -155.0 lineto
183.0 -155.0 lineto
183.0 -144.0 lineto
183.0 -140.66666666666666 182.0 -139.0 180.0 -139.0 curveto
108.0 -139.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -158.0 moveto
105.0 -191.0 lineto
183.0 -191.0 lineto
183.0 -158.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -158.0 moveto
105.0 -191.0 lineto
183.0 -191.0 lineto
183.0 -158.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -194.0 moveto
105.0 -236.0 lineto
183.0 -236.0 lineto
183.0 -194.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -194.0 moveto
105.0 -236.0 lineto
183.0 -236.0 lineto
183.0 -194.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -239.0 moveto
105.0 -252.0 lineto
105.0 -254.66666666666666 106.0 -256.0 108.0 -256.0 curveto
180.0 -256.0 lineto
180.0 -256.0 lineto
182.0 -256.0 183.0 -254.66666666666666 183.0 -252.0 curveto
183.0 -239.1999969482422 lineto
183.0 -239.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -239.0 moveto
105.0 -252.0 lineto
105.0 -254.66666666666666 106.0 -256.0 108.0 -256.0 curveto
180.0 -256.0 lineto
180.0 -256.0 lineto
182.0 -256.0 183.0 -254.66666666666666 183.0 -252.0 curveto
183.0 -239.1999969482422 lineto
183.0 -239.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
48.0 -310.0 moveto
46.0 -310.0 45.0 -311.6666666666667 45.0 -315.0 curveto
45.0 -326.0 lineto
99.0 -326.0 lineto
99.0 -315.0 lineto
99.0 -311.6666666666667 98.0 -310.0 96.0 -310.0 curveto
48.0 -310.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
48.0 -310.0 moveto
46.0 -310.0 45.0 -311.6666666666667 45.0 -315.0 curveto
45.0 -326.0 lineto
99.0 -326.0 lineto
99.0 -315.0 lineto
99.0 -311.6666666666667 98.0 -310.0 96.0 -310.0 curveto
48.0 -310.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
45.0 -329.0 moveto
45.0 -364.0 lineto
99.0 -364.0 lineto
99.0 -329.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
45.0 -329.0 moveto
45.0 -364.0 lineto
99.0 -364.0 lineto
99.0 -329.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
120.0 -310.0 moveto
118.0 -310.0 117.0 -311.6666666666667 117.0 -315.0 curveto
117.0 -326.0 lineto
171.0 -326.0 lineto
171.0 -315.0 lineto
171.0 -311.6666666666667 170.0 -310.0 168.0 -310.0 curveto
120.0 -310.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
120.0 -310.0 moveto
118.0 -310.0 117.0 -311.6666666666667 117.0 -315.0 curveto
117.0 -326.0 lineto
171.0 -326.0 lineto
171.0 -315.0 lineto
171.0 -311.6666666666667 170.0 -310.0 168.0 -310.0 curveto
120.0 -310.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -329.0 moveto
117.0 -364.0 lineto
171.0 -364.0 lineto
171.0 -329.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -329.0 moveto
117.0 -364.0 lineto
171.0 -364.0 lineto
171.0 -329.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
192.0 -310.0 moveto
190.0 -310.0 189.0 -311.6666666666667 189.0 -315.0 curveto
189.0 -326.0 lineto
243.0 -326.0 lineto
243.0 -315.0 lineto
243.0 -311.6666666666667 242.0 -310.0 240.0 -310.0 curveto
192.0 -310.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
192.0 -310.0 moveto
190.0 -310.0 189.0 -311.6666666666667 189.0 -315.0 curveto
189.0 -326.0 lineto
243.0 -326.0 lineto
243.0 -315.0 lineto
243.0 -311.6666666666667 242.0 -310.0 240.0 -310.0 curveto
192.0 -310.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
189.0 -329.0 moveto
189.0 -364.0 lineto
243.0 -364.0 lineto
243.0 -329.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
189.0 -329.0 moveto
189.0 -364.0 lineto
243.0 -364.0 lineto
243.0 -329.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
126.0 -121.0 moveto
18.0 -121.0 lineto
16.0 -121.0 15.0 -122.66666666666667 15.0 -126.0 curveto
15.0 -378.0 lineto
15.0 -378.0 lineto
15.0 -380.6666666666667 16.0 -382.0 18.0 -382.0 curveto
270.0 -382.0 lineto
270.0 -382.0 lineto
272.0 -382.0 273.0 -380.6666666666667 273.0 -378.0 curveto
273.0 -126.0 lineto
273.0 -126.0 lineto
273.0 -122.66666666666667 272.0 -121.0 270.0 -121.0 curveto
162.0 -121.0 lineto
162.0 -121.0 lineto
stroke
newpath
132.0 -121.0 moveto
156.0 -121.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
129.0 -76.0 moveto
129.0 -130.0 lineto
stroke
newpath
159.0 -85.0 moveto
159.0 -139.0 lineto
stroke
newpath
159.0 -81.0 moveto
156.0 -90.0 lineto
162.0 -90.0 lineto
closepath
fill
newpath
126.0 -126.0 moveto
129.0 -135.0 lineto
132.0 -126.0 lineto
closepath
fill
newpath
141.0 -261.0 moveto
138.0 -270.0 lineto
144.0 -270.0 lineto
closepath
fill
newpath
66.0 -297.0 moveto
69.0 -306.0 lineto
72.0 -297.0 lineto
closepath
fill
newpath
138.0 -297.0 moveto
141.0 -306.0 lineto
144.0 -297.0 lineto
closepath
fill
newpath
210.0 -297.0 moveto
213.0 -306.0 lineto
216.0 -297.0 lineto
closepath
fill
newpath
141.0 -265.0 moveto
141.0 -283.0 lineto
stroke
newpath
69.0 -301.0 moveto
69.0 -283.0 lineto
141.0 -283.0 lineto
stroke
newpath
141.0 -301.0 moveto
141.0 -283.0 lineto
stroke
newpath
213.0 -301.0 moveto
213.0 -283.0 lineto
141.0 -283.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
130.0 -44.0 moveto
(Client) show
133.0 -71.0 moveto
(REQ) show
99.0 -107.0 moveto
("Hello") show
152.0 -107.0 moveto
("World") show
128.0 -152.0 moveto
(ROUTER) show
128.0 -179.0 moveto
(Server) show
127.0 -215.0 moveto
(Queue) show
127.0 -224.0 moveto
(proxy) show
127.0 -251.0 moveto
(DEALER) show
61.0 -323.0 moveto
(REP) show
133.0 -323.0 moveto
(REP) show
205.0 -323.0 moveto
(REP) show
54.0 -350.0 moveto
(Worker) show
126.0 -350.0 moveto
(Worker) show
198.0 -350.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3589 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3589 a -2 3672 a
SDict begin H.S end
 -2 3672
a -2 3672 a
SDict begin 13 H.A end
 -2 3672 a -2 3672 a
SDict begin [/View [/XYZ H.V]/Dest (0:1024) cvn /DEST pdfmark end
 -2 3672 a 377 x Fn(2.19.)39
b(Signaling)e(between)h(Threads)2216 4049 y
SDict begin H.S end
 2216 4049
a 2216 4049 a
SDict begin 22.464 H.A end
 2216 4049 a 2216 4049 a
SDict begin [/View [/XYZ H.V]/Dest (7.40.1) cvn /DEST pdfmark end
 2216 4049 a -2
4247 a
SDict begin H.S end
 -2 4247 a -2 4247 a
SDict begin 13 H.A end
 -2 4247 a -2 4247 a
SDict begin [/View [/XYZ H.V]/Dest (0:1026) cvn /DEST pdfmark end
 -2 4247
a 396 4323 a Fk(When)20 b(you)g(start)g(making)f(multithreaded)f
(applications)h(with)h(\330MQ,)h(you')o(ll)e(hit)h(the)g(question)g(of)
g(ho)n(w)f(to)396 4431 y(coordinate)f(your)h(threads.)h(Though)e(you)h
(might)h(be)g(tempted)f(to)h(insert)g(')-5 b(sleep')21
b(statements,)f(or)f(use)i(multithreading)396 4539 y(techniques)e(such)
h(as)h(semaphores)e(or)h(mute)o(x)o(es,)1853 4539 y
SDict begin H.S end
 1853
4539 a 1853 4539 a
SDict begin 13 H.A end
 1853 4539 a 1853 4539 a
SDict begin [/View [/XYZ H.V]/Dest (0:1027) cvn /DEST pdfmark end
 1853 4539
a Fg(the)h(only)f(mechanism)h(that)e(y)n(ou)h(should)h(use)g(ar)o(e)f
(\330MQ)396 4647 y(messages)p Fk(.)h(Remember)e(the)h(story)g(of)g(The)
f(Drunkards)g(and)g(the)h(Beer)h(Bottle.)-2 4831 y
SDict begin H.S end
 -2
4831 a -2 4831 a
SDict begin 13 H.A end
 -2 4831 a -2 4831 a
SDict begin [/View [/XYZ H.V]/Dest (0:1028) cvn /DEST pdfmark end
 -2 4831 a 396 4921
a Fk(Let')-5 b(s)21 b(mak)o(e)f(three)g(threads)f(that)h(signal)g(each)
g(other)g(when)f(the)o(y)h(are)g(ready\()p 0 TeXcolorgray
2658 4921 a
SDict begin H.S end
 2658 4921 a Fk(Figure)d(2-14)3047 4921 y
SDict begin 13 H.L end

3047 4921 a 3047 4921 a
SDict begin [/Subtype /Link/Dest (0:figure-23) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3047 4921 a Black -1 w Fk(\).)j(In)g(this)g(e)o
(xample)f(we)i(use)396 5029 y(P)-8 b(AIR)22 b(sock)o(ets)e(o)o(v)o(er)f
(the)1151 5029 y
SDict begin H.S end
 1151 5029 a 1151 5029 a
SDict begin 13 H.A end
 1151 5029 a
1151 5029 a
SDict begin [/View [/XYZ H.V]/Dest (0:1030) cvn /DEST pdfmark end
 1151 5029 a Fe(inproc)h Fk(transport:)-2
5047 y
SDict begin H.S end
 -2 5047 a -2 5047 a
SDict begin 13 H.A end
 -2 5047 a -2 5047 a
SDict begin [/View [/XYZ H.V]/Dest (0:mtrelay-c) cvn /DEST pdfmark
end
 -2 5047
a Black 3800 5569 a Ff(71)p Black eop end
%%Page: 72 85
TeXDict begin 72 84 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.72) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Example)i(2-12.)d(Multithr)o(eaded)i(r)o(elay)f
(\(mtr)o(elay)-6 b(.c\))-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2
172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1033) cvn /DEST pdfmark end
 -2 172 a 396 253 a Fe(//)396 350 y(//)90
b(Multithreaded)42 b(relay)396 447 y(//)396 544 y(#include)i
("zhelpers.h")396 641 y(#include)g(<pthread.h>)396 835
y(static)g(void)934 848 y(*)396 933 y(step1)g(\(void)934
946 y(*)979 933 y(context\))g({)576 1030 y(//)89 b(Connect)44
b(to)g(step2)g(and)g(tell)h(it)f(we're)g(ready)576 1127
y(void)800 1140 y(*)845 1127 y(xmitter)f(=)i(zmq_socket)e(\(context,)g
(ZMQ_PAIR\);)576 1224 y(zmq_connect)g(\(xmitter,)g("inproc://step2"\);)
576 1321 y(printf)g(\("Step)h(1)h(ready,)f(signaling)f(step)h(2\\n"\);)
576 1418 y(s_send)f(\(xmitter,)h("READY"\);)576 1515
y(zmq_close)f(\(xmitter\);)576 1710 y(return)g(NULL;)396
1807 y(})396 2001 y(static)h(void)934 2014 y(*)396 2098
y(step2)g(\(void)934 2111 y(*)979 2098 y(context\))g({)576
2195 y(//)89 b(Bind)44 b(inproc)g(socket)g(before)g(starting)f(step1)
576 2292 y(void)800 2305 y(*)845 2292 y(receiver)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PAIR\);)576 2390 y(zmq_bind)g(\(receiver,)g
("inproc://step2"\);)576 2487 y(pthread_t)g(thread;)576
2584 y(pthread_create)f(\(&thread,)h(NULL,)h(step1,)g(context\);)576
2778 y(//)89 b(Wait)44 b(for)g(signal)g(and)h(pass)f(it)g(on)576
2875 y(char)800 2888 y(*)845 2875 y(string)f(=)i(s_recv)f
(\(receiver\);)576 2972 y(free)g(\(string\);)576 3070
y(zmq_close)f(\(receiver\);)576 3264 y(//)89 b(Connect)44
b(to)g(step3)g(and)g(tell)h(it)f(we're)g(ready)576 3361
y(void)800 3374 y(*)845 3361 y(xmitter)f(=)i(zmq_socket)e(\(context,)g
(ZMQ_PAIR\);)576 3458 y(zmq_connect)g(\(xmitter,)g("inproc://step3"\);)
576 3555 y(printf)g(\("Step)h(2)h(ready,)f(signaling)f(step)h(3\\n"\);)
576 3652 y(s_send)f(\(xmitter,)h("READY"\);)576 3750
y(zmq_close)f(\(xmitter\);)576 3944 y(return)g(NULL;)396
4041 y(})396 4235 y(int)i(main)f(\(void\))396 4332 y({)576
4429 y(void)800 4442 y(*)845 4429 y(context)f(=)i(zmq_ctx_new)e(\(\);)
576 4624 y(//)89 b(Bind)44 b(inproc)g(socket)g(before)g(starting)f
(step2)576 4721 y(void)800 4734 y(*)845 4721 y(receiver)g(=)i
(zmq_socket)e(\(context,)g(ZMQ_PAIR\);)576 4818 y(zmq_bind)g
(\(receiver,)g("inproc://step3"\);)576 4915 y(pthread_t)g(thread;)576
5012 y(pthread_create)f(\(&thread,)h(NULL,)h(step2,)g(context\);)p
Black 3800 5569 a Ff(72)p Black eop end
%%Page: 73 86
TeXDict begin 73 85 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.73) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1039) cvn /DEST pdfmark end
 -2 -201 a 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(//)89 b(Wait)44 b(for)g(signal)576
170 y(char)800 183 y(*)845 170 y(string)f(=)i(s_recv)f(\(receiver\);)
576 267 y(free)g(\(string\);)576 364 y(zmq_close)f(\(receiver\);)576
558 y(printf)g(\("Test)h(successful!\\n"\);)576 655 y(zmq_ctx_destroy)e
(\(context\);)576 752 y(return)h(0;)396 850 y(})-2 858
y
SDict begin H.S end
 -2 858 a -2 858 a
SDict begin 13 H.A end
 -2 858 a -2 858 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-23) cvn /DEST pdfmark
end
 -2 858 a Black
3800 5569 a Ff(73)p Black eop end
%%Page: 74 87
TeXDict begin 74 86 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.74) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fg(Figur)o(e)h(2-14.)e(The)k(Relay)d(Race)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1036) cvn /DEST pdfmark end
 -2 172 a 396
4531 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4531 a @beginspecial 0 @llx -518 @lly 180
@urx 0 @ury 1800 @rwi @setspecial
%%BeginDocument: images/fig23.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -518 180 0
%%HiResBoundingBox: 0.0 -518.0 180.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -92.00029754638672 lineto
158.00030517578125 -92.00029754638672 lineto
158.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -96.00029754638672 moveto
28.00029945373535 -115.00029754638672 lineto
28.00029945373535 -119.66696421305339 29.666966756184895 -122.00029754638672 33.000301361083984 -122.00029754638672 curveto
153.00030517578125 -122.00029754638672 lineto
153.00030517578125 -122.00029754638672 lineto
156.3336385091146 -122.00029754638672 158.00030517578125 -119.66696421305339 158.00030517578125 -115.00029754638672 curveto
158.00030517578125 -96.00029754638672 lineto
158.00030517578125 -96.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
33.000301361083984 -206.00030517578125 moveto
29.666966756184895 -206.00030517578125 28.00029945373535 -208.3336385091146 28.00029945373535 -213.00030517578125 curveto
28.00029945373535 -232.00030517578125 lineto
158.00030517578125 -232.00030517578125 lineto
158.00030517578125 -213.00030517578125 lineto
158.00030517578125 -208.3336385091146 156.3336385091146 -206.00030517578125 153.00030517578125 -206.00030517578125 curveto
33.000301361083984 -206.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -236.00030517578125 moveto
28.00029945373535 -288.00030517578125 lineto
158.00030517578125 -288.00030517578125 lineto
158.00030517578125 -236.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -292.00030517578125 moveto
28.00029945373535 -311.00030517578125 lineto
28.00029945373535 -315.66697184244794 29.666966756184895 -318.00030517578125 33.000301361083984 -318.00030517578125 curveto
153.00030517578125 -318.00030517578125 lineto
153.00030517578125 -318.00030517578125 lineto
156.3336385091146 -318.00030517578125 158.00030517578125 -315.66697184244794 158.00030517578125 -311.00030517578125 curveto
158.00030517578125 -292.00030517578125 lineto
158.00030517578125 -292.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
33.000301361083984 -402.00030517578125 moveto
29.666966756184895 -402.00030517578125 28.00029945373535 -404.33363850911456 28.00029945373535 -409.00030517578125 curveto
28.00029945373535 -428.00030517578125 lineto
158.00030517578125 -428.00030517578125 lineto
158.00030517578125 -409.00030517578125 lineto
158.00030517578125 -404.33363850911456 156.3336385091146 -402.00030517578125 153.00030517578125 -402.00030517578125 curveto
33.000301361083984 -402.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -432.00030517578125 moveto
28.00029945373535 -486.00030517578125 lineto
158.00030517578125 -486.00030517578125 lineto
158.00030517578125 -432.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
155.0 -89.0 lineto
155.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
155.0 -89.0 lineto
155.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
150.0 -119.0 lineto
150.0 -119.0 lineto
153.33333333333334 -119.0 155.0 -116.66666666666667 155.0 -112.0 curveto
155.0 -93.0 lineto
155.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
150.0 -119.0 lineto
150.0 -119.0 lineto
153.33333333333334 -119.0 155.0 -116.66666666666667 155.0 -112.0 curveto
155.0 -93.0 lineto
155.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
30.0 -203.0 moveto
26.666666666666668 -203.0 25.0 -205.33333333333334 25.0 -210.0 curveto
25.0 -229.0 lineto
155.0 -229.0 lineto
155.0 -210.0 lineto
155.0 -205.33333333333334 153.33333333333334 -203.0 150.0 -203.0 curveto
30.0 -203.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
30.0 -203.0 moveto
26.666666666666668 -203.0 25.0 -205.33333333333334 25.0 -210.0 curveto
25.0 -229.0 lineto
155.0 -229.0 lineto
155.0 -210.0 lineto
155.0 -205.33333333333334 153.33333333333334 -203.0 150.0 -203.0 curveto
30.0 -203.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -233.0 moveto
25.0 -285.0 lineto
155.0 -285.0 lineto
155.0 -233.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -233.0 moveto
25.0 -285.0 lineto
155.0 -285.0 lineto
155.0 -233.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -289.0 moveto
25.0 -308.0 lineto
25.0 -312.6666666666667 26.666666666666668 -315.0 30.0 -315.0 curveto
150.0 -315.0 lineto
150.0 -315.0 lineto
153.33333333333334 -315.0 155.0 -312.6666666666667 155.0 -308.0 curveto
155.0 -289.0 lineto
155.0 -289.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -289.0 moveto
25.0 -308.0 lineto
25.0 -312.6666666666667 26.666666666666668 -315.0 30.0 -315.0 curveto
150.0 -315.0 lineto
150.0 -315.0 lineto
153.33333333333334 -315.0 155.0 -312.6666666666667 155.0 -308.0 curveto
155.0 -289.0 lineto
155.0 -289.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
30.0 -399.0 moveto
26.666666666666668 -399.0 25.0 -401.3333333333333 25.0 -406.0 curveto
25.0 -425.0 lineto
155.0 -425.0 lineto
155.0 -406.0 lineto
155.0 -401.3333333333333 153.33333333333334 -399.0 150.0 -399.0 curveto
30.0 -399.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
30.0 -399.0 moveto
26.666666666666668 -399.0 25.0 -401.3333333333333 25.0 -406.0 curveto
25.0 -425.0 lineto
155.0 -425.0 lineto
155.0 -406.0 lineto
155.0 -401.3333333333333 153.33333333333334 -399.0 150.0 -399.0 curveto
30.0 -399.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -429.0 moveto
25.0 -483.0 lineto
155.0 -483.0 lineto
155.0 -429.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -429.0 moveto
25.0 -483.0 lineto
155.0 -483.0 lineto
155.0 -429.0 lineto
closepath
stroke
newpath
85.0 -119.0 moveto
85.0 -189.0 lineto
stroke
newpath
85.0 -315.0 moveto
85.0 -385.0 lineto
stroke
newpath
80.0 -182.0 moveto
85.0 -196.0 lineto
90.0 -182.0 lineto
closepath
fill
newpath
80.0 -378.0 moveto
85.0 -392.0 lineto
90.0 -378.0 lineto
closepath
fill
/Helvetica findfont
15 scalefont setfont
64.0 -68.0 moveto
(Step 1) show
71.0 -110.0 moveto
(PAIR) show
61.0 -166.0 moveto
(Ready!) show
71.0 -222.0 moveto
(PAIR) show
64.0 -264.0 moveto
(Step 2) show
71.0 -306.0 moveto
(PAIR) show
61.0 -362.0 moveto
(Ready!) show
71.0 -418.0 moveto
(PAIR) show
64.0 -460.0 moveto
(Step 3) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4531 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4531 a 274 x Fk(This)i(is)g(a)f(classic)h
(pattern)f(for)f(multithreading)f(with)i(\330MQ:)-2 4822
y
SDict begin H.S end
 -2 4822 a -2 4822 a
SDict begin 13 H.A end
 -2 4822 a -2 4822 a
SDict begin [/View [/XYZ H.V]/Dest (0:1040) cvn /DEST pdfmark end
 -2 4822 a -2
4832 a
SDict begin H.S end
 -2 4832 a -2 4832 a
SDict begin 13 H.A end
 -2 4832 a -2 4832 a
SDict begin [/View [/XYZ H.V]/Dest (0:1041) cvn /DEST pdfmark end
 -2 4832
a Black 463 4975 a Fk(1.)p Black 546 4975 a
SDict begin H.S end
 546 4975
a 546 4975 a
SDict begin 13 H.A end
 546 4975 a 546 4975 a
SDict begin [/View [/XYZ H.V]/Dest (0:1042) cvn /DEST pdfmark end
 546 4975 a Fk(T)-7
b(w)o(o)20 b(threads)g(communicate)e(o)o(v)o(er)1606
4975 y
SDict begin H.S end
 1606 4975 a 1606 4975 a
SDict begin 13 H.A end
 1606 4975 a 1606 4975
a
SDict begin [/View [/XYZ H.V]/Dest (0:1043) cvn /DEST pdfmark end
 1606 4975 a Fe(inproc)p Fk(,)h(using)h(a)g(shared)g(conte)o(xt.)-2
4993 y
SDict begin H.S end
 -2 4993 a -2 4993 a
SDict begin 13 H.A end
 -2 4993 a -2 4993 a
SDict begin [/View [/XYZ H.V]/Dest (0:1044) cvn /DEST pdfmark end
 -2 4993
a Black 463 5124 a Fk(2.)p Black 546 5124 a
SDict begin H.S end
 546 5124
a 546 5124 a
SDict begin 13 H.A end
 546 5124 a 546 5124 a
SDict begin [/View [/XYZ H.V]/Dest (0:1045) cvn /DEST pdfmark end
 546 5124 a Fk(The)g(parent)f(thread)
g(creates)h(one)g(sock)o(et,)g(binds)f(it)i(to)g(an)f(inproc://)f
(endpoint,)f(and)3024 5124 y
SDict begin H.S end
 3024 5124 a 3024 5124 a
SDict begin 13 H.A end

3024 5124 a 3024 5124 a
SDict begin [/View [/XYZ H.V]/Dest (0:1046) cvn /DEST pdfmark end
 3024 5124 a Ff(then)h Fk(starts)i(the)f(child)p
Black 3800 5569 a Ff(74)p Black eop end
%%Page: 75 88
TeXDict begin 75 87 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.75) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 546 72 a Fk(thread,)g(passing)h(the)g(conte)o(xt)f(to)h(it.)-2
90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:1047) cvn /DEST pdfmark end
 -2 90 a Black 463
222 a Fk(3.)p Black 546 222 a
SDict begin H.S end
 546 222 a 546 222 a
SDict begin 13 H.A end
 546
222 a 546 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:1048) cvn /DEST pdfmark end
 546 222 a Fk(The)g(child)f(thread)h(creates)g(the)g
(second)f(sock)o(et,)h(connects)f(it)i(to)g(that)f(inproc://)f
(endpoint,)f(and)3372 222 y
SDict begin H.S end
 3372 222 a 3372 222 a
SDict begin 13 H.A end
 3372
222 a 3372 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:1049) cvn /DEST pdfmark end
 3372 222 a Ff(then)h Fk(signals)i(to)546
330 y(the)f(parent)f(thread)g(that)i(it')-5 b(s)21 b(ready)-5
b(.)-2 514 y
SDict begin H.S end
 -2 514 a -2 514 a
SDict begin 13 H.A end
 -2 514 a -2 514 a
SDict begin [/View [/XYZ H.V]/Dest (0:1050) cvn /DEST pdfmark end
 -2 514
a 396 604 a Fk(Note)20 b(that)h(multithreading)c(code)j(using)g(this)g
(pattern)g(is)2080 604 y
SDict begin H.S end
 2080 604 a 2080 604 a
SDict begin 13 H.A end
 2080 604
a 2080 604 a
SDict begin [/View [/XYZ H.V]/Dest (0:1051) cvn /DEST pdfmark end
 2080 604 a 2080 604 a
SDict begin H.S end
 2080 604 a 2080 604
a
SDict begin 13 H.A end
 2080 604 a 2080 604 a
SDict begin [/View [/XYZ H.V]/Dest (0:1052) cvn /DEST pdfmark end
 2080 604 a Fd(not)g(scalable)g(out)g(to)h
(processes)p Fk(.)f(If)g(you)f(use)3443 604 y
SDict begin H.S end
 3443 604
a 3443 604 a
SDict begin 13 H.A end
 3443 604 a 3443 604 a
SDict begin [/View [/XYZ H.V]/Dest (0:1053) cvn /DEST pdfmark end
 3443 604 a Fe(inproc)g
Fk(and)396 712 y(sock)o(et)h(pairs,)f(you)g(are)g(b)n(uilding)f(a)i
(tightly-bound)c(application.)i(Do)i(this)g(when)f(lo)n(w)g(latenc)o(y)
g(is)h(really)g(vital.)f(F)o(or)g(all)396 820 y(normal)g(apps,)h(use)g
(one)g(conte)o(xt)f(per)h(thread,)f(and)1898 820 y
SDict begin H.S end
 1898
820 a 1898 820 a
SDict begin 13 H.A end
 1898 820 a 1898 820 a
SDict begin [/View [/XYZ H.V]/Dest (0:1054) cvn /DEST pdfmark end
 1898 820 a Fe(ipc)i
Fk(or)2143 820 y
SDict begin H.S end
 2143 820 a 2143 820 a
SDict begin 13 H.A end
 2143 820 a 2143
820 a
SDict begin [/View [/XYZ H.V]/Dest (0:1055) cvn /DEST pdfmark end
 2143 820 a Fe(tcp)p Fk(.)f(Then)g(you)f(can)h(easily)h(break)e
(your)g(threads)g(out)h(to)396 928 y(separate)g(processes,)g(or)g(box)o
(es,)f(as)h(needed.)-2 1112 y
SDict begin H.S end
 -2 1112 a -2 1112 a
SDict begin 13 H.A end
 -2
1112 a -2 1112 a
SDict begin [/View [/XYZ H.V]/Dest (0:1056) cvn /DEST pdfmark end
 -2 1112 a 396 1202 a Fk(This)h(is)g(the)f(\002rst)h
(time)f(we')l(v)o(e)f(sho)n(wn)h(an)g(e)o(xample)f(using)g(P)-8
b(AIR)22 b(sock)o(ets.)e(Why)g(use)g(P)-8 b(AIR?)21 b(Other)f(sock)o
(et)396 1310 y(combinations)e(might)i(seem)g(to)h(w)o(ork)e(b)n(ut)h
(the)o(y)g(all)h(ha)n(v)o(e)e(side-ef)n(fects)h(that)g(could)f
(interfere)g(with)h(signaling:)-2 1327 y
SDict begin H.S end
 -2 1327 a -2
1327 a
SDict begin 13 H.A end
 -2 1327 a -2 1327 a
SDict begin [/View [/XYZ H.V]/Dest (0:1057) cvn /DEST pdfmark end
 -2 1327 a -2 1337 a
SDict begin H.S end
 -2 1337
a -2 1337 a
SDict begin 13 H.A end
 -2 1337 a -2 1337 a
SDict begin [/View [/XYZ H.V]/Dest (0:1058) cvn /DEST pdfmark end
 -2 1337 a Black 396 1480
a Fj(\225)p Black 479 1480 a
SDict begin H.S end
 479 1480 a 479 1480 a
SDict begin 13 H.A end
 479
1480 a 479 1480 a
SDict begin [/View [/XYZ H.V]/Dest (0:1059) cvn /DEST pdfmark end
 479 1480 a Fk(Y)-9 b(ou)20 b(can)g(use)g(PUSH)h(for)f
(the)g(sender)f(and)h(PULL)g(for)g(the)g(recei)n(v)o(er)-5
b(.)19 b(This)h(looks)g(simple)g(and)g(will)h(w)o(ork,)e(b)n(ut)479
1588 y(remember)g(that)h(PUSH)h(will)g(load-balance)d(messages)i(to)g
(all)h(a)n(v)n(ailable)f(recei)n(v)o(ers.)f(If)h(you)f(by)h(accident)f
(start)479 1696 y(tw)o(o)i(recei)n(v)o(ers)e(\(e.g.)g(you)g(already)g
(ha)n(v)o(e)h(one)g(running)e(and)h(you)h(start)g(a)h(second\),)e(you')
o(ll)g("lose")h(half)g(of)g(your)479 1803 y(signals.)g(P)-8
b(AIR)22 b(has)e(the)g(adv)n(antage)f(of)g(refusing)g(more)h(than)f
(one)h(connection,)e(the)i(pair)g(is)3195 1803 y
SDict begin H.S end
 3195
1803 a 3195 1803 a
SDict begin 13 H.A end
 3195 1803 a 3195 1803 a
SDict begin [/View [/XYZ H.V]/Dest (0:1060) cvn /DEST pdfmark end
 3195 1803
a Ff(e)n(xclusive)p Fk(.)-2 1821 y
SDict begin H.S end
 -2 1821 a -2 1821
a
SDict begin 13 H.A end
 -2 1821 a -2 1821 a
SDict begin [/View [/XYZ H.V]/Dest (0:1061) cvn /DEST pdfmark end
 -2 1821 a Black 396 1953 a Fj(\225)p
Black 479 1953 a
SDict begin H.S end
 479 1953 a 479 1953 a
SDict begin 13 H.A end
 479 1953 a 479
1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:1062) cvn /DEST pdfmark end
 479 1953 a Fk(Y)-9 b(ou)20 b(can)g(use)g(DEALER)g(for)g(the)g
(sender)g(and)f(R)m(OUTER)i(for)e(the)i(recei)n(v)o(er)-5
b(.)19 b(R)m(OUTER)h(ho)n(we)n(v)o(er)e(wraps)i(your)479
2061 y(message)g(in)h(an)f("en)m(v)o(elope",)d(meaning)i(your)g
(zero-size)g(signal)h(turns)g(into)g(a)h(multi-part)d(message.)i(If)g
(you)g(don')o(t)479 2169 y(care)g(about)g(the)g(data,)g(and)f(treat)h
(an)o(ything)f(as)h(a)h(v)n(alid)f(signal,)g(and)f(if)i(you)e(don')o(t)
g(read)g(more)h(than)f(once)h(from)f(the)479 2277 y(sock)o(et,)h(that)g
(w)o(on')o(t)f(matter)-5 b(.)21 b(If)f(ho)n(we)n(v)o(er)e(you)h(decide)
h(to)g(send)g(real)g(data,)g(you)f(will)i(suddenly)e(\002nd)h(R)m
(OUTER)479 2385 y(pro)o(viding)e(you)h(with)h("wrong")f(messages.)h
(DEALER)g(also)h(load-balances,)d(gi)n(ving)h(the)h(same)g(risk)g(as)h
(PUSH.)-2 2403 y
SDict begin H.S end
 -2 2403 a -2 2403 a
SDict begin 13 H.A end
 -2 2403 a -2 2403
a
SDict begin [/View [/XYZ H.V]/Dest (0:1063) cvn /DEST pdfmark end
 -2 2403 a Black 396 2534 a Fj(\225)p Black 479 2534
a
SDict begin H.S end
 479 2534 a 479 2534 a
SDict begin 13 H.A end
 479 2534 a 479 2534 a
SDict begin [/View [/XYZ H.V]/Dest (0:1064) cvn /DEST pdfmark end
 479 2534
a Fk(Y)-9 b(ou)20 b(can)g(use)g(PUB)i(for)d(the)h(sender)g(and)f(SUB)j
(for)d(the)h(recei)n(v)o(er)-5 b(.)19 b(This)i(will)g(correctly)d(deli)
n(v)o(er)h(your)g(messages)479 2642 y(e)o(xactly)g(as)i(you)e(sent)h
(them)f(and)g(PUB)i(does)f(not)f(load-balance)f(as)i(PUSH)h(or)e
(DEALER)h(do.)f(Ho)n(we)n(v)o(er)g(you)f(need)479 2750
y(to)j(con\002gure)d(the)i(subscriber)f(with)h(an)g(empty)f
(subscription,)g(which)g(is)i(anno)o(ying.)d(W)-7 b(orse,)20
b(the)g(reliability)g(of)g(the)479 2858 y(PUB-SUB)i(link)e(is)h(timing)
e(dependent)f(and)i(messages)g(can)g(get)g(lost)h(if)g(the)f(SUB)h
(sock)o(et)f(is)h(connecting)d(while)479 2966 y(the)i(PUB)i(sock)o(et)e
(is)h(sending)e(its)i(messages.)-2 3150 y
SDict begin H.S end
 -2 3150 a -2
3150 a
SDict begin 13 H.A end
 -2 3150 a -2 3150 a
SDict begin [/View [/XYZ H.V]/Dest (0:1065) cvn /DEST pdfmark end
 -2 3150 a 396 3240 a Fk(F)o(or)f(these)g
(reasons,)g(P)-8 b(AIR)21 b(mak)o(es)f(the)g(best)h(choice)e(for)h
(coordination)d(between)j(pairs)g(of)g(threads.)-2 3268
y
SDict begin H.S end
 -2 3268 a -2 3268 a
SDict begin 13 H.A end
 -2 3268 a -2 3268 a
SDict begin [/View [/XYZ H.V]/Dest (0:1066) cvn /DEST pdfmark end
 -2 3268 a 359
x Fn(2.20.)39 b(Node)f(Coor)m(dination)1648 3627 y
SDict begin H.S end
 1648
3627 a 1648 3627 a
SDict begin 22.464 H.A end
 1648 3627 a 1648 3627 a
SDict begin [/View [/XYZ H.V]/Dest (7.41.1) cvn /DEST pdfmark end
 1648 3627
a -2 3795 a
SDict begin H.S end
 -2 3795 a -2 3795 a
SDict begin 13 H.A end
 -2 3795 a -2 3795 a
SDict begin [/View [/XYZ H.V]/Dest (0:1068) cvn /DEST pdfmark end
 -2
3795 a 396 3901 a Fk(When)20 b(you)g(w)o(ant)g(to)g(coordinate)e
(nodes,)i(P)-8 b(AIR)21 b(sock)o(ets)f(w)o(on')o(t)f(w)o(ork)h(well)h
(an)o(y)e(more.)g(This)h(is)i(one)d(of)h(the)g(fe)n(w)396
4009 y(areas)h(where)e(the)h(strate)o(gies)g(for)g(threads)f(and)h
(nodes)g(are)g(dif)n(ferent.)e(Principally)h(nodes)h(come)f(and)h(go)g
(whereas)396 4117 y(threads)g(are)g(static.)h(P)-8 b(AIR)21
b(sock)o(ets)f(do)g(not)g(automatically)f(reconnect)f(if)j(the)f
(remote)f(node)g(goes)h(a)o(w)o(ay)g(and)g(comes)396
4225 y(back.)-2 4392 y
SDict begin H.S end
 -2 4392 a -2 4392 a
SDict begin 13 H.A end
 -2 4392 a
-2 4392 a
SDict begin [/View [/XYZ H.V]/Dest (0:1069) cvn /DEST pdfmark end
 -2 4392 a 396 4499 a Fk(The)g(second)f(signi\002cant)h(dif)n
(ference)e(between)i(threads)f(and)h(nodes)f(is)i(that)g(you)e
(typically)g(ha)n(v)o(e)h(a)h(\002x)o(ed)e(number)f(of)396
4607 y(threads)i(b)n(ut)g(a)h(more)e(v)n(ariable)g(number)f(of)i
(nodes.)g(Let')-5 b(s)20 b(tak)o(e)h(one)e(of)h(our)g(earlier)f
(scenarios)h(\(the)g(weather)f(serv)o(er)396 4715 y(and)h(clients\))g
(and)g(use)g(node)f(coordination)f(to)i(ensure)f(that)i(subscribers)e
(don')o(t)g(lose)h(data)g(when)g(starting)g(up.)-2 4899
y
SDict begin H.S end
 -2 4899 a -2 4899 a
SDict begin 13 H.A end
 -2 4899 a -2 4899 a
SDict begin [/View [/XYZ H.V]/Dest (0:1070) cvn /DEST pdfmark end
 -2 4899 a 396
4989 a Fk(This)h(is)g(ho)n(w)e(the)i(application)d(will)j(w)o(ork:)-2
5007 y
SDict begin H.S end
 -2 5007 a -2 5007 a
SDict begin 13 H.A end
 -2 5007 a -2 5007 a
SDict begin [/View [/XYZ H.V]/Dest (0:1071) cvn /DEST pdfmark end
 -2 5007
a -2 5017 a
SDict begin H.S end
 -2 5017 a -2 5017 a
SDict begin 13 H.A end
 -2 5017 a -2 5017 a
SDict begin [/View [/XYZ H.V]/Dest (0:1072) cvn /DEST pdfmark end
 -2
5017 a Black 3800 5569 a Ff(75)p Black eop end
%%Page: 76 89
TeXDict begin 76 88 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.76) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:1073) cvn /DEST pdfmark end
 479 72 a Fk(The)h(publisher)f(kno)n(ws)g
(in)i(adv)n(ance)d(ho)n(w)i(man)o(y)f(subscribers)g(it)i(e)o(xpects.)e
(This)i(is)g(just)g(a)f(magic)g(number)e(it)j(gets)479
180 y(from)e(some)n(where.)-2 181 y
SDict begin H.S end
 -2 181 a -2 181 a
SDict begin 13 H.A end

-2 181 a -2 181 a
SDict begin [/View [/XYZ H.V]/Dest (0:1074) cvn /DEST pdfmark end
 -2 181 a Black 396 330 a Fj(\225)p
Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330
a
SDict begin [/View [/XYZ H.V]/Dest (0:1075) cvn /DEST pdfmark end
 479 330 a Fk(The)h(publisher)f(starts)i(up)f(and)f(w)o(aits)j(for)d
(all)i(subscribers)e(to)h(connect.)f(This)i(is)g(the)f(node)f
(coordination)e(part.)479 438 y(Each)j(subscriber)f(subscribes)h(and)f
(then)h(tells)h(the)f(publisher)f(it')-5 b(s)21 b(ready)f(via)g
(another)e(sock)o(et.)-2 456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456
a -2 456 a
SDict begin [/View [/XYZ H.V]/Dest (0:1076) cvn /DEST pdfmark end
 -2 456 a Black 396 587 a Fj(\225)p Black 479
587 a
SDict begin H.S end
 479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:1077) cvn /DEST pdfmark end
 479 587
a Fk(When)i(the)h(publisher)d(has)j(all)f(subscribers)g(connected,)e
(it)j(starts)g(to)f(publish)f(data.)-2 771 y
SDict begin H.S end
 -2 771 a
-2 771 a
SDict begin 13 H.A end
 -2 771 a -2 771 a
SDict begin [/View [/XYZ H.V]/Dest (0:1078) cvn /DEST pdfmark end
 -2 771 a 396 861 a Fk(In)h(this)h(case)g
(we')o(ll)f(use)g(a)h(REQ-REP)g(sock)o(et)f(\003o)n(w)g(to)g
(synchronize)e(subscribers)i(and)f(publisher\()p 0 TeXcolorgray
3316 861 a
SDict begin H.S end
 3316 861 a Fk(Figure)e(2-15)3705 861 y
SDict begin 13 H.L end
 3705
861 a 3705 861 a
SDict begin [/Subtype /Link/Dest (0:figure-24) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3705 861 a Black -1 w Fk(\).)396 969
y(Here)j(is)h(the)g(publisher:)-2 987 y
SDict begin H.S end
 -2 987 a -2 987
a
SDict begin 13 H.A end
 -2 987 a -2 987 a
SDict begin [/View [/XYZ H.V]/Dest (0:syncpub-c) cvn /DEST pdfmark
end
 -2 987 a 396 1170 a Fg(Example)g(2-13.)d(Synchr)o
(onized)i(publisher)i(\(syncpub)m(.c\))-2 1270 y
SDict begin H.S end
 -2 1270
a -2 1270 a
SDict begin 11.7 H.A end
 -2 1270 a -2 1270 a
SDict begin [/View [/XYZ H.V]/Dest (0:1082) cvn /DEST pdfmark end
 -2 1270 a 396 1351 a
Fe(//)396 1448 y(//)90 b(Synchronized)42 b(publisher)396
1545 y(//)396 1642 y(#include)i("zhelpers.h")396 1836
y(//)90 b(We)44 b(wait)g(for)h(10)f(subscribers)396 1933
y(#define)g(SUBSCRIBERS_EXPECTED)86 b(10)396 2128 y(int)45
b(main)f(\(void\))396 2225 y({)576 2322 y(void)800 2335
y(*)845 2322 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
2516 y(//)89 b(Socket)44 b(to)g(talk)g(to)h(clients)576
2613 y(void)800 2626 y(*)845 2613 y(publisher)e(=)i(zmq_socket)e
(\(context,)g(ZMQ_PUB\);)576 2711 y(zmq_bind)g(\(publisher,)g("tcp://)
1832 2724 y(*)1877 2711 y(:5561"\);)576 2905 y(//)89
b(Socket)44 b(to)g(receive)g(signals)576 3002 y(void)800
3015 y(*)845 3002 y(syncservice)f(=)h(zmq_socket)f(\(context,)h
(ZMQ_REP\);)576 3099 y(zmq_bind)f(\(syncservice,)g("tcp://)1922
3112 y(*)1967 3099 y(:5562"\);)576 3293 y(//)89 b(Get)44
b(synchronization)f(from)h(subscribers)576 3390 y(printf)f(\("Waiting)h
(for)g(subscribers\\n"\);)576 3488 y(int)g(subscribers)f(=)i(0;)576
3585 y(while)f(\(subscribers)e(<)j(SUBSCRIBERS_EXPECTED\))c({)755
3682 y(//)89 b(-)45 b(wait)f(for)g(synchronization)f(request)755
3779 y(char)979 3792 y(*)1024 3779 y(string)h(=)g(s_recv)g
(\(syncservice\);)755 3876 y(free)g(\(string\);)755 3973
y(//)89 b(-)45 b(send)f(synchronization)e(reply)755 4070
y(s_send)i(\(syncservice,)e(""\);)755 4168 y(subscribers++;)576
4265 y(})576 4362 y(//)89 b(Now)44 b(broadcast)g(exactly)f(1M)i
(updates)e(followed)h(by)g(END)576 4459 y(printf)f(\("Broadcasting)g
(messages\\n"\);)576 4556 y(int)h(update_nbr;)576 4653
y(for)g(\(update_nbr)f(=)i(0;)f(update_nbr)f(<)i(1000000;)e
(update_nbr++\))755 4750 y(s_send)h(\(publisher,)f("Rhubarb"\);)576
4945 y(s_send)g(\(publisher,)g("END"\);)576 5139 y(zmq_close)g
(\(publisher\);)p Black 3798 5569 a Ff(76)p Black eop
end
%%Page: 77 90
TeXDict begin 77 89 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.77) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(zmq_close)43 b(\(syncservice\);)576
170 y(zmq_ctx_destroy)f(\(context\);)576 267 y(return)h(0;)396
364 y(})-2 372 y
SDict begin H.S end
 -2 372 a -2 372 a
SDict begin 13 H.A end
 -2 372 a -2 372 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-24) cvn /DEST pdfmark
end

-2 372 a 396 638 a Fg(Figur)o(e)20 b(2-15.)e(Pub-Sub)j(Synchr)o
(onization)-2 738 y
SDict begin H.S end
 -2 738 a -2 738 a
SDict begin 13 H.A end
 -2 738 a -2 738
a
SDict begin [/View [/XYZ H.V]/Dest (0:1085) cvn /DEST pdfmark end
 -2 738 a 396 3696 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3696 a @beginspecial 0 @llx
-350 @lly 220 @urx 0 @ury 2200 @rwi @setspecial
%%BeginDocument: images/fig24.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -350 220 0
%%HiResBoundingBox: 0.0 -350.0 220.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -94.00029754638672 lineto
198.00030517578125 -94.00029754638672 lineto
198.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -94.00029754638672 moveto
28.00029945373535 -115.00029754638672 lineto
28.00029945373535 -119.66696421305339 29.666966756184895 -122.00029754638672 33.000301361083984 -122.00029754638672 curveto
116.00029754638672 -122.00029754638672 lineto
116.00029754638672 -122.00029754638672 lineto
116.00029754638672 -94.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
120.00029754638672 -94.00029754638672 moveto
120.00029754638672 -122.00029754638672 lineto
193.00030517578125 -122.00029754638672 lineto
196.3336385091146 -122.00029754638672 198.00030517578125 -119.66696421305339 198.00030517578125 -115.00029754638672 curveto
198.00030517578125 -94.00029754638672 lineto
198.00030517578125 -94.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
33.000301361083984 -234.00030517578125 moveto
29.666966756184895 -234.00030517578125 28.00029945373535 -236.3336385091146 28.00029945373535 -241.00030517578125 curveto
28.00029945373535 -262.00030517578125 lineto
116.00029754638672 -262.00030517578125 lineto
116.00029754638672 -234.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
120.00029754638672 -234.00030517578125 moveto
120.00029754638672 -262.00030517578125 lineto
198.00030517578125 -262.00030517578125 lineto
198.00030517578125 -241.00030517578125 lineto
198.00030517578125 -236.3336385091146 196.3336385091146 -234.00030517578125 193.00030517578125 -234.00030517578125 curveto
120.00029754638672 -234.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -262.00030517578125 moveto
28.00029945373535 -318.00030517578125 lineto
198.00030517578125 -318.00030517578125 lineto
198.00030517578125 -262.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -91.0 lineto
195.0 -91.0 lineto
195.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -91.0 lineto
195.0 -91.0 lineto
195.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -91.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
113.0 -119.0 lineto
113.0 -119.0 lineto
113.0 -91.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -91.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
113.0 -119.0 lineto
113.0 -119.0 lineto
113.0 -91.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -91.0 moveto
117.0 -119.0 lineto
190.0 -119.0 lineto
193.33333333333334 -119.0 195.0 -116.66666666666667 195.0 -112.0 curveto
195.0 -91.0 lineto
195.0 -91.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -91.0 moveto
117.0 -119.0 lineto
190.0 -119.0 lineto
193.33333333333334 -119.0 195.0 -116.66666666666667 195.0 -112.0 curveto
195.0 -91.0 lineto
195.0 -91.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
30.0 -231.0 moveto
26.666666666666668 -231.0 25.0 -233.33333333333334 25.0 -238.0 curveto
25.0 -259.0 lineto
113.0 -259.0 lineto
113.0 -231.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
30.0 -231.0 moveto
26.666666666666668 -231.0 25.0 -233.33333333333334 25.0 -238.0 curveto
25.0 -259.0 lineto
113.0 -259.0 lineto
113.0 -231.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -231.0 moveto
117.0 -259.0 lineto
195.0 -259.0 lineto
195.0 -238.0 lineto
195.0 -233.33333333333334 193.33333333333334 -231.0 190.0 -231.0 curveto
117.0 -231.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -231.0 moveto
117.0 -259.0 lineto
195.0 -259.0 lineto
195.0 -238.0 lineto
195.0 -233.33333333333334 193.33333333333334 -231.0 190.0 -231.0 curveto
117.0 -231.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -259.0 moveto
25.0 -315.0 lineto
195.0 -315.0 lineto
195.0 -259.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -259.0 moveto
25.0 -315.0 lineto
195.0 -315.0 lineto
195.0 -259.0 lineto
closepath
stroke
newpath
65.0 -119.0 moveto
65.0 -217.0 lineto
stroke
newpath
175.0 -119.0 moveto
175.0 -217.0 lineto
stroke
newpath
135.0 -133.0 moveto
135.0 -231.0 lineto
stroke
newpath
135.0 -126.0 moveto
130.0 -140.0 lineto
140.0 -140.0 lineto
closepath
fill
newpath
60.0 -210.0 moveto
65.0 -224.0 lineto
70.0 -210.0 lineto
closepath
fill
newpath
170.0 -210.0 moveto
175.0 -224.0 lineto
180.0 -210.0 lineto
closepath
fill
/Helvetica findfont
15 scalefont setfont
68.0 -68.0 moveto
(Publisher) show
50.0 -110.0 moveto
(PUB) show
141.0 -110.0 moveto
(REP) show
123.0 -166.0 moveto
(\(1\)) show
53.0 -180.0 moveto
([3]) show
163.0 -194.0 moveto
(\(2\)) show
51.0 -250.0 moveto
(SUB) show
140.0 -250.0 moveto
(REQ) show
67.0 -292.0 moveto
(Subscriber) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3696 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3696 a -2 3862 a
SDict begin H.S end
 -2 3862
a -2 3862 a
SDict begin 13 H.A end
 -2 3862 a -2 3862 a
SDict begin [/View [/XYZ H.V]/Dest (0:1088) cvn /DEST pdfmark end
 -2 3862 a 396 3970 a
Fk(And)f(here)g(is)h(the)f(subscriber:)-2 3971 y
SDict begin H.S end
 -2 3971
a -2 3971 a
SDict begin 13 H.A end
 -2 3971 a -2 3971 a
SDict begin [/View [/XYZ H.V]/Dest (0:syncsub-c) cvn /DEST pdfmark
end
 -2 3971 a 396 4171 a
Fg(Example)h(2-14.)d(Synchr)o(onized)i(subscriber)h(\(syncsub)m(.c\))-2
4271 y
SDict begin H.S end
 -2 4271 a -2 4271 a
SDict begin 11.7 H.A end
 -2 4271 a -2 4271 a
SDict begin [/View [/XYZ H.V]/Dest (0:1091) cvn /DEST pdfmark end
 -2 4271
a 396 4351 a Fe(//)396 4449 y(//)90 b(Synchronized)42
b(subscriber)396 4546 y(//)396 4643 y(#include)i("zhelpers.h")396
4837 y(int)h(main)f(\(void\))396 4934 y({)576 5031 y(void)800
5044 y(*)845 5031 y(context)f(=)i(zmq_ctx_new)e(\(\);)p
Black 3797 5569 a Ff(77)p Black eop end
%%Page: 78 91
TeXDict begin 78 90 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.78) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 576 72 a Fe(//)89 b(First,)44 b(connect)f(our)i(subscriber)e
(socket)576 170 y(void)800 183 y(*)845 170 y(subscriber)g(=)h
(zmq_socket)g(\(context,)f(ZMQ_SUB\);)576 267 y(zmq_connect)g
(\(subscriber,)f("tcp://localhost:5561"\);)576 364 y(zmq_setsockopt)g
(\(subscriber,)h(ZMQ_SUBSCRIBE,)f("",)j(0\);)576 558
y(//)89 b(0MQ)44 b(is)h(so)f(fast,)g(we)h(need)f(to)g(wait)h(a)f
(while...)576 655 y(sleep)g(\(1\);)576 850 y(//)89 b(Second,)44
b(synchronize)f(with)h(publisher)576 947 y(void)800 960
y(*)845 947 y(syncclient)f(=)h(zmq_socket)g(\(context,)f(ZMQ_REQ\);)576
1044 y(zmq_connect)g(\(syncclient,)f("tcp://localhost:5562"\);)576
1238 y(//)89 b(-)45 b(send)f(a)g(synchronization)f(request)576
1335 y(s_send)g(\(syncclient,)g(""\);)576 1530 y(//)89
b(-)45 b(wait)f(for)g(synchronization)e(reply)576 1627
y(char)800 1640 y(*)845 1627 y(string)h(=)i(s_recv)f(\(syncclient\);)
576 1724 y(free)g(\(string\);)576 1918 y(//)89 b(Third,)44
b(get)g(our)g(updates)g(and)g(report)g(how)h(many)f(we)g(got)576
2015 y(int)g(update_nbr)f(=)i(0;)576 2112 y(while)f(\(true\))f({)755
2209 y(char)979 2222 y(*)1024 2209 y(string)h(=)g(s_recv)g
(\(subscriber\);)755 2307 y(if)g(\(strcmp)g(\(string,)g("END"\))f(==)i
(0\))f({)934 2404 y(free)g(\(string\);)934 2501 y(break;)755
2598 y(})755 2695 y(free)g(\(string\);)755 2792 y(update_nbr++;)576
2889 y(})576 2987 y(printf)f(\("Received)h(\045d)g(updates\\n",)f
(update_nbr\);)576 3181 y(zmq_close)g(\(subscriber\);)576
3278 y(zmq_close)g(\(syncclient\);)576 3375 y(zmq_ctx_destroy)f
(\(context\);)576 3472 y(return)h(0;)396 3569 y(})-2
3744 y
SDict begin H.S end
 -2 3744 a -2 3744 a
SDict begin 13 H.A end
 -2 3744 a -2 3744 a
SDict begin [/View [/XYZ H.V]/Dest (0:1092) cvn /DEST pdfmark end
 -2 3744
a 396 3843 a Fk(This)21 b(Linux)e(shell)h(script)h(will)f(start)h(ten)f
(subscribers)g(and)f(then)h(the)g(publisher:)-2 3944
y
SDict begin H.S end
 -2 3944 a -2 3944 a
SDict begin 11.7 H.A end
 -2 3944 a -2 3944 a
SDict begin [/View [/XYZ H.V]/Dest (0:1093) cvn /DEST pdfmark end
 -2 3944 a 396
4023 a Fe(echo)44 b("Starting)g(subscribers...")396 4121
y(for)h(a)f(in)h(1)f(2)h(3)g(4)f(5)h(6)g(7)f(8)h(9)g(10;)f(do)576
4218 y(syncsub)f(&)396 4315 y(done)396 4412 y(echo)h("Starting)g
(publisher...")396 4509 y(syncpub)-2 4687 y
SDict begin H.S end
 -2 4687 a
-2 4687 a
SDict begin 13 H.A end
 -2 4687 a -2 4687 a
SDict begin [/View [/XYZ H.V]/Dest (0:1094) cvn /DEST pdfmark end
 -2 4687 a 396 4783 a Fk(Which)20
b(gi)n(v)o(es)g(us)h(this)f(satisfying)g(output:)-2 4884
y
SDict begin H.S end
 -2 4884 a -2 4884 a
SDict begin 11.7 H.A end
 -2 4884 a -2 4884 a
SDict begin [/View [/XYZ H.V]/Dest (0:1095) cvn /DEST pdfmark end
 -2 4884 a 396
4963 a Fe(Starting)44 b(subscribers...)396 5060 y(Starting)g
(publisher...)396 5158 y(Received)g(1000000)f(updates)p
Black 3800 5569 a Ff(78)p Black eop end
%%Page: 79 92
TeXDict begin 79 91 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.79) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe(Received)44 b(1000000)f(updates)396
170 y(Received)h(1000000)f(updates)396 267 y(Received)h(1000000)f
(updates)396 364 y(Received)h(1000000)f(updates)396 461
y(Received)h(1000000)f(updates)396 558 y(Received)h(1000000)f(updates)
396 655 y(Received)h(1000000)f(updates)396 752 y(Received)h(1000000)f
(updates)396 850 y(Received)h(1000000)f(updates)-2 1027
y
SDict begin H.S end
 -2 1027 a -2 1027 a
SDict begin 13 H.A end
 -2 1027 a -2 1027 a
SDict begin [/View [/XYZ H.V]/Dest (0:1096) cvn /DEST pdfmark end
 -2 1027 a 396
1124 a Fk(W)-7 b(e)22 b(can')o(t)d(assume)h(that)g(the)g(SUB)i(connect)
d(will)i(be)f(\002nished)f(by)h(the)g(time)h(the)f(REQ/REP)h(dialog)e
(is)j(complete.)396 1231 y(There)e(are)g(no)g(guarantees)e(that)j
(outbound)c(connects)i(will)i(\002nish)f(in)h(an)o(y)e(order)g(whatsoe)
n(v)o(er)m(,)f(if)j(you')l(re)d(using)i(an)o(y)396 1339
y(transport)f(e)o(xcept)948 1339 y
SDict begin H.S end
 948 1339 a 948 1339
a
SDict begin 13 H.A end
 948 1339 a 948 1339 a
SDict begin [/View [/XYZ H.V]/Dest (0:1097) cvn /DEST pdfmark end
 948 1339 a Fe(inproc)p Fk(.)h(So,)g(the)g(e)o
(xample)f(does)h(a)h(brute-force)c(sleep)j(of)g(one)g(second)f(between)
h(subscribing,)396 1447 y(and)g(sending)f(the)h(REQ/REP)h
(synchronization.)-2 1631 y
SDict begin H.S end
 -2 1631 a -2 1631 a
SDict begin 13 H.A end
 -2 1631
a -2 1631 a
SDict begin [/View [/XYZ H.V]/Dest (0:1098) cvn /DEST pdfmark end
 -2 1631 a 396 1721 a Fk(A)g(more)e(rob)n(ust)h(model)f
(could)h(be:)-2 1722 y
SDict begin H.S end
 -2 1722 a -2 1722 a
SDict begin 13 H.A end
 -2 1722 a
-2 1722 a
SDict begin [/View [/XYZ H.V]/Dest (0:1099) cvn /DEST pdfmark end
 -2 1722 a -2 1732 a
SDict begin H.S end
 -2 1732 a -2 1732 a
SDict begin 13 H.A end
 -2
1732 a -2 1732 a
SDict begin [/View [/XYZ H.V]/Dest (0:1100) cvn /DEST pdfmark end
 -2 1732 a Black 396 1891 a Fj(\225)p
Black 479 1891 a
SDict begin H.S end
 479 1891 a 479 1891 a
SDict begin 13 H.A end
 479 1891 a 479
1891 a
SDict begin [/View [/XYZ H.V]/Dest (0:1101) cvn /DEST pdfmark end
 479 1891 a Fk(Publisher)g(opens)f(PUB)i(sock)o(et)f(and)g
(starts)h(sending)e("Hello")h(messages)g(\(not)g(data\).)-2
1909 y
SDict begin H.S end
 -2 1909 a -2 1909 a
SDict begin 13 H.A end
 -2 1909 a -2 1909 a
SDict begin [/View [/XYZ H.V]/Dest (0:1102) cvn /DEST pdfmark end
 -2 1909
a Black 396 2041 a Fj(\225)p Black 479 2041 a
SDict begin H.S end
 479 2041
a 479 2041 a
SDict begin 13 H.A end
 479 2041 a 479 2041 a
SDict begin [/View [/XYZ H.V]/Dest (0:1103) cvn /DEST pdfmark end
 479 2041 a Fk(Subscribers)f(connect)
g(SUB)j(sock)o(et)e(and)f(when)h(the)o(y)f(recei)n(v)o(e)g(a)i(Hello)f
(message)g(the)o(y)g(tell)h(the)f(publisher)f(via)h(a)479
2149 y(REQ/REP)h(sock)o(et)f(pair)-5 b(.)-2 2167 y
SDict begin H.S end
 -2
2167 a -2 2167 a
SDict begin 13 H.A end
 -2 2167 a -2 2167 a
SDict begin [/View [/XYZ H.V]/Dest (0:1104) cvn /DEST pdfmark end
 -2 2167 a Black
396 2298 a Fj(\225)p Black 479 2298 a
SDict begin H.S end
 479 2298 a 479
2298 a
SDict begin 13 H.A end
 479 2298 a 479 2298 a
SDict begin [/View [/XYZ H.V]/Dest (0:1105) cvn /DEST pdfmark end
 479 2298 a Fk(When)20 b(the)h(publisher)d
(has)j(had)e(all)i(the)f(necessary)g(con\002rmations,)e(it)j(starts)g
(to)f(send)g(real)g(data.)-2 2358 y
SDict begin H.S end
 -2 2358 a -2 2358
a
SDict begin 13 H.A end
 -2 2358 a -2 2358 a
SDict begin [/View [/XYZ H.V]/Dest (0:1106) cvn /DEST pdfmark end
 -2 2358 a 359 x Fn(2.21.)39 b(Zer)m(o)g(Cop)n(y)
1063 2717 y
SDict begin H.S end
 1063 2717 a 1063 2717 a
SDict begin 22.464 H.A end
 1063 2717 a 1063
2717 a
SDict begin [/View [/XYZ H.V]/Dest (7.42.1) cvn /DEST pdfmark end
 1063 2717 a -2 2913 a
SDict begin H.S end
 -2 2913 a -2 2913 a
SDict begin 13 H.A end
 -2 2913
a -2 2913 a
SDict begin [/View [/XYZ H.V]/Dest (0:1108) cvn /DEST pdfmark end
 -2 2913 a 396 2991 a Fk(W)-7 b(e)21 b(teased)f(you)f(in)h
(Chapter)f(One,)h(when)f(you)g(were)h(still)h(a)f(\330MQ)g(ne)n(wbie,)f
(about)g(zero-cop)o(y)-5 b(.)17 b(If)i(you)g(survi)n(v)o(ed)f(this)396
3099 y(f)o(ar)m(,)i(you)f(are)h(probably)e(ready)h(to)i(use)f(zero-cop)
o(y)-5 b(.)17 b(Ho)n(we)n(v)o(er)m(,)h(remember)h(that)h(there)g(are)g
(man)o(y)f(roads)g(to)i(Hell,)f(and)396 3207 y(premature)f
(optimization)f(is)j(not)f(the)g(most)h(enjo)o(yable)d(nor)i
(pro\002table)f(one,)g(by)h(f)o(ar)-5 b(.)20 b(T)-7 b(o)20
b(say)h(this)g(in)f(English,)f(trying)396 3315 y(to)i(do)e(zero-cop)o
(y)f(properly)g(while)i(your)f(architecture)g(is)i(not)f(perfect)f(is)i
(a)g(w)o(aste)g(of)f(time)g(and)g(will)h(mak)o(e)f(things)396
3423 y(w)o(orse,)g(not)g(better)-5 b(.)-2 3601 y
SDict begin H.S end
 -2 3601
a -2 3601 a
SDict begin 13 H.A end
 -2 3601 a -2 3601 a
SDict begin [/View [/XYZ H.V]/Dest (0:1109) cvn /DEST pdfmark end
 -2 3601 a 396 3697 a
Fk(\330MQ')g(s)21 b(message)f(API)h(lets)g(you)e(can)h(send)g(and)g
(recei)n(v)o(e)f(messages)h(directly)f(from)h(and)f(to)h(application)f
(b)n(uf)n(fers)396 3805 y(without)h(cop)o(ying)e(data.)i(Gi)n(v)o(en)f
(that)i(\330MQ)f(sends)g(messages)h(in)f(the)g(background,)d(zero-cop)o
(y)g(needs)j(some)g(e)o(xtra)396 3912 y(sauce.)-2 4079
y
SDict begin H.S end
 -2 4079 a -2 4079 a
SDict begin 13 H.A end
 -2 4079 a -2 4079 a
SDict begin [/View [/XYZ H.V]/Dest (0:1110) cvn /DEST pdfmark end
 -2 4079 a 396
4186 a Fk(T)-7 b(o)21 b(do)e(zero-cop)o(y)f(you)i(use)g
(zmq_msg_init_data[3])15 b(to)21 b(create)f(a)g(message)g(that)h
(refers)e(to)i(a)f(block)g(of)f(data)i(already)396 4294
y(allocated)f(on)g(the)g(heap)f(with)i(malloc\(\),)d(and)i(then)g(you)f
(pass)i(that)f(to)g(zmq_msg_send[3].)c(When)k(you)g(create)f(the)396
4402 y(message)h(you)g(also)g(pass)h(a)f(function)f(that)h(\330MQ)h
(will)g(call)f(to)h(free)e(the)i(block)e(of)h(data,)f(when)h(it)h(has)f
(\002nished)396 4510 y(sending)f(the)i(message.)e(This)i(is)g(the)f
(simplest)h(e)o(xample,)d(assuming)h('b)n(uf)n(fer')g(is)i(a)f(block)g
(of)g(1000)e(bytes)i(allocated)396 4618 y(on)g(the)g(heap:)-2
4719 y
SDict begin H.S end
 -2 4719 a -2 4719 a
SDict begin 11.7 H.A end
 -2 4719 a -2 4719 a
SDict begin [/View [/XYZ H.V]/Dest (0:1111) cvn /DEST pdfmark end
 -2 4719
a 396 4798 a Fe(void)44 b(my_free)g(\(void)1248 4811
y(*)1293 4798 y(data,)g(void)1786 4811 y(*)1831 4798
y(hint\))g({)576 4895 y(free)g(\(data\);)396 4993 y(})396
5090 y(//)90 b(Send)44 b(message)f(from)i(buffer,)e(which)h(we)h
(allocate)e(and)i(0MQ)f(will)g(free)g(for)g(us)p Black
3800 5569 a Ff(79)p Black eop end
%%Page: 80 93
TeXDict begin 80 92 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.80) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fe(zmq_msg_t)44 b(message;)396 170 y(zmq_msg_init_data)e
(\(&message,)h(buffer,)h(1000,)g(my_free,)g(NULL\);)396
267 y(zmq_msg_send)f(\(socket,)h(&message,)f(0\);)-2
444 y
SDict begin H.S end
 -2 444 a -2 444 a
SDict begin 13 H.A end
 -2 444 a -2 444 a
SDict begin [/View [/XYZ H.V]/Dest (0:1112) cvn /DEST pdfmark end
 -2 444 a 396
541 a Fk(There)20 b(is)h(no)f(w)o(ay)g(to)g(do)g(zero-cop)o(y)e(on)i
(recei)n(v)o(e:)f(\330MQ)h(deli)n(v)o(ers)f(you)h(a)g(b)n(uf)n(fer)f
(that)h(you)g(can)g(store)g(as)h(long)e(as)i(you)396
649 y(wish)g(b)n(ut)f(it)h(will)g(not)f(write)g(data)g(directly)g(into)
f(application)g(b)n(uf)n(fers.)-2 833 y
SDict begin H.S end
 -2 833 a -2 833
a
SDict begin 13 H.A end
 -2 833 a -2 833 a
SDict begin [/View [/XYZ H.V]/Dest (0:1113) cvn /DEST pdfmark end
 -2 833 a 396 923 a Fk(On)h(writing,)g(\330MQ')-5
b(s)21 b(multi-part)d(messages)j(w)o(ork)e(nicely)h(together)f(with)h
(zero-cop)o(y)-5 b(.)17 b(In)j(traditional)f(messaging)396
1031 y(you)h(need)f(to)h(marshal)g(dif)n(ferent)f(b)n(uf)n(fers)g
(together)f(into)i(one)g(b)n(uf)n(fer)f(that)h(you)f(can)h(send.)g
(That)g(means)g(cop)o(ying)396 1138 y(data.)g(W)m(ith)h(\330MQ,)f(you)f
(can)h(send)g(multiple)g(b)n(uf)n(fers)f(coming)f(from)i(dif)n(ferent)e
(sources)i(as)h(indi)n(vidual)d(message)396 1246 y(frames.)i(W)-7
b(e)21 b(send)f(each)g(\002eld)g(as)h(a)g(length-delimited)c(frame.)i
(T)-7 b(o)21 b(the)f(application)f(it)i(looks)e(lik)o(e)i(a)f(series)h
(of)f(send)396 1354 y(and)g(recv)g(calls.)g(But)h(internally)e(the)h
(multiple)g(parts)g(get)g(written)g(to)g(the)h(netw)o(ork)e(and)g(read)
h(back)f(with)i(single)396 1462 y(system)g(calls,)f(so)h(it')-5
b(s)21 b(v)o(ery)e(ef)n(\002cient.)-2 1491 y
SDict begin H.S end
 -2 1491
a -2 1491 a
SDict begin 13 H.A end
 -2 1491 a -2 1491 a
SDict begin [/View [/XYZ H.V]/Dest (0:1114) cvn /DEST pdfmark end
 -2 1491 a 359 x Fn(2.22.)39
b(Pub-Sub)e(Messa)o(g)q(e)h(En)-6 b(velopes)2346 1850
y
SDict begin H.S end
 2346 1850 a 2346 1850 a
SDict begin 22.464 H.A end
 2346 1850 a 2346 1850 a
SDict begin [/View [/XYZ H.V]/Dest (7.43.1) cvn /DEST pdfmark end
 2346
1850 a -2 2048 a
SDict begin H.S end
 -2 2048 a -2 2048 a
SDict begin 13 H.A end
 -2 2048 a -2 2048
a
SDict begin [/View [/XYZ H.V]/Dest (0:1116) cvn /DEST pdfmark end
 -2 2048 a 396 2124 a Fk(W)f(e')l(v)o(e)20 b(look)o(ed)f(brie\003y)h
(at)g(multi-part)f(messages.)h(Let')-5 b(s)21 b(no)n(w)f(look)f(at)i
(their)f(main)g(use-case,)f(which)h(is)3478 2124 y
SDict begin H.S end
 3478
2124 a 3478 2124 a
SDict begin 13 H.A end
 3478 2124 a 3478 2124 a
SDict begin [/View [/XYZ H.V]/Dest (0:1117) cvn /DEST pdfmark end
 3478 2124
a Ff(messa)o(g)o(e)396 2232 y(en)m(velopes)p Fk(.)f(An)h(en)m(v)o
(elope)e(is)j(a)g(w)o(ay)f(of)g(safely)g(packaging)e(up)i(data)g(with)g
(an)g(address,)g(without)f(touching)f(the)j(data)396
2340 y(itself.)-2 2506 y
SDict begin H.S end
 -2 2506 a -2 2506 a
SDict begin 13 H.A end
 -2 2506
a -2 2506 a
SDict begin [/View [/XYZ H.V]/Dest (0:1118) cvn /DEST pdfmark end
 -2 2506 a 396 2614 a Fk(In)f(the)g(pub-sub)f(pattern,)g
(the)h(en)m(v)o(elope)e(at)i(least)h(holds)f(the)g(subscription)f(k)o
(e)o(y)h(for)f(\002ltering)h(b)n(ut)g(you)f(can)h(also)h(add)396
2721 y(the)f(sender)g(identity)f(in)i(the)f(en)m(v)o(elope.)-2
2906 y
SDict begin H.S end
 -2 2906 a -2 2906 a
SDict begin 13 H.A end
 -2 2906 a -2 2906 a
SDict begin [/View [/XYZ H.V]/Dest (0:1119) cvn /DEST pdfmark end
 -2 2906
a 396 2995 a Fk(If)g(you)g(w)o(ant)g(to)g(use)h(pub-sub)d(en)m(v)o
(elopes,)g(you)h(mak)o(e)h(them)g(yourself.)e(It')-5
b(s)21 b(optional,)e(and)g(in)i(pre)n(vious)d(pub-sub)396
3103 y(e)o(xamples)h(we)i(didn')o(t)e(do)g(this.)i(Using)f(a)g(pub-sub)
f(en)m(v)o(elope)f(is)j(a)f(little)h(more)f(w)o(ork)f(for)h(simple)g
(cases)h(b)n(ut)f(it')-5 b(s)396 3211 y(cleaner)20 b(especially)f(for)h
(real)g(cases,)h(where)e(the)i(k)o(e)o(y)e(and)h(the)g(data)g(are)g
(naturally)f(separate)h(things.)f(It')-5 b(s)21 b(also)g(f)o(aster)m(,)
396 3319 y(if)g(you)e(are)h(writing)g(the)g(data)g(directly)f(from)h
(an)g(application)e(b)n(uf)n(fer)-5 b(.)-2 3503 y
SDict begin H.S end
 -2
3503 a -2 3503 a
SDict begin 13 H.A end
 -2 3503 a -2 3503 a
SDict begin [/View [/XYZ H.V]/Dest (0:1120) cvn /DEST pdfmark end
 -2 3503 a 396 3593
a Fk(Here)20 b(is)h(what)g(a)f(publish-subscribe)e(message)i(with)g(an)
g(en)m(v)o(elope)e(looks)i(lik)o(e:)-2 3611 y
SDict begin H.S end
 -2 3611
a -2 3611 a
SDict begin 13 H.A end
 -2 3611 a -2 3611 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-25) cvn /DEST pdfmark
end
 -2 3611 a 396 3795 a
Fg(Figur)o(e)g(2-16.)e(Pub-Sub)j(En)m(v)o(elope)f(with)h(Separate)e(K)n
(ey)-2 3894 y
SDict begin H.S end
 -2 3894 a -2 3894 a
SDict begin 13 H.A end
 -2 3894 a -2 3894 a
SDict begin [/View [/XYZ H.V]/Dest (0:1123) cvn /DEST pdfmark end

-2 3894 a 396 4536 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4536 a @beginspecial 0 @llx
-72 @lly 318 @urx 0 @ury 3180 @rwi @setspecial
%%BeginDocument: images/fig25.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -72 318 0
%%HiResBoundingBox: 0.0 -72.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -21.800180435180664 moveto
76.80017852783203 -35.80017852783203 lineto
160.80018615722656 -35.80017852783203 lineto
160.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -38.80017852783203 moveto
76.80017852783203 -53.80017852783203 lineto
160.80018615722656 -53.80017852783203 lineto
160.80018615722656 -38.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
159.0 -34.0 lineto
159.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
159.0 -34.0 lineto
159.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -52.0 lineto
159.0 -52.0 lineto
159.0 -37.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -52.0 lineto
159.0 -52.0 lineto
159.0 -37.0 lineto
closepath
stroke
/Helvetica findfont
8 scalefont setfont
15.0 -31.0 moveto
(Frame 1) show
85.0 -31.0 moveto
(Key) show
201.0 -31.0 moveto
(Subscription key) show
15.0 -47.0 moveto
(Frame 2) show
86.0 -47.0 moveto
(Data) show
201.0 -47.0 moveto
(Actual message body) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4536 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4536 a -2 4702 a
SDict begin H.S end
 -2 4702
a -2 4702 a
SDict begin 13 H.A end
 -2 4702 a -2 4702 a
SDict begin [/View [/XYZ H.V]/Dest (0:1126) cvn /DEST pdfmark end
 -2 4702 a 396 4810 a
Fk(Recall)i(that)f(pub-sub)f(matches)g(messages)i(based)f(on)f(the)i
(pre\002x.)e(Putting)g(the)i(k)o(e)o(y)e(into)h(a)h(separate)f(frame)f
(mak)o(es)396 4918 y(the)h(matching)f(v)o(ery)g(ob)o(vious,)f(since)j
(there)f(is)h(no)e(chance)h(an)g(application)f(will)h(accidentally)f
(match)h(on)g(part)g(of)g(the)396 5026 y(data.)p Black
3800 5569 a Ff(80)p Black eop end
%%Page: 81 94
TeXDict begin 81 93 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.81) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1127) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Here)h(is)h(a)g(minimalist)f(e)o(xample)f(of)h(ho)n
(w)f(pub-sub)g(en)m(v)o(elopes)f(look)h(in)i(code.)e(This)h(publisher)f
(sends)h(messages)h(of)396 180 y(tw)o(o)g(types,)e(A)i(and)f(B.)h(The)f
(en)m(v)o(elope)d(holds)j(the)g(message)g(type:)-2 198
y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:psenvpub-c) cvn /DEST pdfmark
end
 -2 198 a 396 382
a Fg(Example)h(2-15.)d(Pub-Sub)j(en)m(v)o(elope)f(publisher)h(\(psen)m
(vpub)m(.c\))-2 482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482
a
SDict begin [/View [/XYZ H.V]/Dest (0:1130) cvn /DEST pdfmark end
 -2 482 a 396 562 a Fe(//)396 659 y(//)90 b(Pubsub)43
b(envelope)h(publisher)396 756 y(//)90 b(Note)44 b(that)g(the)g
(zhelpers.h)f(file)i(also)f(provides)f(s_sendmore)396
853 y(//)396 950 y(#include)h("zhelpers.h")396 1145 y(int)h(main)f
(\(void\))396 1242 y({)576 1339 y(//)89 b(Prepare)44
b(our)g(context)g(and)g(publisher)576 1436 y(void)800
1449 y(*)845 1436 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
1533 y(void)800 1546 y(*)845 1533 y(publisher)g(=)i(zmq_socket)e
(\(context,)g(ZMQ_PUB\);)576 1630 y(zmq_bind)g(\(publisher,)g("tcp://)
1832 1643 y(*)1877 1630 y(:5563"\);)576 1825 y(while)h(\(true\))f({)755
1922 y(//)89 b(Write)44 b(two)h(messages,)e(each)h(with)g(an)h
(envelope)e(and)i(content)755 2019 y(s_sendmore)e(\(publisher,)g
("A"\);)755 2116 y(s_send)h(\(publisher,)f("We)h(don't)g(want)g(to)h
(see)f(this"\);)755 2213 y(s_sendmore)f(\(publisher,)g("B"\);)755
2310 y(s_send)h(\(publisher,)f("We)h(would)g(like)g(to)h(see)f
(this"\);)755 2407 y(sleep)g(\(1\);)576 2505 y(})576
2602 y(//)89 b(We)44 b(never)g(get)h(here)f(but)g(clean)g(up)h(anyhow)
576 2699 y(zmq_close)e(\(publisher\);)576 2796 y(zmq_ctx_destroy)f
(\(context\);)576 2893 y(return)h(0;)396 2990 y(})-2
3165 y
SDict begin H.S end
 -2 3165 a -2 3165 a
SDict begin 13 H.A end
 -2 3165 a -2 3165 a
SDict begin [/View [/XYZ H.V]/Dest (0:1131) cvn /DEST pdfmark end
 -2 3165
a 396 3264 a Fk(The)20 b(subscriber)f(only)g(w)o(ants)i(messages)f(of)g
(type)g(B:)-2 3282 y
SDict begin H.S end
 -2 3282 a -2 3282 a
SDict begin 13 H.A end
 -2 3282 a -2
3282 a
SDict begin [/View [/XYZ H.V]/Dest (0:psenvsub-c) cvn /DEST pdfmark
end
 -2 3282 a 396 3466 a Fg(Example)h(2-16.)d(Pub-Sub)j(en)m(v)o
(elope)f(subscriber)h(\(psen)m(vsub)m(.c\))-2 3565 y
SDict begin H.S end

-2 3565 a -2 3565 a
SDict begin 11.7 H.A end
 -2 3565 a -2 3565 a
SDict begin [/View [/XYZ H.V]/Dest (0:1134) cvn /DEST pdfmark end
 -2 3565 a 396
3646 a Fe(//)396 3743 y(//)90 b(Pubsub)43 b(envelope)h(subscriber)396
3840 y(//)396 3937 y(#include)g("zhelpers.h")396 4131
y(int)h(main)f(\(void\))396 4229 y({)576 4326 y(//)89
b(Prepare)44 b(our)g(context)g(and)g(subscriber)576 4423
y(void)800 4436 y(*)845 4423 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
4520 y(void)800 4533 y(*)845 4520 y(subscriber)g(=)h(zmq_socket)g
(\(context,)f(ZMQ_SUB\);)576 4617 y(zmq_connect)g(\(subscriber,)f
("tcp://localhost:5563"\);)576 4714 y(zmq_setsockopt)g(\(subscriber,)h
(ZMQ_SUBSCRIBE,)f("B",)j(1\);)576 4909 y(while)f(\(true\))f({)755
5006 y(//)89 b(Read)44 b(envelope)g(with)g(address)755
5103 y(char)979 5116 y(*)1024 5103 y(address)g(=)g(s_recv)g
(\(subscriber\);)p Black 3800 5569 a Ff(81)p Black eop
end
%%Page: 82 95
TeXDict begin 82 94 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.82) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 755 72 a Fe(//)89 b(Read)44 b(message)g(contents)755
170 y(char)979 183 y(*)1024 170 y(contents)f(=)i(s_recv)f
(\(subscriber\);)755 267 y(printf)g(\("[\045s])g(\045s\\n",)f(address,)
h(contents\);)755 364 y(free)g(\(address\);)755 461 y(free)g
(\(contents\);)576 558 y(})576 655 y(//)89 b(We)44 b(never)g(get)h
(here)f(but)g(clean)g(up)h(anyhow)576 752 y(zmq_close)e
(\(subscriber\);)576 850 y(zmq_ctx_destroy)f(\(context\);)576
947 y(return)h(0;)396 1044 y(})-2 1218 y
SDict begin H.S end
 -2 1218 a -2
1218 a
SDict begin 13 H.A end
 -2 1218 a -2 1218 a
SDict begin [/View [/XYZ H.V]/Dest (0:1135) cvn /DEST pdfmark end
 -2 1218 a 396 1318 a Fk(When)20
b(you)g(run)f(the)h(tw)o(o)h(programs,)d(the)i(subscriber)f(should)g
(sho)n(w)h(you)f(this:)-2 1419 y
SDict begin H.S end
 -2 1419 a -2 1419 a
SDict begin 11.7 H.A end

-2 1419 a -2 1419 a
SDict begin [/View [/XYZ H.V]/Dest (0:1136) cvn /DEST pdfmark end
 -2 1419 a 396 1498 a Fe([B])45 b(We)f(would)g(like)
g(to)h(see)f(this)396 1595 y([B])h(We)f(would)g(like)g(to)h(see)f(this)
396 1692 y([B])h(We)f(would)g(like)g(to)h(see)f(this)396
1789 y([B])h(We)f(would)g(like)g(to)h(see)f(this)396
1887 y(...)-2 2054 y
SDict begin H.S end
 -2 2054 a -2 2054 a
SDict begin 13 H.A end
 -2 2054 a -2
2054 a
SDict begin [/View [/XYZ H.V]/Dest (0:1137) cvn /DEST pdfmark end
 -2 2054 a 396 2160 a Fk(This)21 b(e)o(xamples)e(sho)n(ws)h(that)
g(the)g(subscription)f(\002lter)i(rejects)f(or)g(accepts)g(the)g
(entire)g(multi-part)f(message)h(\(k)o(e)o(y)f(plus)396
2268 y(data\).)h(Y)-9 b(ou)19 b(w)o(on')o(t)g(get)i(part)f(of)f(a)i
(multi-part)e(message,)h(e)n(v)o(er)-5 b(.)-2 2452 y
SDict begin H.S end

-2 2452 a -2 2452 a
SDict begin 13 H.A end
 -2 2452 a -2 2452 a
SDict begin [/View [/XYZ H.V]/Dest (0:1138) cvn /DEST pdfmark end
 -2 2452 a 396
2542 a Fk(If)20 b(you)g(subscribe)f(to)h(multiple)g(publishers)f(and)h
(you)f(w)o(ant)h(to)g(kno)n(w)g(their)g(identity)f(so)i(that)f(you)f
(can)h(send)g(them)396 2650 y(data)g(via)h(another)d(sock)o(et)i(\(and)
g(this)g(is)h(a)g(f)o(airly)f(typical)g(use-case\),)f(you)g(create)h(a)
h(three-part)d(message:)-2 2668 y
SDict begin H.S end
 -2 2668 a -2 2668 a
SDict begin 13 H.A end

-2 2668 a -2 2668 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-26) cvn /DEST pdfmark
end
 -2 2668 a 396 2852 a Fg(Figur)o(e)i(2-17.)e
(Pub-Sub)j(En)m(v)o(elope)f(with)h(Sender)g(Addr)o(ess)-2
2952 y
SDict begin H.S end
 -2 2952 a -2 2952 a
SDict begin 13 H.A end
 -2 2952 a -2 2952 a
SDict begin [/View [/XYZ H.V]/Dest (0:1141) cvn /DEST pdfmark end
 -2 2952
a 396 3726 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3726 a @beginspecial 0 @llx -88 @lly
324 @urx 0 @ury 3240 @rwi @setspecial
%%BeginDocument: images/fig26.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -88 324 0
%%HiResBoundingBox: 0.0 -88.0 324.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -21.800180435180664 moveto
76.80017852783203 -35.80017852783203 lineto
160.80018615722656 -35.80017852783203 lineto
160.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -38.80017852783203 moveto
76.80017852783203 -51.80017852783203 lineto
160.80018615722656 -51.80017852783203 lineto
160.80018615722656 -38.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -54.80017852783203 moveto
76.80017852783203 -69.80017852783203 lineto
160.80018615722656 -69.80017852783203 lineto
160.80018615722656 -54.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
159.0 -34.0 lineto
159.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
159.0 -34.0 lineto
159.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
159.0 -50.0 lineto
159.0 -37.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
159.0 -50.0 lineto
159.0 -37.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
159.0 -68.0 lineto
159.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
159.0 -68.0 lineto
159.0 -53.0 lineto
closepath
stroke
/Helvetica findfont
8 scalefont setfont
15.0 -31.0 moveto
(Frame 1) show
85.0 -31.0 moveto
(Key) show
201.0 -31.0 moveto
(Subscription key) show
15.0 -47.0 moveto
(Frame 2) show
90.0 -47.0 moveto
(Identity) show
204.0 -47.0 moveto
(Address of publisher) show
15.0 -63.0 moveto
(Frame 3) show
86.0 -63.0 moveto
(Data) show
201.0 -63.0 moveto
(Actual message body) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3726 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3726 a -2 3809 a
SDict begin H.S end
 -2 3809
a -2 3809 a
SDict begin 13 H.A end
 -2 3809 a -2 3809 a
SDict begin [/View [/XYZ H.V]/Dest (0:1144) cvn /DEST pdfmark end
 -2 3809 a 378 x Fn(2.23.)39
b(High)f(W)-6 b(ater)40 b(Marks)1564 4187 y
SDict begin H.S end
 1564 4187
a 1564 4187 a
SDict begin 22.464 H.A end
 1564 4187 a 1564 4187 a
SDict begin [/View [/XYZ H.V]/Dest (7.44.1) cvn /DEST pdfmark end
 1564 4187 a -2
4384 a
SDict begin H.S end
 -2 4384 a -2 4384 a
SDict begin 13 H.A end
 -2 4384 a -2 4384 a
SDict begin [/View [/XYZ H.V]/Dest (0:1146) cvn /DEST pdfmark end
 -2 4384
a 396 4460 a Fk(When)20 b(you)g(can)g(send)f(messages)i(rapidly)e(from)
g(process)h(to)g(process,)f(you)h(soon)f(disco)o(v)o(er)g(that)h
(memory)f(is)i(a)396 4568 y(precious)e(resource,)f(and)i(one)f(that')-5
b(s)21 b(tri)n(vially)e(\002lled)h(up.)f(A)i(fe)n(w)f(seconds)f(delay)g
(some)n(where)g(in)h(a)g(process)g(can)f(turn)396 4676
y(into)h(a)h(backlog)d(that)j(blo)n(ws)f(up)f(a)i(serv)o(er)m(,)e
(unless)h(you)f(understand)g(the)h(problem)e(and)i(tak)o(e)g
(precautions.)-2 4860 y
SDict begin H.S end
 -2 4860 a -2 4860 a
SDict begin 13 H.A end
 -2 4860 a
-2 4860 a
SDict begin [/View [/XYZ H.V]/Dest (0:1147) cvn /DEST pdfmark end
 -2 4860 a 396 4950 a Fk(The)f(problem)d(is)k(this:)f(if)g
(you)f(ha)n(v)o(e)g(process)g(A)h(sending)f(messages)g(to)h(process)f
(B,)i(which)e(suddenly)f(gets)i(v)o(ery)e(b)n(usy)396
5058 y(\(garbage)h(collection,)h(CPU)i(o)o(v)o(erload,)d(whate)n(v)o
(er\),)g(then)i(what)g(happens)e(to)j(the)f(messages)g(that)h(process)e
(A)i(w)o(ants)396 5166 y(to)g(send?)e(Some)h(will)h(sit)g(in)g(B')-5
b(s)21 b(netw)o(ork)e(b)n(uf)n(fers.)g(Some)h(will)h(sit)g(on)f(the)g
(Ethernet)f(wire)h(itself.)h(Some)f(will)h(sit)g(in)p
Black 3800 5569 a Ff(82)p Black eop end
%%Page: 83 96
TeXDict begin 83 95 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.83) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(A)-9 b(')k(s)21 b(netw)o(ork)e(b)n(uf)n(fers.)g(And)h
(the)g(rest)h(will)f(accumulate)f(in)i(A)-9 b(')k(s)21
b(memory)-5 b(.)17 b(If)j(you)g(don')o(t)e(tak)o(e)i(some)g
(precaution,)e(A)396 180 y(can)i(easily)h(run)e(out)h(of)g(memory)e
(and)i(crash.)g(It)g(is)h(a)g(consistent,)e(classic)j(problem)c(with)i
(message)g(brok)o(ers.)-2 364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2
364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:1148) cvn /DEST pdfmark end
 -2 364 a 396 454 a Fk(What)h(are)f(the)g(answers?)g(One)
g(is)h(to)g(pass)f(the)h(problem)d(upstream.)h(A)i(is)g(getting)e(the)h
(messages)h(from)e(some)n(where)396 562 y(else.)i(So)f(tell)h(that)f
(process,)g("stop!")f(And)h(so)h(on.)e(This)i(is)g(called)f("\003o)n(w)
g(control".)f(It)h(sounds)f(great,)h(b)n(ut)g(what)g(if)396
670 y(you')l(re)f(sending)g(out)g(a)i(T)-7 b(witter)21
b(feed?)e(Do)h(you)g(tell)g(the)h(whole)e(w)o(orld)h(to)g(stop)g
(tweeting)g(while)g(B)h(gets)g(its)g(act)396 778 y(together?)-2
962 y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:1149) cvn /DEST pdfmark end
 -2 962 a 396
1052 a Fk(Flo)n(w)g(control)e(w)o(orks)g(in)i(some)f(cases)h(b)n(ut)f
(in)g(others,)g(the)g(transport)f(layer)g(can')o(t)h(tell)h(the)f
(application)e(layer)i("stop")396 1160 y(an)o(y)g(more)f(than)h(a)g
(subw)o(ay)g(system)g(can)g(tell)h(a)g(lar)o(ge)e(b)n(usiness,)h
("please)g(k)o(eep)g(your)f(staf)n(f)h(at)h(w)o(ork)e(another)g(half)h
(an)396 1268 y(hour)m(,)f(I'm)g(too)h(b)n(usy".)-2 1452
y
SDict begin H.S end
 -2 1452 a -2 1452 a
SDict begin 13 H.A end
 -2 1452 a -2 1452 a
SDict begin [/View [/XYZ H.V]/Dest (0:1150) cvn /DEST pdfmark end
 -2 1452 a 396
1542 a Fk(The)g(answer)g(for)g(messaging)f(is)i(to)f(set)h(limits)g(on)
f(the)g(size)h(of)f(b)n(uf)n(fers,)f(and)h(then)f(when)h(we)g(reach)g
(those)g(limits,)396 1650 y(tak)o(e)h(some)f(sensible)g(action.)f(In)h
(most)g(cases)h(\(not)f(for)f(a)i(subw)o(ay)e(system,)i(though\),)c
(the)k(answer)e(is)j(to)e(thro)n(w)f(a)o(w)o(ay)396 1758
y(messages.)h(In)g(a)h(fe)n(w)f(others,)f(it')-5 b(s)22
b(to)e(w)o(ait.)-2 1942 y
SDict begin H.S end
 -2 1942 a -2 1942 a
SDict begin 13 H.A end
 -2 1942
a -2 1942 a
SDict begin [/View [/XYZ H.V]/Dest (0:1151) cvn /DEST pdfmark end
 -2 1942 a 396 2032 a Fk(\330MQ)h(uses)f(the)h(concept)e(of)
g("high)h(w)o(ater)g(mark")f(or)h(HWM)h(to)f(de\002ne)g(the)g(capacity)
g(of)g(its)h(internal)e(pipes.)h(Each)396 2140 y(connection)e(out)i(of)
g(a)h(sock)o(et)f(or)g(into)g(a)g(sock)o(et)g(has)h(its)g(o)n(wn)f
(pipe,)f(and)h(HWM)h(capacity)-5 b(.)-2 2324 y
SDict begin H.S end
 -2 2324
a -2 2324 a
SDict begin 13 H.A end
 -2 2324 a -2 2324 a
SDict begin [/View [/XYZ H.V]/Dest (0:1152) cvn /DEST pdfmark end
 -2 2324 a 396 2414 a
Fk(In)20 b(\330MQ/2.x)f(the)i(HWM)g(w)o(as)g(set)g(to)f(in\002nite)g
(by)g(def)o(ault.)f(In)h(\330MQ/3.x)f(it')-5 b(s)21 b(set)g(to)g(1,000)
d(by)i(def)o(ault,)f(which)h(is)396 2522 y(more)g(sensible.)g(If)g
(you')l(re)e(still)j(using)f(\330MQ/2.x)f(you)h(should)f(al)o(w)o(ays)h
(set)h(a)g(HWM)g(on)f(your)f(sock)o(ets,)h(be)g(it)h(1,000)396
2630 y(to)g(match)e(\330MQ/3.x)h(or)f(another)g(\002gure)h(that)g(tak)o
(es)g(into)g(account)f(your)g(message)h(sizes.)-2 2814
y
SDict begin H.S end
 -2 2814 a -2 2814 a
SDict begin 13 H.A end
 -2 2814 a -2 2814 a
SDict begin [/View [/XYZ H.V]/Dest (0:1153) cvn /DEST pdfmark end
 -2 2814 a 396
2904 a Fk(The)g(high)f(w)o(ater)h(mark)f(af)n(fects)h(both)f(the)h
(transmit)g(and)f(recei)n(v)o(e)g(b)n(uf)n(fers)g(of)h(a)g(single)g
(sock)o(et.)g(Some)f(sock)o(ets)h(\(PUB,)396 3011 y(PUSH\))h(only)e(ha)
n(v)o(e)h(transmit)g(b)n(uf)n(fers.)f(Some)g(\(SUB,)i(PULL,)f(REQ,)h
(REP\))f(only)g(ha)n(v)o(e)f(recei)n(v)o(e)g(b)n(uf)n(fers.)g(Some)396
3119 y(\(DEALER,)h(R)m(OUTER,)g(P)-8 b(AIR\))21 b(ha)n(v)o(e)f(both)f
(transmit)h(and)g(recei)n(v)o(e)f(b)n(uf)n(fers.)-2 3300
y
SDict begin H.S end
 -2 3300 a -2 3300 a
SDict begin 13 H.A end
 -2 3300 a -2 3300 a
SDict begin [/View [/XYZ H.V]/Dest (0:1154) cvn /DEST pdfmark end
 -2 3300 a 396
3393 a Fk(When)h(your)f(sock)o(et)h(reaches)g(its)h(high-w)o(ater)e
(mark,)g(it)i(will)g(either)e(block)h(or)g(drop)f(data)h(depending)d
(on)j(the)g(sock)o(et)396 3501 y(type.)f(PUB)i(sock)o(ets)f(will)h
(drop)e(data)h(if)g(the)o(y)f(reach)g(their)h(high-w)o(ater)e(mark,)h
(while)h(other)f(sock)o(et)h(types)f(will)i(block.)-2
3685 y
SDict begin H.S end
 -2 3685 a -2 3685 a
SDict begin 13 H.A end
 -2 3685 a -2 3685 a
SDict begin [/View [/XYZ H.V]/Dest (0:1155) cvn /DEST pdfmark end
 -2 3685
a 396 3775 a Fk(Ov)o(er)f(the)704 3775 y
SDict begin H.S end
 704 3775 a 704
3775 a
SDict begin 13 H.A end
 704 3775 a 704 3775 a
SDict begin [/View [/XYZ H.V]/Dest (0:1156) cvn /DEST pdfmark end
 704 3775 a Fe(inproc)g Fk(transport,)e
(the)j(sender)e(and)h(recei)n(v)o(er)e(share)i(the)h(same)f(b)n(uf)n
(fers,)f(so)h(the)h(real)f(HWM)h(is)g(the)f(sum)396 3883
y(of)g(the)g(HWM)h(set)f(by)g(both)f(sides.)i(This)f(means)f(in)i(ef)n
(fect)e(that)h(if)g(one)g(side)g(does)g(not)g(set)g(a)h(HWM,)f(there)g
(is)h(no)e(limit)396 3991 y(to)i(the)f(b)n(uf)n(fer)f(size.)-2
4002 y
SDict begin H.S end
 -2 4002 a -2 4002 a
SDict begin 13 H.A end
 -2 4002 a -2 4002 a
SDict begin [/View [/XYZ H.V]/Dest (0:1157) cvn /DEST pdfmark end
 -2 4002
a 377 x Fn(2.24.)39 b(A)g(Bare)g(Necessity)1531 4379
y
SDict begin H.S end
 1531 4379 a 1531 4379 a
SDict begin 22.464 H.A end
 1531 4379 a 1531 4379 a
SDict begin [/View [/XYZ H.V]/Dest (7.45.1) cvn /DEST pdfmark end
 1531
4379 a -2 4574 a
SDict begin H.S end
 -2 4574 a -2 4574 a
SDict begin 13 H.A end
 -2 4574 a -2 4574
a
SDict begin [/View [/XYZ H.V]/Dest (0:1159) cvn /DEST pdfmark end
 -2 4574 a 396 4653 a Fk(\330MQ)21 b(is)g(lik)o(e)f(a)h(box)e(of)h
(pieces)g(that)h(plug)e(together)m(,)f(the)i(only)g(limitation)g(being)
f(your)g(imagination)f(and)i(sobriety)-5 b(.)-2 4837
y
SDict begin H.S end
 -2 4837 a -2 4837 a
SDict begin 13 H.A end
 -2 4837 a -2 4837 a
SDict begin [/View [/XYZ H.V]/Dest (0:1160) cvn /DEST pdfmark end
 -2 4837 a 396
4927 a Fk(The)20 b(scalable)g(elastic)h(architecture)e(you)g(get)h
(should)f(be)i(an)f(e)o(ye-opener)-5 b(.)17 b(Y)-9 b(ou)20
b(might)f(need)h(a)g(cof)n(fee)f(or)h(tw)o(o)h(\002rst.)396
5034 y(Don')o(t)e(mak)o(e)h(the)g(mistak)o(e)g(I)h(made)e(once)h(and)f
(b)n(uy)h(e)o(xotic)g(German)f(cof)n(fee)g(labeled)2917
5034 y
SDict begin H.S end
 2917 5034 a 2917 5034 a
SDict begin 13 H.A end
 2917 5034 a 2917 5034
a
SDict begin [/View [/XYZ H.V]/Dest (0:1161) cvn /DEST pdfmark end
 2917 5034 a Ff(Entk)o(of)o(feiniert)q Fk(.)h(That)g(does)f(not)396
5142 y(mean)h("Delicious".)f(Scalable)h(elastic)h(architectures)e(are)h
(not)g(a)h(ne)n(w)f(idea)g(-)2675 5142 y
SDict begin H.S end
 2675 5142 a
2675 5142 a
SDict begin 13 H.A end
 2675 5142 a 2675 5142 a
SDict begin [/View [/XYZ H.V]/Dest (0:1162) cvn /DEST pdfmark end
 2675 5142 a Fk(\003o)n(w-based)f
(programming)p Black 3800 5569 a Ff(83)p Black eop end
%%Page: 84 97
TeXDict begin 84 96 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.84) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2899 -132 a Ff(Chapter)20 b(2.)g(Intermediate)f(Stuf)o(f)p
Black 396 72 a Fk(\(http://en.wikipedia.or)o(g/wiki/Flo)n(w-b)o(ased_)o
(pro)o(gr)o(amm)o(ing)o(\))c(and)k(languages)g(lik)o(e)2938
72 y
SDict begin H.S end
 2938 72 a 2938 72 a
SDict begin 13 H.A end
 2938 72 a 2938 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:1163) cvn /DEST pdfmark end
 2938 72
a Fk(Erlang)396 180 y(\(http://www)-5 b(.erlang.or)o(g/\))15
b(already)k(w)o(ork)o(ed)h(lik)o(e)g(this)h(-)f(b)n(ut)g(\330MQ)h(mak)o
(es)f(it)h(easier)f(to)g(use)h(than)f(e)n(v)o(er)f(before.)-2
364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:1164) cvn /DEST pdfmark end
 -2 364 a 396
454 a Fk(As)509 454 y
SDict begin H.S end
 509 454 a 509 454 a
SDict begin 13 H.A end
 509 454 a 509
454 a
SDict begin [/View [/XYZ H.V]/Dest (0:1165) cvn /DEST pdfmark end
 509 454 a Fk(Gonzo)g(Diethelm)h(said)h
(\(http://permalink.gmane.or)n(g)o(/gma)o(ne.n)o(etw)o(or)o(k.)o(zero)o
(mq)o(.de)n(v)n(el/2)o(14)o(5\),)14 b(')3460 454 y
SDict begin H.S end
 3460
454 a 3460 454 a
SDict begin 13 H.A end
 3460 454 a 3460 454 a
SDict begin [/View [/XYZ H.V]/Dest (0:1166) cvn /DEST pdfmark end
 3460 454 a Ff(My)20
b(gut)396 562 y(feeling)g(is)h(summarized)f(in)g(this)h(sentence:)e
("if)i(\330MQ)g(didn')n(t)e(e)n(xist,)i(it)g(would)e(be)h(necessary)h
(to)f(in)m(vent)f(it".)i(Meaning)396 670 y(that)f(I)h(r)o(an)e(into)h
(\330MQ)h(after)g(year)o(s)f(of)h(br)o(ain-bac)n(kgr)l(ound)16
b(pr)l(ocessing)o(,)k(and)f(it)i(made)f(instant)f(sense)o(...)h(\330MQ)
396 778 y(simply)h(seems)g(to)f(me)h(a)f("bar)m(e)g(necessity")g
(nowadays.)p Fk(')p Black 3800 5569 a Ff(84)p Black eop
end
%%Page: 85 98
TeXDict begin 85 97 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.85) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:1167) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(3.)f(Ad)m(v)m(anced)h(Request-Repl)m
(y)h(P)-5 b(atterns)3687 115 y
SDict begin H.S end
 3687 115 a 3687 115 a
SDict begin 26.957 H.A end

3687 115 a 3687 115 a
SDict begin [/View [/XYZ H.V]/Dest (8.0) cvn /DEST pdfmark end
 3687 115 a -2 371 a
SDict begin H.S end
 -2 371 a -2
371 a
SDict begin 13 H.A end
 -2 371 a -2 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:1169) cvn /DEST pdfmark end
 -2 371 a 396 443 a Fk(In)20 b(Chapter)g(T)-7
b(w)o(o)20 b(we)h(w)o(ork)o(ed)e(through)f(the)i(basics)h(of)f(using)f
(\330MQ)i(by)f(de)n(v)o(eloping)d(a)k(series)f(of)g(small)396
551 y(applications,)f(each)h(time)g(e)o(xploring)e(ne)n(w)i(aspects)g
(of)g(\330MQ.)h(W)-7 b(e')o(ll)21 b(continue)e(this)h(approach)e(in)j
(this)f(chapter)m(,)f(as)396 659 y(we)i(e)o(xplore)d(adv)n(anced)g
(patterns)i(b)n(uilt)g(on)g(top)g(of)g(\330MQ')-5 b(s)21
b(core)e(request-reply)f(pattern.)-2 843 y
SDict begin H.S end
 -2 843 a -2
843 a
SDict begin 13 H.A end
 -2 843 a -2 843 a
SDict begin [/View [/XYZ H.V]/Dest (0:1170) cvn /DEST pdfmark end
 -2 843 a 396 933 a Fk(W)-7 b(e')o(ll)22
b(co)o(v)o(er:)-2 934 y
SDict begin H.S end
 -2 934 a -2 934 a
SDict begin 13 H.A end
 -2 934 a -2
934 a
SDict begin [/View [/XYZ H.V]/Dest (0:1171) cvn /DEST pdfmark end
 -2 934 a -2 944 a
SDict begin H.S end
 -2 944 a -2 944 a
SDict begin 13 H.A end
 -2 944 a -2
944 a
SDict begin [/View [/XYZ H.V]/Dest (0:1172) cvn /DEST pdfmark end
 -2 944 a Black 396 1103 a Fj(\225)p Black 479 1103
a
SDict begin H.S end
 479 1103 a 479 1103 a
SDict begin 13 H.A end
 479 1103 a 479 1103 a
SDict begin [/View [/XYZ H.V]/Dest (0:1173) cvn /DEST pdfmark end
 479 1103
a Fk(Ho)n(w)e(to)h(create)f(and)f(use)i(message)f(en)m(v)o(elopes)e
(for)h(request-reply)-5 b(.)-2 1121 y
SDict begin H.S end
 -2 1121 a -2 1121
a
SDict begin 13 H.A end
 -2 1121 a -2 1121 a
SDict begin [/View [/XYZ H.V]/Dest (0:1174) cvn /DEST pdfmark end
 -2 1121 a Black 396 1252 a Fj(\225)p
Black 479 1252 a
SDict begin H.S end
 479 1252 a 479 1252 a
SDict begin 13 H.A end
 479 1252 a 479
1252 a
SDict begin [/View [/XYZ H.V]/Dest (0:1175) cvn /DEST pdfmark end
 479 1252 a Fk(Ho)n(w)20 b(to)h(use)f(the)g(REQ,)h(REP)-9
b(,)20 b(DEALER,)g(and)g(R)m(OUTER)h(sock)o(ets.)-2 1267
y
SDict begin H.S end
 -2 1267 a -2 1267 a
SDict begin 13 H.A end
 -2 1267 a -2 1267 a
SDict begin [/View [/XYZ H.V]/Dest (0:1176) cvn /DEST pdfmark end
 -2 1267 a Black
396 1402 a Fj(\225)p Black 479 1402 a
SDict begin H.S end
 479 1402 a 479
1402 a
SDict begin 13 H.A end
 479 1402 a 479 1402 a
SDict begin [/View [/XYZ H.V]/Dest (0:1177) cvn /DEST pdfmark end
 479 1402 a Fk(Ho)n(w)f(to)h(set)g(manual)e
(reply)g(addresses)h(using)g(identities.)-2 1420 y
SDict begin H.S end
 -2
1420 a -2 1420 a
SDict begin 13 H.A end
 -2 1420 a -2 1420 a
SDict begin [/View [/XYZ H.V]/Dest (0:1178) cvn /DEST pdfmark end
 -2 1420 a Black
396 1551 a Fj(\225)p Black 479 1551 a
SDict begin H.S end
 479 1551 a 479
1551 a
SDict begin 13 H.A end
 479 1551 a 479 1551 a
SDict begin [/View [/XYZ H.V]/Dest (0:1179) cvn /DEST pdfmark end
 479 1551 a Fk(Ho)n(w)g(to)h(do)e(custom)h
(random)e(scatter)j(routing.)-2 1569 y
SDict begin H.S end
 -2 1569 a -2 1569
a
SDict begin 13 H.A end
 -2 1569 a -2 1569 a
SDict begin [/View [/XYZ H.V]/Dest (0:1180) cvn /DEST pdfmark end
 -2 1569 a Black 396 1701 a Fj(\225)p
Black 479 1701 a
SDict begin H.S end
 479 1701 a 479 1701 a
SDict begin 13 H.A end
 479 1701 a 479
1701 a
SDict begin [/View [/XYZ H.V]/Dest (0:1181) cvn /DEST pdfmark end
 479 1701 a Fk(Ho)n(w)f(to)h(do)e(custom)h(least-recently)f(used)
h(routing.)-2 1719 y
SDict begin H.S end
 -2 1719 a -2 1719 a
SDict begin 13 H.A end
 -2 1719 a -2
1719 a
SDict begin [/View [/XYZ H.V]/Dest (0:1182) cvn /DEST pdfmark end
 -2 1719 a Black 396 1850 a Fj(\225)p Black 479
1850 a
SDict begin H.S end
 479 1850 a 479 1850 a
SDict begin 13 H.A end
 479 1850 a 479 1850 a
SDict begin [/View [/XYZ H.V]/Dest (0:1183) cvn /DEST pdfmark end
 479
1850 a Fk(Ho)n(w)g(to)h(b)n(uild)e(a)i(higher)n(-le)n(v)o(el)d(message)
i(class.)-2 1868 y
SDict begin H.S end
 -2 1868 a -2 1868 a
SDict begin 13 H.A end
 -2 1868 a -2 1868
a
SDict begin [/View [/XYZ H.V]/Dest (0:1184) cvn /DEST pdfmark end
 -2 1868 a Black 396 1999 a Fj(\225)p Black 479 1999
a
SDict begin H.S end
 479 1999 a 479 1999 a
SDict begin 13 H.A end
 479 1999 a 479 1999 a
SDict begin [/View [/XYZ H.V]/Dest (0:1185) cvn /DEST pdfmark end
 479 1999
a Fk(Ho)n(w)g(to)h(b)n(uild)e(a)i(basic)f(request-reply)e(brok)o(er)-5
b(.)-2 2017 y
SDict begin H.S end
 -2 2017 a -2 2017 a
SDict begin 13 H.A end
 -2 2017 a -2 2017 a
SDict begin [/View [/XYZ H.V]/Dest (0:1186) cvn /DEST pdfmark end

-2 2017 a Black 396 2149 a Fj(\225)p Black 479 2149 a
SDict begin H.S end

479 2149 a 479 2149 a
SDict begin 13 H.A end
 479 2149 a 479 2149 a
SDict begin [/View [/XYZ H.V]/Dest (0:1187) cvn /DEST pdfmark end
 479 2149
a Fk(Ho)n(w)20 b(to)h(choose)e(good)g(names)h(for)f(sock)o(ets.)-2
2167 y
SDict begin H.S end
 -2 2167 a -2 2167 a
SDict begin 13 H.A end
 -2 2167 a -2 2167 a
SDict begin [/View [/XYZ H.V]/Dest (0:1188) cvn /DEST pdfmark end
 -2 2167
a Black 396 2298 a Fj(\225)p Black 479 2298 a
SDict begin H.S end
 479 2298
a 479 2298 a
SDict begin 13 H.A end
 479 2298 a 479 2298 a
SDict begin [/View [/XYZ H.V]/Dest (0:1189) cvn /DEST pdfmark end
 479 2298 a Fk(Ho)n(w)h(to)h
(simulate)f(a)g(cluster)h(of)e(clients)i(and)f(w)o(ork)o(ers.)-2
2299 y
SDict begin H.S end
 -2 2299 a -2 2299 a
SDict begin 13 H.A end
 -2 2299 a -2 2299 a
SDict begin [/View [/XYZ H.V]/Dest (0:1190) cvn /DEST pdfmark end
 -2 2299
a Black 396 2448 a Fj(\225)p Black 479 2448 a
SDict begin H.S end
 479 2448
a 479 2448 a
SDict begin 13 H.A end
 479 2448 a 479 2448 a
SDict begin [/View [/XYZ H.V]/Dest (0:1191) cvn /DEST pdfmark end
 479 2448 a Fk(Ho)n(w)g(to)h(b)n
(uild)e(a)i(scalable)f(cloud)g(of)f(request-reply)f(clusters.)-2
2466 y
SDict begin H.S end
 -2 2466 a -2 2466 a
SDict begin 13 H.A end
 -2 2466 a -2 2466 a
SDict begin [/View [/XYZ H.V]/Dest (0:1192) cvn /DEST pdfmark end
 -2 2466
a Black 396 2597 a Fj(\225)p Black 479 2597 a
SDict begin H.S end
 479 2597
a 479 2597 a
SDict begin 13 H.A end
 479 2597 a 479 2597 a
SDict begin [/View [/XYZ H.V]/Dest (0:1193) cvn /DEST pdfmark end
 479 2597 a Fk(Ho)n(w)i(to)h(use)f
(pipeline)f(sock)o(ets)i(for)e(monitoring)f(threads.)-2
2615 y
SDict begin H.S end
 -2 2615 a -2 2615 a
SDict begin 13 H.A end
 -2 2615 a -2 2615 a
SDict begin [/View [/XYZ H.V]/Dest (0:1194) cvn /DEST pdfmark end
 -2 2615
a 359 x Fn(3.1.)39 b(Request-Repl)n(y)d(En)-6 b(velopes)2033
2974 y
SDict begin H.S end
 2033 2974 a 2033 2974 a
SDict begin 22.464 H.A end
 2033 2974 a 2033 2974
a
SDict begin [/View [/XYZ H.V]/Dest (8.46.1) cvn /DEST pdfmark end
 2033 2974 a -2 3170 a
SDict begin H.S end
 -2 3170 a -2 3170 a
SDict begin 13 H.A end
 -2 3170 a
-2 3170 a
SDict begin [/View [/XYZ H.V]/Dest (0:1196) cvn /DEST pdfmark end
 -2 3170 a 396 3248 a Fk(In)20 b(the)g(request-reply)e
(pattern,)h(the)h(en)m(v)o(elope)e(holds)i(the)g(return)f(address)h
(for)f(replies.)h(It)h(is)g(ho)n(w)f(a)g(\330MQ)h(netw)o(ork)396
3356 y(with)g(no)e(state)i(can)f(create)g(round-trip)e(request-reply)f
(dialogs.)-2 3540 y
SDict begin H.S end
 -2 3540 a -2 3540 a
SDict begin 13 H.A end
 -2 3540 a -2
3540 a
SDict begin [/View [/XYZ H.V]/Dest (0:1197) cvn /DEST pdfmark end
 -2 3540 a 396 3630 a Fk(Y)-9 b(ou)20 b(don')o(t)e(in)j(f)o(act)f
(need)g(to)g(understand)e(ho)n(w)i(request-reply)d(en)m(v)o(elopes)i(w)
o(ork)g(to)h(use)h(them)f(for)f(common)g(cases.)396 3738
y(When)h(you)g(use)g(REQ)h(and)e(REP)-9 b(,)21 b(your)e(sock)o(ets)h(b)
n(uild)g(and)g(use)g(en)m(v)o(elopes)e(automatically)-5
b(.)18 b(When)i(you)g(write)g(a)396 3846 y(de)n(vice,)f(and)h(we)h(co)o
(v)o(ered)d(this)i(in)h(the)f(last)h(chapter)m(,)d(you)i(just)g(need)g
(to)g(read)g(and)g(write)g(all)h(the)f(parts)g(of)g(a)h(message.)396
3954 y(\330MQ)g(implements)e(en)m(v)o(elopes)f(using)i(multi-part)f
(data,)g(so)i(if)f(you)g(cop)o(y)f(multi-part)g(data)h(safely)-5
b(,)19 b(you)h(implicitly)396 4062 y(cop)o(y)g(en)m(v)o(elopes)e(too.)
-2 4246 y
SDict begin H.S end
 -2 4246 a -2 4246 a
SDict begin 13 H.A end
 -2 4246 a -2 4246 a
SDict begin [/View [/XYZ H.V]/Dest (0:1198) cvn /DEST pdfmark end
 -2
4246 a 396 4336 a Fk(Ho)n(we)n(v)o(er)m(,)g(getting)i(under)f(the)h
(hood)f(and)g(playing)g(with)h(request-reply)e(en)m(v)o(elopes)g(is)j
(necessary)f(for)f(adv)n(anced)396 4444 y(request-reply)f(w)o(ork.)h
(It')-5 b(s)21 b(time)g(to)f(e)o(xplain)f(ho)n(w)g(the)i(R)m(OUTER)f
(sock)o(et)g(w)o(orks,)g(in)g(terms)g(of)g(en)m(v)o(elopes:)-2
4462 y
SDict begin H.S end
 -2 4462 a -2 4462 a
SDict begin 13 H.A end
 -2 4462 a -2 4462 a
SDict begin [/View [/XYZ H.V]/Dest (0:1199) cvn /DEST pdfmark end
 -2 4462
a -2 4472 a
SDict begin H.S end
 -2 4472 a -2 4472 a
SDict begin 13 H.A end
 -2 4472 a -2 4472 a
SDict begin [/View [/XYZ H.V]/Dest (0:1200) cvn /DEST pdfmark end
 -2
4472 a Black 396 4614 a Fj(\225)p Black 479 4614 a
SDict begin H.S end
 479
4614 a 479 4614 a
SDict begin 13 H.A end
 479 4614 a 479 4614 a
SDict begin [/View [/XYZ H.V]/Dest (0:1201) cvn /DEST pdfmark end
 479 4614 a Fk(When)g(you)g
(recei)n(v)o(e)f(a)h(message)g(from)f(a)i(R)m(OUTER)g(sock)o(et,)e(it)i
(sho)o(v)o(es)f(a)g(bro)n(wn)f(paper)g(en)m(v)o(elope)f(around)g(the)
479 4722 y(message)i(and)f(scribbles)h(on)f(with)h(indelible)f(ink,)g
("This)h(came)f(from)g(Luc)o(y".)f(Then)h(it)i(gi)n(v)o(es)e(that)h(to)
g(you.)f(That)g(is,)479 4830 y(the)h(R)m(OUTER)h(gi)n(v)o(es)f(you)f
(what)h(came)g(of)n(f)g(the)g(wire,)g(wrapped)e(up)i(in)h(an)f(en)m(v)o
(elope)e(with)i(the)g(reply)f(address)h(on)479 4938 y(it.)-2
4939 y
SDict begin H.S end
 -2 4939 a -2 4939 a
SDict begin 13 H.A end
 -2 4939 a -2 4939 a
SDict begin [/View [/XYZ H.V]/Dest (0:1202) cvn /DEST pdfmark end
 -2 4939
a Black 3800 5569 a Ff(85)p Black eop end
%%Page: 86 99
TeXDict begin 86 98 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.86) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1230) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black Black 396 72 a Fj(\225)p Black
479 72 a
SDict begin H.S end
 479 72 a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:1203) cvn /DEST pdfmark end
 479 72 a
Fk(When)20 b(you)g(send)g(a)g(message)g(to)h(a)f(R)m(OUTER,)g(it)h
(rips)g(of)n(f)e(that)h(bro)n(wn)f(paper)g(en)m(v)o(elope,)f(tries)j
(to)f(read)g(its)h(o)n(wn)479 180 y(handwriting,)d(and)i(if)g(it)h(kno)
n(ws)f(who)f("Luc)o(y")g(is,)i(sends)f(the)g(contents)g(back)f(to)i
(Luc)o(y)-5 b(.)18 b(That)i(is)h(the)f(re)n(v)o(erse)479
288 y(process)g(of)g(recei)n(ving)f(a)h(message.)-2 472
y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:1204) cvn /DEST pdfmark end
 -2 472 a 396 562
a Fk(If)g(you)g(lea)n(v)o(e)g(the)g(bro)n(wn)f(en)m(v)o(elope)f(alone,)
h(and)h(then)f(pass)i(that)f(message)g(to)h(another)d(R)m(OUTER)j
(\(e.g.)e(by)h(sending)396 670 y(to)h(a)f(DEALER)g(connected)f(to)h(a)h
(R)m(OUTER\),)f(the)g(second)f(R)m(OUTER)i(will)g(in)f(turn)f(stick)i
(another)e(bro)n(wn)g(en)m(v)o(elope)396 778 y(on)h(it,)h(and)e
(scribble)h(the)g(name)g(of)g(that)g(DEALER)g(on)g(it.)-2
956 y
SDict begin H.S end
 -2 956 a -2 956 a
SDict begin 13 H.A end
 -2 956 a -2 956 a
SDict begin [/View [/XYZ H.V]/Dest (0:1205) cvn /DEST pdfmark end
 -2 956 a 396
1052 a Fk(The)g(whole)g(point)f(of)h(this)h(is)g(that)f(each)g(R)m
(OUTER)h(kno)n(ws)e(ho)n(w)h(to)g(send)g(replies)g(back)g(to)g(the)g
(right)g(place.)f(All)i(you)396 1160 y(need)f(to)g(do,)g(in)g(your)f
(application,)f(is)k(respect)d(the)i(bro)n(wn)d(en)m(v)o(elopes.)g(No)n
(w)i(the)h(REP)g(sock)o(et)f(mak)o(es)g(sense.)g(It)396
1268 y(carefully)f(slices)i(open)e(the)i(bro)n(wn)d(en)m(v)o(elopes,)g
(one)i(by)g(one,)f(k)o(eeps)h(them)g(safely)g(aside,)g(and)g(gi)n(v)o
(es)f(you)h(\(the)396 1376 y(application)f(code)g(that)i(o)n(wns)f(the)
g(REP)h(sock)o(et\))f(the)g(original)f(message.)h(When)g(you)f(send)h
(the)g(reply)-5 b(,)19 b(it)i(re-wraps)396 1484 y(the)f(reply)g(in)g
(the)g(bro)n(wn)f(paper)g(en)m(v)o(elopes,)f(so)j(it)g(can)f(hand)f
(the)h(resulting)f(bro)n(wn)g(package)g(back)g(to)i(the)396
1592 y(R)m(OUTERs)g(do)n(wn)e(the)h(chain.)-2 1759 y
SDict begin H.S end

-2 1759 a -2 1759 a
SDict begin 13 H.A end
 -2 1759 a -2 1759 a
SDict begin [/View [/XYZ H.V]/Dest (0:1206) cvn /DEST pdfmark end
 -2 1759 a 396
1866 a Fk(Which)g(lets)h(you)f(insert)g(R)m(OUTER-DEALER)g(de)n(vices)f
(into)h(a)h(request-reply)d(pattern)h(lik)o(e)h(this:)-2
1967 y
SDict begin H.S end
 -2 1967 a -2 1967 a
SDict begin 11.7 H.A end
 -2 1967 a -2 1967 a
SDict begin [/View [/XYZ H.V]/Dest (0:1207) cvn /DEST pdfmark end
 -2 1967
a 396 2046 a Fe([REQ])44 b(<-->)g([REP])396 2143 y([REQ])g(<-->)g
([ROUTER--DEALER])f(<-->)h([REP])396 2240 y([REQ])g(<-->)g
([ROUTER--DEALER])f(<-->)h([ROUTER--DEALER])e(<-->)i([REP])396
2337 y(...etc.)-2 2505 y
SDict begin H.S end
 -2 2505 a -2 2505 a
SDict begin 13 H.A end
 -2 2505
a -2 2505 a
SDict begin [/View [/XYZ H.V]/Dest (0:1208) cvn /DEST pdfmark end
 -2 2505 a 396 2611 a Fk(If)20 b(you)g(connect)f(a)h(REQ)h
(sock)o(et)f(to)g(a)h(R)m(OUTER,)f(and)g(send)g(one)f(request)h
(message,)g(you)f(will)i(get)f(a)h(message)f(that)396
2719 y(consists)h(of)f(three)g(frames:)f(a)i(reply)e(address,)h(an)g
(empty)f(message)h(frame,)f(and)h(the)g(')l(real')g(message\()p
0 TeXcolorgray 3400 2719 a
SDict begin H.S end
 3400 2719 a Fk(Figure)e(3-1)3748
2719 y
SDict begin 13 H.L end
 3748 2719 a 3748 2719 a
SDict begin [/Subtype /Link/Dest (0:figure-27) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3748 2719 a Black -1 w
Fk(\).)-2 2737 y
SDict begin H.S end
 -2 2737 a -2 2737 a
SDict begin 13 H.A end
 -2 2737 a -2 2737
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-27) cvn /DEST pdfmark
end
 -2 2737 a 396 2921 a Fg(Figur)o(e)i(3-1.)f(Single-hop)h(Request-r)o
(eply)f(En)m(v)o(elope)-2 3020 y
SDict begin H.S end
 -2 3020 a -2 3020 a
SDict begin 13 H.A end

-2 3020 a -2 3020 a
SDict begin [/View [/XYZ H.V]/Dest (0:1212) cvn /DEST pdfmark end
 -2 3020 a 396 3704 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3704 a @beginspecial
0 @llx -77 @lly 285 @urx 0 @ury 2850 @rwi @setspecial
%%BeginDocument: images/fig27.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -77 285 0
%%HiResBoundingBox: 0.0 -77.0 285.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -18.500150680541992 moveto
63.50014877319336 -32.50014877319336 lineto
143.50015258789062 -32.50014877319336 lineto
143.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -32.50014877319336 moveto
63.50014877319336 -46.50014877319336 lineto
83.50015258789062 -46.50014877319336 lineto
83.50015258789062 -32.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -46.50014877319336 moveto
63.50014877319336 -60.50014877319336 lineto
273.5001525878906 -60.50014877319336 lineto
273.5001525878906 -46.50014877319336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -17.0 moveto
62.0 -31.0 lineto
142.0 -31.0 lineto
142.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -17.0 moveto
62.0 -31.0 lineto
142.0 -31.0 lineto
142.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -31.0 moveto
62.0 -45.0 lineto
82.0 -45.0 lineto
82.0 -31.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -31.0 moveto
62.0 -45.0 lineto
82.0 -45.0 lineto
82.0 -31.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
272.0 -59.0 lineto
272.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
272.0 -59.0 lineto
272.0 -45.0 lineto
closepath
stroke
newpath
162.0 -24.0 moveto
190.0 -24.0 lineto
stroke
newpath
102.0 -38.0 moveto
135.0 -38.0 lineto
stroke
newpath
165.0 -21.0 moveto
160.0 -24.0 lineto
165.0 -28.0 lineto
closepath
fill
newpath
105.0 -35.0 moveto
100.0 -38.0 lineto
105.0 -42.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
11.0 -28.0 moveto
(Frame 1) show
75.0 -28.0 moveto
(Reply address) show
197.0 -28.0 moveto
(Envelope) show
11.0 -42.0 moveto
(Frame 2) show
144.0 -42.0 moveto
(Empty message frame) show
11.0 -56.0 moveto
(Frame 3) show
71.0 -56.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3704 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3704 a -2 3870 a
SDict begin H.S end
 -2 3870
a -2 3870 a
SDict begin 13 H.A end
 -2 3870 a -2 3870 a
SDict begin [/View [/XYZ H.V]/Dest (0:1215) cvn /DEST pdfmark end
 -2 3870 a 396 3978 a
Fk(Breaking)g(this)i(do)n(wn:)-2 3996 y
SDict begin H.S end
 -2 3996 a -2
3996 a
SDict begin 13 H.A end
 -2 3996 a -2 3996 a
SDict begin [/View [/XYZ H.V]/Dest (0:1216) cvn /DEST pdfmark end
 -2 3996 a -2 4006 a
SDict begin H.S end
 -2 4006
a -2 4006 a
SDict begin 13 H.A end
 -2 4006 a -2 4006 a
SDict begin [/View [/XYZ H.V]/Dest (0:1217) cvn /DEST pdfmark end
 -2 4006 a Black 396 4148
a Fj(\225)p Black 479 4148 a
SDict begin H.S end
 479 4148 a 479 4148 a
SDict begin 13 H.A end
 479
4148 a 479 4148 a
SDict begin [/View [/XYZ H.V]/Dest (0:1218) cvn /DEST pdfmark end
 479 4148 a Fk(The)f(data)g(in)h(frame)e(3)h(is)h
(what)f(the)h(sending)e(application)f(sends)j(to)f(the)g(REQ)h(sock)o
(et.)-2 4166 y
SDict begin H.S end
 -2 4166 a -2 4166 a
SDict begin 13 H.A end
 -2 4166 a -2 4166
a
SDict begin [/View [/XYZ H.V]/Dest (0:1219) cvn /DEST pdfmark end
 -2 4166 a Black 396 4297 a Fj(\225)p Black 479 4297
a
SDict begin H.S end
 479 4297 a 479 4297 a
SDict begin 13 H.A end
 479 4297 a 479 4297 a
SDict begin [/View [/XYZ H.V]/Dest (0:1220) cvn /DEST pdfmark end
 479 4297
a Fk(The)f(empty)f(message)h(frame)g(in)g(frame)g(2)g(is)h(prepended)c
(by)j(the)g(REQ)h(sock)o(et)f(when)g(it)h(sends)f(the)g(message)g(to)
479 4405 y(the)g(R)m(OUTER.)-2 4406 y
SDict begin H.S end
 -2 4406 a -2 4406
a
SDict begin 13 H.A end
 -2 4406 a -2 4406 a
SDict begin [/View [/XYZ H.V]/Dest (0:1221) cvn /DEST pdfmark end
 -2 4406 a Black 396 4555 a Fj(\225)p
Black 479 4555 a
SDict begin H.S end
 479 4555 a 479 4555 a
SDict begin 13 H.A end
 479 4555 a 479
4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:1222) cvn /DEST pdfmark end
 479 4555 a Fk(The)g(reply)g(address)f(in)i(frame)e(1)h(is)h
(prepended)d(by)i(the)g(R)m(OUTER)g(before)f(it)i(passes)g(the)f
(message)g(to)h(the)479 4663 y(recei)n(ving)e(application.)-2
4847 y
SDict begin H.S end
 -2 4847 a -2 4847 a
SDict begin 13 H.A end
 -2 4847 a -2 4847 a
SDict begin [/View [/XYZ H.V]/Dest (0:1223) cvn /DEST pdfmark end
 -2 4847
a 396 4936 a Fk(No)n(w)h(if)h(we)f(e)o(xtend)f(this)i(with)f(a)h(chain)
f(of)f(de)n(vices,)h(we)g(get)h(en)m(v)o(elope)c(on)j(en)m(v)o(elope,)e
(with)i(the)h(ne)n(west)f(en)m(v)o(elope)396 5044 y(al)o(w)o(ays)h
(stuck)f(at)h(the)f(be)o(ginning)d(of)j(the)h(stack\()p
0 TeXcolorgray 1808 5044 a
SDict begin H.S end
 1808 5044 a Fk(Figure)d(3-2)2156
5044 y
SDict begin 13 H.L end
 2156 5044 a 2156 5044 a
SDict begin [/Subtype /Link/Dest (0:figure-28) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2156 5044 a Black -1 w
Fk(\).)-2 5062 y
SDict begin H.S end
 -2 5062 a -2 5062 a
SDict begin 13 H.A end
 -2 5062 a -2 5062
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-28) cvn /DEST pdfmark
end
 -2 5062 a Black 3798 5569 a Ff(86)p Black eop end
%%Page: 87 100
TeXDict begin 87 99 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.87) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1248) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-2.)f(Multihop)i
(Request-r)o(eply)e(En)m(v)o(elope)-2 172 y
SDict begin H.S end
 -2 172 a
-2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1227) cvn /DEST pdfmark end
 -2 172 a 396 1206 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1206
a @beginspecial 0 @llx -119 @lly 290 @urx 0 @ury 2900
@rwi @setspecial
%%BeginDocument: images/fig28.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -119 290 0
%%HiResBoundingBox: 0.0 -119.0 290.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -32.50014877319336 moveto
63.50014877319336 -45.50014877319336 lineto
143.50015258789062 -45.50014877319336 lineto
143.50015258789062 -32.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -47.50014877319336 moveto
63.50014877319336 -59.50014877319336 lineto
143.50015258789062 -59.50014877319336 lineto
143.50015258789062 -47.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -61.50014877319336 moveto
63.50014877319336 -74.50015258789062 lineto
143.50015258789062 -74.50015258789062 lineto
143.50015258789062 -61.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -74.50015258789062 moveto
63.50014877319336 -88.50015258789062 lineto
83.50015258789062 -88.50015258789062 lineto
83.50015258789062 -74.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -88.50015258789062 moveto
63.50014877319336 -102.50015258789062 lineto
273.5001525878906 -102.50015258789062 lineto
273.5001525878906 -88.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -31.0 moveto
62.0 -44.0 lineto
142.0 -44.0 lineto
142.0 -31.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -31.0 moveto
62.0 -44.0 lineto
142.0 -44.0 lineto
142.0 -31.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -46.0 moveto
62.0 -58.0 lineto
142.0 -58.0 lineto
142.0 -46.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -46.0 moveto
62.0 -58.0 lineto
142.0 -58.0 lineto
142.0 -46.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -60.0 moveto
62.0 -73.0 lineto
142.0 -73.0 lineto
142.0 -60.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -60.0 moveto
62.0 -73.0 lineto
142.0 -73.0 lineto
142.0 -60.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -73.0 moveto
62.0 -87.0 lineto
82.0 -87.0 lineto
82.0 -73.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -73.0 moveto
62.0 -87.0 lineto
82.0 -87.0 lineto
82.0 -73.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -87.0 moveto
62.0 -101.0 lineto
272.0 -101.0 lineto
272.0 -87.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -87.0 moveto
62.0 -101.0 lineto
272.0 -101.0 lineto
272.0 -87.0 lineto
closepath
stroke
newpath
162.0 -38.0 moveto
190.0 -38.0 lineto
stroke
newpath
162.0 -52.0 moveto
190.0 -52.0 lineto
stroke
newpath
162.0 -66.0 moveto
190.0 -66.0 lineto
stroke
newpath
102.0 -80.0 moveto
135.0 -80.0 lineto
stroke
newpath
165.0 -35.0 moveto
160.0 -38.0 lineto
165.0 -42.0 lineto
closepath
fill
newpath
165.0 -49.0 moveto
160.0 -52.0 lineto
165.0 -56.0 lineto
closepath
fill
newpath
165.0 -63.0 moveto
160.0 -66.0 lineto
165.0 -70.0 lineto
closepath
fill
newpath
105.0 -77.0 moveto
100.0 -80.0 lineto
105.0 -84.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
50.0 -21.0 moveto
(\(Next envelope will go here\)) show
11.0 -42.0 moveto
(Frame 1) show
75.0 -42.0 moveto
(Reply address) show
199.0 -42.0 moveto
(Envelope \(ROUTER\)) show
11.0 -56.0 moveto
(Frame 2) show
75.0 -56.0 moveto
(Reply address) show
199.0 -56.0 moveto
(Envelope \(ROUTER\)) show
11.0 -70.0 moveto
(Frame 3) show
75.0 -70.0 moveto
(Reply address) show
199.0 -70.0 moveto
(Envelope \(ROUTER\)) show
11.0 -84.0 moveto
(Frame 4) show
147.0 -84.0 moveto
(Empty message frame \(REQ\)) show
11.0 -98.0 moveto
(Frame 5) show
71.0 -98.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1206 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1206 a 274 x Fk(Here)h(no)n(w)g(is)h(a)g
(more)e(detailed)h(e)o(xplanation)e(of)h(the)i(four)e(sock)o(et)h
(types)g(we)g(use)h(for)e(request-reply)f(patterns:)-2
1497 y
SDict begin H.S end
 -2 1497 a -2 1497 a
SDict begin 13 H.A end
 -2 1497 a -2 1497 a
SDict begin [/View [/XYZ H.V]/Dest (0:1231) cvn /DEST pdfmark end
 -2 1497
a -2 1507 a
SDict begin H.S end
 -2 1507 a -2 1507 a
SDict begin 13 H.A end
 -2 1507 a -2 1507 a
SDict begin [/View [/XYZ H.V]/Dest (0:1232) cvn /DEST pdfmark end
 -2
1507 a Black 396 1650 a Fj(\225)p Black 479 1650 a
SDict begin H.S end
 479
1650 a 479 1650 a
SDict begin 13 H.A end
 479 1650 a 479 1650 a
SDict begin [/View [/XYZ H.V]/Dest (0:1233) cvn /DEST pdfmark end
 479 1650 a Fk(DEALER)i(just)h
(deals)g(out)e(the)i(messages)f(you)f(send)h(to)h(all)f(connected)f
(peers)h(\(aka)f("round-robin"\),)d(and)j(deals)479 1758
y(in)i(\(aka)e("f)o(air)h(queuing"\))e(the)i(messages)h(it)g(recei)n(v)
o(es.)e(It)h(is)h(e)o(xactly)f(lik)o(e)g(a)h(PUSH)g(and)e(PULL)i(sock)o
(et)f(combined.)-2 1776 y
SDict begin H.S end
 -2 1776 a -2 1776 a
SDict begin 13 H.A end
 -2 1776
a -2 1776 a
SDict begin [/View [/XYZ H.V]/Dest (0:1234) cvn /DEST pdfmark end
 -2 1776 a Black 396 1907 a Fj(\225)p Black
479 1907 a
SDict begin H.S end
 479 1907 a 479 1907 a
SDict begin 13 H.A end
 479 1907 a 479 1907
a
SDict begin [/View [/XYZ H.V]/Dest (0:1235) cvn /DEST pdfmark end
 479 1907 a Fk(REQ)h(prepends)e(an)h(empty)f(message)h(frame)f(to)i(e)
n(v)o(ery)e(message)h(you)f(send,)h(and)f(remo)o(v)o(es)g(the)h(empty)f
(message)479 2015 y(frame)h(from)f(each)h(message)g(you)f(recei)n(v)o
(e.)g(It)h(then)g(w)o(orks)g(lik)o(e)g(DEALER)h(\(and)e(in)h(f)o(act)h
(is)g(b)n(uilt)f(on)g(DEALER\))479 2123 y(e)o(xcept)f(it)i(also)g
(imposes)f(a)g(strict)h(send)f(/)h(recei)n(v)o(e)e(c)o(ycle.)-2
2141 y
SDict begin H.S end
 -2 2141 a -2 2141 a
SDict begin 13 H.A end
 -2 2141 a -2 2141 a
SDict begin [/View [/XYZ H.V]/Dest (0:1236) cvn /DEST pdfmark end
 -2 2141
a Black 396 2272 a Fj(\225)p Black 479 2272 a
SDict begin H.S end
 479 2272
a 479 2272 a
SDict begin 13 H.A end
 479 2272 a 479 2272 a
SDict begin [/View [/XYZ H.V]/Dest (0:1237) cvn /DEST pdfmark end
 479 2272 a Fk(R)m(OUTER)i(prepends)d
(an)i(en)m(v)o(elope)d(with)j(reply)f(address)h(to)g(each)g(message)f
(it)i(recei)n(v)o(es,)e(before)f(passing)i(it)h(to)f(the)479
2380 y(application.)f(It)h(also)h(chops)e(of)n(f)h(the)g(en)m(v)o
(elope)e(\(the)i(\002rst)h(message)f(frame\))f(from)g(each)h(message)g
(it)h(sends,)f(and)479 2488 y(uses)h(that)f(reply)g(address)f(to)i
(decide)e(which)h(peer)f(the)i(message)f(should)f(go)h(to.)-2
2506 y
SDict begin H.S end
 -2 2506 a -2 2506 a
SDict begin 13 H.A end
 -2 2506 a -2 2506 a
SDict begin [/View [/XYZ H.V]/Dest (0:1238) cvn /DEST pdfmark end
 -2 2506
a Black 396 2638 a Fj(\225)p Black 479 2638 a
SDict begin H.S end
 479 2638
a 479 2638 a
SDict begin 13 H.A end
 479 2638 a 479 2638 a
SDict begin [/View [/XYZ H.V]/Dest (0:1239) cvn /DEST pdfmark end
 479 2638 a Fk(REP)h(stores)g(all)g
(the)f(message)g(frames)f(up)h(to)h(the)f(\002rst)h(empty)e(message)h
(frame,)f(when)h(you)f(recei)n(v)o(e)g(a)i(message)479
2746 y(and)f(it)h(passes)g(the)f(rest)h(\(the)e(data\))h(to)g(your)f
(application.)g(When)h(you)f(send)h(a)h(reply)-5 b(,)18
b(REP)j(prepends)e(the)h(sa)n(v)o(ed)479 2854 y(en)m(v)o(elopes)e(to)j
(the)f(message)g(and)g(sends)g(it)h(back)e(using)h(the)g(same)h
(semantics)f(as)h(R)m(OUTER)f(\(and)f(in)i(f)o(act)f(REP)h(is)479
2961 y(b)n(uilt)g(on)e(top)h(of)g(R)m(OUTER\),)g(b)n(ut)g(matching)f
(REQ,)i(imposes)f(a)g(strict)h(recei)n(v)o(e)e(/)i(send)f(c)o(ycle.)-2
3145 y
SDict begin H.S end
 -2 3145 a -2 3145 a
SDict begin 13 H.A end
 -2 3145 a -2 3145 a
SDict begin [/View [/XYZ H.V]/Dest (0:1240) cvn /DEST pdfmark end
 -2 3145
a 396 3235 a Fk(REP)h(requires)e(that)i(the)f(en)m(v)o(elopes)e(end)i
(with)g(an)g(empty)g(message)g(frame.)f(If)h(you')l(re)e(not)i(using)g
(REQ)g(at)h(the)f(other)396 3343 y(end)g(of)g(the)g(chain)g(then)f(you)
h(must)g(add)f(the)i(empty)e(message)h(frame)f(yourself.)-2
3527 y
SDict begin H.S end
 -2 3527 a -2 3527 a
SDict begin 13 H.A end
 -2 3527 a -2 3527 a
SDict begin [/View [/XYZ H.V]/Dest (0:1241) cvn /DEST pdfmark end
 -2 3527
a 396 3617 a Fk(So)i(the)f(ob)o(vious)e(question)h(about)h(R)m(OUTER)g
(is,)h(where)f(does)g(it)h(get)f(the)g(reply)f(addresses)h(from?)f(And)
h(the)g(ob)o(vious)396 3725 y(answer)g(is,)h(it)g(uses)g(the)f(sock)o
(et')-5 b(s)20 b(identity)-5 b(.)19 b(As)i(we)g(already)e(learned,)g
(if)h(a)h(sock)o(et)f(does)g(not)g(set)h(an)f(identity)-5
b(,)18 b(the)396 3833 y(R)m(OUTER)j(generates)e(an)h(identity)g(that)g
(it)h(can)f(associate)g(with)h(the)f(connection)e(to)i(that)h(sock)o
(et\()p 0 TeXcolorgray 3269 3833 a
SDict begin H.S end
 3269 3833 a Fk(Figure)d(3-3)3617
3833 y
SDict begin 13 H.L end
 3617 3833 a 3617 3833 a
SDict begin [/Subtype /Link/Dest (0:figure-29) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3617 3833 a Black -1 w
Fk(\).)-2 3851 y
SDict begin H.S end
 -2 3851 a -2 3851 a
SDict begin 13 H.A end
 -2 3851 a -2 3851
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-29) cvn /DEST pdfmark
end
 -2 3851 a Black 3797 5569 a Ff(87)p Black eop end
%%Page: 88 101
TeXDict begin 88 100 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.88) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-3.)f(R)n(OUTER)h(In)m(v)
o(ents)h(a)f(UUID)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a
-2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1245) cvn /DEST pdfmark end
 -2 172 a 396 1439 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1439 a @beginspecial
0 @llx -147 @lly 310 @urx 0 @ury 3100 @rwi @setspecial
%%BeginDocument: images/fig29.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -147 310 0
%%HiResBoundingBox: 0.0 -147.0 310.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -32.50014877319336 moveto
13.500149726867676 -45.50014877319336 lineto
73.50015258789062 -45.50014877319336 lineto
73.50015258789062 -32.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -47.50014877319336 moveto
13.500149726867676 -57.50014877319336 lineto
13.500149726867676 -59.50014877319336 14.500150044759115 -60.50014877319336 16.500150680541992 -60.50014877319336 curveto
71.50015258789062 -60.50014877319336 lineto
71.50015258789062 -60.50014877319336 lineto
72.83348592122395 -60.50014877319336 73.50015258789062 -59.50014877319336 73.50015258789062 -57.50014877319336 curveto
73.50015258789062 -47.50014877319336 lineto
73.50015258789062 -47.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -46.50014877319336 moveto
113.50015258789062 -60.50014877319336 lineto
163.50015258789062 -60.50014877319336 lineto
163.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -88.50015258789062 moveto
14.500150044759115 -88.50015258789062 13.500149726867676 -89.83348592122395 13.500149726867676 -92.50015258789062 curveto
13.500149726867676 -101.50015258789062 lineto
73.50015258789062 -101.50015258789062 lineto
73.50015258789062 -92.50015258789062 lineto
73.50015258789062 -89.83348592122395 72.83348592122395 -88.50015258789062 71.50015258789062 -88.50015258789062 curveto
16.500150680541992 -88.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -103.50015258789062 moveto
13.500149726867676 -130.50015258789062 lineto
73.50015258789062 -130.50015258789062 lineto
73.50015258789062 -103.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -88.50015258789062 moveto
113.50015258789062 -102.50015258789062 lineto
163.50015258789062 -102.50015258789062 lineto
163.50015258789062 -88.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -102.50015258789062 moveto
113.50015258789062 -116.50015258789062 lineto
123.50015258789062 -116.50015258789062 lineto
123.50015258789062 -102.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -116.50015258789062 moveto
113.50015258789062 -130.50015258789062 lineto
163.50015258789062 -130.50015258789062 lineto
163.50015258789062 -116.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -31.0 moveto
12.0 -44.0 lineto
72.0 -44.0 lineto
72.0 -31.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
12.0 -31.0 moveto
12.0 -44.0 lineto
72.0 -44.0 lineto
72.0 -31.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -46.0 moveto
12.0 -56.0 lineto
12.0 -58.0 13.0 -59.0 15.0 -59.0 curveto
70.0 -59.0 lineto
70.0 -59.0 lineto
71.33333333333333 -59.0 72.0 -58.0 72.0 -56.0 curveto
72.0 -46.0 lineto
72.0 -46.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -46.0 moveto
12.0 -56.0 lineto
12.0 -58.0 13.0 -59.0 15.0 -59.0 curveto
70.0 -59.0 lineto
70.0 -59.0 lineto
71.33333333333333 -59.0 72.0 -58.0 72.0 -56.0 curveto
72.0 -46.0 lineto
72.0 -46.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -45.0 moveto
112.0 -59.0 lineto
162.0 -59.0 lineto
162.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -45.0 moveto
112.0 -59.0 lineto
162.0 -59.0 lineto
162.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -87.0 moveto
13.0 -87.0 12.0 -88.33333333333333 12.0 -91.0 curveto
12.0 -100.0 lineto
72.0 -100.0 lineto
72.0 -91.0 lineto
72.0 -88.33333333333333 71.33333333333333 -87.0 70.0 -87.0 curveto
15.0 -87.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -87.0 moveto
13.0 -87.0 12.0 -88.33333333333333 12.0 -91.0 curveto
12.0 -100.0 lineto
72.0 -100.0 lineto
72.0 -91.0 lineto
72.0 -88.33333333333333 71.33333333333333 -87.0 70.0 -87.0 curveto
15.0 -87.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -102.0 moveto
12.0 -129.0 lineto
72.0 -129.0 lineto
72.0 -102.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -102.0 moveto
12.0 -129.0 lineto
72.0 -129.0 lineto
72.0 -102.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -87.0 moveto
112.0 -101.0 lineto
162.0 -101.0 lineto
162.0 -87.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -87.0 moveto
112.0 -101.0 lineto
162.0 -101.0 lineto
162.0 -87.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -101.0 moveto
112.0 -115.0 lineto
122.0 -115.0 lineto
122.0 -101.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -101.0 moveto
112.0 -115.0 lineto
122.0 -115.0 lineto
122.0 -101.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -115.0 moveto
112.0 -129.0 lineto
162.0 -129.0 lineto
162.0 -115.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -115.0 moveto
112.0 -129.0 lineto
162.0 -129.0 lineto
162.0 -115.0 lineto
closepath
stroke
newpath
12.0 -14.0 moveto
12.0 -31.0 lineto
stroke
newpath
72.0 -14.0 moveto
72.0 -31.0 lineto
stroke
newpath
42.0 -59.0 moveto
42.0 -80.0 lineto
stroke
newpath
40.0 -77.0 moveto
42.0 -84.0 lineto
45.0 -77.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
34.0 -21.0 moveto
(Client) show
35.0 -55.0 moveto
(REQ) show
126.0 -56.0 moveto
(Data) show
201.0 -56.0 moveto
(Client sends this) show
67.0 -77.0 moveto
("My identity is empty") show
26.0 -97.0 moveto
(ROUTER) show
127.0 -97.0 moveto
(UUID) show
190.0 -98.0 moveto
(ROUTER invents UUID to) show
190.0 -105.0 moveto
(use as reply address) show
28.0 -119.0 moveto
(Service) show
126.0 -126.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1439 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1439 a 274 x Fk(When)g(we)h(set)g(our)e(o)n
(wn)h(identity)f(on)h(a)h(sock)o(et,)f(this)g(gets)h(passed)f(to)g(the)
g(R)m(OUTER,)h(which)e(passes)i(it)g(to)f(the)396 1821
y(application)f(as)i(part)f(of)g(the)g(en)m(v)o(elope)e(for)h(each)h
(message)g(that)g(comes)g(in\()p 0 TeXcolorgray 2617
1821 a
SDict begin H.S end
 2617 1821 a Fk(Figure)f(3-4)2966 1821 y
SDict begin 13 H.L end
 2966 1821
a 2966 1821 a
SDict begin [/Subtype /Link/Dest (0:figure-30) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2966 1821 a Black -1 w Fk(\).)-2 1839 y
SDict begin H.S end

-2 1839 a -2 1839 a
SDict begin 13 H.A end
 -2 1839 a -2 1839 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-30) cvn /DEST pdfmark
end
 -2 1839 a 396
2022 a Fg(Figur)o(e)h(3-4.)f(R)n(OUTER)h(uses)i(Identity)e(If)h(It)f
(kno)o(ws)h(It)-2 2122 y
SDict begin H.S end
 -2 2122 a -2 2122 a
SDict begin 13 H.A end
 -2 2122
a -2 2122 a
SDict begin [/View [/XYZ H.V]/Dest (0:1252) cvn /DEST pdfmark end
 -2 2122 a 396 3388 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3388 a @beginspecial
0 @llx -147 @lly 315 @urx 0 @ury 3150 @rwi @setspecial
%%BeginDocument: images/fig30.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -147 315 0
%%HiResBoundingBox: 0.0 -147.0 315.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -18.500150680541992 moveto
13.500149726867676 -45.50014877319336 lineto
73.50015258789062 -45.50014877319336 lineto
73.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -47.50014877319336 moveto
13.500149726867676 -57.50014877319336 lineto
13.500149726867676 -59.50014877319336 14.500150044759115 -60.50014877319336 16.500150680541992 -60.50014877319336 curveto
71.50015258789062 -60.50014877319336 lineto
71.50015258789062 -60.50014877319336 lineto
72.83348592122395 -60.50014877319336 73.50015258789062 -59.50014877319336 73.50015258789062 -57.50014877319336 curveto
73.50015258789062 -47.50014877319336 lineto
73.50015258789062 -47.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -46.50014877319336 moveto
113.50015258789062 -60.50014877319336 lineto
163.50015258789062 -60.50014877319336 lineto
163.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -88.50015258789062 moveto
14.500150044759115 -88.50015258789062 13.500149726867676 -89.83348592122395 13.500149726867676 -92.50015258789062 curveto
13.500149726867676 -101.50015258789062 lineto
73.50015258789062 -101.50015258789062 lineto
73.50015258789062 -92.50015258789062 lineto
73.50015258789062 -89.83348592122395 72.83348592122395 -88.50015258789062 71.50015258789062 -88.50015258789062 curveto
16.500150680541992 -88.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -103.50015258789062 moveto
13.500149726867676 -130.50015258789062 lineto
73.50015258789062 -130.50015258789062 lineto
73.50015258789062 -103.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -88.50015258789062 moveto
113.50015258789062 -102.50015258789062 lineto
163.50015258789062 -102.50015258789062 lineto
163.50015258789062 -88.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -102.50015258789062 moveto
113.50015258789062 -116.50015258789062 lineto
123.50015258789062 -116.50015258789062 lineto
123.50015258789062 -102.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -116.50015258789062 moveto
113.50015258789062 -130.50015258789062 lineto
163.50015258789062 -130.50015258789062 lineto
163.50015258789062 -116.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -17.0 moveto
12.0 -44.0 lineto
72.0 -44.0 lineto
72.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
12.0 -17.0 moveto
12.0 -44.0 lineto
72.0 -44.0 lineto
72.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -46.0 moveto
12.0 -56.0 lineto
12.0 -58.0 13.0 -59.0 15.0 -59.0 curveto
70.0 -59.0 lineto
70.0 -59.0 lineto
71.33333333333333 -59.0 72.0 -58.0 72.0 -56.0 curveto
72.0 -46.0 lineto
72.0 -46.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -46.0 moveto
12.0 -56.0 lineto
12.0 -58.0 13.0 -59.0 15.0 -59.0 curveto
70.0 -59.0 lineto
70.0 -59.0 lineto
71.33333333333333 -59.0 72.0 -58.0 72.0 -56.0 curveto
72.0 -46.0 lineto
72.0 -46.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -45.0 moveto
112.0 -59.0 lineto
162.0 -59.0 lineto
162.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -45.0 moveto
112.0 -59.0 lineto
162.0 -59.0 lineto
162.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -87.0 moveto
13.0 -87.0 12.0 -88.33333333333333 12.0 -91.0 curveto
12.0 -100.0 lineto
72.0 -100.0 lineto
72.0 -91.0 lineto
72.0 -88.33333333333333 71.33333333333333 -87.0 70.0 -87.0 curveto
15.0 -87.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -87.0 moveto
13.0 -87.0 12.0 -88.33333333333333 12.0 -91.0 curveto
12.0 -100.0 lineto
72.0 -100.0 lineto
72.0 -91.0 lineto
72.0 -88.33333333333333 71.33333333333333 -87.0 70.0 -87.0 curveto
15.0 -87.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -102.0 moveto
12.0 -129.0 lineto
72.0 -129.0 lineto
72.0 -102.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -102.0 moveto
12.0 -129.0 lineto
72.0 -129.0 lineto
72.0 -102.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -87.0 moveto
112.0 -101.0 lineto
162.0 -101.0 lineto
162.0 -87.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -87.0 moveto
112.0 -101.0 lineto
162.0 -101.0 lineto
162.0 -87.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -101.0 moveto
112.0 -115.0 lineto
122.0 -115.0 lineto
122.0 -101.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -101.0 moveto
112.0 -115.0 lineto
122.0 -115.0 lineto
122.0 -101.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -115.0 moveto
112.0 -129.0 lineto
162.0 -129.0 lineto
162.0 -115.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -115.0 moveto
112.0 -129.0 lineto
162.0 -129.0 lineto
162.0 -115.0 lineto
closepath
stroke
newpath
42.0 -59.0 moveto
42.0 -80.0 lineto
stroke
newpath
40.0 -77.0 moveto
42.0 -84.0 lineto
45.0 -77.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
119.0 -28.0 moveto
(zmq_setsockopt \(socket,) show
139.0 -35.0 moveto
(ZMQ_IDENTITY, "Lucy", 4\);) show
34.0 -35.0 moveto
(Client) show
35.0 -55.0 moveto
(REQ) show
126.0 -56.0 moveto
(Data) show
201.0 -56.0 moveto
(Client sends this) show
65.0 -77.0 moveto
("Hi, my name is Lucy") show
26.0 -97.0 moveto
(ROUTER) show
124.0 -98.0 moveto
('Lucy') show
200.0 -98.0 moveto
(ROUTER uses identity of) show
204.0 -105.0 moveto
(client as reply address) show
28.0 -119.0 moveto
(Service) show
126.0 -126.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3388 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3388 a -2 3555 a
SDict begin H.S end
 -2 3555
a -2 3555 a
SDict begin 13 H.A end
 -2 3555 a -2 3555 a
SDict begin [/View [/XYZ H.V]/Dest (0:1255) cvn /DEST pdfmark end
 -2 3555 a 396 3662 a
Fk(Let')-5 b(s)21 b(observ)o(e)e(the)h(abo)o(v)o(e)e(tw)o(o)j(cases)g
(in)f(practice.)g(This)g(program)e(dumps)h(the)h(contents)g(of)g(the)g
(message)g(frames)396 3770 y(that)h(a)f(R)m(OUTER)h(recei)n(v)o(es)e
(from)g(tw)o(o)i(REP)g(sock)o(ets,)f(one)f(not)h(using)g(identities,)g
(and)g(one)f(using)h(an)g(identity)396 3878 y('Hello':)-2
3879 y
SDict begin H.S end
 -2 3879 a -2 3879 a
SDict begin 13 H.A end
 -2 3879 a -2 3879 a
SDict begin [/View [/XYZ H.V]/Dest (0:identity-c) cvn /DEST pdfmark
end
 -2 3879
a 396 4080 a Fg(Example)h(3-1.)e(Identity)h(check)h(\(identity)-6
b(.c\))-2 4180 y
SDict begin H.S end
 -2 4180 a -2 4180 a
SDict begin 11.7 H.A end
 -2 4180 a -2 4180
a
SDict begin [/View [/XYZ H.V]/Dest (0:1258) cvn /DEST pdfmark end
 -2 4180 a 396 4260 a Fe(//)396 4357 y(//)90 b(Demonstrate)43
b(identities)g(as)h(used)g(by)h(the)f(request-reply)f(pattern.)88
b(Run)44 b(this)396 4454 y(//)90 b(program)43 b(by)i(itself.)88
b(Note)44 b(that)h(the)f(utility)g(functions)f(s_)h(are)h(provided)e
(by)396 4551 y(//)90 b(zhelpers.h.)d(It)45 b(gets)f(boring)g(for)g
(everyone)g(to)g(keep)g(repeating)g(this)g(code.)396
4648 y(//)396 4745 y(#include)g("zhelpers.h")396 4940
y(int)h(main)f(\(void\))396 5037 y({)576 5134 y(void)800
5147 y(*)845 5134 y(context)f(=)i(zmq_ctx_new)e(\(\);)p
Black 3800 5569 a Ff(88)p Black eop end
%%Page: 89 102
TeXDict begin 89 101 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.89) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 170 a Fe(void)800 183 y(*)845 170
y(sink)44 b(=)g(zmq_socket)g(\(context,)f(ZMQ_ROUTER\);)576
267 y(zmq_bind)g(\(sink,)h("inproc://example"\);)576
461 y(//)89 b(First)44 b(allow)g(0MQ)g(to)h(set)f(the)g(identity)576
558 y(void)800 571 y(*)845 558 y(anonymous)f(=)i(zmq_socket)e
(\(context,)g(ZMQ_REQ\);)576 655 y(zmq_connect)g(\(anonymous,)g
("inproc://example"\);)576 752 y(s_send)g(\(anonymous,)g("ROUTER)h
(uses)g(a)h(generated)e(UUID"\);)576 850 y(s_dump)g(\(sink\);)576
1044 y(//)89 b(Then)44 b(set)g(the)h(identity)e(ourself)576
1141 y(void)800 1154 y(*)845 1141 y(identified)g(=)h(zmq_socket)g
(\(context,)f(ZMQ_REQ\);)576 1238 y(zmq_setsockopt)f(\(identified,)h
(ZMQ_IDENTITY,)g("Hello",)g(5\);)576 1335 y(zmq_connect)g
(\(identified,)f("inproc://example"\);)576 1432 y(s_send)h
(\(identified,)g("ROUTER)h(socket)g(uses)g(REQ's)g(socket)g
(identity"\);)576 1530 y(s_dump)f(\(sink\);)576 1724
y(zmq_close)g(\(sink\);)576 1821 y(zmq_close)g(\(anonymous\);)576
1918 y(zmq_close)g(\(identified\);)576 2015 y(zmq_ctx_destroy)f
(\(context\);)576 2112 y(return)h(0;)396 2209 y(})-2
2384 y
SDict begin H.S end
 -2 2384 a -2 2384 a
SDict begin 13 H.A end
 -2 2384 a -2 2384 a
SDict begin [/View [/XYZ H.V]/Dest (0:1259) cvn /DEST pdfmark end
 -2 2384
a 396 2483 a Fk(Here)20 b(is)h(what)g(the)f(dump)f(function)f(prints:)
-2 2584 y
SDict begin H.S end
 -2 2584 a -2 2584 a
SDict begin 11.7 H.A end
 -2 2584 a -2 2584 a
SDict begin [/View [/XYZ H.V]/Dest (0:1260) cvn /DEST pdfmark end
 -2
2584 a 396 2664 a Fe(----------------------------------------)396
2761 y([017])44 b(00314F043F46C441E28DD0AC54BE8DA727)396
2858 y([000])396 2955 y([026])g(ROUTER)g(uses)g(a)h(generated)e(UUID)
396 3052 y(----------------------------------------)396
3149 y([005])h(Hello)396 3246 y([000])396 3344 y([038])g(ROUTER)g(uses)
g(REQ's)g(socket)g(identity)-2 3438 y
SDict begin H.S end
 -2 3438 a -2 3438
a
SDict begin 13 H.A end
 -2 3438 a -2 3438 a
SDict begin [/View [/XYZ H.V]/Dest (0:1261) cvn /DEST pdfmark end
 -2 3438 a 366 x Fn(3.2.)39 b(Custom)f
(Request-Repl)n(y)e(Routing)2437 3804 y
SDict begin H.S end
 2437 3804 a 2437
3804 a
SDict begin 22.464 H.A end
 2437 3804 a 2437 3804 a
SDict begin [/View [/XYZ H.V]/Dest (8.47.1) cvn /DEST pdfmark end
 2437 3804 a -2 4002 a
SDict begin H.S end

-2 4002 a -2 4002 a
SDict begin 13 H.A end
 -2 4002 a -2 4002 a
SDict begin [/View [/XYZ H.V]/Dest (0:1263) cvn /DEST pdfmark end
 -2 4002 a 396
4078 a Fk(W)-7 b(e)22 b(already)d(sa)o(w)h(that)h(R)m(OUTER)f(uses)h
(the)f(message)g(en)m(v)o(elope)e(to)i(decide)g(which)f(client)i(to)f
(route)f(a)i(reply)e(back)h(to.)396 4186 y(No)n(w)g(let)h(me)f(e)o
(xpress)g(that)g(in)g(another)f(w)o(ay:)1752 4186 y
SDict begin H.S end
 1752
4186 a 1752 4186 a
SDict begin 13 H.A end
 1752 4186 a 1752 4186 a
SDict begin [/View [/XYZ H.V]/Dest (0:1264) cvn /DEST pdfmark end
 1752 4186
a Ff(R)m(OUTER)h(will)i(r)l(oute)e(messa)o(g)o(es)g(async)o(hr)l
(onously)e(to)j(any)e(peer)396 4294 y(connected)g(to)h(it,)h(if)g(you)e
(pr)l(o)o(vide)h(the)g(corr)m(ect)h(r)l(outing)e(addr)m(ess)h(via)g(a)h
(pr)l(operly)f(constructed)f(en)m(velope)o(.)-2 4477
y
SDict begin H.S end
 -2 4477 a -2 4477 a
SDict begin 13 H.A end
 -2 4477 a -2 4477 a
SDict begin [/View [/XYZ H.V]/Dest (0:1265) cvn /DEST pdfmark end
 -2 4477 a 396
4567 a Fk(So)i(R)m(OUTER)f(is)h(really)f(a)h(fully)e(controllable)g(R)m
(OUTER.)h(W)-7 b(e')o(ll)21 b(dig)f(into)g(this)h(magic)e(in)i(detail.)
-2 4752 y
SDict begin H.S end
 -2 4752 a -2 4752 a
SDict begin 13 H.A end
 -2 4752 a -2 4752 a
SDict begin [/View [/XYZ H.V]/Dest (0:1266) cvn /DEST pdfmark end
 -2
4752 a 396 4841 a Fk(But)g(\002rst,)g(and)e(because)h(we')l(re)f(going)
g(to)i(go)e(of)n(f-road)f(into)i(some)g(rough)e(and)i(possibly)g(ille)o
(gal)f(terrain)h(no)n(w)-5 b(,)19 b(let')-5 b(s)396 4949
y(look)20 b(closer)g(at)g(REQ)h(and)f(REP)-9 b(.)20 b(These)g(pro)o
(vide)e(your)h(kinder)o(garten)e(request-reply)h(sock)o(et)i(pattern.)f
(It')-5 b(s)21 b(an)f(easy)396 5057 y(pattern)g(to)g(learn)g(b)n(ut)g
(quite)g(rapidly)f(gets)h(anno)o(ying)e(as)j(it)g(pro)o(vides,)d(for)i
(instance,)f(no)h(w)o(ay)g(to)h(resend)e(a)i(request)e(if)396
5165 y(it)i(got)f(lost)h(for)e(some)h(reason.)p Black
3800 5569 a Ff(89)p Black eop end
%%Page: 90 103
TeXDict begin 90 102 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.90) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1292) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1267) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(While)21 b(we)f(usually)g(think)g
(of)f(request-reply)f(as)j(a)g(to-and-fro)c(pattern,)i(in)h(f)o(act)h
(it)g(can)f(be)g(fully)f(asynchronous,)f(as)396 180 y(long)i(as)h(we)f
(understand)e(that)i(an)o(y)g(REQs)h(and)f(REPS)h(will)g(be)f(at)h(the)
f(end)f(of)h(a)h(chain,)e(ne)n(v)o(er)g(in)h(the)h(middle)e(of)h(it,)
396 288 y(and)g(al)o(w)o(ays)h(synchronous.)c(All)k(we)f(need)g(to)g
(kno)n(w)f(is)i(the)f(address)g(of)g(the)g(peer)g(we)h(w)o(ant)f(to)g
(talk)g(to,)h(and)e(then)h(we)396 396 y(can)g(then)g(send)g(it)h
(messages)f(asynchronously)-5 b(,)16 b(via)21 b(a)f(R)m(OUTER.)g(The)g
(R)m(OUTER)h(is)g(the)f(one)g(and)f(only)h(\330MQ)396
504 y(sock)o(et)g(type)g(capable)f(of)h(being)f(told)h("send)g(this)h
(message)f(to)g(X")h(where)e(X)i(is)g(the)f(address)g(of)g(a)h
(connected)d(peer)-5 b(.)-2 688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2
688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:1268) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(These)20 b(are)g(the)h(w)o(ays)f
(we)h(can)f(kno)n(w)f(the)h(address)g(to)g(send)g(a)h(message)f(to,)g
(and)f(you')o(ll)h(see)g(most)h(of)f(these)g(used)g(in)396
886 y(the)g(e)o(xamples)g(of)f(custom)h(request-reply)e(routing:)-2
904 y
SDict begin H.S end
 -2 904 a -2 904 a
SDict begin 13 H.A end
 -2 904 a -2 904 a
SDict begin [/View [/XYZ H.V]/Dest (0:1269) cvn /DEST pdfmark end
 -2 904 a -2
914 a
SDict begin H.S end
 -2 914 a -2 914 a
SDict begin 13 H.A end
 -2 914 a -2 914 a
SDict begin [/View [/XYZ H.V]/Dest (0:1270) cvn /DEST pdfmark end
 -2 914 a Black
396 1056 a Fj(\225)p Black 479 1056 a
SDict begin H.S end
 479 1056 a 479
1056 a
SDict begin 13 H.A end
 479 1056 a 479 1056 a
SDict begin [/View [/XYZ H.V]/Dest (0:1271) cvn /DEST pdfmark end
 479 1056 a Fk(By)j(def)o(ault,)e(a)i(peer)
e(has)i(a)f(null)g(identity)g(and)f(the)i(R)m(OUTER)f(will)h(generate)e
(a)i(UUID)f(and)g(use)g(that)g(to)h(refer)e(to)479 1164
y(the)h(connection)f(when)g(it)i(deli)n(v)o(ers)e(you)h(each)f
(incoming)g(message)h(from)f(that)h(peer)-5 b(.)-2 1182
y
SDict begin H.S end
 -2 1182 a -2 1182 a
SDict begin 13 H.A end
 -2 1182 a -2 1182 a
SDict begin [/View [/XYZ H.V]/Dest (0:1272) cvn /DEST pdfmark end
 -2 1182 a Black
396 1314 a Fj(\225)p Black 479 1314 a
SDict begin H.S end
 479 1314 a 479
1314 a
SDict begin 13 H.A end
 479 1314 a 479 1314 a
SDict begin [/View [/XYZ H.V]/Dest (0:1273) cvn /DEST pdfmark end
 479 1314 a Fk(If)20 b(the)h(peer)e(sock)o
(et)h(set)h(an)f(identity)-5 b(,)19 b(the)h(R)m(OUTER)h(will)g(gi)n(v)o
(e)e(that)i(identity)e(when)h(it)g(deli)n(v)o(ers)g(an)g(incoming)479
1422 y(request)g(en)m(v)o(elope)e(from)h(that)h(peer)-5
b(.)-2 1440 y
SDict begin H.S end
 -2 1440 a -2 1440 a
SDict begin 13 H.A end
 -2 1440 a -2 1440 a
SDict begin [/View [/XYZ H.V]/Dest (0:1274) cvn /DEST pdfmark end

-2 1440 a Black 396 1571 a Fj(\225)p Black 479 1571 a
SDict begin H.S end

479 1571 a 479 1571 a
SDict begin 13 H.A end
 479 1571 a 479 1571 a
SDict begin [/View [/XYZ H.V]/Dest (0:1275) cvn /DEST pdfmark end
 479 1571
a Fk(Peers)21 b(with)f(e)o(xplicit)g(identities)g(can)g(send)g(them)g
(via)g(some)g(other)f(mechanism,)g(e.g.)h(via)g(some)g(other)f(sock)o
(ets.)-2 1589 y
SDict begin H.S end
 -2 1589 a -2 1589 a
SDict begin 13 H.A end
 -2 1589 a -2 1589
a
SDict begin [/View [/XYZ H.V]/Dest (0:1276) cvn /DEST pdfmark end
 -2 1589 a Black 396 1720 a Fj(\225)p Black 479 1720
a
SDict begin H.S end
 479 1720 a 479 1720 a
SDict begin 13 H.A end
 479 1720 a 479 1720 a
SDict begin [/View [/XYZ H.V]/Dest (0:1277) cvn /DEST pdfmark end
 479 1720
a Fk(Peers)i(can)f(ha)n(v)o(e)f(prior)h(kno)n(wledge)e(of)h(each)h
(others')g(identities,)g(e.g.)f(via)h(con\002guration)e(\002les)j(or)f
(some)g(other)479 1828 y(magic.)-2 2012 y
SDict begin H.S end
 -2 2012 a -2
2012 a
SDict begin 13 H.A end
 -2 2012 a -2 2012 a
SDict begin [/View [/XYZ H.V]/Dest (0:1278) cvn /DEST pdfmark end
 -2 2012 a 396 2102 a Fk(There)g(are)g(at)g
(least)h(three)f(routing)f(patterns,)g(one)h(for)f(each)h(of)g(the)g
(sock)o(et)g(types)g(we)h(can)f(easily)g(connect)f(to)i(a)396
2210 y(R)m(OUTER:)-2 2211 y
SDict begin H.S end
 -2 2211 a -2 2211 a
SDict begin 13 H.A end
 -2 2211
a -2 2211 a
SDict begin [/View [/XYZ H.V]/Dest (0:1279) cvn /DEST pdfmark end
 -2 2211 a -2 2221 a
SDict begin H.S end
 -2 2221 a -2 2221 a
SDict begin 13 H.A end
 -2
2221 a -2 2221 a
SDict begin [/View [/XYZ H.V]/Dest (0:1280) cvn /DEST pdfmark end
 -2 2221 a Black 396 2380 a Fj(\225)p
Black 479 2380 a
SDict begin H.S end
 479 2380 a 479 2380 a
SDict begin 13 H.A end
 479 2380 a 479
2380 a
SDict begin [/View [/XYZ H.V]/Dest (0:1281) cvn /DEST pdfmark end
 479 2380 a Fk(R)m(OUTER-to-DEALER.)-2 2381 y
SDict begin H.S end
 -2
2381 a -2 2381 a
SDict begin 13 H.A end
 -2 2381 a -2 2381 a
SDict begin [/View [/XYZ H.V]/Dest (0:1282) cvn /DEST pdfmark end
 -2 2381 a Black
396 2530 a Fj(\225)p Black 479 2530 a
SDict begin H.S end
 479 2530 a 479
2530 a
SDict begin 13 H.A end
 479 2530 a 479 2530 a
SDict begin [/View [/XYZ H.V]/Dest (0:1283) cvn /DEST pdfmark end
 479 2530 a Fk(R)m(OUTER-to-REQ.)-2
2545 y
SDict begin H.S end
 -2 2545 a -2 2545 a
SDict begin 13 H.A end
 -2 2545 a -2 2545 a
SDict begin [/View [/XYZ H.V]/Dest (0:1284) cvn /DEST pdfmark end
 -2 2545
a Black 396 2679 a Fj(\225)p Black 479 2679 a
SDict begin H.S end
 479 2679
a 479 2679 a
SDict begin 13 H.A end
 479 2679 a 479 2679 a
SDict begin [/View [/XYZ H.V]/Dest (0:1285) cvn /DEST pdfmark end
 479 2679 a Fk(R)m(OUTER-to-REP)-9
b(.)-2 2846 y
SDict begin H.S end
 -2 2846 a -2 2846 a
SDict begin 13 H.A end
 -2 2846 a -2 2846 a
SDict begin [/View [/XYZ H.V]/Dest (0:1286) cvn /DEST pdfmark end

-2 2846 a 396 2953 a Fk(In)20 b(each)g(of)g(these)g(cases)h(we)g(ha)n
(v)o(e)e(total)i(control)e(o)o(v)o(er)g(ho)n(w)g(we)i(route)e
(messages,)h(b)n(ut)g(the)h(dif)n(ferent)d(patterns)i(co)o(v)o(er)396
3061 y(dif)n(ferent)f(use-cases)h(and)g(message)g(\003o)n(ws.)g(Let')-5
b(s)21 b(break)e(it)i(do)n(wn)e(o)o(v)o(er)g(the)h(ne)o(xt)g(sections)g
(with)g(e)o(xamples)f(of)396 3169 y(dif)n(ferent)g(routing)f
(algorithms.)-2 3198 y
SDict begin H.S end
 -2 3198 a -2 3198 a
SDict begin 13 H.A end
 -2 3198 a
-2 3198 a
SDict begin [/View [/XYZ H.V]/Dest (0:1287) cvn /DEST pdfmark end
 -2 3198 a 359 x Fn(3.3.)39 b(R)m(OUTER-to-DEALER)34
b(Routing)2284 3557 y
SDict begin H.S end
 2284 3557 a 2284 3557 a
SDict begin 22.464 H.A end
 2284 3557
a 2284 3557 a
SDict begin [/View [/XYZ H.V]/Dest (8.48.1) cvn /DEST pdfmark end
 2284 3557 a -2 3755 a
SDict begin H.S end
 -2 3755 a -2 3755
a
SDict begin 13 H.A end
 -2 3755 a -2 3755 a
SDict begin [/View [/XYZ H.V]/Dest (0:1289) cvn /DEST pdfmark end
 -2 3755 a 396 3831 a Fk(The)20
b(R)m(OUTER-to-DEALER)f(pattern)g(is)i(the)g(simplest.)f(Y)-9
b(ou)19 b(connect)g(one)h(R)m(OUTER)h(to)f(man)o(y)f(DEALERs,)h(and)396
3939 y(then)g(distrib)n(ute)g(messages)g(to)g(the)h(DEALERs)f(using)g
(an)o(y)f(algorithm)g(you)g(lik)o(e.)h(The)g(DEALERs)h(can)f(be)g
(sinks)396 4047 y(\(process)g(the)g(messages)g(without)g(an)o(y)f
(response\),)g(proxies)g(\(send)g(the)i(messages)f(on)g(to)g(other)f
(nodes\),)g(or)h(services)396 4154 y(\(send)g(back)f(replies\).)-2
4338 y
SDict begin H.S end
 -2 4338 a -2 4338 a
SDict begin 13 H.A end
 -2 4338 a -2 4338 a
SDict begin [/View [/XYZ H.V]/Dest (0:1290) cvn /DEST pdfmark end
 -2 4338
a 396 4428 a Fk(If)h(you)g(e)o(xpect)f(the)h(DEALER)g(to)h(reply)-5
b(,)18 b(there)i(should)f(only)h(be)g(one)f(R)m(OUTER)i(talking)e(to)i
(it.)f(DEALERs)h(ha)n(v)o(e)e(no)396 4536 y(idea)h(ho)n(w)g(to)g(reply)
g(to)g(a)h(speci\002c)f(peer)m(,)f(so)i(if)f(the)o(y)g(ha)n(v)o(e)f
(multiple)h(peers,)f(the)o(y)h(will)h(just)g(round-robin)16
b(between)396 4644 y(them,)k(which)f(w)o(ould)h(be)g(weird.)g(If)g(the)
g(DEALER)g(is)h(a)g(sink,)f(an)o(y)f(number)g(of)g(R)m(OUTERs)i(can)f
(talk)h(to)f(it.)-2 4828 y
SDict begin H.S end
 -2 4828 a -2 4828 a
SDict begin 13 H.A end
 -2 4828
a -2 4828 a
SDict begin [/View [/XYZ H.V]/Dest (0:1291) cvn /DEST pdfmark end
 -2 4828 a 396 4918 a Fk(What)h(kind)e(of)h(routing)f(can)h
(you)f(do)h(with)g(a)h(R)m(OUTER-to-DEALER)e(pattern?)g(If)h(the)g
(DEALERs)h(talk)f(back)f(to)396 5026 y(the)h(R)m(OUTER,)h(e.g.)e
(telling)h(the)h(R)m(OUTER)f(when)g(the)o(y)f(\002nished)h(a)g(task,)h
(you)e(can)h(use)g(that)h(kno)n(wledge)d(to)i(route)p
Black 3800 5569 a Ff(90)p Black eop end
%%Page: 91 104
TeXDict begin 91 103 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.91) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fk(depending)18 b(on)i(ho)n(w)f(f)o(ast)i(a)
g(DEALER)f(is.)h(Since)f(both)f(R)m(OUTER)i(and)f(DEALER)g(are)g
(asynchronous,)d(it)k(can)f(get)g(a)396 180 y(little)h(trick)o(y)-5
b(.)19 b(Y)-9 b(ou')l(d)18 b(need)i(to)g(use)h(zmq_poll[3])c(at)k
(least.)396 454 y(W)-7 b(e')o(ll)22 b(mak)o(e)d(an)h(e)o(xample)f
(where)h(the)g(DEALERs)h(don')o(t)d(talk)i(back,)g(the)o(y')l(re)e
(pure)h(sinks.)i(Our)e(routing)g(algorithm)396 562 y(will)i(be)f(a)h
(weighted)e(random)f(scatter:)j(we)g(ha)n(v)o(e)e(tw)o(o)i(DEALERs)f
(and)g(we)g(send)g(twice)h(as)g(man)o(y)e(messages)h(to)g(one)396
670 y(as)h(to)g(the)f(other\()p 0 TeXcolorgray 894 670
a
SDict begin H.S end
 894 670 a Fk(Figure)e(3-5)1242 670 y
SDict begin 13 H.L end
 1242 670 a 1242
670 a
SDict begin [/Subtype /Link/Dest (0:figure-31) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1242 670 a Black -2 w Fk(\).)-2 688 y
SDict begin H.S end
 -2 688 a
-2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-31) cvn /DEST pdfmark
end
 -2 688 a 396 872 a Fg(Figur)o(e)i(3-5.)f(R)n
(OUTER-to-DEALER)h(Custom)g(Routing)-2 971 y
SDict begin H.S end
 -2 971 a
-2 971 a
SDict begin 13 H.A end
 -2 971 a -2 971 a
SDict begin [/View [/XYZ H.V]/Dest (0:1296) cvn /DEST pdfmark end
 -2 971 a 396 3096 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3096
a @beginspecial 0 @llx -250 @lly 322 @urx 0 @ury 3220
@rwi @setspecial
%%BeginDocument: images/fig31.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -250 322 0
%%HiResBoundingBox: 0.0 -250.0 322.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
68.10021209716797 -27.100210189819336 moveto
68.10021209716797 -65.10021209716797 lineto
166.10020446777344 -65.10021209716797 lineto
166.10020446777344 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
68.10021209716797 -68.10021209716797 moveto
68.10021209716797 -82.10021209716797 lineto
68.10021209716797 -85.4335454305013 69.4335454305013 -87.10021209716797 72.10021209716797 -87.10021209716797 curveto
163.10020446777344 -87.10021209716797 lineto
163.10020446777344 -87.10021209716797 lineto
165.10020446777344 -87.10021209716797 166.10020446777344 -85.4335454305013 166.10020446777344 -82.10021209716797 curveto
166.10020446777344 -68.50021362304688 lineto
166.10020446777344 -68.10021209716797 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.100210189819336 -157.10020446777344 moveto
20.433543523152668 -157.10020446777344 19.100210189819336 -158.7668711344401 19.100210189819336 -162.10020446777344 curveto
19.100210189819336 -185.10020446777344 lineto
103.10021209716797 -185.10020446777344 lineto
103.10021209716797 -162.10020446777344 lineto
103.10021209716797 -158.7668711344401 102.10021209716797 -157.10020446777344 100.10021209716797 -157.10020446777344 curveto
23.100210189819336 -157.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.100210189819336 -188.10020446777344 moveto
19.100210189819336 -227.10020446777344 lineto
103.10021209716797 -227.10020446777344 lineto
103.10021209716797 -188.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
135.10020446777344 -157.10020446777344 moveto
132.43353780110678 -157.10020446777344 131.10020446777344 -158.7668711344401 131.10020446777344 -162.10020446777344 curveto
131.10020446777344 -185.10020446777344 lineto
215.10020446777344 -185.10020446777344 lineto
215.10020446777344 -162.10020446777344 lineto
215.10020446777344 -158.7668711344401 214.10020446777344 -157.10020446777344 212.10020446777344 -157.10020446777344 curveto
135.10020446777344 -157.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
131.10020446777344 -188.10020446777344 moveto
131.10020446777344 -227.10020446777344 lineto
215.10020446777344 -227.10020446777344 lineto
215.10020446777344 -188.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
66.0 -25.0 moveto
66.0 -63.0 lineto
164.0 -63.0 lineto
164.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
66.0 -25.0 moveto
66.0 -63.0 lineto
164.0 -63.0 lineto
164.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
66.0 -66.0 moveto
66.0 -80.0 lineto
66.0 -83.33333333333333 67.33333333333333 -85.0 70.0 -85.0 curveto
161.0 -85.0 lineto
161.0 -85.0 lineto
163.0 -85.0 164.0 -83.33333333333333 164.0 -80.0 curveto
164.0 -66.4000015258789 lineto
164.0 -66.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
66.0 -66.0 moveto
66.0 -80.0 lineto
66.0 -83.33333333333333 67.33333333333333 -85.0 70.0 -85.0 curveto
161.0 -85.0 lineto
161.0 -85.0 lineto
163.0 -85.0 164.0 -83.33333333333333 164.0 -80.0 curveto
164.0 -66.4000015258789 lineto
164.0 -66.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
21.0 -155.0 moveto
18.333333333333332 -155.0 17.0 -156.66666666666666 17.0 -160.0 curveto
17.0 -183.0 lineto
101.0 -183.0 lineto
101.0 -160.0 lineto
101.0 -156.66666666666666 100.0 -155.0 98.0 -155.0 curveto
21.0 -155.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
21.0 -155.0 moveto
18.333333333333332 -155.0 17.0 -156.66666666666666 17.0 -160.0 curveto
17.0 -183.0 lineto
101.0 -183.0 lineto
101.0 -160.0 lineto
101.0 -156.66666666666666 100.0 -155.0 98.0 -155.0 curveto
21.0 -155.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
17.0 -186.0 moveto
17.0 -225.0 lineto
101.0 -225.0 lineto
101.0 -186.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
17.0 -186.0 moveto
17.0 -225.0 lineto
101.0 -225.0 lineto
101.0 -186.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
133.0 -155.0 moveto
130.33333333333334 -155.0 129.0 -156.66666666666666 129.0 -160.0 curveto
129.0 -183.0 lineto
213.0 -183.0 lineto
213.0 -160.0 lineto
213.0 -156.66666666666666 212.0 -155.0 210.0 -155.0 curveto
133.0 -155.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
133.0 -155.0 moveto
130.33333333333334 -155.0 129.0 -156.66666666666666 129.0 -160.0 curveto
129.0 -183.0 lineto
213.0 -183.0 lineto
213.0 -160.0 lineto
213.0 -156.66666666666666 212.0 -155.0 210.0 -155.0 curveto
133.0 -155.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
129.0 -186.0 moveto
129.0 -225.0 lineto
213.0 -225.0 lineto
213.0 -186.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
129.0 -186.0 moveto
129.0 -225.0 lineto
213.0 -225.0 lineto
213.0 -186.0 lineto
closepath
stroke
newpath
56.0 -140.0 moveto
59.0 -150.0 lineto
63.0 -140.0 lineto
closepath
fill
newpath
168.0 -140.0 moveto
171.0 -150.0 lineto
175.0 -140.0 lineto
closepath
fill
newpath
115.0 -85.0 moveto
115.0 -115.0 lineto
stroke
newpath
59.0 -145.0 moveto
59.0 -115.0 lineto
115.0 -115.0 lineto
stroke
newpath
171.0 -145.0 moveto
171.0 -115.0 lineto
115.0 -115.0 lineto
stroke
/Helvetica findfont
10 scalefont setfont
96.0 -49.0 moveto
(Client) show
195.0 -49.0 moveto
(Send to "A" or "B") show
92.0 -78.0 moveto
(ROUTER) show
37.0 -168.0 moveto
(DEALER) show
50.0 -179.0 moveto
("A") show
149.0 -168.0 moveto
(DEALER) show
163.0 -179.0 moveto
("B") show
35.0 -209.0 moveto
(Worker) show
154.0 -209.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3096 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3096 a -2 3262 a
SDict begin H.S end
 -2 3262
a -2 3262 a
SDict begin 13 H.A end
 -2 3262 a -2 3262 a
SDict begin [/View [/XYZ H.V]/Dest (0:1299) cvn /DEST pdfmark end
 -2 3262 a 396 3370 a
Fk(Here')-5 b(s)21 b(code)e(that)h(sho)n(ws)h(ho)n(w)e(this)i(w)o
(orks:)-2 3371 y
SDict begin H.S end
 -2 3371 a -2 3371 a
SDict begin 13 H.A end
 -2 3371 a -2 3371
a
SDict begin [/View [/XYZ H.V]/Dest (0:rtdealer-c) cvn /DEST pdfmark
end
 -2 3371 a 396 3572 a Fg(Example)g(3-2.)e(R)n(OUTER-to-DEALER)h
(\(rtdealer)-8 b(.c\))-2 3671 y
SDict begin H.S end
 -2 3671 a -2 3671 a
SDict begin 11.7 H.A end
 -2
3671 a -2 3671 a
SDict begin [/View [/XYZ H.V]/Dest (0:1302) cvn /DEST pdfmark end
 -2 3671 a 396 3752 a Fe(//)396 3849
y(//)90 b(Custom)43 b(routing)h(Router)g(to)g(Dealer)396
3946 y(//)396 4043 y(#include)g("zhelpers.h")396 4140
y(#include)g(<pthread.h>)396 4335 y(//)90 b(We)44 b(have)g(two)h
(workers,)e(here)h(we)h(copy)f(the)g(code,)g(normally)g(these)g(would)
396 4432 y(//)90 b(run)44 b(on)g(different)g(boxes...)396
4529 y(//)396 4626 y(static)g(void)934 4639 y(*)396 4723
y(worker_task_a)f(\(void)1293 4736 y(*)1338 4723 y(args\))396
4820 y({)576 4917 y(void)800 4930 y(*)845 4917 y(context)g(=)i
(zmq_ctx_new)e(\(\);)576 5015 y(void)800 5028 y(*)845
5015 y(worker)g(=)i(zmq_socket)e(\(context,)h(ZMQ_DEALER\);)576
5112 y(zmq_setsockopt)e(\(worker,)i(ZMQ_IDENTITY,)e("A",)i(1\);)p
Black 3800 5569 a Ff(91)p Black eop end
%%Page: 92 105
TeXDict begin 92 104 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.92) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 72 a Fe(zmq_connect)43 b(\(worker,)g
("ipc://routing.ipc"\);)576 267 y(int)h(total)g(=)h(0;)576
364 y(while)f(\(true\))f({)755 461 y(//)89 b(We)45 b(receive)e(one)i
(part,)f(with)g(the)g(workload)755 558 y(char)979 571
y(*)1024 558 y(request)g(=)g(s_recv)g(\(worker\);)755
655 y(int)g(finished)g(=)g(\(strcmp)g(\(request,)f("END"\))h(==)h(0\);)
755 752 y(free)f(\(request\);)755 850 y(if)g(\(finished\))g({)934
947 y(printf)g(\("A)g(received:)g(\045d\\n",)g(total\);)934
1044 y(break;)755 1141 y(})755 1238 y(total++;)576 1335
y(})576 1432 y(zmq_close)f(\(worker\);)576 1530 y(zmq_ctx_destroy)f
(\(context\);)576 1627 y(return)h(NULL;)396 1724 y(})396
1918 y(static)h(void)934 1931 y(*)396 2015 y(worker_task_b)f(\(void)
1293 2028 y(*)1338 2015 y(args\))396 2112 y({)576 2209
y(void)800 2222 y(*)845 2209 y(context)g(=)i(zmq_ctx_new)e(\(\);)576
2307 y(void)800 2320 y(*)845 2307 y(worker)g(=)i(zmq_socket)e
(\(context,)h(ZMQ_DEALER\);)576 2404 y(zmq_setsockopt)e(\(worker,)i
(ZMQ_IDENTITY,)e("B",)i(1\);)576 2501 y(zmq_connect)f(\(worker,)g
("ipc://routing.ipc"\);)576 2695 y(int)h(total)g(=)h(0;)576
2792 y(while)f(\(true\))f({)755 2889 y(//)89 b(We)45
b(receive)e(one)i(part,)f(with)g(the)g(workload)755 2987
y(char)979 3000 y(*)1024 2987 y(request)g(=)g(s_recv)g(\(worker\);)755
3084 y(int)g(finished)g(=)g(\(strcmp)g(\(request,)f("END"\))h(==)h
(0\);)755 3181 y(free)f(\(request\);)755 3278 y(if)g(\(finished\))g({)
934 3375 y(printf)g(\("B)g(received:)g(\045d\\n",)g(total\);)934
3472 y(break;)755 3569 y(})755 3666 y(total++;)576 3764
y(})576 3861 y(zmq_close)f(\(worker\);)576 3958 y(zmq_ctx_destroy)f
(\(context\);)576 4055 y(return)h(NULL;)396 4152 y(})-2
4326 y
SDict begin H.S end
 -2 4326 a -2 4326 a
SDict begin 13 H.A end
 -2 4326 a -2 4326 a
SDict begin [/View [/XYZ H.V]/Dest (0:1303) cvn /DEST pdfmark end
 -2 4326
a 396 4426 a Fk(After)20 b(we')l(v)o(e)e(de\002ned)h(the)h(tw)o(o)g(w)o
(ork)o(er)f(tasks,)h(we)g(ha)n(v)o(e)f(the)h(main)f(task.)h(Recall)g
(that)g(these)g(three)f(tasks)h(could)f(be)h(in)396 4534
y(separate)g(processes,)g(e)n(v)o(en)f(running)f(on)i(dif)n(ferent)e
(box)o(es.)h(It')-5 b(s)21 b(just)g(easier)f(to)g(start)h(by)f(writing)
f(these)i(in)f(a)h(single)396 4642 y(program.)d(The)i(main)g(task)g
(starts)h(the)f(tw)o(o)h(w)o(ork)o(ers,)e(then)h(scatters)h(tasks)f(to)
h(the)f(w)o(ork)o(ers.)f(It)i(sends)f(an)g(END)396 4750
y(message)g(to)h(each)e(w)o(ork)o(er)h(to)g(tell)h(them)f(to)g(e)o
(xit:)-2 4768 y
SDict begin H.S end
 -2 4768 a -2 4768 a
SDict begin 13 H.A end
 -2 4768 a -2 4768
a
SDict begin [/View [/XYZ H.V]/Dest (0:rtdealer-c-1) cvn /DEST pdfmark
end
 -2 4768 a Black 3800 5569 a Ff(92)p Black eop end
%%Page: 93 106
TeXDict begin 93 105 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.93) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Example)21 b(3-3.)e(R)n(OUTER-to-DEALER)h
(\(rtdealer)-8 b(.c\))18 b(-)i(main)h(task)-2 172 y
SDict begin H.S end
 -2
172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1306) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(int)45
b(main)f(\(void\))396 447 y({)576 544 y(void)800 557
y(*)845 544 y(context)f(=)i(zmq_ctx_new)e(\(\);)576 641
y(void)800 654 y(*)845 641 y(client)g(=)i(zmq_socket)e(\(context,)h
(ZMQ_ROUTER\);)576 738 y(zmq_bind)f(\(client,)h("ipc://routing.ipc"\);)
576 933 y(pthread_t)f(worker;)576 1030 y(pthread_create)f(\(&worker,)h
(NULL,)h(worker_task_a,)f(NULL\);)576 1127 y(pthread_create)f
(\(&worker,)h(NULL,)h(worker_task_b,)f(NULL\);)576 1321
y(//)89 b(Wait)44 b(for)g(threads)g(to)h(connect,)e(since)h(otherwise)f
(the)i(messages)576 1418 y(//)89 b(we)44 b(send)h(won't)f(be)g
(routable.)576 1515 y(sleep)g(\(1\);)576 1710 y(//)89
b(Send)44 b(10)h(tasks)f(scattered)f(to)h(A)h(twice)f(as)h(often)f(as)g
(B)576 1807 y(int)g(task_nbr;)576 1904 y(srandom)f(\(\(unsigned\))g
(time)h(\(NULL\)\);)576 2001 y(for)g(\(task_nbr)f(=)i(0;)f(task_nbr)g
(<)h(10;)f(task_nbr++\))f({)755 2098 y(//)89 b(Send)44
b(two)h(message)e(parts,)h(first)g(the)h(address...)755
2195 y(if)f(\(randof)g(\(3\))g(>)h(0\))934 2292 y(s_sendmore)e
(\(client,)h("A"\);)755 2390 y(else)934 2487 y(s_sendmore)f(\(client,)h
("B"\);)755 2681 y(//)89 b(And)45 b(then)f(the)g(workload)755
2778 y(s_send)g(\(client,)f("This)h(is)h(the)f(workload"\);)576
2875 y(})576 2972 y(s_sendmore)f(\(client,)g("A"\);)576
3070 y(s_send)223 b(\(client,)43 b("END"\);)576 3264
y(s_sendmore)g(\(client,)g("B"\);)576 3361 y(s_send)223
b(\(client,)43 b("END"\);)576 3555 y(zmq_close)g(\(client\);)576
3652 y(zmq_ctx_destroy)f(\(context\);)576 3750 y(return)h(0;)396
3847 y(})-2 4021 y
SDict begin H.S end
 -2 4021 a -2 4021 a
SDict begin 13 H.A end
 -2 4021 a -2 4021
a
SDict begin [/View [/XYZ H.V]/Dest (0:1307) cvn /DEST pdfmark end
 -2 4021 a 396 4121 a Fk(Some)20 b(comments)f(on)h(this)h(code:)-2
4122 y
SDict begin H.S end
 -2 4122 a -2 4122 a
SDict begin 13 H.A end
 -2 4122 a -2 4122 a
SDict begin [/View [/XYZ H.V]/Dest (0:1308) cvn /DEST pdfmark end
 -2 4122
a -2 4132 a
SDict begin H.S end
 -2 4132 a -2 4132 a
SDict begin 13 H.A end
 -2 4132 a -2 4132 a
SDict begin [/View [/XYZ H.V]/Dest (0:1309) cvn /DEST pdfmark end
 -2
4132 a Black 396 4291 a Fj(\225)p Black 479 4291 a
SDict begin H.S end
 479
4291 a 479 4291 a
SDict begin 13 H.A end
 479 4291 a 479 4291 a
SDict begin [/View [/XYZ H.V]/Dest (0:1310) cvn /DEST pdfmark end
 479 4291 a Fk(The)f(R)m(OUTER)h
(doesn')o(t)d(kno)n(w)h(when)h(the)g(DEALERs)h(are)f(ready)-5
b(,)18 b(and)i(it)h(w)o(ould)e(be)i(distracting)e(for)g(our)479
4399 y(e)o(xample)g(to)h(add)g(in)g(the)h(signaling)e(to)h(do)g(that.)g
(So)g(the)h(R)m(OUTER)f(just)h(does)f(a)g("sleep)h(\(1\)")e(after)h
(starting)g(the)479 4507 y(DEALER)g(threads.)g(W)m(ithout)f(this)i
(sleep,)f(the)g(R)m(OUTER)h(will)g(send)f(out)g(messages)g(that)g(can')
o(t)f(be)i(routed,)d(and)479 4615 y(\330MQ)j(will)g(discard)e(them.)-2
4630 y
SDict begin H.S end
 -2 4630 a -2 4630 a
SDict begin 13 H.A end
 -2 4630 a -2 4630 a
SDict begin [/View [/XYZ H.V]/Dest (0:1311) cvn /DEST pdfmark end
 -2 4630
a Black 396 4764 a Fj(\225)p Black 479 4764 a
SDict begin H.S end
 479 4764
a 479 4764 a
SDict begin 13 H.A end
 479 4764 a 479 4764 a
SDict begin [/View [/XYZ H.V]/Dest (0:1312) cvn /DEST pdfmark end
 479 4764 a Fk(Note)h(that)h(this)f
(beha)n(vior)f(is)i(speci\002c)g(to)f(R)m(OUTERs.)g(PUB)i(sock)o(ets)e
(will)h(also)f(discard)g(messages)g(if)h(there)f(are)479
4872 y(no)g(subscribers,)f(b)n(ut)h(all)h(other)e(sock)o(et)h(types)g
(will)h(queue)e(sent)i(messages)f(until)g(there')-5 b(s)20
b(a)h(peer)f(to)g(recei)n(v)o(e)f(them.)p Black 3800
5569 a Ff(93)p Black eop end
%%Page: 94 107
TeXDict begin 94 106 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.94) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1313) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(T)g(o)21 b(route)e(to)h(a)h(DEALER,)f(we)
g(create)g(an)h(en)m(v)o(elope)c(consisting)j(of)g(just)h(an)f
(identity)f(frame)g(\(we)i(don')o(t)d(need)i(a)g(null)396
180 y(separator\)\()p 0 TeXcolorgray 758 180 a
SDict begin H.S end
 758 180
a Fk(Figure)d(3-6)1105 180 y
SDict begin 13 H.L end
 1105 180 a 1105 180 a
SDict begin [/Subtype /Link/Dest (0:figure-32) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1105
180 a Black -1 w Fk(\).)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2
198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-32) cvn /DEST pdfmark
end
 -2 198 a 396 382 a Fg(Figur)o(e)j(3-6.)f(Routing)h(En)m
(v)o(elope)g(f)n(or)f(DEALER)-2 482 y
SDict begin H.S end
 -2 482 a -2 482
a
SDict begin 13 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:1317) cvn /DEST pdfmark end
 -2 482 a 396 1123 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1123 a @beginspecial
0 @llx -72 @lly 275 @urx 0 @ury 2750 @rwi @setspecial
%%BeginDocument: images/fig32.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -72 275 0
%%HiResBoundingBox: 0.0 -72.0 275.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -21.500150680541992 moveto
63.50014877319336 -37.50014877319336 lineto
133.50015258789062 -37.50014877319336 lineto
133.50015258789062 -21.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -37.50014877319336 moveto
63.50014877319336 -53.50014877319336 lineto
263.5001525878906 -53.50014877319336 lineto
263.5001525878906 -37.50014877319336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -20.0 moveto
62.0 -36.0 lineto
132.0 -36.0 lineto
132.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -20.0 moveto
62.0 -36.0 lineto
132.0 -36.0 lineto
132.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -36.0 moveto
62.0 -52.0 lineto
262.0 -52.0 lineto
262.0 -36.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -36.0 moveto
62.0 -52.0 lineto
262.0 -52.0 lineto
262.0 -36.0 lineto
closepath
stroke
/Helvetica findfont
7 scalefont setfont
11.0 -31.0 moveto
(Frame 1) show
72.0 -31.0 moveto
(Address) show
11.0 -47.0 moveto
(Frame 2) show
71.0 -47.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1123 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1123 a -2 1289 a
SDict begin H.S end
 -2 1289
a -2 1289 a
SDict begin 13 H.A end
 -2 1289 a -2 1289 a
SDict begin [/View [/XYZ H.V]/Dest (0:1320) cvn /DEST pdfmark end
 -2 1289 a 396 1397 a
Fk(The)h(R)m(OUTER)h(sock)o(et)f(remo)o(v)o(es)e(the)i(\002rst)h
(frame,)e(and)h(sends)g(the)h(second)e(frame,)g(which)h(the)g(DEALER)g
(gets)396 1505 y(as-is.)h(When)f(the)g(DEALER)g(sends)h(a)f(message)g
(to)h(the)f(R)m(OUTER,)g(it)h(sends)f(one)g(frame.)f(The)h(R)m(OUTER)g
(prepends)396 1613 y(the)g(DEALER')-5 b(s)21 b(address)f(and)f(gi)n(v)o
(es)h(us)h(back)e(a)i(similar)f(en)m(v)o(elope)e(in)i(tw)o(o)h(parts.)
-2 1797 y
SDict begin H.S end
 -2 1797 a -2 1797 a
SDict begin 13 H.A end
 -2 1797 a -2 1797 a
SDict begin [/View [/XYZ H.V]/Dest (0:1321) cvn /DEST pdfmark end
 -2
1797 a 396 1887 a Fk(Something)e(to)h(note:)g(if)g(you)g(use)g(an)g(in)
m(v)n(alid)f(address,)h(the)g(R)m(OUTER)h(discards)e(the)i(message)f
(silently)-5 b(.)19 b(There)h(is)396 1995 y(not)f(much)g(else)h(it)g
(can)f(do)g(usefully)-5 b(.)18 b(In)h(normal)f(cases)i(this)g(either)f
(means)h(the)f(peer)g(has)g(gone)g(a)o(w)o(ay)-5 b(,)18
b(or)h(that)h(there)f(is)396 2103 y(a)h(programming)d(error)h(some)n
(where)h(and)g(you')l(re)f(using)h(a)h(bogus)f(address.)g(In)h(an)o(y)f
(case)h(you)f(cannot)g(e)n(v)o(er)g(assume)g(a)396 2211
y(message)h(will)h(be)f(routed)f(successfully)h(until)g(and)f(unless)i
(you)e(get)h(a)h(reply)e(of)h(some)g(sort)g(from)g(the)g(destination)
396 2319 y(node.)f(W)-7 b(e')o(ll)21 b(come)f(to)g(creating)g(reliable)
f(patterns)h(later)g(on.)-2 2503 y
SDict begin H.S end
 -2 2503 a -2 2503
a
SDict begin 13 H.A end
 -2 2503 a -2 2503 a
SDict begin [/View [/XYZ H.V]/Dest (0:1322) cvn /DEST pdfmark end
 -2 2503 a 396 2593 a Fk(DEALERs)h(in)f(f)o(act)g
(w)o(ork)g(e)o(xactly)f(lik)o(e)i(PUSH)g(and)e(PULL)i(combined.)d(Do)i
(not)g(ho)n(we)n(v)o(er)e(connect)h(PUSH)i(or)396 2701
y(PULL)g(sock)o(ets)f(to)g(DEALERS.)g(That)g(w)o(ould)g(just)g(be)h
(nasty)f(and)f(pointless.)-2 2729 y
SDict begin H.S end
 -2 2729 a -2 2729
a
SDict begin 13 H.A end
 -2 2729 a -2 2729 a
SDict begin [/View [/XYZ H.V]/Dest (0:1323) cvn /DEST pdfmark end
 -2 2729 a 359 x Fn(3.4.)39 b(Least-Recentl)n(y)d
(Used)j(Routing)e(\(LR)m(U)i(P)l(attern\))3227 3088 y
SDict begin H.S end

3227 3088 a 3227 3088 a
SDict begin 22.464 H.A end
 3227 3088 a 3227 3088 a
SDict begin [/View [/XYZ H.V]/Dest (8.49.1) cvn /DEST pdfmark end
 3227
3088 a -2 3286 a
SDict begin H.S end
 -2 3286 a -2 3286 a
SDict begin 13 H.A end
 -2 3286 a -2 3286
a
SDict begin [/View [/XYZ H.V]/Dest (0:1325) cvn /DEST pdfmark end
 -2 3286 a 396 3362 a Fk(REQ)21 b(sock)o(ets)f(don')o(t)f(listen)i(to)
f(you,)f(and)h(if)g(you)f(try)h(to)h(speak)f(out)f(of)h(turn)g(the)o
(y')o(ll)f(ignore)g(you.)g(Y)-9 b(ou)20 b(ha)n(v)o(e)f(to)i(w)o(ait)396
3470 y(for)f(them)g(to)g(say)g(something,)f(and)1445
3470 y
SDict begin H.S end
 1445 3470 a 1445 3470 a
SDict begin 13 H.A end
 1445 3470 a 1445 3470
a
SDict begin [/View [/XYZ H.V]/Dest (0:1326) cvn /DEST pdfmark end
 1445 3470 a Ff(then)h Fk(you)f(can)h(gi)n(v)o(e)g(a)g(sarcastic)h
(answer)-5 b(.)20 b(This)h(is)g(v)o(ery)e(useful)g(for)h(routing)396
3578 y(because)g(it)h(means)f(we)g(can)g(k)o(eep)g(a)g(b)n(unch)f(of)h
(REQs)h(w)o(aiting)f(for)g(answers.)g(In)g(ef)n(fect,)f(a)i(REQ)g(sock)
o(et)f(will)h(tell)f(us)396 3686 y(when)g(it')-5 b(s)21
b(ready)-5 b(.)-2 3870 y
SDict begin H.S end
 -2 3870 a -2 3870 a
SDict begin 13 H.A end
 -2 3870
a -2 3870 a
SDict begin [/View [/XYZ H.V]/Dest (0:1327) cvn /DEST pdfmark end
 -2 3870 a 396 3960 a Fk(Y)c(ou)20 b(can)g(connect)f(one)g
(R)m(OUTER)i(to)f(man)o(y)f(REQs,)i(and)f(distrib)n(ute)g(messages)g
(as)h(you)e(w)o(ould)h(to)g(DEALERs.)396 4068 y(REQs)g(will)f(usually)g
(w)o(ant)g(to)f(reply)-5 b(,)18 b(b)n(ut)h(the)o(y)f(will)h(let)g(you)f
(ha)n(v)o(e)g(the)h(last)h(w)o(ord.)e(Ho)n(we)n(v)o(er)f(it')-5
b(s)20 b(one)e(thing)g(at)h(a)g(time:)-2 4086 y
SDict begin H.S end
 -2 4086
a -2 4086 a
SDict begin 13 H.A end
 -2 4086 a -2 4086 a
SDict begin [/View [/XYZ H.V]/Dest (0:1328) cvn /DEST pdfmark end
 -2 4086 a -2 4096 a
SDict begin H.S end
 -2
4096 a -2 4096 a
SDict begin 13 H.A end
 -2 4096 a -2 4096 a
SDict begin [/View [/XYZ H.V]/Dest (0:1329) cvn /DEST pdfmark end
 -2 4096 a Black
396 4238 a Fj(\225)p Black 479 4238 a
SDict begin H.S end
 479 4238 a 479
4238 a
SDict begin 13 H.A end
 479 4238 a 479 4238 a
SDict begin [/View [/XYZ H.V]/Dest (0:1330) cvn /DEST pdfmark end
 479 4238 a Fk(REQ)i(speaks)f(to)h(R)m
(OUTER)-2 4256 y
SDict begin H.S end
 -2 4256 a -2 4256 a
SDict begin 13 H.A end
 -2 4256 a -2 4256
a
SDict begin [/View [/XYZ H.V]/Dest (0:1331) cvn /DEST pdfmark end
 -2 4256 a Black 396 4387 a Fj(\225)p Black 479 4387
a
SDict begin H.S end
 479 4387 a 479 4387 a
SDict begin 13 H.A end
 479 4387 a 479 4387 a
SDict begin [/View [/XYZ H.V]/Dest (0:1332) cvn /DEST pdfmark end
 479 4387
a Fk(R)m(OUTER)g(replies)f(to)g(REQ)-2 4405 y
SDict begin H.S end
 -2 4405
a -2 4405 a
SDict begin 13 H.A end
 -2 4405 a -2 4405 a
SDict begin [/View [/XYZ H.V]/Dest (0:1333) cvn /DEST pdfmark end
 -2 4405 a Black 396 4537
a Fj(\225)p Black 479 4537 a
SDict begin H.S end
 479 4537 a 479 4537 a
SDict begin 13 H.A end
 479
4537 a 479 4537 a
SDict begin [/View [/XYZ H.V]/Dest (0:1334) cvn /DEST pdfmark end
 479 4537 a Fk(REQ)h(speaks)f(to)h(R)m(OUTER)-2
4555 y
SDict begin H.S end
 -2 4555 a -2 4555 a
SDict begin 13 H.A end
 -2 4555 a -2 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:1335) cvn /DEST pdfmark end
 -2 4555
a Black 396 4686 a Fj(\225)p Black 479 4686 a
SDict begin H.S end
 479 4686
a 479 4686 a
SDict begin 13 H.A end
 479 4686 a 479 4686 a
SDict begin [/View [/XYZ H.V]/Dest (0:1336) cvn /DEST pdfmark end
 479 4686 a Fk(R)m(OUTER)g(replies)f
(to)g(REQ)-2 4704 y
SDict begin H.S end
 -2 4704 a -2 4704 a
SDict begin 13 H.A end
 -2 4704 a -2
4704 a
SDict begin [/View [/XYZ H.V]/Dest (0:1337) cvn /DEST pdfmark end
 -2 4704 a Black 396 4836 a Fj(\225)p Black 479
4836 a
SDict begin H.S end
 479 4836 a 479 4836 a
SDict begin 13 H.A end
 479 4836 a 479 4836 a
SDict begin [/View [/XYZ H.V]/Dest (0:1338) cvn /DEST pdfmark end
 479
4836 a Fk(etc.)p Black 3800 5569 a Ff(94)p Black eop
end
%%Page: 95 108
TeXDict begin 95 107 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.95) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1339) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(Lik)o(e)20 b(DEALERs,)h(REQs)g(can)f
(only)f(talk)h(to)h(one)e(R)m(OUTER)i(and)e(since)i(REQs)g(al)o(w)o
(ays)g(start)f(by)g(talking)f(to)i(the)396 180 y(R)m(OUTER,)g(you)e
(should)g(ne)n(v)o(er)g(connect)g(one)g(REQ)i(to)g(more)e(than)h(one)f
(R)m(OUTER)i(unless)f(you)f(are)i(doing)d(sneak)o(y)396
288 y(stuf)n(f)i(lik)o(e)h(multi-pathw)o(ay)d(redundant)g(routing\()p
0 TeXcolorgray 1839 288 a
SDict begin H.S end
 1839 288 a Fk(Figure)f(3-7)2186
288 y
SDict begin 13 H.L end
 2186 288 a 2186 288 a
SDict begin [/Subtype /Link/Dest (0:figure-33) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2186 288 a Black -2 w Fk(\).)j(I'm)g(not)g
(e)n(v)o(en)f(going)g(to)h(e)o(xplain)f(that)h(no)n(w)-5
b(,)19 b(and)396 396 y(hopefully)f(the)i(jar)o(gon)f(is)i(comple)o(x)d
(enough)h(to)h(stop)g(you)f(trying)g(this)i(until)f(you)f(need)h(it.)-2
414 y
SDict begin H.S end
 -2 414 a -2 414 a
SDict begin 13 H.A end
 -2 414 a -2 414 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-33) cvn /DEST pdfmark
end
 -2 414 a 396
598 a Fg(Figur)o(e)g(3-7.)f(R)n(OUTER)h(to)g(REQ)h(Custom)f(Routing)-2
697 y
SDict begin H.S end
 -2 697 a -2 697 a
SDict begin 13 H.A end
 -2 697 a -2 697 a
SDict begin [/View [/XYZ H.V]/Dest (0:1343) cvn /DEST pdfmark end
 -2 697 a 396
2472 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2472 a @beginspecial 0 @llx -208 @lly 324
@urx 0 @ury 3240 @rwi @setspecial
%%BeginDocument: images/fig33.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -208 324 0
%%HiResBoundingBox: 0.0 -208.0 324.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -21.800180435180664 moveto
58.80017852783203 -51.80017852783203 lineto
142.80018615722656 -51.80017852783203 lineto
142.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -54.80017852783203 moveto
58.80017852783203 -65.80017852783203 lineto
58.80017852783203 -68.4668451944987 59.80017852783203 -69.80017852783203 61.80017852783203 -69.80017852783203 curveto
139.80018615722656 -69.80017852783203 lineto
139.80018615722656 -69.80017852783203 lineto
141.80018615722656 -69.80017852783203 142.80018615722656 -68.4668451944987 142.80018615722656 -65.80017852783203 curveto
142.80018615722656 -55.000179290771484 lineto
142.80018615722656 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -133.80018615722656 moveto
17.800180435180664 -133.80018615722656 16.800180435180664 -135.1335194905599 16.800180435180664 -137.80018615722656 curveto
16.800180435180664 -155.80018615722656 lineto
88.80017852783203 -155.80018615722656 lineto
88.80017852783203 -137.80018615722656 lineto
88.80017852783203 -135.1335194905599 87.80017852783203 -133.80018615722656 85.80017852783203 -133.80018615722656 curveto
19.800180435180664 -133.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -158.80018615722656 moveto
16.800180435180664 -189.80018615722656 lineto
88.80017852783203 -189.80018615722656 lineto
88.80017852783203 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -133.80018615722656 moveto
113.80017852783203 -133.80018615722656 112.80017852783203 -135.1335194905599 112.80017852783203 -137.80018615722656 curveto
112.80017852783203 -155.80018615722656 lineto
184.80018615722656 -155.80018615722656 lineto
184.80018615722656 -137.80018615722656 lineto
184.80018615722656 -135.1335194905599 183.80018615722656 -133.80018615722656 181.80018615722656 -133.80018615722656 curveto
115.80017852783203 -133.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -158.80018615722656 moveto
112.80017852783203 -189.80018615722656 lineto
184.80018615722656 -189.80018615722656 lineto
184.80018615722656 -158.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -20.0 moveto
57.0 -50.0 lineto
141.0 -50.0 lineto
141.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
57.0 -20.0 moveto
57.0 -50.0 lineto
141.0 -50.0 lineto
141.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -53.0 moveto
57.0 -64.0 lineto
57.0 -66.66666666666667 58.0 -68.0 60.0 -68.0 curveto
138.0 -68.0 lineto
138.0 -68.0 lineto
140.0 -68.0 141.0 -66.66666666666667 141.0 -64.0 curveto
141.0 -53.20000076293945 lineto
141.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -53.0 moveto
57.0 -64.0 lineto
57.0 -66.66666666666667 58.0 -68.0 60.0 -68.0 curveto
138.0 -68.0 lineto
138.0 -68.0 lineto
140.0 -68.0 141.0 -66.66666666666667 141.0 -64.0 curveto
141.0 -53.20000076293945 lineto
141.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -132.0 moveto
16.0 -132.0 15.0 -133.33333333333334 15.0 -136.0 curveto
15.0 -154.0 lineto
87.0 -154.0 lineto
87.0 -136.0 lineto
87.0 -133.33333333333334 86.0 -132.0 84.0 -132.0 curveto
18.0 -132.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -132.0 moveto
16.0 -132.0 15.0 -133.33333333333334 15.0 -136.0 curveto
15.0 -154.0 lineto
87.0 -154.0 lineto
87.0 -136.0 lineto
87.0 -133.33333333333334 86.0 -132.0 84.0 -132.0 curveto
18.0 -132.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -157.0 moveto
15.0 -188.0 lineto
87.0 -188.0 lineto
87.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -157.0 moveto
15.0 -188.0 lineto
87.0 -188.0 lineto
87.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -132.0 moveto
112.0 -132.0 111.0 -133.33333333333334 111.0 -136.0 curveto
111.0 -154.0 lineto
183.0 -154.0 lineto
183.0 -136.0 lineto
183.0 -133.33333333333334 182.0 -132.0 180.0 -132.0 curveto
114.0 -132.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -132.0 moveto
112.0 -132.0 111.0 -133.33333333333334 111.0 -136.0 curveto
111.0 -154.0 lineto
183.0 -154.0 lineto
183.0 -136.0 lineto
183.0 -133.33333333333334 182.0 -132.0 180.0 -132.0 curveto
114.0 -132.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -157.0 moveto
111.0 -188.0 lineto
183.0 -188.0 lineto
183.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -157.0 moveto
111.0 -188.0 lineto
183.0 -188.0 lineto
183.0 -157.0 lineto
closepath
stroke
newpath
99.0 -72.0 moveto
96.0 -80.0 lineto
102.0 -80.0 lineto
closepath
fill
newpath
48.0 -120.0 moveto
51.0 -128.0 lineto
54.0 -120.0 lineto
closepath
fill
newpath
144.0 -120.0 moveto
147.0 -128.0 lineto
150.0 -120.0 lineto
closepath
fill
newpath
99.0 -76.0 moveto
99.0 -100.0 lineto
stroke
newpath
51.0 -124.0 moveto
51.0 -100.0 lineto
99.0 -100.0 lineto
stroke
newpath
147.0 -124.0 moveto
147.0 -100.0 lineto
99.0 -100.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
83.0 -39.0 moveto
(Client) show
175.0 -39.0 moveto
(Send to "A" or "B") show
78.0 -63.0 moveto
(ROUTER) show
124.0 -87.0 moveto
(\(1\) REQ says Hi) show
181.0 -119.0 moveto
(\(2\) ROUTER gives laundry) show
42.0 -143.0 moveto
(REQ) show
44.0 -151.0 moveto
("A") show
138.0 -143.0 moveto
(REQ) show
140.0 -151.0 moveto
("B") show
32.0 -175.0 moveto
(Worker) show
134.0 -175.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2472 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2472 a -2 2638 a
SDict begin H.S end
 -2 2638
a -2 2638 a
SDict begin 13 H.A end
 -2 2638 a -2 2638 a
SDict begin [/View [/XYZ H.V]/Dest (0:1346) cvn /DEST pdfmark end
 -2 2638 a 396 2746 a
Fk(What)h(kind)e(of)h(routing)f(can)h(you)f(do)h(with)g(a)h(R)m
(OUTER-to-REQ)e(pattern?)g(Probably)g(the)h(most)g(ob)o(vious)f(is)396
2854 y("least-recently-used")f(\(LR)m(U\),)h(where)h(we)g(al)o(w)o(ays)
h(route)e(to)i(the)f(REQ)h(that')-5 b(s)21 b(been)e(w)o(aiting)h
(longest.)f(Here)h(is)i(an)396 2962 y(e)o(xample)d(that)h(does)g(LR)m
(U)h(routing)d(to)j(a)f(set)h(of)f(REQs:)-2 2980 y
SDict begin H.S end
 -2
2980 a -2 2980 a
SDict begin 13 H.A end
 -2 2980 a -2 2980 a
SDict begin [/View [/XYZ H.V]/Dest (0:rtmama-c) cvn /DEST pdfmark end
 -2 2980 a 396 3163
a Fg(Example)h(3-4.)e(R)n(OUTER-to-REQ)g(\(rtmama.c\))-2
3263 y
SDict begin H.S end
 -2 3263 a -2 3263 a
SDict begin 11.7 H.A end
 -2 3263 a -2 3263 a
SDict begin [/View [/XYZ H.V]/Dest (0:1349) cvn /DEST pdfmark end
 -2 3263
a 396 3344 a Fe(//)396 3441 y(//)90 b(Custom)43 b(routing)h(Router)g
(to)g(Mama)h(\(ROUTER)e(to)i(REQ\))396 3538 y(//)396
3635 y(#include)f("zhelpers.h")396 3732 y(#include)g(<pthread.h>)396
3926 y(#define)g(NBR_WORKERS)f(10)396 4121 y(static)h(void)934
4134 y(*)396 4218 y(worker_task)f(\(void)1203 4231 y(*)1248
4218 y(args\))396 4315 y({)576 4412 y(void)800 4425 y(*)845
4412 y(context)g(=)i(zmq_ctx_new)e(\(\);)576 4509 y(void)800
4522 y(*)845 4509 y(worker)g(=)i(zmq_socket)e(\(context,)h(ZMQ_REQ\);)
576 4704 y(//)89 b(We)44 b(use)h(a)f(string)g(identity)g(for)g(ease)g
(here)576 4801 y(s_set_id)f(\(worker\);)576 4898 y(zmq_connect)g
(\(worker,)g("ipc://routing.ipc"\);)576 5092 y(int)h(total)g(=)h(0;)p
Black 3800 5569 a Ff(95)p Black eop end
%%Page: 96 109
TeXDict begin 96 108 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.96) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 72 a Fe(while)44 b(\(true\))f({)755
170 y(//)89 b(Tell)44 b(the)h(router)f(we're)g(ready)g(for)g(work)755
267 y(s_send)g(\(worker,)f("ready"\);)755 461 y(//)89
b(Get)45 b(workload)e(from)h(router,)g(until)g(finished)755
558 y(char)979 571 y(*)1024 558 y(workload)f(=)i(s_recv)f(\(worker\);)
755 655 y(int)g(finished)g(=)g(\(strcmp)g(\(workload,)f("END"\))h(==)h
(0\);)755 752 y(free)f(\(workload\);)755 850 y(if)g(\(finished\))g({)
934 947 y(printf)g(\("Processed:)f(\045d)h(tasks\\n",)g(total\);)934
1044 y(break;)755 1141 y(})755 1238 y(total++;)755 1432
y(//)89 b(Do)45 b(some)f(random)g(work)755 1530 y(s_sleep)g(\(randof)f
(\(1000\))h(+)h(1\);)576 1627 y(})576 1724 y(zmq_close)e(\(worker\);)
576 1821 y(zmq_ctx_destroy)f(\(context\);)576 1918 y(return)h(NULL;)396
2015 y(})-2 2189 y
SDict begin H.S end
 -2 2189 a -2 2189 a
SDict begin 13 H.A end
 -2 2189 a -2 2189
a
SDict begin [/View [/XYZ H.V]/Dest (0:1350) cvn /DEST pdfmark end
 -2 2189 a 396 2289 a Fk(While)21 b(this)g(e)o(xample)d(runs)i(in)g(a)
h(single)f(process,)g(that)g(is)h(just)g(to)f(mak)o(e)g(it)h(easier)f
(to)h(start)f(and)g(stop)g(the)g(e)o(xample.)396 2397
y(Each)g(thread)f(has)i(its)g(o)n(wn)e(conte)o(xt)g(and)h(conceptually)
e(acts)j(as)g(a)f(separate)g(process.)-2 2415 y
SDict begin H.S end
 -2 2415
a -2 2415 a
SDict begin 13 H.A end
 -2 2415 a -2 2415 a
SDict begin [/View [/XYZ H.V]/Dest (0:rtmama-c-1) cvn /DEST pdfmark
end
 -2 2415 a 396 2598 a
Fg(Example)h(3-5.)e(R)n(OUTER-to-REQ)g(\(rtmama.c\))f(-)j(main)f(task)
-2 2698 y
SDict begin H.S end
 -2 2698 a -2 2698 a
SDict begin 11.7 H.A end
 -2 2698 a -2 2698 a
SDict begin [/View [/XYZ H.V]/Dest (0:1353) cvn /DEST pdfmark end
 -2
2698 a 396 2876 a Fe(int)45 b(main)f(\(void\))396 2973
y({)576 3070 y(void)800 3083 y(*)845 3070 y(context)f(=)i(zmq_ctx_new)e
(\(\);)576 3167 y(void)800 3180 y(*)845 3167 y(client)g(=)i(zmq_socket)
e(\(context,)h(ZMQ_ROUTER\);)576 3264 y(zmq_bind)f(\(client,)h
("ipc://routing.ipc"\);)576 3361 y(srandom)f(\(\(unsigned\))g(time)h
(\(NULL\)\);)576 3556 y(int)g(worker_nbr;)576 3653 y(for)g
(\(worker_nbr)f(=)i(0;)f(worker_nbr)f(<)i(NBR_WORKERS;)e
(worker_nbr++\))f({)755 3750 y(pthread_t)h(worker;)755
3847 y(pthread_create)f(\(&worker,)i(NULL,)g(worker_task,)f(NULL\);)576
3944 y(})576 4041 y(int)h(task_nbr;)576 4138 y(for)g(\(task_nbr)f(=)i
(0;)f(task_nbr)g(<)h(NBR_WORKERS)2459 4151 y(*)2548 4138
y(10;)g(task_nbr++\))e({)755 4236 y(//)89 b(LRU)45 b(worker)e(is)i
(next)f(waiting)g(in)g(queue)755 4333 y(char)979 4346
y(*)1024 4333 y(address)g(=)g(s_recv)g(\(client\);)755
4430 y(char)979 4443 y(*)1024 4430 y(empty)g(=)h(s_recv)e(\(client\);)
755 4527 y(free)h(\(empty\);)755 4624 y(char)979 4637
y(*)1024 4624 y(ready)g(=)h(s_recv)e(\(client\);)755
4721 y(free)h(\(ready\);)755 4916 y(s_sendmore)f(\(client,)h
(address\);)755 5013 y(s_sendmore)f(\(client,)h(""\);)755
5110 y(s_send)g(\(client,)f("This)h(is)h(the)f(workload"\);)p
Black 3798 5569 a Ff(96)p Black eop end
%%Page: 97 110
TeXDict begin 97 109 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.97) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(free)44 b(\(address\);)576
170 y(})576 267 y(//)89 b(Now)44 b(ask)h(mamas)f(to)g(shut)g(down)g
(and)h(report)f(their)g(results)576 364 y(for)g(\(worker_nbr)f(=)i(0;)f
(worker_nbr)f(<)i(NBR_WORKERS;)e(worker_nbr++\))f({)755
461 y(char)979 474 y(*)1024 461 y(address)i(=)g(s_recv)g(\(client\);)
755 558 y(char)979 571 y(*)1024 558 y(empty)g(=)h(s_recv)e(\(client\);)
755 655 y(free)h(\(empty\);)755 752 y(char)979 765 y(*)1024
752 y(ready)g(=)h(s_recv)e(\(client\);)755 850 y(free)h(\(ready\);)755
1044 y(s_sendmore)f(\(client,)h(address\);)755 1141 y(s_sendmore)f
(\(client,)h(""\);)755 1238 y(s_send)g(\(client,)f("END"\);)755
1335 y(free)h(\(address\);)576 1432 y(})576 1530 y(zmq_close)f
(\(client\);)576 1627 y(zmq_ctx_destroy)f(\(context\);)576
1724 y(return)h(0;)396 1821 y(})-2 1995 y
SDict begin H.S end
 -2 1995 a -2
1995 a
SDict begin 13 H.A end
 -2 1995 a -2 1995 a
SDict begin [/View [/XYZ H.V]/Dest (0:1354) cvn /DEST pdfmark end
 -2 1995 a 396 2095 a Fk(F)o(or)20
b(this)h(e)o(xample)e(the)h(LR)m(U)g(doesn')o(t)f(need)g(an)o(y)h
(particular)f(data)h(structures)f(abo)o(v)o(e)g(what)h(\330MQ)g(gi)n(v)
o(es)g(us)396 2203 y(\(message)g(queues\))f(because)g(we)i(don')o(t)d
(need)i(to)g(synchronize)e(the)i(w)o(ork)o(ers)g(with)g(an)o(ything.)e
(A)j(more)e(realistic)396 2311 y(LR)m(U)i(algorithm)d(w)o(ould)i(ha)n
(v)o(e)f(to)i(collect)f(w)o(ork)o(ers)f(as)i(the)o(y)f(become)f(ready)
-5 b(,)18 b(into)i(a)h(queue,)e(and)g(the)h(use)h(this)g(queue)396
2419 y(when)f(routing)e(client)j(requests.)e(W)-7 b(e')o(ll)22
b(do)d(this)i(in)f(a)h(later)f(e)o(xample.)-2 2603 y
SDict begin H.S end

-2 2603 a -2 2603 a
SDict begin 13 H.A end
 -2 2603 a -2 2603 a
SDict begin [/View [/XYZ H.V]/Dest (0:1355) cvn /DEST pdfmark end
 -2 2603 a 396
2693 a Fk(T)-7 b(o)21 b(pro)o(v)o(e)d(that)i(the)g(LR)m(U)h(is)g(w)o
(orking)e(as)i(e)o(xpected,)d(the)i(REQs)h(print)f(the)g(total)g(tasks)
h(the)o(y)f(each)f(did.)h(Since)g(the)396 2801 y(REQs)h(do)f(random)f
(w)o(ork,)g(and)g(we')l(re)h(not)g(load)g(balancing,)e(we)i(e)o(xpect)g
(each)f(REQ)i(to)g(do)e(approximately)f(the)396 2909
y(same)j(amount)d(b)n(ut)j(with)f(random)e(v)n(ariation.)h(And)h(that)g
(is)h(indeed)e(what)h(we)h(see:)-2 2992 y
SDict begin H.S end
 -2 2992 a -2
2992 a
SDict begin 11.7 H.A end
 -2 2992 a -2 2992 a
SDict begin [/View [/XYZ H.V]/Dest (0:1356) cvn /DEST pdfmark end
 -2 2992 a 396 3089 a Fe(Processed:)43
b(8)i(tasks)396 3186 y(Processed:)e(8)i(tasks)396 3283
y(Processed:)e(11)i(tasks)396 3380 y(Processed:)e(7)i(tasks)396
3477 y(Processed:)e(9)i(tasks)396 3574 y(Processed:)e(11)i(tasks)396
3671 y(Processed:)e(14)i(tasks)396 3769 y(Processed:)e(11)i(tasks)396
3866 y(Processed:)e(11)i(tasks)396 3963 y(Processed:)e(10)i(tasks)-2
4130 y
SDict begin H.S end
 -2 4130 a -2 4130 a
SDict begin 13 H.A end
 -2 4130 a -2 4130 a
SDict begin [/View [/XYZ H.V]/Dest (0:1357) cvn /DEST pdfmark end
 -2 4130
a 396 4237 a Fk(Some)20 b(comments)f(on)h(this)h(code)-2
4238 y
SDict begin H.S end
 -2 4238 a -2 4238 a
SDict begin 13 H.A end
 -2 4238 a -2 4238 a
SDict begin [/View [/XYZ H.V]/Dest (0:1358) cvn /DEST pdfmark end
 -2 4238
a -2 4248 a
SDict begin H.S end
 -2 4248 a -2 4248 a
SDict begin 13 H.A end
 -2 4248 a -2 4248 a
SDict begin [/View [/XYZ H.V]/Dest (0:1359) cvn /DEST pdfmark end
 -2
4248 a Black 396 4407 a Fj(\225)p Black 479 4407 a
SDict begin H.S end
 479
4407 a 479 4407 a
SDict begin 13 H.A end
 479 4407 a 479 4407 a
SDict begin [/View [/XYZ H.V]/Dest (0:1360) cvn /DEST pdfmark end
 479 4407 a Fk(W)-7
b(e)22 b(don')o(t)c(need)i(an)o(y)f(settle)i(time,)f(since)h(the)f
(REQs)h(e)o(xplicitly)e(tell)i(the)f(R)m(OUTER)h(when)e(the)o(y)h(are)g
(ready)-5 b(.)-2 4425 y
SDict begin H.S end
 -2 4425 a -2 4425 a
SDict begin 13 H.A end
 -2 4425 a
-2 4425 a
SDict begin [/View [/XYZ H.V]/Dest (0:1361) cvn /DEST pdfmark end
 -2 4425 a Black 396 4556 a Fj(\225)p Black
479 4556 a
SDict begin H.S end
 479 4556 a 479 4556 a
SDict begin 13 H.A end
 479 4556 a 479 4556
a
SDict begin [/View [/XYZ H.V]/Dest (0:1362) cvn /DEST pdfmark end
 479 4556 a Fk(W)e(e')l(re)21 b(generating)d(our)h(o)n(wn)h
(identities)g(here,)f(as)i(printable)e(strings,)h(using)g(the)g
(zhelpers.h)f(s_set_id)h(function.)479 4664 y(That')-5
b(s)21 b(just)f(to)h(mak)o(e)e(our)h(life)g(a)h(little)g(simpler)-5
b(.)20 b(In)g(a)g(realistic)h(application)e(the)h(REQs)h(w)o(ould)e(be)
i(fully)479 4772 y(anon)o(ymous)d(and)h(then)h(you')l(d)e(call)j
(zmq_msg_recv[3])16 b(and)j(zmq_msg_send[3])d(directly)k(instead)g(of)g
(the)479 4880 y(zhelpers)g(s_recv\(\))e(and)i(s_send\(\))f(functions,)g
(which)g(can)h(only)g(handle)f(strings.)-2 4898 y
SDict begin H.S end
 -2
4898 a -2 4898 a
SDict begin 13 H.A end
 -2 4898 a -2 4898 a
SDict begin [/View [/XYZ H.V]/Dest (0:1363) cvn /DEST pdfmark end
 -2 4898 a Black
396 5030 a Fj(\225)p Black 479 5030 a
SDict begin H.S end
 479 5030 a 479
5030 a
SDict begin 13 H.A end
 479 5030 a 479 5030 a
SDict begin [/View [/XYZ H.V]/Dest (0:1364) cvn /DEST pdfmark end
 479 5030 a Fk(If)h(you)g(cop)o(y)f(and)h
(paste)g(e)o(xample)f(code)g(without)h(understanding)d(it,)k(you)e
(deserv)o(e)g(what)h(you)f(get.)h(It')-5 b(s)21 b(lik)o(e)479
5138 y(w)o(atching)f(Spiderman)e(leap)i(of)n(f)g(the)g(roof)f(and)h
(then)f(trying)g(that)i(yourself.)p Black 3797 5569 a
Ff(97)p Black eop end
%%Page: 98 111
TeXDict begin 98 110 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.98) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1389) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1365) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(T)g(o)21 b(route)e(to)h(a)h(REQ,)f
(we)h(must)f(create)g(a)h(REQ-friendly)d(en)m(v)o(elope)g(consisting)i
(of)f(an)i(address)e(plus)h(an)h(empty)396 180 y(message)f(frame\()p
0 TeXcolorgray 921 180 a
SDict begin H.S end
 921 180 a Fk(Figure)e(3-8)1269
180 y
SDict begin 13 H.L end
 1269 180 a 1269 180 a
SDict begin [/Subtype /Link/Dest (0:figure-34) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1269 180 a Black -1 w Fk(\).)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-34) cvn /DEST pdfmark
end
 -2 198 a 396
382 a Fg(Figur)o(e)i(3-8.)f(Routing)h(En)m(v)o(elope)g(f)n(or)f(REQ)-2
482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 13 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:1369) cvn /DEST pdfmark end
 -2 482 a 396
1256 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1256 a @beginspecial 0 @llx -88 @lly 275 @urx
0 @ury 2750 @rwi @setspecial
%%BeginDocument: images/fig34.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -88 275 0
%%HiResBoundingBox: 0.0 -88.0 275.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -21.500150680541992 moveto
63.50014877319336 -37.50014877319336 lineto
133.50015258789062 -37.50014877319336 lineto
133.50015258789062 -21.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -37.50014877319336 moveto
63.50014877319336 -53.50014877319336 lineto
83.50015258789062 -53.50014877319336 lineto
83.50015258789062 -37.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -53.50014877319336 moveto
63.50014877319336 -69.50015258789062 lineto
263.5001525878906 -69.50015258789062 lineto
263.5001525878906 -53.50014877319336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -20.0 moveto
62.0 -36.0 lineto
132.0 -36.0 lineto
132.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -20.0 moveto
62.0 -36.0 lineto
132.0 -36.0 lineto
132.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -36.0 moveto
62.0 -52.0 lineto
82.0 -52.0 lineto
82.0 -36.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -36.0 moveto
62.0 -52.0 lineto
82.0 -52.0 lineto
82.0 -36.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -52.0 moveto
62.0 -68.0 lineto
262.0 -68.0 lineto
262.0 -52.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -52.0 moveto
62.0 -68.0 lineto
262.0 -68.0 lineto
262.0 -52.0 lineto
closepath
stroke
newpath
102.0 -44.0 moveto
135.0 -44.0 lineto
stroke
newpath
105.0 -40.0 moveto
100.0 -44.0 lineto
105.0 -48.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
11.0 -31.0 moveto
(Frame 1) show
72.0 -31.0 moveto
(Address) show
11.0 -47.0 moveto
(Frame 2) show
144.0 -47.0 moveto
(Empty message frame) show
11.0 -63.0 moveto
(Frame 3) show
71.0 -63.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1256 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1256 a -2 1339 a
SDict begin H.S end
 -2 1339
a -2 1339 a
SDict begin 13 H.A end
 -2 1339 a -2 1339 a
SDict begin [/View [/XYZ H.V]/Dest (0:1372) cvn /DEST pdfmark end
 -2 1339 a 378 x Fn(3.5.)39
b(Ad)o(dress-based)d(Routing)1896 1717 y
SDict begin H.S end
 1896 1717 a
1896 1717 a
SDict begin 22.464 H.A end
 1896 1717 a 1896 1717 a
SDict begin [/View [/XYZ H.V]/Dest (8.50.1) cvn /DEST pdfmark end
 1896 1717 a -2 1915
a
SDict begin H.S end
 -2 1915 a -2 1915 a
SDict begin 13 H.A end
 -2 1915 a -2 1915 a
SDict begin [/View [/XYZ H.V]/Dest (0:1374) cvn /DEST pdfmark end
 -2 1915 a 396
1991 a Fk(In)20 b(a)h(classic)g(request-reply)d(pattern)h(a)i(R)m
(OUTER)f(w)o(ouldn')o(t)e(talk)j(to)f(a)h(REP)g(sock)o(et)f(at)g(all,)h
(b)n(ut)f(rather)f(w)o(ould)h(get)g(a)396 2098 y(DEALER)g(to)h(do)f
(the)g(job)g(for)f(it.)i(It')-5 b(s)21 b(w)o(orth)e(remembering)f(with)
i(\330MQ)h(that)f(the)g(classic)h(patterns)f(are)g(the)g(ones)396
2206 y(that)h(w)o(ork)e(best,)h(that)h(the)f(beaten)f(path)h(is)h
(there)f(for)f(a)i(reason,)e(and)h(that)g(when)g(we)g(go)g(of)n(f-road)
e(we)i(tak)o(e)h(the)f(risk)g(of)396 2314 y(f)o(alling)f(of)n(f)g(clif)
n(fs)h(and)f(getting)g(eaten)g(by)h(zombies.)e(Ha)n(ving)h(said)h
(that,)g(let')-5 b(s)20 b(plug)f(a)h(R)m(OUTER)g(into)g(a)g(REP)g(and)f
(see)396 2422 y(what)h(the)h(heck)e(emer)o(ges.)-2 2606
y
SDict begin H.S end
 -2 2606 a -2 2606 a
SDict begin 13 H.A end
 -2 2606 a -2 2606 a
SDict begin [/View [/XYZ H.V]/Dest (0:1375) cvn /DEST pdfmark end
 -2 2606 a 396
2696 a Fk(The)h(special)g(thing)g(about)f(REPs)i(is)h(actually)d(tw)o
(o)i(things:)-2 2714 y
SDict begin H.S end
 -2 2714 a -2 2714 a
SDict begin 13 H.A end
 -2 2714 a
-2 2714 a
SDict begin [/View [/XYZ H.V]/Dest (0:1376) cvn /DEST pdfmark end
 -2 2714 a -2 2724 a
SDict begin H.S end
 -2 2724 a -2 2724 a
SDict begin 13 H.A end
 -2
2724 a -2 2724 a
SDict begin [/View [/XYZ H.V]/Dest (0:1377) cvn /DEST pdfmark end
 -2 2724 a Black 396 2866 a Fj(\225)p
Black 479 2866 a
SDict begin H.S end
 479 2866 a 479 2866 a
SDict begin 13 H.A end
 479 2866 a 479
2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:1378) cvn /DEST pdfmark end
 479 2866 a Fk(One,)f(the)o(y)g(are)g(strictly)g(lockstep)g
(request-reply)-5 b(.)-2 2884 y
SDict begin H.S end
 -2 2884 a -2 2884 a
SDict begin 13 H.A end
 -2
2884 a -2 2884 a
SDict begin [/View [/XYZ H.V]/Dest (0:1379) cvn /DEST pdfmark end
 -2 2884 a Black 396 3016 a Fj(\225)p
Black 479 3016 a
SDict begin H.S end
 479 3016 a 479 3016 a
SDict begin 13 H.A end
 479 3016 a 479
3016 a
SDict begin [/View [/XYZ H.V]/Dest (0:1380) cvn /DEST pdfmark end
 479 3016 a Fk(T)e(w)o(o,)21 b(the)o(y)e(accept)h(an)g(en)m(v)o
(elope)e(stack)i(of)g(an)o(y)f(size)i(and)f(will)h(return)e(that)h
(intact.)-2 3200 y
SDict begin H.S end
 -2 3200 a -2 3200 a
SDict begin 13 H.A end
 -2 3200 a -2 3200
a
SDict begin [/View [/XYZ H.V]/Dest (0:1381) cvn /DEST pdfmark end
 -2 3200 a 396 3290 a Fk(In)g(the)g(normal)f(request-reply)f(pattern,)
h(REPs)i(are)g(anon)o(ymous)c(and)j(replaceable,)e(b)n(ut)i(we')l(re)g
(learning)f(about)396 3398 y(custom)h(routing.)e(So,)i(in)h(our)e
(use-case)h(we)h(ha)n(v)o(e)e(reason)h(to)g(send)g(a)h(request)e(to)h
(REP)h(A)g(rather)f(than)f(REP)i(B.)g(This)396 3506 y(is)g(essential)g
(if)g(you)e(w)o(ant)h(to)h(k)o(eep)e(some)h(kind)g(of)f(a)i(con)m(v)o
(ersation)d(going)g(between)i(you,)f(at)i(one)e(end)h(of)g(a)g(lar)o
(ge)396 3614 y(netw)o(ork,)f(and)h(a)g(REP)h(sitting)g(some)n(where)d
(f)o(ar)j(a)o(w)o(ay)-5 b(.)-2 3798 y
SDict begin H.S end
 -2 3798 a -2 3798
a
SDict begin 13 H.A end
 -2 3798 a -2 3798 a
SDict begin [/View [/XYZ H.V]/Dest (0:1382) cvn /DEST pdfmark end
 -2 3798 a 396 3888 a Fk(A)21 b(core)f(philosophy)
d(of)j(\330MQ)g(is)h(that)g(the)f(edges)g(are)g(smart)g(and)g(man)o(y)
-5 b(,)18 b(and)i(the)g(middle)f(is)i(v)n(ast)g(and)f(dumb)m(.)e(This)
396 3996 y(does)i(mean)g(the)g(edges)g(can)g(address)g(each)f(other)m
(,)g(and)h(this)h(also)f(means)g(we)g(w)o(ant)h(to)f(kno)n(w)f(ho)n(w)h
(to)g(reach)g(a)g(gi)n(v)o(en)396 4103 y(REP)-9 b(.)21
b(Doing)e(routing)g(across)h(multiple)g(hops)f(is)i(something)e(we')o
(ll)h(look)g(at)h(later)f(b)n(ut)g(for)g(no)n(w)f(we')o(ll)i(look)e
(just)i(at)396 4211 y(the)f(\002nal)h(step:)f(a)h(R)m(OUTER)g(talking)e
(to)h(a)h(speci\002c)f(REP\()p 0 TeXcolorgray 2120 4211
a
SDict begin H.S end
 2120 4211 a Fk(Figure)g(3-9)2470 4211 y
SDict begin 13 H.L end
 2470 4211 a
2470 4211 a
SDict begin [/Subtype /Link/Dest (0:figure-35) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2470 4211 a Black -2 w Fk(\).)-2 4229 y
SDict begin H.S end
 -2
4229 a -2 4229 a
SDict begin 13 H.A end
 -2 4229 a -2 4229 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-35) cvn /DEST pdfmark
end
 -2 4229 a Black
3800 5569 a Ff(98)p Black eop end
%%Page: 99 112
TeXDict begin 99 111 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.99) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-9.)f(R)n(OUTER-to-REP)g
(Custom)h(Routing)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a
-2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1386) cvn /DEST pdfmark end
 -2 172 a 396 2164 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2164 a @beginspecial
0 @llx -234 @lly 282 @urx 0 @ury 2820 @rwi @setspecial
%%BeginDocument: images/fig35.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -234 282 0
%%HiResBoundingBox: 0.0 -234.0 282.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -23.800180435180664 moveto
58.80017852783203 -57.80017852783203 lineto
142.80018615722656 -57.80017852783203 lineto
142.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -60.80017852783203 moveto
58.80017852783203 -73.80017852783203 lineto
58.80017852783203 -76.4668451944987 59.80017852783203 -77.80017852783203 61.80017852783203 -77.80017852783203 curveto
139.80018615722656 -77.80017852783203 lineto
139.80018615722656 -77.80017852783203 lineto
141.80018615722656 -77.80017852783203 142.80018615722656 -76.4668451944987 142.80018615722656 -73.80017852783203 curveto
142.80018615722656 -61.000179290771484 lineto
142.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -149.80018615722656 moveto
17.800180435180664 -149.80018615722656 16.800180435180664 -151.46685282389322 16.800180435180664 -154.80018615722656 curveto
16.800180435180664 -174.80018615722656 lineto
88.80017852783203 -174.80018615722656 lineto
88.80017852783203 -154.80018615722656 lineto
88.80017852783203 -151.46685282389322 87.80017852783203 -149.80018615722656 85.80017852783203 -149.80018615722656 curveto
19.800180435180664 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -177.80018615722656 moveto
16.800180435180664 -212.80018615722656 lineto
88.80017852783203 -212.80018615722656 lineto
88.80017852783203 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -149.80018615722656 moveto
113.80017852783203 -149.80018615722656 112.80017852783203 -151.46685282389322 112.80017852783203 -154.80018615722656 curveto
112.80017852783203 -174.80018615722656 lineto
184.80018615722656 -174.80018615722656 lineto
184.80018615722656 -154.80018615722656 lineto
184.80018615722656 -151.46685282389322 183.80018615722656 -149.80018615722656 181.80018615722656 -149.80018615722656 curveto
115.80017852783203 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -177.80018615722656 moveto
112.80017852783203 -212.80018615722656 lineto
184.80018615722656 -212.80018615722656 lineto
184.80018615722656 -177.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -22.0 moveto
57.0 -56.0 lineto
141.0 -56.0 lineto
141.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
57.0 -22.0 moveto
57.0 -56.0 lineto
141.0 -56.0 lineto
141.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -59.0 moveto
57.0 -72.0 lineto
57.0 -74.66666666666667 58.0 -76.0 60.0 -76.0 curveto
138.0 -76.0 lineto
138.0 -76.0 lineto
140.0 -76.0 141.0 -74.66666666666667 141.0 -72.0 curveto
141.0 -59.20000076293945 lineto
141.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -59.0 moveto
57.0 -72.0 lineto
57.0 -74.66666666666667 58.0 -76.0 60.0 -76.0 curveto
138.0 -76.0 lineto
138.0 -76.0 lineto
140.0 -76.0 141.0 -74.66666666666667 141.0 -72.0 curveto
141.0 -59.20000076293945 lineto
141.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -148.0 moveto
16.0 -148.0 15.0 -149.66666666666666 15.0 -153.0 curveto
15.0 -173.0 lineto
87.0 -173.0 lineto
87.0 -153.0 lineto
87.0 -149.66666666666666 86.0 -148.0 84.0 -148.0 curveto
18.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -148.0 moveto
16.0 -148.0 15.0 -149.66666666666666 15.0 -153.0 curveto
15.0 -173.0 lineto
87.0 -173.0 lineto
87.0 -153.0 lineto
87.0 -149.66666666666666 86.0 -148.0 84.0 -148.0 curveto
18.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -211.0 lineto
87.0 -211.0 lineto
87.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -211.0 lineto
87.0 -211.0 lineto
87.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -148.0 moveto
112.0 -148.0 111.0 -149.66666666666666 111.0 -153.0 curveto
111.0 -173.0 lineto
183.0 -173.0 lineto
183.0 -153.0 lineto
183.0 -149.66666666666666 182.0 -148.0 180.0 -148.0 curveto
114.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -148.0 moveto
112.0 -148.0 111.0 -149.66666666666666 111.0 -153.0 curveto
111.0 -173.0 lineto
183.0 -173.0 lineto
183.0 -153.0 lineto
183.0 -149.66666666666666 182.0 -148.0 180.0 -148.0 curveto
114.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -211.0 lineto
183.0 -211.0 lineto
183.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -211.0 lineto
183.0 -211.0 lineto
183.0 -176.0 lineto
closepath
stroke
newpath
99.0 -81.0 moveto
96.0 -90.0 lineto
102.0 -90.0 lineto
closepath
fill
newpath
48.0 -135.0 moveto
51.0 -144.0 lineto
54.0 -135.0 lineto
closepath
fill
newpath
144.0 -135.0 moveto
147.0 -144.0 lineto
150.0 -135.0 lineto
closepath
fill
newpath
99.0 -85.0 moveto
99.0 -112.0 lineto
stroke
newpath
51.0 -139.0 moveto
51.0 -112.0 lineto
99.0 -112.0 lineto
stroke
newpath
147.0 -139.0 moveto
147.0 -112.0 lineto
99.0 -112.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
82.0 -44.0 moveto
(Client) show
172.0 -44.0 moveto
(Send to "A" or "B") show
80.0 -71.0 moveto
(ROUTER) show
43.0 -161.0 moveto
(REP) show
43.0 -170.0 moveto
("A") show
139.0 -161.0 moveto
(REP) show
139.0 -170.0 moveto
("B") show
30.0 -197.0 moveto
(Worker) show
132.0 -197.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2164 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2164 a 274 x Fk(This)h(e)o(xample)d(sho)n
(ws)j(a)f(v)o(ery)f(speci\002c)i(chain)e(of)h(e)n(v)o(ents:)-2
2456 y
SDict begin H.S end
 -2 2456 a -2 2456 a
SDict begin 13 H.A end
 -2 2456 a -2 2456 a
SDict begin [/View [/XYZ H.V]/Dest (0:1390) cvn /DEST pdfmark end
 -2 2456
a -2 2466 a
SDict begin H.S end
 -2 2466 a -2 2466 a
SDict begin 13 H.A end
 -2 2466 a -2 2466 a
SDict begin [/View [/XYZ H.V]/Dest (0:1391) cvn /DEST pdfmark end
 -2
2466 a Black 396 2608 a Fj(\225)p Black 479 2608 a
SDict begin H.S end
 479
2608 a 479 2608 a
SDict begin 13 H.A end
 479 2608 a 479 2608 a
SDict begin [/View [/XYZ H.V]/Dest (0:1392) cvn /DEST pdfmark end
 479 2608 a Fk(The)g(client)g
(has)h(a)f(message)g(that)h(it)g(e)o(xpects)e(to)h(route)g(back)f
(\(via)h(another)f(R)m(OUTER\))h(to)g(some)g(node.)f(The)479
2716 y(message)h(has)h(tw)o(o)f(addresses)g(\(a)g(stack\),)g(an)g
(empty)g(part,)f(and)h(a)g(body)-5 b(.)-2 2734 y
SDict begin H.S end
 -2 2734
a -2 2734 a
SDict begin 13 H.A end
 -2 2734 a -2 2734 a
SDict begin [/View [/XYZ H.V]/Dest (0:1393) cvn /DEST pdfmark end
 -2 2734 a Black 396 2865
a Fj(\225)p Black 479 2865 a
SDict begin H.S end
 479 2865 a 479 2865 a
SDict begin 13 H.A end
 479
2865 a 479 2865 a
SDict begin [/View [/XYZ H.V]/Dest (0:1394) cvn /DEST pdfmark end
 479 2865 a Fk(The)20 b(client)g(passes)h(that)g(to)f
(the)g(R)m(OUTER)h(b)n(ut)f(speci\002es)g(a)h(REP)g(address)f(\002rst.)
-2 2883 y
SDict begin H.S end
 -2 2883 a -2 2883 a
SDict begin 13 H.A end
 -2 2883 a -2 2883 a
SDict begin [/View [/XYZ H.V]/Dest (0:1395) cvn /DEST pdfmark end
 -2
2883 a Black 396 3015 a Fj(\225)p Black 479 3015 a
SDict begin H.S end
 479
3015 a 479 3015 a
SDict begin 13 H.A end
 479 3015 a 479 3015 a
SDict begin [/View [/XYZ H.V]/Dest (0:1396) cvn /DEST pdfmark end
 479 3015 a Fk(The)g(R)m(OUTER)h
(remo)o(v)o(es)d(the)i(REP)h(address,)f(uses)h(that)f(to)g(decide)g
(which)f(REP)i(to)g(send)f(the)g(message)g(to.)-2 3033
y
SDict begin H.S end
 -2 3033 a -2 3033 a
SDict begin 13 H.A end
 -2 3033 a -2 3033 a
SDict begin [/View [/XYZ H.V]/Dest (0:1397) cvn /DEST pdfmark end
 -2 3033 a Black
396 3164 a Fj(\225)p Black 479 3164 a
SDict begin H.S end
 479 3164 a 479
3164 a
SDict begin 13 H.A end
 479 3164 a 479 3164 a
SDict begin [/View [/XYZ H.V]/Dest (0:1398) cvn /DEST pdfmark end
 479 3164 a Fk(The)g(REP)h(recei)n(v)o(es)f
(the)g(addresses,)f(empty)h(part,)f(and)h(body)-5 b(.)-2
3182 y
SDict begin H.S end
 -2 3182 a -2 3182 a
SDict begin 13 H.A end
 -2 3182 a -2 3182 a
SDict begin [/View [/XYZ H.V]/Dest (0:1399) cvn /DEST pdfmark end
 -2 3182
a Black 396 3314 a Fj(\225)p Black 479 3314 a
SDict begin H.S end
 479 3314
a 479 3314 a
SDict begin 13 H.A end
 479 3314 a 479 3314 a
SDict begin [/View [/XYZ H.V]/Dest (0:1400) cvn /DEST pdfmark end
 479 3314 a Fk(It)21
b(remo)o(v)o(es)d(the)j(addresses,)e(sa)n(v)o(es)i(them,)e(and)h
(passes)h(the)f(body)f(to)h(the)g(w)o(ork)o(er)-5 b(.)-2
3332 y
SDict begin H.S end
 -2 3332 a -2 3332 a
SDict begin 13 H.A end
 -2 3332 a -2 3332 a
SDict begin [/View [/XYZ H.V]/Dest (0:1401) cvn /DEST pdfmark end
 -2 3332
a Black 396 3463 a Fj(\225)p Black 479 3463 a
SDict begin H.S end
 479 3463
a 479 3463 a
SDict begin 13 H.A end
 479 3463 a 479 3463 a
SDict begin [/View [/XYZ H.V]/Dest (0:1402) cvn /DEST pdfmark end
 479 3463 a Fk(The)20
b(w)o(ork)o(er)f(sends)i(a)f(reply)g(back)f(to)h(the)h(REP)-9
b(.)-2 3481 y
SDict begin H.S end
 -2 3481 a -2 3481 a
SDict begin 13 H.A end
 -2 3481 a -2 3481 a
SDict begin [/View [/XYZ H.V]/Dest (0:1403) cvn /DEST pdfmark end

-2 3481 a Black 396 3613 a Fj(\225)p Black 479 3613 a
SDict begin H.S end

479 3613 a 479 3613 a
SDict begin 13 H.A end
 479 3613 a 479 3613 a
SDict begin [/View [/XYZ H.V]/Dest (0:1404) cvn /DEST pdfmark end
 479 3613
a Fk(The)20 b(REP)h(recreates)f(the)g(en)m(v)o(elope)e(stack)i(and)g
(sends)g(that)h(back)e(with)h(the)h(w)o(ork)o(er')-5
b(s)19 b(reply)h(to)g(the)g(R)m(OUTER.)-2 3631 y
SDict begin H.S end
 -2 3631
a -2 3631 a
SDict begin 13 H.A end
 -2 3631 a -2 3631 a
SDict begin [/View [/XYZ H.V]/Dest (0:1405) cvn /DEST pdfmark end
 -2 3631 a Black 396 3762
a Fj(\225)p Black 479 3762 a
SDict begin H.S end
 479 3762 a 479 3762 a
SDict begin 13 H.A end
 479
3762 a 479 3762 a
SDict begin [/View [/XYZ H.V]/Dest (0:1406) cvn /DEST pdfmark end
 479 3762 a Fk(The)g(R)m(OUTER)h(prepends)d(the)i
(REP')-5 b(s)22 b(address)d(and)h(pro)o(vides)f(that)h(to)g(the)g
(client)h(along)e(with)h(the)g(rest)h(of)f(the)479 3870
y(address)g(stack,)g(empty)f(part,)h(and)g(the)g(body)-5
b(.)-2 4054 y
SDict begin H.S end
 -2 4054 a -2 4054 a
SDict begin 13 H.A end
 -2 4054 a -2 4054 a
SDict begin [/View [/XYZ H.V]/Dest (0:1407) cvn /DEST pdfmark end

-2 4054 a 396 4144 a Fk(It')g(s)21 b(comple)o(x)e(b)n(ut)h(w)o(orth)f
(w)o(orking)g(through)f(until)i(you)f(understand)f(it.)j(Just)g
(remember)d(a)j(REP)g(is)g(garbage)d(in,)396 4252 y(garbage)g(out.)-2
4270 y
SDict begin H.S end
 -2 4270 a -2 4270 a
SDict begin 13 H.A end
 -2 4270 a -2 4270 a
SDict begin [/View [/XYZ H.V]/Dest (0:rtpapa-c) cvn /DEST pdfmark end
 -2 4270
a 396 4453 a Fg(Example)j(3-6.)e(R)n(OUTER-to-REP)g(\(rtpapa.c\))-2
4553 y
SDict begin H.S end
 -2 4553 a -2 4553 a
SDict begin 11.7 H.A end
 -2 4553 a -2 4553 a
SDict begin [/View [/XYZ H.V]/Dest (0:1410) cvn /DEST pdfmark end
 -2 4553
a 396 4633 a Fe(//)396 4730 y(//)90 b(Custom)43 b(routing)h(Router)g
(to)g(Papa)h(\(ROUTER)e(to)i(REP\))396 4828 y(//)396
4925 y(#include)f("zhelpers.h")396 5119 y(//)90 b(We)44
b(will)g(do)h(this)f(all)g(in)h(one)f(thread)g(to)g(emphasize)g(the)g
(sequence)p Black 3800 5569 a Ff(99)p Black eop end
%%Page: 100 113
TeXDict begin 100 112 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.100) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fe(//)90 b(of)44 b(events...)396
170 y(int)h(main)f(\(void\))396 267 y({)576 364 y(void)800
377 y(*)845 364 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
558 y(void)800 571 y(*)845 558 y(client)g(=)i(zmq_socket)e(\(context,)h
(ZMQ_ROUTER\);)576 655 y(zmq_bind)f(\(client,)h("ipc://routing.ipc"\);)
576 850 y(void)800 863 y(*)845 850 y(worker)f(=)i(zmq_socket)e
(\(context,)h(ZMQ_REP\);)576 947 y(zmq_setsockopt)e(\(worker,)i
(ZMQ_IDENTITY,)e("A",)i(1\);)576 1044 y(zmq_connect)f(\(worker,)g
("ipc://routing.ipc"\);)576 1238 y(//)89 b(Wait)44 b(for)g(the)h
(worker)f(to)g(connect)g(so)g(that)g(when)h(we)f(send)g(a)h(message)576
1335 y(//)89 b(with)44 b(routing)g(envelope,)f(it)i(will)f(actually)f
(match)h(the)h(worker...)576 1432 y(sleep)f(\(1\);)576
1627 y(//)89 b(Send)44 b(papa)g(address,)g(address)f(stack,)h(empty)g
(part,)g(and)h(request)576 1724 y(s_sendmore)e(\(client,)g("A"\);)576
1821 y(s_sendmore)g(\(client,)g("address)h(3"\);)576
1918 y(s_sendmore)f(\(client,)g("address)h(2"\);)576
2015 y(s_sendmore)f(\(client,)g("address)h(1"\);)576
2112 y(s_sendmore)f(\(client,)g(""\);)576 2209 y(s_send)223
b(\(client,)43 b("This)h(is)h(the)f(workload"\);)576
2404 y(//)89 b(Worker)44 b(should)g(get)g(just)g(the)g(workload)576
2501 y(s_dump)f(\(worker\);)576 2695 y(//)89 b(We)44
b(don't)g(play)h(with)f(envelopes)f(in)i(the)f(worker)576
2792 y(s_send)f(\(worker,)h("This)g(is)g(the)h(reply"\);)576
2987 y(//)89 b(Now)44 b(dump)g(what)h(we)f(got)g(off)h(the)f(ROUTER)g
(socket...)576 3084 y(s_dump)f(\(client\);)576 3278 y(zmq_close)g
(\(client\);)576 3375 y(zmq_close)g(\(worker\);)576 3472
y(zmq_ctx_destroy)f(\(context\);)576 3569 y(return)h(0;)396
3666 y(})-2 3841 y
SDict begin H.S end
 -2 3841 a -2 3841 a
SDict begin 13 H.A end
 -2 3841 a -2 3841
a
SDict begin [/View [/XYZ H.V]/Dest (0:1411) cvn /DEST pdfmark end
 -2 3841 a 396 3940 a Fk(Run)20 b(this)h(program)d(and)i(it)h(should)e
(sho)n(w)h(you)f(this:)-2 4041 y
SDict begin H.S end
 -2 4041 a -2 4041 a
SDict begin 11.7 H.A end

-2 4041 a -2 4041 a
SDict begin [/View [/XYZ H.V]/Dest (0:1412) cvn /DEST pdfmark end
 -2 4041 a 396 4121 a Fe
(----------------------------------------)396 4218 y([020])44
b(This)g(is)h(the)f(workload)396 4315 y
(----------------------------------------)396 4412 y([001])g(A)396
4509 y([009])g(address)g(3)396 4606 y([009])g(address)g(2)396
4703 y([009])g(address)g(1)396 4801 y([000])396 4898
y([017])g(This)g(is)h(the)f(reply)p Black 3759 5569 a
Ff(100)p Black eop end
%%Page: 101 114
TeXDict begin 101 113 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.101) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1447) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1413) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(Some)20 b(comments)f(on)h(this)h
(code:)-2 73 y
SDict begin H.S end
 -2 73 a -2 73 a
SDict begin 13 H.A end
 -2 73 a -2 73 a
SDict begin [/View [/XYZ H.V]/Dest (0:1414) cvn /DEST pdfmark end
 -2 73
a -2 83 a
SDict begin H.S end
 -2 83 a -2 83 a
SDict begin 13 H.A end
 -2 83 a -2 83 a
SDict begin [/View [/XYZ H.V]/Dest (0:1415) cvn /DEST pdfmark end
 -2 83 a Black
396 243 a Fj(\225)p Black 479 243 a
SDict begin H.S end
 479 243 a 479 243
a
SDict begin 13 H.A end
 479 243 a 479 243 a
SDict begin [/View [/XYZ H.V]/Dest (0:1416) cvn /DEST pdfmark end
 479 243 a Fk(In)f(reality)g(we')l(d)g(ha)n(v)o(e)
f(the)h(REP)h(and)f(R)m(OUTER)h(in)f(separate)g(nodes.)f(This)h(e)o
(xample)f(does)h(it)h(all)g(in)f(one)g(thread)479 351
y(because)g(it)h(mak)o(es)f(the)g(sequence)f(of)h(e)n(v)o(ents)f
(really)h(clear)-5 b(.)-2 369 y
SDict begin H.S end
 -2 369 a -2 369 a
SDict begin 13 H.A end
 -2
369 a -2 369 a
SDict begin [/View [/XYZ H.V]/Dest (0:1417) cvn /DEST pdfmark end
 -2 369 a Black 396 500 a Fj(\225)p Black
479 500 a
SDict begin H.S end
 479 500 a 479 500 a
SDict begin 13 H.A end
 479 500 a 479 500 a
SDict begin [/View [/XYZ H.V]/Dest (0:1418) cvn /DEST pdfmark end
 479
500 a Fk(zmq_connect[3])16 b(doesn')o(t)i(happen)f(instantly)-5
b(.)19 b(When)g(the)g(REP)i(sock)o(et)e(connects)f(to)i(the)g(R)m
(OUTER,)f(that)h(tak)o(es)f(a)479 608 y(certain)h(time)g(and)g(happens)
f(in)h(the)g(background.)d(In)j(a)g(realistic)h(application)e(the)h(R)m
(OUTER)g(w)o(ouldn')o(t)f(e)n(v)o(en)479 716 y(kno)n(w)g(the)i(REP)g(e)
o(xisted)e(until)h(there)g(had)g(been)f(some)h(pre)n(vious)f(dialog.)g
(In)h(our)f(to)o(y)h(e)o(xample)f(we')o(ll)i(just)3639
716 y
SDict begin H.S end
 3639 716 a 3639 716 a
SDict begin 13 H.A end
 3639 716 a 3639 716 a
SDict begin [/View [/XYZ H.V]/Dest (0:1419) cvn /DEST pdfmark end
 3639
716 a Fe(sleep)479 824 y(\(1\);)f Fk(to)h(mak)o(e)e(sure)i(the)f
(connection')-5 b(s)18 b(done.)h(If)h(you)f(remo)o(v)o(e)g(the)h
(sleep,)g(the)g(REP)h(sock)o(et)f(w)o(on')o(t)f(get)i(the)479
932 y(message.)f(\(T)m(ry)f(it.\))-2 950 y
SDict begin H.S end
 -2 950 a -2
950 a
SDict begin 13 H.A end
 -2 950 a -2 950 a
SDict begin [/View [/XYZ H.V]/Dest (0:1420) cvn /DEST pdfmark end
 -2 950 a Black 396 1081 a Fj(\225)p
Black 479 1081 a
SDict begin H.S end
 479 1081 a 479 1081 a
SDict begin 13 H.A end
 479 1081 a 479
1081 a
SDict begin [/View [/XYZ H.V]/Dest (0:1421) cvn /DEST pdfmark end
 479 1081 a Fk(W)-7 b(e')l(re)21 b(routing)d(using)i(the)g(REP')
-5 b(s)22 b(identity)-5 b(.)18 b(Just)j(to)g(con)m(vince)d(yourself)h
(this)h(really)g(is)h(happening,)d(try)i(sending)479
1189 y(to)h(a)f(wrong)f(address,)h(lik)o(e)g("B".)h(The)f(REP)h(w)o
(on')o(t)e(get)h(the)g(message.)-2 1207 y
SDict begin H.S end
 -2 1207 a -2
1207 a
SDict begin 13 H.A end
 -2 1207 a -2 1207 a
SDict begin [/View [/XYZ H.V]/Dest (0:1422) cvn /DEST pdfmark end
 -2 1207 a Black 396 1339 a
Fj(\225)p Black 479 1339 a
SDict begin H.S end
 479 1339 a 479 1339 a
SDict begin 13 H.A end
 479
1339 a 479 1339 a
SDict begin [/View [/XYZ H.V]/Dest (0:1423) cvn /DEST pdfmark end
 479 1339 a Fk(The)g(s_dump)f(and)g(other)h(utility)g
(functions)f(\(in)h(the)g(C)h(code\))e(come)h(from)f(the)h(zhelpers.h)f
(header)g(\002le.)h(It)479 1446 y(becomes)g(clear)g(that)g(we)g(do)g
(the)g(same)h(w)o(ork)e(o)o(v)o(er)g(and)h(o)o(v)o(er)f(on)g(sock)o
(ets,)h(and)g(there)g(are)g(interesting)f(layers)h(we)479
1554 y(can)g(b)n(uild)g(on)g(top)g(of)g(the)g(\330MQ)g(API.)h(W)-7
b(e')o(ll)21 b(come)e(back)h(to)g(this)h(later)f(when)g(we)g(mak)o(e)g
(a)h(real)f(application)479 1662 y(rather)g(than)f(these)i(to)o(y)f(e)o
(xamples.)-2 1846 y
SDict begin H.S end
 -2 1846 a -2 1846 a
SDict begin 13 H.A end
 -2 1846 a -2
1846 a
SDict begin [/View [/XYZ H.V]/Dest (0:1424) cvn /DEST pdfmark end
 -2 1846 a 396 1936 a Fk(T)-7 b(o)21 b(route)e(to)h(a)h(REP)-9
b(,)20 b(we)h(must)f(create)g(a)h(REP-friendly)d(en)m(v)o(elope\()p
0 TeXcolorgray 2387 1936 a
SDict begin H.S end
 2387 1936 a Fk(Figure)f(3-10)2776
1936 y
SDict begin 13 H.L end
 2776 1936 a 2776 1936 a
SDict begin [/Subtype /Link/Dest (0:figure-36) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2776 1936 a Black -2 w
Fk(\).)-2 1954 y
SDict begin H.S end
 -2 1954 a -2 1954 a
SDict begin 13 H.A end
 -2 1954 a -2 1954
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-36) cvn /DEST pdfmark
end
 -2 1954 a 396 2138 a Fg(Figur)o(e)j(3-10.)e(Routing)i(En)m(v)o(elope)
g(f)n(or)g(REP)-2 2238 y
SDict begin H.S end
 -2 2238 a -2 2238 a
SDict begin 13 H.A end
 -2 2238
a -2 2238 a
SDict begin [/View [/XYZ H.V]/Dest (0:1428) cvn /DEST pdfmark end
 -2 2238 a 396 2921 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2921 a @beginspecial
0 @llx -77 @lly 305 @urx 0 @ury 3050 @rwi @setspecial
%%BeginDocument: images/fig36.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -77 305 0
%%HiResBoundingBox: 0.0 -77.0 305.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -18.500150680541992 moveto
63.50014877319336 -32.50014877319336 lineto
133.50015258789062 -32.50014877319336 lineto
133.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -32.50014877319336 moveto
63.50014877319336 -46.50014877319336 lineto
83.50015258789062 -46.50014877319336 lineto
83.50015258789062 -32.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -46.50014877319336 moveto
63.50014877319336 -60.50014877319336 lineto
263.5001525878906 -60.50014877319336 lineto
263.5001525878906 -46.50014877319336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -17.0 moveto
62.0 -31.0 lineto
132.0 -31.0 lineto
132.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -17.0 moveto
62.0 -31.0 lineto
132.0 -31.0 lineto
132.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -31.0 moveto
62.0 -45.0 lineto
82.0 -45.0 lineto
82.0 -31.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -31.0 moveto
62.0 -45.0 lineto
82.0 -45.0 lineto
82.0 -31.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
262.0 -59.0 lineto
262.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
262.0 -59.0 lineto
262.0 -45.0 lineto
closepath
stroke
newpath
147.0 -24.0 moveto
165.0 -24.0 lineto
stroke
newpath
102.0 -38.0 moveto
135.0 -38.0 lineto
stroke
newpath
150.0 -21.0 moveto
145.0 -24.0 lineto
150.0 -28.0 lineto
closepath
fill
newpath
105.0 -35.0 moveto
100.0 -38.0 lineto
105.0 -42.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
11.0 -28.0 moveto
(Frame 1) show
72.0 -28.0 moveto
(Address) show
180.0 -28.0 moveto
(Zero or more of these) show
11.0 -42.0 moveto
(Frame 2) show
150.0 -42.0 moveto
(Exactly one empty message frame) show
11.0 -56.0 moveto
(Frame 3) show
71.0 -56.0 moveto
(Data) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2921 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2921 a -2 3004 a
SDict begin H.S end
 -2 3004
a -2 3004 a
SDict begin 13 H.A end
 -2 3004 a -2 3004 a
SDict begin [/View [/XYZ H.V]/Dest (0:1431) cvn /DEST pdfmark end
 -2 3004 a 377 x Fn(3.6.)39
b(A)g(Request-Repl)n(y)d(Messa)o(g)q(e)i(Br)m(oker)2569
3381 y
SDict begin H.S end
 2569 3381 a 2569 3381 a
SDict begin 22.464 H.A end
 2569 3381 a 2569 3381
a
SDict begin [/View [/XYZ H.V]/Dest (8.51.1) cvn /DEST pdfmark end
 2569 3381 a -2 3579 a
SDict begin H.S end
 -2 3579 a -2 3579 a
SDict begin 13 H.A end
 -2 3579 a
-2 3579 a
SDict begin [/View [/XYZ H.V]/Dest (0:1433) cvn /DEST pdfmark end
 -2 3579 a 396 3655 a Fk(I')o(ll)21 b(recap)e(the)h(kno)n
(wledge)e(we)j(ha)n(v)o(e)e(so)i(f)o(ar)f(about)f(doing)g(weird)h(stuf)
n(f)g(with)g(\330MQ)h(message)f(en)m(v)o(elopes,)e(and)h(b)n(uild)396
3763 y(the)h(core)g(of)g(a)h(generic)e(custom)g(routing)g(queue)g(de)n
(vice)g(that)i(we)f(can)g(properly)e(call)j(a)2969 3763
y
SDict begin H.S end
 2969 3763 a 2969 3763 a
SDict begin 13 H.A end
 2969 3763 a 2969 3763 a
SDict begin [/View [/XYZ H.V]/Dest (0:1434) cvn /DEST pdfmark end
 2969
3763 a Ff(messa)o(g)o(e)g(br)l(ok)o(er)r Fk(.)f(Sorry)f(for)396
3871 y(all)i(the)f(b)n(uzzw)o(ords.)f(What)h(we')o(ll)h(mak)o(e)f(is)h
(a)1746 3871 y
SDict begin H.S end
 1746 3871 a 1746 3871 a
SDict begin 13 H.A end
 1746 3871 a 1746
3871 a
SDict begin [/View [/XYZ H.V]/Dest (0:1435) cvn /DEST pdfmark end
 1746 3871 a Ff(queue)e(de)o(vice)g Fk(that)h(connects)g(a)g(b)n
(unch)f(of)3022 3871 y
SDict begin H.S end
 3022 3871 a 3022 3871 a
SDict begin 13 H.A end
 3022 3871
a 3022 3871 a
SDict begin [/View [/XYZ H.V]/Dest (0:1436) cvn /DEST pdfmark end
 3022 3871 a Ff(clients)i Fk(to)f(a)h(b)n(unch)e(of)396
3979 y
SDict begin H.S end
 396 3979 a 396 3979 a
SDict begin 13 H.A end
 396 3979 a 396 3979 a
SDict begin [/View [/XYZ H.V]/Dest (0:1437) cvn /DEST pdfmark end
 396
3979 a Ff(work)o(er)o(s)p Fk(,)j(and)d(lets)i(you)f(use)1257
3979 y
SDict begin H.S end
 1257 3979 a 1257 3979 a
SDict begin 13 H.A end
 1257 3979 a 1257 3979
a
SDict begin [/View [/XYZ H.V]/Dest (0:1438) cvn /DEST pdfmark end
 1257 3979 a Ff(any)g(r)l(outing)f(algorithm)g Fk(you)h(w)o(ant.)g
(The)g(algorith)f(we')o(ll)h(implement)f(is)3426 3979
y
SDict begin H.S end
 3426 3979 a 3426 3979 a
SDict begin 13 H.A end
 3426 3979 a 3426 3979 a
SDict begin [/View [/XYZ H.V]/Dest (0:1439) cvn /DEST pdfmark end
 3426
3979 a Ff(least-r)m(ecently)396 4087 y(used)r Fk(,)h(since)h(it')-5
b(s)21 b(the)f(most)g(ob)o(vious)f(use-case)h(after)g(simple)g
(round-robin)c(distrib)n(ution.)-2 4271 y
SDict begin H.S end
 -2 4271 a -2
4271 a
SDict begin 13 H.A end
 -2 4271 a -2 4271 a
SDict begin [/View [/XYZ H.V]/Dest (0:1440) cvn /DEST pdfmark end
 -2 4271 a 396 4361 a Fk(T)-7
b(o)21 b(start)f(with,)g(let')-5 b(s)22 b(look)d(back)g(at)i(the)f
(classic)h(request-reply)d(pattern)i(and)f(then)h(see)h(ho)n(w)e(it)i
(e)o(xtends)e(o)o(v)o(er)g(a)i(lar)o(ger)396 4468 y(and)f(lar)o(ger)f
(service-oriented)e(netw)o(ork.)i(The)h(basic)g(pattern)g(just)g(has)h
(one)e(client)i(talking)e(to)h(a)h(fe)n(w)396 4576 y(w)o(ork)o(ers\()p
0 TeXcolorgray 691 4576 a
SDict begin H.S end
 691 4576 a Fk(Figure)d(3-11)1081
4576 y
SDict begin 13 H.L end
 1081 4576 a 1081 4576 a
SDict begin [/Subtype /Link/Dest (0:figure-37) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1081 4576 a Black -2 w
Fk(\).)-2 4594 y
SDict begin H.S end
 -2 4594 a -2 4594 a
SDict begin 13 H.A end
 -2 4594 a -2 4594
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-37) cvn /DEST pdfmark
end
 -2 4594 a Black 3759 5569 a Ff(101)p Black eop end
%%Page: 102 115
TeXDict begin 102 114 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.102) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1454) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-11.)e(Basic)j
(Request-r)o(eply)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a
-2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1444) cvn /DEST pdfmark end
 -2 172 a 396 2114 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2114 a @beginspecial
0 @llx -228 @lly 304 @urx 0 @ury 3040 @rwi @setspecial
%%BeginDocument: images/fig37.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -228 304 0
%%HiResBoundingBox: 0.0 -228.0 304.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -32.40024185180664 moveto
118.40023803710938 -54.40024185180664 lineto
190.40023803710938 -54.40024185180664 lineto
190.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -57.40024185180664 moveto
118.40023803710938 -80.40023803710938 lineto
190.40023803710938 -80.40023803710938 lineto
190.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -152.40023803710938 moveto
22.400239944458008 -174.40023803710938 lineto
94.40023803710938 -174.40023803710938 lineto
94.40023803710938 -152.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -152.40023803710938 moveto
118.40023803710938 -174.40023803710938 lineto
190.40023803710938 -174.40023803710938 lineto
190.40023803710938 -152.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -152.40023803710938 moveto
214.40023803710938 -174.40023803710938 lineto
286.4002380371094 -174.40023803710938 lineto
286.4002380371094 -152.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -177.40023803710938 moveto
22.400239944458008 -200.40023803710938 lineto
94.40023803710938 -200.40023803710938 lineto
94.40023803710938 -177.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -177.40023803710938 moveto
118.40023803710938 -200.40023803710938 lineto
190.40023803710938 -200.40023803710938 lineto
190.40023803710938 -177.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -177.40023803710938 moveto
214.40023803710938 -200.40023803710938 lineto
286.4002380371094 -200.40023803710938 lineto
286.4002380371094 -177.40023803710938 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -150.0 moveto
20.0 -172.0 lineto
92.0 -172.0 lineto
92.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -150.0 moveto
20.0 -172.0 lineto
92.0 -172.0 lineto
92.0 -150.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -150.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -150.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -150.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -150.0 moveto
212.0 -172.0 lineto
284.0 -172.0 lineto
284.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -150.0 moveto
212.0 -172.0 lineto
284.0 -172.0 lineto
284.0 -150.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -175.0 moveto
20.0 -198.0 lineto
92.0 -198.0 lineto
92.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -175.0 moveto
20.0 -198.0 lineto
92.0 -198.0 lineto
92.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -175.0 moveto
212.0 -198.0 lineto
284.0 -198.0 lineto
284.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -175.0 moveto
212.0 -198.0 lineto
284.0 -198.0 lineto
284.0 -175.0 lineto
closepath
stroke
newpath
148.0 -78.0 moveto
148.0 -114.0 lineto
stroke
newpath
52.0 -150.0 moveto
52.0 -114.0 lineto
148.0 -114.0 lineto
stroke
newpath
148.0 -150.0 moveto
148.0 -114.0 lineto
stroke
newpath
244.0 -150.0 moveto
244.0 -114.0 lineto
148.0 -114.0 lineto
stroke
/Helvetica findfont
13 scalefont setfont
131.0 -47.0 moveto
(Client) show
137.0 -70.0 moveto
(REQ) show
42.0 -166.0 moveto
(REP) show
138.0 -166.0 moveto
(REP) show
234.0 -166.0 moveto
(REP) show
33.0 -190.0 moveto
(Worker) show
129.0 -190.0 moveto
(Worker) show
225.0 -190.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2114 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2114 a 274 x Fk(This)g(e)o(xtends)e(to)h
(multiple)g(w)o(ork)o(ers,)f(b)n(ut)h(if)h(we)f(w)o(ant)g(to)h(handle)e
(multiple)g(clients)i(as)g(well,)f(we)h(need)e(a)i(de)n(vice)e(in)396
2496 y(the)h(middle.)g(W)-7 b(e')l(d)20 b(use)g(a)h(simple)f(ZMQ_Q)o
(UEUE)f(de)n(vice)h(connecting)e(a)i(R)m(OUTER)h(and)f(a)g(DEALER)g
(back)g(to)396 2604 y(back.)g(This)g(de)n(vice)f(just)i(switches)g
(message)f(frames)f(between)h(the)g(tw)o(o)g(sock)o(ets)h(as)g(f)o(ast)
f(as)h(it)g(can\()p 0 TeXcolorgray 3353 2604 a
SDict begin H.S end
 3353 2604
a Fk(Figure)e(3-12)3744 2604 y
SDict begin 13 H.L end
 3744 2604 a 3744 2604
a
SDict begin [/Subtype /Link/Dest (0:figure-38) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3744 2604 a Black -2 w Fk(\).)-2 2622 y
SDict begin H.S end
 -2 2622 a -2
2622 a
SDict begin 13 H.A end
 -2 2622 a -2 2622 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-38) cvn /DEST pdfmark
end
 -2 2622 a Black 3759 5569
a Ff(102)p Black eop end
%%Page: 103 116
TeXDict begin 103 115 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.103) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1462) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-12.)e(Str)o
(etched)i(Request-r)o(eply)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end

-2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1451) cvn /DEST pdfmark end
 -2 172 a 396 2914 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2914 a @beginspecial
0 @llx -324 @lly 304 @urx 0 @ury 3040 @rwi @setspecial
%%BeginDocument: images/fig38.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -324 304 0
%%HiResBoundingBox: 0.0 -324.0 304.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -32.40024185180664 moveto
22.400239944458008 -54.40024185180664 lineto
94.40023803710938 -54.40024185180664 lineto
94.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -32.40024185180664 moveto
118.40023803710938 -54.40024185180664 lineto
190.40023803710938 -54.40024185180664 lineto
190.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -32.40024185180664 moveto
214.40023803710938 -54.40024185180664 lineto
286.4002380371094 -54.40024185180664 lineto
286.4002380371094 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -57.40024185180664 moveto
22.400239944458008 -80.40023803710938 lineto
94.40023803710938 -80.40023803710938 lineto
94.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -57.40024185180664 moveto
118.40023803710938 -80.40023803710938 lineto
190.40023803710938 -80.40023803710938 lineto
190.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -57.40024185180664 moveto
214.40023803710938 -80.40023803710938 lineto
286.4002380371094 -80.40023803710938 lineto
286.4002380371094 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -128.40023803710938 moveto
118.40023803710938 -150.40023803710938 lineto
190.40023803710938 -150.40023803710938 lineto
190.40023803710938 -128.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -153.40023803710938 moveto
118.40023803710938 -174.40023803710938 lineto
190.40023803710938 -174.40023803710938 lineto
190.40023803710938 -153.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -177.40023803710938 moveto
118.40023803710938 -200.40023803710938 lineto
190.40023803710938 -200.40023803710938 lineto
190.40023803710938 -177.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -248.40023803710938 moveto
22.400239944458008 -270.4002380371094 lineto
94.40023803710938 -270.4002380371094 lineto
94.40023803710938 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -248.40023803710938 moveto
118.40023803710938 -270.4002380371094 lineto
190.40023803710938 -270.4002380371094 lineto
190.40023803710938 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -248.40023803710938 moveto
214.40023803710938 -270.4002380371094 lineto
286.4002380371094 -270.4002380371094 lineto
286.4002380371094 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -273.4002380371094 moveto
22.400239944458008 -296.4002380371094 lineto
94.40023803710938 -296.4002380371094 lineto
94.40023803710938 -273.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -273.4002380371094 moveto
118.40023803710938 -296.4002380371094 lineto
190.40023803710938 -296.4002380371094 lineto
190.40023803710938 -273.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -273.4002380371094 moveto
214.40023803710938 -296.4002380371094 lineto
286.4002380371094 -296.4002380371094 lineto
286.4002380371094 -273.4002380371094 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -126.0 moveto
116.0 -148.0 lineto
188.0 -148.0 lineto
188.0 -126.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -126.0 moveto
116.0 -148.0 lineto
188.0 -148.0 lineto
188.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -151.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -151.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -151.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -151.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -246.0 moveto
20.0 -268.0 lineto
92.0 -268.0 lineto
92.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -246.0 moveto
20.0 -268.0 lineto
92.0 -268.0 lineto
92.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -246.0 moveto
116.0 -268.0 lineto
188.0 -268.0 lineto
188.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -246.0 moveto
116.0 -268.0 lineto
188.0 -268.0 lineto
188.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -246.0 moveto
212.0 -268.0 lineto
284.0 -268.0 lineto
284.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -246.0 moveto
212.0 -268.0 lineto
284.0 -268.0 lineto
284.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -271.0 moveto
20.0 -294.0 lineto
92.0 -294.0 lineto
92.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -271.0 moveto
20.0 -294.0 lineto
92.0 -294.0 lineto
92.0 -271.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -271.0 moveto
116.0 -294.0 lineto
188.0 -294.0 lineto
188.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -271.0 moveto
116.0 -294.0 lineto
188.0 -294.0 lineto
188.0 -271.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -271.0 moveto
212.0 -294.0 lineto
284.0 -294.0 lineto
284.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -271.0 moveto
212.0 -294.0 lineto
284.0 -294.0 lineto
284.0 -271.0 lineto
closepath
stroke
newpath
52.0 -78.0 moveto
52.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -78.0 moveto
148.0 -102.0 lineto
stroke
newpath
244.0 -78.0 moveto
244.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -126.0 moveto
148.0 -102.0 lineto
stroke
newpath
148.0 -198.0 moveto
148.0 -222.0 lineto
stroke
newpath
52.0 -246.0 moveto
52.0 -222.0 lineto
148.0 -222.0 lineto
stroke
newpath
148.0 -246.0 moveto
148.0 -222.0 lineto
stroke
newpath
244.0 -246.0 moveto
244.0 -222.0 lineto
148.0 -222.0 lineto
stroke
/Helvetica findfont
13 scalefont setfont
35.0 -47.0 moveto
(Client) show
131.0 -47.0 moveto
(Client) show
227.0 -47.0 moveto
(Client) show
41.0 -70.0 moveto
(REQ) show
137.0 -70.0 moveto
(REQ) show
233.0 -70.0 moveto
(REQ) show
130.0 -142.0 moveto
(ROUTER) show
129.0 -166.0 moveto
(Device) show
131.0 -190.0 moveto
(DEALER) show
42.0 -262.0 moveto
(REP) show
138.0 -262.0 moveto
(REP) show
234.0 -262.0 moveto
(REP) show
33.0 -286.0 moveto
(Worker) show
129.0 -286.0 moveto
(Worker) show
225.0 -286.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2914 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2914 a 274 x Fk(The)g(k)o(e)o(y)g(here)f
(is)i(that)g(the)f(R)m(OUTER)g(stores)h(the)f(originating)e(client)i
(address)g(in)h(the)f(request)f(en)m(v)o(elope,)f(the)396
3296 y(DEALER)i(and)g(w)o(ork)o(ers)g(don')o(t)e(touch)h(that,)h(and)g
(so)h(the)f(R)m(OUTER)g(kno)n(ws)g(which)f(client)i(to)f(send)g(the)g
(reply)g(back)396 3404 y(to.)g(This)h(pattern)e(assumes)h(all)h(w)o
(ork)o(ers)f(pro)o(vide)e(the)i(e)o(xact)g(same)g(service.)-2
3588 y
SDict begin H.S end
 -2 3588 a -2 3588 a
SDict begin 13 H.A end
 -2 3588 a -2 3588 a
SDict begin [/View [/XYZ H.V]/Dest (0:1455) cvn /DEST pdfmark end
 -2 3588
a 396 3678 a Fk(In)g(the)g(abo)o(v)o(e)f(design,)g(we')l(re)h(using)f
(the)i(b)n(uilt-in)e(round-robin)e(routing)h(that)i(DEALER)h(pro)o
(vides.)d(Ho)n(we)n(v)o(er)g(this)396 3786 y(means)i(some)g(w)o(ork)o
(ers)g(may)f(be)i(idle)f(while)g(others)g(ha)n(v)o(e)f(multiple)h
(requests)g(w)o(aiting.)f(F)o(or)h(better)g(ef)n(\002cienc)o(y)f(and)
396 3894 y(proper)g(load-balancing)e(we)j(w)o(ant)h(to)f(use)h(a)f
(least-recently)f(used)h(algorithm,)e(so)j(we)g(tak)o(e)f(the)g(R)m
(OUTER-REQ)396 4001 y(pattern)g(we)g(learned,)f(and)h(apply)f(that\()p
0 TeXcolorgray 1550 4001 a
SDict begin H.S end
 1550 4001 a Fk(Figure)g(3-13)1941
4001 y
SDict begin 13 H.L end
 1941 4001 a 1941 4001 a
SDict begin [/Subtype /Link/Dest (0:figure-39) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1941 4001 a Black -2 w
Fk(\).)-2 4019 y
SDict begin H.S end
 -2 4019 a -2 4019 a
SDict begin 13 H.A end
 -2 4019 a -2 4019
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-39) cvn /DEST pdfmark
end
 -2 4019 a Black 3759 5569 a Ff(103)p Black eop end
%%Page: 104 117
TeXDict begin 104 116 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.104) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-13.)e(Str)o(etched)i
(Request-r)o(eply)f(with)i(LR)n(U)-2 172 y
SDict begin H.S end
 -2 172 a -2
172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1459) cvn /DEST pdfmark end
 -2 172 a 396 2914 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2914
a @beginspecial 0 @llx -324 @lly 304 @urx 0 @ury 3040
@rwi @setspecial
%%BeginDocument: images/fig39.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -324 304 0
%%HiResBoundingBox: 0.0 -324.0 304.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -32.40024185180664 moveto
22.400239944458008 -54.40024185180664 lineto
94.40023803710938 -54.40024185180664 lineto
94.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -32.40024185180664 moveto
118.40023803710938 -54.40024185180664 lineto
190.40023803710938 -54.40024185180664 lineto
190.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -32.40024185180664 moveto
214.40023803710938 -54.40024185180664 lineto
286.4002380371094 -54.40024185180664 lineto
286.4002380371094 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -57.40024185180664 moveto
22.400239944458008 -80.40023803710938 lineto
94.40023803710938 -80.40023803710938 lineto
94.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -57.40024185180664 moveto
118.40023803710938 -80.40023803710938 lineto
190.40023803710938 -80.40023803710938 lineto
190.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -57.40024185180664 moveto
214.40023803710938 -80.40023803710938 lineto
286.4002380371094 -80.40023803710938 lineto
286.4002380371094 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -128.40023803710938 moveto
118.40023803710938 -150.40023803710938 lineto
190.40023803710938 -150.40023803710938 lineto
190.40023803710938 -128.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -153.40023803710938 moveto
118.40023803710938 -174.40023803710938 lineto
190.40023803710938 -174.40023803710938 lineto
190.40023803710938 -153.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -177.40023803710938 moveto
118.40023803710938 -200.40023803710938 lineto
190.40023803710938 -200.40023803710938 lineto
190.40023803710938 -177.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -248.40023803710938 moveto
22.400239944458008 -270.4002380371094 lineto
94.40023803710938 -270.4002380371094 lineto
94.40023803710938 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -248.40023803710938 moveto
118.40023803710938 -270.4002380371094 lineto
190.40023803710938 -270.4002380371094 lineto
190.40023803710938 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -248.40023803710938 moveto
214.40023803710938 -270.4002380371094 lineto
286.4002380371094 -270.4002380371094 lineto
286.4002380371094 -248.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -273.4002380371094 moveto
22.400239944458008 -296.4002380371094 lineto
94.40023803710938 -296.4002380371094 lineto
94.40023803710938 -273.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -273.4002380371094 moveto
118.40023803710938 -296.4002380371094 lineto
190.40023803710938 -296.4002380371094 lineto
190.40023803710938 -273.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -273.4002380371094 moveto
214.40023803710938 -296.4002380371094 lineto
286.4002380371094 -296.4002380371094 lineto
286.4002380371094 -273.4002380371094 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -126.0 moveto
116.0 -148.0 lineto
188.0 -148.0 lineto
188.0 -126.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -126.0 moveto
116.0 -148.0 lineto
188.0 -148.0 lineto
188.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -151.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -151.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -151.0 moveto
116.0 -172.0 lineto
188.0 -172.0 lineto
188.0 -151.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -175.0 moveto
116.0 -198.0 lineto
188.0 -198.0 lineto
188.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -246.0 moveto
20.0 -268.0 lineto
92.0 -268.0 lineto
92.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -246.0 moveto
20.0 -268.0 lineto
92.0 -268.0 lineto
92.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -246.0 moveto
116.0 -268.0 lineto
188.0 -268.0 lineto
188.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -246.0 moveto
116.0 -268.0 lineto
188.0 -268.0 lineto
188.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -246.0 moveto
212.0 -268.0 lineto
284.0 -268.0 lineto
284.0 -246.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -246.0 moveto
212.0 -268.0 lineto
284.0 -268.0 lineto
284.0 -246.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -271.0 moveto
20.0 -294.0 lineto
92.0 -294.0 lineto
92.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -271.0 moveto
20.0 -294.0 lineto
92.0 -294.0 lineto
92.0 -271.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -271.0 moveto
116.0 -294.0 lineto
188.0 -294.0 lineto
188.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -271.0 moveto
116.0 -294.0 lineto
188.0 -294.0 lineto
188.0 -271.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -271.0 moveto
212.0 -294.0 lineto
284.0 -294.0 lineto
284.0 -271.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -271.0 moveto
212.0 -294.0 lineto
284.0 -294.0 lineto
284.0 -271.0 lineto
closepath
stroke
newpath
52.0 -78.0 moveto
52.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -78.0 moveto
148.0 -102.0 lineto
stroke
newpath
244.0 -78.0 moveto
244.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -126.0 moveto
148.0 -102.0 lineto
stroke
newpath
148.0 -198.0 moveto
148.0 -222.0 lineto
stroke
newpath
52.0 -246.0 moveto
52.0 -222.0 lineto
148.0 -222.0 lineto
stroke
newpath
148.0 -246.0 moveto
148.0 -222.0 lineto
stroke
newpath
244.0 -246.0 moveto
244.0 -222.0 lineto
148.0 -222.0 lineto
stroke
/Helvetica findfont
13 scalefont setfont
35.0 -47.0 moveto
(Client) show
131.0 -47.0 moveto
(Client) show
227.0 -47.0 moveto
(Client) show
41.0 -70.0 moveto
(REQ) show
137.0 -70.0 moveto
(REQ) show
233.0 -70.0 moveto
(REQ) show
130.0 -142.0 moveto
(ROUTER) show
211.0 -142.0 moveto
(Frontend) show
129.0 -166.0 moveto
(Device) show
210.0 -166.0 moveto
(LRU queue) show
130.0 -190.0 moveto
(ROUTER) show
209.0 -190.0 moveto
(Backend) show
41.0 -262.0 moveto
(REQ) show
137.0 -262.0 moveto
(REQ) show
233.0 -262.0 moveto
(REQ) show
33.0 -286.0 moveto
(Worker) show
129.0 -286.0 moveto
(Worker) show
225.0 -286.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2914 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2914 a 274 x Fk(Our)f(brok)o(er)f(-)h(a)h
(R)m(OUTER-to-R)m(OUTER)e(LR)m(U)h(queue)f(-)i(can')o(t)e(simply)h(cop)
o(y)f(message)h(frames)g(blindly)-5 b(.)18 b(Here)i(is)396
3296 y(the)g(code,)e(it')-5 b(s)20 b(a)g(f)o(air)f(chunk)f(of)h(code,)f
(b)n(ut)h(we)h(can)f(reuse)g(the)g(core)g(logic)g(an)o(y)f(time)i(we)f
(w)o(ant)g(to)h(do)f(load-balancing:)-2 3314 y
SDict begin H.S end
 -2 3314
a -2 3314 a
SDict begin 13 H.A end
 -2 3314 a -2 3314 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue-c) cvn /DEST pdfmark
end
 -2 3314 a 396 3497 a
Fg(Example)i(3-7.)e(LR)n(U)h(queue)h(br)o(ok)o(er)f(\(lruqueue.c\))-2
3597 y
SDict begin H.S end
 -2 3597 a -2 3597 a
SDict begin 11.7 H.A end
 -2 3597 a -2 3597 a
SDict begin [/View [/XYZ H.V]/Dest (0:1465) cvn /DEST pdfmark end
 -2 3597
a 396 3677 a Fe(//)396 3774 y(//)90 b(Least-recently)42
b(used)i(\(LRU\))g(queue)g(device)396 3872 y(//)90 b(Clients)43
b(and)i(workers)e(are)i(shown)f(here)g(in-process)396
3969 y(//)396 4066 y(#include)g("zhelpers.h")396 4163
y(#include)g(<pthread.h>)396 4357 y(#define)g(NBR_CLIENTS)f(10)396
4454 y(#define)h(NBR_WORKERS)f(3)396 4649 y(//)90 b(Dequeue)43
b(operation)h(for)g(queue)g(implemented)f(as)h(array)g(of)h(anything)
396 4746 y(#define)f(DEQUEUE\(q\))f(memmove)h(\(&\(q\)[0],)f
(&\(q\)[1],)h(sizeof)f(\(q\))i(-)f(sizeof)g(\(q)h([0]\)\))396
4940 y(//)90 b(Basic)44 b(request-reply)e(client)i(using)g(REQ)g
(socket)396 5037 y(//)90 b(Since)44 b(s_send)f(and)i(s_recv)f(can't)g
(handle)f(0MQ)i(binary)f(identities)f(we)396 5134 y(//)90
b(set)44 b(a)h(printable)e(text)h(identity)g(to)g(allow)g(routing.)p
Black 3759 5569 a Ff(104)p Black eop end
%%Page: 105 118
TeXDict begin 105 117 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.105) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fe(//)396 170 y(static)44
b(void)934 183 y(*)396 267 y(client_task)f(\(void)1203
280 y(*)1248 267 y(args\))396 364 y({)576 461 y(void)800
474 y(*)845 461 y(context)g(=)i(zmq_ctx_new)e(\(\);)576
558 y(void)800 571 y(*)845 558 y(client)g(=)i(zmq_socket)e(\(context,)h
(ZMQ_REQ\);)576 655 y(s_set_id)f(\(client\);)447 b(//)89
b(Set)45 b(a)f(printable)g(identity)576 752 y(zmq_connect)f(\(client,)g
("ipc://frontend.ipc"\);)576 947 y(//)89 b(Send)44 b(request,)g(get)g
(reply)576 1044 y(s_send)f(\(client,)h("HELLO"\);)576
1141 y(char)800 1154 y(*)845 1141 y(reply)g(=)g(s_recv)g(\(client\);)
576 1238 y(printf)f(\("Client:)h(\045s\\n",)g(reply\);)576
1335 y(free)g(\(reply\);)576 1432 y(zmq_close)f(\(client\);)576
1530 y(zmq_ctx_destroy)f(\(context\);)576 1627 y(return)h(NULL;)396
1724 y(})-2 1898 y
SDict begin H.S end
 -2 1898 a -2 1898 a
SDict begin 13 H.A end
 -2 1898 a -2 1898
a
SDict begin [/View [/XYZ H.V]/Dest (0:1466) cvn /DEST pdfmark end
 -2 1898 a 396 1998 a Fk(While)21 b(this)g(e)o(xample)d(runs)i(in)g(a)
h(single)f(process,)g(that)g(is)h(just)g(to)f(mak)o(e)g(it)h(easier)f
(to)h(start)f(and)g(stop)g(the)g(e)o(xample.)396 2106
y(Each)g(thread)f(has)i(its)g(o)n(wn)e(conte)o(xt)g(and)h(conceptually)
e(acts)j(as)g(a)f(separate)g(process.)g(This)g(is)h(the)f(w)o(ork)o(er)
g(task,)396 2214 y(using)g(a)h(REQ)f(sock)o(et)g(to)h(do)f(LR)m(U)g
(routing.)e(Since)j(s_send)e(and)h(s_recv)f(can')o(t)h(handle)f(\330MQ)
h(binary)f(identities)h(we)396 2322 y(set)h(a)g(printable)e(te)o(xt)h
(identity)f(to)i(allo)n(w)f(routing.)-2 2340 y
SDict begin H.S end
 -2 2340
a -2 2340 a
SDict begin 13 H.A end
 -2 2340 a -2 2340 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue-c-1) cvn /DEST pdfmark
end
 -2 2340 a 396 2523 a
Fg(Example)h(3-8.)e(LR)n(U)h(queue)h(br)o(ok)o(er)f(\(lruqueue.c\))g(-)
h(w)o(ork)o(er)f(task)-2 2623 y
SDict begin H.S end
 -2 2623 a -2 2623 a
SDict begin 11.7 H.A end
 -2
2623 a -2 2623 a
SDict begin [/View [/XYZ H.V]/Dest (0:1469) cvn /DEST pdfmark end
 -2 2623 a 396 2800 a Fe(static)44 b(void)934
2813 y(*)396 2897 y(worker_task)f(\(void)1203 2910 y(*)1248
2897 y(args\))396 2994 y({)576 3092 y(void)800 3105 y(*)845
3092 y(context)g(=)i(zmq_ctx_new)e(\(\);)576 3189 y(void)800
3202 y(*)845 3189 y(worker)g(=)i(zmq_socket)e(\(context,)h(ZMQ_REQ\);)
576 3286 y(s_set_id)f(\(worker\);)447 b(//)89 b(Set)45
b(a)f(printable)g(identity)576 3383 y(zmq_connect)f(\(worker,)g
("ipc://backend.ipc"\);)576 3577 y(//)89 b(Tell)44 b(broker)g(we're)g
(ready)g(for)g(work)576 3674 y(s_send)f(\(worker,)h("READY"\);)576
3869 y(while)g(\(true\))f({)755 3966 y(//)89 b(Read)44
b(and)h(save)f(all)g(frames)g(until)g(we)h(get)f(an)g(empty)g(frame)755
4063 y(//)89 b(In)45 b(this)f(example)g(there)g(is)g(only)g(1)h(but)f
(it)h(could)f(be)g(more)755 4160 y(char)979 4173 y(*)1024
4160 y(address)g(=)g(s_recv)g(\(worker\);)755 4257 y(char)979
4270 y(*)1024 4257 y(empty)g(=)h(s_recv)e(\(worker\);)755
4354 y(assert)h(\()1114 4367 y(*)1159 4354 y(empty)f(==)i(0\);)755
4451 y(free)f(\(empty\);)755 4646 y(//)89 b(Get)45 b(request,)e(send)h
(reply)755 4743 y(char)979 4756 y(*)1024 4743 y(request)g(=)g(s_recv)g
(\(worker\);)755 4840 y(printf)g(\("Worker:)f(\045s\\n",)h(request\);)
755 4937 y(free)g(\(request\);)755 5131 y(s_sendmore)f(\(worker,)h
(address\);)p Black 3759 5569 a Ff(105)p Black eop end
%%Page: 106 119
TeXDict begin 106 118 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.106) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(s_sendmore)43 b(\(worker,)h(""\);)755
170 y(s_send)223 b(\(worker,)44 b("OK"\);)755 267 y(free)g
(\(address\);)576 364 y(})576 461 y(zmq_close)f(\(worker\);)576
558 y(zmq_ctx_destroy)f(\(context\);)576 655 y(return)h(NULL;)396
752 y(})-2 927 y
SDict begin H.S end
 -2 927 a -2 927 a
SDict begin 13 H.A end
 -2 927 a -2 927 a
SDict begin [/View [/XYZ H.V]/Dest (0:1470) cvn /DEST pdfmark end

-2 927 a 396 1026 a Fk(This)21 b(is)g(the)f(main)g(task.)g(It)h(starts)
g(the)f(clients)g(and)g(w)o(ork)o(ers,)f(and)h(then)f(routes)h
(requests)g(between)f(the)i(tw)o(o)f(layers.)396 1134
y(W)-7 b(ork)o(ers)20 b(signal)g(READ)-5 b(Y)22 b(when)d(the)o(y)h
(start;)g(after)g(that)h(we)f(treat)g(them)g(as)h(ready)e(when)h(the)o
(y)f(reply)h(with)g(a)396 1242 y(response)g(back)f(to)h(a)h(client.)f
(The)g(LR)m(U)g(data)g(structure)g(is)h(just)f(a)h(queue)e(of)h(ne)o
(xt)f(a)n(v)n(ailable)h(w)o(ork)o(ers.)-2 1260 y
SDict begin H.S end
 -2 1260
a -2 1260 a
SDict begin 13 H.A end
 -2 1260 a -2 1260 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue-c-2) cvn /DEST pdfmark
end
 -2 1260 a 396 1444 a
Fg(Example)h(3-9.)e(LR)n(U)h(queue)h(br)o(ok)o(er)f(\(lruqueue.c\))g(-)
h(main)f(task)-2 1543 y
SDict begin H.S end
 -2 1543 a -2 1543 a
SDict begin 11.7 H.A end
 -2 1543 a
-2 1543 a
SDict begin [/View [/XYZ H.V]/Dest (0:1473) cvn /DEST pdfmark end
 -2 1543 a 396 1721 a Fe(int)45 b(main)f(\(void\))396
1818 y({)576 1915 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(sockets)
576 2012 y(void)800 2025 y(*)845 2012 y(context)f(=)i(zmq_ctx_new)e
(\(\);)576 2109 y(void)800 2122 y(*)845 2109 y(frontend)g(=)i
(zmq_socket)e(\(context,)g(ZMQ_ROUTER\);)576 2207 y(void)800
2220 y(*)845 2207 y(backend)88 b(=)45 b(zmq_socket)e(\(context,)g
(ZMQ_ROUTER\);)576 2304 y(zmq_bind)g(\(frontend,)g
("ipc://frontend.ipc"\);)576 2401 y(zmq_bind)g(\(backend,)88
b("ipc://backend.ipc"\);)576 2595 y(int)44 b(client_nbr;)576
2692 y(for)g(\(client_nbr)f(=)i(0;)f(client_nbr)f(<)i(NBR_CLIENTS;)e
(client_nbr++\))f({)755 2789 y(pthread_t)h(client;)755
2887 y(pthread_create)f(\(&client,)i(NULL,)g(client_task,)f(NULL\);)576
2984 y(})576 3081 y(int)h(worker_nbr;)576 3178 y(for)g(\(worker_nbr)f
(=)i(0;)f(worker_nbr)f(<)i(NBR_WORKERS;)e(worker_nbr++\))f({)755
3275 y(pthread_t)h(worker;)755 3372 y(pthread_create)f(\(&worker,)i
(NULL,)g(worker_task,)f(NULL\);)576 3469 y(})-2 3644
y
SDict begin H.S end
 -2 3644 a -2 3644 a
SDict begin 13 H.A end
 -2 3644 a -2 3644 a
SDict begin [/View [/XYZ H.V]/Dest (0:1474) cvn /DEST pdfmark end
 -2 3644 a 396
3743 a Fk(Here)20 b(is)h(the)g(main)e(loop)h(for)f(the)i
(least-recently-used)c(queue.)i(It)i(has)f(tw)o(o)h(sock)o(ets;)f(a)h
(frontend)d(for)h(clients)i(and)e(a)396 3851 y(back)o(end)g(for)g(w)o
(ork)o(ers.)h(It)g(polls)g(the)h(back)o(end)d(in)i(all)h(cases,)g(and)f
(polls)g(the)g(frontend)e(only)h(when)h(there)g(are)g(one)f(or)396
3959 y(more)h(w)o(ork)o(ers)f(ready)-5 b(.)19 b(This)h(is)h(a)g(neat)f
(w)o(ay)g(to)g(use)h(\330MQ')-5 b(s)21 b(o)n(wn)e(queues)h(to)g(hold)f
(messages)i(we')l(re)e(not)h(ready)f(to)396 4067 y(process)h(yet.)g
(When)g(we)h(get)f(a)g(client)h(reply)-5 b(,)18 b(we)j(pop)e(the)h(ne)o
(xt)g(a)n(v)n(ailable)g(w)o(ork)o(er)m(,)e(and)i(send)g(the)g(request)g
(to)g(it,)396 4175 y(including)e(the)i(originating)d(client)j(address.)
e(When)i(a)g(w)o(ork)o(er)e(replies,)h(we)h(re-queue)e(that)h(w)o(ork)o
(er)m(,)f(and)h(we)h(forw)o(ard)396 4283 y(the)g(reply)g(to)g(the)g
(original)f(client,)h(using)g(the)g(address)g(en)m(v)o(elope.)-2
4301 y
SDict begin H.S end
 -2 4301 a -2 4301 a
SDict begin 13 H.A end
 -2 4301 a -2 4301 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue-c-3) cvn /DEST pdfmark
end
 -2 4301
a 396 4484 a Fg(Example)h(3-10.)d(LR)n(U)j(queue)g(br)o(ok)o(er)f
(\(lruqueue.c\))g(-)g(main)h(task)f(body)-2 4584 y
SDict begin H.S end
 -2
4584 a -2 4584 a
SDict begin 11.7 H.A end
 -2 4584 a -2 4584 a
SDict begin [/View [/XYZ H.V]/Dest (0:1477) cvn /DEST pdfmark end
 -2 4584 a 576 4664
a Fe(//)89 b(Queue)44 b(of)g(available)g(workers)576
4762 y(int)g(available_workers)e(=)j(0;)576 4859 y(char)800
4872 y(*)845 4859 y(worker_queue)d([10];)576 5053 y(while)i(\(true\))f
({)755 5150 y(zmq_pollitem_t)f(items)i([])h(=)g({)p Black
3757 5569 a Ff(106)p Black eop end
%%Page: 107 120
TeXDict begin 107 119 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.107) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 934 72 a Fe({)45 b(backend,)88 b(0,)45
b(ZMQ_POLLIN,)e(0)h(},)934 170 y({)h(frontend,)e(0,)i(ZMQ_POLLIN,)e(0)h
(})755 267 y(};)755 364 y(//)89 b(Poll)44 b(frontend)g(only)g(if)h(we)f
(have)g(available)g(workers)755 461 y(int)g(rc)h(=)f(zmq_poll)g
(\(items,)g(available_workers)e(?)i(2)h(:)g(1,)f(-1\);)755
558 y(if)g(\(rc)h(==)f(-1\))934 655 y(break;)627 b(//)89
b(Interrupted)755 850 y(//)g(Handle)44 b(worker)g(activity)f(on)i
(backend)755 947 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)
934 1044 y(//)90 b(Queue)44 b(worker)f(address)h(for)g(LRU)h(routing)
934 1141 y(char)1158 1154 y(*)1203 1141 y(worker_addr)e(=)i(s_recv)f
(\(backend\);)934 1238 y(assert)g(\(available_workers)e(<)j
(NBR_WORKERS\);)934 1335 y(worker_queue)e([available_workers++])e(=)k
(worker_addr;)934 1530 y(//)90 b(Second)43 b(frame)h(is)h(empty)934
1627 y(char)1158 1640 y(*)1203 1627 y(empty)f(=)h(s_recv)f
(\(backend\);)934 1724 y(assert)g(\(empty)g([0])g(==)h(0\);)934
1821 y(free)f(\(empty\);)934 2015 y(//)90 b(Third)44
b(frame)g(is)g(READY)g(or)h(else)f(a)g(client)g(reply)g(address)934
2112 y(char)1158 2125 y(*)1203 2112 y(client_addr)f(=)i(s_recv)f
(\(backend\);)934 2307 y(//)90 b(If)44 b(client)g(reply,)g(send)g(rest)
g(back)g(to)h(frontend)934 2404 y(if)g(\(strcmp)e(\(client_addr,)g
("READY"\))h(!=)g(0\))h({)1114 2501 y(empty)f(=)g(s_recv)g
(\(backend\);)1114 2598 y(assert)f(\(empty)h([0])h(==)f(0\);)1114
2695 y(free)g(\(empty\);)1114 2792 y(char)1338 2805 y(*)1383
2792 y(reply)g(=)g(s_recv)g(\(backend\);)1114 2889 y(s_sendmore)f
(\(frontend,)g(client_addr\);)1114 2987 y(s_sendmore)g(\(frontend,)g
(""\);)1114 3084 y(s_send)223 b(\(frontend,)43 b(reply\);)1114
3181 y(free)h(\(reply\);)1114 3278 y(if)g(\(--client_nbr)f(==)h(0\))
1293 3375 y(break;)268 b(//)89 b(Exit)44 b(after)g(N)h(messages)934
3472 y(})934 3569 y(free)f(\(client_addr\);)755 3666
y(})-2 3841 y
SDict begin H.S end
 -2 3841 a -2 3841 a
SDict begin 13 H.A end
 -2 3841 a -2 3841 a
SDict begin [/View [/XYZ H.V]/Dest (0:1478) cvn /DEST pdfmark end

-2 3841 a 396 3940 a Fk(Here)20 b(is)h(ho)n(w)f(we)h(handle)e(a)h
(client)h(request:)-2 3958 y
SDict begin H.S end
 -2 3958 a -2 3958 a
SDict begin 13 H.A end
 -2 3958
a -2 3958 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue-c-4) cvn /DEST pdfmark
end
 -2 3958 a 396 4142 a Fg(Example)g(3-11.)d(LR)n(U)j(queue)g
(br)o(ok)o(er)f(\(lruqueue.c\))g(-)g(handling)h(a)f(client)g(r)o
(equest)-2 4242 y
SDict begin H.S end
 -2 4242 a -2 4242 a
SDict begin 11.7 H.A end
 -2 4242 a -2 4242
a
SDict begin [/View [/XYZ H.V]/Dest (0:1481) cvn /DEST pdfmark end
 -2 4242 a 755 4322 a Fe(if)44 b(\(items)g([1].revents)f(&)i
(ZMQ_POLLIN\))e({)934 4419 y(//)90 b(Now)44 b(get)g(next)g(client)g
(request,)g(route)g(to)g(LRU)h(worker)934 4516 y(//)90
b(Client)43 b(request)h(is)h([address][empty][request])934
4613 y(char)1158 4626 y(*)1203 4613 y(client_addr)e(=)i(s_recv)f
(\(frontend\);)934 4711 y(char)1158 4724 y(*)1203 4711
y(empty)g(=)h(s_recv)f(\(frontend\);)934 4808 y(assert)g(\(empty)g([0])
g(==)h(0\);)934 4905 y(free)f(\(empty\);)934 5002 y(char)1158
5015 y(*)1203 5002 y(request)g(=)h(s_recv)e(\(frontend\);)p
Black 3756 5569 a Ff(107)p Black eop end
%%Page: 108 121
TeXDict begin 108 120 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.108) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1498) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 934 72 a Fe(s_sendmore)43 b(\(backend,)h
(worker_queue)f([0]\);)934 170 y(s_sendmore)g(\(backend,)h(""\);)934
267 y(s_sendmore)f(\(backend,)h(client_addr\);)934 364
y(s_sendmore)f(\(backend,)h(""\);)934 461 y(s_send)223
b(\(backend,)44 b(request\);)934 655 y(free)g(\(client_addr\);)934
752 y(free)g(\(request\);)934 947 y(//)90 b(Dequeue)43
b(and)i(drop)f(the)g(next)g(worker)g(address)934 1044
y(free)g(\(worker_queue)f([0]\);)934 1141 y(DEQUEUE)h
(\(worker_queue\);)934 1238 y(available_workers--;)755
1335 y(})576 1432 y(})576 1530 y(zmq_close)f(\(frontend\);)576
1627 y(zmq_close)g(\(backend\);)576 1724 y(zmq_ctx_destroy)f
(\(context\);)576 1821 y(return)h(0;)396 1918 y(})-2
2092 y
SDict begin H.S end
 -2 2092 a -2 2092 a
SDict begin 13 H.A end
 -2 2092 a -2 2092 a
SDict begin [/View [/XYZ H.V]/Dest (0:1482) cvn /DEST pdfmark end
 -2 2092
a 396 2192 a Fk(The)20 b(dif)n(\002cult)g(part)g(of)f(this)i(program)d
(is)j(\(a\))f(the)g(en)m(v)o(elopes)f(that)h(each)g(sock)o(et)g(reads)g
(and)f(writes,)i(and)e(\(b\))h(the)g(LR)m(U)396 2300
y(algorithm.)f(W)-7 b(e')o(ll)21 b(tak)o(e)f(these)h(in)f(turn,)f
(starting)h(with)g(the)h(message)f(en)m(v)o(elope)d(formats.)-2
2484 y
SDict begin H.S end
 -2 2484 a -2 2484 a
SDict begin 13 H.A end
 -2 2484 a -2 2484 a
SDict begin [/View [/XYZ H.V]/Dest (0:1483) cvn /DEST pdfmark end
 -2 2484
a 396 2574 a Fk(First,)k(recall)f(that)g(a)h(REQ)g(REQ)g(sock)o(et)f
(al)o(w)o(ays)g(puts)h(on)e(an)h(empty)g(part)g(\(the)f(en)m(v)o(elope)
f(delimiter\))i(on)f(sending)396 2682 y(and)h(remo)o(v)o(es)e(this)j
(empty)e(part)h(on)g(reception.)f(The)g(reason)h(for)f(this)i(isn')o(t)
f(important,)e(it')-5 b(s)22 b(just)e(part)g(of)g(the)396
2790 y('normal')f(request-reply)e(pattern.)i(What)i(we)f(care)g(about)g
(here)f(is)i(just)g(k)o(eeping)e(REQ)i(happ)o(y)e(by)g(doing)g
(precisely)396 2898 y(what)h(she)h(needs.)e(Second,)g(the)i(R)m(OUTER)f
(al)o(w)o(ays)h(adds)f(an)g(en)m(v)o(elope)e(with)i(the)g(address)g(of)
g(whome)n(v)o(er)e(the)396 3006 y(message)i(came)g(from.)-2
3190 y
SDict begin H.S end
 -2 3190 a -2 3190 a
SDict begin 13 H.A end
 -2 3190 a -2 3190 a
SDict begin [/View [/XYZ H.V]/Dest (0:1484) cvn /DEST pdfmark end
 -2 3190
a 396 3280 a Fk(W)-7 b(e)22 b(can)e(no)n(w)f(w)o(alk)i(through)d(a)i
(full)g(request-reply)e(chain)i(from)f(client)h(to)g(w)o(ork)o(er)g
(and)f(back.)g(In)h(this)h(code)f(we)g(set)396 3388 y(the)g(identity)g
(of)g(client)g(and)g(w)o(ork)o(er)f(sock)o(ets)h(to)h(mak)o(e)e(it)i
(easier)g(to)f(trace)g(the)g(message)g(frames.)g(Most)g(normal)396
3495 y(applications)f(do)h(not)g(use)g(identities.)g(Let')-5
b(s)21 b(assume)f(the)g(client')-5 b(s)21 b(identity)f(is)h("CLIENT")e
(and)h(the)g(w)o(ork)o(er')-5 b(s)396 3603 y(identity)20
b(is)h("W)o(ORKER".)g(The)f(client)g(sends)g(a)h(single)f(frame)f(with)
i(the)f(message\()p 0 TeXcolorgray 2867 3603 a
SDict begin H.S end
 2867 3603
a Fk(Figure)e(3-14)3257 3603 y
SDict begin 13 H.L end
 3257 3603 a 3257 3603
a
SDict begin [/Subtype /Link/Dest (0:figure-40) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3257 3603 a Black -1 w Fk(\).)-2 3621 y
SDict begin H.S end
 -2 3621 a -2
3621 a
SDict begin 13 H.A end
 -2 3621 a -2 3621 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-40) cvn /DEST pdfmark
end
 -2 3621 a 396 3805 a Fg(Figur)o(e)i(3-14.)e
(Message)j(that)f(Client)g(Sends)-2 3905 y
SDict begin H.S end
 -2 3905 a
-2 3905 a
SDict begin 13 H.A end
 -2 3905 a -2 3905 a
SDict begin [/View [/XYZ H.V]/Dest (0:1488) cvn /DEST pdfmark end
 -2 3905 a 396 4529 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396
4529 a @beginspecial 0 @llx -70 @lly 308 @urx 0 @ury
3080 @rwi @setspecial
%%BeginDocument: images/fig40.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -70 308 0
%%HiResBoundingBox: 0.0 -70.0 308.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
89.10021209716797 -27.100210189819336 moveto
89.10021209716797 -47.1002082824707 lineto
115.10021209716797 -47.1002082824707 lineto
115.10021209716797 -27.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.10021209716797 -27.100210189819336 moveto
118.10021209716797 -47.1002082824707 lineto
173.10020446777344 -47.1002082824707 lineto
173.10020446777344 -27.100210189819336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
87.0 -25.0 moveto
87.0 -45.0 lineto
113.0 -45.0 lineto
113.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
87.0 -25.0 moveto
87.0 -45.0 lineto
113.0 -45.0 lineto
113.0 -25.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -25.0 moveto
116.0 -45.0 lineto
171.0 -45.0 lineto
171.0 -25.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -25.0 moveto
116.0 -45.0 lineto
171.0 -45.0 lineto
171.0 -25.0 lineto
closepath
stroke
/Helvetica findfont
10 scalefont setfont
15.0 -39.0 moveto
(Frame 1) show
100.0 -39.0 moveto
(5 ) show
126.0 -39.0 moveto
(HELLO) show
227.0 -39.0 moveto
(Data frame) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4529 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4529 a -2 4695 a
SDict begin H.S end
 -2 4695
a -2 4695 a
SDict begin 13 H.A end
 -2 4695 a -2 4695 a
SDict begin [/View [/XYZ H.V]/Dest (0:1491) cvn /DEST pdfmark end
 -2 4695 a 396 4803 a
Fk(What)h(the)f(queue)f(gets,)h(when)g(reading)f(of)n(f)g(the)h(R)m
(OUTER)h(frontend)d(sock)o(et,)i(are)g(three)g(frames)f(consisting)h
(of)g(the)396 4911 y(sender)g(address,)f(empty)h(frame)f(delimiter)m(,)
g(and)g(the)i(data)f(part\()p 0 TeXcolorgray 2285 4911
a
SDict begin H.S end
 2285 4911 a Fk(Figure)e(3-15)2675 4911 y
SDict begin 13 H.L end
 2675 4911
a 2675 4911 a
SDict begin [/Subtype /Link/Dest (0:figure-41) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2675 4911 a Black -2 w Fk(\).)-2 4929 y
SDict begin H.S end

-2 4929 a -2 4929 a
SDict begin 13 H.A end
 -2 4929 a -2 4929 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-41) cvn /DEST pdfmark
end
 -2 4929 a Black
3759 5569 a Ff(108)p Black eop end
%%Page: 109 122
TeXDict begin 109 121 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.109) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1514) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-15.)e(Message)j
(Coming)f(in)h(on)f(Fr)o(ontend)-2 172 y
SDict begin H.S end
 -2 172 a -2
172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1495) cvn /DEST pdfmark end
 -2 172 a 396 947 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 947 a
@beginspecial 0 @llx -88 @lly 318 @urx 0 @ury 3180 @rwi
@setspecial
%%BeginDocument: images/fig41.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -88 318 0
%%HiResBoundingBox: 0.0 -88.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -21.800180435180664 moveto
76.80017852783203 -35.80017852783203 lineto
98.80017852783203 -35.80017852783203 lineto
98.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -21.800180435180664 moveto
101.80017852783203 -37.80017852783203 lineto
154.80018615722656 -37.80017852783203 lineto
154.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -38.80017852783203 moveto
76.80017852783203 -51.80017852783203 lineto
100.80017852783203 -51.80017852783203 lineto
100.80017852783203 -38.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -54.80017852783203 moveto
76.80017852783203 -69.80017852783203 lineto
98.80017852783203 -69.80017852783203 lineto
98.80017852783203 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -53.80017852783203 moveto
101.80017852783203 -69.80017852783203 lineto
148.80018615722656 -69.80017852783203 lineto
148.80018615722656 -53.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
97.0 -68.0 lineto
97.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
97.0 -68.0 lineto
97.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
147.0 -68.0 lineto
147.0 -52.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
147.0 -68.0 lineto
147.0 -52.0 lineto
closepath
stroke
/Helvetica findfont
8 scalefont setfont
15.0 -31.0 moveto
(Frame 1) show
86.0 -31.0 moveto
(6 ) show
111.0 -31.0 moveto
(CLIENT) show
196.0 -31.0 moveto
(Identity of client) show
15.0 -47.0 moveto
(Frame 2) show
86.0 -47.0 moveto
(0 ) show
200.0 -47.0 moveto
(Empty message frame) show
15.0 -63.0 moveto
(Frame 3) show
86.0 -63.0 moveto
(5 ) show
109.0 -63.0 moveto
(HELLO) show
198.0 -63.0 moveto
(Data frame) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 947 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 947 a 274 x Fk(The)g(brok)o(er)f(sends)h
(this)h(to)f(the)g(w)o(ork)o(er)m(,)f(pre\002x)o(ed)f(by)i(the)g
(address)g(of)g(the)g(w)o(ork)o(er)m(,)f(tak)o(en)h(from)f(the)h(LR)m
(U)h(queue,)396 1329 y(plus)f(an)h(additional)d(empty)i(part)g(to)g(k)o
(eep)g(the)g(REQ)h(at)f(the)g(other)g(end)f(happ)o(y\()p
0 TeXcolorgray 2723 1329 a
SDict begin H.S end
 2723 1329 a Fk(Figure)f(3-16)3113
1329 y
SDict begin 13 H.L end
 3113 1329 a 3113 1329 a
SDict begin [/Subtype /Link/Dest (0:figure-42) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3113 1329 a Black -2 w
Fk(\).)-2 1347 y
SDict begin H.S end
 -2 1347 a -2 1347 a
SDict begin 13 H.A end
 -2 1347 a -2 1347
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-42) cvn /DEST pdfmark
end
 -2 1347 a 396 1530 a Fg(Figur)o(e)i(3-16.)e(Message)j(Sent)f(to)g
(Back)o(end)-2 1630 y
SDict begin H.S end
 -2 1630 a -2 1630 a
SDict begin 13 H.A end
 -2 1630 a -2
1630 a
SDict begin [/View [/XYZ H.V]/Dest (0:1502) cvn /DEST pdfmark end
 -2 1630 a 396 2672 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2672 a @beginspecial
0 @llx -120 @lly 318 @urx 0 @ury 3180 @rwi @setspecial
%%BeginDocument: images/fig42.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -120 318 0
%%HiResBoundingBox: 0.0 -120.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -21.800180435180664 moveto
76.80017852783203 -35.80017852783203 lineto
98.80017852783203 -35.80017852783203 lineto
98.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -21.800180435180664 moveto
101.80017852783203 -37.80017852783203 lineto
154.80018615722656 -37.80017852783203 lineto
154.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -38.80017852783203 moveto
76.80017852783203 -51.80017852783203 lineto
100.80017852783203 -51.80017852783203 lineto
100.80017852783203 -38.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -54.80017852783203 moveto
76.80017852783203 -67.80017852783203 lineto
98.80017852783203 -67.80017852783203 lineto
98.80017852783203 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -53.80017852783203 moveto
101.80017852783203 -69.80017852783203 lineto
154.80018615722656 -69.80017852783203 lineto
154.80018615722656 -53.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -70.80017852783203 moveto
76.80017852783203 -83.80017852783203 lineto
100.80017852783203 -83.80017852783203 lineto
100.80017852783203 -70.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -86.80017852783203 moveto
76.80017852783203 -101.80017852783203 lineto
98.80017852783203 -101.80017852783203 lineto
98.80017852783203 -86.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -85.80017852783203 moveto
101.80017852783203 -101.80017852783203 lineto
148.80018615722656 -101.80017852783203 lineto
148.80018615722656 -85.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -66.0 lineto
97.0 -66.0 lineto
97.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -66.0 lineto
97.0 -66.0 lineto
97.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
153.0 -68.0 lineto
153.0 -52.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
153.0 -68.0 lineto
153.0 -52.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -69.0 moveto
75.0 -82.0 lineto
99.0 -82.0 lineto
99.0 -69.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -69.0 moveto
75.0 -82.0 lineto
99.0 -82.0 lineto
99.0 -69.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -85.0 moveto
75.0 -100.0 lineto
97.0 -100.0 lineto
97.0 -85.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -85.0 moveto
75.0 -100.0 lineto
97.0 -100.0 lineto
97.0 -85.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -84.0 moveto
100.0 -100.0 lineto
147.0 -100.0 lineto
147.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -84.0 moveto
100.0 -100.0 lineto
147.0 -100.0 lineto
147.0 -84.0 lineto
closepath
stroke
/Helvetica findfont
8 scalefont setfont
15.0 -31.0 moveto
(Frame 1) show
86.0 -31.0 moveto
(6 ) show
109.0 -31.0 moveto
(WORKER) show
199.0 -31.0 moveto
(Identity of worker) show
15.0 -47.0 moveto
(Frame 2) show
86.0 -47.0 moveto
(0 ) show
200.0 -47.0 moveto
(Empty message frame) show
15.0 -63.0 moveto
(Frame 3) show
86.0 -63.0 moveto
(6 ) show
111.0 -63.0 moveto
(CLIENT) show
196.0 -63.0 moveto
(Identity of client) show
15.0 -79.0 moveto
(Frame 4) show
86.0 -79.0 moveto
(0 ) show
200.0 -79.0 moveto
(Empty message frame) show
15.0 -95.0 moveto
(Frame 5) show
86.0 -95.0 moveto
(5 ) show
109.0 -95.0 moveto
(HELLO) show
198.0 -95.0 moveto
(Data frame) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2672 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2672 a -2 2838 a
SDict begin H.S end
 -2 2838
a -2 2838 a
SDict begin 13 H.A end
 -2 2838 a -2 2838 a
SDict begin [/View [/XYZ H.V]/Dest (0:1505) cvn /DEST pdfmark end
 -2 2838 a 396 2946 a
Fk(This)h(comple)o(x)d(en)m(v)o(elope)g(stack)i(gets)h(che)n(wed)e(up)h
(\002rst)h(by)f(the)g(back)o(end)e(R)m(OUTER)j(sock)o(et,)f(which)f
(remo)o(v)o(es)g(the)396 3054 y(\002rst)i(frame.)e(Then)h(the)g(REQ)h
(sock)o(et)f(in)g(the)g(w)o(ork)o(er)f(remo)o(v)o(es)g(the)h(empty)g
(part,)f(and)h(pro)o(vides)e(the)i(rest)h(to)f(the)396
3162 y(w)o(ork)o(er)f(application\()p 0 TeXcolorgray
1049 3162 a
SDict begin H.S end
 1049 3162 a Fk(Figure)f(3-17)1439 3162 y
SDict begin 13 H.L end

1439 3162 a 1439 3162 a
SDict begin [/Subtype /Link/Dest (0:figure-43) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1439 3162 a Black -2 w Fk(\).)-2
3180 y
SDict begin H.S end
 -2 3180 a -2 3180 a
SDict begin 13 H.A end
 -2 3180 a -2 3180 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-43) cvn /DEST pdfmark
end
 -2 3180
a 396 3363 a Fg(Figur)o(e)i(3-17.)e(Message)j(Deli)o(v)o(er)o(ed)f(to)g
(W)-6 b(ork)o(er)-2 3463 y
SDict begin H.S end
 -2 3463 a -2 3463 a
SDict begin 13 H.A end
 -2 3463
a -2 3463 a
SDict begin [/View [/XYZ H.V]/Dest (0:1509) cvn /DEST pdfmark end
 -2 3463 a 396 4238 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4238 a @beginspecial
0 @llx -88 @lly 318 @urx 0 @ury 3180 @rwi @setspecial
%%BeginDocument: images/fig43.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -88 318 0
%%HiResBoundingBox: 0.0 -88.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -21.800180435180664 moveto
76.80017852783203 -35.80017852783203 lineto
98.80017852783203 -35.80017852783203 lineto
98.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -21.800180435180664 moveto
101.80017852783203 -37.80017852783203 lineto
154.80018615722656 -37.80017852783203 lineto
154.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -38.80017852783203 moveto
76.80017852783203 -51.80017852783203 lineto
100.80017852783203 -51.80017852783203 lineto
100.80017852783203 -38.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
76.80017852783203 -54.80017852783203 moveto
76.80017852783203 -69.80017852783203 lineto
98.80017852783203 -69.80017852783203 lineto
98.80017852783203 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
101.80017852783203 -53.80017852783203 moveto
101.80017852783203 -69.80017852783203 lineto
148.80018615722656 -69.80017852783203 lineto
148.80018615722656 -53.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
75.0 -20.0 moveto
75.0 -34.0 lineto
97.0 -34.0 lineto
97.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -20.0 moveto
100.0 -36.0 lineto
153.0 -36.0 lineto
153.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -37.0 moveto
75.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -37.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
97.0 -68.0 lineto
97.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
75.0 -53.0 moveto
75.0 -68.0 lineto
97.0 -68.0 lineto
97.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
147.0 -68.0 lineto
147.0 -52.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -52.0 moveto
100.0 -68.0 lineto
147.0 -68.0 lineto
147.0 -52.0 lineto
closepath
stroke
/Helvetica findfont
8 scalefont setfont
15.0 -31.0 moveto
(Frame 1) show
86.0 -31.0 moveto
(6 ) show
111.0 -31.0 moveto
(CLIENT) show
196.0 -31.0 moveto
(Identity of client) show
15.0 -47.0 moveto
(Frame 2) show
86.0 -47.0 moveto
(0 ) show
200.0 -47.0 moveto
(Empty message frame) show
15.0 -63.0 moveto
(Frame 3) show
86.0 -63.0 moveto
(5 ) show
109.0 -63.0 moveto
(HELLO) show
198.0 -63.0 moveto
(Data frame) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4238 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4238 a -2 4404 a
SDict begin H.S end
 -2 4404
a -2 4404 a
SDict begin 13 H.A end
 -2 4404 a -2 4404 a
SDict begin [/View [/XYZ H.V]/Dest (0:1512) cvn /DEST pdfmark end
 -2 4404 a 396 4512 a
Fk(Which)20 b(is)h(e)o(xactly)f(the)g(same)g(as)h(what)f(the)h(queue)e
(recei)n(v)o(ed)f(on)i(its)h(frontend)d(R)m(OUTER)j(sock)o(et.)f(The)f
(w)o(ork)o(er)h(has)396 4620 y(to)h(sa)n(v)o(e)f(the)g(en)m(v)o(elope)e
(\(which)h(is)j(all)e(the)h(parts)f(up)f(to)i(and)e(including)g(the)h
(empty)f(message)h(frame\))f(and)h(then)g(it)h(can)396
4728 y(do)f(what')-5 b(s)21 b(needed)d(with)j(the)f(data)g(part.)-2
4912 y
SDict begin H.S end
 -2 4912 a -2 4912 a
SDict begin 13 H.A end
 -2 4912 a -2 4912 a
SDict begin [/View [/XYZ H.V]/Dest (0:1513) cvn /DEST pdfmark end
 -2 4912
a 396 5001 a Fk(On)g(the)h(return)e(path)g(the)i(messages)f(are)g(the)g
(same)h(as)g(when)e(the)o(y)h(come)f(in,)h(i.e.)g(the)h(back)o(end)d
(sock)o(et)i(gi)n(v)o(es)g(the)396 5109 y(queue)f(a)i(message)f(in)g
(\002)n(v)o(e)g(parts,)g(and)g(the)g(queue)f(sends)h(the)g(frontend)e
(sock)o(et)j(a)f(message)g(in)g(three)g(parts,)g(and)g(the)p
Black 3759 5569 a Ff(109)p Black eop end
%%Page: 110 123
TeXDict begin 110 122 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.110) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1530) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fk(client)20 b(gets)h(a)g(message)f
(in)g(one)g(part.)396 346 y(No)n(w)g(let')-5 b(s)21 b(look)f(at)h(the)f
(LR)m(U)g(algorithm.)f(It)h(requires)f(that)i(both)e(clients)h(and)g(w)
o(ork)o(ers)g(use)g(REQ)h(sock)o(ets,)f(and)g(that)396
454 y(w)o(ork)o(ers)g(correctly)f(store)h(and)f(replay)h(the)g(en)m(v)o
(elope)e(on)h(messages)i(the)o(y)e(get.)h(The)g(algorithm)f(is:)-2
472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:1515) cvn /DEST pdfmark end
 -2 472 a -2
482 a
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 13 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:1516) cvn /DEST pdfmark end
 -2 482 a Black
396 625 a Fj(\225)p Black 479 625 a
SDict begin H.S end
 479 625 a 479 625
a
SDict begin 13 H.A end
 479 625 a 479 625 a
SDict begin [/View [/XYZ H.V]/Dest (0:1517) cvn /DEST pdfmark end
 479 625 a Fk(Create)i(a)f(pollset)h(which)e
(polls)h(the)h(back)o(end)d(al)o(w)o(ays,)j(and)e(the)h(frontend)e
(only)i(if)g(there)g(are)g(one)g(or)g(more)479 733 y(w)o(ork)o(ers)g(a)
n(v)n(ailable.)-2 734 y
SDict begin H.S end
 -2 734 a -2 734 a
SDict begin 13 H.A end
 -2 734 a -2
734 a
SDict begin [/View [/XYZ H.V]/Dest (0:1518) cvn /DEST pdfmark end
 -2 734 a Black 396 882 a Fj(\225)p Black 479 882
a
SDict begin H.S end
 479 882 a 479 882 a
SDict begin 13 H.A end
 479 882 a 479 882 a
SDict begin [/View [/XYZ H.V]/Dest (0:1519) cvn /DEST pdfmark end
 479 882 a Fk(Poll)h(for)e
(acti)n(vity)h(with)h(in\002nite)f(timeout.)-2 900 y
SDict begin H.S end

-2 900 a -2 900 a
SDict begin 13 H.A end
 -2 900 a -2 900 a
SDict begin [/View [/XYZ H.V]/Dest (0:1520) cvn /DEST pdfmark end
 -2 900 a Black 396
1031 a Fj(\225)p Black 479 1031 a
SDict begin H.S end
 479 1031 a 479 1031
a
SDict begin 13 H.A end
 479 1031 a 479 1031 a
SDict begin [/View [/XYZ H.V]/Dest (0:1521) cvn /DEST pdfmark end
 479 1031 a Fk(If)g(there)g(is)h(acti)n(vity)f
(on)g(the)g(back)o(end,)e(we)j(either)f(ha)n(v)o(e)f(a)i("ready")e
(message)h(or)g(a)g(reply)g(for)f(a)i(client.)f(In)g(either)479
1139 y(case)h(we)f(store)h(the)f(w)o(ork)o(er)f(address)h(\(the)g
(\002rst)h(part\))e(on)h(our)f(LR)m(U)i(queue,)e(and)g(if)i(the)f(rest)
g(is)i(a)e(client)g(reply)g(we)479 1247 y(send)g(it)h(back)f(to)g(that)
g(client)g(via)h(the)f(frontend.)-2 1248 y
SDict begin H.S end
 -2 1248 a
-2 1248 a
SDict begin 13 H.A end
 -2 1248 a -2 1248 a
SDict begin [/View [/XYZ H.V]/Dest (0:1522) cvn /DEST pdfmark end
 -2 1248 a Black 396 1397
a Fj(\225)p Black 479 1397 a
SDict begin H.S end
 479 1397 a 479 1397 a
SDict begin 13 H.A end
 479
1397 a 479 1397 a
SDict begin [/View [/XYZ H.V]/Dest (0:1523) cvn /DEST pdfmark end
 479 1397 a Fk(If)g(there)g(is)h(acti)n(vity)f(on)g
(the)g(frontend,)e(we)i(tak)o(e)g(the)h(client)f(request,)f(pop)g(the)i
(ne)o(xt)e(w)o(ork)o(er)g(\(which)h(is)h(the)479 1505
y(least-recently)e(used\),)h(and)f(send)h(the)g(request)g(to)g(the)g
(back)o(end.)f(This)h(means)g(sending)f(the)h(w)o(ork)o(er)f(address,)
479 1613 y(empty)h(part,)f(and)h(then)g(the)g(three)f(parts)i(of)f(the)
g(client)g(request.)-2 1797 y
SDict begin H.S end
 -2 1797 a -2 1797 a
SDict begin 13 H.A end
 -2
1797 a -2 1797 a
SDict begin [/View [/XYZ H.V]/Dest (0:1524) cvn /DEST pdfmark end
 -2 1797 a 396 1887 a Fk(Y)-9 b(ou)20
b(should)f(no)n(w)h(see)g(that)h(you)e(can)h(reuse)g(and)g(e)o(xtend)e
(the)j(LR)m(U)f(algorithm)f(with)h(v)n(ariations)f(based)h(on)g(the)396
1994 y(information)e(the)i(w)o(ork)o(er)f(pro)o(vides)g(in)h(its)h
(initial)g("ready")e(message.)h(F)o(or)f(e)o(xample,)g(w)o(ork)o(ers)h
(might)f(start)i(up)f(and)396 2102 y(do)g(a)h(performance)c(self-test,)
j(then)g(tell)h(the)f(brok)o(er)f(ho)n(w)g(f)o(ast)i(the)o(y)f(are.)f
(The)h(brok)o(er)f(can)h(then)g(choose)f(the)h(f)o(astest)396
2210 y(a)n(v)n(ailable)g(w)o(ork)o(er)f(rather)h(than)f(LR)m(U)i(or)f
(round-robin.)-2 2221 y
SDict begin H.S end
 -2 2221 a -2 2221 a
SDict begin 13 H.A end
 -2 2221 a
-2 2221 a
SDict begin [/View [/XYZ H.V]/Dest (0:1525) cvn /DEST pdfmark end
 -2 2221 a 377 x Fn(3.7.)39 b(A)g(High-Le)n(vel)e(API)j(f)m
(or)f(\330MQ)2043 2598 y
SDict begin H.S end
 2043 2598 a 2043 2598 a
SDict begin 22.464 H.A end
 2043
2598 a 2043 2598 a
SDict begin [/View [/XYZ H.V]/Dest (8.52.1) cvn /DEST pdfmark end
 2043 2598 a -2 2796 a
SDict begin H.S end
 -2 2796 a -2
2796 a
SDict begin 13 H.A end
 -2 2796 a -2 2796 a
SDict begin [/View [/XYZ H.V]/Dest (0:1527) cvn /DEST pdfmark end
 -2 2796 a 396 2872 a Fk(Reading)20
b(and)f(writing)h(multi-part)f(messages)h(using)g(the)g(nati)n(v)o(e)f
(\330MQ)i(API)f(is,)h(to)g(be)f(polite,)f(a)i(lot)f(of)g(w)o(ork.)g
(Look)396 2980 y(at)h(the)f(core)g(of)g(the)g(w)o(ork)o(er)f(thread)g
(from)h(our)f(LR)m(U)h(queue)f(brok)o(er:)-2 3081 y
SDict begin H.S end
 -2
3081 a -2 3081 a
SDict begin 11.7 H.A end
 -2 3081 a -2 3081 a
SDict begin [/View [/XYZ H.V]/Dest (0:1528) cvn /DEST pdfmark end
 -2 3081 a 396 3160
a Fe(while)44 b(\(1\))h({)576 3257 y(//)89 b(Read)44
b(and)g(save)h(all)f(frames)g(until)g(we)g(get)h(an)f(empty)g(frame)576
3354 y(//)89 b(In)44 b(this)h(example)e(there)h(is)h(only)f(1)h(but)f
(it)g(could)g(be)h(more)576 3451 y(char)800 3464 y(*)845
3451 y(address)e(=)i(s_recv)f(\(worker\);)576 3548 y(char)800
3561 y(*)845 3548 y(empty)g(=)g(s_recv)g(\(worker\);)576
3646 y(assert)f(\()934 3659 y(*)979 3646 y(empty)h(==)h(0\);)576
3743 y(free)f(\(empty\);)576 3937 y(//)89 b(Get)44 b(request,)g(send)g
(reply)576 4034 y(char)800 4047 y(*)845 4034 y(request)f(=)i(s_recv)f
(\(worker\);)576 4131 y(printf)f(\("Worker:)h(\045s\\n",)g(request\);)
576 4228 y(free)g(\(request\);)576 4423 y(s_sendmore)f(\(worker,)g
(address\);)576 4520 y(s_sendmore)g(\(worker,)g(""\);)576
4617 y(s_send)223 b(\(worker,)43 b("OK"\);)576 4714 y(free)h
(\(address\);)396 4811 y(})p Black 3759 5569 a Ff(110)p
Black eop end
%%Page: 111 124
TeXDict begin 111 123 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.111) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1529) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(That)20 b(code)g(isn')o(t)g(e)n(v)o(en)f
(reusable,)g(because)g(it)i(can)f(only)g(handle)f(one)g(en)m(v)o
(elope.)f(And)i(this)g(code)g(already)f(does)h(some)396
180 y(wrapping)f(around)f(the)i(\330MQ)h(API.)f(If)g(we)g(used)g(the)h
(libzmq)e(API)h(directly)g(this)h(is)g(what)f(we')l(d)f(ha)n(v)o(e)h
(to)g(write:)396 361 y Fe(while)44 b(\(1\))h({)576 458
y(//)89 b(Read)44 b(and)g(save)h(all)f(frames)g(until)g(we)g(get)h(an)f
(empty)g(frame)576 555 y(//)89 b(In)44 b(this)h(example)e(there)h(is)h
(only)f(1)h(but)f(it)g(could)g(be)h(more)576 652 y(zmq_msg_t)e
(address;)576 749 y(zmq_msg_init)f(\(&address\);)576
846 y(zmq_msg_recv)g(\(worker,)i(&address,)f(0\);)576
1041 y(zmq_msg_t)g(empty;)576 1138 y(zmq_msg_init)f(\(&empty\);)576
1235 y(zmq_msg_recv)g(\(worker,)i(&empty,)g(0\);)576
1429 y(//)89 b(Get)44 b(request,)g(send)g(reply)576 1526
y(zmq_msg_t)f(payload;)576 1623 y(zmq_msg_init)f(\(&payload\);)576
1720 y(zmq_msg_recv)g(\(worker,)i(&payload,)f(0\);)576
1915 y(int)h(char_nbr;)576 2012 y(printf)f(\("Worker:)h("\);)576
2109 y(for)g(\(char_nbr)f(=)i(0;)f(char_nbr)g(<)h(zmq_msg_size)d
(\(&payload\);)h(char_nbr++\))755 2206 y(printf)h(\("\045c",)1383
2219 y(*)1428 2206 y(\(char)1696 2219 y(*)1741 2206 y(\))h
(\(zmq_msg_data)e(\(&payload\))g(+)h(char_nbr\)\);)576
2303 y(printf)f(\("\\n"\);)576 2498 y(zmq_msg_init_size)f(\(&payload,)h
(2\);)576 2595 y(memcpy)g(\(zmq_msg_data)g(\(&payload\),)g("OK",)h
(2\);)576 2789 y(zmq_msg_send)e(\(worker,)i(&address,)f(ZMQ_SNDMORE\);)
576 2886 y(zmq_close)g(\(&address\);)576 2983 y(zmq_msg_send)f
(\(worker,)i(&empty,)g(ZMQ_SNDMORE\);)576 3080 y(zmq_close)f
(\(&empty\);)576 3178 y(zmq_msg_send)f(\(worker,)i(&payload,)f(0\);)576
3275 y(zmq_close)g(\(&payload\);)396 3372 y(})-2 3546
y
SDict begin H.S end
 -2 3546 a -2 3546 a
SDict begin 13 H.A end
 -2 3546 a -2 3546 a
SDict begin [/View [/XYZ H.V]/Dest (0:1531) cvn /DEST pdfmark end
 -2 3546 a 396
3646 a Fk(What)21 b(we)f(w)o(ant)h(is)g(an)f(API)g(that)h(lets)g(us)f
(recei)n(v)o(e)g(and)f(send)h(an)g(entire)g(message)g(in)g(one)g(shot,)
g(including)e(all)396 3754 y(en)m(v)o(elopes.)g(One)i(that)h(lets)g(us)
f(do)g(what)g(we)h(w)o(ant)f(with)g(the)h(absolute)e(least)i(lines)g
(of)e(code.)h(The)g(\330MQ)g(core)g(API)396 3862 y(itself)h(doesn')o(t)
e(aim)h(to)g(do)g(this,)h(b)n(ut)f(nothing)e(pre)n(v)o(ents)h(us)i
(making)d(layers)i(on)g(top,)g(and)f(part)h(of)g(learning)f(to)h(use)
396 3970 y(\330MQ)h(intelligently)e(is)i(to)f(do)g(e)o(xactly)f(that.)
-2 4154 y
SDict begin H.S end
 -2 4154 a -2 4154 a
SDict begin 13 H.A end
 -2 4154 a -2 4154 a
SDict begin [/View [/XYZ H.V]/Dest (0:1532) cvn /DEST pdfmark end
 -2
4154 a 396 4244 a Fk(Making)g(a)i(good)e(message)h(API)g(is)h(f)o
(airly)f(dif)n(\002cult,)f(especially)h(if)h(we)f(w)o(ant)h(to)f(a)n(v)
n(oid)g(cop)o(ying)e(data)i(around)f(too)396 4351 y(much.)g(W)-7
b(e)22 b(ha)n(v)o(e)d(a)i(problem)d(of)i(terminology:)e(\330MQ)i(uses)h
("message")f(to)g(describe)g(both)f(multi-part)g(messages,)396
4459 y(and)h(indi)n(vidual)e(parts)i(of)g(a)h(message.)f(W)-7
b(e)21 b(ha)n(v)o(e)f(a)g(problem)f(of)h(semantics:)g(sometimes)g(it')
-5 b(s)21 b(natural)e(to)i(see)396 4567 y(message)f(content)f(as)i
(printable)e(string)h(data,)g(sometimes)g(as)h(binary)e(blobs.)-2
4751 y
SDict begin H.S end
 -2 4751 a -2 4751 a
SDict begin 13 H.A end
 -2 4751 a -2 4751 a
SDict begin [/View [/XYZ H.V]/Dest (0:1533) cvn /DEST pdfmark end
 -2 4751
a 396 4841 a Fk(So)i(one)e(solution)h(is)h(to)f(use)h(three)e
(concepts:)1748 4841 y
SDict begin H.S end
 1748 4841 a 1748 4841 a
SDict begin 13 H.A end
 1748 4841
a 1748 4841 a
SDict begin [/View [/XYZ H.V]/Dest (0:1534) cvn /DEST pdfmark end
 1748 4841 a Ff(string)h Fk(\(already)f(the)h(basis)h(for)
e(s_send)h(and)g(s_recv\),)3355 4841 y
SDict begin H.S end
 3355 4841 a 3355
4841 a
SDict begin 13 H.A end
 3355 4841 a 3355 4841 a
SDict begin [/View [/XYZ H.V]/Dest (0:1535) cvn /DEST pdfmark end
 3355 4841 a Ff(fr)o(ame)g
Fk(\(a)396 4949 y(message)g(frame\),)f(and)1102 4949
y
SDict begin H.S end
 1102 4949 a 1102 4949 a
SDict begin 13 H.A end
 1102 4949 a 1102 4949 a
SDict begin [/View [/XYZ H.V]/Dest (0:1536) cvn /DEST pdfmark end
 1102
4949 a Ff(messa)o(g)o(e)h Fk(\(a)g(list)i(of)e(one)f(or)h(more)f
(frames\).)g(Here)i(is)g(the)f(w)o(ork)o(er)f(code,)g(re)n(written)h
(onto)f(an)396 5057 y(API)i(using)e(these)i(concepts:)p
Black 3759 5569 a Ff(111)p Black eop end
%%Page: 112 125
TeXDict begin 112 124 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.112) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1537) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fe(while)44 b(\(1\))h({)576
170 y(zmsg_t)889 183 y(*)934 170 y(zmsg)f(=)h(zmsg_recv)e(\(worker\);)
576 267 y(zframe_print)f(\(zmsg_last)i(\(zmsg\),)f("Worker:)h("\);)576
364 y(zframe_reset)e(\(zmsg_last)i(\(zmsg\),)f("OK",)h(2\);)576
461 y(zmsg_send)f(\(&zmsg,)h(worker\);)396 558 y(})-2
732 y
SDict begin H.S end
 -2 732 a -2 732 a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:1538) cvn /DEST pdfmark end
 -2 732 a 396
832 a Fk(Replacing)20 b(22)f(lines)i(of)f(code)f(with)i(four)e(is)i(a)g
(good)d(deal,)i(especially)g(since)g(the)h(results)f(are)g(easy)h(to)f
(read)f(and)396 940 y(understand.)f(W)-7 b(e)21 b(can)f(continue)f
(this)i(process)f(for)f(other)g(aspects)i(of)f(w)o(orking)f(with)h
(\330MQ.)g(Let')-5 b(s)21 b(mak)o(e)f(a)g(wishlist)396
1048 y(of)g(things)g(we)g(w)o(ould)g(lik)o(e)g(in)h(a)f(higher)n(-le)n
(v)o(el)e(API:)-2 1066 y
SDict begin H.S end
 -2 1066 a -2 1066 a
SDict begin 13 H.A end
 -2 1066
a -2 1066 a
SDict begin [/View [/XYZ H.V]/Dest (0:1539) cvn /DEST pdfmark end
 -2 1066 a -2 1076 a
SDict begin H.S end
 -2 1076 a -2 1076 a
SDict begin 13 H.A end
 -2
1076 a -2 1076 a
SDict begin [/View [/XYZ H.V]/Dest (0:1540) cvn /DEST pdfmark end
 -2 1076 a Black 396 1218 a Fj(\225)p
Black 479 1218 a
SDict begin H.S end
 479 1218 a 479 1218 a
SDict begin 13 H.A end
 479 1218 a 479
1218 a
SDict begin [/View [/XYZ H.V]/Dest (0:1541) cvn /DEST pdfmark end
 479 1218 a 479 1218 a
SDict begin H.S end
 479 1218 a 479 1218 a
SDict begin 13 H.A end
 479
1218 a 479 1218 a
SDict begin [/View [/XYZ H.V]/Dest (0:1542) cvn /DEST pdfmark end
 479 1218 a Ff(A)n(utomatic)i(handling)e(of)i(soc)n(k)
o(ets.)h Fk(I)f(\002nd)g(it)h(really)f(anno)o(ying)e(to)i(ha)n(v)o(e)g
(to)g(close)g(sock)o(ets)h(manually)-5 b(,)18 b(and)i(to)g(ha)n(v)o(e)
479 1326 y(to)h(e)o(xplicitly)e(de\002ne)g(the)i(linger)e(timeout)h(in)
g(some)g(b)n(ut)g(not)g(all)h(cases.)f(It')l(d)g(be)g(great)g(to)g(ha)n
(v)o(e)g(a)g(w)o(ay)h(to)f(close)479 1434 y(sock)o(ets)h(automatically)
d(when)i(I)g(close)h(the)f(conte)o(xt.)-2 1452 y
SDict begin H.S end
 -2 1452
a -2 1452 a
SDict begin 13 H.A end
 -2 1452 a -2 1452 a
SDict begin [/View [/XYZ H.V]/Dest (0:1543) cvn /DEST pdfmark end
 -2 1452 a Black 396 1583
a Fj(\225)p Black 479 1583 a
SDict begin H.S end
 479 1583 a 479 1583 a
SDict begin 13 H.A end
 479
1583 a 479 1583 a
SDict begin [/View [/XYZ H.V]/Dest (0:1544) cvn /DEST pdfmark end
 479 1583 a 479 1583 a
SDict begin H.S end
 479 1583 a 479
1583 a
SDict begin 13 H.A end
 479 1583 a 479 1583 a
SDict begin [/View [/XYZ H.V]/Dest (0:1545) cvn /DEST pdfmark end
 479 1583 a Ff(P)-7 b(ortable)20
b(thr)m(ead)f(mana)o(g)o(ement.)g Fk(Ev)o(ery)f(non-tri)n(vial)g
(\330MQ)j(application)e(uses)h(threads,)g(b)n(ut)g(POSIX)g(threads)479
1691 y(aren')o(t)f(portable.)g(So)h(a)h(decent)e(high-le)n(v)o(el)f
(API)j(should)e(hide)h(this)g(under)f(a)i(portable)e(layer)-5
b(.)-2 1709 y
SDict begin H.S end
 -2 1709 a -2 1709 a
SDict begin 13 H.A end
 -2 1709 a -2 1709 a
SDict begin [/View [/XYZ H.V]/Dest (0:1546) cvn /DEST pdfmark end

-2 1709 a Black 396 1841 a Fj(\225)p Black 479 1841 a
SDict begin H.S end

479 1841 a 479 1841 a
SDict begin 13 H.A end
 479 1841 a 479 1841 a
SDict begin [/View [/XYZ H.V]/Dest (0:1547) cvn /DEST pdfmark end
 479 1841
a 479 1841 a
SDict begin H.S end
 479 1841 a 479 1841 a
SDict begin 13 H.A end
 479 1841 a 479 1841
a
SDict begin [/View [/XYZ H.V]/Dest (0:1548) cvn /DEST pdfmark end
 479 1841 a Ff(P)e(ortable)20 b(cloc)n(ks.)g Fk(Ev)o(en)f(getting)h
(the)g(time)g(to)h(a)f(millisecond)g(resolution,)e(or)i(sleeping)g(for)
f(some)h(milliseconds,)479 1949 y(is)h(not)f(portable.)f(Realistic)i
(\330MQ)g(applications)e(need)g(portable)g(clocks,)h(so)g(our)g(API)g
(should)f(pro)o(vide)f(them.)-2 1967 y
SDict begin H.S end
 -2 1967 a -2 1967
a
SDict begin 13 H.A end
 -2 1967 a -2 1967 a
SDict begin [/View [/XYZ H.V]/Dest (0:1549) cvn /DEST pdfmark end
 -2 1967 a Black 396 2098 a Fj(\225)p
Black 479 2098 a
SDict begin H.S end
 479 2098 a 479 2098 a
SDict begin 13 H.A end
 479 2098 a 479
2098 a
SDict begin [/View [/XYZ H.V]/Dest (0:1550) cvn /DEST pdfmark end
 479 2098 a 479 2098 a
SDict begin H.S end
 479 2098 a 479 2098 a
SDict begin 13 H.A end
 479
2098 a 479 2098 a
SDict begin [/View [/XYZ H.V]/Dest (0:1551) cvn /DEST pdfmark end
 479 2098 a Ff(A)i(r)m(eactor)g(to)g(r)m(eplace)f
(zmq_poll[3].)f Fk(The)i(poll)f(loop)g(is)i(simple)e(b)n(ut)h(clumsy)-5
b(.)18 b(Writing)i(a)g(lot)g(of)f(these,)h(we)g(end)f(up)479
2206 y(doing)g(the)h(same)h(w)o(ork)e(o)o(v)o(er)g(and)h(o)o(v)o(er:)f
(calculating)g(timers,)h(and)f(calling)h(code)g(when)f(sock)o(ets)h
(are)h(ready)-5 b(.)18 b(A)479 2314 y(simple)i(reactor)g(with)g(sock)o
(et)g(readers,)f(and)h(timers,)g(w)o(ould)f(sa)n(v)o(e)i(a)f(lot)h(of)f
(repeated)f(w)o(ork.)-2 2332 y
SDict begin H.S end
 -2 2332 a -2 2332 a
SDict begin 13 H.A end
 -2
2332 a -2 2332 a
SDict begin [/View [/XYZ H.V]/Dest (0:1552) cvn /DEST pdfmark end
 -2 2332 a Black 396 2464 a Fj(\225)p
Black 479 2464 a
SDict begin H.S end
 479 2464 a 479 2464 a
SDict begin 13 H.A end
 479 2464 a 479
2464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1553) cvn /DEST pdfmark end
 479 2464 a 479 2464 a
SDict begin H.S end
 479 2464 a 479 2464 a
SDict begin 13 H.A end
 479
2464 a 479 2464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1554) cvn /DEST pdfmark end
 479 2464 a Ff(Pr)l(oper)i(handling)c(of)k(Ctrl-C.)g
Fk(W)-7 b(e)22 b(already)d(sa)o(w)h(ho)n(w)g(to)g(catch)g(an)g
(interrupt.)f(It)h(w)o(ould)g(be)g(useful)f(if)i(this)479
2571 y(happened)d(in)j(all)f(applications.)-2 2755 y
SDict begin H.S end

-2 2755 a -2 2755 a
SDict begin 13 H.A end
 -2 2755 a -2 2755 a
SDict begin [/View [/XYZ H.V]/Dest (0:1555) cvn /DEST pdfmark end
 -2 2755 a 396
2845 a Fk(T)l(urning)f(this)h(wishlist)i(into)e(reality)f(gi)n(v)o(es)h
(us)1771 2845 y
SDict begin H.S end
 1771 2845 a 1771 2845 a
SDict begin 13 H.A end
 1771 2845 a 1771
2845 a
SDict begin [/View [/XYZ H.V]/Dest (0:1556) cvn /DEST pdfmark end
 1771 2845 a Fk(CZMQ)g(\(http://zero.mq/c\),)d(a)k(high-le)n(v)o
(el)d(C)j(API)g(for)e(\330MQ.)h(This)396 2953 y(high-le)n(v)o(el)e
(binding)h(in)h(f)o(act)h(de)n(v)o(eloped)c(out)j(of)g(earlier)g(v)o
(ersions)f(of)h(the)g(Guide.)g(It)g(combines)f(nicer)h(semantics)g(for)
396 3061 y(w)o(orking)f(with)h(\330MQ)h(with)f(some)g(portability)f
(layers,)h(and)f(\(importantly)f(for)i(C)h(b)n(ut)f(less)h(for)f(other)
f(languages\))396 3169 y(containers)g(lik)o(e)i(hashes)f(and)f(lists.)j
(CZMQ)e(also)h(uses)g(an)f(ele)o(gant)f(object)g(model)h(that)g(leads)g
(to)h(frankly)d(lo)o(v)o(ely)396 3277 y(code.)-2 3444
y
SDict begin H.S end
 -2 3444 a -2 3444 a
SDict begin 13 H.A end
 -2 3444 a -2 3444 a
SDict begin [/View [/XYZ H.V]/Dest (0:1557) cvn /DEST pdfmark end
 -2 3444 a 396
3551 a Fk(Here)i(is)h(the)g(LR)m(U)f(queue)f(brok)o(er)g(re)n(written)g
(to)h(use)h(CZMQ:)-2 3569 y
SDict begin H.S end
 -2 3569 a -2 3569 a
SDict begin 13 H.A end
 -2 3569
a -2 3569 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue2-c) cvn /DEST pdfmark
end
 -2 3569 a 396 3752 a Fg(Example)g(3-12.)d(LR)n(U)j(queue)g
(br)o(ok)o(er)f(using)h(CZMQ)g(\(lruqueue2.c\))-2 3852
y
SDict begin H.S end
 -2 3852 a -2 3852 a
SDict begin 11.7 H.A end
 -2 3852 a -2 3852 a
SDict begin [/View [/XYZ H.V]/Dest (0:1560) cvn /DEST pdfmark end
 -2 3852 a 396
3933 a Fe(//)396 4030 y(//)90 b(Least-recently)42 b(used)i(\(LRU\))g
(queue)g(device)396 4127 y(//)90 b(Demonstrates)42 b(use)j(of)f(the)h
(CZMQ)f(API)396 4224 y(//)396 4321 y(#include)g("czmq.h")396
4515 y(#define)g(NBR_CLIENTS)f(10)396 4613 y(#define)h(NBR_WORKERS)f(3)
396 4710 y(#define)h(LRU_READY)133 b("\\001")268 b(//)89
b(Signals)44 b(worker)g(is)g(ready)396 4904 y(//)90 b(Basic)44
b(request-reply)e(client)i(using)g(REQ)g(socket)396 5001
y(//)396 5098 y(static)g(void)934 5111 y(*)p Black 3759
5569 a Ff(112)p Black eop end
%%Page: 113 126
TeXDict begin 113 125 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.113) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fe(client_task)43 b(\(void)1203
85 y(*)1248 72 y(args\))396 170 y({)576 267 y(zctx_t)889
280 y(*)934 267 y(ctx)i(=)f(zctx_new)g(\(\);)576 364
y(void)800 377 y(*)845 364 y(client)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 461 y(zsocket_connect)e(\(client,)h
("ipc://frontend.ipc"\);)576 655 y(//)89 b(Send)44 b(request,)g(get)g
(reply)576 752 y(while)g(\(true\))f({)755 850 y(zstr_send)g(\(client,)h
("HELLO"\);)755 947 y(char)979 960 y(*)1024 947 y(reply)g(=)h
(zstr_recv)e(\(client\);)755 1044 y(if)h(\(!reply\))934
1141 y(break;)755 1238 y(printf)g(\("Client:)f(\045s\\n",)h(reply\);)
755 1335 y(free)g(\(reply\);)755 1432 y(sleep)g(\(1\);)576
1530 y(})576 1627 y(zctx_destroy)e(\(&ctx\);)576 1724
y(return)h(NULL;)396 1821 y(})396 2015 y(//)90 b(Worker)43
b(using)h(REQ)h(socket)f(to)g(do)h(LRU)f(routing)396
2112 y(//)396 2209 y(static)g(void)934 2222 y(*)396 2307
y(worker_task)f(\(void)1203 2320 y(*)1248 2307 y(args\))396
2404 y({)576 2501 y(zctx_t)889 2514 y(*)934 2501 y(ctx)i(=)f(zctx_new)g
(\(\);)576 2598 y(void)800 2611 y(*)845 2598 y(worker)f(=)i
(zsocket_new)e(\(ctx,)h(ZMQ_REQ\);)576 2695 y(zsocket_connect)e
(\(worker,)h("ipc://backend.ipc"\);)576 2889 y(//)89
b(Tell)44 b(broker)g(we're)g(ready)g(for)g(work)576 2987
y(zframe_t)979 3000 y(*)1024 2987 y(frame)g(=)h(zframe_new)e
(\(LRU_READY,)g(1\);)576 3084 y(zframe_send)g(\(&frame,)g(worker,)h
(0\);)576 3278 y(//)89 b(Process)44 b(messages)f(as)i(they)f(arrive)576
3375 y(while)g(\(true\))f({)755 3472 y(zmsg_t)1069 3485
y(*)1114 3472 y(msg)h(=)h(zmsg_recv)e(\(worker\);)755
3569 y(if)h(\(!msg\))934 3666 y(break;)627 b(//)89 b(Interrupted)755
3764 y(//zframe_print)42 b(\(zmsg_last)i(\(msg\),)f("Worker:)h("\);)755
3861 y(zframe_reset)f(\(zmsg_last)g(\(msg\),)h("OK",)g(2\);)755
3958 y(zmsg_send)f(\(&msg,)h(worker\);)576 4055 y(})576
4152 y(zctx_destroy)e(\(&ctx\);)576 4249 y(return)h(NULL;)396
4346 y(})-2 4521 y
SDict begin H.S end
 -2 4521 a -2 4521 a
SDict begin 13 H.A end
 -2 4521 a -2 4521
a
SDict begin [/View [/XYZ H.V]/Dest (0:1561) cvn /DEST pdfmark end
 -2 4521 a 396 4620 a Fk(No)n(w)20 b(we)h(come)e(to)i(the)f(main)g
(task.)g(This)g(has)h(the)f(identical)g(functionality)e(to)i(the)g(pre)
n(vious)f(lruqueue)f(e)o(xample)h(b)n(ut)396 4728 y(uses)i(CZMQ)g(to)f
(start)h(child)e(threads,)h(to)g(hold)f(the)i(list)g(of)f(w)o(ork)o
(ers,)f(and)h(to)g(read)g(and)f(send)h(messages:)-2 4746
y
SDict begin H.S end
 -2 4746 a -2 4746 a
SDict begin 13 H.A end
 -2 4746 a -2 4746 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue2-c-1) cvn /DEST pdfmark
end
 -2 4746 a Black
3759 5569 a Ff(113)p Black eop end
%%Page: 114 127
TeXDict begin 114 126 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.114) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Example)21 b(3-13.)d(LR)n(U)j(queue)g(br)
o(ok)o(er)f(using)h(CZMQ)g(\(lruqueue2.c\))e(-)i(main)f(task)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1564) cvn /DEST pdfmark end
 -2 172 a 396
350 a Fe(int)45 b(main)f(\(void\))396 447 y({)576 544
y(zctx_t)889 557 y(*)934 544 y(ctx)h(=)f(zctx_new)g(\(\);)576
641 y(void)800 654 y(*)845 641 y(frontend)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_ROUTER\);)576 738 y(void)800 751 y(*)845 738 y(backend)f(=)i
(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576 835 y(zsocket_bind)e
(\(frontend,)i("ipc://frontend.ipc"\);)576 933 y(zsocket_bind)e
(\(backend,)i("ipc://backend.ipc"\);)576 1127 y(int)g(client_nbr;)576
1224 y(for)g(\(client_nbr)f(=)i(0;)f(client_nbr)f(<)i(NBR_CLIENTS;)e
(client_nbr++\))755 1321 y(zthread_new)g(\(client_task,)g(NULL\);)576
1418 y(int)h(worker_nbr;)576 1515 y(for)g(\(worker_nbr)f(=)i(0;)f
(worker_nbr)f(<)i(NBR_WORKERS;)e(worker_nbr++\))755 1613
y(zthread_new)g(\(worker_task,)g(NULL\);)576 1807 y(//)89
b(Queue)44 b(of)g(available)g(workers)576 1904 y(zlist_t)934
1917 y(*)979 1904 y(workers)g(=)g(zlist_new)g(\(\);)-2
2080 y
SDict begin H.S end
 -2 2080 a -2 2080 a
SDict begin 13 H.A end
 -2 2080 a -2 2080 a
SDict begin [/View [/XYZ H.V]/Dest (0:1565) cvn /DEST pdfmark end
 -2 2080
a 396 2178 a Fk(Here)20 b(is)h(the)g(main)e(loop)h(for)f(the)i(LR)m(U)f
(queue.)f(It)h(w)o(orks)g(the)g(same)h(w)o(ay)f(as)h(the)f(pre)n(vious)
f(e)o(xample,)f(b)n(ut)i(is)i(a)e(lot)396 2286 y(shorter)g(because)f
(CZMQ)i(gi)n(v)o(es)e(us)i(an)f(API)h(that)f(does)g(more)f(with)i(fe)n
(wer)e(calls:)-2 2304 y
SDict begin H.S end
 -2 2304 a -2 2304 a
SDict begin 13 H.A end
 -2 2304 a
-2 2304 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue2-c-2) cvn /DEST pdfmark
end
 -2 2304 a 396 2487 a Fg(Example)i(3-14.)d(LR)n(U)j(queue)g
(br)o(ok)o(er)f(using)h(CZMQ)g(\(lruqueue2.c\))e(-)i(main)f(LR)n(U)h
(queue)g(loop)-2 2587 y
SDict begin H.S end
 -2 2587 a -2 2587 a
SDict begin 11.7 H.A end
 -2 2587 a
-2 2587 a
SDict begin [/View [/XYZ H.V]/Dest (0:1568) cvn /DEST pdfmark end
 -2 2587 a 755 2764 a Fe(zmq_pollitem_t)42 b(items)i([])h(=)g
({)934 2862 y({)g(backend,)88 b(0,)45 b(ZMQ_POLLIN,)e(0)h(},)934
2959 y({)h(frontend,)e(0,)i(ZMQ_POLLIN,)e(0)h(})755 3056
y(};)755 3153 y(//)89 b(Poll)44 b(frontend)g(only)g(if)h(we)f(have)g
(available)g(workers)755 3250 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g
(zlist_size)f(\(workers\)?)g(2:)h(1,)h(-1\);)755 3347
y(if)f(\(rc)h(==)f(-1\))934 3444 y(break;)627 b(//)89
b(Interrupted)755 3639 y(//)g(Handle)44 b(worker)g(activity)f(on)i
(backend)755 3736 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)
934 3833 y(//)90 b(Use)44 b(worker)g(address)f(for)i(LRU)f(routing)934
3930 y(zmsg_t)1248 3943 y(*)1293 3930 y(msg)g(=)h(zmsg_recv)e
(\(backend\);)934 4027 y(if)i(\(!msg\))1114 4124 y(break;)447
b(//)89 b(Interrupted)934 4222 y(zframe_t)1338 4235 y(*)1383
4222 y(address)43 b(=)i(zmsg_unwrap)e(\(msg\);)934 4319
y(zlist_append)g(\(workers,)g(address\);)934 4513 y(//)90
b(Forward)43 b(message)h(to)g(client)g(if)h(it's)f(not)g(a)h(READY)934
4610 y(zframe_t)1338 4623 y(*)1383 4610 y(frame)f(=)g(zmsg_first)f
(\(msg\);)934 4707 y(if)i(\(memcmp)e(\(zframe_data)g(\(frame\),)h
(LRU_READY,)f(1\))h(==)h(0\))1114 4804 y(zmsg_destroy)d(\(&msg\);)934
4901 y(else)1114 4999 y(zmsg_send)h(\(&msg,)h(frontend\);)755
5096 y(})p Black 3759 5569 a Ff(114)p Black eop end
%%Page: 115 128
TeXDict begin 115 127 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.115) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(if)44 b(\(items)g([1].revents)f(&)i
(ZMQ_POLLIN\))e({)934 170 y(//)90 b(Get)44 b(client)g(request,)f(route)
h(to)h(first)f(available)f(worker)934 267 y(zmsg_t)1248
280 y(*)1293 267 y(msg)h(=)h(zmsg_recv)e(\(frontend\);)934
364 y(if)i(\(msg\))f({)1114 461 y(zmsg_wrap)f(\(msg,)h(\(zframe_t)2279
474 y(*)2324 461 y(\))h(zlist_pop)e(\(workers\)\);)1114
558 y(zmsg_send)g(\(&msg,)h(backend\);)934 655 y(})755
752 y(})576 850 y(})576 947 y(//)89 b(When)44 b(we're)g(done,)g(clean)g
(up)h(properly)576 1044 y(while)f(\(zlist_size)f(\(workers\)\))g({)755
1141 y(zframe_t)1158 1154 y(*)1203 1141 y(frame)h(=)h(\(zframe_t)2010
1154 y(*)2055 1141 y(\))g(zlist_pop)e(\(workers\);)755
1238 y(zframe_destroy)f(\(&frame\);)576 1335 y(})576
1432 y(zlist_destroy)g(\(&workers\);)576 1530 y(zctx_destroy)g
(\(&ctx\);)576 1627 y(return)h(0;)396 1724 y(})-2 1898
y
SDict begin H.S end
 -2 1898 a -2 1898 a
SDict begin 13 H.A end
 -2 1898 a -2 1898 a
SDict begin [/View [/XYZ H.V]/Dest (0:1569) cvn /DEST pdfmark end
 -2 1898 a 396
1998 a Fk(One)20 b(thing)g(CZMQ)g(pro)o(vides)f(is)i(clean)f(interrupt)
f(handling.)f(This)i(means)g(that)g(Ctrl-C)h(will)g(cause)f(an)o(y)g
(blocking)396 2106 y(\330MQ)h(call)f(to)h(e)o(xit)f(with)g(a)h(return)e
(code)g(-1)h(and)g(errno)f(set)i(to)f(EINTR.)g(The)g(CZMQ)g(message)g
(recv)g(methods)f(will)396 2214 y(return)g(NULL)h(in)h(such)f(cases.)g
(So,)h(you)e(can)h(cleanly)f(e)o(xit)h(a)h(loop)e(lik)o(e)i(this:)-2
2315 y
SDict begin H.S end
 -2 2315 a -2 2315 a
SDict begin 11.7 H.A end
 -2 2315 a -2 2315 a
SDict begin [/View [/XYZ H.V]/Dest (0:1570) cvn /DEST pdfmark end
 -2 2315
a 396 2394 a Fe(while)44 b(\(1\))h({)576 2491 y(zstr_send)e(\(client,)g
("HELLO"\);)576 2588 y(char)800 2601 y(*)845 2588 y(reply)h(=)g
(zstr_recv)g(\(client\);)576 2685 y(if)g(\(!reply\))755
2782 y(break;)627 b(//)89 b(Interrupted)576 2879 y(printf)43
b(\("Client:)h(\045s\\n",)g(reply\);)576 2977 y(free)g(\(reply\);)576
3074 y(sleep)g(\(1\);)396 3171 y(})-2 3345 y
SDict begin H.S end
 -2 3345
a -2 3345 a
SDict begin 13 H.A end
 -2 3345 a -2 3345 a
SDict begin [/View [/XYZ H.V]/Dest (0:1571) cvn /DEST pdfmark end
 -2 3345 a 396 3445 a
Fk(Or)m(,)20 b(if)h(you')l(re)d(doing)h(zmq_poll,)f(test)j(on)f(the)g
(return)f(code:)-2 3546 y
SDict begin H.S end
 -2 3546 a -2 3546 a
SDict begin 11.7 H.A end
 -2 3546
a -2 3546 a
SDict begin [/View [/XYZ H.V]/Dest (0:1572) cvn /DEST pdfmark end
 -2 3546 a 396 3625 a Fe(int)45 b(rc)f(=)h(zmq_poll)e
(\(items,)h(zlist_size)f(\(workers\)?)g(2:)i(1,)f(-1\);)396
3722 y(if)h(\(rc)f(==)h(-1\))576 3819 y(break;)626 b(//)90
b(Interrupted)-2 3997 y
SDict begin H.S end
 -2 3997 a -2 3997 a
SDict begin 13 H.A end
 -2 3997 a
-2 3997 a
SDict begin [/View [/XYZ H.V]/Dest (0:1573) cvn /DEST pdfmark end
 -2 3997 a 396 4093 a Fk(The)20 b(pre)n(vious)f(e)o(xample)g
(still)i(uses)g(zmq_poll[3].)c(So)j(ho)n(w)g(about)f(reactors?)g(The)h
(CZMQ)3119 4093 y
SDict begin H.S end
 3119 4093 a 3119 4093 a
SDict begin 13 H.A end
 3119 4093 a
3119 4093 a
SDict begin [/View [/XYZ H.V]/Dest (0:1574) cvn /DEST pdfmark end
 3119 4093 a Fe(zloop)g Fk(reactor)f(is)396
4201 y(simple)h(b)n(ut)h(functional.)d(It)i(lets)h(you:)-2
4219 y
SDict begin H.S end
 -2 4219 a -2 4219 a
SDict begin 13 H.A end
 -2 4219 a -2 4219 a
SDict begin [/View [/XYZ H.V]/Dest (0:1575) cvn /DEST pdfmark end
 -2 4219
a -2 4229 a
SDict begin H.S end
 -2 4229 a -2 4229 a
SDict begin 13 H.A end
 -2 4229 a -2 4229 a
SDict begin [/View [/XYZ H.V]/Dest (0:1576) cvn /DEST pdfmark end
 -2
4229 a Black 396 4371 a Fj(\225)p Black 479 4371 a
SDict begin H.S end
 479
4371 a 479 4371 a
SDict begin 13 H.A end
 479 4371 a 479 4371 a
SDict begin [/View [/XYZ H.V]/Dest (0:1577) cvn /DEST pdfmark end
 479 4371 a Fk(Set)g(a)g(reader)
e(on)h(an)o(y)f(sock)o(et,)h(i.e.)g(code)g(that)g(is)h(called)f(whene)n
(v)o(er)e(the)i(sock)o(et)g(has)h(input.)-2 4389 y
SDict begin H.S end
 -2
4389 a -2 4389 a
SDict begin 13 H.A end
 -2 4389 a -2 4389 a
SDict begin [/View [/XYZ H.V]/Dest (0:1578) cvn /DEST pdfmark end
 -2 4389 a Black
396 4521 a Fj(\225)p Black 479 4521 a
SDict begin H.S end
 479 4521 a 479
4521 a
SDict begin 13 H.A end
 479 4521 a 479 4521 a
SDict begin [/View [/XYZ H.V]/Dest (0:1579) cvn /DEST pdfmark end
 479 4521 a Fk(Cancel)g(a)f(reader)f(on)h
(a)h(sock)o(et.)-2 4522 y
SDict begin H.S end
 -2 4522 a -2 4522 a
SDict begin 13 H.A end
 -2 4522
a -2 4522 a
SDict begin [/View [/XYZ H.V]/Dest (0:1580) cvn /DEST pdfmark end
 -2 4522 a Black 396 4670 a Fj(\225)p Black
479 4670 a
SDict begin H.S end
 479 4670 a 479 4670 a
SDict begin 13 H.A end
 479 4670 a 479 4670
a
SDict begin [/View [/XYZ H.V]/Dest (0:1581) cvn /DEST pdfmark end
 479 4670 a Fk(Set)g(a)g(timer)f(that)g(goes)g(of)n(f)f(once)h(or)g
(multiple)f(times)i(at)g(speci\002c)f(interv)n(als.)-2
4688 y
SDict begin H.S end
 -2 4688 a -2 4688 a
SDict begin 13 H.A end
 -2 4688 a -2 4688 a
SDict begin [/View [/XYZ H.V]/Dest (0:1582) cvn /DEST pdfmark end
 -2 4688
a Black 396 4820 a Fj(\225)p Black 479 4820 a
SDict begin H.S end
 479 4820
a 479 4820 a
SDict begin 13 H.A end
 479 4820 a 479 4820 a
SDict begin [/View [/XYZ H.V]/Dest (0:1583) cvn /DEST pdfmark end
 479 4820 a Fk(Cancel)h(a)f(timer)-5
b(.)p Black 3759 5569 a Ff(115)p Black eop end
%%Page: 116 129
TeXDict begin 116 128 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.116) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1584) cvn /DEST pdfmark end
 -2 -11 a -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1585) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fe(zloop)20 b Fk(of)g(course)g(uses)g
(zmq_poll[3])d(internally)-5 b(.)19 b(It)h(reb)n(uilds)g(its)h(poll)f
(set)h(each)f(time)g(you)g(add)f(or)h(remo)o(v)o(e)e(readers,)396
180 y(and)i(it)h(calculates)f(the)g(poll)g(timeout)g(to)g(match)g(the)g
(ne)o(xt)f(timer)-5 b(.)20 b(Then,)g(it)g(calls)h(the)g(reader)e(and)g
(timer)h(handlers)f(for)396 288 y(each)h(sock)o(et)g(and)g(timer)g
(that)g(needs)g(attention.)-2 455 y
SDict begin H.S end
 -2 455 a -2 455 a
SDict begin 13 H.A end

-2 455 a -2 455 a
SDict begin [/View [/XYZ H.V]/Dest (0:1586) cvn /DEST pdfmark end
 -2 455 a 396 562 a Fk(When)g(we)h(use)f(a)h(reactor)e
(pattern,)g(our)h(code)f(turns)h(inside)g(out.)g(The)f(main)h(logic)g
(looks)g(lik)o(e)g(this:)-2 663 y
SDict begin H.S end
 -2 663 a -2 663 a
SDict begin 11.7 H.A end
 -2
663 a -2 663 a
SDict begin [/View [/XYZ H.V]/Dest (0:1587) cvn /DEST pdfmark end
 -2 663 a 396 742 a Fe(zloop_t)755 755
y(*)800 742 y(reactor)43 b(=)i(zloop_new)e(\(\);)396
840 y(zloop_reader)g(\(reactor,)g(self->backend,)g(s_handle_backend,)f
(self\);)396 937 y(zloop_start)h(\(reactor\);)396 1034
y(zloop_destroy)g(\(&reactor\);)-2 1211 y
SDict begin H.S end
 -2 1211 a -2
1211 a
SDict begin 13 H.A end
 -2 1211 a -2 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:1588) cvn /DEST pdfmark end
 -2 1211 a 396 1308 a Fk(While)21
b(the)f(actual)g(handling)e(of)i(messages)h(sits)g(inside)f(dedicated)f
(functions)g(or)h(methods.)f(Y)-9 b(ou)19 b(may)h(not)g(lik)o(e)g(the)
396 1416 y(style,)h(it')-5 b(s)21 b(a)g(matter)e(of)h(taste.)h(What)g
(it)f(does)g(help)g(with)g(is)i(mixing)d(timers)h(and)g(sock)o(et)g
(acti)n(vity)-5 b(.)19 b(In)h(the)g(rest)h(of)e(this)396
1524 y(te)o(xt)h(we')o(ll)h(use)f(zmq_poll[3])d(in)k(simpler)f(cases,)g
(and)2006 1524 y
SDict begin H.S end
 2006 1524 a 2006 1524 a
SDict begin 13 H.A end
 2006 1524 a
2006 1524 a
SDict begin [/View [/XYZ H.V]/Dest (0:1589) cvn /DEST pdfmark end
 2006 1524 a Fe(zloop)g Fk(in)g(more)g(comple)o(x)e(e)o
(xamples.)-2 1708 y
SDict begin H.S end
 -2 1708 a -2 1708 a
SDict begin 13 H.A end
 -2 1708 a -2
1708 a
SDict begin [/View [/XYZ H.V]/Dest (0:1590) cvn /DEST pdfmark end
 -2 1708 a 396 1798 a Fk(Here)i(is)h(the)g(LR)m(U)f(queue)f(brok)
o(er)g(re)n(written)g(once)h(again,)f(this)h(time)h(to)f(use)2658
1798 y
SDict begin H.S end
 2658 1798 a 2658 1798 a
SDict begin 13 H.A end
 2658 1798 a 2658 1798
a
SDict begin [/View [/XYZ H.V]/Dest (0:1591) cvn /DEST pdfmark end
 2658 1798 a Fe(zloop)p Fk(:)-2 1816 y
SDict begin H.S end
 -2 1816 a -2
1816 a
SDict begin 13 H.A end
 -2 1816 a -2 1816 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue3-c) cvn /DEST pdfmark
end
 -2 1816 a 396 1999 a Fg(Example)h(3-15.)d
(LR)n(U)j(queue)g(br)o(ok)o(er)f(using)h(zloop)f(\(lruqueue3.c\))-2
2099 y
SDict begin H.S end
 -2 2099 a -2 2099 a
SDict begin 11.7 H.A end
 -2 2099 a -2 2099 a
SDict begin [/View [/XYZ H.V]/Dest (0:1594) cvn /DEST pdfmark end
 -2 2099
a 396 2179 a Fe(//)396 2276 y(//)90 b(Least-recently)42
b(used)i(\(LRU\))g(queue)g(device)396 2373 y(//)90 b(Demonstrates)42
b(use)j(of)f(the)h(CZMQ)f(API)g(and)g(reactor)g(style)396
2471 y(//)396 2568 y(//)90 b(The)44 b(client)g(and)g(worker)g(tasks)g
(are)g(identical)g(from)g(the)g(previous)g(example.)396
2665 y(...)396 2762 y(//)90 b(Our)44 b(LRU)g(queue)g(structure,)f
(passed)h(to)h(reactor)e(handlers)396 2859 y(typedef)h(struct)g({)576
2956 y(void)800 2969 y(*)845 2956 y(frontend;)581 b(//)89
b(Listen)44 b(to)h(clients)576 3053 y(void)800 3066 y(*)845
3053 y(backend;)626 b(//)89 b(Listen)44 b(to)h(workers)576
3151 y(zlist_t)934 3164 y(*)979 3151 y(workers;)492 b(//)89
b(List)44 b(of)h(ready)f(workers)396 3248 y(})h(lruqueue_t;)-2
3425 y
SDict begin H.S end
 -2 3425 a -2 3425 a
SDict begin 13 H.A end
 -2 3425 a -2 3425 a
SDict begin [/View [/XYZ H.V]/Dest (0:1595) cvn /DEST pdfmark end
 -2 3425
a 396 3522 a Fk(In)20 b(the)g(reactor)g(design,)f(each)h(time)g(a)h
(message)f(arri)n(v)o(es)f(on)h(a)g(sock)o(et,)g(the)g(reactor)g
(passes)h(it)f(to)h(a)f(handler)f(function.)396 3630
y(W)-7 b(e)22 b(ha)n(v)o(e)d(tw)o(o)i(handlers;)e(one)g(for)h(the)g
(frontend,)e(one)i(for)f(the)h(back)o(end:)-2 3642 y
SDict begin H.S end

-2 3642 a -2 3642 a
SDict begin 13 H.A end
 -2 3642 a -2 3642 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue3-c-1) cvn /DEST pdfmark
end
 -2 3642 a 396
3831 a Fg(Example)h(3-16.)d(LR)n(U)j(queue)g(br)o(ok)o(er)f(using)h
(zloop)f(\(lruqueue3.c\))f(-)h(r)o(eactor)f(design)-2
3931 y
SDict begin H.S end
 -2 3931 a -2 3931 a
SDict begin 11.7 H.A end
 -2 3931 a -2 3931 a
SDict begin [/View [/XYZ H.V]/Dest (0:1598) cvn /DEST pdfmark end
 -2 3931
a 396 4205 a Fe(//)90 b(Handle)43 b(input)h(from)h(client,)e(on)i
(frontend)396 4302 y(int)g(s_handle_frontend)d(\(zloop_t)1786
4315 y(*)1831 4302 y(loop,)i(zmq_pollitem_t)2772 4315
y(*)2817 4302 y(poller,)g(void)3400 4315 y(*)3445 4302
y(arg\))396 4400 y({)576 4497 y(lruqueue_t)1069 4510
y(*)1114 4497 y(self)g(=)g(\(lruqueue_t)1965 4510 y(*)2010
4497 y(\))h(arg;)576 4594 y(zmsg_t)889 4607 y(*)934 4594
y(msg)g(=)f(zmsg_recv)g(\(self->frontend\);)576 4691
y(if)g(\(msg\))g({)755 4788 y(zmsg_wrap)f(\(msg,)h(\(zframe_t)1921
4801 y(*)1966 4788 y(\))g(zlist_pop)f(\(self->workers\)\);)755
4885 y(zmsg_send)g(\(&msg,)h(self->backend\);)755 5080
y(//)89 b(Cancel)44 b(reader)g(on)g(frontend)g(if)g(we)h(went)f(from)g
(1)h(to)f(0)h(workers)p Black 3757 5569 a Ff(116)p Black
eop end
%%Page: 117 130
TeXDict begin 117 129 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.117) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(if)44 b(\(zlist_size)f(\(self->workers\))
g(==)h(0\))h({)934 170 y(zmq_pollitem_t)e(poller)h(=)g({)h
(self->frontend,)d(0,)j(ZMQ_POLLIN)e(};)934 267 y(zloop_poller_end)f
(\(loop,)i(&poller\);)755 364 y(})576 461 y(})576 558
y(return)f(0;)396 655 y(})396 850 y(//)90 b(Handle)43
b(input)h(from)h(worker,)e(on)i(backend)396 947 y(int)g
(s_handle_backend)d(\(zloop_t)1741 960 y(*)1786 947 y(loop,)i
(zmq_pollitem_t)2728 960 y(*)2773 947 y(poller,)f(void)3355
960 y(*)3400 947 y(arg\))396 1044 y({)576 1141 y(//)89
b(Use)44 b(worker)g(address)g(for)g(LRU)g(routing)576
1238 y(lruqueue_t)1069 1251 y(*)1114 1238 y(self)g(=)g(\(lruqueue_t)
1965 1251 y(*)2010 1238 y(\))h(arg;)576 1335 y(zmsg_t)889
1348 y(*)934 1335 y(msg)g(=)f(zmsg_recv)g(\(self->backend\);)576
1432 y(if)g(\(msg\))g({)755 1530 y(zframe_t)1158 1543
y(*)1203 1530 y(address)g(=)h(zmsg_unwrap)e(\(msg\);)755
1627 y(zlist_append)g(\(self->workers,)f(address\);)755
1821 y(//)89 b(Enable)44 b(reader)g(on)g(frontend)g(if)g(we)h(went)f
(from)g(0)h(to)f(1)h(workers)755 1918 y(if)f(\(zlist_size)f
(\(self->workers\))g(==)h(1\))h({)934 2015 y(zmq_pollitem_t)e(poller)h
(=)g({)h(self->frontend,)d(0,)j(ZMQ_POLLIN)e(};)934 2112
y(zloop_poller)g(\(loop,)h(&poller,)f(s_handle_frontend,)f(self\);)755
2209 y(})755 2307 y(//)89 b(Forward)44 b(message)g(to)g(client)g(if)g
(it's)h(not)f(a)h(READY)755 2404 y(zframe_t)1158 2417
y(*)1203 2404 y(frame)f(=)h(zmsg_first)e(\(msg\);)755
2501 y(if)h(\(memcmp)g(\(zframe_data)f(\(frame\),)g(LRU_READY,)h(1\))g
(==)h(0\))934 2598 y(zmsg_destroy)e(\(&msg\);)755 2695
y(else)934 2792 y(zmsg_send)h(\(&msg,)f(self->frontend\);)576
2889 y(})576 2987 y(return)g(0;)396 3084 y(})-2 3258
y
SDict begin H.S end
 -2 3258 a -2 3258 a
SDict begin 13 H.A end
 -2 3258 a -2 3258 a
SDict begin [/View [/XYZ H.V]/Dest (0:1599) cvn /DEST pdfmark end
 -2 3258 a 396
3358 a Fk(And)19 b(the)h(main)f(task)g(no)n(w)g(sets-up)g(child)g
(tasks,)h(then)f(starts)h(its)h(reactor)-5 b(.)19 b(If)g(you)f(press)i
(Ctrl-C,)g(the)f(reactor)g(e)o(xits)g(and)396 3466 y(the)h(main)g(task)
h(shuts)f(do)n(wn.)f(Since)h(the)h(reactor)e(is)i(a)g(CZMQ)f(class,)h
(this)g(e)o(xample)e(may)g(not)h(translate)g(into)g(all)396
3574 y(languages)f(equally)g(well.)-2 3591 y
SDict begin H.S end
 -2 3591
a -2 3591 a
SDict begin 13 H.A end
 -2 3591 a -2 3591 a
SDict begin [/View [/XYZ H.V]/Dest (0:lruqueue3-c-2) cvn /DEST pdfmark
end
 -2 3591 a 396 3775 a
Fg(Example)i(3-17.)d(LR)n(U)j(queue)g(br)o(ok)o(er)f(using)h(zloop)f
(\(lruqueue3.c\))f(-)h(main)h(task)-2 3875 y
SDict begin H.S end
 -2 3875
a -2 3875 a
SDict begin 11.7 H.A end
 -2 3875 a -2 3875 a
SDict begin [/View [/XYZ H.V]/Dest (0:1602) cvn /DEST pdfmark end
 -2 3875 a 396 4052 a
Fe(int)45 b(main)f(\(void\))396 4149 y({)576 4246 y(zctx_t)889
4259 y(*)934 4246 y(ctx)h(=)f(zctx_new)g(\(\);)576 4344
y(lruqueue_t)1069 4357 y(*)1114 4344 y(self)g(=)g(\(lruqueue_t)1965
4357 y(*)2010 4344 y(\))h(zmalloc)f(\(sizeof)f(\(lruqueue_t\)\);)576
4441 y(self->frontend)f(=)j(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
4538 y(self->backend)e(=)j(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
4635 y(zsocket_bind)e(\(self->frontend,)h("ipc://frontend.ipc"\);)576
4732 y(zsocket_bind)f(\(self->backend,)h("ipc://backend.ipc"\);)576
4926 y(int)h(client_nbr;)576 5023 y(for)g(\(client_nbr)f(=)i(0;)f
(client_nbr)f(<)i(NBR_CLIENTS;)e(client_nbr++\))755 5121
y(zthread_new)g(\(client_task,)g(NULL\);)p Black 3756
5569 a Ff(117)p Black eop end
%%Page: 118 131
TeXDict begin 118 130 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.118) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1614) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 576 72 a Fe(int)44 b(worker_nbr;)576
170 y(for)g(\(worker_nbr)f(=)i(0;)f(worker_nbr)f(<)i(NBR_WORKERS;)e
(worker_nbr++\))755 267 y(zthread_new)g(\(worker_task,)g(NULL\);)576
461 y(//)89 b(Queue)44 b(of)g(available)g(workers)576
558 y(self->workers)e(=)j(zlist_new)e(\(\);)576 752 y(//)89
b(Prepare)44 b(reactor)f(and)i(fire)f(it)g(up)576 850
y(zloop_t)934 863 y(*)979 850 y(reactor)g(=)g(zloop_new)g(\(\);)576
947 y(zmq_pollitem_t)e(poller)i(=)h({)f(self->backend,)f(0,)h
(ZMQ_POLLIN)f(};)576 1044 y(zloop_poller)f(\(reactor,)i(&poller,)f
(s_handle_backend,)f(self\);)576 1141 y(zloop_start)87
b(\(reactor\);)576 1238 y(zloop_destroy)42 b(\(&reactor\);)576
1432 y(//)89 b(When)44 b(we're)g(done,)g(clean)g(up)h(properly)576
1530 y(while)f(\(zlist_size)f(\(self->workers\)\))f({)755
1627 y(zframe_t)1158 1640 y(*)1203 1627 y(frame)i(=)h(\(zframe_t)2010
1640 y(*)2055 1627 y(\))g(zlist_pop)e(\(self->workers\);)755
1724 y(zframe_destroy)f(\(&frame\);)576 1821 y(})576
1918 y(zlist_destroy)g(\(&self->workers\);)576 2015 y(zctx_destroy)g
(\(&ctx\);)576 2112 y(free)i(\(self\);)576 2209 y(return)f(0;)396
2307 y(})-2 2481 y
SDict begin H.S end
 -2 2481 a -2 2481 a
SDict begin 13 H.A end
 -2 2481 a -2 2481
a
SDict begin [/View [/XYZ H.V]/Dest (0:1603) cvn /DEST pdfmark end
 -2 2481 a 396 2581 a Fk(Getting)20 b(applications)f(to)h(properly)e
(shut-do)n(wn)h(when)g(you)h(send)f(them)h(Ctrl-C)h(can)f(be)g(trick)o
(y)-5 b(.)19 b(If)h(you)f(use)i(the)f(zctx)396 2689 y(class)h(it')o(ll)
g(automatically)e(set-up)h(signal)g(handling,)e(b)n(ut)i(your)f(code)g
(still)j(has)e(to)h(cooperate.)d(Y)-9 b(ou)19 b(must)i(break)e(an)o(y)
396 2796 y(loop)h(if)g(zmq_poll)f(returns)g(-1)h(or)g(if)g(an)o(y)g(of)
f(the)i(recv)e(methods)g(\(zstr_recv)-5 b(,)18 b(zframe_recv)-5
b(,)17 b(zmsg_recv\))h(return)396 2904 y(NULL.)i(If)g(you)f(ha)n(v)o(e)
h(nested)g(loops,)f(it)i(can)f(be)g(useful)g(to)g(mak)o(e)g(the)g
(outer)g(ones)g(conditional)e(on)396 3012 y
SDict begin H.S end
 396 3012
a 396 3012 a
SDict begin 13 H.A end
 396 3012 a 396 3012 a
SDict begin [/View [/XYZ H.V]/Dest (0:1604) cvn /DEST pdfmark end
 396 3012 a Fe(!zctx_interrupted)p
Fk(.)-2 3034 y
SDict begin H.S end
 -2 3034 a -2 3034 a
SDict begin 13 H.A end
 -2 3034 a -2 3034
a
SDict begin [/View [/XYZ H.V]/Dest (0:1605) cvn /DEST pdfmark end
 -2 3034 a 366 x Fn(3.8.)39 b(Async)o(hr)m(onous)d(Client-Ser)q(ver)
2214 3400 y
SDict begin H.S end
 2214 3400 a 2214 3400 a
SDict begin 22.464 H.A end
 2214 3400 a 2214
3400 a
SDict begin [/View [/XYZ H.V]/Dest (8.53.1) cvn /DEST pdfmark end
 2214 3400 a -2 3596 a
SDict begin H.S end
 -2 3596 a -2 3596 a
SDict begin 13 H.A end
 -2 3596
a -2 3596 a
SDict begin [/View [/XYZ H.V]/Dest (0:1607) cvn /DEST pdfmark end
 -2 3596 a 396 3674 a Fk(In)20 b(the)g(R)m(OUTER-to-DEALER)f
(e)o(xample)g(we)i(sa)o(w)f(a)h(1-to-N)e(use)h(case)h(where)f(one)f
(client)h(talks)h(asynchronously)396 3782 y(to)g(multiple)e(w)o(ork)o
(ers.)g(W)-7 b(e)22 b(can)e(turn)f(this)i(upside-do)n(wn)d(to)i(get)g
(a)h(v)o(ery)e(useful)g(N-to-1)h(architecture)e(where)i(v)n(arious)396
3890 y(clients)h(talk)f(to)g(a)h(single)f(serv)o(er)m(,)f(and)h(do)f
(this)i(asynchronously\()p 0 TeXcolorgray 2319 3890 a
SDict begin H.S end

2319 3890 a Fk(Figure)15 b(3-18)2706 3890 y
SDict begin 13 H.L end
 2706 3890
a 2706 3890 a
SDict begin [/Subtype /Link/Dest (0:figure-44) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2706 3890 a Black -1 w Fk(\).)-2 3908 y
SDict begin H.S end

-2 3908 a -2 3908 a
SDict begin 13 H.A end
 -2 3908 a -2 3908 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-44) cvn /DEST pdfmark
end
 -2 3908 a Black
3759 5569 a Ff(118)p Black eop end
%%Page: 119 132
TeXDict begin 119 131 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.119) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-18.)e(Asynchr)o(onous)i
(Client-Ser)o(v)o(er)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172
a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1611) cvn /DEST pdfmark end
 -2 172 a 396 3131 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3131 a @beginspecial
0 @llx -350 @lly 330 @urx 0 @ury 3300 @rwi @setspecial
%%BeginDocument: images/fig44.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -350 330 0
%%HiResBoundingBox: 0.0 -350.0 330.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -38.000301361083984 moveto
28.00029945373535 -92.00029754638672 lineto
148.00030517578125 -92.00029754638672 lineto
148.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.00029945373535 -96.00029754638672 moveto
28.00029945373535 -115.00029754638672 lineto
28.00029945373535 -119.66696421305339 29.666966756184895 -122.00029754638672 33.000301361083984 -122.00029754638672 curveto
143.00030517578125 -122.00029754638672 lineto
143.00030517578125 -122.00029754638672 lineto
146.3336385091146 -122.00029754638672 148.00030517578125 -119.66696421305339 148.00030517578125 -115.00029754638672 curveto
148.00030517578125 -96.00029754638672 lineto
148.00030517578125 -96.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
188.00030517578125 -38.000301361083984 moveto
188.00030517578125 -92.00029754638672 lineto
308.00030517578125 -92.00029754638672 lineto
308.00030517578125 -38.000301361083984 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
188.00030517578125 -96.00029754638672 moveto
188.00030517578125 -115.00029754638672 lineto
188.00030517578125 -119.66696421305339 189.6669718424479 -122.00029754638672 193.00030517578125 -122.00029754638672 curveto
303.00030517578125 -122.00029754638672 lineto
303.00030517578125 -122.00029754638672 lineto
306.33363850911456 -122.00029754638672 308.00030517578125 -119.66696421305339 308.00030517578125 -115.00029754638672 curveto
308.00030517578125 -96.00029754638672 lineto
308.00030517578125 -96.00029754638672 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
103.00029754638672 -234.00030517578125 moveto
99.66696421305339 -234.00030517578125 98.00029754638672 -236.3336385091146 98.00029754638672 -241.00030517578125 curveto
98.00029754638672 -260.00030517578125 lineto
238.00030517578125 -260.00030517578125 lineto
238.00030517578125 -241.00030517578125 lineto
238.00030517578125 -236.3336385091146 236.3336385091146 -234.00030517578125 233.00030517578125 -234.00030517578125 curveto
103.00029754638672 -234.00030517578125 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
98.00029754638672 -264.00030517578125 moveto
98.00029754638672 -318.00030517578125 lineto
238.00030517578125 -318.00030517578125 lineto
238.00030517578125 -264.00030517578125 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
145.0 -89.0 lineto
145.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
1.0 setlinewidth
1 setlinecap
[] 0 setdash
newpath
25.0 -35.0 moveto
25.0 -89.0 lineto
145.0 -89.0 lineto
145.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
140.0 -119.0 lineto
140.0 -119.0 lineto
143.33333333333334 -119.0 145.0 -116.66666666666667 145.0 -112.0 curveto
145.0 -93.0 lineto
145.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
25.0 -93.0 moveto
25.0 -112.0 lineto
25.0 -116.66666666666667 26.666666666666668 -119.0 30.0 -119.0 curveto
140.0 -119.0 lineto
140.0 -119.0 lineto
143.33333333333334 -119.0 145.0 -116.66666666666667 145.0 -112.0 curveto
145.0 -93.0 lineto
145.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
185.0 -35.0 moveto
185.0 -89.0 lineto
305.0 -89.0 lineto
305.0 -35.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
185.0 -35.0 moveto
185.0 -89.0 lineto
305.0 -89.0 lineto
305.0 -35.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
185.0 -93.0 moveto
185.0 -112.0 lineto
185.0 -116.66666666666667 186.66666666666666 -119.0 190.0 -119.0 curveto
300.0 -119.0 lineto
300.0 -119.0 lineto
303.3333333333333 -119.0 305.0 -116.66666666666667 305.0 -112.0 curveto
305.0 -93.0 lineto
305.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
185.0 -93.0 moveto
185.0 -112.0 lineto
185.0 -116.66666666666667 186.66666666666666 -119.0 190.0 -119.0 curveto
300.0 -119.0 lineto
300.0 -119.0 lineto
303.3333333333333 -119.0 305.0 -116.66666666666667 305.0 -112.0 curveto
305.0 -93.0 lineto
305.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -231.0 moveto
96.66666666666667 -231.0 95.0 -233.33333333333334 95.0 -238.0 curveto
95.0 -257.0 lineto
235.0 -257.0 lineto
235.0 -238.0 lineto
235.0 -233.33333333333334 233.33333333333334 -231.0 230.0 -231.0 curveto
100.0 -231.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -231.0 moveto
96.66666666666667 -231.0 95.0 -233.33333333333334 95.0 -238.0 curveto
95.0 -257.0 lineto
235.0 -257.0 lineto
235.0 -238.0 lineto
235.0 -233.33333333333334 233.33333333333334 -231.0 230.0 -231.0 curveto
100.0 -231.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
95.0 -261.0 moveto
95.0 -315.0 lineto
235.0 -315.0 lineto
235.0 -261.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
95.0 -261.0 moveto
95.0 -315.0 lineto
235.0 -315.0 lineto
235.0 -261.0 lineto
closepath
stroke
newpath
85.0 -126.0 moveto
80.0 -140.0 lineto
90.0 -140.0 lineto
closepath
fill
newpath
245.0 -126.0 moveto
240.0 -140.0 lineto
250.0 -140.0 lineto
closepath
fill
newpath
160.0 -210.0 moveto
165.0 -224.0 lineto
170.0 -210.0 lineto
closepath
fill
newpath
85.0 -133.0 moveto
85.0 -175.0 lineto
165.0 -175.0 lineto
stroke
newpath
245.0 -133.0 moveto
245.0 -175.0 lineto
165.0 -175.0 lineto
stroke
newpath
165.0 -217.0 moveto
165.0 -175.0 lineto
stroke
/Helvetica findfont
15 scalefont setfont
57.0 -68.0 moveto
(Client) show
217.0 -68.0 moveto
(Client) show
51.0 -110.0 moveto
(DEALER) show
211.0 -110.0 moveto
(DEALER) show
131.0 -250.0 moveto
(ROUTER) show
133.0 -292.0 moveto
(Server) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3131 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3131 a 274 x Fk(Here')-5
b(s)21 b(ho)n(w)e(it)i(w)o(orks:)-2 3406 y
SDict begin H.S end
 -2 3406 a
-2 3406 a
SDict begin 13 H.A end
 -2 3406 a -2 3406 a
SDict begin [/View [/XYZ H.V]/Dest (0:1615) cvn /DEST pdfmark end
 -2 3406 a -2 3416 a
SDict begin H.S end
 -2
3416 a -2 3416 a
SDict begin 13 H.A end
 -2 3416 a -2 3416 a
SDict begin [/View [/XYZ H.V]/Dest (0:1616) cvn /DEST pdfmark end
 -2 3416 a Black
396 3575 a Fj(\225)p Black 479 3575 a
SDict begin H.S end
 479 3575 a 479
3575 a
SDict begin 13 H.A end
 479 3575 a 479 3575 a
SDict begin [/View [/XYZ H.V]/Dest (0:1617) cvn /DEST pdfmark end
 479 3575 a Fk(Clients)g(connect)e(to)i
(the)f(serv)o(er)f(and)h(send)g(requests.)-2 3593 y
SDict begin H.S end
 -2
3593 a -2 3593 a
SDict begin 13 H.A end
 -2 3593 a -2 3593 a
SDict begin [/View [/XYZ H.V]/Dest (0:1618) cvn /DEST pdfmark end
 -2 3593 a Black
396 3724 a Fj(\225)p Black 479 3724 a
SDict begin H.S end
 479 3724 a 479
3724 a
SDict begin 13 H.A end
 479 3724 a 479 3724 a
SDict begin [/View [/XYZ H.V]/Dest (0:1619) cvn /DEST pdfmark end
 479 3724 a Fk(F)o(or)g(each)g(request,)f
(the)h(serv)o(er)g(sends)g(0)g(to)h(N)f(replies.)-2 3742
y
SDict begin H.S end
 -2 3742 a -2 3742 a
SDict begin 13 H.A end
 -2 3742 a -2 3742 a
SDict begin [/View [/XYZ H.V]/Dest (0:1620) cvn /DEST pdfmark end
 -2 3742 a Black
396 3874 a Fj(\225)p Black 479 3874 a
SDict begin H.S end
 479 3874 a 479
3874 a
SDict begin 13 H.A end
 479 3874 a 479 3874 a
SDict begin [/View [/XYZ H.V]/Dest (0:1621) cvn /DEST pdfmark end
 479 3874 a Fk(Clients)h(can)f(send)g
(multiple)g(requests)g(without)f(w)o(aiting)h(for)g(a)g(reply)-5
b(.)-2 3892 y
SDict begin H.S end
 -2 3892 a -2 3892 a
SDict begin 13 H.A end
 -2 3892 a -2 3892 a
SDict begin [/View [/XYZ H.V]/Dest (0:1622) cvn /DEST pdfmark end

-2 3892 a Black 396 4023 a Fj(\225)p Black 479 4023 a
SDict begin H.S end

479 4023 a 479 4023 a
SDict begin 13 H.A end
 479 4023 a 479 4023 a
SDict begin [/View [/XYZ H.V]/Dest (0:1623) cvn /DEST pdfmark end
 479 4023
a Fk(Serv)o(ers)20 b(can)g(send)g(multiple)f(replies)h(without)g(w)o
(aiting)g(for)f(ne)n(w)h(requests.)-2 4207 y
SDict begin H.S end
 -2 4207
a -2 4207 a
SDict begin 13 H.A end
 -2 4207 a -2 4207 a
SDict begin [/View [/XYZ H.V]/Dest (0:1624) cvn /DEST pdfmark end
 -2 4207 a 396 4297 a
Fk(Here')-5 b(s)21 b(code)e(that)h(sho)n(ws)h(ho)n(w)e(this)i(w)o
(orks:)-2 4298 y
SDict begin H.S end
 -2 4298 a -2 4298 a
SDict begin 13 H.A end
 -2 4298 a -2 4298
a
SDict begin [/View [/XYZ H.V]/Dest (0:asyncsrv-c) cvn /DEST pdfmark
end
 -2 4298 a 396 4498 a Fg(Example)g(3-18.)d(Asynchr)o(onous)i
(client-ser)o(v)o(er)g(\(asyncsr)o(v)-6 b(.c\))-2 4598
y
SDict begin H.S end
 -2 4598 a -2 4598 a
SDict begin 11.7 H.A end
 -2 4598 a -2 4598 a
SDict begin [/View [/XYZ H.V]/Dest (0:1627) cvn /DEST pdfmark end
 -2 4598 a 396
4678 a Fe(//)396 4776 y(//)90 b(Asynchronous)42 b(client-to-server)h
(\(DEALER)g(to)i(ROUTER\))396 4873 y(//)396 4970 y(//)90
b(While)44 b(this)g(example)f(runs)i(in)f(a)h(single)f(process,)f(that)
h(is)h(just)f(to)g(make)396 5067 y(//)90 b(it)44 b(easier)g(to)g(start)
g(and)h(stop)f(the)g(example.)g(Each)g(task)g(has)g(its)h(own)396
5164 y(//)90 b(context)43 b(and)i(conceptually)d(acts)j(as)f(a)h
(separate)e(process.)p Black 3759 5569 a Ff(119)p Black
eop end
%%Page: 120 133
TeXDict begin 120 132 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.120) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 170 a Fe(#include)44 b("czmq.h")396
364 y(//)90 b(-------------------------------------)o(------)o(------)o
(------)o(------)o(-----)o(---)396 461 y(//)g(This)44
b(is)g(our)h(client)e(task)396 558 y(//)90 b(It)44 b(connects)g(to)g
(the)g(server,)g(and)g(then)h(sends)f(a)g(request)g(once)g(per)g
(second)396 655 y(//)90 b(It)44 b(collects)g(responses)f(as)h(they)h
(arrive,)e(and)i(it)f(prints)g(them)g(out.)g(We)h(will)396
752 y(//)90 b(run)44 b(several)g(client)f(tasks)h(in)h(parallel,)e
(each)h(with)h(a)f(different)g(random)f(ID.)396 947 y(static)h(void)934
960 y(*)396 1044 y(client_task)f(\(void)1203 1057 y(*)1248
1044 y(args\))396 1141 y({)576 1238 y(zctx_t)889 1251
y(*)934 1238 y(ctx)i(=)f(zctx_new)g(\(\);)576 1335 y(void)800
1348 y(*)845 1335 y(client)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)
576 1530 y(//)89 b(Set)44 b(random)g(identity)g(to)g(make)g(tracing)g
(easier)576 1627 y(char)g(identity)f([10];)576 1724 y(sprintf)g
(\(identity,)g("\04504X-\04504X",)g(randof)h(\(0x10000\),)f(randof)h
(\(0x10000\)\);)576 1821 y(zsockopt_set_identity)d(\(client,)i
(identity\);)576 1918 y(zsocket_connect)f(\(client,)h
("tcp://localhost:5570"\);)576 2112 y(zmq_pollitem_t)f(items)i([])h(=)f
({)h({)g(client,)e(0,)i(ZMQ_POLLIN,)e(0)h(})h(};)576
2209 y(int)f(request_nbr)f(=)i(0;)576 2307 y(while)f(\(true\))f({)755
2404 y(//)89 b(Tick)44 b(once)h(per)f(second,)g(pulling)f(in)i
(arriving)e(messages)755 2501 y(int)h(centitick;)755
2598 y(for)g(\(centitick)f(=)i(0;)g(centitick)e(<)i(100;)f
(centitick++\))f({)934 2695 y(zmq_poll)h(\(items,)f(1,)i(10)1965
2708 y(*)2055 2695 y(ZMQ_POLL_MSEC\);)934 2792 y(if)g(\(items)f
([0].revents)f(&)h(ZMQ_POLLIN\))f({)1114 2889 y(zmsg_t)1427
2902 y(*)1472 2889 y(msg)i(=)f(zmsg_recv)g(\(client\);)1114
2987 y(zframe_print)e(\(zmsg_last)i(\(msg\),)f(identity\);)1114
3084 y(zmsg_destroy)f(\(&msg\);)934 3181 y(})755 3278
y(})755 3375 y(zstr_sendf)h(\(client,)h("request)f(#\045d",)h
(++request_nbr\);)576 3472 y(})576 3569 y(zctx_destroy)e(\(&ctx\);)576
3666 y(return)h(NULL;)396 3764 y(})-2 3938 y
SDict begin H.S end
 -2 3938
a -2 3938 a
SDict begin 13 H.A end
 -2 3938 a -2 3938 a
SDict begin [/View [/XYZ H.V]/Dest (0:1628) cvn /DEST pdfmark end
 -2 3938 a 396 4038 a
Fk(This)21 b(is)g(our)e(serv)o(er)h(task.)g(It)g(uses)h(the)f
(multithreaded)e(serv)o(er)h(model)h(to)g(deal)g(requests)g(out)g(to)g
(a)h(pool)e(of)h(w)o(ork)o(ers)396 4146 y(and)g(route)f(replies)h(back)
g(to)g(clients.)g(One)h(w)o(ork)o(er)e(can)h(handle)f(one)g(request)h
(at)h(a)f(time)h(b)n(ut)f(one)g(client)g(can)g(talk)g(to)396
4253 y(multiple)g(w)o(ork)o(ers)f(at)i(once.)-2 4271
y
SDict begin H.S end
 -2 4271 a -2 4271 a
SDict begin 13 H.A end
 -2 4271 a -2 4271 a
SDict begin [/View [/XYZ H.V]/Dest (0:asyncsrv-c-1) cvn /DEST pdfmark
end
 -2 4271 a 396
4455 a Fg(Example)g(3-19.)d(Asynchr)o(onous)i(client-ser)o(v)o(er)g
(\(asyncsr)o(v)-6 b(.c\))19 b(-)h(ser)o(v)o(er)h(task)-2
4555 y
SDict begin H.S end
 -2 4555 a -2 4555 a
SDict begin 11.7 H.A end
 -2 4555 a -2 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:1631) cvn /DEST pdfmark end
 -2 4555
a 396 4732 a Fe(static)44 b(void)g(server_worker)f(\(void)1831
4745 y(*)1876 4732 y(args,)h(zctx_t)2459 4745 y(*)2504
4732 y(ctx,)g(void)2952 4745 y(*)2997 4732 y(pipe\);)396
4926 y(void)620 4939 y(*)665 4926 y(server_task)f(\(void)1472
4939 y(*)1517 4926 y(args\))396 5023 y({)576 5121 y(zctx_t)889
5134 y(*)934 5121 y(ctx)i(=)f(zctx_new)g(\(\);)p Black
3759 5569 a Ff(120)p Black eop end
%%Page: 121 134
TeXDict begin 121 133 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.121) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 170 a Fe(//)89 b(Frontend)43 b(socket)h(talks)g
(to)h(clients)e(over)i(TCP)576 267 y(void)800 280 y(*)845
267 y(frontend)e(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
364 y(zsocket_bind)e(\(frontend,)i("tcp://)1967 377 y(*)2012
364 y(:5570"\);)576 558 y(//)89 b(Backend)44 b(socket)f(talks)h(to)h
(workers)f(over)g(inproc)576 655 y(void)800 668 y(*)845
655 y(backend)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)576
752 y(zsocket_bind)e(\(backend,)i("inproc://backend"\);)576
947 y(//)89 b(Launch)44 b(pool)g(of)g(worker)g(threads,)g(precise)f
(number)h(is)h(not)f(critical)576 1044 y(int)g(thread_nbr;)576
1141 y(for)g(\(thread_nbr)f(=)i(0;)f(thread_nbr)f(<)i(5;)f
(thread_nbr++\))755 1238 y(zthread_fork)f(\(ctx,)h(server_worker,)e
(NULL\);)576 1432 y(//)89 b(Connect)44 b(backend)f(to)i(frontend)e(via)
i(a)f(proxy)576 1530 y(zmq_proxy)f(\(frontend,)g(backend,)h(NULL\);)576
1724 y(zctx_destroy)e(\(&ctx\);)576 1821 y(return)h(NULL;)396
1918 y(})-2 2092 y
SDict begin H.S end
 -2 2092 a -2 2092 a
SDict begin 13 H.A end
 -2 2092 a -2 2092
a
SDict begin [/View [/XYZ H.V]/Dest (0:1632) cvn /DEST pdfmark end
 -2 2092 a 396 2192 a Fk(Each)20 b(w)o(ork)o(er)f(task)i(w)o(orks)f
(on)f(one)h(request)f(at)i(a)g(time)f(and)g(sends)g(a)h(random)d
(number)g(of)i(replies)g(back,)g(with)396 2300 y(random)f(delays)h
(between)f(replies:)-2 2318 y
SDict begin H.S end
 -2 2318 a -2 2318 a
SDict begin 13 H.A end
 -2
2318 a -2 2318 a
SDict begin [/View [/XYZ H.V]/Dest (0:asyncsrv-c-2) cvn /DEST pdfmark
end
 -2 2318 a 396 2501 a Fg(Example)i(3-20.)d(Asynchr)o
(onous)i(client-ser)o(v)o(er)g(\(asyncsr)o(v)-6 b(.c\))19
b(-)h(w)o(ork)o(er)g(task)-2 2601 y
SDict begin H.S end
 -2 2601 a -2 2601
a
SDict begin 11.7 H.A end
 -2 2601 a -2 2601 a
SDict begin [/View [/XYZ H.V]/Dest (0:1635) cvn /DEST pdfmark end
 -2 2601 a 396 2779 a Fe(static)44
b(void)396 2876 y(server_worker)f(\(void)1293 2889 y(*)1338
2876 y(args,)h(zctx_t)1921 2889 y(*)1966 2876 y(ctx,)g(void)2414
2889 y(*)2459 2876 y(pipe\))396 2973 y({)576 3070 y(void)800
3083 y(*)845 3070 y(worker)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)
576 3167 y(zsocket_connect)e(\(worker,)h("inproc://backend"\);)576
3361 y(while)h(\(true\))f({)755 3459 y(//)89 b(The)45
b(DEALER)e(socket)h(gives)g(us)h(the)f(address)g(envelope)f(and)i
(message)755 3556 y(zmsg_t)1069 3569 y(*)1114 3556 y(msg)f(=)h
(zmsg_recv)e(\(worker\);)755 3653 y(zframe_t)1158 3666
y(*)1203 3653 y(address)h(=)h(zmsg_pop)e(\(msg\);)755
3750 y(zframe_t)1158 3763 y(*)1203 3750 y(content)h(=)h(zmsg_pop)e
(\(msg\);)755 3847 y(assert)h(\(content\);)755 3944 y(zmsg_destroy)f
(\(&msg\);)755 4138 y(//)89 b(Send)44 b(0..4)h(replies)e(back)755
4236 y(int)h(reply,)g(replies)g(=)g(randof)g(\(5\);)755
4333 y(for)g(\(reply)g(=)h(0;)f(reply)g(<)h(replies;)e(reply++\))h({)
934 4430 y(//)90 b(Sleep)44 b(for)g(some)g(fraction)g(of)g(a)h(second)
934 4527 y(zclock_sleep)e(\(randof)h(\(1000\))g(+)g(1\);)934
4624 y(zframe_send)f(\(&address,)g(worker,)h(ZFRAME_REUSE)f(+)i
(ZFRAME_MORE\);)934 4721 y(zframe_send)e(\(&content,)g(worker,)h
(ZFRAME_REUSE\);)755 4818 y(})755 4916 y(zframe_destroy)e
(\(&address\);)755 5013 y(zframe_destroy)g(\(&content\);)576
5110 y(})p Black 3759 5569 a Ff(121)p Black eop end
%%Page: 122 135
TeXDict begin 122 134 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.122) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1650) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fe(})396 364 y(//)90
b(The)44 b(main)g(thread)g(simply)g(starts)g(several)f(clients,)h(and)g
(a)h(server,)e(and)i(then)396 461 y(//)90 b(waits)44
b(for)g(the)g(server)g(to)h(finish.)396 655 y(int)g(main)f(\(void\))396
752 y({)576 850 y(zctx_t)889 863 y(*)934 850 y(ctx)h(=)f(zctx_new)g
(\(\);)576 947 y(zthread_new)f(\(client_task,)f(NULL\);)576
1044 y(zthread_new)h(\(client_task,)f(NULL\);)576 1141
y(zthread_new)h(\(client_task,)f(NULL\);)576 1238 y(zthread_new)h
(\(server_task,)f(NULL\);)576 1432 y(//)89 b(Run)44 b(for)h(5)f
(seconds)g(then)g(quit)576 1530 y(zclock_sleep)e(\(5)1293
1543 y(*)1383 1530 y(1000\);)576 1627 y(zctx_destroy)g(\(&ctx\);)576
1724 y(return)h(0;)396 1821 y(})-2 1995 y
SDict begin H.S end
 -2 1995 a -2
1995 a
SDict begin 13 H.A end
 -2 1995 a -2 1995 a
SDict begin [/View [/XYZ H.V]/Dest (0:1636) cvn /DEST pdfmark end
 -2 1995 a 396 2095 a Fk(Just)21
b(run)f(that)g(e)o(xample)f(by)g(itself.)i(Lik)o(e)f(other)f
(multi-task)h(e)o(xamples,)f(it)i(runs)e(in)i(a)f(single)g(process)g(b)
n(ut)g(each)g(task)396 2203 y(has)h(its)g(o)n(wn)f(conte)o(xt)e(and)i
(conceptually)e(acts)j(as)g(a)f(separate)g(process\()p
0 TeXcolorgray 2506 2203 a
SDict begin H.S end
 2506 2203 a Fk(Figure)e(3-19)2896
2203 y
SDict begin 13 H.L end
 2896 2203 a 2896 2203 a
SDict begin [/Subtype /Link/Dest (0:figure-45) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2896 2203 a Black -1 w
Fk(\).)i(Y)-9 b(ou)19 b(will)i(see)g(three)f(clients)396
2311 y(\(each)g(with)g(a)h(random)d(ID\),)i(printing)f(out)g(the)i
(replies)f(the)o(y)f(get)h(from)g(the)g(serv)o(er)-5
b(.)19 b(Look)g(carefully)g(and)h(you')o(ll)f(see)396
2419 y(each)h(client)g(task)h(gets)f(0)h(or)f(more)f(replies)h(per)g
(request.)-2 2603 y
SDict begin H.S end
 -2 2603 a -2 2603 a
SDict begin 13 H.A end
 -2 2603 a -2
2603 a
SDict begin [/View [/XYZ H.V]/Dest (0:1638) cvn /DEST pdfmark end
 -2 2603 a 396 2693 a Fk(Some)g(comments)f(on)h(this)h(code:)-2
2694 y
SDict begin H.S end
 -2 2694 a -2 2694 a
SDict begin 13 H.A end
 -2 2694 a -2 2694 a
SDict begin [/View [/XYZ H.V]/Dest (0:1639) cvn /DEST pdfmark end
 -2 2694
a -2 2704 a
SDict begin H.S end
 -2 2704 a -2 2704 a
SDict begin 13 H.A end
 -2 2704 a -2 2704 a
SDict begin [/View [/XYZ H.V]/Dest (0:1640) cvn /DEST pdfmark end
 -2
2704 a Black 396 2863 a Fj(\225)p Black 479 2863 a
SDict begin H.S end
 479
2863 a 479 2863 a
SDict begin 13 H.A end
 479 2863 a 479 2863 a
SDict begin [/View [/XYZ H.V]/Dest (0:1641) cvn /DEST pdfmark end
 479 2863 a Fk(The)e(clients)h
(send)f(a)h(request)e(once)h(per)g(second,)f(and)h(get)g(zero)g(or)g
(more)g(replies)g(back.)f(T)-7 b(o)20 b(mak)o(e)f(this)h(w)o(ork)e
(using)479 2971 y(zmq_poll[3],)f(we)j(can')o(t)f(simply)g(poll)g(with)h
(a)h(1-second)c(timeout,)i(or)h(we')l(d)f(end)g(up)g(sending)g(a)h(ne)n
(w)g(request)f(only)479 3079 y(one)h(second)871 3079
y
SDict begin H.S end
 871 3079 a 871 3079 a
SDict begin 13 H.A end
 871 3079 a 871 3079 a
SDict begin [/View [/XYZ H.V]/Dest (0:1642) cvn /DEST pdfmark end
 871 3079
a Ff(after)h(we)g(r)m(eceived)f(the)g(last)h(r)m(eply)p
Fk(.)f(So)g(we)h(poll)f(at)g(a)h(high)e(frequenc)o(y)f(\(100)h(times)h
(at)h(1/100th)d(of)i(a)479 3187 y(second)g(per)f(poll\),)h(which)f(is)i
(approximately)d(accurate.)h(This)h(means)g(the)g(serv)o(er)g(could)f
(use)h(requests)g(as)h(a)g(form)479 3295 y(of)f(heartbeat,)f(i.e.)h
(detecting)f(when)h(clients)g(are)h(present)e(or)h(disconnected.)-2
3313 y
SDict begin H.S end
 -2 3313 a -2 3313 a
SDict begin 13 H.A end
 -2 3313 a -2 3313 a
SDict begin [/View [/XYZ H.V]/Dest (0:1643) cvn /DEST pdfmark end
 -2 3313
a Black 396 3444 a Fj(\225)p Black 479 3444 a
SDict begin H.S end
 479 3444
a 479 3444 a
SDict begin 13 H.A end
 479 3444 a 479 3444 a
SDict begin [/View [/XYZ H.V]/Dest (0:1644) cvn /DEST pdfmark end
 479 3444 a Fk(The)g(serv)o(er)f
(uses)h(a)g(pool)f(of)g(w)o(ork)o(er)g(threads,)g(each)g(processing)g
(one)g(request)g(synchronously)-5 b(.)16 b(It)k(connects)f(these)479
3552 y(to)i(its)g(frontend)d(sock)o(et)i(using)g(an)g(internal)f
(queue.)g(T)-7 b(o)20 b(help)g(deb)n(ug)f(this,)h(the)h(code)e
(implements)g(its)j(o)n(wn)d(queue)479 3660 y(de)n(vice)h(logic.)f(In)h
(the)g(C)h(code,)f(you)f(can)h(uncomment)e(the)i(zmsg_dump\(\))d(calls)
k(to)f(get)g(deb)n(ugging)e(output.)-2 3678 y
SDict begin H.S end
 -2 3678
a -2 3678 a
SDict begin 13 H.A end
 -2 3678 a -2 3678 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-45) cvn /DEST pdfmark
end
 -2 3678 a Black 3759
5569 a Ff(122)p Black eop end
%%Page: 123 136
TeXDict begin 123 135 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.123) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1659) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-19.)e(Detail)i(of)
g(Asynchr)o(onous)g(Ser)o(v)o(er)-2 172 y
SDict begin H.S end
 -2 172 a -2
172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1647) cvn /DEST pdfmark end
 -2 172 a 396 3081 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3081
a @beginspecial 0 @llx -344 @lly 306 @urx 0 @ury 3060
@rwi @setspecial
%%BeginDocument: images/fig45.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -344 306 0
%%HiResBoundingBox: 0.0 -344.0 306.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
40.80017852783203 -21.800180435180664 moveto
40.80017852783203 -51.80017852783203 lineto
100.80017852783203 -51.80017852783203 lineto
100.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
40.80017852783203 -54.80017852783203 moveto
40.80017852783203 -65.80017852783203 lineto
40.80017852783203 -68.4668451944987 41.80017852783203 -69.80017852783203 43.80017852783203 -69.80017852783203 curveto
97.80017852783203 -69.80017852783203 lineto
97.80017852783203 -69.80017852783203 lineto
99.80017852783203 -69.80017852783203 100.80017852783203 -68.4668451944987 100.80017852783203 -65.80017852783203 curveto
100.80017852783203 -55.000179290771484 lineto
100.80017852783203 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
124.80017852783203 -21.800180435180664 moveto
124.80017852783203 -51.80017852783203 lineto
184.80018615722656 -51.80017852783203 lineto
184.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
124.80017852783203 -54.80017852783203 moveto
124.80017852783203 -65.80017852783203 lineto
124.80017852783203 -68.4668451944987 125.80017852783203 -69.80017852783203 127.80017852783203 -69.80017852783203 curveto
181.80018615722656 -69.80017852783203 lineto
181.80018615722656 -69.80017852783203 lineto
183.80018615722656 -69.80017852783203 184.80018615722656 -68.4668451944987 184.80018615722656 -65.80017852783203 curveto
184.80018615722656 -55.000179290771484 lineto
184.80018615722656 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -21.800180435180664 moveto
208.80018615722656 -51.80017852783203 lineto
268.8001708984375 -51.80017852783203 lineto
268.8001708984375 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -54.80017852783203 moveto
208.80018615722656 -65.80017852783203 lineto
208.80018615722656 -68.4668451944987 209.80018615722656 -69.80017852783203 211.80018615722656 -69.80017852783203 curveto
265.8001708984375 -69.80017852783203 lineto
265.8001708984375 -69.80017852783203 lineto
267.8001708984375 -69.80017852783203 268.8001708984375 -68.4668451944987 268.8001708984375 -65.80017852783203 curveto
268.8001708984375 -55.000179290771484 lineto
268.8001708984375 -54.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
121.80017852783203 -141.80018615722656 moveto
119.80017852783203 -141.80018615722656 118.80017852783203 -143.1335194905599 118.80017852783203 -145.80018615722656 curveto
118.80017852783203 -155.80018615722656 lineto
190.80018615722656 -155.80018615722656 lineto
190.80018615722656 -145.80018615722656 lineto
190.80018615722656 -143.1335194905599 189.80018615722656 -141.80018615722656 187.80018615722656 -141.80018615722656 curveto
121.80017852783203 -141.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -158.80018615722656 moveto
118.80017852783203 -187.80018615722656 lineto
190.80018615722656 -187.80018615722656 lineto
190.80018615722656 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.80017852783203 -190.80018615722656 moveto
118.80017852783203 -201.80018615722656 lineto
118.80017852783203 -204.46685282389322 119.80017852783203 -205.80018615722656 121.80017852783203 -205.80018615722656 curveto
187.80018615722656 -205.80018615722656 lineto
187.80018615722656 -205.80018615722656 lineto
189.80018615722656 -205.80018615722656 190.80018615722656 -204.46685282389322 190.80018615722656 -201.80018615722656 curveto
190.80018615722656 -191.00018310546875 lineto
190.80018615722656 -190.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
43.80017852783203 -261.8001708984375 moveto
41.80017852783203 -261.8001708984375 40.80017852783203 -263.1335042317708 40.80017852783203 -265.8001708984375 curveto
40.80017852783203 -275.8001708984375 lineto
100.80017852783203 -275.8001708984375 lineto
100.80017852783203 -265.8001708984375 lineto
100.80017852783203 -263.1335042317708 99.80017852783203 -261.8001708984375 97.80017852783203 -261.8001708984375 curveto
43.80017852783203 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
40.80017852783203 -278.8001708984375 moveto
40.80017852783203 -309.8001708984375 lineto
100.80017852783203 -309.8001708984375 lineto
100.80017852783203 -278.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
127.80017852783203 -261.8001708984375 moveto
125.80017852783203 -261.8001708984375 124.80017852783203 -263.1335042317708 124.80017852783203 -265.8001708984375 curveto
124.80017852783203 -275.8001708984375 lineto
184.80018615722656 -275.8001708984375 lineto
184.80018615722656 -265.8001708984375 lineto
184.80018615722656 -263.1335042317708 183.80018615722656 -261.8001708984375 181.80018615722656 -261.8001708984375 curveto
127.80017852783203 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
124.80017852783203 -278.8001708984375 moveto
124.80017852783203 -309.8001708984375 lineto
184.80018615722656 -309.8001708984375 lineto
184.80018615722656 -278.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -261.8001708984375 moveto
209.80018615722656 -261.8001708984375 208.80018615722656 -263.1335042317708 208.80018615722656 -265.8001708984375 curveto
208.80018615722656 -275.8001708984375 lineto
268.8001708984375 -275.8001708984375 lineto
268.8001708984375 -265.8001708984375 lineto
268.8001708984375 -263.1335042317708 267.8001708984375 -261.8001708984375 265.8001708984375 -261.8001708984375 curveto
211.80018615722656 -261.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -278.8001708984375 moveto
208.80018615722656 -309.8001708984375 lineto
268.8001708984375 -309.8001708984375 lineto
268.8001708984375 -278.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
39.0 -20.0 moveto
39.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
39.0 -20.0 moveto
39.0 -50.0 lineto
99.0 -50.0 lineto
99.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
39.0 -53.0 moveto
39.0 -64.0 lineto
39.0 -66.66666666666667 40.0 -68.0 42.0 -68.0 curveto
96.0 -68.0 lineto
96.0 -68.0 lineto
98.0 -68.0 99.0 -66.66666666666667 99.0 -64.0 curveto
99.0 -53.20000076293945 lineto
99.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
39.0 -53.0 moveto
39.0 -64.0 lineto
39.0 -66.66666666666667 40.0 -68.0 42.0 -68.0 curveto
96.0 -68.0 lineto
96.0 -68.0 lineto
98.0 -68.0 99.0 -66.66666666666667 99.0 -64.0 curveto
99.0 -53.20000076293945 lineto
99.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
123.0 -20.0 moveto
123.0 -50.0 lineto
183.0 -50.0 lineto
183.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
123.0 -20.0 moveto
123.0 -50.0 lineto
183.0 -50.0 lineto
183.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
123.0 -53.0 moveto
123.0 -64.0 lineto
123.0 -66.66666666666667 124.0 -68.0 126.0 -68.0 curveto
180.0 -68.0 lineto
180.0 -68.0 lineto
182.0 -68.0 183.0 -66.66666666666667 183.0 -64.0 curveto
183.0 -53.20000076293945 lineto
183.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
123.0 -53.0 moveto
123.0 -64.0 lineto
123.0 -66.66666666666667 124.0 -68.0 126.0 -68.0 curveto
180.0 -68.0 lineto
180.0 -68.0 lineto
182.0 -68.0 183.0 -66.66666666666667 183.0 -64.0 curveto
183.0 -53.20000076293945 lineto
183.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -20.0 moveto
207.0 -50.0 lineto
267.0 -50.0 lineto
267.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -20.0 moveto
207.0 -50.0 lineto
267.0 -50.0 lineto
267.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -53.0 moveto
207.0 -64.0 lineto
207.0 -66.66666666666667 208.0 -68.0 210.0 -68.0 curveto
264.0 -68.0 lineto
264.0 -68.0 lineto
266.0 -68.0 267.0 -66.66666666666667 267.0 -64.0 curveto
267.0 -53.20000076293945 lineto
267.0 -53.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -53.0 moveto
207.0 -64.0 lineto
207.0 -66.66666666666667 208.0 -68.0 210.0 -68.0 curveto
264.0 -68.0 lineto
264.0 -68.0 lineto
266.0 -68.0 267.0 -66.66666666666667 267.0 -64.0 curveto
267.0 -53.20000076293945 lineto
267.0 -53.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
120.0 -140.0 moveto
118.0 -140.0 117.0 -141.33333333333334 117.0 -144.0 curveto
117.0 -154.0 lineto
189.0 -154.0 lineto
189.0 -144.0 lineto
189.0 -141.33333333333334 188.0 -140.0 186.0 -140.0 curveto
120.0 -140.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
120.0 -140.0 moveto
118.0 -140.0 117.0 -141.33333333333334 117.0 -144.0 curveto
117.0 -154.0 lineto
189.0 -154.0 lineto
189.0 -144.0 lineto
189.0 -141.33333333333334 188.0 -140.0 186.0 -140.0 curveto
120.0 -140.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -157.0 moveto
117.0 -186.0 lineto
189.0 -186.0 lineto
189.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -157.0 moveto
117.0 -186.0 lineto
189.0 -186.0 lineto
189.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
117.0 -189.0 moveto
117.0 -200.0 lineto
117.0 -202.66666666666666 118.0 -204.0 120.0 -204.0 curveto
186.0 -204.0 lineto
186.0 -204.0 lineto
188.0 -204.0 189.0 -202.66666666666666 189.0 -200.0 curveto
189.0 -189.1999969482422 lineto
189.0 -189.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
117.0 -189.0 moveto
117.0 -200.0 lineto
117.0 -202.66666666666666 118.0 -204.0 120.0 -204.0 curveto
186.0 -204.0 lineto
186.0 -204.0 lineto
188.0 -204.0 189.0 -202.66666666666666 189.0 -200.0 curveto
189.0 -189.1999969482422 lineto
189.0 -189.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
42.0 -260.0 moveto
40.0 -260.0 39.0 -261.3333333333333 39.0 -264.0 curveto
39.0 -274.0 lineto
99.0 -274.0 lineto
99.0 -264.0 lineto
99.0 -261.3333333333333 98.0 -260.0 96.0 -260.0 curveto
42.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
42.0 -260.0 moveto
40.0 -260.0 39.0 -261.3333333333333 39.0 -264.0 curveto
39.0 -274.0 lineto
99.0 -274.0 lineto
99.0 -264.0 lineto
99.0 -261.3333333333333 98.0 -260.0 96.0 -260.0 curveto
42.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
39.0 -277.0 moveto
39.0 -308.0 lineto
99.0 -308.0 lineto
99.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
39.0 -277.0 moveto
39.0 -308.0 lineto
99.0 -308.0 lineto
99.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
126.0 -260.0 moveto
124.0 -260.0 123.0 -261.3333333333333 123.0 -264.0 curveto
123.0 -274.0 lineto
183.0 -274.0 lineto
183.0 -264.0 lineto
183.0 -261.3333333333333 182.0 -260.0 180.0 -260.0 curveto
126.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
126.0 -260.0 moveto
124.0 -260.0 123.0 -261.3333333333333 123.0 -264.0 curveto
123.0 -274.0 lineto
183.0 -274.0 lineto
183.0 -264.0 lineto
183.0 -261.3333333333333 182.0 -260.0 180.0 -260.0 curveto
126.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
123.0 -277.0 moveto
123.0 -308.0 lineto
183.0 -308.0 lineto
183.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
123.0 -277.0 moveto
123.0 -308.0 lineto
183.0 -308.0 lineto
183.0 -277.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -260.0 moveto
208.0 -260.0 207.0 -261.3333333333333 207.0 -264.0 curveto
207.0 -274.0 lineto
267.0 -274.0 lineto
267.0 -264.0 lineto
267.0 -261.3333333333333 266.0 -260.0 264.0 -260.0 curveto
210.0 -260.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -260.0 moveto
208.0 -260.0 207.0 -261.3333333333333 207.0 -264.0 curveto
207.0 -274.0 lineto
267.0 -274.0 lineto
267.0 -264.0 lineto
267.0 -261.3333333333333 266.0 -260.0 264.0 -260.0 curveto
210.0 -260.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -277.0 moveto
207.0 -308.0 lineto
267.0 -308.0 lineto
267.0 -277.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -277.0 moveto
207.0 -308.0 lineto
267.0 -308.0 lineto
267.0 -277.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
150.0 -116.0 moveto
18.0 -116.0 lineto
16.0 -116.0 15.0 -117.33333333333333 15.0 -120.0 curveto
15.0 -320.0 lineto
15.0 -320.0 lineto
15.0 -322.6666666666667 16.0 -324.0 18.0 -324.0 curveto
288.0 -324.0 lineto
288.0 -324.0 lineto
290.0 -324.0 291.0 -322.6666666666667 291.0 -320.0 curveto
291.0 -120.0 lineto
291.0 -120.0 lineto
291.0 -117.33333333333333 290.0 -116.0 288.0 -116.0 curveto
156.0 -116.0 lineto
156.0 -116.0 lineto
stroke
newpath
150.0 -120.0 moveto
153.0 -128.0 lineto
156.0 -120.0 lineto
closepath
fill
newpath
66.0 -240.0 moveto
69.0 -248.0 lineto
72.0 -240.0 lineto
closepath
fill
newpath
150.0 -240.0 moveto
153.0 -248.0 lineto
156.0 -240.0 lineto
closepath
fill
newpath
234.0 -240.0 moveto
237.0 -248.0 lineto
240.0 -240.0 lineto
closepath
fill
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
69.0 -84.0 moveto
69.0 -100.0 lineto
153.0 -100.0 lineto
stroke
newpath
153.0 -84.0 moveto
153.0 -100.0 lineto
stroke
newpath
237.0 -84.0 moveto
237.0 -100.0 lineto
153.0 -100.0 lineto
stroke
newpath
153.0 -124.0 moveto
153.0 -100.0 lineto
stroke
newpath
153.0 -220.0 moveto
153.0 -228.0 lineto
stroke
newpath
69.0 -244.0 moveto
69.0 -228.0 lineto
153.0 -228.0 lineto
stroke
newpath
153.0 -244.0 moveto
153.0 -228.0 lineto
stroke
newpath
237.0 -244.0 moveto
237.0 -228.0 lineto
153.0 -228.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
53.0 -39.0 moveto
(Client) show
137.0 -39.0 moveto
(Client) show
221.0 -39.0 moveto
(Client) show
49.0 -63.0 moveto
(DEALER) show
133.0 -63.0 moveto
(DEALER) show
217.0 -63.0 moveto
(DEALER) show
51.0 -79.0 moveto
(connect) show
135.0 -79.0 moveto
(connect) show
219.0 -79.0 moveto
(connect) show
140.0 -135.0 moveto
(bind) show
132.0 -151.0 moveto
(ROUTER) show
136.0 -175.0 moveto
(Server) show
133.0 -199.0 moveto
(DEALER) show
140.0 -215.0 moveto
(bind) show
51.0 -255.0 moveto
(connect) show
135.0 -255.0 moveto
(connect) show
219.0 -255.0 moveto
(connect) show
49.0 -271.0 moveto
(DEALER) show
133.0 -271.0 moveto
(DEALER) show
217.0 -271.0 moveto
(DEALER) show
50.0 -295.0 moveto
(Worker) show
134.0 -295.0 moveto
(Worker) show
218.0 -295.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3081 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3081 a 274 x Fk(Note)g(that)h(we')l(re)e
(doing)g(a)i(DEALER-to-R)m(OUTER)e(dialog)g(between)g(client)i(and)e
(serv)o(er)m(,)g(b)n(ut)h(internally)f(between)396 3462
y(the)h(serv)o(er)g(main)g(thread)f(and)g(w)o(ork)o(ers)h(we')l(re)g
(doing)e(DEALER-to-DEALER.)h(If)h(the)g(w)o(ork)o(ers)f(were)i
(strictly)396 3570 y(synchronous,)c(we')l(d)j(use)g(REP)-9
b(.)21 b(But)g(since)f(we)h(w)o(ant)f(to)g(send)g(multiple)g(replies)g
(we)g(need)g(an)g(async)g(sock)o(et.)g(W)-7 b(e)21 b(do)396
3678 y Ff(not)h Fk(w)o(ant)e(to)g(route)g(replies,)f(the)o(y)h(al)o(w)o
(ays)h(go)e(to)i(the)f(single)g(serv)o(er)f(thread)h(that)g(sent)g(us)h
(the)f(request.)-2 3862 y
SDict begin H.S end
 -2 3862 a -2 3862 a
SDict begin 13 H.A end
 -2 3862
a -2 3862 a
SDict begin [/View [/XYZ H.V]/Dest (0:1652) cvn /DEST pdfmark end
 -2 3862 a 396 3952 a Fk(Let')-5 b(s)21 b(think)f(about)f
(the)h(routing)f(en)m(v)o(elope.)e(The)j(client)g(sends)h(a)f(simple)g
(message.)g(The)g(serv)o(er)f(thread)g(recei)n(v)o(es)h(a)396
4060 y(tw)o(o-part)f(message)h(\(real)g(message)g(pre\002x)o(ed)f(by)h
(client)g(identity\).)f(W)-7 b(e)21 b(ha)n(v)o(e)f(tw)o(o)g(possible)g
(designs)g(for)f(the)396 4168 y(serv)o(er)n(-to-w)o(ork)o(er)e(interf)o
(ace:)-2 4169 y
SDict begin H.S end
 -2 4169 a -2 4169 a
SDict begin 13 H.A end
 -2 4169 a -2 4169
a
SDict begin [/View [/XYZ H.V]/Dest (0:1653) cvn /DEST pdfmark end
 -2 4169 a -2 4179 a
SDict begin H.S end
 -2 4179 a -2 4179 a
SDict begin 13 H.A end
 -2 4179 a -2
4179 a
SDict begin [/View [/XYZ H.V]/Dest (0:1654) cvn /DEST pdfmark end
 -2 4179 a Black 396 4338 a Fj(\225)p Black 479
4338 a
SDict begin H.S end
 479 4338 a 479 4338 a
SDict begin 13 H.A end
 479 4338 a 479 4338 a
SDict begin [/View [/XYZ H.V]/Dest (0:1655) cvn /DEST pdfmark end
 479
4338 a Fk(W)-7 b(ork)o(ers)20 b(get)h(unaddressed)d(messages,)i(and)f
(we)i(manage)e(the)h(connections)f(from)g(serv)o(er)g(thread)g(to)i(w)o
(ork)o(er)479 4446 y(threads)f(e)o(xplicitly)f(using)h(a)g(R)m(OUTER)h
(sock)o(et)f(as)h(back)o(end.)d(This)i(w)o(ould)g(require)f(that)h(w)o
(ork)o(ers)g(start)g(by)g(telling)479 4554 y(the)g(serv)o(er)g(the)o(y)
f(e)o(xist,)h(which)g(can)g(then)g(route)f(requests)h(to)g(w)o(ork)o
(ers)g(and)f(track)h(which)g(client)g(is)h('connected')d(to)479
4662 y(which)i(w)o(ork)o(er)-5 b(.)19 b(This)i(is)g(the)f(LR)m(U)h
(pattern)e(we)h(already)f(co)o(v)o(ered.)-2 4680 y
SDict begin H.S end
 -2
4680 a -2 4680 a
SDict begin 13 H.A end
 -2 4680 a -2 4680 a
SDict begin [/View [/XYZ H.V]/Dest (0:1656) cvn /DEST pdfmark end
 -2 4680 a Black
396 4812 a Fj(\225)p Black 479 4812 a
SDict begin H.S end
 479 4812 a 479
4812 a
SDict begin 13 H.A end
 479 4812 a 479 4812 a
SDict begin [/View [/XYZ H.V]/Dest (0:1657) cvn /DEST pdfmark end
 479 4812 a Fk(W)-7 b(ork)o(ers)20
b(get)h(addressed)e(messages,)h(and)f(the)o(y)h(return)f(addressed)g
(replies.)h(This)g(requires)f(that)i(w)o(ork)o(ers)e(can)479
4919 y(properly)f(decode)h(and)h(recode)f(en)m(v)o(elopes)f(b)n(ut)i
(it)h(doesn')o(t)e(need)g(an)o(y)h(other)f(mechanisms.)p
Black 3759 5569 a Ff(123)p Black eop end
%%Page: 124 137
TeXDict begin 124 136 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.124) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1658) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(The)20 b(second)f(design)h(is)h(much)e
(simpler)m(,)h(so)g(that')-5 b(s)21 b(what)f(we)g(use:)620
253 y Fe(client)448 b(server)313 b(frontend)f(worker)531
350 y([)44 b(DEALER)g(]<---->[)g(ROUTER)g(<---->)f(DEALER)h(<---->)g
(DEALER)g(])979 447 y(1)h(part)403 b(2)44 b(parts)313
b(2)45 b(parts)-2 624 y
SDict begin H.S end
 -2 624 a -2 624 a
SDict begin 13 H.A end
 -2 624 a -2
624 a
SDict begin [/View [/XYZ H.V]/Dest (0:1660) cvn /DEST pdfmark end
 -2 624 a 396 721 a Fk(When)20 b(you)g(b)n(uild)f(serv)o(ers)h
(that)g(maintain)g(stateful)g(con)m(v)o(ersations)d(with)k(clients,)f
(you)f(will)i(run)f(into)g(a)g(classic)396 829 y(problem.)e(If)j(the)f
(serv)o(er)f(k)o(eeps)h(some)g(state)h(per)f(client,)g(and)f(clients)i
(k)o(eep)f(coming)e(and)i(going,)f(e)n(v)o(entually)f(it)j(will)396
937 y(run)f(out)g(of)f(resources.)g(Ev)o(en)h(if)g(the)g(same)h
(clients)f(k)o(eep)g(connecting,)e(if)i(you')l(re)e(using)i(def)o(ault)
g(identities,)f(each)396 1045 y(connection)f(will)j(look)f(lik)o(e)g(a)
h(ne)n(w)f(one.)-2 1212 y
SDict begin H.S end
 -2 1212 a -2 1212 a
SDict begin 13 H.A end
 -2 1212
a -2 1212 a
SDict begin [/View [/XYZ H.V]/Dest (0:1661) cvn /DEST pdfmark end
 -2 1212 a 396 1319 a Fk(W)-7 b(e)22 b(cheat)e(in)g(the)g
(abo)o(v)o(e)f(e)o(xample)f(by)i(k)o(eeping)f(state)i(only)e(for)h(a)g
(v)o(ery)f(short)h(time)h(\(the)e(time)i(it)g(tak)o(es)f(a)h(w)o(ork)o
(er)e(to)396 1427 y(process)h(a)h(request\))e(and)g(then)h(thro)n(wing)
f(a)o(w)o(ay)g(the)i(state.)f(But)h(that')-5 b(s)21 b(not)f(practical)f
(for)h(man)o(y)f(cases.)h(T)-7 b(o)21 b(properly)396
1534 y(manage)e(client)h(state)h(in)g(a)f(stateful)h(asynchronous)c
(serv)o(er)i(you)g(ha)n(v)o(e)h(to:)-2 1552 y
SDict begin H.S end
 -2 1552
a -2 1552 a
SDict begin 13 H.A end
 -2 1552 a -2 1552 a
SDict begin [/View [/XYZ H.V]/Dest (0:1662) cvn /DEST pdfmark end
 -2 1552 a -2 1562 a
SDict begin H.S end
 -2
1562 a -2 1562 a
SDict begin 13 H.A end
 -2 1562 a -2 1562 a
SDict begin [/View [/XYZ H.V]/Dest (0:1663) cvn /DEST pdfmark end
 -2 1562 a Black
396 1705 a Fj(\225)p Black 479 1705 a
SDict begin H.S end
 479 1705 a 479
1705 a
SDict begin 13 H.A end
 479 1705 a 479 1705 a
SDict begin [/View [/XYZ H.V]/Dest (0:1664) cvn /DEST pdfmark end
 479 1705 a Fk(Do)g(heartbeating)f(from)g
(client)h(to)g(serv)o(er)-5 b(.)20 b(In)g(our)f(e)o(xample)g(we)i(send)
e(a)i(request)f(once)f(per)h(second,)f(which)h(can)479
1813 y(reliably)g(be)g(used)g(as)h(a)f(heartbeat.)-2
1831 y
SDict begin H.S end
 -2 1831 a -2 1831 a
SDict begin 13 H.A end
 -2 1831 a -2 1831 a
SDict begin [/View [/XYZ H.V]/Dest (0:1665) cvn /DEST pdfmark end
 -2 1831
a Black 396 1962 a Fj(\225)p Black 479 1962 a
SDict begin H.S end
 479 1962
a 479 1962 a
SDict begin 13 H.A end
 479 1962 a 479 1962 a
SDict begin [/View [/XYZ H.V]/Dest (0:1666) cvn /DEST pdfmark end
 479 1962 a Fk(Store)g(state)h(using)
f(the)g(client)g(identity)g(\(whether)f(generated)f(or)i(e)o(xplicit\))
f(as)i(k)o(e)o(y)-5 b(.)-2 1980 y
SDict begin H.S end
 -2 1980 a -2 1980 a
SDict begin 13 H.A end

-2 1980 a -2 1980 a
SDict begin [/View [/XYZ H.V]/Dest (0:1667) cvn /DEST pdfmark end
 -2 1980 a Black 396 2111 a Fj(\225)p
Black 479 2111 a
SDict begin H.S end
 479 2111 a 479 2111 a
SDict begin 13 H.A end
 479 2111 a 479
2111 a
SDict begin [/View [/XYZ H.V]/Dest (0:1668) cvn /DEST pdfmark end
 479 2111 a Fk(Detect)21 b(a)f(stopped)f(heartbeat.)g(If)h
(there')-5 b(s)20 b(no)g(request)g(from)f(a)h(client)h(within,)e(say)-5
b(,)20 b(tw)o(o)h(seconds,)e(the)h(serv)o(er)f(can)479
2219 y(detect)h(this)h(and)f(destro)o(y)f(an)o(y)g(state)i(it')-5
b(s)22 b(holding)c(for)i(that)g(client.)-2 2279 y
SDict begin H.S end
 -2
2279 a -2 2279 a
SDict begin 13 H.A end
 -2 2279 a -2 2279 a
SDict begin [/View [/XYZ H.V]/Dest (0:1669) cvn /DEST pdfmark end
 -2 2279 a 359 x
Fn(3.9.)39 b(W)-9 b(orked)39 b(Example:)f(Inter)m(-Br)m(oker)f(Routing)
2911 2638 y
SDict begin H.S end
 2911 2638 a 2911 2638 a
SDict begin 22.464 H.A end
 2911 2638 a 2911
2638 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.1) cvn /DEST pdfmark end
 2911 2638 a -2 2836 a
SDict begin H.S end
 -2 2836 a -2 2836 a
SDict begin 13 H.A end
 -2 2836
a -2 2836 a
SDict begin [/View [/XYZ H.V]/Dest (0:1671) cvn /DEST pdfmark end
 -2 2836 a 396 2912 a Fk(Let')-5 b(s)21 b(tak)o(e)f(e)n(v)o
(erything)e(we')l(v)o(e)h(seen)h(so)h(f)o(ar)m(,)e(and)h(scale)h
(things)e(up.)h(Our)g(best)g(client)h(calls)f(us)h(ur)o(gently)d(and)i
(asks)g(for)396 3020 y(a)h(design)e(of)h(a)h(lar)o(ge)e(cloud)g
(computing)f(f)o(acility)-5 b(.)20 b(He)g(has)h(this)f(vision)g(of)g(a)
h(cloud)e(that)h(spans)g(man)o(y)f(data)i(centers,)396
3128 y(each)f(a)h(cluster)f(of)g(clients)g(and)g(w)o(ork)o(ers,)f(and)h
(that)g(w)o(orks)g(together)f(as)i(a)f(whole.)-2 3312
y
SDict begin H.S end
 -2 3312 a -2 3312 a
SDict begin 13 H.A end
 -2 3312 a -2 3312 a
SDict begin [/View [/XYZ H.V]/Dest (0:1672) cvn /DEST pdfmark end
 -2 3312 a 396
3402 a Fk(Because)h(we')l(re)e(smart)h(enough)f(to)h(kno)n(w)f(that)h
(practice)g(al)o(w)o(ays)h(beats)f(theory)-5 b(,)18 b(we)j(propose)d
(to)j(mak)o(e)e(a)i(w)o(orking)396 3510 y(simulation)f(using)f(\330MQ.)
h(Our)g(client,)g(eager)g(to)g(lock)g(do)n(wn)f(the)h(b)n(udget)f
(before)g(his)i(o)n(wn)e(boss)i(changes)e(his)i(mind,)396
3618 y(and)f(ha)n(ving)f(read)h(great)f(things)h(about)f(\330MQ)i(on)f
(T)-7 b(witter)m(,)19 b(agrees.)-2 3636 y
SDict begin H.S end
 -2 3636 a -2
3636 a
SDict begin 13 H.A end
 -2 3636 a -2 3636 a
SDict begin [/View [/XYZ H.V]/Dest (0:1673) cvn /DEST pdfmark end
 -2 3636 a 396 3946 a Fb(3.9.1.)36
b(Estab)o(lishing)e(the)g(Details)2074 3946 y
SDict begin H.S end
 2074 3946
a 2074 3946 a
SDict begin 18.72 H.A end
 2074 3946 a 2074 3946 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.5.2) cvn /DEST pdfmark end
 2074 3946 a -2
4138 a
SDict begin H.S end
 -2 4138 a -2 4138 a
SDict begin 13 H.A end
 -2 4138 a -2 4138 a
SDict begin [/View [/XYZ H.V]/Dest (0:1675) cvn /DEST pdfmark end
 -2 4138
a 396 4220 a Fk(Se)n(v)o(eral)20 b(espressos)g(later)m(,)g(we)g(w)o
(ant)h(to)f(jump)f(into)h(writing)g(code)f(b)n(ut)i(a)f(little)h(v)n
(oice)f(tells)h(us)g(to)f(get)g(more)g(details)396 4328
y(before)f(making)g(a)h(sensational)g(solution)g(to)g(entirely)f(the)h
(wrong)f(problem.)g("What)h(kind)f(of)h(w)o(ork)g(is)h(the)f(cloud)396
4436 y(doing?",)f(we)h(ask.)g(The)g(client)g(e)o(xplains:)-2
4454 y
SDict begin H.S end
 -2 4454 a -2 4454 a
SDict begin 13 H.A end
 -2 4454 a -2 4454 a
SDict begin [/View [/XYZ H.V]/Dest (0:1676) cvn /DEST pdfmark end
 -2 4454
a -2 4464 a
SDict begin H.S end
 -2 4464 a -2 4464 a
SDict begin 13 H.A end
 -2 4464 a -2 4464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1677) cvn /DEST pdfmark end
 -2
4464 a Black 396 4606 a Fj(\225)p Black 479 4606 a
SDict begin H.S end
 479
4606 a 479 4606 a
SDict begin 13 H.A end
 479 4606 a 479 4606 a
SDict begin [/View [/XYZ H.V]/Dest (0:1678) cvn /DEST pdfmark end
 479 4606 a Fk(W)-7
b(ork)o(ers)20 b(run)g(on)g(v)n(arious)f(kinds)g(of)h(hardw)o(are,)f(b)
n(ut)h(the)o(y)f(are)i(all)f(able)g(to)h(handle)e(an)o(y)g(task.)i
(There)e(are)h(se)n(v)o(eral)479 4714 y(hundred)e(w)o(ork)o(ers)i(per)f
(cluster)m(,)h(and)g(as)g(man)o(y)f(as)i(a)g(dozen)e(clusters)h(in)h
(total.)-2 4732 y
SDict begin H.S end
 -2 4732 a -2 4732 a
SDict begin 13 H.A end
 -2 4732 a -2 4732
a
SDict begin [/View [/XYZ H.V]/Dest (0:1679) cvn /DEST pdfmark end
 -2 4732 a Black 396 4863 a Fj(\225)p Black 479 4863
a
SDict begin H.S end
 479 4863 a 479 4863 a
SDict begin 13 H.A end
 479 4863 a 479 4863 a
SDict begin [/View [/XYZ H.V]/Dest (0:1680) cvn /DEST pdfmark end
 479 4863
a Fk(Clients)g(create)f(tasks)h(for)f(w)o(ork)o(ers.)f(Each)h(task)g
(is)h(an)f(independent)e(unit)i(of)g(w)o(ork)f(and)h(all)h(the)f
(client)g(w)o(ants)h(is)g(to)479 4971 y(\002nd)f(an)g(a)n(v)n(ailable)g
(w)o(ork)o(er)m(,)f(and)g(send)h(it)h(the)f(task,)h(as)g(soon)e(as)i
(possible.)f(There)f(will)i(be)f(a)h(lot)f(of)g(clients)h(and)479
5079 y(the)o(y')o(ll)f(come)f(and)h(go)g(arbitrarily)-5
b(.)-2 5097 y
SDict begin H.S end
 -2 5097 a -2 5097 a
SDict begin 13 H.A end
 -2 5097 a -2 5097 a
SDict begin [/View [/XYZ H.V]/Dest (0:1681) cvn /DEST pdfmark end

-2 5097 a Black 3759 5569 a Ff(124)p Black eop end
%%Page: 125 138
TeXDict begin 125 137 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.125) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1707) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black Black 396 72 a Fj(\225)p Black
479 72 a
SDict begin H.S end
 479 72 a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:1682) cvn /DEST pdfmark end
 479 72 a
Fk(The)20 b(real)g(dif)n(\002culty)f(is)j(to)e(be)g(able)g(to)g(add)g
(and)g(remo)o(v)o(e)e(clusters)i(at)h(an)o(y)e(time.)i(A)f(cluster)g
(can)g(lea)n(v)o(e)g(or)g(join)g(the)479 180 y(cloud)g(instantly)-5
b(,)19 b(bringing)f(all)j(its)g(w)o(ork)o(ers)e(and)h(clients)g(with)h
(it.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:1683) cvn /DEST pdfmark end
 -2
198 a Black 396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330
a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:1684) cvn /DEST pdfmark end
 479 330 a Fk(If)f(there)g(are)g(no)g(w)
o(ork)o(ers)f(in)i(their)f(o)n(wn)f(cluster)m(,)h(clients')g(tasks)h
(will)g(go)f(of)n(f)f(to)h(other)g(a)n(v)n(ailable)f(w)o(ork)o(ers)h
(in)g(the)479 438 y(cloud.)-2 439 y
SDict begin H.S end
 -2 439 a -2 439 a
SDict begin 13 H.A end

-2 439 a -2 439 a
SDict begin [/View [/XYZ H.V]/Dest (0:1685) cvn /DEST pdfmark end
 -2 439 a Black 396 587 a Fj(\225)p
Black 479 587 a
SDict begin H.S end
 479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587
a
SDict begin [/View [/XYZ H.V]/Dest (0:1686) cvn /DEST pdfmark end
 479 587 a Fk(Clients)h(send)f(out)g(one)g(task)g(at)h(a)g(time,)f(w)o
(aiting)g(for)f(a)i(reply)-5 b(.)19 b(If)h(the)o(y)f(don')o(t)g(get)h
(an)g(answer)g(within)g(X)g(seconds)479 695 y(the)o(y')o(ll)g(just)g
(send)g(out)g(the)g(task)h(again.)e(This)h(ain')o(t)g(our)f(concern,)f
(the)j(client)f(API)g(does)g(it)h(already)-5 b(.)-2 713
y
SDict begin H.S end
 -2 713 a -2 713 a
SDict begin 13 H.A end
 -2 713 a -2 713 a
SDict begin [/View [/XYZ H.V]/Dest (0:1687) cvn /DEST pdfmark end
 -2 713 a Black
396 845 a Fj(\225)p Black 479 845 a
SDict begin H.S end
 479 845 a 479 845
a
SDict begin 13 H.A end
 479 845 a 479 845 a
SDict begin [/View [/XYZ H.V]/Dest (0:1688) cvn /DEST pdfmark end
 479 845 a Fk(W)e(ork)o(ers)20 b(process)g(one)g
(task)g(at)h(a)g(time,)f(the)o(y)f(are)h(v)o(ery)f(simple)i(beasts.)f
(If)g(the)o(y)f(crash,)h(the)o(y)g(get)g(restarted)f(by)479
953 y(whate)n(v)o(er)g(script)h(started)g(them.)-2 1137
y
SDict begin H.S end
 -2 1137 a -2 1137 a
SDict begin 13 H.A end
 -2 1137 a -2 1137 a
SDict begin [/View [/XYZ H.V]/Dest (0:1689) cvn /DEST pdfmark end
 -2 1137 a 396
1226 a Fk(So)h(we)f(double)f(check)g(to)i(mak)o(e)e(sure)i(that)f(we)g
(understood)e(this)j(correctly:)-2 1244 y
SDict begin H.S end
 -2 1244 a -2
1244 a
SDict begin 13 H.A end
 -2 1244 a -2 1244 a
SDict begin [/View [/XYZ H.V]/Dest (0:1690) cvn /DEST pdfmark end
 -2 1244 a -2 1254 a
SDict begin H.S end
 -2 1254
a -2 1254 a
SDict begin 13 H.A end
 -2 1254 a -2 1254 a
SDict begin [/View [/XYZ H.V]/Dest (0:1691) cvn /DEST pdfmark end
 -2 1254 a Black 396 1397
a Fj(\225)p Black 479 1397 a
SDict begin H.S end
 479 1397 a 479 1397 a
SDict begin 13 H.A end
 479
1397 a 479 1397 a
SDict begin [/View [/XYZ H.V]/Dest (0:1692) cvn /DEST pdfmark end
 479 1397 a Fk("There)f(will)g(be)h(some)f(kind)f(of)h
(super)n(-duper)d(netw)o(ork)i(interconnect)g(between)g(clusters,)h
(right?",)f(we)i(ask.)f(The)479 1505 y(client)h(says,)f("Y)-8
b(es,)20 b(of)g(course,)f(we')l(re)h(not)g(idiots.")-2
1523 y
SDict begin H.S end
 -2 1523 a -2 1523 a
SDict begin 13 H.A end
 -2 1523 a -2 1523 a
SDict begin [/View [/XYZ H.V]/Dest (0:1693) cvn /DEST pdfmark end
 -2 1523
a Black 396 1654 a Fj(\225)p Black 479 1654 a
SDict begin H.S end
 479 1654
a 479 1654 a
SDict begin 13 H.A end
 479 1654 a 479 1654 a
SDict begin [/View [/XYZ H.V]/Dest (0:1694) cvn /DEST pdfmark end
 479 1654 a Fk("What)h(kind)e(of)h(v)
n(olumes)f(are)i(we)f(talking)g(about?",)e(we)j(ask.)f(The)g(client)g
(replies,)g("Up)g(to)g(a)h(thousand)e(clients)479 1762
y(per)h(cluster)m(,)g(each)f(doing)g(max.)h(ten)g(requests)g(per)g
(second.)f(Requests)h(are)g(small,)h(and)e(replies)h(are)h(also)f
(small,)g(no)479 1870 y(more)g(than)f(1K)i(bytes)f(each.")-2
2054 y
SDict begin H.S end
 -2 2054 a -2 2054 a
SDict begin 13 H.A end
 -2 2054 a -2 2054 a
SDict begin [/View [/XYZ H.V]/Dest (0:1695) cvn /DEST pdfmark end
 -2 2054
a 396 2144 a Fk(So)h(we)f(do)g(a)h(little)g(calculation)e(and)g(see)i
(that)f(this)h(will)g(w)o(ork)f(nicely)f(o)o(v)o(er)g(plain)h(TCP)-9
b(.)20 b(2,500)f(clients)h(x)h(10/second)396 2252 y(x)g(1,000)d(bytes)i
(x)g(2)h(directions)e(=)h(50MB/sec)g(or)g(400Mb/sec,)f(not)h(a)g
(problem)f(for)g(a)i(1Gb)f(netw)o(ork.)-2 2436 y
SDict begin H.S end
 -2 2436
a -2 2436 a
SDict begin 13 H.A end
 -2 2436 a -2 2436 a
SDict begin [/View [/XYZ H.V]/Dest (0:1696) cvn /DEST pdfmark end
 -2 2436 a 396 2526 a
Fk(It')-5 b(s)21 b(a)g(straight-forw)o(ard)c(problem)i(that)h(requires)
f(no)h(e)o(xotic)f(hardw)o(are)g(or)h(protocols,)e(just)j(some)f(cle)n
(v)o(er)f(routing)396 2634 y(algorithms)g(and)h(careful)f(design.)g(W)
-7 b(e)22 b(start)e(by)g(designing)f(one)g(cluster)i(\(one)e(data)h
(center\))f(and)h(then)f(we)i(\002gure)e(out)396 2742
y(ho)n(w)h(to)g(connect)f(clusters)i(together)-5 b(.)-2
2770 y
SDict begin H.S end
 -2 2770 a -2 2770 a
SDict begin 13 H.A end
 -2 2770 a -2 2770 a
SDict begin [/View [/XYZ H.V]/Dest (0:1697) cvn /DEST pdfmark end
 -2 2770
a 396 3080 a Fb(3.9.2.)36 b(Ar)n(c)o(hitecture)d(of)g(a)h(Single)g
(Cluster)2511 3080 y
SDict begin H.S end
 2511 3080 a 2511 3080 a
SDict begin 18.72 H.A end
 2511 3080
a 2511 3080 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.6.2) cvn /DEST pdfmark end
 2511 3080 a -2 3273 a
SDict begin H.S end
 -2 3273 a -2 3273
a
SDict begin 13 H.A end
 -2 3273 a -2 3273 a
SDict begin [/View [/XYZ H.V]/Dest (0:1699) cvn /DEST pdfmark end
 -2 3273 a 396 3354 a Fk(W)-7 b(ork)o(ers)20
b(and)g(clients)h(are)f(synchronous.)d(W)-7 b(e)21 b(w)o(ant)g(to)f
(use)g(the)h(LR)m(U)f(pattern)f(to)i(route)e(tasks)i(to)f(w)o(ork)o
(ers.)f(W)-7 b(ork)o(ers)396 3462 y(are)20 b(all)h(identical,)f(our)f
(f)o(acility)h(has)h(no)e(notion)g(of)h(dif)n(ferent)f(services.)h(W)-7
b(ork)o(ers)20 b(are)g(anon)o(ymous,)d(clients)k(ne)n(v)o(er)396
3570 y(address)f(them)g(directly)-5 b(.)19 b(W)-7 b(e)21
b(mak)o(e)f(no)f(attempt)h(here)g(to)g(pro)o(vide)e(guaranteed)g(deli)n
(v)o(ery)-5 b(,)18 b(retry)-5 b(,)19 b(etc.)-2 3754 y
SDict begin H.S end

-2 3754 a -2 3754 a
SDict begin 13 H.A end
 -2 3754 a -2 3754 a
SDict begin [/View [/XYZ H.V]/Dest (0:1700) cvn /DEST pdfmark end
 -2 3754 a 396
3844 a Fk(F)o(or)h(reasons)g(we)g(already)f(look)o(ed)g(at,)i(clients)f
(and)g(w)o(ork)o(ers)g(w)o(on')o(t)f(speak)g(to)i(each)f(other)f
(directly)-5 b(.)19 b(It)h(mak)o(es)g(it)396 3952 y(impossible)g(to)g
(add)g(or)g(remo)o(v)o(e)e(nodes)h(dynamically)-5 b(.)18
b(So)i(our)g(basic)g(model)g(consists)g(of)g(the)g(request-reply)396
4060 y(message)g(brok)o(er)f(we)h(sa)o(w)h(earlier\()p
0 TeXcolorgray 1442 4060 a
SDict begin H.S end
 1442 4060 a Fk(Figure)d(3-20)1832
4060 y
SDict begin 13 H.L end
 1832 4060 a 1832 4060 a
SDict begin [/Subtype /Link/Dest (0:figure-46) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1832 4060 a Black -2 w
Fk(\).)-2 4078 y
SDict begin H.S end
 -2 4078 a -2 4078 a
SDict begin 13 H.A end
 -2 4078 a -2 4078
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-46) cvn /DEST pdfmark
end
 -2 4078 a Black 3759 5569 a Ff(125)p Black eop end
%%Page: 126 139
TeXDict begin 126 138 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.126) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1715) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-20.)e(Cluster)j
(Ar)o(chitectur)o(e)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172
a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1704) cvn /DEST pdfmark end
 -2 172 a 396 3414 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3414 a @beginspecial
0 @llx -384 @lly 304 @urx 0 @ury 3040 @rwi @setspecial
%%BeginDocument: images/fig46.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -384 304 0
%%HiResBoundingBox: 0.0 -384.0 304.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -32.40024185180664 moveto
22.400239944458008 -54.40024185180664 lineto
94.40023803710938 -54.40024185180664 lineto
94.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -32.40024185180664 moveto
118.40023803710938 -54.40024185180664 lineto
190.40023803710938 -54.40024185180664 lineto
190.40023803710938 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -32.40024185180664 moveto
214.40023803710938 -54.40024185180664 lineto
286.4002380371094 -54.40024185180664 lineto
286.4002380371094 -32.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -57.40024185180664 moveto
22.400239944458008 -80.40023803710938 lineto
94.40023803710938 -80.40023803710938 lineto
94.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -57.40024185180664 moveto
118.40023803710938 -80.40023803710938 lineto
190.40023803710938 -80.40023803710938 lineto
190.40023803710938 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -57.40024185180664 moveto
214.40023803710938 -80.40023803710938 lineto
286.4002380371094 -80.40023803710938 lineto
286.4002380371094 -57.40024185180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
102.40023803710938 -152.40023803710938 moveto
102.40023803710938 -174.40023803710938 lineto
206.40023803710938 -174.40023803710938 lineto
206.40023803710938 -152.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
102.40023803710938 -177.40023803710938 moveto
102.40023803710938 -198.40023803710938 lineto
206.40023803710938 -198.40023803710938 lineto
206.40023803710938 -177.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
102.40023803710938 -201.40023803710938 moveto
102.40023803710938 -224.40023803710938 lineto
206.40023803710938 -224.40023803710938 lineto
206.40023803710938 -201.40023803710938 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -308.4002380371094 moveto
22.400239944458008 -330.4002380371094 lineto
94.40023803710938 -330.4002380371094 lineto
94.40023803710938 -308.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -308.4002380371094 moveto
118.40023803710938 -330.4002380371094 lineto
190.40023803710938 -330.4002380371094 lineto
190.40023803710938 -308.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -308.4002380371094 moveto
214.40023803710938 -330.4002380371094 lineto
286.4002380371094 -330.4002380371094 lineto
286.4002380371094 -308.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
22.400239944458008 -333.4002380371094 moveto
22.400239944458008 -356.4002380371094 lineto
94.40023803710938 -356.4002380371094 lineto
94.40023803710938 -333.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
118.40023803710938 -333.4002380371094 moveto
118.40023803710938 -356.4002380371094 lineto
190.40023803710938 -356.4002380371094 lineto
190.40023803710938 -333.4002380371094 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
214.40023803710938 -333.4002380371094 moveto
214.40023803710938 -356.4002380371094 lineto
286.4002380371094 -356.4002380371094 lineto
286.4002380371094 -333.4002380371094 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
20.0 -30.0 moveto
20.0 -52.0 lineto
92.0 -52.0 lineto
92.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -30.0 moveto
116.0 -52.0 lineto
188.0 -52.0 lineto
188.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -30.0 moveto
212.0 -52.0 lineto
284.0 -52.0 lineto
284.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -55.0 moveto
20.0 -78.0 lineto
92.0 -78.0 lineto
92.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -55.0 moveto
116.0 -78.0 lineto
188.0 -78.0 lineto
188.0 -55.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -55.0 moveto
212.0 -78.0 lineto
284.0 -78.0 lineto
284.0 -55.0 lineto
closepath
stroke
0.8 setlinewidth
0 setlinecap
[4.0] 0.0 setdash
newpath
20.0 -126.0 moveto
20.0 -246.0 lineto
284.0 -246.0 lineto
284.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -150.0 moveto
100.0 -172.0 lineto
204.0 -172.0 lineto
204.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.8 setlinewidth
1 setlinecap
[] 0 setdash
newpath
100.0 -150.0 moveto
100.0 -172.0 lineto
204.0 -172.0 lineto
204.0 -150.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -175.0 moveto
100.0 -196.0 lineto
204.0 -196.0 lineto
204.0 -175.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -175.0 moveto
100.0 -196.0 lineto
204.0 -196.0 lineto
204.0 -175.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
100.0 -199.0 moveto
100.0 -222.0 lineto
204.0 -222.0 lineto
204.0 -199.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
100.0 -199.0 moveto
100.0 -222.0 lineto
204.0 -222.0 lineto
204.0 -199.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -306.0 moveto
20.0 -328.0 lineto
92.0 -328.0 lineto
92.0 -306.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -306.0 moveto
20.0 -328.0 lineto
92.0 -328.0 lineto
92.0 -306.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -306.0 moveto
116.0 -328.0 lineto
188.0 -328.0 lineto
188.0 -306.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -306.0 moveto
116.0 -328.0 lineto
188.0 -328.0 lineto
188.0 -306.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -306.0 moveto
212.0 -328.0 lineto
284.0 -328.0 lineto
284.0 -306.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -306.0 moveto
212.0 -328.0 lineto
284.0 -328.0 lineto
284.0 -306.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
20.0 -331.0 moveto
20.0 -354.0 lineto
92.0 -354.0 lineto
92.0 -331.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
20.0 -331.0 moveto
20.0 -354.0 lineto
92.0 -354.0 lineto
92.0 -331.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
116.0 -331.0 moveto
116.0 -354.0 lineto
188.0 -354.0 lineto
188.0 -331.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
116.0 -331.0 moveto
116.0 -354.0 lineto
188.0 -354.0 lineto
188.0 -331.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -331.0 moveto
212.0 -354.0 lineto
284.0 -354.0 lineto
284.0 -331.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -331.0 moveto
212.0 -354.0 lineto
284.0 -354.0 lineto
284.0 -331.0 lineto
closepath
stroke
newpath
148.0 -132.0 moveto
148.0 -150.0 lineto
stroke
newpath
148.0 -222.0 moveto
148.0 -239.0 lineto
stroke
newpath
52.0 -78.0 moveto
52.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -78.0 moveto
148.0 -102.0 lineto
stroke
newpath
244.0 -78.0 moveto
244.0 -102.0 lineto
148.0 -102.0 lineto
stroke
newpath
148.0 -114.0 moveto
148.0 -102.0 lineto
stroke
newpath
148.0 -258.0 moveto
148.0 -282.0 lineto
stroke
newpath
52.0 -306.0 moveto
52.0 -282.0 lineto
148.0 -282.0 lineto
stroke
newpath
148.0 -306.0 moveto
148.0 -282.0 lineto
stroke
newpath
244.0 -306.0 moveto
244.0 -282.0 lineto
148.0 -282.0 lineto
stroke
/Helvetica findfont
13 scalefont setfont
35.0 -47.0 moveto
(Client) show
131.0 -47.0 moveto
(Client) show
227.0 -47.0 moveto
(Client) show
41.0 -70.0 moveto
(REQ) show
137.0 -70.0 moveto
(REQ) show
233.0 -70.0 moveto
(REQ) show
130.0 -166.0 moveto
(ROUTER) show
113.0 -190.0 moveto
(LRU Queue) show
130.0 -214.0 moveto
(ROUTER) show
225.0 -238.0 moveto
(Broker) show
41.0 -322.0 moveto
(REQ) show
137.0 -322.0 moveto
(REQ) show
233.0 -322.0 moveto
(REQ) show
33.0 -346.0 moveto
(Worker) show
129.0 -346.0 moveto
(Worker) show
225.0 -346.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3414 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3414 a -2 3497 a
SDict begin H.S end
 -2 3497
a -2 3497 a
SDict begin 13 H.A end
 -2 3497 a -2 3497 a
SDict begin [/View [/XYZ H.V]/Dest (0:1707) cvn /DEST pdfmark end
 -2 3497 a 396 3825 a
Fb(3.9.3.)36 b(Scaling)e(to)f(Multiple)h(Cluster)n(s)2293
3825 y
SDict begin H.S end
 2293 3825 a 2293 3825 a
SDict begin 18.72 H.A end
 2293 3825 a 2293 3825
a
SDict begin [/View [/XYZ H.V]/Dest (8.54.7.2) cvn /DEST pdfmark end
 2293 3825 a -2 4018 a
SDict begin H.S end
 -2 4018 a -2 4018 a
SDict begin 13 H.A end
 -2 4018 a
-2 4018 a
SDict begin [/View [/XYZ H.V]/Dest (0:1709) cvn /DEST pdfmark end
 -2 4018 a 396 4099 a Fk(No)n(w)20 b(we)h(scale)g(this)f(out)g
(to)h(more)e(than)h(one)f(cluster)-5 b(.)21 b(Each)e(cluster)h(has)h(a)
f(set)h(of)f(clients)h(and)e(w)o(ork)o(ers,)h(and)f(a)396
4207 y(brok)o(er)g(that)h(joins)g(these)h(together:)-2
4225 y
SDict begin H.S end
 -2 4225 a -2 4225 a
SDict begin 13 H.A end
 -2 4225 a -2 4225 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-47) cvn /DEST pdfmark
end
 -2 4225
a Black 3757 5569 a Ff(126)p Black eop end
%%Page: 127 140
TeXDict begin 127 139 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.127) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1730) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-21.)e(Multiple)k
(Clusters)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172
a
SDict begin [/View [/XYZ H.V]/Dest (0:1712) cvn /DEST pdfmark end
 -2 172 a 396 1614 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1614 a @beginspecial 0 @llx
-168 @lly 318 @urx 0 @ury 3180 @rwi @setspecial
%%BeginDocument: images/fig47.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -168 318 0
%%HiResBoundingBox: 0.0 -168.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -45.80017852783203 moveto
16.800180435180664 -61.80017852783203 lineto
40.80017852783203 -61.80017852783203 lineto
40.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -45.80017852783203 moveto
58.80017852783203 -61.80017852783203 lineto
82.80017852783203 -61.80017852783203 lineto
82.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
100.80017852783203 -45.80017852783203 moveto
100.80017852783203 -61.80017852783203 lineto
124.80017852783203 -61.80017852783203 lineto
124.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -85.80017852783203 moveto
16.800180435180664 -101.80017852783203 lineto
124.80017852783203 -101.80017852783203 lineto
124.80017852783203 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -125.80017852783203 moveto
16.800180435180664 -141.80018615722656 lineto
40.80017852783203 -141.80018615722656 lineto
40.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -125.80017852783203 moveto
58.80017852783203 -141.80018615722656 lineto
82.80017852783203 -141.80018615722656 lineto
82.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
100.80017852783203 -125.80017852783203 moveto
100.80017852783203 -141.80018615722656 lineto
124.80017852783203 -141.80018615722656 lineto
124.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -45.80017852783203 moveto
196.80018615722656 -61.80017852783203 lineto
220.80018615722656 -61.80017852783203 lineto
220.80018615722656 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
238.80018615722656 -45.80017852783203 moveto
238.80018615722656 -61.80017852783203 lineto
262.8001708984375 -61.80017852783203 lineto
262.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
280.8001708984375 -45.80017852783203 moveto
280.8001708984375 -61.80017852783203 lineto
304.8001708984375 -61.80017852783203 lineto
304.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -85.80017852783203 moveto
196.80018615722656 -101.80017852783203 lineto
304.8001708984375 -101.80017852783203 lineto
304.8001708984375 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -125.80017852783203 moveto
196.80018615722656 -141.80018615722656 lineto
220.80018615722656 -141.80018615722656 lineto
220.80018615722656 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
238.80018615722656 -125.80017852783203 moveto
238.80018615722656 -141.80018615722656 lineto
262.8001708984375 -141.80018615722656 lineto
262.8001708984375 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
280.8001708984375 -125.80017852783203 moveto
280.8001708984375 -141.80018615722656 lineto
304.8001708984375 -141.80018615722656 lineto
304.8001708984375 -125.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
99.0 -44.0 moveto
99.0 -60.0 lineto
123.0 -60.0 lineto
123.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
99.0 -44.0 moveto
99.0 -60.0 lineto
123.0 -60.0 lineto
123.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
99.0 -124.0 moveto
99.0 -140.0 lineto
123.0 -140.0 lineto
123.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
99.0 -124.0 moveto
99.0 -140.0 lineto
123.0 -140.0 lineto
123.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -44.0 moveto
195.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -44.0 moveto
195.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
237.0 -44.0 moveto
237.0 -60.0 lineto
261.0 -60.0 lineto
261.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
237.0 -44.0 moveto
237.0 -60.0 lineto
261.0 -60.0 lineto
261.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
279.0 -44.0 moveto
279.0 -60.0 lineto
303.0 -60.0 lineto
303.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
279.0 -44.0 moveto
279.0 -60.0 lineto
303.0 -60.0 lineto
303.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -84.0 moveto
195.0 -100.0 lineto
303.0 -100.0 lineto
303.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -84.0 moveto
195.0 -100.0 lineto
303.0 -100.0 lineto
303.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -124.0 moveto
195.0 -140.0 lineto
219.0 -140.0 lineto
219.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -124.0 moveto
195.0 -140.0 lineto
219.0 -140.0 lineto
219.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
237.0 -124.0 moveto
237.0 -140.0 lineto
261.0 -140.0 lineto
261.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
237.0 -124.0 moveto
237.0 -140.0 lineto
261.0 -140.0 lineto
261.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
279.0 -124.0 moveto
279.0 -140.0 lineto
303.0 -140.0 lineto
303.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
279.0 -124.0 moveto
279.0 -140.0 lineto
303.0 -140.0 lineto
303.0 -124.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
159.0 -16.0 moveto
159.0 -152.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
27.0 -60.0 moveto
27.0 -84.0 lineto
stroke
newpath
69.0 -60.0 moveto
69.0 -84.0 lineto
stroke
newpath
111.0 -60.0 moveto
111.0 -84.0 lineto
stroke
newpath
27.0 -100.0 moveto
27.0 -124.0 lineto
stroke
newpath
69.0 -100.0 moveto
69.0 -124.0 lineto
stroke
newpath
111.0 -100.0 moveto
111.0 -124.0 lineto
stroke
newpath
207.0 -60.0 moveto
207.0 -84.0 lineto
stroke
newpath
249.0 -60.0 moveto
249.0 -84.0 lineto
stroke
newpath
291.0 -60.0 moveto
291.0 -84.0 lineto
stroke
newpath
207.0 -100.0 moveto
207.0 -124.0 lineto
stroke
newpath
249.0 -100.0 moveto
249.0 -124.0 lineto
stroke
newpath
291.0 -100.0 moveto
291.0 -124.0 lineto
stroke
/Helvetica findfont
8 scalefont setfont
48.0 -23.0 moveto
(Cluster 1) show
228.0 -23.0 moveto
(Cluster 2) show
26.0 -55.0 moveto
(C ) show
68.0 -55.0 moveto
(C ) show
110.0 -55.0 moveto
(C ) show
206.0 -55.0 moveto
(C ) show
248.0 -55.0 moveto
(C ) show
290.0 -55.0 moveto
(C ) show
51.0 -95.0 moveto
(Broker) show
231.0 -95.0 moveto
(Broker) show
24.0 -135.0 moveto
(W ) show
66.0 -135.0 moveto
(W ) show
108.0 -135.0 moveto
(W ) show
204.0 -135.0 moveto
(W ) show
246.0 -135.0 moveto
(W ) show
288.0 -135.0 moveto
(W ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1614 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1614 a 274 x Fk(The)e(question)f(is:)i(ho)n
(w)f(do)g(we)g(get)h(the)f(clients)g(of)g(each)g(cluster)g(talking)g
(to)g(the)g(w)o(ork)o(ers)g(of)g(the)g(other)f(cluster?)396
1996 y(There)h(are)g(a)g(fe)n(w)g(possibilities,)h(each)f(with)g(pros)g
(and)f(cons:)-2 2014 y
SDict begin H.S end
 -2 2014 a -2 2014 a
SDict begin 13 H.A end
 -2 2014 a
-2 2014 a
SDict begin [/View [/XYZ H.V]/Dest (0:1716) cvn /DEST pdfmark end
 -2 2014 a -2 2024 a
SDict begin H.S end
 -2 2024 a -2 2024 a
SDict begin 13 H.A end
 -2
2024 a -2 2024 a
SDict begin [/View [/XYZ H.V]/Dest (0:1717) cvn /DEST pdfmark end
 -2 2024 a Black 396 2166 a Fj(\225)p
Black 479 2166 a
SDict begin H.S end
 479 2166 a 479 2166 a
SDict begin 13 H.A end
 479 2166 a 479
2166 a
SDict begin [/View [/XYZ H.V]/Dest (0:1718) cvn /DEST pdfmark end
 479 2166 a Fk(Clients)i(could)f(connect)f(directly)g(to)h(both)g
(brok)o(ers.)e(The)i(adv)n(antage)e(is)j(that)g(we)f(don')o(t)f(need)g
(to)i(modify)d(brok)o(ers)479 2274 y(or)i(w)o(ork)o(ers.)f(But)i
(clients)g(get)f(more)f(comple)o(x,)f(and)i(become)f(a)o(w)o(are)h(of)g
(the)g(o)o(v)o(erall)f(topology)-5 b(.)17 b(If)j(we)h(w)o(ant)f(to)479
2382 y(add,)g(e.g.)f(a)i(third)f(or)f(forth)h(cluster)m(,)f(all)i(the)f
(clients)h(are)f(af)n(fected.)e(In)i(ef)n(fect)g(we)h(ha)n(v)o(e)e(to)i
(mo)o(v)o(e)d(routing)h(and)479 2490 y(f)o(ail-o)o(v)o(er)g(logic)g
(into)h(the)h(clients)f(and)g(that')-5 b(s)20 b(not)g(nice.)-2
2508 y
SDict begin H.S end
 -2 2508 a -2 2508 a
SDict begin 13 H.A end
 -2 2508 a -2 2508 a
SDict begin [/View [/XYZ H.V]/Dest (0:1719) cvn /DEST pdfmark end
 -2 2508
a Black 396 2639 a Fj(\225)p Black 479 2639 a
SDict begin H.S end
 479 2639
a 479 2639 a
SDict begin 13 H.A end
 479 2639 a 479 2639 a
SDict begin [/View [/XYZ H.V]/Dest (0:1720) cvn /DEST pdfmark end
 479 2639 a Fk(W)-7
b(ork)o(ers)20 b(might)g(connect)f(directly)g(to)i(both)e(brok)o(ers.)g
(But)h(REQ)h(w)o(ork)o(ers)f(can')o(t)f(do)h(that,)g(the)o(y)f(can)h
(only)g(reply)f(to)479 2747 y(one)h(brok)o(er)-5 b(.)19
b(W)-7 b(e)21 b(might)f(use)g(REPs)h(b)n(ut)g(REPs)g(don')o(t)d(gi)n(v)
o(e)i(us)g(customizable)f(brok)o(er)n(-to-w)o(ork)o(er)d(routing)j(lik)
o(e)479 2855 y(LR)m(U,)i(only)e(the)h(b)n(uilt-in)g(load)f(balancing.)g
(That')-5 b(s)20 b(a)h(f)o(ail,)f(if)g(we)h(w)o(ant)f(to)h(distrib)n
(ute)e(w)o(ork)h(to)g(idle)h(w)o(ork)o(ers:)e(we)479
2963 y(precisely)h(need)f(LR)m(U.)h(One)h(solution)e(w)o(ould)g(be)h
(to)h(use)f(R)m(OUTER)h(sock)o(ets)f(for)g(the)g(w)o(ork)o(er)f(nodes.)
g(Let')-5 b(s)21 b(label)479 3071 y(this)g("Idea)f(#1".)-2
3072 y
SDict begin H.S end
 -2 3072 a -2 3072 a
SDict begin 13 H.A end
 -2 3072 a -2 3072 a
SDict begin [/View [/XYZ H.V]/Dest (0:1721) cvn /DEST pdfmark end
 -2 3072
a Black 396 3220 a Fj(\225)p Black 479 3220 a
SDict begin H.S end
 479 3220
a 479 3220 a
SDict begin 13 H.A end
 479 3220 a 479 3220 a
SDict begin [/View [/XYZ H.V]/Dest (0:1722) cvn /DEST pdfmark end
 479 3220 a Fk(Brok)o(ers)g(could)f
(connect)g(to)i(each)e(other)-5 b(.)20 b(This)g(looks)g(neatest)g
(because)g(it)h(creates)f(the)g(fe)n(west)h(additional)479
3328 y(connections.)d(W)-7 b(e)22 b(can')o(t)d(add)h(clusters)g(on)g
(the)g(\003y)g(b)n(ut)h(that)f(is)h(probably)d(out)i(of)g(scope.)f(No)n
(w)h(clients)h(and)479 3436 y(w)o(ork)o(ers)f(remain)f(ignorant)g(of)g
(the)i(real)f(netw)o(ork)f(topology)-5 b(,)17 b(and)j(brok)o(ers)f
(tell)i(each)e(other)h(when)f(the)o(y)h(ha)n(v)o(e)479
3544 y(spare)g(capacity)-5 b(.)19 b(Let')-5 b(s)21 b(label)f(this)h
("Idea)e(#2".)-2 3728 y
SDict begin H.S end
 -2 3728 a -2 3728 a
SDict begin 13 H.A end
 -2 3728 a
-2 3728 a
SDict begin [/View [/XYZ H.V]/Dest (0:1723) cvn /DEST pdfmark end
 -2 3728 a 396 3818 a Fk(Let')-5 b(s)21 b(e)o(xplore)d(Idea)i
(#1.)f(In)h(this)h(model)e(we)h(ha)n(v)o(e)g(w)o(ork)o(ers)f
(connecting)f(to)i(both)g(brok)o(ers)e(and)i(accepting)f(jobs)h(from)
396 3926 y(either\()p 0 TeXcolorgray 614 3926 a
SDict begin H.S end
 614 3926
a Fk(Figure)e(3-22)1004 3926 y
SDict begin 13 H.L end
 1004 3926 a 1004 3926
a
SDict begin [/Subtype /Link/Dest (0:figure-48) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1004 3926 a Black -1 w Fk(\).)-2 3944 y
SDict begin H.S end
 -2 3944 a -2
3944 a
SDict begin 13 H.A end
 -2 3944 a -2 3944 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-48) cvn /DEST pdfmark
end
 -2 3944 a Black 3756 5569
a Ff(127)p Black eop end
%%Page: 128 141
TeXDict begin 128 140 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.128) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-22.)e(Idea)j(1)f(-)h(Cr)
o(oss-connected)e(W)-6 b(ork)o(ers)-2 172 y
SDict begin H.S end
 -2 172 a
-2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1727) cvn /DEST pdfmark end
 -2 172 a 396 1497 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1497
a @beginspecial 0 @llx -154 @lly 285 @urx 0 @ury 2850
@rwi @setspecial
%%BeginDocument: images/fig48.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -154 285 0
%%HiResBoundingBox: 0.0 -154.0 285.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
63.50014877319336 -46.50014877319336 moveto
63.50014877319336 -60.50014877319336 lineto
128.50015258789062 -60.50014877319336 lineto
128.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.50015258789062 -46.50014877319336 moveto
208.50015258789062 -60.50014877319336 lineto
273.5001525878906 -60.50014877319336 lineto
273.5001525878906 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -109.50015258789062 moveto
13.500149726867676 -122.50015258789062 lineto
58.50014877319336 -122.50015258789062 lineto
58.50014877319336 -109.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
73.50015258789062 -109.50015258789062 moveto
73.50015258789062 -122.50015258789062 lineto
118.50015258789062 -122.50015258789062 lineto
118.50015258789062 -109.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -109.50015258789062 moveto
133.50015258789062 -122.50015258789062 lineto
178.50015258789062 -122.50015258789062 lineto
178.50015258789062 -109.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -124.50015258789062 moveto
13.500149726867676 -137.50015258789062 lineto
58.50014877319336 -137.50015258789062 lineto
58.50014877319336 -124.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
73.50015258789062 -124.50015258789062 moveto
73.50015258789062 -137.50015258789062 lineto
118.50015258789062 -137.50015258789062 lineto
118.50015258789062 -124.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -124.50015258789062 moveto
133.50015258789062 -137.50015258789062 lineto
178.50015258789062 -137.50015258789062 lineto
178.50015258789062 -124.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
127.0 -59.0 lineto
127.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -45.0 moveto
62.0 -59.0 lineto
127.0 -59.0 lineto
127.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -45.0 moveto
207.0 -59.0 lineto
272.0 -59.0 lineto
272.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -45.0 moveto
207.0 -59.0 lineto
272.0 -59.0 lineto
272.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -108.0 moveto
12.0 -121.0 lineto
57.0 -121.0 lineto
57.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -108.0 moveto
12.0 -121.0 lineto
57.0 -121.0 lineto
57.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
72.0 -108.0 moveto
72.0 -121.0 lineto
117.0 -121.0 lineto
117.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
72.0 -108.0 moveto
72.0 -121.0 lineto
117.0 -121.0 lineto
117.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -108.0 moveto
132.0 -121.0 lineto
177.0 -121.0 lineto
177.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -108.0 moveto
132.0 -121.0 lineto
177.0 -121.0 lineto
177.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -123.0 moveto
12.0 -136.0 lineto
57.0 -136.0 lineto
57.0 -123.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -123.0 moveto
12.0 -136.0 lineto
57.0 -136.0 lineto
57.0 -123.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
72.0 -123.0 moveto
72.0 -136.0 lineto
117.0 -136.0 lineto
117.0 -123.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
72.0 -123.0 moveto
72.0 -136.0 lineto
117.0 -136.0 lineto
117.0 -123.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -123.0 moveto
132.0 -136.0 lineto
177.0 -136.0 lineto
177.0 -123.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -123.0 moveto
132.0 -136.0 lineto
177.0 -136.0 lineto
177.0 -123.0 lineto
closepath
stroke
0.5 setlinewidth
0 setlinecap
[2.0] 0.0 setdash
newpath
167.0 -14.0 moveto
167.0 -35.0 lineto
stroke
newpath
90.0 -73.0 moveto
42.0 -73.0 lineto
42.0 -84.0 lineto
stroke
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
62.0 -35.0 moveto
62.0 -45.0 lineto
stroke
newpath
127.0 -35.0 moveto
127.0 -45.0 lineto
stroke
newpath
207.0 -35.0 moveto
207.0 -45.0 lineto
stroke
newpath
272.0 -35.0 moveto
272.0 -45.0 lineto
stroke
0.5 setlinewidth
0 setlinecap
[2.0] 0.0 setdash
newpath
42.0 -91.0 moveto
42.0 -108.0 lineto
stroke
newpath
102.0 -91.0 moveto
102.0 -108.0 lineto
stroke
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
92.0 -59.0 moveto
92.0 -87.0 lineto
stroke
newpath
32.0 -108.0 moveto
32.0 -87.0 lineto
92.0 -87.0 lineto
stroke
newpath
92.0 -108.0 moveto
92.0 -87.0 lineto
stroke
newpath
152.0 -108.0 moveto
152.0 -87.0 lineto
92.0 -87.0 lineto
stroke
newpath
237.0 -59.0 moveto
237.0 -73.0 lineto
162.0 -73.0 lineto
stroke
newpath
97.0 -73.0 moveto
102.0 -73.0 lineto
stroke
0.5 setlinewidth
0 setlinecap
[2.0] 0.0 setdash
newpath
102.0 -80.0 moveto
102.0 -73.0 lineto
stroke
newpath
162.0 -108.0 moveto
162.0 -73.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
75.0 -21.0 moveto
(Cluster 1) show
220.0 -21.0 moveto
(Cluster 2) show
81.0 -55.0 moveto
(ROUTER) show
226.0 -55.0 moveto
(ROUTER) show
21.0 -118.0 moveto
(ROUTER) show
81.0 -118.0 moveto
(ROUTER) show
141.0 -118.0 moveto
(ROUTER) show
21.0 -133.0 moveto
(Worker) show
81.0 -133.0 moveto
(Worker) show
141.0 -133.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1497 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1497 a 274 x Fk(It)21 b(looks)e(feasible.)h
(Ho)n(we)n(v)o(er)f(it)i(doesn')o(t)d(pro)o(vide)g(what)j(we)f(w)o
(anted,)g(which)f(w)o(as)i(that)g(clients)f(get)g(local)g(w)o(ork)o
(ers)g(if)396 1879 y(possible)g(and)g(remote)f(w)o(ork)o(ers)h(only)f
(if)h(it')-5 b(s)22 b(better)e(than)f(w)o(aiting.)h(Also)h(w)o(ork)o
(ers)e(will)i(signal)f("ready")f(to)h(both)396 1987 y(brok)o(ers)f(and)
h(can)g(get)g(tw)o(o)g(jobs)h(at)f(once,)g(while)g(other)f(w)o(ork)o
(ers)h(remain)f(idle.)h(It)g(seems)h(this)g(design)e(f)o(ails)i
(because)396 2095 y(again)e(we')l(re)h(putting)f(routing)g(logic)g(at)i
(the)f(edges.)-2 2279 y
SDict begin H.S end
 -2 2279 a -2 2279 a
SDict begin 13 H.A end
 -2 2279 a
-2 2279 a
SDict begin [/View [/XYZ H.V]/Dest (0:1731) cvn /DEST pdfmark end
 -2 2279 a 396 2369 a Fk(So)g(idea)g(#2)f(then.)h(W)-7
b(e)21 b(interconnect)c(the)j(brok)o(ers)f(and)g(don')o(t)f(touch)h
(the)h(clients)g(or)g(w)o(ork)o(ers,)f(which)g(are)h(REQs)g(lik)o(e)396
2477 y(we')l(re)g(used)g(to\()p 0 TeXcolorgray 868 2477
a
SDict begin H.S end
 868 2477 a Fk(Figure)f(3-23)1259 2477 y
SDict begin 13 H.L end
 1259 2477 a
1259 2477 a
SDict begin [/Subtype /Link/Dest (0:figure-49) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1259 2477 a Black -2 w Fk(\).)-2 2495 y
SDict begin H.S end
 -2
2495 a -2 2495 a
SDict begin 13 H.A end
 -2 2495 a -2 2495 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-49) cvn /DEST pdfmark
end
 -2 2495 a 396 2678
a Fg(Figur)o(e)h(3-23.)e(Idea)j(2)f(-)h(Br)o(ok)o(ers)f(T)-8
b(alking)21 b(to)f(Each)h(Other)-2 2778 y
SDict begin H.S end
 -2 2778 a -2
2778 a
SDict begin 13 H.A end
 -2 2778 a -2 2778 a
SDict begin [/View [/XYZ H.V]/Dest (0:1735) cvn /DEST pdfmark end
 -2 2778 a 396 4220 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4220
a @beginspecial 0 @llx -168 @lly 318 @urx 0 @ury 3180
@rwi @setspecial
%%BeginDocument: images/fig49.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -168 318 0
%%HiResBoundingBox: 0.0 -168.0 318.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -45.80017852783203 moveto
16.800180435180664 -61.80017852783203 lineto
40.80017852783203 -61.80017852783203 lineto
40.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -45.80017852783203 moveto
58.80017852783203 -61.80017852783203 lineto
82.80017852783203 -61.80017852783203 lineto
82.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
100.80017852783203 -45.80017852783203 moveto
100.80017852783203 -61.80017852783203 lineto
124.80017852783203 -61.80017852783203 lineto
124.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -85.80017852783203 moveto
16.800180435180664 -101.80017852783203 lineto
124.80017852783203 -101.80017852783203 lineto
124.80017852783203 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -125.80017852783203 moveto
16.800180435180664 -141.80018615722656 lineto
40.80017852783203 -141.80018615722656 lineto
40.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -125.80017852783203 moveto
58.80017852783203 -141.80018615722656 lineto
82.80017852783203 -141.80018615722656 lineto
82.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
100.80017852783203 -125.80017852783203 moveto
100.80017852783203 -141.80018615722656 lineto
124.80017852783203 -141.80018615722656 lineto
124.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -45.80017852783203 moveto
196.80018615722656 -61.80017852783203 lineto
220.80018615722656 -61.80017852783203 lineto
220.80018615722656 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
238.80018615722656 -45.80017852783203 moveto
238.80018615722656 -61.80017852783203 lineto
262.8001708984375 -61.80017852783203 lineto
262.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
280.8001708984375 -45.80017852783203 moveto
280.8001708984375 -61.80017852783203 lineto
304.8001708984375 -61.80017852783203 lineto
304.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -85.80017852783203 moveto
196.80018615722656 -101.80017852783203 lineto
304.8001708984375 -101.80017852783203 lineto
304.8001708984375 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.80018615722656 -125.80017852783203 moveto
196.80018615722656 -141.80018615722656 lineto
220.80018615722656 -141.80018615722656 lineto
220.80018615722656 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
238.80018615722656 -125.80017852783203 moveto
238.80018615722656 -141.80018615722656 lineto
262.8001708984375 -141.80018615722656 lineto
262.8001708984375 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
280.8001708984375 -125.80017852783203 moveto
280.8001708984375 -141.80018615722656 lineto
304.8001708984375 -141.80018615722656 lineto
304.8001708984375 -125.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
99.0 -44.0 moveto
99.0 -60.0 lineto
123.0 -60.0 lineto
123.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
99.0 -44.0 moveto
99.0 -60.0 lineto
123.0 -60.0 lineto
123.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
99.0 -124.0 moveto
99.0 -140.0 lineto
123.0 -140.0 lineto
123.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
99.0 -124.0 moveto
99.0 -140.0 lineto
123.0 -140.0 lineto
123.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -44.0 moveto
195.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -44.0 moveto
195.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
237.0 -44.0 moveto
237.0 -60.0 lineto
261.0 -60.0 lineto
261.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
237.0 -44.0 moveto
237.0 -60.0 lineto
261.0 -60.0 lineto
261.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
279.0 -44.0 moveto
279.0 -60.0 lineto
303.0 -60.0 lineto
303.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
279.0 -44.0 moveto
279.0 -60.0 lineto
303.0 -60.0 lineto
303.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -84.0 moveto
195.0 -100.0 lineto
303.0 -100.0 lineto
303.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -84.0 moveto
195.0 -100.0 lineto
303.0 -100.0 lineto
303.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -124.0 moveto
195.0 -140.0 lineto
219.0 -140.0 lineto
219.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -124.0 moveto
195.0 -140.0 lineto
219.0 -140.0 lineto
219.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
237.0 -124.0 moveto
237.0 -140.0 lineto
261.0 -140.0 lineto
261.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
237.0 -124.0 moveto
237.0 -140.0 lineto
261.0 -140.0 lineto
261.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
279.0 -124.0 moveto
279.0 -140.0 lineto
303.0 -140.0 lineto
303.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
279.0 -124.0 moveto
279.0 -140.0 lineto
303.0 -140.0 lineto
303.0 -124.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
159.0 -16.0 moveto
159.0 -88.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
129.0 -92.0 moveto
189.0 -92.0 lineto
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
159.0 -96.0 moveto
159.0 -152.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
27.0 -60.0 moveto
27.0 -84.0 lineto
stroke
newpath
69.0 -60.0 moveto
69.0 -84.0 lineto
stroke
newpath
111.0 -60.0 moveto
111.0 -84.0 lineto
stroke
newpath
27.0 -100.0 moveto
27.0 -124.0 lineto
stroke
newpath
69.0 -100.0 moveto
69.0 -124.0 lineto
stroke
newpath
111.0 -100.0 moveto
111.0 -124.0 lineto
stroke
newpath
207.0 -60.0 moveto
207.0 -84.0 lineto
stroke
newpath
249.0 -60.0 moveto
249.0 -84.0 lineto
stroke
newpath
291.0 -60.0 moveto
291.0 -84.0 lineto
stroke
newpath
207.0 -100.0 moveto
207.0 -124.0 lineto
stroke
newpath
249.0 -100.0 moveto
249.0 -124.0 lineto
stroke
newpath
291.0 -100.0 moveto
291.0 -124.0 lineto
stroke
newpath
132.0 -88.0 moveto
126.0 -92.0 lineto
132.0 -96.0 lineto
closepath
fill
newpath
186.0 -88.0 moveto
192.0 -92.0 lineto
186.0 -96.0 lineto
closepath
fill
/Helvetica findfont
8 scalefont setfont
48.0 -23.0 moveto
(Cluster 1) show
228.0 -23.0 moveto
(Cluster 2) show
26.0 -55.0 moveto
(C ) show
68.0 -55.0 moveto
(C ) show
110.0 -55.0 moveto
(C ) show
206.0 -55.0 moveto
(C ) show
248.0 -55.0 moveto
(C ) show
290.0 -55.0 moveto
(C ) show
51.0 -95.0 moveto
(Broker) show
231.0 -95.0 moveto
(Broker) show
24.0 -135.0 moveto
(W ) show
66.0 -135.0 moveto
(W ) show
108.0 -135.0 moveto
(W ) show
204.0 -135.0 moveto
(W ) show
246.0 -135.0 moveto
(W ) show
288.0 -135.0 moveto
(W ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4220 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4220 a -2 4386 a
SDict begin H.S end
 -2 4386
a -2 4386 a
SDict begin 13 H.A end
 -2 4386 a -2 4386 a
SDict begin [/View [/XYZ H.V]/Dest (0:1738) cvn /DEST pdfmark end
 -2 4386 a 396 4494 a
Fk(This)g(design)e(is)i(appealing)e(because)g(the)i(problem)d(is)j
(solv)o(ed)e(in)i(one)e(place,)h(in)m(visible)g(to)g(the)g(rest)h(of)f
(the)g(w)o(orld.)396 4601 y(Basically)-5 b(,)20 b(brok)o(ers)f(open)g
(secret)i(channels)e(to)h(each)g(other)g(and)f(whisper)m(,)g(lik)o(e)i
(camel)f(traders,)f("He)o(y)-5 b(,)19 b(I')l(v)o(e)g(got)396
4709 y(some)h(spare)g(capacity)-5 b(,)19 b(if)h(you)g(ha)n(v)o(e)f(too)
h(man)o(y)f(clients)i(gi)n(v)o(e)e(me)h(a)h(shout)f(and)f(we')o(ll)i
(deal".)-2 4893 y
SDict begin H.S end
 -2 4893 a -2 4893 a
SDict begin 13 H.A end
 -2 4893 a -2 4893
a
SDict begin [/View [/XYZ H.V]/Dest (0:1739) cvn /DEST pdfmark end
 -2 4893 a 396 4983 a Fk(It)g(is)g(in)f(ef)n(fect)g(just)h(a)f(more)g
(sophisticated)f(routing)f(algorithm:)h(brok)o(ers)g(become)g
(subcontractors)f(for)i(each)f(other)-5 b(.)396 5091
y(Other)20 b(things)g(to)g(lik)o(e)h(about)e(this)i(design,)e(e)n(v)o
(en)g(before)g(we)h(play)g(with)g(real)h(code:)-2 5109
y
SDict begin H.S end
 -2 5109 a -2 5109 a
SDict begin 13 H.A end
 -2 5109 a -2 5109 a
SDict begin [/View [/XYZ H.V]/Dest (0:1740) cvn /DEST pdfmark end
 -2 5109 a -2
5119 a
SDict begin H.S end
 -2 5119 a -2 5119 a
SDict begin 13 H.A end
 -2 5119 a -2 5119 a
SDict begin [/View [/XYZ H.V]/Dest (0:1741) cvn /DEST pdfmark end
 -2 5119
a Black 3759 5569 a Ff(128)p Black eop end
%%Page: 129 142
TeXDict begin 129 141 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.129) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1768) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black Black 396 72 a Fj(\225)p Black
479 72 a
SDict begin H.S end
 479 72 a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:1742) cvn /DEST pdfmark end
 479 72 a
Fk(It)21 b(treats)f(the)h(common)d(case)j(\(clients)f(and)f(w)o(ork)o
(ers)h(on)g(the)g(same)g(cluster\))g(as)h(def)o(ault)e(and)h(does)g(e)o
(xtra)f(w)o(ork)h(for)479 180 y(the)g(e)o(xceptional)f(case)h(\(shuf)n
(\003ing)f(jobs)h(between)f(clusters\).)-2 198 y
SDict begin H.S end
 -2 198
a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:1743) cvn /DEST pdfmark end
 -2 198 a Black 396 330 a
Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330
a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:1744) cvn /DEST pdfmark end
 479 330 a Fk(It)i(lets)g(us)f(use)h(dif)n(ferent)d(message)
i(\003o)n(ws)h(for)f(the)g(dif)n(ferent)e(types)i(of)g(w)o(ork.)f(That)
h(means)g(we)h(can)f(handle)f(them)479 438 y(dif)n(ferently)-5
b(,)18 b(e.g.)h(using)h(dif)n(ferent)f(types)h(of)g(netw)o(ork)e
(connection.)-2 456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456 a -2 456
a
SDict begin [/View [/XYZ H.V]/Dest (0:1745) cvn /DEST pdfmark end
 -2 456 a Black 396 587 a Fj(\225)p Black 479 587 a
SDict begin H.S end

479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:1746) cvn /DEST pdfmark end
 479 587 a Fk(It)j(feels)f(lik)o
(e)h(it)g(w)o(ould)e(scale)i(smoothly)-5 b(.)18 b(Interconnecting)f
(three,)i(or)h(more)g(brok)o(ers)e(doesn')o(t)h(get)h(o)o(v)o(er)n
(-comple)o(x.)479 695 y(If)g(we)h(\002nd)f(this)h(to)f(be)g(a)h
(problem,)d(it')-5 b(s)21 b(easy)f(to)h(solv)o(e)f(by)f(adding)g(a)i
(super)n(-brok)o(er)-5 b(.)-2 879 y
SDict begin H.S end
 -2 879 a -2 879 a
SDict begin 13 H.A end

-2 879 a -2 879 a
SDict begin [/View [/XYZ H.V]/Dest (0:1747) cvn /DEST pdfmark end
 -2 879 a 396 969 a Fk(W)e(e')o(ll)22
b(no)n(w)d(mak)o(e)h(a)h(w)o(ork)o(ed)e(e)o(xample.)f(W)-7
b(e')o(ll)22 b(pack)d(an)h(entire)g(cluster)g(into)g(one)g(process.)f
(That)h(is)h(ob)o(viously)d(not)396 1077 y(realistic)j(b)n(ut)f(it)h
(mak)o(es)f(it)h(simple)f(to)g(simulate,)g(and)g(the)g(simulation)g
(can)f(accurately)g(scale)i(to)f(real)h(processes.)e(This)396
1185 y(is)i(the)g(beauty)e(of)h(\330MQ,)g(you)f(can)h(design)g(at)g
(the)h(microle)n(v)o(el)d(and)i(scale)g(that)h(up)e(to)i(the)f(macro)f
(le)n(v)o(el.)h(Threads)396 1293 y(become)f(processes,)h(become)f(box)o
(es)g(and)h(the)g(patterns)f(and)h(logic)g(remain)f(the)h(same.)h(Each)
e(of)h(our)g('cluster')396 1401 y(processes)g(contains)g(client)g
(threads,)f(w)o(ork)o(er)g(threads,)h(and)f(a)i(brok)o(er)d(thread.)-2
1585 y
SDict begin H.S end
 -2 1585 a -2 1585 a
SDict begin 13 H.A end
 -2 1585 a -2 1585 a
SDict begin [/View [/XYZ H.V]/Dest (0:1748) cvn /DEST pdfmark end
 -2 1585
a 396 1675 a Fk(W)-7 b(e)22 b(kno)n(w)d(the)h(basic)g(model)g(well)g
(by)g(no)n(w:)-2 1693 y
SDict begin H.S end
 -2 1693 a -2 1693 a
SDict begin 13 H.A end
 -2 1693 a
-2 1693 a
SDict begin [/View [/XYZ H.V]/Dest (0:1749) cvn /DEST pdfmark end
 -2 1693 a -2 1703 a
SDict begin H.S end
 -2 1703 a -2 1703 a
SDict begin 13 H.A end
 -2
1703 a -2 1703 a
SDict begin [/View [/XYZ H.V]/Dest (0:1750) cvn /DEST pdfmark end
 -2 1703 a Black 396 1845 a Fj(\225)p
Black 479 1845 a
SDict begin H.S end
 479 1845 a 479 1845 a
SDict begin 13 H.A end
 479 1845 a 479
1845 a
SDict begin [/View [/XYZ H.V]/Dest (0:1751) cvn /DEST pdfmark end
 479 1845 a Fk(The)g(REQ)h(client)f(\(REQ\))g(threads)g(create)g
(w)o(orkloads)e(and)i(pass)h(them)f(to)g(the)g(brok)o(er)f(\(R)m
(OUTER\).)-2 1863 y
SDict begin H.S end
 -2 1863 a -2 1863 a
SDict begin 13 H.A end
 -2 1863 a -2
1863 a
SDict begin [/View [/XYZ H.V]/Dest (0:1752) cvn /DEST pdfmark end
 -2 1863 a Black 396 1994 a Fj(\225)p Black 479
1994 a
SDict begin H.S end
 479 1994 a 479 1994 a
SDict begin 13 H.A end
 479 1994 a 479 1994 a
SDict begin [/View [/XYZ H.V]/Dest (0:1753) cvn /DEST pdfmark end
 479
1994 a Fk(The)h(REQ)h(w)o(ork)o(er)e(\(REQ\))h(threads)g(process)f(w)o
(orkloads)g(and)h(return)f(the)h(results)h(to)f(the)g(brok)o(er)f(\(R)m
(OUTER\).)-2 2012 y
SDict begin H.S end
 -2 2012 a -2 2012 a
SDict begin 13 H.A end
 -2 2012 a -2
2012 a
SDict begin [/View [/XYZ H.V]/Dest (0:1754) cvn /DEST pdfmark end
 -2 2012 a Black 396 2144 a Fj(\225)p Black 479
2144 a
SDict begin H.S end
 479 2144 a 479 2144 a
SDict begin 13 H.A end
 479 2144 a 479 2144 a
SDict begin [/View [/XYZ H.V]/Dest (0:1755) cvn /DEST pdfmark end
 479
2144 a Fk(The)h(brok)o(er)f(queues)g(and)h(distrib)n(utes)g(w)o
(orkloads)f(using)g(the)h(LR)m(U)h(routing)d(model.)-2
2203 y
SDict begin H.S end
 -2 2203 a -2 2203 a
SDict begin 13 H.A end
 -2 2203 a -2 2203 a
SDict begin [/View [/XYZ H.V]/Dest (0:1756) cvn /DEST pdfmark end
 -2 2203
a 396 2513 a Fb(3.9.4.)36 b(Federation)e(vs.)g(P)l(eering)2006
2513 y
SDict begin H.S end
 2006 2513 a 2006 2513 a
SDict begin 18.72 H.A end
 2006 2513 a 2006 2513
a
SDict begin [/View [/XYZ H.V]/Dest (8.54.8.2) cvn /DEST pdfmark end
 2006 2513 a -2 2706 a
SDict begin H.S end
 -2 2706 a -2 2706 a
SDict begin 13 H.A end
 -2 2706 a
-2 2706 a
SDict begin [/View [/XYZ H.V]/Dest (0:1758) cvn /DEST pdfmark end
 -2 2706 a 396 2787 a Fk(There)20 b(are)g(se)n(v)o(eral)f
(possible)h(w)o(ays)h(to)f(interconnect)e(brok)o(ers.)h(What)h(we)2593
2787 y
SDict begin H.S end
 2593 2787 a 2593 2787 a
SDict begin 13 H.A end
 2593 2787 a 2593 2787
a
SDict begin [/View [/XYZ H.V]/Dest (0:1759) cvn /DEST pdfmark end
 2593 2787 a Ff(want)i Fk(is)f(to)f(be)g(able)g(to)h(tell)g(other)e
(brok)o(ers,)396 2895 y("we)i(ha)n(v)o(e)e(capacity",)g(and)h(then)g
(recei)n(v)o(e)f(multiple)g(tasks.)i(W)-7 b(e)21 b(also)g(need)e(to)i
(be)f(able)g(to)g(tell)h(other)e(brok)o(ers)g("stop,)396
3003 y(we')l(re)h(full".)g(It)g(doesn')o(t)f(need)g(to)i(be)f(perfect:)
f(sometimes)h(we)g(may)g(accept)g(jobs)g(we)h(can')o(t)e(process)h
(immediately)-5 b(,)396 3111 y(then)20 b(we')o(ll)h(do)e(them)h(as)h
(soon)f(as)g(possible.)-2 3295 y
SDict begin H.S end
 -2 3295 a -2 3295 a
SDict begin 13 H.A end

-2 3295 a -2 3295 a
SDict begin [/View [/XYZ H.V]/Dest (0:1760) cvn /DEST pdfmark end
 -2 3295 a 396 3385 a Fk(The)g(simplest)h
(interconnect)d(is)1351 3385 y
SDict begin H.S end
 1351 3385 a 1351 3385
a
SDict begin 13 H.A end
 1351 3385 a 1351 3385 a
SDict begin [/View [/XYZ H.V]/Dest (0:1761) cvn /DEST pdfmark end
 1351 3385 a Ff(feder)o(ation)h
Fk(in)h(which)g(brok)o(ers)f(simulate)h(clients)g(and)g(w)o(ork)o(ers)f
(for)h(each)g(other)-5 b(.)19 b(W)-7 b(e)396 3493 y(w)o(ould)20
b(do)g(this)g(by)g(connecting)e(our)h(frontend)g(to)h(the)g(other)f
(brok)o(er')-5 b(s)19 b(back)o(end)g(sock)o(et\()p 0
TeXcolorgray 3018 3493 a
SDict begin H.S end
 3018 3493 a Fk(Figure)f(3-24)3408
3493 y
SDict begin 13 H.L end
 3408 3493 a 3408 3493 a
SDict begin [/Subtype /Link/Dest (0:figure-50) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3408 3493 a Black -1 w
Fk(\).)i(Note)g(that)g(it)396 3601 y(is)h(le)o(gal)f(to)g(both)g(bind)f
(a)i(sock)o(et)f(to)g(an)g(endpoint)e(and)i(connect)f(it)i(to)f(other)g
(endpoints.)-2 3619 y
SDict begin H.S end
 -2 3619 a -2 3619 a
SDict begin 13 H.A end
 -2 3619 a -2
3619 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-50) cvn /DEST pdfmark
end
 -2 3619 a Black 3759 5569 a Ff(129)p Black eop
end
%%Page: 130 143
TeXDict begin 130 142 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.130) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-24.)e(Cr)o
(oss-connected)h(Br)o(ok)o(ers)i(in)g(F)n(ederation)e(Model)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1765) cvn /DEST pdfmark end
 -2 172 a 396
1614 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1614 a @beginspecial 0 @llx -168 @lly 324
@urx 0 @ury 3240 @rwi @setspecial
%%BeginDocument: images/fig50.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -168 324 0
%%HiResBoundingBox: 0.0 -168.0 324.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -45.80017852783203 moveto
16.800180435180664 -61.80017852783203 lineto
40.80017852783203 -61.80017852783203 lineto
40.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -45.80017852783203 moveto
58.80017852783203 -61.80017852783203 lineto
82.80017852783203 -61.80017852783203 lineto
82.80017852783203 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -85.80017852783203 moveto
16.800180435180664 -101.80017852783203 lineto
124.80017852783203 -101.80017852783203 lineto
124.80017852783203 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -125.80017852783203 moveto
16.800180435180664 -141.80018615722656 lineto
40.80017852783203 -141.80018615722656 lineto
40.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
58.80017852783203 -125.80017852783203 moveto
58.80017852783203 -141.80018615722656 lineto
82.80017852783203 -141.80018615722656 lineto
82.80017852783203 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
244.80018615722656 -45.80017852783203 moveto
244.80018615722656 -61.80017852783203 lineto
268.8001708984375 -61.80017852783203 lineto
268.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
286.8001708984375 -45.80017852783203 moveto
286.8001708984375 -61.80017852783203 lineto
310.8001708984375 -61.80017852783203 lineto
310.8001708984375 -45.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
202.80018615722656 -85.80017852783203 moveto
202.80018615722656 -101.80017852783203 lineto
310.8001708984375 -101.80017852783203 lineto
310.8001708984375 -85.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
244.80018615722656 -125.80017852783203 moveto
244.80018615722656 -141.80018615722656 lineto
268.8001708984375 -141.80018615722656 lineto
268.8001708984375 -125.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
286.8001708984375 -125.80017852783203 moveto
286.8001708984375 -141.80018615722656 lineto
310.8001708984375 -141.80018615722656 lineto
310.8001708984375 -125.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -44.0 moveto
15.0 -60.0 lineto
39.0 -60.0 lineto
39.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -44.0 moveto
57.0 -60.0 lineto
81.0 -60.0 lineto
81.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -84.0 moveto
15.0 -100.0 lineto
123.0 -100.0 lineto
123.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -124.0 moveto
15.0 -140.0 lineto
39.0 -140.0 lineto
39.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
57.0 -124.0 moveto
57.0 -140.0 lineto
81.0 -140.0 lineto
81.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
243.0 -44.0 moveto
243.0 -60.0 lineto
267.0 -60.0 lineto
267.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
243.0 -44.0 moveto
243.0 -60.0 lineto
267.0 -60.0 lineto
267.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
285.0 -44.0 moveto
285.0 -60.0 lineto
309.0 -60.0 lineto
309.0 -44.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
285.0 -44.0 moveto
285.0 -60.0 lineto
309.0 -60.0 lineto
309.0 -44.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
201.0 -84.0 moveto
201.0 -100.0 lineto
309.0 -100.0 lineto
309.0 -84.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
201.0 -84.0 moveto
201.0 -100.0 lineto
309.0 -100.0 lineto
309.0 -84.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
243.0 -124.0 moveto
243.0 -140.0 lineto
267.0 -140.0 lineto
267.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
243.0 -124.0 moveto
243.0 -140.0 lineto
267.0 -140.0 lineto
267.0 -124.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
285.0 -124.0 moveto
285.0 -140.0 lineto
309.0 -140.0 lineto
309.0 -124.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
285.0 -124.0 moveto
285.0 -140.0 lineto
309.0 -140.0 lineto
309.0 -124.0 lineto
closepath
stroke
0.6 setlinewidth
0 setlinecap
[3.0] 0.0 setdash
newpath
159.0 -16.0 moveto
159.0 -120.0 lineto
stroke
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
111.0 -108.0 moveto
111.0 -140.0 lineto
177.0 -140.0 lineto
177.0 -128.0 lineto
stroke
newpath
111.0 -84.0 moveto
111.0 -60.0 lineto
141.0 -60.0 lineto
141.0 -124.0 lineto
213.0 -124.0 lineto
213.0 -108.0 lineto
stroke
newpath
27.0 -60.0 moveto
27.0 -84.0 lineto
stroke
newpath
69.0 -60.0 moveto
69.0 -84.0 lineto
stroke
newpath
27.0 -100.0 moveto
27.0 -124.0 lineto
stroke
newpath
69.0 -100.0 moveto
69.0 -124.0 lineto
stroke
newpath
213.0 -84.0 moveto
213.0 -60.0 lineto
177.0 -60.0 lineto
177.0 -120.0 lineto
stroke
newpath
255.0 -60.0 moveto
255.0 -84.0 lineto
stroke
newpath
297.0 -60.0 moveto
297.0 -84.0 lineto
stroke
newpath
255.0 -100.0 moveto
255.0 -124.0 lineto
stroke
newpath
297.0 -100.0 moveto
297.0 -124.0 lineto
stroke
newpath
111.0 -104.0 moveto
108.0 -112.0 lineto
114.0 -112.0 lineto
closepath
fill
newpath
213.0 -104.0 moveto
210.0 -112.0 lineto
216.0 -112.0 lineto
closepath
fill
/Helvetica findfont
8 scalefont setfont
48.0 -23.0 moveto
(Cluster 1) show
228.0 -23.0 moveto
(Cluster 2) show
26.0 -55.0 moveto
(C ) show
68.0 -55.0 moveto
(C ) show
254.0 -55.0 moveto
(C ) show
296.0 -55.0 moveto
(C ) show
51.0 -95.0 moveto
(Broker) show
237.0 -95.0 moveto
(Broker) show
24.0 -135.0 moveto
(W ) show
66.0 -135.0 moveto
(W ) show
252.0 -135.0 moveto
(W ) show
294.0 -135.0 moveto
(W ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1614 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1614 a 274 x Fk(This)i(w)o(ould)e(gi)n(v)o
(e)h(us)g(simple)g(logic)g(in)g(both)g(brok)o(ers)f(and)g(a)i
(reasonably)d(good)h(mechanism:)g(when)h(there)f(are)i(no)396
1996 y(clients,)g(tell)f(the)h(other)e(brok)o(er)g(')l(ready',)f(and)h
(accept)h(one)g(job)g(from)f(it.)h(The)g(problem)f(is)i(also)f(that)h
(it)g(is)g(too)f(simple)396 2104 y(for)g(this)h(problem.)d(A)i
(federated)f(brok)o(er)g(w)o(ould)g(be)h(able)g(to)h(handle)e(only)g
(one)h(task)g(at)h(once.)e(If)h(the)g(brok)o(er)396 2212
y(emulates)g(a)h(lock-step)e(client)h(and)g(w)o(ork)o(er)m(,)e(it)j(is)
g(by)f(de\002nition)f(also)i(going)e(to)h(be)g(lock-step)f(and)h(if)g
(it)h(has)g(lots)f(of)396 2320 y(a)n(v)n(ailable)g(w)o(ork)o(ers)f(the)
o(y)h(w)o(on')o(t)f(be)h(used.)g(Our)g(brok)o(ers)f(need)g(to)i(be)f
(connected)e(in)i(a)h(fully)f(asynchronous)d(f)o(ashion.)-2
2504 y
SDict begin H.S end
 -2 2504 a -2 2504 a
SDict begin 13 H.A end
 -2 2504 a -2 2504 a
SDict begin [/View [/XYZ H.V]/Dest (0:1769) cvn /DEST pdfmark end
 -2 2504
a 396 2594 a Fk(The)j(federation)e(model)i(is)h(perfect)e(for)h(other)f
(kinds)h(of)g(routing,)e(especially)i(service-oriented)d(architectures)
i(or)396 2701 y(SO)m(As)i(\(which)f(route)f(by)h(service)g(name)f(and)h
(proximity)e(rather)i(than)f(LR)m(U)i(or)f(round-robin)c(or)k(random)e
(scatter\).)396 2809 y(So)j(don')o(t)d(dismiss)j(it)g(as)g(useless,)g
(it')-5 b(s)21 b(just)g(not)f(right)f(for)h(least-recently)f(used)h
(and)f(cluster)h(load-balancing.)-2 2993 y
SDict begin H.S end
 -2 2993 a
-2 2993 a
SDict begin 13 H.A end
 -2 2993 a -2 2993 a
SDict begin [/View [/XYZ H.V]/Dest (0:1770) cvn /DEST pdfmark end
 -2 2993 a 396 3083 a Fk(So)h(instead)f
(of)g(federation,)e(let')-5 b(s)21 b(look)e(at)i(a)1694
3083 y
SDict begin H.S end
 1694 3083 a 1694 3083 a
SDict begin 13 H.A end
 1694 3083 a 1694 3083
a
SDict begin [/View [/XYZ H.V]/Dest (0:1771) cvn /DEST pdfmark end
 1694 3083 a Ff(peering)f Fk(approach)e(in)i(which)g(brok)o(ers)f(are)
h(e)o(xplicitly)f(a)o(w)o(are)h(of)g(each)396 3191 y(other)g(and)f
(talk)i(o)o(v)o(er)d(pri)n(vile)o(ged)g(channels.)h(Let')-5
b(s)21 b(break)e(this)i(do)n(wn,)e(assuming)g(we)i(w)o(ant)f(to)h
(interconnect)d(N)396 3299 y(brok)o(ers.)h(Each)h(brok)o(er)e(has)j
(\(N)f(-)g(1\))g(peers,)g(and)g(all)g(brok)o(ers)f(are)h(using)g(e)o
(xactly)f(the)i(same)f(code)f(and)h(logic.)g(There)396
3407 y(are)g(tw)o(o)h(distinct)f(\003o)n(ws)h(of)f(information)d
(between)j(brok)o(ers:)-2 3408 y
SDict begin H.S end
 -2 3408 a -2 3408 a
SDict begin 13 H.A end

-2 3408 a -2 3408 a
SDict begin [/View [/XYZ H.V]/Dest (0:1772) cvn /DEST pdfmark end
 -2 3408 a -2 3418 a
SDict begin H.S end
 -2 3418 a -2
3418 a
SDict begin 13 H.A end
 -2 3418 a -2 3418 a
SDict begin [/View [/XYZ H.V]/Dest (0:1773) cvn /DEST pdfmark end
 -2 3418 a Black 396 3577 a
Fj(\225)p Black 479 3577 a
SDict begin H.S end
 479 3577 a 479 3577 a
SDict begin 13 H.A end
 479
3577 a 479 3577 a
SDict begin [/View [/XYZ H.V]/Dest (0:1774) cvn /DEST pdfmark end
 479 3577 a Fk(Each)g(brok)o(er)f(needs)g(to)i(tell)g
(its)g(peers)f(ho)n(w)f(man)o(y)g(w)o(ork)o(ers)h(it)h(has)f(a)n(v)n
(ailable)g(at)h(an)o(y)e(time.)h(This)h(can)f(be)g(f)o(airly)479
3685 y(simple)g(information,)e(just)j(a)f(quantity)f(that)i(is)g
(updated)d(re)o(gularly)-5 b(.)18 b(The)i(ob)o(vious)e(\(and)h
(correct\))g(sock)o(et)h(pattern)479 3793 y(for)g(this)h(is)g
(publish-subscribe.)c(So)j(e)n(v)o(ery)f(brok)o(er)g(opens)g(a)i(PUB)g
(sock)o(et)f(and)g(publishes)f(state)i(information)d(on)479
3901 y(that,)i(and)g(e)n(v)o(ery)f(brok)o(er)f(also)j(opens)e(a)i(SUB)g
(sock)o(et)f(and)g(connects)f(that)h(to)h(the)f(PUB)h(sock)o(et)f(of)g
(e)n(v)o(ery)f(other)479 4009 y(brok)o(er)m(,)f(to)j(get)f(state)h
(information)d(from)h(its)i(peers.)-2 4027 y
SDict begin H.S end
 -2 4027
a -2 4027 a
SDict begin 13 H.A end
 -2 4027 a -2 4027 a
SDict begin [/View [/XYZ H.V]/Dest (0:1775) cvn /DEST pdfmark end
 -2 4027 a Black 396 4158
a Fj(\225)p Black 479 4158 a
SDict begin H.S end
 479 4158 a 479 4158 a
SDict begin 13 H.A end
 479
4158 a 479 4158 a
SDict begin [/View [/XYZ H.V]/Dest (0:1776) cvn /DEST pdfmark end
 479 4158 a Fk(Each)f(brok)o(er)e(needs)h(a)i(w)o(ay)f
(to)g(dele)o(gate)e(tasks)i(to)g(a)h(peer)e(and)g(get)h(replies)g
(back,)f(asynchronously)-5 b(.)16 b(W)-7 b(e')o(ll)21
b(do)e(this)479 4266 y(using)h(R)m(OUTER/R)m(OUTER)g(\(R)m(OUTER/R)m
(OUTER\))g(sock)o(ets,)g(no)g(other)f(combination)f(w)o(orks.)i(Each)f
(brok)o(er)479 4374 y(has)h(tw)o(o)g(such)f(sock)o(ets:)h(one)f(for)g
(tasks)h(it)g(recei)n(v)o(es,)f(one)g(for)g(tasks)h(it)g(dele)o(gates.)
e(If)i(we)g(didn')o(t)e(use)i(tw)o(o)f(sock)o(ets)h(it)479
4482 y(w)o(ould)g(be)g(more)f(w)o(ork)h(to)g(kno)n(w)f(whether)g(we)i
(were)f(reading)f(a)h(request)g(or)g(a)g(reply)g(each)g(time.)g(That)g
(w)o(ould)479 4590 y(mean)g(adding)f(more)g(information)f(to)i(the)g
(message)g(en)m(v)o(elope.)-2 4774 y
SDict begin H.S end
 -2 4774 a -2 4774
a
SDict begin 13 H.A end
 -2 4774 a -2 4774 a
SDict begin [/View [/XYZ H.V]/Dest (0:1777) cvn /DEST pdfmark end
 -2 4774 a 396 4864 a Fk(And)g(there)g(is)h(also)f
(the)h(\003o)n(w)f(of)g(information)e(between)h(a)i(brok)o(er)d(and)i
(its)h(local)f(clients)h(and)e(w)o(ork)o(ers.)-2 4875
y
SDict begin H.S end
 -2 4875 a -2 4875 a
SDict begin 13 H.A end
 -2 4875 a -2 4875 a
SDict begin [/View [/XYZ H.V]/Dest (0:1778) cvn /DEST pdfmark end
 -2 4875 a Black
3759 5569 a Ff(130)p Black eop end
%%Page: 131 144
TeXDict begin 131 143 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.131) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1827) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 77 a Fb(3.9.5.)36 b(The)d(Naming)i(Ceremon)
n(y)2027 77 y
SDict begin H.S end
 2027 77 a 2027 77 a
SDict begin 18.72 H.A end
 2027 77 a 2027 77 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.9.2) cvn /DEST pdfmark end

2027 77 a -2 269 a
SDict begin H.S end
 -2 269 a -2 269 a
SDict begin 13 H.A end
 -2 269 a -2 269
a
SDict begin [/View [/XYZ H.V]/Dest (0:1780) cvn /DEST pdfmark end
 -2 269 a 396 351 a Fk(Three)20 b(\003o)n(ws)g(x)g(tw)o(o)h(sock)o
(ets)f(for)g(each)g(\003o)n(w)g(=)h(six)f(sock)o(ets)h(that)f(we)g(ha)n
(v)o(e)g(to)g(manage)f(in)i(the)f(brok)o(er)-5 b(.)19
b(Choosing)396 459 y(good)g(names)h(is)h(vital)f(to)h(k)o(eeping)e(a)h
(multi-sock)o(et)f(juggling)g(act)h(reasonably)f(coherent)f(in)j(our)e
(minds.)h(Sock)o(ets)3763 459 y
SDict begin H.S end
 3763 459 a 3763 459 a
SDict begin 13 H.A end

3763 459 a 3763 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:1781) cvn /DEST pdfmark end
 3763 459 a Ff(do)396 566 y Fk(something)f(and)h
(what)g(the)o(y)f(do)h(should)f(form)g(the)i(basis)f(for)g(their)g
(names.)f(It')-5 b(s)21 b(about)f(being)f(able)h(to)g(read)g(the)g
(code)396 674 y(se)n(v)o(eral)g(weeks)g(later)g(on)g(a)h(cold)e(Monday)
g(morning)f(before)h(cof)n(fee,)g(and)g(not)h(feeling)f(pain.)-2
858 y
SDict begin H.S end
 -2 858 a -2 858 a
SDict begin 13 H.A end
 -2 858 a -2 858 a
SDict begin [/View [/XYZ H.V]/Dest (0:1782) cvn /DEST pdfmark end
 -2 858 a 396
948 a Fk(Let')-5 b(s)21 b(do)f(a)g(shamanistic)g(naming)f(ceremon)o(y)f
(for)h(the)i(sock)o(ets.)f(The)g(three)f(\003o)n(ws)i(are:)-2
966 y
SDict begin H.S end
 -2 966 a -2 966 a
SDict begin 13 H.A end
 -2 966 a -2 966 a
SDict begin [/View [/XYZ H.V]/Dest (0:1783) cvn /DEST pdfmark end
 -2 966 a -2
976 a
SDict begin H.S end
 -2 976 a -2 976 a
SDict begin 13 H.A end
 -2 976 a -2 976 a
SDict begin [/View [/XYZ H.V]/Dest (0:1784) cvn /DEST pdfmark end
 -2 976 a Black
396 1119 a Fj(\225)p Black 479 1119 a
SDict begin H.S end
 479 1119 a 479
1119 a
SDict begin 13 H.A end
 479 1119 a 479 1119 a
SDict begin [/View [/XYZ H.V]/Dest (0:1785) cvn /DEST pdfmark end
 479 1119 a Fk(A)560 1119
y
SDict begin H.S end
 560 1119 a 560 1119 a
SDict begin 13 H.A end
 560 1119 a 560 1119 a
SDict begin [/View [/XYZ H.V]/Dest (0:1786) cvn /DEST pdfmark end
 560 1119
a Ff(local)f Fk(request-reply)e(\003o)n(w)i(between)f(the)i(brok)o(er)d
(and)i(its)h(clients)f(and)g(w)o(ork)o(ers.)-2 1137 y
SDict begin H.S end

-2 1137 a -2 1137 a
SDict begin 13 H.A end
 -2 1137 a -2 1137 a
SDict begin [/View [/XYZ H.V]/Dest (0:1787) cvn /DEST pdfmark end
 -2 1137 a Black
396 1268 a Fj(\225)p Black 479 1268 a
SDict begin H.S end
 479 1268 a 479
1268 a
SDict begin 13 H.A end
 479 1268 a 479 1268 a
SDict begin [/View [/XYZ H.V]/Dest (0:1788) cvn /DEST pdfmark end
 479 1268 a Fk(A)560 1268
y
SDict begin H.S end
 560 1268 a 560 1268 a
SDict begin 13 H.A end
 560 1268 a 560 1268 a
SDict begin [/View [/XYZ H.V]/Dest (0:1789) cvn /DEST pdfmark end
 560 1268
a Ff(cloud)h Fk(request-reply)d(\003o)n(w)j(between)e(the)h(brok)o(er)f
(and)g(its)j(peer)d(brok)o(ers.)-2 1286 y
SDict begin H.S end
 -2 1286 a -2
1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:1790) cvn /DEST pdfmark end
 -2 1286 a Black 396 1417 a
Fj(\225)p Black 479 1417 a
SDict begin H.S end
 479 1417 a 479 1417 a
SDict begin 13 H.A end
 479
1417 a 479 1417 a
SDict begin [/View [/XYZ H.V]/Dest (0:1791) cvn /DEST pdfmark end
 479 1417 a Fk(A)560 1417 y
SDict begin H.S end
 560 1417
a 560 1417 a
SDict begin 13 H.A end
 560 1417 a 560 1417 a
SDict begin [/View [/XYZ H.V]/Dest (0:1792) cvn /DEST pdfmark end
 560 1417 a Ff(state)i
Fk(\003o)n(w)f(between)f(the)h(brok)o(er)f(and)h(its)h(peer)f(brok)o
(ers.)-2 1601 y
SDict begin H.S end
 -2 1601 a -2 1601 a
SDict begin 13 H.A end
 -2 1601 a -2 1601
a
SDict begin [/View [/XYZ H.V]/Dest (0:1793) cvn /DEST pdfmark end
 -2 1601 a 396 1691 a Fk(Finding)f(meaningful)f(names)i(that)g(are)h
(all)f(the)h(same)f(length)f(means)h(our)g(code)f(will)i(align)f
(nicely)-5 b(.)19 b(It')-5 b(s)21 b(not)e(a)i(big)396
1799 y(thing,)e(b)n(ut)i(attention)e(to)h(details)h(helps.)f(F)o(or)f
(each)h(\003o)n(w)h(the)f(brok)o(er)e(has)j(tw)o(o)f(sock)o(ets)h(that)
f(we)g(can)g(orthogonally)396 1907 y(call)h(the)f("frontend")e(and)i
("back)o(end".)e(W)-7 b(e')l(v)o(e)20 b(used)f(these)i(names)f(quite)g
(often.)f(A)h(frontend)e(recei)n(v)o(es)i(information)396
2015 y(or)g(tasks.)h(A)f(back)o(end)f(sends)h(those)g(out)g(to)g(other)
g(peers.)f(The)h(conceptual)f(\003o)n(w)h(is)h(from)e(front)g(to)i
(back)e(\(with)396 2123 y(replies)h(going)f(in)i(the)f(opposite)f
(direction)g(from)g(back)g(to)i(front\).)-2 2307 y
SDict begin H.S end
 -2
2307 a -2 2307 a
SDict begin 13 H.A end
 -2 2307 a -2 2307 a
SDict begin [/View [/XYZ H.V]/Dest (0:1794) cvn /DEST pdfmark end
 -2 2307 a 396 2397
a Fk(So)g(in)f(all)h(the)f(code)g(we)g(write)g(for)g(this)h(tutorial)e
(will)i(use)g(these)f(sock)o(et)g(names:)-2 2398 y
SDict begin H.S end
 -2
2398 a -2 2398 a
SDict begin 13 H.A end
 -2 2398 a -2 2398 a
SDict begin [/View [/XYZ H.V]/Dest (0:1795) cvn /DEST pdfmark end
 -2 2398 a -2 2408
a
SDict begin H.S end
 -2 2408 a -2 2408 a
SDict begin 13 H.A end
 -2 2408 a -2 2408 a
SDict begin [/View [/XYZ H.V]/Dest (0:1796) cvn /DEST pdfmark end
 -2 2408 a Black
396 2567 a Fj(\225)p Black 479 2567 a
SDict begin H.S end
 479 2567 a 479
2567 a
SDict begin 13 H.A end
 479 2567 a 479 2567 a
SDict begin [/View [/XYZ H.V]/Dest (0:1797) cvn /DEST pdfmark end
 479 2567 a 479 2567 a
SDict begin H.S end
 479
2567 a 479 2567 a
SDict begin 13 H.A end
 479 2567 a 479 2567 a
SDict begin [/View [/XYZ H.V]/Dest (0:1798) cvn /DEST pdfmark end
 479 2567 a Ff(localfe)g
Fk(and)867 2567 y
SDict begin H.S end
 867 2567 a 867 2567 a
SDict begin 13 H.A end
 867 2567 a 867
2567 a
SDict begin [/View [/XYZ H.V]/Dest (0:1799) cvn /DEST pdfmark end
 867 2567 a Ff(localbe)f Fk(for)g(the)i(local)f(\003o)n(w)-5
b(.)-2 2584 y
SDict begin H.S end
 -2 2584 a -2 2584 a
SDict begin 13 H.A end
 -2 2584 a -2 2584 a
SDict begin [/View [/XYZ H.V]/Dest (0:1800) cvn /DEST pdfmark end

-2 2584 a Black 396 2717 a Fj(\225)p Black 479 2717 a
SDict begin H.S end

479 2717 a 479 2717 a
SDict begin 13 H.A end
 479 2717 a 479 2717 a
SDict begin [/View [/XYZ H.V]/Dest (0:1801) cvn /DEST pdfmark end
 479 2717
a 479 2717 a
SDict begin H.S end
 479 2717 a 479 2717 a
SDict begin 13 H.A end
 479 2717 a 479 2717
a
SDict begin [/View [/XYZ H.V]/Dest (0:1802) cvn /DEST pdfmark end
 479 2717 a Ff(cloudfe)19 b Fk(and)885 2717 y
SDict begin H.S end
 885 2717
a 885 2717 a
SDict begin 13 H.A end
 885 2717 a 885 2717 a
SDict begin [/View [/XYZ H.V]/Dest (0:1803) cvn /DEST pdfmark end
 885 2717 a Ff(cloudbe)g
Fk(for)g(the)h(cloud)g(\003o)n(w)-5 b(.)-2 2734 y
SDict begin H.S end
 -2
2734 a -2 2734 a
SDict begin 13 H.A end
 -2 2734 a -2 2734 a
SDict begin [/View [/XYZ H.V]/Dest (0:1804) cvn /DEST pdfmark end
 -2 2734 a Black
396 2866 a Fj(\225)p Black 479 2866 a
SDict begin H.S end
 479 2866 a 479
2866 a
SDict begin 13 H.A end
 479 2866 a 479 2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:1805) cvn /DEST pdfmark end
 479 2866 a 479 2866 a
SDict begin H.S end
 479
2866 a 479 2866 a
SDict begin 13 H.A end
 479 2866 a 479 2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:1806) cvn /DEST pdfmark end
 479 2866 a Ff(statefe)21
b Fk(and)857 2866 y
SDict begin H.S end
 857 2866 a 857 2866 a
SDict begin 13 H.A end
 857 2866 a
857 2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:1807) cvn /DEST pdfmark end
 857 2866 a Ff(statebe)f Fk(for)g(the)g(state)h(\003o)n(w)-5
b(.)-2 3049 y
SDict begin H.S end
 -2 3049 a -2 3049 a
SDict begin 13 H.A end
 -2 3049 a -2 3049 a
SDict begin [/View [/XYZ H.V]/Dest (0:1808) cvn /DEST pdfmark end

-2 3049 a 396 3140 a Fk(F)o(or)19 b(our)g(transport)f(and)h(because)g
(we')l(re)g(simulating)g(the)g(whole)g(thing)g(on)g(one)g(box,)g(we')o
(ll)g(use)3239 3140 y
SDict begin H.S end
 3239 3140 a 3239 3140 a
SDict begin 13 H.A end
 3239 3140
a 3239 3140 a
SDict begin [/View [/XYZ H.V]/Dest (0:1809) cvn /DEST pdfmark end
 3239 3140 a Fe(ipc)h Fk(for)f(e)n(v)o(erything.)396
3248 y(This)i(has)f(the)g(adv)n(antage)f(of)g(w)o(orking)g(lik)o(e)1705
3248 y
SDict begin H.S end
 1705 3248 a 1705 3248 a
SDict begin 13 H.A end
 1705 3248 a 1705 3248
a
SDict begin [/View [/XYZ H.V]/Dest (0:1810) cvn /DEST pdfmark end
 1705 3248 a Fe(tcp)h Fk(in)g(terms)g(of)g(connecti)n(vity)e(\(i.e.)i
(it')-5 b(s)22 b(a)e(disconnected)e(transport,)396 3356
y(unlik)o(e)624 3356 y
SDict begin H.S end
 624 3356 a 624 3356 a
SDict begin 13 H.A end
 624 3356
a 624 3356 a
SDict begin [/View [/XYZ H.V]/Dest (0:1811) cvn /DEST pdfmark end
 624 3356 a Fe(inproc)p Fk(\),)h(yet)h(we)h(don')o(t)d
(need)i(IP)g(addresses)g(or)g(DNS)h(names,)e(which)h(w)o(ould)g(be)g(a)
g(pain)g(here.)f(Instead,)h(we)396 3464 y(will)h(use)678
3464 y
SDict begin H.S end
 678 3464 a 678 3464 a
SDict begin 13 H.A end
 678 3464 a 678 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1812) cvn /DEST pdfmark end
 678
3464 a Fe(ipc)f Fk(endpoints)e(called)1396 3464 y
SDict begin H.S end
 1396
3464 a 1396 3464 a
SDict begin 13 H.A end
 1396 3464 a 1396 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1813) cvn /DEST pdfmark end
 1396 3464
a Ff(something)p Fk(-)1767 3464 y
SDict begin H.S end
 1767 3464 a 1767 3464
a
SDict begin 13 H.A end
 1767 3464 a 1767 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1814) cvn /DEST pdfmark end
 1767 3464 a Fe(local)p Fk(,)2030
3464 y
SDict begin H.S end
 2030 3464 a 2030 3464 a
SDict begin 13 H.A end
 2030 3464 a 2030 3464
a
SDict begin [/View [/XYZ H.V]/Dest (0:1815) cvn /DEST pdfmark end
 2030 3464 a Ff(something)p Fk(-)2401 3464 y
SDict begin H.S end
 2401 3464
a 2401 3464 a
SDict begin 13 H.A end
 2401 3464 a 2401 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1816) cvn /DEST pdfmark end
 2401 3464 a Fe(cloud)p
Fk(,)g(and)2805 3464 y
SDict begin H.S end
 2805 3464 a 2805 3464 a
SDict begin 13 H.A end
 2805 3464
a 2805 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1817) cvn /DEST pdfmark end
 2805 3464 a Ff(something)p Fk(-)3176 3464
y
SDict begin H.S end
 3176 3464 a 3176 3464 a
SDict begin 13 H.A end
 3176 3464 a 3176 3464 a
SDict begin [/View [/XYZ H.V]/Dest (0:1818) cvn /DEST pdfmark end
 3176
3464 a Fe(state)p Fk(,)g(where)396 3572 y
SDict begin H.S end
 396 3572 a
396 3572 a
SDict begin 13 H.A end
 396 3572 a 396 3572 a
SDict begin [/View [/XYZ H.V]/Dest (0:1819) cvn /DEST pdfmark end
 396 3572 a Ff(something)h
Fk(is)i(the)g(name)e(of)h(our)g(simulated)f(cluster)-5
b(.)-2 3755 y
SDict begin H.S end
 -2 3755 a -2 3755 a
SDict begin 13 H.A end
 -2 3755 a -2 3755 a
SDict begin [/View [/XYZ H.V]/Dest (0:1820) cvn /DEST pdfmark end

-2 3755 a 396 3846 a Fk(Y)c(ou)20 b(may)f(be)h(thinking)e(that)i(this)h
(is)g(a)f(lot)g(of)g(w)o(ork)f(for)h(some)f(names.)h(Why)f(not)h(call)g
(them)g(s1,)g(s2,)g(s3,)g(s4,)g(etc.?)g(The)396 3954
y(answer)g(is)h(that)g(if)f(your)f(brain)g(is)i(not)f(a)h(perfect)e
(machine,)g(you)g(need)h(a)g(lot)h(of)f(help)f(when)h(reading)f(code,)g
(and)h(we')o(ll)396 4062 y(see)h(that)f(these)h(names)f(do)f(help.)h
(It')-5 b(s)21 b(easier)f(to)g(remember)f("three)g(\003o)n(ws,)i(tw)o
(o)f(directions")f(than)h("six)g(dif)n(ferent)396 4170
y(sock)o(ets"\()p 0 TeXcolorgray 702 4170 a
SDict begin H.S end
 702 4170
a Fk(Figure)f(3-25)1093 4170 y
SDict begin 13 H.L end
 1093 4170 a 1093 4170
a
SDict begin [/Subtype /Link/Dest (0:figure-51) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1093 4170 a Black -2 w Fk(\).)-2 4188 y
SDict begin H.S end
 -2 4188 a -2
4188 a
SDict begin 13 H.A end
 -2 4188 a -2 4188 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-51) cvn /DEST pdfmark
end
 -2 4188 a Black 3759 5569
a Ff(131)p Black eop end
%%Page: 132 145
TeXDict begin 132 144 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.132) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:1837) cvn /DEST pdfmark end
 -2 -201 a 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g
(P)-7 b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-25.)e(Br)o(ok)o
(er)i(Sock)o(et)h(Arrangement)-2 172 y
SDict begin H.S end
 -2 172 a -2 172
a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1824) cvn /DEST pdfmark end
 -2 172 a 396 2947 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2947 a @beginspecial
0 @llx -328 @lly 312 @urx 0 @ury 3120 @rwi @setspecial
%%BeginDocument: images/fig51.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -328 312 0
%%HiResBoundingBox: 0.0 -328.0 312.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -21.800180435180664 moveto
16.800180435180664 -43.80017852783203 lineto
76.80017852783203 -43.80017852783203 lineto
76.80017852783203 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -46.80017852783203 moveto
16.800180435180664 -61.80017852783203 lineto
76.80017852783203 -61.80017852783203 lineto
76.80017852783203 -46.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.80017852783203 -21.800180435180664 moveto
88.80017852783203 -43.80017852783203 lineto
148.80018615722656 -43.80017852783203 lineto
148.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.80017852783203 -46.80017852783203 moveto
88.80017852783203 -61.80017852783203 lineto
148.80018615722656 -61.80017852783203 lineto
148.80018615722656 -46.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
160.80018615722656 -21.800180435180664 moveto
160.80018615722656 -43.80017852783203 lineto
220.80018615722656 -43.80017852783203 lineto
220.80018615722656 -21.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
160.80018615722656 -46.80017852783203 moveto
160.80018615722656 -61.80017852783203 lineto
220.80018615722656 -61.80017852783203 lineto
220.80018615722656 -46.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.800180435180664 -109.80017852783203 moveto
28.800180435180664 -123.80017852783203 lineto
86.80017852783203 -123.80017852783203 lineto
86.80017852783203 -109.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
89.80017852783203 -109.80017852783203 moveto
89.80017852783203 -123.80017852783203 lineto
146.80018615722656 -123.80017852783203 lineto
146.80018615722656 -109.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.80018615722656 -109.80017852783203 moveto
149.80018615722656 -123.80017852783203 lineto
208.80018615722656 -123.80017852783203 lineto
208.80018615722656 -109.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.800180435180664 -126.80017852783203 moveto
28.800180435180664 -149.80018615722656 lineto
86.80017852783203 -149.80018615722656 lineto
86.80017852783203 -126.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
89.80017852783203 -126.80017852783203 moveto
89.80017852783203 -149.80018615722656 lineto
146.80018615722656 -149.80018615722656 lineto
146.80018615722656 -126.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.80018615722656 -126.80017852783203 moveto
149.80018615722656 -149.80018615722656 lineto
208.80018615722656 -149.80018615722656 lineto
208.80018615722656 -126.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.800180435180664 -149.80018615722656 moveto
28.800180435180664 -181.80018615722656 lineto
208.80018615722656 -181.80018615722656 lineto
208.80018615722656 -149.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.800180435180664 -181.80018615722656 moveto
28.800180435180664 -203.80018615722656 lineto
86.80017852783203 -203.80018615722656 lineto
86.80017852783203 -181.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
89.80017852783203 -181.80018615722656 moveto
89.80017852783203 -203.80018615722656 lineto
146.80018615722656 -203.80018615722656 lineto
146.80018615722656 -181.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.80018615722656 -181.80018615722656 moveto
149.80018615722656 -203.80018615722656 lineto
208.80018615722656 -203.80018615722656 lineto
208.80018615722656 -181.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
28.800180435180664 -206.80018615722656 moveto
28.800180435180664 -221.80018615722656 lineto
86.80017852783203 -221.80018615722656 lineto
86.80017852783203 -206.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
89.80017852783203 -206.80018615722656 moveto
89.80017852783203 -221.80018615722656 lineto
146.80018615722656 -221.80018615722656 lineto
146.80018615722656 -206.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.80018615722656 -206.80018615722656 moveto
149.80018615722656 -221.80018615722656 lineto
208.80018615722656 -221.80018615722656 lineto
208.80018615722656 -206.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -269.8001708984375 moveto
16.800180435180664 -283.8001708984375 lineto
76.80017852783203 -283.8001708984375 lineto
76.80017852783203 -269.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -286.8001708984375 moveto
16.800180435180664 -309.8001708984375 lineto
76.80017852783203 -309.8001708984375 lineto
76.80017852783203 -286.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.80017852783203 -269.8001708984375 moveto
88.80017852783203 -283.8001708984375 lineto
148.80018615722656 -283.8001708984375 lineto
148.80018615722656 -269.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
88.80017852783203 -286.8001708984375 moveto
88.80017852783203 -309.8001708984375 lineto
148.80018615722656 -309.8001708984375 lineto
148.80018615722656 -286.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
160.80018615722656 -269.8001708984375 moveto
160.80018615722656 -283.8001708984375 lineto
220.80018615722656 -283.8001708984375 lineto
220.80018615722656 -269.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
160.80018615722656 -286.8001708984375 moveto
160.80018615722656 -309.8001708984375 lineto
220.80018615722656 -309.8001708984375 lineto
220.80018615722656 -286.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -20.0 moveto
15.0 -42.0 lineto
75.0 -42.0 lineto
75.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -20.0 moveto
15.0 -42.0 lineto
75.0 -42.0 lineto
75.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -45.0 moveto
15.0 -60.0 lineto
75.0 -60.0 lineto
75.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -45.0 moveto
15.0 -60.0 lineto
75.0 -60.0 lineto
75.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
87.0 -20.0 moveto
87.0 -42.0 lineto
147.0 -42.0 lineto
147.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
87.0 -20.0 moveto
87.0 -42.0 lineto
147.0 -42.0 lineto
147.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
87.0 -45.0 moveto
87.0 -60.0 lineto
147.0 -60.0 lineto
147.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
87.0 -45.0 moveto
87.0 -60.0 lineto
147.0 -60.0 lineto
147.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
159.0 -20.0 moveto
159.0 -42.0 lineto
219.0 -42.0 lineto
219.0 -20.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
159.0 -20.0 moveto
159.0 -42.0 lineto
219.0 -42.0 lineto
219.0 -20.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
159.0 -45.0 moveto
159.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
159.0 -45.0 moveto
159.0 -60.0 lineto
219.0 -60.0 lineto
219.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
27.0 -108.0 moveto
27.0 -122.0 lineto
85.0 -122.0 lineto
85.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
27.0 -108.0 moveto
27.0 -122.0 lineto
85.0 -122.0 lineto
85.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -108.0 moveto
88.0 -122.0 lineto
145.0 -122.0 lineto
145.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -108.0 moveto
88.0 -122.0 lineto
145.0 -122.0 lineto
145.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -108.0 moveto
148.0 -122.0 lineto
207.0 -122.0 lineto
207.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -108.0 moveto
148.0 -122.0 lineto
207.0 -122.0 lineto
207.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
27.0 -125.0 moveto
27.0 -148.0 lineto
85.0 -148.0 lineto
85.0 -125.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
27.0 -125.0 moveto
27.0 -148.0 lineto
85.0 -148.0 lineto
85.0 -125.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -125.0 moveto
88.0 -148.0 lineto
145.0 -148.0 lineto
145.0 -125.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -125.0 moveto
88.0 -148.0 lineto
145.0 -148.0 lineto
145.0 -125.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -125.0 moveto
148.0 -148.0 lineto
207.0 -148.0 lineto
207.0 -125.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -125.0 moveto
148.0 -148.0 lineto
207.0 -148.0 lineto
207.0 -125.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
27.0 -148.0 moveto
27.0 -180.0 lineto
207.0 -180.0 lineto
207.0 -148.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
27.0 -148.0 moveto
27.0 -180.0 lineto
207.0 -180.0 lineto
207.0 -148.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
27.0 -180.0 moveto
27.0 -202.0 lineto
85.0 -202.0 lineto
85.0 -180.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
27.0 -180.0 moveto
27.0 -202.0 lineto
85.0 -202.0 lineto
85.0 -180.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -180.0 moveto
88.0 -202.0 lineto
145.0 -202.0 lineto
145.0 -180.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -180.0 moveto
88.0 -202.0 lineto
145.0 -202.0 lineto
145.0 -180.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -180.0 moveto
148.0 -202.0 lineto
207.0 -202.0 lineto
207.0 -180.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -180.0 moveto
148.0 -202.0 lineto
207.0 -202.0 lineto
207.0 -180.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
27.0 -205.0 moveto
27.0 -220.0 lineto
85.0 -220.0 lineto
85.0 -205.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
27.0 -205.0 moveto
27.0 -220.0 lineto
85.0 -220.0 lineto
85.0 -205.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
88.0 -205.0 moveto
88.0 -220.0 lineto
145.0 -220.0 lineto
145.0 -205.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
88.0 -205.0 moveto
88.0 -220.0 lineto
145.0 -220.0 lineto
145.0 -205.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -205.0 moveto
148.0 -220.0 lineto
207.0 -220.0 lineto
207.0 -205.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -205.0 moveto
148.0 -220.0 lineto
207.0 -220.0 lineto
207.0 -205.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -268.0 moveto
15.0 -282.0 lineto
75.0 -282.0 lineto
75.0 -268.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -268.0 moveto
15.0 -282.0 lineto
75.0 -282.0 lineto
75.0 -268.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -285.0 moveto
15.0 -308.0 lineto
75.0 -308.0 lineto
75.0 -285.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -285.0 moveto
15.0 -308.0 lineto
75.0 -308.0 lineto
75.0 -285.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
87.0 -268.0 moveto
87.0 -282.0 lineto
147.0 -282.0 lineto
147.0 -268.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
87.0 -268.0 moveto
87.0 -282.0 lineto
147.0 -282.0 lineto
147.0 -268.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
87.0 -285.0 moveto
87.0 -308.0 lineto
147.0 -308.0 lineto
147.0 -285.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
87.0 -285.0 moveto
87.0 -308.0 lineto
147.0 -308.0 lineto
147.0 -285.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
159.0 -268.0 moveto
159.0 -282.0 lineto
219.0 -282.0 lineto
219.0 -268.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
159.0 -268.0 moveto
159.0 -282.0 lineto
219.0 -282.0 lineto
219.0 -268.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
159.0 -285.0 moveto
159.0 -308.0 lineto
219.0 -308.0 lineto
219.0 -285.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
159.0 -285.0 moveto
159.0 -308.0 lineto
219.0 -308.0 lineto
219.0 -285.0 lineto
closepath
stroke
newpath
45.0 -72.0 moveto
45.0 -84.0 lineto
57.0 -84.0 lineto
57.0 -100.0 lineto
stroke
newpath
117.0 -72.0 moveto
117.0 -100.0 lineto
stroke
newpath
189.0 -72.0 moveto
189.0 -84.0 lineto
177.0 -84.0 lineto
177.0 -100.0 lineto
stroke
newpath
57.0 -232.0 moveto
57.0 -244.0 lineto
45.0 -244.0 lineto
45.0 -260.0 lineto
stroke
newpath
117.0 -232.0 moveto
117.0 -260.0 lineto
stroke
newpath
177.0 -232.0 moveto
177.0 -244.0 lineto
189.0 -244.0 lineto
189.0 -260.0 lineto
stroke
newpath
54.0 -96.0 moveto
57.0 -104.0 lineto
60.0 -96.0 lineto
closepath
fill
newpath
114.0 -96.0 moveto
117.0 -104.0 lineto
120.0 -96.0 lineto
closepath
fill
newpath
174.0 -96.0 moveto
177.0 -104.0 lineto
180.0 -96.0 lineto
closepath
fill
newpath
42.0 -256.0 moveto
45.0 -264.0 lineto
48.0 -256.0 lineto
closepath
fill
newpath
114.0 -256.0 moveto
117.0 -264.0 lineto
120.0 -256.0 lineto
closepath
fill
newpath
186.0 -256.0 moveto
189.0 -264.0 lineto
192.0 -256.0 lineto
closepath
fill
/Helvetica findfont
8 scalefont setfont
29.0 -31.0 moveto
(Client) show
96.0 -31.0 moveto
(Broker) show
96.0 -39.0 moveto
(cloudbe) show
168.0 -31.0 moveto
(Broker) show
168.0 -39.0 moveto
(statebe) show
27.0 -55.0 moveto
(connect) show
99.0 -55.0 moveto
(connect) show
176.0 -55.0 moveto
(bind) show
28.0 -71.0 moveto
(request) show
100.0 -71.0 moveto
(request) show
178.0 -71.0 moveto
(state) show
44.0 -119.0 moveto
(bind) show
104.0 -119.0 moveto
(bind) show
159.0 -119.0 moveto
(connect) show
36.0 -135.0 moveto
(localfe) show
36.0 -143.0 moveto
(ROUTER) show
96.0 -135.0 moveto
(cloudfe) show
96.0 -143.0 moveto
(ROUTER) show
162.0 -135.0 moveto
(statefe) show
169.0 -143.0 moveto
(SUB) show
240.0 -135.0 moveto
(Frontends) show
240.0 -143.0 moveto
(\(incoming\)) show
99.0 -167.0 moveto
(Broker) show
36.0 -191.0 moveto
(ROUTER) show
36.0 -199.0 moveto
(localbe) show
96.0 -191.0 moveto
(ROUTER) show
96.0 -199.0 moveto
(cloudbe) show
169.0 -191.0 moveto
(PUB) show
160.0 -199.0 moveto
(statebe) show
240.0 -191.0 moveto
(Backends) show
240.0 -199.0 moveto
(\(outgoing\)) show
44.0 -215.0 moveto
(bind) show
99.0 -215.0 moveto
(connect) show
164.0 -215.0 moveto
(bind) show
40.0 -231.0 moveto
(request) show
100.0 -231.0 moveto
(request) show
166.0 -231.0 moveto
(state) show
27.0 -279.0 moveto
(connect) show
104.0 -279.0 moveto
(bind) show
171.0 -279.0 moveto
(connect) show
26.0 -295.0 moveto
(Worker) show
96.0 -295.0 moveto
(Broker) show
96.0 -303.0 moveto
(cloudfe) show
168.0 -295.0 moveto
(Broker) show
168.0 -303.0 moveto
(statefe) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2947 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2947 a 274 x Fk(Note)f(that)h(we)f(connect)
f(the)h(cloudbe)f(in)h(each)g(brok)o(er)f(to)h(the)g(cloudfe)f(in)h(e)n
(v)o(ery)f(other)h(brok)o(er)m(,)e(and)h(lik)o(e)n(wise)i(we)396
3329 y(connect)e(the)h(statebe)h(in)f(each)g(brok)o(er)f(to)h(the)g
(statefe)h(in)f(e)n(v)o(ery)f(other)g(brok)o(er)-5 b(.)-2
3357 y
SDict begin H.S end
 -2 3357 a -2 3357 a
SDict begin 13 H.A end
 -2 3357 a -2 3357 a
SDict begin [/View [/XYZ H.V]/Dest (0:1828) cvn /DEST pdfmark end
 -2 3357
a 396 3668 a Fb(3.9.6.)36 b(Pr)n(ototyping)c(the)i(State)f(Flo)n(w)2238
3668 y
SDict begin H.S end
 2238 3668 a 2238 3668 a
SDict begin 18.72 H.A end
 2238 3668 a 2238 3668
a
SDict begin [/View [/XYZ H.V]/Dest (8.54.10.2) cvn /DEST pdfmark end
 2238 3668 a -2 3860 a
SDict begin H.S end
 -2 3860 a -2 3860 a
SDict begin 13 H.A end
 -2 3860 a
-2 3860 a
SDict begin [/View [/XYZ H.V]/Dest (0:1830) cvn /DEST pdfmark end
 -2 3860 a 396 3942 a Fk(Since)20 b(each)g(sock)o(et)g(\003o)n
(w)h(has)f(its)h(o)n(wn)f(little)h(traps)f(for)g(the)g(unw)o(ary)-5
b(,)18 b(we)j(will)g(test)g(them)f(in)g(real)g(code)g(one)f(by)h(one,)
396 4049 y(rather)g(than)f(try)h(to)h(thro)n(w)e(the)h(whole)g(lot)g
(into)g(code)g(in)g(one)g(go.)f(When)h(we')l(re)g(happ)o(y)f(with)h
(each)g(\003o)n(w)-5 b(,)20 b(we)g(can)g(put)396 4157
y(them)g(together)f(into)h(a)g(full)h(program.)c(W)-7
b(e')o(ll)22 b(start)e(with)h(the)f(state)h(\003o)n(w\()p
0 TeXcolorgray 2546 4157 a
SDict begin H.S end
 2546 4157 a Fk(Figure)e(3-26)2937
4157 y
SDict begin 13 H.L end
 2937 4157 a 2937 4157 a
SDict begin [/Subtype /Link/Dest (0:figure-52) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2937 4157 a Black -2 w
Fk(\).)-2 4175 y
SDict begin H.S end
 -2 4175 a -2 4175 a
SDict begin 13 H.A end
 -2 4175 a -2 4175
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-52) cvn /DEST pdfmark
end
 -2 4175 a Black 3759 5569 a Ff(132)p Black eop end
%%Page: 133 146
TeXDict begin 133 145 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.133) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Figur)o(e)20 b(3-26.)e(The)k(State)d(Flo)
o(w)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1834) cvn /DEST pdfmark end
 -2 172
a 396 4314 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4314 a @beginspecial 0 @llx -492 @lly
333 @urx 0 @ury 3330 @rwi @setspecial
%%BeginDocument: images/fig52.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -492 333 0
%%HiResBoundingBox: 0.0 -492.0 333.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
222.7002716064453 -32.70027160644531 moveto
222.7002716064453 -66.70027160644531 lineto
312.70025634765625 -66.70027160644531 lineto
312.70025634765625 -32.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
222.7002716064453 -69.70027160644531 moveto
222.7002716064453 -92.70027160644531 lineto
312.70025634765625 -92.70027160644531 lineto
312.70025634765625 -69.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -164.7002716064453 moveto
24.70026969909668 -186.7002716064453 lineto
112.70027160644531 -186.7002716064453 lineto
112.70027160644531 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.70027160644531 -164.7002716064453 moveto
115.70027160644531 -186.7002716064453 lineto
202.7002716064453 -186.7002716064453 lineto
202.7002716064453 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
205.7002716064453 -164.7002716064453 moveto
205.7002716064453 -186.7002716064453 lineto
294.70025634765625 -186.7002716064453 lineto
294.70025634765625 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -189.7002716064453 moveto
24.70026969909668 -224.7002716064453 lineto
112.70027160644531 -224.7002716064453 lineto
112.70027160644531 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.70027160644531 -189.7002716064453 moveto
115.70027160644531 -224.7002716064453 lineto
202.7002716064453 -224.7002716064453 lineto
202.7002716064453 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
205.7002716064453 -189.7002716064453 moveto
205.7002716064453 -224.7002716064453 lineto
294.70025634765625 -224.7002716064453 lineto
294.70025634765625 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -224.7002716064453 moveto
24.70026969909668 -272.70025634765625 lineto
294.70025634765625 -272.70025634765625 lineto
294.70025634765625 -224.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -272.70025634765625 moveto
24.70026969909668 -306.70025634765625 lineto
112.70027160644531 -306.70025634765625 lineto
112.70027160644531 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.70027160644531 -272.70025634765625 moveto
115.70027160644531 -306.70025634765625 lineto
202.7002716064453 -306.70025634765625 lineto
202.7002716064453 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
205.7002716064453 -272.70025634765625 moveto
205.7002716064453 -306.70025634765625 lineto
294.70025634765625 -306.70025634765625 lineto
294.70025634765625 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -309.70025634765625 moveto
24.70026969909668 -332.70025634765625 lineto
112.70027160644531 -332.70025634765625 lineto
112.70027160644531 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.70027160644531 -309.70025634765625 moveto
115.70027160644531 -332.70025634765625 lineto
202.7002716064453 -332.70025634765625 lineto
202.7002716064453 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
205.7002716064453 -309.70025634765625 moveto
205.7002716064453 -332.70025634765625 lineto
294.70025634765625 -332.70025634765625 lineto
294.70025634765625 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
222.7002716064453 -404.70025634765625 moveto
222.7002716064453 -426.70025634765625 lineto
312.70025634765625 -426.70025634765625 lineto
312.70025634765625 -404.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
222.7002716064453 -429.70025634765625 moveto
222.7002716064453 -464.70025634765625 lineto
312.70025634765625 -464.70025634765625 lineto
312.70025634765625 -429.70025634765625 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
220.0 -30.0 moveto
220.0 -64.0 lineto
310.0 -64.0 lineto
310.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.9 setlinewidth
1 setlinecap
[] 0 setdash
newpath
220.0 -30.0 moveto
220.0 -64.0 lineto
310.0 -64.0 lineto
310.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
220.0 -67.0 moveto
220.0 -90.0 lineto
310.0 -90.0 lineto
310.0 -67.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
220.0 -67.0 moveto
220.0 -90.0 lineto
310.0 -90.0 lineto
310.0 -67.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -162.0 moveto
22.0 -184.0 lineto
110.0 -184.0 lineto
110.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -162.0 moveto
22.0 -184.0 lineto
110.0 -184.0 lineto
110.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
113.0 -162.0 moveto
113.0 -184.0 lineto
200.0 -184.0 lineto
200.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
113.0 -162.0 moveto
113.0 -184.0 lineto
200.0 -184.0 lineto
200.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
203.0 -162.0 moveto
203.0 -184.0 lineto
292.0 -184.0 lineto
292.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
203.0 -162.0 moveto
203.0 -184.0 lineto
292.0 -184.0 lineto
292.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -187.0 moveto
22.0 -222.0 lineto
110.0 -222.0 lineto
110.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -187.0 moveto
22.0 -222.0 lineto
110.0 -222.0 lineto
110.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
113.0 -187.0 moveto
113.0 -222.0 lineto
200.0 -222.0 lineto
200.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
113.0 -187.0 moveto
113.0 -222.0 lineto
200.0 -222.0 lineto
200.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
203.0 -187.0 moveto
203.0 -222.0 lineto
292.0 -222.0 lineto
292.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
203.0 -187.0 moveto
203.0 -222.0 lineto
292.0 -222.0 lineto
292.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -222.0 moveto
22.0 -270.0 lineto
292.0 -270.0 lineto
292.0 -222.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -222.0 moveto
22.0 -270.0 lineto
292.0 -270.0 lineto
292.0 -222.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -270.0 moveto
22.0 -304.0 lineto
110.0 -304.0 lineto
110.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -270.0 moveto
22.0 -304.0 lineto
110.0 -304.0 lineto
110.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
113.0 -270.0 moveto
113.0 -304.0 lineto
200.0 -304.0 lineto
200.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
113.0 -270.0 moveto
113.0 -304.0 lineto
200.0 -304.0 lineto
200.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
203.0 -270.0 moveto
203.0 -304.0 lineto
292.0 -304.0 lineto
292.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
203.0 -270.0 moveto
203.0 -304.0 lineto
292.0 -304.0 lineto
292.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -307.0 moveto
22.0 -330.0 lineto
110.0 -330.0 lineto
110.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -307.0 moveto
22.0 -330.0 lineto
110.0 -330.0 lineto
110.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
113.0 -307.0 moveto
113.0 -330.0 lineto
200.0 -330.0 lineto
200.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
113.0 -307.0 moveto
113.0 -330.0 lineto
200.0 -330.0 lineto
200.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
203.0 -307.0 moveto
203.0 -330.0 lineto
292.0 -330.0 lineto
292.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
203.0 -307.0 moveto
203.0 -330.0 lineto
292.0 -330.0 lineto
292.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
220.0 -402.0 moveto
220.0 -424.0 lineto
310.0 -424.0 lineto
310.0 -402.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
220.0 -402.0 moveto
220.0 -424.0 lineto
310.0 -424.0 lineto
310.0 -402.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
220.0 -427.0 moveto
220.0 -462.0 lineto
310.0 -462.0 lineto
310.0 -427.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
220.0 -427.0 moveto
220.0 -462.0 lineto
310.0 -462.0 lineto
310.0 -427.0 lineto
closepath
stroke
newpath
265.0 -108.0 moveto
265.0 -126.0 lineto
247.0 -126.0 lineto
247.0 -150.0 lineto
stroke
newpath
247.0 -348.0 moveto
247.0 -366.0 lineto
265.0 -366.0 lineto
265.0 -390.0 lineto
stroke
newpath
243.0 -144.0 moveto
247.0 -156.0 lineto
252.0 -144.0 lineto
closepath
fill
newpath
261.0 -384.0 moveto
265.0 -396.0 lineto
270.0 -384.0 lineto
closepath
fill
/Helvetica findfont
13 scalefont setfont
234.0 -47.0 moveto
(Broker) show
234.0 -59.0 moveto
(statebe) show
245.0 -83.0 moveto
(bind) show
246.0 -107.0 moveto
(state) show
218.0 -179.0 moveto
(connect) show
221.0 -203.0 moveto
(statefe) show
234.0 -214.0 moveto
(SUB) show
129.0 -251.0 moveto
(Broker) show
234.0 -286.0 moveto
(PUB) show
219.0 -299.0 moveto
(statebe) show
227.0 -323.0 moveto
(bind) show
228.0 -347.0 moveto
(state) show
236.0 -419.0 moveto
(connect) show
234.0 -443.0 moveto
(statefe) show
234.0 -455.0 moveto
(Broker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4314 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4314 a 274 x Fk(Here)h(is)h(ho)n(w)f(this)h
(w)o(orks)f(in)g(code:)-2 4589 y
SDict begin H.S end
 -2 4589 a -2 4589 a
SDict begin 13 H.A end

-2 4589 a -2 4589 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering1-c) cvn /DEST pdfmark
end
 -2 4589 a 396 4789 a Fg(Example)h(3-21.)d(Pr)o
(ototype)g(state)i(\003o)o(w)g(\(peering1.c\))-2 4889
y
SDict begin H.S end
 -2 4889 a -2 4889 a
SDict begin 11.7 H.A end
 -2 4889 a -2 4889 a
SDict begin [/View [/XYZ H.V]/Dest (0:1840) cvn /DEST pdfmark end
 -2 4889 a 396
4969 a Fe(//)396 5066 y(//)90 b(Broker)43 b(peering)h(simulation)f
(\(part)h(1\))396 5164 y(//)90 b(Prototypes)43 b(the)h(state)g(flow)p
Black 3759 5569 a Ff(133)p Black eop end
%%Page: 134 147
TeXDict begin 134 146 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.134) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fe(//)396 170 y(#include)44
b("czmq.h")396 364 y(int)h(main)f(\(int)g(argc,)g(char)1517
377 y(*)1562 364 y(argv)g([]\))396 461 y({)576 558 y(//)89
b(First)44 b(argument)f(is)i(this)f(broker's)g(name)576
655 y(//)89 b(Other)44 b(arguments)f(are)i(our)f(peers')g(names)576
752 y(//)576 850 y(if)g(\(argc)g(<)h(2\))f({)755 947
y(printf)g(\("syntax:)f(peering1)h(me)g({you}...\\n"\);)755
1044 y(exit)g(\(EXIT_FAILURE\);)576 1141 y(})576 1238
y(char)800 1251 y(*)845 1238 y(self)g(=)g(argv)h([1];)576
1335 y(printf)e(\("I:)i(preparing)e(broker)h(at)g(\045s...\\n",)g
(self\);)576 1432 y(srandom)f(\(\(unsigned\))g(time)h(\(NULL\)\);)576
1627 y(zctx_t)889 1640 y(*)934 1627 y(ctx)h(=)f(zctx_new)g(\(\);)576
1821 y(//)89 b(Bind)44 b(state)g(backend)g(to)g(endpoint)576
1918 y(void)800 1931 y(*)845 1918 y(statebe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_PUB\);)576 2015 y(zsocket_bind)e(\(statebe,)i
("ipc://\045s-state.ipc",)d(self\);)576 2209 y(//)89
b(Connect)44 b(statefe)f(to)i(all)f(peers)576 2307 y(void)800
2320 y(*)845 2307 y(statefe)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_SUB\);)576
2404 y(zsockopt_set_subscribe)d(\(statefe,)i(""\);)576
2501 y(int)h(argn;)576 2598 y(for)g(\(argn)g(=)h(2;)f(argn)g(<)h(argc;)
f(argn++\))g({)755 2695 y(char)979 2708 y(*)1024 2695
y(peer)g(=)h(argv)f([argn];)755 2792 y(printf)g(\("I:)g(connecting)f
(to)i(state)f(backend)f(at)i('\045s'\\n",)e(peer\);)755
2889 y(zsocket_connect)f(\(statefe,)i("ipc://\045s-state.ipc",)d
(peer\);)576 2987 y(})-2 3161 y
SDict begin H.S end
 -2 3161 a -2 3161 a
SDict begin 13 H.A end
 -2
3161 a -2 3161 a
SDict begin [/View [/XYZ H.V]/Dest (0:1841) cvn /DEST pdfmark end
 -2 3161 a 396 3261 a Fk(The)20 b(main)g(loop)f(sends)i
(out)e(status)i(messages)g(to)f(peers,)g(and)f(collects)i(status)f
(messages)h(back)e(from)g(peers.)h(The)396 3368 y(zmq_poll)f(timeout)g
(de\002nes)h(our)g(o)n(wn)f(heartbeat:)-2 3386 y
SDict begin H.S end
 -2 3386
a -2 3386 a
SDict begin 13 H.A end
 -2 3386 a -2 3386 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering1-c-1) cvn /DEST pdfmark
end
 -2 3386 a 396 3570 a
Fg(Example)i(3-22.)d(Pr)o(ototype)g(state)i(\003o)o(w)g(\(peering1.c\))
f(-)h(main)h(loop)-2 3670 y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 11.7 H.A end
 -2 3670
a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:1844) cvn /DEST pdfmark end
 -2 3670 a 576 3750 a Fe(while)44 b(\(true\))f({)755
3847 y(//)89 b(Poll)44 b(for)h(activity,)e(or)i(1)f(second)g(timeout)
755 3944 y(zmq_pollitem_t)e(items)i([])h(=)g({)f({)h(statefe,)e(0,)i
(ZMQ_POLLIN,)e(0)i(})f(};)755 4041 y(int)g(rc)h(=)f(zmq_poll)g
(\(items,)g(1,)g(1000)2279 4054 y(*)2369 4041 y(ZMQ_POLL_MSEC\);)755
4138 y(if)g(\(rc)h(==)f(-1\))934 4236 y(break;)627 b(//)89
b(Interrupted)755 4430 y(//)g(Handle)44 b(incoming)g(status)f(messages)
755 4527 y(if)h(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
4624 y(char)1158 4637 y(*)1203 4624 y(peer_name)h(=)g(zstr_recv)g
(\(statefe\);)934 4721 y(char)1158 4734 y(*)1203 4721
y(available)g(=)g(zstr_recv)g(\(statefe\);)934 4818 y(printf)g
(\("\045s)g(-)h(\045s)f(workers)g(free\\n",)g(peer_name,)f
(available\);)934 4916 y(free)h(\(peer_name\);)934 5013
y(free)g(\(available\);)755 5110 y(})p Black 3759 5569
a Ff(134)p Black eop end
%%Page: 135 148
TeXDict begin 135 147 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.135) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(else)44 b({)934 170 y(//)90
b(Send)44 b(random)g(values)f(for)i(worker)f(availability)934
267 y(zstr_sendm)f(\(statebe,)h(self\);)934 364 y(zstr_sendf)f
(\(statebe,)h("\045d",)g(randof)g(\(10\)\);)755 461 y(})576
558 y(})576 655 y(zctx_destroy)e(\(&ctx\);)576 752 y(return)h
(EXIT_SUCCESS;)396 850 y(})-2 1024 y
SDict begin H.S end
 -2 1024 a -2 1024
a
SDict begin 13 H.A end
 -2 1024 a -2 1024 a
SDict begin [/View [/XYZ H.V]/Dest (0:1845) cvn /DEST pdfmark end
 -2 1024 a 396 1124 a Fk(Notes)21
b(about)e(this)i(code:)-2 1125 y
SDict begin H.S end
 -2 1125 a -2 1125 a
SDict begin 13 H.A end

-2 1125 a -2 1125 a
SDict begin [/View [/XYZ H.V]/Dest (0:1846) cvn /DEST pdfmark end
 -2 1125 a -2 1135 a
SDict begin H.S end
 -2 1135 a -2
1135 a
SDict begin 13 H.A end
 -2 1135 a -2 1135 a
SDict begin [/View [/XYZ H.V]/Dest (0:1847) cvn /DEST pdfmark end
 -2 1135 a Black 396 1294 a
Fj(\225)p Black 479 1294 a
SDict begin H.S end
 479 1294 a 479 1294 a
SDict begin 13 H.A end
 479
1294 a 479 1294 a
SDict begin [/View [/XYZ H.V]/Dest (0:1848) cvn /DEST pdfmark end
 479 1294 a Fk(Each)f(brok)o(er)f(has)h(an)g(identity)
g(that)g(we)g(use)h(to)f(construct)2212 1294 y
SDict begin H.S end
 2212 1294
a 2212 1294 a
SDict begin 13 H.A end
 2212 1294 a 2212 1294 a
SDict begin [/View [/XYZ H.V]/Dest (0:1849) cvn /DEST pdfmark end
 2212 1294 a Fe(ipc)h
Fk(endpoint)d(names.)i(A)g(real)g(brok)o(er)f(w)o(ould)h(need)f(to)479
1402 y(w)o(ork)h(with)g(TCP)h(and)f(a)g(more)g(sophisticated)f
(con\002guration)f(scheme.)h(W)-7 b(e')o(ll)21 b(look)f(at)g(such)g
(schemes)g(later)h(in)479 1510 y(this)g(book)e(b)n(ut)h(for)g(no)n(w)-5
b(,)19 b(using)g(generated)1771 1510 y
SDict begin H.S end
 1771 1510 a 1771
1510 a
SDict begin 13 H.A end
 1771 1510 a 1771 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:1850) cvn /DEST pdfmark end
 1771 1510 a Fe(ipc)h Fk(names)g(lets)h
(us)f(ignore)f(the)i(problem)d(of)i(where)f(to)i(get)f(TCP/IP)479
1618 y(addresses)g(or)g(names)g(from.)-2 1619 y
SDict begin H.S end
 -2 1619
a -2 1619 a
SDict begin 13 H.A end
 -2 1619 a -2 1619 a
SDict begin [/View [/XYZ H.V]/Dest (0:1851) cvn /DEST pdfmark end
 -2 1619 a Black 396 1767
a Fj(\225)p Black 479 1767 a
SDict begin H.S end
 479 1767 a 479 1767 a
SDict begin 13 H.A end
 479
1767 a 479 1767 a
SDict begin [/View [/XYZ H.V]/Dest (0:1852) cvn /DEST pdfmark end
 479 1767 a Fk(W)-7 b(e)22 b(use)e(a)h(zmq_poll[3])c
(loop)i(as)i(the)f(core)g(of)g(the)g(program.)e(This)i(processes)g
(incoming)f(messages)h(and)g(sends)479 1875 y(out)g(state)h(messages.)f
(W)-7 b(e)22 b(send)d(a)i(state)g(message)1969 1875 y
SDict begin H.S end

1969 1875 a 1969 1875 a
SDict begin 13 H.A end
 1969 1875 a 1969 1875 a
SDict begin [/View [/XYZ H.V]/Dest (0:1853) cvn /DEST pdfmark end
 1969
1875 a Ff(only)f Fk(if)g(we)h(did)f(not)f(get)i(an)o(y)e(incoming)f
(messages)3506 1875 y
SDict begin H.S end
 3506 1875 a 3506 1875 a
SDict begin 13 H.A end
 3506 1875
a 3506 1875 a
SDict begin [/View [/XYZ H.V]/Dest (0:1854) cvn /DEST pdfmark end
 3506 1875 a Ff(and)j Fk(we)479 1983 y(w)o(aited)g(for)e
(a)i(second.)e(If)h(we)g(send)g(out)g(a)h(state)g(message)f(each)g
(time)g(we)h(get)f(one)f(in,)h(we')o(ll)h(get)f(message)g(storms.)-2
2001 y
SDict begin H.S end
 -2 2001 a -2 2001 a
SDict begin 13 H.A end
 -2 2001 a -2 2001 a
SDict begin [/View [/XYZ H.V]/Dest (0:1855) cvn /DEST pdfmark end
 -2 2001
a Black 396 2132 a Fj(\225)p Black 479 2132 a
SDict begin H.S end
 479 2132
a 479 2132 a
SDict begin 13 H.A end
 479 2132 a 479 2132 a
SDict begin [/View [/XYZ H.V]/Dest (0:1856) cvn /DEST pdfmark end
 479 2132 a Fk(W)-7
b(e)22 b(use)e(a)h(tw)o(o-part)e(pubsub)f(message)j(consisting)e(of)h
(sender)f(address)h(and)g(data.)g(Note)g(that)g(we)h(will)f(need)g(to)
479 2240 y(kno)n(w)f(the)g(address)g(of)h(the)f(publisher)f(in)i(order)
e(to)i(send)f(it)h(tasks,)g(and)f(the)h(only)f(w)o(ay)g(is)i(to)e(send)
g(this)i(e)o(xplicitly)d(as)479 2348 y(a)j(part)f(of)g(the)g(message.)
-2 2366 y
SDict begin H.S end
 -2 2366 a -2 2366 a
SDict begin 13 H.A end
 -2 2366 a -2 2366 a
SDict begin [/View [/XYZ H.V]/Dest (0:1857) cvn /DEST pdfmark end
 -2
2366 a Black 396 2498 a Fj(\225)p Black 479 2498 a
SDict begin H.S end
 479
2498 a 479 2498 a
SDict begin 13 H.A end
 479 2498 a 479 2498 a
SDict begin [/View [/XYZ H.V]/Dest (0:1858) cvn /DEST pdfmark end
 479 2498 a Fk(W)-7
b(e)22 b(don')o(t)c(set)j(identities)f(on)g(subscribers,)f(because)h
(if)g(we)h(did)f(then)f(we')l(d)h(get)g(out)g(of)g(date)g(state)h
(information)479 2605 y(when)f(connecting)e(to)i(running)e(brok)o(ers.)
-2 2623 y
SDict begin H.S end
 -2 2623 a -2 2623 a
SDict begin 13 H.A end
 -2 2623 a -2 2623 a
SDict begin [/View [/XYZ H.V]/Dest (0:1859) cvn /DEST pdfmark end
 -2
2623 a Black 396 2755 a Fj(\225)p Black 479 2755 a
SDict begin H.S end
 479
2755 a 479 2755 a
SDict begin 13 H.A end
 479 2755 a 479 2755 a
SDict begin [/View [/XYZ H.V]/Dest (0:1860) cvn /DEST pdfmark end
 479 2755 a Fk(W)-7
b(e)22 b(don')o(t)c(set)j(a)g(HWM)g(on)e(the)i(publisher)m(,)d(b)n(ut)i
(if)g(we)h(were)f(using)g(\330MQ/2.x)f(that)h(w)o(ould)g(be)g(a)h(wise)
g(idea.)-2 2939 y
SDict begin H.S end
 -2 2939 a -2 2939 a
SDict begin 13 H.A end
 -2 2939 a -2 2939
a
SDict begin [/View [/XYZ H.V]/Dest (0:1861) cvn /DEST pdfmark end
 -2 2939 a 396 3029 a Fk(W)-7 b(e)22 b(can)e(b)n(uild)f(this)i(little)
g(program)d(and)i(run)f(it)i(three)f(times)h(to)f(simulate)g(three)g
(clusters.)g(Let')-5 b(s)21 b(call)f(them)g(DC1,)396
3137 y(DC2,)h(and)e(DC3)i(\(the)f(names)g(are)g(arbitrary\).)e(W)-7
b(e)21 b(run)e(these)i(three)f(commands,)e(each)i(in)g(a)h(separate)e
(windo)n(w:)-2 3238 y
SDict begin H.S end
 -2 3238 a -2 3238 a
SDict begin 11.7 H.A end
 -2 3238 a -2
3238 a
SDict begin [/View [/XYZ H.V]/Dest (0:1862) cvn /DEST pdfmark end
 -2 3238 a 396 3317 a Fe(peering1)44 b(DC1)g(DC2)g(DC3)90
b(#)f(Start)44 b(DC1)g(and)h(connect)e(to)i(DC2)f(and)h(DC3)396
3414 y(peering1)f(DC2)g(DC1)g(DC3)90 b(#)f(Start)44 b(DC2)g(and)h
(connect)e(to)i(DC1)f(and)h(DC3)396 3511 y(peering1)f(DC3)g(DC1)g(DC2)
90 b(#)f(Start)44 b(DC3)g(and)h(connect)e(to)i(DC1)f(and)h(DC2)-2
3689 y
SDict begin H.S end
 -2 3689 a -2 3689 a
SDict begin 13 H.A end
 -2 3689 a -2 3689 a
SDict begin [/View [/XYZ H.V]/Dest (0:1863) cvn /DEST pdfmark end
 -2 3689
a 396 3785 a Fk(Y)-9 b(ou')o(ll)20 b(see)h(each)e(cluster)i(report)e
(the)h(state)h(of)f(its)h(peers,)e(and)h(after)g(a)h(fe)n(w)f(seconds)f
(the)o(y)h(will)h(all)g(happily)d(be)396 3893 y(printing)h(random)f
(numbers)h(once)h(per)f(second.)g(T)m(ry)h(this)h(and)e(satisfy)i
(yourself)e(that)h(the)g(three)g(brok)o(ers)f(all)i(match)396
4001 y(up)f(and)g(synchronize)e(to)i(per)n(-second)e(state)j(updates.)
-2 4185 y
SDict begin H.S end
 -2 4185 a -2 4185 a
SDict begin 13 H.A end
 -2 4185 a -2 4185 a
SDict begin [/View [/XYZ H.V]/Dest (0:1864) cvn /DEST pdfmark end
 -2
4185 a 396 4275 a Fk(In)f(real)g(life)h(we')l(d)e(not)h(send)g(out)g
(state)h(messages)f(at)h(re)o(gular)e(interv)n(als)g(b)n(ut)h(rather)g
(whene)n(v)o(er)e(we)i(had)g(a)h(state)396 4383 y(change,)e(i.e.)h
(whene)n(v)o(er)e(a)j(w)o(ork)o(er)e(becomes)g(a)n(v)n(ailable)h(or)g
(una)n(v)n(ailable.)e(That)i(may)g(seem)g(lik)o(e)h(a)g(lot)f(of)g
(traf)n(\002c)g(b)n(ut)396 4491 y(state)h(messages)g(are)f(small)g(and)
g(we')l(v)o(e)f(established)h(that)g(the)g(inter)n(-cluster)g
(connections)e(are)i(super)n(-f)o(ast.)-2 4675 y
SDict begin H.S end
 -2 4675
a -2 4675 a
SDict begin 13 H.A end
 -2 4675 a -2 4675 a
SDict begin [/View [/XYZ H.V]/Dest (0:1865) cvn /DEST pdfmark end
 -2 4675 a 396 4765 a
Fk(If)g(we)h(w)o(anted)f(to)g(send)g(state)h(messages)f(at)h(precise)f
(interv)n(als)f(we')l(d)h(create)g(a)g(child)g(thread)f(and)h(open)f
(the)h(statebe)396 4873 y(sock)o(et)g(in)h(that)f(thread.)f(W)-7
b(e')l(d)20 b(then)g(send)g(irre)o(gular)e(state)j(updates)f(to)g(that)
g(child)g(thread)f(from)g(our)h(main)g(thread,)396 4981
y(and)g(allo)n(w)g(the)g(child)g(thread)f(to)i(con\003ate)e(them)h
(into)g(re)o(gular)f(outgoing)f(messages.)i(This)g(is)h(more)f(w)o(ork)
f(than)h(we)396 5089 y(need)g(here.)-2 5100 y
SDict begin H.S end
 -2 5100
a -2 5100 a
SDict begin 13 H.A end
 -2 5100 a -2 5100 a
SDict begin [/View [/XYZ H.V]/Dest (0:1866) cvn /DEST pdfmark end
 -2 5100 a Black 3759
5569 a Ff(135)p Black eop end
%%Page: 136 149
TeXDict begin 136 148 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.136) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 77 a Fb(3.9.7.)36 b(Pr)n(ototyping)c(the)i(Local)
g(and)g(Cloud)g(Flo)n(ws)2942 77 y
SDict begin H.S end
 2942 77 a 2942 77
a
SDict begin 18.72 H.A end
 2942 77 a 2942 77 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.11.2) cvn /DEST pdfmark end
 2942 77 a -2 269 a
SDict begin H.S end
 -2 269 a -2
269 a
SDict begin 13 H.A end
 -2 269 a -2 269 a
SDict begin [/View [/XYZ H.V]/Dest (0:1868) cvn /DEST pdfmark end
 -2 269 a 396 351 a Fk(Let')-5
b(s)21 b(no)n(w)f(prototype)e(at)i(the)h(\003o)n(w)f(of)g(tasks)h(via)f
(the)g(local)g(and)g(cloud)f(sock)o(ets\()p 0 TeXcolorgray
2774 351 a
SDict begin H.S end
 2774 351 a Fk(Figure)g(3-27)3165 351 y
SDict begin 13 H.L end
 3165
351 a 3165 351 a
SDict begin [/Subtype /Link/Dest (0:figure-53) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3165 351 a Black -2 w Fk(\).)h(This)g(code)g(pulls)396
459 y(requests)g(from)f(clients)i(and)e(then)h(distrib)n(utes)g(them)g
(to)g(local)g(w)o(ork)o(ers)g(and)g(cloud)f(peers)h(on)g(a)g(random)f
(basis.)-2 477 y
SDict begin H.S end
 -2 477 a -2 477 a
SDict begin 13 H.A end
 -2 477 a -2 477 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-53) cvn /DEST pdfmark
end

-2 477 a 396 660 a Fg(Figur)o(e)h(3-27.)e(The)k(Flo)o(w)e(of)g(T)-8
b(asks)-2 760 y
SDict begin H.S end
 -2 760 a -2 760 a
SDict begin 13 H.A end
 -2 760 a -2 760 a
SDict begin [/View [/XYZ H.V]/Dest (0:1872) cvn /DEST pdfmark end
 -2
760 a 396 4901 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4901 a @beginspecial 0 @llx -492
@lly 333 @urx 0 @ury 3330 @rwi @setspecial
%%BeginDocument: images/fig53.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -492 333 0
%%HiResBoundingBox: 0.0 -492.0 333.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -32.70027160644531 moveto
24.70026969909668 -66.70027160644531 lineto
114.70027160644531 -66.70027160644531 lineto
114.70027160644531 -32.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -69.70027160644531 moveto
24.70026969909668 -92.70027160644531 lineto
114.70027160644531 -92.70027160644531 lineto
114.70027160644531 -69.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
132.7002716064453 -32.70027160644531 moveto
132.7002716064453 -66.70027160644531 lineto
222.7002716064453 -66.70027160644531 lineto
222.7002716064453 -32.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
132.7002716064453 -69.70027160644531 moveto
132.7002716064453 -92.70027160644531 lineto
222.7002716064453 -92.70027160644531 lineto
222.7002716064453 -69.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
42.70027160644531 -164.7002716064453 moveto
42.70027160644531 -186.7002716064453 lineto
130.7002716064453 -186.7002716064453 lineto
130.7002716064453 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.7002716064453 -164.7002716064453 moveto
133.7002716064453 -186.7002716064453 lineto
220.7002716064453 -186.7002716064453 lineto
220.7002716064453 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.7002716064453 -164.7002716064453 moveto
223.7002716064453 -186.7002716064453 lineto
312.70025634765625 -186.7002716064453 lineto
312.70025634765625 -164.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
42.70027160644531 -189.7002716064453 moveto
42.70027160644531 -224.7002716064453 lineto
130.7002716064453 -224.7002716064453 lineto
130.7002716064453 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.7002716064453 -189.7002716064453 moveto
133.7002716064453 -224.7002716064453 lineto
220.7002716064453 -224.7002716064453 lineto
220.7002716064453 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.7002716064453 -189.7002716064453 moveto
223.7002716064453 -224.7002716064453 lineto
312.70025634765625 -224.7002716064453 lineto
312.70025634765625 -189.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
42.70027160644531 -224.7002716064453 moveto
42.70027160644531 -272.70025634765625 lineto
312.70025634765625 -272.70025634765625 lineto
312.70025634765625 -224.7002716064453 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
42.70027160644531 -272.70025634765625 moveto
42.70027160644531 -306.70025634765625 lineto
130.7002716064453 -306.70025634765625 lineto
130.7002716064453 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.7002716064453 -272.70025634765625 moveto
133.7002716064453 -306.70025634765625 lineto
220.7002716064453 -306.70025634765625 lineto
220.7002716064453 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.7002716064453 -272.70025634765625 moveto
223.7002716064453 -306.70025634765625 lineto
312.70025634765625 -306.70025634765625 lineto
312.70025634765625 -272.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
42.70027160644531 -309.70025634765625 moveto
42.70027160644531 -332.70025634765625 lineto
130.7002716064453 -332.70025634765625 lineto
130.7002716064453 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.7002716064453 -309.70025634765625 moveto
133.7002716064453 -332.70025634765625 lineto
220.7002716064453 -332.70025634765625 lineto
220.7002716064453 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
223.7002716064453 -309.70025634765625 moveto
223.7002716064453 -332.70025634765625 lineto
312.70025634765625 -332.70025634765625 lineto
312.70025634765625 -309.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -404.70025634765625 moveto
24.70026969909668 -426.70025634765625 lineto
114.70027160644531 -426.70025634765625 lineto
114.70027160644531 -404.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -429.70025634765625 moveto
24.70026969909668 -464.70025634765625 lineto
114.70027160644531 -464.70025634765625 lineto
114.70027160644531 -429.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
132.7002716064453 -404.70025634765625 moveto
132.7002716064453 -426.70025634765625 lineto
222.7002716064453 -426.70025634765625 lineto
222.7002716064453 -404.70025634765625 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
132.7002716064453 -429.70025634765625 moveto
132.7002716064453 -464.70025634765625 lineto
222.7002716064453 -464.70025634765625 lineto
222.7002716064453 -429.70025634765625 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -30.0 moveto
22.0 -64.0 lineto
112.0 -64.0 lineto
112.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.9 setlinewidth
1 setlinecap
[] 0 setdash
newpath
22.0 -30.0 moveto
22.0 -64.0 lineto
112.0 -64.0 lineto
112.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -67.0 moveto
22.0 -90.0 lineto
112.0 -90.0 lineto
112.0 -67.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -67.0 moveto
22.0 -90.0 lineto
112.0 -90.0 lineto
112.0 -67.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
130.0 -30.0 moveto
130.0 -64.0 lineto
220.0 -64.0 lineto
220.0 -30.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -30.0 moveto
130.0 -64.0 lineto
220.0 -64.0 lineto
220.0 -30.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
130.0 -67.0 moveto
130.0 -90.0 lineto
220.0 -90.0 lineto
220.0 -67.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -67.0 moveto
130.0 -90.0 lineto
220.0 -90.0 lineto
220.0 -67.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -162.0 moveto
40.0 -184.0 lineto
128.0 -184.0 lineto
128.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -162.0 moveto
40.0 -184.0 lineto
128.0 -184.0 lineto
128.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
131.0 -162.0 moveto
131.0 -184.0 lineto
218.0 -184.0 lineto
218.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
131.0 -162.0 moveto
131.0 -184.0 lineto
218.0 -184.0 lineto
218.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
221.0 -162.0 moveto
221.0 -184.0 lineto
310.0 -184.0 lineto
310.0 -162.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
221.0 -162.0 moveto
221.0 -184.0 lineto
310.0 -184.0 lineto
310.0 -162.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -187.0 moveto
40.0 -222.0 lineto
128.0 -222.0 lineto
128.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -187.0 moveto
40.0 -222.0 lineto
128.0 -222.0 lineto
128.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
131.0 -187.0 moveto
131.0 -222.0 lineto
218.0 -222.0 lineto
218.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
131.0 -187.0 moveto
131.0 -222.0 lineto
218.0 -222.0 lineto
218.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
221.0 -187.0 moveto
221.0 -222.0 lineto
310.0 -222.0 lineto
310.0 -187.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
221.0 -187.0 moveto
221.0 -222.0 lineto
310.0 -222.0 lineto
310.0 -187.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -222.0 moveto
40.0 -270.0 lineto
310.0 -270.0 lineto
310.0 -222.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -222.0 moveto
40.0 -270.0 lineto
310.0 -270.0 lineto
310.0 -222.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -270.0 moveto
40.0 -304.0 lineto
128.0 -304.0 lineto
128.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -270.0 moveto
40.0 -304.0 lineto
128.0 -304.0 lineto
128.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
131.0 -270.0 moveto
131.0 -304.0 lineto
218.0 -304.0 lineto
218.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
131.0 -270.0 moveto
131.0 -304.0 lineto
218.0 -304.0 lineto
218.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
221.0 -270.0 moveto
221.0 -304.0 lineto
310.0 -304.0 lineto
310.0 -270.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
221.0 -270.0 moveto
221.0 -304.0 lineto
310.0 -304.0 lineto
310.0 -270.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
40.0 -307.0 moveto
40.0 -330.0 lineto
128.0 -330.0 lineto
128.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
40.0 -307.0 moveto
40.0 -330.0 lineto
128.0 -330.0 lineto
128.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
131.0 -307.0 moveto
131.0 -330.0 lineto
218.0 -330.0 lineto
218.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
131.0 -307.0 moveto
131.0 -330.0 lineto
218.0 -330.0 lineto
218.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
221.0 -307.0 moveto
221.0 -330.0 lineto
310.0 -330.0 lineto
310.0 -307.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
221.0 -307.0 moveto
221.0 -330.0 lineto
310.0 -330.0 lineto
310.0 -307.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -402.0 moveto
22.0 -424.0 lineto
112.0 -424.0 lineto
112.0 -402.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -402.0 moveto
22.0 -424.0 lineto
112.0 -424.0 lineto
112.0 -402.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -427.0 moveto
22.0 -462.0 lineto
112.0 -462.0 lineto
112.0 -427.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -427.0 moveto
22.0 -462.0 lineto
112.0 -462.0 lineto
112.0 -427.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
130.0 -402.0 moveto
130.0 -424.0 lineto
220.0 -424.0 lineto
220.0 -402.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -402.0 moveto
130.0 -424.0 lineto
220.0 -424.0 lineto
220.0 -402.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
130.0 -427.0 moveto
130.0 -462.0 lineto
220.0 -462.0 lineto
220.0 -427.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -427.0 moveto
130.0 -462.0 lineto
220.0 -462.0 lineto
220.0 -427.0 lineto
closepath
stroke
newpath
67.0 -108.0 moveto
67.0 -126.0 lineto
85.0 -126.0 lineto
85.0 -150.0 lineto
stroke
newpath
175.0 -108.0 moveto
175.0 -150.0 lineto
stroke
newpath
85.0 -348.0 moveto
85.0 -366.0 lineto
67.0 -366.0 lineto
67.0 -390.0 lineto
stroke
newpath
175.0 -348.0 moveto
175.0 -390.0 lineto
stroke
newpath
81.0 -144.0 moveto
85.0 -156.0 lineto
90.0 -144.0 lineto
closepath
fill
newpath
171.0 -144.0 moveto
175.0 -156.0 lineto
180.0 -144.0 lineto
closepath
fill
newpath
63.0 -384.0 moveto
67.0 -396.0 lineto
72.0 -384.0 lineto
closepath
fill
newpath
171.0 -384.0 moveto
175.0 -396.0 lineto
180.0 -384.0 lineto
closepath
fill
/Helvetica findfont
13 scalefont setfont
42.0 -47.0 moveto
(Client) show
144.0 -47.0 moveto
(Broker) show
144.0 -59.0 moveto
(cloudbe) show
38.0 -83.0 moveto
(connect) show
146.0 -83.0 moveto
(connect) show
39.0 -107.0 moveto
(request) show
147.0 -107.0 moveto
(request) show
65.0 -179.0 moveto
(bind) show
155.0 -179.0 moveto
(bind) show
54.0 -203.0 moveto
(localfe) show
54.0 -214.0 moveto
(ROUTER) show
144.0 -203.0 moveto
(cloudfe) show
144.0 -214.0 moveto
(ROUTER) show
147.0 -251.0 moveto
(Broker) show
54.0 -286.0 moveto
(ROUTER) show
54.0 -299.0 moveto
(localbe) show
144.0 -286.0 moveto
(ROUTER) show
144.0 -299.0 moveto
(cloudbe) show
65.0 -323.0 moveto
(bind) show
146.0 -323.0 moveto
(connect) show
57.0 -347.0 moveto
(request) show
147.0 -347.0 moveto
(request) show
38.0 -419.0 moveto
(connect) show
155.0 -419.0 moveto
(bind) show
144.0 -443.0 moveto
(cloudfe) show
144.0 -455.0 moveto
(Broker) show
37.0 -455.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4901 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4901 a Black 3757 5569 a
Ff(136)p Black eop end
%%Page: 137 150
TeXDict begin 137 149 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.137) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1875) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(Before)20 b(we)g(jump)g(into)g(the)g
(code,)f(which)h(is)h(getting)f(a)g(little)h(comple)o(x,)d(let')-5
b(s)21 b(sk)o(etch)g(the)f(core)f(routing)g(logic)h(and)396
180 y(break)f(it)i(do)n(wn)e(into)h(a)h(simple)f(b)n(ut)g(rob)n(ust)g
(design.)-2 364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:1876) cvn /DEST pdfmark end

-2 364 a 396 454 a Fk(W)-7 b(e)22 b(need)d(tw)o(o)i(queues,)e(one)g
(for)h(requests)g(from)f(local)h(clients)g(and)g(one)g(for)f(requests)h
(from)f(cloud)g(clients.)i(One)396 562 y(option)e(w)o(ould)h(be)g(to)g
(pull)g(messages)g(of)n(f)g(the)g(local)g(and)g(cloud)f(frontends,)f
(and)i(pump)f(these)h(onto)f(their)h(respecti)n(v)o(e)396
670 y(queues.)f(But)i(this)g(is)g(kind)e(of)h(pointless)g(because)g
(\330MQ)g(sock)o(ets)2362 670 y
SDict begin H.S end
 2362 670 a 2362 670 a
SDict begin 13 H.A end

2362 670 a 2362 670 a
SDict begin [/View [/XYZ H.V]/Dest (0:1877) cvn /DEST pdfmark end
 2362 670 a Ff(ar)m(e)h Fk(queues)e(already)-5
b(.)19 b(So)h(let')-5 b(s)21 b(use)g(the)f(\330MQ)396
778 y(sock)o(et)g(b)n(uf)n(fers)f(as)i(queues.)-2 962
y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:1878) cvn /DEST pdfmark end
 -2 962 a 396 1052
a Fk(This)g(w)o(as)g(the)f(technique)e(we)j(used)f(in)g(the)g(LR)m(U)h
(queue)e(brok)o(er)m(,)f(and)i(it)h(w)o(ork)o(ed)e(nicely)-5
b(.)19 b(W)-7 b(e)21 b(only)e(read)h(from)f(the)396 1160
y(tw)o(o)i(frontends)d(when)i(there)f(is)i(some)n(where)e(to)i(send)f
(the)g(requests.)f(W)-7 b(e)22 b(can)e(al)o(w)o(ays)g(read)g(from)f
(the)h(back)o(ends,)396 1268 y(since)h(the)o(y)e(gi)n(v)o(e)g(us)i
(replies)f(to)g(route)g(back.)f(As)i(long)e(as)i(the)g(back)o(ends)d
(aren')o(t)h(talking)h(to)g(us,)g(there')-5 b(s)20 b(no)g(point)g(in)
396 1376 y(e)n(v)o(en)f(looking)g(at)i(the)f(frontends.)-2
1560 y
SDict begin H.S end
 -2 1560 a -2 1560 a
SDict begin 13 H.A end
 -2 1560 a -2 1560 a
SDict begin [/View [/XYZ H.V]/Dest (0:1879) cvn /DEST pdfmark end
 -2 1560
a 396 1650 a Fk(So)h(our)e(main)h(loop)f(becomes:)-2
1668 y
SDict begin H.S end
 -2 1668 a -2 1668 a
SDict begin 13 H.A end
 -2 1668 a -2 1668 a
SDict begin [/View [/XYZ H.V]/Dest (0:1880) cvn /DEST pdfmark end
 -2 1668
a -2 1678 a
SDict begin H.S end
 -2 1678 a -2 1678 a
SDict begin 13 H.A end
 -2 1678 a -2 1678 a
SDict begin [/View [/XYZ H.V]/Dest (0:1881) cvn /DEST pdfmark end
 -2
1678 a Black 396 1820 a Fj(\225)p Black 479 1820 a
SDict begin H.S end
 479
1820 a 479 1820 a
SDict begin 13 H.A end
 479 1820 a 479 1820 a
SDict begin [/View [/XYZ H.V]/Dest (0:1882) cvn /DEST pdfmark end
 479 1820 a Fk(Poll)i(the)f
(back)o(ends)f(for)g(acti)n(vity)-5 b(.)20 b(When)g(we)g(get)g(a)h
(message,)f(it)h(may)e(be)i("READ)-5 b(Y")20 b(from)g(a)g(w)o(ork)o(er)
f(or)h(it)h(may)479 1928 y(be)f(a)h(reply)-5 b(.)19 b(If)h(it')-5
b(s)21 b(a)g(reply)-5 b(,)18 b(route)i(back)f(via)i(the)f(local)g(or)g
(cloud)f(frontend.)-2 1946 y
SDict begin H.S end
 -2 1946 a -2 1946 a
SDict begin 13 H.A end
 -2 1946
a -2 1946 a
SDict begin [/View [/XYZ H.V]/Dest (0:1883) cvn /DEST pdfmark end
 -2 1946 a Black 396 2077 a Fj(\225)p Black
479 2077 a
SDict begin H.S end
 479 2077 a 479 2077 a
SDict begin 13 H.A end
 479 2077 a 479 2077
a
SDict begin [/View [/XYZ H.V]/Dest (0:1884) cvn /DEST pdfmark end
 479 2077 a Fk(If)h(a)h(w)o(ork)o(er)e(replied,)g(it)i(became)e(a)n(v)
n(ailable,)h(so)g(we)h(queue)e(it)i(and)f(count)f(it.)-2
2095 y
SDict begin H.S end
 -2 2095 a -2 2095 a
SDict begin 13 H.A end
 -2 2095 a -2 2095 a
SDict begin [/View [/XYZ H.V]/Dest (0:1885) cvn /DEST pdfmark end
 -2 2095
a Black 396 2227 a Fj(\225)p Black 479 2227 a
SDict begin H.S end
 479 2227
a 479 2227 a
SDict begin 13 H.A end
 479 2227 a 479 2227 a
SDict begin [/View [/XYZ H.V]/Dest (0:1886) cvn /DEST pdfmark end
 479 2227 a Fk(While)i(there)f(are)g
(w)o(ork)o(ers)f(a)n(v)n(ailable,)h(tak)o(e)g(a)h(request,)e(if)h(an)o
(y)-5 b(,)19 b(from)g(either)h(frontend)e(and)i(route)f(to)h(a)h(local)
479 2335 y(w)o(ork)o(er)m(,)e(or)h(randomly)-5 b(,)17
b(a)k(cloud)e(peer)-5 b(.)-2 2519 y
SDict begin H.S end
 -2 2519 a -2 2519
a
SDict begin 13 H.A end
 -2 2519 a -2 2519 a
SDict begin [/View [/XYZ H.V]/Dest (0:1887) cvn /DEST pdfmark end
 -2 2519 a 396 2609 a Fk(Randomly)19
b(sending)g(tasks)i(to)f(a)h(peer)e(brok)o(er)g(rather)g(than)h(a)h(w)o
(ork)o(er)e(simulates)h(w)o(ork)g(distrib)n(ution)f(across)h(the)396
2717 y(cluster)-5 b(.)21 b(It')-5 b(s)20 b(dumb)f(b)n(ut)h(that)h(is)g
(\002ne)f(for)g(this)g(stage.)-2 2901 y
SDict begin H.S end
 -2 2901 a -2
2901 a
SDict begin 13 H.A end
 -2 2901 a -2 2901 a
SDict begin [/View [/XYZ H.V]/Dest (0:1888) cvn /DEST pdfmark end
 -2 2901 a 396 2991 a Fk(W)-7
b(e)22 b(use)e(brok)o(er)f(identities)h(to)g(route)g(messages)g
(between)f(brok)o(ers.)g(Each)h(brok)o(er)e(has)j(a)f(name,)g(which)f
(we)i(pro)o(vide)396 3099 y(on)f(the)g(command)e(line)j(in)f(this)h
(simple)f(prototype.)e(As)j(long)e(as)i(these)f(names)g(don')o(t)f(o)o
(v)o(erlap)f(with)i(the)396 3207 y(\330MQ-generated)e(UUIDs)j(used)f
(for)f(client)h(nodes,)f(we)i(can)f(\002gure)f(out)h(whether)g(to)g
(route)f(a)i(reply)e(back)h(to)g(a)h(client)396 3314
y(or)f(to)h(a)f(brok)o(er)-5 b(.)-2 3481 y
SDict begin H.S end
 -2 3481 a
-2 3481 a
SDict begin 13 H.A end
 -2 3481 a -2 3481 a
SDict begin [/View [/XYZ H.V]/Dest (0:1889) cvn /DEST pdfmark end
 -2 3481 a 396 3588 a Fk(Here)20
b(is)h(ho)n(w)f(this)h(w)o(orks)f(in)g(code.)f(The)h(interesting)f
(part)h(starts)h(around)e(the)h(comment)f("Interesting)f(part".)-2
3606 y
SDict begin H.S end
 -2 3606 a -2 3606 a
SDict begin 13 H.A end
 -2 3606 a -2 3606 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c) cvn /DEST pdfmark
end
 -2 3606
a 396 3790 a Fg(Example)j(3-23.)d(Pr)o(ototype)g(local)i(and)g(cloud)h
(\003o)o(w)g(\(peering2.c\))-2 3890 y
SDict begin H.S end
 -2 3890 a -2 3890
a
SDict begin 11.7 H.A end
 -2 3890 a -2 3890 a
SDict begin [/View [/XYZ H.V]/Dest (0:1892) cvn /DEST pdfmark end
 -2 3890 a 396 3970 a Fe(//)396
4067 y(//)90 b(Broker)43 b(peering)h(simulation)f(\(part)h(2\))396
4164 y(//)90 b(Prototypes)43 b(the)h(request-reply)f(flow)396
4261 y(//)396 4358 y(#include)h("czmq.h")396 4553 y(#define)g
(NBR_CLIENTS)f(10)396 4650 y(#define)h(NBR_WORKERS)f(3)396
4747 y(#define)h(LRU_READY)133 b("\\001")268 b(//)89
b(Signals)44 b(worker)g(is)g(ready)396 4941 y(//)90 b(Our)44
b(own)g(name;)g(in)h(practice)e(this)h(would)g(be)h(configured)e(per)h
(node)396 5038 y(static)g(char)934 5051 y(*)979 5038
y(self;)p Black 3756 5569 a Ff(137)p Black eop end
%%Page: 138 151
TeXDict begin 138 150 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.138) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1893) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(The)20 b(client)g(task)h(does)f(a)g
(request-reply)e(dialog)h(using)h(a)h(standard)e(synchronous)e(REQ)k
(sock)o(et:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c-1) cvn /DEST pdfmark
end
 -2
90 a 396 274 a Fg(Example)g(3-24.)d(Pr)o(ototype)g(local)i(and)g(cloud)
h(\003o)o(w)g(\(peering2.c\))d(-)j(client)f(task)-2 374
y
SDict begin H.S end
 -2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:1896) cvn /DEST pdfmark end
 -2 374 a 396 551
a Fe(static)44 b(void)934 564 y(*)396 648 y(client_task)f(\(void)1203
661 y(*)1248 648 y(args\))396 745 y({)576 843 y(zctx_t)889
856 y(*)934 843 y(ctx)i(=)f(zctx_new)g(\(\);)576 940
y(void)800 953 y(*)845 940 y(client)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 1037 y(zsocket_connect)e(\(client,)h
("ipc://\045s-localfe.ipc",)e(self\);)576 1231 y(while)j(\(true\))f({)
755 1328 y(//)89 b(Send)44 b(request,)g(get)g(reply)755
1425 y(zstr_send)f(\(client,)h("HELLO"\);)755 1522 y(char)979
1535 y(*)1024 1522 y(reply)g(=)h(zstr_recv)e(\(client\);)755
1620 y(if)h(\(!reply\))934 1717 y(break;)627 b(//)89
b(Interrupted)755 1814 y(printf)44 b(\("Client:)f(\045s\\n",)h
(reply\);)755 1911 y(free)g(\(reply\);)755 2008 y(sleep)g(\(1\);)576
2105 y(})576 2202 y(zctx_destroy)e(\(&ctx\);)576 2300
y(return)h(NULL;)396 2397 y(})-2 2571 y
SDict begin H.S end
 -2 2571 a -2
2571 a
SDict begin 13 H.A end
 -2 2571 a -2 2571 a
SDict begin [/View [/XYZ H.V]/Dest (0:1897) cvn /DEST pdfmark end
 -2 2571 a 396 2671 a Fk(The)20
b(w)o(ork)o(er)f(task)i(plugs)e(into)h(the)h(LR)m(U)f(routing)f(dialog)
g(using)h(a)g(REQ)h(sock)o(et:)-2 2689 y
SDict begin H.S end
 -2 2689 a -2
2689 a
SDict begin 13 H.A end
 -2 2689 a -2 2689 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c-2) cvn /DEST pdfmark
end
 -2 2689 a 396 2872 a Fg(Example)g(3-25.)d
(Pr)o(ototype)g(local)i(and)g(cloud)h(\003o)o(w)g(\(peering2.c\))d(-)j
(w)o(ork)o(er)f(task)-2 2972 y
SDict begin H.S end
 -2 2972 a -2 2972 a
SDict begin 11.7 H.A end
 -2
2972 a -2 2972 a
SDict begin [/View [/XYZ H.V]/Dest (0:1900) cvn /DEST pdfmark end
 -2 2972 a 396 3149 a Fe(static)44 b(void)934
3162 y(*)396 3246 y(worker_task)f(\(void)1203 3259 y(*)1248
3246 y(args\))396 3344 y({)576 3441 y(zctx_t)889 3454
y(*)934 3441 y(ctx)i(=)f(zctx_new)g(\(\);)576 3538 y(void)800
3551 y(*)845 3538 y(worker)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_REQ\);)576
3635 y(zsocket_connect)e(\(worker,)h("ipc://\045s-localbe.ipc",)e
(self\);)576 3829 y(//)89 b(Tell)44 b(broker)g(we're)g(ready)g(for)g
(work)576 3926 y(zframe_t)979 3939 y(*)1024 3926 y(frame)g(=)h
(zframe_new)e(\(LRU_READY,)g(1\);)576 4023 y(zframe_send)g(\(&frame,)g
(worker,)h(0\);)576 4218 y(//)89 b(Process)44 b(messages)f(as)i(they)f
(arrive)576 4315 y(while)g(\(true\))f({)755 4412 y(zmsg_t)1069
4425 y(*)1114 4412 y(msg)h(=)h(zmsg_recv)e(\(worker\);)755
4509 y(if)h(\(!msg\))934 4606 y(break;)627 b(//)89 b(Interrupted)755
4801 y(zframe_print)43 b(\(zmsg_last)g(\(msg\),)h("Worker:)f("\);)755
4898 y(zframe_reset)g(\(zmsg_last)g(\(msg\),)h("OK",)g(2\);)755
4995 y(zmsg_send)f(\(&msg,)h(worker\);)576 5092 y(})p
Black 3759 5569 a Ff(138)p Black eop end
%%Page: 139 152
TeXDict begin 139 151 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.139) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 72 a Fe(zctx_destroy)42 b(\(&ctx\);)576
170 y(return)h(NULL;)396 267 y(})-2 441 y
SDict begin H.S end
 -2 441 a -2
441 a
SDict begin 13 H.A end
 -2 441 a -2 441 a
SDict begin [/View [/XYZ H.V]/Dest (0:1901) cvn /DEST pdfmark end
 -2 441 a 396 541 a Fk(The)20
b(main)g(task)g(be)o(gins)g(by)f(setting-up)g(its)j(frontend)c(and)h
(back)o(end)g(sock)o(ets)h(and)g(then)f(starting)h(its)h(client)g(and)
396 649 y(w)o(ork)o(er)e(tasks:)-2 650 y
SDict begin H.S end
 -2 650 a -2
650 a
SDict begin 13 H.A end
 -2 650 a -2 650 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c-3) cvn /DEST pdfmark
end
 -2 650 a 396 850 a Fg(Example)i(3-26.)d(Pr)o
(ototype)g(local)i(and)g(cloud)h(\003o)o(w)g(\(peering2.c\))d(-)j(main)
f(task)-2 950 y
SDict begin H.S end
 -2 950 a -2 950 a
SDict begin 11.7 H.A end
 -2 950 a -2 950 a
SDict begin [/View [/XYZ H.V]/Dest (0:1904) cvn /DEST pdfmark end
 -2
950 a 396 1127 a Fe(int)45 b(main)f(\(int)g(argc,)g(char)1517
1140 y(*)1562 1127 y(argv)g([]\))396 1224 y({)576 1322
y(//)89 b(First)44 b(argument)f(is)i(this)f(broker's)g(name)576
1419 y(//)89 b(Other)44 b(arguments)f(are)i(our)f(peers')g(names)576
1516 y(//)576 1613 y(if)g(\(argc)g(<)h(2\))f({)755 1710
y(printf)g(\("syntax:)f(peering2)h(me)g({you}...\\n"\);)755
1807 y(exit)g(\(EXIT_FAILURE\);)576 1904 y(})576 2001
y(self)g(=)g(argv)h([1];)576 2099 y(printf)e(\("I:)i(preparing)e
(broker)h(at)g(\045s...\\n",)g(self\);)576 2196 y(srandom)f
(\(\(unsigned\))g(time)h(\(NULL\)\);)576 2390 y(zctx_t)889
2403 y(*)934 2390 y(ctx)h(=)f(zctx_new)g(\(\);)576 2584
y(//)89 b(Bind)44 b(cloud)g(frontend)g(to)g(endpoint)576
2681 y(void)800 2694 y(*)845 2681 y(cloudfe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_ROUTER\);)576 2779 y(zsockopt_set_identity)d(\(cloudfe,)i
(self\);)576 2876 y(zsocket_bind)f(\(cloudfe,)i
("ipc://\045s-cloud.ipc",)d(self\);)576 3070 y(//)89
b(Connect)44 b(cloud)g(backend)f(to)i(all)f(peers)576
3167 y(void)800 3180 y(*)845 3167 y(cloudbe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_ROUTER\);)576 3264 y(zsockopt_set_identity)d(\(cloudbe,)i
(self\);)576 3361 y(int)h(argn;)576 3459 y(for)g(\(argn)g(=)h(2;)f
(argn)g(<)h(argc;)f(argn++\))g({)755 3556 y(char)979
3569 y(*)1024 3556 y(peer)g(=)h(argv)f([argn];)755 3653
y(printf)g(\("I:)g(connecting)f(to)i(cloud)f(frontend)f(at)i
('\045s'\\n",)e(peer\);)755 3750 y(zsocket_connect)f(\(cloudbe,)i
("ipc://\045s-cloud.ipc",)d(peer\);)576 3847 y(})576
3944 y(//)89 b(Prepare)44 b(local)g(frontend)f(and)h(backend)576
4041 y(void)800 4054 y(*)845 4041 y(localfe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_ROUTER\);)576 4138 y(zsocket_bind)e(\(localfe,)i
("ipc://\045s-localfe.ipc",)d(self\);)576 4236 y(void)800
4249 y(*)845 4236 y(localbe)i(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)
576 4333 y(zsocket_bind)e(\(localbe,)i("ipc://\045s-localbe.ipc",)d
(self\);)576 4527 y(//)89 b(Get)44 b(user)g(to)h(tell)f(us)h(when)f(we)
g(can)h(start...)576 4624 y(printf)e(\("Press)h(Enter)g(when)g(all)h
(brokers)e(are)i(started:)e("\);)576 4721 y(getchar)g(\(\);)576
4916 y(//)89 b(Start)44 b(local)g(workers)576 5013 y(int)g(worker_nbr;)
576 5110 y(for)g(\(worker_nbr)f(=)i(0;)f(worker_nbr)f(<)i(NBR_WORKERS;)
e(worker_nbr++\))p Black 3759 5569 a Ff(139)p Black eop
end
%%Page: 140 153
TeXDict begin 140 152 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.140) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(zthread_new)43 b(\(worker_task,)g
(NULL\);)576 267 y(//)89 b(Start)44 b(local)g(clients)576
364 y(int)g(client_nbr;)576 461 y(for)g(\(client_nbr)f(=)i(0;)f
(client_nbr)f(<)i(NBR_CLIENTS;)e(client_nbr++\))755 558
y(zthread_new)g(\(client_task,)g(NULL\);)-2 734 y
SDict begin H.S end
 -2
734 a -2 734 a
SDict begin 13 H.A end
 -2 734 a -2 734 a
SDict begin [/View [/XYZ H.V]/Dest (0:1905) cvn /DEST pdfmark end
 -2 734 a 396 832 a Fk(Here)20
b(we)h(handle)e(the)h(request-reply)e(\003o)n(w)-5 b(.)20
b(W)-7 b(e')l(re)20 b(using)g(the)g(LR)m(U)g(approach)e(to)j(poll)f(w)o
(ork)o(ers)f(at)i(all)g(times,)f(and)396 940 y(clients)h(only)e(when)h
(there)f(are)i(one)e(or)h(more)f(w)o(ork)o(ers)h(a)n(v)n(ailable.)-2
958 y
SDict begin H.S end
 -2 958 a -2 958 a
SDict begin 13 H.A end
 -2 958 a -2 958 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c-4) cvn /DEST pdfmark
end
 -2 958 a 396
1141 a Fg(Example)h(3-27.)d(Pr)o(ototype)g(local)i(and)g(cloud)h(\003o)
o(w)g(\(peering2.c\))d(-)j(r)o(equest-r)o(eply)d(handling)-2
1241 y
SDict begin H.S end
 -2 1241 a -2 1241 a
SDict begin 11.7 H.A end
 -2 1241 a -2 1241 a
SDict begin [/View [/XYZ H.V]/Dest (0:1908) cvn /DEST pdfmark end
 -2 1241
a 576 1419 a Fe(//)89 b(Least)44 b(recently)f(used)i(queue)f(of)g
(available)f(workers)576 1516 y(int)h(capacity)f(=)i(0;)576
1613 y(zlist_t)934 1626 y(*)979 1613 y(workers)f(=)g(zlist_new)g(\(\);)
576 1807 y(while)g(\(true\))f({)755 1904 y(//)89 b(First,)44
b(route)g(any)g(waiting)g(replies)g(from)g(workers)755
2001 y(zmq_pollitem_t)e(backends)i([])g(=)h({)934 2099
y({)g(localbe,)e(0,)i(ZMQ_POLLIN,)e(0)i(},)934 2196 y({)g(cloudbe,)e
(0,)i(ZMQ_POLLIN,)e(0)i(})755 2293 y(};)755 2390 y(//)89
b(If)45 b(we)f(have)g(no)h(workers)f(anyhow,)f(wait)h(indefinitely)755
2487 y(int)g(rc)h(=)f(zmq_poll)g(\(backends,)f(2,)934
2584 y(capacity?)h(1000)1607 2597 y(*)1696 2584 y(ZMQ_POLL_MSEC:)f
(-1\);)755 2681 y(if)h(\(rc)h(==)f(-1\))934 2779 y(break;)627
b(//)89 b(Interrupted)755 2973 y(//)g(Handle)44 b(reply)g(from)g(local)
g(worker)755 3070 y(zmsg_t)1069 3083 y(*)1114 3070 y(msg)g(=)h(NULL;)
755 3167 y(if)f(\(backends)g([0].revents)f(&)h(ZMQ_POLLIN\))f({)934
3264 y(msg)i(=)f(zmsg_recv)g(\(localbe\);)934 3361 y(if)h(\(!msg\))1114
3459 y(break;)447 b(//)89 b(Interrupted)934 3556 y(zframe_t)1338
3569 y(*)1383 3556 y(address)43 b(=)i(zmsg_unwrap)e(\(msg\);)934
3653 y(zlist_append)g(\(workers,)g(address\);)934 3750
y(capacity++;)934 3944 y(//)90 b(If)44 b(it's)g(READY,)g(don't)g(route)
g(the)g(message)g(any)g(further)934 4041 y(zframe_t)1338
4054 y(*)1383 4041 y(frame)g(=)g(zmsg_first)f(\(msg\);)934
4138 y(if)i(\(memcmp)e(\(zframe_data)g(\(frame\),)h(LRU_READY,)f(1\))h
(==)h(0\))1114 4236 y(zmsg_destroy)d(\(&msg\);)755 4333
y(})755 4430 y(//)89 b(Or)45 b(handle)f(reply)g(from)g(peer)g(broker)
755 4527 y(else)755 4624 y(if)g(\(backends)g([1].revents)f(&)h
(ZMQ_POLLIN\))f({)934 4721 y(msg)i(=)f(zmsg_recv)g(\(cloudbe\);)934
4818 y(if)h(\(!msg\))1114 4916 y(break;)447 b(//)89 b(Interrupted)934
5013 y(//)h(We)44 b(don't)g(use)g(peer)h(broker)e(address)h(for)g
(anything)934 5110 y(zframe_t)1338 5123 y(*)1383 5110
y(address)f(=)i(zmsg_unwrap)e(\(msg\);)p Black 3759 5569
a Ff(140)p Black eop end
%%Page: 141 154
TeXDict begin 141 153 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.141) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 934 72 a Fe(zframe_destroy)43 b(\(&address\);)755
170 y(})755 267 y(//)89 b(Route)44 b(reply)g(to)h(cloud)f(if)g(it's)g
(addressed)g(to)g(a)h(broker)755 364 y(for)f(\(argn)g(=)h(2;)f(msg)h
(&&)f(argn)g(<)h(argc;)f(argn++\))g({)934 461 y(char)1158
474 y(*)1203 461 y(data)g(=)h(\(char)1786 474 y(*)1831
461 y(\))g(zframe_data)e(\(zmsg_first)g(\(msg\)\);)934
558 y(size_t)h(size)g(=)h(zframe_size)e(\(zmsg_first)g(\(msg\)\);)934
655 y(if)i(\(size)f(==)g(strlen)g(\(argv)g([argn]\))934
752 y(&&)90 b(memcmp)43 b(\(data,)h(argv)g([argn],)g(size\))g(==)h(0\))
1114 850 y(zmsg_send)e(\(&msg,)h(cloudfe\);)755 947 y(})755
1044 y(//)89 b(Route)44 b(reply)g(to)h(client)f(if)g(we)h(still)f(need)
g(to)755 1141 y(if)g(\(msg\))934 1238 y(zmsg_send)g(\(&msg,)f
(localfe\);)-2 1416 y
SDict begin H.S end
 -2 1416 a -2 1416 a
SDict begin 13 H.A end
 -2 1416 a -2
1416 a
SDict begin [/View [/XYZ H.V]/Dest (0:1909) cvn /DEST pdfmark end
 -2 1416 a 396 1512 a Fk(No)n(w)20 b(we)h(route)e(as)i(man)o(y)e
(client)h(requests)g(as)h(we)g(ha)n(v)o(e)e(w)o(ork)o(er)g(capacity)h
(for)-5 b(.)20 b(W)-7 b(e)21 b(may)f(reroute)f(requests)g(from)h(our)
396 1620 y(local)g(frontend,)e(b)n(ut)i(not)g(from)f(the)i(cloud)e
(frontend.)f(W)-7 b(e)21 b(reroute)e(randomly)f(no)n(w)-5
b(,)19 b(just)i(to)f(test)h(things)f(out.)f(In)h(the)396
1728 y(ne)o(xt)g(v)o(ersion)f(we')o(ll)h(do)g(this)h(properly)d(by)i
(calculating)f(cloud)g(capacity:)-2 1746 y
SDict begin H.S end
 -2 1746 a
-2 1746 a
SDict begin 13 H.A end
 -2 1746 a -2 1746 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering2-c-5) cvn /DEST pdfmark
end
 -2 1746 a 396 1929 a Fg(Example)i(3-28.)d
(Pr)o(ototype)g(local)i(and)g(cloud)h(\003o)o(w)g(\(peering2.c\))d(-)j
(r)o(oute)e(client)h(r)o(equests)-2 2029 y
SDict begin H.S end
 -2 2029 a
-2 2029 a
SDict begin 11.7 H.A end
 -2 2029 a -2 2029 a
SDict begin [/View [/XYZ H.V]/Dest (0:1912) cvn /DEST pdfmark end
 -2 2029 a 755 2207 a Fe(while)44
b(\(capacity\))f({)934 2304 y(zmq_pollitem_t)g(frontends)g([])i(=)f({)
1114 2401 y({)g(localfe,)g(0,)g(ZMQ_POLLIN,)f(0)i(},)1114
2498 y({)f(cloudfe,)g(0,)g(ZMQ_POLLIN,)f(0)i(})934 2595
y(};)934 2692 y(rc)g(=)f(zmq_poll)g(\(frontends,)f(2,)h(0\);)934
2789 y(assert)g(\(rc)g(>=)h(0\);)934 2887 y(int)g(reroutable)e(=)h(0;)
934 2984 y(//)90 b(We'll)44 b(do)g(peer)g(brokers)g(first,)g(to)g
(prevent)g(starvation)934 3081 y(if)h(\(frontends)e([1].revents)g(&)i
(ZMQ_POLLIN\))e({)1114 3178 y(msg)h(=)h(zmsg_recv)e(\(cloudfe\);)1114
3275 y(reroutable)g(=)h(0;)934 3372 y(})934 3469 y(else)934
3566 y(if)h(\(frontends)e([0].revents)g(&)i(ZMQ_POLLIN\))e({)1114
3664 y(msg)h(=)h(zmsg_recv)e(\(localfe\);)1114 3761 y(reroutable)g(=)h
(1;)934 3858 y(})934 3955 y(else)1114 4052 y(break;)268
b(//)89 b(No)44 b(work,)g(go)h(back)f(to)h(backends)934
4246 y(//)90 b(If)44 b(reroutable,)f(send)h(to)h(cloud)f(20\045)g(of)h
(the)f(time)934 4344 y(//)90 b(Here)44 b(we'd)g(normally)f(use)i(cloud)
f(status)g(information)934 4441 y(//)934 4538 y(if)h(\(reroutable)e(&&)
h(argc)g(>)h(2)g(&&)f(randof)g(\(5\))g(==)h(0\))f({)1114
4635 y(//)89 b(Route)44 b(to)g(random)g(broker)g(peer)1114
4732 y(int)g(random_peer)f(=)i(randof)e(\(argc)h(-)h(2\))g(+)f(2;)1114
4829 y(zmsg_pushmem)e(\(msg,)i(argv)h([random_peer],)d(strlen)i(\(argv)
g([random_peer]\)\);)1114 4926 y(zmsg_send)f(\(&msg,)h(cloudbe\);)934
5023 y(})934 5121 y(else)g({)p Black 3759 5569 a Ff(141)p
Black eop end
%%Page: 142 155
TeXDict begin 142 154 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.142) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 1114 72 a Fe(zframe_t)1517 85 y(*)1562
72 y(frame)44 b(=)h(\(zframe_t)2369 85 y(*)2414 72 y(\))f(zlist_pop)g
(\(workers\);)1114 170 y(zmsg_wrap)f(\(msg,)h(frame\);)1114
267 y(zmsg_send)f(\(&msg,)h(localbe\);)1114 364 y(capacity--;)934
461 y(})755 558 y(})576 655 y(})576 752 y(//)89 b(When)44
b(we're)g(done,)g(clean)g(up)h(properly)576 850 y(while)f(\(zlist_size)
f(\(workers\)\))g({)755 947 y(zframe_t)1158 960 y(*)1203
947 y(frame)h(=)h(\(zframe_t)2010 960 y(*)2055 947 y(\))g(zlist_pop)e
(\(workers\);)755 1044 y(zframe_destroy)f(\(&frame\);)576
1141 y(})576 1238 y(zlist_destroy)g(\(&workers\);)576
1335 y(zctx_destroy)g(\(&ctx\);)576 1432 y(return)h(EXIT_SUCCESS;)396
1530 y(})-2 1704 y
SDict begin H.S end
 -2 1704 a -2 1704 a
SDict begin 13 H.A end
 -2 1704 a -2 1704
a
SDict begin [/View [/XYZ H.V]/Dest (0:1913) cvn /DEST pdfmark end
 -2 1704 a 396 1803 a Fk(Run)20 b(this)h(by)-5 b(,)19
b(for)h(instance,)f(starting)h(tw)o(o)h(instance)e(of)h(the)h(brok)o
(er)d(in)j(tw)o(o)f(windo)n(ws:)-2 1904 y
SDict begin H.S end
 -2 1904 a -2
1904 a
SDict begin 11.7 H.A end
 -2 1904 a -2 1904 a
SDict begin [/View [/XYZ H.V]/Dest (0:1914) cvn /DEST pdfmark end
 -2 1904 a 396 1984 a Fe(peering2)44
b(me)g(you)396 2081 y(peering2)g(you)g(me)-2 2258 y
SDict begin H.S end
 -2
2258 a -2 2258 a
SDict begin 13 H.A end
 -2 2258 a -2 2258 a
SDict begin [/View [/XYZ H.V]/Dest (0:1915) cvn /DEST pdfmark end
 -2 2258 a 396 2355
a Fk(Some)20 b(comments)f(on)h(this)h(code:)-2 2356 y
SDict begin H.S end

-2 2356 a -2 2356 a
SDict begin 13 H.A end
 -2 2356 a -2 2356 a
SDict begin [/View [/XYZ H.V]/Dest (0:1916) cvn /DEST pdfmark end
 -2 2356 a -2
2366 a
SDict begin H.S end
 -2 2366 a -2 2366 a
SDict begin 13 H.A end
 -2 2366 a -2 2366 a
SDict begin [/View [/XYZ H.V]/Dest (0:1917) cvn /DEST pdfmark end
 -2 2366
a Black 396 2525 a Fj(\225)p Black 479 2525 a
SDict begin H.S end
 479 2525
a 479 2525 a
SDict begin 13 H.A end
 479 2525 a 479 2525 a
SDict begin [/View [/XYZ H.V]/Dest (0:1918) cvn /DEST pdfmark end
 479 2525 a Fk(Using)f(the)h(zmsg)f
(class)h(mak)o(es)f(life)g(much)f(easier)m(,)h(and)g(our)f(code)h(much)
f(shorter)-5 b(.)20 b(It')-5 b(s)20 b(ob)o(viously)e(an)j(abstraction)
479 2633 y(that)g(w)o(orks.)e(If)h(you)f(b)n(uild)h(\330MQ)h
(applications)e(in)h(C,)h(you)e(should)g(use)i(CZMQ.)-2
2651 y
SDict begin H.S end
 -2 2651 a -2 2651 a
SDict begin 13 H.A end
 -2 2651 a -2 2651 a
SDict begin [/View [/XYZ H.V]/Dest (0:1919) cvn /DEST pdfmark end
 -2 2651
a Black 396 2782 a Fj(\225)p Black 479 2782 a
SDict begin H.S end
 479 2782
a 479 2782 a
SDict begin 13 H.A end
 479 2782 a 479 2782 a
SDict begin [/View [/XYZ H.V]/Dest (0:1920) cvn /DEST pdfmark end
 479 2782 a Fk(Since)g(we')l(re)e
(not)h(getting)f(an)o(y)h(state)h(information)c(from)j(peers,)f(we)i
(nai)n(v)o(ely)e(assume)h(the)o(y)f(are)h(running.)e(The)479
2890 y(code)i(prompts)f(you)g(to)h(con\002rm)f(when)h(you')l(v)o(e)e
(started)i(all)h(the)f(brok)o(ers.)f(In)g(the)i(real)f(case)h(we')l(d)e
(not)h(send)479 2998 y(an)o(ything)e(to)j(brok)o(ers)e(who)g(had)h(not)
g(told)g(us)g(the)o(y)g(e)o(xist.)-2 3182 y
SDict begin H.S end
 -2 3182 a
-2 3182 a
SDict begin 13 H.A end
 -2 3182 a -2 3182 a
SDict begin [/View [/XYZ H.V]/Dest (0:1921) cvn /DEST pdfmark end
 -2 3182 a 396 3272 a Fk(Y)-9
b(ou)20 b(can)g(satisfy)g(yourself)f(that)h(the)h(code)e(w)o(orks)h(by)
g(w)o(atching)f(it)i(run)e(fore)n(v)o(er)-5 b(.)19 b(If)h(there)f(were)
i(an)o(y)e(misrouted)396 3380 y(messages,)h(clients)h(w)o(ould)e(end)h
(up)g(blocking,)e(and)h(the)i(brok)o(ers)e(w)o(ould)g(stop)h(printing)f
(trace)h(information.)e(Y)-9 b(ou)19 b(can)396 3488 y(pro)o(v)o(e)f
(that)i(by)f(killing)g(either)h(of)f(the)h(brok)o(ers.)e(The)i(other)e
(brok)o(er)h(tries)h(to)g(send)f(requests)h(to)g(the)f(cloud,)g(and)g
(one)g(by)396 3596 y(one)h(its)h(clients)g(block,)e(w)o(aiting)h(for)f
(an)h(answer)-5 b(.)-2 3624 y
SDict begin H.S end
 -2 3624 a -2 3624 a
SDict begin 13 H.A end
 -2
3624 a -2 3624 a
SDict begin [/View [/XYZ H.V]/Dest (0:1922) cvn /DEST pdfmark end
 -2 3624 a 396 3934 a Fb(3.9.8.)36 b(Putting)d(it)g
(All)h(T)-10 b(og)q(ether)1968 3934 y
SDict begin H.S end
 1968 3934 a 1968
3934 a
SDict begin 18.72 H.A end
 1968 3934 a 1968 3934 a
SDict begin [/View [/XYZ H.V]/Dest (8.54.12.2) cvn /DEST pdfmark end
 1968 3934 a -2 4127 a
SDict begin H.S end

-2 4127 a -2 4127 a
SDict begin 13 H.A end
 -2 4127 a -2 4127 a
SDict begin [/View [/XYZ H.V]/Dest (0:1924) cvn /DEST pdfmark end
 -2 4127 a 396
4208 a Fk(Let')-5 b(s)21 b(put)f(this)h(together)d(into)i(a)h(single)f
(package.)f(As)i(before,)d(we')o(ll)j(run)e(an)h(entire)g(cluster)g(as)
h(one)f(process.)f(W)-7 b(e')l(re)396 4316 y(going)19
b(to)h(tak)o(e)h(the)f(tw)o(o)g(pre)n(vious)f(e)o(xamples)g(and)h(mer)o
(ge)e(them)i(into)g(one)g(properly)e(w)o(orking)g(design)i(that)g(lets)
h(you)396 4424 y(simulate)f(an)o(y)g(number)e(of)i(clusters.)-2
4608 y
SDict begin H.S end
 -2 4608 a -2 4608 a
SDict begin 13 H.A end
 -2 4608 a -2 4608 a
SDict begin [/View [/XYZ H.V]/Dest (0:1925) cvn /DEST pdfmark end
 -2 4608
a 396 4698 a Fk(This)f(code)g(is)h(the)f(size)g(of)g(both)f(pre)n
(vious)f(prototypes)g(together)m(,)h(at)h(270)f(LoC.)h(That')-5
b(s)19 b(pretty)f(good)g(for)g(a)i(simulation)396 4806
y(of)g(a)h(cluster)f(that)g(includes)g(clients)g(and)g(w)o(ork)o(ers)f
(and)h(cloud)f(w)o(orkload)g(distrib)n(ution.)f(Here)i(is)i(the)e
(code:)-2 4807 y
SDict begin H.S end
 -2 4807 a -2 4807 a
SDict begin 13 H.A end
 -2 4807 a -2 4807
a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c) cvn /DEST pdfmark
end
 -2 4807 a Black 3759 5569 a Ff(142)p Black eop end
%%Page: 143 156
TeXDict begin 143 155 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.143) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Example)21 b(3-29.)d(Full)j(cluster)g
(simulation)f(\(peering3.c\))-2 172 y
SDict begin H.S end
 -2 172 a -2 172
a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1928) cvn /DEST pdfmark end
 -2 172 a 396 253 a Fe(//)396 350
y(//)90 b(Broker)43 b(peering)h(simulation)f(\(part)h(3\))396
447 y(//)90 b(Prototypes)43 b(the)h(full)g(flow)g(of)h(status)f(and)g
(tasks)396 544 y(//)396 641 y(#include)g("czmq.h")396
835 y(#define)g(NBR_CLIENTS)f(10)396 933 y(#define)h(NBR_WORKERS)f(5)
396 1030 y(#define)h(LRU_READY)133 b("\\001")268 b(//)89
b(Signals)44 b(worker)g(is)g(ready)396 1224 y(//)90 b(Our)44
b(own)g(name;)g(in)h(practice)e(this)h(would)g(be)h(configured)e(per)h
(node)396 1321 y(static)g(char)934 1334 y(*)979 1321
y(self;)-2 1495 y
SDict begin H.S end
 -2 1495 a -2 1495 a
SDict begin 13 H.A end
 -2 1495 a -2 1495
a
SDict begin [/View [/XYZ H.V]/Dest (0:1929) cvn /DEST pdfmark end
 -2 1495 a 396 1595 a Fk(This)21 b(is)g(the)f(client)g(task.)g(It)h
(issues)g(a)g(b)n(urst)f(of)g(requests)g(and)f(then)h(sleeps)h(for)e(a)
i(fe)n(w)f(seconds.)f(This)i(simulates)396 1703 y(sporadic)e(acti)n
(vity;)h(when)g(a)g(number)f(of)h(clients)g(are)g(acti)n(v)o(e)g(at)h
(once,)e(the)h(local)g(w)o(ork)o(ers)g(should)f(be)h(o)o(v)o(erloaded.)
396 1811 y(The)g(client)g(uses)h(a)g(REQ)f(sock)o(et)h(for)e(requests)h
(and)g(also)g(pushes)g(statistics)i(to)e(the)g(monitor)f(sock)o(et:)-2
1829 y
SDict begin H.S end
 -2 1829 a -2 1829 a
SDict begin 13 H.A end
 -2 1829 a -2 1829 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-1) cvn /DEST pdfmark
end
 -2 1829
a 396 2012 a Fg(Example)i(3-30.)d(Full)j(cluster)g(simulation)f
(\(peering3.c\))f(-)h(client)h(task)-2 2112 y
SDict begin H.S end
 -2 2112
a -2 2112 a
SDict begin 11.7 H.A end
 -2 2112 a -2 2112 a
SDict begin [/View [/XYZ H.V]/Dest (0:1932) cvn /DEST pdfmark end
 -2 2112 a 396 2290 a
Fe(static)44 b(void)934 2303 y(*)396 2387 y(client_task)f(\(void)1203
2400 y(*)1248 2387 y(args\))396 2484 y({)576 2581 y(zctx_t)889
2594 y(*)934 2581 y(ctx)i(=)f(zctx_new)g(\(\);)576 2678
y(void)800 2691 y(*)845 2678 y(client)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 2775 y(zsocket_connect)e(\(client,)h
("ipc://\045s-localfe.ipc",)e(self\);)576 2872 y(void)800
2885 y(*)845 2872 y(monitor)i(=)i(zsocket_new)e(\(ctx,)h(ZMQ_PUSH\);)
576 2970 y(zsocket_connect)e(\(monitor,)h("ipc://\045s-monitor.ipc",)e
(self\);)576 3164 y(while)j(\(true\))f({)755 3261 y(sleep)h(\(randof)g
(\(5\)\);)755 3358 y(int)g(burst)g(=)h(randof)f(\(15\);)755
3455 y(while)g(\(burst--\))f({)934 3552 y(char)h(task_id)g([5];)934
3649 y(sprintf)g(\(task_id,)f("\04504X",)h(randof)g(\(0x10000\)\);)934
3844 y(//)90 b(Send)44 b(request)f(with)i(random)e(hex)i(ID)934
3941 y(zstr_send)f(\(client,)f(task_id\);)934 4135 y(//)90
b(Wait)44 b(max)g(ten)g(seconds)g(for)g(a)h(reply,)f(then)g(complain)
934 4232 y(zmq_pollitem_t)f(pollset)g([1])i(=)f({)h({)g(client,)e(0,)i
(ZMQ_POLLIN,)e(0)h(})h(};)934 4329 y(int)g(rc)f(=)h(zmq_poll)e
(\(pollset,)h(1,)g(10)2459 4342 y(*)2548 4329 y(1000)2772
4342 y(*)2862 4329 y(ZMQ_POLL_MSEC\);)934 4427 y(if)h(\(rc)f(==)h(-1\))
1114 4524 y(break;)447 b(//)89 b(Interrupted)934 4718
y(if)45 b(\(pollset)e([0].revents)g(&)i(ZMQ_POLLIN\))e({)1114
4815 y(char)1338 4828 y(*)1383 4815 y(reply)h(=)g(zstr_recv)g
(\(client\);)1114 4912 y(if)g(\(!reply\))1293 5009 y(break;)627
b(//)89 b(Interrupted)1114 5107 y(//)g(Worker)44 b(is)g(supposed)g(to)g
(answer)g(us)h(with)f(our)g(task)g(id)p Black 3759 5569
a Ff(143)p Black eop end
%%Page: 144 157
TeXDict begin 144 156 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.144) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 1114 72 a Fe(assert)43 b(\(streq)h(\(reply,)g
(task_id\)\);)1114 170 y(zstr_sendf)f(\(monitor,)g("\045s",)h(reply\);)
1114 267 y(free)g(\(reply\);)934 364 y(})934 461 y(else)g({)1114
558 y(zstr_sendf)f(\(monitor,)1293 655 y("E:)h(CLIENT)g(EXIT)g(-)h
(lost)f(task)g(\045s",)g(task_id\);)1114 752 y(return)f(NULL;)934
850 y(})755 947 y(})576 1044 y(})576 1141 y(zctx_destroy)f(\(&ctx\);)
576 1238 y(return)h(NULL;)396 1335 y(})-2 1510 y
SDict begin H.S end
 -2 1510
a -2 1510 a
SDict begin 13 H.A end
 -2 1510 a -2 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:1933) cvn /DEST pdfmark end
 -2 1510 a 396 1609 a
Fk(This)21 b(is)g(the)f(w)o(ork)o(er)f(task,)h(which)g(uses)h(a)f(REQ)h
(sock)o(et)f(to)h(plug)e(into)h(the)g(LR)m(U)h(router)-5
b(.)19 b(It')-5 b(s)21 b(the)f(same)g(stub)g(w)o(ork)o(er)396
1717 y(task)h(you')l(v)o(e)d(seen)i(in)g(other)g(e)o(xamples:)-2
1735 y
SDict begin H.S end
 -2 1735 a -2 1735 a
SDict begin 13 H.A end
 -2 1735 a -2 1735 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-2) cvn /DEST pdfmark
end
 -2 1735
a 396 1918 a Fg(Example)h(3-31.)d(Full)j(cluster)g(simulation)f
(\(peering3.c\))f(-)h(w)o(ork)o(er)g(task)-2 2018 y
SDict begin H.S end
 -2
2018 a -2 2018 a
SDict begin 11.7 H.A end
 -2 2018 a -2 2018 a
SDict begin [/View [/XYZ H.V]/Dest (0:1936) cvn /DEST pdfmark end
 -2 2018 a 396 2196
a Fe(static)44 b(void)934 2209 y(*)396 2293 y(worker_task)f(\(void)1203
2306 y(*)1248 2293 y(args\))396 2390 y({)576 2487 y(zctx_t)889
2500 y(*)934 2487 y(ctx)i(=)f(zctx_new)g(\(\);)576 2584
y(void)800 2597 y(*)845 2584 y(worker)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 2681 y(zsocket_connect)e(\(worker,)h
("ipc://\045s-localbe.ipc",)e(self\);)576 2876 y(//)89
b(Tell)44 b(broker)g(we're)g(ready)g(for)g(work)576 2973
y(zframe_t)979 2986 y(*)1024 2973 y(frame)g(=)h(zframe_new)e
(\(LRU_READY,)g(1\);)576 3070 y(zframe_send)g(\(&frame,)g(worker,)h
(0\);)576 3264 y(//)89 b(Process)44 b(messages)f(as)i(they)f(arrive)576
3361 y(while)g(\(true\))f({)755 3459 y(zmsg_t)1069 3472
y(*)1114 3459 y(msg)h(=)h(zmsg_recv)e(\(worker\);)755
3556 y(if)h(\(!msg\))934 3653 y(break;)627 b(//)89 b(Interrupted)755
3847 y(//)g(Workers)44 b(are)g(busy)g(for)h(0/1)f(seconds)755
3944 y(sleep)g(\(randof)g(\(2\)\);)755 4041 y(zmsg_send)f(\(&msg,)h
(worker\);)576 4138 y(})576 4236 y(zctx_destroy)e(\(&ctx\);)576
4333 y(return)h(NULL;)396 4430 y(})-2 4604 y
SDict begin H.S end
 -2 4604
a -2 4604 a
SDict begin 13 H.A end
 -2 4604 a -2 4604 a
SDict begin [/View [/XYZ H.V]/Dest (0:1937) cvn /DEST pdfmark end
 -2 4604 a 396 4704 a
Fk(The)20 b(main)g(task)g(be)o(gins)g(by)f(setting-up)g(all)i(its)g
(sock)o(ets.)f(The)g(local)g(frontend)e(talks)j(to)f(clients,)h(and)e
(our)h(local)396 4812 y(back)o(end)f(talks)h(to)h(w)o(ork)o(ers.)e(The)
h(cloud)f(frontend)f(talks)j(to)f(peer)g(brok)o(ers)f(as)i(if)f(the)o
(y)f(were)i(clients,)f(and)f(the)i(cloud)396 4920 y(back)o(end)e(talks)
h(to)h(peer)e(brok)o(ers)g(as)i(if)g(the)o(y)e(were)h(w)o(ork)o(ers.)f
(The)h(state)h(back)o(end)e(publishes)g(re)o(gular)g(state)396
5028 y(messages,)h(and)g(the)g(state)h(frontend)d(subscribes)i(to)g
(all)h(state)g(back)o(ends)e(to)h(collect)g(these)g(messages.)h
(Finally)-5 b(,)19 b(we)396 5136 y(use)i(a)f(PULL)h(monitor)d(sock)o
(et)i(to)h(collect)f(printable)f(messages)h(from)f(tasks:)-2
5154 y
SDict begin H.S end
 -2 5154 a -2 5154 a
SDict begin 13 H.A end
 -2 5154 a -2 5154 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-3) cvn /DEST pdfmark
end
 -2 5154
a Black 3759 5569 a Ff(144)p Black eop end
%%Page: 145 158
TeXDict begin 145 157 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.145) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 396 72 a Fg(Example)21 b(3-32.)d(Full)j(cluster)g
(simulation)f(\(peering3.c\))f(-)h(main)h(task)-2 172
y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:1940) cvn /DEST pdfmark end
 -2 172 a 396 350
a Fe(int)45 b(main)f(\(int)g(argc,)g(char)1517 363 y(*)1562
350 y(argv)g([]\))396 447 y({)576 544 y(//)89 b(First)44
b(argument)f(is)i(this)f(broker's)g(name)576 641 y(//)89
b(Other)44 b(arguments)f(are)i(our)f(peers')g(names)576
738 y(//)576 835 y(if)g(\(argc)g(<)h(2\))f({)755 933
y(printf)g(\("syntax:)f(peering3)h(me)g({you}...\\n"\);)755
1030 y(exit)g(\(EXIT_FAILURE\);)576 1127 y(})576 1224
y(self)g(=)g(argv)h([1];)576 1321 y(printf)e(\("I:)i(preparing)e
(broker)h(at)g(\045s...\\n",)g(self\);)576 1418 y(srandom)f
(\(\(unsigned\))g(time)h(\(NULL\)\);)576 1613 y(zctx_t)889
1626 y(*)934 1613 y(ctx)h(=)f(zctx_new)g(\(\);)576 1807
y(//)89 b(Prepare)44 b(local)g(frontend)f(and)h(backend)576
1904 y(void)800 1917 y(*)845 1904 y(localfe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_ROUTER\);)576 2001 y(zsocket_bind)e(\(localfe,)i
("ipc://\045s-localfe.ipc",)d(self\);)576 2195 y(void)800
2208 y(*)845 2195 y(localbe)i(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)
576 2292 y(zsocket_bind)e(\(localbe,)i("ipc://\045s-localbe.ipc",)d
(self\);)576 2487 y(//)89 b(Bind)44 b(cloud)g(frontend)g(to)g(endpoint)
576 2584 y(void)800 2597 y(*)845 2584 y(cloudfe)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_ROUTER\);)576 2681 y(zsockopt_set_identity)d(\(cloudfe,)i
(self\);)576 2778 y(zsocket_bind)f(\(cloudfe,)i
("ipc://\045s-cloud.ipc",)d(self\);)576 2972 y(//)89
b(Connect)44 b(cloud)g(backend)f(to)i(all)f(peers)576
3070 y(void)800 3083 y(*)845 3070 y(cloudbe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_ROUTER\);)576 3167 y(zsockopt_set_identity)d(\(cloudbe,)i
(self\);)576 3264 y(int)h(argn;)576 3361 y(for)g(\(argn)g(=)h(2;)f
(argn)g(<)h(argc;)f(argn++\))g({)755 3458 y(char)979
3471 y(*)1024 3458 y(peer)g(=)h(argv)f([argn];)755 3555
y(printf)g(\("I:)g(connecting)f(to)i(cloud)f(frontend)f(at)i
('\045s'\\n",)e(peer\);)755 3652 y(zsocket_connect)f(\(cloudbe,)i
("ipc://\045s-cloud.ipc",)d(peer\);)576 3750 y(})576
3847 y(//)89 b(Bind)44 b(state)g(backend)g(to)g(endpoint)576
3944 y(void)800 3957 y(*)845 3944 y(statebe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_PUB\);)576 4041 y(zsocket_bind)e(\(statebe,)i
("ipc://\045s-state.ipc",)d(self\);)576 4235 y(//)89
b(Connect)44 b(state)g(frontend)f(to)i(all)f(peers)576
4332 y(void)800 4345 y(*)845 4332 y(statefe)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_SUB\);)576 4429 y(zsockopt_set_subscribe)d(\(statefe,)i(""\);)576
4527 y(for)h(\(argn)g(=)h(2;)f(argn)g(<)h(argc;)f(argn++\))g({)755
4624 y(char)979 4637 y(*)1024 4624 y(peer)g(=)h(argv)f([argn];)755
4721 y(printf)g(\("I:)g(connecting)f(to)i(state)f(backend)f(at)i
('\045s'\\n",)e(peer\);)755 4818 y(zsocket_connect)f(\(statefe,)i
("ipc://\045s-state.ipc",)d(peer\);)576 4915 y(})576
5012 y(//)89 b(Prepare)44 b(monitor)f(socket)576 5109
y(void)800 5122 y(*)845 5109 y(monitor)g(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_PULL\);)p Black 3759 5569 a Ff(145)p Black eop end
%%Page: 146 159
TeXDict begin 146 158 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.146) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 576 72 a Fe(zsocket_bind)42 b(\(monitor,)i
("ipc://\045s-monitor.ipc",)d(self\);)-2 250 y
SDict begin H.S end
 -2 250
a -2 250 a
SDict begin 13 H.A end
 -2 250 a -2 250 a
SDict begin [/View [/XYZ H.V]/Dest (0:1941) cvn /DEST pdfmark end
 -2 250 a 396 346 a Fk(After)20
b(binding)f(and)g(connecting)f(all)j(our)f(sock)o(ets,)g(we)g(start)h
(our)e(child)h(tasks)h(-)f(w)o(ork)o(ers)g(and)f(clients:)-2
364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-4) cvn /DEST pdfmark
end
 -2 364 a 396
548 a Fg(Example)i(3-33.)d(Full)j(cluster)g(simulation)f
(\(peering3.c\))f(-)h(start)g(child)h(tasks)-2 648 y
SDict begin H.S end

-2 648 a -2 648 a
SDict begin 11.7 H.A end
 -2 648 a -2 648 a
SDict begin [/View [/XYZ H.V]/Dest (0:1944) cvn /DEST pdfmark end
 -2 648 a 576 825
a Fe(int)44 b(worker_nbr;)576 922 y(for)g(\(worker_nbr)f(=)i(0;)f
(worker_nbr)f(<)i(NBR_WORKERS;)e(worker_nbr++\))755 1019
y(zthread_new)g(\(worker_task,)g(NULL\);)576 1214 y(//)89
b(Start)44 b(local)g(clients)576 1311 y(int)g(client_nbr;)576
1408 y(for)g(\(client_nbr)f(=)i(0;)f(client_nbr)f(<)i(NBR_CLIENTS;)e
(client_nbr++\))755 1505 y(zthread_new)g(\(client_task,)g(NULL\);)576
1699 y(//)89 b(Queue)44 b(of)g(available)g(workers)576
1796 y(int)g(local_capacity)e(=)j(0;)576 1894 y(int)f(cloud_capacity)e
(=)j(0;)576 1991 y(zlist_t)934 2004 y(*)979 1991 y(workers)f(=)g
(zlist_new)g(\(\);)-2 2167 y
SDict begin H.S end
 -2 2167 a -2 2167 a
SDict begin 13 H.A end
 -2 2167
a -2 2167 a
SDict begin [/View [/XYZ H.V]/Dest (0:1945) cvn /DEST pdfmark end
 -2 2167 a 396 2265 a Fk(The)20 b(main)g(loop)f(has)i(tw)o
(o)f(parts.)g(First)h(we)g(poll)f(w)o(ork)o(ers)f(and)h(our)f(tw)o(o)i
(service)e(sock)o(ets)i(\(statefe)f(and)g(monitor\),)e(in)396
2373 y(an)o(y)i(case.)g(If)g(we)h(ha)n(v)o(e)e(no)h(ready)f(w)o(ork)o
(ers,)g(there')-5 b(s)21 b(no)e(point)h(in)g(looking)f(at)h(incoming)f
(requests.)g(These)h(can)396 2481 y(remain)g(on)f(their)h(internal)g
(\330MQ)g(queues:)-2 2499 y
SDict begin H.S end
 -2 2499 a -2 2499 a
SDict begin 13 H.A end
 -2 2499
a -2 2499 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-5) cvn /DEST pdfmark
end
 -2 2499 a 396 2682 a Fg(Example)h(3-34.)d(Full)j(cluster)g
(simulation)f(\(peering3.c\))f(-)h(main)h(loop)-2 2782
y
SDict begin H.S end
 -2 2782 a -2 2782 a
SDict begin 11.7 H.A end
 -2 2782 a -2 2782 a
SDict begin [/View [/XYZ H.V]/Dest (0:1948) cvn /DEST pdfmark end
 -2 2782 a 576
2959 a Fe(while)44 b(\(true\))f({)755 3056 y(zmq_pollitem_t)f(primary)i
([])h(=)f({)934 3153 y({)h(localbe,)e(0,)i(ZMQ_POLLIN,)e(0)i(},)934
3251 y({)g(cloudbe,)e(0,)i(ZMQ_POLLIN,)e(0)i(},)934 3348
y({)g(statefe,)e(0,)i(ZMQ_POLLIN,)e(0)i(},)934 3445 y({)g(monitor,)e
(0,)i(ZMQ_POLLIN,)e(0)i(})755 3542 y(};)755 3639 y(//)89
b(If)45 b(we)f(have)g(no)h(workers)f(ready,)f(wait)i(indefinitely)755
3736 y(int)f(rc)h(=)f(zmq_poll)g(\(primary,)f(4,)934
3833 y(local_capacity?)g(1000)1876 3846 y(*)1965 3833
y(ZMQ_POLL_MSEC:)g(-1\);)755 3931 y(if)h(\(rc)h(==)f(-1\))934
4028 y(break;)627 b(//)89 b(Interrupted)755 4222 y(//)g(Track)44
b(if)h(capacity)e(changes)h(during)g(this)g(iteration)755
4319 y(int)g(previous)g(=)g(local_capacity;)755 4513
y(//)89 b(Handle)44 b(reply)g(from)g(local)g(worker)755
4610 y(zmsg_t)1069 4623 y(*)1114 4610 y(msg)g(=)h(NULL;)755
4805 y(if)f(\(primary)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
4902 y(msg)i(=)f(zmsg_recv)g(\(localbe\);)934 4999 y(if)h(\(!msg\))1114
5096 y(break;)447 b(//)89 b(Interrupted)p Black 3757
5569 a Ff(146)p Black eop end
%%Page: 147 160
TeXDict begin 147 159 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.147) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 934 72 a Fe(zframe_t)1338 85 y(*)1383
72 y(address)43 b(=)i(zmsg_unwrap)e(\(msg\);)934 170
y(zlist_append)g(\(workers,)g(address\);)934 267 y(local_capacity++;)
934 461 y(//)90 b(If)44 b(it's)g(READY,)g(don't)g(route)g(the)g
(message)g(any)g(further)934 558 y(zframe_t)1338 571
y(*)1383 558 y(frame)g(=)g(zmsg_first)f(\(msg\);)934
655 y(if)i(\(memcmp)e(\(zframe_data)g(\(frame\),)h(LRU_READY,)f(1\))h
(==)h(0\))1114 752 y(zmsg_destroy)d(\(&msg\);)755 850
y(})755 947 y(//)89 b(Or)45 b(handle)f(reply)g(from)g(peer)g(broker)755
1044 y(else)755 1141 y(if)g(\(primary)g([1].revents)f(&)i(ZMQ_POLLIN\))
e({)934 1238 y(msg)i(=)f(zmsg_recv)g(\(cloudbe\);)934
1335 y(if)h(\(!msg\))1114 1432 y(break;)447 b(//)89 b(Interrupted)934
1530 y(//)h(We)44 b(don't)g(use)g(peer)h(broker)e(address)h(for)g
(anything)934 1627 y(zframe_t)1338 1640 y(*)1383 1627
y(address)f(=)i(zmsg_unwrap)e(\(msg\);)934 1724 y(zframe_destroy)g
(\(&address\);)755 1821 y(})755 1918 y(//)89 b(Route)44
b(reply)g(to)h(cloud)f(if)g(it's)g(addressed)g(to)g(a)h(broker)755
2015 y(for)f(\(argn)g(=)h(2;)f(msg)h(&&)f(argn)g(<)h(argc;)f(argn++\))g
({)934 2112 y(char)1158 2125 y(*)1203 2112 y(data)g(=)h(\(char)1786
2125 y(*)1831 2112 y(\))g(zframe_data)e(\(zmsg_first)g(\(msg\)\);)934
2209 y(size_t)h(size)g(=)h(zframe_size)e(\(zmsg_first)g(\(msg\)\);)934
2307 y(if)i(\(size)f(==)g(strlen)g(\(argv)g([argn]\))934
2404 y(&&)90 b(memcmp)43 b(\(data,)h(argv)g([argn],)g(size\))g(==)h
(0\))1114 2501 y(zmsg_send)e(\(&msg,)h(cloudfe\);)755
2598 y(})755 2695 y(//)89 b(Route)44 b(reply)g(to)h(client)f(if)g(we)h
(still)f(need)g(to)755 2792 y(if)g(\(msg\))934 2889 y(zmsg_send)g
(\(&msg,)f(localfe\);)-2 3067 y
SDict begin H.S end
 -2 3067 a -2 3067 a
SDict begin 13 H.A end
 -2
3067 a -2 3067 a
SDict begin [/View [/XYZ H.V]/Dest (0:1949) cvn /DEST pdfmark end
 -2 3067 a 396 3163 a Fk(If)20 b(we)h(ha)n(v)o(e)e
(input)h(messages)g(on)g(our)f(statefe)i(or)f(monitor)e(sock)o(ets)j
(we)f(can)g(process)g(these)g(immediately:)-2 3181 y
SDict begin H.S end

-2 3181 a -2 3181 a
SDict begin 13 H.A end
 -2 3181 a -2 3181 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-6) cvn /DEST pdfmark
end
 -2 3181 a 396
3365 a Fg(Example)h(3-35.)d(Full)j(cluster)g(simulation)f
(\(peering3.c\))f(-)h(handle)h(state)f(messages)-2 3465
y
SDict begin H.S end
 -2 3465 a -2 3465 a
SDict begin 11.7 H.A end
 -2 3465 a -2 3465 a
SDict begin [/View [/XYZ H.V]/Dest (0:1952) cvn /DEST pdfmark end
 -2 3465 a 755
3642 a Fe(if)44 b(\(primary)g([2].revents)f(&)i(ZMQ_POLLIN\))e({)934
3739 y(char)1158 3752 y(*)1203 3739 y(peer)h(=)h(zstr_recv)e
(\(statefe\);)934 3836 y(char)1158 3849 y(*)1203 3836
y(status)h(=)h(zstr_recv)e(\(statefe\);)934 3933 y(cloud_capacity)g(=)h
(atoi)h(\(status\);)934 4031 y(free)f(\(peer\);)934 4128
y(free)g(\(status\);)755 4225 y(})755 4322 y(if)g(\(primary)g
([3].revents)f(&)i(ZMQ_POLLIN\))e({)934 4419 y(char)1158
4432 y(*)1203 4419 y(status)h(=)h(zstr_recv)e(\(monitor\);)934
4516 y(printf)h(\("\045s\\n",)g(status\);)934 4613 y(free)g
(\(status\);)755 4711 y(})p Black 3756 5569 a Ff(147)p
Black eop end
%%Page: 148 161
TeXDict begin 148 160 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.148) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a
-2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:1953) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(No)n(w)20 b(route)g(as)h(man)o(y)e
(clients)h(requests)g(as)h(we)f(can)g(handle.)f(If)h(we)h(ha)n(v)o(e)e
(local)i(capacity)e(we)i(poll)e(both)h(localfe)f(and)396
180 y(cloudfe.)g(If)h(we)g(ha)n(v)o(e)g(cloud)f(capacity)h(only)-5
b(,)18 b(we)j(poll)f(just)h(localfe.)e(W)-7 b(e)21 b(route)f(an)o(y)f
(request)h(locally)f(if)i(we)f(can,)g(else)396 288 y(we)h(route)e(to)i
(the)f(cloud.)-2 289 y
SDict begin H.S end
 -2 289 a -2 289 a
SDict begin 13 H.A end
 -2 289 a -2
289 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-7) cvn /DEST pdfmark
end
 -2 289 a 396 490 a Fg(Example)h(3-36.)d(Full)j(cluster)g
(simulation)f(\(peering3.c\))f(-)h(r)o(oute)f(client)i(r)o(equests)-2
590 y
SDict begin H.S end
 -2 590 a -2 590 a
SDict begin 11.7 H.A end
 -2 590 a -2 590 a
SDict begin [/View [/XYZ H.V]/Dest (0:1956) cvn /DEST pdfmark end
 -2 590 a 755
670 a Fe(while)44 b(\(local_capacity)e(+)j(cloud_capacity\))d({)934
767 y(zmq_pollitem_t)h(secondary)g([])i(=)f({)1114 864
y({)g(localfe,)g(0,)g(ZMQ_POLLIN,)f(0)i(},)1114 961 y({)f(cloudfe,)g
(0,)g(ZMQ_POLLIN,)f(0)i(})934 1058 y(};)934 1156 y(if)g
(\(local_capacity\))1114 1253 y(rc)f(=)h(zmq_poll)e(\(secondary,)g(2,)i
(0\);)934 1350 y(else)1114 1447 y(rc)f(=)h(zmq_poll)e(\(secondary,)g
(1,)i(0\);)934 1544 y(assert)f(\(rc)g(>=)h(0\);)934 1738
y(if)g(\(secondary)e([0].revents)g(&)i(ZMQ_POLLIN\))1114
1835 y(msg)f(=)h(zmsg_recv)e(\(localfe\);)934 1933 y(else)934
2030 y(if)i(\(secondary)e([1].revents)g(&)i(ZMQ_POLLIN\))1114
2127 y(msg)f(=)h(zmsg_recv)e(\(cloudfe\);)934 2224 y(else)1114
2321 y(break;)268 b(//)89 b(No)44 b(work,)g(go)h(back)f(to)h(primary)
934 2515 y(if)g(\(local_capacity\))d({)1114 2613 y(zframe_t)1517
2626 y(*)1562 2613 y(frame)i(=)h(\(zframe_t)2369 2626
y(*)2414 2613 y(\))f(zlist_pop)g(\(workers\);)1114 2710
y(zmsg_wrap)f(\(msg,)h(frame\);)1114 2807 y(zmsg_send)f(\(&msg,)h
(localbe\);)1114 2904 y(local_capacity--;)934 3001 y(})934
3098 y(else)g({)1114 3195 y(//)89 b(Route)44 b(to)g(random)g(broker)g
(peer)1114 3292 y(int)g(random_peer)f(=)i(randof)e(\(argc)h(-)h(2\))g
(+)f(2;)1114 3390 y(zmsg_pushmem)e(\(msg,)i(argv)h([random_peer],)d
(strlen)i(\(argv)g([random_peer]\)\);)1114 3487 y(zmsg_send)f(\(&msg,)h
(cloudbe\);)934 3584 y(})755 3681 y(})-2 3855 y
SDict begin H.S end
 -2 3855
a -2 3855 a
SDict begin 13 H.A end
 -2 3855 a -2 3855 a
SDict begin [/View [/XYZ H.V]/Dest (0:1957) cvn /DEST pdfmark end
 -2 3855 a 396 3955 a
Fk(W)-7 b(e)21 b(broadcast)d(capacity)h(messages)h(to)f(other)g(peers;)
g(to)h(reduce)f(chatter)g(we)g(do)h(this)g(only)e(if)i(our)f(capacity)g
(changed.)-2 3973 y
SDict begin H.S end
 -2 3973 a -2 3973 a
SDict begin 13 H.A end
 -2 3973 a -2
3973 a
SDict begin [/View [/XYZ H.V]/Dest (0:peering3-c-8) cvn /DEST pdfmark
end
 -2 3973 a 396 4156 a Fg(Example)i(3-37.)d(Full)j(cluster)g
(simulation)f(\(peering3.c\))f(-)h(br)o(oadcast)f(capacity)-2
4256 y
SDict begin H.S end
 -2 4256 a -2 4256 a
SDict begin 11.7 H.A end
 -2 4256 a -2 4256 a
SDict begin [/View [/XYZ H.V]/Dest (0:1960) cvn /DEST pdfmark end
 -2 4256
a 755 4336 a Fe(if)44 b(\(local_capacity)f(!=)h(previous\))g({)934
4434 y(//)90 b(We)44 b(stick)g(our)g(own)h(address)e(onto)i(the)f
(envelope)934 4531 y(zstr_sendm)f(\(statebe,)h(self\);)934
4628 y(//)90 b(Broadcast)43 b(new)h(capacity)934 4725
y(zstr_sendf)f(\(statebe,)h("\045d",)g(local_capacity\);)755
4822 y(})576 4919 y(})576 5016 y(//)89 b(When)44 b(we're)g(done,)g
(clean)g(up)h(properly)576 5114 y(while)f(\(zlist_size)f(\(workers\)\))
g({)p Black 3759 5569 a Ff(148)p Black eop end
%%Page: 149 162
TeXDict begin 149 161 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.149) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2384 -132 a Ff(Chapter)20 b(3.)g(Advanced)e(Request-Reply)g(P)-7
b(atterns)p Black 755 72 a Fe(zframe_t)1158 85 y(*)1203
72 y(frame)44 b(=)h(\(zframe_t)2010 85 y(*)2055 72 y(\))g(zlist_pop)e
(\(workers\);)755 170 y(zframe_destroy)f(\(&frame\);)576
267 y(})576 364 y(zlist_destroy)g(\(&workers\);)576 461
y(zctx_destroy)g(\(&ctx\);)576 558 y(return)h(EXIT_SUCCESS;)396
655 y(})-2 830 y
SDict begin H.S end
 -2 830 a -2 830 a
SDict begin 13 H.A end
 -2 830 a -2 830 a
SDict begin [/View [/XYZ H.V]/Dest (0:1961) cvn /DEST pdfmark end

-2 830 a 396 929 a Fk(It')-5 b(s)21 b(a)g(non-tri)n(vial)d(program)g
(and)i(took)f(about)g(a)i(day)e(to)i(get)f(w)o(orking.)e(These)i(are)h
(the)f(highlights:)-2 947 y
SDict begin H.S end
 -2 947 a -2 947 a
SDict begin 13 H.A end
 -2 947
a -2 947 a
SDict begin [/View [/XYZ H.V]/Dest (0:1962) cvn /DEST pdfmark end
 -2 947 a -2 957 a
SDict begin H.S end
 -2 957 a -2 957 a
SDict begin 13 H.A end
 -2 957
a -2 957 a
SDict begin [/View [/XYZ H.V]/Dest (0:1963) cvn /DEST pdfmark end
 -2 957 a Black 396 1099 a Fj(\225)p Black
479 1099 a
SDict begin H.S end
 479 1099 a 479 1099 a
SDict begin 13 H.A end
 479 1099 a 479 1099
a
SDict begin [/View [/XYZ H.V]/Dest (0:1964) cvn /DEST pdfmark end
 479 1099 a Fk(The)g(client)g(threads)g(detect)g(and)g(report)f(a)h(f)
o(ailed)g(request.)f(The)o(y)h(do)f(this)i(by)f(polling)f(for)g(a)i
(response)e(and)h(if)g(none)479 1207 y(arri)n(v)o(es)g(after)f(a)i
(while)f(\(10)g(seconds\),)f(printing)f(an)j(error)e(message.)-2
1225 y
SDict begin H.S end
 -2 1225 a -2 1225 a
SDict begin 13 H.A end
 -2 1225 a -2 1225 a
SDict begin [/View [/XYZ H.V]/Dest (0:1965) cvn /DEST pdfmark end
 -2 1225
a Black 396 1357 a Fj(\225)p Black 479 1357 a
SDict begin H.S end
 479 1357
a 479 1357 a
SDict begin 13 H.A end
 479 1357 a 479 1357 a
SDict begin [/View [/XYZ H.V]/Dest (0:1966) cvn /DEST pdfmark end
 479 1357 a Fk(Client)i(threads)f
(don')o(t)e(print)i(directly)-5 b(,)18 b(b)n(ut)j(instead)f(send)f(a)i
(message)f(to)g(a)h('monitor')d(sock)o(et)i(\(PUSH\))g(that)h(the)479
1465 y(main)f(loop)f(collects)i(\(PULL\))e(and)h(prints)g(of)n(f.)f
(This)i(is)g(the)f(\002rst)h(case)f(we')l(v)o(e)g(seen)g(of)g(using)g
(\330MQ)g(sock)o(ets)g(for)479 1573 y(monitoring)e(and)i(logging;)e
(this)j(is)g(a)g(big)f(use)g(case)h(we')o(ll)f(come)g(back)f(to)i
(later)-5 b(.)-2 1591 y
SDict begin H.S end
 -2 1591 a -2 1591 a
SDict begin 13 H.A end
 -2 1591 a
-2 1591 a
SDict begin [/View [/XYZ H.V]/Dest (0:1967) cvn /DEST pdfmark end
 -2 1591 a Black 396 1722 a Fj(\225)p Black
479 1722 a
SDict begin H.S end
 479 1722 a 479 1722 a
SDict begin 13 H.A end
 479 1722 a 479 1722
a
SDict begin [/View [/XYZ H.V]/Dest (0:1968) cvn /DEST pdfmark end
 479 1722 a Fk(Clients)21 b(simulate)f(v)n(arying)f(loads)h(to)g(get)g
(the)h(cluster)f(100\045)f(at)i(random)d(moments,)h(so)i(that)f(tasks)h
(are)f(shifted)479 1830 y(o)o(v)o(er)f(to)h(the)h(cloud.)e(The)g
(number)g(of)h(clients)g(and)g(w)o(ork)o(ers,)f(and)h(delays)g(in)g
(the)g(client)g(and)g(w)o(ork)o(er)f(threads)479 1938
y(control)g(this.)i(Feel)f(free)g(to)h(play)e(with)i(them)e(to)i(see)g
(if)f(you)f(can)h(mak)o(e)g(a)h(more)e(realistic)i(simulation.)-2
1956 y
SDict begin H.S end
 -2 1956 a -2 1956 a
SDict begin 13 H.A end
 -2 1956 a -2 1956 a
SDict begin [/View [/XYZ H.V]/Dest (0:1969) cvn /DEST pdfmark end
 -2 1956
a Black 396 2087 a Fj(\225)p Black 479 2087 a
SDict begin H.S end
 479 2087
a 479 2087 a
SDict begin 13 H.A end
 479 2087 a 479 2087 a
SDict begin [/View [/XYZ H.V]/Dest (0:1970) cvn /DEST pdfmark end
 479 2087 a Fk(The)f(main)f(loop)g
(uses)h(tw)o(o)g(pollsets.)g(It)g(could)e(in)i(f)o(act)g(use)g(three:)f
(information,)e(back)o(ends,)h(and)i(frontends.)d(As)k(in)479
2195 y(the)f(earlier)g(prototype,)e(there)i(is)h(no)f(point)f(in)h
(taking)g(a)g(frontend)e(message)i(if)h(there)f(is)h(no)f(back)o(end)e
(capacity)-5 b(.)-2 2379 y
SDict begin H.S end
 -2 2379 a -2 2379 a
SDict begin 13 H.A end
 -2 2379
a -2 2379 a
SDict begin [/View [/XYZ H.V]/Dest (0:1971) cvn /DEST pdfmark end
 -2 2379 a 396 2469 a Fk(These)20 b(are)g(some)g(of)g(the)h
(problems)d(that)j(hit)f(during)f(de)n(v)o(elopment)e(of)j(this)g
(program:)-2 2487 y
SDict begin H.S end
 -2 2487 a -2 2487 a
SDict begin 13 H.A end
 -2 2487 a -2
2487 a
SDict begin [/View [/XYZ H.V]/Dest (0:1972) cvn /DEST pdfmark end
 -2 2487 a -2 2497 a
SDict begin H.S end
 -2 2497 a -2 2497 a
SDict begin 13 H.A end
 -2 2497
a -2 2497 a
SDict begin [/View [/XYZ H.V]/Dest (0:1973) cvn /DEST pdfmark end
 -2 2497 a Black 396 2640 a Fj(\225)p Black
479 2640 a
SDict begin H.S end
 479 2640 a 479 2640 a
SDict begin 13 H.A end
 479 2640 a 479 2640
a
SDict begin [/View [/XYZ H.V]/Dest (0:1974) cvn /DEST pdfmark end
 479 2640 a Fk(Clients)h(w)o(ould)f(freeze,)f(due)h(to)g(requests)g
(or)g(replies)g(getting)f(lost)i(some)n(where.)d(Recall)j(that)g(the)f
(\330MQ)479 2747 y(R)m(OUTER/R)m(OUTER)h(sock)o(et)f(drops)f(messages)h
(it)h(can')o(t)e(route.)h(The)f(\002rst)i(tactic)g(here)f(w)o(as)h(to)f
(modify)e(the)j(client)479 2855 y(thread)f(to)g(detect)g(and)g(report)f
(such)g(problems.)g(Secondly)-5 b(,)18 b(I)i(put)g(zmsg_dump\(\))d
(calls)k(after)f(e)n(v)o(ery)f(recv\(\))g(and)479 2963
y(before)g(e)n(v)o(ery)g(send\(\))g(in)h(the)h(main)e(loop,)h(until)g
(it)h(w)o(as)g(clear)f(what)g(the)g(problems)f(were.)-2
2981 y
SDict begin H.S end
 -2 2981 a -2 2981 a
SDict begin 13 H.A end
 -2 2981 a -2 2981 a
SDict begin [/View [/XYZ H.V]/Dest (0:1975) cvn /DEST pdfmark end
 -2 2981
a Black 396 3113 a Fj(\225)p Black 479 3113 a
SDict begin H.S end
 479 3113
a 479 3113 a
SDict begin 13 H.A end
 479 3113 a 479 3113 a
SDict begin [/View [/XYZ H.V]/Dest (0:1976) cvn /DEST pdfmark end
 479 3113 a Fk(The)h(main)f(loop)g(w)
o(as)h(mistak)o(enly)f(reading)f(from)h(more)g(than)g(one)g(ready)g
(sock)o(et.)g(This)h(caused)f(the)h(\002rst)g(message)479
3221 y(to)h(be)f(lost.)g(Fix)o(ed)g(that)g(by)g(reading)f(only)g(from)g
(the)h(\002rst)h(ready)e(sock)o(et.)-2 3239 y
SDict begin H.S end
 -2 3239
a -2 3239 a
SDict begin 13 H.A end
 -2 3239 a -2 3239 a
SDict begin [/View [/XYZ H.V]/Dest (0:1977) cvn /DEST pdfmark end
 -2 3239 a Black 396 3370
a Fj(\225)p Black 479 3370 a
SDict begin H.S end
 479 3370 a 479 3370 a
SDict begin 13 H.A end
 479
3370 a 479 3370 a
SDict begin [/View [/XYZ H.V]/Dest (0:1978) cvn /DEST pdfmark end
 479 3370 a Fk(The)h(zmsg)g(class)h(w)o(as)g(not)f
(properly)e(encoding)g(UUIDs)j(as)g(C)g(strings.)f(This)g(caused)g
(UUIDs)g(that)h(contain)e(0)479 3478 y(bytes)h(to)h(be)f(corrupted.)d
(Fix)o(ed)j(by)g(modifying)e(zmsg)i(to)g(encode)f(UUIDs)h(as)h
(printable)e(he)o(x)g(strings.)-2 3662 y
SDict begin H.S end
 -2 3662 a -2
3662 a
SDict begin 13 H.A end
 -2 3662 a -2 3662 a
SDict begin [/View [/XYZ H.V]/Dest (0:1979) cvn /DEST pdfmark end
 -2 3662 a 396 3752 a Fk(This)h(simulation)f
(does)g(not)h(detect)f(disappearance)f(of)h(a)h(cloud)f(peer)-5
b(.)19 b(If)g(you)g(start)h(se)n(v)o(eral)f(peers)h(and)f(stop)g(one,)g
(and)396 3860 y(it)i(w)o(as)f(broadcasting)d(capacity)i(to)h(the)g
(others,)e(the)o(y)h(will)i(continue)d(to)h(send)h(it)g(w)o(ork)f(e)n
(v)o(en)g(if)h(it')-5 b(s)20 b(gone.)f(Y)-9 b(ou)19 b(can)g(try)396
3968 y(this,)i(and)e(you)h(will)h(get)f(clients)g(that)h(complain)d(of)
i(lost)h(requests.)f(The)f(solution)h(is)h(tw)o(ofold:)e(\002rst,)i
(only)e(k)o(eep)h(the)396 4076 y(capacity)g(information)d(for)j(a)h
(short)e(time)i(so)f(that)h(if)f(a)h(peer)e(does)h(disappear)m(,)f(its)
i(capacity)e(is)i(quickly)e(set)i(to)f('zero'.)396 4184
y(Second,)f(add)h(reliability)f(to)i(the)f(request-reply)e(chain.)h(W)
-7 b(e')o(ll)21 b(look)f(at)g(reliability)g(in)g(the)h(ne)o(xt)e
(chapter)-5 b(.)p Black 3759 5569 a Ff(149)p Black eop
end
%%Page: 150 163
TeXDict begin 150 162 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.150) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:1980) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(4.)f(Reliab)n(le)h(Request-Repl)m(y)
2796 115 y
SDict begin H.S end
 2796 115 a 2796 115 a
SDict begin 26.957 H.A end
 2796 115 a 2796 115
a
SDict begin [/View [/XYZ H.V]/Dest (9.0) cvn /DEST pdfmark end
 2796 115 a -2 371 a
SDict begin H.S end
 -2 371 a -2 371 a
SDict begin 13 H.A end
 -2 371 a -2 371
a
SDict begin [/View [/XYZ H.V]/Dest (0:1982) cvn /DEST pdfmark end
 -2 371 a 396 443 a Fk(In)20 b(Chapter)g(Three)f(we)i(look)o(ed)e(at)h
(adv)n(anced)e(use)j(of)f(\330MQ')-5 b(s)21 b(request-reply)c(pattern)j
(with)g(w)o(ork)o(ed)f(e)o(xamples.)g(In)396 551 y(this)i(chapter)e
(we')o(ll)i(look)e(at)i(the)f(general)f(question)g(of)h(reliability)g
(and)f(b)n(uild)h(a)h(set)g(of)f(reliable)f(messaging)h(patterns)396
659 y(on)g(top)g(of)g(\330MQ')-5 b(s)21 b(core)e(request-reply)f
(pattern.)-2 843 y
SDict begin H.S end
 -2 843 a -2 843 a
SDict begin 13 H.A end
 -2 843 a -2 843
a
SDict begin [/View [/XYZ H.V]/Dest (0:1983) cvn /DEST pdfmark end
 -2 843 a 396 933 a Fk(In)i(this)h(chapter)e(we)i(focus)e(hea)n(vily)h
(on)f(user)n(-space)h(request-reply)e('patterns',)g(reusable)i(models)f
(that)i(help)e(you)396 1041 y(design)h(your)f(o)n(wn)g(\330MQ)i
(architectures:)-2 1059 y
SDict begin H.S end
 -2 1059 a -2 1059 a
SDict begin 13 H.A end
 -2 1059
a -2 1059 a
SDict begin [/View [/XYZ H.V]/Dest (0:1984) cvn /DEST pdfmark end
 -2 1059 a -2 1069 a
SDict begin H.S end
 -2 1069 a -2 1069 a
SDict begin 13 H.A end
 -2
1069 a -2 1069 a
SDict begin [/View [/XYZ H.V]/Dest (0:1985) cvn /DEST pdfmark end
 -2 1069 a Black 396 1211 a Fj(\225)p
Black 479 1211 a
SDict begin H.S end
 479 1211 a 479 1211 a
SDict begin 13 H.A end
 479 1211 a 479
1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:1986) cvn /DEST pdfmark end
 479 1211 a Fk(The)629 1211 y
SDict begin H.S end
 629 1211 a 629 1211
a
SDict begin 13 H.A end
 629 1211 a 629 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:1987) cvn /DEST pdfmark end
 629 1211 a Ff(Lazy)g(Pir)o(ate)f
Fk(pattern:)f(reliable)h(request)f(reply)h(from)f(the)h(client)g(side.)
-2 1229 y
SDict begin H.S end
 -2 1229 a -2 1229 a
SDict begin 13 H.A end
 -2 1229 a -2 1229 a
SDict begin [/View [/XYZ H.V]/Dest (0:1988) cvn /DEST pdfmark end
 -2
1229 a Black 396 1360 a Fj(\225)p Black 479 1360 a
SDict begin H.S end
 479
1360 a 479 1360 a
SDict begin 13 H.A end
 479 1360 a 479 1360 a
SDict begin [/View [/XYZ H.V]/Dest (0:1989) cvn /DEST pdfmark end
 479 1360 a Fk(The)629
1360 y
SDict begin H.S end
 629 1360 a 629 1360 a
SDict begin 13 H.A end
 629 1360 a 629 1360 a
SDict begin [/View [/XYZ H.V]/Dest (0:1990) cvn /DEST pdfmark end
 629
1360 a Ff(Simple)g(Pir)o(ate)g Fk(pattern:)f(reliable)h(request-reply)e
(using)h(a)i(LR)m(U)g(queue.)-2 1378 y
SDict begin H.S end
 -2 1378 a -2 1378
a
SDict begin 13 H.A end
 -2 1378 a -2 1378 a
SDict begin [/View [/XYZ H.V]/Dest (0:1991) cvn /DEST pdfmark end
 -2 1378 a Black 396 1510 a Fj(\225)p
Black 479 1510 a
SDict begin H.S end
 479 1510 a 479 1510 a
SDict begin 13 H.A end
 479 1510 a 479
1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:1992) cvn /DEST pdfmark end
 479 1510 a Fk(The)629 1510 y
SDict begin H.S end
 629 1510 a 629 1510
a
SDict begin 13 H.A end
 629 1510 a 629 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:1993) cvn /DEST pdfmark end
 629 1510 a Ff(P)-7 b(ar)o(anoid)19
b(Pir)o(ate)h Fk(pattern:)f(reliable)h(request-reply)e(with)i
(heartbeating.)-2 1528 y
SDict begin H.S end
 -2 1528 a -2 1528 a
SDict begin 13 H.A end
 -2 1528
a -2 1528 a
SDict begin [/View [/XYZ H.V]/Dest (0:1994) cvn /DEST pdfmark end
 -2 1528 a Black 396 1659 a Fj(\225)p Black
479 1659 a
SDict begin H.S end
 479 1659 a 479 1659 a
SDict begin 13 H.A end
 479 1659 a 479 1659
a
SDict begin [/View [/XYZ H.V]/Dest (0:1995) cvn /DEST pdfmark end
 479 1659 a Fk(The)629 1659 y
SDict begin H.S end
 629 1659 a 629 1659 a
SDict begin 13 H.A end

629 1659 a 629 1659 a
SDict begin [/View [/XYZ H.V]/Dest (0:1996) cvn /DEST pdfmark end
 629 1659 a Ff(Major)m(domo)f Fk(pattern:)g
(service-oriented)f(reliable)i(queuing.)-2 1677 y
SDict begin H.S end
 -2
1677 a -2 1677 a
SDict begin 13 H.A end
 -2 1677 a -2 1677 a
SDict begin [/View [/XYZ H.V]/Dest (0:1997) cvn /DEST pdfmark end
 -2 1677 a Black
396 1809 a Fj(\225)p Black 479 1809 a
SDict begin H.S end
 479 1809 a 479
1809 a
SDict begin 13 H.A end
 479 1809 a 479 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:1998) cvn /DEST pdfmark end
 479 1809 a Fk(The)629 1809
y
SDict begin H.S end
 629 1809 a 629 1809 a
SDict begin 13 H.A end
 629 1809 a 629 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:1999) cvn /DEST pdfmark end
 629 1809
a Ff(T)-5 b(itanic)21 b Fk(pattern:)e(disk-based)g(/)i(disconnected)d
(reliable)i(queuing.)-2 1826 y
SDict begin H.S end
 -2 1826 a -2 1826 a
SDict begin 13 H.A end
 -2
1826 a -2 1826 a
SDict begin [/View [/XYZ H.V]/Dest (0:2000) cvn /DEST pdfmark end
 -2 1826 a Black 396 1958 a Fj(\225)p
Black 479 1958 a
SDict begin H.S end
 479 1958 a 479 1958 a
SDict begin 13 H.A end
 479 1958 a 479
1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:2001) cvn /DEST pdfmark end
 479 1958 a Fk(The)629 1958 y
SDict begin H.S end
 629 1958 a 629 1958
a
SDict begin 13 H.A end
 629 1958 a 629 1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:2002) cvn /DEST pdfmark end
 629 1958 a Ff(Binary)g(Star)i
Fk(pattern:)d(primary-backup)d(serv)o(er)k(f)o(ail-o)o(v)o(er)-5
b(.)-2 1976 y
SDict begin H.S end
 -2 1976 a -2 1976 a
SDict begin 13 H.A end
 -2 1976 a -2 1976 a
SDict begin [/View [/XYZ H.V]/Dest (0:2003) cvn /DEST pdfmark end

-2 1976 a Black 396 2107 a Fj(\225)p Black 479 2107 a
SDict begin H.S end

479 2107 a 479 2107 a
SDict begin 13 H.A end
 479 2107 a 479 2107 a
SDict begin [/View [/XYZ H.V]/Dest (0:2004) cvn /DEST pdfmark end
 479 2107
a Fk(The)629 2107 y
SDict begin H.S end
 629 2107 a 629 2107 a
SDict begin 13 H.A end
 629 2107 a
629 2107 a
SDict begin [/View [/XYZ H.V]/Dest (0:2005) cvn /DEST pdfmark end
 629 2107 a Ff(F)g(r)m(eelance)20 b Fk(pattern:)f(brok)o
(erless)g(reliable)h(request-reply)-5 b(.)-2 2125 y
SDict begin H.S end
 -2
2125 a -2 2125 a
SDict begin 13 H.A end
 -2 2125 a -2 2125 a
SDict begin [/View [/XYZ H.V]/Dest (0:2006) cvn /DEST pdfmark end
 -2 2125 a 360 x
Fn(4.1.)39 b(What)g(is)h("Reliability"?)1731 2485 y
SDict begin H.S end
 1731
2485 a 1731 2485 a
SDict begin 22.464 H.A end
 1731 2485 a 1731 2485 a
SDict begin [/View [/XYZ H.V]/Dest (9.55.1) cvn /DEST pdfmark end
 1731 2485
a -2 2680 a
SDict begin H.S end
 -2 2680 a -2 2680 a
SDict begin 13 H.A end
 -2 2680 a -2 2680 a
SDict begin [/View [/XYZ H.V]/Dest (0:2008) cvn /DEST pdfmark end
 -2
2680 a 396 2758 a Fk(Most)21 b(people)e(who)h(speak)f(of)h(')l
(reliability')f(don')o(t)g(really)g(kno)n(w)g(what)i(the)o(y)e(mean.)g
(W)-7 b(e)22 b(can)e(only)f(de\002ne)h(reliability)396
2866 y(in)h(terms)f(of)g(f)o(ailure.)f(That)h(is,)h(if)f(we)h(can)f
(handle)f(a)i(certain)e(set)i(of)f(well-de\002ned)f(and)h(understood)d
(f)o(ailures,)j(we)h(are)396 2974 y(reliable)f(with)g(respect)g(to)h
(those)f(f)o(ailures.)f(No)h(more,)g(no)f(less.)i(So)g(let')-5
b(s)21 b(look)e(at)i(the)f(possible)g(causes)g(of)g(f)o(ailure)g(in)g
(a)396 3082 y(distrib)n(uted)g(\330MQ)g(application,)e(in)j(roughly)d
(descending)g(order)h(of)h(probability:)-2 3100 y
SDict begin H.S end
 -2
3100 a -2 3100 a
SDict begin 13 H.A end
 -2 3100 a -2 3100 a
SDict begin [/View [/XYZ H.V]/Dest (0:2009) cvn /DEST pdfmark end
 -2 3100 a -2 3110
a
SDict begin H.S end
 -2 3110 a -2 3110 a
SDict begin 13 H.A end
 -2 3110 a -2 3110 a
SDict begin [/View [/XYZ H.V]/Dest (0:2010) cvn /DEST pdfmark end
 -2 3110 a Black
396 3252 a Fj(\225)p Black 479 3252 a
SDict begin H.S end
 479 3252 a 479
3252 a
SDict begin 13 H.A end
 479 3252 a 479 3252 a
SDict begin [/View [/XYZ H.V]/Dest (0:2011) cvn /DEST pdfmark end
 479 3252 a Fk(Application)f(code)h(is)h
(the)f(w)o(orst)g(of)n(fender)-5 b(.)18 b(It)j(can)f(crash)g(and)f(e)o
(xit,)h(freeze)g(and)f(stop)h(responding)e(to)j(input,)e(run)479
3360 y(too)h(slo)n(wly)g(for)g(its)h(input,)e(e)o(xhaust)g(all)i
(memory)-5 b(,)18 b(etc.)-2 3378 y
SDict begin H.S end
 -2 3378 a -2 3378
a
SDict begin 13 H.A end
 -2 3378 a -2 3378 a
SDict begin [/View [/XYZ H.V]/Dest (0:2012) cvn /DEST pdfmark end
 -2 3378 a Black 396 3510 a Fj(\225)p
Black 479 3510 a
SDict begin H.S end
 479 3510 a 479 3510 a
SDict begin 13 H.A end
 479 3510 a 479
3510 a
SDict begin [/View [/XYZ H.V]/Dest (0:2013) cvn /DEST pdfmark end
 479 3510 a Fk(System)j(code)e(-)h(lik)o(e)h(brok)o(ers)e(we)h
(write)h(using)e(\330MQ)i(-)f(can)g(die)g(for)g(the)g(same)h(reasons)e
(as)i(application)e(code.)479 3618 y(System)i(code)922
3618 y
SDict begin H.S end
 922 3618 a 922 3618 a
SDict begin 13 H.A end
 922 3618 a 922 3618 a
SDict begin [/View [/XYZ H.V]/Dest (0:2014) cvn /DEST pdfmark end
 922
3618 a Ff(should)g Fk(be)g(more)e(reliable)h(than)f(application)g(code)
h(b)n(ut)g(it)h(can)f(still)h(crash)f(and)g(b)n(urn,)f(and)479
3726 y(especially)h(run)f(out)h(of)g(memory)f(if)h(it)h(tries)g(to)f
(queue)f(messages)h(for)g(slo)n(w)h(clients.)-2 3744
y
SDict begin H.S end
 -2 3744 a -2 3744 a
SDict begin 13 H.A end
 -2 3744 a -2 3744 a
SDict begin [/View [/XYZ H.V]/Dest (0:2015) cvn /DEST pdfmark end
 -2 3744 a Black
396 3875 a Fj(\225)p Black 479 3875 a
SDict begin H.S end
 479 3875 a 479
3875 a
SDict begin 13 H.A end
 479 3875 a 479 3875 a
SDict begin [/View [/XYZ H.V]/Dest (0:2016) cvn /DEST pdfmark end
 479 3875 a Fk(Message)g(queues)e(can)h(o)o
(v)o(er\003o)n(w)-5 b(,)18 b(typically)h(in)h(system)h(code)e(that)h
(has)h(learned)e(to)h(deal)g(brutally)f(with)i(slo)n(w)479
3983 y(clients.)g(When)f(a)g(queue)f(o)o(v)o(er\003o)n(ws,)g(it)h
(starts)i(to)e(discard)f(messages.)h(So)h(we)f(get)h("lost")f
(messages.)-2 4001 y
SDict begin H.S end
 -2 4001 a -2 4001 a
SDict begin 13 H.A end
 -2 4001 a -2
4001 a
SDict begin [/View [/XYZ H.V]/Dest (0:2017) cvn /DEST pdfmark end
 -2 4001 a Black 396 4133 a Fj(\225)p Black 479
4133 a
SDict begin H.S end
 479 4133 a 479 4133 a
SDict begin 13 H.A end
 479 4133 a 479 4133 a
SDict begin [/View [/XYZ H.V]/Dest (0:2018) cvn /DEST pdfmark end
 479
4133 a Fk(Netw)o(orks)g(can)g(f)o(ail)g(\(e.g.)f(wi\002)i(gets)f
(switched)g(of)n(f)f(or)h(goes)g(out)g(of)f(range\).)g(\330MQ)h(will)h
(automatically)d(reconnect)479 4240 y(in)j(such)f(cases)g(b)n(ut)h(in)f
(the)g(meantime,)f(messages)i(may)e(get)h(lost.)-2 4258
y
SDict begin H.S end
 -2 4258 a -2 4258 a
SDict begin 13 H.A end
 -2 4258 a -2 4258 a
SDict begin [/View [/XYZ H.V]/Dest (0:2019) cvn /DEST pdfmark end
 -2 4258 a Black
396 4390 a Fj(\225)p Black 479 4390 a
SDict begin H.S end
 479 4390 a 479
4390 a
SDict begin 13 H.A end
 479 4390 a 479 4390 a
SDict begin [/View [/XYZ H.V]/Dest (0:2020) cvn /DEST pdfmark end
 479 4390 a Fk(Hardw)o(are)f(can)h(f)o(ail)
h(and)f(tak)o(e)g(with)g(it)h(all)g(the)f(processes)g(running)e(on)i
(that)g(box.)-2 4408 y
SDict begin H.S end
 -2 4408 a -2 4408 a
SDict begin 13 H.A end
 -2 4408 a
-2 4408 a
SDict begin [/View [/XYZ H.V]/Dest (0:2021) cvn /DEST pdfmark end
 -2 4408 a Black 396 4539 a Fj(\225)p Black
479 4539 a
SDict begin H.S end
 479 4539 a 479 4539 a
SDict begin 13 H.A end
 479 4539 a 479 4539
a
SDict begin [/View [/XYZ H.V]/Dest (0:2022) cvn /DEST pdfmark end
 479 4539 a Fk(Netw)o(orks)g(can)g(f)o(ail)h(in)f(e)o(xotic)f(w)o
(ays,)i(e.g.)e(some)h(ports)g(on)g(a)g(switch)h(may)f(die)g(and)g
(those)g(parts)g(of)g(the)g(netw)o(ork)479 4647 y(become)f
(inaccessible.)-2 4648 y
SDict begin H.S end
 -2 4648 a -2 4648 a
SDict begin 13 H.A end
 -2 4648
a -2 4648 a
SDict begin [/View [/XYZ H.V]/Dest (0:2023) cvn /DEST pdfmark end
 -2 4648 a Black 396 4797 a Fj(\225)p Black
479 4797 a
SDict begin H.S end
 479 4797 a 479 4797 a
SDict begin 13 H.A end
 479 4797 a 479 4797
a
SDict begin [/View [/XYZ H.V]/Dest (0:2024) cvn /DEST pdfmark end
 479 4797 a Fk(Entire)h(data)g(centers)g(can)g(be)g(struck)g(by)f
(lightning,)g(earthquak)o(es,)f(\002re,)i(or)g(more)f(mundane)g(po)n
(wer)g(or)h(cooling)479 4905 y(f)o(ailures.)p Black 3759
5569 a Ff(150)p Black eop end
%%Page: 151 164
TeXDict begin 151 163 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.151) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2042) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2025) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(T)-7 b(o)21 b(mak)o(e)e(a)i(softw)o(are)f(system)g
(fully)g(reliable)f(against)2020 72 y
SDict begin H.S end
 2020 72 a 2020
72 a
SDict begin 13 H.A end
 2020 72 a 2020 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2026) cvn /DEST pdfmark end
 2020 72 a Ff(all)h Fk(of)g(these)h(possible)f
(f)o(ailures)g(is)h(an)f(enormously)e(dif)n(\002cult)396
180 y(and)i(e)o(xpensi)n(v)o(e)e(job)i(and)g(goes)g(be)o(yond)d(the)k
(scope)e(of)h(this)h(modest)f(guide.)-2 364 y
SDict begin H.S end
 -2 364
a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:2027) cvn /DEST pdfmark end
 -2 364 a 396 454 a Fk(Since)g(the)h
(\002rst)g(\002)n(v)o(e)f(cases)h(co)o(v)o(er)d(99.9\045)h(of)h(real)h
(w)o(orld)e(requirements)f(outside)i(lar)o(ge)f(companies)g
(\(according)f(to)i(a)396 562 y(highly)f(scienti\002c)h(study)f(I)h
(just)g(ran,)f(which)h(also)g(told)f(me)h(that)g(78\045)f(of)h
(statistics)h(are)f(made)f(up)g(on)g(the)h(spot\),)f(that')-5
b(s)396 670 y(what)20 b(we')o(ll)h(look)e(at.)i(If)f(you')l(re)e(a)j
(lar)o(ge)e(compan)o(y)f(with)i(mone)o(y)f(to)h(spend)f(on)h(the)g
(last)i(tw)o(o)e(cases,)h(contact)e(my)396 778 y(compan)o(y)f
(immediately!)h(There')-5 b(s)19 b(a)i(lar)o(ge)e(hole)h(behind)f(my)h
(beach)f(house)g(w)o(aiting)h(to)h(be)f(con)m(v)o(erted)d(into)j(an)396
886 y(e)o(x)o(ecuti)n(v)o(e)e(pool.)-2 914 y
SDict begin H.S end
 -2 914 a
-2 914 a
SDict begin 13 H.A end
 -2 914 a -2 914 a
SDict begin [/View [/XYZ H.V]/Dest (0:2028) cvn /DEST pdfmark end
 -2 914 a 360 x Fn(4.2.)39
b(Designing)e(Reliability)1690 1274 y
SDict begin H.S end
 1690 1274 a 1690
1274 a
SDict begin 22.464 H.A end
 1690 1274 a 1690 1274 a
SDict begin [/View [/XYZ H.V]/Dest (9.56.1) cvn /DEST pdfmark end
 1690 1274 a -2 1472 a
SDict begin H.S end

-2 1472 a -2 1472 a
SDict begin 13 H.A end
 -2 1472 a -2 1472 a
SDict begin [/View [/XYZ H.V]/Dest (0:2030) cvn /DEST pdfmark end
 -2 1472 a 396
1548 a Fk(So)21 b(to)f(mak)o(e)g(things)g(brutally)f(simple,)g
(reliability)h(is)h("k)o(eeping)e(things)h(w)o(orking)e(properly)g
(when)i(code)f(freezes)h(or)396 1655 y(crashes",)g(a)h(situation)e(we')
o(ll)i(shorten)e(to)h("dies".)g(Ho)n(we)n(v)o(er)f(the)h(things)g(we)h
(w)o(ant)f(to)g(k)o(eep)g(w)o(orking)f(properly)f(are)396
1763 y(more)i(comple)o(x)e(than)i(just)h(messages.)f(W)-7
b(e)21 b(need)e(to)i(tak)o(e)f(each)g(core)f(\330MQ)i(messaging)e
(pattern)h(and)f(see)i(ho)n(w)f(to)396 1871 y(mak)o(e)g(it)h(w)o(ork)e
(\(if)i(we)f(can\))g(e)n(v)o(en)f(when)h(code)f(dies.)-2
2052 y
SDict begin H.S end
 -2 2052 a -2 2052 a
SDict begin 13 H.A end
 -2 2052 a -2 2052 a
SDict begin [/View [/XYZ H.V]/Dest (0:2031) cvn /DEST pdfmark end
 -2 2052
a 396 2145 a Fk(Let')-5 b(s)21 b(tak)o(e)f(them)g(one)g(by)g(one:)-2
2163 y
SDict begin H.S end
 -2 2163 a -2 2163 a
SDict begin 13 H.A end
 -2 2163 a -2 2163 a
SDict begin [/View [/XYZ H.V]/Dest (0:2032) cvn /DEST pdfmark end
 -2 2163
a -2 2173 a
SDict begin H.S end
 -2 2173 a -2 2173 a
SDict begin 13 H.A end
 -2 2173 a -2 2173 a
SDict begin [/View [/XYZ H.V]/Dest (0:2033) cvn /DEST pdfmark end
 -2
2173 a Black 396 2316 a Fj(\225)p Black 479 2316 a
SDict begin H.S end
 479
2316 a 479 2316 a
SDict begin 13 H.A end
 479 2316 a 479 2316 a
SDict begin [/View [/XYZ H.V]/Dest (0:2034) cvn /DEST pdfmark end
 479 2316 a Fk(Request-reply:)f
(if)h(the)h(serv)o(er)e(dies)h(\(while)g(processing)f(a)i(request\),)e
(the)h(client)g(can)g(\002gure)g(that)g(out)g(since)g(it)479
2423 y(w)o(on')o(t)f(get)i(an)f(answer)g(back.)f(Then)g(it)i(can)f(gi)n
(v)o(e)g(up)f(in)i(a)f(huf)n(f,)f(w)o(ait)i(and)f(try)g(again)f(later)m
(,)g(\002nd)h(another)f(serv)o(er)m(,)479 2531 y(etc.)i(As)g(for)e(the)
h(client)h(dying,)d(we)j(can)f(brush)f(that)h(of)n(f)g(as)h("someone)d
(else')-5 b(s)22 b(problem")c(for)i(no)n(w)-5 b(.)-2
2549 y
SDict begin H.S end
 -2 2549 a -2 2549 a
SDict begin 13 H.A end
 -2 2549 a -2 2549 a
SDict begin [/View [/XYZ H.V]/Dest (0:2035) cvn /DEST pdfmark end
 -2 2549
a Black 396 2681 a Fj(\225)p Black 479 2681 a
SDict begin H.S end
 479 2681
a 479 2681 a
SDict begin 13 H.A end
 479 2681 a 479 2681 a
SDict begin [/View [/XYZ H.V]/Dest (0:2036) cvn /DEST pdfmark end
 479 2681 a Fk(Publish-subscribe:)18
b(if)j(the)f(client)g(dies)h(\(ha)n(ving)e(gotten)g(some)h(data\),)f
(the)i(serv)o(er)e(doesn')o(t)g(kno)n(w)g(about)g(it.)479
2789 y(Pubsub)h(doesn')o(t)e(send)i(an)o(y)g(information)d(back)j(from)
f(client)h(to)h(serv)o(er)-5 b(.)19 b(But)i(the)f(client)g(can)g
(contact)g(the)g(serv)o(er)479 2897 y(out-of-band,)d(e.g.)i(via)i
(request-reply)-5 b(,)17 b(and)i(ask,)i("please)f(resend)f(e)n(v)o
(erything)f(I)i(missed".)g(As)h(for)f(the)g(serv)o(er)479
3005 y(dying,)f(that')-5 b(s)21 b(out)e(of)h(scope)g(for)g(here.)f
(Subscribers)g(can)h(also)h(self-v)o(erify)d(that)i(the)o(y')l(re)f
(not)h(running)e(too)i(slo)n(wly)-5 b(,)479 3113 y(and)20
b(tak)o(e)g(action)g(\(e.g.)f(w)o(arn)h(the)g(operator)m(,)e(and)i
(die\))g(if)g(the)o(y)f(are.)-2 3131 y
SDict begin H.S end
 -2 3131 a -2 3131
a
SDict begin 13 H.A end
 -2 3131 a -2 3131 a
SDict begin [/View [/XYZ H.V]/Dest (0:2037) cvn /DEST pdfmark end
 -2 3131 a Black 396 3262 a Fj(\225)p
Black 479 3262 a
SDict begin H.S end
 479 3262 a 479 3262 a
SDict begin 13 H.A end
 479 3262 a 479
3262 a
SDict begin [/View [/XYZ H.V]/Dest (0:2038) cvn /DEST pdfmark end
 479 3262 a Fk(Pipeline:)h(if)h(a)f(w)o(ork)o(er)g(dies)g
(\(while)g(w)o(orking\),)e(the)i(v)o(entilator)f(doesn')o(t)g(kno)n(w)g
(about)g(it.)i(Pipelines,)f(lik)o(e)g(pubsub,)479 3370
y(and)g(the)g(grinding)e(gears)i(of)g(time,)g(only)g(w)o(ork)f(in)h
(one)g(direction.)f(But)h(the)h(do)n(wnstream)d(collector)h(can)h
(detect)479 3478 y(that)h(one)e(task)i(didn')o(t)d(get)i(done,)f(and)h
(send)g(a)h(message)f(back)f(to)h(the)h(v)o(entilator)d(saying,)i("he)o
(y)-5 b(,)18 b(resend)i(task)g(324!")479 3586 y(If)g(the)h(v)o
(entilator)d(or)i(collector)f(dies,)i(then)e(whate)n(v)o(er)g(upstream)
g(client)h(originally)f(sent)i(the)f(w)o(ork)f(batch)h(can)g(get)479
3694 y(tired)g(of)g(w)o(aiting)g(and)g(resend)f(the)h(whole)g(lot.)g
(It')-5 b(s)21 b(not)f(ele)o(gant)f(b)n(ut)h(system)g(code)g(should)f
(really)h(not)g(die)g(often)479 3802 y(enough)e(to)j(matter)-5
b(.)-2 3986 y
SDict begin H.S end
 -2 3986 a -2 3986 a
SDict begin 13 H.A end
 -2 3986 a -2 3986 a
SDict begin [/View [/XYZ H.V]/Dest (0:2039) cvn /DEST pdfmark end

-2 3986 a 396 4076 a Fk(In)20 b(this)h(chapter)e(we')o(ll)i(focus)e(on)
h(just)h(on)e(request-reply)-5 b(,)18 b(which)h(is)i(the)f(lo)n
(w-hanging)e(Durian)h(fruit)h(of)g(reliable)396 4184
y(messaging.)f(W)-7 b(e')o(ll)22 b(co)o(v)o(er)c(reliable)i(pub-sub)e
(and)i(pipeline)f(in)h(later)h(follo)n(wing)d(chapters.)-2
4368 y
SDict begin H.S end
 -2 4368 a -2 4368 a
SDict begin 13 H.A end
 -2 4368 a -2 4368 a
SDict begin [/View [/XYZ H.V]/Dest (0:2040) cvn /DEST pdfmark end
 -2 4368
a 396 4457 a Fk(The)i(basic)g(request-reply)e(pattern)i(\(a)g(REQ)h
(client)f(sock)o(et)g(doing)f(a)h(blocking)f(send/recv)g(to)h(a)h(REP)g
(serv)o(er)e(sock)o(et\))396 4565 y(scores)h(lo)n(w)h(on)e(handling)g
(the)h(most)g(common)f(types)h(of)g(f)o(ailure.)f(If)h(the)g(serv)o(er)
f(crashes)i(while)f(processing)f(the)396 4673 y(request,)f(the)h
(client)g(just)h(hangs)e(fore)n(v)o(er)-5 b(.)17 b(If)h(the)h(netw)o
(ork)f(loses)i(the)e(request)h(or)f(the)h(reply)-5 b(,)18
b(the)h(client)f(hangs)h(fore)n(v)o(er)-5 b(.)-2 4857
y
SDict begin H.S end
 -2 4857 a -2 4857 a
SDict begin 13 H.A end
 -2 4857 a -2 4857 a
SDict begin [/View [/XYZ H.V]/Dest (0:2041) cvn /DEST pdfmark end
 -2 4857 a 396
4947 a Fk(It)21 b(is)g(much)e(better)h(than)g(TCP)-9
b(,)20 b(thanks)g(to)g(\330MQ')-5 b(s)21 b(ability)f(to)g(reconnect)f
(peers)h(silently)-5 b(,)19 b(to)i(load-balance)396 5055
y(messages,)f(and)g(so)h(on.)e(But)i(it')-5 b(s)21 b(still)g(not)f
(good)f(enough)f(for)i(real)g(w)o(ork.)f(The)h(only)g(case)g(where)g
(you)f(can)h(really)p Black 3759 5569 a Ff(151)p Black
eop end
%%Page: 152 165
TeXDict begin 152 164 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.152) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2068) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fk(trust)h(the)f(basic)g(request-reply)e(pattern)h(is)i
(between)f(tw)o(o)g(threads)g(in)g(the)g(same)h(process)e(where)h
(there')-5 b(s)20 b(no)g(netw)o(ork)396 180 y(or)g(separate)g(serv)o
(er)f(process)h(to)g(die.)396 454 y(Ho)n(we)n(v)o(er)m(,)e(with)j(a)f
(little)h(e)o(xtra)f(w)o(ork)f(this)i(humble)e(pattern)g(becomes)g(a)i
(good)e(basis)i(for)e(real)h(w)o(ork)g(across)g(a)396
562 y(distrib)n(uted)g(netw)o(ork,)e(and)i(we)g(get)h(a)f(set)h(of)f
(reliable)g(request-reply)e(\(RRR\))j(patterns)e(I)i(lik)o(e)f(to)h
(call)f(the)h("Pirate")396 670 y(patterns)f(\(you')o(ll)f(get)h(the)g
(jok)o(e,)g(e)n(v)o(entually\).)-2 854 y
SDict begin H.S end
 -2 854 a -2
854 a
SDict begin 13 H.A end
 -2 854 a -2 854 a
SDict begin [/View [/XYZ H.V]/Dest (0:2043) cvn /DEST pdfmark end
 -2 854 a 396 944 a Fk(There)g(are)g(in)g(my)g
(e)o(xperience,)e(roughly)g(three)i(w)o(ays)g(to)g(connect)f(clients)i
(to)f(serv)o(ers.)g(Each)f(needs)h(a)h(speci\002c)396
1052 y(approach)d(to)j(reliability:)-2 1070 y
SDict begin H.S end
 -2 1070
a -2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:2044) cvn /DEST pdfmark end
 -2 1070 a -2 1080 a
SDict begin H.S end
 -2
1080 a -2 1080 a
SDict begin 13 H.A end
 -2 1080 a -2 1080 a
SDict begin [/View [/XYZ H.V]/Dest (0:2045) cvn /DEST pdfmark end
 -2 1080 a Black
396 1222 a Fj(\225)p Black 479 1222 a
SDict begin H.S end
 479 1222 a 479
1222 a
SDict begin 13 H.A end
 479 1222 a 479 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:2046) cvn /DEST pdfmark end
 479 1222 a Fk(Multiple)f(clients)h
(talking)e(directly)g(to)i(a)f(single)g(serv)o(er)-5
b(.)20 b(Use)h(case:)f(single)h(well-kno)n(wn)d(serv)o(er)h(that)h
(clients)h(need)479 1330 y(to)g(talk)f(to.)g(T)-7 b(ypes)20
b(of)g(f)o(ailure)g(we)g(aim)g(to)h(handle:)e(serv)o(er)g(crashes)h
(and)g(restarts,)g(netw)o(ork)f(disconnects.)-2 1348
y
SDict begin H.S end
 -2 1348 a -2 1348 a
SDict begin 13 H.A end
 -2 1348 a -2 1348 a
SDict begin [/View [/XYZ H.V]/Dest (0:2047) cvn /DEST pdfmark end
 -2 1348 a Black
396 1480 a Fj(\225)p Black 479 1480 a
SDict begin H.S end
 479 1480 a 479
1480 a
SDict begin 13 H.A end
 479 1480 a 479 1480 a
SDict begin [/View [/XYZ H.V]/Dest (0:2048) cvn /DEST pdfmark end
 479 1480 a Fk(Multiple)h(clients)h
(talking)e(to)h(a)h(single)f(queue)f(de)n(vice)g(that)i(distrib)n(utes)
f(w)o(ork)f(to)i(multiple)e(serv)o(ers.)h(Use)g(case:)479
1588 y(w)o(orkload)f(distrib)n(ution)g(to)h(w)o(ork)o(ers.)f(T)-7
b(ypes)20 b(of)g(f)o(ailure)g(we)g(aim)h(to)f(handle:)f(w)o(ork)o(er)g
(crashes)i(and)e(restarts,)479 1696 y(w)o(ork)o(er)g(b)n(usy)h
(looping,)f(w)o(ork)o(er)g(o)o(v)o(erload,)e(queue)i(crashes)h(and)g
(restarts,)g(netw)o(ork)f(disconnects.)-2 1714 y
SDict begin H.S end
 -2 1714
a -2 1714 a
SDict begin 13 H.A end
 -2 1714 a -2 1714 a
SDict begin [/View [/XYZ H.V]/Dest (0:2049) cvn /DEST pdfmark end
 -2 1714 a Black 396 1845
a Fj(\225)p Black 479 1845 a
SDict begin H.S end
 479 1845 a 479 1845 a
SDict begin 13 H.A end
 479
1845 a 479 1845 a
SDict begin [/View [/XYZ H.V]/Dest (0:2050) cvn /DEST pdfmark end
 479 1845 a Fk(Multiple)h(clients)h(talking)e(to)h
(multiple)g(serv)o(ers)f(with)i(no)f(intermediary)e(de)n(vices.)h(Use)i
(case:)g(distrib)n(uted)479 1953 y(services)f(such)g(as)h(name)f
(resolution.)e(T)-7 b(ypes)20 b(of)g(f)o(ailure)g(we)h(aim)f(to)g
(handle:)f(service)h(crashes)g(and)g(restarts,)479 2061
y(service)g(b)n(usy)g(looping,)e(service)i(o)o(v)o(erload,)e(netw)o
(ork)h(disconnects.)-2 2245 y
SDict begin H.S end
 -2 2245 a -2 2245 a
SDict begin 13 H.A end
 -2
2245 a -2 2245 a
SDict begin [/View [/XYZ H.V]/Dest (0:2051) cvn /DEST pdfmark end
 -2 2245 a 396 2335 a Fk(Each)h(of)g(these)g(has)h
(their)f(trade-of)n(fs)e(and)i(often)f(you')o(ll)g(mix)h(them.)g(W)-7
b(e')o(ll)21 b(look)e(at)i(all)g(three)f(of)g(these)g(in)g(detail.)-2
2363 y
SDict begin H.S end
 -2 2363 a -2 2363 a
SDict begin 13 H.A end
 -2 2363 a -2 2363 a
SDict begin [/View [/XYZ H.V]/Dest (0:2052) cvn /DEST pdfmark end
 -2 2363
a 359 x Fn(4.3.)39 b(Client-side)e(Reliability)h(\(Lazy)g(Pirate)h(P)l
(attern\))3153 2722 y
SDict begin H.S end
 3153 2722 a 3153 2722 a
SDict begin 22.464 H.A end
 3153 2722
a 3153 2722 a
SDict begin [/View [/XYZ H.V]/Dest (9.57.1) cvn /DEST pdfmark end
 3153 2722 a -2 2918 a
SDict begin H.S end
 -2 2918 a -2 2918
a
SDict begin 13 H.A end
 -2 2918 a -2 2918 a
SDict begin [/View [/XYZ H.V]/Dest (0:2054) cvn /DEST pdfmark end
 -2 2918 a 396 2996 a Fk(W)-7 b(e)22
b(can)e(get)g(v)o(ery)f(simple)h(reliable)g(request-reply)e(with)i
(only)f(some)h(changes)f(in)i(the)f(client.)g(W)-7 b(e)21
b(call)g(this)g(the)f(Lazy)396 3104 y(Pirate)h(pattern\()p
0 TeXcolorgray 871 3104 a
SDict begin H.S end
 871 3104 a Fk(Figure)c(4-1)1218
3104 y
SDict begin 13 H.L end
 1218 3104 a 1218 3104 a
SDict begin [/Subtype /Link/Dest (0:figure-54) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1218 3104 a Black -1 w
Fk(\).)j(Rather)g(than)g(doing)f(a)i(blocking)d(recei)n(v)o(e,)h(we:)-2
3122 y
SDict begin H.S end
 -2 3122 a -2 3122 a
SDict begin 13 H.A end
 -2 3122 a -2 3122 a
SDict begin [/View [/XYZ H.V]/Dest (0:2056) cvn /DEST pdfmark end
 -2 3122
a -2 3132 a
SDict begin H.S end
 -2 3132 a -2 3132 a
SDict begin 13 H.A end
 -2 3132 a -2 3132 a
SDict begin [/View [/XYZ H.V]/Dest (0:2057) cvn /DEST pdfmark end
 -2
3132 a Black 396 3274 a Fj(\225)p Black 479 3274 a
SDict begin H.S end
 479
3274 a 479 3274 a
SDict begin 13 H.A end
 479 3274 a 479 3274 a
SDict begin [/View [/XYZ H.V]/Dest (0:2058) cvn /DEST pdfmark end
 479 3274 a Fk(Poll)i(the)f(REQ)
h(sock)o(et)f(and)g(only)f(recei)n(v)o(e)g(from)g(it)i(when)f(it')-5
b(s)21 b(sure)f(a)h(reply)e(has)h(arri)n(v)o(ed.)-2 3292
y
SDict begin H.S end
 -2 3292 a -2 3292 a
SDict begin 13 H.A end
 -2 3292 a -2 3292 a
SDict begin [/View [/XYZ H.V]/Dest (0:2059) cvn /DEST pdfmark end
 -2 3292 a Black
396 3424 a Fj(\225)p Black 479 3424 a
SDict begin H.S end
 479 3424 a 479
3424 a
SDict begin 13 H.A end
 479 3424 a 479 3424 a
SDict begin [/View [/XYZ H.V]/Dest (0:2060) cvn /DEST pdfmark end
 479 3424 a Fk(Resend)g(a)h(request)f(se)n
(v)o(eral)f(times,)i(if)f(no)g(reply)f(arri)n(v)o(ed)g(within)h(a)g
(timeout)g(period.)-2 3442 y
SDict begin H.S end
 -2 3442 a -2 3442 a
SDict begin 13 H.A end
 -2 3442
a -2 3442 a
SDict begin [/View [/XYZ H.V]/Dest (0:2061) cvn /DEST pdfmark end
 -2 3442 a Black 396 3573 a Fj(\225)p Black
479 3573 a
SDict begin H.S end
 479 3573 a 479 3573 a
SDict begin 13 H.A end
 479 3573 a 479 3573
a
SDict begin [/View [/XYZ H.V]/Dest (0:2062) cvn /DEST pdfmark end
 479 3573 a Fk(Abandon)e(the)j(transaction)e(if)h(after)g(se)n(v)o
(eral)g(requests,)f(there)h(is)h(still)g(no)f(reply)-5
b(.)-2 3591 y
SDict begin H.S end
 -2 3591 a -2 3591 a
SDict begin 13 H.A end
 -2 3591 a -2 3591 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-54) cvn /DEST pdfmark
end

-2 3591 a Black 3759 5569 a Ff(152)p Black eop end
%%Page: 153 166
TeXDict begin 153 165 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.153) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-1.)f(The)i(Lazy)f(Pirate)g(P)o(atter)o
(n)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2065) cvn /DEST pdfmark end
 -2 172
a 396 1939 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1939 a @beginspecial 0 @llx -207 @lly
294 @urx 0 @ury 2940 @rwi @setspecial
%%BeginDocument: images/fig54.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -207 294 0
%%HiResBoundingBox: 0.0 -207.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -39.80017852783203 lineto
88.80017852783203 -39.80017852783203 lineto
88.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -42.80017852783203 moveto
16.800180435180664 -57.80017852783203 lineto
88.80017852783203 -57.80017852783203 lineto
88.80017852783203 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -60.80017852783203 moveto
16.800180435180664 -73.80017852783203 lineto
16.800180435180664 -76.4668451944987 17.800180435180664 -77.80017852783203 19.800180435180664 -77.80017852783203 curveto
85.80017852783203 -77.80017852783203 lineto
85.80017852783203 -77.80017852783203 lineto
87.80017852783203 -77.80017852783203 88.80017852783203 -76.4668451944987 88.80017852783203 -73.80017852783203 curveto
88.80017852783203 -61.000179290771484 lineto
88.80017852783203 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -23.800180435180664 moveto
112.80017852783203 -39.80017852783203 lineto
184.80018615722656 -39.80017852783203 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -42.80017852783203 moveto
112.80017852783203 -57.80017852783203 lineto
184.80018615722656 -57.80017852783203 lineto
184.80018615722656 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -60.80017852783203 moveto
112.80017852783203 -73.80017852783203 lineto
112.80017852783203 -76.4668451944987 113.80017852783203 -77.80017852783203 115.80017852783203 -77.80017852783203 curveto
181.80018615722656 -77.80017852783203 lineto
181.80018615722656 -77.80017852783203 lineto
183.80018615722656 -77.80017852783203 184.80018615722656 -76.4668451944987 184.80018615722656 -73.80017852783203 curveto
184.80018615722656 -61.000179290771484 lineto
184.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -23.800180435180664 moveto
208.80018615722656 -39.80017852783203 lineto
280.8001708984375 -39.80017852783203 lineto
280.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -42.80017852783203 moveto
208.80018615722656 -57.80017852783203 lineto
280.8001708984375 -57.80017852783203 lineto
280.8001708984375 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -60.80017852783203 moveto
208.80018615722656 -73.80017852783203 lineto
208.80018615722656 -76.4668451944987 209.80018615722656 -77.80017852783203 211.80018615722656 -77.80017852783203 curveto
277.8001708984375 -77.80017852783203 lineto
277.8001708984375 -77.80017852783203 lineto
279.8001708984375 -77.80017852783203 280.8001708984375 -76.4668451944987 280.8001708984375 -73.80017852783203 curveto
280.8001708984375 -61.000179290771484 lineto
280.8001708984375 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
109.80017852783203 -131.80018615722656 moveto
107.80017852783203 -131.80018615722656 106.80017852783203 -133.46685282389322 106.80017852783203 -136.80018615722656 curveto
106.80017852783203 -147.80018615722656 lineto
190.80018615722656 -147.80018615722656 lineto
190.80018615722656 -136.80018615722656 lineto
190.80018615722656 -133.46685282389322 189.80018615722656 -131.80018615722656 187.80018615722656 -131.80018615722656 curveto
109.80017852783203 -131.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -150.80018615722656 moveto
106.80017852783203 -185.80018615722656 lineto
190.80018615722656 -185.80018615722656 lineto
190.80018615722656 -150.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
108.0 -130.0 moveto
106.0 -130.0 105.0 -131.66666666666666 105.0 -135.0 curveto
105.0 -146.0 lineto
189.0 -146.0 lineto
189.0 -135.0 lineto
189.0 -131.66666666666666 188.0 -130.0 186.0 -130.0 curveto
108.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
108.0 -130.0 moveto
106.0 -130.0 105.0 -131.66666666666666 105.0 -135.0 curveto
105.0 -146.0 lineto
189.0 -146.0 lineto
189.0 -135.0 lineto
189.0 -131.66666666666666 188.0 -130.0 186.0 -130.0 curveto
108.0 -130.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -149.0 moveto
105.0 -184.0 lineto
189.0 -184.0 lineto
189.0 -149.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -149.0 moveto
105.0 -184.0 lineto
189.0 -184.0 lineto
189.0 -149.0 lineto
closepath
stroke
newpath
51.0 -81.0 moveto
48.0 -90.0 lineto
54.0 -90.0 lineto
closepath
fill
newpath
147.0 -81.0 moveto
144.0 -90.0 lineto
150.0 -90.0 lineto
closepath
fill
newpath
243.0 -81.0 moveto
240.0 -90.0 lineto
246.0 -90.0 lineto
closepath
fill
newpath
144.0 -117.0 moveto
147.0 -126.0 lineto
150.0 -117.0 lineto
closepath
fill
newpath
51.0 -85.0 moveto
51.0 -99.0 lineto
51.0 -101.66666666666667 52.0 -103.0 54.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -85.0 moveto
147.0 -103.0 lineto
stroke
newpath
243.0 -85.0 moveto
243.0 -99.0 lineto
243.0 -101.66666666666667 242.0 -103.0 240.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -121.0 moveto
147.0 -103.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
34.0 -35.0 moveto
(Client) show
130.0 -35.0 moveto
(Client) show
226.0 -35.0 moveto
(Client) show
38.0 -53.0 moveto
(Retry) show
134.0 -53.0 moveto
(Retry) show
230.0 -53.0 moveto
(Retry) show
43.0 -71.0 moveto
(REQ) show
139.0 -71.0 moveto
(REQ) show
235.0 -71.0 moveto
(REQ) show
139.0 -143.0 moveto
(REP) show
134.0 -170.0 moveto
(Server) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1939 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1939 a 274 x Fk(If)g(you)f(try)h(to)h(use)f
(a)g(REQ)h(sock)o(et)f(in)g(an)o(ything)e(than)i(a)h(strict)f
(send-recv)f(f)o(ashion,)g(you')o(ll)g(get)h(an)g(error)f
(\(technically)-5 b(,)396 2321 y(the)20 b(REQ)h(sock)o(et)f(implements)
g(a)g(small)h(\002nite-state)f(machine)f(to)h(enforce)f(the)h
(send-recv)f(ping-pong,)e(and)i(so)i(the)396 2429 y(error)e(code)h(is)h
(called)f("EFSM"\).)g(This)g(is)h(slightly)f(anno)o(ying)e(when)i(we)g
(w)o(ant)h(to)f(use)g(REQ)h(in)f(a)h(pirate)f(pattern,)396
2537 y(because)g(we)g(may)g(send)g(se)n(v)o(eral)g(requests)f(before)g
(getting)h(a)g(reply)-5 b(.)19 b(The)h(pretty)f(good)g(brute-force)f
(solution)h(is)i(to)396 2645 y(close)g(and)e(reopen)g(the)h(REQ)h(sock)
o(et)f(after)g(an)g(error:)-2 2663 y
SDict begin H.S end
 -2 2663 a -2 2663
a
SDict begin 13 H.A end
 -2 2663 a -2 2663 a
SDict begin [/View [/XYZ H.V]/Dest (0:lpclient-c) cvn /DEST pdfmark
end
 -2 2663 a 396 2846 a Fg(Example)h(4-1.)e(Lazy)h
(Pirate)f(client)i(\(lpclient.c\))-2 2946 y
SDict begin H.S end
 -2 2946 a
-2 2946 a
SDict begin 11.7 H.A end
 -2 2946 a -2 2946 a
SDict begin [/View [/XYZ H.V]/Dest (0:2071) cvn /DEST pdfmark end
 -2 2946 a 396 3026 a Fe(//)396
3123 y(//)90 b(Lazy)44 b(Pirate)g(client)396 3220 y(//)90
b(Use)44 b(zmq_poll)f(to)i(do)f(a)h(safe)f(request-reply)396
3317 y(//)90 b(To)44 b(run,)g(start)g(lpserver)g(and)g(then)g(randomly)
g(kill/restart)f(it)396 3415 y(//)396 3512 y(#include)h("czmq.h")396
3706 y(#define)g(REQUEST_TIMEOUT)222 b(2500)178 b(//)90
b(msecs,)43 b(\(>)i(1000!\))396 3803 y(#define)f(REQUEST_RETRIES)222
b(3)313 b(//)90 b(Before)43 b(we)i(abandon)396 3900 y(#define)f
(SERVER_ENDPOINT)222 b("tcp://localhost:5555")396 4095
y(int)45 b(main)f(\(void\))396 4192 y({)576 4289 y(zctx_t)889
4302 y(*)934 4289 y(ctx)h(=)f(zctx_new)g(\(\);)576 4386
y(printf)f(\("I:)i(connecting)e(to)h(server...\\n"\);)576
4483 y(void)800 4496 y(*)845 4483 y(client)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 4580 y(assert)f(\(client\);)576 4677
y(zsocket_connect)f(\(client,)h(SERVER_ENDPOINT\);)576
4872 y(int)h(sequence)f(=)i(0;)576 4969 y(int)f(retries_left)f(=)h
(REQUEST_RETRIES;)576 5066 y(while)g(\(retries_left)e(&&)j
(!zctx_interrupted\))d({)755 5163 y(//)89 b(We)45 b(send)f(a)h
(request,)e(then)h(we)h(work)f(to)g(get)h(a)f(reply)p
Black 3759 5569 a Ff(153)p Black eop end
%%Page: 154 167
TeXDict begin 154 166 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.154) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(char)44 b(request)g([10];)755 170 y(sprintf)g
(\(request,)f("\045d",)h(++sequence\);)755 267 y(zstr_send)f(\(client,)
h(request\);)755 461 y(int)g(expect_reply)f(=)i(1;)755
558 y(while)f(\(expect_reply\))e({)934 655 y(//)90 b(Poll)44
b(socket)g(for)g(a)h(reply,)e(with)i(timeout)934 752
y(zmq_pollitem_t)e(items)h([])g(=)h({)g({)f(client,)g(0,)g(ZMQ_POLLIN,)
f(0)i(})g(};)934 850 y(int)g(rc)f(=)h(zmq_poll)e(\(items,)h(1,)g
(REQUEST_TIMEOUT)2952 863 y(*)3041 850 y(ZMQ_POLL_MSEC\);)934
947 y(if)h(\(rc)f(==)h(-1\))1114 1044 y(break;)447 b(//)89
b(Interrupted)-2 1221 y
SDict begin H.S end
 -2 1221 a -2 1221 a
SDict begin 13 H.A end
 -2 1221 a
-2 1221 a
SDict begin [/View [/XYZ H.V]/Dest (0:2072) cvn /DEST pdfmark end
 -2 1221 a 396 1318 a Fk(Here)20 b(we)h(process)f(a)g(serv)o
(er)g(reply)f(and)h(e)o(xit)g(our)f(loop)g(if)i(the)f(reply)f(is)j(v)n
(alid.)d(If)h(we)h(didn')o(t)d(a)j(reply)e(we)i(close)f(the)396
1426 y(client)g(sock)o(et)h(and)e(resend)h(the)g(request.)f(W)-7
b(e)21 b(try)f(a)h(number)d(of)i(times)h(before)e(\002nally)h
(abandoning:)-2 1444 y
SDict begin H.S end
 -2 1444 a -2 1444 a
SDict begin 13 H.A end
 -2 1444 a
-2 1444 a
SDict begin [/View [/XYZ H.V]/Dest (0:lpclient-c-1) cvn /DEST pdfmark
end
 -2 1444 a 396 1627 a Fg(Example)h(4-2.)e(Lazy)h(Pirate)f
(client)i(\(lpclient.c\))e(-)i(pr)o(ocess)f(ser)o(v)o(er)g(r)o(eply)-2
1727 y
SDict begin H.S end
 -2 1727 a -2 1727 a
SDict begin 11.7 H.A end
 -2 1727 a -2 1727 a
SDict begin [/View [/XYZ H.V]/Dest (0:2075) cvn /DEST pdfmark end
 -2 1727
a 934 1904 a Fe(if)45 b(\(items)f([0].revents)f(&)h(ZMQ_POLLIN\))f({)
1114 2001 y(//)89 b(We)44 b(got)h(a)f(reply)g(from)h(the)f(server,)g
(must)g(match)g(sequence)1114 2099 y(char)1338 2112 y(*)1383
2099 y(reply)g(=)g(zstr_recv)g(\(client\);)1114 2196
y(if)g(\(!reply\))1293 2293 y(break;)268 b(//)89 b(Interrupted)1114
2390 y(if)44 b(\(atoi)g(\(reply\))g(==)g(sequence\))g({)1293
2487 y(printf)g(\("I:)g(server)g(replied)f(OK)i(\(\045s\)\\n",)e
(reply\);)1293 2584 y(retries_left)g(=)h(REQUEST_RETRIES;)1293
2681 y(expect_reply)f(=)h(0;)1114 2779 y(})1114 2876
y(else)1293 2973 y(printf)g(\("E:)g(malformed)f(reply)h(from)g(server:)
g(\045s\\n",)1472 3070 y(reply\);)1114 3264 y(free)g(\(reply\);)934
3361 y(})934 3459 y(else)934 3556 y(if)h(\(--retries_left)d(==)j(0\))f
({)1114 3653 y(printf)f(\("E:)i(server)e(seems)h(to)h(be)f(offline,)g
(abandoning\\n"\);)1114 3750 y(break;)934 3847 y(})934
3944 y(else)g({)1114 4041 y(printf)f(\("W:)i(no)f(response)g(from)g
(server,)f(retrying...\\n"\);)1114 4138 y(//)89 b(Old)44
b(socket)g(is)h(confused;)e(close)h(it)g(and)h(open)f(a)h(new)f(one)
1114 4236 y(zsocket_destroy)e(\(ctx,)i(client\);)1114
4333 y(printf)f(\("I:)i(reconnecting)d(to)j(server...\\n"\);)1114
4430 y(client)e(=)i(zsocket_new)e(\(ctx,)h(ZMQ_REQ\);)1114
4527 y(zsocket_connect)e(\(client,)h(SERVER_ENDPOINT\);)1114
4624 y(//)89 b(Send)44 b(request)g(again,)g(on)g(new)g(socket)1114
4721 y(zstr_send)f(\(client,)g(request\);)934 4818 y(})755
4916 y(})576 5013 y(})576 5110 y(zctx_destroy)f(\(&ctx\);)p
Black 3759 5569 a Ff(154)p Black eop end
%%Page: 155 168
TeXDict begin 155 167 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.155) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2081) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(return)43 b(0;)396 170 y(})-2 344 y
SDict begin H.S end

-2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:2076) cvn /DEST pdfmark end
 -2 344 a 396 444
a Fk(Run)20 b(this)h(together)e(with)h(the)h(matching)d(serv)o(er:)-2
462 y
SDict begin H.S end
 -2 462 a -2 462 a
SDict begin 13 H.A end
 -2 462 a -2 462 a
SDict begin [/View [/XYZ H.V]/Dest (0:lpserver-c) cvn /DEST pdfmark
end
 -2 462 a 396
645 a Fg(Example)j(4-3.)e(Lazy)h(Pirate)f(ser)o(v)o(er)i(\(lpser)o(v)o
(er)-8 b(.c\))-2 745 y
SDict begin H.S end
 -2 745 a -2 745 a
SDict begin 11.7 H.A end
 -2 745 a -2
745 a
SDict begin [/View [/XYZ H.V]/Dest (0:2079) cvn /DEST pdfmark end
 -2 745 a 396 825 a Fe(//)396 922 y(//)90 b(Lazy)44
b(Pirate)g(server)396 1019 y(//)90 b(Binds)44 b(REQ)g(socket)g(to)g
(tcp://)1742 1032 y(*)1787 1019 y(:5555)396 1116 y(//)90
b(Like)44 b(hwserver)f(except:)396 1214 y(//)134 b(-)45
b(echoes)f(request)g(as-is)396 1311 y(//)134 b(-)45 b(randomly)f(runs)g
(slowly,)f(or)i(exits)f(to)g(simulate)g(a)h(crash.)396
1408 y(//)396 1505 y(#include)f("zhelpers.h")396 1699
y(int)h(main)f(\(void\))396 1796 y({)576 1894 y(srandom)f
(\(\(unsigned\))g(time)h(\(NULL\)\);)576 2088 y(void)800
2101 y(*)845 2088 y(context)f(=)i(zmq_ctx_new)e(\(\);)576
2185 y(void)800 2198 y(*)845 2185 y(server)g(=)i(zmq_socket)e
(\(context,)h(ZMQ_REP\);)576 2282 y(zmq_bind)f(\(server,)h("tcp://)1698
2295 y(*)1743 2282 y(:5555"\);)576 2476 y(int)g(cycles)g(=)g(0;)576
2574 y(while)g(\(true\))f({)755 2671 y(char)979 2684
y(*)1024 2671 y(request)h(=)g(s_recv)g(\(server\);)755
2768 y(cycles++;)755 2962 y(//)89 b(Simulate)44 b(various)f(problems,)h
(after)g(a)g(few)h(cycles)755 3059 y(if)f(\(cycles)g(>)h(3)f(&&)h
(randof)f(\(3\))g(==)h(0\))f({)934 3156 y(printf)g(\("I:)g(simulating)f
(a)i(crash\\n"\);)934 3253 y(break;)755 3351 y(})755
3448 y(else)755 3545 y(if)f(\(cycles)g(>)h(3)f(&&)h(randof)f(\(3\))g
(==)h(0\))f({)934 3642 y(printf)g(\("I:)g(simulating)f(CPU)i
(overload\\n"\);)934 3739 y(sleep)f(\(2\);)755 3836 y(})755
3933 y(printf)g(\("I:)g(normal)g(request)f(\(\045s\)\\n",)h(request\);)
755 4031 y(sleep)g(\(1\);)627 b(//)89 b(Do)45 b(some)f(heavy)g(work)755
4128 y(s_send)g(\(server,)f(request\);)755 4225 y(free)h(\(request\);)
576 4322 y(})576 4419 y(zmq_close)f(\(server\);)576 4516
y(zmq_ctx_destroy)f(\(context\);)576 4613 y(return)h(0;)396
4711 y(})p Black 3759 5569 a Ff(155)p Black eop end
%%Page: 156 169
TeXDict begin 156 168 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.156) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2080) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(T)-7 b(o)21 b(run)e(this)i(testcase,)f(start)h(the)f
(client)h(and)e(the)h(serv)o(er)g(in)g(tw)o(o)h(console)e(windo)n(ws.)g
(The)h(serv)o(er)f(will)i(randomly)396 180 y(misbeha)n(v)o(e)e(after)h
(a)h(fe)n(w)f(messages.)g(Y)-9 b(ou)19 b(can)h(check)g(the)g(client')-5
b(s)21 b(response.)e(Here)h(is)h(a)f(typical)g(output)f(from)g(the)396
288 y(serv)o(er:)396 468 y Fe(I:)45 b(normal)f(request)f(\(1\))396
566 y(I:)i(normal)f(request)f(\(2\))396 663 y(I:)i(normal)f(request)f
(\(3\))396 760 y(I:)i(simulating)e(CPU)h(overload)396
857 y(I:)h(normal)f(request)f(\(4\))396 954 y(I:)i(simulating)e(a)i
(crash)-2 1132 y
SDict begin H.S end
 -2 1132 a -2 1132 a
SDict begin 13 H.A end
 -2 1132 a -2 1132
a
SDict begin [/View [/XYZ H.V]/Dest (0:2082) cvn /DEST pdfmark end
 -2 1132 a 396 1228 a Fk(And)20 b(here)g(is)h(the)f(client')-5
b(s)21 b(response:)-2 1329 y
SDict begin H.S end
 -2 1329 a -2 1329 a
SDict begin 11.7 H.A end
 -2 1329
a -2 1329 a
SDict begin [/View [/XYZ H.V]/Dest (0:2083) cvn /DEST pdfmark end
 -2 1329 a 396 1408 a Fe(I:)45 b(connecting)e(to)h
(server...)396 1505 y(I:)h(server)f(replied)f(OK)i(\(1\))396
1603 y(I:)g(server)f(replied)f(OK)i(\(2\))396 1700 y(I:)g(server)f
(replied)f(OK)i(\(3\))396 1797 y(W:)g(no)f(response)g(from)g(server,)g
(retrying...)396 1894 y(I:)h(connecting)e(to)h(server...)396
1991 y(W:)h(no)f(response)g(from)g(server,)g(retrying...)396
2088 y(I:)h(connecting)e(to)h(server...)396 2185 y(E:)h(server)f(seems)
g(to)g(be)h(offline,)e(abandoning)-2 2363 y
SDict begin H.S end
 -2 2363 a
-2 2363 a
SDict begin 13 H.A end
 -2 2363 a -2 2363 a
SDict begin [/View [/XYZ H.V]/Dest (0:2084) cvn /DEST pdfmark end
 -2 2363 a 396 2459 a Fk(The)20
b(client)g(sequences)g(each)g(message,)f(and)h(checks)g(that)g(replies)
g(come)g(back)f(e)o(xactly)g(in)i(order:)e(that)h(no)g(requests)396
2567 y(or)g(replies)g(are)g(lost,)h(and)f(no)f(replies)h(come)g(back)f
(more)h(than)g(once,)f(or)h(out)g(of)f(order)-5 b(.)20
b(Run)g(the)g(test)h(a)g(fe)n(w)f(times)396 2675 y(until)g(you')l(re)f
(con)m(vinced)e(this)k(mechanism)e(actually)g(w)o(orks.)h(Y)-9
b(ou)20 b(don')o(t)e(need)i(sequence)f(numbers)f(in)j(reality)-5
b(,)19 b(the)o(y)396 2783 y(just)i(help)f(us)g(trust)h(our)e(design.)-2
2967 y
SDict begin H.S end
 -2 2967 a -2 2967 a
SDict begin 13 H.A end
 -2 2967 a -2 2967 a
SDict begin [/View [/XYZ H.V]/Dest (0:2085) cvn /DEST pdfmark end
 -2 2967
a 396 3057 a Fk(The)h(client)g(uses)h(a)g(REQ)f(sock)o(et,)g(and)g
(does)g(the)g(brute-force)e(close/reopen)g(because)h(REQ)i(sock)o(ets)g
(impose)e(that)396 3165 y(strict)i(send/recei)n(v)o(e)d(c)o(ycle.)i(Y)
-9 b(ou)19 b(might)h(be)g(tempted)f(to)i(use)f(a)h(DEALER)f(instead,)g
(b)n(ut)g(it)h(w)o(ould)e(not)h(be)g(a)h(good)396 3273
y(decision.)e(First,)i(it)g(w)o(ould)f(mean)f(emulating)g(the)h(secret)
h(sauce)f(that)g(REQ)h(does)f(with)g(en)m(v)o(elopes)e(\(if)i(you')l(v)
o(e)396 3381 y(for)o(gotten)d(what)j(that)g(is,)h(it')-5
b(s)20 b(a)h(good)d(sign)i(you)f(don')o(t)f(w)o(ant)i(to)f(ha)n(v)o(e)h
(to)g(do)f(it\).)h(Second,)e(it)j(w)o(ould)e(mean)g(potentially)396
3489 y(getting)h(back)f(replies)h(that)h(you)e(didn')o(t)f(e)o(xpect.)
-2 3673 y
SDict begin H.S end
 -2 3673 a -2 3673 a
SDict begin 13 H.A end
 -2 3673 a -2 3673 a
SDict begin [/View [/XYZ H.V]/Dest (0:2086) cvn /DEST pdfmark end
 -2
3673 a 396 3763 a Fk(Handling)h(f)o(ailures)h(only)f(at)i(the)f(client)
g(w)o(orks)g(when)g(we)g(ha)n(v)o(e)g(a)h(set)g(of)f(clients)g(talking)
f(to)i(a)f(single)g(serv)o(er)-5 b(.)20 b(It)g(can)396
3871 y(handle)f(a)i(serv)o(er)e(crash,)h(b)n(ut)g(only)g(if)g(reco)o(v)
o(ery)e(means)i(restarting)f(that)h(same)h(serv)o(er)-5
b(.)19 b(If)h(there')-5 b(s)20 b(a)h(permanent)d(error)396
3979 y(-)j(e.g.)e(a)i(dead)e(po)n(wer)h(supply)f(on)h(the)g(serv)o(er)f
(hardw)o(are)g(-)h(this)h(approach)d(w)o(on')o(t)h(w)o(ork.)g(Since)i
(the)f(application)f(code)396 4087 y(in)i(serv)o(ers)e(is)i(usually)f
(the)g(biggest)g(source)f(of)h(f)o(ailures)g(in)g(an)o(y)g
(architecture,)e(depending)g(on)i(a)g(single)g(serv)o(er)g(is)h(not)396
4195 y(a)g(great)f(idea.)-2 4379 y
SDict begin H.S end
 -2 4379 a -2 4379
a
SDict begin 13 H.A end
 -2 4379 a -2 4379 a
SDict begin [/View [/XYZ H.V]/Dest (0:2087) cvn /DEST pdfmark end
 -2 4379 a 396 4468 a Fk(So,)g(pros)g(and)g(cons:)
-2 4486 y
SDict begin H.S end
 -2 4486 a -2 4486 a
SDict begin 13 H.A end
 -2 4486 a -2 4486 a
SDict begin [/View [/XYZ H.V]/Dest (0:2088) cvn /DEST pdfmark end
 -2
4486 a -2 4496 a
SDict begin H.S end
 -2 4496 a -2 4496 a
SDict begin 13 H.A end
 -2 4496 a -2 4496
a
SDict begin [/View [/XYZ H.V]/Dest (0:2089) cvn /DEST pdfmark end
 -2 4496 a Black 396 4639 a Fj(\225)p Black 479 4639
a
SDict begin H.S end
 479 4639 a 479 4639 a
SDict begin 13 H.A end
 479 4639 a 479 4639 a
SDict begin [/View [/XYZ H.V]/Dest (0:2090) cvn /DEST pdfmark end
 479 4639
a Fk(Pro:)g(simple)h(to)f(understand)e(and)i(implement.)-2
4657 y
SDict begin H.S end
 -2 4657 a -2 4657 a
SDict begin 13 H.A end
 -2 4657 a -2 4657 a
SDict begin [/View [/XYZ H.V]/Dest (0:2091) cvn /DEST pdfmark end
 -2 4657
a Black 396 4788 a Fj(\225)p Black 479 4788 a
SDict begin H.S end
 479 4788
a 479 4788 a
SDict begin 13 H.A end
 479 4788 a 479 4788 a
SDict begin [/View [/XYZ H.V]/Dest (0:2092) cvn /DEST pdfmark end
 479 4788 a Fk(Pro:)g(w)o(orks)g
(easily)h(with)f(e)o(xisting)g(client)g(and)f(serv)o(er)h(application)e
(code.)-2 4806 y
SDict begin H.S end
 -2 4806 a -2 4806 a
SDict begin 13 H.A end
 -2 4806 a -2 4806
a
SDict begin [/View [/XYZ H.V]/Dest (0:2093) cvn /DEST pdfmark end
 -2 4806 a Black 396 4938 a Fj(\225)p Black 479 4938
a
SDict begin H.S end
 479 4938 a 479 4938 a
SDict begin 13 H.A end
 479 4938 a 479 4938 a
SDict begin [/View [/XYZ H.V]/Dest (0:2094) cvn /DEST pdfmark end
 479 4938
a Fk(Pro:)i(\330MQ)h(automatically)e(retries)h(the)g(actual)g
(reconnection)e(until)i(it)h(w)o(orks.)-2 4956 y
SDict begin H.S end
 -2 4956
a -2 4956 a
SDict begin 13 H.A end
 -2 4956 a -2 4956 a
SDict begin [/View [/XYZ H.V]/Dest (0:2095) cvn /DEST pdfmark end
 -2 4956 a Black 396 5087
a Fj(\225)p Black 479 5087 a
SDict begin H.S end
 479 5087 a 479 5087 a
SDict begin 13 H.A end
 479
5087 a 479 5087 a
SDict begin [/View [/XYZ H.V]/Dest (0:2096) cvn /DEST pdfmark end
 479 5087 a Fk(Con:)g(doesn')o(t)d(do)i(f)o(ail-o)o(v)
o(er)e(to)j(backup)d(/)j(alternate)f(serv)o(ers.)-2 5146
y
SDict begin H.S end
 -2 5146 a -2 5146 a
SDict begin 13 H.A end
 -2 5146 a -2 5146 a
SDict begin [/View [/XYZ H.V]/Dest (0:2097) cvn /DEST pdfmark end
 -2 5146 a Black
3757 5569 a Ff(156)p Black eop end
%%Page: 157 170
TeXDict begin 157 169 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.157) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 94 a Fn(4.4.)39 b(Basic)g(Reliab)o(le)e(Queuing)h(\(Simple)g
(Pirate)h(P)l(attern\))3447 94 y
SDict begin H.S end
 3447 94 a 3447 94 a
SDict begin 22.464 H.A end

3447 94 a 3447 94 a
SDict begin [/View [/XYZ H.V]/Dest (9.58.1) cvn /DEST pdfmark end
 3447 94 a -2 292 a
SDict begin H.S end
 -2 292 a -2 292
a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:2099) cvn /DEST pdfmark end
 -2 292 a 396 368 a Fk(Our)20 b(second)f(approach)f
(tak)o(es)j(Lazy)f(Pirate)g(pattern)f(and)h(e)o(xtends)f(it)i(with)g(a)
f(queue)f(de)n(vice)h(that)g(lets)h(us)f(talk,)396 476
y(transparently)-5 b(,)18 b(to)i(multiple)g(serv)o(ers,)f(which)h(we)g
(can)g(more)g(accurately)f(call)h('w)o(ork)o(ers'.)f(W)-7
b(e')o(ll)21 b(de)n(v)o(elop)d(this)j(in)396 584 y(stages,)g(starting)e
(with)i(a)f(minimal)g(w)o(orking)f(model,)g(the)h(Simple)g(Pirate)g
(pattern.)-2 768 y
SDict begin H.S end
 -2 768 a -2 768 a
SDict begin 13 H.A end
 -2 768 a -2 768
a
SDict begin [/View [/XYZ H.V]/Dest (0:2100) cvn /DEST pdfmark end
 -2 768 a 396 858 a Fk(In)g(all)h(these)f(Pirate)h(patterns,)e(w)o
(ork)o(ers)h(are)g(stateless,)h(or)f(ha)n(v)o(e)f(some)h(shared)g
(state)h(we)f(don')o(t)f(kno)n(w)g(about,)g(e.g.)h(a)396
966 y(shared)g(database.)f(Ha)n(ving)h(a)g(queue)f(de)n(vice)h(means)f
(w)o(ork)o(ers)h(can)g(come)g(and)f(go)h(without)f(clients)i(kno)n
(wing)396 1074 y(an)o(ything)d(about)i(it.)g(If)g(one)g(w)o(ork)o(er)f
(dies,)h(another)f(tak)o(es)i(o)o(v)o(er)-5 b(.)19 b(This)h(is)h(a)g
(nice)f(simple)g(topology)e(with)i(only)g(one)396 1182
y(real)g(weakness,)g(namely)f(the)h(central)g(queue)f(itself,)i(which)e
(can)h(become)f(a)i(problem)d(to)j(manage,)d(and)i(a)h(single)396
1290 y(point)f(of)g(f)o(ailure.)-2 1474 y
SDict begin H.S end
 -2 1474 a -2
1474 a
SDict begin 13 H.A end
 -2 1474 a -2 1474 a
SDict begin [/View [/XYZ H.V]/Dest (0:2101) cvn /DEST pdfmark end
 -2 1474 a 396 1564 a Fk(The)g(basis)h(for)e
(the)i(queue)e(de)n(vice)g(is)i(the)f(least-recently-used)e(\(LR)m(U\))
i(routing)f(queue)g(from)g(Chapter)g(Three.)g(What)396
1672 y(is)i(the)g(v)o(ery)762 1672 y
SDict begin H.S end
 762 1672 a 762 1672
a
SDict begin 13 H.A end
 762 1672 a 762 1672 a
SDict begin [/View [/XYZ H.V]/Dest (0:2102) cvn /DEST pdfmark end
 762 1672 a Ff(minimum)e Fk(we)i(need)e(to)i(do)
f(to)g(handle)f(dead)h(or)f(block)o(ed)g(w)o(ork)o(ers?)h(T)l(urns)f
(out,)h(it')-5 b(s)21 b(surprisingly)e(little.)396 1779
y(W)-7 b(e)21 b(already)e(ha)n(v)o(e)h(a)g(retry)f(mechanism)g(in)h
(the)g(client.)g(So)g(using)f(the)h(standard)f(LR)m(U)h(queue)f(will)i
(w)o(ork)e(pretty)g(well.)396 1887 y(This)h(\002ts)h(with)f(\330MQ')-5
b(s)20 b(philosophy)d(that)j(we)g(can)g(e)o(xtend)e(a)i(peer)n
(-to-peer)d(pattern)i(lik)o(e)h(request-reply)e(by)h(plugging)396
1995 y(nai)n(v)o(e)h(de)n(vices)f(in)i(the)f(middle\()p
0 TeXcolorgray 1329 1995 a
SDict begin H.S end
 1329 1995 a Fk(Figure)e(4-2)1677
1995 y
SDict begin 13 H.L end
 1677 1995 a 1677 1995 a
SDict begin [/Subtype /Link/Dest (0:figure-55) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1677 1995 a Black -2 w
Fk(\).)-2 2013 y
SDict begin H.S end
 -2 2013 a -2 2013 a
SDict begin 13 H.A end
 -2 2013 a -2 2013
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-55) cvn /DEST pdfmark
end
 -2 2013 a 396 2197 a Fg(Figur)o(e)i(4-2.)f(The)i(Simple)g(Pirate)f(P)
o(atter)o(n)-2 2297 y
SDict begin H.S end
 -2 2297 a -2 2297 a
SDict begin 13 H.A end
 -2 2297 a -2
2297 a
SDict begin [/View [/XYZ H.V]/Dest (0:2106) cvn /DEST pdfmark end
 -2 2297 a 396 4963 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4963 a @beginspecial
0 @llx -315 @lly 294 @urx 0 @ury 2940 @rwi @setspecial
%%BeginDocument: images/fig55.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -315 294 0
%%HiResBoundingBox: 0.0 -315.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -39.80017852783203 lineto
88.80017852783203 -39.80017852783203 lineto
88.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -42.80017852783203 moveto
16.800180435180664 -57.80017852783203 lineto
88.80017852783203 -57.80017852783203 lineto
88.80017852783203 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -60.80017852783203 moveto
16.800180435180664 -73.80017852783203 lineto
16.800180435180664 -76.4668451944987 17.800180435180664 -77.80017852783203 19.800180435180664 -77.80017852783203 curveto
85.80017852783203 -77.80017852783203 lineto
85.80017852783203 -77.80017852783203 lineto
87.80017852783203 -77.80017852783203 88.80017852783203 -76.4668451944987 88.80017852783203 -73.80017852783203 curveto
88.80017852783203 -61.000179290771484 lineto
88.80017852783203 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -23.800180435180664 moveto
112.80017852783203 -39.80017852783203 lineto
184.80018615722656 -39.80017852783203 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -42.80017852783203 moveto
112.80017852783203 -57.80017852783203 lineto
184.80018615722656 -57.80017852783203 lineto
184.80018615722656 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -60.80017852783203 moveto
112.80017852783203 -73.80017852783203 lineto
112.80017852783203 -76.4668451944987 113.80017852783203 -77.80017852783203 115.80017852783203 -77.80017852783203 curveto
181.80018615722656 -77.80017852783203 lineto
181.80018615722656 -77.80017852783203 lineto
183.80018615722656 -77.80017852783203 184.80018615722656 -76.4668451944987 184.80018615722656 -73.80017852783203 curveto
184.80018615722656 -61.000179290771484 lineto
184.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -23.800180435180664 moveto
208.80018615722656 -39.80017852783203 lineto
280.8001708984375 -39.80017852783203 lineto
280.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -42.80017852783203 moveto
208.80018615722656 -57.80017852783203 lineto
280.8001708984375 -57.80017852783203 lineto
280.8001708984375 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -60.80017852783203 moveto
208.80018615722656 -73.80017852783203 lineto
208.80018615722656 -76.4668451944987 209.80018615722656 -77.80017852783203 211.80018615722656 -77.80017852783203 curveto
277.8001708984375 -77.80017852783203 lineto
277.8001708984375 -77.80017852783203 lineto
279.8001708984375 -77.80017852783203 280.8001708984375 -76.4668451944987 280.8001708984375 -73.80017852783203 curveto
280.8001708984375 -61.000179290771484 lineto
280.8001708984375 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -131.80018615722656 moveto
113.80017852783203 -131.80018615722656 112.80017852783203 -133.46685282389322 112.80017852783203 -136.80018615722656 curveto
112.80017852783203 -147.80018615722656 lineto
184.80018615722656 -147.80018615722656 lineto
184.80018615722656 -136.80018615722656 lineto
184.80018615722656 -133.46685282389322 183.80018615722656 -131.80018615722656 181.80018615722656 -131.80018615722656 curveto
115.80017852783203 -131.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -150.80018615722656 moveto
112.80017852783203 -174.80018615722656 lineto
184.80018615722656 -174.80018615722656 lineto
184.80018615722656 -150.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -177.80018615722656 moveto
112.80017852783203 -190.80018615722656 lineto
112.80017852783203 -193.46685282389322 113.80017852783203 -194.80018615722656 115.80017852783203 -194.80018615722656 curveto
181.80018615722656 -194.80018615722656 lineto
181.80018615722656 -194.80018615722656 lineto
183.80018615722656 -194.80018615722656 184.80018615722656 -193.46685282389322 184.80018615722656 -190.80018615722656 curveto
184.80018615722656 -178.00018310546875 lineto
184.80018615722656 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -248.80018615722656 moveto
17.800180435180664 -248.80018615722656 16.800180435180664 -250.46685282389322 16.800180435180664 -253.80018615722656 curveto
16.800180435180664 -264.8001708984375 lineto
88.80017852783203 -264.8001708984375 lineto
88.80017852783203 -253.80018615722656 lineto
88.80017852783203 -250.46685282389322 87.80017852783203 -248.80018615722656 85.80017852783203 -248.80018615722656 curveto
19.800180435180664 -248.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -267.8001708984375 moveto
16.800180435180664 -293.8001708984375 lineto
88.80017852783203 -293.8001708984375 lineto
88.80017852783203 -267.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -248.80018615722656 moveto
113.80017852783203 -248.80018615722656 112.80017852783203 -250.46685282389322 112.80017852783203 -253.80018615722656 curveto
112.80017852783203 -264.8001708984375 lineto
184.80018615722656 -264.8001708984375 lineto
184.80018615722656 -253.80018615722656 lineto
184.80018615722656 -250.46685282389322 183.80018615722656 -248.80018615722656 181.80018615722656 -248.80018615722656 curveto
115.80017852783203 -248.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -267.8001708984375 moveto
112.80017852783203 -293.8001708984375 lineto
184.80018615722656 -293.8001708984375 lineto
184.80018615722656 -267.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -248.80018615722656 moveto
209.80018615722656 -248.80018615722656 208.80018615722656 -250.46685282389322 208.80018615722656 -253.80018615722656 curveto
208.80018615722656 -264.8001708984375 lineto
280.8001708984375 -264.8001708984375 lineto
280.8001708984375 -253.80018615722656 lineto
280.8001708984375 -250.46685282389322 279.8001708984375 -248.80018615722656 277.8001708984375 -248.80018615722656 curveto
211.80018615722656 -248.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -267.8001708984375 moveto
208.80018615722656 -293.8001708984375 lineto
280.8001708984375 -293.8001708984375 lineto
280.8001708984375 -267.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -146.0 lineto
183.0 -146.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -146.0 lineto
183.0 -146.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -149.0 moveto
111.0 -173.0 lineto
183.0 -173.0 lineto
183.0 -149.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -149.0 moveto
111.0 -173.0 lineto
183.0 -173.0 lineto
183.0 -149.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -189.0 lineto
111.0 -191.66666666666666 112.0 -193.0 114.0 -193.0 curveto
180.0 -193.0 lineto
180.0 -193.0 lineto
182.0 -193.0 183.0 -191.66666666666666 183.0 -189.0 curveto
183.0 -176.1999969482422 lineto
183.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -189.0 lineto
111.0 -191.66666666666666 112.0 -193.0 114.0 -193.0 curveto
180.0 -193.0 lineto
180.0 -193.0 lineto
182.0 -193.0 183.0 -191.66666666666666 183.0 -189.0 curveto
183.0 -176.1999969482422 lineto
183.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -247.0 moveto
16.0 -247.0 15.0 -248.66666666666666 15.0 -252.0 curveto
15.0 -263.0 lineto
87.0 -263.0 lineto
87.0 -252.0 lineto
87.0 -248.66666666666666 86.0 -247.0 84.0 -247.0 curveto
18.0 -247.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -247.0 moveto
16.0 -247.0 15.0 -248.66666666666666 15.0 -252.0 curveto
15.0 -263.0 lineto
87.0 -263.0 lineto
87.0 -252.0 lineto
87.0 -248.66666666666666 86.0 -247.0 84.0 -247.0 curveto
18.0 -247.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -266.0 moveto
15.0 -292.0 lineto
87.0 -292.0 lineto
87.0 -266.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -266.0 moveto
15.0 -292.0 lineto
87.0 -292.0 lineto
87.0 -266.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -247.0 moveto
112.0 -247.0 111.0 -248.66666666666666 111.0 -252.0 curveto
111.0 -263.0 lineto
183.0 -263.0 lineto
183.0 -252.0 lineto
183.0 -248.66666666666666 182.0 -247.0 180.0 -247.0 curveto
114.0 -247.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -247.0 moveto
112.0 -247.0 111.0 -248.66666666666666 111.0 -252.0 curveto
111.0 -263.0 lineto
183.0 -263.0 lineto
183.0 -252.0 lineto
183.0 -248.66666666666666 182.0 -247.0 180.0 -247.0 curveto
114.0 -247.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -266.0 moveto
111.0 -292.0 lineto
183.0 -292.0 lineto
183.0 -266.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -266.0 moveto
111.0 -292.0 lineto
183.0 -292.0 lineto
183.0 -266.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -247.0 moveto
208.0 -247.0 207.0 -248.66666666666666 207.0 -252.0 curveto
207.0 -263.0 lineto
279.0 -263.0 lineto
279.0 -252.0 lineto
279.0 -248.66666666666666 278.0 -247.0 276.0 -247.0 curveto
210.0 -247.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -247.0 moveto
208.0 -247.0 207.0 -248.66666666666666 207.0 -252.0 curveto
207.0 -263.0 lineto
279.0 -263.0 lineto
279.0 -252.0 lineto
279.0 -248.66666666666666 278.0 -247.0 276.0 -247.0 curveto
210.0 -247.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -266.0 moveto
207.0 -292.0 lineto
279.0 -292.0 lineto
279.0 -266.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -266.0 moveto
207.0 -292.0 lineto
279.0 -292.0 lineto
279.0 -266.0 lineto
closepath
stroke
newpath
51.0 -81.0 moveto
48.0 -90.0 lineto
54.0 -90.0 lineto
closepath
fill
newpath
147.0 -81.0 moveto
144.0 -90.0 lineto
150.0 -90.0 lineto
closepath
fill
newpath
243.0 -81.0 moveto
240.0 -90.0 lineto
246.0 -90.0 lineto
closepath
fill
newpath
144.0 -117.0 moveto
147.0 -126.0 lineto
150.0 -117.0 lineto
closepath
fill
newpath
147.0 -198.0 moveto
144.0 -207.0 lineto
150.0 -207.0 lineto
closepath
fill
newpath
48.0 -234.0 moveto
51.0 -243.0 lineto
54.0 -234.0 lineto
closepath
fill
newpath
144.0 -234.0 moveto
147.0 -243.0 lineto
150.0 -234.0 lineto
closepath
fill
newpath
240.0 -234.0 moveto
243.0 -243.0 lineto
246.0 -234.0 lineto
closepath
fill
newpath
51.0 -85.0 moveto
51.0 -99.0 lineto
51.0 -101.66666666666667 52.0 -103.0 54.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -85.0 moveto
147.0 -103.0 lineto
stroke
newpath
243.0 -85.0 moveto
243.0 -99.0 lineto
243.0 -101.66666666666667 242.0 -103.0 240.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -121.0 moveto
147.0 -103.0 lineto
stroke
newpath
147.0 -202.0 moveto
147.0 -220.0 lineto
stroke
newpath
51.0 -238.0 moveto
51.0 -225.0 lineto
51.0 -221.66666666666666 52.0 -220.0 54.0 -220.0 curveto
147.0 -220.0 lineto
147.0 -220.0 lineto
stroke
newpath
147.0 -238.0 moveto
147.0 -220.0 lineto
stroke
newpath
243.0 -238.0 moveto
243.0 -225.0 lineto
243.0 -221.66666666666666 242.0 -220.0 240.0 -220.0 curveto
147.0 -220.0 lineto
147.0 -220.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
34.0 -35.0 moveto
(Client) show
130.0 -35.0 moveto
(Client) show
226.0 -35.0 moveto
(Client) show
38.0 -53.0 moveto
(Retry) show
134.0 -53.0 moveto
(Retry) show
230.0 -53.0 moveto
(Retry) show
43.0 -71.0 moveto
(REQ) show
139.0 -71.0 moveto
(REQ) show
235.0 -71.0 moveto
(REQ) show
128.0 -143.0 moveto
(ROUTER) show
140.0 -161.0 moveto
(LRU) show
133.0 -170.0 moveto
(Queue) show
128.0 -188.0 moveto
(ROUTER) show
43.0 -260.0 moveto
(REQ) show
139.0 -260.0 moveto
(REQ) show
235.0 -260.0 moveto
(REQ) show
44.0 -278.0 moveto
(LRU) show
36.0 -287.0 moveto
(Worker) show
140.0 -278.0 moveto
(LRU) show
132.0 -287.0 moveto
(Worker) show
236.0 -278.0 moveto
(LRU) show
228.0 -287.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4963 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4963 a Black 3756 5569 a
Ff(157)p Black eop end
%%Page: 158 171
TeXDict begin 158 170 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.158) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2109) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(W)-7 b(e)21 b(don')o(t)d(need)h(a)h(special)g
(client,)g(we')l(re)f(still)i(using)e(the)h(Lazy)f(Pirate)h(client.)f
(Here)h(is)h(the)e(queue,)g(which)g(is)i(e)o(xactly)396
180 y(a)g(LR)m(U)f(queue,)f(no)h(more)f(or)h(less:)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:spqueue-c) cvn /DEST pdfmark
end
 -2 198 a 396
382 a Fg(Example)h(4-4.)e(Simple)i(Pirate)f(queue)h(\(spqueue.c\))-2
482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:2112) cvn /DEST pdfmark end
 -2 482 a 396
562 a Fe(//)396 659 y(//)90 b(Simple)43 b(Pirate)h(queue)396
756 y(//)90 b(This)44 b(is)g(identical)g(to)g(the)g(LRU)h(pattern,)e
(with)h(no)h(reliability)e(mechanisms)396 853 y(//)90
b(at)44 b(all.)g(It)h(depends)e(on)i(the)f(client)g(for)g(recovery.)g
(Runs)g(forever.)396 950 y(//)396 1048 y(#include)g("czmq.h")396
1242 y(#define)g(LRU_READY)133 b("\\001")268 b(//)89
b(Signals)44 b(worker)g(is)g(ready)396 1436 y(int)h(main)f(\(void\))396
1533 y({)576 1630 y(zctx_t)889 1643 y(*)934 1630 y(ctx)h(=)f(zctx_new)g
(\(\);)576 1728 y(void)800 1741 y(*)845 1728 y(frontend)f(=)i
(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576 1825 y(void)800
1838 y(*)845 1825 y(backend)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)
576 1922 y(zsocket_bind)e(\(frontend,)i("tcp://)1967
1935 y(*)2012 1922 y(:5555"\);)176 b(//)90 b(For)44 b(clients)576
2019 y(zsocket_bind)e(\(backend,)89 b("tcp://)1967 2032
y(*)2012 2019 y(:5556"\);)176 b(//)90 b(For)44 b(workers)576
2213 y(//)89 b(Queue)44 b(of)g(available)g(workers)576
2310 y(zlist_t)934 2323 y(*)979 2310 y(workers)g(=)g(zlist_new)g(\(\);)
576 2505 y(//)89 b(The)44 b(body)g(of)h(this)f(example)g(is)g(exactly)g
(the)g(same)g(as)h(lruqueue2.)396 2602 y(...)396 2699
y(})-2 2873 y
SDict begin H.S end
 -2 2873 a -2 2873 a
SDict begin 13 H.A end
 -2 2873 a -2 2873 a
SDict begin [/View [/XYZ H.V]/Dest (0:2113) cvn /DEST pdfmark end

-2 2873 a 396 2973 a Fk(Here)20 b(is)h(the)g(w)o(ork)o(er)m(,)d(which)i
(tak)o(es)h(the)f(Lazy)f(Pirate)i(serv)o(er)e(and)h(adapts)g(it)h(for)e
(the)h(LR)m(U)h(pattern)e(\(using)g(the)i(REQ)396 3081
y(')l(ready')e(signaling\):)-2 3099 y
SDict begin H.S end
 -2 3099 a -2 3099
a
SDict begin 13 H.A end
 -2 3099 a -2 3099 a
SDict begin [/View [/XYZ H.V]/Dest (0:spworker-c) cvn /DEST pdfmark
end
 -2 3099 a 396 3282 a Fg(Example)i(4-5.)e(Simple)i
(Pirate)f(w)o(ork)o(er)g(\(spw)o(ork)o(er)-8 b(.c\))-2
3382 y
SDict begin H.S end
 -2 3382 a -2 3382 a
SDict begin 11.7 H.A end
 -2 3382 a -2 3382 a
SDict begin [/View [/XYZ H.V]/Dest (0:2116) cvn /DEST pdfmark end
 -2 3382
a 396 3462 a Fe(//)396 3559 y(//)90 b(Simple)43 b(Pirate)h(worker)396
3657 y(//)90 b(Connects)43 b(REQ)h(socket)g(to)h(tcp://)1877
3670 y(*)1922 3657 y(:5556)396 3754 y(//)90 b(Implements)43
b(worker)h(part)g(of)g(LRU)h(queueing)396 3851 y(//)396
3948 y(#include)f("czmq.h")396 4045 y(#define)g(LRU_READY)133
b("\\001")268 b(//)89 b(Signals)44 b(worker)g(is)g(ready)396
4239 y(int)h(main)f(\(void\))396 4336 y({)576 4434 y(zctx_t)889
4447 y(*)934 4434 y(ctx)h(=)f(zctx_new)g(\(\);)576 4531
y(void)800 4544 y(*)845 4531 y(worker)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_REQ\);)576 4725 y(//)89 b(Set)44 b(random)g(identity)g(to)g(make)g
(tracing)g(easier)576 4822 y(srandom)f(\(\(unsigned\))g(time)h
(\(NULL\)\);)576 4919 y(char)g(identity)f([10];)576 5016
y(sprintf)g(\(identity,)g("\04504X-\04504X",)g(randof)h(\(0x10000\),)f
(randof)h(\(0x10000\)\);)576 5114 y(zmq_setsockopt)e(\(worker,)i
(ZMQ_IDENTITY,)e(identity,)i(strlen)f(\(identity\)\);)p
Black 3759 5569 a Ff(158)p Black eop end
%%Page: 159 172
TeXDict begin 159 171 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.159) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(zsocket_connect)42 b(\(worker,)h
("tcp://localhost:5556"\);)576 267 y(//)89 b(Tell)44
b(broker)g(we're)g(ready)g(for)g(work)576 364 y(printf)f(\("I:)i
(\(\045s\))f(worker)g(ready\\n",)f(identity\);)576 461
y(zframe_t)979 474 y(*)1024 461 y(frame)h(=)h(zframe_new)e
(\(LRU_READY,)g(1\);)576 558 y(zframe_send)g(\(&frame,)g(worker,)h
(0\);)576 752 y(int)g(cycles)g(=)g(0;)576 850 y(while)g(\(true\))f({)
755 947 y(zmsg_t)1069 960 y(*)1114 947 y(msg)h(=)h(zmsg_recv)e
(\(worker\);)755 1044 y(if)h(\(!msg\))934 1141 y(break;)627
b(//)89 b(Interrupted)755 1335 y(//)g(Simulate)44 b(various)f
(problems,)h(after)g(a)g(few)h(cycles)755 1432 y(cycles++;)755
1530 y(if)f(\(cycles)g(>)h(3)f(&&)h(randof)f(\(5\))g(==)h(0\))f({)934
1627 y(printf)g(\("I:)g(\(\045s\))g(simulating)g(a)g(crash\\n",)g
(identity\);)934 1724 y(zmsg_destroy)f(\(&msg\);)934
1821 y(break;)755 1918 y(})755 2015 y(else)755 2112 y(if)h(\(cycles)g
(>)h(3)f(&&)h(randof)f(\(5\))g(==)h(0\))f({)934 2209
y(printf)g(\("I:)g(\(\045s\))g(simulating)g(CPU)g(overload\\n",)f
(identity\);)934 2307 y(sleep)h(\(3\);)934 2404 y(if)h
(\(zctx_interrupted\))1114 2501 y(break;)755 2598 y(})755
2695 y(printf)f(\("I:)g(\(\045s\))g(normal)g(reply\\n",)f(identity\);)
755 2792 y(sleep)h(\(1\);)627 b(//)89 b(Do)45 b(some)f(heavy)g(work)755
2889 y(zmsg_send)f(\(&msg,)h(worker\);)576 2987 y(})576
3084 y(zctx_destroy)e(\(&ctx\);)576 3181 y(return)h(0;)396
3278 y(})-2 3452 y
SDict begin H.S end
 -2 3452 a -2 3452 a
SDict begin 13 H.A end
 -2 3452 a -2 3452
a
SDict begin [/View [/XYZ H.V]/Dest (0:2117) cvn /DEST pdfmark end
 -2 3452 a 396 3552 a Fk(T)-7 b(o)21 b(test)g(this,)f(start)h(a)f
(handful)f(of)h(w)o(ork)o(ers,)f(a)i(client,)f(and)f(the)h(queue,)f(in)
i(an)o(y)e(order)-5 b(.)19 b(Y)-9 b(ou')o(ll)20 b(see)g(that)h(the)f(w)
o(ork)o(ers)396 3660 y(e)n(v)o(entually)e(all)i(crash)g(and)f(b)n(urn,)
f(and)h(the)h(client)g(retries)f(and)g(then)g(gi)n(v)o(es)h(up.)f(The)g
(queue)f(ne)n(v)o(er)h(stops,)g(and)g(you)g(can)396 3768
y(restart)h(w)o(ork)o(ers)g(and)g(clients)g(ad-nauseam.)e(This)j(model)
e(w)o(orks)h(with)g(an)o(y)f(number)g(of)h(clients)g(and)g(w)o(ork)o
(ers.)-2 3796 y
SDict begin H.S end
 -2 3796 a -2 3796 a
SDict begin 13 H.A end
 -2 3796 a -2 3796
a
SDict begin [/View [/XYZ H.V]/Dest (0:2118) cvn /DEST pdfmark end
 -2 3796 a 359 x Fn(4.5.)39 b(Rob)m(ust)f(Reliab)o(le)g(Queuing)f(\(P)
l(aranoid)h(Pirate)g(P)l(attern\))3694 4155 y
SDict begin H.S end
 3694 4155
a 3694 4155 a
SDict begin 22.464 H.A end
 3694 4155 a 3694 4155 a
SDict begin [/View [/XYZ H.V]/Dest (9.59.1) cvn /DEST pdfmark end
 3694 4155 a -2
4353 a
SDict begin H.S end
 -2 4353 a -2 4353 a
SDict begin 13 H.A end
 -2 4353 a -2 4353 a
SDict begin [/View [/XYZ H.V]/Dest (0:2120) cvn /DEST pdfmark end
 -2 4353
a 396 4429 a Fk(The)20 b(Simple)g(Pirate)h(Queue)e(pattern)g(w)o(orks)h
(pretty)g(well,)g(especially)g(since)g(it')-5 b(s)21
b(just)g(a)g(combination)d(of)i(tw)o(o)396 4537 y(e)o(xisting)g
(patterns,)f(b)n(ut)h(it)h(has)g(some)f(weaknesses:)-2
4555 y
SDict begin H.S end
 -2 4555 a -2 4555 a
SDict begin 13 H.A end
 -2 4555 a -2 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:2121) cvn /DEST pdfmark end
 -2 4555
a -2 4565 a
SDict begin H.S end
 -2 4565 a -2 4565 a
SDict begin 13 H.A end
 -2 4565 a -2 4565 a
SDict begin [/View [/XYZ H.V]/Dest (0:2122) cvn /DEST pdfmark end
 -2
4565 a Black 396 4707 a Fj(\225)p Black 479 4707 a
SDict begin H.S end
 479
4707 a 479 4707 a
SDict begin 13 H.A end
 479 4707 a 479 4707 a
SDict begin [/View [/XYZ H.V]/Dest (0:2123) cvn /DEST pdfmark end
 479 4707 a Fk(It')-5
b(s)21 b(not)f(rob)n(ust)g(against)f(a)i(queue)e(crash)h(and)f
(restart.)h(The)g(client)g(will)h(reco)o(v)o(er)m(,)d(b)n(ut)i(the)g(w)
o(ork)o(ers)g(w)o(on')o(t.)f(While)479 4815 y(\330MQ)i(will)g
(reconnect)d(w)o(ork)o(ers')h(sock)o(ets)i(automatically)-5
b(,)18 b(as)j(f)o(ar)f(as)h(the)f(ne)n(wly)f(started)h(queue)f(is)j
(concerned,)479 4923 y(the)e(w)o(ork)o(ers)g(ha)n(v)o(en')o(t)e
(signaled)i("READ)-5 b(Y",)20 b(so)h(don')o(t)d(e)o(xist.)j(T)-7
b(o)20 b(\002x)g(this)h(we)g(ha)n(v)o(e)e(to)i(do)e(heartbeating)f
(from)479 5031 y(queue)h(to)i(w)o(ork)o(er)m(,)d(so)j(that)f(the)g(w)o
(ork)o(er)g(can)g(detect)g(when)f(the)h(queue)f(has)i(gone)e(a)o(w)o
(ay)-5 b(.)-2 5049 y
SDict begin H.S end
 -2 5049 a -2 5049 a
SDict begin 13 H.A end
 -2 5049 a -2
5049 a
SDict begin [/View [/XYZ H.V]/Dest (0:2124) cvn /DEST pdfmark end
 -2 5049 a Black 3759 5569 a Ff(159)p Black eop
end
%%Page: 160 173
TeXDict begin 160 172 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.160) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2125) cvn /DEST pdfmark end
 479 72 a Fk(The)g(queue)f(does)h(not)g
(detect)g(w)o(ork)o(er)f(f)o(ailure,)h(so)g(if)h(a)f(w)o(ork)o(er)f
(dies)i(while)f(idle,)g(the)g(queue)f(can)h(only)g(remo)o(v)o(e)e(it)
479 180 y(from)h(its)j(w)o(ork)o(er)d(queue)g(by)h(\002rst)h(sending)e
(it)i(a)f(request.)f(The)h(client)h(w)o(aits)g(and)e(retries)i(for)e
(nothing.)f(It')-5 b(s)21 b(not)f(a)479 288 y(critical)h(problem)d(b)n
(ut)i(it')-5 b(s)22 b(not)d(nice.)h(T)-7 b(o)21 b(mak)o(e)e(this)i(w)o
(ork)f(properly)e(we)i(do)g(heartbeating)e(from)h(w)o(ork)o(er)g(to)479
396 y(queue,)g(so)i(that)f(the)g(queue)f(can)h(detect)g(a)h(lost)f(w)o
(ork)o(er)g(at)g(an)o(y)g(stage.)-2 580 y
SDict begin H.S end
 -2 580 a -2
580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:2126) cvn /DEST pdfmark end
 -2 580 a 396 670 a Fk(W)-7 b(e')o(ll)22
b(\002x)e(these)g(in)h(a)f(properly)e(pedantic)h(P)o(aranoid)g(Pirate)h
(P)o(attern.)-2 854 y
SDict begin H.S end
 -2 854 a -2 854 a
SDict begin 13 H.A end
 -2 854 a -2 854
a
SDict begin [/View [/XYZ H.V]/Dest (0:2127) cvn /DEST pdfmark end
 -2 854 a 396 944 a Fk(W)-7 b(e)22 b(pre)n(viously)c(used)i(a)g(REQ)h
(sock)o(et)f(for)g(the)g(w)o(ork)o(er)-5 b(.)19 b(F)o(or)h(the)g(P)o
(aranoid)f(Pirate)h(w)o(ork)o(er)g(we')o(ll)g(switch)h(to)f(a)396
1052 y(DEALER)g(sock)o(et\()p 0 TeXcolorgray 984 1052
a
SDict begin H.S end
 984 1052 a Fk(Figure)f(4-3)1333 1052 y
SDict begin 13 H.L end
 1333 1052 a
1333 1052 a
SDict begin [/Subtype /Link/Dest (0:figure-56) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1333 1052 a Black -2 w Fk(\).)h(This)g(has)g(the)g(adv)n
(antage)e(of)h(letting)h(us)g(send)g(and)f(recei)n(v)o(e)g(messages)g
(at)i(an)o(y)e(time,)396 1160 y(rather)h(than)f(the)i(lock-step)e
(send/recei)n(v)o(e)f(that)i(REQ)h(imposes.)f(The)g(do)n(wnside)f(of)g
(DEALER)i(is)g(that)f(we)h(ha)n(v)o(e)e(to)396 1268 y(do)h(our)f(o)n
(wn)h(en)m(v)o(elope)e(management.)g(If)i(you)f(don')o(t)g(kno)n(w)g
(what)h(I)g(mean,)g(please)g(re-read)f(Chapter)g(Three.)-2
1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-56) cvn /DEST pdfmark
end
 -2 1286
a 396 1469 a Fg(Figur)o(e)h(4-3.)f(The)i(P)o(aranoid)e(Pirate)h(P)o
(atter)o(n)-2 1569 y
SDict begin H.S end
 -2 1569 a -2 1569 a
SDict begin 13 H.A end
 -2 1569 a -2
1569 a
SDict begin [/View [/XYZ H.V]/Dest (0:2131) cvn /DEST pdfmark end
 -2 1569 a 396 4386 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4386 a @beginspecial
0 @llx -333 @lly 294 @urx 0 @ury 2940 @rwi @setspecial
%%BeginDocument: images/fig56.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -333 294 0
%%HiResBoundingBox: 0.0 -333.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -39.80017852783203 lineto
88.80017852783203 -39.80017852783203 lineto
88.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -42.80017852783203 moveto
16.800180435180664 -57.80017852783203 lineto
88.80017852783203 -57.80017852783203 lineto
88.80017852783203 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -60.80017852783203 moveto
16.800180435180664 -73.80017852783203 lineto
16.800180435180664 -76.4668451944987 17.800180435180664 -77.80017852783203 19.800180435180664 -77.80017852783203 curveto
85.80017852783203 -77.80017852783203 lineto
85.80017852783203 -77.80017852783203 lineto
87.80017852783203 -77.80017852783203 88.80017852783203 -76.4668451944987 88.80017852783203 -73.80017852783203 curveto
88.80017852783203 -61.000179290771484 lineto
88.80017852783203 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -23.800180435180664 moveto
112.80017852783203 -39.80017852783203 lineto
184.80018615722656 -39.80017852783203 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -42.80017852783203 moveto
112.80017852783203 -57.80017852783203 lineto
184.80018615722656 -57.80017852783203 lineto
184.80018615722656 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -60.80017852783203 moveto
112.80017852783203 -73.80017852783203 lineto
112.80017852783203 -76.4668451944987 113.80017852783203 -77.80017852783203 115.80017852783203 -77.80017852783203 curveto
181.80018615722656 -77.80017852783203 lineto
181.80018615722656 -77.80017852783203 lineto
183.80018615722656 -77.80017852783203 184.80018615722656 -76.4668451944987 184.80018615722656 -73.80017852783203 curveto
184.80018615722656 -61.000179290771484 lineto
184.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -23.800180435180664 moveto
208.80018615722656 -39.80017852783203 lineto
280.8001708984375 -39.80017852783203 lineto
280.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -42.80017852783203 moveto
208.80018615722656 -57.80017852783203 lineto
280.8001708984375 -57.80017852783203 lineto
280.8001708984375 -42.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -60.80017852783203 moveto
208.80018615722656 -73.80017852783203 lineto
208.80018615722656 -76.4668451944987 209.80018615722656 -77.80017852783203 211.80018615722656 -77.80017852783203 curveto
277.8001708984375 -77.80017852783203 lineto
277.8001708984375 -77.80017852783203 lineto
279.8001708984375 -77.80017852783203 280.8001708984375 -76.4668451944987 280.8001708984375 -73.80017852783203 curveto
280.8001708984375 -61.000179290771484 lineto
280.8001708984375 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -131.80018615722656 moveto
113.80017852783203 -131.80018615722656 112.80017852783203 -133.46685282389322 112.80017852783203 -136.80018615722656 curveto
112.80017852783203 -147.80018615722656 lineto
184.80018615722656 -147.80018615722656 lineto
184.80018615722656 -136.80018615722656 lineto
184.80018615722656 -133.46685282389322 183.80018615722656 -131.80018615722656 181.80018615722656 -131.80018615722656 curveto
115.80017852783203 -131.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -150.80018615722656 moveto
112.80017852783203 -165.80018615722656 lineto
184.80018615722656 -165.80018615722656 lineto
184.80018615722656 -150.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -168.80018615722656 moveto
112.80017852783203 -183.80018615722656 lineto
184.80018615722656 -183.80018615722656 lineto
184.80018615722656 -168.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -186.80018615722656 moveto
112.80017852783203 -199.80018615722656 lineto
112.80017852783203 -202.46685282389322 113.80017852783203 -203.80018615722656 115.80017852783203 -203.80018615722656 curveto
181.80018615722656 -203.80018615722656 lineto
181.80018615722656 -203.80018615722656 lineto
183.80018615722656 -203.80018615722656 184.80018615722656 -202.46685282389322 184.80018615722656 -199.80018615722656 curveto
184.80018615722656 -187.00018310546875 lineto
184.80018615722656 -186.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -257.8001708984375 moveto
17.800180435180664 -257.8001708984375 16.800180435180664 -259.4668375651042 16.800180435180664 -262.8001708984375 curveto
16.800180435180664 -273.8001708984375 lineto
88.80017852783203 -273.8001708984375 lineto
88.80017852783203 -262.8001708984375 lineto
88.80017852783203 -259.4668375651042 87.80017852783203 -257.8001708984375 85.80017852783203 -257.8001708984375 curveto
19.800180435180664 -257.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -276.8001708984375 moveto
16.800180435180664 -291.8001708984375 lineto
88.80017852783203 -291.8001708984375 lineto
88.80017852783203 -276.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -294.8001708984375 moveto
16.800180435180664 -311.8001708984375 lineto
88.80017852783203 -311.8001708984375 lineto
88.80017852783203 -294.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -257.8001708984375 moveto
113.80017852783203 -257.8001708984375 112.80017852783203 -259.4668375651042 112.80017852783203 -262.8001708984375 curveto
112.80017852783203 -273.8001708984375 lineto
184.80018615722656 -273.8001708984375 lineto
184.80018615722656 -262.8001708984375 lineto
184.80018615722656 -259.4668375651042 183.80018615722656 -257.8001708984375 181.80018615722656 -257.8001708984375 curveto
115.80017852783203 -257.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -276.8001708984375 moveto
112.80017852783203 -291.8001708984375 lineto
184.80018615722656 -291.8001708984375 lineto
184.80018615722656 -276.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -294.8001708984375 moveto
112.80017852783203 -311.8001708984375 lineto
184.80018615722656 -311.8001708984375 lineto
184.80018615722656 -294.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -257.8001708984375 moveto
209.80018615722656 -257.8001708984375 208.80018615722656 -259.4668375651042 208.80018615722656 -262.8001708984375 curveto
208.80018615722656 -273.8001708984375 lineto
280.8001708984375 -273.8001708984375 lineto
280.8001708984375 -262.8001708984375 lineto
280.8001708984375 -259.4668375651042 279.8001708984375 -257.8001708984375 277.8001708984375 -257.8001708984375 curveto
211.80018615722656 -257.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -276.8001708984375 moveto
208.80018615722656 -291.8001708984375 lineto
280.8001708984375 -291.8001708984375 lineto
280.8001708984375 -276.8001708984375 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -294.8001708984375 moveto
208.80018615722656 -311.8001708984375 lineto
280.8001708984375 -311.8001708984375 lineto
280.8001708984375 -294.8001708984375 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -38.0 lineto
87.0 -38.0 lineto
87.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -41.0 moveto
15.0 -56.0 lineto
87.0 -56.0 lineto
87.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -59.0 moveto
15.0 -72.0 lineto
15.0 -74.66666666666667 16.0 -76.0 18.0 -76.0 curveto
84.0 -76.0 lineto
84.0 -76.0 lineto
86.0 -76.0 87.0 -74.66666666666667 87.0 -72.0 curveto
87.0 -59.20000076293945 lineto
87.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -38.0 lineto
183.0 -38.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -41.0 moveto
111.0 -56.0 lineto
183.0 -56.0 lineto
183.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -59.0 moveto
111.0 -72.0 lineto
111.0 -74.66666666666667 112.0 -76.0 114.0 -76.0 curveto
180.0 -76.0 lineto
180.0 -76.0 lineto
182.0 -76.0 183.0 -74.66666666666667 183.0 -72.0 curveto
183.0 -59.20000076293945 lineto
183.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -38.0 lineto
279.0 -38.0 lineto
279.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -41.0 moveto
207.0 -56.0 lineto
279.0 -56.0 lineto
279.0 -41.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -59.0 moveto
207.0 -72.0 lineto
207.0 -74.66666666666667 208.0 -76.0 210.0 -76.0 curveto
276.0 -76.0 lineto
276.0 -76.0 lineto
278.0 -76.0 279.0 -74.66666666666667 279.0 -72.0 curveto
279.0 -59.20000076293945 lineto
279.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -146.0 lineto
183.0 -146.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -146.0 lineto
183.0 -146.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -149.0 moveto
111.0 -164.0 lineto
183.0 -164.0 lineto
183.0 -149.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -149.0 moveto
111.0 -164.0 lineto
183.0 -164.0 lineto
183.0 -149.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -167.0 moveto
111.0 -182.0 lineto
183.0 -182.0 lineto
183.0 -167.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -167.0 moveto
111.0 -182.0 lineto
183.0 -182.0 lineto
183.0 -167.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -185.0 moveto
111.0 -198.0 lineto
111.0 -200.66666666666666 112.0 -202.0 114.0 -202.0 curveto
180.0 -202.0 lineto
180.0 -202.0 lineto
182.0 -202.0 183.0 -200.66666666666666 183.0 -198.0 curveto
183.0 -185.1999969482422 lineto
183.0 -185.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -185.0 moveto
111.0 -198.0 lineto
111.0 -200.66666666666666 112.0 -202.0 114.0 -202.0 curveto
180.0 -202.0 lineto
180.0 -202.0 lineto
182.0 -202.0 183.0 -200.66666666666666 183.0 -198.0 curveto
183.0 -185.1999969482422 lineto
183.0 -185.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -256.0 moveto
16.0 -256.0 15.0 -257.6666666666667 15.0 -261.0 curveto
15.0 -272.0 lineto
87.0 -272.0 lineto
87.0 -261.0 lineto
87.0 -257.6666666666667 86.0 -256.0 84.0 -256.0 curveto
18.0 -256.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -256.0 moveto
16.0 -256.0 15.0 -257.6666666666667 15.0 -261.0 curveto
15.0 -272.0 lineto
87.0 -272.0 lineto
87.0 -261.0 lineto
87.0 -257.6666666666667 86.0 -256.0 84.0 -256.0 curveto
18.0 -256.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -275.0 moveto
15.0 -290.0 lineto
87.0 -290.0 lineto
87.0 -275.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -275.0 moveto
15.0 -290.0 lineto
87.0 -290.0 lineto
87.0 -275.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -293.0 moveto
15.0 -310.0 lineto
87.0 -310.0 lineto
87.0 -293.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -293.0 moveto
15.0 -310.0 lineto
87.0 -310.0 lineto
87.0 -293.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -256.0 moveto
112.0 -256.0 111.0 -257.6666666666667 111.0 -261.0 curveto
111.0 -272.0 lineto
183.0 -272.0 lineto
183.0 -261.0 lineto
183.0 -257.6666666666667 182.0 -256.0 180.0 -256.0 curveto
114.0 -256.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -256.0 moveto
112.0 -256.0 111.0 -257.6666666666667 111.0 -261.0 curveto
111.0 -272.0 lineto
183.0 -272.0 lineto
183.0 -261.0 lineto
183.0 -257.6666666666667 182.0 -256.0 180.0 -256.0 curveto
114.0 -256.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -275.0 moveto
111.0 -290.0 lineto
183.0 -290.0 lineto
183.0 -275.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -275.0 moveto
111.0 -290.0 lineto
183.0 -290.0 lineto
183.0 -275.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -293.0 moveto
111.0 -310.0 lineto
183.0 -310.0 lineto
183.0 -293.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -293.0 moveto
111.0 -310.0 lineto
183.0 -310.0 lineto
183.0 -293.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -256.0 moveto
208.0 -256.0 207.0 -257.6666666666667 207.0 -261.0 curveto
207.0 -272.0 lineto
279.0 -272.0 lineto
279.0 -261.0 lineto
279.0 -257.6666666666667 278.0 -256.0 276.0 -256.0 curveto
210.0 -256.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -256.0 moveto
208.0 -256.0 207.0 -257.6666666666667 207.0 -261.0 curveto
207.0 -272.0 lineto
279.0 -272.0 lineto
279.0 -261.0 lineto
279.0 -257.6666666666667 278.0 -256.0 276.0 -256.0 curveto
210.0 -256.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -275.0 moveto
207.0 -290.0 lineto
279.0 -290.0 lineto
279.0 -275.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -275.0 moveto
207.0 -290.0 lineto
279.0 -290.0 lineto
279.0 -275.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -293.0 moveto
207.0 -310.0 lineto
279.0 -310.0 lineto
279.0 -293.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -293.0 moveto
207.0 -310.0 lineto
279.0 -310.0 lineto
279.0 -293.0 lineto
closepath
stroke
newpath
51.0 -81.0 moveto
48.0 -90.0 lineto
54.0 -90.0 lineto
closepath
fill
newpath
147.0 -81.0 moveto
144.0 -90.0 lineto
150.0 -90.0 lineto
closepath
fill
newpath
243.0 -81.0 moveto
240.0 -90.0 lineto
246.0 -90.0 lineto
closepath
fill
newpath
144.0 -117.0 moveto
147.0 -126.0 lineto
150.0 -117.0 lineto
closepath
fill
newpath
147.0 -207.0 moveto
144.0 -216.0 lineto
150.0 -216.0 lineto
closepath
fill
newpath
48.0 -243.0 moveto
51.0 -252.0 lineto
54.0 -243.0 lineto
closepath
fill
newpath
144.0 -243.0 moveto
147.0 -252.0 lineto
150.0 -243.0 lineto
closepath
fill
newpath
240.0 -243.0 moveto
243.0 -252.0 lineto
246.0 -243.0 lineto
closepath
fill
newpath
51.0 -85.0 moveto
51.0 -99.0 lineto
51.0 -101.66666666666667 52.0 -103.0 54.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -85.0 moveto
147.0 -103.0 lineto
stroke
newpath
243.0 -85.0 moveto
243.0 -99.0 lineto
243.0 -101.66666666666667 242.0 -103.0 240.0 -103.0 curveto
147.0 -103.0 lineto
147.0 -103.0 lineto
stroke
newpath
147.0 -121.0 moveto
147.0 -103.0 lineto
stroke
newpath
147.0 -211.0 moveto
147.0 -229.0 lineto
stroke
newpath
51.0 -247.0 moveto
51.0 -234.0 lineto
51.0 -230.66666666666666 52.0 -229.0 54.0 -229.0 curveto
147.0 -229.0 lineto
147.0 -229.0 lineto
stroke
newpath
147.0 -247.0 moveto
147.0 -229.0 lineto
stroke
newpath
243.0 -247.0 moveto
243.0 -234.0 lineto
243.0 -230.66666666666666 242.0 -229.0 240.0 -229.0 curveto
147.0 -229.0 lineto
147.0 -229.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
34.0 -35.0 moveto
(Client) show
130.0 -35.0 moveto
(Client) show
226.0 -35.0 moveto
(Client) show
38.0 -53.0 moveto
(Retry) show
134.0 -53.0 moveto
(Retry) show
230.0 -53.0 moveto
(Retry) show
43.0 -71.0 moveto
(REQ) show
139.0 -71.0 moveto
(REQ) show
235.0 -71.0 moveto
(REQ) show
128.0 -143.0 moveto
(ROUTER) show
133.0 -161.0 moveto
(Queue) show
122.0 -179.0 moveto
(Heartbeat) show
128.0 -197.0 moveto
(ROUTER) show
31.0 -269.0 moveto
(DEALER) show
127.0 -269.0 moveto
(DEALER) show
223.0 -269.0 moveto
(DEALER) show
26.0 -287.0 moveto
(Heartbeat) show
122.0 -287.0 moveto
(Heartbeat) show
218.0 -287.0 moveto
(Heartbeat) show
36.0 -305.0 moveto
(Worker) show
132.0 -305.0 moveto
(Worker) show
228.0 -305.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4386 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4386 a -2 4552 a
SDict begin H.S end
 -2 4552
a -2 4552 a
SDict begin 13 H.A end
 -2 4552 a -2 4552 a
SDict begin [/View [/XYZ H.V]/Dest (0:2134) cvn /DEST pdfmark end
 -2 4552 a 396 4660 a
Fk(W)-7 b(e')l(re)21 b(still)g(using)f(the)g(Lazy)g(Pirate)g(client.)g
(Here)g(is)h(the)f(P)o(aranoid)f(Pirate)h(queue)f(de)n(vice:)-2
4678 y
SDict begin H.S end
 -2 4678 a -2 4678 a
SDict begin 13 H.A end
 -2 4678 a -2 4678 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c) cvn /DEST pdfmark
end
 -2 4678
a 396 4861 a Fg(Example)i(4-6.)e(P)o(aranoid)g(Pirate)h(queue)h
(\(ppqueue.c\))-2 4961 y
SDict begin H.S end
 -2 4961 a -2 4961 a
SDict begin 11.7 H.A end
 -2 4961
a -2 4961 a
SDict begin [/View [/XYZ H.V]/Dest (0:2137) cvn /DEST pdfmark end
 -2 4961 a 396 5041 a Fe(//)396 5138 y(//)90
b(Paranoid)43 b(Pirate)h(queue)p Black 3759 5569 a Ff(160)p
Black eop end
%%Page: 161 174
TeXDict begin 161 173 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.161) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(//)396 170 y(#include)44 b("czmq.h")396
364 y(#define)g(HEARTBEAT_LIVENESS)87 b(3)313 b(//)90
b(3-5)44 b(is)g(reasonable)396 461 y(#define)g(HEARTBEAT_INTERVAL)87
b(1000)178 b(//)90 b(msecs)396 655 y(//)g(Paranoid)43
b(Pirate)h(Protocol)f(constants)396 752 y(#define)h(PPP_READY)312
b("\\001")268 b(//)90 b(Signals)43 b(worker)h(is)h(ready)396
850 y(#define)f(PPP_HEARTBEAT)132 b("\\002")268 b(//)90
b(Signals)43 b(worker)h(heartbeat)-2 1027 y
SDict begin H.S end
 -2 1027 a
-2 1027 a
SDict begin 13 H.A end
 -2 1027 a -2 1027 a
SDict begin [/View [/XYZ H.V]/Dest (0:2138) cvn /DEST pdfmark end
 -2 1027 a 396 1124 a Fk(Here)20
b(we)h(de\002ne)f(the)g(w)o(ork)o(er)f(class;)i(a)g(structure)e(and)h
(a)g(set)h(of)f(functions)f(that)h(as)h(constructor)m(,)d(destructor)m
(,)g(and)396 1231 y(methods)h(on)h(w)o(ork)o(er)f(objects:)-2
1249 y
SDict begin H.S end
 -2 1249 a -2 1249 a
SDict begin 13 H.A end
 -2 1249 a -2 1249 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-1) cvn /DEST pdfmark
end
 -2 1249
a 396 1433 a Fg(Example)i(4-7.)e(P)o(aranoid)g(Pirate)h(queue)h
(\(ppqueue.c\))f(-)g(w)o(ork)o(er)h(class)f(structur)o(e)-2
1533 y
SDict begin H.S end
 -2 1533 a -2 1533 a
SDict begin 11.7 H.A end
 -2 1533 a -2 1533 a
SDict begin [/View [/XYZ H.V]/Dest (0:2141) cvn /DEST pdfmark end
 -2 1533
a 396 1710 a Fe(typedef)44 b(struct)g({)576 1807 y(zframe_t)979
1820 y(*)1024 1807 y(address;)447 b(//)89 b(Address)44
b(of)g(worker)576 1904 y(char)800 1917 y(*)845 1904 y(identity;)581
b(//)89 b(Printable)44 b(identity)576 2001 y(int64_t)f(expiry;)582
b(//)89 b(Expires)44 b(at)g(this)h(time)396 2099 y(})g(worker_t;)396
2293 y(//)90 b(Construct)43 b(new)h(worker)396 2390 y(static)g
(worker_t)1114 2403 y(*)396 2487 y(s_worker_new)f(\(zframe_t)1427
2500 y(*)1472 2487 y(address\))396 2584 y({)576 2681
y(worker_t)979 2694 y(*)1024 2681 y(self)h(=)h(\(worker_t)1786
2694 y(*)1831 2681 y(\))g(zmalloc)e(\(sizeof)h(\(worker_t\)\);)576
2779 y(self->address)e(=)j(address;)576 2876 y(self->identity)d(=)j
(zframe_strdup)d(\(address\);)576 2973 y(self->expiry)g(=)j
(zclock_time)e(\(\))i(+)f(HEARTBEAT_INTERVAL)2862 2986
y(*)2952 2973 y(HEARTBEAT_LIVENESS;)576 3070 y(return)f(self;)396
3167 y(})396 3361 y(//)90 b(Destroy)43 b(specified)h(worker)f(object,)h
(including)f(identity)h(frame.)396 3459 y(static)g(void)396
3556 y(s_worker_destroy)e(\(worker_t)1607 3569 y(**)1697
3556 y(self_p\))396 3653 y({)576 3750 y(assert)h(\(self_p\);)576
3847 y(if)h(\()755 3860 y(*)800 3847 y(self_p\))f({)755
3944 y(worker_t)1158 3957 y(*)1203 3944 y(self)h(=)1517
3957 y(*)1562 3944 y(self_p;)755 4041 y(zframe_destroy)e
(\(&self->address\);)755 4138 y(free)i(\(self->identity\);)755
4236 y(free)g(\(self\);)755 4346 y(*)800 4333 y(self_p)g(=)g(NULL;)576
4430 y(})396 4527 y(})-2 4701 y
SDict begin H.S end
 -2 4701 a -2 4701 a
SDict begin 13 H.A end
 -2
4701 a -2 4701 a
SDict begin [/View [/XYZ H.V]/Dest (0:2142) cvn /DEST pdfmark end
 -2 4701 a 396 4801 a Fk(The)20 b(ready)f(method)g
(puts)h(a)h(w)o(ork)o(er)e(to)h(the)h(end)e(of)h(the)g(ready)g(list:)-2
4819 y
SDict begin H.S end
 -2 4819 a -2 4819 a
SDict begin 13 H.A end
 -2 4819 a -2 4819 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-2) cvn /DEST pdfmark
end
 -2 4819
a Black 3759 5569 a Ff(161)p Black eop end
%%Page: 162 175
TeXDict begin 162 174 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.162) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-8.)e(P)o(aranoid)g(Pirate)h(queue)h
(\(ppqueue.c\))f(-)g(w)o(ork)o(er)h(r)o(eady)e(method)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2145) cvn /DEST pdfmark end
 -2 172 a 396
350 a Fe(static)44 b(void)396 447 y(s_worker_ready)f(\(worker_t)1517
460 y(*)1562 447 y(self,)h(zlist_t)2190 460 y(*)2235
447 y(workers\))396 544 y({)576 641 y(worker_t)979 654
y(*)1024 641 y(worker)g(=)g(\(worker_t)1876 654 y(*)1921
641 y(\))g(zlist_first)f(\(workers\);)576 738 y(while)h(\(worker\))f({)
755 835 y(if)h(\(streq)g(\(self->identity,)e(worker->identity\)\))g({)
934 933 y(zlist_remove)h(\(workers,)g(worker\);)934 1030
y(s_worker_destroy)f(\(&worker\);)934 1127 y(break;)755
1224 y(})755 1321 y(worker)i(=)g(\(worker_t)1607 1334
y(*)1652 1321 y(\))g(zlist_next)f(\(workers\);)576 1418
y(})576 1515 y(zlist_append)f(\(workers,)i(self\);)396
1613 y(})-2 1787 y
SDict begin H.S end
 -2 1787 a -2 1787 a
SDict begin 13 H.A end
 -2 1787 a -2 1787
a
SDict begin [/View [/XYZ H.V]/Dest (0:2146) cvn /DEST pdfmark end
 -2 1787 a 396 1887 a Fk(The)20 b(ne)o(xt)g(method)e(returns)i(the)g
(ne)o(xt)f(a)n(v)n(ailable)h(w)o(ork)o(er)f(address:)-2
1888 y
SDict begin H.S end
 -2 1888 a -2 1888 a
SDict begin 13 H.A end
 -2 1888 a -2 1888 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-3) cvn /DEST pdfmark
end
 -2 1888
a 396 2088 a Fg(Example)i(4-9.)e(P)o(aranoid)g(Pirate)h(queue)h
(\(ppqueue.c\))f(-)g(get)g(next)g(a)n(v)o(ailable)f(w)o(ork)o(er)-2
2188 y
SDict begin H.S end
 -2 2188 a -2 2188 a
SDict begin 11.7 H.A end
 -2 2188 a -2 2188 a
SDict begin [/View [/XYZ H.V]/Dest (0:2149) cvn /DEST pdfmark end
 -2 2188
a 396 2365 a Fe(static)44 b(zframe_t)1114 2378 y(*)396
2462 y(s_workers_next)f(\(zlist_t)1472 2475 y(*)1517
2462 y(workers\))396 2559 y({)576 2657 y(worker_t)979
2670 y(*)1024 2657 y(worker)h(=)g(zlist_pop)g(\(workers\);)576
2754 y(assert)f(\(worker\);)576 2851 y(zframe_t)979 2864
y(*)1024 2851 y(frame)h(=)h(worker->address;)576 2948
y(worker->address)d(=)j(NULL;)576 3045 y(s_worker_destroy)d
(\(&worker\);)576 3142 y(return)h(frame;)396 3239 y(})-2
3414 y
SDict begin H.S end
 -2 3414 a -2 3414 a
SDict begin 13 H.A end
 -2 3414 a -2 3414 a
SDict begin [/View [/XYZ H.V]/Dest (0:2150) cvn /DEST pdfmark end
 -2 3414
a 396 3513 a Fk(The)20 b(pur)o(ge)e(method)h(looks)h(for)f(and)h(kills)
h(e)o(xpired)d(w)o(ork)o(ers.)i(W)-7 b(e)21 b(hold)e(w)o(ork)o(ers)h
(from)f(oldest)h(to)g(most)h(recent,)e(so)396 3621 y(we)i(stop)f(at)h
(the)f(\002rst)h(ali)n(v)o(e)f(w)o(ork)o(er:)-2 3639
y
SDict begin H.S end
 -2 3639 a -2 3639 a
SDict begin 13 H.A end
 -2 3639 a -2 3639 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-4) cvn /DEST pdfmark
end
 -2 3639 a 396
3823 a Fg(Example)h(4-10.)d(P)o(aranoid)i(Pirate)f(queue)i
(\(ppqueue.c\))f(-)h(pur)o(ge)f(expir)o(ed)g(w)o(ork)o(ers)-2
3922 y
SDict begin H.S end
 -2 3922 a -2 3922 a
SDict begin 11.7 H.A end
 -2 3922 a -2 3922 a
SDict begin [/View [/XYZ H.V]/Dest (0:2153) cvn /DEST pdfmark end
 -2 3922
a 396 4100 a Fe(static)44 b(void)396 4197 y(s_workers_purge)f
(\(zlist_t)1517 4210 y(*)1562 4197 y(workers\))396 4294
y({)576 4391 y(worker_t)979 4404 y(*)1024 4391 y(worker)h(=)g
(\(worker_t)1876 4404 y(*)1921 4391 y(\))g(zlist_first)f(\(workers\);)
576 4488 y(while)h(\(worker\))f({)755 4586 y(if)h(\(zclock_time)f(\(\))
i(<)f(worker->expiry\))934 4683 y(break;)627 b(//)89
b(Worker)44 b(is)h(alive,)e(we're)h(done)h(here)755 4877
y(zlist_remove)e(\(workers,)g(worker\);)755 4974 y(s_worker_destroy)f
(\(&worker\);)755 5071 y(worker)i(=)g(\(worker_t)1607
5084 y(*)1652 5071 y(\))g(zlist_first)f(\(workers\);)576
5168 y(})p Black 3759 5569 a Ff(162)p Black eop end
%%Page: 163 176
TeXDict begin 163 175 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.163) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(})-2 247 y
SDict begin H.S end
 -2 247 a -2 247 a
SDict begin 13 H.A end
 -2 247
a -2 247 a
SDict begin [/View [/XYZ H.V]/Dest (0:2154) cvn /DEST pdfmark end
 -2 247 a 396 346 a Fk(The)g(main)g(task)g(is)i(an)e(LR)m(U)g
(queue)f(with)i(heartbeating)d(on)h(w)o(ork)o(ers)h(so)h(we)f(can)g
(detect)g(crashed)f(or)h(block)o(ed)396 454 y(w)o(ork)o(er)f(tasks:)-2
455 y
SDict begin H.S end
 -2 455 a -2 455 a
SDict begin 13 H.A end
 -2 455 a -2 455 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-5) cvn /DEST pdfmark
end
 -2 455 a 396
656 a Fg(Example)i(4-11.)d(P)o(aranoid)i(Pirate)f(queue)i
(\(ppqueue.c\))f(-)h(main)f(task)-2 756 y
SDict begin H.S end
 -2 756 a -2
756 a
SDict begin 11.7 H.A end
 -2 756 a -2 756 a
SDict begin [/View [/XYZ H.V]/Dest (0:2157) cvn /DEST pdfmark end
 -2 756 a 396 933 a Fe(int)45
b(main)f(\(void\))396 1030 y({)576 1127 y(zctx_t)889
1140 y(*)934 1127 y(ctx)h(=)f(zctx_new)g(\(\);)576 1224
y(void)800 1237 y(*)845 1224 y(frontend)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_ROUTER\);)576 1322 y(void)800 1335 y(*)845 1322
y(backend)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
1419 y(zsocket_bind)e(\(frontend,)i("tcp://)1967 1432
y(*)2012 1419 y(:5555"\);)176 b(//)90 b(For)44 b(clients)576
1516 y(zsocket_bind)e(\(backend,)89 b("tcp://)1967 1529
y(*)2012 1516 y(:5556"\);)176 b(//)90 b(For)44 b(workers)576
1710 y(//)89 b(List)44 b(of)h(available)e(workers)576
1807 y(zlist_t)934 1820 y(*)979 1807 y(workers)h(=)g(zlist_new)g(\(\);)
576 2001 y(//)89 b(Send)44 b(out)g(heartbeats)g(at)g(regular)g
(intervals)576 2099 y(uint64_t)f(heartbeat_at)g(=)i(zclock_time)e(\(\))
h(+)h(HEARTBEAT_INTERVAL;)576 2293 y(while)f(\(true\))f({)755
2390 y(zmq_pollitem_t)f(items)i([])h(=)g({)934 2487 y({)g(backend,)88
b(0,)45 b(ZMQ_POLLIN,)e(0)h(},)934 2584 y({)h(frontend,)e(0,)i
(ZMQ_POLLIN,)e(0)h(})755 2681 y(};)755 2779 y(//)89 b(Poll)44
b(frontend)g(only)g(if)h(we)f(have)g(available)g(workers)755
2876 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g(zlist_size)f(\(workers\)?)g
(2:)h(1,)934 2973 y(HEARTBEAT_INTERVAL)1786 2986 y(*)1876
2973 y(ZMQ_POLL_MSEC\);)755 3070 y(if)g(\(rc)h(==)f(-1\))934
3167 y(break;)627 b(//)89 b(Interrupted)755 3361 y(//)g(Handle)44
b(worker)g(activity)f(on)i(backend)755 3459 y(if)f(\(items)g
([0].revents)f(&)i(ZMQ_POLLIN\))e({)934 3556 y(//)90
b(Use)44 b(worker)g(address)f(for)i(LRU)f(routing)934
3653 y(zmsg_t)1248 3666 y(*)1293 3653 y(msg)g(=)h(zmsg_recv)e
(\(backend\);)934 3750 y(if)i(\(!msg\))1114 3847 y(break;)447
b(//)89 b(Interrupted)934 4041 y(//)h(Any)44 b(sign)g(of)h(life)f(from)
g(worker)g(means)g(it's)g(ready)934 4138 y(zframe_t)1338
4151 y(*)1383 4138 y(address)f(=)i(zmsg_unwrap)e(\(msg\);)934
4236 y(worker_t)1338 4249 y(*)1383 4236 y(worker)g(=)i(s_worker_new)e
(\(address\);)934 4333 y(s_worker_ready)g(\(worker,)g(workers\);)934
4527 y(//)90 b(Validate)43 b(control)h(message,)f(or)i(return)f(reply)g
(to)g(client)934 4624 y(if)h(\(zmsg_size)e(\(msg\))h(==)g(1\))h({)1114
4721 y(zframe_t)1517 4734 y(*)1562 4721 y(frame)f(=)h(zmsg_first)e
(\(msg\);)1114 4818 y(if)h(\(memcmp)g(\(zframe_data)f(\(frame\),)g
(PPP_READY,)g(1\))1114 4916 y(&&)89 b(memcmp)44 b(\(zframe_data)f
(\(frame\),)g(PPP_HEARTBEAT,)g(1\)\))h({)1293 5013 y(printf)g(\("E:)g
(invalid)g(message)f(from)h(worker"\);)1293 5110 y(zmsg_dump)f
(\(msg\);)p Black 3759 5569 a Ff(163)p Black eop end
%%Page: 164 177
TeXDict begin 164 176 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.164) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 1114 72 a Fe(})1114 170 y(zmsg_destroy)42 b(\(&msg\);)934
267 y(})934 364 y(else)1114 461 y(zmsg_send)h(\(&msg,)h(frontend\);)755
558 y(})755 655 y(if)g(\(items)g([1].revents)f(&)i(ZMQ_POLLIN\))e({)934
752 y(//)90 b(Now)44 b(get)g(next)g(client)g(request,)g(route)g(to)g
(next)g(worker)934 850 y(zmsg_t)1248 863 y(*)1293 850
y(msg)g(=)h(zmsg_recv)e(\(frontend\);)934 947 y(if)i(\(!msg\))1114
1044 y(break;)447 b(//)89 b(Interrupted)934 1141 y(zmsg_push)44
b(\(msg,)g(s_workers_next)e(\(workers\)\);)934 1238 y(zmsg_send)i
(\(&msg,)f(backend\);)755 1335 y(})-2 1510 y
SDict begin H.S end
 -2 1510
a -2 1510 a
SDict begin 13 H.A end
 -2 1510 a -2 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:2158) cvn /DEST pdfmark end
 -2 1510 a 396 1609 a
Fk(W)-7 b(e)22 b(handle)d(heartbeating)f(after)i(an)o(y)f(sock)o(et)h
(acti)n(vity)-5 b(.)19 b(First)i(we)g(send)f(heartbeats)f(to)h(an)o(y)g
(idle)g(w)o(ork)o(ers)g(if)g(it')-5 b(s)21 b(time.)396
1717 y(Then)f(we)g(pur)o(ge)e(an)o(y)i(dead)f(w)o(ork)o(ers:)-2
1735 y
SDict begin H.S end
 -2 1735 a -2 1735 a
SDict begin 13 H.A end
 -2 1735 a -2 1735 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppqueue-c-6) cvn /DEST pdfmark
end
 -2 1735
a 396 1918 a Fg(Example)i(4-12.)d(P)o(aranoid)i(Pirate)f(queue)i
(\(ppqueue.c\))f(-)h(handle)f(heartbeating)-2 2018 y
SDict begin H.S end

-2 2018 a -2 2018 a
SDict begin 11.7 H.A end
 -2 2018 a -2 2018 a
SDict begin [/View [/XYZ H.V]/Dest (0:2161) cvn /DEST pdfmark end
 -2 2018 a 755
2196 a Fe(if)44 b(\(zclock_time)f(\(\))i(>=)f(heartbeat_at\))f({)934
2293 y(worker_t)1338 2306 y(*)1383 2293 y(worker)g(=)i(\(worker_t)2234
2306 y(*)2279 2293 y(\))g(zlist_first)e(\(workers\);)934
2390 y(while)h(\(worker\))g({)1114 2487 y(zframe_send)f
(\(&worker->address,)e(backend,)1696 2584 y(ZFRAME_REUSE)i(+)i
(ZFRAME_MORE\);)1114 2681 y(zframe_t)1517 2694 y(*)1562
2681 y(frame)f(=)h(zframe_new)e(\(PPP_HEARTBEAT,)f(1\);)1114
2779 y(zframe_send)h(\(&frame,)g(backend,)h(0\);)1114
2876 y(worker)f(=)i(\(worker_t)1965 2889 y(*)2010 2876
y(\))g(zlist_next)e(\(workers\);)934 2973 y(})934 3070
y(heartbeat_at)g(=)i(zclock_time)e(\(\))h(+)h(HEARTBEAT_INTERVAL;)755
3167 y(})755 3264 y(s_workers_purge)d(\(workers\);)576
3361 y(})576 3556 y(//)89 b(When)44 b(we're)g(done,)g(clean)g(up)h
(properly)576 3653 y(while)f(\(zlist_size)f(\(workers\)\))g({)755
3750 y(worker_t)1158 3763 y(*)1203 3750 y(worker)h(=)h(\(worker_t)2055
3763 y(*)2100 3750 y(\))g(zlist_pop)e(\(workers\);)755
3847 y(s_worker_destroy)f(\(&worker\);)576 3944 y(})576
4041 y(zlist_destroy)g(\(&workers\);)576 4138 y(zctx_destroy)g
(\(&ctx\);)576 4236 y(return)h(0;)396 4333 y(})-2 4507
y
SDict begin H.S end
 -2 4507 a -2 4507 a
SDict begin 13 H.A end
 -2 4507 a -2 4507 a
SDict begin [/View [/XYZ H.V]/Dest (0:2162) cvn /DEST pdfmark end
 -2 4507 a 396
4607 a Fk(The)20 b(queue)f(e)o(xtends)g(the)h(LR)m(U)h(pattern)e(with)i
(heartbeating)d(of)i(w)o(ork)o(ers.)f(Heartbeating)f(is)k(one)d(of)h
(those)g(')-5 b(simple')396 4715 y(things)20 b(that)g(can)g(be)g
(subtle)h(to)f(get)g(right.)f(I')o(ll)i(e)o(xplain)e(more)g(about)g
(that)i(in)f(a)h(second.)-2 4899 y
SDict begin H.S end
 -2 4899 a -2 4899
a
SDict begin 13 H.A end
 -2 4899 a -2 4899 a
SDict begin [/View [/XYZ H.V]/Dest (0:2163) cvn /DEST pdfmark end
 -2 4899 a 396 4989 a Fk(Here)f(is)h(the)g(P)o
(aranoid)d(Pirate)j(w)o(ork)o(er:)-2 4990 y
SDict begin H.S end
 -2 4990 a
-2 4990 a
SDict begin 13 H.A end
 -2 4990 a -2 4990 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppworker-c) cvn /DEST pdfmark
end
 -2 4990 a Black 3759 5569
a Ff(164)p Black eop end
%%Page: 165 178
TeXDict begin 165 177 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.165) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-13.)d(P)o(aranoid)i(Pirate)f(w)o(ork)o
(er)i(\(ppw)o(ork)o(er)-8 b(.c\))-2 172 y
SDict begin H.S end
 -2 172 a -2
172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2166) cvn /DEST pdfmark end
 -2 172 a 396 253 a Fe(//)396
350 y(//)90 b(Paranoid)43 b(Pirate)h(worker)396 447 y(//)396
544 y(#include)g("czmq.h")396 738 y(#define)g(HEARTBEAT_LIVENESS)87
b(3)313 b(//)90 b(3-5)44 b(is)g(reasonable)396 835 y(#define)g
(HEARTBEAT_INTERVAL)87 b(1000)178 b(//)90 b(msecs)396
933 y(#define)44 b(INTERVAL_INIT)312 b(1000)178 b(//)90
b(Initial)43 b(reconnect)396 1030 y(#define)h(INTERVAL_MAX)312
b(32000)178 b(//)90 b(After)44 b(exponential)f(backoff)396
1224 y(//)90 b(Paranoid)43 b(Pirate)h(Protocol)f(constants)396
1321 y(#define)h(PPP_READY)312 b("\\001")268 b(//)90
b(Signals)43 b(worker)h(is)h(ready)396 1418 y(#define)f(PPP_HEARTBEAT)
132 b("\\002")268 b(//)90 b(Signals)43 b(worker)h(heartbeat)396
1613 y(//)90 b(Helper)43 b(function)h(that)g(returns)g(a)g(new)h
(configured)e(socket)396 1710 y(//)90 b(connected)43
b(to)h(the)h(Paranoid)e(Pirate)h(queue)396 1904 y(static)g(void)934
1917 y(*)396 2001 y(s_worker_socket)f(\(zctx_t)1472 2014
y(*)1517 2001 y(ctx\))h({)576 2098 y(void)800 2111 y(*)845
2098 y(worker)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)576
2195 y(zsocket_connect)e(\(worker,)h("tcp://localhost:5556"\);)576
2390 y(//)89 b(Tell)44 b(queue)g(we're)g(ready)g(for)g(work)576
2487 y(printf)f(\("I:)i(worker)e(ready\\n"\);)576 2584
y(zframe_t)979 2597 y(*)1024 2584 y(frame)h(=)h(zframe_new)e
(\(PPP_READY,)g(1\);)576 2681 y(zframe_send)g(\(&frame,)g(worker,)h
(0\);)576 2875 y(return)f(worker;)396 2972 y(})-2 3147
y
SDict begin H.S end
 -2 3147 a -2 3147 a
SDict begin 13 H.A end
 -2 3147 a -2 3147 a
SDict begin [/View [/XYZ H.V]/Dest (0:2167) cvn /DEST pdfmark end
 -2 3147 a 396
3246 a Fk(W)-7 b(e)22 b(ha)n(v)o(e)d(a)i(single)f(task,)g(which)g
(implements)f(the)h(w)o(ork)o(er)f(side)i(of)f(the)g(P)o(aranoid)f
(Pirate)h(Protocol)f(\(PPP\).)i(The)396 3354 y(interesting)f(parts)g
(here)f(are)h(the)h(heartbeating,)d(which)h(lets)i(the)f(w)o(ork)o(er)g
(detect)g(if)g(the)g(queue)f(has)i(died,)e(and)396 3462
y(vice-v)o(ersa:)-2 3463 y
SDict begin H.S end
 -2 3463 a -2 3463 a
SDict begin 13 H.A end
 -2 3463
a -2 3463 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppworker-c-1) cvn /DEST pdfmark
end
 -2 3463 a 396 3664 a Fg(Example)i(4-14.)d(P)o(aranoid)i
(Pirate)f(w)o(ork)o(er)i(\(ppw)o(ork)o(er)-8 b(.c\))19
b(-)h(main)h(task)-2 3763 y
SDict begin H.S end
 -2 3763 a -2 3763 a
SDict begin 11.7 H.A end
 -2 3763
a -2 3763 a
SDict begin [/View [/XYZ H.V]/Dest (0:2170) cvn /DEST pdfmark end
 -2 3763 a 396 3941 a Fe(int)45 b(main)f(\(void\))396
4038 y({)576 4135 y(zctx_t)889 4148 y(*)934 4135 y(ctx)h(=)f(zctx_new)g
(\(\);)576 4232 y(void)800 4245 y(*)845 4232 y(worker)f(=)i
(s_worker_socket)d(\(ctx\);)576 4427 y(//)89 b(If)44
b(liveness)g(hits)g(zero,)g(queue)g(is)h(considered)e(disconnected)576
4524 y(size_t)g(liveness)h(=)h(HEARTBEAT_LIVENESS;)576
4621 y(size_t)e(interval)h(=)h(INTERVAL_INIT;)576 4815
y(//)89 b(Send)44 b(out)g(heartbeats)g(at)g(regular)g(intervals)576
4912 y(uint64_t)f(heartbeat_at)g(=)i(zclock_time)e(\(\))h(+)h
(HEARTBEAT_INTERVAL;)576 5107 y(srandom)e(\(\(unsigned\))g(time)h
(\(NULL\)\);)p Black 3759 5569 a Ff(165)p Black eop end
%%Page: 166 179
TeXDict begin 166 178 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.166) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(int)44 b(cycles)g(=)g(0;)576 170 y(while)g(\(true\))f
({)755 267 y(zmq_pollitem_t)f(items)i([])h(=)g({)f({)h(worker,)88
b(0,)45 b(ZMQ_POLLIN,)e(0)i(})f(};)755 364 y(int)g(rc)h(=)f(zmq_poll)g
(\(items,)g(1,)g(HEARTBEAT_INTERVAL)2907 377 y(*)2997
364 y(ZMQ_POLL_MSEC\);)755 461 y(if)g(\(rc)h(==)f(-1\))934
558 y(break;)627 b(//)89 b(Interrupted)755 752 y(if)44
b(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934 850
y(//)90 b(Get)44 b(message)934 947 y(//)90 b(-)44 b(3-part)g(envelope)g
(+)g(content)g(->)g(request)934 1044 y(//)90 b(-)44 b(1-part)g
(HEARTBEAT)f(->)i(heartbeat)934 1141 y(zmsg_t)1248 1154
y(*)1293 1141 y(msg)f(=)h(zmsg_recv)e(\(worker\);)934
1238 y(if)i(\(!msg\))1114 1335 y(break;)447 b(//)89 b(Interrupted)-2
1513 y
SDict begin H.S end
 -2 1513 a -2 1513 a
SDict begin 13 H.A end
 -2 1513 a -2 1513 a
SDict begin [/View [/XYZ H.V]/Dest (0:2171) cvn /DEST pdfmark end
 -2 1513
a 396 1609 a Fk(T)-7 b(o)21 b(test)g(the)f(rob)n(ustness)g(of)f(the)i
(queue)e(implementation)f(we)i(simulate)g(v)n(arious)f(typical)h
(problems,)f(such)h(as)g(the)396 1717 y(w)o(ork)o(er)f(crashing,)g(or)h
(running)e(v)o(ery)h(slo)n(wly)-5 b(.)20 b(W)-7 b(e)21
b(do)f(this)h(after)e(a)i(fe)n(w)f(c)o(ycles)g(so)h(that)f(the)g
(architecture)f(can)h(get)g(up)396 1825 y(and)g(running)e(\002rst:)-2
1843 y
SDict begin H.S end
 -2 1843 a -2 1843 a
SDict begin 13 H.A end
 -2 1843 a -2 1843 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppworker-c-2) cvn /DEST pdfmark
end
 -2 1843
a 396 2026 a Fg(Example)j(4-15.)d(P)o(aranoid)i(Pirate)f(w)o(ork)o(er)i
(\(ppw)o(ork)o(er)-8 b(.c\))19 b(-)h(simulating)h(pr)o(oblems)-2
2126 y
SDict begin H.S end
 -2 2126 a -2 2126 a
SDict begin 11.7 H.A end
 -2 2126 a -2 2126 a
SDict begin [/View [/XYZ H.V]/Dest (0:2174) cvn /DEST pdfmark end
 -2 2126
a 1114 2304 a Fe(cycles++;)1114 2401 y(if)44 b(\(cycles)g(>)g(3)h(&&)g
(randof)e(\(5\))i(==)f(0\))h({)1293 2498 y(printf)f(\("I:)g(simulating)
f(a)i(crash\\n"\);)1293 2595 y(zmsg_destroy)e(\(&msg\);)1293
2692 y(break;)1114 2789 y(})1114 2887 y(else)1114 2984
y(if)h(\(cycles)g(>)g(3)h(&&)g(randof)e(\(5\))i(==)f(0\))h({)1293
3081 y(printf)f(\("I:)g(simulating)f(CPU)h(overload\\n"\);)1293
3178 y(sleep)g(\(3\);)1293 3275 y(if)g(\(zctx_interrupted\))1472
3372 y(break;)1114 3469 y(})1114 3566 y(printf)f(\("I:)i(normal)e
(reply\\n"\);)1114 3664 y(zmsg_send)g(\(&msg,)h(worker\);)1114
3761 y(liveness)f(=)i(HEARTBEAT_LIVENESS;)1114 3858 y(sleep)f(\(1\);)
627 b(//)89 b(Do)44 b(some)h(heavy)f(work)1114 3955 y(if)g
(\(zctx_interrupted\))1293 4052 y(break;)934 4149 y(})934
4246 y(else)-2 4414 y
SDict begin H.S end
 -2 4414 a -2 4414 a
SDict begin 13 H.A end
 -2 4414 a -2
4414 a
SDict begin [/View [/XYZ H.V]/Dest (0:2175) cvn /DEST pdfmark end
 -2 4414 a 396 4520 a Fk(When)20 b(we)h(get)f(a)h(heartbeat)e
(message)h(from)f(the)h(queue,)f(it)i(means)f(the)g(queue)f(w)o(as)i
(\(recently\))d(ali)n(v)o(e,)i(so)g(reset)h(our)396 4628
y(li)n(v)o(eness)f(indicator:)-2 4629 y
SDict begin H.S end
 -2 4629 a -2
4629 a
SDict begin 13 H.A end
 -2 4629 a -2 4629 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppworker-c-3) cvn /DEST pdfmark
end
 -2 4629 a Black 3757 5569
a Ff(166)p Black eop end
%%Page: 167 180
TeXDict begin 167 179 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.167) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-16.)d(P)o(aranoid)i(Pirate)f(w)o(ork)o
(er)i(\(ppw)o(ork)o(er)-8 b(.c\))19 b(-)h(handle)h(heartbeats)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2178) cvn /DEST pdfmark end
 -2 172 a 1114
253 a Fe(zframe_t)1517 266 y(*)1562 253 y(frame)44 b(=)h(zmsg_first)e
(\(msg\);)1114 350 y(if)h(\(memcmp)g(\(zframe_data)f(\(frame\),)g
(PPP_HEARTBEAT,)g(1\))h(==)g(0\))1293 447 y(liveness)f(=)i
(HEARTBEAT_LIVENESS;)1114 544 y(else)f({)1293 641 y(printf)g(\("E:)g
(invalid)g(message\\n"\);)1293 738 y(zmsg_dump)f(\(msg\);)1114
835 y(})1114 933 y(zmsg_destroy)f(\(&msg\);)934 1030
y(})934 1127 y(else)i({)1114 1224 y(printf)f(\("E:)i(invalid)e
(message\\n"\);)1114 1321 y(zmsg_dump)g(\(msg\);)934
1418 y(})934 1515 y(interval)h(=)g(INTERVAL_INIT;)755
1613 y(})755 1710 y(else)-2 1877 y
SDict begin H.S end
 -2 1877 a -2 1877
a
SDict begin 13 H.A end
 -2 1877 a -2 1877 a
SDict begin [/View [/XYZ H.V]/Dest (0:2179) cvn /DEST pdfmark end
 -2 1877 a 396 1984 a Fk(If)20 b(the)h(queue)e
(hasn')o(t)g(sent)h(us)h(heartbeats)e(in)h(a)h(while,)f(destro)o(y)f
(the)i(sock)o(et)f(and)f(reconnect.)f(This)j(is)g(the)f(simplest)396
2092 y(most)g(brutal)g(w)o(ay)g(of)g(discarding)f(an)o(y)g(messages)h
(we)h(might)f(ha)n(v)o(e)f(sent)i(in)f(the)g(meantime:)-2
2110 y
SDict begin H.S end
 -2 2110 a -2 2110 a
SDict begin 13 H.A end
 -2 2110 a -2 2110 a
SDict begin [/View [/XYZ H.V]/Dest (0:ppworker-c-4) cvn /DEST pdfmark
end
 -2 2110
a 396 2293 a Fg(Example)h(4-17.)d(P)o(aranoid)i(Pirate)f(w)o(ork)o(er)i
(\(ppw)o(ork)o(er)-8 b(.c\))19 b(-)h(detecting)g(a)g(dead)g(queue)-2
2393 y
SDict begin H.S end
 -2 2393 a -2 2393 a
SDict begin 11.7 H.A end
 -2 2393 a -2 2393 a
SDict begin [/View [/XYZ H.V]/Dest (0:2182) cvn /DEST pdfmark end
 -2 2393
a 934 2473 a Fe(printf)44 b(\("W:)g(heartbeat)g(failure,)f(can't)h
(reach)g(queue\\n"\);)934 2570 y(printf)g(\("W:)g(reconnecting)f(in)i
(\045zd)f(msec...\\n",)f(interval\);)934 2667 y(zclock_sleep)g
(\(interval\);)934 2862 y(if)i(\(interval)e(<)i(INTERVAL_MAX\))1114
2959 y(interval)1517 2972 y(*)1562 2959 y(=)g(2;)934
3056 y(zsocket_destroy)e(\(ctx,)h(worker\);)934 3153
y(worker)g(=)h(s_worker_socket)d(\(ctx\);)934 3250 y(liveness)i(=)g
(HEARTBEAT_LIVENESS;)755 3347 y(})755 3542 y(//)89 b(Send)44
b(heartbeat)g(to)g(queue)g(if)h(it's)f(time)755 3639
y(if)g(\(zclock_time)f(\(\))i(>)f(heartbeat_at\))f({)934
3736 y(heartbeat_at)g(=)i(zclock_time)e(\(\))h(+)h(HEARTBEAT_INTERVAL;)
934 3833 y(printf)f(\("I:)g(worker)g(heartbeat\\n"\);)934
3930 y(zframe_t)1338 3943 y(*)1383 3930 y(frame)g(=)g(zframe_new)f
(\(PPP_HEARTBEAT,)g(1\);)934 4027 y(zframe_send)g(\(&frame,)h(worker,)f
(0\);)755 4124 y(})576 4222 y(})576 4319 y(zctx_destroy)f(\(&ctx\);)576
4416 y(return)h(0;)396 4513 y(})-2 4687 y
SDict begin H.S end
 -2 4687 a -2
4687 a
SDict begin 13 H.A end
 -2 4687 a -2 4687 a
SDict begin [/View [/XYZ H.V]/Dest (0:2183) cvn /DEST pdfmark end
 -2 4687 a 396 4787 a Fk(Some)20
b(comments)f(about)g(this)i(e)o(xample:)-2 4805 y
SDict begin H.S end
 -2
4805 a -2 4805 a
SDict begin 13 H.A end
 -2 4805 a -2 4805 a
SDict begin [/View [/XYZ H.V]/Dest (0:2184) cvn /DEST pdfmark end
 -2 4805 a -2 4815
a
SDict begin H.S end
 -2 4815 a -2 4815 a
SDict begin 13 H.A end
 -2 4815 a -2 4815 a
SDict begin [/View [/XYZ H.V]/Dest (0:2185) cvn /DEST pdfmark end
 -2 4815 a Black
396 4957 a Fj(\225)p Black 479 4957 a
SDict begin H.S end
 479 4957 a 479
4957 a
SDict begin 13 H.A end
 479 4957 a 479 4957 a
SDict begin [/View [/XYZ H.V]/Dest (0:2186) cvn /DEST pdfmark end
 479 4957 a Fk(The)f(code)g(includes)f
(simulation)g(of)h(f)o(ailures,)g(as)h(before.)d(This)j(mak)o(es)f(it)h
(\(a\))f(v)o(ery)f(hard)g(to)h(deb)n(ug,)f(and)h(\(b\))479
5065 y(dangerous)e(to)j(reuse.)e(When)h(you)g(w)o(ant)g(to)g(deb)n(ug)f
(this,)i(disable)f(the)g(f)o(ailure)f(simulation.)-2
5083 y
SDict begin H.S end
 -2 5083 a -2 5083 a
SDict begin 13 H.A end
 -2 5083 a -2 5083 a
SDict begin [/View [/XYZ H.V]/Dest (0:2187) cvn /DEST pdfmark end
 -2 5083
a Black 3756 5569 a Ff(167)p Black eop end
%%Page: 168 181
TeXDict begin 168 180 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.168) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2188) cvn /DEST pdfmark end
 479 72 a Fk(The)g(w)o(ork)o(er)f(uses)i(a)
g(reconnect)d(strate)o(gy)h(similar)i(to)f(the)g(one)g(we)h(designed)e
(for)g(the)h(Lazy)g(Pirate)g(client.)g(W)m(ith)479 180
y(tw)o(o)h(major)e(dif)n(ferences:)g(\(a\))h(it)h(does)e(an)i(e)o
(xponential)c(back-of)n(f,)h(and)i(\(b\))f(it)i(ne)n(v)o(er)e
(abandons.)-2 364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364
a
SDict begin [/View [/XYZ H.V]/Dest (0:2189) cvn /DEST pdfmark end
 -2 364 a 396 454 a Fk(T)m(ry)h(the)g(client,)g(queue,)f(and)h(w)o
(ork)o(ers,)f(e.g.)g(using)h(a)h(script)f(lik)o(e)g(this:)-2
555 y
SDict begin H.S end
 -2 555 a -2 555 a
SDict begin 11.7 H.A end
 -2 555 a -2 555 a
SDict begin [/View [/XYZ H.V]/Dest (0:2190) cvn /DEST pdfmark end
 -2 555 a 396
635 a Fe(ppqueue)44 b(&)396 732 y(for)h(i)f(in)h(1)f(2)h(3)g(4;)f(do)
576 829 y(ppworker)f(&)576 926 y(sleep)h(1)396 1023 y(done)396
1120 y(lpclient)g(&)-2 1298 y
SDict begin H.S end
 -2 1298 a -2 1298 a
SDict begin 13 H.A end
 -2
1298 a -2 1298 a
SDict begin [/View [/XYZ H.V]/Dest (0:2191) cvn /DEST pdfmark end
 -2 1298 a 396 1394 a Fk(Y)-9 b(ou)20
b(should)f(see)i(the)f(w)o(ork)o(ers)g(die,)f(one)h(by)g(one,)f(as)i
(the)o(y)f(simulate)g(a)g(crash,)g(and)g(the)g(client)g(e)n(v)o
(entually)e(gi)n(v)o(e)i(up.)396 1502 y(Y)-9 b(ou)20
b(can)g(stop)g(and)g(restart)g(the)g(queue)f(and)h(both)f(client)h(and)
g(w)o(ork)o(ers)f(will)i(reconnect)e(and)g(carry)h(on.)f(And)h(no)396
1610 y(matter)g(what)g(you)g(do)f(to)i(queues)e(and)h(w)o(ork)o(ers,)f
(the)h(client)g(will)h(ne)n(v)o(er)e(get)h(an)g(out-of-order)d(reply:)i
(the)i(whole)396 1718 y(chain)f(either)g(w)o(orks,)f(or)h(the)g(client)
h(abandons.)-2 1740 y
SDict begin H.S end
 -2 1740 a -2 1740 a
SDict begin 13 H.A end
 -2 1740 a -2
1740 a
SDict begin [/View [/XYZ H.V]/Dest (0:2192) cvn /DEST pdfmark end
 -2 1740 a 365 x Fn(4.6.)39 b(Hear)s(tbeating)1160
2105 y
SDict begin H.S end
 1160 2105 a 1160 2105 a
SDict begin 22.464 H.A end
 1160 2105 a 1160 2105
a
SDict begin [/View [/XYZ H.V]/Dest (9.60.1) cvn /DEST pdfmark end
 1160 2105 a -2 2303 a
SDict begin H.S end
 -2 2303 a -2 2303 a
SDict begin 13 H.A end
 -2 2303 a
-2 2303 a
SDict begin [/View [/XYZ H.V]/Dest (0:2194) cvn /DEST pdfmark end
 -2 2303 a 396 2379 a Fk(When)20 b(writing)g(the)g(P)o
(aranoid)f(Pirate)h(e)o(xamples,)f(it)i(took)e(about)h(\002)n(v)o(e)f
(hours)h(to)g(get)g(the)g(queue-to-w)o(ork)o(er)396 2487
y(heartbeating)d(w)o(orking)f(properly)-5 b(.)16 b(The)i(rest)h(of)f
(the)h(request-reply)d(chain)h(took)h(perhaps)f(ten)i(minutes.)e
(Heartbeating)396 2595 y(is)k(one)f(of)g(those)g(reliability)f(layers)h
(that)g(often)g(causes)g(more)f(trouble)g(than)h(it)h(sa)n(v)o(es.)f
(It)h(is)g(especially)e(easy)i(to)f(create)396 2703 y('f)o(alse)h(f)o
(ailures',)e(i.e.)h(peers)g(decide)f(that)i(the)o(y)e(are)h
(disconnected)f(because)g(the)h(heartbeats)g(aren')o(t)e(sent)j
(properly)-5 b(.)-2 2887 y
SDict begin H.S end
 -2 2887 a -2 2887 a
SDict begin 13 H.A end
 -2 2887
a -2 2887 a
SDict begin [/View [/XYZ H.V]/Dest (0:2195) cvn /DEST pdfmark end
 -2 2887 a 396 2977 a Fk(Some)20 b(points)g(to)g(consider)f
(when)h(understanding)d(and)j(implementing)e(heartbeating:)-2
2995 y
SDict begin H.S end
 -2 2995 a -2 2995 a
SDict begin 13 H.A end
 -2 2995 a -2 2995 a
SDict begin [/View [/XYZ H.V]/Dest (0:2196) cvn /DEST pdfmark end
 -2 2995
a -2 3005 a
SDict begin H.S end
 -2 3005 a -2 3005 a
SDict begin 13 H.A end
 -2 3005 a -2 3005 a
SDict begin [/View [/XYZ H.V]/Dest (0:2197) cvn /DEST pdfmark end
 -2
3005 a Black 396 3147 a Fj(\225)p Black 479 3147 a
SDict begin H.S end
 479
3147 a 479 3147 a
SDict begin 13 H.A end
 479 3147 a 479 3147 a
SDict begin [/View [/XYZ H.V]/Dest (0:2198) cvn /DEST pdfmark end
 479 3147 a Fk(Note)i(that)h
(heartbeats)e(are)h(not)g(request-reply)-5 b(.)17 b(The)o(y)i(\003o)n
(w)i(asynchronously)16 b(in)21 b(both)e(directions.)g(Either)h(peer)479
3255 y(can)g(decide)g(the)g(other)f(is)i(')l(dead')e(and)h(stop)g
(talking)f(to)i(it.)-2 3273 y
SDict begin H.S end
 -2 3273 a -2 3273 a
SDict begin 13 H.A end
 -2
3273 a -2 3273 a
SDict begin [/View [/XYZ H.V]/Dest (0:2199) cvn /DEST pdfmark end
 -2 3273 a Black 396 3405 a Fj(\225)p
Black 479 3405 a
SDict begin H.S end
 479 3405 a 479 3405 a
SDict begin 13 H.A end
 479 3405 a 479
3405 a
SDict begin [/View [/XYZ H.V]/Dest (0:2200) cvn /DEST pdfmark end
 479 3405 a Fk(First,)g(get)f(the)g(heartbeating)f(w)o(orking,)f
(and)i(only)1975 3405 y
SDict begin H.S end
 1975 3405 a 1975 3405 a
SDict begin 13 H.A end
 1975
3405 a 1975 3405 a
SDict begin [/View [/XYZ H.V]/Dest (0:2201) cvn /DEST pdfmark end
 1975 3405 a Ff(then)g Fk(add)f(in)i(the)f(rest)h(of)
e(the)i(message)f(\003o)n(w)-5 b(.)19 b(Y)-9 b(ou)20
b(should)f(be)479 3513 y(able)h(to)h(pro)o(v)o(e)d(the)i(heartbeating)e
(w)o(orks)i(by)g(starting)g(peers)g(in)g(an)o(y)f(order)m(,)g(stopping)
g(and)g(restarting)h(them,)479 3621 y(simulating)g(freezes,)f(and)h(so)
g(on.)-2 3639 y
SDict begin H.S end
 -2 3639 a -2 3639 a
SDict begin 13 H.A end
 -2 3639 a -2 3639
a
SDict begin [/View [/XYZ H.V]/Dest (0:2202) cvn /DEST pdfmark end
 -2 3639 a Black 396 3770 a Fj(\225)p Black 479 3770
a
SDict begin H.S end
 479 3770 a 479 3770 a
SDict begin 13 H.A end
 479 3770 a 479 3770 a
SDict begin [/View [/XYZ H.V]/Dest (0:2203) cvn /DEST pdfmark end
 479 3770
a Fk(When)g(your)f(main)h(loop)f(is)j(based)d(on)h(zmq_poll[3],)d(use)j
(a)h(secondary)d(timer)i(to)h(trigger)e(heartbeats.)g(Do)3638
3770 y
SDict begin H.S end
 3638 3770 a 3638 3770 a
SDict begin 13 H.A end
 3638 3770 a 3638 3770
a
SDict begin [/View [/XYZ H.V]/Dest (0:2204) cvn /DEST pdfmark end
 3638 3770 a Ff(not)j Fk(use)479 3878 y(the)e(poll)f(loop)g(for)f
(this,)i(because)f(you')o(ll)f(enter)h(the)h(loop)e(e)n(v)o(ery)g(time)
i(you)f(recei)n(v)o(e)f(an)o(y)g(message)i(\(fun,)e(when)h(you)479
3986 y(ha)n(v)o(e)h(tw)o(o)g(peers)g(sending)f(each)h(other)g
(heartbeats\))e(\(think)i(about)f(it\).)-2 4170 y
SDict begin H.S end
 -2
4170 a -2 4170 a
SDict begin 13 H.A end
 -2 4170 a -2 4170 a
SDict begin [/View [/XYZ H.V]/Dest (0:2205) cvn /DEST pdfmark end
 -2 4170 a 396 4260
a Fk(Y)-9 b(our)19 b(language)g(or)h(binding)e(should)i(pro)o(vide)e(a)
i(method)f(that)h(returns)g(the)g(current)f(system)h(clock)g(in)g
(milliseconds.)396 4368 y(It')-5 b(s)21 b(easy)f(to)h(use)f(this)h(to)f
(calculate)g(when)g(to)g(send)g(the)g(ne)o(xt)g(heartbeats.)f(Thus,)g
(in)i(C:)-2 4469 y
SDict begin H.S end
 -2 4469 a -2 4469 a
SDict begin 11.7 H.A end
 -2 4469 a -2 4469
a
SDict begin [/View [/XYZ H.V]/Dest (0:2206) cvn /DEST pdfmark end
 -2 4469 a 396 4548 a Fe(//)90 b(Send)44 b(out)g(heartbeats)f(at)i
(regular)e(intervals)396 4645 y(uint64_t)h(heartbeat_at)f(=)h
(zclock_time)f(\(\))i(+)f(HEARTBEAT_INTERVAL;)396 4839
y(while)g(\(1\))h({)576 4937 y(...)576 5034 y(int)f(rc)g(=)h(zmq_poll)f
(\(items,)f(1,)i(HEARTBEAT_INTERVAL)2728 5047 y(*)2817
5034 y(ZMQ_POLL_MSEC\);)576 5131 y(...)p Black 3759 5569
a Ff(168)p Black eop end
%%Page: 169 182
TeXDict begin 169 181 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.169) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(//)89 b(Send)44 b(heartbeat)f(to)i(queue)f(if)g(it's)
h(time)576 170 y(if)f(\(zclock_time)f(\(\))h(>)h(heartbeat_at\))e({)755
267 y(...)h(Send)g(heartbeats)g(to)g(all)g(peers)g(that)h(expect)e
(them)755 364 y(//)89 b(Set)45 b(timer)f(for)g(next)g(heartbeat)755
461 y(heartbeat_at)f(=)h(zclock_time)f(\(\))i(+)g(HEARTBEAT_INTERVAL;)
576 558 y(})396 655 y(})-2 663 y
SDict begin H.S end
 -2 663 a -2 663 a
SDict begin 13 H.A end
 -2
663 a -2 663 a
SDict begin [/View [/XYZ H.V]/Dest (0:2207) cvn /DEST pdfmark end
 -2 663 a -2 747 a
SDict begin H.S end
 -2 747 a -2 747 a
SDict begin 13 H.A end
 -2
747 a -2 747 a
SDict begin [/View [/XYZ H.V]/Dest (0:2208) cvn /DEST pdfmark end
 -2 747 a Black 396 1012 a Fj(\225)p Black
479 1012 a
SDict begin H.S end
 479 1012 a 479 1012 a
SDict begin 13 H.A end
 479 1012 a 479 1012
a
SDict begin [/View [/XYZ H.V]/Dest (0:2209) cvn /DEST pdfmark end
 479 1012 a Fk(Y)-9 b(our)20 b(main)f(poll)h(loop)g(should)f(use)h
(the)g(heartbeat)f(interv)n(al)h(as)h(its)g(timeout.)e(Ob)o(viously)-5
b(,)18 b(don')o(t)g(use)j(in\002nity)-5 b(.)479 1120
y(An)o(ything)18 b(less)k(will)f(just)f(w)o(aste)h(c)o(ycles.)-2
1138 y
SDict begin H.S end
 -2 1138 a -2 1138 a
SDict begin 13 H.A end
 -2 1138 a -2 1138 a
SDict begin [/View [/XYZ H.V]/Dest (0:2210) cvn /DEST pdfmark end
 -2 1138
a Black 396 1270 a Fj(\225)p Black 479 1270 a
SDict begin H.S end
 479 1270
a 479 1270 a
SDict begin 13 H.A end
 479 1270 a 479 1270 a
SDict begin [/View [/XYZ H.V]/Dest (0:2211) cvn /DEST pdfmark end
 479 1270 a Fk(Use)g(simple)f
(tracing,)f(i.e.)i(print)e(to)i(console,)e(to)h(get)g(this)h(w)o
(orking.)d(Some)i(tricks)g(to)h(help)e(you)h(trace)g(the)g(\003o)n(w)g
(of)479 1378 y(messages)h(between)e(peers:)h(a)h(dump)d(method)h(such)h
(as)h(zmsg)f(of)n(fers;)g(number)e(messages)i(incrementally)f(so)h(you)
479 1486 y(can)g(see)h(if)g(there)e(are)h(gaps.)-2 1503
y
SDict begin H.S end
 -2 1503 a -2 1503 a
SDict begin 13 H.A end
 -2 1503 a -2 1503 a
SDict begin [/View [/XYZ H.V]/Dest (0:2212) cvn /DEST pdfmark end
 -2 1503 a Black
396 1635 a Fj(\225)p Black 479 1635 a
SDict begin H.S end
 479 1635 a 479
1635 a
SDict begin 13 H.A end
 479 1635 a 479 1635 a
SDict begin [/View [/XYZ H.V]/Dest (0:2213) cvn /DEST pdfmark end
 479 1635 a Fk(In)g(a)h(real)f
(application,)e(heartbeating)h(must)h(be)g(con\002gurable)e(and)h
(usually)h(ne)o(gotiated)e(with)j(the)f(peer)-5 b(.)20
b(Some)479 1743 y(peers)g(will)h(w)o(ant)f(aggressi)n(v)o(e)f
(heartbeating,)f(as)j(lo)n(w)f(as)h(10)f(msecs.)g(Other)g(peers)g(will)
h(be)f(f)o(ar)g(a)o(w)o(ay)g(and)g(w)o(ant)479 1851 y(heartbeating)e
(as)j(high)f(as)h(30)e(seconds.)-2 1869 y
SDict begin H.S end
 -2 1869 a -2
1869 a
SDict begin 13 H.A end
 -2 1869 a -2 1869 a
SDict begin [/View [/XYZ H.V]/Dest (0:2214) cvn /DEST pdfmark end
 -2 1869 a Black 396 2000 a
Fj(\225)p Black 479 2000 a
SDict begin H.S end
 479 2000 a 479 2000 a
SDict begin 13 H.A end
 479
2000 a 479 2000 a
SDict begin [/View [/XYZ H.V]/Dest (0:2215) cvn /DEST pdfmark end
 479 2000 a Fk(If)h(you)g(ha)n(v)o(e)f(dif)n(ferent)g
(heartbeat)g(interv)n(als)g(for)h(dif)n(ferent)e(peers,)i(your)f(poll)h
(timeout)f(should)h(be)g(the)g(lo)n(west)479 2108 y(\(shortest)g
(time\))g(of)g(these.)-2 2123 y
SDict begin H.S end
 -2 2123 a -2 2123 a
SDict begin 13 H.A end
 -2
2123 a -2 2123 a
SDict begin [/View [/XYZ H.V]/Dest (0:2216) cvn /DEST pdfmark end
 -2 2123 a Black 396 2258 a Fj(\225)p
Black 479 2258 a
SDict begin H.S end
 479 2258 a 479 2258 a
SDict begin 13 H.A end
 479 2258 a 479
2258 a
SDict begin [/View [/XYZ H.V]/Dest (0:2217) cvn /DEST pdfmark end
 479 2258 a Fk(Y)-9 b(ou)20 b(might)f(be)i(tempted)e(to)h(open)f
(a)i(separate)f(sock)o(et)g(dialog)f(for)h(heartbeats.)f(This)h(is)h
(super\002cially)e(nice)479 2366 y(because)h(you)f(can)h(separate)g
(dif)n(ferent)e(dialogs,)i(e.g.)f(the)i(synchronous)c(request-reply)h
(from)h(the)h(asynchronous)479 2473 y(heartbeating.)e(Ho)n(we)n(v)o(er)
h(it')-5 b(s)21 b(a)g(bad)e(idea)h(for)g(se)n(v)o(eral)g(reasons.)f
(First,)i(if)f(you')l(re)f(sending)g(data)h(you)f(don')o(t)f(need)479
2581 y(to)j(send)f(heartbeats.)f(Second,)g(sock)o(ets)h(may)-5
b(,)19 b(due)h(to)g(netw)o(ork)f(v)n(agaries,)g(become)g(jammed.)g(Y)-9
b(ou)19 b(need)h(to)g(kno)n(w)479 2689 y(when)g(your)f(main)h(data)g
(sock)o(et)g(is)h(silent)f(because)g(it')-5 b(s)21 b(dead,)f(rather)f
(than)h(just)g(not)g(b)n(usy)-5 b(,)19 b(so)i(you)e(need)479
2797 y(heartbeats)h(on)f(that)i(sock)o(et.)e(Lastly)-5
b(,)20 b(tw)o(o)h(sock)o(ets)f(is)h(more)e(comple)o(x)g(than)h(one.)-2
2815 y
SDict begin H.S end
 -2 2815 a -2 2815 a
SDict begin 13 H.A end
 -2 2815 a -2 2815 a
SDict begin [/View [/XYZ H.V]/Dest (0:2218) cvn /DEST pdfmark end
 -2 2815
a Black 396 2947 a Fj(\225)p Black 479 2947 a
SDict begin H.S end
 479 2947
a 479 2947 a
SDict begin 13 H.A end
 479 2947 a 479 2947 a
SDict begin [/View [/XYZ H.V]/Dest (0:2219) cvn /DEST pdfmark end
 479 2947 a Fk(W)-7
b(e')l(re)21 b(not)e(doing)g(heartbeating)f(from)i(client)g(to)g
(queue.)f(It)h(does)g(mak)o(e)g(things)g(more)f(comple)o(x,)f(b)n(ut)j
(we)f(do)g(that)479 3055 y(in)h(real)f(applications)f(so)h(that)h
(clients)f(can)g(detect)g(when)g(brok)o(ers)f(die,)h(and)f(do)h(cle)n
(v)o(er)f(things)h(lik)o(e)h(switch)f(to)479 3163 y(alternate)g(brok)o
(ers.)-2 3205 y
SDict begin H.S end
 -2 3205 a -2 3205 a
SDict begin 13 H.A end
 -2 3205 a -2 3205
a
SDict begin [/View [/XYZ H.V]/Dest (0:2220) cvn /DEST pdfmark end
 -2 3205 a 376 x Fn(4.7.)39 b(Contracts)e(and)i(Pr)m(otocols)1942
3581 y
SDict begin H.S end
 1942 3581 a 1942 3581 a
SDict begin 22.464 H.A end
 1942 3581 a 1942 3581
a
SDict begin [/View [/XYZ H.V]/Dest (9.61.1) cvn /DEST pdfmark end
 1942 3581 a -2 3749 a
SDict begin H.S end
 -2 3749 a -2 3749 a
SDict begin 13 H.A end
 -2 3749 a
-2 3749 a
SDict begin [/View [/XYZ H.V]/Dest (0:2222) cvn /DEST pdfmark end
 -2 3749 a 396 3855 a Fk(If)20 b(you')l(re)f(paying)f
(attention)i(you')o(ll)f(realize)h(that)g(P)o(aranoid)f(Pirate)h(is)h
(not)f(interoperable)e(with)i(Simple)g(Pirate,)396 3963
y(because)f(of)g(the)h(heartbeats.)e(But)i(ho)n(w)f(do)g(we)g(de\002ne)
g("interoperable"?)e(T)-7 b(o)19 b(guarantee)f(interoperability)f(we)j
(need)e(a)396 4071 y(kind)i(of)g(contract,)e(an)j(agreement)d(that)i
(lets)h(dif)n(ferent)e(teams,)h(in)h(dif)n(ferent)d(times)j(and)e
(places,)h(write)h(code)e(that)i(is)396 4179 y(guaranteed)d(to)j(w)o
(ork)e(together)-5 b(.)19 b(W)-7 b(e)21 b(call)g(this)g(a)f
("protocol".)-2 4363 y
SDict begin H.S end
 -2 4363 a -2 4363 a
SDict begin 13 H.A end
 -2 4363 a
-2 4363 a
SDict begin [/View [/XYZ H.V]/Dest (0:2223) cvn /DEST pdfmark end
 -2 4363 a 396 4453 a Fk(It')-5 b(s)21 b(fun)f(to)g(e)o
(xperiment)e(without)h(speci\002cations,)h(b)n(ut)g(that')-5
b(s)21 b(not)f(a)g(sensible)g(basis)h(for)f(real)g(applications.)f
(What)396 4561 y(happens)g(if)i(we)f(w)o(ant)g(to)h(write)f(a)h(w)o
(ork)o(er)e(in)h(another)f(language?)f(Do)j(we)f(ha)n(v)o(e)g(to)g
(read)g(code)f(to)i(see)f(ho)n(w)g(things)396 4669 y(w)o(ork?)g(What)g
(if)h(we)f(w)o(ant)h(to)f(change)f(the)h(protocol)e(for)i(some)g
(reason?)f(The)h(protocol)f(may)g(be)i(simple)f(b)n(ut)g(it')-5
b(s)21 b(not)396 4777 y(ob)o(vious,)d(and)i(if)h(it')-5
b(s)21 b(successful)f(it')o(ll)h(become)e(more)g(comple)o(x.)-2
4961 y
SDict begin H.S end
 -2 4961 a -2 4961 a
SDict begin 13 H.A end
 -2 4961 a -2 4961 a
SDict begin [/View [/XYZ H.V]/Dest (0:2224) cvn /DEST pdfmark end
 -2 4961
a 396 5051 a Fk(Lack)h(of)g(contracts)f(is)i(a)g(sure)f(sign)g(of)g(a)h
(disposable)e(application.)g(So,)h(let')-5 b(s)21 b(write)f(a)h
(contract)e(for)h(this)g(protocol.)396 5159 y(Ho)n(w)g(do)g(we)h(do)e
(that?)-2 5160 y
SDict begin H.S end
 -2 5160 a -2 5160 a
SDict begin 13 H.A end
 -2 5160 a -2 5160
a
SDict begin [/View [/XYZ H.V]/Dest (0:2225) cvn /DEST pdfmark end
 -2 5160 a -2 5170 a
SDict begin H.S end
 -2 5170 a -2 5170 a
SDict begin 13 H.A end
 -2 5170 a -2
5170 a
SDict begin [/View [/XYZ H.V]/Dest (0:2226) cvn /DEST pdfmark end
 -2 5170 a Black 3759 5569 a Ff(169)p Black eop
end
%%Page: 170 183
TeXDict begin 170 182 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.170) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2255) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2227) cvn /DEST pdfmark end
 479 72 a Fk(There')-5 b(s)20
b(a)h(wiki,)f(at)1076 72 y
SDict begin H.S end
 1076 72 a 1076 72 a
SDict begin 13 H.A end
 1076 72
a 1076 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2228) cvn /DEST pdfmark end
 1076 72 a Fk(rfc.zeromq.or)o(g)c(\(http://rfc.zeromq.or)o
(g\),)e(that)20 b(we)h(made)e(especially)h(as)h(a)g(home)e(for)h
(public)479 180 y(\330MQ)h(contracts.)-2 195 y
SDict begin H.S end
 -2 195
a -2 195 a
SDict begin 13 H.A end
 -2 195 a -2 195 a
SDict begin [/View [/XYZ H.V]/Dest (0:2229) cvn /DEST pdfmark end
 -2 195 a Black 396 330 a
Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330
a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:2230) cvn /DEST pdfmark end
 479 330 a Fk(T)-7 b(o)21 b(create)f(a)g(ne)n(w)g
(speci\002cation,)f(re)o(gister)m(,)g(and)h(follo)n(w)f(the)i
(instructions.)e(It')-5 b(s)20 b(straight-forw)o(ard,)e(though)479
438 y(technical)i(writing)f(is)i(not)f(for)g(e)n(v)o(eryone.)-2
622 y
SDict begin H.S end
 -2 622 a -2 622 a
SDict begin 13 H.A end
 -2 622 a -2 622 a
SDict begin [/View [/XYZ H.V]/Dest (0:2231) cvn /DEST pdfmark end
 -2 622 a 396
712 a Fk(It)h(took)e(me)h(about)g(\002fteen)f(minutes)h(to)g(draft)g
(the)g(ne)n(w)2022 712 y
SDict begin H.S end
 2022 712 a 2022 712 a
SDict begin 13 H.A end
 2022 712
a 2022 712 a
SDict begin [/View [/XYZ H.V]/Dest (0:2232) cvn /DEST pdfmark end
 2022 712 a Fk(Pirate)h(P)o(attern)e(Protocol)g
(\(http://rfc.zeromq.or)o(g/spec:6)o(\).)396 820 y(It')-5
b(s)21 b(not)f(a)h(big)e(speci\002cation)h(b)n(ut)g(it)h(does)f
(capture)f(enough)f(to)j(act)f(as)h(the)f(basis)h(for)f(ar)o(guments)e
(\("your)g(queue)h(isn')o(t)396 928 y(PPP)i(compatible,)e(please)h
(\002x)h(it!"\).)-2 1112 y
SDict begin H.S end
 -2 1112 a -2 1112 a
SDict begin 13 H.A end
 -2 1112
a -2 1112 a
SDict begin [/View [/XYZ H.V]/Dest (0:2233) cvn /DEST pdfmark end
 -2 1112 a 396 1202 a Fk(T)l(urning)e(PPP)i(into)f(a)h(real)
f(protocol)e(w)o(ould)i(tak)o(e)g(more)f(w)o(ork:)-2
1220 y
SDict begin H.S end
 -2 1220 a -2 1220 a
SDict begin 13 H.A end
 -2 1220 a -2 1220 a
SDict begin [/View [/XYZ H.V]/Dest (0:2234) cvn /DEST pdfmark end
 -2 1220
a -2 1230 a
SDict begin H.S end
 -2 1230 a -2 1230 a
SDict begin 13 H.A end
 -2 1230 a -2 1230 a
SDict begin [/View [/XYZ H.V]/Dest (0:2235) cvn /DEST pdfmark end
 -2
1230 a Black 396 1372 a Fj(\225)p Black 479 1372 a
SDict begin H.S end
 479
1372 a 479 1372 a
SDict begin 13 H.A end
 479 1372 a 479 1372 a
SDict begin [/View [/XYZ H.V]/Dest (0:2236) cvn /DEST pdfmark end
 479 1372 a Fk(There)h(should)f
(be)h(a)h(protocol)d(v)o(ersion)h(number)f(in)j(the)f(READ)-5
b(Y)21 b(command)d(so)j(that)f(it')-5 b(s)21 b(possible)f(to)h(create)f
(ne)n(w)479 1480 y(v)o(ersions)g(of)f(PPP)j(safely)-5
b(.)-2 1498 y
SDict begin H.S end
 -2 1498 a -2 1498 a
SDict begin 13 H.A end
 -2 1498 a -2 1498 a
SDict begin [/View [/XYZ H.V]/Dest (0:2237) cvn /DEST pdfmark end

-2 1498 a Black 396 1629 a Fj(\225)p Black 479 1629 a
SDict begin H.S end

479 1629 a 479 1629 a
SDict begin 13 H.A end
 479 1629 a 479 1629 a
SDict begin [/View [/XYZ H.V]/Dest (0:2238) cvn /DEST pdfmark end
 479 1629
a Fk(Right)21 b(no)n(w)-5 b(,)19 b(READ)-5 b(Y)21 b(and)e(HEAR)-5
b(TBEA)c(T)20 b(are)h(not)e(entirely)h(distinct)g(from)f(requests)h
(and)g(replies.)f(T)-7 b(o)21 b(mak)o(e)479 1737 y(them)f(distinct,)g
(we)h(w)o(ould)e(w)o(ant)h(a)h(message)f(structure)f(that)i(includes)e
(a)i("message)f(type")f(part.)-2 1797 y
SDict begin H.S end
 -2 1797 a -2
1797 a
SDict begin 13 H.A end
 -2 1797 a -2 1797 a
SDict begin [/View [/XYZ H.V]/Dest (0:2239) cvn /DEST pdfmark end
 -2 1797 a 359 x Fn(4.8.)39
b(Ser)q(vice-Oriented)d(Reliab)o(le)i(Queuing)g(\(Major)m(domo)-2
2342 y(P)l(attern\))538 2342 y
SDict begin H.S end
 538 2342 a 538 2342 a
SDict begin 22.464 H.A end

538 2342 a 538 2342 a
SDict begin [/View [/XYZ H.V]/Dest (9.62.1) cvn /DEST pdfmark end
 538 2342 a -2 2538 a
SDict begin H.S end
 -2 2538 a
-2 2538 a
SDict begin 13 H.A end
 -2 2538 a -2 2538 a
SDict begin [/View [/XYZ H.V]/Dest (0:2241) cvn /DEST pdfmark end
 -2 2538 a 396 2616 a Fk(The)20
b(nice)f(thing)h(about)e(progress)h(is)i(ho)n(w)e(f)o(ast)i(it)f
(happens)f(when)g(la)o(wyers)g(and)h(committees)f(aren')o(t)f(in)m(v)n
(olv)o(ed.)g(Just)i(a)396 2724 y(fe)n(w)g(sentences)g(ago)g(we)g(were)h
(dreaming)d(of)i(a)g(better)g(protocol)f(that)h(w)o(ould)f(\002x)i(the)
f(w)o(orld.)f(And)h(here)g(we)g(ha)n(v)o(e)g(it:)-2 2742
y
SDict begin H.S end
 -2 2742 a -2 2742 a
SDict begin 13 H.A end
 -2 2742 a -2 2742 a
SDict begin [/View [/XYZ H.V]/Dest (0:2242) cvn /DEST pdfmark end
 -2 2742 a -2
2752 a
SDict begin H.S end
 -2 2752 a -2 2752 a
SDict begin 13 H.A end
 -2 2752 a -2 2752 a
SDict begin [/View [/XYZ H.V]/Dest (0:2243) cvn /DEST pdfmark end
 -2 2752
a Black 396 2894 a Fj(\225)p Black 479 2894 a
SDict begin H.S end
 479 2894
a 479 2894 a
SDict begin 13 H.A end
 479 2894 a 479 2894 a
SDict begin [/View [/XYZ H.V]/Dest (0:2244) cvn /DEST pdfmark end
 479 2894 a Fk(http://rfc.zeromq.or)o
(g/spec:7)-2 3078 y
SDict begin H.S end
 -2 3078 a -2 3078 a
SDict begin 13 H.A end
 -2 3078 a -2
3078 a
SDict begin [/View [/XYZ H.V]/Dest (0:2245) cvn /DEST pdfmark end
 -2 3078 a 396 3168 a Fk(This)g(one-page)e(speci\002cation)g(tak)
o(es)i(PPP)h(and)e(turns)g(it)i(into)e(something)f(more)h(solid\()p
0 TeXcolorgray 2966 3168 a
SDict begin H.S end
 2966 3168 a Fk(Figure)g(4-4)3315
3168 y
SDict begin 13 H.L end
 3315 3168 a 3315 3168 a
SDict begin [/Subtype /Link/Dest (0:figure-57) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3315 3168 a Black -2 w
Fk(\).)h(This)g(is)g(ho)n(w)f(we)396 3276 y(should)g(design)h(comple)o
(x)e(architectures:)h(start)i(by)f(writing)f(do)n(wn)h(the)g
(contracts,)f(and)h(only)3153 3276 y
SDict begin H.S end
 3153 3276 a 3153
3276 a
SDict begin 13 H.A end
 3153 3276 a 3153 3276 a
SDict begin [/View [/XYZ H.V]/Dest (0:2247) cvn /DEST pdfmark end
 3153 3276 a Ff(then)g
Fk(write)g(softw)o(are)g(to)396 3384 y(implement)f(them.)-2
3568 y
SDict begin H.S end
 -2 3568 a -2 3568 a
SDict begin 13 H.A end
 -2 3568 a -2 3568 a
SDict begin [/View [/XYZ H.V]/Dest (0:2248) cvn /DEST pdfmark end
 -2 3568
a 396 3658 a Fk(The)h(Majordomo)e(Protocol)h(\(MDP\))h(e)o(xtends)f
(and)h(impro)o(v)o(es)e(PPP)j(in)g(one)e(interesting)h(w)o(ay)g(apart)f
(from)h(the)g(tw)o(o)396 3766 y(points)g(abo)o(v)o(e.)e(It)j(adds)f(a)g
("service)g(name")g(to)g(requests)g(that)g(the)g(client)g(sends,)g(and)
g(asks)h(w)o(ork)o(ers)e(to)i(re)o(gister)e(for)396 3874
y(speci\002c)i(services.)f(The)f(nice)h(thing)g(about)f(MDP)i(is)g
(that)f(it)h(came)f(from)f(w)o(orking)g(code,)g(a)i(simpler)f
(protocol,)e(and)h(a)396 3982 y(precise)h(set)h(of)f(impro)o(v)o
(ements.)d(This)j(made)g(it)h(easy)f(to)h(draft.)-2 4166
y
SDict begin H.S end
 -2 4166 a -2 4166 a
SDict begin 13 H.A end
 -2 4166 a -2 4166 a
SDict begin [/View [/XYZ H.V]/Dest (0:2249) cvn /DEST pdfmark end
 -2 4166 a 396
4256 a Fk(Adding)e(service)h(names)g(is)h(a)g(small)f(b)n(ut)g
(signi\002cant)g(change)f(that)h(turns)g(our)g(P)o(aranoid)e(Pirate)j
(queue)e(into)h(a)396 4364 y(service-oriented)e(brok)o(er)-5
b(.)-2 4365 y
SDict begin H.S end
 -2 4365 a -2 4365 a
SDict begin 13 H.A end
 -2 4365 a -2 4365 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-57) cvn /DEST pdfmark
end

-2 4365 a Black 3759 5569 a Ff(170)p Black eop end
%%Page: 171 184
TeXDict begin 171 183 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.171) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-4.)f(The)i(Majordomo)e(P)o(atter)o(n)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2252) cvn /DEST pdfmark end
 -2 172 a 396
2539 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2539 a @beginspecial 0 @llx -279 @lly 294
@urx 0 @ury 2940 @rwi @setspecial
%%BeginDocument: images/fig57.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -279 294 0
%%HiResBoundingBox: 0.0 -279.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -55.80017852783203 lineto
16.800180435180664 -58.466845194498696 17.800180435180664 -59.80017852783203 19.800180435180664 -59.80017852783203 curveto
85.80017852783203 -59.80017852783203 lineto
85.80017852783203 -59.80017852783203 lineto
87.80017852783203 -59.80017852783203 88.80017852783203 -58.466845194498696 88.80017852783203 -55.80017852783203 curveto
88.80017852783203 -23.800180435180664 lineto
88.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -23.800180435180664 moveto
112.80017852783203 -55.80017852783203 lineto
112.80017852783203 -58.466845194498696 113.80017852783203 -59.80017852783203 115.80017852783203 -59.80017852783203 curveto
181.80018615722656 -59.80017852783203 lineto
181.80018615722656 -59.80017852783203 lineto
183.80018615722656 -59.80017852783203 184.80018615722656 -58.466845194498696 184.80018615722656 -55.80017852783203 curveto
184.80018615722656 -23.800180435180664 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -23.800180435180664 moveto
208.80018615722656 -55.80017852783203 lineto
208.80018615722656 -58.466845194498696 209.80018615722656 -59.80017852783203 211.80018615722656 -59.80017852783203 curveto
277.8001708984375 -59.80017852783203 lineto
277.8001708984375 -59.80017852783203 lineto
279.8001708984375 -59.80017852783203 280.8001708984375 -58.466845194498696 280.8001708984375 -55.80017852783203 curveto
280.8001708984375 -23.800180435180664 lineto
280.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -113.80017852783203 moveto
113.80017852783203 -113.80017852783203 112.80017852783203 -115.4668451944987 112.80017852783203 -118.80017852783203 curveto
112.80017852783203 -145.80018615722656 lineto
112.80017852783203 -148.46685282389322 113.80017852783203 -149.80018615722656 115.80017852783203 -149.80018615722656 curveto
181.80018615722656 -149.80018615722656 lineto
181.80018615722656 -149.80018615722656 lineto
183.80018615722656 -149.80018615722656 184.80018615722656 -148.46685282389322 184.80018615722656 -145.80018615722656 curveto
184.80018615722656 -118.80017852783203 lineto
184.80018615722656 -118.80017852783203 lineto
184.80018615722656 -115.4668451944987 183.80018615722656 -113.80017852783203 181.80018615722656 -113.80017852783203 curveto
115.80017852783203 -113.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -203.80018615722656 moveto
17.800180435180664 -203.80018615722656 16.800180435180664 -205.46685282389322 16.800180435180664 -208.80018615722656 curveto
16.800180435180664 -219.80018615722656 lineto
88.80017852783203 -219.80018615722656 lineto
88.80017852783203 -208.80018615722656 lineto
88.80017852783203 -205.46685282389322 87.80017852783203 -203.80018615722656 85.80017852783203 -203.80018615722656 curveto
19.800180435180664 -203.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -222.80018615722656 moveto
16.800180435180664 -257.8001708984375 lineto
88.80017852783203 -257.8001708984375 lineto
88.80017852783203 -222.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -203.80018615722656 moveto
113.80017852783203 -203.80018615722656 112.80017852783203 -205.46685282389322 112.80017852783203 -208.80018615722656 curveto
112.80017852783203 -219.80018615722656 lineto
184.80018615722656 -219.80018615722656 lineto
184.80018615722656 -208.80018615722656 lineto
184.80018615722656 -205.46685282389322 183.80018615722656 -203.80018615722656 181.80018615722656 -203.80018615722656 curveto
115.80017852783203 -203.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -222.80018615722656 moveto
112.80017852783203 -257.8001708984375 lineto
184.80018615722656 -257.8001708984375 lineto
184.80018615722656 -222.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -203.80018615722656 moveto
209.80018615722656 -203.80018615722656 208.80018615722656 -205.46685282389322 208.80018615722656 -208.80018615722656 curveto
208.80018615722656 -219.80018615722656 lineto
280.8001708984375 -219.80018615722656 lineto
280.8001708984375 -208.80018615722656 lineto
280.8001708984375 -205.46685282389322 279.8001708984375 -203.80018615722656 277.8001708984375 -203.80018615722656 curveto
211.80018615722656 -203.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -222.80018615722656 moveto
208.80018615722656 -257.8001708984375 lineto
280.8001708984375 -257.8001708984375 lineto
280.8001708984375 -222.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -54.0 lineto
15.0 -56.666666666666664 16.0 -58.0 18.0 -58.0 curveto
84.0 -58.0 lineto
84.0 -58.0 lineto
86.0 -58.0 87.0 -56.666666666666664 87.0 -54.0 curveto
87.0 -22.0 lineto
87.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -54.0 lineto
15.0 -56.666666666666664 16.0 -58.0 18.0 -58.0 curveto
84.0 -58.0 lineto
84.0 -58.0 lineto
86.0 -58.0 87.0 -56.666666666666664 87.0 -54.0 curveto
87.0 -22.0 lineto
87.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -54.0 lineto
111.0 -56.666666666666664 112.0 -58.0 114.0 -58.0 curveto
180.0 -58.0 lineto
180.0 -58.0 lineto
182.0 -58.0 183.0 -56.666666666666664 183.0 -54.0 curveto
183.0 -22.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -54.0 lineto
111.0 -56.666666666666664 112.0 -58.0 114.0 -58.0 curveto
180.0 -58.0 lineto
180.0 -58.0 lineto
182.0 -58.0 183.0 -56.666666666666664 183.0 -54.0 curveto
183.0 -22.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -54.0 lineto
207.0 -56.666666666666664 208.0 -58.0 210.0 -58.0 curveto
276.0 -58.0 lineto
276.0 -58.0 lineto
278.0 -58.0 279.0 -56.666666666666664 279.0 -54.0 curveto
279.0 -22.0 lineto
279.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -54.0 lineto
207.0 -56.666666666666664 208.0 -58.0 210.0 -58.0 curveto
276.0 -58.0 lineto
276.0 -58.0 lineto
278.0 -58.0 279.0 -56.666666666666664 279.0 -54.0 curveto
279.0 -22.0 lineto
279.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -112.0 moveto
112.0 -112.0 111.0 -113.66666666666667 111.0 -117.0 curveto
111.0 -144.0 lineto
111.0 -146.66666666666666 112.0 -148.0 114.0 -148.0 curveto
180.0 -148.0 lineto
180.0 -148.0 lineto
182.0 -148.0 183.0 -146.66666666666666 183.0 -144.0 curveto
183.0 -117.0 lineto
183.0 -117.0 lineto
183.0 -113.66666666666667 182.0 -112.0 180.0 -112.0 curveto
114.0 -112.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -112.0 moveto
112.0 -112.0 111.0 -113.66666666666667 111.0 -117.0 curveto
111.0 -144.0 lineto
111.0 -146.66666666666666 112.0 -148.0 114.0 -148.0 curveto
180.0 -148.0 lineto
180.0 -148.0 lineto
182.0 -148.0 183.0 -146.66666666666666 183.0 -144.0 curveto
183.0 -117.0 lineto
183.0 -117.0 lineto
183.0 -113.66666666666667 182.0 -112.0 180.0 -112.0 curveto
114.0 -112.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -202.0 moveto
16.0 -202.0 15.0 -203.66666666666666 15.0 -207.0 curveto
15.0 -218.0 lineto
87.0 -218.0 lineto
87.0 -207.0 lineto
87.0 -203.66666666666666 86.0 -202.0 84.0 -202.0 curveto
18.0 -202.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -202.0 moveto
16.0 -202.0 15.0 -203.66666666666666 15.0 -207.0 curveto
15.0 -218.0 lineto
87.0 -218.0 lineto
87.0 -207.0 lineto
87.0 -203.66666666666666 86.0 -202.0 84.0 -202.0 curveto
18.0 -202.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -221.0 moveto
15.0 -256.0 lineto
87.0 -256.0 lineto
87.0 -221.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -221.0 moveto
15.0 -256.0 lineto
87.0 -256.0 lineto
87.0 -221.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -202.0 moveto
112.0 -202.0 111.0 -203.66666666666666 111.0 -207.0 curveto
111.0 -218.0 lineto
183.0 -218.0 lineto
183.0 -207.0 lineto
183.0 -203.66666666666666 182.0 -202.0 180.0 -202.0 curveto
114.0 -202.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -202.0 moveto
112.0 -202.0 111.0 -203.66666666666666 111.0 -207.0 curveto
111.0 -218.0 lineto
183.0 -218.0 lineto
183.0 -207.0 lineto
183.0 -203.66666666666666 182.0 -202.0 180.0 -202.0 curveto
114.0 -202.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -221.0 moveto
111.0 -256.0 lineto
183.0 -256.0 lineto
183.0 -221.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -221.0 moveto
111.0 -256.0 lineto
183.0 -256.0 lineto
183.0 -221.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -202.0 moveto
208.0 -202.0 207.0 -203.66666666666666 207.0 -207.0 curveto
207.0 -218.0 lineto
279.0 -218.0 lineto
279.0 -207.0 lineto
279.0 -203.66666666666666 278.0 -202.0 276.0 -202.0 curveto
210.0 -202.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -202.0 moveto
208.0 -202.0 207.0 -203.66666666666666 207.0 -207.0 curveto
207.0 -218.0 lineto
279.0 -218.0 lineto
279.0 -207.0 lineto
279.0 -203.66666666666666 278.0 -202.0 276.0 -202.0 curveto
210.0 -202.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -221.0 moveto
207.0 -256.0 lineto
279.0 -256.0 lineto
279.0 -221.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -221.0 moveto
207.0 -256.0 lineto
279.0 -256.0 lineto
279.0 -221.0 lineto
closepath
stroke
newpath
51.0 -63.0 moveto
48.0 -72.0 lineto
54.0 -72.0 lineto
closepath
fill
newpath
147.0 -63.0 moveto
144.0 -72.0 lineto
150.0 -72.0 lineto
closepath
fill
newpath
243.0 -63.0 moveto
240.0 -72.0 lineto
246.0 -72.0 lineto
closepath
fill
newpath
144.0 -99.0 moveto
147.0 -108.0 lineto
150.0 -99.0 lineto
closepath
fill
newpath
147.0 -153.0 moveto
144.0 -162.0 lineto
150.0 -162.0 lineto
closepath
fill
newpath
48.0 -189.0 moveto
51.0 -198.0 lineto
54.0 -189.0 lineto
closepath
fill
newpath
144.0 -189.0 moveto
147.0 -198.0 lineto
150.0 -189.0 lineto
closepath
fill
newpath
240.0 -189.0 moveto
243.0 -198.0 lineto
246.0 -189.0 lineto
closepath
fill
newpath
51.0 -67.0 moveto
51.0 -81.0 lineto
51.0 -83.66666666666667 52.0 -85.0 54.0 -85.0 curveto
147.0 -85.0 lineto
147.0 -85.0 lineto
stroke
newpath
147.0 -67.0 moveto
147.0 -85.0 lineto
stroke
newpath
243.0 -67.0 moveto
243.0 -81.0 lineto
243.0 -83.66666666666667 242.0 -85.0 240.0 -85.0 curveto
147.0 -85.0 lineto
147.0 -85.0 lineto
stroke
newpath
147.0 -103.0 moveto
147.0 -85.0 lineto
stroke
newpath
147.0 -157.0 moveto
147.0 -175.0 lineto
stroke
newpath
51.0 -193.0 moveto
51.0 -180.0 lineto
51.0 -176.66666666666666 52.0 -175.0 54.0 -175.0 curveto
147.0 -175.0 lineto
147.0 -175.0 lineto
stroke
newpath
147.0 -193.0 moveto
147.0 -175.0 lineto
stroke
newpath
243.0 -193.0 moveto
243.0 -180.0 lineto
243.0 -176.66666666666666 242.0 -175.0 240.0 -175.0 curveto
147.0 -175.0 lineto
147.0 -175.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
34.0 -44.0 moveto
(Client) show
130.0 -44.0 moveto
(Client) show
226.0 -44.0 moveto
(Client) show
18.0 -98.0 moveto
("Give me coffee") show
209.0 -98.0 moveto
("Give me tea") show
128.0 -134.0 moveto
(Broker) show
31.0 -215.0 moveto
("Water") show
133.0 -215.0 moveto
("Tea") show
219.0 -215.0 moveto
("Coffee") show
30.0 -242.0 moveto
(Worker) show
126.0 -242.0 moveto
(Worker) show
222.0 -242.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2539 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2539 a 274 x Fk(T)-7 b(o)21
b(implement)e(Majordomo)e(we)k(need)e(to)i(write)f(a)h(frame)n(w)o(ork)
d(for)h(clients)i(and)e(w)o(ork)o(ers.)h(It')-5 b(s)21
b(really)e(not)h(sane)h(to)396 2921 y(ask)g(e)n(v)o(ery)e(application)f
(de)n(v)o(eloper)g(to)i(read)g(the)g(spec)g(and)g(mak)o(e)g(it)h(w)o
(ork,)e(when)h(the)o(y)f(could)g(be)h(using)g(a)h(simpler)396
3029 y(API)g(b)n(uilt)f(and)g(tested)g(just)h(once.)-2
3213 y
SDict begin H.S end
 -2 3213 a -2 3213 a
SDict begin 13 H.A end
 -2 3213 a -2 3213 a
SDict begin [/View [/XYZ H.V]/Dest (0:2256) cvn /DEST pdfmark end
 -2 3213
a 396 3303 a Fk(So,)f(while)h(our)e(\002rst)i(contract)e(\(MDP)i
(itself\))f(de\002nes)g(ho)n(w)g(the)g(pieces)g(of)g(our)f(distrib)n
(uted)h(architecture)e(talk)i(to)396 3411 y(each)g(other)m(,)f(our)g
(second)h(contract)f(de\002nes)h(ho)n(w)f(user)h(applications)f(talk)i
(to)f(the)g(technical)g(frame)n(w)o(ork)e(we')l(re)396
3519 y(going)h(to)h(design.)-2 3703 y
SDict begin H.S end
 -2 3703 a -2 3703
a
SDict begin 13 H.A end
 -2 3703 a -2 3703 a
SDict begin [/View [/XYZ H.V]/Dest (0:2257) cvn /DEST pdfmark end
 -2 3703 a 396 3792 a Fk(Majordomo)e(has)i(tw)o(o)
h(halv)o(es,)e(a)i(client)f(side)h(and)e(a)i(w)o(ork)o(er)e(side.)h
(Since)h(we')o(ll)f(write)h(both)e(client)h(and)g(w)o(ork)o(er)396
3900 y(applications,)f(we)i(will)g(need)e(tw)o(o)h(APIs.)h(Here)f(is)h
(a)g(sk)o(etch)f(for)f(the)i(client)f(API,)g(using)g(a)g(simple)h
(object-oriented)396 4008 y(approach.)d(W)-7 b(e)21 b(write)g(this)f
(in)h(C,)g(using)e(the)i(style)f(of)g(the)2098 4008 y
SDict begin H.S end

2098 4008 a 2098 4008 a
SDict begin 13 H.A end
 2098 4008 a 2098 4008 a
SDict begin [/View [/XYZ H.V]/Dest (0:2258) cvn /DEST pdfmark end
 2098
4008 a Fk(CZMQ)h(binding)d(\(http://czmq.zeromq.or)o(g/\):)-2
4109 y
SDict begin H.S end
 -2 4109 a -2 4109 a
SDict begin 11.7 H.A end
 -2 4109 a -2 4109 a
SDict begin [/View [/XYZ H.V]/Dest (0:2259) cvn /DEST pdfmark end
 -2 4109
a 396 4189 a Fe(mdcli_t)755 4202 y(*)800 4189 y(mdcli_new)222
b(\(char)1696 4202 y(*)1741 4189 y(broker\);)396 4286
y(void)i(mdcli_destroy)42 b(\(mdcli_t)1831 4299 y(**)1921
4286 y(self_p\);)396 4383 y(zmsg_t)755 4396 y(*)800 4383
y(mdcli_send)177 b(\(mdcli_t)1831 4396 y(*)1876 4383
y(self,)44 b(char)2369 4396 y(*)2414 4383 y(service,)f(zmsg_t)3131
4396 y(**)3221 4383 y(request_p\);)-2 4560 y
SDict begin H.S end
 -2 4560
a -2 4560 a
SDict begin 13 H.A end
 -2 4560 a -2 4560 a
SDict begin [/View [/XYZ H.V]/Dest (0:2260) cvn /DEST pdfmark end
 -2 4560 a 396 4657 a
Fk(That')-5 b(s)21 b(it.)f(W)-7 b(e)22 b(open)d(a)h(session)h(to)f(the)
h(brok)o(er)m(,)d(we)i(send)g(a)h(request)e(message)h(and)g(get)g(a)h
(reply)e(message)h(back,)f(and)396 4765 y(we)i(e)n(v)o(entually)d
(close)i(the)h(connection.)d(Here')-5 b(s)20 b(a)h(sk)o(etch)f(for)f
(the)h(w)o(ork)o(er)g(API:)-2 4866 y
SDict begin H.S end
 -2 4866 a -2 4866
a
SDict begin 11.7 H.A end
 -2 4866 a -2 4866 a
SDict begin [/View [/XYZ H.V]/Dest (0:2261) cvn /DEST pdfmark end
 -2 4866 a 396 4945 a Fe(mdwrk_t)755
4958 y(*)800 4945 y(mdwrk_new)222 b(\(char)1696 4958
y(*)1741 4945 y(broker,char)2279 4958 y(*)2324 4945 y(service\);)396
5042 y(void)i(mdwrk_destroy)42 b(\(mdwrk_t)1831 5055
y(**)1921 5042 y(self_p\);)396 5139 y(zmsg_t)755 5152
y(*)800 5139 y(mdwrk_recv)177 b(\(mdwrk_t)1831 5152 y(*)1876
5139 y(self,)44 b(zmsg_t)2459 5152 y(*)2504 5139 y(reply\);)p
Black 3759 5569 a Ff(171)p Black eop end
%%Page: 172 185
TeXDict begin 172 184 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.172) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2262) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(It')-5 b(s)21 b(more)e(or)h(less)i(symmetrical)d(b)n
(ut)h(the)g(w)o(ork)o(er)g(dialog)f(is)i(a)g(little)g(dif)n(ferent.)d
(The)i(\002rst)h(time)f(a)h(w)o(ork)o(er)e(does)h(a)396
180 y(recv\(\),)f(it)i(passes)g(a)f(null)g(reply)-5 b(,)19
b(thereafter)g(it)i(passes)g(the)f(current)f(reply)-5
b(,)18 b(and)i(gets)h(a)f(ne)n(w)g(request.)-2 364 y
SDict begin H.S end

-2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:2263) cvn /DEST pdfmark end
 -2 364 a 396 454
a Fk(The)g(client)g(and)g(w)o(ork)o(er)f(APIs)i(were)f(f)o(airly)g
(simple)g(to)g(construct,)f(since)i(the)o(y')l(re)d(hea)n(vily)i(based)
f(on)h(the)g(P)o(aranoid)396 562 y(Pirate)h(code)e(we)i(already)e(de)n
(v)o(eloped.)e(Here)j(is)h(the)g(client)f(API:)-2 580
y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi-c) cvn /DEST pdfmark
end
 -2 580 a 396 764
a Fg(Example)h(4-18.)d(Majordomo)h(client)i(API)g(\(mdcliapi.c\))-2
864 y
SDict begin H.S end
 -2 864 a -2 864 a
SDict begin 11.7 H.A end
 -2 864 a -2 864 a
SDict begin [/View [/XYZ H.V]/Dest (0:2266) cvn /DEST pdfmark end
 -2 864 a 396
944 a Fe(/)441 957 y(*)576 944 y(=====================================)
o(======)o(======)o(======)o(======)o(=====)o(===)441
1054 y(*)576 1041 y(mdcliapi.c)43 b(-)h(Majordomo)g(Protocol)f(Client)h
(API)441 1151 y(*)576 1138 y(Implements)f(the)h(MDP/Worker)f(spec)h(at)
h(http://rfc.zeromq.org/spec:7.)441 1248 y(*)576 1235
y(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 1248 y(*)3759 1235 y(/)396
1429 y(#include)f("mdcliapi.h")396 1624 y(//)90 b(Structure)43
b(of)h(our)h(class)396 1721 y(//)90 b(We)44 b(access)g(these)g
(properties)f(only)h(via)h(class)f(methods)396 1915 y(struct)g
(_mdcli_t)g({)576 2012 y(zctx_t)889 2025 y(*)934 2012
y(ctx;)717 b(//)89 b(Our)45 b(context)576 2109 y(char)800
2122 y(*)845 2109 y(broker;)576 2207 y(void)800 2220
y(*)845 2207 y(client;)671 b(//)89 b(Socket)44 b(to)h(broker)576
2304 y(int)f(verbose;)716 b(//)89 b(Print)44 b(activity)g(to)g(stdout)
576 2401 y(int)g(timeout;)716 b(//)89 b(Request)44 b(timeout)576
2498 y(int)g(retries;)716 b(//)89 b(Request)44 b(retries)396
2595 y(};)396 2887 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
2984 y(//)g(Connect)43 b(or)i(reconnect)e(to)i(broker)396
3178 y(void)f(s_mdcli_connect_to_broker)d(\(mdcli_t)2190
3191 y(*)2235 3178 y(self\))396 3275 y({)576 3372 y(if)j
(\(self->client\))755 3469 y(zsocket_destroy)e(\(self->ctx,)h
(self->client\);)576 3566 y(self->client)f(=)j(zsocket_new)e
(\(self->ctx,)g(ZMQ_REQ\);)576 3664 y(zmq_connect)g(\(self->client,)f
(self->broker\);)576 3761 y(if)i(\(self->verbose\))755
3858 y(zclock_log)f(\("I:)h(connecting)f(to)i(broker)f(at)g(\045s...",)
g(self->broker\);)396 3955 y(})-2 4129 y
SDict begin H.S end
 -2 4129 a -2
4129 a
SDict begin 13 H.A end
 -2 4129 a -2 4129 a
SDict begin [/View [/XYZ H.V]/Dest (0:2267) cvn /DEST pdfmark end
 -2 4129 a 396 4229 a Fk(Here)20
b(we)h(ha)n(v)o(e)e(the)i(constructor)d(and)i(destructor)e(for)i(our)f
(mdcli)h(class:)-2 4230 y
SDict begin H.S end
 -2 4230 a -2 4230 a
SDict begin 13 H.A end
 -2 4230
a -2 4230 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi-c-1) cvn /DEST pdfmark
end
 -2 4230 a 396 4430 a Fg(Example)h(4-19.)d(Majordomo)h
(client)i(API)g(\(mdcliapi.c\))e(-)i(constructor)e(and)h(destructor)-2
4530 y
SDict begin H.S end
 -2 4530 a -2 4530 a
SDict begin 11.7 H.A end
 -2 4530 a -2 4530 a
SDict begin [/View [/XYZ H.V]/Dest (0:2270) cvn /DEST pdfmark end
 -2 4530
a 396 4805 a Fe(//)90 b(-------------------------------------)o(------)
o(------)o(------)o(------)o(-----)o(---)396 4902 y(//)g(Constructor)
396 5096 y(mdcli_t)755 5109 y(*)p Black 3759 5569 a Ff(172)p
Black eop end
%%Page: 173 186
TeXDict begin 173 185 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.173) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(mdcli_new)44 b(\(char)1114 85 y(*)1159
72 y(broker,)f(int)h(verbose\))396 170 y({)576 267 y(assert)f
(\(broker\);)576 461 y(mdcli_t)934 474 y(*)979 461 y(self)h(=)h
(\(mdcli_t)1696 474 y(*)1741 461 y(\))g(zmalloc)f(\(sizeof)f
(\(mdcli_t\)\);)576 558 y(self->ctx)g(=)i(zctx_new)e(\(\);)576
655 y(self->broker)f(=)j(strdup)f(\(broker\);)576 752
y(self->verbose)e(=)j(verbose;)576 850 y(self->timeout)d(=)j(2500;)492
b(//)90 b(msecs)576 947 y(self->retries)42 b(=)j(3;)627
b(//)90 b(Before)43 b(we)i(abandon)576 1141 y
(s_mdcli_connect_to_broker)40 b(\(self\);)576 1238 y(return)j(self;)396
1335 y(})396 1627 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
1724 y(//)g(Destructor)396 1918 y(void)396 2015 y(mdcli_destroy)43
b(\(mdcli_t)1427 2028 y(**)1517 2015 y(self_p\))396 2112
y({)576 2209 y(assert)g(\(self_p\);)576 2307 y(if)h(\()755
2320 y(*)800 2307 y(self_p\))f({)755 2404 y(mdcli_t)1114
2417 y(*)1159 2404 y(self)h(=)1472 2417 y(*)1517 2404
y(self_p;)755 2501 y(zctx_destroy)f(\(&self->ctx\);)755
2598 y(free)h(\(self->broker\);)755 2695 y(free)g(\(self\);)755
2805 y(*)800 2792 y(self_p)g(=)g(NULL;)576 2889 y(})396
2987 y(})-2 3161 y
SDict begin H.S end
 -2 3161 a -2 3161 a
SDict begin 13 H.A end
 -2 3161 a -2 3161
a
SDict begin [/View [/XYZ H.V]/Dest (0:2271) cvn /DEST pdfmark end
 -2 3161 a 396 3261 a Fk(These)19 b(are)h(the)f(class)i(methods.)d(W)
-7 b(e)20 b(can)f(set)i(the)e(request)g(timeout)g(and)f(number)g(of)h
(retry)g(attempts,)g(before)f(sending)396 3368 y(requests:)-2
3386 y
SDict begin H.S end
 -2 3386 a -2 3386 a
SDict begin 13 H.A end
 -2 3386 a -2 3386 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi-c-2) cvn /DEST pdfmark
end
 -2 3386
a 396 3570 a Fg(Example)j(4-20.)d(Majordomo)h(client)i(API)g
(\(mdcliapi.c\))e(-)i(con\002gur)o(e)e(r)o(etry)g(beha)n(vior)-2
3670 y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 11.7 H.A end
 -2 3670 a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:2274) cvn /DEST pdfmark end
 -2 3670
a 396 3944 a Fe(//)90 b(-------------------------------------)o(------)
o(------)o(------)o(------)o(-----)o(---)396 4041 y(//)g(Set)44
b(request)g(timeout)396 4236 y(void)396 4333 y(mdcli_set_timeout)e
(\(mdcli_t)1607 4346 y(*)1652 4333 y(self,)i(int)g(timeout\))396
4430 y({)576 4527 y(assert)f(\(self\);)576 4624 y(self->timeout)f(=)j
(timeout;)396 4721 y(})396 5013 y(//)90 b
(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(---)396 5110 y(//)g(Set)44 b(request)g(retries)p
Black 3759 5569 a Ff(173)p Black eop end
%%Page: 174 187
TeXDict begin 174 186 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.174) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 170 a Fe(void)396 267 y(mdcli_set_retries)42
b(\(mdcli_t)1607 280 y(*)1652 267 y(self,)i(int)g(retries\))396
364 y({)576 461 y(assert)f(\(self\);)576 558 y(self->retries)f(=)j
(retries;)396 655 y(})-2 830 y
SDict begin H.S end
 -2 830 a -2 830 a
SDict begin 13 H.A end
 -2 830
a -2 830 a
SDict begin [/View [/XYZ H.V]/Dest (0:2275) cvn /DEST pdfmark end
 -2 830 a 396 929 a Fk(Here)20 b(is)h(the)g(send)f(method.)e
(It)j(sends)f(a)g(request)g(to)g(the)h(brok)o(er)d(and)i(gets)g(a)h
(reply)e(e)n(v)o(en)g(if)i(it)g(has)f(to)h(retry)e(se)n(v)o(eral)396
1037 y(times.)i(It)f(tak)o(es)h(o)n(wnership)d(of)i(the)g(request)g
(message,)g(and)f(destro)o(ys)h(it)h(when)e(sent.)i(It)f(returns)f(the)
i(reply)e(message,)396 1145 y(or)h(NULL)g(if)h(there)e(w)o(as)i(no)f
(reply)g(after)f(multiple)h(attempts:)-2 1163 y
SDict begin H.S end
 -2 1163
a -2 1163 a
SDict begin 13 H.A end
 -2 1163 a -2 1163 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi-c-3) cvn /DEST pdfmark
end
 -2 1163 a 396 1346 a
Fg(Example)h(4-21.)d(Majordomo)h(client)i(API)g(\(mdcliapi.c\))e(-)i
(send)g(r)o(equest)f(and)h(wait)f(f)n(or)f(r)o(eply)-2
1446 y
SDict begin H.S end
 -2 1446 a -2 1446 a
SDict begin 11.7 H.A end
 -2 1446 a -2 1446 a
SDict begin [/View [/XYZ H.V]/Dest (0:2278) cvn /DEST pdfmark end
 -2 1446
a 396 1721 a Fe(zmsg_t)710 1734 y(*)396 1818 y(mdcli_send)43
b(\(mdcli_t)1293 1831 y(*)1338 1818 y(self,)h(char)1831
1831 y(*)1876 1818 y(service,)f(zmsg_t)2593 1831 y(**)2683
1818 y(request_p\))396 1915 y({)576 2012 y(assert)g(\(self\);)576
2109 y(assert)g(\(request_p\);)576 2207 y(zmsg_t)889
2220 y(*)934 2207 y(request)h(=)1383 2220 y(*)1428 2207
y(request_p;)576 2401 y(//)89 b(Prefix)44 b(request)f(with)i(protocol)e
(frames)576 2498 y(//)89 b(Frame)44 b(1:)g("MDPCxy")g(\(six)g(bytes,)g
(MDP/Client)f(x.y\))576 2595 y(//)89 b(Frame)44 b(2:)g(Service)g(name)g
(\(printable)f(string\))576 2692 y(zmsg_pushstr)f(\(request,)i
(service\);)576 2789 y(zmsg_pushstr)e(\(request,)i(MDPC_CLIENT\);)576
2887 y(if)g(\(self->verbose\))e({)755 2984 y(zclock_log)h(\("I:)h(send)
g(request)g(to)h('\045s')f(service:",)f(service\);)755
3081 y(zmsg_dump)g(\(request\);)576 3178 y(})576 3275
y(int)h(retries_left)f(=)h(self->retries;)576 3372 y(while)g
(\(retries_left)e(&&)j(!zctx_interrupted\))d({)755 3469
y(zmsg_t)1069 3482 y(*)1114 3469 y(msg)i(=)h(zmsg_dup)e(\(request\);)
755 3566 y(zmsg_send)g(\(&msg,)h(self->client\);)755
3761 y(zmq_pollitem_t)e(items)i([])h(=)g({)934 3858 y({)g
(self->client,)e(0,)h(ZMQ_POLLIN,)f(0)i(})755 3955 y(};)-2
4129 y
SDict begin H.S end
 -2 4129 a -2 4129 a
SDict begin 13 H.A end
 -2 4129 a -2 4129 a
SDict begin [/View [/XYZ H.V]/Dest (0:2279) cvn /DEST pdfmark end
 -2 4129
a 396 4229 a Fk(On)20 b(an)o(y)g(blocking)e(call,)j(libzmq)e(will)i
(return)e(-1)h(if)g(there)g(w)o(as)h(an)f(error;)f(we)i(could)e(in)h
(theory)f(check)h(for)f(dif)n(ferent)396 4337 y(error)g(codes)h(b)n(ut)
g(in)h(practice)e(it')-5 b(s)21 b(OK)g(to)f(assume)h(it)g(w)o(as)g
(EINTR)f(\(Ctrl-C\):)-2 4355 y
SDict begin H.S end
 -2 4355 a -2 4355 a
SDict begin 13 H.A end
 -2
4355 a -2 4355 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi-c-4) cvn /DEST pdfmark
end
 -2 4355 a 396 4538 a Fg(Example)h(4-22.)d(Majordomo)h
(client)i(API)g(\(mdcliapi.c\))e(-)i(body)f(of)g(send)-2
4638 y
SDict begin H.S end
 -2 4638 a -2 4638 a
SDict begin 11.7 H.A end
 -2 4638 a -2 4638 a
SDict begin [/View [/XYZ H.V]/Dest (0:2282) cvn /DEST pdfmark end
 -2 4638
a 755 4718 a Fe(int)44 b(rc)h(=)f(zmq_poll)g(\(items,)g(1,)g
(self->timeout)2683 4731 y(*)2772 4718 y(ZMQ_POLL_MSEC\);)755
4816 y(if)g(\(rc)h(==)f(-1\))934 4913 y(break;)448 b(//)89
b(Interrupted)755 5107 y(//)g(If)45 b(we)f(got)h(a)f(reply,)g(process)g
(it)p Black 3759 5569 a Ff(174)p Black eop end
%%Page: 175 188
TeXDict begin 175 187 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.175) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(if)44 b(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)
934 170 y(zmsg_t)1248 183 y(*)1293 170 y(msg)h(=)h(zmsg_recv)e
(\(self->client\);)934 267 y(if)i(\(self->verbose\))d({)1114
364 y(zclock_log)h(\("I:)h(received)f(reply:"\);)1114
461 y(zmsg_dump)g(\(msg\);)934 558 y(})934 655 y(//)90
b(We)44 b(would)g(handle)g(malformed)f(replies)h(better)g(in)g(real)g
(code)934 752 y(assert)g(\(zmsg_size)f(\(msg\))h(>=)h(3\);)934
947 y(zframe_t)1338 960 y(*)1383 947 y(header)e(=)i(zmsg_pop)f
(\(msg\);)934 1044 y(assert)g(\(zframe_streq)f(\(header,)g
(MDPC_CLIENT\)\);)934 1141 y(zframe_destroy)g(\(&header\);)934
1335 y(zframe_t)1338 1348 y(*)1383 1335 y(reply_service)f(=)j(zmsg_pop)
e(\(msg\);)934 1432 y(assert)h(\(zframe_streq)f(\(reply_service,)f
(service\)\);)934 1530 y(zframe_destroy)h(\(&reply_service\);)934
1724 y(zmsg_destroy)g(\(&request\);)934 1821 y(return)h(msg;)224
b(//)89 b(Success)755 1918 y(})755 2015 y(else)755 2112
y(if)44 b(\(--retries_left\))f({)934 2209 y(if)i(\(self->verbose\))1114
2307 y(zclock_log)e(\("W:)h(no)g(reply,)g(reconnecting..."\);)934
2404 y(s_mdcli_connect_to_broker)d(\(self\);)755 2501
y(})755 2598 y(else)j({)934 2695 y(if)h(\(self->verbose\))1114
2792 y(zclock_log)e(\("W:)h(permanent)f(error,)h(abandoning"\);)934
2889 y(break;)448 b(//)89 b(Give)44 b(up)755 2987 y(})576
3084 y(})576 3181 y(if)g(\(zctx_interrupted\))755 3278
y(printf)g(\("W:)g(interrupt)f(received,)h(killing)f(client...\\n"\);)
576 3375 y(zmsg_destroy)f(\(&request\);)576 3472 y(return)h(NULL;)396
3569 y(})-2 3744 y
SDict begin H.S end
 -2 3744 a -2 3744 a
SDict begin 13 H.A end
 -2 3744 a -2 3744
a
SDict begin [/View [/XYZ H.V]/Dest (0:2283) cvn /DEST pdfmark end
 -2 3744 a 396 3843 a Fk(W)m(ith)21 b(an)f(e)o(xample)f(test)i
(program)d(that)i(does)g(100K)f(request-reply)f(c)o(ycles:)-2
3861 y
SDict begin H.S end
 -2 3861 a -2 3861 a
SDict begin 13 H.A end
 -2 3861 a -2 3861 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdclient-c) cvn /DEST pdfmark
end
 -2 3861
a 396 4045 a Fg(Example)j(4-23.)d(Majordomo)h(client)i(application)e
(\(mdclient.c\))-2 4145 y
SDict begin H.S end
 -2 4145 a -2 4145 a
SDict begin 11.7 H.A end
 -2 4145
a -2 4145 a
SDict begin [/View [/XYZ H.V]/Dest (0:2286) cvn /DEST pdfmark end
 -2 4145 a 396 4225 a Fe(//)396 4322 y(//)90
b(Majordomo)43 b(Protocol)g(client)h(example)396 4419
y(//)90 b(Uses)44 b(the)g(mdcli)g(API)g(to)h(hide)f(all)g(MDP)h
(aspects)396 4516 y(//)396 4711 y(//)90 b(Lets)44 b(us)g(build)g(this)g
(source)g(without)g(creating)f(a)i(library)396 4808 y(#include)f
("mdcliapi.c")396 5002 y(int)h(main)f(\(int)g(argc,)g(char)1517
5015 y(*)1562 5002 y(argv)g([]\))396 5099 y({)p Black
3759 5569 a Ff(175)p Black eop end
%%Page: 176 189
TeXDict begin 176 188 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.176) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(int)44 b(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g
(\(argv)g([1],)g("-v"\)\);)576 170 y(mdcli_t)934 183
y(*)979 170 y(session)g(=)g(mdcli_new)g(\("tcp://localhost:5555",)d
(verbose\);)576 364 y(int)j(count;)576 461 y(for)g(\(count)g(=)g(0;)h
(count)f(<)h(100000;)e(count++\))h({)755 558 y(zmsg_t)1069
571 y(*)1114 558 y(request)f(=)i(zmsg_new)e(\(\);)755
655 y(zmsg_pushstr)g(\(request,)g("Hello)h(world"\);)755
752 y(zmsg_t)1069 765 y(*)1114 752 y(reply)g(=)g(mdcli_send)f
(\(session,)h("echo",)f(&request\);)755 850 y(if)h(\(reply\))934
947 y(zmsg_destroy)f(\(&reply\);)755 1044 y(else)934
1141 y(break;)627 b(//)89 b(Interrupt)44 b(or)g(failure)576
1238 y(})576 1335 y(printf)f(\("\045d)i(requests/replies)d
(processed\\n",)g(count\);)576 1432 y(mdcli_destroy)g(\(&session\);)576
1530 y(return)h(0;)396 1627 y(})-2 1801 y
SDict begin H.S end
 -2 1801 a -2
1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:2287) cvn /DEST pdfmark end
 -2 1801 a 396 1901 a Fk(And)20
b(here)g(is)h(the)f(w)o(ork)o(er)f(API:)-2 1902 y
SDict begin H.S end
 -2
1902 a -2 1902 a
SDict begin 13 H.A end
 -2 1902 a -2 1902 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c) cvn /DEST pdfmark
end
 -2 1902 a 396 2102
a Fg(Example)i(4-24.)d(Majordomo)h(w)o(ork)o(er)i(API)f(\(md)o
(wrkapi.c\))-2 2202 y
SDict begin H.S end
 -2 2202 a -2 2202 a
SDict begin 11.7 H.A end
 -2 2202 a -2
2202 a
SDict begin [/View [/XYZ H.V]/Dest (0:2290) cvn /DEST pdfmark end
 -2 2202 a 396 2282 a Fe(/)441 2295 y(*)576 2282
y(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)441 2392 y(*)576 2379 y(mdwrkapi.c)43
b(-)h(Majordomo)g(Protocol)f(Worker)h(API)441 2489 y(*)576
2476 y(Implements)f(the)h(MDP/Worker)f(spec)h(at)h
(http://rfc.zeromq.org/spec:7.)441 2587 y(*)576 2574
y(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 2587 y(*)3759 2574 y(/)396
2768 y(#include)f("mdwrkapi.h")396 2962 y(//)90 b(Reliability)43
b(parameters)396 3059 y(#define)h(HEARTBEAT_LIVENESS)87
b(3)313 b(//)90 b(3-5)44 b(is)g(reasonable)-2 3235 y
SDict begin H.S end

-2 3235 a -2 3235 a
SDict begin 13 H.A end
 -2 3235 a -2 3235 a
SDict begin [/View [/XYZ H.V]/Dest (0:2291) cvn /DEST pdfmark end
 -2 3235 a 396
3333 a Fk(This)21 b(is)g(the)f(structure)f(of)h(a)h(w)o(ork)o(er)e(API)
h(instance.)g(W)-7 b(e)21 b(use)g(a)f(pseudo-OO)f(approach)f(in)i(a)h
(lot)f(of)g(the)g(C)i(e)o(xamples,)396 3441 y(as)f(well)g(as)g(the)f
(CZMQ)h(binding:)-2 3459 y
SDict begin H.S end
 -2 3459 a -2 3459 a
SDict begin 13 H.A end
 -2 3459
a -2 3459 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-1) cvn /DEST pdfmark
end
 -2 3459 a 396 3642 a Fg(Example)g(4-25.)d(Majordomo)h(w)o
(ork)o(er)i(API)f(\(md)o(wrkapi.c\))g(-)g(w)o(ork)o(er)h(class)f
(structur)o(e)-2 3742 y
SDict begin H.S end
 -2 3742 a -2 3742 a
SDict begin 11.7 H.A end
 -2 3742 a
-2 3742 a
SDict begin [/View [/XYZ H.V]/Dest (0:2294) cvn /DEST pdfmark end
 -2 3742 a 396 3920 a Fe(//)90 b(Structure)43
b(of)h(our)h(class)396 4017 y(//)90 b(We)44 b(access)g(these)g
(properties)f(only)h(via)h(class)f(methods)396 4211 y(struct)g
(_mdwrk_t)g({)576 4308 y(zctx_t)889 4321 y(*)934 4308
y(ctx;)717 b(//)89 b(Our)45 b(context)576 4405 y(char)800
4418 y(*)845 4405 y(broker;)576 4503 y(char)800 4516
y(*)845 4503 y(service;)576 4600 y(void)800 4613 y(*)845
4600 y(worker;)671 b(//)89 b(Socket)44 b(to)h(broker)576
4697 y(int)f(verbose;)716 b(//)89 b(Print)44 b(activity)g(to)g(stdout)
576 4891 y(//)89 b(Heartbeat)43 b(management)576 4988
y(uint64_t)g(heartbeat_at;)267 b(//)89 b(When)44 b(to)h(send)f
(HEARTBEAT)576 5085 y(size_t)f(liveness;)537 b(//)89
b(How)45 b(many)f(attempts)f(left)p Black 3757 5569 a
Ff(176)p Black eop end
%%Page: 177 190
TeXDict begin 177 189 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.177) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(int)44 b(heartbeat;)626 b(//)89 b(Heartbeat)44
b(delay,)f(msecs)576 170 y(int)h(reconnect;)626 b(//)89
b(Reconnect)44 b(delay,)f(msecs)576 364 y(int)h(expect_reply;)491
b(//)89 b(Zero)44 b(only)h(at)f(start)576 461 y(zframe_t)979
474 y(*)1024 461 y(reply_to;)402 b(//)89 b(Return)44
b(address,)g(if)g(any)396 558 y(};)-2 732 y
SDict begin H.S end
 -2 732 a
-2 732 a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:2295) cvn /DEST pdfmark end
 -2 732 a 396 832 a Fk(W)-7
b(e)22 b(ha)n(v)o(e)d(tw)o(o)i(utility)f(functions;)f(to)h(send)g(a)h
(message)f(to)g(the)g(brok)o(er)f(and)g(to)i(\(re-\)connect)c(to)j(the)
h(brok)o(er:)-2 850 y
SDict begin H.S end
 -2 850 a -2 850 a
SDict begin 13 H.A end
 -2 850 a -2 850
a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-2) cvn /DEST pdfmark
end
 -2 850 a 396 1033 a Fg(Example)g(4-26.)d(Majordomo)h(w)o(ork)o(er)i
(API)f(\(md)o(wrkapi.c\))g(-)g(utility)g(functions)-2
1133 y
SDict begin H.S end
 -2 1133 a -2 1133 a
SDict begin 11.7 H.A end
 -2 1133 a -2 1133 a
SDict begin [/View [/XYZ H.V]/Dest (0:2298) cvn /DEST pdfmark end
 -2 1133
a 396 1408 a Fe(//)90 b(-------------------------------------)o(------)
o(------)o(------)o(------)o(-----)o(---)396 1505 y(//)g(Send)44
b(message)f(to)i(broker)396 1602 y(//)90 b(If)44 b(no)h(msg)f(is)g
(provided,)g(creates)f(one)i(internally)396 1796 y(static)f(void)396
1894 y(s_mdwrk_send_to_broker)d(\(mdwrk_t)1831 1907 y(*)1876
1894 y(self,)j(char)2369 1907 y(*)2414 1894 y(command,)f(char)3041
1907 y(*)3086 1894 y(option,)1472 1991 y(zmsg_t)1786
2004 y(*)1831 1991 y(msg\))396 2088 y({)576 2185 y(msg)h(=)h(msg?)f
(zmsg_dup)f(\(msg\):)h(zmsg_new)g(\(\);)576 2379 y(//)89
b(Stack)44 b(protocol)f(envelope)h(to)g(start)g(of)h(message)576
2476 y(if)f(\(option\))755 2574 y(zmsg_pushstr)f(\(msg,)h(option\);)576
2671 y(zmsg_pushstr)e(\(msg,)i(command\);)576 2768 y(zmsg_pushstr)e
(\(msg,)i(MDPW_WORKER\);)576 2865 y(zmsg_pushstr)e(\(msg,)i(""\);)576
3059 y(if)g(\(self->verbose\))e({)755 3156 y(zclock_log)h(\("I:)h
(sending)g(\045s)g(to)h(broker",)934 3253 y(mdps_commands)e([\(int\))
1876 3266 y(*)1921 3253 y(command]\);)755 3351 y(zmsg_dump)g(\(msg\);)
576 3448 y(})576 3545 y(zmsg_send)g(\(&msg,)h(self->worker\);)396
3642 y(})396 3933 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
4031 y(//)g(Connect)43 b(or)i(reconnect)e(to)i(broker)396
4225 y(void)f(s_mdwrk_connect_to_broker)d(\(mdwrk_t)2190
4238 y(*)2235 4225 y(self\))396 4322 y({)576 4419 y(if)j
(\(self->worker\))755 4516 y(zsocket_destroy)e(\(self->ctx,)h
(self->worker\);)576 4613 y(self->worker)f(=)j(zsocket_new)e
(\(self->ctx,)g(ZMQ_DEALER\);)576 4711 y(zmq_connect)g(\(self->worker,)
f(self->broker\);)576 4808 y(if)i(\(self->verbose\))755
4905 y(zclock_log)f(\("I:)h(connecting)f(to)i(broker)f(at)g(\045s...",)
g(self->broker\);)576 5099 y(//)89 b(Register)43 b(service)h(with)g
(broker)p Black 3756 5569 a Ff(177)p Black eop end
%%Page: 178 191
TeXDict begin 178 190 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.178) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(s_mdwrk_send_to_broker)41 b(\(self,)j(MDPW_READY,)f
(self->service,)f(NULL\);)576 267 y(//)89 b(If)44 b(liveness)g(hits)g
(zero,)g(queue)g(is)h(considered)e(disconnected)576 364
y(self->liveness)f(=)j(HEARTBEAT_LIVENESS;)576 461 y
(self->heartbeat_at)c(=)k(zclock_time)e(\(\))i(+)f(self->heartbeat;)396
558 y(})-2 732 y
SDict begin H.S end
 -2 732 a -2 732 a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:2299) cvn /DEST pdfmark end

-2 732 a 396 832 a Fk(Here)20 b(we)h(ha)n(v)o(e)e(the)i(constructor)d
(and)i(destructor)e(for)i(our)f(mdwrk)g(class:)-2 833
y
SDict begin H.S end
 -2 833 a -2 833 a
SDict begin 13 H.A end
 -2 833 a -2 833 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-3) cvn /DEST pdfmark
end
 -2 833 a 396 1033
a Fg(Example)i(4-27.)d(Majordomo)h(w)o(ork)o(er)i(API)f(\(md)o
(wrkapi.c\))g(-)g(constructor)f(and)i(destructor)-2 1133
y
SDict begin H.S end
 -2 1133 a -2 1133 a
SDict begin 11.7 H.A end
 -2 1133 a -2 1133 a
SDict begin [/View [/XYZ H.V]/Dest (0:2302) cvn /DEST pdfmark end
 -2 1133 a 396
1408 a Fe(//)90 b(-------------------------------------)o(------)o
(------)o(------)o(------)o(-----)o(---)396 1505 y(//)g(Constructor)396
1699 y(mdwrk_t)755 1712 y(*)396 1796 y(mdwrk_new)44 b(\(char)1114
1809 y(*)1159 1796 y(broker,char)1696 1809 y(*)1741 1796
y(service,)g(int)g(verbose\))396 1894 y({)576 1991 y(assert)f
(\(broker\);)576 2088 y(assert)g(\(service\);)576 2282
y(mdwrk_t)934 2295 y(*)979 2282 y(self)h(=)h(\(mdwrk_t)1696
2295 y(*)1741 2282 y(\))g(zmalloc)f(\(sizeof)f(\(mdwrk_t\)\);)576
2379 y(self->ctx)g(=)i(zctx_new)e(\(\);)576 2476 y(self->broker)f(=)j
(strdup)f(\(broker\);)576 2574 y(self->service)e(=)j(strdup)f
(\(service\);)576 2671 y(self->verbose)e(=)j(verbose;)576
2768 y(self->heartbeat)d(=)j(2500;)223 b(//)89 b(msecs)576
2865 y(self->reconnect)42 b(=)j(2500;)223 b(//)89 b(msecs)576
3059 y(s_mdwrk_connect_to_broker)40 b(\(self\);)576 3156
y(return)j(self;)396 3253 y(})396 3545 y(//)90 b
(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(---)396 3642 y(//)g(Destructor)396
3836 y(void)396 3933 y(mdwrk_destroy)43 b(\(mdwrk_t)1427
3946 y(**)1517 3933 y(self_p\))396 4031 y({)576 4128
y(assert)g(\(self_p\);)576 4225 y(if)h(\()755 4238 y(*)800
4225 y(self_p\))f({)755 4322 y(mdwrk_t)1114 4335 y(*)1159
4322 y(self)h(=)1472 4335 y(*)1517 4322 y(self_p;)755
4419 y(zctx_destroy)f(\(&self->ctx\);)755 4516 y(free)h
(\(self->broker\);)755 4613 y(free)g(\(self->service\);)755
4711 y(free)g(\(self\);)755 4821 y(*)800 4808 y(self_p)g(=)g(NULL;)576
4905 y(})396 5002 y(})p Black 3759 5569 a Ff(178)p Black
eop end
%%Page: 179 192
TeXDict begin 179 191 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.179) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2303) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(W)-7 b(e)22 b(pro)o(vide)c(tw)o(o)i(methods)f(to)i
(con\002gure)d(the)i(w)o(ork)o(er)f(API.)i(Y)-9 b(ou)19
b(can)h(set)h(the)f(heartbeat)f(interv)n(al)h(and)f(retries)i(to)396
180 y(match)f(the)g(e)o(xpected)f(netw)o(ork)g(performance.)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-4) cvn /DEST pdfmark
end
 -2 198 a 396
382 a Fg(Example)i(4-28.)d(Majordomo)h(w)o(ork)o(er)i(API)f(\(md)o
(wrkapi.c\))g(-)g(con\002gur)o(e)g(w)o(ork)o(er)-2 482
y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:2306) cvn /DEST pdfmark end
 -2 482 a 396 756
a Fe(//)90 b(-------------------------------------)o(------)o(------)o
(------)o(------)o(-----)o(---)396 853 y(//)g(Set)44
b(heartbeat)f(delay)396 1048 y(void)396 1145 y(mdwrk_set_heartbeat)f
(\(mdwrk_t)1696 1158 y(*)1741 1145 y(self,)i(int)h(heartbeat\))396
1242 y({)576 1339 y(self->heartbeat)d(=)j(heartbeat;)396
1436 y(})396 1728 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
1825 y(//)g(Set)44 b(reconnect)f(delay)396 2019 y(void)396
2116 y(mdwrk_set_reconnect)f(\(mdwrk_t)1696 2129 y(*)1741
2116 y(self,)i(int)h(reconnect\))396 2213 y({)576 2310
y(self->reconnect)d(=)j(reconnect;)396 2407 y(})-2 2582
y
SDict begin H.S end
 -2 2582 a -2 2582 a
SDict begin 13 H.A end
 -2 2582 a -2 2582 a
SDict begin [/View [/XYZ H.V]/Dest (0:2307) cvn /DEST pdfmark end
 -2 2582 a 396
2681 a Fk(This)21 b(is)g(the)f(recv)g(method;)f(it')-5
b(s)21 b(a)f(little)h(misnamed)e(since)i(it)g(\002rst)g(sends)f(an)o(y)
f(reply)h(and)f(then)h(w)o(aits)h(for)f(a)g(ne)n(w)396
2789 y(request.)g(If)g(you)f(ha)n(v)o(e)g(a)i(better)f(name)f(for)h
(this,)g(let)h(me)f(kno)n(w:)-2 2807 y
SDict begin H.S end
 -2 2807 a -2 2807
a
SDict begin 13 H.A end
 -2 2807 a -2 2807 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-5) cvn /DEST pdfmark
end
 -2 2807 a 396 2991 a Fg(Example)h(4-29.)d
(Majordomo)h(w)o(ork)o(er)i(API)f(\(md)o(wrkapi.c\))g(-)g(r)o(ecv)g
(method)-2 3091 y
SDict begin H.S end
 -2 3091 a -2 3091 a
SDict begin 11.7 H.A end
 -2 3091 a -2 3091
a
SDict begin [/View [/XYZ H.V]/Dest (0:2310) cvn /DEST pdfmark end
 -2 3091 a 396 3268 a Fe(//)90 b
(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(---)396 3365 y(//)g(Send)44 b(reply,)g(if)g(any,)g
(to)h(broker)f(and)g(wait)g(for)g(next)h(request.)396
3559 y(zmsg_t)710 3572 y(*)396 3657 y(mdwrk_recv)e(\(mdwrk_t)1293
3670 y(*)1338 3657 y(self,)h(zmsg_t)1921 3670 y(**)2011
3657 y(reply_p\))396 3754 y({)576 3851 y(//)89 b(Format)44
b(and)g(send)g(the)h(reply)f(if)g(we)h(were)f(provided)f(one)576
3948 y(assert)g(\(reply_p\);)576 4045 y(zmsg_t)889 4058
y(*)934 4045 y(reply)h(=)1293 4058 y(*)1338 4045 y(reply_p;)576
4142 y(assert)f(\(reply)h(||)h(!self->expect_reply\);)576
4239 y(if)f(\(reply\))g({)755 4336 y(assert)g(\(self->reply_to\);)755
4434 y(zmsg_wrap)f(\(reply,)h(self->reply_to\);)755 4531
y(s_mdwrk_send_to_broker)d(\(self,)j(MDPW_REPLY,)f(NULL,)h(reply\);)755
4628 y(zmsg_destroy)f(\(reply_p\);)576 4725 y(})576 4822
y(self->expect_reply)e(=)k(1;)576 5016 y(while)f(\(true\))f({)755
5114 y(zmq_pollitem_t)f(items)i([])h(=)g({)p Black 3759
5569 a Ff(179)p Black eop end
%%Page: 180 193
TeXDict begin 180 192 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.180) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 72 a Fe({)45 b(self->worker,)87 b(0,)45 b(ZMQ_POLLIN,)e(0)i
(})f(};)755 170 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g(1,)g
(self->heartbeat)2772 183 y(*)2862 170 y(ZMQ_POLL_MSEC\);)755
267 y(if)g(\(rc)h(==)f(-1\))934 364 y(break;)627 b(//)89
b(Interrupted)755 558 y(if)44 b(\(items)g([0].revents)f(&)i
(ZMQ_POLLIN\))e({)934 655 y(zmsg_t)1248 668 y(*)1293
655 y(msg)h(=)h(zmsg_recv)e(\(self->worker\);)934 752
y(if)i(\(!msg\))1114 850 y(break;)447 b(//)89 b(Interrupted)934
947 y(if)45 b(\(self->verbose\))d({)1114 1044 y(zclock_log)h(\("I:)h
(received)f(message)h(from)g(broker:"\);)1114 1141 y(zmsg_dump)f
(\(msg\);)934 1238 y(})934 1335 y(self->liveness)g(=)h
(HEARTBEAT_LIVENESS;)934 1530 y(//)90 b(Don't)44 b(try)g(to)g(handle)g
(errors,)g(just)g(assert)g(noisily)934 1627 y(assert)g(\(zmsg_size)f
(\(msg\))h(>=)h(3\);)934 1821 y(zframe_t)1338 1834 y(*)1383
1821 y(empty)f(=)g(zmsg_pop)g(\(msg\);)934 1918 y(assert)g
(\(zframe_streq)f(\(empty,)g(""\)\);)934 2015 y(zframe_destroy)g
(\(&empty\);)934 2209 y(zframe_t)1338 2222 y(*)1383 2209
y(header)g(=)i(zmsg_pop)f(\(msg\);)934 2307 y(assert)g(\(zframe_streq)f
(\(header,)g(MDPW_WORKER\)\);)934 2404 y(zframe_destroy)g(\(&header\);)
934 2598 y(zframe_t)1338 2611 y(*)1383 2598 y(command)g(=)i(zmsg_pop)e
(\(msg\);)934 2695 y(if)i(\(zframe_streq)d(\(command,)i
(MDPW_REQUEST\)\))e({)1114 2792 y(//)89 b(We)44 b(should)g(pop)h(and)f
(save)g(as)h(many)f(addresses)f(as)i(there)e(are)1114
2889 y(//)89 b(up)44 b(to)h(a)g(null)f(part,)g(but)g(for)g(now,)h(just)
f(save)g(one...)1114 2987 y(self->reply_to)e(=)j(zmsg_unwrap)e
(\(msg\);)1114 3084 y(zframe_destroy)f(\(&command\);)-2
3261 y
SDict begin H.S end
 -2 3261 a -2 3261 a
SDict begin 13 H.A end
 -2 3261 a -2 3261 a
SDict begin [/View [/XYZ H.V]/Dest (0:2311) cvn /DEST pdfmark end
 -2 3261
a 396 3358 a Fk(Here)20 b(is)h(where)f(we)h(actually)e(ha)n(v)o(e)h(a)g
(message)g(to)h(process;)f(we)g(return)f(it)i(to)f(the)h(caller)f
(application:)f(W)-7 b(e)21 b(ha)n(v)o(e)e(a)396 3466
y(request)h(to)g(process)-2 3484 y
SDict begin H.S end
 -2 3484 a -2 3484
a
SDict begin 13 H.A end
 -2 3484 a -2 3484 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdwrkapi-c-6) cvn /DEST pdfmark
end
 -2 3484 a 396 3667 a Fg(Example)h(4-30.)d
(Majordomo)h(w)o(ork)o(er)i(API)f(\(md)o(wrkapi.c\))g(-)g(pr)o(ocess)g
(message)-2 3767 y
SDict begin H.S end
 -2 3767 a -2 3767 a
SDict begin 11.7 H.A end
 -2 3767 a -2 3767
a
SDict begin [/View [/XYZ H.V]/Dest (0:2314) cvn /DEST pdfmark end
 -2 3767 a 934 3847 a Fe(else)934 3944 y(if)45 b(\(zframe_streq)d
(\(command,)i(MDPW_HEARTBEAT\)\))1114 4041 y(;)672 b(//)89
b(Do)45 b(nothing)e(for)i(heartbeats)934 4138 y(else)934
4236 y(if)g(\(zframe_streq)d(\(command,)i(MDPW_DISCONNECT\)\))1114
4333 y(s_mdwrk_connect_to_broker)c(\(self\);)934 4430
y(else)k({)1114 4527 y(zclock_log)f(\("E:)h(invalid)g(input)g
(message"\);)1114 4624 y(zmsg_dump)f(\(msg\);)934 4721
y(})934 4818 y(zframe_destroy)g(\(&command\);)934 4916
y(zmsg_destroy)g(\(&msg\);)755 5013 y(})755 5110 y(else)p
Black 3759 5569 a Ff(180)p Black eop end
%%Page: 181 194
TeXDict begin 181 193 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.181) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(if)44 b(\(--self->liveness)e(==)j(0\))f({)934
170 y(if)h(\(self->verbose\))1114 267 y(zclock_log)e(\("W:)h
(disconnected)f(from)h(broker)g(-)g(retrying..."\);)934
364 y(zclock_sleep)f(\(self->reconnect\);)934 461 y
(s_mdwrk_connect_to_broker)e(\(self\);)755 558 y(})755
655 y(//)89 b(Send)44 b(HEARTBEAT)g(if)g(it's)g(time)755
752 y(if)g(\(zclock_time)f(\(\))i(>)f(self->heartbeat_at\))e({)934
850 y(s_mdwrk_send_to_broker)f(\(self,)j(MDPW_HEARTBEAT,)f(NULL,)h
(NULL\);)934 947 y(self->heartbeat_at)e(=)j(zclock_time)e(\(\))h(+)h
(self->heartbeat;)755 1044 y(})576 1141 y(})576 1238
y(if)f(\(zctx_interrupted\))755 1335 y(printf)g(\("W:)g(interrupt)f
(received,)h(killing)f(worker...\\n"\);)576 1432 y(return)g(NULL;)396
1530 y(})-2 1704 y
SDict begin H.S end
 -2 1704 a -2 1704 a
SDict begin 13 H.A end
 -2 1704 a -2 1704
a
SDict begin [/View [/XYZ H.V]/Dest (0:2315) cvn /DEST pdfmark end
 -2 1704 a 396 1803 a Fk(W)m(ith)21 b(an)f(e)o(xample)f(test)i
(program)d(that)i(implements)f(an)h('echo')f(service:)-2
1821 y
SDict begin H.S end
 -2 1821 a -2 1821 a
SDict begin 13 H.A end
 -2 1821 a -2 1821 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdworker-c) cvn /DEST pdfmark
end
 -2 1821
a 396 2005 a Fg(Example)i(4-31.)d(Majordomo)h(w)o(ork)o(er)i
(application)e(\(md)o(w)o(ork)o(er)-8 b(.c\))-2 2105
y
SDict begin H.S end
 -2 2105 a -2 2105 a
SDict begin 11.7 H.A end
 -2 2105 a -2 2105 a
SDict begin [/View [/XYZ H.V]/Dest (0:2318) cvn /DEST pdfmark end
 -2 2105 a 396
2185 a Fe(//)396 2282 y(//)90 b(Majordomo)43 b(Protocol)g(worker)h
(example)396 2379 y(//)90 b(Uses)44 b(the)g(mdwrk)g(API)g(to)h(hide)f
(all)g(MDP)h(aspects)396 2476 y(//)396 2671 y(//)90 b(Lets)44
b(us)g(build)g(this)g(source)g(without)g(creating)f(a)i(library)396
2768 y(#include)f("mdwrkapi.c")396 2962 y(int)h(main)f(\(int)g(argc,)g
(char)1517 2975 y(*)1562 2962 y(argv)g([]\))396 3059
y({)576 3156 y(int)g(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g
(\(argv)g([1],)g("-v"\)\);)576 3253 y(mdwrk_t)934 3266
y(*)979 3253 y(session)g(=)g(mdwrk_new)g(\()755 3351
y("tcp://localhost:5555",)d("echo",)j(verbose\);)576
3545 y(zmsg_t)889 3558 y(*)934 3545 y(reply)g(=)h(NULL;)576
3642 y(while)f(\(true\))f({)755 3739 y(zmsg_t)1069 3752
y(*)1114 3739 y(request)g(=)i(mdwrk_recv)e(\(session,)g(&reply\);)755
3836 y(if)h(\(request)g(==)g(NULL\))934 3933 y(break;)627
b(//)89 b(Worker)44 b(was)g(interrupted)755 4031 y(reply)g(=)h
(request;)357 b(//)89 b(Echo)44 b(is)h(complex...)e(:-\))576
4128 y(})576 4225 y(mdwrk_destroy)f(\(&session\);)576
4322 y(return)h(0;)396 4419 y(})-2 4593 y
SDict begin H.S end
 -2 4593 a -2
4593 a
SDict begin 13 H.A end
 -2 4593 a -2 4593 a
SDict begin [/View [/XYZ H.V]/Dest (0:2319) cvn /DEST pdfmark end
 -2 4593 a 396 4693 a Fk(Notes)21
b(on)e(this)i(code:)-2 4694 y
SDict begin H.S end
 -2 4694 a -2 4694 a
SDict begin 13 H.A end
 -2
4694 a -2 4694 a
SDict begin [/View [/XYZ H.V]/Dest (0:2320) cvn /DEST pdfmark end
 -2 4694 a -2 4704 a
SDict begin H.S end
 -2 4704 a -2 4704
a
SDict begin 13 H.A end
 -2 4704 a -2 4704 a
SDict begin [/View [/XYZ H.V]/Dest (0:2321) cvn /DEST pdfmark end
 -2 4704 a Black 396 4863 a Fj(\225)p
Black 479 4863 a
SDict begin H.S end
 479 4863 a 479 4863 a
SDict begin 13 H.A end
 479 4863 a 479
4863 a
SDict begin [/View [/XYZ H.V]/Dest (0:2322) cvn /DEST pdfmark end
 479 4863 a Fk(The)f(APIs)h(are)f(single)g(threaded.)f(This)h
(means,)g(for)f(e)o(xample,)g(that)h(the)g(w)o(ork)o(er)f(w)o(on')o(t)g
(send)h(heartbeats)g(in)g(the)479 4971 y(background.)c(Happily)-5
b(,)18 b(this)i(is)h(e)o(xactly)e(what)g(we)h(w)o(ant:)g(if)g(the)f(w)o
(ork)o(er)g(application)f(gets)i(stuck,)f(heartbeats)g(will)479
5079 y(stop)h(and)g(the)g(brok)o(er)f(will)i(stop)f(sending)f(requests)
h(to)g(the)g(w)o(ork)o(er)-5 b(.)-2 5097 y
SDict begin H.S end
 -2 5097 a
-2 5097 a
SDict begin 13 H.A end
 -2 5097 a -2 5097 a
SDict begin [/View [/XYZ H.V]/Dest (0:2323) cvn /DEST pdfmark end
 -2 5097 a Black 3759 5569
a Ff(181)p Black eop end
%%Page: 182 195
TeXDict begin 182 194 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.182) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2324) cvn /DEST pdfmark end
 479 72 a Fk(The)g(w)o(ork)o(er)f(API)i
(doesn')o(t)e(do)g(an)h(e)o(xponential)e(back-of)n(f,)g(it')-5
b(s)21 b(not)f(w)o(orth)g(the)g(e)o(xtra)f(comple)o(xity)-5
b(.)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:2325) cvn /DEST pdfmark end
 -2 90 a Black
396 222 a Fj(\225)p Black 479 222 a
SDict begin H.S end
 479 222 a 479 222
a
SDict begin 13 H.A end
 479 222 a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:2326) cvn /DEST pdfmark end
 479 222 a Fk(The)20 b(APIs)h(don')o(t)d(do)i(an)o
(y)g(error)f(reporting.)f(If)i(something)e(isn')o(t)i(as)h(e)o
(xpected,)d(the)o(y)i(raise)g(an)h(assertion)e(\(or)479
330 y(e)o(xception)g(depending)e(on)j(the)g(language\).)e(This)i(is)i
(ideal)e(for)f(a)i(reference)d(implementation,)g(so)j(an)o(y)e
(protocol)479 438 y(errors)h(sho)n(w)g(immediately)-5
b(.)18 b(F)o(or)i(real)g(applications)f(the)h(API)h(should)e(be)h(rob)n
(ust)f(against)h(in)m(v)n(alid)f(messages.)-2 622 y
SDict begin H.S end
 -2
622 a -2 622 a
SDict begin 13 H.A end
 -2 622 a -2 622 a
SDict begin [/View [/XYZ H.V]/Dest (0:2327) cvn /DEST pdfmark end
 -2 622 a 396 712 a Fk(Y)-9
b(ou)20 b(might)f(w)o(onder)g(why)h(the)g(w)o(ork)o(er)f(API)i(is)g
(manually)d(closing)i(its)h(sock)o(et)f(and)g(opening)e(a)j(ne)n(w)f
(one,)f(when)396 820 y(\330MQ)i(will)g(automatically)d(reconnect)h(a)h
(sock)o(et)g(if)h(the)f(peer)g(disappears)f(and)h(comes)g(back.)f(Look)
g(back)g(at)i(the)396 928 y(Simple)f(Pirate)h(w)o(ork)o(er)m(,)d(and)i
(the)g(P)o(aranoid)f(Pirate)h(w)o(ork)o(er)g(to)g(understand.)e(While)i
(\330MQ)h(will)g(automatically)396 1036 y(reconnect)e(w)o(ork)o(ers,)g
(if)h(the)h(brok)o(er)d(dies)j(and)e(comes)h(back)g(up,)f(this)i(isn')o
(t)f(suf)n(\002cient)g(to)g(re-re)o(gister)f(the)h(w)o(ork)o(ers)396
1143 y(with)h(the)f(brok)o(er)-5 b(.)19 b(There)g(are)h(at)h(least)g
(tw)o(o)f(solutions)g(I)g(kno)n(w)f(of.)h(The)g(simplest,)g(which)g(we)
g(use)h(here,)e(is)i(that)g(the)396 1251 y(w)o(ork)o(er)d(monitors)f
(the)i(connection)e(using)h(heartbeats,)f(and)h(if)h(it)h(decides)e
(the)h(brok)o(er)e(is)i(dead,)f(closes)h(its)h(sock)o(et)e(and)396
1359 y(starts)j(afresh)f(with)g(a)h(ne)n(w)f(sock)o(et.)g(The)f
(alternati)n(v)o(e)g(is)i(for)f(the)g(brok)o(er)f(to)h(challenge)f
(unkno)n(wn)f(w)o(ork)o(ers)h(--)h(when)g(it)396 1467
y(gets)h(a)f(heartbeat)f(from)h(the)g(w)o(ork)o(er)f(--)h(and)g(ask)g
(them)g(to)g(re-re)o(gister)-5 b(.)19 b(That)h(w)o(ould)f(require)g
(protocol)g(support.)-2 1651 y
SDict begin H.S end
 -2 1651 a -2 1651 a
SDict begin 13 H.A end
 -2
1651 a -2 1651 a
SDict begin [/View [/XYZ H.V]/Dest (0:2328) cvn /DEST pdfmark end
 -2 1651 a 396 1741 a Fk(Let')-5 b(s)21
b(design)f(the)g(Majordomo)e(brok)o(er)-5 b(.)18 b(Its)j(core)f
(structure)f(is)i(a)g(set)g(of)f(queues,)f(one)g(per)h(service.)g(W)-7
b(e)21 b(will)g(create)396 1849 y(these)g(queues)e(as)i(w)o(ork)o(ers)e
(appear)g(\(we)i(could)e(delete)h(them)g(as)h(w)o(ork)o(ers)e
(disappear)g(b)n(ut)h(for)o(get)f(that)h(for)f(no)n(w)-5
b(,)19 b(it)396 1957 y(gets)i(comple)o(x\).)d(Additionally)-5
b(,)17 b(we)k(k)o(eep)f(a)g(queue)f(of)h(w)o(ork)o(ers)g(per)g
(service.)-2 2141 y
SDict begin H.S end
 -2 2141 a -2 2141 a
SDict begin 13 H.A end
 -2 2141 a -2
2141 a
SDict begin [/View [/XYZ H.V]/Dest (0:2329) cvn /DEST pdfmark end
 -2 2141 a 396 2231 a Fk(And)g(here)g(is)h(the)f(brok)o(er:)-2
2232 y
SDict begin H.S end
 -2 2232 a -2 2232 a
SDict begin 13 H.A end
 -2 2232 a -2 2232 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c) cvn /DEST pdfmark
end
 -2 2232
a 396 2432 a Fg(Example)h(4-32.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))-2 2532 y
SDict begin H.S end
 -2 2532 a -2 2532 a
SDict begin 11.7 H.A end
 -2 2532
a -2 2532 a
SDict begin [/View [/XYZ H.V]/Dest (0:2332) cvn /DEST pdfmark end
 -2 2532 a 396 2613 a Fe(//)396 2710 y(//)90
b(Majordomo)43 b(Protocol)g(broker)396 2807 y(//)90 b(A)44
b(minimal)g(C)h(implementation)d(of)j(the)f(Majordomo)f(Protocol)h(as)g
(defined)g(in)396 2904 y(//)90 b(http://rfc.zeromq.org/spec:7)40
b(and)k(http://rfc.zeromq.org/spec:8.)396 3001 y(//)396
3098 y(#include)g("czmq.h")396 3195 y(#include)g("mdp.h")396
3390 y(//)90 b(We'd)44 b(normally)f(pull)h(these)g(from)h(config)e
(data)396 3584 y(#define)h(HEARTBEAT_LIVENESS)87 b(3)313
b(//)90 b(3-5)44 b(is)g(reasonable)396 3681 y(#define)g
(HEARTBEAT_INTERVAL)87 b(2500)178 b(//)90 b(msecs)396
3778 y(#define)44 b(HEARTBEAT_EXPIRY)177 b(HEARTBEAT_INTERVAL)2503
3791 y(*)2593 3778 y(HEARTBEAT_LIVENESS)-2 3954 y
SDict begin H.S end
 -2
3954 a -2 3954 a
SDict begin 13 H.A end
 -2 3954 a -2 3954 a
SDict begin [/View [/XYZ H.V]/Dest (0:2333) cvn /DEST pdfmark end
 -2 3954 a 396 4052
a Fk(The)20 b(brok)o(er)f(class)i(de\002nes)f(a)g(single)h(brok)o(er)d
(instance:)-2 4070 y
SDict begin H.S end
 -2 4070 a -2 4070 a
SDict begin 13 H.A end
 -2 4070 a -2
4070 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-1) cvn /DEST pdfmark
end
 -2 4070 a 396 4253 a Fg(Example)j(4-33.)d(Majordomo)h(br)o(ok)o
(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19 b(-)h(br)o(ok)o(er)g(class)h
(structur)o(e)-2 4353 y
SDict begin H.S end
 -2 4353 a -2 4353 a
SDict begin 11.7 H.A end
 -2 4353 a
-2 4353 a
SDict begin [/View [/XYZ H.V]/Dest (0:2336) cvn /DEST pdfmark end
 -2 4353 a 396 4531 a Fe(typedef)44 b(struct)g({)576
4628 y(zctx_t)889 4641 y(*)934 4628 y(ctx;)717 b(//)89
b(Our)45 b(context)576 4725 y(void)800 4738 y(*)845 4725
y(socket;)671 b(//)89 b(Socket)44 b(for)g(clients)g(&)h(workers)576
4822 y(int)f(verbose;)716 b(//)89 b(Print)44 b(activity)g(to)g(stdout)
576 4919 y(char)800 4932 y(*)845 4919 y(endpoint;)581
b(//)89 b(Broker)44 b(binds)g(to)h(this)f(endpoint)576
5016 y(zhash_t)934 5029 y(*)979 5016 y(services;)447
b(//)89 b(Hash)44 b(of)h(known)f(services)576 5114 y(zhash_t)934
5127 y(*)979 5114 y(workers;)492 b(//)89 b(Hash)44 b(of)h(known)f
(workers)p Black 3759 5569 a Ff(182)p Black eop end
%%Page: 183 196
TeXDict begin 183 195 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.183) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(zlist_t)934 85 y(*)979 72 y(waiting;)492
b(//)89 b(List)44 b(of)h(waiting)f(workers)576 170 y(uint64_t)f
(heartbeat_at;)267 b(//)89 b(When)44 b(to)h(send)f(HEARTBEAT)396
267 y(})h(broker_t;)396 461 y(static)f(broker_t)1114
474 y(*)576 558 y(s_broker_new)e(\(int)j(verbose\);)396
655 y(static)f(void)576 752 y(s_broker_destroy)e(\(broker_t)1786
765 y(**)1876 752 y(self_p\);)396 850 y(static)i(void)576
947 y(s_broker_bind)e(\(broker_t)1652 960 y(*)1697 947
y(self,)h(char)2190 960 y(*)2235 947 y(endpoint\);)396
1044 y(static)h(void)576 1141 y(s_broker_worker_msg)d(\(broker_t)1921
1154 y(*)1966 1141 y(self,)i(zframe_t)2638 1154 y(*)2683
1141 y(sender,)g(zmsg_t)3355 1154 y(*)3400 1141 y(msg\);)396
1238 y(static)h(void)576 1335 y(s_broker_client_msg)d(\(broker_t)1921
1348 y(*)1966 1335 y(self,)i(zframe_t)2638 1348 y(*)2683
1335 y(sender,)g(zmsg_t)3355 1348 y(*)3400 1335 y(msg\);)396
1432 y(static)h(void)576 1530 y(s_broker_purge)e(\(broker_t)1696
1543 y(*)1741 1530 y(self\);)-2 1707 y
SDict begin H.S end
 -2 1707 a -2 1707
a
SDict begin 13 H.A end
 -2 1707 a -2 1707 a
SDict begin [/View [/XYZ H.V]/Dest (0:2337) cvn /DEST pdfmark end
 -2 1707 a 396 1803 a Fk(The)20
b(service)g(class)h(de\002nes)f(a)h(single)f(service)g(instance:)-2
1821 y
SDict begin H.S end
 -2 1821 a -2 1821 a
SDict begin 13 H.A end
 -2 1821 a -2 1821 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-2) cvn /DEST pdfmark
end
 -2 1821
a 396 2005 a Fg(Example)h(4-34.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))19 b(-)h(ser)o(vice)h(class)f(structur)o(e)-2
2105 y
SDict begin H.S end
 -2 2105 a -2 2105 a
SDict begin 11.7 H.A end
 -2 2105 a -2 2105 a
SDict begin [/View [/XYZ H.V]/Dest (0:2340) cvn /DEST pdfmark end
 -2 2105
a 396 2282 a Fe(typedef)44 b(struct)g({)576 2379 y(broker_t)979
2392 y(*)1024 2379 y(broker;)492 b(//)89 b(Broker)44
b(instance)576 2476 y(char)800 2489 y(*)845 2476 y(name;)761
b(//)89 b(Service)44 b(name)576 2574 y(zlist_t)934 2587
y(*)979 2574 y(requests;)447 b(//)89 b(List)44 b(of)h(client)f
(requests)576 2671 y(zlist_t)934 2684 y(*)979 2671 y(waiting;)492
b(//)89 b(List)44 b(of)h(waiting)f(workers)576 2768 y(size_t)f
(workers;)582 b(//)89 b(How)45 b(many)f(workers)f(we)i(have)396
2865 y(})g(service_t;)396 3059 y(static)f(service_t)1158
3072 y(*)576 3156 y(s_service_require)e(\(broker_t)1831
3169 y(*)1876 3156 y(self,)i(zframe_t)2548 3169 y(*)2593
3156 y(service_frame\);)396 3253 y(static)g(void)576
3351 y(s_service_destroy)e(\(void)1652 3364 y(*)1697
3351 y(argument\);)396 3448 y(static)i(void)576 3545
y(s_service_dispatch)d(\(service_t)1921 3558 y(*)1966
3545 y(service,)i(zmsg_t)2683 3558 y(*)2728 3545 y(msg\);)-2
3722 y
SDict begin H.S end
 -2 3722 a -2 3722 a
SDict begin 13 H.A end
 -2 3722 a -2 3722 a
SDict begin [/View [/XYZ H.V]/Dest (0:2341) cvn /DEST pdfmark end
 -2 3722
a 396 3819 a Fk(The)20 b(w)o(ork)o(er)f(class)i(de\002nes)f(a)h(single)
f(w)o(ork)o(er)m(,)f(idle)h(or)g(acti)n(v)o(e:)-2 3837
y
SDict begin H.S end
 -2 3837 a -2 3837 a
SDict begin 13 H.A end
 -2 3837 a -2 3837 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-3) cvn /DEST pdfmark
end
 -2 3837 a 396
4020 a Fg(Example)h(4-35.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o(ok)o
(er)-8 b(.c\))19 b(-)h(w)o(ork)o(er)h(class)f(structur)o(e)-2
4120 y
SDict begin H.S end
 -2 4120 a -2 4120 a
SDict begin 11.7 H.A end
 -2 4120 a -2 4120 a
SDict begin [/View [/XYZ H.V]/Dest (0:2344) cvn /DEST pdfmark end
 -2 4120
a 396 4297 a Fe(typedef)44 b(struct)g({)576 4395 y(broker_t)979
4408 y(*)1024 4395 y(broker;)492 b(//)89 b(Broker)44
b(instance)576 4492 y(char)800 4505 y(*)845 4492 y(identity;)581
b(//)89 b(Identity)44 b(of)g(worker)576 4589 y(zframe_t)979
4602 y(*)1024 4589 y(address;)447 b(//)89 b(Address)44
b(frame)g(to)g(route)g(to)576 4686 y(service_t)1024 4699
y(*)1069 4686 y(service;)402 b(//)89 b(Owning)44 b(service,)g(if)g
(known)576 4783 y(int64_t)f(expiry;)582 b(//)89 b(Expires)44
b(at)g(unless)g(heartbeat)396 4880 y(})h(worker_t;)396
5075 y(static)f(worker_t)1114 5088 y(*)p Black 3759 5569
a Ff(183)p Black eop end
%%Page: 184 197
TeXDict begin 184 196 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.184) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(s_worker_require)42 b(\(broker_t)1786
85 y(*)1831 72 y(self,)i(zframe_t)2503 85 y(*)2548 72
y(address\);)396 170 y(static)g(void)576 267 y(s_worker_delete)e
(\(worker_t)1741 280 y(*)1786 267 y(self,)i(int)g(disconnect\);)396
364 y(static)g(void)576 461 y(s_worker_destroy)e(\(void)1607
474 y(*)1652 461 y(argument\);)396 558 y(static)i(void)576
655 y(s_worker_send)e(\(worker_t)1652 668 y(*)1697 655
y(self,)h(char)2190 668 y(*)2235 655 y(command,)g(char)2862
668 y(*)2907 655 y(option,)1248 752 y(zmsg_t)1562 765
y(*)1607 752 y(msg\);)396 850 y(static)h(void)576 947
y(s_worker_waiting)e(\(worker_t)1786 960 y(*)1831 947
y(self\);)-2 1124 y
SDict begin H.S end
 -2 1124 a -2 1124 a
SDict begin 13 H.A end
 -2 1124 a -2
1124 a
SDict begin [/View [/XYZ H.V]/Dest (0:2345) cvn /DEST pdfmark end
 -2 1124 a 396 1221 a Fk(Here)20 b(are)g(the)h(constructor)d(and)
i(destructor)e(for)i(the)g(brok)o(er:)-2 1222 y
SDict begin H.S end
 -2 1222
a -2 1222 a
SDict begin 13 H.A end
 -2 1222 a -2 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-4) cvn /DEST pdfmark
end
 -2 1222 a 396 1422 a
Fg(Example)h(4-36.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o(ok)o(er)-8
b(.c\))19 b(-)h(br)o(ok)o(er)g(constructor)f(and)i(destructor)-2
1522 y
SDict begin H.S end
 -2 1522 a -2 1522 a
SDict begin 11.7 H.A end
 -2 1522 a -2 1522 a
SDict begin [/View [/XYZ H.V]/Dest (0:2348) cvn /DEST pdfmark end
 -2 1522
a 396 1699 a Fe(static)44 b(broker_t)1114 1712 y(*)396
1796 y(s_broker_new)f(\(int)h(verbose\))396 1894 y({)576
1991 y(broker_t)979 2004 y(*)1024 1991 y(self)g(=)h(\(broker_t)1786
2004 y(*)1831 1991 y(\))g(zmalloc)e(\(sizeof)h(\(broker_t\)\);)576
2185 y(//)89 b(Initialize)43 b(broker)h(state)576 2282
y(self->ctx)f(=)i(zctx_new)e(\(\);)576 2379 y(self->socket)f(=)j
(zsocket_new)e(\(self->ctx,)g(ZMQ_ROUTER\);)576 2476
y(self->verbose)f(=)j(verbose;)576 2574 y(self->services)d(=)j
(zhash_new)e(\(\);)576 2671 y(self->workers)f(=)j(zhash_new)e(\(\);)576
2768 y(self->waiting)f(=)j(zlist_new)e(\(\);)576 2865
y(self->heartbeat_at)e(=)k(zclock_time)e(\(\))i(+)f
(HEARTBEAT_INTERVAL;)576 2962 y(return)f(self;)396 3059
y(})396 3253 y(static)h(void)396 3351 y(s_broker_destroy)e(\(broker_t)
1607 3364 y(**)1697 3351 y(self_p\))396 3448 y({)576
3545 y(assert)h(\(self_p\);)576 3642 y(if)h(\()755 3655
y(*)800 3642 y(self_p\))f({)755 3739 y(broker_t)1158
3752 y(*)1203 3739 y(self)h(=)1517 3752 y(*)1562 3739
y(self_p;)755 3836 y(zctx_destroy)f(\(&self->ctx\);)755
3933 y(zhash_destroy)g(\(&self->services\);)755 4031
y(zhash_destroy)g(\(&self->workers\);)755 4128 y(zlist_destroy)g
(\(&self->waiting\);)755 4225 y(free)h(\(self\);)755
4335 y(*)800 4322 y(self_p)g(=)g(NULL;)576 4419 y(})396
4516 y(})-2 4690 y
SDict begin H.S end
 -2 4690 a -2 4690 a
SDict begin 13 H.A end
 -2 4690 a -2 4690
a
SDict begin [/View [/XYZ H.V]/Dest (0:2349) cvn /DEST pdfmark end
 -2 4690 a 396 4790 a Fk(The)20 b(bind)f(method)g(binds)h(the)g(brok)o
(er)f(instance)h(to)g(an)g(endpoint.)e(W)-7 b(e)22 b(can)d(call)i(this)
g(multiple)e(times.)i(Note)f(that)396 4898 y(MDP)h(uses)g(a)f(single)g
(sock)o(et)g(for)g(both)f(clients)i(and)e(w)o(ork)o(ers:)-2
4916 y
SDict begin H.S end
 -2 4916 a -2 4916 a
SDict begin 13 H.A end
 -2 4916 a -2 4916 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-5) cvn /DEST pdfmark
end
 -2 4916
a Black 3759 5569 a Ff(184)p Black eop end
%%Page: 185 198
TeXDict begin 185 197 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.185) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-37.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))19 b(-)h(br)o(ok)o(er)g(bind)i(method)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2352) cvn /DEST pdfmark end
 -2 172 a 396
350 a Fe(void)396 447 y(s_broker_bind)43 b(\(broker_t)1472
460 y(*)1517 447 y(self,)h(char)2010 460 y(*)2055 447
y(endpoint\))396 544 y({)576 641 y(zsocket_bind)e(\(self->socket,)h
(endpoint\);)576 738 y(zclock_log)g(\("I:)h(MDP)g(broker/0.2.0)f(is)i
(active)e(at)i(\045s",)f(endpoint\);)396 835 y(})-2 1010
y
SDict begin H.S end
 -2 1010 a -2 1010 a
SDict begin 13 H.A end
 -2 1010 a -2 1010 a
SDict begin [/View [/XYZ H.V]/Dest (0:2353) cvn /DEST pdfmark end
 -2 1010 a 396
1109 a Fk(The)20 b(w)o(ork)o(er_msg)e(method)h(processes)h(one)g(READ)
-5 b(Y)-11 b(,)21 b(REPL)-8 b(Y)d(,)20 b(HEAR)-5 b(TBEA)c(T)20
b(or)g(DISCONNECT)h(message)396 1217 y(sent)g(to)f(the)g(brok)o(er)f
(by)h(a)g(w)o(ork)o(er:)-2 1235 y
SDict begin H.S end
 -2 1235 a -2 1235 a
SDict begin 13 H.A end

-2 1235 a -2 1235 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-6) cvn /DEST pdfmark
end
 -2 1235 a 396 1419 a Fg(Example)h(4-38.)d
(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19
b(-)h(br)o(ok)o(er)g(w)o(ork)o(er_msg)g(method)-2 1519
y
SDict begin H.S end
 -2 1519 a -2 1519 a
SDict begin 11.7 H.A end
 -2 1519 a -2 1519 a
SDict begin [/View [/XYZ H.V]/Dest (0:2356) cvn /DEST pdfmark end
 -2 1519 a 396
1696 a Fe(static)44 b(void)396 1793 y(s_broker_worker_msg)e(\(broker_t)
1741 1806 y(*)1786 1793 y(self,)i(zframe_t)2459 1806
y(*)2504 1793 y(sender,)f(zmsg_t)3176 1806 y(*)3221 1793
y(msg\))396 1890 y({)576 1987 y(assert)g(\(zmsg_size)h(\(msg\))g(>=)g
(1\);)224 b(//)89 b(At)45 b(least,)e(command)576 2182
y(zframe_t)979 2195 y(*)1024 2182 y(command)h(=)g(zmsg_pop)g(\(msg\);)
576 2279 y(char)800 2292 y(*)845 2279 y(identity)f(=)i(zframe_strhex)d
(\(sender\);)576 2376 y(int)i(worker_ready)f(=)h(\(zhash_lookup)f
(\(self->workers,)f(identity\))i(!=)g(NULL\);)576 2473
y(free)g(\(identity\);)576 2570 y(worker_t)979 2583 y(*)1024
2570 y(worker)g(=)g(s_worker_require)f(\(self,)g(sender\);)576
2764 y(if)h(\(zframe_streq)f(\(command,)g(MDPW_READY\)\))g({)755
2862 y(if)h(\(worker_ready\))671 b(//)89 b(Not)44 b(first)g(command)g
(in)g(session)934 2959 y(s_worker_delete)f(\(worker,)g(1\);)755
3056 y(else)755 3153 y(if)h(\(zframe_size)f(\(sender\))h(>=)g(4)90
b(//)f(Reserved)44 b(service)f(name)755 3250 y(&&)89
b(memcmp)44 b(\(zframe_data)f(\(sender\),)g("mmi.",)h(4\))g(==)h(0\))
934 3347 y(s_worker_delete)e(\(worker,)g(1\);)755 3444
y(else)h({)934 3542 y(//)90 b(Attach)43 b(worker)h(to)h(service)e(and)i
(mark)f(as)g(idle)934 3639 y(zframe_t)1338 3652 y(*)1383
3639 y(service_frame)e(=)j(zmsg_pop)e(\(msg\);)934 3736
y(worker->service)g(=)h(s_service_require)e(\(self,)i(service_frame\);)
934 3833 y(worker->service->workers++;)934 3930 y(s_worker_waiting)e
(\(worker\);)934 4027 y(zframe_destroy)h(\(&service_frame\);)755
4124 y(})576 4222 y(})576 4319 y(else)576 4416 y(if)h(\(zframe_streq)f
(\(command,)g(MDPW_REPLY\)\))g({)755 4513 y(if)h(\(worker_ready\))f({)
934 4610 y(//)90 b(Remove)43 b(&)i(save)f(client)g(return)g(envelope)f
(and)i(insert)f(the)934 4707 y(//)90 b(protocol)43 b(header)h(and)g
(service)g(name,)g(then)g(rewrap)g(envelope.)934 4804
y(zframe_t)1338 4817 y(*)1383 4804 y(client)f(=)i(zmsg_unwrap)e
(\(msg\);)934 4901 y(zmsg_pushstr)g(\(msg,)h(worker->service->name\);)
934 4999 y(zmsg_pushstr)f(\(msg,)h(MDPC_CLIENT\);)934
5096 y(zmsg_wrap)g(\(msg,)g(client\);)p Black 3759 5569
a Ff(185)p Black eop end
%%Page: 186 199
TeXDict begin 186 198 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.186) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 72 a Fe(zmsg_send)44 b(\(&msg,)f(self->socket\);)934
170 y(s_worker_waiting)f(\(worker\);)755 267 y(})755
364 y(else)934 461 y(s_worker_delete)h(\(worker,)g(1\);)576
558 y(})576 655 y(else)576 752 y(if)h(\(zframe_streq)f(\(command,)g
(MDPW_HEARTBEAT\)\))f({)755 850 y(if)i(\(worker_ready\))934
947 y(worker->expiry)f(=)h(zclock_time)f(\(\))i(+)g(HEARTBEAT_EXPIRY;)
755 1044 y(else)934 1141 y(s_worker_delete)e(\(worker,)g(1\);)576
1238 y(})576 1335 y(else)576 1432 y(if)h(\(zframe_streq)f(\(command,)g
(MDPW_DISCONNECT\)\))755 1530 y(s_worker_delete)f(\(worker,)i(0\);)576
1627 y(else)g({)755 1724 y(zclock_log)f(\("E:)h(invalid)g(input)g
(message"\);)755 1821 y(zmsg_dump)f(\(msg\);)576 1918
y(})576 2015 y(free)h(\(command\);)576 2112 y(zmsg_destroy)e(\(&msg\);)
396 2209 y(})-2 2384 y
SDict begin H.S end
 -2 2384 a -2 2384 a
SDict begin 13 H.A end
 -2 2384 a
-2 2384 a
SDict begin [/View [/XYZ H.V]/Dest (0:2357) cvn /DEST pdfmark end
 -2 2384 a 396 2483 a Fk(Process)21 b(a)f(request)g(coming)f
(from)g(a)h(client.)g(W)-7 b(e)22 b(implement)d(MMI)h(requests)f
(directly)h(here)f(\(at)i(present,)e(we)396 2591 y(implement)g(only)h
(the)g(mmi.service)f(request\):)-2 2609 y
SDict begin H.S end
 -2 2609 a -2
2609 a
SDict begin 13 H.A end
 -2 2609 a -2 2609 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-7) cvn /DEST pdfmark
end
 -2 2609 a 396 2793 a Fg(Example)i(4-39.)d
(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19
b(-)h(br)o(ok)o(er)g(client_msg)g(method)-2 2893 y
SDict begin H.S end
 -2
2893 a -2 2893 a
SDict begin 11.7 H.A end
 -2 2893 a -2 2893 a
SDict begin [/View [/XYZ H.V]/Dest (0:2360) cvn /DEST pdfmark end
 -2 2893 a 396 3070
a Fe(static)44 b(void)396 3167 y(s_broker_client_msg)e(\(broker_t)1741
3180 y(*)1786 3167 y(self,)i(zframe_t)2459 3180 y(*)2504
3167 y(sender,)f(zmsg_t)3176 3180 y(*)3221 3167 y(msg\))396
3264 y({)576 3361 y(assert)g(\(zmsg_size)h(\(msg\))g(>=)g(2\);)224
b(//)89 b(Service)44 b(name)g(+)h(body)576 3556 y(zframe_t)979
3569 y(*)1024 3556 y(service_frame)e(=)h(zmsg_pop)g(\(msg\);)576
3653 y(service_t)1024 3666 y(*)1069 3653 y(service)f(=)i
(s_service_require)d(\(self,)i(service_frame\);)576 3847
y(//)89 b(Set)44 b(reply)g(return)g(address)g(to)g(client)g(sender)576
3944 y(zmsg_wrap)f(\(msg,)h(zframe_dup)f(\(sender\)\);)576
4138 y(//)89 b(If)44 b(we)h(got)f(a)h(MMI)f(service)g(request,)f
(process)h(that)g(internally)576 4236 y(if)g(\(zframe_size)f
(\(service_frame\))f(>=)j(4)576 4333 y(&&)89 b(memcmp)44
b(\(zframe_data)f(\(service_frame\),)f("mmi.",)h(4\))i(==)f(0\))h({)755
4430 y(char)979 4443 y(*)1024 4430 y(return_code;)755
4527 y(if)f(\(zframe_streq)f(\(service_frame,)f("mmi.service"\)\))h({)
934 4624 y(char)1158 4637 y(*)1203 4624 y(name)h(=)h(zframe_strdup)e
(\(zmsg_last)g(\(msg\)\);)934 4721 y(service_t)1383 4734
y(*)1428 4721 y(service)g(=)1114 4818 y(\(service_t)1607
4831 y(*)1652 4818 y(\))h(zhash_lookup)f(\(self->services,)f(name\);)
934 4916 y(return_code)h(=)i(service)f(&&)g(service->workers?)e("200":)
i("404";)934 5013 y(free)g(\(name\);)755 5110 y(})p Black
3757 5569 a Ff(186)p Black eop end
%%Page: 187 200
TeXDict begin 187 199 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.187) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(else)934 170 y(return_code)43 b(=)i("501";)755
364 y(zframe_reset)e(\(zmsg_last)g(\(msg\),)h(return_code,)f(strlen)g
(\(return_code\)\);)755 558 y(//)89 b(Remove)44 b(&)h(save)f(client)g
(return)g(envelope)f(and)h(insert)g(the)755 655 y(//)89
b(protocol)44 b(header)g(and)g(service)g(name,)g(then)g(rewrap)g
(envelope.)755 752 y(zframe_t)1158 765 y(*)1203 752 y(client)g(=)h
(zmsg_unwrap)e(\(msg\);)755 850 y(zmsg_push)g(\(msg,)h(zframe_dup)f
(\(service_frame\)\);)755 947 y(zmsg_pushstr)g(\(msg,)h(MDPC_CLIENT\);)
755 1044 y(zmsg_wrap)f(\(msg,)h(client\);)755 1141 y(zmsg_send)f
(\(&msg,)h(self->socket\);)576 1238 y(})576 1335 y(else)755
1432 y(//)89 b(Else)44 b(dispatch)g(the)g(message)g(to)g(the)h
(requested)e(service)755 1530 y(s_service_dispatch)f(\(service,)h
(msg\);)576 1627 y(zframe_destroy)f(\(&service_frame\);)396
1724 y(})-2 1898 y
SDict begin H.S end
 -2 1898 a -2 1898 a
SDict begin 13 H.A end
 -2 1898 a -2 1898
a
SDict begin [/View [/XYZ H.V]/Dest (0:2361) cvn /DEST pdfmark end
 -2 1898 a 396 1998 a Fk(The)20 b(pur)o(ge)e(method)h(deletes)i(an)o
(y)e(idle)h(w)o(ork)o(ers)g(that)g(ha)n(v)o(en')o(t)e(pinged)h(us)i(in)
f(a)h(while.)f(W)-7 b(e)21 b(hold)e(w)o(ork)o(ers)h(from)396
2106 y(oldest)g(to)h(most)f(recent,)f(so)i(we)f(can)g(stop)h(scanning)d
(whene)n(v)o(er)h(we)h(\002nd)g(a)h(li)n(v)o(e)f(w)o(ork)o(er)-5
b(.)19 b(This)h(means)g(we')o(ll)h(mainly)396 2214 y(stop)f(at)h(the)f
(\002rst)h(w)o(ork)o(er)m(,)e(which)h(is)h(essential)f(when)g(we)h(ha)n
(v)o(e)e(lar)o(ge)g(numbers)g(of)h(w)o(ork)o(ers)f(\(since)h(we)h(call)
g(this)396 2322 y(method)e(in)h(our)g(critical)g(path\):)-2
2340 y
SDict begin H.S end
 -2 2340 a -2 2340 a
SDict begin 13 H.A end
 -2 2340 a -2 2340 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-8) cvn /DEST pdfmark
end
 -2 2340
a 396 2523 a Fg(Example)h(4-40.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))19 b(-)h(br)o(ok)o(er)g(pur)o(ge)h(method)-2
2623 y
SDict begin H.S end
 -2 2623 a -2 2623 a
SDict begin 11.7 H.A end
 -2 2623 a -2 2623 a
SDict begin [/View [/XYZ H.V]/Dest (0:2364) cvn /DEST pdfmark end
 -2 2623
a 396 2800 a Fe(static)44 b(void)396 2897 y(s_broker_purge)f
(\(broker_t)1517 2910 y(*)1562 2897 y(self\))396 2994
y({)576 3092 y(worker_t)979 3105 y(*)1024 3092 y(worker)h(=)g
(\(worker_t)1876 3105 y(*)1921 3092 y(\))g(zlist_first)f
(\(self->waiting\);)576 3189 y(while)h(\(worker\))f({)755
3286 y(if)h(\(zclock_time)f(\(\))i(<)f(worker->expiry\))934
3383 y(break;)806 b(//)90 b(Worker)43 b(is)i(alive,)f(we're)g(done)g
(here)755 3480 y(if)g(\(self->verbose\))934 3577 y(zclock_log)f(\("I:)i
(deleting)e(expired)h(worker:)f(\045s",)1472 3674 y
(worker->identity\);)755 3869 y(s_worker_delete)f(\(worker,)i(0\);)755
3966 y(worker)g(=)g(\(worker_t)1607 3979 y(*)1652 3966
y(\))g(zlist_first)f(\(self->waiting\);)576 4063 y(})396
4160 y(})-2 4334 y
SDict begin H.S end
 -2 4334 a -2 4334 a
SDict begin 13 H.A end
 -2 4334 a -2 4334
a
SDict begin [/View [/XYZ H.V]/Dest (0:2365) cvn /DEST pdfmark end
 -2 4334 a 396 4434 a Fk(Here)20 b(is)h(the)g(implementation)d(of)i
(the)g(methods)f(that)h(w)o(ork)g(on)f(a)i(service:)-2
4452 y
SDict begin H.S end
 -2 4452 a -2 4452 a
SDict begin 13 H.A end
 -2 4452 a -2 4452 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-9) cvn /DEST pdfmark
end
 -2 4452
a 396 4635 a Fg(Example)g(4-41.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))19 b(-)h(ser)o(vice)h(methods)-2 4735
y
SDict begin H.S end
 -2 4735 a -2 4735 a
SDict begin 11.7 H.A end
 -2 4735 a -2 4735 a
SDict begin [/View [/XYZ H.V]/Dest (0:2368) cvn /DEST pdfmark end
 -2 4735 a 396
4913 a Fe(//)90 b(Lazy)44 b(constructor)f(that)h(locates)g(a)g(service)
g(by)g(name,)g(or)h(creates)f(a)g(new)396 5010 y(//)90
b(service)43 b(if)i(there)f(is)g(no)h(service)e(already)h(with)g(that)g
(name.)p Black 3756 5569 a Ff(187)p Black eop end
%%Page: 188 201
TeXDict begin 188 200 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.188) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(static)44 b(service_t)1158 85 y(*)396
170 y(s_service_require)e(\(broker_t)1652 183 y(*)1697
170 y(self,)h(zframe_t)2369 183 y(*)2414 170 y(service_frame\))396
267 y({)576 364 y(assert)g(\(service_frame\);)576 461
y(char)800 474 y(*)845 461 y(name)h(=)g(zframe_strdup)f
(\(service_frame\);)576 655 y(service_t)1024 668 y(*)1069
655 y(service)g(=)755 752 y(\(service_t)1248 765 y(*)1293
752 y(\))i(zhash_lookup)d(\(self->services,)h(name\);)576
850 y(if)h(\(service)g(==)g(NULL\))g({)755 947 y(service)g(=)g
(\(service_t)1696 960 y(*)1741 947 y(\))h(zmalloc)f(\(sizeof)f
(\(service_t\)\);)755 1044 y(service->broker)f(=)j(self;)755
1141 y(service->name)e(=)h(name;)755 1238 y(service->requests)e(=)j
(zlist_new)e(\(\);)755 1335 y(service->waiting)f(=)j(zlist_new)e(\(\);)
755 1432 y(zhash_insert)g(\(self->services,)f(name,)i(service\);)755
1530 y(zhash_freefn)f(\(self->services,)f(name,)i(s_service_destroy\);)
755 1627 y(if)g(\(self->verbose\))934 1724 y(zclock_log)f(\("I:)i
(added)f(service:)f(\045s",)h(name\);)576 1821 y(})576
1918 y(else)755 2015 y(free)g(\(name\);)576 2209 y(return)f(service;)
396 2307 y(})396 2501 y(//)90 b(Service)43 b(destructor)g(is)i(called)f
(automatically)e(whenever)i(the)g(service)g(is)396 2598
y(//)90 b(removed)43 b(from)h(broker->services.)396 2792
y(static)g(void)396 2889 y(s_service_destroy)e(\(void)1472
2902 y(*)1517 2889 y(argument\))396 2987 y({)576 3084
y(service_t)1024 3097 y(*)1069 3084 y(service)h(=)i(\(service_t)2010
3097 y(*)2055 3084 y(\))g(argument;)576 3181 y(while)f(\(zlist_size)f
(\(service->requests\)\))e({)755 3278 y(zmsg_t)1069 3291
y(*)1114 3278 y(msg)j(=)h(zlist_pop)e(\(service->requests\);)755
3375 y(zmsg_destroy)g(\(&msg\);)576 3472 y(})576 3569
y(zlist_destroy)f(\(&service->requests\);)576 3666 y(zlist_destroy)g
(\(&service->waiting\);)576 3764 y(free)i(\(service->name\);)576
3861 y(free)g(\(service\);)396 3958 y(})-2 4132 y
SDict begin H.S end
 -2
4132 a -2 4132 a
SDict begin 13 H.A end
 -2 4132 a -2 4132 a
SDict begin [/View [/XYZ H.V]/Dest (0:2369) cvn /DEST pdfmark end
 -2 4132 a 396 4232
a Fk(The)20 b(dispatch)g(method)e(sends)j(requests)e(to)i(w)o(aiting)f
(w)o(ork)o(ers:)-2 4250 y
SDict begin H.S end
 -2 4250 a -2 4250 a
SDict begin 13 H.A end
 -2 4250
a -2 4250 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-10) cvn /DEST pdfmark
end
 -2 4250 a 396 4433 a Fg(Example)h(4-42.)d(Majordomo)h(br)o
(ok)o(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19 b(-)h(ser)o(vice)h(dispatch)f
(method)-2 4533 y
SDict begin H.S end
 -2 4533 a -2 4533 a
SDict begin 11.7 H.A end
 -2 4533 a -2 4533
a
SDict begin [/View [/XYZ H.V]/Dest (0:2372) cvn /DEST pdfmark end
 -2 4533 a 396 4711 a Fe(static)44 b(void)396 4808 y
(s_service_dispatch)e(\(service_t)1741 4821 y(*)1786
4808 y(self,)i(zmsg_t)2369 4821 y(*)2414 4808 y(msg\))396
4905 y({)576 5002 y(assert)f(\(self\);)576 5099 y(if)h(\(msg\))896
b(//)89 b(Queue)44 b(message)g(if)g(any)p Black 3759
5569 a Ff(188)p Black eop end
%%Page: 189 202
TeXDict begin 189 201 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.189) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(zlist_append)43 b(\(self->requests,)f(msg\);)576
267 y(s_broker_purge)g(\(self->broker\);)576 364 y(while)i
(\(zlist_size)f(\(self->waiting\))f(&&)i(zlist_size)g
(\(self->requests\)\))d({)755 461 y(worker_t)1158 474
y(*)1203 461 y(worker)j(=)h(zlist_pop)e(\(self->waiting\);)755
558 y(zlist_remove)g(\(self->broker->waiting,)e(worker\);)755
655 y(zmsg_t)1069 668 y(*)1114 655 y(msg)j(=)h(zlist_pop)e
(\(self->requests\);)755 752 y(s_worker_send)g(\(worker,)g
(MDPW_REQUEST,)g(NULL,)h(msg\);)755 850 y(zmsg_destroy)f(\(&msg\);)576
947 y(})396 1044 y(})-2 1218 y
SDict begin H.S end
 -2 1218 a -2 1218 a
SDict begin 13 H.A end
 -2
1218 a -2 1218 a
SDict begin [/View [/XYZ H.V]/Dest (0:2373) cvn /DEST pdfmark end
 -2 1218 a 396 1318 a Fk(Here)20 b(is)h(the)g
(implementation)d(of)i(the)g(methods)f(that)h(w)o(ork)g(on)f(a)i(w)o
(ork)o(er:)-2 1336 y
SDict begin H.S end
 -2 1336 a -2 1336 a
SDict begin 13 H.A end
 -2 1336 a -2
1336 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-11) cvn /DEST pdfmark
end
 -2 1336 a 396 1519 a Fg(Example)g(4-43.)d(Majordomo)h(br)o(ok)o
(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19 b(-)h(w)o(ork)o(er)h(methods)-2
1619 y
SDict begin H.S end
 -2 1619 a -2 1619 a
SDict begin 11.7 H.A end
 -2 1619 a -2 1619 a
SDict begin [/View [/XYZ H.V]/Dest (0:2376) cvn /DEST pdfmark end
 -2 1619
a 396 1796 a Fe(//)90 b(Lazy)44 b(constructor)f(that)h(locates)g(a)g
(worker)g(by)h(identity,)e(or)h(creates)g(a)h(new)396
1894 y(//)90 b(worker)43 b(if)i(there)f(is)g(no)h(worker)f(already)f
(with)i(that)f(identity.)396 2088 y(static)g(worker_t)1114
2101 y(*)396 2185 y(s_worker_require)e(\(broker_t)1607
2198 y(*)1652 2185 y(self,)i(zframe_t)2324 2198 y(*)2369
2185 y(address\))396 2282 y({)576 2379 y(assert)f(\(address\);)576
2574 y(//)89 b(self->workers)43 b(is)h(keyed)g(off)g(worker)g(identity)
576 2671 y(char)800 2684 y(*)845 2671 y(identity)f(=)i(zframe_strhex)d
(\(address\);)576 2768 y(worker_t)979 2781 y(*)1024 2768
y(worker)i(=)755 2865 y(\(worker_t)1203 2878 y(*)1248
2865 y(\))h(zhash_lookup)e(\(self->workers,)f(identity\);)576
3059 y(if)i(\(worker)g(==)g(NULL\))g({)755 3156 y(worker)g(=)g
(\(worker_t)1607 3169 y(*)1652 3156 y(\))g(zmalloc)g(\(sizeof)g
(\(worker_t\)\);)755 3253 y(worker->broker)e(=)j(self;)755
3351 y(worker->identity)d(=)j(identity;)755 3448 y(worker->address)d(=)
j(zframe_dup)e(\(address\);)755 3545 y(zhash_insert)g(\(self->workers,)
f(identity,)h(worker\);)755 3642 y(zhash_freefn)g(\(self->workers,)f
(identity,)h(s_worker_destroy\);)755 3739 y(if)h(\(self->verbose\))934
3836 y(zclock_log)f(\("I:)i(registering)e(new)h(worker:)g(\045s",)g
(identity\);)576 3933 y(})576 4031 y(else)755 4128 y(free)g
(\(identity\);)576 4225 y(return)f(worker;)396 4322 y(})396
4516 y(//)90 b(The)44 b(delete)g(method)g(deletes)f(the)i(current)e
(worker.)396 4711 y(static)h(void)396 4808 y(s_worker_delete)f
(\(worker_t)1562 4821 y(*)1607 4808 y(self,)h(int)g(disconnect\))396
4905 y({)576 5002 y(assert)f(\(self\);)576 5099 y(if)h(\(disconnect\))p
Black 3759 5569 a Ff(189)p Black eop end
%%Page: 190 203
TeXDict begin 190 202 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.190) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(s_worker_send)43 b(\(self,)g(MDPW_DISCONNECT,)g
(NULL,)h(NULL\);)576 267 y(if)g(\(self->service\))e({)755
364 y(zlist_remove)h(\(self->service->waiting,)e(self\);)755
461 y(self->service->workers--;)576 558 y(})576 655 y(zlist_remove)h
(\(self->broker->waiting,)f(self\);)576 752 y(//)89 b(This)44
b(implicitly)f(calls)h(s_worker_destroy)576 850 y(zhash_delete)e
(\(self->broker->workers,)f(self->identity\);)396 947
y(})396 1141 y(//)90 b(Worker)43 b(destructor)h(is)g(called)g
(automatically)f(whenever)g(the)h(worker)g(is)396 1238
y(//)90 b(removed)43 b(from)h(broker->workers.)396 1432
y(static)g(void)396 1530 y(s_worker_destroy)e(\(void)1427
1543 y(*)1472 1530 y(argument\))396 1627 y({)576 1724
y(worker_t)979 1737 y(*)1024 1724 y(self)i(=)h(\(worker_t)1786
1737 y(*)1831 1724 y(\))g(argument;)576 1821 y(zframe_destroy)d
(\(&self->address\);)576 1918 y(free)i(\(self->identity\);)576
2015 y(free)g(\(self\);)396 2112 y(})-2 2287 y
SDict begin H.S end
 -2 2287
a -2 2287 a
SDict begin 13 H.A end
 -2 2287 a -2 2287 a
SDict begin [/View [/XYZ H.V]/Dest (0:2377) cvn /DEST pdfmark end
 -2 2287 a 396 2386 a
Fk(The)20 b(send)g(method)f(formats)g(and)h(sends)g(a)h(command)d(to)i
(a)h(w)o(ork)o(er)-5 b(.)19 b(The)h(caller)g(may)g(also)h(pro)o(vide)d
(a)i(command)396 2494 y(option,)f(and)h(a)g(message)g(payload:)-2
2512 y
SDict begin H.S end
 -2 2512 a -2 2512 a
SDict begin 13 H.A end
 -2 2512 a -2 2512 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-12) cvn /DEST pdfmark
end
 -2 2512
a 396 2696 a Fg(Example)h(4-44.)d(Majordomo)h(br)o(ok)o(er)h(\(mdbr)o
(ok)o(er)-8 b(.c\))19 b(-)h(w)o(ork)o(er)h(send)g(method)-2
2795 y
SDict begin H.S end
 -2 2795 a -2 2795 a
SDict begin 11.7 H.A end
 -2 2795 a -2 2795 a
SDict begin [/View [/XYZ H.V]/Dest (0:2380) cvn /DEST pdfmark end
 -2 2795
a 396 2973 a Fe(static)44 b(void)396 3070 y(s_worker_send)f(\(worker_t)
1472 3083 y(*)1517 3070 y(self,)h(char)2010 3083 y(*)2055
3070 y(command,)g(char)2683 3083 y(*)2728 3070 y(option,)f(zmsg_t)3400
3083 y(*)3445 3070 y(msg\))396 3167 y({)576 3264 y(msg)h(=)h(msg?)f
(zmsg_dup)f(\(msg\):)h(zmsg_new)g(\(\);)576 3459 y(//)89
b(Stack)44 b(protocol)f(envelope)h(to)g(start)g(of)h(message)576
3556 y(if)f(\(option\))755 3653 y(zmsg_pushstr)f(\(msg,)h(option\);)576
3750 y(zmsg_pushstr)e(\(msg,)i(command\);)576 3847 y(zmsg_pushstr)e
(\(msg,)i(MDPW_WORKER\);)576 4041 y(//)89 b(Stack)44
b(routing)g(envelope)f(to)i(start)f(of)g(message)576
4138 y(zmsg_wrap)f(\(msg,)h(zframe_dup)f(\(self->address\)\);)576
4333 y(if)h(\(self->broker->verbose\))d({)755 4430 y(zclock_log)i
(\("I:)h(sending)g(\045s)g(to)h(worker",)934 4527 y(mdps_commands)e
([\(int\))1876 4540 y(*)1921 4527 y(command]\);)755 4624
y(zmsg_dump)g(\(msg\);)576 4721 y(})576 4818 y(zmsg_send)g(\(&msg,)h
(self->broker->socket\);)396 4916 y(})396 5110 y(//)90
b(This)44 b(worker)g(is)g(now)g(waiting)g(for)g(work)p
Black 3759 5569 a Ff(190)p Black eop end
%%Page: 191 204
TeXDict begin 191 203 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.191) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 170 a Fe(static)44 b(void)396 267 y(s_worker_waiting)e
(\(worker_t)1607 280 y(*)1652 267 y(self\))396 364 y({)576
461 y(//)89 b(Queue)44 b(to)g(broker)g(and)h(service)e(waiting)h(lists)
576 558 y(assert)f(\(self->broker\);)576 655 y(zlist_append)f
(\(self->broker->waiting,)f(self\);)576 752 y(zlist_append)h
(\(self->service->waiting,)f(self\);)576 850 y(self->expiry)h(=)j
(zclock_time)e(\(\))i(+)f(HEARTBEAT_EXPIRY;)576 947 y
(s_service_dispatch)d(\(self->service,)i(NULL\);)396
1044 y(})-2 1218 y
SDict begin H.S end
 -2 1218 a -2 1218 a
SDict begin 13 H.A end
 -2 1218 a -2 1218
a
SDict begin [/View [/XYZ H.V]/Dest (0:2381) cvn /DEST pdfmark end
 -2 1218 a 396 1318 a Fk(Finally)20 b(here)f(is)i(the)f(main)g(task.)g
(W)-7 b(e)21 b(create)e(a)i(ne)n(w)f(brok)o(er)e(instance)h(and)h(then)
f(processes)h(messages)g(on)f(the)h(brok)o(er)396 1426
y(sock)o(et:)-2 1427 y
SDict begin H.S end
 -2 1427 a -2 1427 a
SDict begin 13 H.A end
 -2 1427 a
-2 1427 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdbroker-c-13) cvn /DEST pdfmark
end
 -2 1427 a 396 1627 a Fg(Example)h(4-45.)d(Majordomo)h(br)o
(ok)o(er)h(\(mdbr)o(ok)o(er)-8 b(.c\))19 b(-)h(main)h(task)-2
1727 y
SDict begin H.S end
 -2 1727 a -2 1727 a
SDict begin 11.7 H.A end
 -2 1727 a -2 1727 a
SDict begin [/View [/XYZ H.V]/Dest (0:2384) cvn /DEST pdfmark end
 -2 1727
a 396 1904 a Fe(int)45 b(main)f(\(int)g(argc,)g(char)1517
1917 y(*)1562 1904 y(argv)g([]\))396 2001 y({)576 2099
y(int)g(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g(\(argv)g([1],)g
("-v"\)\);)576 2293 y(broker_t)979 2306 y(*)1024 2293
y(self)g(=)h(s_broker_new)e(\(verbose\);)576 2390 y(s_broker_bind)f
(\(self,)i("tcp://)1832 2403 y(*)1877 2390 y(:5555"\);)576
2584 y(//)89 b(Get)44 b(and)h(process)e(messages)h(forever)f(or)i
(until)f(interrupted)576 2681 y(while)g(\(true\))f({)755
2779 y(zmq_pollitem_t)f(items)i([])h(=)g({)934 2876 y({)g
(self->socket,)87 b(0,)45 b(ZMQ_POLLIN,)e(0)i(})f(};)755
2973 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g(1,)g(HEARTBEAT_INTERVAL)
2907 2986 y(*)2997 2973 y(ZMQ_POLL_MSEC\);)755 3070 y(if)g(\(rc)h(==)f
(-1\))934 3167 y(break;)627 b(//)89 b(Interrupted)755
3361 y(//)g(Process)44 b(next)g(input)g(message,)g(if)g(any)755
3459 y(if)g(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
3556 y(zmsg_t)1248 3569 y(*)1293 3556 y(msg)h(=)h(zmsg_recv)e
(\(self->socket\);)934 3653 y(if)i(\(!msg\))1114 3750
y(break;)447 b(//)89 b(Interrupted)934 3847 y(if)45 b
(\(self->verbose\))d({)1114 3944 y(zclock_log)h(\("I:)h(received)f
(message:"\);)1114 4041 y(zmsg_dump)g(\(msg\);)934 4138
y(})934 4236 y(zframe_t)1338 4249 y(*)1383 4236 y(sender)g(=)i
(zmsg_pop)f(\(msg\);)934 4333 y(zframe_t)1338 4346 y(*)1383
4333 y(empty)88 b(=)45 b(zmsg_pop)f(\(msg\);)934 4430
y(zframe_t)1338 4443 y(*)1383 4430 y(header)f(=)i(zmsg_pop)f(\(msg\);)
934 4624 y(if)h(\(zframe_streq)d(\(header,)i(MDPC_CLIENT\)\))1114
4721 y(s_broker_client_msg)d(\(self,)j(sender,)g(msg\);)934
4818 y(else)934 4916 y(if)h(\(zframe_streq)d(\(header,)i
(MDPW_WORKER\)\))1114 5013 y(s_broker_worker_msg)d(\(self,)j(sender,)g
(msg\);)934 5110 y(else)g({)p Black 3759 5569 a Ff(191)p
Black eop end
%%Page: 192 205
TeXDict begin 192 204 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.192) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2400) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 1114 72 a Fe(zclock_log)43 b(\("E:)h(invalid)g(message:"\);)1114
170 y(zmsg_dump)f(\(msg\);)1114 267 y(zmsg_destroy)f(\(&msg\);)934
364 y(})934 461 y(zframe_destroy)h(\(&sender\);)934 558
y(zframe_destroy)g(\(&empty\);)934 655 y(zframe_destroy)g(\(&header\);)
755 752 y(})755 850 y(//)89 b(Disconnect)43 b(and)i(delete)f(any)g
(expired)g(workers)755 947 y(//)89 b(Send)44 b(heartbeats)g(to)g(idle)g
(workers)g(if)g(needed)755 1044 y(if)g(\(zclock_time)f(\(\))i(>)f
(self->heartbeat_at\))e({)934 1141 y(s_broker_purge)h(\(self\);)934
1238 y(worker_t)1338 1251 y(*)1383 1238 y(worker)g(=)i(\(worker_t)2234
1251 y(*)2279 1238 y(\))g(zlist_first)e(\(self->waiting\);)934
1335 y(while)h(\(worker\))g({)1114 1432 y(s_worker_send)e(\(worker,)i
(MDPW_HEARTBEAT,)e(NULL,)i(NULL\);)1114 1530 y(worker)f(=)i(\(worker_t)
1965 1543 y(*)2010 1530 y(\))g(zlist_next)e(\(self->waiting\);)934
1627 y(})934 1724 y(self->heartbeat_at)f(=)j(zclock_time)e(\(\))h(+)h
(HEARTBEAT_INTERVAL;)755 1821 y(})576 1918 y(})576 2015
y(if)f(\(zctx_interrupted\))755 2112 y(printf)g(\("W:)g(interrupt)f
(received,)h(shutting)f(down...\\n"\);)576 2307 y(s_broker_destroy)f
(\(&self\);)576 2404 y(return)h(0;)396 2501 y(})-2 2675
y
SDict begin H.S end
 -2 2675 a -2 2675 a
SDict begin 13 H.A end
 -2 2675 a -2 2675 a
SDict begin [/View [/XYZ H.V]/Dest (0:2385) cvn /DEST pdfmark end
 -2 2675 a 396
2775 a Fk(This)21 b(is)g(by)f(f)o(ar)g(the)g(most)g(comple)o(x)e(e)o
(xample)h(we')l(v)o(e)g(seen.)h(It')-5 b(s)21 b(almost)g(500)e(lines)h
(of)g(code.)g(T)-7 b(o)20 b(write)g(this,)h(and)396 2883
y(mak)o(e)f(it)h(some)n(what)e(rob)n(ust)h(took)f(tw)o(o)i(days.)e(Ho)n
(we)n(v)o(er)g(this)i(is)g(still)g(a)g(short)f(piece)g(of)g(code)f(for)
h(a)g(full)396 2991 y(service-oriented)e(brok)o(er)-5
b(.)-2 3158 y
SDict begin H.S end
 -2 3158 a -2 3158 a
SDict begin 13 H.A end
 -2 3158 a -2 3158 a
SDict begin [/View [/XYZ H.V]/Dest (0:2386) cvn /DEST pdfmark end

-2 3158 a 396 3265 a Fk(Notes)21 b(on)e(this)i(code:)-2
3266 y
SDict begin H.S end
 -2 3266 a -2 3266 a
SDict begin 13 H.A end
 -2 3266 a -2 3266 a
SDict begin [/View [/XYZ H.V]/Dest (0:2387) cvn /DEST pdfmark end
 -2 3266
a -2 3276 a
SDict begin H.S end
 -2 3276 a -2 3276 a
SDict begin 13 H.A end
 -2 3276 a -2 3276 a
SDict begin [/View [/XYZ H.V]/Dest (0:2388) cvn /DEST pdfmark end
 -2
3276 a Black 396 3435 a Fj(\225)p Black 479 3435 a
SDict begin H.S end
 479
3435 a 479 3435 a
SDict begin 13 H.A end
 479 3435 a 479 3435 a
SDict begin [/View [/XYZ H.V]/Dest (0:2389) cvn /DEST pdfmark end
 479 3435 a Fk(The)f(Majordomo)e
(Protocol)h(lets)i(us)g(handle)e(both)g(clients)i(and)e(w)o(ork)o(ers)h
(on)g(a)g(single)g(sock)o(et.)g(This)g(is)i(nicer)d(for)479
3543 y(those)h(deplo)o(ying)e(and)i(managing)e(the)i(brok)o(er:)f(it)i
(just)g(sits)g(on)f(one)g(\330MQ)g(endpoint)e(rather)i(than)f(the)i(tw)
o(o)f(that)479 3651 y(most)h(de)n(vices)e(need.)-2 3652
y
SDict begin H.S end
 -2 3652 a -2 3652 a
SDict begin 13 H.A end
 -2 3652 a -2 3652 a
SDict begin [/View [/XYZ H.V]/Dest (0:2390) cvn /DEST pdfmark end
 -2 3652 a Black
396 3800 a Fj(\225)p Black 479 3800 a
SDict begin H.S end
 479 3800 a 479
3800 a
SDict begin 13 H.A end
 479 3800 a 479 3800 a
SDict begin [/View [/XYZ H.V]/Dest (0:2391) cvn /DEST pdfmark end
 479 3800 a Fk(The)h(brok)o(er)f
(implements)g(all)i(of)f(MDP/0.1)f(properly)f(\(as)j(f)o(ar)f(as)h(I)f
(kno)n(w\),)f(including)f(disconnection)g(if)j(the)479
3908 y(brok)o(er)e(sends)h(in)m(v)n(alid)f(commands,)f(heartbeating,)g
(and)i(the)g(rest.)-2 3926 y
SDict begin H.S end
 -2 3926 a -2 3926 a
SDict begin 13 H.A end
 -2 3926
a -2 3926 a
SDict begin [/View [/XYZ H.V]/Dest (0:2392) cvn /DEST pdfmark end
 -2 3926 a Black 396 4058 a Fj(\225)p Black
479 4058 a
SDict begin H.S end
 479 4058 a 479 4058 a
SDict begin 13 H.A end
 479 4058 a 479 4058
a
SDict begin [/View [/XYZ H.V]/Dest (0:2393) cvn /DEST pdfmark end
 479 4058 a Fk(It)h(can)f(be)g(e)o(xtended)e(to)i(run)g(multiple)f
(threads,)h(each)g(managing)e(one)h(sock)o(et)h(and)g(one)g(set)h(of)f
(clients)g(and)479 4165 y(w)o(ork)o(ers.)g(This)g(could)f(be)h
(interesting)g(for)f(se)o(gmenting)f(lar)o(ge)i(architectures.)e(The)i
(C)h(code)f(is)h(already)e(or)o(ganized)479 4273 y(around)g(a)h(brok)o
(er)f(class)i(to)f(mak)o(e)g(this)h(tri)n(vial.)-2 4274
y
SDict begin H.S end
 -2 4274 a -2 4274 a
SDict begin 13 H.A end
 -2 4274 a -2 4274 a
SDict begin [/View [/XYZ H.V]/Dest (0:2394) cvn /DEST pdfmark end
 -2 4274 a Black
396 4423 a Fj(\225)p Black 479 4423 a
SDict begin H.S end
 479 4423 a 479
4423 a
SDict begin 13 H.A end
 479 4423 a 479 4423 a
SDict begin [/View [/XYZ H.V]/Dest (0:2395) cvn /DEST pdfmark end
 479 4423 a Fk(A)g(primary-f)o(ail-o)o(v)o
(er)16 b(or)k(li)n(v)o(e-li)n(v)o(e)e(brok)o(er)h(reliability)h(model)f
(is)i(easy)-5 b(,)20 b(since)g(the)g(brok)o(er)f(essentially)h(has)h
(no)479 4531 y(state)g(e)o(xcept)e(service)h(presence.)f(It')-5
b(s)21 b(up)f(to)g(clients)h(and)e(w)o(ork)o(ers)h(to)g(choose)f
(another)g(brok)o(er)g(if)h(their)g(\002rst)479 4639
y(choice)g(isn')o(t)g(up)f(and)h(running.)-2 4657 y
SDict begin H.S end
 -2
4657 a -2 4657 a
SDict begin 13 H.A end
 -2 4657 a -2 4657 a
SDict begin [/View [/XYZ H.V]/Dest (0:2396) cvn /DEST pdfmark end
 -2 4657 a Black
396 4788 a Fj(\225)p Black 479 4788 a
SDict begin H.S end
 479 4788 a 479
4788 a
SDict begin 13 H.A end
 479 4788 a 479 4788 a
SDict begin [/View [/XYZ H.V]/Dest (0:2397) cvn /DEST pdfmark end
 479 4788 a Fk(The)g(e)o(xamples)f(use)i
(5-second)d(heartbeats,)h(mainly)h(to)g(reduce)f(the)h(amount)f(of)h
(output)f(when)g(you)h(enable)479 4896 y(tracing.)f(Realistic)i(v)n
(alues)f(w)o(ould)f(be)h(lo)n(wer)g(for)f(most)h(LAN)g(applications.)f
(Ho)n(we)n(v)o(er)m(,)f(an)o(y)h(retry)g(has)h(to)h(be)e(slo)n(w)479
5004 y(enough)f(to)j(allo)n(w)f(for)g(a)g(service)g(to)g(restart,)g
(say)h(10)f(seconds)f(at)i(least.)-2 5022 y
SDict begin H.S end
 -2 5022 a
-2 5022 a
SDict begin 13 H.A end
 -2 5022 a -2 5022 a
SDict begin [/View [/XYZ H.V]/Dest (0:2398) cvn /DEST pdfmark end
 -2 5022 a Black 3759 5569
a Ff(192)p Black eop end
%%Page: 193 206
TeXDict begin 193 205 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.193) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2399) cvn /DEST pdfmark end
 479 72 a Fk(W)-7 b(e)22
b(later)e(impro)o(v)o(ed)d(and)j(e)o(xtended)e(the)i(protocol)f(and)h
(the)g(Majordomo)e(implementation,)f(which)j(no)n(w)g(sits)h(in)479
180 y(its)g(o)n(wn)f(Github)g(project.)f(If)h(you)f(w)o(ant)h(a)h
(properly)d(usable)i(Majordomo)e(stack,)i(use)g(the)g(github)f
(project.)-2 240 y
SDict begin H.S end
 -2 240 a -2 240 a
SDict begin 13 H.A end
 -2 240 a -2 240
a
SDict begin [/View [/XYZ H.V]/Dest (0:2400) cvn /DEST pdfmark end
 -2 240 a 359 x Fn(4.9.)39 b(Async)o(hr)m(onous)d(Major)m(domo)h(P)l
(attern)2619 599 y
SDict begin H.S end
 2619 599 a 2619 599 a
SDict begin 22.464 H.A end
 2619 599 a 2619
599 a
SDict begin [/View [/XYZ H.V]/Dest (9.63.1) cvn /DEST pdfmark end
 2619 599 a -2 795 a
SDict begin H.S end
 -2 795 a -2 795 a
SDict begin 13 H.A end
 -2 795 a
-2 795 a
SDict begin [/View [/XYZ H.V]/Dest (0:2402) cvn /DEST pdfmark end
 -2 795 a 396 873 a Fk(The)20 b(w)o(ay)g(we)h(implemented)d
(Majordomo,)g(abo)o(v)o(e,)g(is)j(simple)f(and)g(stupid.)f(The)h
(client)h(is)g(just)f(the)h(original)e(Simple)396 981
y(Pirate,)h(wrapped)f(up)h(in)g(a)h(se)o(xy)e(API.)i(When)f(I)g(\002re)
h(up)e(a)i(client,)f(brok)o(er)m(,)e(and)i(w)o(ork)o(er)f(on)h(a)g
(test)h(box,)e(it)i(can)f(process)396 1089 y(100,000)e(requests)i(in)g
(about)f(14)h(seconds.)f(That)h(is)h(partly)f(due)g(to)g(the)g(code,)f
(which)h(cheerfully)e(copies)i(message)396 1197 y(frames)g(around)e(as)
j(if)g(CPU)g(c)o(ycles)f(were)g(free.)f(But)i(the)f(real)h(problem)d
(is)j(that)f(we')l(re)g(doing)f(netw)o(ork)g(round-trips.)396
1305 y(\330MQ)i(disables)899 1305 y
SDict begin H.S end
 899 1305 a 899 1305
a
SDict begin 13 H.A end
 899 1305 a 899 1305 a
SDict begin [/View [/XYZ H.V]/Dest (0:2403) cvn /DEST pdfmark end
 899 1305 a Fk(Nagle')-5 b(s)20
b(algorithm)f(\(http://en.wikipedia.or)o(g/wiki/Nagles_)o(algo)o(rithm)
o(\),)14 b(b)n(ut)21 b(round-tripping)16 b(is)396 1413
y(still)22 b(slo)n(w)-5 b(.)-2 1580 y
SDict begin H.S end
 -2 1580 a -2 1580
a
SDict begin 13 H.A end
 -2 1580 a -2 1580 a
SDict begin [/View [/XYZ H.V]/Dest (0:2404) cvn /DEST pdfmark end
 -2 1580 a 396 1687 a Fk(Theory)19
b(is)i(great)f(in)g(theory)-5 b(,)18 b(b)n(ut)i(in)h(practice,)e
(practice)h(is)h(better)-5 b(.)20 b(Let')-5 b(s)20 b(measure)g(the)g
(actual)g(cost)h(of)396 1795 y(round-tripping)16 b(with)21
b(a)f(simple)g(test)i(program.)17 b(This)k(sends)f(a)h(b)n(unch)e(of)g
(messages,)h(\002rst)h(w)o(aiting)f(for)g(a)h(reply)e(to)396
1902 y(each)h(message,)g(and)g(second)f(as)i(a)f(batch,)g(reading)e
(all)j(the)f(replies)h(back)e(as)i(a)g(batch.)e(Both)h(approaches)e(do)
i(the)396 2010 y(same)h(w)o(ork,)e(b)n(ut)h(the)o(y)g(gi)n(v)o(e)f(v)o
(ery)g(dif)n(ferent)g(results.)h(W)-7 b(e)21 b(mock-up)d(a)j(client,)f
(brok)o(er)m(,)e(and)h(w)o(ork)o(er:)-2 2028 y
SDict begin H.S end
 -2 2028
a -2 2028 a
SDict begin 13 H.A end
 -2 2028 a -2 2028 a
SDict begin [/View [/XYZ H.V]/Dest (0:tripping-c) cvn /DEST pdfmark
end
 -2 2028 a 396 2212 a
Fg(Example)i(4-46.)d(Round-trip)i(demonstrator)f(\(tripping)o(.c\))-2
2312 y
SDict begin H.S end
 -2 2312 a -2 2312 a
SDict begin 11.7 H.A end
 -2 2312 a -2 2312 a
SDict begin [/View [/XYZ H.V]/Dest (0:2407) cvn /DEST pdfmark end
 -2 2312
a 396 2392 a Fe(//)396 2489 y(//)90 b(Round-trip)43 b(demonstrator)396
2586 y(//)396 2683 y(//)90 b(While)44 b(this)g(example)f(runs)i(in)f(a)
h(single)f(process,)f(that)h(is)h(just)f(to)g(make)396
2780 y(//)90 b(it)44 b(easier)g(to)g(start)g(and)h(stop)f(the)g
(example.)g(The)g(client)g(task)g(signals)g(to)396 2878
y(//)90 b(main)44 b(when)g(it's)g(ready.)396 2975 y(//)396
3072 y(#include)g("czmq.h")396 3266 y(static)g(void)396
3363 y(client_task)f(\(void)1203 3376 y(*)1248 3363 y(args,)h(zctx_t)
1831 3376 y(*)1876 3363 y(ctx,)g(void)2324 3376 y(*)2369
3363 y(pipe\))396 3460 y({)576 3558 y(void)800 3571 y(*)845
3558 y(client)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)576
3655 y(zsocket_connect)e(\(client,)h("tcp://localhost:5555"\);)576
3752 y(printf)g(\("Setting)h(up)g(test...\\n"\);)576
3849 y(zclock_sleep)e(\(100\);)576 4043 y(int)i(requests;)576
4140 y(int64_t)f(start;)576 4335 y(printf)g(\("Synchronous)g
(round-trip)g(test...\\n"\);)576 4432 y(start)h(=)g(zclock_time)f
(\(\);)576 4529 y(for)h(\(requests)f(=)i(0;)f(requests)g(<)h(10000;)e
(requests++\))g({)755 4626 y(zstr_send)g(\(client,)h("hello"\);)755
4723 y(char)979 4736 y(*)1024 4723 y(reply)g(=)h(zstr_recv)e
(\(client\);)755 4820 y(free)h(\(reply\);)576 4917 y(})576
5015 y(printf)f(\(")i(\045d)f(calls/second\\n",)755 5112
y(\(1000)1024 5125 y(*)1114 5112 y(10000\))f(/)i(\(int\))f
(\(zclock_time)f(\(\))h(-)h(start\)\);)p Black 3759 5569
a Ff(193)p Black eop end
%%Page: 194 207
TeXDict begin 194 206 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.194) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 170 a Fe(printf)43 b(\("Asynchronous)g(round-trip)g
(test...\\n"\);)576 267 y(start)h(=)g(zclock_time)f(\(\);)576
364 y(for)h(\(requests)f(=)i(0;)f(requests)g(<)h(100000;)e
(requests++\))755 461 y(zstr_send)g(\(client,)h("hello"\);)576
558 y(for)g(\(requests)f(=)i(0;)f(requests)g(<)h(100000;)e
(requests++\))g({)755 655 y(char)979 668 y(*)1024 655
y(reply)h(=)h(zstr_recv)e(\(client\);)755 752 y(free)h(\(reply\);)576
850 y(})576 947 y(printf)f(\(")i(\045d)f(calls/second\\n",)755
1044 y(\(1000)1024 1057 y(*)1114 1044 y(100000\))f(/)i(\(int\))f
(\(zclock_time)f(\(\))h(-)h(start\)\);)576 1141 y(zstr_send)e(\(pipe,)h
("done"\);)396 1238 y(})-2 1412 y
SDict begin H.S end
 -2 1412 a -2 1412 a
SDict begin 13 H.A end

-2 1412 a -2 1412 a
SDict begin [/View [/XYZ H.V]/Dest (0:2408) cvn /DEST pdfmark end
 -2 1412 a 396 1512 a Fk(Here)20 b(is)h(the)g(w)o
(ork)o(er)e(task.)h(All)h(it)g(does)f(is)h(recei)n(v)o(e)e(a)i
(message,)e(and)h(bounce)f(it)i(back)e(the)h(w)o(ay)h(it)f(came:)-2
1530 y
SDict begin H.S end
 -2 1530 a -2 1530 a
SDict begin 13 H.A end
 -2 1530 a -2 1530 a
SDict begin [/View [/XYZ H.V]/Dest (0:tripping-c-1) cvn /DEST pdfmark
end
 -2 1530
a 396 1713 a Fg(Example)h(4-47.)d(Round-trip)i(demonstrator)f
(\(tripping)o(.c\))g(-)i(w)o(ork)o(er)f(task)-2 1813
y
SDict begin H.S end
 -2 1813 a -2 1813 a
SDict begin 11.7 H.A end
 -2 1813 a -2 1813 a
SDict begin [/View [/XYZ H.V]/Dest (0:2411) cvn /DEST pdfmark end
 -2 1813 a 396
1991 a Fe(static)44 b(void)934 2004 y(*)396 2088 y(worker_task)f
(\(void)1203 2101 y(*)1248 2088 y(args\))396 2185 y({)576
2282 y(zctx_t)889 2295 y(*)934 2282 y(ctx)i(=)f(zctx_new)g(\(\);)576
2379 y(void)800 2392 y(*)845 2379 y(worker)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_DEALER\);)576 2476 y(zsocket_connect)e(\(worker,)h
("tcp://localhost:5556"\);)576 2671 y(while)h(\(true\))f({)755
2768 y(zmsg_t)1069 2781 y(*)1114 2768 y(msg)h(=)h(zmsg_recv)e
(\(worker\);)755 2865 y(zmsg_send)g(\(&msg,)h(worker\);)576
2962 y(})576 3059 y(zctx_destroy)e(\(&ctx\);)576 3156
y(return)h(NULL;)396 3253 y(})-2 3428 y
SDict begin H.S end
 -2 3428 a -2
3428 a
SDict begin 13 H.A end
 -2 3428 a -2 3428 a
SDict begin [/View [/XYZ H.V]/Dest (0:2412) cvn /DEST pdfmark end
 -2 3428 a 396 3527 a Fk(Here)20
b(is)h(the)g(brok)o(er)d(task.)j(It)f(uses)h(the)f(zmq_proxy)d
(function)h(to)j(switch)f(messages)h(between)e(frontend)f(and)396
3635 y(back)o(end:)-2 3636 y
SDict begin H.S end
 -2 3636 a -2 3636 a
SDict begin 13 H.A end
 -2 3636
a -2 3636 a
SDict begin [/View [/XYZ H.V]/Dest (0:tripping-c-2) cvn /DEST pdfmark
end
 -2 3636 a 396 3837 a Fg(Example)j(4-48.)d(Round-trip)i
(demonstrator)f(\(tripping)o(.c\))g(-)i(br)o(ok)o(er)f(task)-2
3937 y
SDict begin H.S end
 -2 3937 a -2 3937 a
SDict begin 11.7 H.A end
 -2 3937 a -2 3937 a
SDict begin [/View [/XYZ H.V]/Dest (0:2415) cvn /DEST pdfmark end
 -2 3937
a 396 4114 a Fe(static)44 b(void)934 4127 y(*)396 4211
y(broker_task)f(\(void)1203 4224 y(*)1248 4211 y(args\))396
4308 y({)576 4405 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(sockets)
576 4503 y(zctx_t)889 4516 y(*)934 4503 y(ctx)h(=)f(zctx_new)g(\(\);)
576 4600 y(void)800 4613 y(*)845 4600 y(frontend)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_DEALER\);)576 4697 y(zsocket_bind)e(\(frontend,)i
("tcp://)1967 4710 y(*)2012 4697 y(:5555"\);)576 4794
y(void)800 4807 y(*)845 4794 y(backend)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_DEALER\);)576 4891 y(zsocket_bind)e(\(backend,)i("tcp://)1922
4904 y(*)1967 4891 y(:5556"\);)576 4988 y(zmq_proxy)f(\(frontend,)g
(backend,)h(NULL\);)576 5085 y(zctx_destroy)e(\(&ctx\);)p
Black 3759 5569 a Ff(194)p Black eop end
%%Page: 195 208
TeXDict begin 195 207 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.195) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(return)43 b(NULL;)396 170 y(})-2 344
y
SDict begin H.S end
 -2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:2416) cvn /DEST pdfmark end
 -2 344 a 396 444
a Fk(Finally)-5 b(,)20 b(here')-5 b(s)20 b(the)g(main)g(task,)g(which)g
(starts)h(the)f(client,)g(w)o(ork)o(er)m(,)e(and)i(brok)o(er)m(,)e(and)
i(then)f(runs)h(until)g(the)g(client)396 552 y(signals)h(it)g(to)f
(stop:)-2 569 y
SDict begin H.S end
 -2 569 a -2 569 a
SDict begin 13 H.A end
 -2 569 a -2 569 a
SDict begin [/View [/XYZ H.V]/Dest (0:tripping-c-3) cvn /DEST pdfmark
end
 -2
569 a 396 753 a Fg(Example)h(4-49.)d(Round-trip)i(demonstrator)f
(\(tripping)o(.c\))g(-)i(main)g(task)-2 853 y
SDict begin H.S end
 -2 853
a -2 853 a
SDict begin 11.7 H.A end
 -2 853 a -2 853 a
SDict begin [/View [/XYZ H.V]/Dest (0:2419) cvn /DEST pdfmark end
 -2 853 a 396 1030 a Fe(int)45
b(main)f(\(void\))396 1127 y({)576 1224 y(//)89 b(Create)44
b(threads)576 1322 y(zctx_t)889 1335 y(*)934 1322 y(ctx)h(=)f(zctx_new)
g(\(\);)576 1419 y(void)800 1432 y(*)845 1419 y(client)f(=)i
(zthread_fork)e(\(ctx,)h(client_task,)f(NULL\);)576 1516
y(zthread_new)g(\(worker_task,)f(NULL\);)576 1613 y(zthread_new)h
(\(broker_task,)f(NULL\);)576 1807 y(//)89 b(Wait)44
b(for)g(signal)g(on)h(client)f(pipe)576 1904 y(char)800
1917 y(*)845 1904 y(signal)f(=)i(zstr_recv)e(\(client\);)576
2001 y(free)h(\(signal\);)576 2196 y(zctx_destroy)e(\(&ctx\);)576
2293 y(return)h(0;)396 2390 y(})-2 2564 y
SDict begin H.S end
 -2 2564 a -2
2564 a
SDict begin 13 H.A end
 -2 2564 a -2 2564 a
SDict begin [/View [/XYZ H.V]/Dest (0:2420) cvn /DEST pdfmark end
 -2 2564 a 396 2664 a Fk(On)20
b(my)g(de)n(v)o(elopment)e(box,)h(this)h(program)e(says:)-2
2765 y
SDict begin H.S end
 -2 2765 a -2 2765 a
SDict begin 11.7 H.A end
 -2 2765 a -2 2765 a
SDict begin [/View [/XYZ H.V]/Dest (0:2421) cvn /DEST pdfmark end
 -2 2765
a 396 2844 a Fe(Setting)44 b(up)g(test...)396 2941 y(Synchronous)f
(round-trip)g(test...)441 3038 y(9057)h(calls/second)396
3136 y(Asynchronous)f(round-trip)g(test...)441 3233 y(173010)h
(calls/second)-2 3405 y
SDict begin H.S end
 -2 3405 a -2 3405 a
SDict begin 13 H.A end
 -2 3405 a
-2 3405 a
SDict begin [/View [/XYZ H.V]/Dest (0:2422) cvn /DEST pdfmark end
 -2 3405 a 396 3507 a Fk(Note)20 b(that)h(the)f(client)g
(thread)f(does)h(a)h(small)g(pause)e(before)g(starting.)h(This)g(is)h
(to)g(get)f(around)e(one)i(of)g(the)g('features')396
3615 y(of)g(the)g(router)f(sock)o(et:)i(if)f(you)f(send)h(a)h(message)f
(with)g(the)g(address)g(of)g(a)h(peer)e(that')-5 b(s)21
b(not)f(yet)g(connected,)e(the)396 3723 y(message)i(gets)h(discarded.)d
(In)i(this)h(e)o(xample)e(we)h(don')o(t)f(use)h(the)h(LR)m(U)f
(mechanism,)f(so)h(without)g(the)g(sleep,)g(if)h(the)396
3830 y(w)o(ork)o(er)e(thread)h(is)h(too)f(slo)n(w)g(to)h(connect,)d
(it')o(ll)j(lose)g(messages,)f(making)f(a)h(mess)h(of)f(our)f(test.)-2
4014 y
SDict begin H.S end
 -2 4014 a -2 4014 a
SDict begin 13 H.A end
 -2 4014 a -2 4014 a
SDict begin [/View [/XYZ H.V]/Dest (0:2423) cvn /DEST pdfmark end
 -2 4014
a 396 4104 a Fk(As)i(we)g(see,)f(round-tripping)c(in)21
b(the)f(simplest)g(case)h(is)g(20)f(times)h(slo)n(wer)f(than)f("sho)o
(v)o(e)g(it)i(do)n(wn)e(the)h(pipe)g(as)h(f)o(ast)g(as)396
4212 y(it')o(ll)g(go")f(asynchronous)d(approach.)h(Let')-5
b(s)21 b(see)f(if)h(we)f(can)g(apply)g(this)g(to)h(Majordomo)d(to)i
(mak)o(e)g(it)h(f)o(aster)-5 b(.)-2 4396 y
SDict begin H.S end
 -2 4396 a
-2 4396 a
SDict begin 13 H.A end
 -2 4396 a -2 4396 a
SDict begin [/View [/XYZ H.V]/Dest (0:2424) cvn /DEST pdfmark end
 -2 4396 a 396 4486 a Fk(First,)21
b(we)g(modify)d(the)i(client)h(API)f(to)g(ha)n(v)o(e)g(separate)g(send)
g(and)f(recv)h(methods:)-2 4587 y
SDict begin H.S end
 -2 4587 a -2 4587 a
SDict begin 11.7 H.A end

-2 4587 a -2 4587 a
SDict begin [/View [/XYZ H.V]/Dest (0:2425) cvn /DEST pdfmark end
 -2 4587 a 396 4667 a Fe(mdcli_t)755
4680 y(*)800 4667 y(mdcli_new)222 b(\(char)1696 4680
y(*)1741 4667 y(broker\);)396 4764 y(void)i(mdcli_destroy)42
b(\(mdcli_t)1831 4777 y(**)1921 4764 y(self_p\);)396
4861 y(int)269 b(mdcli_send)177 b(\(mdcli_t)1831 4874
y(*)1876 4861 y(self,)44 b(char)2369 4874 y(*)2414 4861
y(service,)f(zmsg_t)3131 4874 y(**)3221 4861 y(request_p\);)396
4958 y(zmsg_t)755 4971 y(*)800 4958 y(mdcli_recv)177
b(\(mdcli_t)1831 4971 y(*)1876 4958 y(self\);)p Black
3759 5569 a Ff(195)p Black eop end
%%Page: 196 209
TeXDict begin 196 208 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.196) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2426) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(It')-5 b(s)21 b(literally)f(a)h(fe)n(w)f(minutes')f
(w)o(ork)h(to)g(ref)o(actor)f(the)h(synchronous)e(client)i(API)h(to)f
(become)f(asynchronous:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90
a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdcliapi2-c) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)i(4-50.)d(Majordomo)h(asynchr)o
(onous)h(client)g(API)h(\(mdcliapi2.c\))-2 374 y
SDict begin H.S end
 -2 374
a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:2429) cvn /DEST pdfmark end
 -2 374 a 396 454 a Fe(/)441
467 y(*)576 454 y(=====================================)o(======)o
(======)o(======)o(======)o(=====)o(===)441 564 y(*)576
551 y(mdcliapi2.c)43 b(-)h(Majordomo)g(Protocol)f(Client)h(API)441
661 y(*)576 648 y(Implements)f(the)h(MDP/Worker)f(spec)h(at)h
(http://rfc.zeromq.org/spec:7.)441 758 y(*)576 745 y
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 758 y(*)3759 745 y(/)396 940
y(#include)f("mdcliapi2.h")396 1134 y(//)90 b(Structure)43
b(of)h(our)h(class)396 1231 y(//)90 b(We)44 b(access)g(these)g
(properties)f(only)h(via)h(class)f(methods)396 1425 y(struct)g
(_mdcli_t)g({)576 1522 y(zctx_t)889 1535 y(*)934 1522
y(ctx;)717 b(//)89 b(Our)45 b(context)576 1620 y(char)800
1633 y(*)845 1620 y(broker;)576 1717 y(void)800 1730
y(*)845 1717 y(client;)671 b(//)89 b(Socket)44 b(to)h(broker)576
1814 y(int)f(verbose;)716 b(//)89 b(Print)44 b(activity)g(to)g(stdout)
576 1911 y(int)g(timeout;)716 b(//)89 b(Request)44 b(timeout)396
2008 y(};)396 2202 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
2300 y(//)g(Connect)43 b(or)i(reconnect)e(to)i(broker.)e(In)i(this)f
(asynchronous)f(class)h(we)g(use)g(a)396 2397 y(//)90
b(DEALER)43 b(socket)h(instead)g(of)g(a)h(REQ)f(socket;)g(this)g(lets)g
(us)h(send)f(any)g(number)396 2494 y(//)90 b(of)44 b(requests)g
(without)f(waiting)h(for)g(a)h(reply.)396 2688 y(void)f
(s_mdcli_connect_to_broker)d(\(mdcli_t)2190 2701 y(*)2235
2688 y(self\))396 2785 y({)576 2882 y(if)j(\(self->client\))755
2979 y(zsocket_destroy)e(\(self->ctx,)h(self->client\);)576
3077 y(self->client)f(=)j(zsocket_new)e(\(self->ctx,)g(ZMQ_DEALER\);)
576 3174 y(zmq_connect)g(\(self->client,)f(self->broker\);)576
3271 y(if)i(\(self->verbose\))755 3368 y(zclock_log)f(\("I:)h
(connecting)f(to)i(broker)f(at)g(\045s...",)g(self->broker\);)396
3465 y(})396 3757 y(//)90 b(The)44 b(constructor)f(and)h(destructor)f
(are)i(the)f(same)g(as)h(in)f(mdcliapi,)g(except)396
3854 y(//)90 b(we)44 b(don't)g(do)h(retries,)e(so)i(there's)e(no)i
(retries)e(property.)396 3951 y(...)396 4048 y(...)-2
4215 y
SDict begin H.S end
 -2 4215 a -2 4215 a
SDict begin 13 H.A end
 -2 4215 a -2 4215 a
SDict begin [/View [/XYZ H.V]/Dest (0:2430) cvn /DEST pdfmark end
 -2 4215
a 396 4322 a Fk(And)20 b(here')-5 b(s)20 b(the)g(corresponding)d
(client)j(test)h(program:)-2 4340 y
SDict begin H.S end
 -2 4340 a -2 4340
a
SDict begin 13 H.A end
 -2 4340 a -2 4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:mdclient2-c) cvn /DEST pdfmark
end
 -2 4340 a 396 4523 a Fg(Example)g(4-51.)d
(Majordomo)h(client)i(application)e(\(mdclient2.c\))-2
4623 y
SDict begin H.S end
 -2 4623 a -2 4623 a
SDict begin 11.7 H.A end
 -2 4623 a -2 4623 a
SDict begin [/View [/XYZ H.V]/Dest (0:2433) cvn /DEST pdfmark end
 -2 4623
a 396 4703 a Fe(//)396 4801 y(//)90 b(Majordomo)43 b(Protocol)g(client)
h(example)g(-)h(asynchronous)396 4898 y(//)90 b(Uses)44
b(the)g(mdcli)g(API)g(to)h(hide)f(all)g(MDP)h(aspects)396
4995 y(//)396 5092 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)p Black 3757 5569 a
Ff(196)p Black eop end
%%Page: 197 210
TeXDict begin 197 209 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.197) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(#include)44 b("mdcliapi2.c")396 267
y(int)h(main)f(\(int)g(argc,)g(char)1517 280 y(*)1562
267 y(argv)g([]\))396 364 y({)576 461 y(int)g(verbose)g(=)g(\(argc)g(>)
h(1)g(&&)f(streq)g(\(argv)g([1],)g("-v"\)\);)576 558
y(mdcli_t)934 571 y(*)979 558 y(session)g(=)g(mdcli_new)g
(\("tcp://localhost:5555",)d(verbose\);)576 752 y(int)j(count;)576
850 y(for)g(\(count)g(=)g(0;)h(count)f(<)h(100000;)e(count++\))h({)755
947 y(zmsg_t)1069 960 y(*)1114 947 y(request)f(=)i(zmsg_new)e(\(\);)755
1044 y(zmsg_pushstr)g(\(request,)g("Hello)h(world"\);)755
1141 y(mdcli_send)f(\(session,)g("echo",)h(&request\);)576
1238 y(})576 1335 y(for)g(\(count)g(=)g(0;)h(count)f(<)h(100000;)e
(count++\))h({)755 1432 y(zmsg_t)1069 1445 y(*)1114 1432
y(reply)g(=)g(mdcli_recv)f(\(session\);)755 1530 y(if)h(\(reply\))934
1627 y(zmsg_destroy)f(\(&reply\);)755 1724 y(else)934
1821 y(break;)627 b(//)89 b(Interrupted)43 b(by)i(Ctrl-C)576
1918 y(})576 2015 y(printf)e(\("\045d)i(replies)e(received\\n",)g
(count\);)576 2112 y(mdcli_destroy)f(\(&session\);)576
2209 y(return)h(0;)396 2307 y(})-2 2481 y
SDict begin H.S end
 -2 2481 a -2
2481 a
SDict begin 13 H.A end
 -2 2481 a -2 2481 a
SDict begin [/View [/XYZ H.V]/Dest (0:2434) cvn /DEST pdfmark end
 -2 2481 a 396 2581 a Fk(The)20
b(brok)o(er)f(and)g(w)o(ork)o(er)g(are)h(unchanged,)e(since)i(we')l(v)o
(e)f(not)h(modi\002ed)f(the)h(protocol)e(at)j(all.)g(W)-7
b(e)21 b(see)g(an)f(immediate)396 2689 y(impro)o(v)o(ement)d(in)k
(performance.)c(Here')-5 b(s)20 b(the)g(synchronous)e(client)i
(chugging)e(through)g(100K)h(request-reply)396 2796 y(c)o(ycles:)-2
2897 y
SDict begin H.S end
 -2 2897 a -2 2897 a
SDict begin 11.7 H.A end
 -2 2897 a -2 2897 a
SDict begin [/View [/XYZ H.V]/Dest (0:2435) cvn /DEST pdfmark end
 -2 2897
a 396 2977 a Fe($)45 b(time)f(mdclient)396 3074 y(100000)g
(requests/replies)e(processed)396 3268 y(real)179 b(0m14.088s)396
3365 y(user)g(0m1.310s)396 3462 y(sys)224 b(0m2.670s)-2
3640 y
SDict begin H.S end
 -2 3640 a -2 3640 a
SDict begin 13 H.A end
 -2 3640 a -2 3640 a
SDict begin [/View [/XYZ H.V]/Dest (0:2436) cvn /DEST pdfmark end
 -2 3640
a 396 3736 a Fk(And)20 b(here')-5 b(s)20 b(the)g(asynchronous)d
(client,)j(with)h(a)f(single)h(w)o(ork)o(er:)-2 3837
y
SDict begin H.S end
 -2 3837 a -2 3837 a
SDict begin 11.7 H.A end
 -2 3837 a -2 3837 a
SDict begin [/View [/XYZ H.V]/Dest (0:2437) cvn /DEST pdfmark end
 -2 3837 a 396
3916 a Fe($)45 b(time)f(mdclient2)396 4014 y(100000)g(replies)g
(received)396 4208 y(real)179 b(0m8.730s)396 4305 y(user)g(0m0.920s)396
4402 y(sys)224 b(0m1.550s)-2 4580 y
SDict begin H.S end
 -2 4580 a -2 4580
a
SDict begin 13 H.A end
 -2 4580 a -2 4580 a
SDict begin [/View [/XYZ H.V]/Dest (0:2438) cvn /DEST pdfmark end
 -2 4580 a 396 4676 a Fk(T)-7 b(wice)21
b(as)g(f)o(ast.)f(Not)h(bad,)e(b)n(ut)h(let')-5 b(s)21
b(\002re)g(up)f(10)f(w)o(ork)o(ers,)h(and)f(see)i(ho)n(w)f(it)h
(handles:)-2 4777 y
SDict begin H.S end
 -2 4777 a -2 4777 a
SDict begin 11.7 H.A end
 -2 4777 a -2
4777 a
SDict begin [/View [/XYZ H.V]/Dest (0:2439) cvn /DEST pdfmark end
 -2 4777 a 396 4856 a Fe($)45 b(time)f(mdclient2)396
4953 y(100000)g(replies)g(received)396 5148 y(real)179
b(0m3.863s)p Black 3756 5569 a Ff(197)p Black eop end
%%Page: 198 211
TeXDict begin 198 210 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.198) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(user)179 b(0m0.730s)396 170 y(sys)224
b(0m0.470s)-2 347 y
SDict begin H.S end
 -2 347 a -2 347 a
SDict begin 13 H.A end
 -2 347 a -2 347
a
SDict begin [/View [/XYZ H.V]/Dest (0:2440) cvn /DEST pdfmark end
 -2 347 a 396 444 a Fk(It)21 b(isn')o(t)f(fully)f(asynchronous)e
(since)k(w)o(ork)o(ers)e(get)i(their)e(messages)i(on)f(a)g(strict)h(LR)
m(U)f(basis.)h(But)g(it)g(will)g(scale)f(better)396 552
y(with)h(more)e(w)o(ork)o(ers.)g(On)h(my)g(PC,)h(after)f(eight)g(or)g
(so)g(w)o(ork)o(ers)g(it)h(doesn')o(t)e(get)h(an)o(y)f(f)o(aster)-5
b(.)21 b(F)o(our)e(cores)h(only)396 659 y(stretches)h(so)f(f)o(ar)-5
b(.)20 b(But)h(we)g(got)e(a)i(4x)f(impro)o(v)o(ement)d(in)j(throughput)
d(with)k(just)f(a)h(fe)n(w)f(minutes')g(w)o(ork.)f(The)h(brok)o(er)e
(is)396 767 y(still)k(unoptimized.)17 b(It)k(spends)e(most)i(of)f(its)h
(time)f(cop)o(ying)f(message)h(frames)f(around,)f(instead)i(of)g(doing)
f(zero)h(cop)o(y)-5 b(,)396 875 y(which)20 b(it)h(could.)e(But)i(we')l
(re)e(getting)g(25K)h(reliable)g(request/reply)e(calls)j(a)g(second,)e
(with)h(pretty)g(lo)n(w)g(ef)n(fort.)-2 1059 y
SDict begin H.S end
 -2 1059
a -2 1059 a
SDict begin 13 H.A end
 -2 1059 a -2 1059 a
SDict begin [/View [/XYZ H.V]/Dest (0:2441) cvn /DEST pdfmark end
 -2 1059 a 396 1149 a
Fk(Ho)n(we)n(v)o(er)f(the)h(asynchronous)d(Majordomo)h(pattern)h(isn')o
(t)h(all)h(roses.)f(It)h(has)f(a)h(fundamental)d(weakness,)h(namely)396
1257 y(that)i(it)f(cannot)g(survi)n(v)o(e)e(a)j(brok)o(er)e(crash)h
(without)f(more)g(w)o(ork.)h(If)g(you)f(look)g(at)i(the)f(mdcliapi2)f
(code)h(you')o(ll)f(see)i(it)396 1365 y(does)f(not)g(attempt)g(to)g
(reconnect)f(after)h(a)g(f)o(ailure.)g(A)g(proper)f(reconnect)f(w)o
(ould)i(require:)-2 1383 y
SDict begin H.S end
 -2 1383 a -2 1383 a
SDict begin 13 H.A end
 -2 1383
a -2 1383 a
SDict begin [/View [/XYZ H.V]/Dest (0:2442) cvn /DEST pdfmark end
 -2 1383 a -2 1393 a
SDict begin H.S end
 -2 1393 a -2 1393 a
SDict begin 13 H.A end
 -2
1393 a -2 1393 a
SDict begin [/View [/XYZ H.V]/Dest (0:2443) cvn /DEST pdfmark end
 -2 1393 a Black 396 1535 a Fj(\225)p
Black 479 1535 a
SDict begin H.S end
 479 1535 a 479 1535 a
SDict begin 13 H.A end
 479 1535 a 479
1535 a
SDict begin [/View [/XYZ H.V]/Dest (0:2444) cvn /DEST pdfmark end
 479 1535 a Fk(That)g(e)n(v)o(ery)f(request)h(is)h(numbered,)c
(and)j(e)n(v)o(ery)f(reply)g(has)h(a)h(matching)e(number)m(,)f(which)h
(w)o(ould)h(ideally)g(require)479 1643 y(a)h(change)e(to)h(the)g
(protocol)f(to)h(enforce.)-2 1661 y
SDict begin H.S end
 -2 1661 a -2 1661
a
SDict begin 13 H.A end
 -2 1661 a -2 1661 a
SDict begin [/View [/XYZ H.V]/Dest (0:2445) cvn /DEST pdfmark end
 -2 1661 a Black 396 1793 a Fj(\225)p
Black 479 1793 a
SDict begin H.S end
 479 1793 a 479 1793 a
SDict begin 13 H.A end
 479 1793 a 479
1793 a
SDict begin [/View [/XYZ H.V]/Dest (0:2446) cvn /DEST pdfmark end
 479 1793 a Fk(That)g(the)g(client)h(API)f(tracks)g(and)g(holds)f
(onto)h(all)h(outstanding)d(requests,)h(i.e.)i(for)e(which)h(no)g
(reply)f(had)h(yet)g(been)479 1901 y(recei)n(v)o(ed.)-2
1902 y
SDict begin H.S end
 -2 1902 a -2 1902 a
SDict begin 13 H.A end
 -2 1902 a -2 1902 a
SDict begin [/View [/XYZ H.V]/Dest (0:2447) cvn /DEST pdfmark end
 -2 1902
a Black 396 2050 a Fj(\225)p Black 479 2050 a
SDict begin H.S end
 479 2050
a 479 2050 a
SDict begin 13 H.A end
 479 2050 a 479 2050 a
SDict begin [/View [/XYZ H.V]/Dest (0:2448) cvn /DEST pdfmark end
 479 2050 a Fk(That)g(in)h(case)f(of)
g(f)o(ail-o)o(v)o(er)m(,)e(the)i(client)g(API)1794 2050
y
SDict begin H.S end
 1794 2050 a 1794 2050 a
SDict begin 13 H.A end
 1794 2050 a 1794 2050 a
SDict begin [/View [/XYZ H.V]/Dest (0:2449) cvn /DEST pdfmark end
 1794
2050 a Ff(r)m(esends)g Fk(all)h(outstanding)d(requests)i(to)g(the)g
(brok)o(er)-5 b(.)-2 2234 y
SDict begin H.S end
 -2 2234 a -2 2234 a
SDict begin 13 H.A end
 -2 2234
a -2 2234 a
SDict begin [/View [/XYZ H.V]/Dest (0:2450) cvn /DEST pdfmark end
 -2 2234 a 396 2324 a Fk(It')g(s)21 b(not)f(a)h(deal)f
(break)o(er)e(b)n(ut)j(it)g(does)f(sho)n(w)f(that)i(performance)c
(often)i(means)h(comple)o(xity)-5 b(.)18 b(Is)i(this)h(w)o(orth)f
(doing)f(for)396 2432 y(Majordomo?)f(It)i(depends)f(on)h(your)f(use)h
(case.)h(F)o(or)f(a)g(name)g(lookup)e(service)i(you)f(call)i(once)e
(per)h(session,)h(no.)e(F)o(or)h(a)396 2540 y(web)g(front-end)e
(serving)h(thousands)g(of)h(clients,)g(probably)e(yes.)-2
2568 y
SDict begin H.S end
 -2 2568 a -2 2568 a
SDict begin 13 H.A end
 -2 2568 a -2 2568 a
SDict begin [/View [/XYZ H.V]/Dest (0:2451) cvn /DEST pdfmark end
 -2 2568
a 359 x Fn(4.10.)39 b(Ser)q(vice)f(Disco)m(ver)q(y)1594
2927 y
SDict begin H.S end
 1594 2927 a 1594 2927 a
SDict begin 22.464 H.A end
 1594 2927 a 1594 2927
a
SDict begin [/View [/XYZ H.V]/Dest (9.64.1) cvn /DEST pdfmark end
 1594 2927 a -2 3123 a
SDict begin H.S end
 -2 3123 a -2 3123 a
SDict begin 13 H.A end
 -2 3123 a
-2 3123 a
SDict begin [/View [/XYZ H.V]/Dest (0:2453) cvn /DEST pdfmark end
 -2 3123 a 396 3201 a Fk(So,)20 b(we)h(ha)n(v)o(e)f(a)g(nice)g
(service-oriented)e(brok)o(er)m(,)g(b)n(ut)i(we)h(ha)n(v)o(e)e(no)h(w)o
(ay)g(of)g(kno)n(wing)e(whether)i(a)g(particular)f(service)396
3309 y(is)i(a)n(v)n(ailable)f(or)g(not.)g(W)-7 b(e)21
b(kno)n(w)e(if)i(a)f(request)g(f)o(ailed,)f(b)n(ut)i(we)f(don')o(t)f
(kno)n(w)g(why)-5 b(.)19 b(It)h(is)h(useful)f(to)g(be)g(able)g(to)h
(ask)f(the)396 3417 y(brok)o(er)m(,)e("is)j(the)g(echo)e(service)h
(running?")e(The)i(most)g(ob)o(vious)e(w)o(ay)i(w)o(ould)g(be)g(to)g
(modify)f(our)g(MDP/Client)396 3525 y(protocol)e(to)j(add)e(commands)f
(to)i(ask)g(the)g(brok)o(er)m(,)e("is)j(service)e(X)i(running?")c(But)k
(MDP/Client)f(has)g(the)g(great)g(charm)396 3633 y(of)h(being)f
(simple.)h(Adding)f(service)h(disco)o(v)o(ery)e(to)i(it)h(w)o(ould)f
(mak)o(e)g(it)g(as)h(comple)o(x)e(as)i(the)f(MDP/W)-7
b(ork)o(er)20 b(protocol.)-2 3817 y
SDict begin H.S end
 -2 3817 a -2 3817
a
SDict begin 13 H.A end
 -2 3817 a -2 3817 a
SDict begin [/View [/XYZ H.V]/Dest (0:2454) cvn /DEST pdfmark end
 -2 3817 a 396 3907 a Fk(Another)f(option)g(is)i
(to)g(do)e(what)h(email)h(does,)e(and)h(ask)g(that)h(undeli)n(v)o
(erable)c(requests)j(be)g(returned.)e(This)i(can)g(w)o(ork)396
4015 y(well)h(in)f(an)g(asynchronous)e(w)o(orld)h(b)n(ut)i(it)f(also)h
(adds)f(comple)o(xity)-5 b(.)17 b(W)-7 b(e)22 b(need)d(w)o(ays)i(to)f
(distinguish)f(returned)396 4123 y(requests)h(from)f(replies,)h(and)g
(to)g(handle)f(these)i(properly)-5 b(.)-2 4307 y
SDict begin H.S end
 -2 4307
a -2 4307 a
SDict begin 13 H.A end
 -2 4307 a -2 4307 a
SDict begin [/View [/XYZ H.V]/Dest (0:2455) cvn /DEST pdfmark end
 -2 4307 a 396 4397 a
Fk(Let')g(s)21 b(try)f(to)g(use)h(what)f(we')l(v)o(e)f(already)g(b)n
(uilt,)h(b)n(uilding)f(on)h(top)g(of)g(MDP)g(instead)g(of)g(modifying)e
(it.)j(Service)396 4505 y(disco)o(v)o(ery)d(is,)j(itself,)g(a)f
(service.)g(It)g(might)g(indeed)f(be)h(one)g(of)g(se)n(v)o(eral)f
(management)f(services,)i(such)g(as)h("disable)396 4613
y(service)f(X",)g("pro)o(vide)e(statistics",)k(and)d(so)i(on.)f(What)g
(we)h(w)o(ant)f(is)h(a)g(general,)e(e)o(xtensible)g(solution)g(that)h
(doesn')o(t)396 4721 y(af)n(fect)g(the)g(protocol)f(nor)g(e)o(xisting)g
(applications.)-2 4905 y
SDict begin H.S end
 -2 4905 a -2 4905 a
SDict begin 13 H.A end
 -2 4905
a -2 4905 a
SDict begin [/View [/XYZ H.V]/Dest (0:2456) cvn /DEST pdfmark end
 -2 4905 a 396 4995 a Fk(So)h(here')-5 b(s)19
b(a)h(small)g(RFC)h(-)f(MMI,)f(or)g(the)h(Majordomo)d(Management)h
(Interf)o(ace)g(-)i(that)f(layers)h(this)g(on)f(top)g(of)g(MDP:)396
5103 y(http://rfc.zeromq.or)o(g/spec:8.)14 b(W)-7 b(e)22
b(already)d(implemented)f(it)j(in)f(the)g(brok)o(er)m(,)e(though)h
(unless)h(you)f(read)h(the)g(whole)p Black 3759 5569
a Ff(198)p Black eop end
%%Page: 199 212
TeXDict begin 199 211 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.199) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fk(thing)g(you)f(probably)f(missed)i(that.)g(Here')-5
b(s)21 b(ho)n(w)e(we)i(use)f(the)h(service)e(disco)o(v)o(ery)g(in)h(an)
g(application:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90
a
SDict begin [/View [/XYZ H.V]/Dest (0:mmiecho-c) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)h(4-52.)d(Ser)o(vice)i(disco)o(v)o(ery)g
(o)o(v)o(er)g(Majordomo)f(\(mmiecho.c\))-2 374 y
SDict begin H.S end
 -2 374
a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:2459) cvn /DEST pdfmark end
 -2 374 a 396 454 a Fe(//)396
551 y(//)90 b(MMI)44 b(echo)g(query)g(example)396 648
y(//)396 843 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)g
(creating)f(a)i(library)396 940 y(#include)f("mdcliapi.c")396
1134 y(int)h(main)f(\(int)g(argc,)g(char)1517 1147 y(*)1562
1134 y(argv)g([]\))396 1231 y({)576 1328 y(int)g(verbose)g(=)g(\(argc)g
(>)h(1)g(&&)f(streq)g(\(argv)g([1],)g("-v"\)\);)576 1425
y(mdcli_t)934 1438 y(*)979 1425 y(session)g(=)g(mdcli_new)g
(\("tcp://localhost:5555",)d(verbose\);)576 1620 y(//)89
b(This)44 b(is)h(the)f(service)g(we)g(want)g(to)h(look)f(up)576
1717 y(zmsg_t)889 1730 y(*)934 1717 y(request)g(=)h(zmsg_new)e(\(\);)
576 1814 y(zmsg_addstr)g(\(request,)g("echo"\);)576 2008
y(//)89 b(This)44 b(is)h(the)f(service)g(we)g(send)g(our)h(request)e
(to)576 2105 y(zmsg_t)889 2118 y(*)934 2105 y(reply)h(=)h(mdcli_send)e
(\(session,)g("mmi.service",)g(&request\);)576 2300 y(if)h(\(reply\))g
({)755 2397 y(char)979 2410 y(*)1024 2397 y(reply_code)f(=)i
(zframe_strdup)d(\(zmsg_first)h(\(reply\)\);)755 2494
y(printf)h(\("Lookup)f(echo)h(service:)g(\045s\\n",)g(reply_code\);)755
2591 y(free)g(\(reply_code\);)755 2688 y(zmsg_destroy)f(\(&reply\);)576
2785 y(})576 2882 y(else)755 2979 y(printf)h(\("E:)g(no)g(response)g
(from)g(broker,)g(make)g(sure)g(it's)g(running\\n"\);)576
3174 y(mdcli_destroy)e(\(&session\);)576 3271 y(return)h(0;)396
3368 y(})-2 3542 y
SDict begin H.S end
 -2 3542 a -2 3542 a
SDict begin 13 H.A end
 -2 3542 a -2 3542
a
SDict begin [/View [/XYZ H.V]/Dest (0:2460) cvn /DEST pdfmark end
 -2 3542 a 396 3642 a Fk(The)20 b(brok)o(er)f(checks)g(the)i(service)e
(name,)h(and)f(handles)h(an)o(y)f(service)h(starting)g(with)g("mmi.")g
(itself,)g(rather)g(than)396 3750 y(passing)g(the)g(request)g(on)g(to)g
(a)h(w)o(ork)o(er)-5 b(.)19 b(T)m(ry)h(this)g(with)h(and)e(without)h(a)
g(w)o(ork)o(er)g(running,)d(and)j(you)f(should)h(see)g(the)396
3858 y(little)h(program)d(report)h('200')g(or)h('404')e(accordingly)-5
b(.)17 b(The)j(implementation)e(of)i(MMI)g(in)h(our)e(e)o(xample)g
(brok)o(er)f(is)396 3966 y(pretty)i(weak.)f(F)o(or)h(e)o(xample)f(if)h
(a)h(w)o(ork)o(er)e(disappears,)g(services)h(remain)g("present".)f(In)h
(practice)f(a)i(brok)o(er)d(should)396 4074 y(remo)o(v)o(e)h(services)h
(that)g(ha)n(v)o(e)g(no)f(w)o(ork)o(ers)h(after)g(some)g
(con\002gurable)d(timeout.)-2 4102 y
SDict begin H.S end
 -2 4102 a -2 4102
a
SDict begin 13 H.A end
 -2 4102 a -2 4102 a
SDict begin [/View [/XYZ H.V]/Dest (0:2461) cvn /DEST pdfmark end
 -2 4102 a 359 x Fn(4.11.)39 b(Idempotent)e(Ser)q
(vices)1763 4461 y
SDict begin H.S end
 1763 4461 a 1763 4461 a
SDict begin 22.464 H.A end
 1763 4461
a 1763 4461 a
SDict begin [/View [/XYZ H.V]/Dest (9.65.1) cvn /DEST pdfmark end
 1763 4461 a -2 4657 a
SDict begin H.S end
 -2 4657 a -2 4657
a
SDict begin 13 H.A end
 -2 4657 a -2 4657 a
SDict begin [/View [/XYZ H.V]/Dest (0:2463) cvn /DEST pdfmark end
 -2 4657 a 396 4735 a Fk(Idempotenc)o(y)17
b(is)k(not)f(something)f(you)g(tak)o(e)h(a)h(pill)g(for)-5
b(.)19 b(What)i(it)g(means)f(is)h(that)f(it')-5 b(s)21
b(safe)g(to)f(repeat)g(an)g(operation.)396 4843 y(Checking)f(the)h
(clock)g(is)h(idempotent.)d(Lending)h(ones)h(credit)f(card)h(to)g(ones)
g(children)f(is)i(not.)f(While)h(man)o(y)396 4951 y(client-to-serv)o
(er)d(use)i(cases)h(are)f(idempotent,)f(some)h(are)g(not.)f(Examples)g
(of)h(idempotent)f(use)h(cases)h(include:)-2 4969 y
SDict begin H.S end
 -2
4969 a -2 4969 a
SDict begin 13 H.A end
 -2 4969 a -2 4969 a
SDict begin [/View [/XYZ H.V]/Dest (0:2464) cvn /DEST pdfmark end
 -2 4969 a -2 4979
a
SDict begin H.S end
 -2 4979 a -2 4979 a
SDict begin 13 H.A end
 -2 4979 a -2 4979 a
SDict begin [/View [/XYZ H.V]/Dest (0:2465) cvn /DEST pdfmark end
 -2 4979 a Black
3759 5569 a Ff(199)p Black eop end
%%Page: 200 213
TeXDict begin 200 212 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.200) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2466) cvn /DEST pdfmark end
 479 72 a Fk(Stateless)i(task)e(distrib)n
(ution,)f(i.e.)h(a)h(pipeline)e(where)h(the)g(serv)o(ers)f(are)h
(stateless)i(w)o(ork)o(ers)d(that)i(compute)d(a)j(reply)479
180 y(based)f(purely)f(on)h(the)g(state)h(pro)o(vided)d(by)h(a)i
(request.)e(In)h(such)g(a)h(case)f(it')-5 b(s)22 b(safe)e(\(though)e
(inef)n(\002cient\))h(to)h(e)o(x)o(ecute)479 288 y(the)g(same)h
(request)e(man)o(y)g(times.)-2 306 y
SDict begin H.S end
 -2 306 a -2 306
a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:2467) cvn /DEST pdfmark end
 -2 306 a Black 396 438 a Fj(\225)p
Black 479 438 a
SDict begin H.S end
 479 438 a 479 438 a
SDict begin 13 H.A end
 479 438 a 479 438
a
SDict begin [/View [/XYZ H.V]/Dest (0:2468) cvn /DEST pdfmark end
 479 438 a Fk(A)i(name)e(service)g(that)h(translates)g(logical)g
(addresses)f(into)h(endpoints)e(to)i(bind)f(or)h(connect)e(to.)i(In)g
(such)f(a)h(case)h(it')-5 b(s)479 546 y(safe)21 b(to)f(mak)o(e)g(the)g
(same)g(lookup)f(request)g(man)o(y)g(times.)-2 730 y
SDict begin H.S end

-2 730 a -2 730 a
SDict begin 13 H.A end
 -2 730 a -2 730 a
SDict begin [/View [/XYZ H.V]/Dest (0:2469) cvn /DEST pdfmark end
 -2 730 a 396 820
a Fk(And)h(here)g(are)g(e)o(xamples)f(of)h(a)g(non-idempotent)d(use)j
(cases:)-2 838 y
SDict begin H.S end
 -2 838 a -2 838 a
SDict begin 13 H.A end
 -2 838 a -2 838 a
SDict begin [/View [/XYZ H.V]/Dest (0:2470) cvn /DEST pdfmark end

-2 838 a -2 848 a
SDict begin H.S end
 -2 848 a -2 848 a
SDict begin 13 H.A end
 -2 848 a -2 848 a
SDict begin [/View [/XYZ H.V]/Dest (0:2471) cvn /DEST pdfmark end

-2 848 a Black 396 990 a Fj(\225)p Black 479 990 a
SDict begin H.S end
 479
990 a 479 990 a
SDict begin 13 H.A end
 479 990 a 479 990 a
SDict begin [/View [/XYZ H.V]/Dest (0:2472) cvn /DEST pdfmark end
 479 990 a Fk(A)h(logging)d
(service.)i(One)g(does)g(not)g(w)o(ant)g(the)g(same)h(log)f
(information)d(recorded)i(more)g(than)h(once.)-2 1008
y
SDict begin H.S end
 -2 1008 a -2 1008 a
SDict begin 13 H.A end
 -2 1008 a -2 1008 a
SDict begin [/View [/XYZ H.V]/Dest (0:2473) cvn /DEST pdfmark end
 -2 1008 a Black
396 1139 a Fj(\225)p Black 479 1139 a
SDict begin H.S end
 479 1139 a 479
1139 a
SDict begin 13 H.A end
 479 1139 a 479 1139 a
SDict begin [/View [/XYZ H.V]/Dest (0:2474) cvn /DEST pdfmark end
 479 1139 a Fk(An)o(y)g(service)g(that)g
(has)g(impact)g(on)g(do)n(wnstream)e(nodes,)i(e.g.)f(sends)h(on)g
(information)e(to)i(other)g(nodes.)f(If)h(that)479 1247
y(service)g(gets)h(the)f(same)g(request)g(more)f(than)h(once,)f(do)n
(wnstream)g(nodes)g(will)i(get)f(duplicate)f(information.)-2
1265 y
SDict begin H.S end
 -2 1265 a -2 1265 a
SDict begin 13 H.A end
 -2 1265 a -2 1265 a
SDict begin [/View [/XYZ H.V]/Dest (0:2475) cvn /DEST pdfmark end
 -2 1265
a Black 396 1397 a Fj(\225)p Black 479 1397 a
SDict begin H.S end
 479 1397
a 479 1397 a
SDict begin 13 H.A end
 479 1397 a 479 1397 a
SDict begin [/View [/XYZ H.V]/Dest (0:2476) cvn /DEST pdfmark end
 479 1397 a Fk(An)o(y)h(service)g
(that)g(modi\002es)g(shared)f(data)h(in)h(some)f(non-idempotent)c(w)o
(ay)-5 b(.)20 b(E.g.)f(a)i(service)f(that)g(debits)g(a)h(bank)479
1505 y(account)e(is)i(de\002nitely)f(not)g(idempotent.)-2
1689 y
SDict begin H.S end
 -2 1689 a -2 1689 a
SDict begin 13 H.A end
 -2 1689 a -2 1689 a
SDict begin [/View [/XYZ H.V]/Dest (0:2477) cvn /DEST pdfmark end
 -2 1689
a 396 1779 a Fk(When)g(our)g(serv)o(er)f(applications)g(are)h(not)g
(idempotent,)e(we)j(ha)n(v)o(e)e(to)i(think)e(more)g(carefully)g(about)
g(when)h(e)o(xactly)396 1887 y(the)o(y)g(might)f(crash.)h(If)g(an)g
(application)f(dies)h(when)g(it')-5 b(s)21 b(idle,)f(or)g(while)g(it')
-5 b(s)22 b(processing)d(a)h(request,)f(that')-5 b(s)21
b(usually)396 1994 y(\002ne.)e(W)-7 b(e)21 b(can)e(use)h(database)f
(transactions)f(to)i(mak)o(e)e(sure)i(a)g(debit)e(and)h(a)h(credit)f
(are)g(al)o(w)o(ays)h(done)e(together)m(,)g(if)i(at)f(all.)396
2102 y(If)h(the)h(serv)o(er)e(dies)h(while)h(sending)e(its)i(reply)-5
b(,)19 b(that')-5 b(s)20 b(a)h(problem,)d(because)i(as)g(f)o(ar)h(as)f
(it')-5 b(s)22 b(concerned,)17 b(it')-5 b(s)22 b(done)d(its)396
2210 y(w)o(ork.)-2 2377 y
SDict begin H.S end
 -2 2377 a -2 2377 a
SDict begin 13 H.A end
 -2 2377
a -2 2377 a
SDict begin [/View [/XYZ H.V]/Dest (0:2478) cvn /DEST pdfmark end
 -2 2377 a 396 2484 a Fk(if)i(the)f(netw)o(ork)f(dies)h
(just)h(as)g(the)f(reply)g(is)h(making)e(its)i(w)o(ay)f(back)g(to)g
(the)g(client,)g(the)g(same)h(problem)d(arises.)j(The)396
2592 y(client)f(will)h(think)f(the)g(serv)o(er)f(died,)h(will)h(resend)
e(the)h(request,)g(and)f(the)i(serv)o(er)e(will)i(do)f(the)g(same)g(w)o
(ork)g(twice.)396 2700 y(Which)g(is)h(not)f(what)g(we)h(w)o(ant.)-2
2867 y
SDict begin H.S end
 -2 2867 a -2 2867 a
SDict begin 13 H.A end
 -2 2867 a -2 2867 a
SDict begin [/View [/XYZ H.V]/Dest (0:2479) cvn /DEST pdfmark end
 -2 2867
a 396 2974 a Fk(W)-7 b(e)22 b(use)e(the)g(f)o(airly)g(standard)f
(solution)g(of)h(detecting)f(and)h(rejecting)f(duplicate)g(requests.)h
(This)g(means:)-2 2992 y
SDict begin H.S end
 -2 2992 a -2 2992 a
SDict begin 13 H.A end
 -2 2992
a -2 2992 a
SDict begin [/View [/XYZ H.V]/Dest (0:2480) cvn /DEST pdfmark end
 -2 2992 a -2 3002 a
SDict begin H.S end
 -2 3002 a -2 3002 a
SDict begin 13 H.A end
 -2
3002 a -2 3002 a
SDict begin [/View [/XYZ H.V]/Dest (0:2481) cvn /DEST pdfmark end
 -2 3002 a Black 396 3144 a Fj(\225)p
Black 479 3144 a
SDict begin H.S end
 479 3144 a 479 3144 a
SDict begin 13 H.A end
 479 3144 a 479
3144 a
SDict begin [/View [/XYZ H.V]/Dest (0:2482) cvn /DEST pdfmark end
 479 3144 a Fk(The)g(client)g(must)h(stamp)f(e)n(v)o(ery)f
(request)g(with)h(a)h(unique)e(client)h(identi\002er)g(and)f(a)i
(unique)e(message)h(number)-5 b(.)-2 3162 y
SDict begin H.S end
 -2 3162 a
-2 3162 a
SDict begin 13 H.A end
 -2 3162 a -2 3162 a
SDict begin [/View [/XYZ H.V]/Dest (0:2483) cvn /DEST pdfmark end
 -2 3162 a Black 396 3294
a Fj(\225)p Black 479 3294 a
SDict begin H.S end
 479 3294 a 479 3294 a
SDict begin 13 H.A end
 479
3294 a 479 3294 a
SDict begin [/View [/XYZ H.V]/Dest (0:2484) cvn /DEST pdfmark end
 479 3294 a Fk(The)20 b(serv)o(er)m(,)f(before)g
(sending)g(back)g(a)i(reply)-5 b(,)19 b(stores)h(it)h(using)f(the)g
(client)g(id)g(+)h(message)f(number)e(as)j(a)g(k)o(e)o(y)-5
b(.)-2 3312 y
SDict begin H.S end
 -2 3312 a -2 3312 a
SDict begin 13 H.A end
 -2 3312 a -2 3312 a
SDict begin [/View [/XYZ H.V]/Dest (0:2485) cvn /DEST pdfmark end

-2 3312 a Black 396 3443 a Fj(\225)p Black 479 3443 a
SDict begin H.S end

479 3443 a 479 3443 a
SDict begin 13 H.A end
 479 3443 a 479 3443 a
SDict begin [/View [/XYZ H.V]/Dest (0:2486) cvn /DEST pdfmark end
 479 3443
a Fk(The)20 b(serv)o(er)m(,)f(when)g(getting)h(a)g(request)g(from)f(a)i
(gi)n(v)o(en)e(client,)h(\002rst)h(checks)e(if)i(it)g(has)f(a)h(reply)e
(for)h(that)g(client)g(id)g(+)479 3551 y(message)g(number)-5
b(.)19 b(If)h(so,)g(it)h(does)f(not)g(process)g(the)g(request)f(b)n(ut)
i(just)f(resends)g(the)g(reply)-5 b(.)-2 3611 y
SDict begin H.S end
 -2 3611
a -2 3611 a
SDict begin 13 H.A end
 -2 3611 a -2 3611 a
SDict begin [/View [/XYZ H.V]/Dest (0:2487) cvn /DEST pdfmark end
 -2 3611 a 359 x Fn(4.12.)39
b(Disconnected)d(Reliability)i(\(Titanic)g(P)l(attern\))3145
3970 y
SDict begin H.S end
 3145 3970 a 3145 3970 a
SDict begin 22.464 H.A end
 3145 3970 a 3145 3970
a
SDict begin [/View [/XYZ H.V]/Dest (9.66.1) cvn /DEST pdfmark end
 3145 3970 a -2 4165 a
SDict begin H.S end
 -2 4165 a -2 4165 a
SDict begin 13 H.A end
 -2 4165 a
-2 4165 a
SDict begin [/View [/XYZ H.V]/Dest (0:2489) cvn /DEST pdfmark end
 -2 4165 a 396 4244 a Fk(Once)20 b(you)f(realize)h(that)h
(Majordomo)d(is)j(a)f(')l(reliable')f(message)h(brok)o(er)m(,)e(you)i
(might)f(be)h(tempted)f(to)i(add)e(some)396 4352 y(spinning)g(rust)h
(\(that)g(is,)h(ferrous-based)d(hard)h(disk)h(platters\).)g(After)g
(all,)g(this)h(w)o(orks)f(for)f(all)i(the)f(enterprise)396
4460 y(messaging)g(systems.)g(It')-5 b(s)21 b(such)f(a)g(tempting)f
(idea)h(that)h(it')-5 b(s)21 b(a)g(little)g(sad)f(to)g(ha)n(v)o(e)g(to)
g(be)g(ne)o(gati)n(v)o(e.)e(But)j(brutal)396 4567 y(c)o(ynicism)f(is)h
(one)e(of)h(my)g(specialties.)g(So,)h(some)f(reasons)f(you)h(don')o(t)e
(w)o(ant)j(rust-based)e(brok)o(ers)f(sitting)j(in)f(the)396
4675 y(center)g(of)g(your)f(architecture)f(are:)-2 4693
y
SDict begin H.S end
 -2 4693 a -2 4693 a
SDict begin 13 H.A end
 -2 4693 a -2 4693 a
SDict begin [/View [/XYZ H.V]/Dest (0:2490) cvn /DEST pdfmark end
 -2 4693 a -2
4703 a
SDict begin H.S end
 -2 4703 a -2 4703 a
SDict begin 13 H.A end
 -2 4703 a -2 4703 a
SDict begin [/View [/XYZ H.V]/Dest (0:2491) cvn /DEST pdfmark end
 -2 4703
a Black 396 4846 a Fj(\225)p Black 479 4846 a
SDict begin H.S end
 479 4846
a 479 4846 a
SDict begin 13 H.A end
 479 4846 a 479 4846 a
SDict begin [/View [/XYZ H.V]/Dest (0:2492) cvn /DEST pdfmark end
 479 4846 a Fk(As)j(you')l(v)o(e)d
(seen,)i(the)g(Lazy)g(Pirate)h(client)f(performs)e(surprisingly)h
(well.)h(It)h(w)o(orks)e(across)i(a)f(whole)g(range)f(of)479
4954 y(architectures,)g(from)g(direct)h(client-to-serv)o(er)e(to)i
(distrib)n(uted)f(queue)g(de)n(vices.)h(It)g(does)g(tend)g(to)g(assume)
g(that)479 5061 y(w)o(ork)o(ers)g(are)f(stateless)j(and)d(idempotent.)f
(But)i(we)h(can)e(w)o(ork)h(around)e(that)i(limitation)f(without)g
(resorting)g(to)h(rust.)-2 5079 y
SDict begin H.S end
 -2 5079 a -2 5079 a
SDict begin 13 H.A end

-2 5079 a -2 5079 a
SDict begin [/View [/XYZ H.V]/Dest (0:2493) cvn /DEST pdfmark end
 -2 5079 a Black 3759 5569 a Ff(200)p
Black eop end
%%Page: 201 214
TeXDict begin 201 213 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.201) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2513) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2494) cvn /DEST pdfmark end
 479 72 a Fk(Rust)h(brings)f(a)g(whole)g
(set)h(of)f(problems,)e(from)h(slo)n(w)i(performance)c(to)k(additional)
d(pieces)j(to)f(ha)n(v)o(e)g(to)g(manage,)479 180 y(repair)m(,)f(and)g
(create)h(6am)f(panics)g(as)i(the)o(y)e(ine)n(vitably)g(break)f(at)j
(the)f(start)g(of)f(daily)h(operations.)e(The)h(beauty)g(of)h(the)479
288 y(Pirate)h(patterns)e(in)i(general)e(is)i(their)f(simplicity)-5
b(.)19 b(The)o(y)g(w)o(on')o(t)g(crash.)h(And)g(if)g(you')l(re)f(still)
i(w)o(orried)e(about)g(the)479 396 y(hardw)o(are,)g(you)g(can)h(mo)o(v)
o(e)f(to)h(a)h(peer)n(-to-peer)d(pattern)h(that)h(has)h(no)e(brok)o(er)
g(at)i(all.)f(I')o(ll)h(e)o(xplain)d(later)j(in)f(this)479
504 y(chapter)-5 b(.)-2 688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2 688
a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:2495) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(Ha)n(ving)20 b(said)g(this,)h(ho)n(we)
n(v)o(er)m(,)c(there)j(is)h(one)f(sane)g(use)h(case)f(for)g(rust-based)
f(reliability)-5 b(,)19 b(which)g(is)j(an)e(asynchronous)396
886 y(disconnected)e(netw)o(ork.)h(It)i(solv)o(es)f(a)g(major)g
(problem)e(with)j(Pirate,)f(namely)f(that)h(a)h(client)f(has)h(to)f(w)o
(ait)h(for)e(an)396 994 y(answer)g(in)f(real-time.)g(If)g(clients)h
(and)f(w)o(ork)o(ers)g(are)h(only)f(sporadically)f(connected)g(\(think)
g(of)h(email)h(as)g(an)g(analogy\),)396 1102 y(we)i(can')o(t)e(use)h(a)
h(stateless)h(netw)o(ork)d(between)g(clients)h(and)g(w)o(ork)o(ers.)f
(W)-7 b(e)22 b(ha)n(v)o(e)d(to)i(put)e(state)i(in)g(the)f(middle.)-2
1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:2496) cvn /DEST pdfmark end
 -2 1286
a 396 1376 a Fk(So,)g(here')-5 b(s)20 b(the)h(T)m(itanic)f(pattern\()p
0 TeXcolorgray 1380 1376 a
SDict begin H.S end
 1380 1376 a Fk(Figure)d(4-5)1727
1376 y
SDict begin 13 H.L end
 1727 1376 a 1727 1376 a
SDict begin [/Subtype /Link/Dest (0:figure-58) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1727 1376 a Black -1 w
Fk(\),)j(in)h(which)e(we)i(write)f(messages)h(to)f(disk)g(to)g(ensure)g
(the)o(y)f(ne)n(v)o(er)g(get)396 1484 y(lost,)i(no)f(matter)f(ho)n(w)h
(sporadically)f(clients)h(and)g(w)o(ork)o(ers)f(are)h(connected.)e(As)j
(we)g(did)f(for)f(service)h(disco)o(v)o(ery)-5 b(,)396
1592 y(we')l(re)20 b(going)f(to)h(layer)g(T)m(itanic)g(on)g(top)f(of)h
(Majordomo)e(rather)h(than)h(e)o(xtend)f(MDP)-9 b(.)20
b(It')-5 b(s)21 b(w)o(onderfully)d(lazy)i(because)396
1700 y(it)h(means)f(we)h(can)f(implement)f(our)g(\002re-and-for)o(get)d
(reliability)k(in)g(a)h(specialized)e(w)o(ork)o(er)m(,)g(rather)h(than)
f(in)i(the)396 1808 y(brok)o(er)-5 b(.)19 b(This)h(is)i(e)o(xcellent)d
(for)g(se)n(v)o(eral)h(reasons:)-2 1809 y
SDict begin H.S end
 -2 1809 a -2
1809 a
SDict begin 13 H.A end
 -2 1809 a -2 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:2498) cvn /DEST pdfmark end
 -2 1809 a -2 1819 a
SDict begin H.S end
 -2 1819
a -2 1819 a
SDict begin 13 H.A end
 -2 1819 a -2 1819 a
SDict begin [/View [/XYZ H.V]/Dest (0:2499) cvn /DEST pdfmark end
 -2 1819 a Black 396 1978
a Fj(\225)p Black 479 1978 a
SDict begin H.S end
 479 1978 a 479 1978 a
SDict begin 13 H.A end
 479
1978 a 479 1978 a
SDict begin [/View [/XYZ H.V]/Dest (0:2500) cvn /DEST pdfmark end
 479 1978 a Fk(It)h(is)627 1978 y
SDict begin H.S end
 627
1978 a 627 1978 a
SDict begin 13 H.A end
 627 1978 a 627 1978 a
SDict begin [/View [/XYZ H.V]/Dest (0:2501) cvn /DEST pdfmark end
 627 1978 a Ff(muc)o(h)e
Fk(easier)i(because)e(we)i(di)n(vide)e(and)h(conquer:)e(the)i(brok)o
(er)f(handles)g(message)h(routing)f(and)g(the)h(w)o(ork)o(er)479
2086 y(handles)g(reliability)-5 b(.)-2 2104 y
SDict begin H.S end
 -2 2104
a -2 2104 a
SDict begin 13 H.A end
 -2 2104 a -2 2104 a
SDict begin [/View [/XYZ H.V]/Dest (0:2502) cvn /DEST pdfmark end
 -2 2104 a Black 396 2235
a Fj(\225)p Black 479 2235 a
SDict begin H.S end
 479 2235 a 479 2235 a
SDict begin 13 H.A end
 479
2235 a 479 2235 a
SDict begin [/View [/XYZ H.V]/Dest (0:2503) cvn /DEST pdfmark end
 479 2235 a Fk(It)21 b(lets)g(us)f(mix)g(brok)o(ers)f
(written)h(in)h(one)e(language)g(with)h(w)o(ork)o(ers)g(written)f(in)i
(another)-5 b(.)-2 2253 y
SDict begin H.S end
 -2 2253 a -2 2253 a
SDict begin 13 H.A end
 -2 2253
a -2 2253 a
SDict begin [/View [/XYZ H.V]/Dest (0:2504) cvn /DEST pdfmark end
 -2 2253 a Black 396 2385 a Fj(\225)p Black
479 2385 a
SDict begin H.S end
 479 2385 a 479 2385 a
SDict begin 13 H.A end
 479 2385 a 479 2385
a
SDict begin [/View [/XYZ H.V]/Dest (0:2505) cvn /DEST pdfmark end
 479 2385 a Fk(It)21 b(lets)g(us)f(e)n(v)n(olv)o(e)g(the)g
(\002re-and-for)o(get)c(technology)i(independently)-5
b(.)-2 2569 y
SDict begin H.S end
 -2 2569 a -2 2569 a
SDict begin 13 H.A end
 -2 2569 a -2 2569 a
SDict begin [/View [/XYZ H.V]/Dest (0:2506) cvn /DEST pdfmark end

-2 2569 a 396 2659 a Fk(The)20 b(only)f(do)n(wnside)g(is)j(that)e
(there')-5 b(s)20 b(an)g(e)o(xtra)f(netw)o(ork)g(hop)h(between)f(brok)o
(er)g(and)g(hard)h(disk.)g(This)g(is)h(easily)396 2767
y(w)o(orth)f(it.)-2 2933 y
SDict begin H.S end
 -2 2933 a -2 2933 a
SDict begin 13 H.A end
 -2 2933
a -2 2933 a
SDict begin [/View [/XYZ H.V]/Dest (0:2507) cvn /DEST pdfmark end
 -2 2933 a 396 3041 a Fk(There)g(are)g(man)o(y)f(w)o(ays)h
(to)h(mak)o(e)e(a)i(persistent)f(request-reply)e(architecture.)g(W)-7
b(e')o(ll)21 b(aim)g(for)e(simple)h(and)g(painless.)396
3148 y(The)g(simplest)h(design)e(I)i(could)e(come)g(up)h(with,)g(after)
g(playing)f(with)h(this)h(for)f(a)g(fe)n(w)g(hours,)f(is)i(T)m(itanic)g
(as)f(a)h("proxy)396 3256 y(service".)f(That)g(is,)h(it)f(doesn')o(t)f
(af)n(fect)h(w)o(ork)o(ers)f(at)i(all.)g(If)f(a)g(client)g(w)o(ants)h
(a)g(reply)e(immediately)-5 b(,)18 b(it)j(talks)g(directly)e(to)396
3364 y(a)i(service)f(and)f(hopes)h(the)g(service)g(is)h(a)n(v)n
(ailable.)f(If)g(a)g(client)g(is)i(happ)o(y)c(to)j(w)o(ait)g(a)f
(while,)g(it)h(talks)g(to)f(T)m(itanic)g(instead)396
3472 y(and)g(asks,)g("he)o(y)-5 b(,)19 b(b)n(uddy)-5
b(,)18 b(w)o(ould)h(you)h(tak)o(e)g(care)g(of)g(this)h(for)e(me)h
(while)h(I)f(go)g(b)n(uy)f(my)h(groceries?")-2 3490 y
SDict begin H.S end

-2 3490 a -2 3490 a
SDict begin 13 H.A end
 -2 3490 a -2 3490 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-58) cvn /DEST pdfmark
end
 -2 3490 a Black
3759 5569 a Ff(201)p Black eop end
%%Page: 202 215
TeXDict begin 202 214 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.202) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-5.)f(The)i(T)o(itanic)f(P)o(atter)o(n)
-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2510) cvn /DEST pdfmark end
 -2 172 a
396 2081 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 2081 a @beginspecial 0 @llx -224 @lly
315 @urx 0 @ury 3150 @rwi @setspecial
%%BeginDocument: images/fig58.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -224 315 0
%%HiResBoundingBox: 0.0 -224.0 315.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -18.500150680541992 moveto
13.500149726867676 -43.50014877319336 lineto
13.500149726867676 -45.50014877319336 14.500150044759115 -46.50014877319336 16.500150680541992 -46.50014877319336 curveto
71.50015258789062 -46.50014877319336 lineto
71.50015258789062 -46.50014877319336 lineto
72.83348592122395 -46.50014877319336 73.50015258789062 -45.50014877319336 73.50015258789062 -43.50014877319336 curveto
73.50015258789062 -18.500150680541992 lineto
73.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
93.50015258789062 -18.500150680541992 moveto
93.50015258789062 -43.50014877319336 lineto
93.50015258789062 -45.50014877319336 94.50015258789062 -46.50014877319336 96.50015258789062 -46.50014877319336 curveto
151.50015258789062 -46.50014877319336 lineto
151.50015258789062 -46.50014877319336 lineto
152.83348592122397 -46.50014877319336 153.50015258789062 -45.50014877319336 153.50015258789062 -43.50014877319336 curveto
153.50015258789062 -18.500150680541992 lineto
153.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
173.50015258789062 -18.500150680541992 moveto
173.50015258789062 -43.50014877319336 lineto
173.50015258789062 -45.50014877319336 174.50015258789062 -46.50014877319336 176.50015258789062 -46.50014877319336 curveto
231.50015258789062 -46.50014877319336 lineto
231.50015258789062 -46.50014877319336 lineto
232.83348592122397 -46.50014877319336 233.50015258789062 -45.50014877319336 233.50015258789062 -43.50014877319336 curveto
233.50015258789062 -18.500150680541992 lineto
233.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
96.50015258789062 -95.50015258789062 moveto
94.50015258789062 -95.50015258789062 93.50015258789062 -96.83348592122395 93.50015258789062 -99.50015258789062 curveto
93.50015258789062 -120.50015258789062 lineto
93.50015258789062 -122.50015258789062 94.50015258789062 -123.50015258789062 96.50015258789062 -123.50015258789062 curveto
151.50015258789062 -123.50015258789062 lineto
151.50015258789062 -123.50015258789062 lineto
152.83348592122397 -123.50015258789062 153.50015258789062 -122.50015258789062 153.50015258789062 -120.50015258789062 curveto
153.50015258789062 -99.50015258789062 lineto
153.50015258789062 -99.50015258789062 lineto
153.50015258789062 -96.83348592122395 152.83348592122397 -95.50015258789062 151.50015258789062 -95.50015258789062 curveto
96.50015258789062 -95.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
183.50015258789062 -95.50015258789062 moveto
183.50015258789062 -123.50015258789062 lineto
233.50015258789062 -123.50015258789062 lineto
233.50015258789062 -95.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
263.5001525878906 -95.50015258789062 moveto
269.5001525878906 -98.50015258789062 297.5001525878906 -98.50015258789062 303.5001525878906 -95.50015258789062 curveto
297.5001525878906 -92.50015258789062 269.5001525878906 -92.50015258789062 263.5001525878906 -95.50015258789062 curveto
263.5001525878906 -95.50015258789062 moveto
263.5001525878906 -123.50015258789062 lineto
269.5001525878906 -128.50015258789062 297.5001525878906 -128.50015258789062 303.5001525878906 -123.50015258789062 curveto
303.5001525878906 -95.50015258789062 lineto
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -165.50015258789062 moveto
14.500150044759115 -165.50015258789062 13.500149726867676 -166.83348592122397 13.500149726867676 -169.50015258789062 curveto
13.500149726867676 -178.50015258789062 lineto
73.50015258789062 -178.50015258789062 lineto
73.50015258789062 -169.50015258789062 lineto
73.50015258789062 -166.83348592122397 72.83348592122395 -165.50015258789062 71.50015258789062 -165.50015258789062 curveto
16.500150680541992 -165.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -180.50015258789062 moveto
13.500149726867676 -207.50015258789062 lineto
73.50015258789062 -207.50015258789062 lineto
73.50015258789062 -180.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
96.50015258789062 -165.50015258789062 moveto
94.50015258789062 -165.50015258789062 93.50015258789062 -166.83348592122397 93.50015258789062 -169.50015258789062 curveto
93.50015258789062 -178.50015258789062 lineto
153.50015258789062 -178.50015258789062 lineto
153.50015258789062 -169.50015258789062 lineto
153.50015258789062 -166.83348592122397 152.83348592122397 -165.50015258789062 151.50015258789062 -165.50015258789062 curveto
96.50015258789062 -165.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
93.50015258789062 -180.50015258789062 moveto
93.50015258789062 -207.50015258789062 lineto
153.50015258789062 -207.50015258789062 lineto
153.50015258789062 -180.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
176.50015258789062 -165.50015258789062 moveto
174.50015258789062 -165.50015258789062 173.50015258789062 -166.83348592122397 173.50015258789062 -169.50015258789062 curveto
173.50015258789062 -178.50015258789062 lineto
233.50015258789062 -178.50015258789062 lineto
233.50015258789062 -169.50015258789062 lineto
233.50015258789062 -166.83348592122397 232.83348592122397 -165.50015258789062 231.50015258789062 -165.50015258789062 curveto
176.50015258789062 -165.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
173.50015258789062 -180.50015258789062 moveto
173.50015258789062 -207.50015258789062 lineto
233.50015258789062 -207.50015258789062 lineto
233.50015258789062 -180.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
262.0 -94.0 moveto
268.0 -97.0 296.0 -97.0 302.0 -94.0 curveto
296.0 -91.0 268.0 -91.0 262.0 -94.0 curveto
262.0 -94.0 moveto
262.0 -122.0 lineto
268.0 -127.0 296.0 -127.0 302.0 -122.0 curveto
302.0 -94.0 lineto
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
262.0 -94.0 moveto
268.0 -97.0 296.0 -97.0 302.0 -94.0 curveto
296.0 -91.0 268.0 -91.0 262.0 -94.0 curveto
262.0 -94.0 moveto
262.0 -122.0 lineto
268.0 -127.0 296.0 -127.0 302.0 -122.0 curveto
302.0 -94.0 lineto
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -17.0 moveto
12.0 -42.0 lineto
12.0 -44.0 13.0 -45.0 15.0 -45.0 curveto
70.0 -45.0 lineto
70.0 -45.0 lineto
71.33333333333333 -45.0 72.0 -44.0 72.0 -42.0 curveto
72.0 -17.0 lineto
72.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -17.0 moveto
12.0 -42.0 lineto
12.0 -44.0 13.0 -45.0 15.0 -45.0 curveto
70.0 -45.0 lineto
70.0 -45.0 lineto
71.33333333333333 -45.0 72.0 -44.0 72.0 -42.0 curveto
72.0 -17.0 lineto
72.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
92.0 -17.0 moveto
92.0 -42.0 lineto
92.0 -44.0 93.0 -45.0 95.0 -45.0 curveto
150.0 -45.0 lineto
150.0 -45.0 lineto
151.33333333333334 -45.0 152.0 -44.0 152.0 -42.0 curveto
152.0 -17.0 lineto
152.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
92.0 -17.0 moveto
92.0 -42.0 lineto
92.0 -44.0 93.0 -45.0 95.0 -45.0 curveto
150.0 -45.0 lineto
150.0 -45.0 lineto
151.33333333333334 -45.0 152.0 -44.0 152.0 -42.0 curveto
152.0 -17.0 lineto
152.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
172.0 -17.0 moveto
172.0 -42.0 lineto
172.0 -44.0 173.0 -45.0 175.0 -45.0 curveto
230.0 -45.0 lineto
230.0 -45.0 lineto
231.33333333333334 -45.0 232.0 -44.0 232.0 -42.0 curveto
232.0 -17.0 lineto
232.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
172.0 -17.0 moveto
172.0 -42.0 lineto
172.0 -44.0 173.0 -45.0 175.0 -45.0 curveto
230.0 -45.0 lineto
230.0 -45.0 lineto
231.33333333333334 -45.0 232.0 -44.0 232.0 -42.0 curveto
232.0 -17.0 lineto
232.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
95.0 -94.0 moveto
93.0 -94.0 92.0 -95.33333333333333 92.0 -98.0 curveto
92.0 -119.0 lineto
92.0 -121.0 93.0 -122.0 95.0 -122.0 curveto
150.0 -122.0 lineto
150.0 -122.0 lineto
151.33333333333334 -122.0 152.0 -121.0 152.0 -119.0 curveto
152.0 -98.0 lineto
152.0 -98.0 lineto
152.0 -95.33333333333333 151.33333333333334 -94.0 150.0 -94.0 curveto
95.0 -94.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
95.0 -94.0 moveto
93.0 -94.0 92.0 -95.33333333333333 92.0 -98.0 curveto
92.0 -119.0 lineto
92.0 -121.0 93.0 -122.0 95.0 -122.0 curveto
150.0 -122.0 lineto
150.0 -122.0 lineto
151.33333333333334 -122.0 152.0 -121.0 152.0 -119.0 curveto
152.0 -98.0 lineto
152.0 -98.0 lineto
152.0 -95.33333333333333 151.33333333333334 -94.0 150.0 -94.0 curveto
95.0 -94.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
182.0 -94.0 moveto
182.0 -122.0 lineto
232.0 -122.0 lineto
232.0 -94.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
182.0 -94.0 moveto
182.0 -122.0 lineto
232.0 -122.0 lineto
232.0 -94.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -164.0 moveto
13.0 -164.0 12.0 -165.33333333333334 12.0 -168.0 curveto
12.0 -177.0 lineto
72.0 -177.0 lineto
72.0 -168.0 lineto
72.0 -165.33333333333334 71.33333333333333 -164.0 70.0 -164.0 curveto
15.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -164.0 moveto
13.0 -164.0 12.0 -165.33333333333334 12.0 -168.0 curveto
12.0 -177.0 lineto
72.0 -177.0 lineto
72.0 -168.0 lineto
72.0 -165.33333333333334 71.33333333333333 -164.0 70.0 -164.0 curveto
15.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -179.0 moveto
12.0 -206.0 lineto
72.0 -206.0 lineto
72.0 -179.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -179.0 moveto
12.0 -206.0 lineto
72.0 -206.0 lineto
72.0 -179.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
95.0 -164.0 moveto
93.0 -164.0 92.0 -165.33333333333334 92.0 -168.0 curveto
92.0 -177.0 lineto
152.0 -177.0 lineto
152.0 -168.0 lineto
152.0 -165.33333333333334 151.33333333333334 -164.0 150.0 -164.0 curveto
95.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
95.0 -164.0 moveto
93.0 -164.0 92.0 -165.33333333333334 92.0 -168.0 curveto
92.0 -177.0 lineto
152.0 -177.0 lineto
152.0 -168.0 lineto
152.0 -165.33333333333334 151.33333333333334 -164.0 150.0 -164.0 curveto
95.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
92.0 -179.0 moveto
92.0 -206.0 lineto
152.0 -206.0 lineto
152.0 -179.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
92.0 -179.0 moveto
92.0 -206.0 lineto
152.0 -206.0 lineto
152.0 -179.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
175.0 -164.0 moveto
173.0 -164.0 172.0 -165.33333333333334 172.0 -168.0 curveto
172.0 -177.0 lineto
232.0 -177.0 lineto
232.0 -168.0 lineto
232.0 -165.33333333333334 231.33333333333334 -164.0 230.0 -164.0 curveto
175.0 -164.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
175.0 -164.0 moveto
173.0 -164.0 172.0 -165.33333333333334 172.0 -168.0 curveto
172.0 -177.0 lineto
232.0 -177.0 lineto
232.0 -168.0 lineto
232.0 -165.33333333333334 231.33333333333334 -164.0 230.0 -164.0 curveto
175.0 -164.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
172.0 -179.0 moveto
172.0 -206.0 lineto
232.0 -206.0 lineto
232.0 -179.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
172.0 -179.0 moveto
172.0 -206.0 lineto
232.0 -206.0 lineto
232.0 -179.0 lineto
closepath
stroke
newpath
157.0 -108.0 moveto
177.0 -108.0 lineto
stroke
newpath
237.0 -108.0 moveto
257.0 -108.0 lineto
stroke
newpath
42.0 -49.0 moveto
40.0 -56.0 lineto
45.0 -56.0 lineto
closepath
fill
newpath
122.0 -49.0 moveto
120.0 -56.0 lineto
125.0 -56.0 lineto
closepath
fill
newpath
202.0 -49.0 moveto
200.0 -56.0 lineto
205.0 -56.0 lineto
closepath
fill
newpath
120.0 -84.0 moveto
122.0 -91.0 lineto
125.0 -84.0 lineto
closepath
fill
newpath
160.0 -105.0 moveto
155.0 -108.0 lineto
160.0 -112.0 lineto
closepath
fill
newpath
175.0 -105.0 moveto
180.0 -108.0 lineto
175.0 -112.0 lineto
closepath
fill
newpath
240.0 -105.0 moveto
235.0 -108.0 lineto
240.0 -112.0 lineto
closepath
fill
newpath
255.0 -105.0 moveto
260.0 -108.0 lineto
255.0 -112.0 lineto
closepath
fill
newpath
122.0 -126.0 moveto
120.0 -133.0 lineto
125.0 -133.0 lineto
closepath
fill
newpath
40.0 -154.0 moveto
42.0 -161.0 lineto
45.0 -154.0 lineto
closepath
fill
newpath
120.0 -154.0 moveto
122.0 -161.0 lineto
125.0 -154.0 lineto
closepath
fill
newpath
200.0 -154.0 moveto
202.0 -161.0 lineto
205.0 -154.0 lineto
closepath
fill
newpath
42.0 -52.0 moveto
42.0 -63.0 lineto
42.0 -65.0 43.0 -66.0 45.0 -66.0 curveto
122.0 -66.0 lineto
122.0 -66.0 lineto
stroke
newpath
122.0 -52.0 moveto
122.0 -66.0 lineto
stroke
newpath
202.0 -52.0 moveto
202.0 -63.0 lineto
202.0 -65.0 201.33333333333334 -66.0 200.0 -66.0 curveto
122.0 -66.0 lineto
122.0 -66.0 lineto
stroke
newpath
122.0 -87.0 moveto
122.0 -66.0 lineto
stroke
newpath
122.0 -129.0 moveto
122.0 -143.0 lineto
stroke
newpath
42.0 -157.0 moveto
42.0 -147.0 lineto
42.0 -144.33333333333334 43.0 -143.0 45.0 -143.0 curveto
122.0 -143.0 lineto
122.0 -143.0 lineto
stroke
newpath
122.0 -157.0 moveto
122.0 -143.0 lineto
stroke
newpath
202.0 -157.0 moveto
202.0 -147.0 lineto
202.0 -144.33333333333334 201.33333333333334 -143.0 200.0 -143.0 curveto
122.0 -143.0 lineto
122.0 -143.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
29.0 -35.0 moveto
(Client) show
109.0 -35.0 moveto
(Client) show
189.0 -35.0 moveto
(Client) show
10.0 -77.0 moveto
(Titanic,) show
10.0 -84.0 moveto
(give me coffee") show
176.0 -77.0 moveto
("Titanic,) show
180.0 -84.0 moveto
(give me tea") show
267.0 -91.0 moveto
(Disk) show
107.0 -112.0 moveto
(Broker) show
194.0 -112.0 moveto
(Titanic) show
26.0 -175.0 moveto
("Water") show
111.0 -175.0 moveto
("Tea") show
183.0 -175.0 moveto
("Coffee") show
26.0 -196.0 moveto
(Worker) show
106.0 -196.0 moveto
(Worker) show
186.0 -196.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 2081 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 2081 a 274 x Fk(T)m(itanic)g(is)h(thus)g
(both)e(a)i(w)o(ork)o(er)m(,)d(and)i(a)g(client.)g(The)g(dialog)g
(between)f(client)h(and)g(T)m(itanic)g(goes)g(along)f(these)h(lines:)-2
2372 y
SDict begin H.S end
 -2 2372 a -2 2372 a
SDict begin 13 H.A end
 -2 2372 a -2 2372 a
SDict begin [/View [/XYZ H.V]/Dest (0:2514) cvn /DEST pdfmark end
 -2 2372
a -2 2382 a
SDict begin H.S end
 -2 2382 a -2 2382 a
SDict begin 13 H.A end
 -2 2382 a -2 2382 a
SDict begin [/View [/XYZ H.V]/Dest (0:2515) cvn /DEST pdfmark end
 -2
2382 a Black 396 2525 a Fj(\225)p Black 479 2525 a
SDict begin H.S end
 479
2525 a 479 2525 a
SDict begin 13 H.A end
 479 2525 a 479 2525 a
SDict begin [/View [/XYZ H.V]/Dest (0:2516) cvn /DEST pdfmark end
 479 2525 a Fk(Client:)h(please)
f(accept)g(this)h(request)e(for)h(me.)g(T)m(itanic:)g(OK,)g(done.)-2
2543 y
SDict begin H.S end
 -2 2543 a -2 2543 a
SDict begin 13 H.A end
 -2 2543 a -2 2543 a
SDict begin [/View [/XYZ H.V]/Dest (0:2517) cvn /DEST pdfmark end
 -2 2543
a Black 396 2674 a Fj(\225)p Black 479 2674 a
SDict begin H.S end
 479 2674
a 479 2674 a
SDict begin 13 H.A end
 479 2674 a 479 2674 a
SDict begin [/View [/XYZ H.V]/Dest (0:2518) cvn /DEST pdfmark end
 479 2674 a Fk(Client:)h(do)f(you)f
(ha)n(v)o(e)h(a)g(reply)g(for)f(me?)h(T)m(itanic:)h(Y)-8
b(es,)20 b(here)f(it)i(is.)g(Or)m(,)f(no,)g(not)f(yet.)-2
2692 y
SDict begin H.S end
 -2 2692 a -2 2692 a
SDict begin 13 H.A end
 -2 2692 a -2 2692 a
SDict begin [/View [/XYZ H.V]/Dest (0:2519) cvn /DEST pdfmark end
 -2 2692
a Black 396 2824 a Fj(\225)p Black 479 2824 a
SDict begin H.S end
 479 2824
a 479 2824 a
SDict begin 13 H.A end
 479 2824 a 479 2824 a
SDict begin [/View [/XYZ H.V]/Dest (0:2520) cvn /DEST pdfmark end
 479 2824 a Fk(Client:)i(ok,)f(you)f
(can)h(wipe)g(that)g(request)g(no)n(w)-5 b(,)19 b(it')-5
b(s)21 b(all)g(happ)o(y)-5 b(.)18 b(T)m(itanic:)i(OK,)h(done.)-2
3008 y
SDict begin H.S end
 -2 3008 a -2 3008 a
SDict begin 13 H.A end
 -2 3008 a -2 3008 a
SDict begin [/View [/XYZ H.V]/Dest (0:2521) cvn /DEST pdfmark end
 -2 3008
a 396 3098 a Fk(Whereas)f(the)h(dialog)e(between)g(T)m(itanic)h(and)g
(brok)o(er)f(and)g(w)o(ork)o(er)g(goes)h(lik)o(e)h(this:)-2
3116 y
SDict begin H.S end
 -2 3116 a -2 3116 a
SDict begin 13 H.A end
 -2 3116 a -2 3116 a
SDict begin [/View [/XYZ H.V]/Dest (0:2522) cvn /DEST pdfmark end
 -2 3116
a -2 3126 a
SDict begin H.S end
 -2 3126 a -2 3126 a
SDict begin 13 H.A end
 -2 3126 a -2 3126 a
SDict begin [/View [/XYZ H.V]/Dest (0:2523) cvn /DEST pdfmark end
 -2
3126 a Black 396 3268 a Fj(\225)p Black 479 3268 a
SDict begin H.S end
 479
3268 a 479 3268 a
SDict begin 13 H.A end
 479 3268 a 479 3268 a
SDict begin [/View [/XYZ H.V]/Dest (0:2524) cvn /DEST pdfmark end
 479 3268 a Fk(T)m(itanic:)f(he)
o(y)-5 b(,)19 b(brok)o(er)m(,)f(is)j(there)f(an)g(echo)g(service?)f
(Brok)o(er:)h(uhm,)f(yeah,)g(seems)i(lik)o(e.)-2 3286
y
SDict begin H.S end
 -2 3286 a -2 3286 a
SDict begin 13 H.A end
 -2 3286 a -2 3286 a
SDict begin [/View [/XYZ H.V]/Dest (0:2525) cvn /DEST pdfmark end
 -2 3286 a Black
396 3417 a Fj(\225)p Black 479 3417 a
SDict begin H.S end
 479 3417 a 479
3417 a
SDict begin 13 H.A end
 479 3417 a 479 3417 a
SDict begin [/View [/XYZ H.V]/Dest (0:2526) cvn /DEST pdfmark end
 479 3417 a Fk(T)m(itanic:)f(he)o(y)-5
b(,)19 b(echo,)g(please)i(handle)e(this)h(for)g(me.)g(Echo:)f(sure,)h
(here)g(you)f(are.)-2 3435 y
SDict begin H.S end
 -2 3435 a -2 3435 a
SDict begin 13 H.A end
 -2 3435
a -2 3435 a
SDict begin [/View [/XYZ H.V]/Dest (0:2527) cvn /DEST pdfmark end
 -2 3435 a Black 396 3567 a Fj(\225)p Black
479 3567 a
SDict begin H.S end
 479 3567 a 479 3567 a
SDict begin 13 H.A end
 479 3567 a 479 3567
a
SDict begin [/View [/XYZ H.V]/Dest (0:2528) cvn /DEST pdfmark end
 479 3567 a Fk(T)m(itanic:)h(sweeeeet!)-2 3733 y
SDict begin H.S end
 -2
3733 a -2 3733 a
SDict begin 13 H.A end
 -2 3733 a -2 3733 a
SDict begin [/View [/XYZ H.V]/Dest (0:2529) cvn /DEST pdfmark end
 -2 3733 a 396 3841
a Fk(Y)-9 b(ou)20 b(can)g(w)o(ork)f(through)f(this,)j(and)f(the)g
(possible)g(f)o(ailure)f(scenarios.)h(If)g(a)g(w)o(ork)o(er)g(crashes)g
(while)g(processing)f(a)396 3949 y(request,)h(T)m(itanic)g(retries,)g
(inde\002nitely)-5 b(.)18 b(If)i(a)h(reply)e(gets)h(lost)h(some)n
(where,)e(T)m(itanic)h(will)h(retry)-5 b(.)19 b(If)h(the)g(request)f
(gets)396 4056 y(processed)g(b)n(ut)i(the)f(client)g(doesn')o(t)f(get)h
(the)g(reply)-5 b(,)19 b(it)i(will)g(ask)f(again.)f(If)h(T)m(itanic)g
(crashes)g(while)g(processing)f(a)396 4164 y(request,)h(or)f(a)i(reply)
-5 b(,)19 b(the)h(client)g(will)h(try)f(again.)f(As)i(long)e(as)i
(requests)f(are)g(fully)g(committed)f(to)h(safe)h(storage,)e(w)o(ork)
396 4272 y(can')o(t)g(get)i(lost.)-2 4456 y
SDict begin H.S end
 -2 4456 a
-2 4456 a
SDict begin 13 H.A end
 -2 4456 a -2 4456 a
SDict begin [/View [/XYZ H.V]/Dest (0:2530) cvn /DEST pdfmark end
 -2 4456 a 396 4546 a Fk(The)f
(handshaking)e(is)j(pedantic,)d(b)n(ut)j(can)f(be)g(pipelined,)e(i.e.)i
(clients)h(can)f(use)g(the)h(asynchronous)c(Majordomo)396
4654 y(pattern)j(to)g(do)g(a)g(lot)h(of)f(w)o(ork)f(and)h(then)g(get)g
(the)g(responses)f(later)-5 b(.)-2 4838 y
SDict begin H.S end
 -2 4838 a -2
4838 a
SDict begin 13 H.A end
 -2 4838 a -2 4838 a
SDict begin [/View [/XYZ H.V]/Dest (0:2531) cvn /DEST pdfmark end
 -2 4838 a 396 4928 a Fk(W)e(e)22
b(need)d(some)h(w)o(ay)g(for)g(a)h(client)f(to)g(request)1784
4928 y
SDict begin H.S end
 1784 4928 a 1784 4928 a
SDict begin 13 H.A end
 1784 4928 a 1784 4928
a
SDict begin [/View [/XYZ H.V]/Dest (0:2532) cvn /DEST pdfmark end
 1784 4928 a Ff(its)h Fk(replies.)f(W)-7 b(e')o(ll)21
b(ha)n(v)o(e)f(man)o(y)f(clients)h(asking)g(for)f(the)h(same)396
5036 y(services,)g(and)g(clients)g(disappear)f(and)h(reappear)e(with)j
(dif)n(ferent)d(identities.)i(So)h(here)e(is)i(a)g(simple,)f
(reasonably)396 5144 y(secure)g(solution:)-2 5145 y
SDict begin H.S end
 -2
5145 a -2 5145 a
SDict begin 13 H.A end
 -2 5145 a -2 5145 a
SDict begin [/View [/XYZ H.V]/Dest (0:2533) cvn /DEST pdfmark end
 -2 5145 a -2 5155
a
SDict begin H.S end
 -2 5155 a -2 5155 a
SDict begin 13 H.A end
 -2 5155 a -2 5155 a
SDict begin [/View [/XYZ H.V]/Dest (0:2534) cvn /DEST pdfmark end
 -2 5155 a Black
3759 5569 a Ff(202)p Black eop end
%%Page: 203 216
TeXDict begin 203 215 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.203) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2535) cvn /DEST pdfmark end
 479 72 a Fk(Ev)o(ery)f(request)h
(generates)f(a)h(uni)n(v)o(ersally)f(unique)g(ID)h(\(UUID\),)f(which)h
(T)m(itanic)g(returns)f(to)i(the)f(client)g(when)g(it')-5
b(s)479 180 y(queued)19 b(the)h(request.)-2 198 y
SDict begin H.S end
 -2
198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:2536) cvn /DEST pdfmark end
 -2 198 a Black 396 330
a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330
a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:2537) cvn /DEST pdfmark end
 479 330 a Fk(When)g(a)h(client)f(asks)h(for)e(a)i(reply)-5
b(,)19 b(it)i(must)f(specify)f(the)i(UUID)f(for)f(the)i(original)e
(request.)-2 514 y
SDict begin H.S end
 -2 514 a -2 514 a
SDict begin 13 H.A end
 -2 514 a -2 514
a
SDict begin [/View [/XYZ H.V]/Dest (0:2538) cvn /DEST pdfmark end
 -2 514 a 396 604 a Fk(This)i(puts)f(some)g(onus)f(on)h(the)g(client)h
(to)f(store)g(its)h(request)f(UUIDs)g(safely)-5 b(,)20
b(b)n(ut)g(it)h(remo)o(v)o(es)d(an)o(y)i(need)f(for)396
712 y(authentication.)f(What)j(alternati)n(v)o(es)e(are)h(there?)-2
879 y
SDict begin H.S end
 -2 879 a -2 879 a
SDict begin 13 H.A end
 -2 879 a -2 879 a
SDict begin [/View [/XYZ H.V]/Dest (0:2539) cvn /DEST pdfmark end
 -2 879 a 396
986 a Fk(Before)g(we)g(jump)g(of)n(f)f(and)h(write)g(yet)h(another)d
(formal)h(speci\002cation)h(\(fun,)f(fun!\))f(let')-5
b(s)22 b(consider)d(ho)n(w)g(the)h(client)396 1094 y(talks)h(to)f(T)m
(itanic.)g(One)g(w)o(ay)g(is)h(to)g(use)f(a)h(single)f(service)g(and)f
(send)h(it)h(three)f(dif)n(ferent)e(request)i(types.)g(Another)f(w)o
(ay)-5 b(,)396 1202 y(which)20 b(seems)h(simpler)m(,)e(is)i(to)f(use)h
(three)e(services:)-2 1220 y
SDict begin H.S end
 -2 1220 a -2 1220 a
SDict begin 13 H.A end
 -2 1220
a -2 1220 a
SDict begin [/View [/XYZ H.V]/Dest (0:2540) cvn /DEST pdfmark end
 -2 1220 a -2 1230 a
SDict begin H.S end
 -2 1230 a -2 1230 a
SDict begin 13 H.A end
 -2
1230 a -2 1230 a
SDict begin [/View [/XYZ H.V]/Dest (0:2541) cvn /DEST pdfmark end
 -2 1230 a Black 396 1372 a Fj(\225)p
Black 479 1372 a
SDict begin H.S end
 479 1372 a 479 1372 a
SDict begin 13 H.A end
 479 1372 a 479
1372 a
SDict begin [/View [/XYZ H.V]/Dest (0:2542) cvn /DEST pdfmark end
 479 1372 a 479 1372 a
SDict begin H.S end
 479 1372 a 479 1372 a
SDict begin 13 H.A end
 479
1372 a 479 1372 a
SDict begin [/View [/XYZ H.V]/Dest (0:2543) cvn /DEST pdfmark end
 479 1372 a Fg(titanic.r)o(equest)g
Fk(-)i(store)f(a)g(request)g(message,)g(return)f(a)h(UUID)g(for)g(the)g
(request.)-2 1390 y
SDict begin H.S end
 -2 1390 a -2 1390 a
SDict begin 13 H.A end
 -2 1390 a -2
1390 a
SDict begin [/View [/XYZ H.V]/Dest (0:2544) cvn /DEST pdfmark end
 -2 1390 a Black 396 1521 a Fj(\225)p Black 479
1521 a
SDict begin H.S end
 479 1521 a 479 1521 a
SDict begin 13 H.A end
 479 1521 a 479 1521 a
SDict begin [/View [/XYZ H.V]/Dest (0:2545) cvn /DEST pdfmark end
 479
1521 a 479 1521 a
SDict begin H.S end
 479 1521 a 479 1521 a
SDict begin 13 H.A end
 479 1521 a 479
1521 a
SDict begin [/View [/XYZ H.V]/Dest (0:2546) cvn /DEST pdfmark end
 479 1521 a Fg(titanic.r)o(eply)f Fk(-)h(fetch)g(a)g(reply)-5
b(,)19 b(if)i(a)n(v)n(ailable,)e(for)h(a)g(gi)n(v)o(en)f(request)h
(UUID.)-2 1539 y
SDict begin H.S end
 -2 1539 a -2 1539 a
SDict begin 13 H.A end
 -2 1539 a -2 1539
a
SDict begin [/View [/XYZ H.V]/Dest (0:2547) cvn /DEST pdfmark end
 -2 1539 a Black 396 1671 a Fj(\225)p Black 479 1671
a
SDict begin H.S end
 479 1671 a 479 1671 a
SDict begin 13 H.A end
 479 1671 a 479 1671 a
SDict begin [/View [/XYZ H.V]/Dest (0:2548) cvn /DEST pdfmark end
 479 1671
a 479 1671 a
SDict begin H.S end
 479 1671 a 479 1671 a
SDict begin 13 H.A end
 479 1671 a 479 1671
a
SDict begin [/View [/XYZ H.V]/Dest (0:2549) cvn /DEST pdfmark end
 479 1671 a Fg(titanic.close)f Fk(-)i(con\002rm)e(that)h(a)h(reply)e
(has)i(been)e(stored)h(and)f(processed.)-2 1855 y
SDict begin H.S end
 -2
1855 a -2 1855 a
SDict begin 13 H.A end
 -2 1855 a -2 1855 a
SDict begin [/View [/XYZ H.V]/Dest (0:2550) cvn /DEST pdfmark end
 -2 1855 a 396 1945
a Fk(W)-7 b(e')o(ll)22 b(just)e(mak)o(e)g(a)h(multithreaded)d(w)o(ork)o
(er)m(,)g(which)i(as)h(we')l(v)o(e)e(seen)h(from)f(our)h
(multithreading)e(e)o(xperience)g(with)396 2053 y(\330MQ,)i(is)i(tri)n
(vial.)d(Ho)n(we)n(v)o(er)g(before)g(jumping)f(into)i(code)g(let')-5
b(s)21 b(sk)o(etch)f(do)n(wn)f(what)h(T)m(itanic)g(w)o(ould)g(look)f
(lik)o(e)i(in)396 2160 y(terms)f(of)g(\330MQ)h(messages)f(and)g
(frames:)g(http://rfc.zeromq.or)o(g/spec)o(:9.)14 b(This)21
b(is)g(the)f("T)m(itanic)g(Service)g(Protocol",)396 2268
y(or)g(TSP)-9 b(.)-2 2435 y
SDict begin H.S end
 -2 2435 a -2 2435 a
SDict begin 13 H.A end
 -2 2435
a -2 2435 a
SDict begin [/View [/XYZ H.V]/Dest (0:2551) cvn /DEST pdfmark end
 -2 2435 a 396 2542 a Fk(Using)20 b(TSP)h(is)g(clearly)f
(more)f(w)o(ork)h(for)f(client)i(applications)e(than)g(accessing)h(a)h
(service)f(directly)f(via)h(MDP)-9 b(.)21 b(Here')-5
b(s)396 2650 y(the)20 b(shortest)h(rob)n(ust)e('echo')g(client)h(e)o
(xample:)-2 2668 y
SDict begin H.S end
 -2 2668 a -2 2668 a
SDict begin 13 H.A end
 -2 2668 a -2 2668
a
SDict begin [/View [/XYZ H.V]/Dest (0:ticlient-c) cvn /DEST pdfmark
end
 -2 2668 a 396 2852 a Fg(Example)h(4-53.)d(T)o(itanic)i(client)h
(example)f(\(ticlient.c\))-2 2952 y
SDict begin H.S end
 -2 2952 a -2 2952
a
SDict begin 11.7 H.A end
 -2 2952 a -2 2952 a
SDict begin [/View [/XYZ H.V]/Dest (0:2554) cvn /DEST pdfmark end
 -2 2952 a 396 3032 a Fe(//)396
3129 y(//)90 b(Titanic)43 b(client)h(example)396 3226
y(//)90 b(Implements)43 b(client)h(side)g(of)g
(http://rfc.zeromq.org/spec:9)396 3420 y(//)90 b(Lets)44
b(us)g(build)g(this)g(source)g(without)g(creating)f(a)i(library)396
3517 y(#include)f("mdcliapi.c")396 3712 y(//)90 b(Calls)44
b(a)g(TSP)h(service)396 3809 y(//)90 b(Returns)43 b(response)h(if)g
(successful)f(\(status)h(code)g(200)h(OK\),)f(else)g(NULL)396
3906 y(//)396 4003 y(static)g(zmsg_t)1024 4016 y(*)396
4100 y(s_service_call)f(\(mdcli_t)1472 4113 y(*)1517
4100 y(session,)h(char)2145 4113 y(*)2190 4100 y(service,)f(zmsg_t)2907
4113 y(**)2997 4100 y(request_p\))396 4197 y({)576 4295
y(zmsg_t)889 4308 y(*)934 4295 y(reply)h(=)h(mdcli_send)e(\(session,)g
(service,)h(request_p\);)576 4392 y(if)g(\(reply\))g({)755
4489 y(zframe_t)1158 4502 y(*)1203 4489 y(status)g(=)h(zmsg_pop)e
(\(reply\);)755 4586 y(if)h(\(zframe_streq)f(\(status,)h("200"\)\))f({)
934 4683 y(zframe_destroy)g(\(&status\);)934 4780 y(return)h(reply;)755
4877 y(})755 4975 y(else)755 5072 y(if)g(\(zframe_streq)f(\(status,)h
("400"\)\))f({)934 5169 y(printf)h(\("E:)g(client)g(fatal)g(error,)g
(aborting\\n"\);)p Black 3759 5569 a Ff(203)p Black eop
end
%%Page: 204 217
TeXDict begin 204 216 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.204) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 72 a Fe(exit)44 b(\(EXIT_FAILURE\);)755 170
y(})755 267 y(else)755 364 y(if)g(\(zframe_streq)f(\(status,)h
("500"\)\))f({)934 461 y(printf)h(\("E:)g(server)g(fatal)g(error,)g
(aborting\\n"\);)934 558 y(exit)g(\(EXIT_FAILURE\);)755
655 y(})576 752 y(})576 850 y(else)755 947 y(exit)g(\(EXIT_SUCCESS\);)
177 b(//)89 b(Interrupted)43 b(or)i(failed)576 1141 y(zmsg_destroy)d
(\(&reply\);)576 1238 y(return)h(NULL;)358 b(//)90 b(Didn't)43
b(succeed,)h(don't)g(care)g(why)g(not)396 1335 y(})-2
1510 y
SDict begin H.S end
 -2 1510 a -2 1510 a
SDict begin 13 H.A end
 -2 1510 a -2 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:2555) cvn /DEST pdfmark end
 -2 1510
a 396 1609 a Fk(The)20 b(main)g(task)g(tests)i(our)d(service)h(call)h
(by)e(sending)h(an)g(echo)f(request:)-2 1627 y
SDict begin H.S end
 -2 1627
a -2 1627 a
SDict begin 13 H.A end
 -2 1627 a -2 1627 a
SDict begin [/View [/XYZ H.V]/Dest (0:ticlient-c-1) cvn /DEST pdfmark
end
 -2 1627 a 396 1811 a
Fg(Example)i(4-54.)d(T)o(itanic)i(client)h(example)f(\(ticlient.c\))f
(-)h(main)h(task)-2 1910 y
SDict begin H.S end
 -2 1910 a -2 1910 a
SDict begin 11.7 H.A end
 -2 1910
a -2 1910 a
SDict begin [/View [/XYZ H.V]/Dest (0:2558) cvn /DEST pdfmark end
 -2 1910 a 396 2088 a Fe(int)45 b(main)f(\(int)g(argc,)g
(char)1517 2101 y(*)1562 2088 y(argv)g([]\))396 2185
y({)576 2282 y(int)g(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g
(\(argv)g([1],)g("-v"\)\);)576 2379 y(mdcli_t)934 2392
y(*)979 2379 y(session)g(=)g(mdcli_new)g(\("tcp://localhost:5555",)d
(verbose\);)576 2574 y(//)89 b(1.)44 b(Send)h('echo')e(request)h(to)h
(Titanic)576 2671 y(zmsg_t)889 2684 y(*)934 2671 y(request)f(=)h
(zmsg_new)e(\(\);)576 2768 y(zmsg_addstr)g(\(request,)g("echo"\);)576
2865 y(zmsg_addstr)g(\(request,)g("Hello)h(world"\);)576
2962 y(zmsg_t)889 2975 y(*)934 2962 y(reply)g(=)h(s_service_call)d(\()
755 3059 y(session,)h("titanic.request",)f(&request\);)576
3253 y(zframe_t)979 3266 y(*)1024 3253 y(uuid)i(=)h(NULL;)576
3351 y(if)f(\(reply\))g({)755 3448 y(uuid)g(=)h(zmsg_pop)e(\(reply\);)
755 3545 y(zmsg_destroy)g(\(&reply\);)755 3642 y(zframe_print)g
(\(uuid,)h("I:)g(request)g(UUID)g("\);)576 3739 y(})576
3933 y(//)89 b(2.)44 b(Wait)h(until)f(we)g(get)g(a)h(reply)576
4031 y(while)f(\(!zctx_interrupted\))d({)755 4128 y(zclock_sleep)i
(\(100\);)755 4225 y(request)h(=)g(zmsg_new)g(\(\);)755
4322 y(zmsg_add)f(\(request,)h(zframe_dup)f(\(uuid\)\);)755
4419 y(zmsg_t)1069 4432 y(*)1114 4419 y(reply)h(=)g(s_service_call)f
(\()934 4516 y(session,)h("titanic.reply",)e(&request\);)755
4711 y(if)i(\(reply\))g({)934 4808 y(char)1158 4821 y(*)1203
4808 y(reply_string)f(=)i(zframe_strdup)d(\(zmsg_last)i(\(reply\)\);)
934 4905 y(printf)g(\("Reply:)g(\045s\\n",)f(reply_string\);)934
5002 y(free)h(\(reply_string\);)934 5099 y(zmsg_destroy)f(\(&reply\);)p
Black 3759 5569 a Ff(204)p Black eop end
%%Page: 205 218
TeXDict begin 205 217 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.205) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 170 a Fe(//)90 b(3.)44 b(Close)g(request)934
267 y(request)g(=)h(zmsg_new)e(\(\);)934 364 y(zmsg_add)h(\(request,)f
(zframe_dup)g(\(uuid\)\);)934 461 y(reply)h(=)h(s_service_call)d
(\(session,)i("titanic.close",)e(&request\);)934 558
y(zmsg_destroy)h(\(&reply\);)934 655 y(break;)755 752
y(})755 850 y(else)h({)934 947 y(printf)g(\("I:)g(no)h(reply)f(yet,)g
(trying)g(again...\\n"\);)934 1044 y(zclock_sleep)f(\(5000\);)223
b(//)89 b(Try)45 b(again)f(in)g(5)h(seconds)755 1141
y(})576 1238 y(})576 1335 y(zframe_destroy)d(\(&uuid\);)576
1432 y(mdcli_destroy)g(\(&session\);)576 1530 y(return)h(0;)396
1627 y(})-2 1801 y
SDict begin H.S end
 -2 1801 a -2 1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801
a
SDict begin [/View [/XYZ H.V]/Dest (0:2559) cvn /DEST pdfmark end
 -2 1801 a 396 1901 a Fk(Of)21 b(course)e(this)i(can)f(and)f(in)i
(practice)e(w)o(ould)h(be)g(wrapped)e(up)i(in)h(some)f(kind)f(of)h
(frame)n(w)o(ork.)e(Real)j(application)396 2009 y(de)n(v)o(elopers)d
(should)i(ne)n(v)o(er)e(see)j(messaging)e(up)h(close,)g(it')-5
b(s)22 b(a)e(tool)g(for)g(more)f(technically-minded)e(e)o(xperts)i(to)h
(b)n(uild)396 2116 y(frame)n(w)o(orks)f(and)g(APIs.)i(If)f(we)g(had)g
(in\002nite)g(time)g(to)h(e)o(xplore)d(this,)j(I')l(d)e(mak)o(e)h(a)h
(TSP)f(API)h(e)o(xample,)d(and)i(bring)f(the)396 2224
y(client)h(application)f(back)h(do)n(wn)f(to)h(a)h(fe)n(w)f(lines)h(of)
e(code.)h(But)g(it')-5 b(s)22 b(the)e(same)g(principle)f(as)i(we)g(sa)o
(w)f(for)g(MDP)-9 b(,)20 b(no)396 2332 y(need)g(to)g(be)g(repetiti)n(v)
o(e.)-2 2516 y
SDict begin H.S end
 -2 2516 a -2 2516 a
SDict begin 13 H.A end
 -2 2516 a -2 2516
a
SDict begin [/View [/XYZ H.V]/Dest (0:2560) cvn /DEST pdfmark end
 -2 2516 a 396 2606 a Fk(Here')-5 b(s)21 b(the)f(T)m(itanic)g
(implementation.)e(This)i(serv)o(er)f(handles)h(the)g(three)g(services)
g(using)g(three)f(threads,)g(as)396 2714 y(proposed.)f(It)j(does)f
(full)g(persistence)f(to)i(disk)f(using)f(the)i(most)f(brute-force)d
(approach)h(possible:)i(one)g(\002le)h(per)396 2822 y(message.)f(It')-5
b(s)21 b(so)f(simple)h(it')-5 b(s)21 b(scary)-5 b(,)19
b(the)h(only)g(comple)o(x)e(part)i(is)h(that)f(it)h(k)o(eeps)f(a)h
(separate)f('queue')e(of)i(all)h(requests)396 2930 y(to)g(a)n(v)n(oid)f
(reading)e(the)i(directory)f(o)o(v)o(er)g(and)g(o)o(v)o(er:)-2
2948 y
SDict begin H.S end
 -2 2948 a -2 2948 a
SDict begin 13 H.A end
 -2 2948 a -2 2948 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c) cvn /DEST pdfmark
end
 -2 2948
a 396 3131 a Fg(Example)i(4-55.)d(T)o(itanic)i(br)o(ok)o(er)g(example)g
(\(titanic.c\))-2 3231 y
SDict begin H.S end
 -2 3231 a -2 3231 a
SDict begin 11.7 H.A end
 -2 3231
a -2 3231 a
SDict begin [/View [/XYZ H.V]/Dest (0:2563) cvn /DEST pdfmark end
 -2 3231 a 396 3312 a Fe(//)396 3409 y(//)90
b(Titanic)43 b(service)396 3506 y(//)396 3603 y(//)90
b(Implements)43 b(server)h(side)g(of)g(http://rfc.zeromq.org/spec:9)396
3797 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)g
(creating)f(a)i(library)396 3894 y(#include)f("mdwrkapi.c")396
3992 y(#include)g("mdcliapi.c")396 4186 y(#include)g("zfile.h")396
4283 y(#include)g(<uuid/uuid.h>)396 4477 y(//)90 b(Return)43
b(a)i(new)f(UUID)h(as)f(a)h(printable)e(character)g(string)396
4574 y(//)90 b(Caller)43 b(must)i(free)f(returned)f(string)h(when)g
(finished)g(with)g(it)396 4769 y(static)g(char)934 4782
y(*)396 4866 y(s_generate_uuid)f(\(void\))396 4963 y({)576
5060 y(char)h(hex_char)f([])i(=)f("0123456789ABCDEF";)576
5157 y(char)800 5170 y(*)845 5157 y(uuidstr)f(=)i(zmalloc)f(\(sizeof)f
(\(uuid_t\))2414 5170 y(*)2503 5157 y(2)i(+)g(1\);)p
Black 3759 5569 a Ff(205)p Black eop end
%%Page: 206 219
TeXDict begin 206 218 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.206) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(uuid_t)43 b(uuid;)576 170 y(uuid_generate)f
(\(uuid\);)576 267 y(int)i(byte_nbr;)576 364 y(for)g(\(byte_nbr)f(=)i
(0;)f(byte_nbr)g(<)h(sizeof)e(\(uuid_t\);)h(byte_nbr++\))f({)755
461 y(uuidstr)h([byte_nbr)1562 474 y(*)1652 461 y(2)g(+)h(0])f(=)h
(hex_char)f([uuid)g([byte_nbr])f(>>)h(4];)755 558 y(uuidstr)g
([byte_nbr)1562 571 y(*)1652 558 y(2)g(+)h(1])f(=)h(hex_char)f([uuid)g
([byte_nbr])f(&)h(15];)576 655 y(})576 752 y(return)f(uuidstr;)396
850 y(})396 1044 y(//)90 b(Returns)43 b(freshly)h(allocated)f(request)h
(filename)f(for)i(given)f(UUID)396 1238 y(#define)g(TITANIC_DIR)f
(".titanic")396 1432 y(static)h(char)934 1445 y(*)396
1530 y(s_request_filename)e(\(char)1517 1543 y(*)1562
1530 y(uuid\))i({)576 1627 y(char)800 1640 y(*)845 1627
y(filename)f(=)i(malloc)f(\(256\);)576 1724 y(snprintf)f(\(filename,)g
(256,)h(TITANIC_DIR)f("/\045s.req",)h(uuid\);)576 1821
y(return)f(filename;)396 1918 y(})396 2112 y(//)90 b(Returns)43
b(freshly)h(allocated)f(reply)h(filename)g(for)g(given)g(UUID)396
2307 y(static)g(char)934 2320 y(*)396 2404 y(s_reply_filename)e(\(char)
1427 2417 y(*)1472 2404 y(uuid\))i({)576 2501 y(char)800
2514 y(*)845 2501 y(filename)f(=)i(malloc)f(\(256\);)576
2598 y(snprintf)f(\(filename,)g(256,)h(TITANIC_DIR)f("/\045s.rep",)h
(uuid\);)576 2695 y(return)f(filename;)396 2792 y(})-2
2967 y
SDict begin H.S end
 -2 2967 a -2 2967 a
SDict begin 13 H.A end
 -2 2967 a -2 2967 a
SDict begin [/View [/XYZ H.V]/Dest (0:2564) cvn /DEST pdfmark end
 -2 2967
a 396 3066 a Fk(The)20 b("titanic.request")f(task)h(w)o(aits)h(for)f
(requests)g(to)g(this)h(service.)e(It)i(writes)g(each)e(request)h(to)g
(disk)g(and)g(returns)f(a)396 3174 y(UUID)h(to)h(the)f(client.)g(The)g
(client)g(picks)g(up)g(the)g(reply)f(asynchronously)e(using)j(the)g
("titanic.reply")f(service:)-2 3192 y
SDict begin H.S end
 -2 3192 a -2 3192
a
SDict begin 13 H.A end
 -2 3192 a -2 3192 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c-1) cvn /DEST pdfmark
end
 -2 3192 a 396 3376 a Fg(Example)i(4-56.)d(T)o
(itanic)i(br)o(ok)o(er)g(example)g(\(titanic.c\))f(-)h(T)o(itanic)g(r)o
(equest)g(ser)o(vice)-2 3475 y
SDict begin H.S end
 -2 3475 a -2 3475 a
SDict begin 11.7 H.A end
 -2
3475 a -2 3475 a
SDict begin [/View [/XYZ H.V]/Dest (0:2567) cvn /DEST pdfmark end
 -2 3475 a 396 3750 a Fe(static)44 b(void)396
3847 y(titanic_request)f(\(void)1383 3860 y(*)1428 3847
y(args,)g(zctx_t)2010 3860 y(*)2055 3847 y(ctx,)h(void)2503
3860 y(*)2548 3847 y(pipe\))396 3944 y({)576 4041 y(mdwrk_t)934
4054 y(*)979 4041 y(worker)g(=)h(mdwrk_new)e(\()755 4138
y("tcp://localhost:5555",)e("titanic.request",)h(0\);)576
4236 y(zmsg_t)889 4249 y(*)934 4236 y(reply)i(=)h(NULL;)576
4430 y(while)f(\(true\))f({)755 4527 y(//)89 b(Send)44
b(reply)g(if)h(it's)f(not)g(null)755 4624 y(//)89 b(And)45
b(then)f(get)g(next)g(request)g(from)g(broker)755 4721
y(zmsg_t)1069 4734 y(*)1114 4721 y(request)f(=)i(mdwrk_recv)e
(\(worker,)h(&reply\);)755 4818 y(if)g(\(!request\))934
4916 y(break;)268 b(//)90 b(Interrupted,)42 b(exit)755
5110 y(//)89 b(Ensure)44 b(message)g(directory)f(exists)p
Black 3757 5569 a Ff(206)p Black eop end
%%Page: 207 220
TeXDict begin 207 219 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.207) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(zfile_mkdir)43 b(\(TITANIC_DIR\);)755
267 y(//)89 b(Generate)44 b(UUID)g(and)g(save)g(message)g(to)h(disk)755
364 y(char)979 377 y(*)1024 364 y(uuid)f(=)h(s_generate_uuid)d(\(\);)
755 461 y(char)979 474 y(*)1024 461 y(filename)h(=)i
(s_request_filename)d(\(uuid\);)755 558 y(FILE)979 571
y(*)1024 558 y(file)i(=)h(fopen)f(\(filename,)f("w"\);)755
655 y(assert)h(\(file\);)755 752 y(zmsg_save)f(\(request,)h(file\);)755
850 y(fclose)g(\(file\);)755 947 y(free)g(\(filename\);)755
1044 y(zmsg_destroy)f(\(&request\);)755 1238 y(//)89
b(Send)44 b(UUID)h(through)e(to)i(message)e(queue)755
1335 y(reply)h(=)h(zmsg_new)e(\(\);)755 1432 y(zmsg_addstr)g(\(reply,)h
(uuid\);)755 1530 y(zmsg_send)f(\(&reply,)h(pipe\);)755
1724 y(//)89 b(Now)45 b(send)f(UUID)g(back)g(to)h(client)755
1821 y(//)89 b(Done)44 b(by)h(the)f(mdwrk_recv\(\))f(at)i(the)f(top)g
(of)h(the)f(loop)755 1918 y(reply)g(=)h(zmsg_new)e(\(\);)755
2015 y(zmsg_addstr)g(\(reply,)h("200"\);)755 2112 y(zmsg_addstr)f
(\(reply,)h(uuid\);)755 2209 y(free)g(\(uuid\);)576 2307
y(})576 2404 y(mdwrk_destroy)e(\(&worker\);)396 2501
y(})-2 2675 y
SDict begin H.S end
 -2 2675 a -2 2675 a
SDict begin 13 H.A end
 -2 2675 a -2 2675 a
SDict begin [/View [/XYZ H.V]/Dest (0:2568) cvn /DEST pdfmark end

-2 2675 a 396 2775 a Fk(The)20 b("titanic.reply")f(task)h(checks)g(if)g
(there')-5 b(s)20 b(a)h(reply)e(for)h(the)g(speci\002ed)g(request)f
(\(by)h(UUID\),)f(and)h(returns)f(a)i(200)396 2883 y(OK,)g(300)e
(Pending,)g(or)h(400)f(Unkno)n(wn)f(accordingly:)-2 2901
y
SDict begin H.S end
 -2 2901 a -2 2901 a
SDict begin 13 H.A end
 -2 2901 a -2 2901 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c-2) cvn /DEST pdfmark
end
 -2 2901 a 396
3084 a Fg(Example)j(4-57.)d(T)o(itanic)i(br)o(ok)o(er)g(example)g
(\(titanic.c\))f(-)h(T)o(itanic)g(r)o(eply)g(ser)o(vice)-2
3184 y
SDict begin H.S end
 -2 3184 a -2 3184 a
SDict begin 11.7 H.A end
 -2 3184 a -2 3184 a
SDict begin [/View [/XYZ H.V]/Dest (0:2571) cvn /DEST pdfmark end
 -2 3184
a 396 3459 a Fe(static)44 b(void)934 3472 y(*)396 3556
y(titanic_reply)f(\(void)1293 3569 y(*)1338 3556 y(context\))396
3653 y({)576 3750 y(mdwrk_t)934 3763 y(*)979 3750 y(worker)h(=)h
(mdwrk_new)e(\()755 3847 y("tcp://localhost:5555",)e("titanic.reply",)h
(0\);)576 3944 y(zmsg_t)889 3957 y(*)934 3944 y(reply)i(=)h(NULL;)576
4138 y(while)f(\(true\))f({)755 4236 y(zmsg_t)1069 4249
y(*)1114 4236 y(request)g(=)i(mdwrk_recv)e(\(worker,)h(&reply\);)755
4333 y(if)g(\(!request\))934 4430 y(break;)268 b(//)90
b(Interrupted,)42 b(exit)755 4624 y(char)979 4637 y(*)1024
4624 y(uuid)i(=)h(zmsg_popstr)e(\(request\);)755 4721
y(char)979 4734 y(*)1024 4721 y(req_filename)g(=)h(s_request_filename)e
(\(uuid\);)755 4818 y(char)979 4831 y(*)1024 4818 y(rep_filename)h(=)h
(s_reply_filename)f(\(uuid\);)755 4916 y(if)h(\(zfile_exists)f
(\(rep_filename\)\))f({)934 5013 y(FILE)1158 5026 y(*)1203
5013 y(file)i(=)h(fopen)f(\(rep_filename,)f("r"\);)934
5110 y(assert)h(\(file\);)p Black 3756 5569 a Ff(207)p
Black eop end
%%Page: 208 221
TeXDict begin 208 220 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.208) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 72 a Fe(reply)44 b(=)h(zmsg_load)e(\(NULL,)h(file\);)934
170 y(zmsg_pushstr)f(\(reply,)h("200"\);)934 267 y(fclose)g(\(file\);)
755 364 y(})755 461 y(else)g({)934 558 y(reply)g(=)h(zmsg_new)e(\(\);)
934 655 y(if)i(\(zfile_exists)d(\(req_filename\)\))1114
752 y(zmsg_pushstr)g(\(reply,)i("300"\);)g(//Pending)934
850 y(else)1114 947 y(zmsg_pushstr)e(\(reply,)i("400"\);)g(//Unknown)
755 1044 y(})755 1141 y(zmsg_destroy)f(\(&request\);)755
1238 y(free)h(\(uuid\);)755 1335 y(free)g(\(req_filename\);)755
1432 y(free)g(\(rep_filename\);)576 1530 y(})576 1627
y(mdwrk_destroy)e(\(&worker\);)576 1724 y(return)h(0;)396
1821 y(})-2 1995 y
SDict begin H.S end
 -2 1995 a -2 1995 a
SDict begin 13 H.A end
 -2 1995 a -2 1995
a
SDict begin [/View [/XYZ H.V]/Dest (0:2572) cvn /DEST pdfmark end
 -2 1995 a 396 2095 a Fk(The)20 b("titanic.close")f(task)i(remo)o(v)o
(es)d(an)o(y)i(w)o(aiting)g(replies)g(for)f(the)i(request)e
(\(speci\002ed)h(by)f(UUID\).)h(It')-5 b(s)21 b(idempotent,)396
2203 y(so)g(safe)f(to)h(call)f(more)g(than)f(once)h(in)g(a)h(ro)n(w:)-2
2204 y
SDict begin H.S end
 -2 2204 a -2 2204 a
SDict begin 13 H.A end
 -2 2204 a -2 2204 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c-3) cvn /DEST pdfmark
end
 -2 2204
a 396 2404 a Fg(Example)g(4-58.)d(T)o(itanic)i(br)o(ok)o(er)g(example)g
(\(titanic.c\))f(-)h(T)o(itanic)g(close)g(task)-2 2504
y
SDict begin H.S end
 -2 2504 a -2 2504 a
SDict begin 11.7 H.A end
 -2 2504 a -2 2504 a
SDict begin [/View [/XYZ H.V]/Dest (0:2575) cvn /DEST pdfmark end
 -2 2504 a 396
2779 a Fe(static)44 b(void)934 2792 y(*)396 2876 y(titanic_close)f
(\(void)1293 2889 y(*)1338 2876 y(context\))396 2973
y({)576 3070 y(mdwrk_t)934 3083 y(*)979 3070 y(worker)h(=)h(mdwrk_new)e
(\()755 3167 y("tcp://localhost:5555",)e("titanic.close",)h(0\);)576
3264 y(zmsg_t)889 3277 y(*)934 3264 y(reply)i(=)h(NULL;)576
3459 y(while)f(\(true\))f({)755 3556 y(zmsg_t)1069 3569
y(*)1114 3556 y(request)g(=)i(mdwrk_recv)e(\(worker,)h(&reply\);)755
3653 y(if)g(\(!request\))934 3750 y(break;)268 b(//)90
b(Interrupted,)42 b(exit)755 3944 y(char)979 3957 y(*)1024
3944 y(uuid)i(=)h(zmsg_popstr)e(\(request\);)755 4041
y(char)979 4054 y(*)1024 4041 y(req_filename)g(=)h(s_request_filename)e
(\(uuid\);)755 4138 y(char)979 4151 y(*)1024 4138 y(rep_filename)h(=)h
(s_reply_filename)f(\(uuid\);)755 4236 y(zfile_delete)g
(\(req_filename\);)755 4333 y(zfile_delete)g(\(rep_filename\);)755
4430 y(free)h(\(uuid\);)755 4527 y(free)g(\(req_filename\);)755
4624 y(free)g(\(rep_filename\);)755 4818 y(zmsg_destroy)f
(\(&request\);)755 4916 y(reply)h(=)h(zmsg_new)e(\(\);)755
5013 y(zmsg_addstr)g(\(reply,)h("200"\);)576 5110 y(})p
Black 3759 5569 a Ff(208)p Black eop end
%%Page: 209 222
TeXDict begin 209 221 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.209) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(mdwrk_destroy)42 b(\(&worker\);)576
170 y(return)h(0;)396 267 y(})-2 441 y
SDict begin H.S end
 -2 441 a -2 441
a
SDict begin 13 H.A end
 -2 441 a -2 441 a
SDict begin [/View [/XYZ H.V]/Dest (0:2576) cvn /DEST pdfmark end
 -2 441 a 396 541 a Fk(This)21 b(is)g(the)f(main)g
(thread)f(for)h(the)g(T)m(itanic)g(w)o(ork)o(er)-5 b(.)19
b(It)i(starts)g(three)e(child)h(threads;)g(for)f(the)i(request,)e
(reply)-5 b(,)19 b(and)396 649 y(close)i(services.)f(It)g(then)g
(dispatches)f(requests)h(to)h(w)o(ork)o(ers)e(using)h(a)g(simple)g
(brute-force)e(disk)i(queue.)f(It)h(recei)n(v)o(es)396
757 y(request)g(UUIDs)g(from)f(the)i(titanic.request)d(service,)i(sa)n
(v)o(es)h(these)f(to)g(a)h(disk)f(\002le,)h(and)f(then)f(thro)n(ws)h
(each)g(request)f(at)396 865 y(MDP)i(w)o(ork)o(ers)e(until)h(it)h(gets)
g(a)f(response:)-2 882 y
SDict begin H.S end
 -2 882 a -2 882 a
SDict begin 13 H.A end
 -2 882 a -2
882 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c-4) cvn /DEST pdfmark
end
 -2 882 a 396 1066 a Fg(Example)h(4-59.)d(T)o(itanic)i(br)o(ok)o
(er)g(example)g(\(titanic.c\))f(-)h(w)o(ork)o(er)g(task)-2
1166 y
SDict begin H.S end
 -2 1166 a -2 1166 a
SDict begin 11.7 H.A end
 -2 1166 a -2 1166 a
SDict begin [/View [/XYZ H.V]/Dest (0:2579) cvn /DEST pdfmark end
 -2 1166
a 396 1440 a Fe(static)44 b(int)g(s_service_success)e(\(char)1965
1453 y(*)2010 1440 y(uuid\);)396 1635 y(int)j(main)f(\(int)g(argc,)g
(char)1517 1648 y(*)1562 1635 y(argv)g([]\))396 1732
y({)576 1829 y(int)g(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g
(\(argv)g([1],)g("-v"\)\);)576 1926 y(zctx_t)889 1939
y(*)934 1926 y(ctx)h(=)f(zctx_new)g(\(\);)576 2120 y(void)800
2133 y(*)845 2120 y(request_pipe)e(=)j(zthread_fork)e(\(ctx,)h
(titanic_request,)e(NULL\);)576 2217 y(zthread_new)h(\(titanic_reply,)f
(NULL\);)576 2314 y(zthread_new)h(\(titanic_close,)f(NULL\);)576
2509 y(//)89 b(Main)44 b(dispatcher)f(loop)576 2606 y(while)h(\(true\))
f({)755 2703 y(//)89 b(We'll)44 b(dispatch)g(once)g(per)g(second,)g(if)
g(there's)g(no)h(activity)755 2800 y(zmq_pollitem_t)d(items)i([])h(=)g
({)f({)h(request_pipe,)e(0,)h(ZMQ_POLLIN,)f(0)i(})f(};)755
2897 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g(1,)g(1000)2279
2910 y(*)2369 2897 y(ZMQ_POLL_MSEC\);)755 2994 y(if)g(\(rc)h(==)f(-1\))
934 3092 y(break;)627 b(//)89 b(Interrupted)755 3189
y(if)44 b(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
3286 y(//)90 b(Ensure)43 b(message)h(directory)f(exists)934
3383 y(zfile_mkdir)g(\(TITANIC_DIR\);)934 3577 y(//)90
b(Append)43 b(UUID)i(to)f(queue,)g(prefixed)f(with)i('-')f(for)g
(pending)934 3674 y(zmsg_t)1248 3687 y(*)1293 3674 y(msg)g(=)h
(zmsg_recv)e(\(request_pipe\);)934 3772 y(if)i(\(!msg\))1114
3869 y(break;)447 b(//)89 b(Interrupted)934 3966 y(FILE)1158
3979 y(*)1203 3966 y(file)44 b(=)h(fopen)f(\(TITANIC_DIR)f("/queue",)g
("a"\);)934 4063 y(char)1158 4076 y(*)1203 4063 y(uuid)h(=)h
(zmsg_popstr)e(\(msg\);)934 4160 y(fprintf)h(\(file,)g("-\045s\\n",)f
(uuid\);)934 4257 y(fclose)h(\(file\);)934 4354 y(free)g(\(uuid\);)934
4451 y(zmsg_destroy)f(\(&msg\);)755 4549 y(})755 4646
y(//)89 b(Brute-force)43 b(dispatcher)755 4743 y(char)h(entry)g([])h(=)
f("?.......:.......:.......:.......:";)755 4840 y(FILE)979
4853 y(*)1024 4840 y(file)g(=)h(fopen)f(\(TITANIC_DIR)f("/queue",)g
("r+"\);)755 4937 y(while)h(\(file)g(&&)g(fread)g(\(entry,)g(33,)g(1,)h
(file\))f(==)g(1\))h({)934 5034 y(//)90 b(UUID)44 b(is)g(prefixed)g
(with)g('-')g(if)h(still)f(waiting)934 5131 y(if)h(\(entry)f([0])g(==)g
('-'\))h({)p Black 3759 5569 a Ff(209)p Black eop end
%%Page: 210 223
TeXDict begin 210 222 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.210) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 1114 72 a Fe(if)44 b(\(verbose\))1293 170 y(printf)g(\("I:)g
(processing)f(request)h(\045s\\n",)g(entry)g(+)g(1\);)1114
267 y(if)g(\(s_service_success)e(\(entry)i(+)g(1\)\))h({)1293
364 y(//)89 b(Mark)44 b(queue)g(entry)g(as)h(processed)1293
461 y(fseek)f(\(file,)g(-33,)g(SEEK_CUR\);)1293 558 y(fwrite)g(\("+",)g
(1,)g(1,)h(file\);)1293 655 y(fseek)f(\(file,)g(32,)g(SEEK_CUR\);)1114
752 y(})934 850 y(})934 947 y(//)90 b(Skip)44 b(end)g(of)h(line,)f(LF)g
(or)h(CRLF)934 1044 y(if)g(\(fgetc)f(\(file\))f(==)i('\\r'\))1114
1141 y(fgetc)f(\(file\);)934 1238 y(if)h(\(zctx_interrupted\))1114
1335 y(break;)755 1432 y(})755 1530 y(if)f(\(file\))934
1627 y(fclose)g(\(file\);)576 1724 y(})576 1821 y(return)f(0;)396
1918 y(})-2 2092 y
SDict begin H.S end
 -2 2092 a -2 2092 a
SDict begin 13 H.A end
 -2 2092 a -2 2092
a
SDict begin [/View [/XYZ H.V]/Dest (0:2580) cvn /DEST pdfmark end
 -2 2092 a 396 2192 a Fk(Here)20 b(we)h(\002rst)g(check)e(if)i(the)f
(requested)f(MDP)h(service)g(is)h(de\002ned)f(or)g(not,)f(using)h(a)g
(MMI)g(lookup)f(to)h(the)396 2300 y(Majordomo)e(brok)o(er)-5
b(.)19 b(If)h(the)g(service)g(e)o(xists)h(we)f(send)g(a)h(request)e
(and)h(w)o(ait)h(for)e(a)i(reply)e(using)h(the)g(con)m(v)o(entional)396
2408 y(MDP)h(client)f(API.)g(This)h(is)g(not)f(meant)f(to)i(be)f(f)o
(ast,)g(just)h(v)o(ery)e(simple:)-2 2426 y
SDict begin H.S end
 -2 2426 a
-2 2426 a
SDict begin 13 H.A end
 -2 2426 a -2 2426 a
SDict begin [/View [/XYZ H.V]/Dest (0:titanic-c-5) cvn /DEST pdfmark
end
 -2 2426 a 396 2609 a Fg(Example)i(4-60.)d
(T)o(itanic)i(br)o(ok)o(er)g(example)g(\(titanic.c\))f(-)h(try)g(to)g
(call)g(a)g(ser)o(vice)-2 2709 y
SDict begin H.S end
 -2 2709 a -2 2709 a
SDict begin 11.7 H.A end

-2 2709 a -2 2709 a
SDict begin [/View [/XYZ H.V]/Dest (0:2583) cvn /DEST pdfmark end
 -2 2709 a 396 2887 a Fe(static)44
b(int)396 2984 y(s_service_success)e(\(char)1472 2997
y(*)1517 2984 y(uuid\))396 3081 y({)576 3178 y(//)89
b(Load)44 b(request)g(message,)f(service)h(will)g(be)h(first)f(frame)
576 3275 y(char)800 3288 y(*)845 3275 y(filename)f(=)i
(s_request_filename)d(\(uuid\);)576 3372 y(FILE)800 3385
y(*)845 3372 y(file)i(=)g(fopen)g(\(filename,)g("r"\);)576
3469 y(free)g(\(filename\);)576 3664 y(//)89 b(If)44
b(the)h(client)f(already)f(closed)h(request,)g(treat)g(as)g(successful)
576 3761 y(if)g(\(!file\))755 3858 y(return)g(1;)576
4052 y(zmsg_t)889 4065 y(*)934 4052 y(request)g(=)h(zmsg_load)e
(\(NULL,)h(file\);)576 4149 y(fclose)f(\(file\);)576
4246 y(zframe_t)979 4259 y(*)1024 4246 y(service)h(=)g(zmsg_pop)g
(\(request\);)576 4344 y(char)800 4357 y(*)845 4344 y(service_name)e(=)
j(zframe_strdup)e(\(service\);)576 4538 y(//)89 b(Create)44
b(MDP)g(client)g(session)g(with)g(short)g(timeout)576
4635 y(mdcli_t)934 4648 y(*)979 4635 y(client)g(=)h(mdcli_new)e
(\("tcp://localhost:5555",)e(FALSE\);)576 4732 y(mdcli_set_timeout)h
(\(client,)h(1000\);)89 b(//)g(1)45 b(sec)576 4829 y(mdcli_set_retries)
d(\(client,)h(1\);)224 b(//)89 b(only)44 b(1)h(retry)576
5023 y(//)89 b(Use)44 b(MMI)h(protocol)e(to)i(check)f(if)g(service)g
(is)g(available)576 5121 y(zmsg_t)889 5134 y(*)934 5121
y(mmi_request)f(=)i(zmsg_new)e(\(\);)p Black 3759 5569
a Ff(210)p Black eop end
%%Page: 211 224
TeXDict begin 211 223 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.211) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(zmsg_add)43 b(\(mmi_request,)g(service\);)576
170 y(zmsg_t)889 183 y(*)934 170 y(mmi_reply)h(=)g(mdcli_send)f
(\(client,)h("mmi.service",)e(&mmi_request\);)576 267
y(int)i(service_ok)f(=)i(\(mmi_reply)755 364 y(&&)f(zframe_streq)f
(\(zmsg_first)g(\(mmi_reply\),)g("200"\)\);)576 461 y(zmsg_destroy)f
(\(&mmi_reply\);)576 655 y(int)i(result)g(=)g(0;)576
752 y(if)g(\(service_ok\))f({)755 850 y(zmsg_t)1069 863
y(*)1114 850 y(reply)h(=)g(mdcli_send)f(\(client,)h(service_name,)f
(&request\);)755 947 y(if)h(\(reply\))g({)934 1044 y(filename)g(=)g
(s_reply_filename)f(\(uuid\);)934 1141 y(FILE)1158 1154
y(*)1203 1141 y(file)h(=)h(fopen)f(\(filename,)f("w"\);)934
1238 y(assert)h(\(file\);)934 1335 y(zmsg_save)g(\(reply,)f(file\);)934
1432 y(fclose)h(\(file\);)934 1530 y(free)g(\(filename\);)934
1627 y(result)g(=)h(1;)755 1724 y(})755 1821 y(zmsg_destroy)e
(\(&reply\);)576 1918 y(})576 2015 y(else)755 2112 y(zmsg_destroy)g
(\(&request\);)576 2307 y(mdcli_destroy)f(\(&client\);)576
2404 y(free)i(\(service_name\);)576 2501 y(return)f(result;)396
2598 y(})-2 2772 y
SDict begin H.S end
 -2 2772 a -2 2772 a
SDict begin 13 H.A end
 -2 2772 a -2 2772
a
SDict begin [/View [/XYZ H.V]/Dest (0:2584) cvn /DEST pdfmark end
 -2 2772 a 396 2872 a Fk(T)-7 b(o)20 b(test)h(this,)f(start)962
2872 y
SDict begin H.S end
 962 2872 a 962 2872 a
SDict begin 13 H.A end
 962 2872 a 962 2872 a
SDict begin [/View [/XYZ H.V]/Dest (0:2585) cvn /DEST pdfmark end
 962
2872 a Fe(mdbroker)f Fk(and)1481 2872 y
SDict begin H.S end
 1481 2872 a 1481
2872 a
SDict begin 13 H.A end
 1481 2872 a 1481 2872 a
SDict begin [/View [/XYZ H.V]/Dest (0:2586) cvn /DEST pdfmark end
 1481 2872 a Fe(titanic)p
Fk(,)g(then)g(run)2130 2872 y
SDict begin H.S end
 2130 2872 a 2130 2872 a
SDict begin 13 H.A end

2130 2872 a 2130 2872 a
SDict begin [/View [/XYZ H.V]/Dest (0:2587) cvn /DEST pdfmark end
 2130 2872 a Fe(ticlient)p Fk(.)f(No)n(w)i
(start)2872 2872 y
SDict begin H.S end
 2872 2872 a 2872 2872 a
SDict begin 13 H.A end
 2872 2872
a 2872 2872 a
SDict begin [/View [/XYZ H.V]/Dest (0:2588) cvn /DEST pdfmark end
 2872 2872 a Fe(mdworker)f Fk(arbitrarily)-5
b(,)18 b(and)h(you)396 2980 y(should)g(see)i(the)f(client)h(getting)e
(a)i(response)e(and)h(e)o(xiting)f(happily)-5 b(.)-2
3164 y
SDict begin H.S end
 -2 3164 a -2 3164 a
SDict begin 13 H.A end
 -2 3164 a -2 3164 a
SDict begin [/View [/XYZ H.V]/Dest (0:2589) cvn /DEST pdfmark end
 -2 3164
a 396 3254 a Fk(Some)20 b(notes)g(about)f(this)i(code:)-2
3255 y
SDict begin H.S end
 -2 3255 a -2 3255 a
SDict begin 13 H.A end
 -2 3255 a -2 3255 a
SDict begin [/View [/XYZ H.V]/Dest (0:2590) cvn /DEST pdfmark end
 -2 3255
a -2 3265 a
SDict begin H.S end
 -2 3265 a -2 3265 a
SDict begin 13 H.A end
 -2 3265 a -2 3265 a
SDict begin [/View [/XYZ H.V]/Dest (0:2591) cvn /DEST pdfmark end
 -2
3265 a Black 396 3424 a Fj(\225)p Black 479 3424 a
SDict begin H.S end
 479
3424 a 479 3424 a
SDict begin 13 H.A end
 479 3424 a 479 3424 a
SDict begin [/View [/XYZ H.V]/Dest (0:2592) cvn /DEST pdfmark end
 479 3424 a Fk(W)-7
b(e)22 b(use)e(MMI)g(to)g(only)g(send)g(requests)g(to)g(services)g
(that)g(appear)f(to)i(be)f(running.)e(This)i(w)o(orks)g(as)h(well)f(as)
h(the)479 3532 y(MMI)f(implementation)e(in)j(the)f(brok)o(er)-5
b(.)-2 3550 y
SDict begin H.S end
 -2 3550 a -2 3550 a
SDict begin 13 H.A end
 -2 3550 a -2 3550 a
SDict begin [/View [/XYZ H.V]/Dest (0:2593) cvn /DEST pdfmark end

-2 3550 a Black 396 3681 a Fj(\225)p Black 479 3681 a
SDict begin H.S end

479 3681 a 479 3681 a
SDict begin 13 H.A end
 479 3681 a 479 3681 a
SDict begin [/View [/XYZ H.V]/Dest (0:2594) cvn /DEST pdfmark end
 479 3681
a Fk(W)e(e)22 b(use)e(an)g(inproc)f(connection)f(to)i(send)g(ne)n(w)g
(request)g(data)g(from)f(the)2596 3681 y
SDict begin H.S end
 2596 3681 a
2596 3681 a
SDict begin 13 H.A end
 2596 3681 a 2596 3681 a
SDict begin [/View [/XYZ H.V]/Dest (0:2595) cvn /DEST pdfmark end
 2596 3681 a Fg(titanic.r)o(equest)g
Fk(service)h(through)e(to)i(the)479 3789 y(main)g(dispatcher)-5
b(.)19 b(This)i(sa)n(v)o(es)f(the)g(dispatcher)f(from)h(ha)n(ving)f(to)
h(scan)g(the)h(disk)f(directory)-5 b(,)18 b(load)h(all)i(request)f
(\002les,)479 3897 y(and)g(sort)g(them)g(by)g(date/time.)-2
4081 y
SDict begin H.S end
 -2 4081 a -2 4081 a
SDict begin 13 H.A end
 -2 4081 a -2 4081 a
SDict begin [/View [/XYZ H.V]/Dest (0:2596) cvn /DEST pdfmark end
 -2 4081
a 396 4171 a Fk(The)g(important)f(thing)g(about)g(this)i(e)o(xample)e
(is)i(not)f(performance)d(\(which)i(is)j(surely)d(terrible,)h(I')l(v)o
(e)f(not)g(tested)i(it\),)396 4279 y(b)n(ut)f(ho)n(w)g(well)h(it)g
(implements)e(the)h(reliability)g(contract.)f(T)-7 b(o)20
b(try)g(it,)h(start)f(the)h(mdbrok)o(er)c(and)j(titanic)g(programs.)396
4387 y(Then)g(start)g(the)h(ticlient,)f(and)f(then)h(start)h(the)f(mdw)
o(ork)o(er)e(echo)i(service.)f(Y)-9 b(ou)20 b(can)g(run)f(all)i(four)e
(of)h(these)h(using)e(the)396 4495 y('-v')g(option)g(to)i(do)f(v)o
(erbose)e(tracing)i(of)f(acti)n(vity)-5 b(.)20 b(Y)-9
b(ou)19 b(can)h(stop)g(and)g(restart)g(an)o(y)g(piece)3019
4495 y
SDict begin H.S end
 3019 4495 a 3019 4495 a
SDict begin 13 H.A end
 3019 4495 a 3019 4495
a
SDict begin [/View [/XYZ H.V]/Dest (0:2597) cvn /DEST pdfmark end
 3019 4495 a Ff(e)n(xcept)i Fk(the)e(client)h(and)396
4603 y(nothing)e(will)i(get)f(lost.)-2 4787 y
SDict begin H.S end
 -2 4787
a -2 4787 a
SDict begin 13 H.A end
 -2 4787 a -2 4787 a
SDict begin [/View [/XYZ H.V]/Dest (0:2598) cvn /DEST pdfmark end
 -2 4787 a 396 4877 a
Fk(If)g(you)g(w)o(ant)g(to)g(use)h(T)m(itanic)f(in)g(real)g(cases,)h
(you')o(ll)e(rapidly)g(be)h(asking)g("ho)n(w)f(do)h(we)h(mak)o(e)e
(this)i(f)o(aster?")f(Here')-5 b(s)396 4985 y(what)20
b(I')l(d)g(do,)f(starting)h(with)h(the)f(e)o(xample)f(implementation:)
-2 5003 y
SDict begin H.S end
 -2 5003 a -2 5003 a
SDict begin 13 H.A end
 -2 5003 a -2 5003 a
SDict begin [/View [/XYZ H.V]/Dest (0:2599) cvn /DEST pdfmark end
 -2
5003 a -2 5013 a
SDict begin H.S end
 -2 5013 a -2 5013 a
SDict begin 13 H.A end
 -2 5013 a -2 5013
a
SDict begin [/View [/XYZ H.V]/Dest (0:2600) cvn /DEST pdfmark end
 -2 5013 a Black 3759 5569 a Ff(211)p Black eop end
%%Page: 212 225
TeXDict begin 212 224 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.212) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2635) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2601) cvn /DEST pdfmark end
 479 72 a Fk(Use)h(a)g(single)f(disk)g
(\002le)h(for)e(all)i(data,)f(rather)f(than)h(multiple)g(\002les.)h
(Operating)d(systems)j(are)f(usually)g(better)g(at)479
180 y(handling)f(a)h(fe)n(w)g(lar)o(ge)g(\002les)h(than)e(man)o(y)g
(smaller)i(ones.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a
-2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:2602) cvn /DEST pdfmark end
 -2 198 a Black 396 330 a Fj(\225)p Black 479
330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:2603) cvn /DEST pdfmark end
 479 330
a Fk(Or)o(ganize)d(that)j(disk)f(\002le)h(as)g(a)f(circular)g(b)n(uf)n
(fer)e(so)j(that)f(ne)n(w)g(requests)g(can)g(be)g(written)g
(contiguously)e(\(with)i(v)o(ery)479 438 y(occasional)f(wraparound\).)e
(One)j(thread,)f(writing)h(full)g(speed)g(to)g(a)h(disk)f(\002le)h(can)
f(w)o(ork)f(rapidly)-5 b(.)-2 456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end

-2 456 a -2 456 a
SDict begin [/View [/XYZ H.V]/Dest (0:2604) cvn /DEST pdfmark end
 -2 456 a Black 396 587 a Fj(\225)p
Black 479 587 a
SDict begin H.S end
 479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587
a
SDict begin [/View [/XYZ H.V]/Dest (0:2605) cvn /DEST pdfmark end
 479 587 a Fk(K)n(eep)20 b(the)g(inde)o(x)f(in)i(memory)d(and)i(reb)n
(uild)f(the)h(inde)o(x)f(at)i(startup)f(time,)g(from)f(the)h(disk)g(b)n
(uf)n(fer)-5 b(.)19 b(This)i(sa)n(v)o(es)f(the)479 695
y(e)o(xtra)f(disk)g(head)g(\003utter)h(needed)e(to)h(k)o(eep)g(the)h
(inde)o(x)e(fully)h(safe)g(on)g(disk.)h(Y)-9 b(ou)18
b(w)o(ould)h(w)o(ant)h(an)f(fsync)g(after)g(e)n(v)o(ery)479
803 y(message,)h(or)g(e)n(v)o(ery)f(N)i(milliseconds)e(if)h(you)g(were)
g(prepared)e(to)i(lose)h(the)f(last)h(M)g(messages)f(in)g(case)h(of)f
(a)h(system)479 911 y(f)o(ailure.)-2 912 y
SDict begin H.S end
 -2 912 a -2
912 a
SDict begin 13 H.A end
 -2 912 a -2 912 a
SDict begin [/View [/XYZ H.V]/Dest (0:2606) cvn /DEST pdfmark end
 -2 912 a Black 396 1060 a Fj(\225)p
Black 479 1060 a
SDict begin H.S end
 479 1060 a 479 1060 a
SDict begin 13 H.A end
 479 1060 a 479
1060 a
SDict begin [/View [/XYZ H.V]/Dest (0:2607) cvn /DEST pdfmark end
 479 1060 a Fk(Use)g(a)g(solid-state)f(dri)n(v)o(e)f(rather)g
(than)h(spinning)f(iron)g(oxide)g(platters.)-2 1078 y
SDict begin H.S end

-2 1078 a -2 1078 a
SDict begin 13 H.A end
 -2 1078 a -2 1078 a
SDict begin [/View [/XYZ H.V]/Dest (0:2608) cvn /DEST pdfmark end
 -2 1078 a Black
396 1210 a Fj(\225)p Black 479 1210 a
SDict begin H.S end
 479 1210 a 479
1210 a
SDict begin 13 H.A end
 479 1210 a 479 1210 a
SDict begin [/View [/XYZ H.V]/Dest (0:2609) cvn /DEST pdfmark end
 479 1210 a Fk(Preallocate)h(the)g(entire)g
(\002le,)h(or)e(allocate)h(in)h(lar)o(ge)e(chunks)g(allo)n(wing)g(the)h
(circular)g(b)n(uf)n(fer)e(to)j(gro)n(w)e(and)h(shrink)f(as)479
1318 y(needed.)g(This)h(a)n(v)n(oids)g(fragmentation)e(and)i(ensures)f
(most)i(reads)f(and)f(writes)i(are)f(contiguous.)-2 1502
y
SDict begin H.S end
 -2 1502 a -2 1502 a
SDict begin 13 H.A end
 -2 1502 a -2 1502 a
SDict begin [/View [/XYZ H.V]/Dest (0:2610) cvn /DEST pdfmark end
 -2 1502 a 396
1592 a Fk(And)g(so)h(on.)e(What)i(I')l(d)e(not)h(recommend)e(is)j
(storing)e(messages)h(in)h(a)f(database,)g(not)g(e)n(v)o(en)f(a)h('f)o
(ast')h(k)o(e)o(y/v)n(alue)d(store,)396 1700 y(unless)j(you)e(really)h
(lik)o(e)g(a)h(speci\002c)f(database)g(and)f(don')o(t)g(ha)n(v)o(e)g
(performance)f(w)o(orries.)h(Y)-9 b(ou)20 b(will)h(pay)f(a)g(steep)h
(price)396 1808 y(for)f(the)g(abstraction,)f(10)h(to)g(1000x)e(o)o(v)o
(er)h(a)i(ra)o(w)f(disk)g(\002le.)-2 1986 y
SDict begin H.S end
 -2 1986 a
-2 1986 a
SDict begin 13 H.A end
 -2 1986 a -2 1986 a
SDict begin [/View [/XYZ H.V]/Dest (0:2611) cvn /DEST pdfmark end
 -2 1986 a 396 2082 a Fk(If)g(you)g(w)o
(ant)g(to)g(mak)o(e)g(T)m(itanic)1337 2082 y
SDict begin H.S end
 1337 2082
a 1337 2082 a
SDict begin 13 H.A end
 1337 2082 a 1337 2082 a
SDict begin [/View [/XYZ H.V]/Dest (0:2612) cvn /DEST pdfmark end
 1337 2082 a Ff(e)o(ven)g(mor)m(e)
g(r)m(eliable)p Fk(,)g(you)f(can)h(do)g(this)g(by)g(duplicating)f
(requests)g(to)i(a)f(second)396 2190 y(serv)o(er)m(,)f(which)h(you')l
(d)e(place)i(in)g(a)h(second)e(location)g(just)i(f)o(ar)f(enough)e(to)j
(survi)n(v)o(e)e(nuclear)g(attack)h(on)f(your)g(primary)396
2297 y(location,)g(yet)h(not)g(so)h(f)o(ar)f(that)g(you)g(get)g(too)g
(much)f(latenc)o(y)-5 b(.)-2 2481 y
SDict begin H.S end
 -2 2481 a -2 2481
a
SDict begin 13 H.A end
 -2 2481 a -2 2481 a
SDict begin [/View [/XYZ H.V]/Dest (0:2613) cvn /DEST pdfmark end
 -2 2481 a 396 2571 a Fk(If)20 b(you)g(w)o(ant)g
(to)g(mak)o(e)g(T)m(itanic)1337 2571 y
SDict begin H.S end
 1337 2571 a 1337
2571 a
SDict begin 13 H.A end
 1337 2571 a 1337 2571 a
SDict begin [/View [/XYZ H.V]/Dest (0:2614) cvn /DEST pdfmark end
 1337 2571 a Ff(muc)o(h)f(faster)i(and)f
(less)h(r)m(eliable)p Fk(,)f(you)f(can)h(store)g(requests)g(and)f
(replies)i(purely)d(in)396 2679 y(memory)-5 b(.)18 b(This)i(will)h(gi)n
(v)o(e)f(you)f(the)h(functionality)e(of)i(a)h(disconnected)d(netw)o
(ork,)h(b)n(ut)h(it)h(w)o(on')o(t)e(survi)n(v)o(e)g(a)i(crash)e(of)396
2787 y(the)h(T)m(itanic)h(serv)o(er)e(itself.)-2 2798
y
SDict begin H.S end
 -2 2798 a -2 2798 a
SDict begin 13 H.A end
 -2 2798 a -2 2798 a
SDict begin [/View [/XYZ H.V]/Dest (0:2615) cvn /DEST pdfmark end
 -2 2798 a 377
x Fn(4.13.)39 b(High-a)n(v)m(ailability)d(P)l(air)i(\(Binar)q(y)h(Star)
g(P)l(attern\))3193 3175 y
SDict begin H.S end
 3193 3175 a 3193 3175 a
SDict begin 22.464 H.A end
 3193
3175 a 3193 3175 a
SDict begin [/View [/XYZ H.V]/Dest (9.67.1) cvn /DEST pdfmark end
 3193 3175 a -2 3207 a
SDict begin H.S end
 -2 3207 a -2
3207 a
SDict begin 13 H.A end
 -2 3207 a -2 3207 a
SDict begin [/View [/XYZ H.V]/Dest (0:2617) cvn /DEST pdfmark end
 -2 3207 a 396 3503 a Fb(4.13.1.)d(Over)q
(vie)n(w)1324 3503 y
SDict begin H.S end
 1324 3503 a 1324 3503 a
SDict begin 18.72 H.A end
 1324 3503
a 1324 3503 a
SDict begin [/View [/XYZ H.V]/Dest (9.67.13.2) cvn /DEST pdfmark end
 1324 3503 a -2 3670 a
SDict begin H.S end
 -2 3670 a -2 3670
a
SDict begin 13 H.A end
 -2 3670 a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:2619) cvn /DEST pdfmark end
 -2 3670 a 396 3777 a Fk(The)20
b(Binary)g(Star)g(pattern)g(puts)g(tw)o(o)g(serv)o(ers)g(in)g(a)h
(primary-backup)16 b(high-a)n(v)n(ailability)i(pair\()p
0 TeXcolorgray 3175 3777 a
SDict begin H.S end
 3175 3777 a Fk(Figure)g(4-6)3523
3777 y
SDict begin 13 H.L end
 3523 3777 a 3523 3777 a
SDict begin [/Subtype /Link/Dest (0:figure-59) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3523 3777 a Black -1 w
Fk(\).)i(At)h(an)o(y)396 3885 y(gi)n(v)o(en)e(time,)g(one)g(of)h(these)
g(accepts)f(connections)f(from)h(client)h(applications)e(\(it)i(is)h
(the)e("master"\))g(and)h(one)f(does)g(not)396 3993 y(\(it)i(is)g(the)f
("sla)n(v)o(e"\).)g(Each)f(serv)o(er)h(monitors)f(the)h(other)-5
b(.)20 b(If)g(the)g(master)g(disappears)f(from)g(the)h(netw)o(ork,)f
(after)h(a)396 4101 y(certain)g(time)g(the)g(sla)n(v)o(e)h(tak)o(es)f
(o)o(v)o(er)f(as)i(master)-5 b(.)-2 4268 y
SDict begin H.S end
 -2 4268 a
-2 4268 a
SDict begin 13 H.A end
 -2 4268 a -2 4268 a
SDict begin [/View [/XYZ H.V]/Dest (0:2621) cvn /DEST pdfmark end
 -2 4268 a 396 4375 a Fk(Binary)20
b(Star)h(pattern)e(w)o(as)i(de)n(v)o(eloped)c(by)j(Pieter)h(Hintjens)f
(and)f(Martin)h(Sustrik)g(for)g(the)g(iMatix)3302 4375
y
SDict begin H.S end
 3302 4375 a 3302 4375 a
SDict begin 13 H.A end
 3302 4375 a 3302 4375 a
SDict begin [/View [/XYZ H.V]/Dest (0:2622) cvn /DEST pdfmark end
 3302
4375 a Fk(OpenAMQ)396 4483 y(serv)o(er)g(\(http://www)-5
b(.openamq.or)o(g)o(\).)14 b(W)-7 b(e)22 b(designed)d(it:)-2
4501 y
SDict begin H.S end
 -2 4501 a -2 4501 a
SDict begin 13 H.A end
 -2 4501 a -2 4501 a
SDict begin [/View [/XYZ H.V]/Dest (0:2623) cvn /DEST pdfmark end
 -2 4501
a -2 4511 a
SDict begin H.S end
 -2 4511 a -2 4511 a
SDict begin 13 H.A end
 -2 4511 a -2 4511 a
SDict begin [/View [/XYZ H.V]/Dest (0:2624) cvn /DEST pdfmark end
 -2
4511 a Black 396 4653 a Fj(\225)p Black 479 4653 a
SDict begin H.S end
 479
4653 a 479 4653 a
SDict begin 13 H.A end
 479 4653 a 479 4653 a
SDict begin [/View [/XYZ H.V]/Dest (0:2625) cvn /DEST pdfmark end
 479 4653 a Fk(T)-7
b(o)21 b(pro)o(vide)d(a)i(straight-forw)o(ard)e(high-a)n(v)n
(ailability)g(solution.)-2 4671 y
SDict begin H.S end
 -2 4671 a -2 4671 a
SDict begin 13 H.A end

-2 4671 a -2 4671 a
SDict begin [/View [/XYZ H.V]/Dest (0:2626) cvn /DEST pdfmark end
 -2 4671 a Black 396 4802 a Fj(\225)p
Black 479 4802 a
SDict begin H.S end
 479 4802 a 479 4802 a
SDict begin 13 H.A end
 479 4802 a 479
4802 a
SDict begin [/View [/XYZ H.V]/Dest (0:2627) cvn /DEST pdfmark end
 479 4802 a Fk(T)-7 b(o)21 b(be)f(simple)g(enough)e(to)i
(actually)g(understand)e(and)i(use.)-2 4820 y
SDict begin H.S end
 -2 4820
a -2 4820 a
SDict begin 13 H.A end
 -2 4820 a -2 4820 a
SDict begin [/View [/XYZ H.V]/Dest (0:2628) cvn /DEST pdfmark end
 -2 4820 a Black 396 4952
a Fj(\225)p Black 479 4952 a
SDict begin H.S end
 479 4952 a 479 4952 a
SDict begin 13 H.A end
 479
4952 a 479 4952 a
SDict begin [/View [/XYZ H.V]/Dest (0:2629) cvn /DEST pdfmark end
 479 4952 a Fk(T)-7 b(o)21 b(f)o(ail-o)o(v)o(er)d
(reliably)h(when)h(needed,)f(and)g(only)h(when)f(needed.)-2
4970 y
SDict begin H.S end
 -2 4970 a -2 4970 a
SDict begin 13 H.A end
 -2 4970 a -2 4970 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-59) cvn /DEST pdfmark
end
 -2 4970
a Black 3759 5569 a Ff(212)p Black eop end
%%Page: 213 226
TeXDict begin 213 225 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.213) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-6.)f(High-a)n(v)o(ailability)e(P)o(air)
-8 b(,)21 b(Normal)f(Operation)-2 172 y
SDict begin H.S end
 -2 172 a -2 172
a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2632) cvn /DEST pdfmark end
 -2 172 a 396 1639 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1639 a @beginspecial
0 @llx -171 @lly 282 @urx 0 @ury 2820 @rwi @setspecial
%%BeginDocument: images/fig59.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -171 282 0
%%HiResBoundingBox: 0.0 -171.0 282.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -68.80017852783203 lineto
94.80017852783203 -68.80017852783203 lineto
94.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
190.80018615722656 -23.800180435180664 moveto
190.80018615722656 -68.80017852783203 lineto
268.8001708984375 -68.80017852783203 lineto
268.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -113.80017852783203 moveto
16.800180435180664 -149.80018615722656 lineto
94.80017852783203 -149.80018615722656 lineto
94.80017852783203 -113.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -67.0 lineto
93.0 -67.0 lineto
93.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -67.0 lineto
93.0 -67.0 lineto
93.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
189.0 -22.0 moveto
189.0 -67.0 lineto
267.0 -67.0 lineto
267.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
189.0 -22.0 moveto
189.0 -67.0 lineto
267.0 -67.0 lineto
267.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -112.0 moveto
15.0 -148.0 lineto
93.0 -148.0 lineto
93.0 -112.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -112.0 moveto
15.0 -148.0 lineto
93.0 -148.0 lineto
93.0 -112.0 lineto
closepath
stroke
newpath
99.0 -40.0 moveto
183.0 -40.0 lineto
stroke
newpath
51.0 -76.0 moveto
51.0 -112.0 lineto
stroke
newpath
102.0 -36.0 moveto
96.0 -40.0 lineto
102.0 -45.0 lineto
closepath
fill
newpath
180.0 -36.0 moveto
186.0 -40.0 lineto
180.0 -45.0 lineto
closepath
fill
newpath
51.0 -72.0 moveto
48.0 -81.0 lineto
54.0 -81.0 lineto
closepath
fill
/Helvetica findfont
9 scalefont setfont
30.0 -44.0 moveto
(Primary) show
30.0 -53.0 moveto
("master") show
210.0 -44.0 moveto
(Backup) show
210.0 -53.0 moveto
("slave") show
40.0 -134.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1639 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1639 a 274 x Fk(Assuming)g(we)g(ha)n(v)o(e)
g(a)h(Binary)e(Star)i(pair)f(running,)d(here)j(are)g(the)g(dif)n
(ferent)f(scenarios)h(that)g(will)h(result)f(in)g(f)o(ail-o)o(v)o(er)
396 2021 y(happening\()p 0 TeXcolorgray 773 2021 a
SDict begin H.S end
 773
2021 a Fk(Figure)c(4-7)1119 2021 y
SDict begin 13 H.L end
 1119 2021 a 1119 2021
a
SDict begin [/Subtype /Link/Dest (0:figure-60) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1119 2021 a Black -1 w Fk(\):)-2 2039 y
SDict begin H.S end
 -2 2039 a -2
2039 a
SDict begin 13 H.A end
 -2 2039 a -2 2039 a
SDict begin [/View [/XYZ H.V]/Dest (0:2637) cvn /DEST pdfmark end
 -2 2039 a -2 2049 a
SDict begin H.S end
 -2 2049
a -2 2049 a
SDict begin 13 H.A end
 -2 2049 a -2 2049 a
SDict begin [/View [/XYZ H.V]/Dest (0:2638) cvn /DEST pdfmark end
 -2 2049 a Black 463 2191
a Fk(1.)p Black 546 2191 a
SDict begin H.S end
 546 2191 a 546 2191 a
SDict begin 13 H.A end
 546
2191 a 546 2191 a
SDict begin [/View [/XYZ H.V]/Dest (0:2639) cvn /DEST pdfmark end
 546 2191 a Fk(The)k(hardw)o(are)e(running)g(the)j
(primary)d(serv)o(er)h(has)i(a)g(f)o(atal)f(problem)e(\(po)n(wer)h
(supply)g(e)o(xplodes,)g(machine)546 2299 y(catches)h(\002re,)g(or)g
(someone)f(simply)h(unplugs)e(it)j(by)f(mistak)o(e\),)g(and)f
(disappears.)g(Applications)g(see)i(this,)f(and)546 2407
y(reconnect)e(to)j(the)f(backup)e(serv)o(er)-5 b(.)-2
2425 y
SDict begin H.S end
 -2 2425 a -2 2425 a
SDict begin 13 H.A end
 -2 2425 a -2 2425 a
SDict begin [/View [/XYZ H.V]/Dest (0:2640) cvn /DEST pdfmark end
 -2 2425
a Black 463 2556 a Fk(2.)p Black 546 2556 a
SDict begin H.S end
 546 2556
a 546 2556 a
SDict begin 13 H.A end
 546 2556 a 546 2556 a
SDict begin [/View [/XYZ H.V]/Dest (0:2641) cvn /DEST pdfmark end
 546 2556 a Fk(The)20
b(netw)o(ork)f(se)o(gment)g(on)h(which)f(the)h(primary)f(serv)o(er)g
(sits)j(crashes)e(-)g(perhaps)f(a)i(router)e(gets)h(hit)h(by)f(a)g(po)n
(wer)546 2664 y(spik)o(e)g(-)g(and)g(applications)f(start)i(to)f
(reconnect)e(to)j(the)f(backup)f(serv)o(er)-5 b(.)-2
2682 y
SDict begin H.S end
 -2 2682 a -2 2682 a
SDict begin 13 H.A end
 -2 2682 a -2 2682 a
SDict begin [/View [/XYZ H.V]/Dest (0:2642) cvn /DEST pdfmark end
 -2 2682
a Black 463 2814 a Fk(3.)p Black 546 2814 a
SDict begin H.S end
 546 2814
a 546 2814 a
SDict begin 13 H.A end
 546 2814 a 546 2814 a
SDict begin [/View [/XYZ H.V]/Dest (0:2643) cvn /DEST pdfmark end
 546 2814 a Fk(The)20
b(primary)e(serv)o(er)h(crashes)i(or)e(is)j(killed)d(by)h(the)g
(operator)f(and)g(does)h(not)g(restart)h(automatically)-5
b(.)-2 2832 y
SDict begin H.S end
 -2 2832 a -2 2832 a
SDict begin 13 H.A end
 -2 2832 a -2 2832 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-60) cvn /DEST pdfmark
end

-2 2832 a 396 3046 a Fg(Figur)o(e)20 b(4-7.)f(High-a)n(v)o(ailability)e
(P)o(air)k(During)f(F)n(ailo)o(v)o(er)-2 3146 y
SDict begin H.S end
 -2 3146
a -2 3146 a
SDict begin 13 H.A end
 -2 3146 a -2 3146 a
SDict begin [/View [/XYZ H.V]/Dest (0:2646) cvn /DEST pdfmark end
 -2 3146 a 396 4612 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate

396 4612 a @beginspecial 0 @llx -171 @lly 282 @urx 0
@ury 2820 @rwi @setspecial
%%BeginDocument: images/fig60.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -171 282 0
%%HiResBoundingBox: 0.0 -171.0 282.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -68.80017852783203 lineto
94.80017852783203 -68.80017852783203 lineto
94.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
190.80018615722656 -23.800180435180664 moveto
190.80018615722656 -68.80017852783203 lineto
268.8001708984375 -68.80017852783203 lineto
268.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -113.80017852783203 moveto
16.800180435180664 -149.80018615722656 lineto
94.80017852783203 -149.80018615722656 lineto
94.80017852783203 -113.80017852783203 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -67.0 lineto
93.0 -67.0 lineto
93.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -67.0 lineto
93.0 -67.0 lineto
93.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
189.0 -22.0 moveto
189.0 -67.0 lineto
267.0 -67.0 lineto
267.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
189.0 -22.0 moveto
189.0 -67.0 lineto
267.0 -67.0 lineto
267.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -112.0 moveto
15.0 -148.0 lineto
93.0 -148.0 lineto
93.0 -112.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -112.0 moveto
15.0 -148.0 lineto
93.0 -148.0 lineto
93.0 -112.0 lineto
closepath
stroke
newpath
99.0 -40.0 moveto
183.0 -40.0 lineto
stroke
newpath
231.0 -76.0 moveto
231.0 -94.0 lineto
51.0 -94.0 lineto
51.0 -112.0 lineto
stroke
newpath
102.0 -36.0 moveto
96.0 -40.0 lineto
102.0 -45.0 lineto
closepath
fill
newpath
180.0 -36.0 moveto
186.0 -40.0 lineto
180.0 -45.0 lineto
closepath
fill
newpath
231.0 -72.0 moveto
228.0 -81.0 lineto
234.0 -81.0 lineto
closepath
fill
/Helvetica findfont
9 scalefont setfont
32.0 -44.0 moveto
(Primary) show
33.0 -53.0 moveto
("slave") show
211.0 -44.0 moveto
(Backup) show
206.0 -53.0 moveto
("master") show
40.0 -134.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4612 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4612 a -2 4779 a
SDict begin H.S end
 -2 4779
a -2 4779 a
SDict begin 13 H.A end
 -2 4779 a -2 4779 a
SDict begin [/View [/XYZ H.V]/Dest (0:2649) cvn /DEST pdfmark end
 -2 4779 a 396 4886 a
Fk(Reco)o(v)o(ery)f(from)g(f)o(ail-o)o(v)o(er)f(w)o(orks)i(as)h(follo)n
(ws:)-2 4904 y
SDict begin H.S end
 -2 4904 a -2 4904 a
SDict begin 13 H.A end
 -2 4904 a -2 4904
a
SDict begin [/View [/XYZ H.V]/Dest (0:2650) cvn /DEST pdfmark end
 -2 4904 a -2 4914 a
SDict begin H.S end
 -2 4914 a -2 4914 a
SDict begin 13 H.A end
 -2 4914 a -2
4914 a
SDict begin [/View [/XYZ H.V]/Dest (0:2651) cvn /DEST pdfmark end
 -2 4914 a Black 463 5057 a Fk(1.)p Black 546 5057
a
SDict begin H.S end
 546 5057 a 546 5057 a
SDict begin 13 H.A end
 546 5057 a 546 5057 a
SDict begin [/View [/XYZ H.V]/Dest (0:2652) cvn /DEST pdfmark end
 546 5057
a Fk(The)e(operators)f(restart)i(the)g(primary)e(serv)o(er)g(and)i
(\002x)f(whate)n(v)o(er)g(problems)f(were)h(causing)g(it)i(to)e
(disappear)g(from)546 5165 y(the)h(netw)o(ork.)-2 5166
y
SDict begin H.S end
 -2 5166 a -2 5166 a
SDict begin 13 H.A end
 -2 5166 a -2 5166 a
SDict begin [/View [/XYZ H.V]/Dest (0:2653) cvn /DEST pdfmark end
 -2 5166 a Black
3759 5569 a Ff(213)p Black eop end
%%Page: 214 227
TeXDict begin 214 226 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.214) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 463 72 a Fk(2.)p Black 546 72 a
SDict begin H.S end
 546 72 a
546 72 a
SDict begin 13 H.A end
 546 72 a 546 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2654) cvn /DEST pdfmark end
 546 72 a Fk(The)e(operators)g(stop)h(the)g
(backup)e(serv)o(er)m(,)h(at)h(a)h(moment)e(that)h(will)g(cause)g
(minimal)g(disruption)e(to)i(applications.)-2 90 y
SDict begin H.S end
 -2
90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:2655) cvn /DEST pdfmark end
 -2 90 a Black 463 222 a
Fk(3.)p Black 546 222 a
SDict begin H.S end
 546 222 a 546 222 a
SDict begin 13 H.A end
 546 222 a
546 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:2656) cvn /DEST pdfmark end
 546 222 a Fk(When)h(applications)f(ha)n(v)o(e)g(reconnected)f
(to)i(the)h(primary)d(serv)o(er)m(,)h(the)h(operators)f(restart)h(the)g
(backup)f(serv)o(er)-5 b(.)-2 406 y
SDict begin H.S end
 -2 406 a -2 406 a
SDict begin 13 H.A end

-2 406 a -2 406 a
SDict begin [/View [/XYZ H.V]/Dest (0:2657) cvn /DEST pdfmark end
 -2 406 a 396 496 a Fk(Reco)o(v)o(ery)19
b(\(to)h(using)f(the)i(primary)d(serv)o(er)h(as)i(master\))f(is)h(a)g
(manual)e(operation.)f(P)o(ainful)h(e)o(xperience)g(teaches)h(us)396
604 y(that)h(automatic)e(reco)o(v)o(ery)e(is)22 b(undesirable.)c(There)
h(are)h(se)n(v)o(eral)g(reasons:)-2 622 y
SDict begin H.S end
 -2 622 a -2
622 a
SDict begin 13 H.A end
 -2 622 a -2 622 a
SDict begin [/View [/XYZ H.V]/Dest (0:2658) cvn /DEST pdfmark end
 -2 622 a -2 632 a
SDict begin H.S end
 -2 632 a -2
632 a
SDict begin 13 H.A end
 -2 632 a -2 632 a
SDict begin [/View [/XYZ H.V]/Dest (0:2659) cvn /DEST pdfmark end
 -2 632 a Black 396 774 a Fj(\225)p
Black 479 774 a
SDict begin H.S end
 479 774 a 479 774 a
SDict begin 13 H.A end
 479 774 a 479 774
a
SDict begin [/View [/XYZ H.V]/Dest (0:2660) cvn /DEST pdfmark end
 479 774 a Fk(F)o(ailo)o(v)o(er)f(creates)h(an)g(interruption)e(of)i
(service)g(to)g(applications,)f(possibly)h(lasting)g(10-30)e(seconds.)i
(If)g(there)f(is)i(a)479 882 y(real)f(emer)o(genc)o(y)-5
b(,)17 b(this)k(is)g(much)e(better)h(than)g(total)g(outage.)f(But)i(if)
f(reco)o(v)o(ery)e(creates)i(a)h(further)d(10-30)h(second)479
990 y(outage,)g(it)i(is)g(better)f(that)g(this)h(happens)e(of)n
(f-peak,)e(when)j(users)g(ha)n(v)o(e)g(gone)f(of)n(f)h(the)g(netw)o
(ork.)-2 1008 y
SDict begin H.S end
 -2 1008 a -2 1008 a
SDict begin 13 H.A end
 -2 1008 a -2 1008
a
SDict begin [/View [/XYZ H.V]/Dest (0:2661) cvn /DEST pdfmark end
 -2 1008 a Black 396 1139 a Fj(\225)p Black 479 1139
a
SDict begin H.S end
 479 1139 a 479 1139 a
SDict begin 13 H.A end
 479 1139 a 479 1139 a
SDict begin [/View [/XYZ H.V]/Dest (0:2662) cvn /DEST pdfmark end
 479 1139
a Fk(When)g(there)g(is)h(an)f(emer)o(genc)o(y)-5 b(,)17
b(it')-5 b(s)21 b(a)g(Good)e(Idea)h(to)g(create)g(predictability)e(for)
i(those)g(trying)f(to)h(\002x)h(things.)479 1247 y(Automatic)f(reco)o
(v)o(ery)d(creates)j(uncertainty)f(for)g(system)i(admins,)e(who)h(can)g
(no)g(longer)e(be)j(sure)f(which)f(serv)o(er)h(is)479
1355 y(in)h(char)o(ge)d(without)i(double-checking.)-2
1373 y
SDict begin H.S end
 -2 1373 a -2 1373 a
SDict begin 13 H.A end
 -2 1373 a -2 1373 a
SDict begin [/View [/XYZ H.V]/Dest (0:2663) cvn /DEST pdfmark end
 -2 1373
a Black 396 1505 a Fj(\225)p Black 479 1505 a
SDict begin H.S end
 479 1505
a 479 1505 a
SDict begin 13 H.A end
 479 1505 a 479 1505 a
SDict begin [/View [/XYZ H.V]/Dest (0:2664) cvn /DEST pdfmark end
 479 1505 a Fk(Last,)h(you)e(can)h
(get)g(situations)g(with)h(automatic)e(reco)o(v)o(ery)f(where)h(netw)o
(orks)g(will)i(f)o(ail)g(o)o(v)o(er)m(,)d(and)i(then)g(reco)o(v)o(er)m
(,)479 1613 y(and)g(operators)f(are)h(then)f(placed)h(in)g(a)h(dif)n
(\002cult)e(position)h(to)g(analyze)f(what)i(happened.)c(There)j(w)o
(as)h(an)479 1720 y(interruption)d(of)i(service,)g(b)n(ut)g(the)g
(cause)g(isn')o(t)g(clear)-5 b(.)-2 1904 y
SDict begin H.S end
 -2 1904 a
-2 1904 a
SDict begin 13 H.A end
 -2 1904 a -2 1904 a
SDict begin [/View [/XYZ H.V]/Dest (0:2665) cvn /DEST pdfmark end
 -2 1904 a 396 1994 a Fk(Ha)n(ving)20
b(said)g(this,)h(the)f(Binary)g(Star)g(pattern)g(will)g(f)o(ail)h(back)
f(to)g(the)g(primary)f(serv)o(er)g(if)h(this)h(is)g(running)d
(\(again\))h(and)396 2102 y(the)h(backup)f(serv)o(er)g(f)o(ails.)i(In)f
(f)o(act)g(this)h(is)g(ho)n(w)f(we)g(pro)o(v)n(ok)o(e)e(reco)o(v)o(ery)
-5 b(.)-2 2286 y
SDict begin H.S end
 -2 2286 a -2 2286 a
SDict begin 13 H.A end
 -2 2286 a -2 2286
a
SDict begin [/View [/XYZ H.V]/Dest (0:2666) cvn /DEST pdfmark end
 -2 2286 a 396 2376 a Fk(The)20 b(shutdo)n(wn)f(process)g(for)h(a)h
(Binary)e(Star)i(pair)f(is)h(to)f(either:)-2 2394 y
SDict begin H.S end
 -2
2394 a -2 2394 a
SDict begin 13 H.A end
 -2 2394 a -2 2394 a
SDict begin [/View [/XYZ H.V]/Dest (0:2667) cvn /DEST pdfmark end
 -2 2394 a -2 2404
a
SDict begin H.S end
 -2 2404 a -2 2404 a
SDict begin 13 H.A end
 -2 2404 a -2 2404 a
SDict begin [/View [/XYZ H.V]/Dest (0:2668) cvn /DEST pdfmark end
 -2 2404 a Black
463 2547 a Fk(1.)p Black 546 2547 a
SDict begin H.S end
 546 2547 a 546 2547
a
SDict begin 13 H.A end
 546 2547 a 546 2547 a
SDict begin [/View [/XYZ H.V]/Dest (0:2669) cvn /DEST pdfmark end
 546 2547 a Fk(Stop)g(the)g(passi)n(v)o(e)g
(serv)o(er)f(and)h(then)f(stop)i(the)f(acti)n(v)o(e)g(serv)o(er)f(at)i
(an)o(y)e(later)h(time,)g(or)-2 2565 y
SDict begin H.S end
 -2 2565 a -2 2565
a
SDict begin 13 H.A end
 -2 2565 a -2 2565 a
SDict begin [/View [/XYZ H.V]/Dest (0:2670) cvn /DEST pdfmark end
 -2 2565 a Black 463 2696 a Fk(2.)p
Black 546 2696 a
SDict begin H.S end
 546 2696 a 546 2696 a
SDict begin 13 H.A end
 546 2696 a 546
2696 a
SDict begin [/View [/XYZ H.V]/Dest (0:2671) cvn /DEST pdfmark end
 546 2696 a Fk(Stop)g(both)f(serv)o(ers)h(in)g(an)o(y)f(order)g
(b)n(ut)i(within)f(a)g(fe)n(w)g(seconds)g(of)g(each)g(other)-5
b(.)-2 2880 y
SDict begin H.S end
 -2 2880 a -2 2880 a
SDict begin 13 H.A end
 -2 2880 a -2 2880 a
SDict begin [/View [/XYZ H.V]/Dest (0:2672) cvn /DEST pdfmark end

-2 2880 a 396 2970 a Fk(Stopping)19 b(the)h(acti)n(v)o(e)g(and)f(then)h
(the)g(passi)n(v)o(e)g(serv)o(er)g(with)g(an)o(y)f(delay)h(longer)f
(than)g(the)i(f)o(ail-o)o(v)o(er)d(timeout)h(will)396
3078 y(cause)h(applications)f(to)i(disconnect,)d(then)i(reconnect,)e
(then)i(disconnect)f(again,)g(which)g(may)h(disturb)g(users.)-2
3106 y
SDict begin H.S end
 -2 3106 a -2 3106 a
SDict begin 13 H.A end
 -2 3106 a -2 3106 a
SDict begin [/View [/XYZ H.V]/Dest (0:2673) cvn /DEST pdfmark end
 -2 3106
a 396 3416 a Fb(4.13.2.)36 b(Detailed)f(Requirements)2088
3416 y
SDict begin H.S end
 2088 3416 a 2088 3416 a
SDict begin 18.72 H.A end
 2088 3416 a 2088 3416
a
SDict begin [/View [/XYZ H.V]/Dest (9.67.14.2) cvn /DEST pdfmark end
 2088 3416 a -2 3607 a
SDict begin H.S end
 -2 3607 a -2 3607 a
SDict begin 13 H.A end
 -2 3607 a
-2 3607 a
SDict begin [/View [/XYZ H.V]/Dest (0:2675) cvn /DEST pdfmark end
 -2 3607 a 396 3690 a Fk(Binary)20 b(Star)h(is)g(as)g(simple)f
(as)h(it)g(can)f(be,)f(while)i(still)g(w)o(orking)e(accurately)-5
b(.)18 b(In)i(f)o(act)g(the)g(current)f(design)h(is)h(the)f(third)396
3798 y(complete)f(redesign.)g(Each)h(of)g(the)g(pre)n(vious)f(designs)g
(we)i(found)d(to)j(be)f(too)g(comple)o(x,)e(trying)h(to)h(do)g(too)g
(much,)f(and)396 3906 y(we)i(stripped)e(out)h(functionality)e(until)i
(we)h(came)f(to)g(a)g(design)g(that)g(w)o(as)h(understandable)d(and)h
(use,)h(and)g(reliable)396 4014 y(enough)e(to)j(be)f(w)o(orth)g(using.)
-2 4198 y
SDict begin H.S end
 -2 4198 a -2 4198 a
SDict begin 13 H.A end
 -2 4198 a -2 4198 a
SDict begin [/View [/XYZ H.V]/Dest (0:2676) cvn /DEST pdfmark end
 -2
4198 a 396 4288 a Fk(These)g(are)g(our)g(requirements)e(for)i(a)g
(high-a)n(v)n(ailability)e(architecture:)-2 4306 y
SDict begin H.S end
 -2
4306 a -2 4306 a
SDict begin 13 H.A end
 -2 4306 a -2 4306 a
SDict begin [/View [/XYZ H.V]/Dest (0:2677) cvn /DEST pdfmark end
 -2 4306 a -2 4316
a
SDict begin H.S end
 -2 4316 a -2 4316 a
SDict begin 13 H.A end
 -2 4316 a -2 4316 a
SDict begin [/View [/XYZ H.V]/Dest (0:2678) cvn /DEST pdfmark end
 -2 4316 a Black
396 4458 a Fj(\225)p Black 479 4458 a
SDict begin H.S end
 479 4458 a 479
4458 a
SDict begin 13 H.A end
 479 4458 a 479 4458 a
SDict begin [/View [/XYZ H.V]/Dest (0:2679) cvn /DEST pdfmark end
 479 4458 a Fk(The)i(f)o(ail-o)o(v)o(er)e
(is)k(meant)d(to)i(pro)o(vide)d(insurance)h(against)g(catastrophic)g
(system)h(f)o(ailures,)g(such)g(as)h(hardw)o(are)479
4566 y(breakdo)n(wn,)d(\002re,)i(accident,)f(etc.)h(T)-7
b(o)21 b(guard)d(against)i(ordinary)e(serv)o(er)h(crashes)h(there)g
(are)g(simpler)g(w)o(ays)h(to)479 4674 y(reco)o(v)o(er)-5
b(.)-2 4675 y
SDict begin H.S end
 -2 4675 a -2 4675 a
SDict begin 13 H.A end
 -2 4675 a -2 4675 a
SDict begin [/View [/XYZ H.V]/Dest (0:2680) cvn /DEST pdfmark end

-2 4675 a Black 396 4824 a Fj(\225)p Black 479 4824 a
SDict begin H.S end

479 4824 a 479 4824 a
SDict begin 13 H.A end
 479 4824 a 479 4824 a
SDict begin [/View [/XYZ H.V]/Dest (0:2681) cvn /DEST pdfmark end
 479 4824
a Fk(F)o(ailo)o(v)o(er)19 b(time)h(should)g(be)g(under)e(60)i(seconds)g
(and)f(preferably)f(under)h(10)h(seconds.)-2 4842 y
SDict begin H.S end
 -2
4842 a -2 4842 a
SDict begin 13 H.A end
 -2 4842 a -2 4842 a
SDict begin [/View [/XYZ H.V]/Dest (0:2682) cvn /DEST pdfmark end
 -2 4842 a Black
396 4973 a Fj(\225)p Black 479 4973 a
SDict begin H.S end
 479 4973 a 479
4973 a
SDict begin 13 H.A end
 479 4973 a 479 4973 a
SDict begin [/View [/XYZ H.V]/Dest (0:2683) cvn /DEST pdfmark end
 479 4973 a Fk(F)o(ailo)o(v)o(er)f(has)h
(to)h(happen)d(automatically)-5 b(,)18 b(whereas)i(reco)o(v)o(er)e
(must)i(happen)f(manually)-5 b(.)18 b(W)-7 b(e)21 b(w)o(ant)g
(applications)e(to)479 5081 y(switch)i(o)o(v)o(er)e(to)h(the)g(backup)f
(serv)o(er)g(automatically)g(b)n(ut)h(we)g(do)g(not)g(w)o(ant)g(them)g
(to)h(switch)f(back)g(to)g(the)g(primary)p Black 3759
5569 a Ff(214)p Black eop end
%%Page: 215 228
TeXDict begin 215 227 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.215) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2728) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 479 72 a Fk(serv)o(er)g(e)o(xcept)f(when)g(the)i(operators)d(ha)n
(v)o(e)i(\002x)o(ed)f(whate)n(v)o(er)g(problem)g(there)g(w)o(as,)i(and)
f(decided)f(that)h(it)h(is)g(a)g(good)479 180 y(time)g(to)f(interrupt)f
(applications)g(again.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2
198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:2684) cvn /DEST pdfmark end
 -2 198 a Black 396 330 a Fj(\225)p Black
479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:2685) cvn /DEST pdfmark end
 479
330 a Fk(The)h(semantics)g(for)g(client)g(applications)f(should)g(be)h
(simple)h(and)e(easy)i(for)e(de)n(v)o(elopers)f(to)i(understand.)e
(Ideally)479 438 y(the)o(y)i(should)f(be)h(hidden)f(in)h(the)g(client)h
(API.)-2 456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456 a -2 456 a
SDict begin [/View [/XYZ H.V]/Dest (0:2686) cvn /DEST pdfmark end
 -2
456 a Black 396 587 a Fj(\225)p Black 479 587 a
SDict begin H.S end
 479 587
a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:2687) cvn /DEST pdfmark end
 479 587 a Fk(There)f(should)f(be)h
(clear)g(instructions)f(for)h(netw)o(ork)f(architects)h(on)f(ho)n(w)h
(to)g(a)n(v)n(oid)g(designs)g(that)g(could)g(lead)g(to)479
695 y(split)h(brain)e(syndrome)g(in)h(which)g(both)f(serv)o(ers)h(in)g
(a)h(Binary)e(Star)i(pair)f(think)f(the)o(y)h(are)g(the)g(master)g
(serv)o(er)-5 b(.)-2 713 y
SDict begin H.S end
 -2 713 a -2 713 a
SDict begin 13 H.A end
 -2 713 a
-2 713 a
SDict begin [/View [/XYZ H.V]/Dest (0:2688) cvn /DEST pdfmark end
 -2 713 a Black 396 845 a Fj(\225)p Black 479
845 a
SDict begin H.S end
 479 845 a 479 845 a
SDict begin 13 H.A end
 479 845 a 479 845 a
SDict begin [/View [/XYZ H.V]/Dest (0:2689) cvn /DEST pdfmark end
 479 845
a Fk(There)20 b(should)f(be)h(no)g(dependencies)e(on)h(the)i(order)e
(in)h(which)g(the)g(tw)o(o)g(serv)o(ers)g(are)g(started.)-2
863 y
SDict begin H.S end
 -2 863 a -2 863 a
SDict begin 13 H.A end
 -2 863 a -2 863 a
SDict begin [/View [/XYZ H.V]/Dest (0:2690) cvn /DEST pdfmark end
 -2 863 a Black
396 994 a Fj(\225)p Black 479 994 a
SDict begin H.S end
 479 994 a 479 994
a
SDict begin 13 H.A end
 479 994 a 479 994 a
SDict begin [/View [/XYZ H.V]/Dest (0:2691) cvn /DEST pdfmark end
 479 994 a Fk(It)h(must)f(be)g(possible)g(to)g
(mak)o(e)g(planned)f(stops)h(and)g(restarts)g(of)g(either)g(serv)o(er)f
(without)h(stopping)f(client)479 1102 y(applications)g(\(though)f(the)o
(y)i(may)g(be)g(forced)e(to)j(reconnect\).)-2 1120 y
SDict begin H.S end

-2 1120 a -2 1120 a
SDict begin 13 H.A end
 -2 1120 a -2 1120 a
SDict begin [/View [/XYZ H.V]/Dest (0:2692) cvn /DEST pdfmark end
 -2 1120 a Black
396 1251 a Fj(\225)p Black 479 1251 a
SDict begin H.S end
 479 1251 a 479
1251 a
SDict begin 13 H.A end
 479 1251 a 479 1251 a
SDict begin [/View [/XYZ H.V]/Dest (0:2693) cvn /DEST pdfmark end
 479 1251 a Fk(Operators)e(must)i(be)f
(able)g(to)g(monitor)f(both)g(serv)o(ers)h(at)h(all)f(times.)-2
1269 y
SDict begin H.S end
 -2 1269 a -2 1269 a
SDict begin 13 H.A end
 -2 1269 a -2 1269 a
SDict begin [/View [/XYZ H.V]/Dest (0:2694) cvn /DEST pdfmark end
 -2 1269
a Black 396 1401 a Fj(\225)p Black 479 1401 a
SDict begin H.S end
 479 1401
a 479 1401 a
SDict begin 13 H.A end
 479 1401 a 479 1401 a
SDict begin [/View [/XYZ H.V]/Dest (0:2695) cvn /DEST pdfmark end
 479 1401 a Fk(It)h(must)f(be)g
(possible)g(to)g(connect)f(the)i(tw)o(o)f(serv)o(ers)g(using)f(a)i
(high-speed)d(dedicated)h(netw)o(ork)g(connection.)f(That)479
1509 y(is,)j(f)o(ail-o)o(v)o(er)d(synchronization)g(must)i(be)g(able)g
(to)g(use)h(a)f(speci\002c)h(IP)f(route.)-2 1693 y
SDict begin H.S end
 -2
1693 a -2 1693 a
SDict begin 13 H.A end
 -2 1693 a -2 1693 a
SDict begin [/View [/XYZ H.V]/Dest (0:2696) cvn /DEST pdfmark end
 -2 1693 a 396 1783
a Fk(W)-7 b(e)22 b(mak)o(e)d(these)i(assumptions:)-2
1801 y
SDict begin H.S end
 -2 1801 a -2 1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:2697) cvn /DEST pdfmark end
 -2 1801
a -2 1811 a
SDict begin H.S end
 -2 1811 a -2 1811 a
SDict begin 13 H.A end
 -2 1811 a -2 1811 a
SDict begin [/View [/XYZ H.V]/Dest (0:2698) cvn /DEST pdfmark end
 -2
1811 a Black 396 1953 a Fj(\225)p Black 479 1953 a
SDict begin H.S end
 479
1953 a 479 1953 a
SDict begin 13 H.A end
 479 1953 a 479 1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:2699) cvn /DEST pdfmark end
 479 1953 a Fk(A)g(single)f
(backup)f(serv)o(er)g(pro)o(vides)f(enough)h(insurance,)f(we)j(don')o
(t)d(need)i(multiple)f(le)n(v)o(els)h(of)g(backup.)-2
1971 y
SDict begin H.S end
 -2 1971 a -2 1971 a
SDict begin 13 H.A end
 -2 1971 a -2 1971 a
SDict begin [/View [/XYZ H.V]/Dest (0:2700) cvn /DEST pdfmark end
 -2 1971
a Black 396 2102 a Fj(\225)p Black 479 2102 a
SDict begin H.S end
 479 2102
a 479 2102 a
SDict begin 13 H.A end
 479 2102 a 479 2102 a
SDict begin [/View [/XYZ H.V]/Dest (0:2701) cvn /DEST pdfmark end
 479 2102 a Fk(The)g(primary)f(and)g
(backup)g(serv)o(ers)h(are)g(equally)f(capable)g(of)h(carrying)e(the)j
(application)d(load.)i(W)-7 b(e)21 b(do)f(not)479 2210
y(attempt)g(to)g(balance)g(load)f(across)i(the)f(serv)o(ers.)-2
2228 y
SDict begin H.S end
 -2 2228 a -2 2228 a
SDict begin 13 H.A end
 -2 2228 a -2 2228 a
SDict begin [/View [/XYZ H.V]/Dest (0:2702) cvn /DEST pdfmark end
 -2 2228
a Black 396 2360 a Fj(\225)p Black 479 2360 a
SDict begin H.S end
 479 2360
a 479 2360 a
SDict begin 13 H.A end
 479 2360 a 479 2360 a
SDict begin [/View [/XYZ H.V]/Dest (0:2703) cvn /DEST pdfmark end
 479 2360 a Fk(There)g(is)h(suf)n
(\002cient)e(b)n(udget)h(to)g(co)o(v)o(er)f(a)h(fully)g(redundant)d
(backup)i(serv)o(er)g(that)i(does)f(nothing)e(almost)i(all)h(the)479
2468 y(time.)-2 2635 y
SDict begin H.S end
 -2 2635 a -2 2635 a
SDict begin 13 H.A end
 -2 2635 a
-2 2635 a
SDict begin [/View [/XYZ H.V]/Dest (0:2704) cvn /DEST pdfmark end
 -2 2635 a 396 2742 a Fk(W)-7 b(e)22 b(don')o(t)c(attempt)i
(to)g(co)o(v)o(er:)-2 2760 y
SDict begin H.S end
 -2 2760 a -2 2760 a
SDict begin 13 H.A end
 -2 2760
a -2 2760 a
SDict begin [/View [/XYZ H.V]/Dest (0:2705) cvn /DEST pdfmark end
 -2 2760 a -2 2770 a
SDict begin H.S end
 -2 2770 a -2 2770 a
SDict begin 13 H.A end
 -2
2770 a -2 2770 a
SDict begin [/View [/XYZ H.V]/Dest (0:2706) cvn /DEST pdfmark end
 -2 2770 a Black 396 2912 a Fj(\225)p
Black 479 2912 a
SDict begin H.S end
 479 2912 a 479 2912 a
SDict begin 13 H.A end
 479 2912 a 479
2912 a
SDict begin [/View [/XYZ H.V]/Dest (0:2707) cvn /DEST pdfmark end
 479 2912 a Fk(The)g(use)h(of)e(an)i(acti)n(v)o(e)e(backup)g
(serv)o(er)g(or)h(load)g(balancing.)e(In)i(a)h(Binary)e(Star)i(pair)m
(,)e(the)h(backup)f(serv)o(er)g(is)479 3020 y(inacti)n(v)o(e)h(and)f
(does)h(no)g(useful)g(w)o(ork)f(until)h(the)g(primary)f(serv)o(er)g
(goes)h(of)n(f-line.)-2 3038 y
SDict begin H.S end
 -2 3038 a -2 3038 a
SDict begin 13 H.A end
 -2
3038 a -2 3038 a
SDict begin [/View [/XYZ H.V]/Dest (0:2708) cvn /DEST pdfmark end
 -2 3038 a Black 396 3169 a Fj(\225)p
Black 479 3169 a
SDict begin H.S end
 479 3169 a 479 3169 a
SDict begin 13 H.A end
 479 3169 a 479
3169 a
SDict begin [/View [/XYZ H.V]/Dest (0:2709) cvn /DEST pdfmark end
 479 3169 a Fk(The)g(handling)e(of)i(persistent)g(messages)h(or)f
(transactions)f(in)h(an)o(y)g(w)o(ay)-5 b(.)19 b(W)-7
b(e)22 b(assuming)d(a)i(netw)o(ork)e(of)h(unreliable)479
3277 y(\(and)g(probably)d(untrusted\))i(serv)o(ers)g(or)h(Binary)g
(Star)h(pairs.)-2 3295 y
SDict begin H.S end
 -2 3295 a -2 3295 a
SDict begin 13 H.A end
 -2 3295
a -2 3295 a
SDict begin [/View [/XYZ H.V]/Dest (0:2710) cvn /DEST pdfmark end
 -2 3295 a Black 396 3427 a Fj(\225)p Black
479 3427 a
SDict begin H.S end
 479 3427 a 479 3427 a
SDict begin 13 H.A end
 479 3427 a 479 3427
a
SDict begin [/View [/XYZ H.V]/Dest (0:2711) cvn /DEST pdfmark end
 479 3427 a Fk(An)o(y)f(automatic)f(e)o(xploration)f(of)i(the)g(netw)o
(ork.)e(The)i(Binary)g(Star)h(pair)e(is)j(manually)c(and)i(e)o
(xplicitly)f(de\002ned)g(in)479 3534 y(the)h(netw)o(ork)f(and)h(is)h
(kno)n(wn)e(to)h(applications)f(\(at)i(least)g(in)f(their)g
(con\002guration)d(data\).)-2 3552 y
SDict begin H.S end
 -2 3552 a -2 3552
a
SDict begin 13 H.A end
 -2 3552 a -2 3552 a
SDict begin [/View [/XYZ H.V]/Dest (0:2712) cvn /DEST pdfmark end
 -2 3552 a Black 396 3684 a Fj(\225)p
Black 479 3684 a
SDict begin H.S end
 479 3684 a 479 3684 a
SDict begin 13 H.A end
 479 3684 a 479
3684 a
SDict begin [/View [/XYZ H.V]/Dest (0:2713) cvn /DEST pdfmark end
 479 3684 a Fk(Replication)j(of)g(state)h(or)f(messages)g
(between)f(serv)o(ers.)h(All)h(serv)o(er)n(-side)e(state)i(much)e(be)h
(recreated)f(by)479 3792 y(applications)g(when)h(the)o(y)f(f)o(ail)i(o)
o(v)o(er)-5 b(.)-2 3976 y
SDict begin H.S end
 -2 3976 a -2 3976 a
SDict begin 13 H.A end
 -2 3976
a -2 3976 a
SDict begin [/View [/XYZ H.V]/Dest (0:2714) cvn /DEST pdfmark end
 -2 3976 a 396 4066 a Fk(Here)20 b(is)h(the)g(k)o(e)o(y)e
(terminology)f(we)i(use)h(in)f(Binary)g(Star:)-2 4084
y
SDict begin H.S end
 -2 4084 a -2 4084 a
SDict begin 13 H.A end
 -2 4084 a -2 4084 a
SDict begin [/View [/XYZ H.V]/Dest (0:2715) cvn /DEST pdfmark end
 -2 4084 a -2
4094 a
SDict begin H.S end
 -2 4094 a -2 4094 a
SDict begin 13 H.A end
 -2 4094 a -2 4094 a
SDict begin [/View [/XYZ H.V]/Dest (0:2716) cvn /DEST pdfmark end
 -2 4094
a Black 396 4236 a Fj(\225)p Black 479 4236 a
SDict begin H.S end
 479 4236
a 479 4236 a
SDict begin 13 H.A end
 479 4236 a 479 4236 a
SDict begin [/View [/XYZ H.V]/Dest (0:2717) cvn /DEST pdfmark end
 479 4236 a 479 4236
a
SDict begin H.S end
 479 4236 a 479 4236 a
SDict begin 13 H.A end
 479 4236 a 479 4236 a
SDict begin [/View [/XYZ H.V]/Dest (0:2718) cvn /DEST pdfmark end
 479 4236
a Fg(Primary)g Fk(-)g(the)g(primary)f(serv)o(er)g(is)i(the)g(one)e
(that)i(is)g(normally)d('master'.)-2 4254 y
SDict begin H.S end
 -2 4254 a
-2 4254 a
SDict begin 13 H.A end
 -2 4254 a -2 4254 a
SDict begin [/View [/XYZ H.V]/Dest (0:2719) cvn /DEST pdfmark end
 -2 4254 a Black 396 4385
a Fj(\225)p Black 479 4385 a
SDict begin H.S end
 479 4385 a 479 4385 a
SDict begin 13 H.A end
 479
4385 a 479 4385 a
SDict begin [/View [/XYZ H.V]/Dest (0:2720) cvn /DEST pdfmark end
 479 4385 a 479 4385 a
SDict begin H.S end
 479 4385 a 479
4385 a
SDict begin 13 H.A end
 479 4385 a 479 4385 a
SDict begin [/View [/XYZ H.V]/Dest (0:2721) cvn /DEST pdfmark end
 479 4385 a Fg(Backup)j Fk(-)g(the)f
(backup)e(serv)o(er)i(is)h(the)f(one)g(that)g(is)h(normally)e(')-5
b(sla)n(v)o(e',)20 b(it)h(will)f(become)f(master)h(if)h(and)f(when)f
(the)479 4493 y(primary)g(serv)o(er)g(disappears)g(from)h(the)g(netw)o
(ork,)f(and)g(when)h(client)g(applications)f(ask)h(the)h(backup)d(serv)
o(er)h(to)479 4601 y(connect.)-2 4602 y
SDict begin H.S end
 -2 4602 a -2
4602 a
SDict begin 13 H.A end
 -2 4602 a -2 4602 a
SDict begin [/View [/XYZ H.V]/Dest (0:2722) cvn /DEST pdfmark end
 -2 4602 a Black 396 4751 a
Fj(\225)p Black 479 4751 a
SDict begin H.S end
 479 4751 a 479 4751 a
SDict begin 13 H.A end
 479
4751 a 479 4751 a
SDict begin [/View [/XYZ H.V]/Dest (0:2723) cvn /DEST pdfmark end
 479 4751 a 479 4751 a
SDict begin H.S end
 479 4751 a 479
4751 a
SDict begin 13 H.A end
 479 4751 a 479 4751 a
SDict begin [/View [/XYZ H.V]/Dest (0:2724) cvn /DEST pdfmark end
 479 4751 a Fg(Master)i Fk(-)f(the)g
(master)g(serv)o(er)g(is)h(the)f(one)g(of)g(a)g(Binary)g(Star)g(pair)g
(that)h(accepts)f(client)g(connections.)e(There)h(is)i(at)479
4859 y(most)g(one)e(master)h(serv)o(er)-5 b(.)-2 4860
y
SDict begin H.S end
 -2 4860 a -2 4860 a
SDict begin 13 H.A end
 -2 4860 a -2 4860 a
SDict begin [/View [/XYZ H.V]/Dest (0:2725) cvn /DEST pdfmark end
 -2 4860 a Black
3759 5569 a Ff(215)p Black eop end
%%Page: 216 229
TeXDict begin 216 228 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.216) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2726) cvn /DEST pdfmark end
 479 72 a 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:2727) cvn /DEST pdfmark end
 479 72 a Fg(Sla)n(v)o(e)g
Fk(-)h(the)f(sla)n(v)o(e)g(serv)o(er)g(is)h(the)f(one)g(that)g(tak)o
(es)g(o)o(v)o(er)f(if)i(the)f(master)g(disappears.)f(Note)h(that)g
(when)g(a)h(Binary)479 180 y(Star)g(pair)f(is)h(running)d(normally)-5
b(,)18 b(the)i(primary)f(serv)o(er)g(is)i(master)m(,)f(and)f(the)h
(backup)f(is)i(sla)n(v)o(e.)f(When)g(a)h(f)o(ail-o)o(v)o(er)479
288 y(has)g(happened,)c(the)k(roles)f(are)g(switched.)396
562 y(T)-7 b(o)21 b(con\002gure)d(a)j(Binary)e(Star)i(pair)m(,)e(you)g
(need)h(to:)-2 580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580
a
SDict begin [/View [/XYZ H.V]/Dest (0:2729) cvn /DEST pdfmark end
 -2 580 a -2 590 a
SDict begin H.S end
 -2 590 a -2 590 a
SDict begin 13 H.A end
 -2 590 a -2 590
a
SDict begin [/View [/XYZ H.V]/Dest (0:2730) cvn /DEST pdfmark end
 -2 590 a Black 463 733 a Fk(1.)p Black 546 733 a
SDict begin H.S end
 546
733 a 546 733 a
SDict begin 13 H.A end
 546 733 a 546 733 a
SDict begin [/View [/XYZ H.V]/Dest (0:2731) cvn /DEST pdfmark end
 546 733 a Fk(T)-6
b(ell)20 b(the)h(primary)d(serv)o(er)i(where)f(the)h(backup)f(serv)o
(er)g(is.)-2 750 y
SDict begin H.S end
 -2 750 a -2 750 a
SDict begin 13 H.A end
 -2 750 a -2 750
a
SDict begin [/View [/XYZ H.V]/Dest (0:2732) cvn /DEST pdfmark end
 -2 750 a Black 463 882 a Fk(2.)p Black 546 882 a
SDict begin H.S end
 546
882 a 546 882 a
SDict begin 13 H.A end
 546 882 a 546 882 a
SDict begin [/View [/XYZ H.V]/Dest (0:2733) cvn /DEST pdfmark end
 546 882 a Fk(T)-6
b(ell)20 b(the)h(backup)d(serv)o(er)h(where)h(the)g(primary)f(serv)o
(er)g(is.)-2 900 y
SDict begin H.S end
 -2 900 a -2 900 a
SDict begin 13 H.A end
 -2 900 a -2 900
a
SDict begin [/View [/XYZ H.V]/Dest (0:2734) cvn /DEST pdfmark end
 -2 900 a Black 463 1031 a Fk(3.)p Black 546 1031 a
SDict begin H.S end

546 1031 a 546 1031 a
SDict begin 13 H.A end
 546 1031 a 546 1031 a
SDict begin [/View [/XYZ H.V]/Dest (0:2735) cvn /DEST pdfmark end
 546 1031
a Fk(Optionally)-5 b(,)18 b(tune)i(the)g(f)o(ail-o)o(v)o(er)e(response)
h(times,)i(which)f(must)g(be)g(the)g(same)g(for)g(both)f(serv)o(ers.)-2
1215 y
SDict begin H.S end
 -2 1215 a -2 1215 a
SDict begin 13 H.A end
 -2 1215 a -2 1215 a
SDict begin [/View [/XYZ H.V]/Dest (0:2736) cvn /DEST pdfmark end
 -2 1215
a 396 1305 a Fk(The)h(main)g(tuning)f(concern)f(is)k(ho)n(w)d
(frequently)f(you)h(w)o(ant)i(the)f(serv)o(ers)g(to)g(check)f(their)h
(peering)f(status,)i(and)e(ho)n(w)396 1413 y(quickly)g(you)g(w)o(ant)i
(to)f(acti)n(v)n(ate)g(f)o(ail-o)o(v)o(er)-5 b(.)18 b(In)i(our)g(e)o
(xample,)e(the)i(f)o(ail-o)o(v)o(er)f(timeout)g(v)n(alue)h(def)o(aults)
f(to)i(2000)e(msec.)396 1521 y(If)h(you)g(reduce)f(this,)h(the)g
(backup)f(serv)o(er)g(will)i(tak)o(e)f(o)o(v)o(er)f(as)i(master)f(more)
f(rapidly)g(b)n(ut)i(may)e(tak)o(e)i(o)o(v)o(er)d(in)j(cases)396
1629 y(where)f(the)g(primary)f(serv)o(er)g(could)g(reco)o(v)o(er)-5
b(.)19 b(Y)-9 b(ou)19 b(may)h(for)f(e)o(xample)g(ha)n(v)o(e)h(wrapped)e
(the)j(primary)d(serv)o(er)i(in)g(a)h(shell)396 1737
y(script)f(that)h(restarts)f(it)h(if)g(it)g(crashes.)e(In)h(that)h
(case)f(the)g(timeout)g(should)f(be)h(higher)f(than)h(the)g(time)g
(needed)f(to)i(restart)396 1845 y(the)f(primary)f(serv)o(er)-5
b(.)-2 2029 y
SDict begin H.S end
 -2 2029 a -2 2029 a
SDict begin 13 H.A end
 -2 2029 a -2 2029 a
SDict begin [/View [/XYZ H.V]/Dest (0:2737) cvn /DEST pdfmark end

-2 2029 a 396 2119 a Fk(F)o(or)20 b(client)g(applications)f(to)i(w)o
(ork)e(properly)f(with)j(a)f(Binary)g(Star)g(pair)m(,)g(the)o(y)f
(must:)-2 2137 y
SDict begin H.S end
 -2 2137 a -2 2137 a
SDict begin 13 H.A end
 -2 2137 a -2 2137
a
SDict begin [/View [/XYZ H.V]/Dest (0:2738) cvn /DEST pdfmark end
 -2 2137 a -2 2147 a
SDict begin H.S end
 -2 2147 a -2 2147 a
SDict begin 13 H.A end
 -2 2147 a -2
2147 a
SDict begin [/View [/XYZ H.V]/Dest (0:2739) cvn /DEST pdfmark end
 -2 2147 a Black 463 2289 a Fk(1.)p Black 546 2289
a
SDict begin H.S end
 546 2289 a 546 2289 a
SDict begin 13 H.A end
 546 2289 a 546 2289 a
SDict begin [/View [/XYZ H.V]/Dest (0:2740) cvn /DEST pdfmark end
 546 2289
a Fk(Kno)n(w)g(both)h(serv)o(er)f(addresses.)-2 2290
y
SDict begin H.S end
 -2 2290 a -2 2290 a
SDict begin 13 H.A end
 -2 2290 a -2 2290 a
SDict begin [/View [/XYZ H.V]/Dest (0:2741) cvn /DEST pdfmark end
 -2 2290 a Black
463 2439 a Fk(2.)p Black 546 2439 a
SDict begin H.S end
 546 2439 a 546 2439
a
SDict begin 13 H.A end
 546 2439 a 546 2439 a
SDict begin [/View [/XYZ H.V]/Dest (0:2742) cvn /DEST pdfmark end
 546 2439 a Fk(T)m(ry)g(to)i(connect)e(to)h(the)
g(primary)f(serv)o(er)m(,)g(and)g(if)i(that)f(f)o(ails,)h(to)f(the)g
(backup)f(serv)o(er)-5 b(.)-2 2457 y
SDict begin H.S end
 -2 2457 a -2 2457
a
SDict begin 13 H.A end
 -2 2457 a -2 2457 a
SDict begin [/View [/XYZ H.V]/Dest (0:2743) cvn /DEST pdfmark end
 -2 2457 a Black 463 2588 a Fk(3.)p
Black 546 2588 a
SDict begin H.S end
 546 2588 a 546 2588 a
SDict begin 13 H.A end
 546 2588 a 546
2588 a
SDict begin [/View [/XYZ H.V]/Dest (0:2744) cvn /DEST pdfmark end
 546 2588 a Fk(Detect)20 b(a)h(f)o(ailed)f(connection,)e
(typically)h(using)h(heartbeating.)-2 2606 y
SDict begin H.S end
 -2 2606
a -2 2606 a
SDict begin 13 H.A end
 -2 2606 a -2 2606 a
SDict begin [/View [/XYZ H.V]/Dest (0:2745) cvn /DEST pdfmark end
 -2 2606 a Black 463 2737
a Fk(4.)p Black 546 2737 a
SDict begin H.S end
 546 2737 a 546 2737 a
SDict begin 13 H.A end
 546
2737 a 546 2737 a
SDict begin [/View [/XYZ H.V]/Dest (0:2746) cvn /DEST pdfmark end
 546 2737 a Fk(T)m(ry)f(to)i(reconnect)d(to)j(primary)
-5 b(,)18 b(and)h(then)h(backup,)e(with)j(a)f(delay)g(between)f
(retries)h(that)h(is)g(at)f(least)h(as)g(high)f(as)546
2845 y(the)g(serv)o(er)f(f)o(ail-o)o(v)o(er)g(timeout.)-2
2846 y
SDict begin H.S end
 -2 2846 a -2 2846 a
SDict begin 13 H.A end
 -2 2846 a -2 2846 a
SDict begin [/View [/XYZ H.V]/Dest (0:2747) cvn /DEST pdfmark end
 -2 2846
a Black 463 2995 a Fk(5.)p Black 546 2995 a
SDict begin H.S end
 546 2995
a 546 2995 a
SDict begin 13 H.A end
 546 2995 a 546 2995 a
SDict begin [/View [/XYZ H.V]/Dest (0:2748) cvn /DEST pdfmark end
 546 2995 a Fk(Recreate)h(all)h(of)f
(the)g(state)h(the)o(y)e(require)g(on)h(a)g(serv)o(er)-5
b(.)-2 3013 y
SDict begin H.S end
 -2 3013 a -2 3013 a
SDict begin 13 H.A end
 -2 3013 a -2 3013 a
SDict begin [/View [/XYZ H.V]/Dest (0:2749) cvn /DEST pdfmark end

-2 3013 a Black 463 3144 a Fk(6.)p Black 546 3144 a
SDict begin H.S end
 546
3144 a 546 3144 a
SDict begin 13 H.A end
 546 3144 a 546 3144 a
SDict begin [/View [/XYZ H.V]/Dest (0:2750) cvn /DEST pdfmark end
 546 3144 a Fk(Retransmit)20
b(messages)g(lost)h(during)d(a)j(f)o(ail-o)o(v)o(er)m(,)d(if)i
(messages)h(need)e(to)h(be)h(reliable.)-2 3328 y
SDict begin H.S end
 -2 3328
a -2 3328 a
SDict begin 13 H.A end
 -2 3328 a -2 3328 a
SDict begin [/View [/XYZ H.V]/Dest (0:2751) cvn /DEST pdfmark end
 -2 3328 a 396 3418 a
Fk(It')-5 b(s)21 b(not)f(tri)n(vial)g(w)o(ork,)f(and)h(we')l(d)f
(usually)h(wrap)g(this)h(in)f(an)g(API)g(that)h(hides)f(it)h(from)e
(real)h(end-user)f(applications.)-2 3602 y
SDict begin H.S end
 -2 3602 a
-2 3602 a
SDict begin 13 H.A end
 -2 3602 a -2 3602 a
SDict begin [/View [/XYZ H.V]/Dest (0:2752) cvn /DEST pdfmark end
 -2 3602 a 396 3692 a Fk(These)h(are)g
(the)h(main)e(limitations)h(of)g(the)h(Binary)e(Star)i(pattern:)-2
3710 y
SDict begin H.S end
 -2 3710 a -2 3710 a
SDict begin 13 H.A end
 -2 3710 a -2 3710 a
SDict begin [/View [/XYZ H.V]/Dest (0:2753) cvn /DEST pdfmark end
 -2 3710
a -2 3720 a
SDict begin H.S end
 -2 3720 a -2 3720 a
SDict begin 13 H.A end
 -2 3720 a -2 3720 a
SDict begin [/View [/XYZ H.V]/Dest (0:2754) cvn /DEST pdfmark end
 -2
3720 a Black 396 3862 a Fj(\225)p Black 479 3862 a
SDict begin H.S end
 479
3862 a 479 3862 a
SDict begin 13 H.A end
 479 3862 a 479 3862 a
SDict begin [/View [/XYZ H.V]/Dest (0:2755) cvn /DEST pdfmark end
 479 3862 a Fk(A)g(serv)o(er)e
(process)h(cannot)f(be)h(part)g(of)g(more)f(than)h(one)g(Binary)f(Star)
i(pair)-5 b(.)-2 3880 y
SDict begin H.S end
 -2 3880 a -2 3880 a
SDict begin 13 H.A end
 -2 3880 a
-2 3880 a
SDict begin [/View [/XYZ H.V]/Dest (0:2756) cvn /DEST pdfmark end
 -2 3880 a Black 396 4012 a Fj(\225)p Black
479 4012 a
SDict begin H.S end
 479 4012 a 479 4012 a
SDict begin 13 H.A end
 479 4012 a 479 4012
a
SDict begin [/View [/XYZ H.V]/Dest (0:2757) cvn /DEST pdfmark end
 479 4012 a Fk(A)21 b(primary)e(serv)o(er)g(can)h(ha)n(v)o(e)f(a)i
(single)f(backup)f(serv)o(er)m(,)f(no)i(more.)-2 4030
y
SDict begin H.S end
 -2 4030 a -2 4030 a
SDict begin 13 H.A end
 -2 4030 a -2 4030 a
SDict begin [/View [/XYZ H.V]/Dest (0:2758) cvn /DEST pdfmark end
 -2 4030 a Black
396 4161 a Fj(\225)p Black 479 4161 a
SDict begin H.S end
 479 4161 a 479
4161 a
SDict begin 13 H.A end
 479 4161 a 479 4161 a
SDict begin [/View [/XYZ H.V]/Dest (0:2759) cvn /DEST pdfmark end
 479 4161 a Fk(The)g(backup)f(serv)o(er)g
(cannot)g(do)h(useful)g(w)o(ork)f(while)h(in)h(sla)n(v)o(e)f(mode.)-2
4179 y
SDict begin H.S end
 -2 4179 a -2 4179 a
SDict begin 13 H.A end
 -2 4179 a -2 4179 a
SDict begin [/View [/XYZ H.V]/Dest (0:2760) cvn /DEST pdfmark end
 -2 4179
a Black 396 4311 a Fj(\225)p Black 479 4311 a
SDict begin H.S end
 479 4311
a 479 4311 a
SDict begin 13 H.A end
 479 4311 a 479 4311 a
SDict begin [/View [/XYZ H.V]/Dest (0:2761) cvn /DEST pdfmark end
 479 4311 a Fk(The)g(backup)f(serv)o
(er)g(must)h(be)g(capable)g(of)g(handling)e(full)i(application)f
(loads.)-2 4329 y
SDict begin H.S end
 -2 4329 a -2 4329 a
SDict begin 13 H.A end
 -2 4329 a -2 4329
a
SDict begin [/View [/XYZ H.V]/Dest (0:2762) cvn /DEST pdfmark end
 -2 4329 a Black 396 4460 a Fj(\225)p Black 479 4460
a
SDict begin H.S end
 479 4460 a 479 4460 a
SDict begin 13 H.A end
 479 4460 a 479 4460 a
SDict begin [/View [/XYZ H.V]/Dest (0:2763) cvn /DEST pdfmark end
 479 4460
a Fk(F)o(ailo)o(v)o(er)g(con\002guration)f(cannot)h(be)h(modi\002ed)f
(at)h(runtime.)-2 4478 y
SDict begin H.S end
 -2 4478 a -2 4478 a
SDict begin 13 H.A end
 -2 4478
a -2 4478 a
SDict begin [/View [/XYZ H.V]/Dest (0:2764) cvn /DEST pdfmark end
 -2 4478 a Black 396 4610 a Fj(\225)p Black
479 4610 a
SDict begin H.S end
 479 4610 a 479 4610 a
SDict begin 13 H.A end
 479 4610 a 479 4610
a
SDict begin [/View [/XYZ H.V]/Dest (0:2765) cvn /DEST pdfmark end
 479 4610 a Fk(Client)h(applications)e(must)h(do)g(some)g(w)o(ork)g
(to)g(bene\002t)g(from)f(f)o(ail-o)o(v)o(er)-5 b(.)-2
4669 y
SDict begin H.S end
 -2 4669 a -2 4669 a
SDict begin 13 H.A end
 -2 4669 a -2 4669 a
SDict begin [/View [/XYZ H.V]/Dest (0:2766) cvn /DEST pdfmark end
 -2 4669
a Black 3757 5569 a Ff(216)p Black eop end
%%Page: 217 230
TeXDict begin 217 229 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.217) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 77 a Fb(4.13.3.)36 b(Pre)n(venting)e(Split-Brain)g(Syndr)n
(ome)2664 77 y
SDict begin H.S end
 2664 77 a 2664 77 a
SDict begin 18.72 H.A end
 2664 77 a 2664 77
a
SDict begin [/View [/XYZ H.V]/Dest (9.67.15.2) cvn /DEST pdfmark end
 2664 77 a -2 269 a
SDict begin H.S end
 -2 269 a -2 269 a
SDict begin 13 H.A end
 -2 269 a -2 269
a
SDict begin [/View [/XYZ H.V]/Dest (0:2768) cvn /DEST pdfmark end
 -2 269 a 396 351 a Fk("Split-brain)19 b(syndrome")f(is)j(when)f(dif)n
(ferent)e(parts)i(of)g(a)h(cluster)f(think)g(the)o(y)f(are)h('master')g
(at)g(the)g(same)h(time.)f(It)396 459 y(causes)h(applications)e(to)h
(stop)g(seeing)g(each)g(other)-5 b(.)19 b(Binary)h(Star)h(has)f(an)g
(algorithm)f(for)g(detecting)h(and)f(eliminating)396
566 y(split)i(brain,)e(based)h(on)g(a)g(three-w)o(ay)f(decision)h
(mechanism)f(\(a)h(serv)o(er)f(will)i(not)f(decide)f(to)i(become)e
(master)h(until)g(it)396 674 y(gets)h(application)d(connection)h
(requests)g(and)h(it)h(cannot)e(see)i(its)g(peer)f(serv)o(er\).)-2
858 y
SDict begin H.S end
 -2 858 a -2 858 a
SDict begin 13 H.A end
 -2 858 a -2 858 a
SDict begin [/View [/XYZ H.V]/Dest (0:2769) cvn /DEST pdfmark end
 -2 858 a 396
948 a Fk(Ho)n(we)n(v)o(er)f(it)i(is)g(still)g(possible)f(to)h
(\(mis\)design)d(a)j(netw)o(ork)e(to)h(fool)g(this)h(algorithm.)d(A)j
(typical)e(scenario)h(w)o(ould)f(a)396 1056 y(Binary)h(Star)h(pair)e
(distrib)n(uted)h(between)f(tw)o(o)h(b)n(uildings,)f(where)h(each)g(b)n
(uilding)f(also)h(had)g(a)g(set)h(of)f(applications,)396
1164 y(and)g(there)g(w)o(as)h(a)f(single)g(netw)o(ork)f(link)h(between)
g(both)f(b)n(uildings.)g(Breaking)g(this)i(link)f(w)o(ould)f(create)h
(tw)o(o)h(sets)g(of)396 1272 y(client)f(applications,)f(each)h(with)g
(half)g(of)g(the)g(Binary)g(Star)h(pair)m(,)e(and)h(each)f(f)o(ail-o)o
(v)o(er)g(serv)o(er)g(w)o(ould)h(become)e(acti)n(v)o(e.)-2
1456 y
SDict begin H.S end
 -2 1456 a -2 1456 a
SDict begin 13 H.A end
 -2 1456 a -2 1456 a
SDict begin [/View [/XYZ H.V]/Dest (0:2770) cvn /DEST pdfmark end
 -2 1456
a 396 1546 a Fk(T)-7 b(o)21 b(pre)n(v)o(ent)d(split-brain)h
(situations,)h(we)1608 1546 y
SDict begin H.S end
 1608 1546 a 1608 1546 a
SDict begin 13 H.A end

1608 1546 a 1608 1546 a
SDict begin [/View [/XYZ H.V]/Dest (0:2771) cvn /DEST pdfmark end
 1608 1546 a Ff(MUST)27 b Fk(connect)19
b(Binary)h(Star)h(pairs)f(using)f(a)i(dedicated)e(netw)o(ork)g(link,)
396 1654 y(which)h(can)g(be)g(as)h(simple)f(as)h(plugging)d(them)i
(both)f(into)h(the)g(same)h(switch)f(or)g(better)m(,)f(using)h(a)h
(cross-o)o(v)o(er)d(cable)396 1762 y(directly)i(between)f(tw)o(o)h
(machines.)-2 1946 y
SDict begin H.S end
 -2 1946 a -2 1946 a
SDict begin 13 H.A end
 -2 1946 a -2
1946 a
SDict begin [/View [/XYZ H.V]/Dest (0:2772) cvn /DEST pdfmark end
 -2 1946 a 396 2036 a Fk(W)-7 b(e)22 b(must)e(not)g(split)g(a)h
(Binary)f(Star)g(architecture)f(into)h(tw)o(o)g(islands,)h(each)e(with)
i(a)f(set)h(of)f(applications.)f(While)i(this)396 2144
y(may)f(be)g(a)h(common)d(type)i(of)g(netw)o(ork)f(architecture,)f(we')
l(d)i(use)g(federation,)e(not)i(high-a)n(v)n(ailability)e(f)o(ail-o)o
(v)o(er)m(,)g(in)396 2252 y(such)i(cases.)-2 2419 y
SDict begin H.S end
 -2
2419 a -2 2419 a
SDict begin 13 H.A end
 -2 2419 a -2 2419 a
SDict begin [/View [/XYZ H.V]/Dest (0:2773) cvn /DEST pdfmark end
 -2 2419 a 396 2526
a Fk(A)h(suitably)f(paranoid)e(netw)o(ork)h(con\002guration)e(w)o(ould)
j(use)g(tw)o(o)h(pri)n(v)n(ate)e(cluster)h(interconnects,)e(rather)i
(than)f(a)396 2634 y(single)h(one.)g(Further)m(,)e(the)j(netw)o(ork)e
(cards)g(used)h(for)g(the)g(cluster)g(w)o(ould)g(be)g(dif)n(ferent)e
(to)j(those)f(used)g(for)f(message)396 2742 y(in/out,)h(and)f(possibly)
h(e)n(v)o(en)f(on)h(dif)n(ferent)e(PCI)j(paths)f(on)g(the)g(serv)o(er)f
(hardw)o(are.)g(The)h(goal)g(being)f(to)h(separate)396
2850 y(possible)g(f)o(ailures)g(in)g(the)h(netw)o(ork)e(from)g
(possible)h(f)o(ailures)g(in)g(the)g(cluster)-5 b(.)20
b(Netw)o(ork)g(ports)g(ha)n(v)o(e)f(a)i(relati)n(v)o(ely)e(high)396
2958 y(f)o(ailure)h(rate.)-2 2969 y
SDict begin H.S end
 -2 2969 a -2 2969
a
SDict begin 13 H.A end
 -2 2969 a -2 2969 a
SDict begin [/View [/XYZ H.V]/Dest (0:2774) cvn /DEST pdfmark end
 -2 2969 a 396 3296 a Fb(4.13.4.)36
b(Binar)q(y)f(Star)d(Implementation)2348 3296 y
SDict begin H.S end
 2348
3296 a 2348 3296 a
SDict begin 18.72 H.A end
 2348 3296 a 2348 3296 a
SDict begin [/View [/XYZ H.V]/Dest (9.67.16.2) cvn /DEST pdfmark end
 2348 3296
a -2 3487 a
SDict begin H.S end
 -2 3487 a -2 3487 a
SDict begin 13 H.A end
 -2 3487 a -2 3487 a
SDict begin [/View [/XYZ H.V]/Dest (0:2776) cvn /DEST pdfmark end
 -2
3487 a 396 3570 a Fk(W)m(ithout)20 b(further)e(ado,)i(here)g(is)h(a)f
(proof-of-concept)15 b(implementation)j(of)i(the)h(Binary)e(Star)i
(serv)o(er:)-2 3588 y
SDict begin H.S end
 -2 3588 a -2 3588 a
SDict begin 13 H.A end
 -2 3588 a -2
3588 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv-c) cvn /DEST pdfmark
end
 -2 3588 a 396 3771 a Fg(Example)g(4-61.)d(Binary)j(Star)f(ser)o
(v)o(er)g(\(bstarsr)o(v)-6 b(.c\))-2 3871 y
SDict begin H.S end
 -2 3871 a
-2 3871 a
SDict begin 11.7 H.A end
 -2 3871 a -2 3871 a
SDict begin [/View [/XYZ H.V]/Dest (0:2779) cvn /DEST pdfmark end
 -2 3871 a 396 3951 a Fe(//)396
4049 y(//)90 b(Binary)43 b(Star)i(server)e(proof-of-concept)g
(implementation.)f(This)i(server)g(does)g(no)396 4146
y(//)90 b(real)44 b(work;)g(it)g(just)g(demonstrates)f(the)i(Binary)e
(Star)i(failover)e(model.)396 4340 y(#include)h("czmq.h")396
4534 y(//)90 b(States)43 b(we)i(can)f(be)h(in)f(at)h(any)f(point)g(in)h
(time)396 4631 y(typedef)f(enum)g({)576 4729 y(STATE_PRIMARY)e(=)j(1,)
448 b(//)89 b(Primary,)44 b(waiting)f(for)i(peer)f(to)g(connect)576
4826 y(STATE_BACKUP)e(=)j(2,)493 b(//)89 b(Backup,)44
b(waiting)g(for)g(peer)g(to)h(connect)576 4923 y(STATE_ACTIVE)d(=)j(3,)
493 b(//)89 b(Active)44 b(-)h(accepting)e(connections)576
5020 y(STATE_PASSIVE)f(=)j(4)493 b(//)89 b(Passive)44
b(-)h(not)f(accepting)f(connections)396 5117 y(})i(state_t;)p
Black 3756 5569 a Ff(217)p Black eop end
%%Page: 218 231
TeXDict begin 218 230 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.218) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 170 a Fe(//)90 b(Events,)43 b(which)h(start)g(with)g(the)h
(states)f(our)g(peer)g(can)g(be)h(in)396 267 y(typedef)f(enum)g({)576
364 y(PEER_PRIMARY)e(=)j(1,)493 b(//)89 b(HA)45 b(peer)f(is)g(pending)g
(primary)576 461 y(PEER_BACKUP)f(=)h(2,)538 b(//)89 b(HA)45
b(peer)f(is)g(pending)g(backup)576 558 y(PEER_ACTIVE)f(=)h(3,)538
b(//)89 b(HA)45 b(peer)f(is)g(active)576 655 y(PEER_PASSIVE)e(=)j(4,)
493 b(//)89 b(HA)45 b(peer)f(is)g(passive)576 752 y(CLIENT_REQUEST)e(=)
j(5)448 b(//)89 b(Client)44 b(makes)g(request)396 850
y(})h(event_t;)396 1044 y(//)90 b(Our)44 b(finite)g(state)g(machine)396
1141 y(typedef)g(struct)g({)576 1238 y(state_t)f(state;)627
b(//)89 b(Current)44 b(state)576 1335 y(event_t)f(event;)627
b(//)89 b(Current)44 b(event)576 1432 y(int64_t)f(peer_expiry;)357
b(//)89 b(When)44 b(peer)h(is)f(considered)f('dead')396
1530 y(})i(bstar_t;)396 1724 y(//)90 b(We)44 b(send)g(state)g
(information)f(every)h(this)g(often)396 1821 y(//)90
b(If)44 b(peer)g(doesn't)g(respond)g(in)g(two)g(heartbeats,)f(it)i(is)f
('dead')396 1918 y(#define)g(HEARTBEAT)f(1000)448 b(//)89
b(In)45 b(msecs)-2 2090 y
SDict begin H.S end
 -2 2090 a -2 2090 a
SDict begin 13 H.A end
 -2 2090
a -2 2090 a
SDict begin [/View [/XYZ H.V]/Dest (0:2780) cvn /DEST pdfmark end
 -2 2090 a 396 2192 a Fk(The)20 b(heart)g(of)g(the)g(Binary)
g(Star)g(design)g(is)h(its)g(\002nite-state)f(machine)f(\(FSM\).)h(The)
g(FSM)h(runs)f(one)f(e)n(v)o(ent)h(at)g(a)h(time.)396
2300 y(W)-7 b(e)22 b(apply)d(an)h(e)n(v)o(ent)f(to)i(the)f(current)f
(state,)h(which)g(checks)g(if)g(the)g(e)n(v)o(ent)g(is)h(accepted,)e
(and)g(if)i(so)f(sets)i(a)e(ne)n(w)g(state:)-2 2318 y
SDict begin H.S end

-2 2318 a -2 2318 a
SDict begin 13 H.A end
 -2 2318 a -2 2318 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv-c-1) cvn /DEST pdfmark
end
 -2 2318 a 396
2501 a Fg(Example)h(4-62.)d(Binary)j(Star)f(ser)o(v)o(er)g(\(bstarsr)o
(v)-6 b(.c\))19 b(-)h(Binary)h(Star)f(state)f(machine)-2
2601 y
SDict begin H.S end
 -2 2601 a -2 2601 a
SDict begin 11.7 H.A end
 -2 2601 a -2 2601 a
SDict begin [/View [/XYZ H.V]/Dest (0:2783) cvn /DEST pdfmark end
 -2 2601
a 396 2779 a Fe(static)44 b(Bool)396 2876 y(s_state_machine)f
(\(bstar_t)1517 2889 y(*)1562 2876 y(fsm\))396 2973 y({)576
3070 y(Bool)h(exception)f(=)i(FALSE;)576 3264 y(//)89
b(These)44 b(are)g(the)h(PRIMARY)e(and)i(BACKUP)e(states;)h(we're)g
(waiting)g(to)g(become)576 3361 y(//)89 b(ACTIVE)44 b(or)g(PASSIVE)g
(depending)f(on)i(events)f(we)g(get)g(from)h(our)f(peer:)576
3459 y(if)g(\(fsm->state)f(==)i(STATE_PRIMARY\))d({)755
3556 y(if)i(\(fsm->event)f(==)i(PEER_BACKUP\))e({)934
3653 y(printf)h(\("I:)g(connected)g(to)g(backup)g(\(slave\),)f(ready)h
(as)h(master\\n"\);)934 3750 y(fsm->state)e(=)i(STATE_ACTIVE;)755
3847 y(})755 3944 y(else)755 4041 y(if)f(\(fsm->event)f(==)i
(PEER_ACTIVE\))e({)934 4138 y(printf)h(\("I:)g(connected)g(to)g(backup)
g(\(master\),)f(ready)h(as)h(slave\\n"\);)934 4236 y(fsm->state)e(=)i
(STATE_PASSIVE;)755 4333 y(})755 4430 y(//)89 b(Accept)44
b(client)g(connections)576 4527 y(})576 4624 y(else)576
4721 y(if)g(\(fsm->state)f(==)i(STATE_BACKUP\))d({)755
4818 y(if)i(\(fsm->event)f(==)i(PEER_ACTIVE\))e({)934
4916 y(printf)h(\("I:)g(connected)g(to)g(primary)g(\(master\),)f(ready)
h(as)h(slave\\n"\);)934 5013 y(fsm->state)e(=)i(STATE_PASSIVE;)755
5110 y(})p Black 3759 5569 a Ff(218)p Black eop end
%%Page: 219 232
TeXDict begin 219 231 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.219) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(else)755 170 y(//)89 b(Reject)44 b(client)g
(connections)f(when)h(acting)g(as)g(backup)755 267 y(if)g(\(fsm->event)
f(==)i(CLIENT_REQUEST\))934 364 y(exception)f(=)g(TRUE;)576
461 y(})576 558 y(else)-2 725 y
SDict begin H.S end
 -2 725 a -2 725 a
SDict begin 13 H.A end
 -2
725 a -2 725 a
SDict begin [/View [/XYZ H.V]/Dest (0:2784) cvn /DEST pdfmark end
 -2 725 a 396 832 a Fk(These)20 b(are)g(the)h(A)m(CTIVE)e
(and)h(P)-8 b(ASSIVE)21 b(states:)-2 833 y
SDict begin H.S end
 -2 833 a -2
833 a
SDict begin 13 H.A end
 -2 833 a -2 833 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv-c-2) cvn /DEST pdfmark
end
 -2 833 a 396 1033 a Fg(Example)g(4-63.)d
(Binary)j(Star)f(ser)o(v)o(er)g(\(bstarsr)o(v)-6 b(.c\))19
b(-)h(acti)o(v)o(e)g(and)h(passi)o(v)o(e)f(states)-2
1133 y
SDict begin H.S end
 -2 1133 a -2 1133 a
SDict begin 11.7 H.A end
 -2 1133 a -2 1133 a
SDict begin [/View [/XYZ H.V]/Dest (0:2787) cvn /DEST pdfmark end
 -2 1133
a 576 1214 a Fe(if)44 b(\(fsm->state)f(==)i(STATE_ACTIVE\))d({)755
1311 y(if)i(\(fsm->event)f(==)i(PEER_ACTIVE\))e({)934
1408 y(//)90 b(Two)44 b(masters)g(would)g(mean)g(split-brain)934
1505 y(printf)g(\("E:)g(fatal)g(error)g(-)h(dual)f(masters,)g
(aborting\\n"\);)934 1602 y(exception)g(=)g(TRUE;)755
1699 y(})576 1796 y(})576 1894 y(else)576 1991 y(//)89
b(Server)44 b(is)g(passive)576 2088 y(//)89 b(CLIENT_REQUEST)42
b(events)i(can)h(trigger)e(failover)h(if)g(peer)g(looks)g(dead)576
2185 y(if)g(\(fsm->state)f(==)i(STATE_PASSIVE\))d({)755
2282 y(if)i(\(fsm->event)f(==)i(PEER_PRIMARY\))e({)934
2379 y(//)90 b(Peer)44 b(is)g(restarting)f(-)i(become)f(active,)g(peer)
g(will)g(go)g(passive)934 2476 y(printf)g(\("I:)g(primary)g(\(slave\))g
(is)g(restarting,)f(ready)h(as)h(master\\n"\);)934 2574
y(fsm->state)e(=)i(STATE_ACTIVE;)755 2671 y(})755 2768
y(else)755 2865 y(if)f(\(fsm->event)f(==)i(PEER_BACKUP\))e({)934
2962 y(//)90 b(Peer)44 b(is)g(restarting)f(-)i(become)f(active,)g(peer)
g(will)g(go)g(passive)934 3059 y(printf)g(\("I:)g(backup)g(\(slave\))g
(is)g(restarting,)f(ready)h(as)h(master\\n"\);)934 3156
y(fsm->state)e(=)i(STATE_ACTIVE;)755 3253 y(})755 3351
y(else)755 3448 y(if)f(\(fsm->event)f(==)i(PEER_PASSIVE\))e({)934
3545 y(//)90 b(Two)44 b(passives)f(would)h(mean)h(cluster)e(would)h(be)
h(non-responsive)934 3642 y(printf)f(\("E:)g(fatal)g(error)g(-)h(dual)f
(slaves,)g(aborting\\n"\);)934 3739 y(exception)g(=)g(TRUE;)755
3836 y(})755 3933 y(else)755 4031 y(if)g(\(fsm->event)f(==)i
(CLIENT_REQUEST\))d({)934 4128 y(//)90 b(Peer)44 b(becomes)f(master)h
(if)h(timeout)e(has)i(passed)934 4225 y(//)90 b(It's)44
b(the)g(client)g(request)g(that)g(triggers)f(the)i(failover)934
4322 y(assert)f(\(fsm->peer_expiry)e(>)j(0\);)934 4419
y(if)g(\(zclock_time)e(\(\))h(>=)h(fsm->peer_expiry\))d({)1114
4516 y(//)89 b(If)44 b(peer)h(is)f(dead,)g(switch)g(to)g(the)h(active)f
(state)1114 4613 y(printf)f(\("I:)i(failover)e(successful,)g(ready)h
(as)h(master\\n"\);)1114 4711 y(fsm->state)e(=)h(STATE_ACTIVE;)934
4808 y(})934 4905 y(else)1114 5002 y(//)89 b(If)44 b(peer)h(is)f
(alive,)g(reject)g(connections)1114 5099 y(exception)f(=)i(TRUE;)p
Black 3759 5569 a Ff(219)p Black eop end
%%Page: 220 233
TeXDict begin 220 232 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.220) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(})576 170 y(})576 267 y(return)43 b(exception;)396
364 y(})-2 538 y
SDict begin H.S end
 -2 538 a -2 538 a
SDict begin 13 H.A end
 -2 538 a -2 538 a
SDict begin [/View [/XYZ H.V]/Dest (0:2788) cvn /DEST pdfmark end

-2 538 a 396 638 a Fk(This)21 b(is)g(our)e(main)h(task.)g(First)h(we)g
(bind/connect)c(our)j(sock)o(ets)g(with)h(our)e(peer)h(and)f(mak)o(e)h
(sure)g(we)h(will)g(get)f(state)396 746 y(messages)h(correctly)-5
b(.)18 b(W)-7 b(e)21 b(use)g(three)e(sock)o(ets;)i(one)e(to)i(publish)e
(state,)i(one)e(to)i(subscribe)e(to)h(state,)h(and)f(one)f(for)396
854 y(client)h(requests/replies:)-2 872 y
SDict begin H.S end
 -2 872 a -2
872 a
SDict begin 13 H.A end
 -2 872 a -2 872 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv-c-3) cvn /DEST pdfmark
end
 -2 872 a 396 1055 a Fg(Example)h(4-64.)d
(Binary)j(Star)f(ser)o(v)o(er)g(\(bstarsr)o(v)-6 b(.c\))19
b(-)h(main)h(task)-2 1155 y
SDict begin H.S end
 -2 1155 a -2 1155 a
SDict begin 11.7 H.A end
 -2 1155
a -2 1155 a
SDict begin [/View [/XYZ H.V]/Dest (0:2791) cvn /DEST pdfmark end
 -2 1155 a 396 1429 a Fe(int)45 b(main)f(\(int)g(argc,)g
(char)1517 1442 y(*)1562 1429 y(argv)g([]\))396 1527
y({)576 1624 y(//)89 b(Arguments)43 b(can)i(be)f(either)g(of:)576
1721 y(//)268 b(-p)90 b(primary)43 b(server,)h(at)g
(tcp://localhost:5001)576 1818 y(//)268 b(-b)90 b(backup)43
b(server,)h(at)h(tcp://localhost:5002)576 1915 y(zctx_t)889
1928 y(*)934 1915 y(ctx)g(=)f(zctx_new)g(\(\);)576 2012
y(void)800 2025 y(*)845 2012 y(statepub)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_PUB\);)576 2109 y(void)800 2122 y(*)845 2109 y(statesub)f(=)i
(zsocket_new)e(\(ctx,)h(ZMQ_SUB\);)576 2207 y(zsockopt_set_subscribe)d
(\(statesub,)i(""\);)576 2304 y(void)800 2317 y(*)845
2304 y(frontend)g(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
2401 y(bstar_t)f(fsm)i(=)f({)h(0)g(};)576 2595 y(if)f(\(argc)g(==)h(2)f
(&&)h(streq)f(\(argv)g([1],)g("-p"\)\))g({)755 2692 y(printf)g(\("I:)g
(Primary)g(master,)f(waiting)h(for)g(backup)g(\(slave\)\\n"\);)755
2789 y(zsocket_bind)f(\(frontend,)g("tcp://)2146 2802
y(*)2191 2789 y(:5001"\);)755 2887 y(zsocket_bind)g(\(statepub,)g
("tcp://)2146 2900 y(*)2191 2887 y(:5003"\);)755 2984
y(zsocket_connect)f(\(statesub,)h("tcp://localhost:5004"\);)755
3081 y(fsm.state)g(=)i(STATE_PRIMARY;)576 3178 y(})576
3275 y(else)576 3372 y(if)f(\(argc)g(==)h(2)f(&&)h(streq)f(\(argv)g
([1],)g("-b"\)\))g({)755 3469 y(printf)g(\("I:)g(Backup)g(slave,)g
(waiting)f(for)i(primary)e(\(master\)\\n"\);)755 3566
y(zsocket_bind)g(\(frontend,)g("tcp://)2146 3579 y(*)2191
3566 y(:5002"\);)755 3664 y(zsocket_bind)g(\(statepub,)g("tcp://)2146
3677 y(*)2191 3664 y(:5004"\);)755 3761 y(zsocket_connect)f
(\(statesub,)h("tcp://localhost:5003"\);)755 3858 y(fsm.state)g(=)i
(STATE_BACKUP;)576 3955 y(})576 4052 y(else)f({)755 4149
y(printf)g(\("Usage:)f(bstarsrv)h({)g(-p)h(|)g(-b)f(}\\n"\);)755
4246 y(zctx_destroy)f(\(&ctx\);)755 4344 y(exit)h(\(0\);)576
4441 y(})-2 4615 y
SDict begin H.S end
 -2 4615 a -2 4615 a
SDict begin 13 H.A end
 -2 4615 a -2 4615
a
SDict begin [/View [/XYZ H.V]/Dest (0:2792) cvn /DEST pdfmark end
 -2 4615 a 396 4715 a Fk(W)-7 b(e)22 b(no)n(w)d(process)h(e)n(v)o
(ents)g(on)f(our)h(tw)o(o)g(input)g(sock)o(ets,)g(and)f(process)h
(these)g(e)n(v)o(ents)g(one)g(at)g(a)h(time)f(via)h(our)396
4823 y(\002nite-state)g(machine.)d(Our)i("w)o(ork")f(for)h(a)h(client)f
(request)f(is)j(simply)d(to)i(echo)e(it)i(back:)-2 4841
y
SDict begin H.S end
 -2 4841 a -2 4841 a
SDict begin 13 H.A end
 -2 4841 a -2 4841 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv-c-4) cvn /DEST pdfmark
end
 -2 4841 a Black
3759 5569 a Ff(220)p Black eop end
%%Page: 221 234
TeXDict begin 221 233 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.221) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-65.)d(Binary)j(Star)f(ser)o(v)o(er)g
(\(bstarsr)o(v)-6 b(.c\))19 b(-)h(handling)h(sock)o(et)f(input)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2795) cvn /DEST pdfmark end
 -2 172 a 576
253 a Fe(//)89 b(Set)44 b(timer)g(for)h(next)f(outgoing)f(state)h
(message)576 350 y(int64_t)f(send_state_at)g(=)i(zclock_time)e(\(\))h
(+)h(HEARTBEAT;)576 447 y(while)f(\(!zctx_interrupted\))d({)755
544 y(zmq_pollitem_t)h(items)i([])h(=)g({)934 641 y({)g(frontend,)e(0,)
i(ZMQ_POLLIN,)e(0)h(},)934 738 y({)h(statesub,)e(0,)i(ZMQ_POLLIN,)e(0)h
(})755 835 y(};)755 933 y(int)g(time_left)g(=)g(\(int\))g
(\(\(send_state_at)f(-)h(zclock_time)f(\(\)\)\);)755
1030 y(if)h(\(time_left)g(<)g(0\))934 1127 y(time_left)g(=)g(0;)755
1224 y(int)g(rc)h(=)f(zmq_poll)g(\(items,)g(2,)g(time_left)2503
1237 y(*)2593 1224 y(ZMQ_POLL_MSEC\);)755 1321 y(if)g(\(rc)h(==)f(-1\))
934 1418 y(break;)627 b(//)89 b(Context)44 b(has)g(been)g(shut)h(down)
755 1613 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
1710 y(//)90 b(Have)44 b(a)g(client)g(request)934 1807
y(zmsg_t)1248 1820 y(*)1293 1807 y(msg)g(=)h(zmsg_recv)e(\(frontend\);)
934 1904 y(fsm.event)h(=)g(CLIENT_REQUEST;)934 2001 y(if)h
(\(s_state_machine)d(\(&fsm\))i(==)g(FALSE\))1114 2098
y(//)89 b(Answer)44 b(client)g(by)g(echoing)g(request)f(back)1114
2195 y(zmsg_send)g(\(&msg,)h(frontend\);)934 2292 y(else)1114
2390 y(zmsg_destroy)e(\(&msg\);)755 2487 y(})755 2584
y(if)i(\(items)g([1].revents)f(&)i(ZMQ_POLLIN\))e({)934
2681 y(//)90 b(Have)44 b(state)g(from)g(our)g(peer,)g(execute)g(as)g
(event)934 2778 y(char)1158 2791 y(*)1203 2778 y(message)g(=)h
(zstr_recv)e(\(statesub\);)934 2875 y(fsm.event)h(=)g(atoi)g
(\(message\);)934 2972 y(free)g(\(message\);)934 3070
y(if)h(\(s_state_machine)d(\(&fsm\)\))1114 3167 y(break;)447
b(//)89 b(Error,)44 b(so)h(exit)934 3264 y(fsm.peer_expiry)e(=)h
(zclock_time)f(\(\))i(+)f(2)2593 3277 y(*)2683 3264 y(HEARTBEAT;)755
3361 y(})755 3458 y(//)89 b(If)45 b(we)f(timed-out,)f(send)i(state)f
(to)g(peer)755 3555 y(if)g(\(zclock_time)f(\(\))i(>=)f(send_state_at\))
f({)934 3652 y(char)h(message)g([2];)934 3750 y(sprintf)g(\(message,)f
("\045d",)h(fsm.state\);)934 3847 y(zstr_send)g(\(statepub,)f
(message\);)934 3944 y(send_state_at)g(=)i(zclock_time)e(\(\))h(+)h
(HEARTBEAT;)755 4041 y(})576 4138 y(})576 4235 y(if)f
(\(zctx_interrupted\))755 4332 y(printf)g(\("W:)g(interrupted\\n"\);)
576 4527 y(//)89 b(Shutdown)43 b(sockets)h(and)g(context)576
4624 y(zctx_destroy)e(\(&ctx\);)576 4721 y(return)h(0;)396
4818 y(})-2 4992 y
SDict begin H.S end
 -2 4992 a -2 4992 a
SDict begin 13 H.A end
 -2 4992 a -2 4992
a
SDict begin [/View [/XYZ H.V]/Dest (0:2796) cvn /DEST pdfmark end
 -2 4992 a 396 5092 a Fk(And)20 b(here)g(is)h(the)f(client:)-2
5093 y
SDict begin H.S end
 -2 5093 a -2 5093 a
SDict begin 13 H.A end
 -2 5093 a -2 5093 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarcli-c) cvn /DEST pdfmark
end
 -2 5093
a Black 3759 5569 a Ff(221)p Black eop end
%%Page: 222 235
TeXDict begin 222 234 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.222) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-66.)d(Binary)j(Star)f(client)g(\(bstar)o
(cli.c\))-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2799) cvn /DEST pdfmark end

-2 172 a 396 253 a Fe(//)396 350 y(//)90 b(Binary)43
b(Star)i(client)e(proof-of-concept)g(implementation.)f(This)i(client)g
(does)g(no)396 447 y(//)90 b(real)44 b(work;)g(it)g(just)g
(demonstrates)f(the)i(Binary)e(Star)i(failover)e(model.)396
641 y(#include)h("czmq.h")396 835 y(#define)g(REQUEST_TIMEOUT)222
b(1000)178 b(//)90 b(msecs)396 933 y(#define)44 b(SETTLE_DELAY)357
b(2000)178 b(//)90 b(Before)43 b(failing)h(over)396 1127
y(int)h(main)f(\(void\))396 1224 y({)576 1321 y(zctx_t)889
1334 y(*)934 1321 y(ctx)h(=)f(zctx_new)g(\(\);)576 1515
y(char)800 1528 y(*)845 1515 y(server)f([])i(=)g({)f
("tcp://localhost:5001",)d("tcp://localhost:5002")g(};)576
1613 y(uint)j(server_nbr)f(=)i(0;)576 1807 y(printf)e(\("I:)i
(connecting)e(to)h(server)g(at)h(\045s...\\n",)e(server)h
([server_nbr]\);)576 1904 y(void)800 1917 y(*)845 1904
y(client)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_REQ\);)576
2001 y(zsocket_connect)e(\(client,)h(server)h([server_nbr]\);)576
2195 y(int)g(sequence)f(=)i(0;)576 2292 y(while)f
(\(!zctx_interrupted\))d({)755 2390 y(//)89 b(We)45 b(send)f(a)h
(request,)e(then)h(we)h(work)f(to)g(get)h(a)f(reply)755
2487 y(char)g(request)g([10];)755 2584 y(sprintf)g(\(request,)f
("\045d",)h(++sequence\);)755 2681 y(zstr_send)f(\(client,)h
(request\);)755 2875 y(int)g(expect_reply)f(=)i(1;)755
2972 y(while)f(\(expect_reply\))e({)934 3070 y(//)90
b(Poll)44 b(socket)g(for)g(a)h(reply,)e(with)i(timeout)934
3167 y(zmq_pollitem_t)e(items)h([])g(=)h({)g({)f(client,)g(0,)g
(ZMQ_POLLIN,)f(0)i(})g(};)934 3264 y(int)g(rc)f(=)h(zmq_poll)e
(\(items,)h(1,)g(REQUEST_TIMEOUT)2952 3277 y(*)3041 3264
y(ZMQ_POLL_MSEC\);)934 3361 y(if)h(\(rc)f(==)h(-1\))1114
3458 y(break;)447 b(//)89 b(Interrupted)-2 3636 y
SDict begin H.S end
 -2
3636 a -2 3636 a
SDict begin 13 H.A end
 -2 3636 a -2 3636 a
SDict begin [/View [/XYZ H.V]/Dest (0:2800) cvn /DEST pdfmark end
 -2 3636 a 396 3732
a Fk(W)-7 b(e)21 b(use)g(a)f(Lazy)f(Pirate)i(strate)o(gy)e(in)h(the)g
(client.)g(If)g(there')-5 b(s)19 b(no)h(reply)f(within)h(our)f
(timeout,)g(we)h(close)g(the)g(sock)o(et)g(and)396 3840
y(try)g(again.)f(In)h(Binary)g(Star)m(,)g(it')-5 b(s)21
b(the)f(client)g(v)n(ote)h(which)e(decides)h(which)g(serv)o(er)f(is)i
(primary;)e(the)h(client)g(must)396 3948 y(therefore)f(try)h(to)g
(connect)f(to)h(each)g(serv)o(er)f(in)i(turn:)-2 3966
y
SDict begin H.S end
 -2 3966 a -2 3966 a
SDict begin 13 H.A end
 -2 3966 a -2 3966 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarcli-c-1) cvn /DEST pdfmark
end
 -2 3966 a 396
4149 a Fg(Example)g(4-67.)d(Binary)j(Star)f(client)g(\(bstar)o(cli.c\))
f(-)h(main)h(body)f(of)g(client)-2 4249 y
SDict begin H.S end
 -2 4249 a -2
4249 a
SDict begin 11.7 H.A end
 -2 4249 a -2 4249 a
SDict begin [/View [/XYZ H.V]/Dest (0:2803) cvn /DEST pdfmark end
 -2 4249 a 934 4427 a Fe(if)45
b(\(items)f([0].revents)f(&)h(ZMQ_POLLIN\))f({)1114 4524
y(//)89 b(We)44 b(got)h(a)f(reply)g(from)h(the)f(server,)g(must)g
(match)g(sequence)1114 4621 y(char)1338 4634 y(*)1383
4621 y(reply)g(=)g(zstr_recv)g(\(client\);)1114 4718
y(if)g(\(atoi)g(\(reply\))g(==)g(sequence\))g({)1293
4815 y(printf)g(\("I:)g(server)g(replied)f(OK)i(\(\045s\)\\n",)e
(reply\);)1293 4912 y(expect_reply)g(=)h(0;)1293 5009
y(sleep)g(\(1\);)89 b(//)g(One)45 b(request)e(per)i(second)1114
5107 y(})p Black 3759 5569 a Ff(222)p Black eop end
%%Page: 223 236
TeXDict begin 223 235 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.223) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2814) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 1114 72 a Fe(else)1293 170 y(printf)44 b(\("E:)g(bad)g(reply)g
(from)g(server:)g(\045s\\n",)g(reply\);)1114 267 y(free)g(\(reply\);)
934 364 y(})934 461 y(else)g({)1114 558 y(printf)f(\("W:)i(no)f
(response)g(from)g(server,)f(failing)h(over\\n"\);)1114
752 y(//)89 b(Old)44 b(socket)g(is)h(confused;)e(close)h(it)g(and)h
(open)f(a)h(new)f(one)1114 850 y(zsocket_destroy)e(\(ctx,)i(client\);)
1114 947 y(server_nbr)f(=)h(\(server_nbr)f(+)i(1\))g(\045)f(2;)1114
1044 y(zclock_sleep)e(\(SETTLE_DELAY\);)1114 1141 y(printf)h(\("I:)i
(connecting)e(to)h(server)g(at)h(\045s...\\n",)1472 1238
y(server)f([server_nbr]\);)1114 1335 y(client)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_REQ\);)1114 1432 y(zsocket_connect)e(\(client,)h(server)h
([server_nbr]\);)1114 1627 y(//)89 b(Send)44 b(request)g(again,)g(on)g
(new)g(socket)1114 1724 y(zstr_send)f(\(client,)g(request\);)934
1821 y(})755 1918 y(})576 2015 y(})576 2112 y(zctx_destroy)f(\(&ctx\);)
576 2209 y(return)h(0;)396 2307 y(})-2 2481 y
SDict begin H.S end
 -2 2481
a -2 2481 a
SDict begin 13 H.A end
 -2 2481 a -2 2481 a
SDict begin [/View [/XYZ H.V]/Dest (0:2804) cvn /DEST pdfmark end
 -2 2481 a 396 2581 a
Fk(T)-7 b(o)21 b(test)g(Binary)e(Star)m(,)h(start)h(the)f(serv)o(ers)g
(and)g(client)g(in)g(an)o(y)g(order:)-2 2682 y
SDict begin H.S end
 -2 2682
a -2 2682 a
SDict begin 11.7 H.A end
 -2 2682 a -2 2682 a
SDict begin [/View [/XYZ H.V]/Dest (0:2805) cvn /DEST pdfmark end
 -2 2682 a 396 2761 a
Fe(bstarsrv)44 b(-p)224 b(#)44 b(Start)g(primary)396
2858 y(bstarsrv)g(-b)224 b(#)44 b(Start)g(backup)396
2955 y(bstarcli)-2 3122 y
SDict begin H.S end
 -2 3122 a -2 3122 a
SDict begin 13 H.A end
 -2 3122
a -2 3122 a
SDict begin [/View [/XYZ H.V]/Dest (0:2806) cvn /DEST pdfmark end
 -2 3122 a 396 3229 a Fk(Y)-9 b(ou)20 b(can)g(then)g(pro)o
(v)n(ok)o(e)e(f)o(ail-o)o(v)o(er)g(by)i(killing)f(the)i(primary)d(serv)
o(er)m(,)h(and)h(reco)o(v)o(ery)d(by)j(restarting)f(the)h(primary)f
(and)396 3337 y(killing)h(the)g(backup.)e(Note)j(ho)n(w)e(it')-5
b(s)21 b(the)g(client)f(v)n(ote)g(that)g(triggers)g(f)o(ail-o)o(v)o(er)
m(,)d(and)j(reco)o(v)o(ery)-5 b(.)-2 3521 y
SDict begin H.S end
 -2 3521 a
-2 3521 a
SDict begin 13 H.A end
 -2 3521 a -2 3521 a
SDict begin [/View [/XYZ H.V]/Dest (0:2807) cvn /DEST pdfmark end
 -2 3521 a 396 3611 a Fk(Binary)20
b(star)h(is)g(dri)n(v)o(en)d(by)i(a)h(\002nite)f(state)h(machine\()p
0 TeXcolorgray 1926 3611 a
SDict begin H.S end
 1926 3611 a Fk(Figure)d(4-8)2274
3611 y
SDict begin 13 H.L end
 2274 3611 a 2274 3611 a
SDict begin [/Subtype /Link/Dest (0:figure-61) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2274 3611 a Black -2 w
Fk(\).)i(States)h(in)g(green)e(accept)h(client)g(requests,)g(states)h
(in)396 3719 y(pink)e(refuse)g(them.)g(Ev)o(ents)g(are)g(the)h(peer)f
(state,)h(so)g("Peer)f(Acti)n(v)o(e")g(means)h(the)f(other)g(serv)o(er)
g(has)h(told)f(us)h(it')-5 b(s)20 b(acti)n(v)o(e.)396
3827 y("Client)h(Request")f(means)g(we')l(v)o(e)f(recei)n(v)o(ed)g(a)h
(client)h(request.)e("Client)h(V)-11 b(ote")21 b(means)f(we')l(v)o(e)f
(recei)n(v)o(ed)f(a)j(client)396 3935 y(request)f(AND)g(our)g(peer)f
(is)j(inacti)n(v)o(e)d(for)g(tw)o(o)i(heartbeats.)-2
3953 y
SDict begin H.S end
 -2 3953 a -2 3953 a
SDict begin 13 H.A end
 -2 3953 a -2 3953 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-61) cvn /DEST pdfmark
end
 -2 3953
a Black 3759 5569 a Ff(223)p Black eop end
%%Page: 224 237
TeXDict begin 224 236 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.224) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-8.)f(Binary)h(Star)g(Finite)g(State)g
(Machine)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2811) cvn /DEST pdfmark end

-2 172 a 396 1506 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1506 a @beginspecial 0 @llx -155
@lly 312 @urx 0 @ury 3120 @rwi @setspecial
%%BeginDocument: images/fig61.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -155 312 0
%%HiResBoundingBox: 0.0 -155.0 312.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
11.200119972229004 -28.20012092590332 moveto
11.200119972229004 -53.20011901855469 lineto
59.20011901855469 -53.20011901855469 lineto
59.20011901855469 -28.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
131.2001190185547 -28.20012092590332 moveto
131.2001190185547 -53.20011901855469 lineto
179.2001190185547 -53.20011901855469 lineto
179.2001190185547 -28.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
255.2001190185547 -28.20012092590332 moveto
255.2001190185547 -53.20011901855469 lineto
303.20013427734375 -53.20011901855469 lineto
303.20013427734375 -28.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
131.2001190185547 -118.20011901855469 moveto
131.2001190185547 -143.2001190185547 lineto
179.2001190185547 -143.2001190185547 lineto
179.2001190185547 -118.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
131.2001190185547 -73.20011901855469 moveto
131.2001190185547 -98.20011901855469 lineto
179.2001190185547 -98.20011901855469 lineto
179.2001190185547 -73.20011901855469 lineto
closepath
fill
0.5647058823529412 0.9411764705882353 0.6901960784313725 setrgbcolor
newpath
10.0 -27.0 moveto
10.0 -52.0 lineto
58.0 -52.0 lineto
58.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.4 setlinewidth
1 setlinecap
[] 0 setdash
newpath
10.0 -27.0 moveto
10.0 -52.0 lineto
58.0 -52.0 lineto
58.0 -27.0 lineto
closepath
stroke
0.5647058823529412 0.9411764705882353 0.6901960784313725 setrgbcolor
newpath
130.0 -27.0 moveto
130.0 -52.0 lineto
178.0 -52.0 lineto
178.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -27.0 moveto
130.0 -52.0 lineto
178.0 -52.0 lineto
178.0 -27.0 lineto
closepath
stroke
0.9411764705882353 0.5647058823529412 0.6901960784313725 setrgbcolor
newpath
254.0 -27.0 moveto
254.0 -52.0 lineto
302.0 -52.0 lineto
302.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
254.0 -27.0 moveto
254.0 -52.0 lineto
302.0 -52.0 lineto
302.0 -27.0 lineto
closepath
stroke
0.9411764705882353 0.5647058823529412 0.6901960784313725 setrgbcolor
newpath
130.0 -117.0 moveto
130.0 -142.0 lineto
178.0 -142.0 lineto
178.0 -117.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -117.0 moveto
130.0 -142.0 lineto
178.0 -142.0 lineto
178.0 -117.0 lineto
closepath
stroke
0.9411764705882353 0.0 0.0 setrgbcolor
newpath
130.0 -72.0 moveto
130.0 -97.0 lineto
178.0 -97.0 lineto
178.0 -72.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
130.0 -72.0 moveto
130.0 -97.0 lineto
178.0 -97.0 lineto
178.0 -72.0 lineto
closepath
stroke
newpath
34.0 -15.0 moveto
34.0 -22.0 lineto
stroke
newpath
278.0 -15.0 moveto
278.0 -22.0 lineto
stroke
newpath
146.0 -22.0 moveto
146.0 -15.0 lineto
146.0 -13.0 145.33333333333334 -12.0 144.0 -12.0 curveto
52.0 -12.0 lineto
52.0 -12.0 lineto
50.666666666666664 -12.0 50.0 -13.0 50.0 -15.0 curveto
50.0 -27.0 lineto
50.0 -27.0 lineto
stroke
newpath
58.0 -37.0 moveto
126.0 -37.0 lineto
stroke
newpath
34.0 -52.0 moveto
34.0 -130.0 lineto
34.0 -131.33333333333334 34.666666666666664 -132.0 36.0 -132.0 curveto
126.0 -132.0 lineto
126.0 -132.0 lineto
stroke
newpath
278.0 -52.0 moveto
278.0 -130.0 lineto
278.0 -131.33333333333334 277.3333333333333 -132.0 276.0 -132.0 curveto
182.0 -132.0 lineto
182.0 -132.0 lineto
stroke
newpath
182.0 -37.0 moveto
240.0 -37.0 lineto
241.33333333333334 -37.0 242.0 -38.0 242.0 -40.0 curveto
242.0 -125.0 lineto
242.0 -125.0 lineto
242.0 -126.33333333333333 241.33333333333334 -127.0 240.0 -127.0 curveto
178.0 -127.0 lineto
178.0 -127.0 lineto
stroke
newpath
126.0 -42.0 moveto
100.0 -42.0 lineto
98.66666666666667 -42.0 98.0 -43.0 98.0 -45.0 curveto
98.0 -125.0 lineto
98.0 -125.0 lineto
98.0 -126.33333333333333 98.66666666666667 -127.0 100.0 -127.0 curveto
130.0 -127.0 lineto
130.0 -127.0 lineto
stroke
newpath
182.0 -42.0 moveto
204.0 -42.0 lineto
205.33333333333334 -42.0 206.0 -43.0 206.0 -45.0 curveto
206.0 -120.0 lineto
206.0 -120.0 lineto
206.0 -121.33333333333333 205.33333333333334 -122.0 204.0 -122.0 curveto
178.0 -122.0 lineto
178.0 -122.0 lineto
stroke
newpath
154.0 -102.0 moveto
154.0 -117.0 lineto
stroke
newpath
32.0 -20.0 moveto
34.0 -25.0 lineto
36.0 -20.0 lineto
closepath
fill
newpath
144.0 -20.0 moveto
146.0 -25.0 lineto
148.0 -20.0 lineto
closepath
fill
newpath
160.0 -20.0 moveto
162.0 -25.0 lineto
164.0 -20.0 lineto
closepath
fill
newpath
276.0 -20.0 moveto
278.0 -25.0 lineto
280.0 -20.0 lineto
closepath
fill
newpath
124.0 -35.0 moveto
128.0 -37.0 lineto
124.0 -40.0 lineto
closepath
fill
newpath
184.0 -35.0 moveto
180.0 -37.0 lineto
184.0 -40.0 lineto
closepath
fill
newpath
124.0 -40.0 moveto
128.0 -42.0 lineto
124.0 -45.0 lineto
closepath
fill
newpath
184.0 -40.0 moveto
180.0 -42.0 lineto
184.0 -45.0 lineto
closepath
fill
newpath
152.0 -65.0 moveto
154.0 -70.0 lineto
156.0 -65.0 lineto
closepath
fill
newpath
154.0 -100.0 moveto
152.0 -105.0 lineto
156.0 -105.0 lineto
closepath
fill
newpath
124.0 -130.0 moveto
128.0 -132.0 lineto
124.0 -135.0 lineto
closepath
fill
newpath
184.0 -130.0 moveto
180.0 -132.0 lineto
184.0 -135.0 lineto
closepath
fill
newpath
162.0 -22.0 moveto
162.0 -15.0 lineto
162.0 -13.0 162.66666666666666 -12.0 164.0 -12.0 curveto
204.0 -12.0 lineto
204.0 -12.0 lineto
205.33333333333334 -12.0 206.0 -13.0 206.0 -15.0 curveto
206.0 -30.0 lineto
206.0 -30.0 lineto
206.0 -31.333333333333332 205.33333333333334 -32.0 204.0 -32.0 curveto
178.0 -32.0 lineto
178.0 -32.0 lineto
stroke
newpath
154.0 -67.0 moveto
154.0 -52.0 lineto
stroke
/Helvetica findfont
4 scalefont setfont
28.0 -14.0 moveto
(Start) show
272.0 -14.0 moveto
(Start) show
64.0 -19.0 moveto
(Client Request) show
192.0 -19.0 moveto
(Client Request) show
72.0 -34.0 moveto
(Peer Backup) show
25.0 -39.0 moveto
(Primary) show
145.0 -39.0 moveto
(Active) show
268.0 -39.0 moveto
(Backup) show
25.0 -64.0 moveto
(Peer Active) show
145.0 -64.0 moveto
(Peer Active) show
269.0 -64.0 moveto
(Peer Active) show
88.0 -84.0 moveto
(Peer Backup) show
145.0 -84.0 moveto
(Error!) show
197.0 -84.0 moveto
(Peer Primary) show
146.0 -109.0 moveto
(Peer Passive) show
226.0 -109.0 moveto
(Client Vote) show
146.0 -129.0 moveto
(Passive) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1506 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1506 a 274 x Fk(Note)g(that)h(the)f(serv)o
(ers)g(use)g(PUB-SUB)h(sock)o(ets)g(for)e(state)i(e)o(xchange.)d(No)i
(other)f(sock)o(et)i(combination)c(will)k(w)o(ork)396
1887 y(here.)f(PUSH)h(and)e(DEALER)h(block)g(if)g(there)g(is)h(no)f
(peer)f(ready)h(to)g(recei)n(v)o(e)f(a)i(message.)e(P)-8
b(AIR)22 b(does)e(not)f(reconnect)396 1995 y(if)i(the)f(peer)g
(disappears)f(and)g(comes)h(back.)g(R)m(OUTER)g(needs)g(the)g(address)g
(of)g(the)g(peer)g(before)e(it)j(can)f(send)g(it)h(a)396
2103 y(message.)-2 2287 y
SDict begin H.S end
 -2 2287 a -2 2287 a
SDict begin 13 H.A end
 -2 2287
a -2 2287 a
SDict begin [/View [/XYZ H.V]/Dest (0:2815) cvn /DEST pdfmark end
 -2 2287 a 396 2377 a Fk(These)f(are)g(the)h(main)e
(limitations)h(of)g(the)h(Binary)e(Star)i(pattern:)-2
2395 y
SDict begin H.S end
 -2 2395 a -2 2395 a
SDict begin 13 H.A end
 -2 2395 a -2 2395 a
SDict begin [/View [/XYZ H.V]/Dest (0:2816) cvn /DEST pdfmark end
 -2 2395
a -2 2405 a
SDict begin H.S end
 -2 2405 a -2 2405 a
SDict begin 13 H.A end
 -2 2405 a -2 2405 a
SDict begin [/View [/XYZ H.V]/Dest (0:2817) cvn /DEST pdfmark end
 -2
2405 a Black 396 2547 a Fj(\225)p Black 479 2547 a
SDict begin H.S end
 479
2547 a 479 2547 a
SDict begin 13 H.A end
 479 2547 a 479 2547 a
SDict begin [/View [/XYZ H.V]/Dest (0:2818) cvn /DEST pdfmark end
 479 2547 a Fk(A)g(serv)o(er)e
(process)h(cannot)f(be)h(part)g(of)g(more)f(than)h(one)g(Binary)f(Star)
i(pair)-5 b(.)-2 2565 y
SDict begin H.S end
 -2 2565 a -2 2565 a
SDict begin 13 H.A end
 -2 2565 a
-2 2565 a
SDict begin [/View [/XYZ H.V]/Dest (0:2819) cvn /DEST pdfmark end
 -2 2565 a Black 396 2697 a Fj(\225)p Black
479 2697 a
SDict begin H.S end
 479 2697 a 479 2697 a
SDict begin 13 H.A end
 479 2697 a 479 2697
a
SDict begin [/View [/XYZ H.V]/Dest (0:2820) cvn /DEST pdfmark end
 479 2697 a Fk(A)21 b(primary)e(serv)o(er)g(can)h(ha)n(v)o(e)f(a)i
(single)f(backup)f(serv)o(er)m(,)f(no)i(more.)-2 2715
y
SDict begin H.S end
 -2 2715 a -2 2715 a
SDict begin 13 H.A end
 -2 2715 a -2 2715 a
SDict begin [/View [/XYZ H.V]/Dest (0:2821) cvn /DEST pdfmark end
 -2 2715 a Black
396 2846 a Fj(\225)p Black 479 2846 a
SDict begin H.S end
 479 2846 a 479
2846 a
SDict begin 13 H.A end
 479 2846 a 479 2846 a
SDict begin [/View [/XYZ H.V]/Dest (0:2822) cvn /DEST pdfmark end
 479 2846 a Fk(The)g(backup)f(serv)o(er)g
(cannot)g(do)h(useful)g(w)o(ork)f(while)h(in)h(sla)n(v)o(e)f(mode.)-2
2864 y
SDict begin H.S end
 -2 2864 a -2 2864 a
SDict begin 13 H.A end
 -2 2864 a -2 2864 a
SDict begin [/View [/XYZ H.V]/Dest (0:2823) cvn /DEST pdfmark end
 -2 2864
a Black 396 2996 a Fj(\225)p Black 479 2996 a
SDict begin H.S end
 479 2996
a 479 2996 a
SDict begin 13 H.A end
 479 2996 a 479 2996 a
SDict begin [/View [/XYZ H.V]/Dest (0:2824) cvn /DEST pdfmark end
 479 2996 a Fk(The)g(backup)f(serv)o
(er)g(must)h(be)g(capable)g(of)g(handling)e(full)i(application)f
(loads.)-2 3014 y
SDict begin H.S end
 -2 3014 a -2 3014 a
SDict begin 13 H.A end
 -2 3014 a -2 3014
a
SDict begin [/View [/XYZ H.V]/Dest (0:2825) cvn /DEST pdfmark end
 -2 3014 a Black 396 3145 a Fj(\225)p Black 479 3145
a
SDict begin H.S end
 479 3145 a 479 3145 a
SDict begin 13 H.A end
 479 3145 a 479 3145 a
SDict begin [/View [/XYZ H.V]/Dest (0:2826) cvn /DEST pdfmark end
 479 3145
a Fk(F)o(ailo)o(v)o(er)g(con\002guration)f(cannot)h(be)h(modi\002ed)f
(at)h(runtime.)-2 3163 y
SDict begin H.S end
 -2 3163 a -2 3163 a
SDict begin 13 H.A end
 -2 3163
a -2 3163 a
SDict begin [/View [/XYZ H.V]/Dest (0:2827) cvn /DEST pdfmark end
 -2 3163 a Black 396 3295 a Fj(\225)p Black
479 3295 a
SDict begin H.S end
 479 3295 a 479 3295 a
SDict begin 13 H.A end
 479 3295 a 479 3295
a
SDict begin [/View [/XYZ H.V]/Dest (0:2828) cvn /DEST pdfmark end
 479 3295 a Fk(Client)h(applications)e(must)h(do)g(some)g(w)o(ork)g
(to)g(bene\002t)g(from)f(f)o(ail-o)o(v)o(er)-5 b(.)-2
3354 y
SDict begin H.S end
 -2 3354 a -2 3354 a
SDict begin 13 H.A end
 -2 3354 a -2 3354 a
SDict begin [/View [/XYZ H.V]/Dest (0:2829) cvn /DEST pdfmark end
 -2 3354
a 396 3664 a Fb(4.13.5.)36 b(Binar)q(y)f(Star)d(Reactor)1911
3664 y
SDict begin H.S end
 1911 3664 a 1911 3664 a
SDict begin 18.72 H.A end
 1911 3664 a 1911 3664
a
SDict begin [/View [/XYZ H.V]/Dest (9.67.17.2) cvn /DEST pdfmark end
 1911 3664 a -2 3855 a
SDict begin H.S end
 -2 3855 a -2 3855 a
SDict begin 13 H.A end
 -2 3855 a
-2 3855 a
SDict begin [/View [/XYZ H.V]/Dest (0:2831) cvn /DEST pdfmark end
 -2 3855 a 396 3938 a Fk(Binary)20 b(Star)h(is)g(useful)e(and)
h(generic)f(enough)f(to)j(package)d(up)i(as)h(a)g(reusable)e(reactor)g
(class.)i(The)f(reactor)f(then)h(runs)396 4046 y(and)g(calls)h(our)e
(code)h(whene)n(v)o(er)e(it)j(has)f(a)h(message)f(to)g(process.)g(This)
g(is)h(much)e(nicer)h(than)g(cop)o(ying/pasting)d(the)396
4154 y(Binary)j(Star)h(code)e(into)h(each)g(serv)o(er)f(where)h(we)g(w)
o(ant)h(that)f(capability)-5 b(.)18 b(In)i(C)h(we)g(wrap)f(the)g(CZMQ)
3405 4154 y
SDict begin H.S end
 3405 4154 a 3405 4154 a
SDict begin 13 H.A end
 3405 4154 a 3405
4154 a
SDict begin [/View [/XYZ H.V]/Dest (0:2832) cvn /DEST pdfmark end
 3405 4154 a Fe(zloop)f Fk(class,)396 4262 y(though)g(your)g
(mileage)g(may)h(v)n(ary)f(in)h(other)g(languages.)e(Here)i(is)i(the)
2465 4262 y
SDict begin H.S end
 2465 4262 a 2465 4262 a
SDict begin 13 H.A end
 2465 4262 a 2465
4262 a
SDict begin [/View [/XYZ H.V]/Dest (0:2833) cvn /DEST pdfmark end
 2465 4262 a Fe(bstar)e Fk(interf)o(ace)f(in)h(C:)-2
4363 y
SDict begin H.S end
 -2 4363 a -2 4363 a
SDict begin 11.7 H.A end
 -2 4363 a -2 4363 a
SDict begin [/View [/XYZ H.V]/Dest (0:2834) cvn /DEST pdfmark end
 -2 4363
a 396 4442 a Fe(//)90 b(Create)43 b(a)i(new)f(Binary)g(Star)g
(instance,)g(using)g(local)g(\(bind\))g(and)396 4539
y(//)90 b(remote)43 b(\(connect\))h(endpoints)f(to)i(set-up)e(the)i
(server)f(peering.)396 4636 y(bstar_t)755 4649 y(*)800
4636 y(bstar_new)f(\(int)h(primary,)g(char)2100 4649
y(*)2145 4636 y(local,)g(char)2683 4649 y(*)2728 4636
y(remote\);)396 4831 y(//)90 b(Destroy)43 b(a)i(Binary)f(Star)g
(instance)396 4928 y(void)g(bstar_destroy)f(\(bstar_t)1652
4941 y(**)1742 4928 y(self_p\);)396 5122 y(//)90 b(Return)43
b(underlying)h(zloop)g(reactor,)f(for)h(timer)g(and)h(reader)p
Black 3759 5569 a Ff(224)p Black eop end
%%Page: 225 238
TeXDict begin 225 237 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.225) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(//)90 b(registration)42 b(and)j(cancelation.)396
170 y(zloop_t)755 183 y(*)800 170 y(bstar_zloop)e(\(bstar_t)1741
183 y(*)1786 170 y(self\);)396 364 y(//)90 b(Register)43
b(voting)h(reader)396 461 y(int)h(bstar_voter)e(\(bstar_t)1517
474 y(*)1562 461 y(self,)h(char)2055 474 y(*)2100 461
y(endpoint,)f(int)i(type,)1158 558 y(zloop_fn)f(handler,)f(void)2190
571 y(*)2235 558 y(arg\);)396 752 y(//)90 b(Register)43
b(main)h(state)g(change)g(handlers)396 850 y(void)g(bstar_new_master)f
(\(bstar_t)1786 863 y(*)1831 850 y(self,)h(zloop_fn)f(handler,)h(void)
3131 863 y(*)3176 850 y(arg\);)396 947 y(void)g(bstar_new_slave)f
(\(bstar_t)1741 960 y(*)1786 947 y(self,)h(zloop_fn)g(handler,)f(void)
3086 960 y(*)3131 947 y(arg\);)396 1141 y(//)90 b(Start)44
b(the)g(reactor,)f(ends)i(if)f(a)h(callback)e(function)h(returns)f(-1,)
i(or)f(the)396 1238 y(//)90 b(process)43 b(received)h(SIGINT)g(or)g
(SIGTERM.)396 1335 y(int)h(bstar_start)e(\(bstar_t)1517
1348 y(*)1562 1335 y(self\);)-2 1511 y
SDict begin H.S end
 -2 1511 a -2 1511
a
SDict begin 13 H.A end
 -2 1511 a -2 1511 a
SDict begin [/View [/XYZ H.V]/Dest (0:2835) cvn /DEST pdfmark end
 -2 1511 a 396 1609 a Fk(And)20
b(here)g(is)h(the)f(class)h(implementation:)-2 1627 y
SDict begin H.S end

-2 1627 a -2 1627 a
SDict begin 13 H.A end
 -2 1627 a -2 1627 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c) cvn /DEST pdfmark end
 -2 1627 a 396
1811 a Fg(Example)g(4-68.)d(Binary)j(Star)f(cor)o(e)f(class)i(\(bstar)
-8 b(.c\))-2 1910 y
SDict begin H.S end
 -2 1910 a -2 1910 a
SDict begin 11.7 H.A end
 -2 1910 a -2
1910 a
SDict begin [/View [/XYZ H.V]/Dest (0:2838) cvn /DEST pdfmark end
 -2 1910 a 396 1991 a Fe(/)441 2004 y(*)576 1991
y(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)441 2101 y(*)576 2088 y(bstar)44
b(-)g(Binary)g(Star)g(reactor)441 2198 y(*)576 2185 y
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 2198 y(*)3759 2185 y(/)396
2379 y(#include)g("bstar.h")396 2574 y(//)90 b(States)43
b(we)i(can)f(be)h(in)f(at)h(any)f(point)g(in)h(time)396
2671 y(typedef)f(enum)g({)576 2768 y(STATE_PRIMARY)e(=)j(1,)448
b(//)89 b(Primary,)44 b(waiting)f(for)i(peer)f(to)g(connect)576
2865 y(STATE_BACKUP)e(=)j(2,)493 b(//)89 b(Backup,)44
b(waiting)g(for)g(peer)g(to)h(connect)576 2962 y(STATE_ACTIVE)d(=)j(3,)
493 b(//)89 b(Active)44 b(-)h(accepting)e(connections)576
3059 y(STATE_PASSIVE)f(=)j(4)493 b(//)89 b(Passive)44
b(-)h(not)f(accepting)f(connections)396 3156 y(})i(state_t;)396
3351 y(//)90 b(Events,)43 b(which)h(start)g(with)g(the)h(states)f(our)g
(peer)g(can)g(be)h(in)396 3448 y(typedef)f(enum)g({)576
3545 y(PEER_PRIMARY)e(=)j(1,)493 b(//)89 b(HA)45 b(peer)f(is)g(pending)
g(primary)576 3642 y(PEER_BACKUP)f(=)h(2,)538 b(//)89
b(HA)45 b(peer)f(is)g(pending)g(backup)576 3739 y(PEER_ACTIVE)f(=)h(3,)
538 b(//)89 b(HA)45 b(peer)f(is)g(active)576 3836 y(PEER_PASSIVE)e(=)j
(4,)493 b(//)89 b(HA)45 b(peer)f(is)g(passive)576 3933
y(CLIENT_REQUEST)e(=)j(5)448 b(//)89 b(Client)44 b(makes)g(request)396
4031 y(})h(event_t;)396 4225 y(//)90 b(Structure)43 b(of)h(our)h(class)
396 4419 y(struct)f(_bstar_t)g({)576 4516 y(zctx_t)889
4529 y(*)934 4516 y(ctx;)717 b(//)89 b(Our)45 b(private)e(context)576
4613 y(zloop_t)934 4626 y(*)979 4613 y(loop;)627 b(//)89
b(Reactor)44 b(loop)576 4711 y(void)800 4724 y(*)845
4711 y(statepub;)581 b(//)89 b(State)44 b(publisher)576
4808 y(void)800 4821 y(*)845 4808 y(statesub;)581 b(//)89
b(State)44 b(subscriber)576 4905 y(state_t)f(state;)627
b(//)89 b(Current)44 b(state)576 5002 y(event_t)f(event;)627
b(//)89 b(Current)44 b(event)576 5099 y(int64_t)f(peer_expiry;)357
b(//)89 b(When)44 b(peer)h(is)f(considered)f('dead')p
Black 3759 5569 a Ff(225)p Black eop end
%%Page: 226 239
TeXDict begin 226 238 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.226) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(zloop_fn)979 85 y(*)1024 72 y(voter_fn;)402
b(//)89 b(Voting)44 b(socket)g(handler)576 170 y(void)800
183 y(*)845 170 y(voter_arg;)536 b(//)89 b(Arguments)44
b(for)g(voting)g(handler)576 267 y(zloop_fn)979 280 y(*)1024
267 y(master_fn;)357 b(//)89 b(Call)44 b(when)h(become)e(master)576
364 y(void)800 377 y(*)845 364 y(master_arg;)491 b(//)89
b(Arguments)44 b(for)g(handler)576 461 y(zloop_fn)979
474 y(*)1024 461 y(slave_fn;)402 b(//)89 b(Call)44 b(when)h(become)e
(slave)576 558 y(void)800 571 y(*)845 558 y(slave_arg;)536
b(//)89 b(Arguments)44 b(for)g(handler)396 655 y(};)396
850 y(//)90 b(The)44 b(finite-state)f(machine)g(is)i(the)f(same)g(as)h
(in)f(the)h(proof-of-concept)d(server.)396 947 y(//)90
b(To)44 b(understand)f(this)h(reactor)g(in)h(detail,)e(first)h(read)g
(the)h(CZMQ)f(zloop)g(class.)396 1044 y(...)-2 1211 y
SDict begin H.S end

-2 1211 a -2 1211 a
SDict begin 13 H.A end
 -2 1211 a -2 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:2839) cvn /DEST pdfmark end
 -2 1211 a 396
1318 a Fk(This)21 b(is)g(the)f(constructor)e(for)i(our)f(bstar)h
(class.)h(W)-7 b(e)22 b(ha)n(v)o(e)d(to)i(tell)f(it)h(whether)e(we')l
(re)h(primary)f(or)h(backup)e(serv)o(er)m(,)h(and)396
1426 y(our)h(local)g(and)f(remote)h(endpoints)e(to)j(bind)e(and)h
(connect)f(to:)-2 1444 y
SDict begin H.S end
 -2 1444 a -2 1444 a
SDict begin 13 H.A end
 -2 1444
a -2 1444 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-1) cvn /DEST pdfmark
end
 -2 1444 a 396 1627 a Fg(Example)i(4-69.)d(Binary)j(Star)f
(cor)o(e)f(class)i(\(bstar)-8 b(.c\))19 b(-)h(constructor)-2
1727 y
SDict begin H.S end
 -2 1727 a -2 1727 a
SDict begin 11.7 H.A end
 -2 1727 a -2 1727 a
SDict begin [/View [/XYZ H.V]/Dest (0:2842) cvn /DEST pdfmark end
 -2 1727
a 396 1807 a Fe(bstar_t)755 1820 y(*)396 1904 y(bstar_new)44
b(\(int)g(primary,)f(char)1696 1917 y(*)1741 1904 y(local,)h(char)2279
1917 y(*)2324 1904 y(remote\))396 2001 y({)576 2099 y(bstar_t)755
2209 y(*)800 2196 y(self;)576 2390 y(self)g(=)g(\(bstar_t)1293
2403 y(*)1338 2390 y(\))g(zmalloc)g(\(sizeof)g(\(bstar_t\)\);)576
2584 y(//)89 b(Initialize)43 b(the)h(Binary)g(Star)576
2681 y(self->ctx)f(=)i(zctx_new)e(\(\);)576 2779 y(self->loop)g(=)h
(zloop_new)g(\(\);)576 2876 y(self->state)f(=)h(primary?)g
(STATE_PRIMARY:)e(STATE_BACKUP;)576 3070 y(//)89 b(Create)44
b(publisher)f(for)h(state)g(going)g(to)h(peer)576 3167
y(self->statepub)d(=)j(zsocket_new)e(\(self->ctx,)g(ZMQ_PUB\);)576
3264 y(zsocket_bind)f(\(self->statepub,)h(local\);)576
3459 y(//)89 b(Create)44 b(subscriber)f(for)h(state)g(coming)g(from)g
(peer)576 3556 y(self->statesub)e(=)j(zsocket_new)e(\(self->ctx,)g
(ZMQ_SUB\);)576 3653 y(zsockopt_set_subscribe)e(\(self->statesub,)h
(""\);)576 3750 y(zsocket_connect)g(\(self->statesub,)g(remote\);)576
3944 y(//)89 b(Set-up)44 b(basic)g(reactor)f(events)576
4041 y(zloop_timer)g(\(self->loop,)f(BSTAR_HEARTBEAT,)h(0,)h
(s_send_state,)f(self\);)576 4138 y(zmq_pollitem_t)f(poller)i(=)h({)f
(self->statesub,)f(0,)h(ZMQ_POLLIN)f(};)576 4236 y(zloop_poller)f
(\(self->loop,)h(&poller,)h(s_recv_state,)e(self\);)576
4333 y(return)h(self;)396 4430 y(})-2 4604 y
SDict begin H.S end
 -2 4604
a -2 4604 a
SDict begin 13 H.A end
 -2 4604 a -2 4604 a
SDict begin [/View [/XYZ H.V]/Dest (0:2843) cvn /DEST pdfmark end
 -2 4604 a 396 4704 a
Fk(The)20 b(destructor)f(shuts)h(do)n(wn)f(the)i(bstar)f(reactor:)-2
4705 y
SDict begin H.S end
 -2 4705 a -2 4705 a
SDict begin 13 H.A end
 -2 4705 a -2 4705 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-2) cvn /DEST pdfmark
end
 -2 4705
a Black 3757 5569 a Ff(226)p Black eop end
%%Page: 227 240
TeXDict begin 227 239 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.227) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-70.)d(Binary)j(Star)f(cor)o(e)f(class)i
(\(bstar)-8 b(.c\))19 b(-)h(destructor)-2 172 y
SDict begin H.S end
 -2 172
a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2846) cvn /DEST pdfmark end
 -2 172 a 396 447 a Fe(void)396
544 y(bstar_destroy)43 b(\(bstar_t)1427 557 y(**)1517
544 y(self_p\))396 641 y({)576 738 y(assert)g(\(self_p\);)576
835 y(if)h(\()755 848 y(*)800 835 y(self_p\))f({)755
933 y(bstar_t)1114 946 y(*)1159 933 y(self)h(=)1472 946
y(*)1517 933 y(self_p;)755 1030 y(zloop_destroy)f(\(&self->loop\);)755
1127 y(zctx_destroy)g(\(&self->ctx\);)755 1224 y(free)h(\(self\);)755
1334 y(*)800 1321 y(self_p)g(=)g(NULL;)576 1418 y(})396
1515 y(})-2 1690 y
SDict begin H.S end
 -2 1690 a -2 1690 a
SDict begin 13 H.A end
 -2 1690 a -2 1690
a
SDict begin [/View [/XYZ H.V]/Dest (0:2847) cvn /DEST pdfmark end
 -2 1690 a 396 1789 a Fk(The)20 b(zloop)f(method)g(returns)g(the)i
(underlying)c(zloop)i(reactor)m(,)g(so)i(we)f(can)g(add)g(additional)f
(timers)h(and)g(readers:)-2 1807 y
SDict begin H.S end
 -2 1807 a -2 1807
a
SDict begin 13 H.A end
 -2 1807 a -2 1807 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-3) cvn /DEST pdfmark
end
 -2 1807 a 396 1991 a Fg(Example)h(4-71.)d(Binary)
j(Star)f(cor)o(e)f(class)i(\(bstar)-8 b(.c\))19 b(-)h(zloop)g(method)-2
2091 y
SDict begin H.S end
 -2 2091 a -2 2091 a
SDict begin 11.7 H.A end
 -2 2091 a -2 2091 a
SDict begin [/View [/XYZ H.V]/Dest (0:2850) cvn /DEST pdfmark end
 -2 2091
a 396 2365 a Fe(zloop_t)755 2378 y(*)396 2462 y(bstar_zloop)43
b(\(bstar_t)1338 2475 y(*)1383 2462 y(self\))396 2559
y({)576 2657 y(return)g(self->loop;)396 2754 y(})-2 2928
y
SDict begin H.S end
 -2 2928 a -2 2928 a
SDict begin 13 H.A end
 -2 2928 a -2 2928 a
SDict begin [/View [/XYZ H.V]/Dest (0:2851) cvn /DEST pdfmark end
 -2 2928 a 396
3028 a Fk(The)20 b(v)n(oter)g(method)f(re)o(gisters)g(a)i(client)f(v)n
(oter)g(sock)o(et.)g(Messages)g(recei)n(v)o(ed)f(on)h(this)g(sock)o(et)
g(pro)o(vide)f(the)396 3136 y(CLIENT_REQ)o(UEST)g(e)n(v)o(ents)h(for)g
(the)g(Binary)f(Star)i(FSM)g(and)f(are)g(passed)g(to)g(the)g(pro)o
(vided)e(application)h(handler)-5 b(.)396 3244 y(W)e(e)22
b(require)c(e)o(xactly)i(one)f(v)n(oter)h(per)g(bstar)g(instance:)-2
3261 y
SDict begin H.S end
 -2 3261 a -2 3261 a
SDict begin 13 H.A end
 -2 3261 a -2 3261 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-4) cvn /DEST pdfmark
end
 -2 3261
a 396 3445 a Fg(Example)h(4-72.)d(Binary)j(Star)f(cor)o(e)f(class)i
(\(bstar)-8 b(.c\))19 b(-)h(v)o(oter)f(method)-2 3545
y
SDict begin H.S end
 -2 3545 a -2 3545 a
SDict begin 11.7 H.A end
 -2 3545 a -2 3545 a
SDict begin [/View [/XYZ H.V]/Dest (0:2854) cvn /DEST pdfmark end
 -2 3545 a 396
3819 a Fe(int)396 3916 y(bstar_voter)43 b(\(bstar_t)1338
3929 y(*)1383 3916 y(self,)h(char)1876 3929 y(*)1921
3916 y(endpoint,)f(int)h(type,)g(zloop_fn)g(handler,)979
4014 y(void)1203 4027 y(*)1248 4014 y(arg\))396 4111
y({)576 4208 y(//)89 b(Hold)44 b(actual)g(handler+arg)f(so)h(we)h(can)f
(call)g(this)h(later)576 4305 y(void)800 4318 y(*)845
4305 y(socket)e(=)i(zsocket_new)e(\(self->ctx,)g(type\);)576
4402 y(zsocket_bind)f(\(socket,)i(endpoint\);)576 4499
y(assert)f(\(!self->voter_fn\);)576 4596 y(self->voter_fn)f(=)j
(handler;)576 4693 y(self->voter_arg)d(=)j(arg;)576 4791
y(zmq_pollitem_t)d(poller)i(=)h({)f(socket,)g(0,)g(ZMQ_POLLIN)g(};)576
4888 y(return)f(zloop_poller)g(\(self->loop,)g(&poller,)h
(s_voter_ready,)e(self\);)396 4985 y(})p Black 3756 5569
a Ff(227)p Black eop end
%%Page: 228 241
TeXDict begin 228 240 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.228) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2855) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Re)o(gister)g(handlers)g(to)g(be)g(called)g(each)g
(time)g(there')-5 b(s)20 b(a)h(state)g(change:)-2 90
y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-5) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)g(4-73.)
d(Binary)j(Star)f(cor)o(e)f(class)i(\(bstar)-8 b(.c\))19
b(-)h(r)o(egister)f(state-change)g(handlers)-2 374 y
SDict begin H.S end

-2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:2858) cvn /DEST pdfmark end
 -2 374 a 396 551
a Fe(void)396 648 y(bstar_new_master)42 b(\(bstar_t)1562
661 y(*)1607 648 y(self,)i(zloop_fn)f(handler,)h(void)2907
661 y(*)2952 648 y(arg\))396 745 y({)576 843 y(assert)f
(\(!self->master_fn\);)576 940 y(self->master_fn)f(=)j(handler;)576
1037 y(self->master_arg)d(=)i(arg;)396 1134 y(})396 1328
y(void)396 1425 y(bstar_new_slave)f(\(bstar_t)1517 1438
y(*)1562 1425 y(self,)h(zloop_fn)f(handler,)h(void)2862
1438 y(*)2907 1425 y(arg\))396 1522 y({)576 1620 y(assert)f
(\(!self->slave_fn\);)576 1717 y(self->slave_fn)f(=)j(handler;)576
1814 y(self->slave_arg)d(=)j(arg;)396 1911 y(})-2 2085
y
SDict begin H.S end
 -2 2085 a -2 2085 a
SDict begin 13 H.A end
 -2 2085 a -2 2085 a
SDict begin [/View [/XYZ H.V]/Dest (0:2859) cvn /DEST pdfmark end
 -2 2085 a 396
2185 a Fk(Enable/disable)19 b(v)o(erbose)g(tracing,)g(for)g(deb)n
(ugging:)-2 2203 y
SDict begin H.S end
 -2 2203 a -2 2203 a
SDict begin 13 H.A end
 -2 2203 a -2 2203
a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-6) cvn /DEST pdfmark
end
 -2 2203 a 396 2386 a Fg(Example)i(4-74.)d(Binary)j(Star)f(cor)o(e)f
(class)i(\(bstar)-8 b(.c\))19 b(-)h(enable/disable)h(tracing)-2
2486 y
SDict begin H.S end
 -2 2486 a -2 2486 a
SDict begin 11.7 H.A end
 -2 2486 a -2 2486 a
SDict begin [/View [/XYZ H.V]/Dest (0:2862) cvn /DEST pdfmark end
 -2 2486
a 396 2664 a Fe(void)44 b(bstar_set_verbose)e(\(bstar_t)1831
2677 y(*)1876 2664 y(self,)i(Bool)g(verbose\))396 2761
y({)576 2858 y(zloop_set_verbose)e(\(self->loop,)g(verbose\);)396
2955 y(})-2 3129 y
SDict begin H.S end
 -2 3129 a -2 3129 a
SDict begin 13 H.A end
 -2 3129 a -2 3129
a
SDict begin [/View [/XYZ H.V]/Dest (0:2863) cvn /DEST pdfmark end
 -2 3129 a 396 3229 a Fk(Finally)-5 b(,)20 b(start)g(the)h
(con\002gured)c(reactor)-5 b(.)20 b(It)g(will)h(end)f(if)g(an)o(y)g
(handler)e(returns)i(-1)g(to)g(the)g(reactor)m(,)f(or)h(if)g(the)h
(process)396 3337 y(recei)n(v)o(es)f(SIGINT)f(or)h(SIGTERM:)-2
3338 y
SDict begin H.S end
 -2 3338 a -2 3338 a
SDict begin 13 H.A end
 -2 3338 a -2 3338 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstar-c-7) cvn /DEST pdfmark
end
 -2 3338
a 396 3538 a Fg(Example)h(4-75.)d(Binary)j(Star)f(cor)o(e)f(class)i
(\(bstar)-8 b(.c\))19 b(-)h(start)g(the)g(r)o(eactor)-2
3638 y
SDict begin H.S end
 -2 3638 a -2 3638 a
SDict begin 11.7 H.A end
 -2 3638 a -2 3638 a
SDict begin [/View [/XYZ H.V]/Dest (0:2866) cvn /DEST pdfmark end
 -2 3638
a 396 3816 a Fe(int)396 3913 y(bstar_start)43 b(\(bstar_t)1338
3926 y(*)1383 3913 y(self\))396 4010 y({)576 4107 y(assert)g
(\(self->voter_fn\);)576 4204 y(s_update_peer_expiry)e(\(self\);)576
4301 y(return)i(zloop_start)g(\(self->loop\);)396 4398
y(})-2 4573 y
SDict begin H.S end
 -2 4573 a -2 4573 a
SDict begin 13 H.A end
 -2 4573 a -2 4573 a
SDict begin [/View [/XYZ H.V]/Dest (0:2867) cvn /DEST pdfmark end

-2 4573 a 396 4672 a Fk(Which)20 b(gi)n(v)o(es)g(us)h(the)f(follo)n
(wing)e(short)i(main)g(program)e(for)i(the)g(serv)o(er:)-2
4690 y
SDict begin H.S end
 -2 4690 a -2 4690 a
SDict begin 13 H.A end
 -2 4690 a -2 4690 a
SDict begin [/View [/XYZ H.V]/Dest (0:bstarsrv2-c) cvn /DEST pdfmark
end
 -2 4690
a Black 3759 5569 a Ff(228)p Black eop end
%%Page: 229 242
TeXDict begin 229 241 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.229) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-76.)d(Binary)j(Star)f(ser)o(v)o(er)-8
b(,)20 b(using)h(cor)o(e)e(class)i(\(bstarsr)o(v2.c\))-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2870) cvn /DEST pdfmark end
 -2 172 a 396
253 a Fe(//)396 350 y(//)90 b(Binary)43 b(Star)i(server,)e(using)h
(bstar)g(reactor)396 447 y(//)396 641 y(//)90 b(Lets)44
b(us)g(build)g(this)g(source)g(without)g(creating)f(a)i(library)396
738 y(#include)f("bstar.c")396 933 y(//)90 b(Echo)44
b(service)396 1030 y(int)h(s_echo)e(\(zloop_t)1293 1043
y(*)1338 1030 y(loop,)h(zmq_pollitem_t)2279 1043 y(*)2324
1030 y(poller,)g(void)2907 1043 y(*)2952 1030 y(arg\))396
1127 y({)576 1224 y(zmsg_t)889 1237 y(*)934 1224 y(msg)h(=)f(zmsg_recv)
g(\(poller->socket\);)576 1321 y(zmsg_send)f(\(&msg,)h
(poller->socket\);)576 1418 y(return)f(0;)396 1515 y(})396
1710 y(int)i(main)f(\(int)g(argc,)g(char)1517 1723 y(*)1562
1710 y(argv)g([]\))396 1807 y({)576 1904 y(//)89 b(Arguments)43
b(can)i(be)f(either)g(of:)576 2001 y(//)268 b(-p)90 b(primary)43
b(server,)h(at)g(tcp://localhost:5001)576 2098 y(//)268
b(-b)90 b(backup)43 b(server,)h(at)h(tcp://localhost:5002)576
2195 y(bstar_t)934 2208 y(*)979 2195 y(bstar;)576 2292
y(if)f(\(argc)g(==)h(2)f(&&)h(streq)f(\(argv)g([1],)g("-p"\)\))g({)755
2390 y(printf)g(\("I:)g(Primary)g(master,)f(waiting)h(for)g(backup)g
(\(slave\)\\n"\);)755 2487 y(bstar)g(=)h(bstar_new)e(\(BSTAR_PRIMARY,)
934 2584 y("tcp://)1249 2597 y(*)1294 2584 y(:5003",)g
("tcp://localhost:5004"\);)755 2681 y(bstar_voter)g(\(bstar,)h("tcp://)
1967 2694 y(*)2012 2681 y(:5001",)e(ZMQ_ROUTER,)h(s_echo,)h(NULL\);)576
2778 y(})576 2875 y(else)576 2972 y(if)g(\(argc)g(==)h(2)f(&&)h(streq)f
(\(argv)g([1],)g("-b"\)\))g({)755 3070 y(printf)g(\("I:)g(Backup)g
(slave,)g(waiting)f(for)i(primary)e(\(master\)\\n"\);)755
3167 y(bstar)h(=)h(bstar_new)e(\(BSTAR_BACKUP,)934 3264
y("tcp://)1249 3277 y(*)1294 3264 y(:5004",)g
("tcp://localhost:5003"\);)755 3361 y(bstar_voter)g(\(bstar,)h("tcp://)
1967 3374 y(*)2012 3361 y(:5002",)e(ZMQ_ROUTER,)h(s_echo,)h(NULL\);)576
3458 y(})576 3555 y(else)g({)755 3652 y(printf)g(\("Usage:)f(bstarsrvs)
h({)g(-p)h(|)f(-b)h(}\\n"\);)755 3750 y(exit)f(\(0\);)576
3847 y(})576 3944 y(bstar_start)f(\(bstar\);)576 4041
y(bstar_destroy)f(\(&bstar\);)576 4138 y(return)h(0;)396
4235 y(})-2 4409 y
SDict begin H.S end
 -2 4409 a -2 4409 a
SDict begin 13 H.A end
 -2 4409 a -2 4409
a
SDict begin [/View [/XYZ H.V]/Dest (0:2871) cvn /DEST pdfmark end
 -2 4409 a 369 x Fn(4.14.)c(Br)m(okerless)e(Reliability)h(\(Freelance)
f(P)l(attern\))3150 4778 y
SDict begin H.S end
 3150 4778 a 3150 4778 a
SDict begin 22.464 H.A end
 3150
4778 a 3150 4778 a
SDict begin [/View [/XYZ H.V]/Dest (9.68.1) cvn /DEST pdfmark end
 3150 4778 a -2 4974 a
SDict begin H.S end
 -2 4974 a -2
4974 a
SDict begin 13 H.A end
 -2 4974 a -2 4974 a
SDict begin [/View [/XYZ H.V]/Dest (0:2873) cvn /DEST pdfmark end
 -2 4974 a 396 5052 a Fk(It)21
b(might)e(seem)i(ironic)e(to)h(focus)g(so)h(much)e(on)h(brok)o(er)n
(-based)d(reliability)-5 b(,)19 b(when)h(we)g(often)g(e)o(xplain)f
(\330MQ)h(as)396 5160 y("brok)o(erless)f(messaging".)g(Ho)n(we)n(v)o
(er)g(in)h(messaging,)f(as)i(in)f(real)h(life,)f(the)g(middleman)e(is)k
(both)d(a)h(b)n(urden)f(and)h(a)p Black 3759 5569 a Ff(229)p
Black eop end
%%Page: 230 243
TeXDict begin 230 242 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.230) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2894) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fk(bene\002t.)g(In)g(practice,)f(most)h(messaging)f
(architectures)g(bene\002t)h(from)f(a)i(mix)f(of)g(distrib)n(uted)f
(and)h(brok)o(ered)396 180 y(messaging.)f(Y)-9 b(ou)20
b(get)g(the)g(best)h(results)f(when)g(you)f(can)h(decide)g(freely)f
(what)h(tradeof)n(fs)f(you)g(w)o(ant)h(to)h(mak)o(e.)e(This)i(is)396
288 y(why)e(I)h(can)f(dri)n(v)o(e)f(10km)h(to)g(a)h(wholesaler)f(to)h
(b)n(uy)f(\002)n(v)o(e)g(cases)h(of)g(wine)f(for)g(a)h(party)-5
b(,)18 b(b)n(ut)i(I)f(can)h(also)f(w)o(alk)h(10)f(minutes)396
396 y(to)i(a)f(corner)f(store)h(to)h(b)n(uy)e(one)h(bottle)g(for)f(a)i
(dinner)-5 b(.)19 b(Our)h(highly)f(conte)o(xt-sensiti)n(v)o(e)f(relati)
n(v)o(e)h(v)n(aluations)g(of)h(time,)396 504 y(ener)o(gy)-5
b(,)18 b(and)h(cost)i(are)f(essential)h(to)f(the)g(real)g(w)o(orld)g
(economy)-5 b(.)18 b(And)h(the)o(y)h(are)g(essential)h(to)f(an)g
(optimal)396 612 y(message-based)f(architecture.)-2 796
y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:2874) cvn /DEST pdfmark end
 -2 796 a 396 886
a Fk(Which)h(is)h(why)f(\330MQ)g(does)g(not)1392 886
y
SDict begin H.S end
 1392 886 a 1392 886 a
SDict begin 13 H.A end
 1392 886 a 1392 886 a
SDict begin [/View [/XYZ H.V]/Dest (0:2875) cvn /DEST pdfmark end
 1392 886
a Ff(impose)g Fk(a)h(brok)o(er)n(-centric)c(architecture,)h(though)h
(it)i(gi)n(v)o(es)e(you)h(the)g(tools)g(to)h(b)n(uild)396
994 y(brok)o(ers,)e(aka)h("de)n(vices",)f(and)h(we')l(v)o(e)f(b)n(uilt)
h(a)h(dozen)e(or)h(so)g(dif)n(ferent)f(ones)h(so)g(f)o(ar)m(,)g(just)h
(for)e(practice.)-2 1178 y
SDict begin H.S end
 -2 1178 a -2 1178 a
SDict begin 13 H.A end
 -2 1178
a -2 1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:2876) cvn /DEST pdfmark end
 -2 1178 a 396 1268 a Fk(So)i(we')o(ll)f(end)g(this)h
(chapter)e(by)g(deconstructing)f(the)i(brok)o(er)n(-based)e
(reliability)h(we')l(v)o(e)h(b)n(uilt)g(so)h(f)o(ar)m(,)e(and)h
(turning)e(it)396 1376 y(back)i(into)g(a)g(distrib)n(uted)g(peer)n
(-to-peer)d(architecture)i(I)h(call)h(the)f(Freelance)g(pattern.)f(Our)
h(use)g(case)h(will)g(be)f(a)g(name)396 1484 y(resolution)f(service.)h
(This)g(is)h(a)g(common)d(problem)h(with)h(\330MQ)g(architectures:)f
(ho)n(w)h(do)g(we)g(kno)n(w)g(the)g(endpoint)e(to)396
1592 y(connect)h(to?)h(Hard-coding)e(TCP/IP)j(addresses)f(in)g(code)f
(is)j(insanely)d(fragile.)g(Using)h(con\002guration)e(\002les)j
(creates)396 1700 y(an)f(administration)f(nightmare.)f(Imagine)h(if)h
(you)g(had)f(to)i(hand-con\002gure)16 b(your)j(web)h(bro)n(wser)m(,)e
(on)i(e)n(v)o(ery)f(PC)i(or)396 1808 y(mobile)f(phone)e(you)i(used,)f
(to)i(realize)f(that)g("google.com")d(w)o(as)k("74.125.230.82".)-2
1992 y
SDict begin H.S end
 -2 1992 a -2 1992 a
SDict begin 13 H.A end
 -2 1992 a -2 1992 a
SDict begin [/View [/XYZ H.V]/Dest (0:2877) cvn /DEST pdfmark end
 -2 1992
a 396 2082 a Fk(A)g(\330MQ)f(name)g(service)g(\(and)f(we')o(ll)i(mak)o
(e)e(a)i(simple)f(implementation\))e(has)i(to:)-2 2100
y
SDict begin H.S end
 -2 2100 a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:2878) cvn /DEST pdfmark end
 -2 2100 a -2
2110 a
SDict begin H.S end
 -2 2110 a -2 2110 a
SDict begin 13 H.A end
 -2 2110 a -2 2110 a
SDict begin [/View [/XYZ H.V]/Dest (0:2879) cvn /DEST pdfmark end
 -2 2110
a Black 396 2252 a Fj(\225)p Black 479 2252 a
SDict begin H.S end
 479 2252
a 479 2252 a
SDict begin 13 H.A end
 479 2252 a 479 2252 a
SDict begin [/View [/XYZ H.V]/Dest (0:2880) cvn /DEST pdfmark end
 479 2252 a Fk(Resolv)o(e)g(a)h
(logical)f(name)f(into)h(at)h(least)g(a)f(bind)g(endpoint,)e(and)h(a)i
(connect)e(endpoint.)f(A)j(realistic)f(name)g(service)479
2360 y(w)o(ould)g(pro)o(vide)e(multiple)h(bind)h(endpoints,)e(and)i
(possibly)f(multiple)h(connect)f(endpoints)g(too.)-2
2378 y
SDict begin H.S end
 -2 2378 a -2 2378 a
SDict begin 13 H.A end
 -2 2378 a -2 2378 a
SDict begin [/View [/XYZ H.V]/Dest (0:2881) cvn /DEST pdfmark end
 -2 2378
a Black 396 2509 a Fj(\225)p Black 479 2509 a
SDict begin H.S end
 479 2509
a 479 2509 a
SDict begin 13 H.A end
 479 2509 a 479 2509 a
SDict begin [/View [/XYZ H.V]/Dest (0:2882) cvn /DEST pdfmark end
 479 2509 a Fk(Allo)n(w)i(us)f(to)g
(manage)f(multiple)h(parallel)g(en)m(vironments,)d(e.g.)i("test")i(vs.)
g("production")c(without)i(modifying)479 2617 y(code.)-2
2618 y
SDict begin H.S end
 -2 2618 a -2 2618 a
SDict begin 13 H.A end
 -2 2618 a -2 2618 a
SDict begin [/View [/XYZ H.V]/Dest (0:2883) cvn /DEST pdfmark end
 -2 2618
a Black 396 2767 a Fj(\225)p Black 479 2767 a
SDict begin H.S end
 479 2767
a 479 2767 a
SDict begin 13 H.A end
 479 2767 a 479 2767 a
SDict begin [/View [/XYZ H.V]/Dest (0:2884) cvn /DEST pdfmark end
 479 2767 a Fk(Be)i(reliable,)f
(because)f(if)i(it)g(is)g(una)n(v)n(ailable,)d(applications)h(w)o(on')o
(t)g(be)i(able)f(to)g(connect)f(to)h(the)g(netw)o(ork.)-2
2951 y
SDict begin H.S end
 -2 2951 a -2 2951 a
SDict begin 13 H.A end
 -2 2951 a -2 2951 a
SDict begin [/View [/XYZ H.V]/Dest (0:2885) cvn /DEST pdfmark end
 -2 2951
a 396 3041 a Fk(Putting)g(a)h(name)e(service)h(behind)f(a)h
(service-oriented)e(Majordomo)g(brok)o(er)g(is)j(cle)n(v)o(er)f(from)f
(some)h(points)g(of)g(vie)n(w)-5 b(.)396 3148 y(Ho)n(we)n(v)o(er)19
b(it')-5 b(s)21 b(simpler)f(and)g(much)f(less)i(surprising)e(to)h(just)
h(e)o(xpose)e(the)h(name)g(service)g(as)h(a)f(serv)o(er)g(that)g
(clients)g(can)396 3256 y(connect)f(to)i(directly)-5
b(.)18 b(If)i(we)h(do)f(this)g(right,)g(the)g(name)g(service)f(becomes)
h(the)2699 3256 y
SDict begin H.S end
 2699 3256 a 2699 3256 a
SDict begin 13 H.A end
 2699 3256 a
2699 3256 a
SDict begin [/View [/XYZ H.V]/Dest (0:2886) cvn /DEST pdfmark end
 2699 3256 a Ff(only)g Fk(global)f(netw)o(ork)g(endpoint)f
(we)396 3364 y(need)i(to)g(hard-code)e(in)i(our)g(code)f(or)h
(con\002guration)d(\002les.)-2 3548 y
SDict begin H.S end
 -2 3548 a -2 3548
a
SDict begin 13 H.A end
 -2 3548 a -2 3548 a
SDict begin [/View [/XYZ H.V]/Dest (0:2887) cvn /DEST pdfmark end
 -2 3548 a 396 3638 a Fk(The)j(types)g(of)g(f)o
(ailure)g(we)g(aim)g(to)h(handle)e(are)h(serv)o(er)f(crashes)h(and)g
(restarts,)g(serv)o(er)g(b)n(usy)g(looping,)e(serv)o(er)396
3746 y(o)o(v)o(erload,)g(and)h(netw)o(ork)g(issues.)i(T)-7
b(o)21 b(get)f(reliability)-5 b(,)19 b(we')o(ll)h(create)g(a)h(pool)e
(of)h(name)g(serv)o(ers)f(so)i(if)f(one)g(crashes)g(or)396
3854 y(goes)g(a)o(w)o(ay)-5 b(,)19 b(clients)i(can)f(connect)f(to)h
(another)m(,)e(and)i(so)h(on.)e(In)h(practice,)f(tw)o(o)i(w)o(ould)e
(be)h(enough.)e(But)j(for)f(the)396 3962 y(e)o(xample,)f(we')o(ll)h
(assume)h(the)f(pool)f(can)h(be)g(an)o(y)g(size\()p 0
TeXcolorgray 1996 3962 a
SDict begin H.S end
 1996 3962 a Fk(Figure)f(4-9)2345
3962 y
SDict begin 13 H.L end
 2345 3962 a 2345 3962 a
SDict begin [/Subtype /Link/Dest (0:figure-62) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2345 3962 a Black -1 w
Fk(\).)-2 3980 y
SDict begin H.S end
 -2 3980 a -2 3980 a
SDict begin 13 H.A end
 -2 3980 a -2 3980
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-62) cvn /DEST pdfmark
end
 -2 3980 a Black 3759 5569 a Ff(230)p Black eop end
%%Page: 231 244
TeXDict begin 231 243 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.231) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Figur)o(e)g(4-9.)f(The)i(Fr)o(eelance)e(P)o(atter)o
(n)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:2891) cvn /DEST pdfmark end
 -2 172
a 396 1789 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1789 a @beginspecial 0 @llx -189 @lly
294 @urx 0 @ury 2940 @rwi @setspecial
%%BeginDocument: images/fig62.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -189 294 0
%%HiResBoundingBox: 0.0 -189.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -23.800180435180664 moveto
16.800180435180664 -55.80017852783203 lineto
16.800180435180664 -58.466845194498696 17.800180435180664 -59.80017852783203 19.800180435180664 -59.80017852783203 curveto
85.80017852783203 -59.80017852783203 lineto
85.80017852783203 -59.80017852783203 lineto
87.80017852783203 -59.80017852783203 88.80017852783203 -58.466845194498696 88.80017852783203 -55.80017852783203 curveto
88.80017852783203 -23.800180435180664 lineto
88.80017852783203 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -23.800180435180664 moveto
112.80017852783203 -55.80017852783203 lineto
112.80017852783203 -58.466845194498696 113.80017852783203 -59.80017852783203 115.80017852783203 -59.80017852783203 curveto
181.80018615722656 -59.80017852783203 lineto
181.80018615722656 -59.80017852783203 lineto
183.80018615722656 -59.80017852783203 184.80018615722656 -58.466845194498696 184.80018615722656 -55.80017852783203 curveto
184.80018615722656 -23.800180435180664 lineto
184.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -23.800180435180664 moveto
208.80018615722656 -55.80017852783203 lineto
208.80018615722656 -58.466845194498696 209.80018615722656 -59.80017852783203 211.80018615722656 -59.80017852783203 curveto
277.8001708984375 -59.80017852783203 lineto
277.8001708984375 -59.80017852783203 lineto
279.8001708984375 -59.80017852783203 280.8001708984375 -58.466845194498696 280.8001708984375 -55.80017852783203 curveto
280.8001708984375 -23.800180435180664 lineto
280.8001708984375 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -131.80018615722656 moveto
17.800180435180664 -131.80018615722656 16.800180435180664 -133.46685282389322 16.800180435180664 -136.80018615722656 curveto
16.800180435180664 -167.80018615722656 lineto
88.80017852783203 -167.80018615722656 lineto
88.80017852783203 -136.80018615722656 lineto
88.80017852783203 -133.46685282389322 87.80017852783203 -131.80018615722656 85.80017852783203 -131.80018615722656 curveto
19.800180435180664 -131.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -131.80018615722656 moveto
113.80017852783203 -131.80018615722656 112.80017852783203 -133.46685282389322 112.80017852783203 -136.80018615722656 curveto
112.80017852783203 -167.80018615722656 lineto
184.80018615722656 -167.80018615722656 lineto
184.80018615722656 -136.80018615722656 lineto
184.80018615722656 -133.46685282389322 183.80018615722656 -131.80018615722656 181.80018615722656 -131.80018615722656 curveto
115.80017852783203 -131.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -131.80018615722656 moveto
209.80018615722656 -131.80018615722656 208.80018615722656 -133.46685282389322 208.80018615722656 -136.80018615722656 curveto
208.80018615722656 -167.80018615722656 lineto
280.8001708984375 -167.80018615722656 lineto
280.8001708984375 -136.80018615722656 lineto
280.8001708984375 -133.46685282389322 279.8001708984375 -131.80018615722656 277.8001708984375 -131.80018615722656 curveto
211.80018615722656 -131.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -22.0 moveto
15.0 -54.0 lineto
15.0 -56.666666666666664 16.0 -58.0 18.0 -58.0 curveto
84.0 -58.0 lineto
84.0 -58.0 lineto
86.0 -58.0 87.0 -56.666666666666664 87.0 -54.0 curveto
87.0 -22.0 lineto
87.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -22.0 moveto
15.0 -54.0 lineto
15.0 -56.666666666666664 16.0 -58.0 18.0 -58.0 curveto
84.0 -58.0 lineto
84.0 -58.0 lineto
86.0 -58.0 87.0 -56.666666666666664 87.0 -54.0 curveto
87.0 -22.0 lineto
87.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -54.0 lineto
111.0 -56.666666666666664 112.0 -58.0 114.0 -58.0 curveto
180.0 -58.0 lineto
180.0 -58.0 lineto
182.0 -58.0 183.0 -56.666666666666664 183.0 -54.0 curveto
183.0 -22.0 lineto
183.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -22.0 moveto
111.0 -54.0 lineto
111.0 -56.666666666666664 112.0 -58.0 114.0 -58.0 curveto
180.0 -58.0 lineto
180.0 -58.0 lineto
182.0 -58.0 183.0 -56.666666666666664 183.0 -54.0 curveto
183.0 -22.0 lineto
183.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -54.0 lineto
207.0 -56.666666666666664 208.0 -58.0 210.0 -58.0 curveto
276.0 -58.0 lineto
276.0 -58.0 lineto
278.0 -58.0 279.0 -56.666666666666664 279.0 -54.0 curveto
279.0 -22.0 lineto
279.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -22.0 moveto
207.0 -54.0 lineto
207.0 -56.666666666666664 208.0 -58.0 210.0 -58.0 curveto
276.0 -58.0 lineto
276.0 -58.0 lineto
278.0 -58.0 279.0 -56.666666666666664 279.0 -54.0 curveto
279.0 -22.0 lineto
279.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -130.0 moveto
16.0 -130.0 15.0 -131.66666666666666 15.0 -135.0 curveto
15.0 -166.0 lineto
87.0 -166.0 lineto
87.0 -135.0 lineto
87.0 -131.66666666666666 86.0 -130.0 84.0 -130.0 curveto
18.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -130.0 moveto
16.0 -130.0 15.0 -131.66666666666666 15.0 -135.0 curveto
15.0 -166.0 lineto
87.0 -166.0 lineto
87.0 -135.0 lineto
87.0 -131.66666666666666 86.0 -130.0 84.0 -130.0 curveto
18.0 -130.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -166.0 lineto
183.0 -166.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -130.0 moveto
112.0 -130.0 111.0 -131.66666666666666 111.0 -135.0 curveto
111.0 -166.0 lineto
183.0 -166.0 lineto
183.0 -135.0 lineto
183.0 -131.66666666666666 182.0 -130.0 180.0 -130.0 curveto
114.0 -130.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -130.0 moveto
208.0 -130.0 207.0 -131.66666666666666 207.0 -135.0 curveto
207.0 -166.0 lineto
279.0 -166.0 lineto
279.0 -135.0 lineto
279.0 -131.66666666666666 278.0 -130.0 276.0 -130.0 curveto
210.0 -130.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -130.0 moveto
208.0 -130.0 207.0 -131.66666666666666 207.0 -135.0 curveto
207.0 -166.0 lineto
279.0 -166.0 lineto
279.0 -135.0 lineto
279.0 -131.66666666666666 278.0 -130.0 276.0 -130.0 curveto
210.0 -130.0 lineto
closepath
stroke
newpath
51.0 -76.0 moveto
51.0 -94.0 lineto
stroke
newpath
147.0 -76.0 moveto
147.0 -94.0 lineto
stroke
newpath
243.0 -76.0 moveto
243.0 -94.0 lineto
stroke
newpath
51.0 -112.0 moveto
51.0 -94.0 lineto
stroke
newpath
147.0 -112.0 moveto
147.0 -94.0 lineto
stroke
newpath
243.0 -112.0 moveto
243.0 -94.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
34.0 -44.0 moveto
(Client) show
130.0 -44.0 moveto
(Client) show
226.0 -44.0 moveto
(Client) show
32.0 -71.0 moveto
(connect) show
128.0 -71.0 moveto
(connect) show
224.0 -71.0 moveto
(connect) show
38.0 -125.0 moveto
(bind) show
134.0 -125.0 moveto
(bind) show
230.0 -125.0 moveto
(bind) show
32.0 -152.0 moveto
(Server) show
128.0 -152.0 moveto
(Server) show
224.0 -152.0 moveto
(Server) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1789 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1789 a 274 x Fk(In)h(this)h(architecture)e
(a)h(lar)o(ge)f(set)i(of)f(clients)h(connect)e(to)h(a)h(small)f(set)h
(of)f(serv)o(ers)g(directly)-5 b(.)19 b(The)g(serv)o(ers)h(bind)f(to)
396 2171 y(their)h(respecti)n(v)o(e)f(addresses.)h(It')-5
b(s)21 b(fundamentally)c(dif)n(ferent)i(from)g(a)h(brok)o(er)n(-based)e
(approach)g(lik)o(e)i(Majordomo,)396 2279 y(where)g(w)o(ork)o(ers)f
(connect)g(to)i(the)f(brok)o(er)-5 b(.)19 b(F)o(or)g(clients,)i(there)e
(are)i(a)f(couple)f(of)h(options:)-2 2297 y
SDict begin H.S end
 -2 2297 a
-2 2297 a
SDict begin 13 H.A end
 -2 2297 a -2 2297 a
SDict begin [/View [/XYZ H.V]/Dest (0:2895) cvn /DEST pdfmark end
 -2 2297 a -2 2307 a
SDict begin H.S end
 -2
2307 a -2 2307 a
SDict begin 13 H.A end
 -2 2307 a -2 2307 a
SDict begin [/View [/XYZ H.V]/Dest (0:2896) cvn /DEST pdfmark end
 -2 2307 a Black
396 2449 a Fj(\225)p Black 479 2449 a
SDict begin H.S end
 479 2449 a 479
2449 a
SDict begin 13 H.A end
 479 2449 a 479 2449 a
SDict begin [/View [/XYZ H.V]/Dest (0:2897) cvn /DEST pdfmark end
 479 2449 a Fk(Clients)h(could)f(use)g(REQ)
h(sock)o(ets)f(and)g(the)g(Lazy)g(Pirate)g(pattern.)f(Easy)-5
b(,)20 b(b)n(ut)g(w)o(ould)f(need)h(some)g(additional)479
2557 y(intelligence)f(to)i(not)f(stupidly)f(reconnect)f(to)j(dead)e
(serv)o(ers)h(o)o(v)o(er)f(and)g(o)o(v)o(er)-5 b(.)-2
2575 y
SDict begin H.S end
 -2 2575 a -2 2575 a
SDict begin 13 H.A end
 -2 2575 a -2 2575 a
SDict begin [/View [/XYZ H.V]/Dest (0:2898) cvn /DEST pdfmark end
 -2 2575
a Black 396 2706 a Fj(\225)p Black 479 2706 a
SDict begin H.S end
 479 2706
a 479 2706 a
SDict begin 13 H.A end
 479 2706 a 479 2706 a
SDict begin [/View [/XYZ H.V]/Dest (0:2899) cvn /DEST pdfmark end
 479 2706 a Fk(Clients)21
b(could)f(use)g(DEALER)g(sock)o(ets)h(and)e(blast)i(out)f(requests)f
(\(which)h(will)h(be)f(load)f(balanced)g(to)i(all)479
2814 y(connected)e(serv)o(ers\))g(until)h(the)o(y)f(get)i(a)f(reply)-5
b(.)19 b(Brutal,)h(b)n(ut)g(not)g(ele)o(gant.)-2 2832
y
SDict begin H.S end
 -2 2832 a -2 2832 a
SDict begin 13 H.A end
 -2 2832 a -2 2832 a
SDict begin [/View [/XYZ H.V]/Dest (0:2900) cvn /DEST pdfmark end
 -2 2832 a Black
396 2964 a Fj(\225)p Black 479 2964 a
SDict begin H.S end
 479 2964 a 479
2964 a
SDict begin 13 H.A end
 479 2964 a 479 2964 a
SDict begin [/View [/XYZ H.V]/Dest (0:2901) cvn /DEST pdfmark end
 479 2964 a Fk(Clients)h(could)f(use)g(R)m
(OUTER)g(sock)o(ets)h(so)f(the)o(y)g(can)g(address)f(speci\002c)i(serv)
o(ers.)e(But)i(ho)n(w)e(does)h(the)h(client)f(kno)n(w)479
3072 y(the)g(identity)g(of)g(the)g(serv)o(er)f(sock)o(ets?)i(Either)e
(the)h(serv)o(er)g(has)g(to)h(ping)e(the)h(client)g(\002rst)h(\(comple)
o(x\),)d(or)i(the)g(each)479 3179 y(serv)o(er)g(has)g(to)g(use)h(a)f
(hard-coded,)d(\002x)o(ed)j(identity)f(kno)n(wn)g(to)h(the)h(client)f
(\(nasty\).)-2 3197 y
SDict begin H.S end
 -2 3197 a -2 3197 a
SDict begin 13 H.A end
 -2 3197 a -2
3197 a
SDict begin [/View [/XYZ H.V]/Dest (0:2902) cvn /DEST pdfmark end
 -2 3197 a 396 3508 a Fb(4.14.1.)36 b(Model)e(One)f(-)h(Simple)g
(Retr)q(y)g(and)g(F)n(ailo)n(ver)2977 3508 y
SDict begin H.S end
 2977 3508
a 2977 3508 a
SDict begin 18.72 H.A end
 2977 3508 a 2977 3508 a
SDict begin [/View [/XYZ H.V]/Dest (9.68.18.2) cvn /DEST pdfmark end
 2977 3508 a -2
3698 a
SDict begin H.S end
 -2 3698 a -2 3698 a
SDict begin 13 H.A end
 -2 3698 a -2 3698 a
SDict begin [/View [/XYZ H.V]/Dest (0:2904) cvn /DEST pdfmark end
 -2 3698
a 396 3782 a Fk(So)21 b(our)e(menu)g(appears)h(to)g(of)n(fer:)f
(simple,)h(brutal,)f(comple)o(x,)f(or)i(nasty)-5 b(.)20
b(Let')-5 b(s)20 b(start)h(with)g(')-5 b(simple')19 b(and)h(then)g(w)o
(ork)396 3889 y(out)g(the)g(kinks.)g(W)-7 b(e)21 b(tak)o(e)f(Lazy)g
(Pirate)g(and)g(re)n(write)g(it)h(to)f(w)o(ork)g(with)g(multiple)g
(serv)o(er)f(endpoints.)f(Start)j(the)f(serv)o(er)396
3997 y(\002rst,)h(specifying)e(a)h(bind)g(endpoint)e(as)j(ar)o(gument.)
c(Run)k(one)e(or)h(se)n(v)o(eral)g(serv)o(ers:)-2 4015
y
SDict begin H.S end
 -2 4015 a -2 4015 a
SDict begin 13 H.A end
 -2 4015 a -2 4015 a
SDict begin [/View [/XYZ H.V]/Dest (0:flserver1-c) cvn /DEST pdfmark
end
 -2 4015 a 396
4199 a Fg(Example)h(4-77.)d(Fr)o(eelance)h(ser)o(v)o(er)-8
b(,)21 b(Model)g(One)f(\(\003ser)o(v)o(er1.c\))-2 4299
y
SDict begin H.S end
 -2 4299 a -2 4299 a
SDict begin 11.7 H.A end
 -2 4299 a -2 4299 a
SDict begin [/View [/XYZ H.V]/Dest (0:2907) cvn /DEST pdfmark end
 -2 4299 a 396
4379 a Fe(//)396 4476 y(//)90 b(Freelance)43 b(server)h(-)g(Model)g(1)
396 4573 y(//)90 b(Trivial)43 b(echo)h(service)396 4670
y(//)396 4767 y(#include)g("czmq.h")396 4962 y(int)h(main)f(\(int)g
(argc,)g(char)1517 4975 y(*)1562 4962 y(argv)g([]\))396
5059 y({)576 5156 y(if)g(\(argc)g(<)h(2\))f({)p Black
3759 5569 a Ff(231)p Black eop end
%%Page: 232 245
TeXDict begin 232 244 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.232) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 755 72 a Fe(printf)44 b(\("I:)g(syntax:)g(\045s)g
(<endpoint>\\n",)f(argv)h([0]\);)755 170 y(exit)g(\(EXIT_SUCCESS\);)576
267 y(})576 364 y(zctx_t)889 377 y(*)934 364 y(ctx)h(=)f(zctx_new)g
(\(\);)576 461 y(void)800 474 y(*)845 461 y(server)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_REP\);)576 558 y(zsocket_bind)e(\(server,)i(argv)g
([1]\);)576 752 y(printf)f(\("I:)i(echo)f(service)f(is)i(ready)f(at)g
(\045s\\n",)g(argv)g([1]\);)576 850 y(while)g(\(true\))f({)755
947 y(zmsg_t)1069 960 y(*)1114 947 y(msg)h(=)h(zmsg_recv)e(\(server\);)
755 1044 y(if)h(\(!msg\))934 1141 y(break;)448 b(//)89
b(Interrupted)755 1238 y(zmsg_send)43 b(\(&msg,)h(server\);)576
1335 y(})576 1432 y(if)g(\(zctx_interrupted\))755 1530
y(printf)g(\("W:)g(interrupted\\n"\);)576 1724 y(zctx_destroy)e
(\(&ctx\);)576 1821 y(return)h(0;)396 1918 y(})-2 2092
y
SDict begin H.S end
 -2 2092 a -2 2092 a
SDict begin 13 H.A end
 -2 2092 a -2 2092 a
SDict begin [/View [/XYZ H.V]/Dest (0:2908) cvn /DEST pdfmark end
 -2 2092 a 396
2192 a Fk(Then)20 b(start)g(the)h(client,)f(specifying)e(one)i(or)g
(more)f(connect)g(endpoints)g(as)i(ar)o(guments:)-2 2210
y
SDict begin H.S end
 -2 2210 a -2 2210 a
SDict begin 13 H.A end
 -2 2210 a -2 2210 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient1-c) cvn /DEST pdfmark
end
 -2 2210 a 396
2393 a Fg(Example)g(4-78.)d(Fr)o(eelance)h(client,)i(Model)f(One)h
(\(\003client1.c\))-2 2493 y
SDict begin H.S end
 -2 2493 a -2 2493 a
SDict begin 11.7 H.A end
 -2 2493
a -2 2493 a
SDict begin [/View [/XYZ H.V]/Dest (0:2911) cvn /DEST pdfmark end
 -2 2493 a 396 2574 a Fe(//)396 2671 y(//)90
b(Freelance)43 b(client)h(-)g(Model)g(1)396 2768 y(//)90
b(Uses)44 b(REQ)g(socket)g(to)g(query)g(one)h(or)f(more)g(services)396
2865 y(//)396 2962 y(#include)g("czmq.h")396 3156 y(#define)g
(REQUEST_TIMEOUT)222 b(1000)396 3253 y(#define)44 b(MAX_RETRIES)402
b(3)313 b(//)90 b(Before)43 b(we)i(abandon)396 3448 y(static)f(zmsg_t)
1024 3461 y(*)396 3545 y(s_try_request)f(\(zctx_t)1383
3558 y(*)1428 3545 y(ctx,)h(char)1876 3558 y(*)1921 3545
y(endpoint,)f(zmsg_t)2683 3558 y(*)2728 3545 y(request\))396
3642 y({)576 3739 y(printf)g(\("I:)i(trying)e(echo)i(service)e(at)i
(\045s...\\n",)e(endpoint\);)576 3836 y(void)800 3849
y(*)845 3836 y(client)g(=)i(zsocket_new)e(\(ctx,)h(ZMQ_REQ\);)576
3933 y(zsocket_connect)e(\(client,)h(endpoint\);)576
4128 y(//)89 b(Send)44 b(request,)g(wait)g(safely)g(for)g(reply)576
4225 y(zmsg_t)889 4238 y(*)934 4225 y(msg)h(=)f(zmsg_dup)g
(\(request\);)576 4322 y(zmsg_send)f(\(&msg,)h(client\);)576
4419 y(zmq_pollitem_t)e(items)i([])h(=)f({)h({)g(client,)e(0,)i
(ZMQ_POLLIN,)e(0)h(})h(};)576 4516 y(zmq_poll)e(\(items,)h(1,)g
(REQUEST_TIMEOUT)2190 4529 y(*)2279 4516 y(ZMQ_POLL_MSEC\);)576
4613 y(zmsg_t)889 4626 y(*)934 4613 y(reply)g(=)h(NULL;)576
4711 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))755
4808 y(reply)f(=)h(zmsg_recv)e(\(client\);)576 5002 y(//)89
b(Close)44 b(socket)g(in)g(any)h(case,)f(we're)g(done)g(with)g(it)g
(now)576 5099 y(zsocket_destroy)e(\(ctx,)i(client\);)p
Black 3759 5569 a Ff(232)p Black eop end
%%Page: 233 246
TeXDict begin 233 245 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.233) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:2917) cvn /DEST pdfmark end
 -2 -201 a 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(return)43 b(reply;)396 170 y(})-2 344
y
SDict begin H.S end
 -2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:2912) cvn /DEST pdfmark end
 -2 344 a 396 444
a Fk(The)20 b(client)g(uses)h(a)g(Lazy)e(Pirate)i(strate)o(gy)e(if)i
(it)g(only)e(has)h(one)g(serv)o(er)f(to)i(talk)f(to.)g(If)g(it)h(has)f
(2)h(or)f(more)f(serv)o(ers)h(to)g(talk)396 552 y(to,)g(it)h(will)g
(try)f(each)g(serv)o(er)f(just)i(once:)-2 569 y
SDict begin H.S end
 -2 569
a -2 569 a
SDict begin 13 H.A end
 -2 569 a -2 569 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient1-c-1) cvn /DEST pdfmark
end
 -2 569 a 396 753 a Fg(Example)g(4-79.)d
(Fr)o(eelance)h(client,)i(Model)f(One)h(\(\003client1.c\))e(-)h(client)
h(task)-2 853 y
SDict begin H.S end
 -2 853 a -2 853 a
SDict begin 11.7 H.A end
 -2 853 a -2 853 a
SDict begin [/View [/XYZ H.V]/Dest (0:2915) cvn /DEST pdfmark end
 -2
853 a 396 1030 a Fe(int)45 b(main)f(\(int)g(argc,)g(char)1517
1043 y(*)1562 1030 y(argv)g([]\))396 1127 y({)576 1224
y(zctx_t)889 1237 y(*)934 1224 y(ctx)h(=)f(zctx_new)g(\(\);)576
1322 y(zmsg_t)889 1335 y(*)934 1322 y(request)g(=)h(zmsg_new)e(\(\);)
576 1419 y(zmsg_addstr)g(\(request,)g("Hello)h(world"\);)576
1516 y(zmsg_t)889 1529 y(*)934 1516 y(reply)g(=)h(NULL;)576
1710 y(int)f(endpoints)f(=)i(argc)f(-)h(1;)576 1807 y(if)f(\(endpoints)
f(==)i(0\))755 1904 y(printf)f(\("I:)g(syntax:)g(\045s)g(<endpoint>)f
(...\\n",)h(argv)g([0]\);)576 2001 y(else)576 2099 y(if)g(\(endpoints)f
(==)i(1\))f({)755 2196 y(//)89 b(For)45 b(one)f(endpoint,)f(we)i(retry)
f(N)g(times)755 2293 y(int)g(retries;)755 2390 y(for)g(\(retries)g(=)g
(0;)h(retries)f(<)g(MAX_RETRIES;)f(retries++\))g({)934
2487 y(char)1158 2500 y(*)1203 2487 y(endpoint)h(=)g(argv)h([1];)934
2584 y(reply)f(=)h(s_try_request)e(\(ctx,)h(endpoint,)f(request\);)934
2681 y(if)i(\(reply\))1114 2779 y(break;)447 b(//)89
b(Successful)934 2876 y(printf)44 b(\("W:)g(no)h(response)e(from)h
(\045s,)h(retrying...\\n",)d(endpoint\);)755 2973 y(})576
3070 y(})576 3167 y(else)i({)755 3264 y(//)89 b(For)45
b(multiple)e(endpoints,)g(try)i(each)f(at)g(most)g(once)755
3361 y(int)g(endpoint_nbr;)755 3459 y(for)g(\(endpoint_nbr)f(=)i(0;)f
(endpoint_nbr)f(<)i(endpoints;)e(endpoint_nbr++\))f({)934
3556 y(char)1158 3569 y(*)1203 3556 y(endpoint)i(=)g(argv)h
([endpoint_nbr)d(+)j(1];)934 3653 y(reply)f(=)h(s_try_request)e(\(ctx,)
h(endpoint,)f(request\);)934 3750 y(if)i(\(reply\))1114
3847 y(break;)447 b(//)89 b(Successful)934 3944 y(printf)44
b(\("W:)g(no)h(response)e(from)h(\045s\\n",)g(endpoint\);)755
4041 y(})576 4138 y(})576 4236 y(if)g(\(reply\))755 4333
y(printf)g(\("Service)f(is)i(running)e(OK\\n"\);)576
4527 y(zmsg_destroy)f(\(&request\);)576 4624 y(zmsg_destroy)g
(\(&reply\);)576 4721 y(zctx_destroy)g(\(&ctx\);)576
4818 y(return)h(0;)396 4916 y(})p Black 3759 5569 a Ff(233)p
Black eop end
%%Page: 234 247
TeXDict begin 234 246 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.234) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2916) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(F)o(or)g(e)o(xample:)396 253 y Fe(flserver1)44
b(tcp://)1115 266 y(*)1160 253 y(:5555)e(&)396 350 y(flserver1)i
(tcp://)1115 363 y(*)1160 350 y(:5556)e(&)396 447 y(flclient1)i
(tcp://localhost:5555)d(tcp://localhost:5556)-2 624 y
SDict begin H.S end

-2 624 a -2 624 a
SDict begin 13 H.A end
 -2 624 a -2 624 a
SDict begin [/View [/XYZ H.V]/Dest (0:2918) cvn /DEST pdfmark end
 -2 624 a 396 721
a Fk(While)21 b(the)f(basic)g(approach)f(is)i(Lazy)e(Pirate,)i(the)f
(client)g(aims)h(to)f(just)h(get)f(one)f(successful)h(reply)-5
b(.)19 b(It)i(has)f(tw)o(o)396 829 y(techniques,)f(depending)e(on)j
(whether)f(you)h(are)g(running)e(a)i(single)h(serv)o(er)m(,)d(or)i
(multiple)g(serv)o(ers:)-2 847 y
SDict begin H.S end
 -2 847 a -2 847 a
SDict begin 13 H.A end
 -2
847 a -2 847 a
SDict begin [/View [/XYZ H.V]/Dest (0:2919) cvn /DEST pdfmark end
 -2 847 a -2 857 a
SDict begin H.S end
 -2 857 a -2 857 a
SDict begin 13 H.A end
 -2
857 a -2 857 a
SDict begin [/View [/XYZ H.V]/Dest (0:2920) cvn /DEST pdfmark end
 -2 857 a Black 396 999 a Fj(\225)p Black
479 999 a
SDict begin H.S end
 479 999 a 479 999 a
SDict begin 13 H.A end
 479 999 a 479 999 a
SDict begin [/View [/XYZ H.V]/Dest (0:2921) cvn /DEST pdfmark end
 479
999 a Fk(W)m(ith)h(a)f(single)g(serv)o(er)m(,)f(the)h(client)h(will)g
(retry)e(se)n(v)o(eral)h(times,)g(e)o(xactly)f(as)i(for)f(Lazy)g
(Pirate.)-2 1017 y
SDict begin H.S end
 -2 1017 a -2 1017 a
SDict begin 13 H.A end
 -2 1017 a -2 1017
a
SDict begin [/View [/XYZ H.V]/Dest (0:2922) cvn /DEST pdfmark end
 -2 1017 a Black 396 1148 a Fj(\225)p Black 479 1148
a
SDict begin H.S end
 479 1148 a 479 1148 a
SDict begin 13 H.A end
 479 1148 a 479 1148 a
SDict begin [/View [/XYZ H.V]/Dest (0:2923) cvn /DEST pdfmark end
 479 1148
a Fk(W)m(ith)h(multiple)e(serv)o(ers,)h(the)g(client)g(will)h(try)f
(each)g(serv)o(er)f(at)i(most)f(once,)f(until)h(it')-5
b(s)22 b(recei)n(v)o(ed)c(a)j(reply)-5 b(,)19 b(or)h(has)479
1256 y(tried)g(all)h(serv)o(ers.)-2 1423 y
SDict begin H.S end
 -2 1423 a
-2 1423 a
SDict begin 13 H.A end
 -2 1423 a -2 1423 a
SDict begin [/View [/XYZ H.V]/Dest (0:2924) cvn /DEST pdfmark end
 -2 1423 a 396 1530 a Fk(This)g(solv)o(es)
f(the)g(main)g(weakness)g(of)g(Lazy)f(Pirate,)h(namely)g(that)g(it)h
(could)e(not)h(do)g(f)o(ail-o)o(v)o(er)e(to)i(backup)f(/)i(alternate)
396 1638 y(serv)o(ers.)-2 1805 y
SDict begin H.S end
 -2 1805 a -2 1805 a
SDict begin 13 H.A end

-2 1805 a -2 1805 a
SDict begin [/View [/XYZ H.V]/Dest (0:2925) cvn /DEST pdfmark end
 -2 1805 a 396 1912 a Fk(Ho)n(we)n(v)o(er)e(this)i
(design)e(w)o(on')o(t)g(w)o(ork)h(well)h(in)f(a)g(real)h(application.)d
(If)i(we')l(re)g(connecting)e(man)o(y)h(sock)o(ets,)h(and)g(our)396
2020 y(primary)f(name)g(serv)o(er)h(is)h(do)n(wn,)e(we')l(re)g(going)g
(to)i(do)e(this)i(painful)e(timeout)h(each)f(time.)-2
2049 y
SDict begin H.S end
 -2 2049 a -2 2049 a
SDict begin 13 H.A end
 -2 2049 a -2 2049 a
SDict begin [/View [/XYZ H.V]/Dest (0:2926) cvn /DEST pdfmark end
 -2 2049
a 396 2359 a Fb(4.14.2.)36 b(Model)e(T)-7 b(w)n(o)32
b(-)i(Brutal)f(Shotgun)g(Massacre)2949 2359 y
SDict begin H.S end
 2949 2359
a 2949 2359 a
SDict begin 18.72 H.A end
 2949 2359 a 2949 2359 a
SDict begin [/View [/XYZ H.V]/Dest (9.68.19.2) cvn /DEST pdfmark end
 2949 2359 a -2
2551 a
SDict begin H.S end
 -2 2551 a -2 2551 a
SDict begin 13 H.A end
 -2 2551 a -2 2551 a
SDict begin [/View [/XYZ H.V]/Dest (0:2928) cvn /DEST pdfmark end
 -2 2551
a 396 2633 a Fk(Let')-5 b(s)21 b(switch)g(our)e(client)h(to)h(using)e
(a)i(DEALER)f(sock)o(et.)g(Our)g(goal)f(here)h(is)h(to)g(mak)o(e)e
(sure)h(we)h(get)f(a)h(reply)e(back)396 2741 y(within)h(the)g(shortest)
g(possible)g(time,)g(no)g(matter)g(whether)f(the)i(primary)d(serv)o(er)
h(is)j(do)n(wn)d(or)h(not.)f(Our)h(client)g(tak)o(es)396
2848 y(this)h(approach:)-2 2866 y
SDict begin H.S end
 -2 2866 a -2 2866 a
SDict begin 13 H.A end

-2 2866 a -2 2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:2929) cvn /DEST pdfmark end
 -2 2866 a -2 2876 a
SDict begin H.S end
 -2 2876 a -2
2876 a
SDict begin 13 H.A end
 -2 2876 a -2 2876 a
SDict begin [/View [/XYZ H.V]/Dest (0:2930) cvn /DEST pdfmark end
 -2 2876 a Black 396 3019 a
Fj(\225)p Black 479 3019 a
SDict begin H.S end
 479 3019 a 479 3019 a
SDict begin 13 H.A end
 479
3019 a 479 3019 a
SDict begin [/View [/XYZ H.V]/Dest (0:2931) cvn /DEST pdfmark end
 479 3019 a Fk(W)-7 b(e)22 b(set)f(things)e(up,)h
(connecting)e(to)i(all)h(serv)o(ers.)-2 3037 y
SDict begin H.S end
 -2 3037
a -2 3037 a
SDict begin 13 H.A end
 -2 3037 a -2 3037 a
SDict begin [/View [/XYZ H.V]/Dest (0:2932) cvn /DEST pdfmark end
 -2 3037 a Black 396 3168
a Fj(\225)p Black 479 3168 a
SDict begin H.S end
 479 3168 a 479 3168 a
SDict begin 13 H.A end
 479
3168 a 479 3168 a
SDict begin [/View [/XYZ H.V]/Dest (0:2933) cvn /DEST pdfmark end
 479 3168 a Fk(When)f(we)h(ha)n(v)o(e)e(a)i(request,)e
(we)i(blast)f(it)h(out)f(as)h(man)o(y)e(times)i(as)g(we)f(ha)n(v)o(e)g
(serv)o(ers.)-2 3186 y
SDict begin H.S end
 -2 3186 a -2 3186 a
SDict begin 13 H.A end
 -2 3186 a
-2 3186 a
SDict begin [/View [/XYZ H.V]/Dest (0:2934) cvn /DEST pdfmark end
 -2 3186 a Black 396 3318 a Fj(\225)p Black
479 3318 a
SDict begin H.S end
 479 3318 a 479 3318 a
SDict begin 13 H.A end
 479 3318 a 479 3318
a
SDict begin [/View [/XYZ H.V]/Dest (0:2935) cvn /DEST pdfmark end
 479 3318 a Fk(W)-7 b(e)22 b(w)o(ait)f(for)e(the)h(\002rst)h(reply)-5
b(,)19 b(and)h(tak)o(e)g(that.)-2 3336 y
SDict begin H.S end
 -2 3336 a -2
3336 a
SDict begin 13 H.A end
 -2 3336 a -2 3336 a
SDict begin [/View [/XYZ H.V]/Dest (0:2936) cvn /DEST pdfmark end
 -2 3336 a Black 396 3467 a
Fj(\225)p Black 479 3467 a
SDict begin H.S end
 479 3467 a 479 3467 a
SDict begin 13 H.A end
 479
3467 a 479 3467 a
SDict begin [/View [/XYZ H.V]/Dest (0:2937) cvn /DEST pdfmark end
 479 3467 a Fk(W)-7 b(e)22 b(ignore)d(an)o(y)g(other)g
(replies.)-2 3651 y
SDict begin H.S end
 -2 3651 a -2 3651 a
SDict begin 13 H.A end
 -2 3651 a -2
3651 a
SDict begin [/View [/XYZ H.V]/Dest (0:2938) cvn /DEST pdfmark end
 -2 3651 a 396 3741 a Fk(What)i(will)g(happen)d(in)j(practice)e
(is)i(that)g(when)e(all)i(serv)o(ers)f(are)g(running,)d(\330MQ)k(will)g
(distrib)n(ute)f(the)g(requests)g(so)396 3849 y(each)g(serv)o(er)f
(gets)i(one)f(request,)f(and)h(sends)g(one)f(reply)-5
b(.)19 b(When)h(an)o(y)f(serv)o(er)h(is)h(of)n(\003ine,)e(and)h
(disconnected,)e(\330MQ)396 3957 y(will)j(distrib)n(ute)f(the)g
(requests)g(to)g(the)h(remaining)d(serv)o(ers.)h(So)i(a)f(serv)o(er)g
(may)f(in)i(some)f(cases)h(get)f(the)g(same)g(request)396
4065 y(more)g(than)f(once.)-2 4232 y
SDict begin H.S end
 -2 4232 a -2 4232
a
SDict begin 13 H.A end
 -2 4232 a -2 4232 a
SDict begin [/View [/XYZ H.V]/Dest (0:2939) cvn /DEST pdfmark end
 -2 4232 a 396 4339 a Fk(What')-5
b(s)21 b(more)f(anno)o(ying)e(for)h(the)h(client)h(is)g(that)f(we')o
(ll)g(get)h(multiple)e(replies)h(back,)g(b)n(ut)g(there')-5
b(s)20 b(no)g(guarantee)e(we')o(ll)396 4447 y(get)i(a)h(precise)f
(number)e(of)i(replies.)g(Requests)h(and)e(replies)h(can)g(get)h(lost)f
(\(e.g.)g(if)g(the)g(serv)o(er)g(crashes)g(while)396
4555 y(processing)f(a)i(request\).)-2 4739 y
SDict begin H.S end
 -2 4739
a -2 4739 a
SDict begin 13 H.A end
 -2 4739 a -2 4739 a
SDict begin [/View [/XYZ H.V]/Dest (0:2940) cvn /DEST pdfmark end
 -2 4739 a 396 4829 a
Fk(So,)f(we)h(ha)n(v)o(e)f(to)g(number)e(requests,)i(and)g(ignore)e(an)
o(y)i(replies)g(that)g(don')o(t)f(match)g(the)i(request)e(number)-5
b(.)19 b(Our)h(Model)396 4936 y(One)g(serv)o(er)g(will)h(w)o(ork,)e
(since)h(it')-5 b(s)22 b(an)e(echo)f(serv)o(er)m(,)g(b)n(ut)h
(coincidence)e(is)k(not)d(a)i(great)f(basis)h(for)e(understanding.)e
(So)396 5044 y(we')o(ll)k(mak)o(e)f(a)g(Model)g(T)-7
b(w)o(o)20 b(serv)o(er)f(that)i(che)n(ws)f(up)g(the)g(message,)g
(returns)f(a)i(correctly-numbered)15 b(reply)k(with)i(the)396
5152 y(content)e("OK".)i(W)-7 b(e')o(ll)21 b(use)f(messages)h
(consisting)e(of)h(tw)o(o)g(parts,)g(a)h(sequence)e(number)f(and)i(a)h
(body)-5 b(.)p Black 3759 5569 a Ff(234)p Black eop end
%%Page: 235 248
TeXDict begin 235 247 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.235) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2941) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Start)h(the)f(serv)o(er)f(once)h(or)g(more,)f
(specifying)g(a)h(bind)g(endpoint)e(each)i(time:)-2 90
y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:flserver2-c) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)h(4-80.)
d(Fr)o(eelance)h(ser)o(v)o(er)-8 b(,)21 b(Model)g(T)-6
b(w)o(o)20 b(\(\003ser)o(v)o(er2.c\))-2 374 y
SDict begin H.S end
 -2 374
a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:2944) cvn /DEST pdfmark end
 -2 374 a 396 454 a Fe(//)396
551 y(//)90 b(Freelance)43 b(server)h(-)g(Model)g(2)396
648 y(//)90 b(Does)44 b(some)g(work,)g(replies)g(OK,)g(with)g(message)g
(sequencing)396 745 y(//)396 843 y(#include)g("czmq.h")396
1037 y(int)h(main)f(\(int)g(argc,)g(char)1517 1050 y(*)1562
1037 y(argv)g([]\))396 1134 y({)576 1231 y(if)g(\(argc)g(<)h(2\))f({)
755 1328 y(printf)g(\("I:)g(syntax:)g(\045s)g(<endpoint>\\n",)f(argv)h
([0]\);)755 1425 y(exit)g(\(EXIT_SUCCESS\);)576 1522
y(})576 1620 y(zctx_t)889 1633 y(*)934 1620 y(ctx)h(=)f(zctx_new)g
(\(\);)576 1717 y(void)800 1730 y(*)845 1717 y(server)f(=)i
(zsocket_new)e(\(ctx,)h(ZMQ_REP\);)576 1814 y(zsocket_bind)e(\(server,)
i(argv)g([1]\);)576 2008 y(printf)f(\("I:)i(service)e(is)i(ready)f(at)g
(\045s\\n",)g(argv)g([1]\);)576 2105 y(while)g(\(true\))f({)755
2202 y(zmsg_t)1069 2215 y(*)1114 2202 y(request)g(=)i(zmsg_recv)e
(\(server\);)755 2300 y(if)h(\(!request\))934 2397 y(break;)448
b(//)89 b(Interrupted)755 2494 y(//)g(Fail)44 b(nastily)g(if)h(run)f
(against)g(wrong)g(client)755 2591 y(assert)g(\(zmsg_size)f
(\(request\))g(==)i(2\);)755 2785 y(zframe_t)1158 2798
y(*)1203 2785 y(address)f(=)h(zmsg_pop)e(\(request\);)755
2882 y(zmsg_destroy)g(\(&request\);)755 3077 y(zmsg_t)1069
3090 y(*)1114 3077 y(reply)h(=)g(zmsg_new)g(\(\);)755
3174 y(zmsg_add)f(\(reply,)h(address\);)755 3271 y(zmsg_addstr)f
(\(reply,)h("OK"\);)755 3368 y(zmsg_send)f(\(&reply,)h(server\);)576
3465 y(})576 3562 y(if)g(\(zctx_interrupted\))755 3659
y(printf)g(\("W:)g(interrupted\\n"\);)576 3854 y(zctx_destroy)e
(\(&ctx\);)576 3951 y(return)h(0;)396 4048 y(})-2 4222
y
SDict begin H.S end
 -2 4222 a -2 4222 a
SDict begin 13 H.A end
 -2 4222 a -2 4222 a
SDict begin [/View [/XYZ H.V]/Dest (0:2945) cvn /DEST pdfmark end
 -2 4222 a 396
4322 a Fk(Then)20 b(start)g(the)h(client,)f(specifying)e(the)i(connect)
f(endpoints)g(as)i(ar)o(guments:)-2 4340 y
SDict begin H.S end
 -2 4340 a
-2 4340 a
SDict begin 13 H.A end
 -2 4340 a -2 4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient2-c) cvn /DEST pdfmark
end
 -2 4340 a 396 4523 a Fg(Example)g(4-81.)d
(Fr)o(eelance)h(client,)i(Model)f(T)-6 b(w)o(o)21 b(\(\003client2.c\))
-2 4623 y
SDict begin H.S end
 -2 4623 a -2 4623 a
SDict begin 11.7 H.A end
 -2 4623 a -2 4623 a
SDict begin [/View [/XYZ H.V]/Dest (0:2948) cvn /DEST pdfmark end
 -2
4623 a 396 4703 a Fe(//)396 4801 y(//)90 b(Freelance)43
b(client)h(-)g(Model)g(2)396 4898 y(//)90 b(Uses)44 b(DEALER)g(socket)f
(to)i(blast)f(one)g(or)h(more)f(services)396 4995 y(//)396
5092 y(#include)g("czmq.h")p Black 3759 5569 a Ff(235)p
Black eop end
%%Page: 236 249
TeXDict begin 236 248 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.236) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 170 a Fe(//)90 b(We)44 b(design)g(our)g(client)g(API)g(as)h
(a)g(class,)e(using)h(the)h(CZMQ)f(style)396 267 y(#ifdef)g
(__cplusplus)396 364 y(extern)g("C")g({)396 461 y(#endif)396
655 y(typedef)g(struct)g(_flclient_t)f(flclient_t;)396
752 y(flclient_t)889 765 y(*)934 752 y(flclient_new)g(\(void\);)396
850 y(void)358 b(flclient_destroy)42 b(\(flclient_t)2234
863 y(**)2324 850 y(self_p\);)396 947 y(void)358 b(flclient_connect)42
b(\(flclient_t)2234 960 y(*)2279 947 y(self,)i(char)2772
960 y(*)2817 947 y(endpoint\);)396 1044 y(zmsg_t)889
1057 y(*)934 1044 y(flclient_request)e(\(flclient_t)2234
1057 y(*)2279 1044 y(self,)i(zmsg_t)2862 1057 y(**)2952
1044 y(request_p\);)396 1238 y(#ifdef)g(__cplusplus)396
1335 y(})396 1432 y(#endif)396 1627 y(//)90 b(If)44 b(not)g(a)h(single)
f(service)g(replies)f(within)h(this)g(time,)g(give)g(up)396
1724 y(#define)g(GLOBAL_TIMEOUT)e(2500)396 1918 y(int)j(main)f(\(int)g
(argc,)g(char)1517 1931 y(*)1562 1918 y(argv)g([]\))396
2015 y({)576 2112 y(if)g(\(argc)g(==)h(1\))f({)755 2209
y(printf)g(\("I:)g(syntax:)g(\045s)g(<endpoint>)f(...\\n",)h(argv)g
([0]\);)755 2307 y(exit)g(\(EXIT_SUCCESS\);)576 2404
y(})576 2501 y(//)89 b(Create)44 b(new)g(freelance)f(client)h(object)
576 2598 y(flclient_t)1069 2611 y(*)1114 2598 y(client)f(=)i
(flclient_new)e(\(\);)576 2792 y(//)89 b(Connect)44 b(to)g(each)g
(endpoint)576 2889 y(int)g(argn;)576 2987 y(for)g(\(argn)g(=)h(1;)f
(argn)g(<)h(argc;)f(argn++\))755 3084 y(flclient_connect)e(\(client,)i
(argv)g([argn]\);)576 3278 y(//)89 b(Send)44 b(a)h(bunch)f(of)g(name)g
(resolution)g('requests',)f(measure)g(time)576 3375 y(int)h(requests)f
(=)i(10000;)576 3472 y(uint64_t)e(start)h(=)h(zclock_time)e(\(\);)576
3569 y(while)h(\(requests--\))e({)755 3666 y(zmsg_t)1069
3679 y(*)1114 3666 y(request)h(=)i(zmsg_new)e(\(\);)755
3764 y(zmsg_addstr)g(\(request,)g("random)h(name"\);)755
3861 y(zmsg_t)1069 3874 y(*)1114 3861 y(reply)g(=)g(flclient_request)e
(\(client,)i(&request\);)755 3958 y(if)g(\(!reply\))g({)934
4055 y(printf)g(\("E:)g(name)g(service)g(not)g(available,)g
(aborting\\n"\);)934 4152 y(break;)755 4249 y(})755 4346
y(zmsg_destroy)f(\(&reply\);)576 4444 y(})576 4541 y(printf)g
(\("Average)h(round)g(trip)g(cost:)g(\045d)g(usec\\n",)755
4638 y(\(int\))g(\(zclock_time)f(\(\))h(-)h(start\))f(/)g(10\);)576
4832 y(flclient_destroy)e(\(&client\);)576 4929 y(return)h(0;)396
5026 y(})p Black 3757 5569 a Ff(236)p Black eop end
%%Page: 237 250
TeXDict begin 237 249 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.237) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2949) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Here)g(is)h(the)f(\003client)g(class)g
(implementation.)e(Each)h(instance)g(has)i(a)f(conte)o(xt,)e(a)i
(DEALER)g(sock)o(et)g(it)g(uses)h(to)f(talk)g(to)396
180 y(the)g(serv)o(ers,)g(a)g(counter)f(of)h(ho)n(w)g(man)o(y)f(serv)o
(ers)g(it')-5 b(s)22 b(connected)c(to,)i(and)g(a)g(request)g(sequence)f
(number:)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient2-c-1) cvn /DEST pdfmark
end

-2 198 a 396 382 a Fg(Example)i(4-82.)d(Fr)o(eelance)h(client,)i(Model)
f(T)-6 b(w)o(o)21 b(\(\003client2.c\))e(-)h(class)h(implementation)-2
482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:2952) cvn /DEST pdfmark end
 -2 482 a 396
756 a Fe(struct)44 b(_flclient_t)f({)576 853 y(zctx_t)889
866 y(*)934 853 y(ctx;)358 b(//)90 b(Our)44 b(context)g(wrapper)576
950 y(void)800 963 y(*)845 950 y(socket;)312 b(//)90
b(DEALER)43 b(socket)h(talking)g(to)g(servers)576 1048
y(size_t)f(servers;)223 b(//)90 b(How)44 b(many)g(servers)g(we)g(have)g
(connected)g(to)576 1145 y(uint)g(sequence;)267 b(//)90
b(Number)43 b(of)i(requests)e(ever)i(sent)396 1242 y(};)396
1436 y(//)90 b(-------------------------------------)o(------)o(------)
o(------)o(------)o(-----)o(--)396 1533 y(//)g(Constructor)396
1728 y(flclient_t)889 1741 y(*)396 1825 y(flclient_new)43
b(\(void\))396 1922 y({)576 2019 y(flclient_t)755 2129
y(*)800 2116 y(self;)576 2310 y(self)h(=)g(\(flclient_t)1427
2323 y(*)1472 2310 y(\))h(zmalloc)f(\(sizeof)f(\(flclient_t\)\);)576
2407 y(self->ctx)g(=)i(zctx_new)e(\(\);)576 2505 y(self->socket)f(=)j
(zsocket_new)e(\(self->ctx,)g(ZMQ_DEALER\);)576 2602
y(return)g(self;)396 2699 y(})396 2893 y(//)90 b
(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(--)396 2990 y(//)g(Destructor)396 3185
y(void)396 3282 y(flclient_destroy)42 b(\(flclient_t)1696
3295 y(**)1786 3282 y(self_p\))396 3379 y({)576 3476
y(assert)h(\(self_p\);)576 3573 y(if)h(\()755 3586 y(*)800
3573 y(self_p\))f({)755 3670 y(flclient_t)1248 3683 y(*)1293
3670 y(self)h(=)1607 3683 y(*)1652 3670 y(self_p;)755
3767 y(zctx_destroy)f(\(&self->ctx\);)755 3865 y(free)h(\(self\);)755
3975 y(*)800 3962 y(self_p)g(=)g(NULL;)576 4059 y(})396
4156 y(})396 4350 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(--)396 4447
y(//)g(Connect)43 b(to)i(new)f(server)g(endpoint)396
4642 y(void)396 4739 y(flclient_connect)e(\(flclient_t)1696
4752 y(*)1741 4739 y(self,)i(char)2234 4752 y(*)2279
4739 y(endpoint\))396 4836 y({)576 4933 y(assert)f(\(self\);)576
5030 y(zsocket_connect)f(\(self->socket,)g(endpoint\);)576
5127 y(self->servers++;)p Black 3756 5569 a Ff(237)p
Black eop end
%%Page: 238 251
TeXDict begin 238 250 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.238) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fe(})-2 247 y
SDict begin H.S end
 -2 247 a -2 247 a
SDict begin 13 H.A end
 -2 247
a -2 247 a
SDict begin [/View [/XYZ H.V]/Dest (0:2953) cvn /DEST pdfmark end
 -2 247 a 396 346 a Fk(The)g(request)g(method)e(does)i(the)h
(hard)e(w)o(ork.)g(It)i(sends)f(a)g(request)g(to)g(all)h(connected)d
(serv)o(ers)i(in)g(parallel)g(\(for)f(this)i(to)396 454
y(w)o(ork,)f(all)g(connections)f(ha)n(v)o(e)g(to)i(be)f(successful)g
(and)f(completed)g(by)h(this)g(time\).)g(It)h(then)e(w)o(aits)j(for)d
(a)i(single)396 562 y(successful)f(reply)-5 b(,)19 b(and)h(returns)f
(that)h(to)h(the)f(caller)-5 b(.)20 b(An)o(y)g(other)f(replies)h(are)g
(just)h(dropped:)-2 580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a
-2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient2-c-2) cvn /DEST pdfmark
end
 -2 580 a 396 764 a Fg(Example)g(4-83.)d(Fr)o(eelance)h
(client,)i(Model)f(T)-6 b(w)o(o)21 b(\(\003client2.c\))e(-)h(r)o
(equest)g(method)-2 864 y
SDict begin H.S end
 -2 864 a -2 864 a
SDict begin 11.7 H.A end
 -2 864 a
-2 864 a
SDict begin [/View [/XYZ H.V]/Dest (0:2956) cvn /DEST pdfmark end
 -2 864 a 396 1041 a Fe(zmsg_t)710 1054 y(*)396
1138 y(flclient_request)42 b(\(flclient_t)1696 1151 y(*)1741
1138 y(self,)i(zmsg_t)2324 1151 y(**)2414 1138 y(request_p\))396
1235 y({)576 1332 y(assert)f(\(self\);)576 1429 y(assert)g(\()934
1442 y(*)979 1429 y(request_p\);)576 1527 y(zmsg_t)889
1540 y(*)934 1527 y(request)h(=)1383 1540 y(*)1428 1527
y(request_p;)576 1721 y(//)89 b(Prefix)44 b(request)f(with)i(sequence)e
(number)h(and)g(empty)g(envelope)576 1818 y(char)g(sequence_text)e
([10];)576 1915 y(sprintf)h(\(sequence_text,)g("\045u",)h
(++self->sequence\);)576 2012 y(zmsg_pushstr)e(\(request,)i
(sequence_text\);)576 2109 y(zmsg_pushstr)e(\(request,)i(""\);)576
2304 y(//)89 b(Blast)44 b(the)g(request)g(to)g(all)h(connected)e
(servers)576 2401 y(int)h(server;)576 2498 y(for)g(\(server)g(=)g(0;)h
(server)f(<)g(self->servers;)f(server++\))g({)755 2595
y(zmsg_t)1069 2608 y(*)1114 2595 y(msg)h(=)h(zmsg_dup)e(\(request\);)
755 2692 y(zmsg_send)g(\(&msg,)h(self->socket\);)576
2789 y(})576 2887 y(//)89 b(Wait)44 b(for)g(a)h(matching)f(reply)g(to)g
(arrive)g(from)g(anywhere)576 2984 y(//)89 b(Since)44
b(we)g(can)h(poll)f(several)g(times,)f(calculate)h(each)g(one)576
3081 y(zmsg_t)889 3094 y(*)934 3081 y(reply)g(=)h(NULL;)576
3178 y(uint64_t)e(endtime)h(=)g(zclock_time)f(\(\))i(+)g
(GLOBAL_TIMEOUT;)576 3275 y(while)f(\(zclock_time)e(\(\))j(<)g
(endtime\))e({)755 3372 y(zmq_pollitem_t)f(items)i([])h(=)g({)f({)h
(self->socket,)e(0,)h(ZMQ_POLLIN,)f(0)i(})f(};)755 3469
y(zmq_poll)f(\(items,)h(1,)h(\(endtime)e(-)i(zclock_time)e(\(\)\))2862
3482 y(*)2952 3469 y(ZMQ_POLL_MSEC\);)755 3566 y(if)h(\(items)g
([0].revents)f(&)i(ZMQ_POLLIN\))e({)934 3664 y(//)90
b(Reply)44 b(is)g([empty][sequence][OK])934 3761 y(reply)g(=)h
(zmsg_recv)e(\(self->socket\);)934 3858 y(assert)h(\(zmsg_size)f
(\(reply\))h(==)g(3\);)934 3955 y(free)g(\(zmsg_popstr)f(\(reply\)\);)
934 4052 y(char)1158 4065 y(*)1203 4052 y(sequence)h(=)g(zmsg_popstr)f
(\(reply\);)934 4149 y(int)i(sequence_nbr)d(=)j(atoi)f(\(sequence\);)
934 4246 y(free)g(\(sequence\);)934 4344 y(if)h(\(sequence_nbr)d(==)j
(self->sequence\))1114 4441 y(break;)755 4538 y(})576
4635 y(})576 4732 y(zmsg_destroy)d(\(request_p\);)576
4829 y(return)h(reply;)396 4926 y(})p Black 3759 5569
a Ff(238)p Black eop end
%%Page: 239 252
TeXDict begin 239 251 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.239) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2957) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Some)g(notes)g(on)g(this)h(code:)-2
73 y
SDict begin H.S end
 -2 73 a -2 73 a
SDict begin 13 H.A end
 -2 73 a -2 73 a
SDict begin [/View [/XYZ H.V]/Dest (0:2958) cvn /DEST pdfmark end
 -2 73 a -2 83 a
SDict begin H.S end

-2 83 a -2 83 a
SDict begin 13 H.A end
 -2 83 a -2 83 a
SDict begin [/View [/XYZ H.V]/Dest (0:2959) cvn /DEST pdfmark end
 -2 83 a Black 396 243
a Fj(\225)p Black 479 243 a
SDict begin H.S end
 479 243 a 479 243 a
SDict begin 13 H.A end
 479 243
a 479 243 a
SDict begin [/View [/XYZ H.V]/Dest (0:2960) cvn /DEST pdfmark end
 479 243 a Fk(The)f(client)g(is)h(structured)e(as)i(a)g
(nice)f(little)h(class-based)f(API)g(that)g(hides)g(the)h(dirty)e(w)o
(ork)h(of)g(creating)f(\330MQ)479 351 y(conte)o(xts)h(and)f(sock)o
(ets,)h(and)g(talking)f(to)i(the)f(serv)o(er)-5 b(.)19
b(If)h(a)h(shotgun)e(blast)h(to)h(the)f(midrif)n(f)f(can)h(be)g(called)
g("talking".)-2 369 y
SDict begin H.S end
 -2 369 a -2 369 a
SDict begin 13 H.A end
 -2 369 a -2 369
a
SDict begin [/View [/XYZ H.V]/Dest (0:2961) cvn /DEST pdfmark end
 -2 369 a Black 396 500 a Fj(\225)p Black 479 500 a
SDict begin H.S end

479 500 a 479 500 a
SDict begin 13 H.A end
 479 500 a 479 500 a
SDict begin [/View [/XYZ H.V]/Dest (0:2962) cvn /DEST pdfmark end
 479 500 a Fk(The)g(client)g
(will)h(abandon)d(the)j(chase)f(if)g(it)h(can')o(t)e(\002nd)2087
500 y
SDict begin H.S end
 2087 500 a 2087 500 a
SDict begin 13 H.A end
 2087 500 a 2087 500 a
SDict begin [/View [/XYZ H.V]/Dest (0:2963) cvn /DEST pdfmark end
 2087
500 a Ff(any)h Fk(responsi)n(v)o(e)e(serv)o(er)i(within)g(a)g(fe)n(w)g
(seconds.)-2 518 y
SDict begin H.S end
 -2 518 a -2 518 a
SDict begin 13 H.A end
 -2 518 a -2 518
a
SDict begin [/View [/XYZ H.V]/Dest (0:2964) cvn /DEST pdfmark end
 -2 518 a Black 396 649 a Fj(\225)p Black 479 649 a
SDict begin H.S end

479 649 a 479 649 a
SDict begin 13 H.A end
 479 649 a 479 649 a
SDict begin [/View [/XYZ H.V]/Dest (0:2965) cvn /DEST pdfmark end
 479 649 a Fk(The)g(client)g
(has)h(to)f(create)g(a)h(v)n(alid)e(REP)i(en)m(v)o(elope,)d(i.e.)i(add)
g(an)g(empty)f(message)h(frame)g(to)g(the)g(front)f(of)h(the)479
757 y(message.)-2 941 y
SDict begin H.S end
 -2 941 a -2 941 a
SDict begin 13 H.A end
 -2 941 a -2
941 a
SDict begin [/View [/XYZ H.V]/Dest (0:2966) cvn /DEST pdfmark end
 -2 941 a 396 1031 a Fk(The)g(client)g(does)g(10,000)e(name)i
(resolution)f(requests)h(\(f)o(ak)o(e)f(ones,)h(since)g(our)g(serv)o
(er)f(does)h(essentially)g(nothing\),)396 1139 y(and)g(measures)g(the)g
(a)n(v)o(erage)f(cost.)h(On)g(my)g(test)h(box,)e(talking)h(to)g(one)g
(serv)o(er)m(,)e(it')-5 b(s)22 b(about)d(60)h(usec.)g(T)-7
b(alking)19 b(to)h(three)396 1247 y(serv)o(ers,)g(it')-5
b(s)21 b(about)e(80)h(usec.)-2 1425 y
SDict begin H.S end
 -2 1425 a -2 1425
a
SDict begin 13 H.A end
 -2 1425 a -2 1425 a
SDict begin [/View [/XYZ H.V]/Dest (0:2967) cvn /DEST pdfmark end
 -2 1425 a 396 1521 a Fk(So)h(pros)e(and)h(cons)g
(of)g(our)f(shotgun)g(approach:)-2 1539 y
SDict begin H.S end
 -2 1539 a -2
1539 a
SDict begin 13 H.A end
 -2 1539 a -2 1539 a
SDict begin [/View [/XYZ H.V]/Dest (0:2968) cvn /DEST pdfmark end
 -2 1539 a -2 1549 a
SDict begin H.S end
 -2 1549
a -2 1549 a
SDict begin 13 H.A end
 -2 1549 a -2 1549 a
SDict begin [/View [/XYZ H.V]/Dest (0:2969) cvn /DEST pdfmark end
 -2 1549 a Black 396 1691
a Fj(\225)p Black 479 1691 a
SDict begin H.S end
 479 1691 a 479 1691 a
SDict begin 13 H.A end
 479
1691 a 479 1691 a
SDict begin [/View [/XYZ H.V]/Dest (0:2970) cvn /DEST pdfmark end
 479 1691 a Fk(Pro:)h(it)h(is)g(simple,)f(easy)h(to)f
(mak)o(e)g(and)f(easy)i(to)f(understand.)-2 1709 y
SDict begin H.S end
 -2
1709 a -2 1709 a
SDict begin 13 H.A end
 -2 1709 a -2 1709 a
SDict begin [/View [/XYZ H.V]/Dest (0:2971) cvn /DEST pdfmark end
 -2 1709 a Black
396 1841 a Fj(\225)p Black 479 1841 a
SDict begin H.S end
 479 1841 a 479
1841 a
SDict begin 13 H.A end
 479 1841 a 479 1841 a
SDict begin [/View [/XYZ H.V]/Dest (0:2972) cvn /DEST pdfmark end
 479 1841 a Fk(Pro:)g(it)h(does)f(the)g
(job)g(of)g(f)o(ail-o)o(v)o(er)m(,)e(and)i(w)o(orks)f(rapidly)-5
b(,)19 b(so)h(long)g(as)h(there)e(is)i(at)g(least)g(one)f(serv)o(er)f
(running.)-2 1859 y
SDict begin H.S end
 -2 1859 a -2 1859 a
SDict begin 13 H.A end
 -2 1859 a -2
1859 a
SDict begin [/View [/XYZ H.V]/Dest (0:2973) cvn /DEST pdfmark end
 -2 1859 a Black 396 1990 a Fj(\225)p Black 479
1990 a
SDict begin H.S end
 479 1990 a 479 1990 a
SDict begin 13 H.A end
 479 1990 a 479 1990 a
SDict begin [/View [/XYZ H.V]/Dest (0:2974) cvn /DEST pdfmark end
 479
1990 a Fk(Con:)i(it)f(creates)h(redundant)c(netw)o(ork)i(traf)n(\002c.)
-2 1991 y
SDict begin H.S end
 -2 1991 a -2 1991 a
SDict begin 13 H.A end
 -2 1991 a -2 1991 a
SDict begin [/View [/XYZ H.V]/Dest (0:2975) cvn /DEST pdfmark end
 -2
1991 a Black 396 2140 a Fj(\225)p Black 479 2140 a
SDict begin H.S end
 479
2140 a 479 2140 a
SDict begin 13 H.A end
 479 2140 a 479 2140 a
SDict begin [/View [/XYZ H.V]/Dest (0:2976) cvn /DEST pdfmark end
 479 2140 a Fk(Con:)i(we)f(can')
o(t)f(prioritize)g(our)h(serv)o(ers,)f(i.e.)h(Primary)-5
b(,)19 b(then)h(Secondary)-5 b(.)-2 2158 y
SDict begin H.S end
 -2 2158 a
-2 2158 a
SDict begin 13 H.A end
 -2 2158 a -2 2158 a
SDict begin [/View [/XYZ H.V]/Dest (0:2977) cvn /DEST pdfmark end
 -2 2158 a Black 396 2289
a Fj(\225)p Black 479 2289 a
SDict begin H.S end
 479 2289 a 479 2289 a
SDict begin 13 H.A end
 479
2289 a 479 2289 a
SDict begin [/View [/XYZ H.V]/Dest (0:2978) cvn /DEST pdfmark end
 479 2289 a Fk(Con:)21 b(the)f(serv)o(er)f(can)h(do)g
(at)h(most)f(one)f(request)h(at)h(a)f(time,)g(period.)-2
2349 y
SDict begin H.S end
 -2 2349 a -2 2349 a
SDict begin 13 H.A end
 -2 2349 a -2 2349 a
SDict begin [/View [/XYZ H.V]/Dest (0:2979) cvn /DEST pdfmark end
 -2 2349
a 396 2659 a Fb(4.14.3.)36 b(Model)e(Three)f(-)h(Comple)n(x)h(and)f
(Nasty)2712 2659 y
SDict begin H.S end
 2712 2659 a 2712 2659 a
SDict begin 18.72 H.A end
 2712 2659
a 2712 2659 a
SDict begin [/View [/XYZ H.V]/Dest (9.68.20.2) cvn /DEST pdfmark end
 2712 2659 a -2 2850 a
SDict begin H.S end
 -2 2850 a -2 2850
a
SDict begin 13 H.A end
 -2 2850 a -2 2850 a
SDict begin [/View [/XYZ H.V]/Dest (0:2981) cvn /DEST pdfmark end
 -2 2850 a 396 2933 a Fk(The)20
b(shotgun)e(approach)g(seems)i(too)f(good)g(to)h(be)f(true.)h(Let')-5
b(s)20 b(be)g(scienti\002c)g(and)f(w)o(ork)g(through)f(all)i(the)g
(alternati)n(v)o(es.)396 3041 y(W)-7 b(e')l(re)21 b(going)d(to)j(e)o
(xplore)d(the)j(comple)o(x/nasty)c(option,)i(e)n(v)o(en)g(if)i(it')-5
b(s)21 b(only)e(to)i(\002nally)f(realize)g(that)g(we)g(preferred)396
3149 y(brutal.)f(Ah,)h(the)h(story)e(of)h(my)g(life.)-2
3333 y
SDict begin H.S end
 -2 3333 a -2 3333 a
SDict begin 13 H.A end
 -2 3333 a -2 3333 a
SDict begin [/View [/XYZ H.V]/Dest (0:2982) cvn /DEST pdfmark end
 -2 3333
a 396 3423 a Fk(W)-7 b(e)22 b(can)e(solv)o(e)f(the)i(main)e(problems)g
(of)h(the)g(client)g(by)g(switching)g(to)g(a)h(R)m(OUTER)f(sock)o(et.)g
(That)g(lets)h(us)g(send)396 3531 y(requests)f(to)g(speci\002c)h(serv)o
(ers,)e(a)n(v)n(oid)h(serv)o(ers)g(we)g(kno)n(w)f(are)i(dead,)e(and)g
(in)i(general)e(be)h(as)h(smart)f(as)h(we)g(w)o(ant)f(to)396
3638 y(mak)o(e)g(it.)h(W)-7 b(e)21 b(can)f(also)h(solv)o(e)e(the)h
(main)g(problem)f(of)h(the)g(serv)o(er)f(\(single-threadedness\))e(by)j
(switching)f(to)i(a)396 3746 y(R)m(OUTER)g(sock)o(et.)-2
3913 y
SDict begin H.S end
 -2 3913 a -2 3913 a
SDict begin 13 H.A end
 -2 3913 a -2 3913 a
SDict begin [/View [/XYZ H.V]/Dest (0:2983) cvn /DEST pdfmark end
 -2 3913
a 396 4020 a Fk(But)g(doing)e(R)m(OUTER-to-R)m(OUTER)g(between)g(tw)o
(o)i(anon)o(ymous)c(sock)o(ets)k(\(which)e(ha)n(v)o(en')o(t)f(set)j(an)
f(identity\))f(is)j(not)396 4128 y(possible.)e(Both)g(sides)h(generate)
e(an)h(identity)f(\(for)h(the)g(other)f(peer\))h(only)f(when)g(the)o(y)
h(recei)n(v)o(e)f(a)i(\002rst)g(message,)e(and)396 4236
y(thus)h(neither)e(can)h(talk)h(to)f(the)h(other)e(until)h(it)i(has)e
(\002rst)h(recei)n(v)o(ed)e(a)i(message.)f(The)g(only)g(w)o(ay)g(out)g
(of)g(this)h(conundrum)396 4344 y(is)h(to)g(cheat,)e(and)h(use)g
(hard-coded)e(identities)i(in)g(one)g(direction.)e(The)i(proper)f(w)o
(ay)h(to)g(cheat,)g(in)g(a)h(client)f(serv)o(er)396 4452
y(case,)h(is)g(that)f(the)g(client)h('kno)n(ws')d(the)i(identity)g(of)g
(the)g(serv)o(er)-5 b(.)20 b(V)-5 b(ice-v)o(ersa)19 b(w)o(ould)g(be)h
(insane,)g(on)g(top)g(of)f(comple)o(x)396 4560 y(and)h(nasty)-5
b(.)19 b(Insane,)g(comple)o(x,)g(and)g(nasty)h(are)g(great)g(attrib)n
(utes)g(for)g(a)g(genocidal)f(dictator)m(,)g(b)n(ut)h(terrible)g(ones)f
(for)396 4668 y(softw)o(are.)-2 4835 y
SDict begin H.S end
 -2 4835 a -2 4835
a
SDict begin 13 H.A end
 -2 4835 a -2 4835 a
SDict begin [/View [/XYZ H.V]/Dest (0:2984) cvn /DEST pdfmark end
 -2 4835 a 396 4942 a Fk(Rather)h(than)g(in)m(v)o
(ent)f(yet)h(another)f(concept)g(to)h(manage,)f(we')o(ll)h(use)h(the)f
(connection)e(endpoint)g(as)j(identity)-5 b(.)19 b(This)h(is)h(a)396
5050 y(unique)e(string)h(both)f(sides)i(can)f(agree)g(on)f(without)h
(more)f(prior)g(kno)n(wledge)f(than)i(the)o(y)f(already)h(ha)n(v)o(e)f
(for)h(the)396 5158 y(shotgun)f(model.)g(It')-5 b(s)21
b(a)f(sneak)o(y)g(and)f(ef)n(fecti)n(v)o(e)g(w)o(ay)h(to)h(connect)d
(tw)o(o)j(R)m(OUTER)f(sock)o(ets.)p Black 3759 5569 a
Ff(239)p Black eop end
%%Page: 240 253
TeXDict begin 240 252 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.240) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:2985) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Remember)f(ho)n(w)h(\330MQ)g(identities)h(w)o(ork.)e
(The)h(serv)o(er)f(R)m(OUTER)i(sock)o(et)f(sets)h(an)f(identity)g
(before)e(it)j(binds)f(its)396 180 y(sock)o(et.)g(When)g(a)h(client)f
(connects,)f(the)o(y)g(do)h(a)h(little)g(handshak)o(e)d(to)j(e)o
(xchange)d(identities,)h(before)g(either)h(side)h(sends)396
288 y(a)g(real)f(message.)g(The)g(client)g(R)m(OUTER)g(sock)o(et,)g(ha)
n(ving)f(not)h(set)h(an)f(identity)-5 b(,)19 b(sends)h(a)h(null)f
(identity)f(to)i(the)f(serv)o(er)-5 b(.)396 396 y(The)20
b(serv)o(er)f(generates)h(a)g(random)f(UUID)h(for)f(the)i(client,)f
(for)f(its)i(o)n(wn)f(use.)g(The)g(serv)o(er)f(sends)i(its)g(identity)e
(\(which)396 504 y(we')l(v)o(e)g(agreed)g(is)j(going)c(to)j(be)f(an)g
(endpoint)e(string\))i(to)g(the)g(client.)-2 688 y
SDict begin H.S end
 -2
688 a -2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:2986) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(This)h(means)f
(our)f(client)h(can)g(route)g(a)g(message)g(to)h(the)f(serv)o(er)f
(\(i.e.)h(send)g(on)g(its)h(R)m(OUTER)f(sock)o(et,)g(specifying)f(the)
396 886 y(serv)o(er)h(endpoint)e(as)j(identity\))e(as)i(soon)e(as)i
(the)g(connection)d(is)j(established.)e(That')-5 b(s)21
b(not)3028 886 y
SDict begin H.S end
 3028 886 a 3028 886 a
SDict begin 13 H.A end
 3028 886 a 3028
886 a
SDict begin [/View [/XYZ H.V]/Dest (0:2987) cvn /DEST pdfmark end
 3028 886 a Ff(immediately)f Fk(after)g(doing)f(a)396
994 y(zmq_connect,)e(b)n(ut)k(some)f(random)e(time)i(thereafter)-5
b(.)19 b(Herein)h(lies)h(one)f(problem:)e(we)j(don')o(t)d(kno)n(w)i
(when)f(the)h(serv)o(er)396 1102 y(will)h(actually)f(be)g(a)n(v)n
(ailable)g(and)f(complete)g(its)j(connection)c(handshak)o(e.)g(If)i
(the)g(serv)o(er)f(is)i(actually)f(online,)f(it)i(could)396
1210 y(be)f(after)g(a)h(fe)n(w)f(milliseconds.)f(If)h(the)h(serv)o(er)e
(is)i(do)n(wn,)e(and)h(the)g(sysadmin)f(is)i(out)f(to)g(lunch,)f(it)i
(could)f(be)g(an)g(hour)-5 b(.)-2 1394 y
SDict begin H.S end
 -2 1394 a -2
1394 a
SDict begin 13 H.A end
 -2 1394 a -2 1394 a
SDict begin [/View [/XYZ H.V]/Dest (0:2988) cvn /DEST pdfmark end
 -2 1394 a 396 1484 a Fk(There')g(s)20
b(a)h(small)f(paradox)e(here.)i(W)-7 b(e)21 b(need)f(to)g(kno)n(w)f
(when)h(serv)o(ers)f(become)g(connected)g(and)g(a)n(v)n(ailable)h(for)g
(w)o(ork.)396 1592 y(In)g(the)g(Freelance)g(pattern,)f(unlik)o(e)g(the)
i(brok)o(er)n(-based)c(patterns)j(we)g(sa)o(w)h(earlier)f(in)g(this)h
(chapter)m(,)d(serv)o(ers)i(are)g(silent)396 1700 y(until)g(spok)o(en)f
(to.)i(Thus)e(we)i(can')o(t)e(talk)h(to)h(a)f(serv)o(er)g(until)g(it')
-5 b(s)21 b(told)f(us)g(it')-5 b(s)22 b(on-line,)c(which)i(it)h(can')o
(t)e(do)h(until)g(we')l(v)o(e)396 1808 y(ask)o(ed)g(it.)-2
1975 y
SDict begin H.S end
 -2 1975 a -2 1975 a
SDict begin 13 H.A end
 -2 1975 a -2 1975 a
SDict begin [/View [/XYZ H.V]/Dest (0:2989) cvn /DEST pdfmark end
 -2 1975
a 396 2082 a Fk(My)g(solution)g(is)h(to)f(mix)g(in)g(a)h(little)g(of)f
(the)g(shotgun)f(approach)f(from)h(model)g(2,)h(meaning)f(we')o(ll)i
(\002re)f(\(harmless\))396 2190 y(shots)h(at)f(an)o(ything)e(we)j(can,)
f(and)f(if)i(an)o(ything)d(mo)o(v)o(es,)h(we)h(kno)n(w)g(it')-5
b(s)21 b(ali)n(v)o(e.)e(W)-7 b(e')l(re)21 b(not)f(going)e(to)j(\002re)f
(real)g(requests,)396 2297 y(b)n(ut)g(rather)g(a)g(kind)g(of)g
(ping-pong)d(heartbeat.)-2 2481 y
SDict begin H.S end
 -2 2481 a -2 2481 a
SDict begin 13 H.A end

-2 2481 a -2 2481 a
SDict begin [/View [/XYZ H.V]/Dest (0:2990) cvn /DEST pdfmark end
 -2 2481 a 396 2571 a Fk(This)k(brings)e(us)i(to)f
(the)g(realm)g(of)g(protocols)f(again,)f(so)j(here')-5
b(s)20 b(a)h(short)e(spec)i(that)f(de\002nes)g(ho)n(w)g(a)g(Freelance)g
(client)396 2679 y(and)g(serv)o(er)f(e)o(xchange)f(PING-PONG)i
(commands,)f(and)g(request-reply)f(commands:)-2 2697
y
SDict begin H.S end
 -2 2697 a -2 2697 a
SDict begin 13 H.A end
 -2 2697 a -2 2697 a
SDict begin [/View [/XYZ H.V]/Dest (0:2991) cvn /DEST pdfmark end
 -2 2697 a -2
2707 a
SDict begin H.S end
 -2 2707 a -2 2707 a
SDict begin 13 H.A end
 -2 2707 a -2 2707 a
SDict begin [/View [/XYZ H.V]/Dest (0:2992) cvn /DEST pdfmark end
 -2 2707
a Black 396 2850 a Fj(\225)p Black 479 2850 a
SDict begin H.S end
 479 2850
a 479 2850 a
SDict begin 13 H.A end
 479 2850 a 479 2850 a
SDict begin [/View [/XYZ H.V]/Dest (0:2993) cvn /DEST pdfmark end
 479 2850 a Fk(http://rfc.zeromq.or)o
(g/spec:10)-2 3034 y
SDict begin H.S end
 -2 3034 a -2 3034 a
SDict begin 13 H.A end
 -2 3034 a -2
3034 a
SDict begin [/View [/XYZ H.V]/Dest (0:2994) cvn /DEST pdfmark end
 -2 3034 a 396 3124 a Fk(It)j(is)g(short)f(and)f(sweet)i(to)f
(implement)f(as)i(a)g(serv)o(er)-5 b(.)19 b(Here')-5
b(s)21 b(our)e(echo)h(serv)o(er)m(,)f(Model)g(Three,)g(no)n(w)h
(speaking)f(FLP)-9 b(.)-2 3308 y
SDict begin H.S end
 -2 3308 a -2 3308 a
SDict begin 13 H.A end

-2 3308 a -2 3308 a
SDict begin [/View [/XYZ H.V]/Dest (0:2995) cvn /DEST pdfmark end
 -2 3308 a 396 3398 a Fk(Model)20
b(Three)f(of)h(the)g(serv)o(er)g(is)h(just)f(slightly)g(dif)n(ferent:)
-2 3415 y
SDict begin H.S end
 -2 3415 a -2 3415 a
SDict begin 13 H.A end
 -2 3415 a -2 3415 a
SDict begin [/View [/XYZ H.V]/Dest (0:flserver3-c) cvn /DEST pdfmark
end
 -2
3415 a 396 3599 a Fg(Example)h(4-84.)d(Fr)o(eelance)h(ser)o(v)o(er)-8
b(,)21 b(Model)g(Thr)o(ee)f(\(\003ser)o(v)o(er3.c\))-2
3699 y
SDict begin H.S end
 -2 3699 a -2 3699 a
SDict begin 11.7 H.A end
 -2 3699 a -2 3699 a
SDict begin [/View [/XYZ H.V]/Dest (0:2998) cvn /DEST pdfmark end
 -2 3699
a 396 3779 a Fe(//)396 3876 y(//)90 b(Freelance)43 b(server)h(-)g
(Model)g(3)396 3973 y(//)90 b(Uses)44 b(an)g(ROUTER/ROUTER)f(socket)h
(but)g(just)g(one)h(thread)396 4070 y(//)396 4168 y(#include)f
("czmq.h")396 4362 y(int)h(main)f(\(int)g(argc,)g(char)1517
4375 y(*)1562 4362 y(argv)g([]\))396 4459 y({)576 4556
y(int)g(verbose)g(=)g(\(argc)g(>)h(1)g(&&)f(streq)g(\(argv)g([1],)g
("-v"\)\);)576 4750 y(zctx_t)889 4763 y(*)934 4750 y(ctx)h(=)f
(zctx_new)g(\(\);)576 4945 y(//)89 b(Prepare)44 b(server)f(socket)h
(with)g(predictable)f(identity)576 5042 y(char)800 5055
y(*)845 5042 y(bind_endpoint)f(=)j("tcp://)1877 5055
y(*)1922 5042 y(:5555";)576 5139 y(char)800 5152 y(*)845
5139 y(connect_endpoint)d(=)i("tcp://localhost:5555";)p
Black 3759 5569 a Ff(240)p Black eop end
%%Page: 241 254
TeXDict begin 241 253 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.241) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(void)800 85 y(*)845 72 y(server)43
b(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576 170 y(zmq_setsockopt)e
(\(server,)755 267 y(ZMQ_IDENTITY,)h(connect_endpoint,)f(strlen)h
(\(connect_endpoint\)\);)576 364 y(zsocket_bind)f(\(server,)i
(bind_endpoint\);)576 461 y(printf)f(\("I:)i(service)e(is)i(ready)f(at)
g(\045s\\n",)g(bind_endpoint\);)576 655 y(while)g
(\(!zctx_interrupted\))d({)755 752 y(zmsg_t)1069 765
y(*)1114 752 y(request)i(=)i(zmsg_recv)e(\(server\);)755
850 y(if)h(\(verbose)g(&&)g(request\))934 947 y(zmsg_dump)g
(\(request\);)755 1044 y(if)g(\(!request\))934 1141 y(break;)448
b(//)89 b(Interrupted)755 1335 y(//)g(Frame)44 b(0:)h(identity)e(of)i
(client)755 1432 y(//)89 b(Frame)44 b(1:)h(PING,)f(or)g(client)g
(control)g(frame)755 1530 y(//)89 b(Frame)44 b(2:)h(request)e(body)755
1627 y(zframe_t)1158 1640 y(*)1203 1627 y(address)h(=)h(zmsg_pop)e
(\(request\);)755 1724 y(zframe_t)1158 1737 y(*)1203
1724 y(control)h(=)h(zmsg_pop)e(\(request\);)755 1821
y(zmsg_t)1069 1834 y(*)1114 1821 y(reply)h(=)g(zmsg_new)g(\(\);)755
1918 y(if)g(\(zframe_streq)f(\(control,)g("PING"\)\))934
2015 y(zmsg_addstr)g(\(reply,)h("PONG"\);)755 2112 y(else)g({)934
2209 y(zmsg_add)g(\(reply,)f(control\);)934 2307 y(zmsg_addstr)g
(\(reply,)h("OK"\);)755 2404 y(})755 2501 y(zmsg_destroy)f
(\(&request\);)755 2598 y(zmsg_push)g(\(reply,)h(address\);)755
2695 y(if)g(\(verbose)g(&&)g(reply\))934 2792 y(zmsg_dump)g(\(reply\);)
755 2889 y(zmsg_send)f(\(&reply,)h(server\);)576 2987
y(})576 3084 y(if)g(\(zctx_interrupted\))755 3181 y(printf)g(\("W:)g
(interrupted\\n"\);)576 3375 y(zctx_destroy)e(\(&ctx\);)576
3472 y(return)h(0;)396 3569 y(})-2 3744 y
SDict begin H.S end
 -2 3744 a -2
3744 a
SDict begin 13 H.A end
 -2 3744 a -2 3744 a
SDict begin [/View [/XYZ H.V]/Dest (0:2999) cvn /DEST pdfmark end
 -2 3744 a 396 3843 a Fk(The)20
b(Freelance)g(client,)g(ho)n(we)n(v)o(er)m(,)d(has)k(gotten)e(lar)o
(ge.)g(F)o(or)h(clarity)-5 b(,)19 b(it')-5 b(s)21 b(split)g(into)f(an)g
(e)o(xample)f(application)g(and)g(a)396 3951 y(class)i(that)g(does)f
(the)g(hard)f(w)o(ork.)g(Here')-5 b(s)21 b(the)f(top-le)n(v)o(el)f
(application:)-2 3969 y
SDict begin H.S end
 -2 3969 a -2 3969 a
SDict begin 13 H.A end
 -2 3969 a
-2 3969 a
SDict begin [/View [/XYZ H.V]/Dest (0:flclient3-c) cvn /DEST pdfmark
end
 -2 3969 a 396 4153 a Fg(Example)i(4-85.)d(Fr)o(eelance)h
(client,)i(Model)f(Thr)o(ee)h(\(\003client3.c\))-2 4252
y
SDict begin H.S end
 -2 4252 a -2 4252 a
SDict begin 11.7 H.A end
 -2 4252 a -2 4252 a
SDict begin [/View [/XYZ H.V]/Dest (0:3002) cvn /DEST pdfmark end
 -2 4252 a 396
4333 a Fe(//)396 4430 y(//)90 b(Freelance)43 b(client)h(-)g(Model)g(3)
396 4527 y(//)90 b(Uses)44 b(flcliapi)f(class)h(to)h(encapsulate)e
(Freelance)g(pattern)396 4624 y(//)396 4721 y(//)90 b(Lets)44
b(us)g(build)g(this)g(source)g(without)g(creating)f(a)i(library)396
4818 y(#include)f("flcliapi.c")396 5013 y(int)h(main)f(\(void\))396
5110 y({)p Black 3759 5569 a Ff(241)p Black eop end
%%Page: 242 255
TeXDict begin 242 254 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.242) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(//)89 b(Create)44 b(new)g(freelance)f(client)h
(object)576 170 y(flcliapi_t)1069 183 y(*)1114 170 y(client)f(=)i
(flcliapi_new)e(\(\);)576 364 y(//)89 b(Connect)44 b(to)g(several)g
(endpoints)576 461 y(flcliapi_connect)e(\(client,)h
("tcp://localhost:5555"\);)576 558 y(flcliapi_connect)f(\(client,)h
("tcp://localhost:5556"\);)576 655 y(flcliapi_connect)f(\(client,)h
("tcp://localhost:5557"\);)576 850 y(//)89 b(Send)44
b(a)h(bunch)f(of)g(name)g(resolution)g('requests',)f(measure)g(time)576
947 y(int)h(requests)f(=)i(1000;)576 1044 y(uint64_t)e(start)h(=)h
(zclock_time)e(\(\);)576 1141 y(while)h(\(requests--\))e({)755
1238 y(zmsg_t)1069 1251 y(*)1114 1238 y(request)h(=)i(zmsg_new)e(\(\);)
755 1335 y(zmsg_addstr)g(\(request,)g("random)h(name"\);)755
1432 y(zmsg_t)1069 1445 y(*)1114 1432 y(reply)g(=)g(flcliapi_request)e
(\(client,)i(&request\);)755 1530 y(if)g(\(!reply\))g({)934
1627 y(printf)g(\("E:)g(name)g(service)g(not)g(available,)g
(aborting\\n"\);)934 1724 y(break;)755 1821 y(})755 1918
y(zmsg_destroy)f(\(&reply\);)576 2015 y(})576 2112 y(printf)g
(\("Average)h(round)g(trip)g(cost:)g(\045d)g(usec\\n",)755
2209 y(\(int\))g(\(zclock_time)f(\(\))h(-)h(start\))f(/)g(10\);)576
2404 y(flcliapi_destroy)e(\(&client\);)576 2501 y(return)h(0;)396
2598 y(})-2 2772 y
SDict begin H.S end
 -2 2772 a -2 2772 a
SDict begin 13 H.A end
 -2 2772 a -2 2772
a
SDict begin [/View [/XYZ H.V]/Dest (0:3003) cvn /DEST pdfmark end
 -2 2772 a 396 2872 a Fk(And)20 b(here,)f(almost)i(as)f(comple)o(x)f
(and)h(lar)o(ge)f(as)i(the)f(Majordomo)e(brok)o(er)m(,)g(is)j(the)f
(client)g(API)h(class:)-2 2890 y
SDict begin H.S end
 -2 2890 a -2 2890 a
SDict begin 13 H.A end

-2 2890 a -2 2890 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c) cvn /DEST pdfmark
end
 -2 2890 a 396 3073 a Fg(Example)g(4-86.)d(Fr)o
(eelance)h(client)i(API)g(\(\003cliapi.c\))-2 3173 y
SDict begin H.S end

-2 3173 a -2 3173 a
SDict begin 11.7 H.A end
 -2 3173 a -2 3173 a
SDict begin [/View [/XYZ H.V]/Dest (0:3006) cvn /DEST pdfmark end
 -2 3173 a 396
3253 a Fe(/)441 3266 y(*)576 3253 y
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)441 3364 y(*)576 3351 y(flcliapi)43
b(-)i(Freelance)e(Pattern)h(agent)g(class)441 3461 y(*)576
3448 y(Implements)f(the)h(Freelance)f(Protocol)h(at)g
(http://rfc.zeromq.org/spec:10.)441 3558 y(*)576 3545
y(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 3558 y(*)3759 3545 y(/)396
3739 y(#include)g("flcliapi.h")396 3933 y(//)90 b(If)44
b(no)h(server)e(replies)h(within)g(this)g(time,)g(abandon)g(request)396
4031 y(#define)g(GLOBAL_TIMEOUT)87 b(3000)179 b(//)89
b(msecs)396 4128 y(//)h(PING)44 b(interval)f(for)i(servers)e(we)i
(think)f(are)g(alive)396 4225 y(#define)g(PING_INTERVAL)132
b(2000)179 b(//)89 b(msecs)396 4322 y(//)h(Server)43
b(considered)h(dead)g(if)g(silent)g(for)g(this)h(long)396
4419 y(#define)f(SERVER_TTL)267 b(6000)179 b(//)89 b(msecs)-2
4595 y
SDict begin H.S end
 -2 4595 a -2 4595 a
SDict begin 13 H.A end
 -2 4595 a -2 4595 a
SDict begin [/View [/XYZ H.V]/Dest (0:3007) cvn /DEST pdfmark end
 -2 4595
a 396 4693 a Fk(This)20 b(API)g(w)o(orks)f(in)h(tw)o(o)g(halv)o(es,)f
(a)h(common)e(pattern)h(for)g(APIs)h(that)g(need)f(to)h(run)e(in)i(the)
g(background.)c(One)j(half)h(is)396 4801 y(an)g(front-end)e(object)i
(our)f(application)g(creates)h(and)g(w)o(orks)g(with;)g(the)g(other)g
(half)f(is)j(a)e(back-end)e("agent")i(that)g(runs)396
4909 y(in)h(a)f(background)d(thread.)i(The)h(front-end)d(talks)k(to)f
(the)h(back-end)d(o)o(v)o(er)g(an)j(inproc)d(pipe)i(sock)o(et:)-2
4927 y
SDict begin H.S end
 -2 4927 a -2 4927 a
SDict begin 13 H.A end
 -2 4927 a -2 4927 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-1) cvn /DEST pdfmark
end
 -2 4927
a Black 3759 5569 a Ff(242)p Black eop end
%%Page: 243 256
TeXDict begin 243 255 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.243) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-87.)d(Fr)o(eelance)h(client)i(API)g
(\(\003cliapi.c\))e(-)i(API)f(structur)o(e)-2 172 y
SDict begin H.S end
 -2
172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3010) cvn /DEST pdfmark end
 -2 172 a 396 447 a Fe(//)90
b(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(---)396 544 y(//)g(Structure)43 b(of)h(our)h
(front-end)e(class)396 738 y(struct)h(_flcliapi_t)f({)576
835 y(zctx_t)889 848 y(*)934 835 y(ctx;)358 b(//)90 b(Our)44
b(context)g(wrapper)576 933 y(void)800 946 y(*)845 933
y(pipe;)402 b(//)90 b(Pipe)44 b(through)f(to)i(flcliapi)e(agent)396
1030 y(};)396 1224 y(//)90 b(This)44 b(is)g(the)h(thread)e(that)i
(handles)e(our)i(real)f(flcliapi)f(class)396 1321 y(static)h(void)g
(flcliapi_agent)f(\(void)1876 1334 y(*)1921 1321 y(args,)h(zctx_t)2503
1334 y(*)2548 1321 y(ctx,)g(void)2997 1334 y(*)3042 1321
y(pipe\);)396 1515 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
1613 y(//)g(Constructor)396 1807 y(flcliapi_t)889 1820
y(*)396 1904 y(flcliapi_new)43 b(\(void\))396 2001 y({)576
2098 y(flcliapi_t)755 2208 y(*)800 2195 y(self;)576 2390
y(self)h(=)g(\(flcliapi_t)1427 2403 y(*)1472 2390 y(\))h(zmalloc)f
(\(sizeof)f(\(flcliapi_t\)\);)576 2487 y(self->ctx)g(=)i(zctx_new)e
(\(\);)576 2584 y(self->pipe)g(=)h(zthread_fork)f(\(self->ctx,)g
(flcliapi_agent,)g(NULL\);)576 2681 y(return)g(self;)396
2778 y(})396 2972 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
3070 y(//)g(Destructor)396 3264 y(void)396 3361 y(flcliapi_destroy)42
b(\(flcliapi_t)1696 3374 y(**)1786 3361 y(self_p\))396
3458 y({)576 3555 y(assert)h(\(self_p\);)576 3652 y(if)h(\()755
3665 y(*)800 3652 y(self_p\))f({)755 3750 y(flcliapi_t)1248
3763 y(*)1293 3750 y(self)h(=)1607 3763 y(*)1652 3750
y(self_p;)755 3847 y(zctx_destroy)f(\(&self->ctx\);)755
3944 y(free)h(\(self\);)755 4054 y(*)800 4041 y(self_p)g(=)g(NULL;)576
4138 y(})396 4235 y(})-2 4409 y
SDict begin H.S end
 -2 4409 a -2 4409 a
SDict begin 13 H.A end
 -2
4409 a -2 4409 a
SDict begin [/View [/XYZ H.V]/Dest (0:3011) cvn /DEST pdfmark end
 -2 4409 a 396 4509 a Fk(T)-7 b(o)21
b(implement)e(the)h(connect)f(method,)f(the)i(front-end)e(object)i
(sends)g(a)h(multi-part)d(message)j(to)f(the)g(back-end)396
4617 y(agent.)g(The)f(\002rst)i(part)f(is)h(a)g(string)f("CONNECT",)g
(and)g(the)g(second)f(part)h(is)h(the)f(endpoint.)f(It)h(w)o(aits)h
(100msec)e(for)396 4725 y(the)h(connection)f(to)h(come)f(up,)h(which)g
(isn')o(t)g(pretty)-5 b(,)18 b(b)n(ut)j(sa)n(v)o(es)f(us)h(from)e
(sending)g(all)i(requests)f(to)g(a)g(single)h(serv)o(er)m(,)d(at)396
4833 y(start-up)i(time:)-2 4851 y
SDict begin H.S end
 -2 4851 a -2 4851 a
SDict begin 13 H.A end

-2 4851 a -2 4851 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-2) cvn /DEST pdfmark
end
 -2 4851 a Black 3759 5569 a Ff(243)p
Black eop end
%%Page: 244 257
TeXDict begin 244 256 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.244) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-88.)d(Fr)o(eelance)h(client)i(API)g
(\(\003cliapi.c\))e(-)i(connect)e(method)-2 172 y
SDict begin H.S end
 -2
172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3014) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(void)396
447 y(flcliapi_connect)42 b(\(flcliapi_t)1696 460 y(*)1741
447 y(self,)i(char)2234 460 y(*)2279 447 y(endpoint\))396
544 y({)576 641 y(assert)f(\(self\);)576 738 y(assert)g(\(endpoint\);)
576 835 y(zmsg_t)889 848 y(*)934 835 y(msg)i(=)f(zmsg_new)g(\(\);)576
933 y(zmsg_addstr)f(\(msg,)h("CONNECT"\);)576 1030 y(zmsg_addstr)f
(\(msg,)h(endpoint\);)576 1127 y(zmsg_send)f(\(&msg,)h(self->pipe\);)
576 1224 y(zclock_sleep)e(\(100\);)268 b(//)90 b(Allow)44
b(connection)f(to)h(come)h(up)396 1321 y(})-2 1495 y
SDict begin H.S end

-2 1495 a -2 1495 a
SDict begin 13 H.A end
 -2 1495 a -2 1495 a
SDict begin [/View [/XYZ H.V]/Dest (0:3015) cvn /DEST pdfmark end
 -2 1495 a 396
1595 a Fk(T)-7 b(o)21 b(implement)e(the)h(request)f(method,)g(the)h
(front-end)e(object)h(sends)i(a)f(message)g(to)h(the)f(back-end,)e
(specifying)g(a)396 1703 y(command)g("REQ)o(UEST")j(and)e(the)i
(request)e(message:)-2 1721 y
SDict begin H.S end
 -2 1721 a -2 1721 a
SDict begin 13 H.A end
 -2
1721 a -2 1721 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-3) cvn /DEST pdfmark
end
 -2 1721 a 396 1904 a Fg(Example)i(4-89.)d(Fr)o
(eelance)h(client)i(API)g(\(\003cliapi.c\))e(-)i(r)o(equest)f(method)-2
2004 y
SDict begin H.S end
 -2 2004 a -2 2004 a
SDict begin 11.7 H.A end
 -2 2004 a -2 2004 a
SDict begin [/View [/XYZ H.V]/Dest (0:3018) cvn /DEST pdfmark end
 -2 2004
a 396 2182 a Fe(zmsg_t)710 2195 y(*)396 2279 y(flcliapi_request)42
b(\(flcliapi_t)1696 2292 y(*)1741 2279 y(self,)i(zmsg_t)2324
2292 y(**)2414 2279 y(request_p\))396 2376 y({)576 2473
y(assert)f(\(self\);)576 2570 y(assert)g(\()934 2583
y(*)979 2570 y(request_p\);)576 2764 y(zmsg_pushstr)f(\()1203
2777 y(*)1248 2764 y(request_p,)h("REQUEST"\);)576 2862
y(zmsg_send)g(\(request_p,)g(self->pipe\);)576 2959 y(zmsg_t)889
2972 y(*)934 2959 y(reply)h(=)h(zmsg_recv)e(\(self->pipe\);)576
3056 y(if)h(\(reply\))g({)755 3153 y(char)979 3166 y(*)1024
3153 y(status)g(=)g(zmsg_popstr)f(\(reply\);)755 3250
y(if)h(\(streq)g(\(status,)g("FAILED"\)\))934 3347 y(zmsg_destroy)f
(\(&reply\);)755 3444 y(free)h(\(status\);)576 3542 y(})576
3639 y(return)f(reply;)396 3736 y(})-2 3910 y
SDict begin H.S end
 -2 3910
a -2 3910 a
SDict begin 13 H.A end
 -2 3910 a -2 3910 a
SDict begin [/View [/XYZ H.V]/Dest (0:3019) cvn /DEST pdfmark end
 -2 3910 a 396 4010 a
Fk(Here)20 b(we)g(see)g(the)g(back-end)e(agent.)g(It)j(runs)e(as)h(an)g
(attached)f(thread,)f(talking)h(to)h(its)h(parent)e(o)o(v)o(er)f(a)i
(pipe)f(sock)o(et.)h(It)g(is)396 4118 y(a)h(f)o(airly)f(comple)o(x)e
(piece)i(of)g(w)o(ork)f(so)i(we')o(ll)g(break)e(it)i(do)n(wn)e(into)h
(pieces.)g(First,)g(the)h(agent)e(manages)g(a)i(set)g(of)396
4226 y(serv)o(ers,)f(using)f(our)h(f)o(amiliar)f(class)j(approach:)-2
4244 y
SDict begin H.S end
 -2 4244 a -2 4244 a
SDict begin 13 H.A end
 -2 4244 a -2 4244 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-4) cvn /DEST pdfmark
end
 -2 4244
a 396 4427 a Fg(Example)f(4-90.)d(Fr)o(eelance)h(client)i(API)g
(\(\003cliapi.c\))e(-)i(back-end)f(agent)-2 4527 y
SDict begin H.S end
 -2
4527 a -2 4527 a
SDict begin 11.7 H.A end
 -2 4527 a -2 4527 a
SDict begin [/View [/XYZ H.V]/Dest (0:3022) cvn /DEST pdfmark end
 -2 4527 a 396 4801
a Fe(//)90 b(-------------------------------------)o(------)o(------)o
(------)o(------)o(-----)o(---)396 4899 y(//)g(Simple)43
b(class)h(for)h(one)f(server)g(we)g(talk)h(to)396 5093
y(typedef)f(struct)g({)p Black 3759 5569 a Ff(244)p Black
eop end
%%Page: 245 258
TeXDict begin 245 257 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.245) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 576 72 a Fe(char)800 85 y(*)845 72 y(endpoint;)581
b(//)89 b(Server)44 b(identity/endpoint)576 170 y(uint)g(alive;)761
b(//)89 b(1)45 b(if)f(known)g(to)h(be)f(alive)576 267
y(int64_t)f(ping_at;)537 b(//)89 b(Next)44 b(ping)h(at)f(this)g(time)
576 364 y(int64_t)f(expires;)537 b(//)89 b(Expires)44
b(at)g(this)h(time)396 461 y(})g(server_t;)396 655 y(server_t)800
668 y(*)396 752 y(server_new)e(\(char)1158 765 y(*)1203
752 y(endpoint\))396 850 y({)576 947 y(server_t)979 960
y(*)1024 947 y(self)h(=)h(\(server_t)1786 960 y(*)1831
947 y(\))g(zmalloc)e(\(sizeof)h(\(server_t\)\);)576 1044
y(self->endpoint)e(=)j(strdup)f(\(endpoint\);)576 1141
y(self->alive)f(=)h(0;)576 1238 y(self->ping_at)e(=)j(zclock_time)e
(\(\))h(+)h(PING_INTERVAL;)576 1335 y(self->expires)d(=)j(zclock_time)e
(\(\))h(+)h(SERVER_TTL;)576 1432 y(return)e(self;)396
1530 y(})396 1724 y(void)396 1821 y(server_destroy)g(\(server_t)1517
1834 y(**)1607 1821 y(self_p\))396 1918 y({)576 2015
y(assert)g(\(self_p\);)576 2112 y(if)h(\()755 2125 y(*)800
2112 y(self_p\))f({)755 2209 y(server_t)1158 2222 y(*)1203
2209 y(self)h(=)1517 2222 y(*)1562 2209 y(self_p;)755
2307 y(free)g(\(self->endpoint\);)755 2404 y(free)g(\(self\);)755
2514 y(*)800 2501 y(self_p)g(=)g(NULL;)576 2598 y(})396
2695 y(})396 2889 y(int)396 2987 y(server_ping)f(\(const)h(char)1472
3000 y(*)1517 2987 y(key,)g(void)1965 3000 y(*)2010 2987
y(server,)g(void)2593 3000 y(*)2638 2987 y(socket\))396
3084 y({)576 3181 y(server_t)979 3194 y(*)1024 3181 y(self)g(=)h
(\(server_t)1786 3194 y(*)1831 3181 y(\))g(server;)576
3278 y(if)f(\(zclock_time)f(\(\))h(>=)h(self->ping_at\))d({)755
3375 y(zmsg_t)1069 3388 y(*)1114 3375 y(ping)i(=)g(zmsg_new)g(\(\);)755
3472 y(zmsg_addstr)f(\(ping,)h(self->endpoint\);)755
3569 y(zmsg_addstr)f(\(ping,)h("PING"\);)755 3666 y(zmsg_send)f
(\(&ping,)h(socket\);)755 3764 y(self->ping_at)f(=)h(zclock_time)f
(\(\))i(+)f(PING_INTERVAL;)576 3861 y(})576 3958 y(return)f(0;)396
4055 y(})396 4249 y(int)396 4346 y(server_tickless)g(\(const)g(char)
1652 4359 y(*)1697 4346 y(key,)h(void)2145 4359 y(*)2190
4346 y(server,)f(void)2772 4359 y(*)2817 4346 y(arg\))396
4444 y({)576 4541 y(server_t)979 4554 y(*)1024 4541 y(self)h(=)h
(\(server_t)1786 4554 y(*)1831 4541 y(\))g(server;)576
4638 y(uint64_t)979 4651 y(*)1024 4638 y(tickless)e(=)i(\(uint64_t)1965
4651 y(*)2010 4638 y(\))g(arg;)576 4735 y(if)f(\()755
4748 y(*)800 4735 y(tickless)f(>)i(self->ping_at\))755
4845 y(*)800 4832 y(tickless)e(=)i(self->ping_at;)576
4929 y(return)e(0;)396 5026 y(})p Black 3759 5569 a Ff(245)p
Black eop end
%%Page: 246 259
TeXDict begin 246 258 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.246) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3023) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(W)-7 b(e)22 b(b)n(uild)d(the)i(agent)e(as)i(a)g
(class)g(that')-5 b(s)21 b(capable)e(of)h(processing)f(messages)h
(coming)f(in)h(from)f(its)i(v)n(arious)f(sock)o(ets:)-2
90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-5) cvn /DEST pdfmark
end
 -2 90 a 396 274
a Fg(Example)h(4-91.)d(Fr)o(eelance)h(client)i(API)g(\(\003cliapi.c\))e
(-)i(back-end)f(agent)f(class)-2 374 y
SDict begin H.S end
 -2 374 a -2 374
a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:3026) cvn /DEST pdfmark end
 -2 374 a 396 648 a Fe(//)90 b
(-------------------------------------)o(------)o(------)o(------)o
(------)o(-----)o(---)396 745 y(//)g(Simple)43 b(class)h(for)h(one)f
(background)f(agent)396 940 y(typedef)h(struct)g({)576
1037 y(zctx_t)889 1050 y(*)934 1037 y(ctx;)717 b(//)89
b(Own)45 b(context)576 1134 y(void)800 1147 y(*)845 1134
y(pipe;)761 b(//)89 b(Socket)44 b(to)h(talk)f(back)g(to)g(application)
576 1231 y(void)800 1244 y(*)845 1231 y(router;)671 b(//)89
b(Socket)44 b(to)h(talk)f(to)g(servers)576 1328 y(zhash_t)934
1341 y(*)979 1328 y(servers;)492 b(//)89 b(Servers)44
b(we've)g(connected)f(to)576 1425 y(zlist_t)934 1438
y(*)979 1425 y(actives;)492 b(//)89 b(Servers)44 b(we)g(know)h(are)f
(alive)576 1522 y(uint)g(sequence;)626 b(//)89 b(Number)44
b(of)h(requests)e(ever)h(sent)576 1620 y(zmsg_t)889 1633
y(*)934 1620 y(request;)537 b(//)89 b(Current)44 b(request)g(if)g(any)
576 1717 y(zmsg_t)889 1730 y(*)934 1717 y(reply;)627
b(//)89 b(Current)44 b(reply)g(if)g(any)576 1814 y(int64_t)f(expires;)
537 b(//)89 b(Timeout)44 b(for)g(request/reply)396 1911
y(})h(agent_t;)396 2105 y(agent_t)755 2118 y(*)396 2202
y(agent_new)f(\(zctx_t)1203 2215 y(*)1248 2202 y(ctx,)g(void)1696
2215 y(*)1741 2202 y(pipe\))396 2300 y({)576 2397 y(agent_t)934
2410 y(*)979 2397 y(self)g(=)h(\(agent_t)1696 2410 y(*)1741
2397 y(\))g(zmalloc)f(\(sizeof)f(\(agent_t\)\);)576 2494
y(self->ctx)g(=)i(ctx;)576 2591 y(self->pipe)e(=)h(pipe;)576
2688 y(self->router)e(=)j(zsocket_new)e(\(self->ctx,)g(ZMQ_ROUTER\);)
576 2785 y(self->servers)f(=)j(zhash_new)e(\(\);)576
2882 y(self->actives)f(=)j(zlist_new)e(\(\);)576 2979
y(return)g(self;)396 3077 y(})396 3271 y(void)396 3368
y(agent_destroy)g(\(agent_t)1427 3381 y(**)1517 3368
y(self_p\))396 3465 y({)576 3562 y(assert)g(\(self_p\);)576
3659 y(if)h(\()755 3672 y(*)800 3659 y(self_p\))f({)755
3757 y(agent_t)1114 3770 y(*)1159 3757 y(self)h(=)1472
3770 y(*)1517 3757 y(self_p;)755 3854 y(zhash_destroy)f
(\(&self->servers\);)755 3951 y(zlist_destroy)g(\(&self->actives\);)755
4048 y(zmsg_destroy)g(\(&self->request\);)755 4145 y(zmsg_destroy)g
(\(&self->reply\);)755 4242 y(free)h(\(self\);)755 4352
y(*)800 4339 y(self_p)g(=)g(NULL;)576 4437 y(})396 4534
y(})-2 4708 y
SDict begin H.S end
 -2 4708 a -2 4708 a
SDict begin 13 H.A end
 -2 4708 a -2 4708 a
SDict begin [/View [/XYZ H.V]/Dest (0:3027) cvn /DEST pdfmark end

-2 4708 a 396 4808 a Fk(The)20 b(control_message)e(method)h(processes)h
(one)f(message)h(from)f(our)h(front-end)d(class)22 b(\(it')-5
b(s)21 b(going)d(to)j(be)396 4916 y(CONNECT)g(or)f(REQ)o(UEST\):)-2
4931 y
SDict begin H.S end
 -2 4931 a -2 4931 a
SDict begin 13 H.A end
 -2 4931 a -2 4931 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-6) cvn /DEST pdfmark
end
 -2 4931
a Black 3757 5569 a Ff(246)p Black eop end
%%Page: 247 260
TeXDict begin 247 259 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.247) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-92.)d(Fr)o(eelance)h(client)i(API)g
(\(\003cliapi.c\))e(-)i(contr)o(ol)d(messages)-2 172
y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3030) cvn /DEST pdfmark end
 -2 172 a 396 350
a Fe(//)90 b(Callback)43 b(when)h(we)h(remove)f(server)f(from)i(agent)f
('servers')f(hash)h(table)396 544 y(static)g(void)396
641 y(s_server_free)f(\(void)1293 654 y(*)1338 641 y(argument\))396
738 y({)576 835 y(server_t)979 848 y(*)1024 835 y(server)h(=)g
(\(server_t)1876 848 y(*)1921 835 y(\))g(argument;)576
933 y(server_destroy)e(\(&server\);)396 1030 y(})396
1224 y(void)396 1321 y(agent_control_message)g(\(agent_t)1786
1334 y(*)1831 1321 y(self\))396 1418 y({)576 1515 y(zmsg_t)889
1528 y(*)934 1515 y(msg)j(=)f(zmsg_recv)g(\(self->pipe\);)576
1613 y(char)800 1626 y(*)845 1613 y(command)f(=)i(zmsg_popstr)e
(\(msg\);)576 1807 y(if)h(\(streq)g(\(command,)f("CONNECT"\)\))g({)755
1904 y(char)979 1917 y(*)1024 1904 y(endpoint)g(=)i(zmsg_popstr)e
(\(msg\);)755 2001 y(printf)h(\("I:)g(connecting)f(to)i(\045s...\\n",)e
(endpoint\);)755 2098 y(int)h(rc)h(=)f(zmq_connect)f(\(self->router,)g
(endpoint\);)755 2195 y(assert)h(\(rc)g(==)h(0\);)755
2292 y(server_t)1158 2305 y(*)1203 2292 y(server)f(=)h(server_new)e
(\(endpoint\);)755 2390 y(zhash_insert)g(\(self->servers,)f(endpoint,)h
(server\);)755 2487 y(zhash_freefn)g(\(self->servers,)f(endpoint,)h
(s_server_free\);)755 2584 y(zlist_append)g(\(self->actives,)f
(server\);)755 2681 y(server->ping_at)g(=)j(zclock_time)e(\(\))h(+)h
(PING_INTERVAL;)755 2778 y(server->expires)d(=)j(zclock_time)e(\(\))h
(+)h(SERVER_TTL;)755 2875 y(free)f(\(endpoint\);)576
2972 y(})576 3070 y(else)576 3167 y(if)g(\(streq)g(\(command,)f
("REQUEST"\)\))g({)755 3264 y(assert)h(\(!self->request\);)176
b(//)90 b(Strict)43 b(request-reply)g(cycle)755 3361
y(//)89 b(Prefix)44 b(request)g(with)g(sequence)f(number)h(and)h(empty)
f(envelope)755 3458 y(char)g(sequence_text)f([10];)755
3555 y(sprintf)h(\(sequence_text,)e("\045u",)i(++self->sequence\);)755
3652 y(zmsg_pushstr)f(\(msg,)h(sequence_text\);)755 3750
y(//)89 b(Take)44 b(ownership)g(of)g(request)g(message)755
3847 y(self->request)f(=)h(msg;)755 3944 y(msg)g(=)h(NULL;)755
4041 y(//)89 b(Request)44 b(expires)g(after)g(global)f(timeout)755
4138 y(self->expires)g(=)h(zclock_time)f(\(\))i(+)f(GLOBAL_TIMEOUT;)576
4235 y(})576 4332 y(free)g(\(command\);)576 4429 y(zmsg_destroy)e
(\(&msg\);)396 4527 y(})-2 4701 y
SDict begin H.S end
 -2 4701 a -2 4701 a
SDict begin 13 H.A end

-2 4701 a -2 4701 a
SDict begin [/View [/XYZ H.V]/Dest (0:3031) cvn /DEST pdfmark end
 -2 4701 a 396 4801 a Fk(The)20 b(router_message)e
(method)h(processes)h(one)f(message)h(from)f(a)i(connected)d(serv)o
(er:)-2 4819 y
SDict begin H.S end
 -2 4819 a -2 4819 a
SDict begin 13 H.A end
 -2 4819 a -2 4819
a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-7) cvn /DEST pdfmark
end
 -2 4819 a Black 3756 5569 a Ff(247)p Black eop end
%%Page: 248 261
TeXDict begin 248 260 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.248) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 396 72 a Fg(Example)h(4-93.)d(Fr)o(eelance)h(client)i(API)g
(\(\003cliapi.c\))e(-)i(r)o(outer)e(messages)-2 172 y
SDict begin H.S end

-2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3034) cvn /DEST pdfmark end
 -2 172 a 396 350
a Fe(void)396 447 y(agent_router_message)42 b(\(agent_t)1741
460 y(*)1786 447 y(self\))396 544 y({)576 641 y(zmsg_t)889
654 y(*)934 641 y(reply)i(=)h(zmsg_recv)e(\(self->router\);)576
835 y(//)89 b(Frame)44 b(0)h(is)f(server)g(that)g(replied)576
933 y(char)800 946 y(*)845 933 y(endpoint)f(=)i(zmsg_popstr)e
(\(reply\);)576 1030 y(server_t)979 1043 y(*)1024 1030
y(server)h(=)755 1127 y(\(server_t)1203 1140 y(*)1248
1127 y(\))h(zhash_lookup)e(\(self->servers,)f(endpoint\);)576
1224 y(assert)h(\(server\);)576 1321 y(free)h(\(endpoint\);)576
1418 y(if)g(\(!server->alive\))e({)755 1515 y(zlist_append)h
(\(self->actives,)f(server\);)755 1613 y(server->alive)h(=)h(1;)576
1710 y(})576 1807 y(server->ping_at)e(=)j(zclock_time)e(\(\))h(+)h
(PING_INTERVAL;)576 1904 y(server->expires)d(=)j(zclock_time)e(\(\))h
(+)h(SERVER_TTL;)576 2098 y(//)89 b(Frame)44 b(1)h(may)f(be)g(sequence)
g(number)g(for)g(reply)576 2195 y(char)800 2208 y(*)845
2195 y(sequence)f(=)i(zmsg_popstr)e(\(reply\);)576 2292
y(if)h(\(atoi)g(\(sequence\))f(==)i(self->sequence\))d({)755
2390 y(zmsg_pushstr)h(\(reply,)g("OK"\);)755 2487 y(zmsg_send)g
(\(&reply,)h(self->pipe\);)755 2584 y(zmsg_destroy)f
(\(&self->request\);)576 2681 y(})576 2778 y(else)755
2875 y(zmsg_destroy)g(\(&reply\);)396 2972 y(})-2 3147
y
SDict begin H.S end
 -2 3147 a -2 3147 a
SDict begin 13 H.A end
 -2 3147 a -2 3147 a
SDict begin [/View [/XYZ H.V]/Dest (0:3035) cvn /DEST pdfmark end
 -2 3147 a 396
3246 a Fk(Finally)20 b(here')-5 b(s)20 b(the)h(agent)e(task)i(itself,)f
(which)g(polls)g(its)h(tw)o(o)g(sock)o(ets)f(and)g(processes)g
(incoming)e(messages:)-2 3264 y
SDict begin H.S end
 -2 3264 a -2 3264 a
SDict begin 13 H.A end
 -2
3264 a -2 3264 a
SDict begin [/View [/XYZ H.V]/Dest (0:flcliapi-c-8) cvn /DEST pdfmark
end
 -2 3264 a 396 3448 a Fg(Example)j(4-94.)d(Fr)o
(eelance)h(client)i(API)g(\(\003cliapi.c\))e(-)i(back-end)f(agent)f
(implementation)-2 3548 y
SDict begin H.S end
 -2 3548 a -2 3548 a
SDict begin 11.7 H.A end
 -2 3548
a -2 3548 a
SDict begin [/View [/XYZ H.V]/Dest (0:3038) cvn /DEST pdfmark end
 -2 3548 a 396 3822 a Fe(static)44 b(void)396
3919 y(flcliapi_agent)f(\(void)1338 3932 y(*)1383 3919
y(args,)h(zctx_t)1965 3932 y(*)2010 3919 y(ctx,)g(void)2459
3932 y(*)2504 3919 y(pipe\))396 4016 y({)576 4114 y(agent_t)934
4127 y(*)979 4114 y(self)g(=)h(agent_new)e(\(ctx,)h(pipe\);)576
4308 y(zmq_pollitem_t)e(items)i([])h(=)f({)755 4405 y({)h(self->pipe,)e
(0,)h(ZMQ_POLLIN,)f(0)i(},)755 4502 y({)g(self->router,)d(0,)j
(ZMQ_POLLIN,)e(0)h(})576 4599 y(};)576 4696 y(while)g
(\(!zctx_interrupted\))d({)755 4794 y(//)89 b(Calculate)44
b(tickless)f(timer,)h(up)g(to)h(1)g(hour)755 4891 y(uint64_t)e
(tickless)h(=)h(zclock_time)e(\(\))h(+)h(1000)2638 4904
y(*)2728 4891 y(3600;)755 4988 y(if)f(\(self->request)755
5085 y(&&)89 b(tickless)44 b(>)g(self->expires\))p Black
3759 5569 a Ff(248)p Black eop end
%%Page: 249 262
TeXDict begin 249 261 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.249) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black 934 72 a Fe(tickless)44 b(=)g(self->expires;)755
170 y(zhash_foreach)f(\(self->servers,)f(server_tickless,)g
(&tickless\);)755 364 y(int)i(rc)h(=)f(zmq_poll)g(\(items,)g(2,)934
461 y(\(tickless)g(-)g(zclock_time)f(\(\)\))2190 474
y(*)2279 461 y(ZMQ_POLL_MSEC\);)755 558 y(if)h(\(rc)h(==)f(-1\))934
655 y(break;)627 b(//)89 b(Context)44 b(has)g(been)g(shut)h(down)755
850 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))934
947 y(agent_control_message)d(\(self\);)755 1141 y(if)i(\(items)g
([1].revents)f(&)i(ZMQ_POLLIN\))934 1238 y(agent_router_message)d
(\(self\);)755 1432 y(//)89 b(If)45 b(we're)f(processing)f(a)i
(request,)e(dispatch)h(to)g(next)g(server)755 1530 y(if)g
(\(self->request\))f({)934 1627 y(if)i(\(zclock_time)e(\(\))h(>=)h
(self->expires\))d({)1114 1724 y(//)89 b(Request)44 b(expired,)f(kill)h
(it)1114 1821 y(zstr_send)f(\(self->pipe,)g("FAILED"\);)1114
1918 y(zmsg_destroy)f(\(&self->request\);)934 2015 y(})934
2112 y(else)i({)1114 2209 y(//)89 b(Find)44 b(server)g(to)g(talk)h(to,)
f(remove)g(any)g(expired)g(ones)1114 2307 y(while)g(\(zlist_size)f
(\(self->actives\)\))f({)1293 2404 y(server_t)1696 2417
y(*)1741 2404 y(server)i(=)1472 2501 y(\(server_t)1921
2514 y(*)1966 2501 y(\))g(zlist_first)f(\(self->actives\);)1293
2598 y(if)h(\(zclock_time)f(\(\))i(>=)f(server->expires\))e({)1472
2695 y(zlist_pop)i(\(self->actives\);)1472 2792 y(server->alive)f(=)i
(0;)1293 2889 y(})1293 2987 y(else)f({)1472 3084 y(zmsg_t)1786
3097 y(*)1831 3084 y(request)g(=)g(zmsg_dup)g(\(self->request\);)1472
3181 y(zmsg_pushstr)f(\(request,)g(server->endpoint\);)1472
3278 y(zmsg_send)h(\(&request,)f(self->router\);)1472
3375 y(break;)1293 3472 y(})1114 3569 y(})934 3666 y(})755
3764 y(})755 3861 y(//)89 b(Disconnect)43 b(and)i(delete)f(any)g
(expired)g(servers)755 3958 y(//)89 b(Send)44 b(heartbeats)g(to)g(idle)
g(servers)g(if)g(needed)755 4055 y(zhash_foreach)f(\(self->servers,)f
(server_ping,)h(self->router\);)576 4152 y(})576 4249
y(agent_destroy)f(\(&self\);)396 4346 y(})-2 4521 y
SDict begin H.S end
 -2
4521 a -2 4521 a
SDict begin 13 H.A end
 -2 4521 a -2 4521 a
SDict begin [/View [/XYZ H.V]/Dest (0:3039) cvn /DEST pdfmark end
 -2 4521 a 396 4620
a Fk(This)21 b(API)f(implementation)e(is)j(f)o(airly)f(sophisticated)f
(and)h(uses)h(a)f(couple)f(of)h(techniques)f(that)h(we')l(v)o(e)g(not)f
(seen)396 4728 y(before:)-2 4895 y
SDict begin H.S end
 -2 4895 a -2 4895
a
SDict begin 13 H.A end
 -2 4895 a -2 4895 a
SDict begin [/View [/XYZ H.V]/Dest (0:3040) cvn /DEST pdfmark end
 -2 4895 a -2 4895 a
SDict begin H.S end
 -2 4895 a -2
4895 a
SDict begin 13 H.A end
 -2 4895 a -2 4895 a
SDict begin [/View [/XYZ H.V]/Dest (0:3041) cvn /DEST pdfmark end
 -2 4895 a 396 5002 a Fg(Multithr)o(eaded)h
(API)p Black 3759 5569 a Ff(249)p Black eop end
%%Page: 250 263
TeXDict begin 250 262 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.250) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2730 -132 a Ff(Chapter)20 b(4.)g(Reliable)g(Request-Reply)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3042) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)g(client)g(API)g(consists)g(of)g(tw)o(o)g(parts,)
f(a)i(synchronous)c('\003cliapi')i(class)i(that)f(runs)f(in)h(the)g
(application)f(thread,)f(and)396 180 y(an)i(asynchronous)e('agent')h
(class)i(that)f(runs)g(as)h(a)f(background)d(thread.)i(Remember)g(ho)n
(w)h(\330MQ)g(mak)o(es)g(it)h(easy)f(to)396 288 y(create)g
(multithreaded)e(apps.)i(The)g(\003cliapi)g(and)g(agent)f(classes)j
(talk)e(to)g(each)g(other)f(with)i(messages)f(o)o(v)o(er)f(an)396
396 y
SDict begin H.S end
 396 396 a 396 396 a
SDict begin 13 H.A end
 396 396 a 396 396 a
SDict begin [/View [/XYZ H.V]/Dest (0:3043) cvn /DEST pdfmark end
 396 396
a Fe(inproc)h Fk(sock)o(et.)g(All)h(\330MQ)f(aspects)h(\(such)e(as)i
(creating)e(and)h(destro)o(ying)e(a)j(conte)o(xt\))e(are)h(hidden)e(in)
j(the)f(API.)g(The)396 504 y(agent)g(in)g(ef)n(fect)g(acts)h(lik)o(e)f
(a)h(mini-brok)o(er)m(,)c(talking)i(to)h(serv)o(ers)g(in)g(the)h
(background,)16 b(so)21 b(that)f(when)f(we)i(mak)o(e)f(a)396
612 y(request,)g(it)g(can)g(mak)o(e)g(a)h(best)f(ef)n(fort)f(to)i
(reach)e(a)i(serv)o(er)e(it)i(belie)n(v)o(es)f(is)h(a)n(v)n(ailable.)-2
796 y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:3044) cvn /DEST pdfmark end
 -2 796 a -2
796 a
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:3045) cvn /DEST pdfmark end
 -2 796 a 396
886 a Fg(T)o(ickless)h(poll)e(timer)-2 1069 y
SDict begin H.S end
 -2 1069
a -2 1069 a
SDict begin 13 H.A end
 -2 1069 a -2 1069 a
SDict begin [/View [/XYZ H.V]/Dest (0:3046) cvn /DEST pdfmark end
 -2 1069 a 396 1160 a
Fk(In)g(pre)n(vious)f(poll)h(loops)f(we)i(al)o(w)o(ays)g(used)f(a)g
(\002x)o(ed)g(tick)g(interv)n(al,)f(e.g.)h(1)g(second,)f(which)h(is)h
(simple)f(enough)e(b)n(ut)i(not)396 1268 y(e)o(xcellent)f(on)h(po)n
(wer)n(-sensiti)n(v)o(e)f(clients,)h(such)g(as)h(notebooks)d(or)i
(mobile)f(phones,)g(where)g(w)o(aking)h(the)g(CPU)h(costs)396
1376 y(po)n(wer)-5 b(.)20 b(F)o(or)f(fun,)h(and)f(to)i(help)e(sa)n(v)o
(e)i(the)f(planet,)f(the)i(agent)e(uses)i(a)f(')o(tickless)g(timer',)g
(which)f(calculates)i(the)f(poll)396 1484 y(delay)g(based)g(on)f(the)i
(ne)o(xt)e(timeout)h(we')l(re)f(e)o(xpecting.)f(A)j(proper)d
(implementation)g(w)o(ould)i(k)o(eep)f(an)i(ordered)d(list)j(of)396
1592 y(timeouts.)f(W)-7 b(e)21 b(just)g(check)e(all)i(timeouts)f(and)f
(calculate)h(the)g(poll)g(delay)g(until)g(the)g(ne)o(xt)g(one.)-2
1703 y
SDict begin H.S end
 -2 1703 a -2 1703 a
SDict begin 13 H.A end
 -2 1703 a -2 1703 a
SDict begin [/View [/XYZ H.V]/Dest (0:3047) cvn /DEST pdfmark end
 -2 1703
a 359 x Fn(4.15.)39 b(Conc)m(lusion)1138 2062 y
SDict begin H.S end
 1138
2062 a 1138 2062 a
SDict begin 22.464 H.A end
 1138 2062 a 1138 2062 a
SDict begin [/View [/XYZ H.V]/Dest (9.69.1) cvn /DEST pdfmark end
 1138 2062
a -2 2230 a
SDict begin H.S end
 -2 2230 a -2 2230 a
SDict begin 13 H.A end
 -2 2230 a -2 2230 a
SDict begin [/View [/XYZ H.V]/Dest (0:3049) cvn /DEST pdfmark end
 -2
2230 a 396 2336 a Fk(In)20 b(this)h(chapter)e(we')l(v)o(e)g(seen)h(a)h
(v)n(ariety)e(of)h(reliable)g(request-reply)e(mechanisms,)h(each)h
(with)g(certain)g(costs)g(and)396 2444 y(bene\002ts.)g(The)g(e)o
(xample)f(code)g(is)i(lar)o(gely)e(ready)g(for)h(real)g(use,)g(though)f
(it)i(is)g(not)f(optimized.)e(Of)i(all)h(the)f(dif)n(ferent)396
2552 y(patterns,)g(the)g(tw)o(o)g(that)h(stand)f(out)f(are)i(the)f
(Majordomo)e(pattern,)h(for)g(brok)o(er)n(-based)f(reliability)-5
b(,)19 b(and)g(the)i(Freelance)396 2660 y(pattern)f(for)f(brok)o
(erless)g(reliability)-5 b(.)p Black 3759 5569 a Ff(250)p
Black eop end
%%Page: 251 264
TeXDict begin 251 263 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.251) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:3050) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(5.)f(Ad)m(v)m(anced)h(Pub)n
(lish-Subscribe)3262 115 y
SDict begin H.S end
 3262 115 a 3262 115 a
SDict begin 26.957 H.A end
 3262
115 a 3262 115 a
SDict begin [/View [/XYZ H.V]/Dest (10.0) cvn /DEST pdfmark end
 3262 115 a -2 371 a
SDict begin H.S end
 -2 371 a -2 371
a
SDict begin 13 H.A end
 -2 371 a -2 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:3052) cvn /DEST pdfmark end
 -2 371 a 396 443 a Fk(In)20 b(Chapters)g(Three)f
(and)h(F)o(our)f(we)i(look)o(ed)e(at)i(adv)n(anced)d(use)i(of)g
(\330MQ')-5 b(s)21 b(request-reply)d(pattern.)h(If)h(you)f(managed)396
551 y(to)i(digest)f(all)g(that,)h(congratulations.)c(In)j(this)h
(chapter)e(we')o(ll)h(focus)g(on)g(publish-subscribe,)d(and)i(e)o
(xtend)g(\330MQ')-5 b(s)396 659 y(core)20 b(pub-sub)e(pattern)h(with)i
(higher)n(-le)n(v)o(el)d(patterns)h(for)h(performance,)d(reliability)-5
b(,)19 b(state)i(distrib)n(ution,)e(and)396 767 y(monitoring.)-2
951 y
SDict begin H.S end
 -2 951 a -2 951 a
SDict begin 13 H.A end
 -2 951 a -2 951 a
SDict begin [/View [/XYZ H.V]/Dest (0:3053) cvn /DEST pdfmark end
 -2 951 a 396
1041 a Fk(W)-7 b(e')o(ll)22 b(co)o(v)o(er:)-2 1042 y
SDict begin H.S end

-2 1042 a -2 1042 a
SDict begin 13 H.A end
 -2 1042 a -2 1042 a
SDict begin [/View [/XYZ H.V]/Dest (0:3054) cvn /DEST pdfmark end
 -2 1042 a -2
1052 a
SDict begin H.S end
 -2 1052 a -2 1052 a
SDict begin 13 H.A end
 -2 1052 a -2 1052 a
SDict begin [/View [/XYZ H.V]/Dest (0:3055) cvn /DEST pdfmark end
 -2 1052
a Black 396 1211 a Fj(\225)p Black 479 1211 a
SDict begin H.S end
 479 1211
a 479 1211 a
SDict begin 13 H.A end
 479 1211 a 479 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:3056) cvn /DEST pdfmark end
 479 1211 a Fk(Ho)n(w)e(to)h(handle)e
(too-slo)n(w)g(subscribers)g(\(the)1840 1211 y
SDict begin H.S end
 1840 1211
a 1840 1211 a
SDict begin 13 H.A end
 1840 1211 a 1840 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:3057) cvn /DEST pdfmark end
 1840 1211 a Ff(Suicidal)g(Snail)h
Fk(pattern\).)-2 1229 y
SDict begin H.S end
 -2 1229 a -2 1229 a
SDict begin 13 H.A end
 -2 1229 a
-2 1229 a
SDict begin [/View [/XYZ H.V]/Dest (0:3058) cvn /DEST pdfmark end
 -2 1229 a Black 396 1360 a Fj(\225)p Black
479 1360 a
SDict begin H.S end
 479 1360 a 479 1360 a
SDict begin 13 H.A end
 479 1360 a 479 1360
a
SDict begin [/View [/XYZ H.V]/Dest (0:3059) cvn /DEST pdfmark end
 479 1360 a Fk(Ho)n(w)g(to)h(design)e(high-speed)f(subscribers)i
(\(the)1911 1360 y
SDict begin H.S end
 1911 1360 a 1911 1360 a
SDict begin 13 H.A end
 1911 1360
a 1911 1360 a
SDict begin [/View [/XYZ H.V]/Dest (0:3060) cvn /DEST pdfmark end
 1911 1360 a Ff(Blac)n(k)h(Box)f Fk(pattern\).)-2
1378 y
SDict begin H.S end
 -2 1378 a -2 1378 a
SDict begin 13 H.A end
 -2 1378 a -2 1378 a
SDict begin [/View [/XYZ H.V]/Dest (0:3061) cvn /DEST pdfmark end
 -2 1378
a Black 396 1510 a Fj(\225)p Black 479 1510 a
SDict begin H.S end
 479 1510
a 479 1510 a
SDict begin 13 H.A end
 479 1510 a 479 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:3062) cvn /DEST pdfmark end
 479 1510 a Fk(Ho)n(w)g(to)h(b)n
(uild)e(a)i(shared)f(k)o(e)o(y-v)n(alue)e(cache)h(\(the)1933
1510 y
SDict begin H.S end
 1933 1510 a 1933 1510 a
SDict begin 13 H.A end
 1933 1510 a 1933 1510
a
SDict begin [/View [/XYZ H.V]/Dest (0:3063) cvn /DEST pdfmark end
 1933 1510 a Ff(Clone)h Fk(pattern\).)-2 1528 y
SDict begin H.S end
 -2 1528
a -2 1528 a
SDict begin 13 H.A end
 -2 1528 a -2 1528 a
SDict begin [/View [/XYZ H.V]/Dest (0:3064) cvn /DEST pdfmark end
 -2 1528 a Black 396 1659
a Fj(\225)p Black 479 1659 a
SDict begin H.S end
 479 1659 a 479 1659 a
SDict begin 13 H.A end
 479
1659 a 479 1659 a
SDict begin [/View [/XYZ H.V]/Dest (0:3065) cvn /DEST pdfmark end
 479 1659 a Fk(Ho)n(w)g(to)h(use)f(reactors)g(to)g
(simplify)g(comple)o(x)e(serv)o(ers.)-2 1677 y
SDict begin H.S end
 -2 1677
a -2 1677 a
SDict begin 13 H.A end
 -2 1677 a -2 1677 a
SDict begin [/View [/XYZ H.V]/Dest (0:3066) cvn /DEST pdfmark end
 -2 1677 a Black 396 1809
a Fj(\225)p Black 479 1809 a
SDict begin H.S end
 479 1809 a 479 1809 a
SDict begin 13 H.A end
 479
1809 a 479 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:3067) cvn /DEST pdfmark end
 479 1809 a Fk(Ho)n(w)i(to)h(use)f(the)g(Binary)g
(Star)h(pattern)e(to)h(add)g(f)o(ailo)o(v)o(er)e(to)j(a)f(serv)o(er)-5
b(.)-2 1826 y
SDict begin H.S end
 -2 1826 a -2 1826 a
SDict begin 13 H.A end
 -2 1826 a -2 1826 a
SDict begin [/View [/XYZ H.V]/Dest (0:3068) cvn /DEST pdfmark end

-2 1826 a Black 396 1958 a Fj(\225)p Black 479 1958 a
SDict begin H.S end

479 1958 a 479 1958 a
SDict begin 13 H.A end
 479 1958 a 479 1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:3069) cvn /DEST pdfmark end
 479 1958
a Fk(Ho)n(w)20 b(to)h(monitor)d(a)j(publish-subscribe)c(netw)o(ork)i
(\(the)2134 1958 y
SDict begin H.S end
 2134 1958 a 2134 1958 a
SDict begin 13 H.A end
 2134 1958
a 2134 1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:3070) cvn /DEST pdfmark end
 2134 1958 a Ff(Espr)m(esso)i Fk(pattern\).)-2
1976 y
SDict begin H.S end
 -2 1976 a -2 1976 a
SDict begin 13 H.A end
 -2 1976 a -2 1976 a
SDict begin [/View [/XYZ H.V]/Dest (0:3071) cvn /DEST pdfmark end
 -2 1976
a 359 x Fn(5.1.)39 b(Slo)n(w)f(Subscriber)g(Detection)f(\(Suicidal)h
(Snail)h(P)l(attern\))3693 2335 y
SDict begin H.S end
 3693 2335 a 3693 2335
a
SDict begin 22.464 H.A end
 3693 2335 a 3693 2335 a
SDict begin [/View [/XYZ H.V]/Dest (10.70.1) cvn /DEST pdfmark end
 3693 2335 a -2 2531 a
SDict begin H.S end
 -2 2531
a -2 2531 a
SDict begin 13 H.A end
 -2 2531 a -2 2531 a
SDict begin [/View [/XYZ H.V]/Dest (0:3073) cvn /DEST pdfmark end
 -2 2531 a 396 2609 a
Fk(A)21 b(common)d(problem)h(you)g(will)i(hit)f(when)g(using)g(the)g
(pub-sub)e(pattern)h(in)i(real)f(life)g(is)i(the)e(slo)n(w)g
(subscriber)-5 b(.)19 b(In)h(an)396 2717 y(ideal)g(w)o(orld,)g(we)g
(stream)g(data)g(at)h(full)f(speed)g(from)f(publishers)g(to)i
(subscribers.)e(In)h(reality)-5 b(,)19 b(subscriber)396
2825 y(applications)g(are)h(often)g(written)g(in)g(interpreted)e
(languages,)h(or)h(just)h(do)e(a)i(lot)f(of)g(w)o(ork,)g(or)g(are)g
(just)g(badly)g(written,)396 2933 y(to)h(the)f(e)o(xtent)f(that)i(the)o
(y)e(can')o(t)g(k)o(eep)h(up)g(with)g(publishers.)-2
3117 y
SDict begin H.S end
 -2 3117 a -2 3117 a
SDict begin 13 H.A end
 -2 3117 a -2 3117 a
SDict begin [/View [/XYZ H.V]/Dest (0:3074) cvn /DEST pdfmark end
 -2 3117
a 396 3207 a Fk(Ho)n(w)g(do)g(we)h(handle)e(a)h(slo)n(w)h(subscriber?)e
(The)h(ideal)g(\002x)g(is)h(to)g(mak)o(e)e(the)i(subscriber)e(f)o
(aster)m(,)g(b)n(ut)h(that)h(might)e(tak)o(e)396 3315
y(w)o(ork)h(and)f(time.)i(Some)e(of)h(the)h(classic)g(strate)o(gies)f
(for)f(handling)g(a)h(slo)n(w)h(subscriber)e(are:)-2
3333 y
SDict begin H.S end
 -2 3333 a -2 3333 a
SDict begin 13 H.A end
 -2 3333 a -2 3333 a
SDict begin [/View [/XYZ H.V]/Dest (0:3075) cvn /DEST pdfmark end
 -2 3333
a -2 3343 a
SDict begin H.S end
 -2 3343 a -2 3343 a
SDict begin 13 H.A end
 -2 3343 a -2 3343 a
SDict begin [/View [/XYZ H.V]/Dest (0:3076) cvn /DEST pdfmark end
 -2
3343 a Black 396 3485 a Fj(\225)p Black 479 3485 a
SDict begin H.S end
 479
3485 a 479 3485 a
SDict begin 13 H.A end
 479 3485 a 479 3485 a
SDict begin [/View [/XYZ H.V]/Dest (0:3077) cvn /DEST pdfmark end
 479 3485 a 479
3485 a
SDict begin H.S end
 479 3485 a 479 3485 a
SDict begin 13 H.A end
 479 3485 a 479 3485 a
SDict begin [/View [/XYZ H.V]/Dest (0:3078) cvn /DEST pdfmark end
 479
3485 a Fg(Queue)i(messages)f(on)h(the)f(publisher)p Fk(.)h(This)g(is)g
(what)f(Gmail)g(does)g(when)g(I)g(don')o(t)f(read)g(my)h(email)g(for)g
(a)h(couple)479 3593 y(of)f(hours.)f(But)i(in)f(high-v)n(olume)e
(messaging,)h(pushing)f(queues)i(upstream)f(has)h(the)g(thrilling)g(b)n
(ut)g(unpro\002table)479 3701 y(result)h(of)e(making)g(publishers)g
(run)h(out)g(of)f(memory)g(and)h(crash.)f(Especially)h(if)g(there)g
(are)g(lots)h(of)f(subscribers)479 3809 y(and)g(it')-5
b(s)21 b(not)f(possible)g(to)g(\003ush)h(to)f(disk)g(for)g(performance)
d(reasons.)-2 3827 y
SDict begin H.S end
 -2 3827 a -2 3827 a
SDict begin 13 H.A end
 -2 3827 a -2
3827 a
SDict begin [/View [/XYZ H.V]/Dest (0:3079) cvn /DEST pdfmark end
 -2 3827 a Black 396 3958 a Fj(\225)p Black 479
3958 a
SDict begin H.S end
 479 3958 a 479 3958 a
SDict begin 13 H.A end
 479 3958 a 479 3958 a
SDict begin [/View [/XYZ H.V]/Dest (0:3080) cvn /DEST pdfmark end
 479
3958 a 479 3958 a
SDict begin H.S end
 479 3958 a 479 3958 a
SDict begin 13 H.A end
 479 3958 a 479
3958 a
SDict begin [/View [/XYZ H.V]/Dest (0:3081) cvn /DEST pdfmark end
 479 3958 a Fg(Queue)k(messages)f(on)h(the)f(subscriber)p
Fk(.)h(This)g(is)g(much)e(better)m(,)g(and)h(it')-5 b(s)21
b(what)f(\330MQ)h(does)f(by)f(def)o(ault)h(if)g(the)479
4066 y(netw)o(ork)f(can)h(k)o(eep)g(up)g(with)g(things.)g(If)g(an)o
(yone')-5 b(s)18 b(going)h(to)h(run)g(out)g(of)g(memory)e(and)i(crash,)
f(it')o(ll)i(be)f(the)479 4174 y(subscriber)f(rather)h(than)f(the)i
(publisher)m(,)d(which)h(is)j(f)o(air)-5 b(.)20 b(This)g(is)h(perfect)f
(for)f("peak)o(y")g(streams)h(where)g(a)479 4282 y(subscriber)f(can')o
(t)g(k)o(eep)h(up)g(for)f(a)i(while,)f(b)n(ut)g(can)g(catch)g(up)g
(when)g(the)g(stream)g(slo)n(ws)h(do)n(wn.)e(Ho)n(we)n(v)o(er)f(it')-5
b(s)21 b(no)479 4390 y(answer)f(to)h(a)f(subscriber)f(that')-5
b(s)21 b(simply)f(too)f(slo)n(w)i(in)f(general.)-2 4408
y
SDict begin H.S end
 -2 4408 a -2 4408 a
SDict begin 13 H.A end
 -2 4408 a -2 4408 a
SDict begin [/View [/XYZ H.V]/Dest (0:3082) cvn /DEST pdfmark end
 -2 4408 a Black
396 4539 a Fj(\225)p Black 479 4539 a
SDict begin H.S end
 479 4539 a 479
4539 a
SDict begin 13 H.A end
 479 4539 a 479 4539 a
SDict begin [/View [/XYZ H.V]/Dest (0:3083) cvn /DEST pdfmark end
 479 4539 a 479 4539 a
SDict begin H.S end
 479
4539 a 479 4539 a
SDict begin 13 H.A end
 479 4539 a 479 4539 a
SDict begin [/View [/XYZ H.V]/Dest (0:3084) cvn /DEST pdfmark end
 479 4539 a Fg(Stop)h(queuing)f
(new)h(messages)g(after)e(a)h(while)p Fk(.)h(This)f(is)h(what)f(Gmail)h
(does)f(when)f(my)h(mailbox)f(o)o(v)o(er\003o)n(ws)g(its)479
4647 y(7.554GB,)g(no)h(7.555GB)f(of)g(space.)h(Ne)n(w)h(messages)f
(just)h(get)f(rejected)g(or)f(dropped.)f(This)i(is)i(a)e(great)g
(strate)o(gy)479 4755 y(from)f(the)i(perspecti)n(v)o(e)d(of)i(the)g
(publisher)m(,)e(and)i(it')-5 b(s)21 b(what)g(\330MQ)f(does)g(when)g
(the)g(publisher)e(sets)k(a)e(high)g(w)o(ater)479 4863
y(mark)g(or)g(HWM.)g(Ho)n(we)n(v)o(er)f(it)i(still)g(doesn')o(t)e(help)
h(us)g(\002x)g(the)h(slo)n(w)f(subscriber)-5 b(.)19 b(No)n(w)h(we)h
(just)g(get)f(gaps)f(in)i(our)479 4971 y(message)f(stream.)-2
4989 y
SDict begin H.S end
 -2 4989 a -2 4989 a
SDict begin 13 H.A end
 -2 4989 a -2 4989 a
SDict begin [/View [/XYZ H.V]/Dest (0:3085) cvn /DEST pdfmark end
 -2 4989
a Black 3759 5569 a Ff(251)p Black eop end
%%Page: 252 265
TeXDict begin 252 264 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.252) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3086) cvn /DEST pdfmark end
 479 72 a 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3087) cvn /DEST pdfmark end
 479 72 a Fg(Punish)k(slo)o(w)e
(subscribers)i(with)f(disconnect)p Fk(.)f(This)g(is)h(what)f(Hotmail)g
(does)g(when)g(I)g(don')o(t)f(login)g(for)h(tw)o(o)479
180 y(weeks,)g(which)g(is)h(why)e(I'm)h(on)g(my)g(\002fteenth)f
(Hotmail)h(account.)f(It')-5 b(s)21 b(a)f(nice)g(brutal)g(strate)o(gy)f
(that)h(forces)479 288 y(subscribers)g(to)g(sit)h(up)f(and)g(pay)f
(attention,)g(and)h(w)o(ould)f(be)h(ideal,)g(b)n(ut)h(\330MQ)f(doesn')o
(t)f(do)g(this,)i(and)f(there')-5 b(s)20 b(no)479 396
y(w)o(ay)h(to)f(layer)g(it)g(on)g(top)g(since)g(subscribers)g(are)g(in)
m(visible)f(to)i(publisher)d(applications.)-2 580 y
SDict begin H.S end
 -2
580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:3088) cvn /DEST pdfmark end
 -2 580 a 396 670 a Fk(None)i(of)g
(these)g(classic)h(strate)o(gies)f(\002t.)h(So)f(we)h(need)f(to)g(get)g
(creati)n(v)o(e.)f(Rather)h(than)g(disconnect)f(the)h(publisher)m(,)e
(let')-5 b(s)396 778 y(con)m(vince)18 b(the)j(subscriber)e(to)h(kill)g
(itself.)h(This)f(is)h(the)g(Suicidal)f(Snail)g(pattern.)f(When)h(a)h
(subscriber)e(detects)h(that)g(it')-5 b(s)396 886 y(running)18
b(too)i(slo)n(wly)g(\(where)f("too)h(slo)n(wly")g(is)h(presumably)d(a)j
(con\002gured)d(option)h(that)h(really)g(means)g("so)g(slo)n(wly)396
994 y(that)f(if)g(you)e(e)n(v)o(er)h(get)h(here,)e(shout)h(really)h
(loudly)e(because)h(I)g(need)g(to)h(kno)n(w)-5 b(,)17
b(so)i(I)g(can)f(\002x)h(this!"\),)f(it)h(croaks)f(and)g(dies.)-2
1178 y
SDict begin H.S end
 -2 1178 a -2 1178 a
SDict begin 13 H.A end
 -2 1178 a -2 1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:3089) cvn /DEST pdfmark end
 -2 1178
a 396 1268 a Fk(Ho)n(w)i(can)g(a)h(subscriber)e(detect)h(this?)h(One)f
(w)o(ay)g(w)o(ould)f(be)h(to)h(sequence)e(messages)h(\(number)e(them)i
(in)g(order\),)f(and)396 1376 y(use)h(a)g(HWM)h(at)f(the)g(publisher)-5
b(.)19 b(No)n(w)-5 b(,)19 b(if)h(the)f(subscriber)g(detects)h(a)g(gap)f
(\(i.e.)g(the)h(numbering)d(isn')o(t)j(consecuti)n(v)o(e\),)d(it)396
1484 y(kno)n(ws)j(something)e(is)k(wrong.)c(W)-7 b(e)22
b(then)d(tune)h(the)g(HWM)h(to)f(the)h("croak)e(and)g(die)h(if)h(you)e
(hit)i(this")f(le)n(v)o(el.)-2 1668 y
SDict begin H.S end
 -2 1668 a -2 1668
a
SDict begin 13 H.A end
 -2 1668 a -2 1668 a
SDict begin [/View [/XYZ H.V]/Dest (0:3090) cvn /DEST pdfmark end
 -2 1668 a 396 1758 a Fk(There)g(are)g(tw)o(o)g
(problems)f(with)h(this)h(solution.)e(One,)h(if)g(we)h(ha)n(v)o(e)f
(man)o(y)f(publishers,)f(ho)n(w)i(do)g(we)g(sequence)396
1866 y(messages?)g(The)g(solution)g(is)h(to)f(gi)n(v)o(e)g(each)f
(publisher)g(a)i(unique)d(ID)j(and)e(add)h(that)g(to)h(the)f
(sequencing.)e(Second,)h(if)396 1974 y(subscribers)h(use)g
(ZMQ_SUBSCRIBE)h(\002lters,)f(the)o(y)g(will)h(get)f(gaps)g(by)f
(de\002nition.)g(Our)h(precious)f(sequencing)396 2082
y(will)i(be)f(for)g(nothing.)-2 2266 y
SDict begin H.S end
 -2 2266 a -2 2266
a
SDict begin 13 H.A end
 -2 2266 a -2 2266 a
SDict begin [/View [/XYZ H.V]/Dest (0:3091) cvn /DEST pdfmark end
 -2 2266 a 396 2356 a Fk(Some)g(use-cases)g(w)o
(on')o(t)g(use)g(\002lters,)h(and)e(sequencing)f(will)j(w)o(ork)f(for)f
(them.)h(But)h(a)f(more)g(general)f(solution)g(is)i(that)396
2464 y(the)f(publisher)f(timestamps)h(each)g(message.)g(When)g(a)g
(subscriber)f(gets)i(a)g(message)f(it)h(checks)e(the)h(time,)h(and)e
(if)i(the)396 2571 y(dif)n(ference)d(is)j(more)e(than,)h(say)-5
b(,)19 b(one)h(second,)f(it)h(does)g(the)g("croak)f(and)g(die")h
(thing.)f(Possibly)h(\002ring)g(of)n(f)f(a)i(squa)o(wk)e(to)396
2679 y(some)h(operator)f(console)g(\002rst.)-2 2863 y
SDict begin H.S end

-2 2863 a -2 2863 a
SDict begin 13 H.A end
 -2 2863 a -2 2863 a
SDict begin [/View [/XYZ H.V]/Dest (0:3092) cvn /DEST pdfmark end
 -2 2863 a 396
2953 a Fk(The)h(Suicide)g(Snail)g(pattern)g(w)o(orks)g(especially)f
(when)h(subscribers)f(ha)n(v)o(e)h(their)g(o)n(wn)f(clients)i(and)e
(service-le)n(v)o(el)396 3061 y(agreements)g(and)h(need)f(to)i
(guarantee)d(certain)i(maximum)e(latencies.)i(Aborting)f(a)h
(subscriber)f(may)h(not)g(seem)g(lik)o(e)h(a)396 3169
y(constructi)n(v)o(e)e(w)o(ay)h(to)g(guarantee)f(a)h(maximum)f(latenc)o
(y)-5 b(,)18 b(b)n(ut)i(it')-5 b(s)22 b(the)e(assertion)g(model.)f
(Abort)g(today)-5 b(,)19 b(and)h(the)396 3277 y(problem)f(will)i(be)f
(\002x)o(ed.)f(Allo)n(w)h(late)h(data)f(to)g(\003o)n(w)h(do)n
(wnstream,)d(and)i(the)g(problem)e(may)i(cause)g(wider)g(damage)396
3385 y(and)g(tak)o(e)g(longer)f(to)h(appear)f(on)h(the)g(radar)-5
b(.)-2 3569 y
SDict begin H.S end
 -2 3569 a -2 3569 a
SDict begin 13 H.A end
 -2 3569 a -2 3569 a
SDict begin [/View [/XYZ H.V]/Dest (0:3093) cvn /DEST pdfmark end

-2 3569 a 396 3659 a Fk(So)21 b(here)e(is)i(a)g(minimal)f(e)o(xample)e
(of)i(a)h(Suicidal)f(Snail:)-2 3677 y
SDict begin H.S end
 -2 3677 a -2 3677
a
SDict begin 13 H.A end
 -2 3677 a -2 3677 a
SDict begin [/View [/XYZ H.V]/Dest (0:suisnail-c) cvn /DEST pdfmark
end
 -2 3677 a 396 3860 a Fg(Example)h(5-1.)e
(Suicidal)i(Snail)f(\(suisnail.c\))-2 3960 y
SDict begin H.S end
 -2 3960
a -2 3960 a
SDict begin 11.7 H.A end
 -2 3960 a -2 3960 a
SDict begin [/View [/XYZ H.V]/Dest (0:3096) cvn /DEST pdfmark end
 -2 3960 a 396 4041 a
Fe(//)396 4138 y(//)90 b(Suicidal)43 b(Snail)396 4235
y(//)396 4332 y(#include)h("czmq.h")396 4526 y(//)90
b(This)44 b(is)g(our)h(subscriber.)e(It)h(connects)g(to)g(the)g
(publisher)g(and)g(subscribes)f(to)396 4623 y(//)90 b(everything.)43
b(It)h(sleeps)g(for)g(a)h(short)f(time)g(between)g(messages)f(to)i
(simulate)e(doing)396 4720 y(//)90 b(too)44 b(much)g(work.)g(If)h(a)f
(message)g(is)g(more)h(than)f(1)g(second)g(late,)g(it)h(croaks:)396
4915 y(#define)f(MAX_ALLOWED_DELAY)132 b(1000)178 b(//)90
b(msecs)396 5109 y(static)44 b(void)p Black 3759 5569
a Ff(252)p Black eop end
%%Page: 253 266
TeXDict begin 253 265 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.253) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(subscriber)43 b(\(void)1158 85 y(*)1203
72 y(args,)h(zctx_t)1786 85 y(*)1831 72 y(ctx,)g(void)2279
85 y(*)2324 72 y(pipe\))396 170 y({)576 267 y(//)89 b(Subscribe)43
b(to)i(everything)576 364 y(void)800 377 y(*)845 364
y(subscriber)e(=)h(zsocket_new)f(\(ctx,)h(ZMQ_SUB\);)576
461 y(zsockopt_set_subscribe)d(\(subscriber,)i(""\);)576
558 y(zsocket_connect)f(\(subscriber,)h("tcp://localhost:5556"\);)576
752 y(//)89 b(Get)44 b(and)h(process)e(messages)576 850
y(while)h(\(true\))f({)755 947 y(char)979 960 y(*)1024
947 y(string)h(=)g(zstr_recv)g(\(subscriber\);)755 1044
y(printf\("\045s\\n",)e(string\);)755 1141 y(int64_t)i(clock;)755
1238 y(int)g(terms)g(=)h(sscanf)f(\(string,)f("\045")i(PRId64,)e
(&clock\);)755 1335 y(assert)h(\(terms)g(==)g(1\);)755
1432 y(free)g(\(string\);)755 1627 y(//)89 b(Suicide)44
b(snail)g(logic)755 1724 y(if)g(\(zclock_time)f(\(\))i(-)f(clock)g(>)h
(MAX_ALLOWED_DELAY\))d({)934 1821 y(fprintf)i(\(stderr,)f("E:)i
(subscriber)e(cannot)h(keep)g(up,)g(aborting\\n"\);)934
1918 y(break;)755 2015 y(})755 2112 y(//)89 b(Work)44
b(for)h(1)f(msec)h(plus)f(some)g(random)g(additional)f(time)755
2209 y(zclock_sleep)g(\(1)h(+)h(randof)f(\(2\)\);)576
2307 y(})576 2404 y(zstr_send)f(\(pipe,)h("gone)g(and)g(died"\);)396
2501 y(})-2 2675 y
SDict begin H.S end
 -2 2675 a -2 2675 a
SDict begin 13 H.A end
 -2 2675 a -2 2675
a
SDict begin [/View [/XYZ H.V]/Dest (0:3097) cvn /DEST pdfmark end
 -2 2675 a 396 2775 a Fk(This)21 b(is)g(our)e(publisher)g(task.)h(It)h
(publishes)e(a)i(time-stamped)d(message)i(to)h(its)g(PUB)g(sock)o(et)f
(e)n(v)o(ery)f(1)h(msec:)-2 2793 y
SDict begin H.S end
 -2 2793 a -2 2793
a
SDict begin 13 H.A end
 -2 2793 a -2 2793 a
SDict begin [/View [/XYZ H.V]/Dest (0:suisnail-c-1) cvn /DEST pdfmark
end
 -2 2793 a 396 2976 a Fg(Example)h(5-2.)e
(Suicidal)i(Snail)f(\(suisnail.c\))h(-)f(publisher)i(task)-2
3076 y
SDict begin H.S end
 -2 3076 a -2 3076 a
SDict begin 11.7 H.A end
 -2 3076 a -2 3076 a
SDict begin [/View [/XYZ H.V]/Dest (0:3100) cvn /DEST pdfmark end
 -2 3076
a 396 3253 a Fe(static)44 b(void)396 3351 y(publisher)g(\(void)1114
3364 y(*)1159 3351 y(args,)f(zctx_t)1741 3364 y(*)1786
3351 y(ctx,)h(void)2234 3364 y(*)2279 3351 y(pipe\))396
3448 y({)576 3545 y(//)89 b(Prepare)44 b(publisher)576
3642 y(void)800 3655 y(*)845 3642 y(publisher)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_PUB\);)576 3739 y(zsocket_bind)e(\(publisher,)h("tcp://)
2011 3752 y(*)2056 3739 y(:5556"\);)576 3933 y(while)h(\(true\))f({)755
4031 y(//)89 b(Send)44 b(current)g(clock)g(\(msecs\))g(to)g
(subscribers)755 4128 y(char)g(string)g([20];)755 4225
y(sprintf)g(\(string,)f("\045")h(PRId64,)g(zclock_time)f(\(\)\);)755
4322 y(zstr_send)g(\(publisher,)g(string\);)755 4419
y(char)979 4432 y(*)1024 4419 y(signal)h(=)g(zstr_recv_nowait)f
(\(pipe\);)755 4516 y(if)h(\(signal\))g({)934 4613 y(free)g
(\(signal\);)934 4711 y(break;)755 4808 y(})755 4905
y(zclock_sleep)f(\(1\);)537 b(//)89 b(1msec)44 b(wait)576
5002 y(})396 5099 y(})p Black 3759 5569 a Ff(253)p Black
eop end
%%Page: 254 267
TeXDict begin 254 266 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.254) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3101) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)i(main)g(task)g(simply)g(starts)h(a)g(client,)f
(and)f(a)i(serv)o(er)m(,)e(and)h(then)f(w)o(aits)i(for)f(the)g(client)g
(to)h(signal)f(that)g(it)h(has)f(died:)-2 90 y
SDict begin H.S end
 -2 90
a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:suisnail-c-2) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)h(5-3.)e
(Suicidal)i(Snail)f(\(suisnail.c\))h(-)f(main)h(task)-2
374 y
SDict begin H.S end
 -2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:3104) cvn /DEST pdfmark end
 -2 374 a 396
551 a Fe(int)45 b(main)f(\(void\))396 648 y({)576 745
y(zctx_t)889 758 y(*)934 745 y(ctx)h(=)f(zctx_new)g(\(\);)576
843 y(void)800 856 y(*)845 843 y(pubpipe)f(=)i(zthread_fork)e(\(ctx,)h
(publisher,)f(NULL\);)576 940 y(void)800 953 y(*)845
940 y(subpipe)g(=)i(zthread_fork)e(\(ctx,)h(subscriber,)f(NULL\);)576
1037 y(free)h(\(zstr_recv)f(\(subpipe\)\);)576 1134 y(zstr_send)g
(\(pubpipe,)g("break"\);)576 1231 y(zclock_sleep)f(\(100\);)576
1328 y(zctx_destroy)g(\(&ctx\);)576 1425 y(return)h(0;)396
1522 y(})-2 1697 y
SDict begin H.S end
 -2 1697 a -2 1697 a
SDict begin 13 H.A end
 -2 1697 a -2 1697
a
SDict begin [/View [/XYZ H.V]/Dest (0:3105) cvn /DEST pdfmark end
 -2 1697 a 396 1796 a Fk(Notes)21 b(about)e(this)i(e)o(xample:)-2
1814 y
SDict begin H.S end
 -2 1814 a -2 1814 a
SDict begin 13 H.A end
 -2 1814 a -2 1814 a
SDict begin [/View [/XYZ H.V]/Dest (0:3106) cvn /DEST pdfmark end
 -2 1814
a -2 1824 a
SDict begin H.S end
 -2 1824 a -2 1824 a
SDict begin 13 H.A end
 -2 1824 a -2 1824 a
SDict begin [/View [/XYZ H.V]/Dest (0:3107) cvn /DEST pdfmark end
 -2
1824 a Black 396 1967 a Fj(\225)p Black 479 1967 a
SDict begin H.S end
 479
1967 a 479 1967 a
SDict begin 13 H.A end
 479 1967 a 479 1967 a
SDict begin [/View [/XYZ H.V]/Dest (0:3108) cvn /DEST pdfmark end
 479 1967 a Fk(The)f(message)g
(here)g(consists)g(simply)g(of)g(the)g(current)f(system)i(clock)e(as)i
(a)g(number)d(of)i(milliseconds.)f(In)h(a)479 2075 y(realistic)h
(application)e(you')l(d)f(ha)n(v)o(e)h(at)i(least)g(a)g(message)f
(header)f(with)h(the)g(timestamp,)g(and)f(a)i(message)f(body)479
2182 y(with)h(data.)-2 2183 y
SDict begin H.S end
 -2 2183 a -2 2183 a
SDict begin 13 H.A end
 -2
2183 a -2 2183 a
SDict begin [/View [/XYZ H.V]/Dest (0:3109) cvn /DEST pdfmark end
 -2 2183 a Black 396 2332 a Fj(\225)p
Black 479 2332 a
SDict begin H.S end
 479 2332 a 479 2332 a
SDict begin 13 H.A end
 479 2332 a 479
2332 a
SDict begin [/View [/XYZ H.V]/Dest (0:3110) cvn /DEST pdfmark end
 479 2332 a Fk(The)f(e)o(xample)f(has)h(subscriber)f(and)h
(publisher)f(in)h(a)h(single)f(process,)f(as)i(tw)o(o)g(threads.)e(In)h
(reality)g(the)o(y)f(w)o(ould)h(be)479 2440 y(separate)g(processes.)g
(Using)g(threads)f(is)i(just)g(con)m(v)o(enient)d(for)h(the)h
(demonstration.)-2 2499 y
SDict begin H.S end
 -2 2499 a -2 2499 a
SDict begin 13 H.A end
 -2 2499
a -2 2499 a
SDict begin [/View [/XYZ H.V]/Dest (0:3111) cvn /DEST pdfmark end
 -2 2499 a 359 x Fn(5.2.)39 b(High-speed)e(Subscriber)n(s)g
(\(Blac)m(k)h(Bo)l(x)h(P)l(attern\))3279 2858 y
SDict begin H.S end
 3279
2858 a 3279 2858 a
SDict begin 22.464 H.A end
 3279 2858 a 3279 2858 a
SDict begin [/View [/XYZ H.V]/Dest (10.71.1) cvn /DEST pdfmark end
 3279 2858
a -2 3056 a
SDict begin H.S end
 -2 3056 a -2 3056 a
SDict begin 13 H.A end
 -2 3056 a -2 3056 a
SDict begin [/View [/XYZ H.V]/Dest (0:3113) cvn /DEST pdfmark end
 -2
3056 a 396 3132 a Fk(A)21 b(common)d(use-case)i(for)g(pub-sub)e(is)j
(distrib)n(uting)e(lar)o(ge)g(data)h(streams.)h(F)o(or)e(e)o(xample,)g
('mark)o(et)g(data')h(coming)396 3240 y(from)f(stock)h(e)o(xchanges.)e
(A)j(typical)f(set-up)g(w)o(ould)f(ha)n(v)o(e)h(a)g(publisher)f
(connected)f(to)j(a)f(stock)g(e)o(xchange,)e(taking)396
3348 y(price)i(quotes,)f(and)h(sending)f(them)h(out)g(to)g(a)h(number)d
(of)i(subscribers.)f(If)h(there)g(are)g(a)g(handful)f(of)h
(subscribers,)f(we)396 3456 y(could)g(use)i(TCP)-9 b(.)20
b(If)h(we)f(ha)n(v)o(e)g(a)g(lar)o(ger)f(number)g(of)g(subscribers,)g
(we')l(d)h(probably)e(use)i(reliable)g(multicast,)g(i.e.)3703
3456 y
SDict begin H.S end
 3703 3456 a 3703 3456 a
SDict begin 13 H.A end
 3703 3456 a 3703 3456
a
SDict begin [/View [/XYZ H.V]/Dest (0:3114) cvn /DEST pdfmark end
 3703 3456 a Fe(pgm)p Fk(.)-2 3640 y
SDict begin H.S end
 -2 3640 a -2 3640
a
SDict begin 13 H.A end
 -2 3640 a -2 3640 a
SDict begin [/View [/XYZ H.V]/Dest (0:3115) cvn /DEST pdfmark end
 -2 3640 a 396 3730 a Fk(Let')-5
b(s)21 b(imagine)e(our)h(feed)f(has)i(an)f(a)n(v)o(erage)f(of)g
(100,000)f(100-byte)g(messages)i(a)h(second.)e(That')-5
b(s)20 b(a)g(typical)g(rate,)g(after)396 3838 y(\002ltering)g(mark)o
(et)f(data)h(we)h(don')o(t)e(need)g(to)h(send)g(on)g(to)g(subscribers.)
f(No)n(w)i(we)f(decide)g(to)g(record)f(a)h(day')-5 b(s)20
b(data)396 3946 y(\(maybe)f(250)g(GB)i(in)g(8)f(hours\),)f(and)g(then)h
(replay)f(it)i(to)f(a)h(simulation)e(netw)o(ork,)g(i.e.)h(a)h(small)g
(group)d(of)i(subscribers.)396 4054 y(While)h(100K)e(messages)h(a)h
(second)e(is)j(easy)e(for)f(a)i(\330MQ)f(application,)f(we)h(w)o(ant)h
(to)f(replay)3125 4054 y
SDict begin H.S end
 3125 4054 a 3125 4054 a
SDict begin 13 H.A end
 3125
4054 a 3125 4054 a
SDict begin [/View [/XYZ H.V]/Dest (0:3116) cvn /DEST pdfmark end
 3125 4054 a Ff(muc)o(h)g(faster)r
Fk(.)-2 4238 y
SDict begin H.S end
 -2 4238 a -2 4238 a
SDict begin 13 H.A end
 -2 4238 a -2 4238
a
SDict begin [/View [/XYZ H.V]/Dest (0:3117) cvn /DEST pdfmark end
 -2 4238 a 396 4328 a Fk(So)h(we)f(set-up)g(our)f(architecture)g(with)
h(a)h(b)n(unch)e(of)h(box)o(es,)f(one)g(for)h(the)g(publisher)m(,)e
(and)i(one)g(for)f(each)h(subscriber)-5 b(.)396 4436
y(These)20 b(are)g(well-speci\002ed)g(box)o(es,)f(eight)h(cores,)f
(twelv)o(e)h(for)g(the)g(publisher)-5 b(.)19 b(\(If)h(you')l(re)e
(reading)h(this)h(in)h(2015,)396 4544 y(which)f(is)h(when)f(the)g
(Guide)g(is)h(scheduled)d(to)j(be)f(\002nished,)f(please)i(add)e(a)i
(zero)e(to)i(those)f(numbers.\))-2 4728 y
SDict begin H.S end
 -2 4728 a -2
4728 a
SDict begin 13 H.A end
 -2 4728 a -2 4728 a
SDict begin [/View [/XYZ H.V]/Dest (0:3118) cvn /DEST pdfmark end
 -2 4728 a 396 4818 a Fk(And)g(as)h(we)f
(pump)f(data)h(into)g(our)g(subscribers,)f(we)h(notice)g(tw)o(o)g
(things:)-2 4836 y
SDict begin H.S end
 -2 4836 a -2 4836 a
SDict begin 13 H.A end
 -2 4836 a -2 4836
a
SDict begin [/View [/XYZ H.V]/Dest (0:3119) cvn /DEST pdfmark end
 -2 4836 a -2 4846 a
SDict begin H.S end
 -2 4846 a -2 4846 a
SDict begin 13 H.A end
 -2 4846 a -2
4846 a
SDict begin [/View [/XYZ H.V]/Dest (0:3120) cvn /DEST pdfmark end
 -2 4846 a Black 463 4988 a Fk(1.)p Black 546 4988
a
SDict begin H.S end
 546 4988 a 546 4988 a
SDict begin 13 H.A end
 546 4988 a 546 4988 a
SDict begin [/View [/XYZ H.V]/Dest (0:3121) cvn /DEST pdfmark end
 546 4988
a Fk(When)g(we)g(do)g(e)n(v)o(en)f(the)h(slightest)h(amount)e(of)h(w)o
(ork)f(with)i(a)f(message,)g(it)h(slo)n(ws)g(do)n(wn)e(our)g
(subscriber)g(to)i(the)546 5096 y(point)e(where)h(it)h(can')o(t)e
(catch)h(up)g(with)g(the)g(publisher)f(again.)-2 5114
y
SDict begin H.S end
 -2 5114 a -2 5114 a
SDict begin 13 H.A end
 -2 5114 a -2 5114 a
SDict begin [/View [/XYZ H.V]/Dest (0:3122) cvn /DEST pdfmark end
 -2 5114 a Black
3759 5569 a Ff(254)p Black eop end
%%Page: 255 268
TeXDict begin 255 267 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.255) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 463 72 a Fk(2.)p Black 546 72 a
SDict begin H.S end
 546 72 a
546 72 a
SDict begin 13 H.A end
 546 72 a 546 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3123) cvn /DEST pdfmark end
 546 72 a Fk(W)-7 b(e')l(re)20
b(hitting)g(a)g(ceiling,)g(at)g(both)g(publisher)f(and)g(subscriber)m
(,)g(to)h(around)e(say)j(6M)f(messages)g(a)h(second,)e(e)n(v)o(en)546
180 y(after)h(careful)f(optimization)f(and)i(TCP)h(tuning.)-2
364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:3124) cvn /DEST pdfmark end
 -2 364 a 396
454 a Fk(The)f(\002rst)h(thing)f(we)g(ha)n(v)o(e)g(to)g(do)g(is)h
(break)e(our)g(subscriber)g(into)h(a)h(multithreaded)d(design)h(so)i
(that)f(we)h(can)f(do)g(w)o(ork)396 562 y(with)h(messages)f(in)g(one)g
(set)h(of)f(threads,)f(while)h(reading)f(messages)h(in)h(another)-5
b(.)19 b(T)-7 b(ypically)19 b(we)i(don')o(t)d(w)o(ant)i(to)396
670 y(process)g(e)n(v)o(ery)f(message)h(the)g(same)g(w)o(ay)-5
b(.)20 b(Rather)m(,)g(the)g(subscriber)f(will)i(\002lter)f(some)g
(messages,)g(perhaps)f(by)h(pre\002x)396 778 y(k)o(e)o(y)-5
b(.)19 b(When)h(a)h(message)f(matches)g(some)g(criteria,)f(the)i
(subscriber)d(will)j(call)g(a)g(w)o(ork)o(er)e(to)h(deal)g(with)h(it.)f
(In)g(\330MQ)396 886 y(terms)g(this)h(means)f(sending)f(the)h(message)g
(to)h(a)f(w)o(ork)o(er)g(thread.)-2 1070 y
SDict begin H.S end
 -2 1070 a
-2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:3125) cvn /DEST pdfmark end
 -2 1070 a 396 1160 a Fk(So)h(the)f
(subscriber)f(looks)h(something)e(lik)o(e)j(a)f(queue)f(de)n(vice.)g(W)
-7 b(e)22 b(could)d(use)h(v)n(arious)g(sock)o(ets)g(to)g(connect)f(the)
396 1268 y(subscriber)g(and)h(w)o(ork)o(ers.)f(If)h(we)h(assume)f
(one-w)o(ay)f(traf)n(\002c,)g(and)h(w)o(ork)o(ers)g(that)g(are)g(all)h
(identical,)e(we)i(can)f(use)396 1376 y(PUSH)h(and)f(PULL,)g(and)g
(dele)o(gate)e(all)j(the)f(routing)f(w)o(ork)g(to)i(\330MQ\()p
0 TeXcolorgray 2440 1376 a
SDict begin H.S end
 2440 1376 a Fk(Figure)e(5-1)2789
1376 y
SDict begin 13 H.L end
 2789 1376 a 2789 1376 a
SDict begin [/Subtype /Link/Dest (0:figure-63) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2789 1376 a Black -2 w
Fk(\).)h(This)h(is)g(the)f(simplest)h(and)e(f)o(astest)396
1484 y(approach.)-2 1502 y
SDict begin H.S end
 -2 1502 a -2 1502 a
SDict begin 13 H.A end
 -2 1502
a -2 1502 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-63) cvn /DEST pdfmark
end
 -2 1502 a 396 1685 a Fg(Figur)o(e)h(5-1.)f(The)i(Simple)g
(Black)g(Box)f(P)o(atter)o(n)-2 1785 y
SDict begin H.S end
 -2 1785 a -2 1785
a
SDict begin 13 H.A end
 -2 1785 a -2 1785 a
SDict begin [/View [/XYZ H.V]/Dest (0:3129) cvn /DEST pdfmark end
 -2 1785 a 396 4043 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4043 a
@beginspecial 0 @llx -266 @lly 285 @urx 0 @ury 2850 @rwi
@setspecial
%%BeginDocument: images/fig63.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -266 285 0
%%HiResBoundingBox: 0.0 -266.0 285.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -18.500150680541992 moveto
113.50015258789062 -45.50014877319336 lineto
173.50015258789062 -45.50014877319336 lineto
173.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -47.50014877319336 moveto
113.50015258789062 -57.50014877319336 lineto
113.50015258789062 -59.50014877319336 114.50015258789062 -60.50014877319336 116.50015258789062 -60.50014877319336 curveto
171.50015258789062 -60.50014877319336 lineto
171.50015258789062 -60.50014877319336 lineto
172.83348592122397 -60.50014877319336 173.50015258789062 -59.50014877319336 173.50015258789062 -57.50014877319336 curveto
173.50015258789062 -47.50014877319336 lineto
173.50015258789062 -47.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
116.50015258789062 -95.50015258789062 moveto
114.50015258789062 -95.50015258789062 113.50015258789062 -96.83348592122395 113.50015258789062 -99.50015258789062 curveto
113.50015258789062 -108.50015258789062 lineto
173.50015258789062 -108.50015258789062 lineto
173.50015258789062 -99.50015258789062 lineto
173.50015258789062 -96.83348592122395 172.83348592122397 -95.50015258789062 171.50015258789062 -95.50015258789062 curveto
116.50015258789062 -95.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -110.50015258789062 moveto
113.50015258789062 -136.50015258789062 lineto
173.50015258789062 -136.50015258789062 lineto
173.50015258789062 -110.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -138.50015258789062 moveto
113.50015258789062 -148.50015258789062 lineto
113.50015258789062 -150.50015258789062 114.50015258789062 -151.50015258789062 116.50015258789062 -151.50015258789062 curveto
171.50015258789062 -151.50015258789062 lineto
171.50015258789062 -151.50015258789062 lineto
172.83348592122397 -151.50015258789062 173.50015258789062 -150.50015258789062 173.50015258789062 -148.50015258789062 curveto
173.50015258789062 -138.50015258789062 lineto
173.50015258789062 -138.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
36.50014877319336 -193.50015258789062 moveto
34.50014877319336 -193.50015258789062 33.50014877319336 -194.83348592122397 33.50014877319336 -197.50015258789062 curveto
33.50014877319336 -206.50015258789062 lineto
93.50015258789062 -206.50015258789062 lineto
93.50015258789062 -197.50015258789062 lineto
93.50015258789062 -194.83348592122397 92.83348592122395 -193.50015258789062 91.50015258789062 -193.50015258789062 curveto
36.50014877319336 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
33.50014877319336 -208.50015258789062 moveto
33.50014877319336 -235.50015258789062 lineto
93.50015258789062 -235.50015258789062 lineto
93.50015258789062 -208.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
116.50015258789062 -193.50015258789062 moveto
114.50015258789062 -193.50015258789062 113.50015258789062 -194.83348592122397 113.50015258789062 -197.50015258789062 curveto
113.50015258789062 -206.50015258789062 lineto
173.50015258789062 -206.50015258789062 lineto
173.50015258789062 -197.50015258789062 lineto
173.50015258789062 -194.83348592122397 172.83348592122397 -193.50015258789062 171.50015258789062 -193.50015258789062 curveto
116.50015258789062 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -208.50015258789062 moveto
113.50015258789062 -235.50015258789062 lineto
173.50015258789062 -235.50015258789062 lineto
173.50015258789062 -208.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
196.50015258789062 -193.50015258789062 moveto
194.50015258789062 -193.50015258789062 193.50015258789062 -194.83348592122397 193.50015258789062 -197.50015258789062 curveto
193.50015258789062 -206.50015258789062 lineto
253.50015258789062 -206.50015258789062 lineto
253.50015258789062 -197.50015258789062 lineto
253.50015258789062 -194.83348592122397 252.83348592122397 -193.50015258789062 251.50015258789062 -193.50015258789062 curveto
196.50015258789062 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
193.50015258789062 -208.50015258789062 moveto
193.50015258789062 -235.50015258789062 lineto
253.50015258789062 -235.50015258789062 lineto
253.50015258789062 -208.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -17.0 moveto
112.0 -44.0 lineto
172.0 -44.0 lineto
172.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
112.0 -17.0 moveto
112.0 -44.0 lineto
172.0 -44.0 lineto
172.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -46.0 moveto
112.0 -56.0 lineto
112.0 -58.0 113.0 -59.0 115.0 -59.0 curveto
170.0 -59.0 lineto
170.0 -59.0 lineto
171.33333333333334 -59.0 172.0 -58.0 172.0 -56.0 curveto
172.0 -46.0 lineto
172.0 -46.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -46.0 moveto
112.0 -56.0 lineto
112.0 -58.0 113.0 -59.0 115.0 -59.0 curveto
170.0 -59.0 lineto
170.0 -59.0 lineto
171.33333333333334 -59.0 172.0 -58.0 172.0 -56.0 curveto
172.0 -46.0 lineto
172.0 -46.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -94.0 moveto
113.0 -94.0 112.0 -95.33333333333333 112.0 -98.0 curveto
112.0 -107.0 lineto
172.0 -107.0 lineto
172.0 -98.0 lineto
172.0 -95.33333333333333 171.33333333333334 -94.0 170.0 -94.0 curveto
115.0 -94.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -94.0 moveto
113.0 -94.0 112.0 -95.33333333333333 112.0 -98.0 curveto
112.0 -107.0 lineto
172.0 -107.0 lineto
172.0 -98.0 lineto
172.0 -95.33333333333333 171.33333333333334 -94.0 170.0 -94.0 curveto
115.0 -94.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -109.0 moveto
112.0 -135.0 lineto
172.0 -135.0 lineto
172.0 -109.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -109.0 moveto
112.0 -135.0 lineto
172.0 -135.0 lineto
172.0 -109.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -137.0 moveto
112.0 -147.0 lineto
112.0 -149.0 113.0 -150.0 115.0 -150.0 curveto
170.0 -150.0 lineto
170.0 -150.0 lineto
171.33333333333334 -150.0 172.0 -149.0 172.0 -147.0 curveto
172.0 -137.0 lineto
172.0 -137.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -137.0 moveto
112.0 -147.0 lineto
112.0 -149.0 113.0 -150.0 115.0 -150.0 curveto
170.0 -150.0 lineto
170.0 -150.0 lineto
171.33333333333334 -150.0 172.0 -149.0 172.0 -147.0 curveto
172.0 -137.0 lineto
172.0 -137.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
35.0 -192.0 moveto
33.0 -192.0 32.0 -193.33333333333334 32.0 -196.0 curveto
32.0 -205.0 lineto
92.0 -205.0 lineto
92.0 -196.0 lineto
92.0 -193.33333333333334 91.33333333333333 -192.0 90.0 -192.0 curveto
35.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
35.0 -192.0 moveto
33.0 -192.0 32.0 -193.33333333333334 32.0 -196.0 curveto
32.0 -205.0 lineto
92.0 -205.0 lineto
92.0 -196.0 lineto
92.0 -193.33333333333334 91.33333333333333 -192.0 90.0 -192.0 curveto
35.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
32.0 -207.0 moveto
32.0 -234.0 lineto
92.0 -234.0 lineto
92.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
32.0 -207.0 moveto
32.0 -234.0 lineto
92.0 -234.0 lineto
92.0 -207.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -192.0 moveto
113.0 -192.0 112.0 -193.33333333333334 112.0 -196.0 curveto
112.0 -205.0 lineto
172.0 -205.0 lineto
172.0 -196.0 lineto
172.0 -193.33333333333334 171.33333333333334 -192.0 170.0 -192.0 curveto
115.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -192.0 moveto
113.0 -192.0 112.0 -193.33333333333334 112.0 -196.0 curveto
112.0 -205.0 lineto
172.0 -205.0 lineto
172.0 -196.0 lineto
172.0 -193.33333333333334 171.33333333333334 -192.0 170.0 -192.0 curveto
115.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -207.0 moveto
112.0 -234.0 lineto
172.0 -234.0 lineto
172.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -207.0 moveto
112.0 -234.0 lineto
172.0 -234.0 lineto
172.0 -207.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
195.0 -192.0 moveto
193.0 -192.0 192.0 -193.33333333333334 192.0 -196.0 curveto
192.0 -205.0 lineto
252.0 -205.0 lineto
252.0 -196.0 lineto
252.0 -193.33333333333334 251.33333333333334 -192.0 250.0 -192.0 curveto
195.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
195.0 -192.0 moveto
193.0 -192.0 192.0 -193.33333333333334 192.0 -196.0 curveto
192.0 -205.0 lineto
252.0 -205.0 lineto
252.0 -196.0 lineto
252.0 -193.33333333333334 251.33333333333334 -192.0 250.0 -192.0 curveto
195.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
192.0 -207.0 moveto
192.0 -234.0 lineto
252.0 -234.0 lineto
252.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
192.0 -207.0 moveto
192.0 -234.0 lineto
252.0 -234.0 lineto
252.0 -207.0 lineto
closepath
stroke
0.5 setlinewidth
0 setlinecap
[2.0] 0.0 setdash
newpath
140.0 -73.0 moveto
12.0 -73.0 lineto
12.0 -248.0 lineto
272.0 -248.0 lineto
272.0 -73.0 lineto
145.0 -73.0 lineto
stroke
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
142.0 -59.0 moveto
142.0 -87.0 lineto
stroke
newpath
140.0 -84.0 moveto
142.0 -91.0 lineto
145.0 -84.0 lineto
closepath
fill
newpath
60.0 -182.0 moveto
62.0 -189.0 lineto
65.0 -182.0 lineto
closepath
fill
newpath
140.0 -182.0 moveto
142.0 -189.0 lineto
145.0 -182.0 lineto
closepath
fill
newpath
220.0 -182.0 moveto
222.0 -189.0 lineto
225.0 -182.0 lineto
closepath
fill
newpath
142.0 -150.0 moveto
142.0 -171.0 lineto
stroke
newpath
62.0 -185.0 moveto
62.0 -175.0 lineto
62.0 -172.33333333333334 63.0 -171.0 65.0 -171.0 curveto
142.0 -171.0 lineto
142.0 -171.0 lineto
stroke
newpath
142.0 -185.0 moveto
142.0 -171.0 lineto
stroke
newpath
222.0 -185.0 moveto
222.0 -175.0 lineto
222.0 -172.33333333333334 221.33333333333334 -171.0 220.0 -171.0 curveto
142.0 -171.0 lineto
142.0 -171.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
124.0 -35.0 moveto
(Publisher) show
135.0 -55.0 moveto
(PUB) show
228.0 -84.0 moveto
(Fast box) show
135.0 -104.0 moveto
(SUB) show
125.0 -126.0 moveto
(Subscriber) show
131.0 -146.0 moveto
(PUSH) show
51.0 -203.0 moveto
(PULL) show
131.0 -203.0 moveto
(PULL) show
211.0 -203.0 moveto
(PULL) show
46.0 -224.0 moveto
(Worker) show
126.0 -224.0 moveto
(Worker) show
206.0 -224.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4043 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4043 a -2 4209 a
SDict begin H.S end
 -2 4209
a -2 4209 a
SDict begin 13 H.A end
 -2 4209 a -2 4209 a
SDict begin [/View [/XYZ H.V]/Dest (0:3132) cvn /DEST pdfmark end
 -2 4209 a 396 4317 a
Fk(The)g(subscriber)f(talks)i(to)f(the)g(publisher)f(o)o(v)o(er)g(TCP)i
(or)f(PGM.)g(The)g(subscriber)f(talks)i(to)f(its)h(w)o(ork)o(ers,)e
(which)h(are)g(all)396 4425 y(in)h(the)f(same)g(process,)g(o)o(v)o(er)e
(inproc.)-2 4609 y
SDict begin H.S end
 -2 4609 a -2 4609 a
SDict begin 13 H.A end
 -2 4609 a -2 4609
a
SDict begin [/View [/XYZ H.V]/Dest (0:3133) cvn /DEST pdfmark end
 -2 4609 a 396 4699 a Fk(No)n(w)i(to)h(break)e(that)h(ceiling.)g(What)
g(happens)f(is)i(that)f(the)h(subscriber)e(thread)g(hits)i(100\045)e
(of)h(CPU,)h(and)f(since)g(it)h(is)396 4807 y(one)e(thread,)g(it)h
(cannot)e(use)i(more)f(than)g(one)g(core.)g(A)h(single)f(thread)g(will)
h(al)o(w)o(ays)g(hit)g(a)g(ceiling,)f(be)g(it)i(at)f(2M,)f(6M,)g(or)396
4915 y(more)h(messages)g(per)g(second.)f(W)-7 b(e)21
b(w)o(ant)f(to)h(split)g(the)f(w)o(ork)f(across)i(multiple)e(threads)h
(that)g(can)g(run)f(in)i(parallel.)p Black 3759 5569
a Ff(255)p Black eop end
%%Page: 256 269
TeXDict begin 256 268 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.256) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3134) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)i(approach)e(used)i(by)g(man)o(y)f
(high-performance)c(products,)k(which)g(w)o(orks)h(here,)g(is)3002
72 y
SDict begin H.S end
 3002 72 a 3002 72 a
SDict begin 13 H.A end
 3002 72 a 3002 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3135) cvn /DEST pdfmark end
 3002 72
a Ff(shar)m(ding)p Fk(,)e(meaning)h(we)396 180 y(split)i(the)f(w)o(ork)
g(into)g(parallel)f(and)h(independent)e(streams.)i(E.g.)f(half)h(of)g
(the)g(topic)g(k)o(e)o(ys)g(are)g(in)g(one)g(stream,)g(half)g(in)396
288 y(another\()p 0 TeXcolorgray 675 288 a
SDict begin H.S end
 675 288 a
Fk(Figure)d(5-2)1022 288 y
SDict begin 13 H.L end
 1022 288 a 1022 288 a
SDict begin [/Subtype /Link/Dest (0:figure-64) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1022
288 a Black -1 w Fk(\).)j(W)-7 b(e)21 b(could)e(use)h(man)o(y)f
(streams,)h(b)n(ut)g(performance)d(w)o(on')o(t)i(scale)i(unless)f(we)g
(ha)n(v)o(e)g(free)f(cores.)-2 472 y
SDict begin H.S end
 -2 472 a -2 472
a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:3137) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(So)i(let')-5
b(s)21 b(see)g(ho)n(w)e(to)i(shard)e(into)h(tw)o(o)h(streams:)-2
563 y
SDict begin H.S end
 -2 563 a -2 563 a
SDict begin 13 H.A end
 -2 563 a -2 563 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-64) cvn /DEST pdfmark
end
 -2 563 a 396
764 a Fg(Figur)o(e)f(5-2.)f(Mad)i(Black)f(Box)h(P)o(atter)o(n)-2
864 y
SDict begin H.S end
 -2 864 a -2 864 a
SDict begin 13 H.A end
 -2 864 a -2 864 a
SDict begin [/View [/XYZ H.V]/Dest (0:3140) cvn /DEST pdfmark end
 -2 864 a 396
3122 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3122 a @beginspecial 0 @llx -266 @lly 315
@urx 0 @ury 3150 @rwi @setspecial
%%BeginDocument: images/fig64.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -266 315 0
%%HiResBoundingBox: 0.0 -266.0 315.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -18.500150680541992 moveto
133.50015258789062 -46.50014877319336 lineto
193.50015258789062 -46.50014877319336 lineto
193.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -46.50014877319336 moveto
133.50015258789062 -57.50014877319336 lineto
133.50015258789062 -59.50014877319336 134.50015258789062 -60.50014877319336 136.50015258789062 -60.50014877319336 curveto
162.50015258789062 -60.50014877319336 lineto
162.50015258789062 -60.50014877319336 lineto
162.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
164.50015258789062 -46.50014877319336 moveto
164.50015258789062 -60.50014877319336 lineto
191.50015258789062 -60.50014877319336 lineto
192.83348592122397 -60.50014877319336 193.50015258789062 -59.50014877319336 193.50015258789062 -57.50014877319336 curveto
193.50015258789062 -46.50014877319336 lineto
193.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
136.50015258789062 -95.50015258789062 moveto
134.50015258789062 -95.50015258789062 133.50015258789062 -96.83348592122395 133.50015258789062 -99.50015258789062 curveto
133.50015258789062 -109.50015258789062 lineto
162.50015258789062 -109.50015258789062 lineto
162.50015258789062 -95.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
164.50015258789062 -95.50015258789062 moveto
164.50015258789062 -109.50015258789062 lineto
193.50015258789062 -109.50015258789062 lineto
193.50015258789062 -99.50015258789062 lineto
193.50015258789062 -96.83348592122395 192.83348592122397 -95.50015258789062 191.50015258789062 -95.50015258789062 curveto
164.50015258789062 -95.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -109.50015258789062 moveto
133.50015258789062 -137.50015258789062 lineto
193.50015258789062 -137.50015258789062 lineto
193.50015258789062 -109.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -137.50015258789062 moveto
133.50015258789062 -148.50015258789062 lineto
133.50015258789062 -150.50015258789062 134.50015258789062 -151.50015258789062 136.50015258789062 -151.50015258789062 curveto
162.50015258789062 -151.50015258789062 lineto
162.50015258789062 -151.50015258789062 lineto
162.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
164.50015258789062 -137.50015258789062 moveto
164.50015258789062 -151.50015258789062 lineto
191.50015258789062 -151.50015258789062 lineto
192.83348592122397 -151.50015258789062 193.50015258789062 -150.50015258789062 193.50015258789062 -148.50015258789062 curveto
193.50015258789062 -137.50015258789062 lineto
193.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
56.50014877319336 -193.50015258789062 moveto
54.50014877319336 -193.50015258789062 53.50014877319336 -194.83348592122397 53.50014877319336 -197.50015258789062 curveto
53.50014877319336 -206.50015258789062 lineto
113.50015258789062 -206.50015258789062 lineto
113.50015258789062 -197.50015258789062 lineto
113.50015258789062 -194.83348592122397 112.83348592122395 -193.50015258789062 111.50015258789062 -193.50015258789062 curveto
56.50014877319336 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
53.50014877319336 -208.50015258789062 moveto
53.50014877319336 -235.50015258789062 lineto
113.50015258789062 -235.50015258789062 lineto
113.50015258789062 -208.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
136.50015258789062 -193.50015258789062 moveto
134.50015258789062 -193.50015258789062 133.50015258789062 -194.83348592122397 133.50015258789062 -197.50015258789062 curveto
133.50015258789062 -206.50015258789062 lineto
193.50015258789062 -206.50015258789062 lineto
193.50015258789062 -197.50015258789062 lineto
193.50015258789062 -194.83348592122397 192.83348592122397 -193.50015258789062 191.50015258789062 -193.50015258789062 curveto
136.50015258789062 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.50015258789062 -208.50015258789062 moveto
133.50015258789062 -235.50015258789062 lineto
193.50015258789062 -235.50015258789062 lineto
193.50015258789062 -208.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
216.50015258789062 -193.50015258789062 moveto
214.50015258789062 -193.50015258789062 213.50015258789062 -194.83348592122397 213.50015258789062 -197.50015258789062 curveto
213.50015258789062 -206.50015258789062 lineto
273.5001525878906 -206.50015258789062 lineto
273.5001525878906 -197.50015258789062 lineto
273.5001525878906 -194.83348592122397 272.83348592122394 -193.50015258789062 271.5001525878906 -193.50015258789062 curveto
216.50015258789062 -193.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
213.50015258789062 -208.50015258789062 moveto
213.50015258789062 -235.50015258789062 lineto
273.5001525878906 -235.50015258789062 lineto
273.5001525878906 -208.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -17.0 moveto
132.0 -45.0 lineto
192.0 -45.0 lineto
192.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
132.0 -17.0 moveto
132.0 -45.0 lineto
192.0 -45.0 lineto
192.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -45.0 moveto
132.0 -56.0 lineto
132.0 -58.0 133.0 -59.0 135.0 -59.0 curveto
161.0 -59.0 lineto
161.0 -59.0 lineto
161.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -45.0 moveto
132.0 -56.0 lineto
132.0 -58.0 133.0 -59.0 135.0 -59.0 curveto
161.0 -59.0 lineto
161.0 -59.0 lineto
161.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
163.0 -45.0 moveto
163.0 -59.0 lineto
190.0 -59.0 lineto
191.33333333333334 -59.0 192.0 -58.0 192.0 -56.0 curveto
192.0 -45.0 lineto
192.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
163.0 -45.0 moveto
163.0 -59.0 lineto
190.0 -59.0 lineto
191.33333333333334 -59.0 192.0 -58.0 192.0 -56.0 curveto
192.0 -45.0 lineto
192.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
135.0 -94.0 moveto
133.0 -94.0 132.0 -95.33333333333333 132.0 -98.0 curveto
132.0 -108.0 lineto
161.0 -108.0 lineto
161.0 -94.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
135.0 -94.0 moveto
133.0 -94.0 132.0 -95.33333333333333 132.0 -98.0 curveto
132.0 -108.0 lineto
161.0 -108.0 lineto
161.0 -94.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
163.0 -94.0 moveto
163.0 -108.0 lineto
192.0 -108.0 lineto
192.0 -98.0 lineto
192.0 -95.33333333333333 191.33333333333334 -94.0 190.0 -94.0 curveto
163.0 -94.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
163.0 -94.0 moveto
163.0 -108.0 lineto
192.0 -108.0 lineto
192.0 -98.0 lineto
192.0 -95.33333333333333 191.33333333333334 -94.0 190.0 -94.0 curveto
163.0 -94.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -108.0 moveto
132.0 -136.0 lineto
192.0 -136.0 lineto
192.0 -108.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -108.0 moveto
132.0 -136.0 lineto
192.0 -136.0 lineto
192.0 -108.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -136.0 moveto
132.0 -147.0 lineto
132.0 -149.0 133.0 -150.0 135.0 -150.0 curveto
161.0 -150.0 lineto
161.0 -150.0 lineto
161.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -136.0 moveto
132.0 -147.0 lineto
132.0 -149.0 133.0 -150.0 135.0 -150.0 curveto
161.0 -150.0 lineto
161.0 -150.0 lineto
161.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
163.0 -136.0 moveto
163.0 -150.0 lineto
190.0 -150.0 lineto
191.33333333333334 -150.0 192.0 -149.0 192.0 -147.0 curveto
192.0 -136.0 lineto
192.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
163.0 -136.0 moveto
163.0 -150.0 lineto
190.0 -150.0 lineto
191.33333333333334 -150.0 192.0 -149.0 192.0 -147.0 curveto
192.0 -136.0 lineto
192.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
55.0 -192.0 moveto
53.0 -192.0 52.0 -193.33333333333334 52.0 -196.0 curveto
52.0 -205.0 lineto
112.0 -205.0 lineto
112.0 -196.0 lineto
112.0 -193.33333333333334 111.33333333333333 -192.0 110.0 -192.0 curveto
55.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
55.0 -192.0 moveto
53.0 -192.0 52.0 -193.33333333333334 52.0 -196.0 curveto
52.0 -205.0 lineto
112.0 -205.0 lineto
112.0 -196.0 lineto
112.0 -193.33333333333334 111.33333333333333 -192.0 110.0 -192.0 curveto
55.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
52.0 -207.0 moveto
52.0 -234.0 lineto
112.0 -234.0 lineto
112.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
52.0 -207.0 moveto
52.0 -234.0 lineto
112.0 -234.0 lineto
112.0 -207.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
135.0 -192.0 moveto
133.0 -192.0 132.0 -193.33333333333334 132.0 -196.0 curveto
132.0 -205.0 lineto
192.0 -205.0 lineto
192.0 -196.0 lineto
192.0 -193.33333333333334 191.33333333333334 -192.0 190.0 -192.0 curveto
135.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
135.0 -192.0 moveto
133.0 -192.0 132.0 -193.33333333333334 132.0 -196.0 curveto
132.0 -205.0 lineto
192.0 -205.0 lineto
192.0 -196.0 lineto
192.0 -193.33333333333334 191.33333333333334 -192.0 190.0 -192.0 curveto
135.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
132.0 -207.0 moveto
132.0 -234.0 lineto
192.0 -234.0 lineto
192.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
132.0 -207.0 moveto
132.0 -234.0 lineto
192.0 -234.0 lineto
192.0 -207.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
215.0 -192.0 moveto
213.0 -192.0 212.0 -193.33333333333334 212.0 -196.0 curveto
212.0 -205.0 lineto
272.0 -205.0 lineto
272.0 -196.0 lineto
272.0 -193.33333333333334 271.3333333333333 -192.0 270.0 -192.0 curveto
215.0 -192.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
215.0 -192.0 moveto
213.0 -192.0 212.0 -193.33333333333334 212.0 -196.0 curveto
212.0 -205.0 lineto
272.0 -205.0 lineto
272.0 -196.0 lineto
272.0 -193.33333333333334 271.3333333333333 -192.0 270.0 -192.0 curveto
215.0 -192.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -207.0 moveto
212.0 -234.0 lineto
272.0 -234.0 lineto
272.0 -207.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -207.0 moveto
212.0 -234.0 lineto
272.0 -234.0 lineto
272.0 -207.0 lineto
closepath
stroke
0.5 setlinewidth
0 setlinecap
[2.0] 0.0 setdash
newpath
145.0 -73.0 moveto
22.0 -73.0 lineto
22.0 -248.0 lineto
302.0 -248.0 lineto
302.0 -73.0 lineto
180.0 -73.0 lineto
stroke
newpath
150.0 -73.0 moveto
175.0 -73.0 lineto
stroke
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
147.0 -59.0 moveto
147.0 -87.0 lineto
stroke
newpath
177.0 -59.0 moveto
177.0 -87.0 lineto
stroke
newpath
177.0 -150.0 moveto
177.0 -171.0 lineto
240.0 -171.0 lineto
241.33333333333334 -171.0 242.0 -172.33333333333334 242.0 -175.0 curveto
242.0 -185.0 lineto
242.0 -185.0 lineto
stroke
newpath
145.0 -84.0 moveto
147.0 -91.0 lineto
150.0 -84.0 lineto
closepath
fill
newpath
175.0 -84.0 moveto
177.0 -91.0 lineto
180.0 -84.0 lineto
closepath
fill
newpath
80.0 -182.0 moveto
82.0 -189.0 lineto
85.0 -182.0 lineto
closepath
fill
newpath
160.0 -182.0 moveto
162.0 -189.0 lineto
165.0 -182.0 lineto
closepath
fill
newpath
240.0 -182.0 moveto
242.0 -189.0 lineto
245.0 -182.0 lineto
closepath
fill
newpath
147.0 -150.0 moveto
147.0 -171.0 lineto
stroke
newpath
82.0 -185.0 moveto
82.0 -175.0 lineto
82.0 -172.33333333333334 83.0 -171.0 85.0 -171.0 curveto
147.0 -171.0 lineto
147.0 -171.0 lineto
stroke
newpath
162.0 -185.0 moveto
162.0 -171.0 lineto
147.0 -171.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
144.0 -35.0 moveto
(Publisher) show
140.0 -55.0 moveto
(PUB) show
170.0 -55.0 moveto
(PUB) show
248.0 -84.0 moveto
(Fast box) show
140.0 -104.0 moveto
(SUB) show
170.0 -104.0 moveto
(SUB) show
145.0 -126.0 moveto
(Subscriber) show
143.0 -146.0 moveto
(PUSH PUSH) show
71.0 -203.0 moveto
(PULL) show
151.0 -203.0 moveto
(PULL) show
231.0 -203.0 moveto
(PULL) show
66.0 -224.0 moveto
(Worker) show
146.0 -224.0 moveto
(Worker) show
226.0 -224.0 moveto
(Worker) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3122 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3122 a -2 3288 a
SDict begin H.S end
 -2 3288
a -2 3288 a
SDict begin 13 H.A end
 -2 3288 a -2 3288 a
SDict begin [/View [/XYZ H.V]/Dest (0:3143) cvn /DEST pdfmark end
 -2 3288 a 396 3396 a
Fk(W)m(ith)g(tw)o(o)f(streams,)g(w)o(orking)f(at)i(full)f(speed,)f(we)i
(w)o(ould)e(con\002gure)g(\330MQ)h(as)h(follo)n(ws:)-2
3414 y
SDict begin H.S end
 -2 3414 a -2 3414 a
SDict begin 13 H.A end
 -2 3414 a -2 3414 a
SDict begin [/View [/XYZ H.V]/Dest (0:3144) cvn /DEST pdfmark end
 -2 3414
a -2 3424 a
SDict begin H.S end
 -2 3424 a -2 3424 a
SDict begin 13 H.A end
 -2 3424 a -2 3424 a
SDict begin [/View [/XYZ H.V]/Dest (0:3145) cvn /DEST pdfmark end
 -2
3424 a Black 396 3566 a Fj(\225)p Black 479 3566 a
SDict begin H.S end
 479
3566 a 479 3566 a
SDict begin 13 H.A end
 479 3566 a 479 3566 a
SDict begin [/View [/XYZ H.V]/Dest (0:3146) cvn /DEST pdfmark end
 479 3566 a Fk(T)-7
b(w)o(o)21 b(I/O)f(threads,)f(rather)h(than)g(one.)-2
3578 y
SDict begin H.S end
 -2 3578 a -2 3578 a
SDict begin 13 H.A end
 -2 3578 a -2 3578 a
SDict begin [/View [/XYZ H.V]/Dest (0:3147) cvn /DEST pdfmark end
 -2 3578
a Black 396 3715 a Fj(\225)p Black 479 3715 a
SDict begin H.S end
 479 3715
a 479 3715 a
SDict begin 13 H.A end
 479 3715 a 479 3715 a
SDict begin [/View [/XYZ H.V]/Dest (0:3148) cvn /DEST pdfmark end
 479 3715 a Fk(T)-7
b(w)o(o)21 b(netw)o(ork)e(interf)o(aces)g(\(NIC\),)h(one)g(per)g
(subscriber)-5 b(.)-2 3733 y
SDict begin H.S end
 -2 3733 a -2 3733 a
SDict begin 13 H.A end
 -2 3733
a -2 3733 a
SDict begin [/View [/XYZ H.V]/Dest (0:3149) cvn /DEST pdfmark end
 -2 3733 a Black 396 3865 a Fj(\225)p Black
479 3865 a
SDict begin H.S end
 479 3865 a 479 3865 a
SDict begin 13 H.A end
 479 3865 a 479 3865
a
SDict begin [/View [/XYZ H.V]/Dest (0:3150) cvn /DEST pdfmark end
 479 3865 a Fk(Each)20 b(I/O)g(thread)g(bound)e(to)i(a)h(speci\002c)f
(NIC.)-2 3883 y
SDict begin H.S end
 -2 3883 a -2 3883 a
SDict begin 13 H.A end
 -2 3883 a -2 3883
a
SDict begin [/View [/XYZ H.V]/Dest (0:3151) cvn /DEST pdfmark end
 -2 3883 a Black 396 4014 a Fj(\225)p Black 479 4014
a
SDict begin H.S end
 479 4014 a 479 4014 a
SDict begin 13 H.A end
 479 4014 a 479 4014 a
SDict begin [/View [/XYZ H.V]/Dest (0:3152) cvn /DEST pdfmark end
 479 4014
a Fk(T)-7 b(w)o(o)21 b(subscriber)e(threads,)g(bound)f(to)j(speci\002c)
f(cores.)-2 4032 y
SDict begin H.S end
 -2 4032 a -2 4032 a
SDict begin 13 H.A end
 -2 4032 a -2 4032
a
SDict begin [/View [/XYZ H.V]/Dest (0:3153) cvn /DEST pdfmark end
 -2 4032 a Black 396 4164 a Fj(\225)p Black 479 4164
a
SDict begin H.S end
 479 4164 a 479 4164 a
SDict begin 13 H.A end
 479 4164 a 479 4164 a
SDict begin [/View [/XYZ H.V]/Dest (0:3154) cvn /DEST pdfmark end
 479 4164
a Fk(T)-7 b(w)o(o)21 b(SUB)g(sock)o(ets,)f(one)g(per)f(subscriber)g
(thread.)-2 4182 y
SDict begin H.S end
 -2 4182 a -2 4182 a
SDict begin 13 H.A end
 -2 4182 a -2 4182
a
SDict begin [/View [/XYZ H.V]/Dest (0:3155) cvn /DEST pdfmark end
 -2 4182 a Black 396 4313 a Fj(\225)p Black 479 4313
a
SDict begin H.S end
 479 4313 a 479 4313 a
SDict begin 13 H.A end
 479 4313 a 479 4313 a
SDict begin [/View [/XYZ H.V]/Dest (0:3156) cvn /DEST pdfmark end
 479 4313
a Fk(The)h(remaining)f(cores)g(assigned)h(to)h(w)o(ork)o(er)e(threads.)
-2 4331 y
SDict begin H.S end
 -2 4331 a -2 4331 a
SDict begin 13 H.A end
 -2 4331 a -2 4331 a
SDict begin [/View [/XYZ H.V]/Dest (0:3157) cvn /DEST pdfmark end
 -2
4331 a Black 396 4462 a Fj(\225)p Black 479 4462 a
SDict begin H.S end
 479
4462 a 479 4462 a
SDict begin 13 H.A end
 479 4462 a 479 4462 a
SDict begin [/View [/XYZ H.V]/Dest (0:3158) cvn /DEST pdfmark end
 479 4462 a Fk(W)-7
b(ork)o(er)20 b(threads)g(connected)e(to)i(both)g(subscriber)f(PUSH)i
(sock)o(ets.)-2 4629 y
SDict begin H.S end
 -2 4629 a -2 4629 a
SDict begin 13 H.A end
 -2 4629 a
-2 4629 a
SDict begin [/View [/XYZ H.V]/Dest (0:3159) cvn /DEST pdfmark end
 -2 4629 a 396 4736 a Fk(W)m(ith)g(ideally)-5
b(,)19 b(no)h(more)f(threads)h(in)g(our)f(architecture)g(than)h(we)g
(had)g(cores.)f(Once)h(we)h(create)f(more)f(threads)h(than)396
4844 y(cores,)g(we)h(get)f(contention)e(between)h(threads,)h(and)f
(diminishing)g(returns.)g(There)g(w)o(ould)h(be)g(no)g(bene\002t,)f
(for)396 4952 y(e)o(xample,)g(in)h(creating)f(more)h(I/O)g(threads.)-2
4981 y
SDict begin H.S end
 -2 4981 a -2 4981 a
SDict begin 13 H.A end
 -2 4981 a -2 4981 a
SDict begin [/View [/XYZ H.V]/Dest (0:3160) cvn /DEST pdfmark end
 -2 4981
a Black 3757 5569 a Ff(256)p Black eop end
%%Page: 257 270
TeXDict begin 257 269 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.257) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 94 a Fn(5.3.)39 b(A)g(Shared)g(K)n(e)n(y-V)-9
b(alue)37 b(Cac)o(he)h(\(Clone)g(P)l(attern\))3162 94
y
SDict begin H.S end
 3162 94 a 3162 94 a
SDict begin 22.464 H.A end
 3162 94 a 3162 94 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.1) cvn /DEST pdfmark end
 3162 94 a -2
290 a
SDict begin H.S end
 -2 290 a -2 290 a
SDict begin 13 H.A end
 -2 290 a -2 290 a
SDict begin [/View [/XYZ H.V]/Dest (0:3162) cvn /DEST pdfmark end
 -2 290 a 396
368 a Fk(Pub-sub)19 b(is)i(lik)o(e)g(a)f(radio)g(broadcast,)e(you)i
(miss)h(e)n(v)o(erything)c(before)i(you)g(join,)h(and)g(then)f(ho)n(w)h
(much)f(information)396 476 y(you)h(get)g(depends)f(on)g(the)i(quality)
e(of)h(your)f(reception.)f(Surprisingly)-5 b(,)18 b(for)h(engineers)g
(who)h(are)g(used)g(to)g(aiming)g(for)396 584 y("perfection",)e(this)j
(model)e(is)i(useful)f(and)g(wide-spread,)e(because)h(it)i(maps)f
(perfectly)f(to)h(real-w)o(orld)f(distrib)n(ution)g(of)396
692 y(information.)f(Think)h(of)h(F)o(acebook)e(and)i(T)-7
b(witter)m(,)20 b(the)g(BBC)i(W)-7 b(orld)20 b(Service,)g(and)f(the)h
(sports)g(results.)-2 876 y
SDict begin H.S end
 -2 876 a -2 876 a
SDict begin 13 H.A end
 -2 876
a -2 876 a
SDict begin [/View [/XYZ H.V]/Dest (0:3163) cvn /DEST pdfmark end
 -2 876 a 396 966 a Fk(Ho)n(we)n(v)o(er)m(,)e(there)i(are)g
(also)h(a)f(whole)g(lot)g(of)g(cases)h(where)f(more)f(reliable)h
(pub-sub)e(w)o(ould)i(be)g(v)n(aluable,)e(if)j(we)f(could)396
1074 y(do)g(it.)h(As)g(we)f(did)g(for)g(request-reply)-5
b(,)17 b(let')-5 b(s)21 b(de\002ne)f(\224reliability')f(in)h(terms)g
(of)g(what)g(can)g(go)g(wrong.)f(Here)h(are)g(the)396
1182 y(classic)h(problems)e(with)h(pub-sub:)-2 1200 y
SDict begin H.S end

-2 1200 a -2 1200 a
SDict begin 13 H.A end
 -2 1200 a -2 1200 a
SDict begin [/View [/XYZ H.V]/Dest (0:3164) cvn /DEST pdfmark end
 -2 1200 a -2
1210 a
SDict begin H.S end
 -2 1210 a -2 1210 a
SDict begin 13 H.A end
 -2 1210 a -2 1210 a
SDict begin [/View [/XYZ H.V]/Dest (0:3165) cvn /DEST pdfmark end
 -2 1210
a Black 396 1352 a Fj(\225)p Black 479 1352 a
SDict begin H.S end
 479 1352
a 479 1352 a
SDict begin 13 H.A end
 479 1352 a 479 1352 a
SDict begin [/View [/XYZ H.V]/Dest (0:3166) cvn /DEST pdfmark end
 479 1352 a Fk(Subscribers)f(join)h
(late,)h(so)f(miss)h(messages)g(the)f(serv)o(er)f(already)g(sent.)-2
1370 y
SDict begin H.S end
 -2 1370 a -2 1370 a
SDict begin 13 H.A end
 -2 1370 a -2 1370 a
SDict begin [/View [/XYZ H.V]/Dest (0:3167) cvn /DEST pdfmark end
 -2 1370
a Black 396 1501 a Fj(\225)p Black 479 1501 a
SDict begin H.S end
 479 1501
a 479 1501 a
SDict begin 13 H.A end
 479 1501 a 479 1501 a
SDict begin [/View [/XYZ H.V]/Dest (0:3168) cvn /DEST pdfmark end
 479 1501 a Fk(Subscriber)g
(connections)f(are)j(slo)n(w)-5 b(,)19 b(and)h(can)g(lose)h(messages)f
(during)e(that)j(time.)-2 1519 y
SDict begin H.S end
 -2 1519 a -2 1519 a
SDict begin 13 H.A end

-2 1519 a -2 1519 a
SDict begin [/View [/XYZ H.V]/Dest (0:3169) cvn /DEST pdfmark end
 -2 1519 a Black 396 1651 a Fj(\225)p
Black 479 1651 a
SDict begin H.S end
 479 1651 a 479 1651 a
SDict begin 13 H.A end
 479 1651 a 479
1651 a
SDict begin [/View [/XYZ H.V]/Dest (0:3170) cvn /DEST pdfmark end
 479 1651 a Fk(Subscribers)e(go)h(a)o(w)o(ay)-5
b(,)19 b(and)h(lose)h(messages)f(while)g(the)o(y)g(are)g(a)o(w)o(ay)-5
b(.)-2 1835 y
SDict begin H.S end
 -2 1835 a -2 1835 a
SDict begin 13 H.A end
 -2 1835 a -2 1835 a
SDict begin [/View [/XYZ H.V]/Dest (0:3171) cvn /DEST pdfmark end

-2 1835 a 396 1925 a Fk(Less)21 b(often,)e(we)i(see)g(problems)d(lik)o
(e)j(these:)-2 1943 y
SDict begin H.S end
 -2 1943 a -2 1943 a
SDict begin 13 H.A end
 -2 1943 a -2
1943 a
SDict begin [/View [/XYZ H.V]/Dest (0:3172) cvn /DEST pdfmark end
 -2 1943 a -2 1953 a
SDict begin H.S end
 -2 1953 a -2 1953 a
SDict begin 13 H.A end
 -2 1953
a -2 1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:3173) cvn /DEST pdfmark end
 -2 1953 a Black 396 2095 a Fj(\225)p Black
479 2095 a
SDict begin H.S end
 479 2095 a 479 2095 a
SDict begin 13 H.A end
 479 2095 a 479 2095
a
SDict begin [/View [/XYZ H.V]/Dest (0:3174) cvn /DEST pdfmark end
 479 2095 a Fk(Subscribers)e(can)h(crash,)g(and)g(restart,)g(and)f
(lose)i(whate)n(v)o(er)e(data)h(the)o(y)f(already)g(recei)n(v)o(ed.)-2
2113 y
SDict begin H.S end
 -2 2113 a -2 2113 a
SDict begin 13 H.A end
 -2 2113 a -2 2113 a
SDict begin [/View [/XYZ H.V]/Dest (0:3175) cvn /DEST pdfmark end
 -2 2113
a Black 396 2244 a Fj(\225)p Black 479 2244 a
SDict begin H.S end
 479 2244
a 479 2244 a
SDict begin 13 H.A end
 479 2244 a 479 2244 a
SDict begin [/View [/XYZ H.V]/Dest (0:3176) cvn /DEST pdfmark end
 479 2244 a Fk(Subscribers)g(can)h
(fetch)g(messages)g(too)g(slo)n(wly)-5 b(,)20 b(so)g(queues)g(b)n(uild)
f(up)h(and)g(then)g(o)o(v)o(er\003o)n(w)-5 b(.)-2 2262
y
SDict begin H.S end
 -2 2262 a -2 2262 a
SDict begin 13 H.A end
 -2 2262 a -2 2262 a
SDict begin [/View [/XYZ H.V]/Dest (0:3177) cvn /DEST pdfmark end
 -2 2262 a Black
396 2394 a Fj(\225)p Black 479 2394 a
SDict begin H.S end
 479 2394 a 479
2394 a
SDict begin 13 H.A end
 479 2394 a 479 2394 a
SDict begin [/View [/XYZ H.V]/Dest (0:3178) cvn /DEST pdfmark end
 479 2394 a Fk(Netw)o(orks)20
b(can)g(become)f(o)o(v)o(erloaded)e(and)j(drop)f(data)h
(\(speci\002cally)-5 b(,)19 b(for)g(PGM\).)-2 2412 y
SDict begin H.S end

-2 2412 a -2 2412 a
SDict begin 13 H.A end
 -2 2412 a -2 2412 a
SDict begin [/View [/XYZ H.V]/Dest (0:3179) cvn /DEST pdfmark end
 -2 2412 a Black
396 2543 a Fj(\225)p Black 479 2543 a
SDict begin H.S end
 479 2543 a 479
2543 a
SDict begin 13 H.A end
 479 2543 a 479 2543 a
SDict begin [/View [/XYZ H.V]/Dest (0:3180) cvn /DEST pdfmark end
 479 2543 a Fk(Netw)o(orks)h(can)g(become)f
(too)h(slo)n(w)-5 b(,)20 b(so)g(publisher)n(-side)f(queues)g(o)o(v)o
(er\003o)n(w)-5 b(,)18 b(and)h(publishers)g(crash.)-2
2727 y
SDict begin H.S end
 -2 2727 a -2 2727 a
SDict begin 13 H.A end
 -2 2727 a -2 2727 a
SDict begin [/View [/XYZ H.V]/Dest (0:3181) cvn /DEST pdfmark end
 -2 2727
a 396 2817 a Fk(A)i(lot)f(more)g(can)g(go)g(wrong)e(b)n(ut)j(these)f
(are)g(the)g(typical)g(f)o(ailures)g(we)g(see)h(in)g(a)f(realistic)h
(system.)-2 3001 y
SDict begin H.S end
 -2 3001 a -2 3001 a
SDict begin 13 H.A end
 -2 3001 a -2 3001
a
SDict begin [/View [/XYZ H.V]/Dest (0:3182) cvn /DEST pdfmark end
 -2 3001 a 396 3091 a Fk(W)-7 b(e')l(v)o(e)19 b(already)f(solv)o(ed)g
(some)h(of)g(these,)g(such)f(as)i(the)f(slo)n(w)h(subscriber)m(,)d
(which)h(we)i(handle)e(with)h(the)g(Suicidal)f(Snail)396
3199 y(pattern.)h(But)i(for)f(the)g(rest,)g(it)h(w)o(ould)f(be)g(nice)g
(to)g(ha)n(v)o(e)g(a)g(generic,)f(reusable)h(frame)n(w)o(ork)e(for)h
(reliable)h(pub-sub)m(.)-2 3383 y
SDict begin H.S end
 -2 3383 a -2 3383 a
SDict begin 13 H.A end

-2 3383 a -2 3383 a
SDict begin [/View [/XYZ H.V]/Dest (0:3183) cvn /DEST pdfmark end
 -2 3383 a 396 3473 a Fk(The)g(dif)n(\002culty)f(is)
i(that)g(we)f(ha)n(v)o(e)g(no)g(idea)g(what)g(our)f(tar)o(get)h
(applications)f(actually)g(w)o(ant)h(to)h(do)f(with)g(their)g(data.)g
(Do)396 3581 y(the)o(y)g(\002lter)g(it,)h(and)f(process)f(only)h(a)g
(subset)h(of)f(messages?)g(Do)g(the)o(y)f(log)h(the)g(data)h(some)n
(where)d(for)i(later)g(reuse?)g(Do)396 3689 y(the)o(y)f(distrib)n(ute)g
(the)h(data)f(further)f(to)i(w)o(ork)o(ers?)f(There)g(are)g(dozens)g
(of)g(plausible)g(scenarios,)g(and)g(each)g(will)i(ha)n(v)o(e)e(its)396
3797 y(o)n(wn)h(ideas)g(about)f(what)i(reliability)e(means)h(and)g(ho)n
(w)f(much)h(it')-5 b(s)21 b(w)o(orth)f(in)g(terms)g(of)g(ef)n(fort)f
(and)h(performance.)-2 3981 y
SDict begin H.S end
 -2 3981 a -2 3981 a
SDict begin 13 H.A end
 -2
3981 a -2 3981 a
SDict begin [/View [/XYZ H.V]/Dest (0:3184) cvn /DEST pdfmark end
 -2 3981 a 396 4071 a Fk(So)h(we')o(ll)f(b)n(uild)g(an)
g(abstraction)f(that)h(we)h(can)f(implement)f(once,)g(and)h(then)g
(reuse)f(for)h(man)o(y)f(applications.)g(This)396 4179
y(abstraction)g(is)i(a)915 4179 y
SDict begin H.S end
 915 4179 a 915 4179
a
SDict begin 13 H.A end
 915 4179 a 915 4179 a
SDict begin [/View [/XYZ H.V]/Dest (0:3185) cvn /DEST pdfmark end
 915 4179 a Fg(shar)o(ed)f(k)o(ey-v)o(alue)g
(cache)p Fk(,)f(which)h(stores)g(a)h(set)g(of)f(blobs)g(inde)o(x)o(ed)e
(by)i(unique)e(k)o(e)o(ys.)-2 4363 y
SDict begin H.S end
 -2 4363 a -2 4363
a
SDict begin 13 H.A end
 -2 4363 a -2 4363 a
SDict begin [/View [/XYZ H.V]/Dest (0:3186) cvn /DEST pdfmark end
 -2 4363 a 396 4453 a Fk(Don')o(t)h(confuse)g
(this)i(with)1197 4453 y
SDict begin H.S end
 1197 4453 a 1197 4453 a
SDict begin 13 H.A end
 1197
4453 a 1197 4453 a
SDict begin [/View [/XYZ H.V]/Dest (0:3187) cvn /DEST pdfmark end
 1197 4453 a Ff(distrib)n(uted)f(hash)g(tables)p
Fk(,)g(which)f(solv)o(e)h(the)g(wider)g(problem)e(of)i(connecting)e
(peers)i(in)h(a)396 4561 y(distrib)n(uted)f(netw)o(ork,)e(or)i(with)
1342 4561 y
SDict begin H.S end
 1342 4561 a 1342 4561 a
SDict begin 13 H.A end
 1342 4561 a 1342
4561 a
SDict begin [/View [/XYZ H.V]/Dest (0:3188) cvn /DEST pdfmark end
 1342 4561 a Ff(distrib)n(uted)f(k)o(e)n(y-value)g(tables)p
Fk(,)h(which)f(act)i(lik)o(e)f(non-SQL)f(databases.)h(All)h(we)f(will)
396 4669 y(b)n(uild)g(is)h(a)g(system)f(that)g(reliably)g(clones)g
(some)g(in-memory)d(state)k(from)f(a)g(serv)o(er)f(to)i(a)f(set)h(of)f
(clients.)h(W)-7 b(e)21 b(w)o(ant)f(to:)-2 4687 y
SDict begin H.S end
 -2
4687 a -2 4687 a
SDict begin 13 H.A end
 -2 4687 a -2 4687 a
SDict begin [/View [/XYZ H.V]/Dest (0:3189) cvn /DEST pdfmark end
 -2 4687 a -2 4697
a
SDict begin H.S end
 -2 4697 a -2 4697 a
SDict begin 13 H.A end
 -2 4697 a -2 4697 a
SDict begin [/View [/XYZ H.V]/Dest (0:3190) cvn /DEST pdfmark end
 -2 4697 a Black
396 4839 a Fj(\225)p Black 479 4839 a
SDict begin H.S end
 479 4839 a 479
4839 a
SDict begin 13 H.A end
 479 4839 a 479 4839 a
SDict begin [/View [/XYZ H.V]/Dest (0:3191) cvn /DEST pdfmark end
 479 4839 a Fk(Let)h(a)f(client)h(join)e
(the)i(netw)o(ork)e(at)h(an)o(y)g(time,)g(and)g(reliably)f(get)h(the)g
(current)f(serv)o(er)h(state.)-2 4857 y
SDict begin H.S end
 -2 4857 a -2
4857 a
SDict begin 13 H.A end
 -2 4857 a -2 4857 a
SDict begin [/View [/XYZ H.V]/Dest (0:3192) cvn /DEST pdfmark end
 -2 4857 a Black 396 4988 a
Fj(\225)p Black 479 4988 a
SDict begin H.S end
 479 4988 a 479 4988 a
SDict begin 13 H.A end
 479
4988 a 479 4988 a
SDict begin [/View [/XYZ H.V]/Dest (0:3193) cvn /DEST pdfmark end
 479 4988 a Fk(Let)h(an)o(y)e(client)h(update)f(the)i
(k)o(e)o(y-v)n(alue)d(cache)h(\(inserting)g(ne)n(w)h(k)o(e)o(y-v)n
(alue)e(pairs,)i(updating)e(e)o(xisting)i(ones,)g(or)479
5096 y(deleting)g(them\).)-2 5114 y
SDict begin H.S end
 -2 5114 a -2 5114
a
SDict begin 13 H.A end
 -2 5114 a -2 5114 a
SDict begin [/View [/XYZ H.V]/Dest (0:3194) cvn /DEST pdfmark end
 -2 5114 a Black 3756 5569 a Ff(257)p
Black eop end
%%Page: 258 271
TeXDict begin 258 270 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.258) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3195) cvn /DEST pdfmark end
 479 72 a Fk(Reliably)i(propagate)e
(changes)h(to)i(all)f(clients,)h(and)e(do)h(this)h(with)f(minimum)f
(latenc)o(y)g(o)o(v)o(erhead.)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end

-2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:3196) cvn /DEST pdfmark end
 -2 90 a Black 396 222 a Fj(\225)p Black
479 222 a
SDict begin H.S end
 479 222 a 479 222 a
SDict begin 13 H.A end
 479 222 a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:3197) cvn /DEST pdfmark end
 479
222 a Fk(Handle)h(v)o(ery)f(lar)o(ge)g(numbers)g(of)h(clients,)g(e.g.)g
(tens)g(of)g(thousands)f(or)h(more.)-2 406 y
SDict begin H.S end
 -2 406 a
-2 406 a
SDict begin 13 H.A end
 -2 406 a -2 406 a
SDict begin [/View [/XYZ H.V]/Dest (0:3198) cvn /DEST pdfmark end
 -2 406 a 396 496 a Fk(The)g(k)o(e)o(y)g
(aspect)g(of)g(the)g(Clone)g(pattern)f(is)j(that)e(clients)g(talk)h
(back)e(to)h(serv)o(ers,)g(which)g(is)h(more)e(than)h(we)g(do)g(in)g(a)
396 604 y(simple)g(pub-sub)f(dialog.)g(This)h(is)h(why)f(I)g(use)g(the)
h(terms)f(')-5 b(serv)o(er')19 b(and)h('client')f(instead)h(of)g
('publisher')e(and)396 712 y(')-5 b(subscriber'.)19 b(W)-7
b(e')o(ll)21 b(use)f(pub-sub)f(as)i(the)f(core)f(of)h(Clone)g(b)n(ut)h
(it)g(is)g(a)f(bit)h(more)e(than)h(that.)-2 730 y
SDict begin H.S end
 -2
730 a -2 730 a
SDict begin 13 H.A end
 -2 730 a -2 730 a
SDict begin [/View [/XYZ H.V]/Dest (0:3199) cvn /DEST pdfmark end
 -2 730 a 396 1040 a
Fb(5.3.1.)36 b(Distrib)n(uting)d(K)n(e)n(y-V)-7 b(alue)36
b(Updates)2501 1040 y
SDict begin H.S end
 2501 1040 a 2501 1040 a
SDict begin 18.72 H.A end
 2501 1040
a 2501 1040 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.21.2) cvn /DEST pdfmark end
 2501 1040 a -2 1232 a
SDict begin H.S end
 -2 1232 a -2 1232
a
SDict begin 13 H.A end
 -2 1232 a -2 1232 a
SDict begin [/View [/XYZ H.V]/Dest (0:3201) cvn /DEST pdfmark end
 -2 1232 a 396 1314 a Fk(W)-7 b(e')o(ll)22
b(de)n(v)o(elop)c(Clone)i(in)g(stages,)h(solving)e(one)h(problem)e(at)j
(a)f(time.)h(First,)f(let')-5 b(s)21 b(look)f(at)g(ho)n(w)g(to)g
(distrib)n(ute)396 1422 y(k)o(e)o(y-v)n(alue)e(updates)i(from)f(a)h
(serv)o(er)g(to)g(a)h(set)g(of)f(clients.)g(W)-7 b(e')o(ll)21
b(tak)o(e)f(our)g(weather)f(serv)o(er)h(from)f(Chapter)g(One)h(and)396
1530 y(ref)o(actor)f(it)i(to)g(send)e(messages)i(as)g(k)o(e)o(y-v)n
(alue)d(pairs\()p 0 TeXcolorgray 1958 1530 a
SDict begin H.S end
 1958 1530
a Fk(Figure)g(5-3)2306 1530 y
SDict begin 13 H.L end
 2306 1530 a 2306 1530 a
SDict begin [/Subtype /Link/Dest (0:figure-65) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

2306 1530 a Black -1 w Fk(\).)i(W)-7 b(e')o(ll)21 b(modify)e(our)g
(client)i(to)f(store)g(these)h(in)f(a)396 1638 y(hash)g(table.)-2
1639 y
SDict begin H.S end
 -2 1639 a -2 1639 a
SDict begin 13 H.A end
 -2 1639 a -2 1639 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-65) cvn /DEST pdfmark
end
 -2 1639
a 396 1839 a Fg(Figur)o(e)g(5-3.)f(Simplest)i(Clone)f(Model)-2
1939 y
SDict begin H.S end
 -2 1939 a -2 1939 a
SDict begin 13 H.A end
 -2 1939 a -2 1939 a
SDict begin [/View [/XYZ H.V]/Dest (0:3205) cvn /DEST pdfmark end
 -2 1939
a 396 3930 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3930 a @beginspecial 0 @llx -234 @lly
300 @urx 0 @ury 3000 @rwi @setspecial
%%BeginDocument: images/fig65.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -234 300 0
%%HiResBoundingBox: 0.0 -234.0 300.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -23.800180435180664 moveto
106.80017852783203 -57.80017852783203 lineto
190.80018615722656 -57.80017852783203 lineto
190.80018615722656 -23.800180435180664 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
106.80017852783203 -60.80017852783203 moveto
106.80017852783203 -73.80017852783203 lineto
106.80017852783203 -76.4668451944987 107.80017852783203 -77.80017852783203 109.80017852783203 -77.80017852783203 curveto
187.80018615722656 -77.80017852783203 lineto
187.80018615722656 -77.80017852783203 lineto
189.80018615722656 -77.80017852783203 190.80018615722656 -76.4668451944987 190.80018615722656 -73.80017852783203 curveto
190.80018615722656 -61.000179290771484 lineto
190.80018615722656 -60.80017852783203 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
19.800180435180664 -158.80018615722656 moveto
17.800180435180664 -158.80018615722656 16.800180435180664 -160.46685282389322 16.800180435180664 -163.80018615722656 curveto
16.800180435180664 -174.80018615722656 lineto
94.80017852783203 -174.80018615722656 lineto
94.80017852783203 -163.80018615722656 lineto
94.80017852783203 -160.46685282389322 93.80017852783203 -158.80018615722656 91.80017852783203 -158.80018615722656 curveto
19.800180435180664 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.800180435180664 -177.80018615722656 moveto
16.800180435180664 -212.80018615722656 lineto
94.80017852783203 -212.80018615722656 lineto
94.80017852783203 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
115.80017852783203 -158.80018615722656 moveto
113.80017852783203 -158.80018615722656 112.80017852783203 -160.46685282389322 112.80017852783203 -163.80018615722656 curveto
112.80017852783203 -174.80018615722656 lineto
190.80018615722656 -174.80018615722656 lineto
190.80018615722656 -163.80018615722656 lineto
190.80018615722656 -160.46685282389322 189.80018615722656 -158.80018615722656 187.80018615722656 -158.80018615722656 curveto
115.80017852783203 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
112.80017852783203 -177.80018615722656 moveto
112.80017852783203 -212.80018615722656 lineto
190.80018615722656 -212.80018615722656 lineto
190.80018615722656 -177.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
211.80018615722656 -158.80018615722656 moveto
209.80018615722656 -158.80018615722656 208.80018615722656 -160.46685282389322 208.80018615722656 -163.80018615722656 curveto
208.80018615722656 -174.80018615722656 lineto
286.8001708984375 -174.80018615722656 lineto
286.8001708984375 -163.80018615722656 lineto
286.8001708984375 -160.46685282389322 285.8001708984375 -158.80018615722656 283.8001708984375 -158.80018615722656 curveto
211.80018615722656 -158.80018615722656 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
208.80018615722656 -177.80018615722656 moveto
208.80018615722656 -212.80018615722656 lineto
286.8001708984375 -212.80018615722656 lineto
286.8001708984375 -177.80018615722656 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.6 setlinewidth
1 setlinecap
[] 0 setdash
newpath
105.0 -22.0 moveto
105.0 -56.0 lineto
189.0 -56.0 lineto
189.0 -22.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
105.0 -59.0 moveto
105.0 -72.0 lineto
105.0 -74.66666666666667 106.0 -76.0 108.0 -76.0 curveto
186.0 -76.0 lineto
186.0 -76.0 lineto
188.0 -76.0 189.0 -74.66666666666667 189.0 -72.0 curveto
189.0 -59.20000076293945 lineto
189.0 -59.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
18.0 -157.0 moveto
16.0 -157.0 15.0 -158.66666666666666 15.0 -162.0 curveto
15.0 -173.0 lineto
93.0 -173.0 lineto
93.0 -162.0 lineto
93.0 -158.66666666666666 92.0 -157.0 90.0 -157.0 curveto
18.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
18.0 -157.0 moveto
16.0 -157.0 15.0 -158.66666666666666 15.0 -162.0 curveto
15.0 -173.0 lineto
93.0 -173.0 lineto
93.0 -162.0 lineto
93.0 -158.66666666666666 92.0 -157.0 90.0 -157.0 curveto
18.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -211.0 lineto
93.0 -211.0 lineto
93.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -176.0 moveto
15.0 -211.0 lineto
93.0 -211.0 lineto
93.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
114.0 -157.0 moveto
112.0 -157.0 111.0 -158.66666666666666 111.0 -162.0 curveto
111.0 -173.0 lineto
189.0 -173.0 lineto
189.0 -162.0 lineto
189.0 -158.66666666666666 188.0 -157.0 186.0 -157.0 curveto
114.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
114.0 -157.0 moveto
112.0 -157.0 111.0 -158.66666666666666 111.0 -162.0 curveto
111.0 -173.0 lineto
189.0 -173.0 lineto
189.0 -162.0 lineto
189.0 -158.66666666666666 188.0 -157.0 186.0 -157.0 curveto
114.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -211.0 lineto
189.0 -211.0 lineto
189.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
111.0 -176.0 moveto
111.0 -211.0 lineto
189.0 -211.0 lineto
189.0 -176.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
210.0 -157.0 moveto
208.0 -157.0 207.0 -158.66666666666666 207.0 -162.0 curveto
207.0 -173.0 lineto
285.0 -173.0 lineto
285.0 -162.0 lineto
285.0 -158.66666666666666 284.0 -157.0 282.0 -157.0 curveto
210.0 -157.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
210.0 -157.0 moveto
208.0 -157.0 207.0 -158.66666666666666 207.0 -162.0 curveto
207.0 -173.0 lineto
285.0 -173.0 lineto
285.0 -162.0 lineto
285.0 -158.66666666666666 284.0 -157.0 282.0 -157.0 curveto
210.0 -157.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
207.0 -176.0 moveto
207.0 -211.0 lineto
285.0 -211.0 lineto
285.0 -176.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
207.0 -176.0 moveto
207.0 -211.0 lineto
285.0 -211.0 lineto
285.0 -176.0 lineto
closepath
stroke
newpath
48.0 -144.0 moveto
51.0 -153.0 lineto
54.0 -144.0 lineto
closepath
fill
newpath
144.0 -144.0 moveto
147.0 -153.0 lineto
150.0 -144.0 lineto
closepath
fill
newpath
240.0 -144.0 moveto
243.0 -153.0 lineto
246.0 -144.0 lineto
closepath
fill
newpath
147.0 -76.0 moveto
147.0 -121.0 lineto
stroke
newpath
51.0 -148.0 moveto
51.0 -121.0 lineto
147.0 -121.0 lineto
stroke
newpath
147.0 -148.0 moveto
147.0 -121.0 lineto
stroke
newpath
243.0 -148.0 moveto
243.0 -121.0 lineto
147.0 -121.0 lineto
stroke
/Helvetica findfont
9 scalefont setfont
128.0 -44.0 moveto
(Server) show
139.0 -71.0 moveto
(PUB) show
128.0 -107.0 moveto
(updates) show
43.0 -170.0 moveto
(SUB) show
139.0 -170.0 moveto
(SUB) show
235.0 -170.0 moveto
(SUB) show
40.0 -197.0 moveto
(Client) show
136.0 -197.0 moveto
(Client) show
232.0 -197.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3930 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3930 a -2 4096 a
SDict begin H.S end
 -2 4096
a -2 4096 a
SDict begin 13 H.A end
 -2 4096 a -2 4096 a
SDict begin [/View [/XYZ H.V]/Dest (0:3208) cvn /DEST pdfmark end
 -2 4096 a 396 4204 a
Fk(This)h(is)g(the)f(serv)o(er:)-2 4205 y
SDict begin H.S end
 -2 4205 a -2
4205 a
SDict begin 13 H.A end
 -2 4205 a -2 4205 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv1-c) cvn /DEST pdfmark
end
 -2 4205 a 396 4406 a Fg(Example)h(5-4.)e
(Clone)h(ser)o(v)o(er)-8 b(,)21 b(Model)f(One)h(\(clonesr)o(v1.c\))-2
4505 y
SDict begin H.S end
 -2 4505 a -2 4505 a
SDict begin 11.7 H.A end
 -2 4505 a -2 4505 a
SDict begin [/View [/XYZ H.V]/Dest (0:3211) cvn /DEST pdfmark end
 -2 4505
a 396 4586 a Fe(//)396 4683 y(//)90 b(Clone)44 b(server)f(Model)h(One)
396 4780 y(//)396 4974 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)396 5071 y(#include)f("kvsimple.c")p
Black 3759 5569 a Ff(258)p Black eop end
%%Page: 259 272
TeXDict begin 259 271 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.259) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(int)45 b(main)f(\(void\))396 170 y({)576
267 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(publisher)f(socket)576
364 y(zctx_t)889 377 y(*)934 364 y(ctx)i(=)f(zctx_new)g(\(\);)576
461 y(void)800 474 y(*)845 461 y(publisher)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_PUB\);)576 558 y(zsocket_bind)e(\(publisher,)h("tcp://)2011
571 y(*)2056 558 y(:5556"\);)576 655 y(zclock_sleep)f(\(200\);)576
850 y(zhash_t)934 863 y(*)979 850 y(kvmap)i(=)h(zhash_new)e(\(\);)576
947 y(int64_t)g(sequence)h(=)g(0;)576 1044 y(srandom)f(\(\(unsigned\))g
(time)h(\(NULL\)\);)576 1238 y(while)g(\(!zctx_interrupted\))d({)755
1335 y(//)89 b(Distribute)43 b(as)i(key-value)e(message)755
1432 y(kvmsg_t)1114 1445 y(*)1159 1432 y(kvmsg)g(=)i(kvmsg_new)e
(\(++sequence\);)755 1530 y(kvmsg_fmt_key)87 b(\(kvmsg,)44
b("\045d",)g(randof)g(\(10000\)\);)755 1627 y(kvmsg_fmt_body)e
(\(kvmsg,)i("\045d",)g(randof)g(\(1000000\)\);)755 1724
y(kvmsg_send)222 b(\(kvmsg,)44 b(publisher\);)755 1821
y(kvmsg_store)133 b(\(&kvmsg,)43 b(kvmap\);)576 1918
y(})576 2015 y(printf)g(\(")i(Interrupted\\n\045d)d(messages)i
(out\\n",)f(\(int\))h(sequence\);)576 2112 y(zhash_destroy)e
(\(&kvmap\);)576 2209 y(zctx_destroy)g(\(&ctx\);)576
2307 y(return)h(0;)396 2404 y(})-2 2578 y
SDict begin H.S end
 -2 2578 a -2
2578 a
SDict begin 13 H.A end
 -2 2578 a -2 2578 a
SDict begin [/View [/XYZ H.V]/Dest (0:3212) cvn /DEST pdfmark end
 -2 2578 a 396 2678 a Fk(And)20
b(here)g(is)h(the)f(client:)-2 2679 y
SDict begin H.S end
 -2 2679 a -2 2679
a
SDict begin 13 H.A end
 -2 2679 a -2 2679 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli1-c) cvn /DEST pdfmark
end
 -2 2679 a 396 2879 a Fg(Example)h(5-5.)e(Clone)h
(client,)g(Model)h(One)f(\(clonecli1.c\))-2 2979 y
SDict begin H.S end
 -2
2979 a -2 2979 a
SDict begin 11.7 H.A end
 -2 2979 a -2 2979 a
SDict begin [/View [/XYZ H.V]/Dest (0:3215) cvn /DEST pdfmark end
 -2 2979 a 396 3059
a Fe(//)396 3156 y(//)90 b(Clone)44 b(client)f(Model)h(One)396
3253 y(//)396 3448 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)396 3545 y(#include)f("kvsimple.c")
396 3739 y(int)h(main)f(\(void\))396 3836 y({)576 3933
y(//)89 b(Prepare)44 b(our)g(context)g(and)g(updates)g(socket)576
4031 y(zctx_t)889 4044 y(*)934 4031 y(ctx)h(=)f(zctx_new)g(\(\);)576
4128 y(void)800 4141 y(*)845 4128 y(updates)f(=)i(zsocket_new)e(\(ctx,)
h(ZMQ_SUB\);)576 4225 y(zsockopt_set_subscribe)d(\(updates,)i(""\);)576
4322 y(zsocket_connect)f(\(updates,)h("tcp://localhost:5556"\);)576
4516 y(zhash_t)934 4529 y(*)979 4516 y(kvmap)h(=)h(zhash_new)e(\(\);)
576 4613 y(int64_t)g(sequence)h(=)g(0;)576 4808 y(while)g(\(true\))f({)
755 4905 y(kvmsg_t)1114 4918 y(*)1159 4905 y(kvmsg)g(=)i(kvmsg_recv)e
(\(updates\);)755 5002 y(if)h(\(!kvmsg\))934 5099 y(break;)448
b(//)89 b(Interrupted)p Black 3759 5569 a Ff(259)p Black
eop end
%%Page: 260 273
TeXDict begin 260 272 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.260) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(kvmsg_store)43 b(\(&kvmsg,)g(kvmap\);)755
170 y(sequence++;)576 267 y(})576 364 y(printf)g(\(")i
(Interrupted\\n\045d)d(messages)i(in\\n",)g(\(int\))g(sequence\);)576
461 y(zhash_destroy)e(\(&kvmap\);)576 558 y(zctx_destroy)g(\(&ctx\);)
576 655 y(return)h(0;)396 752 y(})-2 927 y
SDict begin H.S end
 -2 927 a -2
927 a
SDict begin 13 H.A end
 -2 927 a -2 927 a
SDict begin [/View [/XYZ H.V]/Dest (0:3216) cvn /DEST pdfmark end
 -2 927 a 396 1026 a Fk(Some)20
b(notes)g(about)f(this)i(code:)-2 1027 y
SDict begin H.S end
 -2 1027 a -2
1027 a
SDict begin 13 H.A end
 -2 1027 a -2 1027 a
SDict begin [/View [/XYZ H.V]/Dest (0:3217) cvn /DEST pdfmark end
 -2 1027 a -2 1037 a
SDict begin H.S end
 -2 1037
a -2 1037 a
SDict begin 13 H.A end
 -2 1037 a -2 1037 a
SDict begin [/View [/XYZ H.V]/Dest (0:3218) cvn /DEST pdfmark end
 -2 1037 a Black 396 1197
a Fj(\225)p Black 479 1197 a
SDict begin H.S end
 479 1197 a 479 1197 a
SDict begin 13 H.A end
 479
1197 a 479 1197 a
SDict begin [/View [/XYZ H.V]/Dest (0:3219) cvn /DEST pdfmark end
 479 1197 a Fk(All)g(the)f(hard)g(w)o(ork)f(is)i(done)
e(in)i(a)1488 1197 y
SDict begin H.S end
 1488 1197 a 1488 1197 a
SDict begin 13 H.A end
 1488 1197
a 1488 1197 a
SDict begin [/View [/XYZ H.V]/Dest (0:3220) cvn /DEST pdfmark end
 1488 1197 a Fg(kvmsg)g Fk(class.)g(This)f(class)h(w)o
(orks)f(with)g(k)o(e)o(y-v)n(alue)e(message)i(objects,)g(which)479
1305 y(are)g(multi-part)f(\330MQ)i(messages)f(structured)f(as)i(three)e
(frames:)h(a)h(k)o(e)o(y)e(\(a)i(\330MQ)f(string\),)f(a)i(sequence)e
(number)479 1412 y(\(64-bit)g(v)n(alue,)g(in)i(netw)o(ork)e(byte)g
(order\),)g(and)g(a)i(binary)e(body)g(\(holds)g(e)n(v)o(erything)e
(else\).)-2 1430 y
SDict begin H.S end
 -2 1430 a -2 1430 a
SDict begin 13 H.A end
 -2 1430 a -2 1430
a
SDict begin [/View [/XYZ H.V]/Dest (0:3221) cvn /DEST pdfmark end
 -2 1430 a Black 396 1562 a Fj(\225)p Black 479 1562
a
SDict begin H.S end
 479 1562 a 479 1562 a
SDict begin 13 H.A end
 479 1562 a 479 1562 a
SDict begin [/View [/XYZ H.V]/Dest (0:3222) cvn /DEST pdfmark end
 479 1562
a Fk(The)j(serv)o(er)f(generates)h(messages)g(with)g(a)h(randomized)d
(4-digit)h(k)o(e)o(y)-5 b(,)19 b(which)g(lets)j(us)e(simulate)g(a)h
(lar)o(ge)e(b)n(ut)h(not)479 1670 y(enormous)e(hash)i(table)h(\(10K)e
(entries\).)-2 1685 y
SDict begin H.S end
 -2 1685 a -2 1685 a
SDict begin 13 H.A end
 -2 1685 a -2
1685 a
SDict begin [/View [/XYZ H.V]/Dest (0:3223) cvn /DEST pdfmark end
 -2 1685 a Black 396 1819 a Fj(\225)p Black 479
1819 a
SDict begin H.S end
 479 1819 a 479 1819 a
SDict begin 13 H.A end
 479 1819 a 479 1819 a
SDict begin [/View [/XYZ H.V]/Dest (0:3224) cvn /DEST pdfmark end
 479
1819 a Fk(The)h(serv)o(er)f(does)h(a)h(200)e(millisecond)h(pause)f
(after)h(binding)f(its)i(sock)o(et.)f(This)g(is)h(to)f(pre)n(v)o(ent)f
("slo)n(w)h(joiner)479 1927 y(syndrome")e(where)h(the)h(subscriber)e
(loses)i(messages)g(as)h(it)f(connects)f(to)h(the)g(serv)o(er')-5
b(s)19 b(sock)o(et.)g(W)-7 b(e')o(ll)21 b(remo)o(v)o(e)d(that)479
2035 y(in)j(later)f(models.)-2 2036 y
SDict begin H.S end
 -2 2036 a -2 2036
a
SDict begin 13 H.A end
 -2 2036 a -2 2036 a
SDict begin [/View [/XYZ H.V]/Dest (0:3225) cvn /DEST pdfmark end
 -2 2036 a Black 396 2185 a Fj(\225)p
Black 479 2185 a
SDict begin H.S end
 479 2185 a 479 2185 a
SDict begin 13 H.A end
 479 2185 a 479
2185 a
SDict begin [/View [/XYZ H.V]/Dest (0:3226) cvn /DEST pdfmark end
 479 2185 a Fk(W)-7 b(e')o(ll)22 b(use)e(the)g(terms)g
('publisher')f(and)g(')-5 b(subscriber')19 b(in)h(the)g(code)g(to)g
(refer)g(to)g(sock)o(ets.)g(This)g(will)h(help)f(later)479
2292 y(when)g(we)g(ha)n(v)o(e)g(multiple)g(sock)o(ets)g(doing)f(dif)n
(ferent)f(things.)-2 2477 y
SDict begin H.S end
 -2 2477 a -2 2477 a
SDict begin 13 H.A end
 -2 2477
a -2 2477 a
SDict begin [/View [/XYZ H.V]/Dest (0:3227) cvn /DEST pdfmark end
 -2 2477 a 396 2566 a Fk(Here)i(is)h(the)g(kvmsg)e(class,)i
(in)f(the)g(simplest)h(form)e(that)h(w)o(orks)g(for)g(no)n(w:)-2
2584 y
SDict begin H.S end
 -2 2584 a -2 2584 a
SDict begin 13 H.A end
 -2 2584 a -2 2584 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c) cvn /DEST pdfmark
end
 -2 2584
a 396 2768 a Fg(Example)h(5-6.)e(K)n(ey-v)o(alue)f(message)j(class)f
(\(kvsimple.c\))-2 2868 y
SDict begin H.S end
 -2 2868 a -2 2868 a
SDict begin 11.7 H.A end
 -2 2868
a -2 2868 a
SDict begin [/View [/XYZ H.V]/Dest (0:3230) cvn /DEST pdfmark end
 -2 2868 a 396 2948 a Fe(/)441 2961 y(*)576
2948 y(=====================================)o(======)o(======)o
(======)o(======)o(=====)o(===)441 3058 y(*)576 3045
y(kvsimple)43 b(-)i(simple)f(key-value)f(message)h(class)g(for)g
(example)g(applications)441 3155 y(*)576 3142 y
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)3714 3155 y(*)3759 3142 y(/)396
3336 y(#include)g("kvsimple.h")396 3434 y(#include)g("zlist.h")396
3628 y(//)90 b(Keys)44 b(are)g(short)g(strings)396 3725
y(#define)g(KVMSG_KEY_MAX)132 b(255)396 3919 y(//)90
b(Message)43 b(is)i(formatted)e(on)i(wire)f(as)g(4)h(frames:)396
4016 y(//)90 b(frame)44 b(0:)g(key)g(\(0MQ)h(string\))396
4114 y(//)90 b(frame)44 b(1:)g(sequence)g(\(8)g(bytes,)g(network)g
(order\))396 4211 y(//)90 b(frame)44 b(2:)g(body)g(\(blob\))396
4308 y(#define)g(FRAME_KEY)312 b(0)396 4405 y(#define)44
b(FRAME_SEQ)312 b(1)396 4502 y(#define)44 b(FRAME_BODY)267
b(2)396 4599 y(#define)44 b(KVMSG_FRAMES)177 b(3)396
4794 y(//)90 b(The)44 b(kvmsg)g(class)g(holds)g(a)h(single)e(key-value)
h(message)f(consisting)h(of)g(a)396 4891 y(//)90 b(list)44
b(of)g(0)h(or)f(more)h(frames:)396 5085 y(struct)f(_kvmsg)g({)p
Black 3759 5569 a Ff(260)p Black eop end
%%Page: 261 274
TeXDict begin 261 273 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.261) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(//)89 b(Presence)43 b(indicators)h(for)g(each)g
(frame)576 170 y(int)g(present)g([KVMSG_FRAMES];)576
267 y(//)89 b(Corresponding)43 b(0MQ)h(message)g(frames,)f(if)i(any)576
364 y(zmq_msg_t)e(frame)h([KVMSG_FRAMES];)576 461 y(//)89
b(Key,)44 b(copied)g(into)g(safe)g(C)h(string)576 558
y(char)f(key)g([KVMSG_KEY_MAX)f(+)h(1];)396 655 y(};)-2
830 y
SDict begin H.S end
 -2 830 a -2 830 a
SDict begin 13 H.A end
 -2 830 a -2 830 a
SDict begin [/View [/XYZ H.V]/Dest (0:3231) cvn /DEST pdfmark end
 -2 830 a 396
929 a Fk(Here)20 b(are)g(the)h(constructor)d(and)i(destructor)e(for)i
(the)g(class:)-2 930 y
SDict begin H.S end
 -2 930 a -2 930 a
SDict begin 13 H.A end
 -2 930 a -2
930 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-1) cvn /DEST pdfmark
end
 -2 930 a 396 1131 a Fg(Example)h(5-7.)e(K)n(ey-v)o(alue)f
(message)j(class)f(\(kvsimple.c\))g(-)h(constructor)e(and)i(destructor)
-2 1230 y
SDict begin H.S end
 -2 1230 a -2 1230 a
SDict begin 11.7 H.A end
 -2 1230 a -2 1230 a
SDict begin [/View [/XYZ H.V]/Dest (0:3234) cvn /DEST pdfmark end
 -2
1230 a 396 1505 a Fe(//)90 b(Constructor,)42 b(takes)i(a)h(sequence)f
(number)f(for)i(the)f(new)g(kvmsg)g(instance:)396 1602
y(kvmsg_t)755 1615 y(*)396 1699 y(kvmsg_new)g(\(int64_t)f(sequence\))
396 1796 y({)576 1894 y(kvmsg_t)755 2004 y(*)800 1991
y(self;)576 2185 y(self)h(=)g(\(kvmsg_t)1293 2198 y(*)1338
2185 y(\))g(zmalloc)g(\(sizeof)g(\(kvmsg_t\)\);)576 2282
y(kvmsg_set_sequence)d(\(self,)j(sequence\);)576 2379
y(return)f(self;)396 2476 y(})396 2671 y(//)90 b(zhash_free_fn)42
b(callback)i(helper)g(that)g(does)g(the)g(low)h(level)f(destruction:)
396 2768 y(void)396 2865 y(kvmsg_free)f(\(void)1158 2878
y(*)1203 2865 y(ptr\))396 2962 y({)576 3059 y(if)h(\(ptr\))g({)755
3156 y(kvmsg_t)1114 3169 y(*)1159 3156 y(self)g(=)g(\(kvmsg_t)1876
3169 y(*)1921 3156 y(\))g(ptr;)755 3253 y(//)89 b(Destroy)44
b(message)g(frames)f(if)i(any)755 3351 y(int)f(frame_nbr;)755
3448 y(for)g(\(frame_nbr)f(=)i(0;)g(frame_nbr)e(<)i(KVMSG_FRAMES;)d
(frame_nbr++\))934 3545 y(if)j(\(self->present)d([frame_nbr]\))1114
3642 y(zmq_msg_close)g(\(&self->frame)h([frame_nbr]\);)755
3836 y(//)89 b(Free)44 b(object)g(itself)755 3933 y(free)g(\(self\);)
576 4031 y(})396 4128 y(})396 4322 y(//)90 b(Destructor)396
4419 y(void)396 4516 y(kvmsg_destroy)43 b(\(kvmsg_t)1427
4529 y(**)1517 4516 y(self_p\))396 4613 y({)576 4711
y(assert)g(\(self_p\);)576 4808 y(if)h(\()755 4821 y(*)800
4808 y(self_p\))f({)755 4905 y(kvmsg_free)g(\()1293 4918
y(*)1338 4905 y(self_p\);)755 5015 y(*)800 5002 y(self_p)h(=)g(NULL;)
576 5099 y(})p Black 3759 5569 a Ff(261)p Black eop end
%%Page: 262 275
TeXDict begin 262 274 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.262) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(})-2 247 y
SDict begin H.S end
 -2 247 a -2 247 a
SDict begin 13 H.A end
 -2 247
a -2 247 a
SDict begin [/View [/XYZ H.V]/Dest (0:3235) cvn /DEST pdfmark end
 -2 247 a 396 346 a Fk(The)i(recv)g(method)f(reads)h(a)g(k)o
(e)o(y-v)n(alue)e(message)i(from)f(sock)o(et,)h(and)g(returns)f(a)i(ne)
n(w)f(kvmsg)f(instance:)-2 364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2
364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-2) cvn /DEST pdfmark
end
 -2 364 a 396 548 a Fg(Example)i(5-8.)e(K)n(ey-v)o(alue)f
(message)j(class)f(\(kvsimple.c\))g(-)h(r)o(ecv)e(method)-2
648 y
SDict begin H.S end
 -2 648 a -2 648 a
SDict begin 11.7 H.A end
 -2 648 a -2 648 a
SDict begin [/View [/XYZ H.V]/Dest (0:3238) cvn /DEST pdfmark end
 -2 648 a 396
922 a Fe(kvmsg_t)755 935 y(*)396 1019 y(kvmsg_recv)43
b(\(void)1158 1032 y(*)1203 1019 y(socket\))396 1116
y({)576 1214 y(assert)g(\(socket\);)576 1311 y(kvmsg_t)934
1324 y(*)979 1311 y(self)h(=)h(kvmsg_new)e(\(0\);)576
1505 y(//)89 b(Read)44 b(all)g(frames)g(off)h(the)f(wire,)g(reject)g
(if)g(bogus)576 1602 y(int)g(frame_nbr;)576 1699 y(for)g(\(frame_nbr)f
(=)i(0;)f(frame_nbr)g(<)g(KVMSG_FRAMES;)f(frame_nbr++\))g({)755
1796 y(if)h(\(self->present)f([frame_nbr]\))934 1894
y(zmq_msg_close)g(\(&self->frame)g([frame_nbr]\);)755
1991 y(zmq_msg_init)g(\(&self->frame)f([frame_nbr]\);)755
2088 y(self->present)h([frame_nbr])g(=)h(1;)755 2185
y(if)g(\(zmq_msg_recv)f(\(&self->frame)g([frame_nbr],)g(socket,)g(0\))i
(==)f(-1\))g({)934 2282 y(kvmsg_destroy)f(\(&self\);)934
2379 y(break;)755 2476 y(})755 2574 y(//)89 b(Verify)44
b(multipart)f(framing)755 2671 y(int)h(rcvmore)g(=)h(\(frame_nbr)e(<)h
(KVMSG_FRAMES)f(-)i(1\)?)f(1:)h(0;)755 2768 y(if)f(\(zsockopt_rcvmore)e
(\(socket\))i(!=)g(rcvmore\))g({)934 2865 y(kvmsg_destroy)f(\(&self\);)
934 2962 y(break;)755 3059 y(})576 3156 y(})576 3253
y(return)g(self;)396 3351 y(})-2 3525 y
SDict begin H.S end
 -2 3525 a -2
3525 a
SDict begin 13 H.A end
 -2 3525 a -2 3525 a
SDict begin [/View [/XYZ H.V]/Dest (0:3239) cvn /DEST pdfmark end
 -2 3525 a 396 3625 a Fk(The)20
b(send)g(method)f(sends)h(a)h(multi-frame)d(k)o(e)o(y-v)n(alue)g
(message)i(to)g(a)h(sock)o(et:)-2 3643 y
SDict begin H.S end
 -2 3643 a -2
3643 a
SDict begin 13 H.A end
 -2 3643 a -2 3643 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-3) cvn /DEST pdfmark
end
 -2 3643 a 396 3826 a Fg(Example)g(5-9.)e(K)n
(ey-v)o(alue)f(message)j(class)f(\(kvsimple.c\))g(-)h(send)g(method)-2
3926 y
SDict begin H.S end
 -2 3926 a -2 3926 a
SDict begin 11.7 H.A end
 -2 3926 a -2 3926 a
SDict begin [/View [/XYZ H.V]/Dest (0:3242) cvn /DEST pdfmark end
 -2 3926
a 396 4200 a Fe(void)396 4297 y(kvmsg_send)43 b(\(kvmsg_t)1293
4310 y(*)1338 4297 y(self,)h(void)1831 4310 y(*)1876
4297 y(socket\))396 4395 y({)576 4492 y(assert)f(\(self\);)576
4589 y(assert)g(\(socket\);)576 4783 y(int)h(frame_nbr;)576
4880 y(for)g(\(frame_nbr)f(=)i(0;)f(frame_nbr)g(<)g(KVMSG_FRAMES;)f
(frame_nbr++\))g({)755 4977 y(zmq_msg_t)g(copy;)755 5075
y(zmq_msg_init)g(\(&copy\);)p Black 3759 5569 a Ff(262)p
Black eop end
%%Page: 263 276
TeXDict begin 263 275 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.263) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(if)44 b(\(self->present)f([frame_nbr]\))934
170 y(zmq_msg_copy)g(\(&copy,)h(&self->frame)f([frame_nbr]\);)755
267 y(zmq_msg_send)g(\(&copy,)g(socket,)934 364 y(\(frame_nbr)g(<)i
(KVMSG_FRAMES)e(-)i(1\)?)f(ZMQ_SNDMORE:)f(0\);)755 461
y(zmq_msg_close)g(\(&copy\);)576 558 y(})396 655 y(})-2
830 y
SDict begin H.S end
 -2 830 a -2 830 a
SDict begin 13 H.A end
 -2 830 a -2 830 a
SDict begin [/View [/XYZ H.V]/Dest (0:3243) cvn /DEST pdfmark end
 -2 830 a 396
929 a Fk(These)20 b(methods)e(let)i(the)g(caller)g(get)f(and)g(set)i
(the)e(message)h(k)o(e)o(y)-5 b(,)18 b(as)j(a)f(\002x)o(ed)f(string)g
(and)g(as)h(a)g(printf)f(formatted)f(string:)-2 947 y
SDict begin H.S end

-2 947 a -2 947 a
SDict begin 13 H.A end
 -2 947 a -2 947 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-4) cvn /DEST pdfmark
end
 -2 947 a 396 1131
a Fg(Example)j(5-10.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(k)o(ey)h(methods)-2 1230 y
SDict begin H.S end
 -2 1230
a -2 1230 a
SDict begin 11.7 H.A end
 -2 1230 a -2 1230 a
SDict begin [/View [/XYZ H.V]/Dest (0:3246) cvn /DEST pdfmark end
 -2 1230 a 396 1505 a
Fe(char)620 1518 y(*)396 1602 y(kvmsg_key)44 b(\(kvmsg_t)1248
1615 y(*)1293 1602 y(self\))396 1699 y({)576 1796 y(assert)f(\(self\);)
576 1894 y(if)h(\(self->present)f([FRAME_KEY]\))f({)755
1991 y(if)i(\(!)979 2004 y(*)1024 1991 y(self->key\))f({)934
2088 y(size_t)h(size)g(=)h(zmq_msg_size)e(\(&self->frame)f
([FRAME_KEY]\);)934 2185 y(if)j(\(size)f(>)g(KVMSG_KEY_MAX\))1114
2282 y(size)g(=)g(KVMSG_KEY_MAX;)934 2379 y(memcpy)g(\(self->key,)1114
2476 y(zmq_msg_data)e(\(&self->frame)h([FRAME_KEY]\),)g(size\);)934
2574 y(self->key)h([size])f(=)i(0;)755 2671 y(})755 2768
y(return)f(self->key;)576 2865 y(})576 2962 y(else)755
3059 y(return)g(NULL;)396 3156 y(})396 3351 y(void)396
3448 y(kvmsg_set_key)f(\(kvmsg_t)1427 3461 y(*)1472 3448
y(self,)h(char)1965 3461 y(*)2010 3448 y(key\))396 3545
y({)576 3642 y(assert)f(\(self\);)576 3739 y(zmq_msg_t)1024
3752 y(*)1069 3739 y(msg)h(=)h(&self->frame)e([FRAME_KEY];)576
3836 y(if)h(\(self->present)f([FRAME_KEY]\))755 3933
y(zmq_msg_close)g(\(msg\);)576 4031 y(zmq_msg_init_size)f(\(msg,)i
(strlen)f(\(key\)\);)576 4128 y(memcpy)g(\(zmq_msg_data)g(\(msg\),)h
(key,)g(strlen)g(\(key\)\);)576 4225 y(self->present)e([FRAME_KEY])h(=)
i(1;)396 4322 y(})396 4516 y(void)396 4613 y(kvmsg_fmt_key)e(\(kvmsg_t)
1427 4626 y(*)1472 4613 y(self,)h(char)1965 4626 y(*)2010
4613 y(format,)g(...\))396 4711 y({)576 4808 y(char)g(value)g
([KVMSG_KEY_MAX)e(+)j(1];)576 4905 y(va_list)e(args;)576
5099 y(assert)g(\(self\);)p Black 3759 5569 a Ff(263)p
Black eop end
%%Page: 264 277
TeXDict begin 264 276 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.264) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(va_start)43 b(\(args,)h(format\);)576
170 y(vsnprintf)f(\(value,)h(KVMSG_KEY_MAX,)e(format,)i(args\);)576
267 y(va_end)f(\(args\);)576 364 y(kvmsg_set_key)f(\(self,)i(value\);)
396 461 y(})-2 635 y
SDict begin H.S end
 -2 635 a -2 635 a
SDict begin 13 H.A end
 -2 635 a -2 635
a
SDict begin [/View [/XYZ H.V]/Dest (0:3247) cvn /DEST pdfmark end
 -2 635 a 396 735 a Fk(These)20 b(tw)o(o)h(methods)e(let)i(the)f
(caller)g(get)g(and)g(set)h(the)f(message)g(sequence)f(number:)-2
753 y
SDict begin H.S end
 -2 753 a -2 753 a
SDict begin 13 H.A end
 -2 753 a -2 753 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-5) cvn /DEST pdfmark
end
 -2 753 a 396
936 a Fg(Example)i(5-11.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(sequence)h(methods)-2 1036 y
SDict begin H.S end
 -2
1036 a -2 1036 a
SDict begin 11.7 H.A end
 -2 1036 a -2 1036 a
SDict begin [/View [/XYZ H.V]/Dest (0:3250) cvn /DEST pdfmark end
 -2 1036 a 396 1311
a Fe(int64_t)396 1408 y(kvmsg_sequence)43 b(\(kvmsg_t)1472
1421 y(*)1517 1408 y(self\))396 1505 y({)576 1602 y(assert)g(\(self\);)
576 1699 y(if)h(\(self->present)f([FRAME_SEQ]\))f({)755
1796 y(assert)i(\(zmq_msg_size)e(\(&self->frame)h([FRAME_SEQ]\))g(==)h
(8\);)755 1894 y(byte)979 1907 y(*)1024 1894 y(source)g(=)g
(zmq_msg_data)f(\(&self->frame)g([FRAME_SEQ]\);)755 1991
y(int64_t)h(sequence)f(=)i(\(\(int64_t\))e(\(source)h([0]\))g(<<)g
(56\))1517 2088 y(+)h(\(\(int64_t\))e(\(source)h([1]\))g(<<)g(48\))1517
2185 y(+)h(\(\(int64_t\))e(\(source)h([2]\))g(<<)g(40\))1517
2282 y(+)h(\(\(int64_t\))e(\(source)h([3]\))g(<<)g(32\))1517
2379 y(+)h(\(\(int64_t\))e(\(source)h([4]\))g(<<)g(24\))1517
2476 y(+)h(\(\(int64_t\))e(\(source)h([5]\))g(<<)g(16\))1517
2574 y(+)h(\(\(int64_t\))e(\(source)h([6]\))g(<<)g(8\))1517
2671 y(+)90 b(\(int64_t\))43 b(\(source)h([7]\);)755
2768 y(return)g(sequence;)576 2865 y(})576 2962 y(else)755
3059 y(return)g(0;)396 3156 y(})396 3351 y(void)396 3448
y(kvmsg_set_sequence)e(\(kvmsg_t)1652 3461 y(*)1697 3448
y(self,)h(int64_t)h(sequence\))396 3545 y({)576 3642
y(assert)f(\(self\);)576 3739 y(zmq_msg_t)1024 3752 y(*)1069
3739 y(msg)h(=)h(&self->frame)e([FRAME_SEQ];)576 3836
y(if)h(\(self->present)f([FRAME_SEQ]\))755 3933 y(zmq_msg_close)g
(\(msg\);)576 4031 y(zmq_msg_init_size)f(\(msg,)i(8\);)576
4225 y(byte)800 4238 y(*)845 4225 y(source)f(=)i(zmq_msg_data)e
(\(msg\);)576 4322 y(source)g([0])i(=)f(\(byte\))g(\(\(sequence)f(>>)i
(56\))f(&)h(255\);)576 4419 y(source)e([1])i(=)f(\(byte\))g
(\(\(sequence)f(>>)i(48\))f(&)h(255\);)576 4516 y(source)e([2])i(=)f
(\(byte\))g(\(\(sequence)f(>>)i(40\))f(&)h(255\);)576
4613 y(source)e([3])i(=)f(\(byte\))g(\(\(sequence)f(>>)i(32\))f(&)h
(255\);)576 4711 y(source)e([4])i(=)f(\(byte\))g(\(\(sequence)f(>>)i
(24\))f(&)h(255\);)576 4808 y(source)e([5])i(=)f(\(byte\))g
(\(\(sequence)f(>>)i(16\))f(&)h(255\);)576 4905 y(source)e([6])i(=)f
(\(byte\))g(\(\(sequence)f(>>)i(8\))89 b(&)45 b(255\);)576
5002 y(source)e([7])i(=)f(\(byte\))g(\(\(sequence\))312
b(&)45 b(255\);)p Black 3759 5569 a Ff(264)p Black eop
end
%%Page: 265 278
TeXDict begin 265 277 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.265) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(self->present)42 b([FRAME_SEQ])h(=)i(1;)396
170 y(})-2 344 y
SDict begin H.S end
 -2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:3251) cvn /DEST pdfmark end

-2 344 a 396 444 a Fk(These)20 b(methods)f(let)i(the)f(caller)h(get)f
(and)f(set)i(the)g(message)f(body)-5 b(,)18 b(as)j(a)f(\002x)o(ed)g
(string)g(and)f(as)i(a)g(printf)e(formatted)396 552 y(string:)-2
569 y
SDict begin H.S end
 -2 569 a -2 569 a
SDict begin 13 H.A end
 -2 569 a -2 569 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-6) cvn /DEST pdfmark
end
 -2 569 a 396
753 a Fg(Example)i(5-12.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(message)h(body)f(methods)-2 853
y
SDict begin H.S end
 -2 853 a -2 853 a
SDict begin 11.7 H.A end
 -2 853 a -2 853 a
SDict begin [/View [/XYZ H.V]/Dest (0:3254) cvn /DEST pdfmark end
 -2 853 a 396 1030
a Fe(byte)620 1043 y(*)396 1127 y(kvmsg_body)43 b(\(kvmsg_t)1293
1140 y(*)1338 1127 y(self\))396 1224 y({)576 1322 y(assert)g(\(self\);)
576 1419 y(if)h(\(self->present)f([FRAME_BODY]\))755
1516 y(return)h(\(byte)1338 1529 y(*)1383 1516 y(\))g(zmq_msg_data)f
(\(&self->frame)g([FRAME_BODY]\);)576 1613 y(else)755
1710 y(return)h(NULL;)396 1807 y(})396 2001 y(void)396
2099 y(kvmsg_set_body)f(\(kvmsg_t)1472 2112 y(*)1517
2099 y(self,)h(byte)2010 2112 y(*)2055 2099 y(body,)g(size_t)g(size\))
396 2196 y({)576 2293 y(assert)f(\(self\);)576 2390 y(zmq_msg_t)1024
2403 y(*)1069 2390 y(msg)h(=)h(&self->frame)e([FRAME_BODY];)576
2487 y(if)h(\(self->present)f([FRAME_BODY]\))755 2584
y(zmq_msg_close)g(\(msg\);)576 2681 y(self->present)f([FRAME_BODY])h(=)
i(1;)576 2779 y(zmq_msg_init_size)d(\(msg,)i(size\);)576
2876 y(memcpy)f(\(zmq_msg_data)g(\(msg\),)h(body,)g(size\);)396
2973 y(})396 3167 y(void)396 3264 y(kvmsg_fmt_body)f(\(kvmsg_t)1472
3277 y(*)1517 3264 y(self,)h(char)2010 3277 y(*)2055
3264 y(format,)g(...\))396 3361 y({)576 3459 y(char)g(value)g([255)g(+)
h(1];)576 3556 y(va_list)e(args;)576 3750 y(assert)g(\(self\);)576
3847 y(va_start)g(\(args,)h(format\);)576 3944 y(vsnprintf)f(\(value,)h
(255,)g(format,)f(args\);)576 4041 y(va_end)g(\(args\);)576
4138 y(kvmsg_set_body)f(\(self,)i(\(byte)1831 4151 y(*)1876
4138 y(\))g(value,)g(strlen)g(\(value\)\);)396 4236 y(})-2
4410 y
SDict begin H.S end
 -2 4410 a -2 4410 a
SDict begin 13 H.A end
 -2 4410 a -2 4410 a
SDict begin [/View [/XYZ H.V]/Dest (0:3255) cvn /DEST pdfmark end
 -2 4410
a 396 4510 a Fk(The)20 b(size)h(method)e(returns)g(the)h(body)f(size)i
(of)f(the)g(last-read)g(message,)f(if)i(an)o(y:)-2 4528
y
SDict begin H.S end
 -2 4528 a -2 4528 a
SDict begin 13 H.A end
 -2 4528 a -2 4528 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-7) cvn /DEST pdfmark
end
 -2 4528 a Black
3759 5569 a Ff(265)p Black eop end
%%Page: 266 279
TeXDict begin 266 278 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.266) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-13.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(size)h(method)-2 172 y
SDict begin H.S end
 -2 172 a
-2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3258) cvn /DEST pdfmark end
 -2 172 a 396 447 a Fe(size_t)396
544 y(kvmsg_size)43 b(\(kvmsg_t)1293 557 y(*)1338 544
y(self\))396 641 y({)576 738 y(assert)g(\(self\);)576
835 y(if)h(\(self->present)f([FRAME_BODY]\))755 933 y(return)h
(zmq_msg_size)f(\(&self->frame)f([FRAME_BODY]\);)576
1030 y(else)755 1127 y(return)i(0;)396 1224 y(})-2 1398
y
SDict begin H.S end
 -2 1398 a -2 1398 a
SDict begin 13 H.A end
 -2 1398 a -2 1398 a
SDict begin [/View [/XYZ H.V]/Dest (0:3259) cvn /DEST pdfmark end
 -2 1398 a 396
1498 a Fk(The)20 b(store)g(method)f(stores)h(the)g(k)o(e)o(y-v)n(alue)e
(message)i(into)g(a)g(hash)g(map,)f(unless)h(the)g(k)o(e)o(y)g(and)f(v)
n(alue)h(are)g(both)f(null.)g(It)396 1606 y(nulli\002es)i(the)f(kvmsg)f
(reference)f(so)j(that)f(the)h(object)e(is)i(o)n(wned)e(by)h(the)g
(hash)g(map,)g(not)g(the)g(caller:)-2 1624 y
SDict begin H.S end
 -2 1624
a -2 1624 a
SDict begin 13 H.A end
 -2 1624 a -2 1624 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-8) cvn /DEST pdfmark
end
 -2 1624 a 396 1807 a
Fg(Example)h(5-14.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(stor)o(e)g(method)-2 1907 y
SDict begin H.S end
 -2
1907 a -2 1907 a
SDict begin 11.7 H.A end
 -2 1907 a -2 1907 a
SDict begin [/View [/XYZ H.V]/Dest (0:3262) cvn /DEST pdfmark end
 -2 1907 a 396 2085
a Fe(void)396 2182 y(kvmsg_store)43 b(\(kvmsg_t)1338
2195 y(**)1428 2182 y(self_p,)g(zhash_t)2145 2195 y(*)2190
2182 y(hash\))396 2279 y({)576 2376 y(assert)g(\(self_p\);)576
2473 y(if)h(\()755 2486 y(*)800 2473 y(self_p\))f({)755
2570 y(kvmsg_t)1114 2583 y(*)1159 2570 y(self)h(=)1472
2583 y(*)1517 2570 y(self_p;)755 2667 y(assert)g(\(self\);)755
2764 y(if)g(\(self->present)f([FRAME_KEY])755 2862 y(&&)89
b(self->present)43 b([FRAME_BODY]\))g({)934 2959 y(zhash_update)g
(\(hash,)h(kvmsg_key)f(\(self\),)h(self\);)934 3056 y(zhash_freefn)f
(\(hash,)h(kvmsg_key)f(\(self\),)h(kvmsg_free\);)755
3153 y(})755 3263 y(*)800 3250 y(self_p)g(=)g(NULL;)576
3347 y(})396 3444 y(})-2 3619 y
SDict begin H.S end
 -2 3619 a -2 3619 a
SDict begin 13 H.A end
 -2
3619 a -2 3619 a
SDict begin [/View [/XYZ H.V]/Dest (0:3263) cvn /DEST pdfmark end
 -2 3619 a 396 3718 a Fk(The)20 b(dump)f(method)g
(prints)h(the)g(k)o(e)o(y-v)n(alue)e(message)i(to)g(stderr)m(,)f(for)h
(deb)n(ugging)e(and)h(tracing:)-2 3736 y
SDict begin H.S end
 -2 3736 a -2
3736 a
SDict begin 13 H.A end
 -2 3736 a -2 3736 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-9) cvn /DEST pdfmark
end
 -2 3736 a 396 3920 a Fg(Example)i(5-15.)d(K)
n(ey-v)o(alue)h(message)h(class)h(\(kvsimple.c\))f(-)g(dump)i(method)-2
4020 y
SDict begin H.S end
 -2 4020 a -2 4020 a
SDict begin 11.7 H.A end
 -2 4020 a -2 4020 a
SDict begin [/View [/XYZ H.V]/Dest (0:3266) cvn /DEST pdfmark end
 -2 4020
a 396 4197 a Fe(void)396 4294 y(kvmsg_dump)43 b(\(kvmsg_t)1293
4307 y(*)1338 4294 y(self\))396 4391 y({)576 4488 y(if)h(\(self\))g({)
755 4586 y(if)g(\(!self\))g({)934 4683 y(fprintf)g(\(stderr,)f
("NULL"\);)934 4780 y(return;)755 4877 y(})755 4974 y(size_t)h(size)g
(=)h(kvmsg_size)e(\(self\);)755 5071 y(byte)1024 5084
y(*)1069 5071 y(body)h(=)h(kvmsg_body)e(\(self\);)755
5168 y(fprintf)h(\(stderr,)f("[seq:\045")h(PRId64)f("]",)i
(kvmsg_sequence)d(\(self\)\);)p Black 3757 5569 a Ff(266)p
Black eop end
%%Page: 267 280
TeXDict begin 267 279 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.267) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(fprintf)44 b(\(stderr,)f("[key:\045s]",)g(kvmsg_key)g
(\(self\)\);)755 170 y(fprintf)h(\(stderr,)f("[size:\045zd])g(",)i
(size\);)755 267 y(int)f(char_nbr;)755 364 y(for)g(\(char_nbr)g(=)g(0;)
h(char_nbr)e(<)i(size;)f(char_nbr++\))934 461 y(fprintf)g(\(stderr,)f
("\04502X",)h(body)g([char_nbr]\);)755 558 y(fprintf)g(\(stderr,)f
("\\n"\);)576 655 y(})576 752 y(else)755 850 y(fprintf)h(\(stderr,)f
("NULL)h(message\\n"\);)396 947 y(})-2 1121 y
SDict begin H.S end
 -2 1121
a -2 1121 a
SDict begin 13 H.A end
 -2 1121 a -2 1121 a
SDict begin [/View [/XYZ H.V]/Dest (0:3267) cvn /DEST pdfmark end
 -2 1121 a 396 1221 a
Fk(It')-5 b(s)21 b(good)e(practice)g(to)i(ha)n(v)o(e)e(a)i(self-test)g
(method)d(that)j(tests)g(the)f(class;)h(this)g(also)g(sho)n(ws)f(ho)n
(w)g(it')-5 b(s)21 b(used)f(in)396 1329 y(applications:)-2
1347 y
SDict begin H.S end
 -2 1347 a -2 1347 a
SDict begin 13 H.A end
 -2 1347 a -2 1347 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvsimple-c-10) cvn /DEST pdfmark
end
 -2 1347
a 396 1530 a Fg(Example)h(5-16.)d(K)n(ey-v)o(alue)h(message)h(class)h
(\(kvsimple.c\))f(-)g(test)h(method)-2 1630 y
SDict begin H.S end
 -2 1630
a -2 1630 a
SDict begin 11.7 H.A end
 -2 1630 a -2 1630 a
SDict begin [/View [/XYZ H.V]/Dest (0:3270) cvn /DEST pdfmark end
 -2 1630 a 396 1807 a
Fe(int)396 1904 y(kvmsg_test)43 b(\(int)i(verbose\))396
2001 y({)576 2099 y(kvmsg_t)755 2209 y(*)800 2196 y(kvmsg;)576
2390 y(printf)e(\(")1024 2403 y(*)1114 2390 y(kvmsg:)g("\);)576
2584 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(sockets)576
2681 y(zctx_t)889 2694 y(*)934 2681 y(ctx)h(=)f(zctx_new)g(\(\);)576
2779 y(void)800 2792 y(*)845 2779 y(output)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_DEALER\);)576 2876 y(int)g(rc)g(=)h(zmq_bind)f(\(output,)f
("ipc://kvmsg_selftest.ipc"\);)576 2973 y(assert)g(\(rc)i(==)f(0\);)576
3070 y(void)800 3083 y(*)845 3070 y(input)g(=)g(zsocket_new)f(\(ctx,)h
(ZMQ_DEALER\);)576 3167 y(rc)g(=)h(zmq_connect)e(\(input,)g
("ipc://kvmsg_selftest.ipc"\);)576 3264 y(assert)g(\(rc)i(==)f(0\);)576
3459 y(zhash_t)934 3472 y(*)979 3459 y(kvmap)g(=)h(zhash_new)e(\(\);)
576 3653 y(//)89 b(Test)44 b(send)g(and)h(receive)e(of)i(simple)f
(message)576 3750 y(kvmsg)g(=)g(kvmsg_new)g(\(1\);)576
3847 y(kvmsg_set_key)87 b(\(kvmsg,)44 b("key"\);)576
3944 y(kvmsg_set_body)e(\(kvmsg,)i(\(byte)1876 3957 y(*)1921
3944 y(\))g("body",)g(4\);)576 4041 y(if)g(\(verbose\))755
4138 y(kvmsg_dump)f(\(kvmsg\);)576 4236 y(kvmsg_send)g(\(kvmsg,)g
(output\);)576 4333 y(kvmsg_store)g(\(&kvmsg,)g(kvmap\);)576
4527 y(kvmsg)h(=)g(kvmsg_recv)f(\(input\);)576 4624 y(if)h(\(verbose\))
755 4721 y(kvmsg_dump)f(\(kvmsg\);)576 4818 y(assert)g(\(streq)h
(\(kvmsg_key)f(\(kvmsg\),)h("key"\)\);)576 4916 y(kvmsg_store)f
(\(&kvmsg,)g(kvmap\);)576 5110 y(//)89 b(Shutdown)43
b(and)i(destroy)e(all)i(objects)p Black 3756 5569 a Ff(267)p
Black eop end
%%Page: 268 281
TeXDict begin 268 280 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.268) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(zhash_destroy)42 b(\(&kvmap\);)576
170 y(zctx_destroy)g(\(&ctx\);)576 364 y(printf)h(\("OK\\n"\);)576
461 y(return)g(0;)396 558 y(})-2 732 y
SDict begin H.S end
 -2 732 a -2 732
a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:3271) cvn /DEST pdfmark end
 -2 732 a 396 832 a Fk(W)-7 b(e')o(ll)22
b(mak)o(e)d(a)i(more)e(sophisticated)h(kvmsg)f(class)i(later)m(,)f(for)
f(using)h(in)g(real)g(applications.)-2 1016 y
SDict begin H.S end
 -2 1016
a -2 1016 a
SDict begin 13 H.A end
 -2 1016 a -2 1016 a
SDict begin [/View [/XYZ H.V]/Dest (0:3272) cvn /DEST pdfmark end
 -2 1016 a 396 1106 a
Fk(Both)g(the)h(serv)o(er)e(and)h(client)g(maintain)f(hash)h(tables,)g
(b)n(ut)h(this)f(\002rst)h(model)f(only)f(w)o(orks)h(properly)e(if)i
(we)h(start)g(all)396 1214 y(clients)g(before)e(the)h(serv)o(er)m(,)f
(and)g(the)h(clients)h(ne)n(v)o(er)e(crash.)g(That')-5
b(s)21 b(not)f(')l(reliability'.)-2 1242 y
SDict begin H.S end
 -2 1242 a
-2 1242 a
SDict begin 13 H.A end
 -2 1242 a -2 1242 a
SDict begin [/View [/XYZ H.V]/Dest (0:3273) cvn /DEST pdfmark end
 -2 1242 a 396 1553 a Fb(5.3.2.)36
b(Getting)d(a)h(Snapshot)1824 1553 y
SDict begin H.S end
 1824 1553 a 1824
1553 a
SDict begin 18.72 H.A end
 1824 1553 a 1824 1553 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.22.2) cvn /DEST pdfmark end
 1824 1553 a -2 1745 a
SDict begin H.S end

-2 1745 a -2 1745 a
SDict begin 13 H.A end
 -2 1745 a -2 1745 a
SDict begin [/View [/XYZ H.V]/Dest (0:3275) cvn /DEST pdfmark end
 -2 1745 a 396
1826 a Fk(In)20 b(order)f(to)h(allo)n(w)h(a)f(late)h(\(or)e(reco)o(v)o
(ering\))e(client)k(to)f(catch)g(up)g(with)g(a)h(serv)o(er)e(it)i(has)f
(to)h(get)f(a)g(snapshot)g(of)g(the)396 1934 y(serv)o(er')-5
b(s)20 b(state.)h(Just)g(as)g(we')l(v)o(e)e(reduced)f("message")i(to)g
(mean)g("a)g(sequenced)f(k)o(e)o(y-v)n(alue)f(pair",)h(we)i(can)f
(reduce)396 2042 y("state")h(to)f(mean)g("a)g(hash)g(table".)g(T)-7
b(o)20 b(get)h(the)f(serv)o(er)f(state,)i(a)f(client)h(opens)e(a)i
(DEALER)f(sock)o(et)g(and)g(asks)g(for)g(it)396 2150
y(e)o(xplicitly\()p 0 TeXcolorgray 738 2150 a
SDict begin H.S end
 738 2150
a Fk(Figure)e(5-4)1086 2150 y
SDict begin 13 H.L end
 1086 2150 a 1086 2150 a
SDict begin [/Subtype /Link/Dest (0:figure-66) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

1086 2150 a Black -1 w Fk(\).)-2 2168 y
SDict begin H.S end
 -2 2168 a -2
2168 a
SDict begin 13 H.A end
 -2 2168 a -2 2168 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-66) cvn /DEST pdfmark
end
 -2 2168 a 396 2352 a Fg(Figur)o(e)i(5-4.)f
(State)g(Replication)-2 2451 y
SDict begin H.S end
 -2 2451 a -2 2451 a
SDict begin 13 H.A end
 -2
2451 a -2 2451 a
SDict begin [/View [/XYZ H.V]/Dest (0:3279) cvn /DEST pdfmark end
 -2 2451 a 396 4010 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4010 a @beginspecial
0 @llx -182 @lly 305 @urx 0 @ury 3050 @rwi @setspecial
%%BeginDocument: images/fig66.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -182 305 0
%%HiResBoundingBox: 0.0 -182.0 305.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
103.50015258789062 -18.500150680541992 moveto
103.50015258789062 -46.50014877319336 lineto
193.50015258789062 -46.50014877319336 lineto
193.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
103.50015258789062 -46.50014877319336 moveto
103.50015258789062 -57.50014877319336 lineto
103.50015258789062 -59.50014877319336 104.50015258789062 -60.50014877319336 106.50015258789062 -60.50014877319336 curveto
147.50015258789062 -60.50014877319336 lineto
147.50015258789062 -60.50014877319336 lineto
147.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.50015258789062 -46.50014877319336 moveto
149.50015258789062 -60.50014877319336 lineto
191.50015258789062 -60.50014877319336 lineto
192.83348592122397 -60.50014877319336 193.50015258789062 -59.50014877319336 193.50015258789062 -57.50014877319336 curveto
193.50015258789062 -46.50014877319336 lineto
193.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
216.50015258789062 -123.50015258789062 moveto
214.50015258789062 -123.50015258789062 213.50015258789062 -124.83348592122395 213.50015258789062 -127.50015258789062 curveto
213.50015258789062 -137.50015258789062 lineto
247.50015258789062 -137.50015258789062 lineto
247.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
249.50015258789062 -123.50015258789062 moveto
249.50015258789062 -137.50015258789062 lineto
293.5001525878906 -137.50015258789062 lineto
293.5001525878906 -127.50015258789062 lineto
293.5001525878906 -124.83348592122395 292.83348592122394 -123.50015258789062 291.5001525878906 -123.50015258789062 curveto
249.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
213.50015258789062 -137.50015258789062 moveto
213.50015258789062 -165.50015258789062 lineto
293.5001525878906 -165.50015258789062 lineto
293.5001525878906 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -123.50015258789062 moveto
14.500150044759115 -123.50015258789062 13.500149726867676 -124.83348592122395 13.500149726867676 -127.50015258789062 curveto
13.500149726867676 -164.50015258789062 lineto
93.50015258789062 -164.50015258789062 lineto
93.50015258789062 -127.50015258789062 lineto
93.50015258789062 -124.83348592122395 92.83348592122395 -123.50015258789062 91.50015258789062 -123.50015258789062 curveto
16.500150680541992 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -123.50015258789062 moveto
14.500150044759115 -123.50015258789062 13.500149726867676 -124.83348592122395 13.500149726867676 -127.50015258789062 curveto
13.500149726867676 -137.50015258789062 lineto
47.50014877319336 -137.50015258789062 lineto
47.50014877319336 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
49.50014877319336 -123.50015258789062 moveto
49.50014877319336 -137.50015258789062 lineto
93.50015258789062 -137.50015258789062 lineto
93.50015258789062 -127.50015258789062 lineto
93.50015258789062 -124.83348592122395 92.83348592122395 -123.50015258789062 91.50015258789062 -123.50015258789062 curveto
49.50014877319336 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -137.50015258789062 moveto
13.500149726867676 -164.50015258789062 lineto
93.50015258789062 -164.50015258789062 lineto
93.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
116.50015258789062 -123.50015258789062 moveto
114.50015258789062 -123.50015258789062 113.50015258789062 -124.83348592122395 113.50015258789062 -127.50015258789062 curveto
113.50015258789062 -164.50015258789062 lineto
193.50015258789062 -164.50015258789062 lineto
193.50015258789062 -127.50015258789062 lineto
193.50015258789062 -124.83348592122395 192.83348592122397 -123.50015258789062 191.50015258789062 -123.50015258789062 curveto
116.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
116.50015258789062 -123.50015258789062 moveto
114.50015258789062 -123.50015258789062 113.50015258789062 -124.83348592122395 113.50015258789062 -127.50015258789062 curveto
113.50015258789062 -137.50015258789062 lineto
147.50015258789062 -137.50015258789062 lineto
147.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
149.50015258789062 -123.50015258789062 moveto
149.50015258789062 -137.50015258789062 lineto
193.50015258789062 -137.50015258789062 lineto
193.50015258789062 -127.50015258789062 lineto
193.50015258789062 -124.83348592122395 192.83348592122397 -123.50015258789062 191.50015258789062 -123.50015258789062 curveto
149.50015258789062 -123.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
113.50015258789062 -137.50015258789062 moveto
113.50015258789062 -164.50015258789062 lineto
193.50015258789062 -164.50015258789062 lineto
193.50015258789062 -137.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
102.0 -17.0 moveto
102.0 -45.0 lineto
192.0 -45.0 lineto
192.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
102.0 -17.0 moveto
102.0 -45.0 lineto
192.0 -45.0 lineto
192.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
102.0 -45.0 moveto
102.0 -56.0 lineto
102.0 -58.0 103.0 -59.0 105.0 -59.0 curveto
146.0 -59.0 lineto
146.0 -59.0 lineto
146.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
102.0 -45.0 moveto
102.0 -56.0 lineto
102.0 -58.0 103.0 -59.0 105.0 -59.0 curveto
146.0 -59.0 lineto
146.0 -59.0 lineto
146.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -45.0 moveto
148.0 -59.0 lineto
190.0 -59.0 lineto
191.33333333333334 -59.0 192.0 -58.0 192.0 -56.0 curveto
192.0 -45.0 lineto
192.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -45.0 moveto
148.0 -59.0 lineto
190.0 -59.0 lineto
191.33333333333334 -59.0 192.0 -58.0 192.0 -56.0 curveto
192.0 -45.0 lineto
192.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
215.0 -122.0 moveto
213.0 -122.0 212.0 -123.33333333333333 212.0 -126.0 curveto
212.0 -136.0 lineto
246.0 -136.0 lineto
246.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
215.0 -122.0 moveto
213.0 -122.0 212.0 -123.33333333333333 212.0 -126.0 curveto
212.0 -136.0 lineto
246.0 -136.0 lineto
246.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
248.0 -122.0 moveto
248.0 -136.0 lineto
292.0 -136.0 lineto
292.0 -126.0 lineto
292.0 -123.33333333333333 291.3333333333333 -122.0 290.0 -122.0 curveto
248.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
248.0 -122.0 moveto
248.0 -136.0 lineto
292.0 -136.0 lineto
292.0 -126.0 lineto
292.0 -123.33333333333333 291.3333333333333 -122.0 290.0 -122.0 curveto
248.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
212.0 -136.0 moveto
212.0 -164.0 lineto
292.0 -164.0 lineto
292.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
212.0 -136.0 moveto
212.0 -164.0 lineto
292.0 -164.0 lineto
292.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -163.0 lineto
92.0 -163.0 lineto
92.0 -126.0 lineto
92.0 -123.33333333333333 91.33333333333333 -122.0 90.0 -122.0 curveto
15.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -163.0 lineto
92.0 -163.0 lineto
92.0 -126.0 lineto
92.0 -123.33333333333333 91.33333333333333 -122.0 90.0 -122.0 curveto
15.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -136.0 lineto
46.0 -136.0 lineto
46.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -122.0 moveto
13.0 -122.0 12.0 -123.33333333333333 12.0 -126.0 curveto
12.0 -136.0 lineto
46.0 -136.0 lineto
46.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
48.0 -122.0 moveto
48.0 -136.0 lineto
92.0 -136.0 lineto
92.0 -126.0 lineto
92.0 -123.33333333333333 91.33333333333333 -122.0 90.0 -122.0 curveto
48.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
48.0 -122.0 moveto
48.0 -136.0 lineto
92.0 -136.0 lineto
92.0 -126.0 lineto
92.0 -123.33333333333333 91.33333333333333 -122.0 90.0 -122.0 curveto
48.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -136.0 moveto
12.0 -163.0 lineto
92.0 -163.0 lineto
92.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -136.0 moveto
12.0 -163.0 lineto
92.0 -163.0 lineto
92.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -122.0 moveto
113.0 -122.0 112.0 -123.33333333333333 112.0 -126.0 curveto
112.0 -163.0 lineto
192.0 -163.0 lineto
192.0 -126.0 lineto
192.0 -123.33333333333333 191.33333333333334 -122.0 190.0 -122.0 curveto
115.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -122.0 moveto
113.0 -122.0 112.0 -123.33333333333333 112.0 -126.0 curveto
112.0 -163.0 lineto
192.0 -163.0 lineto
192.0 -126.0 lineto
192.0 -123.33333333333333 191.33333333333334 -122.0 190.0 -122.0 curveto
115.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
115.0 -122.0 moveto
113.0 -122.0 112.0 -123.33333333333333 112.0 -126.0 curveto
112.0 -136.0 lineto
146.0 -136.0 lineto
146.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
115.0 -122.0 moveto
113.0 -122.0 112.0 -123.33333333333333 112.0 -126.0 curveto
112.0 -136.0 lineto
146.0 -136.0 lineto
146.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
148.0 -122.0 moveto
148.0 -136.0 lineto
192.0 -136.0 lineto
192.0 -126.0 lineto
192.0 -123.33333333333333 191.33333333333334 -122.0 190.0 -122.0 curveto
148.0 -122.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
148.0 -122.0 moveto
148.0 -136.0 lineto
192.0 -136.0 lineto
192.0 -126.0 lineto
192.0 -123.33333333333333 191.33333333333334 -122.0 190.0 -122.0 curveto
148.0 -122.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
112.0 -136.0 moveto
112.0 -163.0 lineto
192.0 -163.0 lineto
192.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
112.0 -136.0 moveto
112.0 -163.0 lineto
192.0 -163.0 lineto
192.0 -136.0 lineto
closepath
stroke
newpath
167.0 -66.0 moveto
167.0 -80.0 lineto
265.0 -80.0 lineto
266.3333333333333 -80.0 267.0 -81.33333333333333 267.0 -84.0 curveto
267.0 -122.0 lineto
267.0 -122.0 lineto
stroke
newpath
167.0 -63.0 moveto
165.0 -70.0 lineto
170.0 -70.0 lineto
closepath
fill
newpath
30.0 -112.0 moveto
32.0 -119.0 lineto
35.0 -112.0 lineto
closepath
fill
newpath
125.0 -112.0 moveto
127.0 -119.0 lineto
130.0 -112.0 lineto
closepath
fill
newpath
225.0 -112.0 moveto
227.0 -119.0 lineto
230.0 -112.0 lineto
closepath
fill
newpath
127.0 -59.0 moveto
127.0 -94.0 lineto
stroke
newpath
32.0 -115.0 moveto
32.0 -98.0 lineto
32.0 -95.33333333333333 33.0 -94.0 35.0 -94.0 curveto
127.0 -94.0 lineto
127.0 -94.0 lineto
stroke
newpath
127.0 -115.0 moveto
127.0 -94.0 lineto
stroke
newpath
227.0 -115.0 moveto
227.0 -98.0 lineto
227.0 -95.33333333333333 226.33333333333334 -94.0 225.0 -94.0 curveto
127.0 -94.0 lineto
127.0 -94.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
132.0 -35.0 moveto
(Server) show
120.0 -55.0 moveto
(PUB) show
156.0 -55.0 moveto
(ROUTER) show
181.0 -77.0 moveto
(state request) show
111.0 -84.0 moveto
(updates) show
20.0 -132.0 moveto
(SUB) show
55.0 -133.0 moveto
(DEALER) show
120.0 -132.0 moveto
(SUB) show
155.0 -133.0 moveto
(DEALER) show
220.0 -132.0 moveto
(SUB) show
255.0 -133.0 moveto
(DEALER) show
39.0 -154.0 moveto
(Client) show
139.0 -154.0 moveto
(Client) show
239.0 -154.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4010 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4010 a -2 4176 a
SDict begin H.S end
 -2 4176
a -2 4176 a
SDict begin 13 H.A end
 -2 4176 a -2 4176 a
SDict begin [/View [/XYZ H.V]/Dest (0:3282) cvn /DEST pdfmark end
 -2 4176 a 396 4284 a
Fk(T)-7 b(o)20 b(mak)o(e)f(this)h(w)o(ork,)e(we)i(ha)n(v)o(e)f(to)h
(solv)o(e)f(the)g(timing)g(problem.)f(Getting)h(a)h(state)g(snapshot)e
(will)j(tak)o(e)e(a)h(certain)f(time,)396 4392 y(possibly)h(f)o(airly)g
(long)f(if)h(the)h(snapshot)e(is)i(lar)o(ge.)e(W)-7 b(e)21
b(need)f(to)g(correctly)f(apply)g(updates)h(to)g(the)g(snapshot.)f(But)
i(the)396 4499 y(serv)o(er)f(w)o(on')o(t)f(kno)n(w)g(when)g(to)i(start)
g(sending)e(us)h(updates.)f(One)h(w)o(ay)h(w)o(ould)e(be)h(to)h(start)f
(subscribing,)f(get)h(a)g(\002rst)396 4607 y(update,)f(and)h(then)f
(ask)i(for)e("state)i(for)f(update)f(N".)h(This)g(w)o(ould)g(require)f
(the)h(serv)o(er)f(storing)h(one)f(snapshot)h(for)f(each)396
4715 y(update,)g(which)h(isn')o(t)g(practical.)-2 4899
y
SDict begin H.S end
 -2 4899 a -2 4899 a
SDict begin 13 H.A end
 -2 4899 a -2 4899 a
SDict begin [/View [/XYZ H.V]/Dest (0:3283) cvn /DEST pdfmark end
 -2 4899 a 396
4989 a Fk(So)h(we)f(will)h(do)f(the)g(synchronization)d(in)k(the)f
(client,)g(as)h(follo)n(ws:)-2 5007 y
SDict begin H.S end
 -2 5007 a -2 5007
a
SDict begin 13 H.A end
 -2 5007 a -2 5007 a
SDict begin [/View [/XYZ H.V]/Dest (0:3284) cvn /DEST pdfmark end
 -2 5007 a -2 5017 a
SDict begin H.S end
 -2 5017 a -2
5017 a
SDict begin 13 H.A end
 -2 5017 a -2 5017 a
SDict begin [/View [/XYZ H.V]/Dest (0:3285) cvn /DEST pdfmark end
 -2 5017 a Black 3759 5569
a Ff(268)p Black eop end
%%Page: 269 282
TeXDict begin 269 281 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.269) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3286) cvn /DEST pdfmark end
 479 72 a Fk(The)i(client)g(\002rst)h
(subscribes)f(to)g(updates)g(and)f(then)h(mak)o(es)g(a)h(state)g
(request.)e(This)h(guarantees)f(that)h(the)g(state)h(is)479
180 y(going)e(to)i(be)f(ne)n(wer)f(than)h(the)g(oldest)g(update)f(it)i
(has.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:3287) cvn /DEST pdfmark end
 -2
198 a Black 396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330
a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:3288) cvn /DEST pdfmark end
 479 330 a Fk(The)f(client)g(w)o(aits)i
(for)d(the)h(serv)o(er)g(to)g(reply)f(with)i(state,)f(and)g(meanwhile)f
(queues)g(all)i(updates.)e(It)i(does)f(this)479 438 y(simply)f(by)f
(not)g(reading)f(them:)h(\330MQ)h(k)o(eeps)g(them)f(queued)f(on)h(the)h
(sock)o(et)f(queue,)f(since)i(we)g(don')o(t)e(set)i(a)g(HWM.)-2
456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456 a -2 456 a
SDict begin [/View [/XYZ H.V]/Dest (0:3289) cvn /DEST pdfmark end
 -2 456 a Black
396 587 a Fj(\225)p Black 479 587 a
SDict begin H.S end
 479 587 a 479 587
a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:3290) cvn /DEST pdfmark end
 479 587 a Fk(When)h(the)h(client)f(recei)n(v)o
(es)f(its)i(state)g(update,)e(it)i(be)o(gins)e(once)h(again)f(to)h
(read)g(updates.)f(Ho)n(we)n(v)o(er)g(it)i(discards)e(an)o(y)479
695 y(updates)h(that)g(are)g(older)f(than)h(the)g(state)h(update.)d(So)
j(if)f(the)g(state)h(update)e(includes)g(updates)h(up)f(to)i(200,)e
(the)h(client)479 803 y(will)h(discard)f(updates)f(up)h(to)g(201.)-2
821 y
SDict begin H.S end
 -2 821 a -2 821 a
SDict begin 13 H.A end
 -2 821 a -2 821 a
SDict begin [/View [/XYZ H.V]/Dest (0:3291) cvn /DEST pdfmark end
 -2 821 a Black
396 953 a Fj(\225)p Black 479 953 a
SDict begin H.S end
 479 953 a 479 953
a
SDict begin 13 H.A end
 479 953 a 479 953 a
SDict begin [/View [/XYZ H.V]/Dest (0:3292) cvn /DEST pdfmark end
 479 953 a Fk(The)g(client)g(then)g(applies)g
(updates)f(to)i(its)g(o)n(wn)f(state)h(snapshot.)-2 1137
y
SDict begin H.S end
 -2 1137 a -2 1137 a
SDict begin 13 H.A end
 -2 1137 a -2 1137 a
SDict begin [/View [/XYZ H.V]/Dest (0:3293) cvn /DEST pdfmark end
 -2 1137 a 396
1226 a Fk(It')-5 b(s)21 b(a)g(simple)f(model)f(that)i(e)o(xploits)e
(\330MQ')-5 b(s)21 b(o)n(wn)e(internal)h(queues.)f(Here')-5
b(s)20 b(the)g(serv)o(er:)-2 1244 y
SDict begin H.S end
 -2 1244 a -2 1244
a
SDict begin 13 H.A end
 -2 1244 a -2 1244 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv2-c) cvn /DEST pdfmark
end
 -2 1244 a 396 1428 a Fg(Example)h(5-17.)d(Clone)j
(ser)o(v)o(er)-8 b(,)20 b(Model)h(T)-6 b(w)o(o)20 b(\(clonesr)o(v2.c\))
-2 1528 y
SDict begin H.S end
 -2 1528 a -2 1528 a
SDict begin 11.7 H.A end
 -2 1528 a -2 1528 a
SDict begin [/View [/XYZ H.V]/Dest (0:3296) cvn /DEST pdfmark end
 -2
1528 a 396 1608 a Fe(//)396 1705 y(//)90 b(Clone)44 b(server)f(Model)h
(Two)396 1802 y(//)396 1997 y(//)90 b(Lets)44 b(us)g(build)g(this)g
(source)g(without)g(creating)f(a)i(library)396 2094 y(#include)f
("kvsimple.c")396 2288 y(static)g(int)g(s_send_single)f(\(const)h(char)
2055 2301 y(*)2100 2288 y(key,)g(void)2548 2301 y(*)2593
2288 y(data,)g(void)3086 2301 y(*)3131 2288 y(args\);)396
2385 y(static)g(void)g(state_manager)f(\(void)1831 2398
y(*)1876 2385 y(args,)h(zctx_t)2459 2398 y(*)2504 2385
y(ctx,)g(void)2952 2398 y(*)2997 2385 y(pipe\);)396 2579
y(int)h(main)f(\(void\))396 2676 y({)576 2774 y(//)89
b(Prepare)44 b(our)g(context)g(and)g(sockets)576 2871
y(zctx_t)889 2884 y(*)934 2871 y(ctx)h(=)f(zctx_new)g(\(\);)576
2968 y(void)800 2981 y(*)845 2968 y(publisher)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_PUB\);)576 3065 y(zsocket_bind)e(\(publisher,)h("tcp://)
2011 3078 y(*)2056 3065 y(:5557"\);)576 3259 y(int64_t)g(sequence)h(=)g
(0;)576 3356 y(srandom)f(\(\(unsigned\))g(time)h(\(NULL\)\);)576
3551 y(//)89 b(Start)44 b(state)g(manager)g(and)g(wait)g(for)g
(synchronization)f(signal)576 3648 y(void)800 3661 y(*)845
3648 y(updates)g(=)i(zthread_fork)e(\(ctx,)h(state_manager,)e(NULL\);)
576 3745 y(free)i(\(zstr_recv)f(\(updates\)\);)576 3939
y(while)h(\(!zctx_interrupted\))d({)755 4036 y(//)89
b(Distribute)43 b(as)i(key-value)e(message)755 4133 y(kvmsg_t)1114
4146 y(*)1159 4133 y(kvmsg)g(=)i(kvmsg_new)e(\(++sequence\);)755
4231 y(kvmsg_fmt_key)87 b(\(kvmsg,)44 b("\045d",)g(randof)g
(\(10000\)\);)755 4328 y(kvmsg_fmt_body)e(\(kvmsg,)i("\045d",)g(randof)
g(\(1000000\)\);)755 4425 y(kvmsg_send)222 b(\(kvmsg,)44
b(publisher\);)755 4522 y(kvmsg_send)222 b(\(kvmsg,)44
b(updates\);)755 4619 y(kvmsg_destroy)f(\(&kvmsg\);)576
4716 y(})576 4813 y(printf)g(\(")i(Interrupted\\n\045d)d(messages)i
(out\\n",)f(\(int\))h(sequence\);)576 4911 y(zctx_destroy)e(\(&ctx\);)
576 5008 y(return)h(0;)396 5105 y(})p Black 3759 5569
a Ff(269)p Black eop end
%%Page: 270 283
TeXDict begin 270 282 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.270) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 170 a Fe(//)90 b(Routing)43 b(information)g(for)i(a)f
(key-value)g(snapshot)396 267 y(typedef)g(struct)g({)576
364 y(void)800 377 y(*)845 364 y(socket;)492 b(//)89
b(ROUTER)44 b(socket)g(to)g(send)g(to)576 461 y(zframe_t)979
474 y(*)1024 461 y(identity;)223 b(//)89 b(Identity)43
b(of)i(peer)f(who)g(requested)g(state)396 558 y(})h(kvroute_t;)396
752 y(//)90 b(Send)44 b(one)g(state)g(snapshot)g(key-value)f(pair)h(to)
h(a)f(socket)396 850 y(//)90 b(Hash)44 b(item)g(data)g(is)h(our)f
(kvmsg)g(object,)g(ready)g(to)g(send)396 947 y(static)g(int)396
1044 y(s_send_single)f(\(const)h(char)1562 1057 y(*)1607
1044 y(key,)g(void)2055 1057 y(*)2100 1044 y(data,)g(void)2593
1057 y(*)2638 1044 y(args\))396 1141 y({)576 1238 y(kvroute_t)1024
1251 y(*)1069 1238 y(kvroute)f(=)i(\(kvroute_t)2010 1251
y(*)2055 1238 y(\))g(args;)576 1335 y(//)89 b(Send)44
b(identity)g(of)g(recipient)f(first)576 1432 y(zframe_send)g
(\(&kvroute->identity,)755 1530 y(kvroute->socket,)f(ZFRAME_MORE)h(+)i
(ZFRAME_REUSE\);)576 1627 y(kvmsg_t)934 1640 y(*)979
1627 y(kvmsg)f(=)h(\(kvmsg_t)1741 1640 y(*)1786 1627
y(\))g(data;)576 1724 y(kvmsg_send)e(\(kvmsg,)g(kvroute->socket\);)576
1821 y(return)g(0;)396 1918 y(})-2 2092 y
SDict begin H.S end
 -2 2092 a -2
2092 a
SDict begin 13 H.A end
 -2 2092 a -2 2092 a
SDict begin [/View [/XYZ H.V]/Dest (0:3297) cvn /DEST pdfmark end
 -2 2092 a 396 2192 a Fk(The)20
b(state)h(manager)e(task)h(maintains)g(the)g(state)h(and)f(handles)f
(requests)h(from)f(clients)h(for)g(snapshots:)-2 2210
y
SDict begin H.S end
 -2 2210 a -2 2210 a
SDict begin 13 H.A end
 -2 2210 a -2 2210 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv2-c-1) cvn /DEST pdfmark
end
 -2 2210 a 396
2393 a Fg(Example)h(5-18.)d(Clone)j(ser)o(v)o(er)-8 b(,)20
b(Model)h(T)-6 b(w)o(o)20 b(\(clonesr)o(v2.c\))f(-)h(state)g(manager)-2
2493 y
SDict begin H.S end
 -2 2493 a -2 2493 a
SDict begin 11.7 H.A end
 -2 2493 a -2 2493 a
SDict begin [/View [/XYZ H.V]/Dest (0:3300) cvn /DEST pdfmark end
 -2 2493
a 396 2671 a Fe(static)44 b(void)396 2768 y(state_manager)f(\(void)1293
2781 y(*)1338 2768 y(args,)h(zctx_t)1921 2781 y(*)1966
2768 y(ctx,)g(void)2414 2781 y(*)2459 2768 y(pipe\))396
2865 y({)576 2962 y(zhash_t)934 2975 y(*)979 2962 y(kvmap)g(=)h
(zhash_new)e(\(\);)576 3156 y(zstr_send)g(\(pipe,)h("READY"\);)576
3253 y(void)800 3266 y(*)845 3253 y(snapshot)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_ROUTER\);)576 3351 y(zsocket_bind)e(\(snapshot,)i
("tcp://)1967 3364 y(*)2012 3351 y(:5556"\);)576 3545
y(zmq_pollitem_t)e(items)i([])h(=)f({)755 3642 y({)h(pipe,)f(0,)g
(ZMQ_POLLIN,)f(0)i(},)755 3739 y({)g(snapshot,)e(0,)h(ZMQ_POLLIN,)f(0)i
(})576 3836 y(};)576 3933 y(int64_t)e(sequence)h(=)g(0;)314
b(//)89 b(Current)44 b(snapshot)f(version)h(number)576
4031 y(while)g(\(!zctx_interrupted\))d({)755 4128 y(int)j(rc)h(=)f
(zmq_poll)g(\(items,)g(2,)g(-1\);)755 4225 y(if)g(\(rc)h(==)f(-1)h(&&)f
(errno)g(==)h(ETERM\))934 4322 y(break;)627 b(//)89 b(Context)44
b(has)g(been)g(shut)h(down)755 4516 y(//)89 b(Apply)44
b(state)g(update)g(from)g(main)g(thread)755 4613 y(if)g(\(items)g
([0].revents)f(&)i(ZMQ_POLLIN\))e({)934 4711 y(kvmsg_t)1293
4724 y(*)1338 4711 y(kvmsg)h(=)g(kvmsg_recv)g(\(pipe\);)934
4808 y(if)h(\(!kvmsg\))1114 4905 y(break;)447 b(//)89
b(Interrupted)934 5002 y(sequence)44 b(=)g(kvmsg_sequence)f(\(kvmsg\);)
934 5099 y(kvmsg_store)g(\(&kvmsg,)h(kvmap\);)p Black
3759 5569 a Ff(270)p Black eop end
%%Page: 271 284
TeXDict begin 271 283 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.271) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(})755 170 y(//)89 b(Execute)44 b(state)g(snapshot)f
(request)755 267 y(if)h(\(items)g([1].revents)f(&)i(ZMQ_POLLIN\))e({)
934 364 y(zframe_t)1338 377 y(*)1383 364 y(identity)g(=)i(zframe_recv)e
(\(snapshot\);)934 461 y(if)i(\(!identity\))1114 558
y(break;)447 b(//)89 b(Interrupted)934 752 y(//)h(Request)43
b(is)i(in)f(second)g(frame)g(of)h(message)934 850 y(char)1158
863 y(*)1203 850 y(request)f(=)h(zstr_recv)e(\(snapshot\);)934
947 y(if)i(\(streq)f(\(request,)f("ICANHAZ?"\)\))1114
1044 y(free)h(\(request\);)934 1141 y(else)g({)1114 1238
y(printf)f(\("E:)i(bad)f(request,)f(aborting\\n"\);)1114
1335 y(break;)934 1432 y(})934 1530 y(//)90 b(Send)44
b(state)g(snapshot)f(to)i(client)934 1627 y(kvroute_t)f(routing)f(=)i
({)g(snapshot,)e(identity)g(};)934 1821 y(//)90 b(For)44
b(each)g(entry)g(in)h(kvmap,)e(send)i(kvmsg)f(to)g(client)934
1918 y(zhash_foreach)f(\(kvmap,)h(s_send_single,)e(&routing\);)934
2112 y(//)90 b(Now)44 b(send)g(END)g(message)g(with)g(sequence)g
(number)934 2209 y(printf)g(\("Sending)f(state)h(shapshot=\045d\\n",)f
(\(int\))h(sequence\);)934 2307 y(zframe_send)f(\(&identity,)g
(snapshot,)h(ZFRAME_MORE\);)934 2404 y(kvmsg_t)1293 2417
y(*)1338 2404 y(kvmsg)g(=)g(kvmsg_new)g(\(sequence\);)934
2501 y(kvmsg_set_key)88 b(\(kvmsg,)43 b("KTHXBAI"\);)934
2598 y(kvmsg_set_body)g(\(kvmsg,)g(\(byte)2234 2611 y(*)2279
2598 y(\))i("",)f(0\);)934 2695 y(kvmsg_send)223 b(\(kvmsg,)43
b(snapshot\);)934 2792 y(kvmsg_destroy)g(\(&kvmsg\);)755
2889 y(})576 2987 y(})576 3084 y(zhash_destroy)f(\(&kvmap\);)396
3181 y(})-2 3355 y
SDict begin H.S end
 -2 3355 a -2 3355 a
SDict begin 13 H.A end
 -2 3355 a -2 3355
a
SDict begin [/View [/XYZ H.V]/Dest (0:3301) cvn /DEST pdfmark end
 -2 3355 a 396 3455 a Fk(And)20 b(here)g(is)h(the)f(client:)-2
3456 y
SDict begin H.S end
 -2 3456 a -2 3456 a
SDict begin 13 H.A end
 -2 3456 a -2 3456 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli2-c) cvn /DEST pdfmark
end
 -2 3456
a 396 3656 a Fg(Example)h(5-19.)d(Clone)j(client,)f(Model)h(T)-6
b(w)o(o)20 b(\(clonecli2.c\))-2 3756 y
SDict begin H.S end
 -2 3756 a -2 3756
a
SDict begin 11.7 H.A end
 -2 3756 a -2 3756 a
SDict begin [/View [/XYZ H.V]/Dest (0:3304) cvn /DEST pdfmark end
 -2 3756 a 396 3836 a Fe(//)396
3933 y(//)90 b(Clone)44 b(client)f(Model)h(Two)396 4031
y(//)396 4225 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)
g(creating)f(a)i(library)396 4322 y(#include)f("kvsimple.c")396
4516 y(int)h(main)f(\(void\))396 4613 y({)576 4711 y(//)89
b(Prepare)44 b(our)g(context)g(and)g(subscriber)576 4808
y(zctx_t)889 4821 y(*)934 4808 y(ctx)h(=)f(zctx_new)g(\(\);)576
4905 y(void)800 4918 y(*)845 4905 y(snapshot)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_DEALER\);)576 5002 y(zsocket_connect)e(\(snapshot,)h
("tcp://localhost:5556"\);)576 5099 y(void)800 5112 y(*)845
5099 y(subscriber)g(=)h(zsocket_new)f(\(ctx,)h(ZMQ_SUB\);)p
Black 3759 5569 a Ff(271)p Black eop end
%%Page: 272 285
TeXDict begin 272 284 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.272) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(zsockopt_set_subscribe)41 b(\(subscriber,)i(""\);)576
170 y(zsocket_connect)f(\(subscriber,)h("tcp://localhost:5557"\);)576
364 y(zhash_t)934 377 y(*)979 364 y(kvmap)h(=)h(zhash_new)e(\(\);)576
558 y(//)89 b(Get)44 b(state)g(snapshot)576 655 y(int64_t)f(sequence)h
(=)g(0;)576 752 y(zstr_send)f(\(snapshot,)g("ICANHAZ?"\);)576
850 y(while)h(\(true\))f({)755 947 y(kvmsg_t)1114 960
y(*)1159 947 y(kvmsg)g(=)i(kvmsg_recv)e(\(snapshot\);)755
1044 y(if)h(\(!kvmsg\))934 1141 y(break;)448 b(//)89
b(Interrupted)755 1238 y(if)44 b(\(streq)g(\(kvmsg_key)f(\(kvmsg\),)h
("KTHXBAI"\)\))f({)934 1335 y(sequence)h(=)g(kvmsg_sequence)f
(\(kvmsg\);)934 1432 y(printf)h(\("Received)f(snapshot=\045d\\n",)g
(\(int\))h(sequence\);)934 1530 y(kvmsg_destroy)f(\(&kvmsg\);)934
1627 y(break;)448 b(//)89 b(Done)755 1724 y(})755 1821
y(kvmsg_store)43 b(\(&kvmsg,)g(kvmap\);)576 1918 y(})576
2015 y(//)89 b(Now)44 b(apply)g(pending)g(updates,)f(discard)h
(out-of-sequence)e(messages)576 2112 y(while)i(\(!zctx_interrupted\))d
({)755 2209 y(kvmsg_t)1114 2222 y(*)1159 2209 y(kvmsg)i(=)i(kvmsg_recv)
e(\(subscriber\);)755 2307 y(if)h(\(!kvmsg\))934 2404
y(break;)448 b(//)89 b(Interrupted)755 2501 y(if)44 b(\(kvmsg_sequence)
f(\(kvmsg\))g(>)i(sequence\))e({)934 2598 y(sequence)h(=)g
(kvmsg_sequence)f(\(kvmsg\);)934 2695 y(kvmsg_store)g(\(&kvmsg,)h
(kvmap\);)755 2792 y(})755 2889 y(else)934 2987 y(kvmsg_destroy)f
(\(&kvmsg\);)576 3084 y(})576 3181 y(zhash_destroy)f(\(&kvmap\);)576
3278 y(zctx_destroy)g(\(&ctx\);)576 3375 y(return)h(0;)396
3472 y(})-2 3646 y
SDict begin H.S end
 -2 3646 a -2 3646 a
SDict begin 13 H.A end
 -2 3646 a -2 3646
a
SDict begin [/View [/XYZ H.V]/Dest (0:3305) cvn /DEST pdfmark end
 -2 3646 a 396 3746 a Fk(Some)20 b(notes)g(about)f(this)i(code:)-2
3747 y
SDict begin H.S end
 -2 3747 a -2 3747 a
SDict begin 13 H.A end
 -2 3747 a -2 3747 a
SDict begin [/View [/XYZ H.V]/Dest (0:3306) cvn /DEST pdfmark end
 -2 3747
a -2 3757 a
SDict begin H.S end
 -2 3757 a -2 3757 a
SDict begin 13 H.A end
 -2 3757 a -2 3757 a
SDict begin [/View [/XYZ H.V]/Dest (0:3307) cvn /DEST pdfmark end
 -2
3757 a Black 396 3916 a Fj(\225)p Black 479 3916 a
SDict begin H.S end
 479
3916 a 479 3916 a
SDict begin 13 H.A end
 479 3916 a 479 3916 a
SDict begin [/View [/XYZ H.V]/Dest (0:3308) cvn /DEST pdfmark end
 479 3916 a Fk(The)f(serv)o(er)f
(uses)i(tw)o(o)g(threads,)e(for)g(simpler)h(design.)g(One)g(thread)f
(produces)f(random)h(updates,)g(and)g(the)i(second)479
4024 y(thread)f(handles)f(state.)i(The)e(tw)o(o)i(communicate)d(across)
i(P)-8 b(AIR)21 b(sock)o(ets.)g(Y)-9 b(ou)19 b(might)h(lik)o(e)g(to)g
(use)h(SUB)g(sock)o(ets)479 4132 y(b)n(ut)f(you')l(d)f(hit)h(the)g
("slo)n(w)h(joiner")e(problem)g(where)g(the)h(subscriber)f(w)o(ould)h
(randomly)e(miss)j(some)f(messages)479 4240 y(while)h(connecting.)c(P)
-8 b(AIR)22 b(sock)o(ets)e(let)h(us)f(e)o(xplicitly)f(synchronize)f
(the)j(tw)o(o)f(threads.)-2 4258 y
SDict begin H.S end
 -2 4258 a -2 4258
a
SDict begin 13 H.A end
 -2 4258 a -2 4258 a
SDict begin [/View [/XYZ H.V]/Dest (0:3309) cvn /DEST pdfmark end
 -2 4258 a Black 396 4390 a Fj(\225)p
Black 479 4390 a
SDict begin H.S end
 479 4390 a 479 4390 a
SDict begin 13 H.A end
 479 4390 a 479
4390 a
SDict begin [/View [/XYZ H.V]/Dest (0:3310) cvn /DEST pdfmark end
 479 4390 a Fk(W)-7 b(e)22 b(set)f(a)f(HWM)h(on)f(the)g(updates)f
(sock)o(et)i(pair)m(,)e(since)h(hash)g(table)g(insertions)g(are)g
(relati)n(v)o(ely)f(slo)n(w)-5 b(.)20 b(W)m(ithout)f(this,)479
4498 y(the)h(serv)o(er)g(runs)g(out)f(of)h(memory)-5
b(.)18 b(On)1639 4498 y
SDict begin H.S end
 1639 4498 a 1639 4498 a
SDict begin 13 H.A end
 1639
4498 a 1639 4498 a
SDict begin [/View [/XYZ H.V]/Dest (0:3311) cvn /DEST pdfmark end
 1639 4498 a Fe(inproc)i Fk(connections,)e(the)i
(real)h(HWM)f(is)i(the)e(sum)g(of)g(the)g(HWM)h(of)479
4605 y
SDict begin H.S end
 479 4605 a 479 4605 a
SDict begin 13 H.A end
 479 4605 a 479 4605 a
SDict begin [/View [/XYZ H.V]/Dest (0:3312) cvn /DEST pdfmark end
 479
4605 a Ff(both)f Fk(sock)o(ets,)g(so)g(we)h(set)g(the)f(HWM)h(on)f
(each)g(sock)o(et.)-2 4617 y
SDict begin H.S end
 -2 4617 a -2 4617 a
SDict begin 13 H.A end
 -2 4617
a -2 4617 a
SDict begin [/View [/XYZ H.V]/Dest (0:3313) cvn /DEST pdfmark end
 -2 4617 a Black 396 4755 a Fj(\225)p Black
479 4755 a
SDict begin H.S end
 479 4755 a 479 4755 a
SDict begin 13 H.A end
 479 4755 a 479 4755
a
SDict begin [/View [/XYZ H.V]/Dest (0:3314) cvn /DEST pdfmark end
 479 4755 a Fk(The)g(client)g(is)h(really)f(simple.)g(In)g(C,)h(under)
e(60)h(lines)g(of)g(code.)f(A)i(lot)f(of)g(the)h(hea)n(vy)e(lifting)h
(is)h(done)e(in)h(the)h(kvmsg)479 4863 y(class,)g(b)n(ut)f(still,)i
(the)e(basic)g(Clone)g(pattern)f(is)j(easier)e(to)g(implement)f(than)h
(it)h(seemed)f(at)g(\002rst.)-2 4881 y
SDict begin H.S end
 -2 4881 a -2 4881
a
SDict begin 13 H.A end
 -2 4881 a -2 4881 a
SDict begin [/View [/XYZ H.V]/Dest (0:3315) cvn /DEST pdfmark end
 -2 4881 a Black 3759 5569 a Ff(272)p
Black eop end
%%Page: 273 286
TeXDict begin 273 285 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.273) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:3337) cvn /DEST pdfmark end
 -2 -201 a 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e
(Publish-Subscribe)p Black Black 396 72 a Fj(\225)p Black
479 72 a
SDict begin H.S end
 479 72 a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3316) cvn /DEST pdfmark end
 479 72 a
Fk(W)-7 b(e)22 b(don')o(t)c(use)j(an)o(ything)d(f)o(anc)o(y)h(for)g
(serializing)h(the)g(state.)h(The)f(hash)g(table)g(holds)f(a)i(set)g
(of)f(kvmsg)f(objects,)h(and)479 180 y(the)g(serv)o(er)g(sends)g
(these,)g(as)h(a)g(batch)e(of)h(messages,)g(to)h(the)f(client)g
(requesting)f(state.)h(If)g(multiple)g(clients)g(request)479
288 y(state)h(at)g(once,)e(each)h(will)h(get)f(a)h(dif)n(ferent)d
(snapshot.)-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306
a
SDict begin [/View [/XYZ H.V]/Dest (0:3317) cvn /DEST pdfmark end
 -2 306 a Black 396 438 a Fj(\225)p Black 479 438 a
SDict begin H.S end

479 438 a 479 438 a
SDict begin 13 H.A end
 479 438 a 479 438 a
SDict begin [/View [/XYZ H.V]/Dest (0:3318) cvn /DEST pdfmark end
 479 438 a Fk(W)-7
b(e)22 b(assume)e(that)g(the)g(client)h(has)f(e)o(xactly)f(one)h(serv)o
(er)f(to)i(talk)f(to.)g(The)g(serv)o(er)2809 438 y
SDict begin H.S end
 2809
438 a 2809 438 a
SDict begin 13 H.A end
 2809 438 a 2809 438 a
SDict begin [/View [/XYZ H.V]/Dest (0:3319) cvn /DEST pdfmark end
 2809 438 a Fg(must)h
Fk(be)f(running;)e(we)j(do)f(not)g(try)479 546 y(to)h(solv)o(e)e(the)i
(question)e(of)h(what)g(happens)f(if)h(the)g(serv)o(er)g(crashes.)-2
730 y
SDict begin H.S end
 -2 730 a -2 730 a
SDict begin 13 H.A end
 -2 730 a -2 730 a
SDict begin [/View [/XYZ H.V]/Dest (0:3320) cvn /DEST pdfmark end
 -2 730 a 396
820 a Fk(Right)h(no)n(w)-5 b(,)19 b(these)h(tw)o(o)g(programs)f(don')o
(t)f(do)i(an)o(ything)e(real,)i(b)n(ut)g(the)o(y)g(correctly)f
(synchronize)e(state.)k(It')-5 b(s)21 b(a)g(neat)396
928 y(e)o(xample)e(of)h(ho)n(w)g(to)g(mix)g(dif)n(ferent)e(patterns:)i
(P)-8 b(AIR-o)o(v)o(er)n(-inproc,)17 b(PUB-SUB,)k(and)f(R)m
(OUTER-DEALER.)-2 956 y
SDict begin H.S end
 -2 956 a -2 956 a
SDict begin 13 H.A end
 -2 956 a -2
956 a
SDict begin [/View [/XYZ H.V]/Dest (0:3321) cvn /DEST pdfmark end
 -2 956 a 396 1266 a Fb(5.3.3.)36 b(Repub)o(lishing)f(Updates)1988
1266 y
SDict begin H.S end
 1988 1266 a 1988 1266 a
SDict begin 18.72 H.A end
 1988 1266 a 1988 1266
a
SDict begin [/View [/XYZ H.V]/Dest (10.72.23.2) cvn /DEST pdfmark end
 1988 1266 a -2 1459 a
SDict begin H.S end
 -2 1459 a -2 1459 a
SDict begin 13 H.A end
 -2 1459 a
-2 1459 a
SDict begin [/View [/XYZ H.V]/Dest (0:3323) cvn /DEST pdfmark end
 -2 1459 a 396 1540 a Fk(In)20 b(our)g(second)f(model,)g
(changes)g(to)h(the)h(k)o(e)o(y-v)n(alue)d(cache)h(came)h(from)f(the)i
(serv)o(er)e(itself.)i(This)f(is)h(a)g(centralized)396
1648 y(model,)e(useful)g(for)g(e)o(xample)f(if)i(we)g(ha)n(v)o(e)f(a)h
(central)g(con\002guration)d(\002le)j(we)g(w)o(ant)g(to)g(distrib)n
(ute,)f(with)g(local)h(caching)396 1756 y(on)g(each)g(node.)f(A)h(more)
g(interesting)f(model)g(tak)o(es)i(updates)e(from)h(clients,)g(not)g
(the)g(serv)o(er)-5 b(.)19 b(The)h(serv)o(er)g(thus)396
1864 y(becomes)g(a)g(stateless)i(brok)o(er)-5 b(.)18
b(This)j(gi)n(v)o(es)e(us)i(some)f(bene\002ts:)-2 1882
y
SDict begin H.S end
 -2 1882 a -2 1882 a
SDict begin 13 H.A end
 -2 1882 a -2 1882 a
SDict begin [/View [/XYZ H.V]/Dest (0:3324) cvn /DEST pdfmark end
 -2 1882 a -2
1892 a
SDict begin H.S end
 -2 1892 a -2 1892 a
SDict begin 13 H.A end
 -2 1892 a -2 1892 a
SDict begin [/View [/XYZ H.V]/Dest (0:3325) cvn /DEST pdfmark end
 -2 1892
a Black 396 2034 a Fj(\225)p Black 479 2034 a
SDict begin H.S end
 479 2034
a 479 2034 a
SDict begin 13 H.A end
 479 2034 a 479 2034 a
SDict begin [/View [/XYZ H.V]/Dest (0:3326) cvn /DEST pdfmark end
 479 2034 a Fk(W)-7
b(e')l(re)21 b(less)g(w)o(orried)e(about)g(the)h(reliability)g(of)g
(the)g(serv)o(er)-5 b(.)20 b(If)g(it)h(crashes,)f(we)g(can)g(start)h(a)
f(ne)n(w)g(instance,)g(and)479 2142 y(feed)g(it)h(ne)n(w)f(v)n(alues.)
-2 2143 y
SDict begin H.S end
 -2 2143 a -2 2143 a
SDict begin 13 H.A end
 -2 2143 a -2 2143 a
SDict begin [/View [/XYZ H.V]/Dest (0:3327) cvn /DEST pdfmark end
 -2
2143 a Black 396 2291 a Fj(\225)p Black 479 2291 a
SDict begin H.S end
 479
2291 a 479 2291 a
SDict begin 13 H.A end
 479 2291 a 479 2291 a
SDict begin [/View [/XYZ H.V]/Dest (0:3328) cvn /DEST pdfmark end
 479 2291 a Fk(W)-7
b(e)22 b(can)e(use)g(the)g(k)o(e)o(y-v)n(alue)e(cache)i(to)g(share)g
(kno)n(wledge)e(between)i(dynamic)e(peers.)-2 2475 y
SDict begin H.S end

-2 2475 a -2 2475 a
SDict begin 13 H.A end
 -2 2475 a -2 2475 a
SDict begin [/View [/XYZ H.V]/Dest (0:3329) cvn /DEST pdfmark end
 -2 2475 a 396
2565 a Fk(Updates)i(from)f(clients)i(go)f(via)g(a)g(PUSH-PULL)h(sock)o
(et)f(\003o)n(w)g(from)f(client)h(to)h(serv)o(er\()p
0 TeXcolorgray 2963 2565 a
SDict begin H.S end
 2963 2565 a Fk(Figure)c(5-5)3310
2565 y
SDict begin 13 H.L end
 3310 2565 a 3310 2565 a
SDict begin [/Subtype /Link/Dest (0:figure-67) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3310 2565 a Black -1 w
Fk(\).)-2 2583 y
SDict begin H.S end
 -2 2583 a -2 2583 a
SDict begin 13 H.A end
 -2 2583 a -2 2583
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-67) cvn /DEST pdfmark
end
 -2 2583 a 396 2767 a Fg(Figur)o(e)j(5-5.)f(Republishing)i(Updates)-2
2867 y
SDict begin H.S end
 -2 2867 a -2 2867 a
SDict begin 13 H.A end
 -2 2867 a -2 2867 a
SDict begin [/View [/XYZ H.V]/Dest (0:3333) cvn /DEST pdfmark end
 -2 2867
a 396 4541 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 4541 a @beginspecial 0 @llx -196 @lly
285 @urx 0 @ury 2850 @rwi @setspecial
%%BeginDocument: images/fig67.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -196 285 0
%%HiResBoundingBox: 0.0 -196.0 285.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
78.50015258789062 -18.500150680541992 moveto
78.50015258789062 -46.50014877319336 lineto
213.50015258789062 -46.50014877319336 lineto
213.50015258789062 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
78.50015258789062 -46.50014877319336 moveto
78.50015258789062 -57.50014877319336 lineto
78.50015258789062 -59.50014877319336 79.50015258789062 -60.50014877319336 81.50015258789062 -60.50014877319336 curveto
122.50015258789062 -60.50014877319336 lineto
122.50015258789062 -60.50014877319336 lineto
122.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
124.50015258789062 -46.50014877319336 moveto
124.50015258789062 -60.50014877319336 lineto
167.50015258789062 -60.50014877319336 lineto
167.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
169.50015258789062 -46.50014877319336 moveto
169.50015258789062 -60.50014877319336 lineto
211.50015258789062 -60.50014877319336 lineto
212.83348592122397 -60.50014877319336 213.50015258789062 -59.50014877319336 213.50015258789062 -57.50014877319336 curveto
213.50015258789062 -46.50014877319336 lineto
213.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
161.50015258789062 -137.50015258789062 moveto
159.50015258789062 -137.50015258789062 158.50015258789062 -138.83348592122397 158.50015258789062 -141.50015258789062 curveto
158.50015258789062 -151.50015258789062 lineto
192.50015258789062 -151.50015258789062 lineto
192.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
194.50015258789062 -137.50015258789062 moveto
194.50015258789062 -151.50015258789062 lineto
237.50015258789062 -151.50015258789062 lineto
237.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
239.50015258789062 -137.50015258789062 moveto
239.50015258789062 -151.50015258789062 lineto
273.5001525878906 -151.50015258789062 lineto
273.5001525878906 -141.50015258789062 lineto
273.5001525878906 -138.83348592122397 272.83348592122394 -137.50015258789062 271.5001525878906 -137.50015258789062 curveto
239.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
158.50015258789062 -151.50015258789062 moveto
158.50015258789062 -179.50015258789062 lineto
273.5001525878906 -179.50015258789062 lineto
273.5001525878906 -151.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -137.50015258789062 moveto
14.500150044759115 -137.50015258789062 13.500149726867676 -138.83348592122397 13.500149726867676 -141.50015258789062 curveto
13.500149726867676 -151.50015258789062 lineto
47.50014877319336 -151.50015258789062 lineto
47.50014877319336 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
49.50014877319336 -137.50015258789062 moveto
49.50014877319336 -151.50015258789062 lineto
92.50015258789062 -151.50015258789062 lineto
92.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
94.50015258789062 -137.50015258789062 moveto
94.50015258789062 -151.50015258789062 lineto
128.50015258789062 -151.50015258789062 lineto
128.50015258789062 -141.50015258789062 lineto
128.50015258789062 -138.83348592122397 127.83348592122395 -137.50015258789062 126.50015258789062 -137.50015258789062 curveto
94.50015258789062 -137.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.500149726867676 -151.50015258789062 moveto
13.500149726867676 -179.50015258789062 lineto
128.50015258789062 -179.50015258789062 lineto
128.50015258789062 -151.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
77.0 -17.0 moveto
77.0 -45.0 lineto
212.0 -45.0 lineto
212.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
77.0 -17.0 moveto
77.0 -45.0 lineto
212.0 -45.0 lineto
212.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
77.0 -45.0 moveto
77.0 -56.0 lineto
77.0 -58.0 78.0 -59.0 80.0 -59.0 curveto
121.0 -59.0 lineto
121.0 -59.0 lineto
121.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
77.0 -45.0 moveto
77.0 -56.0 lineto
77.0 -58.0 78.0 -59.0 80.0 -59.0 curveto
121.0 -59.0 lineto
121.0 -59.0 lineto
121.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
123.0 -45.0 moveto
123.0 -59.0 lineto
166.0 -59.0 lineto
166.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
123.0 -45.0 moveto
123.0 -59.0 lineto
166.0 -59.0 lineto
166.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
168.0 -45.0 moveto
168.0 -59.0 lineto
210.0 -59.0 lineto
211.33333333333334 -59.0 212.0 -58.0 212.0 -56.0 curveto
212.0 -45.0 lineto
212.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
168.0 -45.0 moveto
168.0 -59.0 lineto
210.0 -59.0 lineto
211.33333333333334 -59.0 212.0 -58.0 212.0 -56.0 curveto
212.0 -45.0 lineto
212.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
160.0 -136.0 moveto
158.0 -136.0 157.0 -137.33333333333334 157.0 -140.0 curveto
157.0 -150.0 lineto
191.0 -150.0 lineto
191.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
160.0 -136.0 moveto
158.0 -136.0 157.0 -137.33333333333334 157.0 -140.0 curveto
157.0 -150.0 lineto
191.0 -150.0 lineto
191.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
193.0 -136.0 moveto
193.0 -150.0 lineto
236.0 -150.0 lineto
236.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
193.0 -136.0 moveto
193.0 -150.0 lineto
236.0 -150.0 lineto
236.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
238.0 -136.0 moveto
238.0 -150.0 lineto
272.0 -150.0 lineto
272.0 -140.0 lineto
272.0 -137.33333333333334 271.3333333333333 -136.0 270.0 -136.0 curveto
238.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
238.0 -136.0 moveto
238.0 -150.0 lineto
272.0 -150.0 lineto
272.0 -140.0 lineto
272.0 -137.33333333333334 271.3333333333333 -136.0 270.0 -136.0 curveto
238.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
157.0 -150.0 moveto
157.0 -178.0 lineto
272.0 -178.0 lineto
272.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
157.0 -150.0 moveto
157.0 -178.0 lineto
272.0 -178.0 lineto
272.0 -150.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -136.0 moveto
13.0 -136.0 12.0 -137.33333333333334 12.0 -140.0 curveto
12.0 -150.0 lineto
46.0 -150.0 lineto
46.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
15.0 -136.0 moveto
13.0 -136.0 12.0 -137.33333333333334 12.0 -140.0 curveto
12.0 -150.0 lineto
46.0 -150.0 lineto
46.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
48.0 -136.0 moveto
48.0 -150.0 lineto
91.0 -150.0 lineto
91.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
48.0 -136.0 moveto
48.0 -150.0 lineto
91.0 -150.0 lineto
91.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
93.0 -136.0 moveto
93.0 -150.0 lineto
127.0 -150.0 lineto
127.0 -140.0 lineto
127.0 -137.33333333333334 126.33333333333333 -136.0 125.0 -136.0 curveto
93.0 -136.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
93.0 -136.0 moveto
93.0 -150.0 lineto
127.0 -150.0 lineto
127.0 -140.0 lineto
127.0 -137.33333333333334 126.33333333333333 -136.0 125.0 -136.0 curveto
93.0 -136.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -150.0 moveto
12.0 -178.0 lineto
127.0 -178.0 lineto
127.0 -150.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -150.0 moveto
12.0 -178.0 lineto
127.0 -178.0 lineto
127.0 -150.0 lineto
closepath
stroke
newpath
27.0 -112.0 moveto
27.0 -129.0 lineto
stroke
newpath
142.0 -66.0 moveto
142.0 -91.0 lineto
142.0 -93.0 143.0 -94.0 145.0 -94.0 curveto
210.0 -94.0 lineto
210.0 -94.0 lineto
211.33333333333334 -94.0 212.0 -95.33333333333333 212.0 -98.0 curveto
212.0 -136.0 lineto
212.0 -136.0 lineto
stroke
newpath
187.0 -66.0 moveto
187.0 -77.0 lineto
187.0 -79.0 188.0 -80.0 190.0 -80.0 curveto
250.0 -80.0 lineto
250.0 -80.0 lineto
251.33333333333334 -80.0 252.0 -81.33333333333333 252.0 -84.0 curveto
252.0 -136.0 lineto
252.0 -136.0 lineto
stroke
newpath
67.0 -122.0 moveto
67.0 -136.0 lineto
stroke
newpath
107.0 -122.0 moveto
107.0 -136.0 lineto
stroke
newpath
142.0 -63.0 moveto
140.0 -70.0 lineto
145.0 -70.0 lineto
closepath
fill
newpath
187.0 -63.0 moveto
185.0 -70.0 lineto
190.0 -70.0 lineto
closepath
fill
newpath
67.0 -119.0 moveto
65.0 -126.0 lineto
70.0 -126.0 lineto
closepath
fill
newpath
107.0 -119.0 moveto
105.0 -126.0 lineto
110.0 -126.0 lineto
closepath
fill
newpath
25.0 -126.0 moveto
27.0 -133.0 lineto
30.0 -126.0 lineto
closepath
fill
newpath
170.0 -126.0 moveto
172.0 -133.0 lineto
175.0 -126.0 lineto
closepath
fill
newpath
102.0 -59.0 moveto
102.0 -108.0 lineto
stroke
newpath
32.0 -108.0 moveto
102.0 -108.0 lineto
stroke
newpath
172.0 -129.0 moveto
172.0 -112.0 lineto
172.0 -109.33333333333333 171.33333333333334 -108.0 170.0 -108.0 curveto
102.0 -108.0 lineto
102.0 -108.0 lineto
stroke
/Helvetica findfont
7 scalefont setfont
132.0 -35.0 moveto
(Server) show
95.0 -55.0 moveto
(PUB) show
131.0 -55.0 moveto
(ROUTER) show
181.0 -56.0 moveto
(PULL) show
200.0 -77.0 moveto
(state update) show
156.0 -91.0 moveto
(state request) show
86.0 -98.0 moveto
(updates) show
28.0 -112.0 moveto
(. ) show
20.0 -146.0 moveto
(SUB) show
55.0 -147.0 moveto
(DEALER) show
101.0 -146.0 moveto
(PUSH) show
165.0 -146.0 moveto
(SUB) show
200.0 -147.0 moveto
(DEALER) show
246.0 -146.0 moveto
(PUSH) show
59.0 -168.0 moveto
(Client) show
204.0 -168.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 4541 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 4541 a -2 4707 a
SDict begin H.S end
 -2 4707
a -2 4707 a
SDict begin 13 H.A end
 -2 4707 a -2 4707 a
SDict begin [/View [/XYZ H.V]/Dest (0:3336) cvn /DEST pdfmark end
 -2 4707 a 396 4815 a
Fk(Why)f(don')o(t)f(we)h(allo)n(w)g(clients)h(to)f(publish)f(updates)h
(directly)f(to)h(other)g(clients?)g(While)h(this)g(w)o(ould)e(reduce)g
(latenc)o(y)-5 b(,)396 4923 y(it)21 b(mak)o(es)f(it)h(impossible)f(to)g
(assign)g(ascending)f(unique)g(sequence)g(numbers)g(to)h(messages.)g
(The)g(serv)o(er)f(can)h(do)g(this.)396 5031 y(There')-5
b(s)20 b(a)g(more)f(subtle)h(second)f(reason.)f(In)i(man)o(y)f
(applications)f(it')-5 b(s)21 b(important)d(that)i(updates)f(ha)n(v)o
(e)h(a)g(single)g(order)m(,)p Black 3759 5569 a Ff(273)p
Black eop end
%%Page: 274 287
TeXDict begin 274 286 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.274) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fk(across)i(man)o(y)f(clients.)i(F)o(orcing)e(all)h
(updates)g(through)e(the)i(serv)o(er)f(ensures)h(that)g(the)o(y)g(ha)n
(v)o(e)f(the)i(same)f(order)f(when)396 180 y(the)o(y)h(\002nally)g(get)
g(to)g(clients.)396 454 y(W)m(ith)h(unique)d(sequencing,)h(clients)h
(can)g(detect)g(the)g(nastier)g(f)o(ailures)g(-)h(netw)o(ork)e
(congestion)f(and)i(queue)f(o)o(v)o(er\003o)n(w)-5 b(.)396
562 y(If)20 b(a)h(client)f(disco)o(v)o(ers)f(that)h(its)h(incoming)e
(message)h(stream)g(has)g(a)h(hole,)f(it)g(can)g(tak)o(e)h(action.)e
(It)i(seems)f(sensible)g(that)396 670 y(the)g(client)g(contact)f(the)h
(serv)o(er)f(and)g(ask)h(for)g(the)g(missing)f(messages,)h(b)n(ut)g(in)
g(practice)f(that)h(isn')o(t)g(useful.)f(If)g(there)h(are)396
778 y(holes,)g(the)o(y')l(re)f(caused)g(by)h(netw)o(ork)f(stress,)i
(and)f(adding)e(more)i(stress)h(to)f(the)g(netw)o(ork)f(will)i(mak)o(e)
f(things)g(w)o(orse.)396 886 y(All)h(the)f(client)h(can)f(really)f(do)h
(is)h(w)o(arn)f(its)h(users)g("Unable)e(to)h(continue",)f(and)g(stop,)h
(and)g(not)g(restart)g(until)g(someone)396 994 y(has)h(manually)d
(check)o(ed)h(the)i(cause)f(of)g(the)g(problem.)-2 1178
y
SDict begin H.S end
 -2 1178 a -2 1178 a
SDict begin 13 H.A end
 -2 1178 a -2 1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:3338) cvn /DEST pdfmark end
 -2 1178 a 396
1268 a Fk(W)-7 b(e')o(ll)22 b(no)n(w)d(generate)g(state)i(updates)e(in)
i(the)f(client.)g(Here')-5 b(s)20 b(the)h(serv)o(er:)-2
1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv3-c) cvn /DEST pdfmark
end
 -2 1286
a 396 1469 a Fg(Example)g(5-20.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Thr)o(ee)f(\(clonesr)o(v3.c\))-2 1569
y
SDict begin H.S end
 -2 1569 a -2 1569 a
SDict begin 11.7 H.A end
 -2 1569 a -2 1569 a
SDict begin [/View [/XYZ H.V]/Dest (0:3341) cvn /DEST pdfmark end
 -2 1569 a 396
1649 a Fe(//)396 1747 y(//)90 b(Clone)44 b(server)f(Model)h(Three)396
1844 y(//)396 2038 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)396 2135 y(#include)f("kvsimple.c")
396 2329 y(//)90 b(Routing)43 b(information)g(for)i(a)f(key-value)g
(snapshot)396 2427 y(typedef)g(struct)g({)576 2524 y(void)800
2537 y(*)845 2524 y(socket;)492 b(//)89 b(ROUTER)44 b(socket)g(to)g
(send)g(to)576 2621 y(zframe_t)979 2634 y(*)1024 2621
y(identity;)223 b(//)89 b(Identity)43 b(of)i(peer)f(who)g(requested)g
(state)396 2718 y(})h(kvroute_t;)396 2912 y(//)90 b(Send)44
b(one)g(state)g(snapshot)g(key-value)f(pair)h(to)h(a)f(socket)396
3009 y(//)90 b(Hash)44 b(item)g(data)g(is)h(our)f(kvmsg)g(object,)g
(ready)g(to)g(send)396 3107 y(static)g(int)396 3204 y(s_send_single)f
(\(const)h(char)1562 3217 y(*)1607 3204 y(key,)g(void)2055
3217 y(*)2100 3204 y(data,)g(void)2593 3217 y(*)2638
3204 y(args\))396 3301 y({)576 3398 y(kvroute_t)1024
3411 y(*)1069 3398 y(kvroute)f(=)i(\(kvroute_t)2010 3411
y(*)2055 3398 y(\))g(args;)576 3495 y(//)89 b(Send)44
b(identity)g(of)g(recipient)f(first)576 3592 y(zframe_send)g
(\(&kvroute->identity,)755 3689 y(kvroute->socket,)f(ZFRAME_MORE)h(+)i
(ZFRAME_REUSE\);)576 3786 y(kvmsg_t)934 3799 y(*)979
3786 y(kvmsg)f(=)h(\(kvmsg_t)1741 3799 y(*)1786 3786
y(\))g(data;)576 3884 y(kvmsg_send)e(\(kvmsg,)g(kvroute->socket\);)576
3981 y(return)g(0;)396 4078 y(})396 4272 y(int)i(main)f(\(void\))396
4369 y({)576 4466 y(//)89 b(Prepare)44 b(our)g(context)g(and)g(sockets)
576 4564 y(zctx_t)889 4577 y(*)934 4564 y(ctx)h(=)f(zctx_new)g(\(\);)
576 4661 y(void)800 4674 y(*)845 4661 y(snapshot)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_ROUTER\);)576 4758 y(zsocket_bind)e(\(snapshot,)i
("tcp://)1967 4771 y(*)2012 4758 y(:5556"\);)576 4855
y(void)800 4868 y(*)845 4855 y(publisher)f(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_PUB\);)576 4952 y(zsocket_bind)e(\(publisher,)h("tcp://)2011
4965 y(*)2056 4952 y(:5557"\);)576 5049 y(void)800 5062
y(*)845 5049 y(collector)g(=)i(zsocket_new)e(\(ctx,)h(ZMQ_PULL\);)576
5146 y(zsocket_bind)e(\(collector,)h("tcp://)2011 5159
y(*)2056 5146 y(:5558"\);)p Black 3759 5569 a Ff(274)p
Black eop end
%%Page: 275 288
TeXDict begin 275 287 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.275) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3342) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)i(body)f(of)h(the)g(main)g(task)g(collects)h
(updates)e(from)g(clients)i(and)e(publishes)h(them)g(back)f(out)h(to)g
(clients:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv3-c-1) cvn /DEST pdfmark
end
 -2
90 a 396 274 a Fg(Example)h(5-21.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Thr)o(ee)f(\(clonesr)o(v3.c\))f(-)h(body)g(of)g(main)h
(task)-2 374 y
SDict begin H.S end
 -2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:3345) cvn /DEST pdfmark end
 -2
374 a 576 551 a Fe(int64_t)43 b(sequence)h(=)g(0;)576
648 y(zhash_t)934 661 y(*)979 648 y(kvmap)g(=)h(zhash_new)e(\(\);)576
843 y(zmq_pollitem_t)f(items)i([])h(=)f({)755 940 y({)h(collector,)e
(0,)h(ZMQ_POLLIN,)f(0)i(},)755 1037 y({)g(snapshot,)e(0,)h(ZMQ_POLLIN,)
f(0)i(})576 1134 y(};)576 1231 y(while)f(\(!zctx_interrupted\))d({)755
1328 y(int)j(rc)h(=)f(zmq_poll)g(\(items,)g(2,)g(1000)2279
1341 y(*)2369 1328 y(ZMQ_POLL_MSEC\);)755 1522 y(//)89
b(Apply)44 b(state)g(update)g(sent)g(from)g(client)755
1620 y(if)g(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
1717 y(kvmsg_t)1293 1730 y(*)1338 1717 y(kvmsg)h(=)g(kvmsg_recv)g
(\(collector\);)934 1814 y(if)h(\(!kvmsg\))1114 1911
y(break;)447 b(//)89 b(Interrupted)934 2008 y(kvmsg_set_sequence)42
b(\(kvmsg,)i(++sequence\);)934 2105 y(kvmsg_send)f(\(kvmsg,)h
(publisher\);)934 2202 y(kvmsg_store)f(\(&kvmsg,)h(kvmap\);)934
2300 y(printf)g(\("I:)g(publishing)f(update)h(\0455d\\n",)g(\(int\))g
(sequence\);)755 2397 y(})755 2494 y(//)89 b(Execute)44
b(state)g(snapshot)f(request)755 2591 y(if)h(\(items)g([1].revents)f(&)
i(ZMQ_POLLIN\))e({)934 2688 y(zframe_t)1338 2701 y(*)1383
2688 y(identity)g(=)i(zframe_recv)e(\(snapshot\);)934
2785 y(if)i(\(!identity\))1114 2882 y(break;)447 b(//)89
b(Interrupted)934 3077 y(//)h(Request)43 b(is)i(in)f(second)g(frame)g
(of)h(message)934 3174 y(char)1158 3187 y(*)1203 3174
y(request)f(=)h(zstr_recv)e(\(snapshot\);)934 3271 y(if)i(\(streq)f
(\(request,)f("ICANHAZ?"\)\))1114 3368 y(free)h(\(request\);)934
3465 y(else)g({)1114 3562 y(printf)f(\("E:)i(bad)f(request,)f
(aborting\\n"\);)1114 3659 y(break;)934 3757 y(})934
3854 y(//)90 b(Send)44 b(state)g(snapshot)f(to)i(client)934
3951 y(kvroute_t)f(routing)f(=)i({)g(snapshot,)e(identity)g(};)934
4145 y(//)90 b(For)44 b(each)g(entry)g(in)h(kvmap,)e(send)i(kvmsg)f(to)
g(client)934 4242 y(zhash_foreach)f(\(kvmap,)h(s_send_single,)e
(&routing\);)934 4437 y(//)90 b(Now)44 b(send)g(END)g(message)g(with)g
(sequence)g(number)934 4534 y(printf)g(\("I:)g(sending)g
(shapshot=\045d\\n",)e(\(int\))i(sequence\);)934 4631
y(zframe_send)f(\(&identity,)g(snapshot,)h(ZFRAME_MORE\);)934
4728 y(kvmsg_t)1293 4741 y(*)1338 4728 y(kvmsg)g(=)g(kvmsg_new)g
(\(sequence\);)934 4825 y(kvmsg_set_key)88 b(\(kvmsg,)43
b("KTHXBAI"\);)934 4922 y(kvmsg_set_body)g(\(kvmsg,)g(\(byte)2234
4935 y(*)2279 4922 y(\))i("",)f(0\);)934 5019 y(kvmsg_send)223
b(\(kvmsg,)43 b(snapshot\);)934 5116 y(kvmsg_destroy)g(\(&kvmsg\);)p
Black 3759 5569 a Ff(275)p Black eop end
%%Page: 276 289
TeXDict begin 276 288 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.276) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(})576 170 y(})576 267 y(printf)43 b(\(")i
(Interrupted\\n\045d)d(messages)i(handled\\n",)f(\(int\))h(sequence\);)
576 364 y(zhash_destroy)e(\(&kvmap\);)576 461 y(zctx_destroy)g
(\(&ctx\);)576 655 y(return)h(0;)396 752 y(})-2 927 y
SDict begin H.S end

-2 927 a -2 927 a
SDict begin 13 H.A end
 -2 927 a -2 927 a
SDict begin [/View [/XYZ H.V]/Dest (0:3346) cvn /DEST pdfmark end
 -2 927 a 396 1026
a Fk(And)20 b(here)g(is)h(the)f(client:)-2 1027 y
SDict begin H.S end
 -2
1027 a -2 1027 a
SDict begin 13 H.A end
 -2 1027 a -2 1027 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli3-c) cvn /DEST pdfmark
end
 -2 1027 a 396 1228
a Fg(Example)h(5-22.)d(Clone)j(client,)f(Model)h(Thr)o(ee)f
(\(clonecli3.c\))-2 1328 y
SDict begin H.S end
 -2 1328 a -2 1328 a
SDict begin 11.7 H.A end
 -2 1328
a -2 1328 a
SDict begin [/View [/XYZ H.V]/Dest (0:3349) cvn /DEST pdfmark end
 -2 1328 a 396 1408 a Fe(//)396 1505 y(//)90
b(Clone)44 b(client)f(Model)h(Three)396 1602 y(//)396
1796 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)g
(creating)f(a)i(library)396 1894 y(#include)f("kvsimple.c")396
2088 y(int)h(main)f(\(void\))396 2185 y({)576 2282 y(//)89
b(Prepare)44 b(our)g(context)g(and)g(subscriber)576 2379
y(zctx_t)889 2392 y(*)934 2379 y(ctx)h(=)f(zctx_new)g(\(\);)576
2476 y(void)800 2489 y(*)845 2476 y(snapshot)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_DEALER\);)576 2574 y(zsocket_connect)e(\(snapshot,)h
("tcp://localhost:5556"\);)576 2671 y(void)800 2684 y(*)845
2671 y(subscriber)g(=)h(zsocket_new)f(\(ctx,)h(ZMQ_SUB\);)576
2768 y(zsockopt_set_subscribe)d(\(subscriber,)i(""\);)576
2865 y(zsocket_connect)f(\(subscriber,)h("tcp://localhost:5557"\);)576
2962 y(void)800 2975 y(*)845 2962 y(publisher)g(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_PUSH\);)576 3059 y(zsocket_connect)e(\(publisher,)h
("tcp://localhost:5558"\);)576 3253 y(zhash_t)934 3266
y(*)979 3253 y(kvmap)h(=)h(zhash_new)e(\(\);)576 3351
y(srandom)g(\(\(unsigned\))g(time)h(\(NULL\)\);)-2 3528
y
SDict begin H.S end
 -2 3528 a -2 3528 a
SDict begin 13 H.A end
 -2 3528 a -2 3528 a
SDict begin [/View [/XYZ H.V]/Dest (0:3350) cvn /DEST pdfmark end
 -2 3528 a 396
3625 a Fk(W)-7 b(e)22 b(\002rst)f(request)e(a)i(state)g(snapshot:)-2
3643 y
SDict begin H.S end
 -2 3643 a -2 3643 a
SDict begin 13 H.A end
 -2 3643 a -2 3643 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli3-c-1) cvn /DEST pdfmark
end
 -2 3643
a 396 3826 a Fg(Example)g(5-23.)d(Clone)j(client,)f(Model)h(Thr)o(ee)f
(\(clonecli3.c\))f(-)h(getting)f(a)h(state)g(snapshot)-2
3926 y
SDict begin H.S end
 -2 3926 a -2 3926 a
SDict begin 11.7 H.A end
 -2 3926 a -2 3926 a
SDict begin [/View [/XYZ H.V]/Dest (0:3353) cvn /DEST pdfmark end
 -2 3926
a 576 4103 a Fe(zstr_send)43 b(\(snapshot,)g("ICANHAZ?"\);)576
4200 y(while)h(\(true\))f({)755 4297 y(kvmsg_t)1114 4310
y(*)1159 4297 y(kvmsg)g(=)i(kvmsg_recv)e(\(snapshot\);)755
4395 y(if)h(\(!kvmsg\))934 4492 y(break;)448 b(//)89
b(Interrupted)755 4589 y(if)44 b(\(streq)g(\(kvmsg_key)f(\(kvmsg\),)h
("KTHXBAI"\)\))f({)934 4686 y(sequence)h(=)g(kvmsg_sequence)f
(\(kvmsg\);)934 4783 y(printf)h(\("I:)g(received)g(snapshot=\045d\\n",)
e(\(int\))i(sequence\);)934 4880 y(kvmsg_destroy)f(\(&kvmsg\);)934
4977 y(break;)448 b(//)89 b(Done)755 5075 y(})p Black
3757 5569 a Ff(276)p Black eop end
%%Page: 277 290
TeXDict begin 277 289 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.277) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(kvmsg_store)43 b(\(&kvmsg,)g(kvmap\);)576
170 y(})-2 344 y
SDict begin H.S end
 -2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:3354) cvn /DEST pdfmark end

-2 344 a 396 444 a Fk(No)n(w)20 b(we)h(w)o(ait)g(for)e(updates)h(from)f
(the)h(serv)o(er)m(,)f(and)g(e)n(v)o(ery)g(so)i(often,)e(we)i(send)e(a)
i(random)d(k)o(e)o(y-v)n(alue)g(update)i(to)g(the)396
552 y(serv)o(er:)-2 553 y
SDict begin H.S end
 -2 553 a -2 553 a
SDict begin 13 H.A end
 -2 553 a
-2 553 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli3-c-2) cvn /DEST pdfmark
end
 -2 553 a 396 753 a Fg(Example)h(5-24.)d(Clone)j(client,)f
(Model)h(Thr)o(ee)f(\(clonecli3.c\))f(-)h(pr)o(ocessing)g(state)g
(updates)-2 853 y
SDict begin H.S end
 -2 853 a -2 853 a
SDict begin 11.7 H.A end
 -2 853 a -2 853 a
SDict begin [/View [/XYZ H.V]/Dest (0:3357) cvn /DEST pdfmark end

-2 853 a 576 933 a Fe(int64_t)43 b(alarm)h(=)h(zclock_time)e(\(\))h(+)h
(1000;)576 1030 y(while)f(\(!zctx_interrupted\))d({)755
1127 y(zmq_pollitem_t)h(items)i([])h(=)g({)f({)h(subscriber,)e(0,)h
(ZMQ_POLLIN,)f(0)i(})g(};)755 1224 y(int)f(tickless)g(=)g(\(int\))g
(\(\(alarm)g(-)h(zclock_time)e(\(\)\)\);)755 1322 y(if)h(\(tickless)g
(<)g(0\))934 1419 y(tickless)g(=)g(0;)755 1516 y(int)g(rc)h(=)f
(zmq_poll)g(\(items,)g(1,)g(tickless)2459 1529 y(*)2548
1516 y(ZMQ_POLL_MSEC\);)755 1613 y(if)g(\(rc)h(==)f(-1\))934
1710 y(break;)627 b(//)89 b(Context)44 b(has)g(been)g(shut)h(down)755
1904 y(if)f(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
2001 y(kvmsg_t)1293 2014 y(*)1338 2001 y(kvmsg)h(=)g(kvmsg_recv)g
(\(subscriber\);)934 2099 y(if)h(\(!kvmsg\))1114 2196
y(break;)447 b(//)89 b(Interrupted)934 2390 y(//)h(Discard)43
b(out-of-sequence)g(kvmsgs,)g(incl.)h(heartbeats)934
2487 y(if)h(\(kvmsg_sequence)d(\(kvmsg\))i(>)g(sequence\))g({)1114
2584 y(sequence)f(=)i(kvmsg_sequence)d(\(kvmsg\);)1114
2681 y(kvmsg_store)h(\(&kvmsg,)g(kvmap\);)1114 2779 y(printf)g(\("I:)i
(received)e(update=\045d\\n",)g(\(int\))h(sequence\);)934
2876 y(})934 2973 y(else)1114 3070 y(kvmsg_destroy)e(\(&kvmsg\);)755
3167 y(})755 3264 y(//)89 b(If)45 b(we)f(timed-out,)f(generate)h(a)h
(random)e(kvmsg)755 3361 y(if)h(\(zclock_time)f(\(\))i(>=)f(alarm\))g
({)934 3459 y(kvmsg_t)1293 3472 y(*)1338 3459 y(kvmsg)g(=)g(kvmsg_new)g
(\(0\);)934 3556 y(kvmsg_fmt_key)88 b(\(kvmsg,)43 b("\045d",)h(randof)g
(\(10000\)\);)934 3653 y(kvmsg_fmt_body)f(\(kvmsg,)g("\045d",)h(randof)
g(\(1000000\)\);)934 3750 y(kvmsg_send)223 b(\(kvmsg,)43
b(publisher\);)934 3847 y(kvmsg_destroy)g(\(&kvmsg\);)934
3944 y(alarm)h(=)h(zclock_time)e(\(\))h(+)h(1000;)755
4041 y(})576 4138 y(})576 4236 y(printf)e(\(")i(Interrupted\\n\045d)d
(messages)i(in\\n",)g(\(int\))g(sequence\);)576 4333
y(zhash_destroy)e(\(&kvmap\);)576 4430 y(zctx_destroy)g(\(&ctx\);)576
4527 y(return)h(0;)396 4624 y(})-2 4798 y
SDict begin H.S end
 -2 4798 a -2
4798 a
SDict begin 13 H.A end
 -2 4798 a -2 4798 a
SDict begin [/View [/XYZ H.V]/Dest (0:3358) cvn /DEST pdfmark end
 -2 4798 a 396 4898 a Fk(Some)20
b(notes)g(about)f(this)i(code:)-2 4899 y
SDict begin H.S end
 -2 4899 a -2
4899 a
SDict begin 13 H.A end
 -2 4899 a -2 4899 a
SDict begin [/View [/XYZ H.V]/Dest (0:3359) cvn /DEST pdfmark end
 -2 4899 a -2 4909 a
SDict begin H.S end
 -2 4909
a -2 4909 a
SDict begin 13 H.A end
 -2 4909 a -2 4909 a
SDict begin [/View [/XYZ H.V]/Dest (0:3360) cvn /DEST pdfmark end
 -2 4909 a Black 3756
5569 a Ff(277)p Black eop end
%%Page: 278 291
TeXDict begin 278 290 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.278) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3361) cvn /DEST pdfmark end
 479 72 a Fk(The)i(serv)o(er)f(has)h
(collapsed)f(to)h(a)g(single)g(task.)g(It)g(manages)f(a)h(PULL)g(sock)o
(et)g(for)f(incoming)f(updates,)h(a)h(R)m(OUTER)479 180
y(sock)o(et)g(for)g(state)h(requests,)e(and)h(a)h(PUB)g(sock)o(et)f
(for)f(outgoing)f(updates.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end

-2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:3362) cvn /DEST pdfmark end
 -2 198 a Black 396 330 a Fj(\225)p
Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330
a
SDict begin [/View [/XYZ H.V]/Dest (0:3363) cvn /DEST pdfmark end
 479 330 a Fk(The)i(client)g(uses)h(a)g(simple)f(tickless)h(timer)f
(to)g(send)g(a)h(random)d(update)h(to)h(the)h(serv)o(er)e(once)g(a)i
(second.)e(In)h(a)h(real)479 438 y(implementation)d(we)j(w)o(ould)e
(dri)n(v)o(e)g(updates)h(from)f(application)g(code.)-2
497 y
SDict begin H.S end
 -2 497 a -2 497 a
SDict begin 13 H.A end
 -2 497 a -2 497 a
SDict begin [/View [/XYZ H.V]/Dest (0:3364) cvn /DEST pdfmark end
 -2 497 a 396
807 a Fb(5.3.4.)36 b(Clone)e(Subtrees)1605 807 y
SDict begin H.S end
 1605
807 a 1605 807 a
SDict begin 18.72 H.A end
 1605 807 a 1605 807 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.24.2) cvn /DEST pdfmark end
 1605 807 a -2
975 a
SDict begin H.S end
 -2 975 a -2 975 a
SDict begin 13 H.A end
 -2 975 a -2 975 a
SDict begin [/View [/XYZ H.V]/Dest (0:3366) cvn /DEST pdfmark end
 -2 975 a 396
1081 a Fk(A)21 b(realistic)g(k)o(e)o(y-v)n(alue)d(cache)h(will)i(get)f
(lar)o(ge,)f(and)h(clients)h(will)f(usually)g(be)g(interested)g(only)f
(in)h(parts)h(of)e(the)i(cache.)396 1189 y(W)-7 b(orking)20
b(with)g(a)h(subtree)e(is)i(f)o(airly)f(simple.)g(The)g(client)g(has)g
(to)h(tell)g(the)f(serv)o(er)f(the)h(subtree)g(when)f(it)i(mak)o(es)f
(a)h(state)396 1297 y(request,)f(and)f(it)i(has)g(to)f(specify)f(the)i
(same)f(subtree)f(when)h(it)h(subscribes)f(to)g(updates.)-2
1481 y
SDict begin H.S end
 -2 1481 a -2 1481 a
SDict begin 13 H.A end
 -2 1481 a -2 1481 a
SDict begin [/View [/XYZ H.V]/Dest (0:3367) cvn /DEST pdfmark end
 -2 1481
a 396 1571 a Fk(There)g(are)g(a)g(couple)f(of)h(common)f(syntax)o(es)g
(for)h(trees.)g(One)g(is)h(the)f("path)g(hierarchy",)d(and)j(another)f
(is)i(the)f("topic)396 1679 y(tree".)g(These)g(look)f(lik)o(e:)-2
1680 y
SDict begin H.S end
 -2 1680 a -2 1680 a
SDict begin 13 H.A end
 -2 1680 a -2 1680 a
SDict begin [/View [/XYZ H.V]/Dest (0:3368) cvn /DEST pdfmark end
 -2 1680
a -2 1690 a
SDict begin H.S end
 -2 1690 a -2 1690 a
SDict begin 13 H.A end
 -2 1690 a -2 1690 a
SDict begin [/View [/XYZ H.V]/Dest (0:3369) cvn /DEST pdfmark end
 -2
1690 a Black 396 1849 a Fj(\225)p Black 479 1849 a
SDict begin H.S end
 479
1849 a 479 1849 a
SDict begin 13 H.A end
 479 1849 a 479 1849 a
SDict begin [/View [/XYZ H.V]/Dest (0:3370) cvn /DEST pdfmark end
 479 1849 a Fk(P)o(ath)h
(hierarchy:)e("/some/list/of/paths")-2 1867 y
SDict begin H.S end
 -2 1867
a -2 1867 a
SDict begin 13 H.A end
 -2 1867 a -2 1867 a
SDict begin [/View [/XYZ H.V]/Dest (0:3371) cvn /DEST pdfmark end
 -2 1867 a Black 396 1999
a Fj(\225)p Black 479 1999 a
SDict begin H.S end
 479 1999 a 479 1999 a
SDict begin 13 H.A end
 479
1999 a 479 1999 a
SDict begin [/View [/XYZ H.V]/Dest (0:3372) cvn /DEST pdfmark end
 479 1999 a Fk(T)-7 b(opic)20 b(tree:)g
("some.list.of.topics")-2 2183 y
SDict begin H.S end
 -2 2183 a -2 2183 a
SDict begin 13 H.A end

-2 2183 a -2 2183 a
SDict begin [/View [/XYZ H.V]/Dest (0:3373) cvn /DEST pdfmark end
 -2 2183 a 396 2273 a Fk(W)-7 b(e')o(ll)22
b(use)e(the)g(path)g(hierarchy)-5 b(,)17 b(and)j(e)o(xtend)f(our)g
(client)h(and)g(serv)o(er)f(so)i(that)f(a)h(client)f(can)g(w)o(ork)f
(with)i(a)f(single)396 2381 y(subtree.)f(W)-7 b(orking)19
b(with)h(multiple)f(subtrees)g(is)i(not)e(much)g(more)g(dif)n
(\002cult,)g(we)h(w)o(on')o(t)f(do)g(that)h(here)f(b)n(ut)h(it')-5
b(s)21 b(a)f(tri)n(vial)396 2489 y(e)o(xtension.)-2 2655
y
SDict begin H.S end
 -2 2655 a -2 2655 a
SDict begin 13 H.A end
 -2 2655 a -2 2655 a
SDict begin [/View [/XYZ H.V]/Dest (0:3374) cvn /DEST pdfmark end
 -2 2655 a 396
2763 a Fk(Here')-5 b(s)21 b(the)f(serv)o(er)m(,)f(a)h(small)h(v)n
(ariation)e(on)h(Model)f(Three:)-2 2775 y
SDict begin H.S end
 -2 2775 a -2
2775 a
SDict begin 13 H.A end
 -2 2775 a -2 2775 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv4-c) cvn /DEST pdfmark
end
 -2 2775 a 396 2964 a Fg(Example)i(5-25.)d
(Clone)j(ser)o(v)o(er)-8 b(,)20 b(Model)h(F)n(our)f(\(clonesr)o(v4.c\))
-2 3064 y
SDict begin H.S end
 -2 3064 a -2 3064 a
SDict begin 11.7 H.A end
 -2 3064 a -2 3064 a
SDict begin [/View [/XYZ H.V]/Dest (0:3377) cvn /DEST pdfmark end
 -2
3064 a 396 3144 a Fe(//)396 3241 y(//)90 b(Clone)44 b(server)f(Model)h
(Four)396 3338 y(//)396 3533 y(//)90 b(Lets)44 b(us)g(build)g(this)g
(source)g(without)g(creating)f(a)i(library)396 3630 y(#include)f
("kvsimple.c")396 3824 y(//)90 b(Routing)43 b(information)g(for)i(a)f
(key-value)g(snapshot)396 3921 y(typedef)g(struct)g({)576
4018 y(void)800 4031 y(*)845 4018 y(socket;)492 b(//)89
b(ROUTER)44 b(socket)g(to)g(send)g(to)576 4115 y(zframe_t)979
4128 y(*)1024 4115 y(identity;)223 b(//)89 b(Identity)43
b(of)i(peer)f(who)g(requested)g(state)576 4213 y(char)800
4226 y(*)845 4213 y(subtree;)447 b(//)89 b(Client)44
b(subtree)f(specification)396 4310 y(})i(kvroute_t;)396
4504 y(//)90 b(Send)44 b(one)g(state)g(snapshot)g(key-value)f(pair)h
(to)h(a)f(socket)396 4601 y(//)90 b(Hash)44 b(item)g(data)g(is)h(our)f
(kvmsg)g(object,)g(ready)g(to)g(send)396 4698 y(static)g(int)396
4795 y(s_send_single)f(\(const)h(char)1562 4808 y(*)1607
4795 y(key,)g(void)2055 4808 y(*)2100 4795 y(data,)g(void)2593
4808 y(*)2638 4795 y(args\))396 4892 y({)576 4990 y(kvroute_t)1024
5003 y(*)1069 4990 y(kvroute)f(=)i(\(kvroute_t)2010 5003
y(*)2055 4990 y(\))g(args;)576 5087 y(kvmsg_t)934 5100
y(*)979 5087 y(kvmsg)f(=)h(\(kvmsg_t)1741 5100 y(*)1786
5087 y(\))g(data;)p Black 3759 5569 a Ff(278)p Black
eop end
%%Page: 279 292
TeXDict begin 279 291 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.279) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(if)44 b(\(strlen)g(\(kvroute->subtree\))e(<=)i
(strlen)g(\(kvmsg_key)f(\(kvmsg\)\))576 170 y(&&)89 b(memcmp)44
b(\(kvroute->subtree,)1114 267 y(kvmsg_key)f(\(kvmsg\),)g(strlen)h
(\(kvroute->subtree\)\))e(==)i(0\))h({)755 364 y(//)89
b(Send)44 b(identity)g(of)g(recipient)g(first)755 461
y(zframe_send)f(\(&kvroute->identity,)934 558 y(kvroute->socket,)f
(ZFRAME_MORE)h(+)i(ZFRAME_REUSE\);)755 655 y(kvmsg_send)e(\(kvmsg,)h
(kvroute->socket\);)576 752 y(})576 850 y(return)f(0;)396
947 y(})396 1141 y(//)90 b(The)44 b(main)g(task)g(is)h(identical)e(to)i
(clonesrv3)e(except)h(for)g(where)g(it)396 1238 y(//)90
b(handles)43 b(subtrees.)396 1335 y(...)934 1432 y(//)90
b(Request)43 b(is)i(in)f(second)g(frame)g(of)h(message)934
1530 y(char)1158 1543 y(*)1203 1530 y(request)f(=)h(zstr_recv)e
(\(snapshot\);)934 1627 y(char)1158 1640 y(*)1203 1627
y(subtree)h(=)h(NULL;)934 1724 y(if)g(\(streq)f(\(request,)f
("ICANHAZ?"\)\))g({)1114 1821 y(free)h(\(request\);)1114
1918 y(subtree)f(=)i(zstr_recv)e(\(snapshot\);)934 2015
y(})396 2112 y(...)934 2209 y(//)90 b(Send)44 b(state)g(snapshot)f(to)i
(client)934 2307 y(kvroute_t)f(routing)f(=)i({)g(snapshot,)e(identity,)
g(subtree)h(};)396 2404 y(...)934 2501 y(//)90 b(Now)44
b(send)g(END)g(message)g(with)g(sequence)g(number)934
2598 y(printf)g(\("I:)g(sending)g(shapshot=\045d\\n",)e(\(int\))i
(sequence\);)934 2695 y(zframe_send)f(\(&identity,)g(snapshot,)h
(ZFRAME_MORE\);)934 2792 y(kvmsg_t)1293 2805 y(*)1338
2792 y(kvmsg)g(=)g(kvmsg_new)g(\(sequence\);)934 2889
y(kvmsg_set_key)88 b(\(kvmsg,)43 b("KTHXBAI"\);)934 2987
y(kvmsg_set_body)g(\(kvmsg,)g(\(byte)2234 3000 y(*)2279
2987 y(\))i(subtree,)e(0\);)934 3084 y(kvmsg_send)223
b(\(kvmsg,)43 b(snapshot\);)934 3181 y(kvmsg_destroy)g(\(&kvmsg\);)934
3278 y(free)h(\(subtree\);)755 3375 y(})576 3472 y(})396
3569 y(...)-2 3737 y
SDict begin H.S end
 -2 3737 a -2 3737 a
SDict begin 13 H.A end
 -2 3737 a -2
3737 a
SDict begin [/View [/XYZ H.V]/Dest (0:3378) cvn /DEST pdfmark end
 -2 3737 a 396 3843 a Fk(And)20 b(here)g(is)h(the)f(client:)-2
3844 y
SDict begin H.S end
 -2 3844 a -2 3844 a
SDict begin 13 H.A end
 -2 3844 a -2 3844 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli4-c) cvn /DEST pdfmark
end
 -2 3844
a 396 4045 a Fg(Example)h(5-26.)d(Clone)j(client,)f(Model)h(F)n(our)f
(\(clonecli4.c\))-2 4145 y
SDict begin H.S end
 -2 4145 a -2 4145 a
SDict begin 11.7 H.A end
 -2 4145
a -2 4145 a
SDict begin [/View [/XYZ H.V]/Dest (0:3381) cvn /DEST pdfmark end
 -2 4145 a 396 4225 a Fe(//)396 4322 y(//)90
b(Clone)44 b(client)f(Model)h(Four)396 4419 y(//)396
4613 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)g
(creating)f(a)i(library)396 4711 y(#include)f("kvsimple.c")396
4905 y(//)90 b(This)44 b(client)g(is)g(identical)f(to)i(clonecli3)e
(except)h(for)g(where)g(we)396 5002 y(//)90 b(handles)43
b(subtrees.)396 5099 y(#define)h(SUBTREE)g("/client/")p
Black 3759 5569 a Ff(279)p Black eop end
%%Page: 280 293
TeXDict begin 280 292 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.280) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:3390) cvn /DEST pdfmark end
 -2 -201 a 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e
(Publish-Subscribe)p Black 396 72 a Fe(...)576 170 y(zsocket_connect)42
b(\(subscriber,)h("tcp://localhost:5557"\);)576 267 y
(zsockopt_set_subscribe)e(\(subscriber,)i(SUBTREE\);)396
364 y(...)576 461 y(//)89 b(We)44 b(first)g(request)g(a)h(state)f
(snapshot:)576 558 y(int64_t)f(sequence)h(=)g(0;)576
655 y(zstr_sendm)f(\(snapshot,)g("ICANHAZ?"\);)576 752
y(zstr_send)88 b(\(snapshot,)43 b(SUBTREE\);)396 850
y(...)755 947 y(//)89 b(If)45 b(we)f(timed-out,)f(generate)h(a)h
(random)e(kvmsg)755 1044 y(if)h(\(zclock_time)f(\(\))i(>=)f(alarm\))g
({)934 1141 y(kvmsg_t)1293 1154 y(*)1338 1141 y(kvmsg)g(=)g(kvmsg_new)g
(\(0\);)934 1238 y(kvmsg_fmt_key)88 b(\(kvmsg,)43 b("\045s\045d",)h
(SUBTREE,)g(randof)f(\(10000\)\);)934 1335 y(kvmsg_fmt_body)g(\(kvmsg,)
g("\045d",)h(randof)g(\(1000000\)\);)934 1432 y(kvmsg_send)223
b(\(kvmsg,)43 b(publisher\);)934 1530 y(kvmsg_destroy)g(\(&kvmsg\);)934
1627 y(alarm)h(=)h(zclock_time)e(\(\))h(+)h(1000;)755
1724 y(})396 1821 y(...)-2 1905 y
SDict begin H.S end
 -2 1905 a -2 1905 a
SDict begin 13 H.A end

-2 1905 a -2 1905 a
SDict begin [/View [/XYZ H.V]/Dest (0:3382) cvn /DEST pdfmark end
 -2 1905 a 396 2232 a Fb(5.3.5.)36
b(Ephemeral)e(V)-7 b(alues)1750 2232 y
SDict begin H.S end
 1750 2232 a 1750
2232 a
SDict begin 18.72 H.A end
 1750 2232 a 1750 2232 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.25.2) cvn /DEST pdfmark end
 1750 2232 a -2 2423 a
SDict begin H.S end

-2 2423 a -2 2423 a
SDict begin 13 H.A end
 -2 2423 a -2 2423 a
SDict begin [/View [/XYZ H.V]/Dest (0:3384) cvn /DEST pdfmark end
 -2 2423 a 396
2506 a Fk(An)20 b(ephemeral)f(v)n(alue)h(is)h(one)e(that)i(e)o(xpires)e
(dynamically)-5 b(.)17 b(If)j(you)g(think)f(of)h(Clone)g(being)f(used)h
(for)g(a)h(DNS-lik)o(e)396 2614 y(service,)f(then)g(ephemeral)e(v)n
(alues)i(w)o(ould)f(let)i(you)e(do)h(dynamic)f(DNS.)h(A)h(node)e(joins)
i(the)f(netw)o(ork,)f(publishes)g(its)396 2722 y(address,)h(and)f
(refreshes)h(this)g(re)o(gularly)-5 b(.)18 b(If)i(the)g(node)f(dies,)i
(its)g(address)f(e)n(v)o(entually)e(gets)i(remo)o(v)o(ed.)-2
2906 y
SDict begin H.S end
 -2 2906 a -2 2906 a
SDict begin 13 H.A end
 -2 2906 a -2 2906 a
SDict begin [/View [/XYZ H.V]/Dest (0:3385) cvn /DEST pdfmark end
 -2 2906
a 396 2996 a Fk(The)g(usual)g(abstraction)f(for)h(ephemeral)e(v)n
(alues)i(is)h(to)g(attach)f(them)f(to)i(a)f("session",)g(and)g(delete)g
(them)g(when)f(the)396 3104 y(session)i(ends.)f(In)f(Clone,)h(sessions)
h(w)o(ould)f(be)g(de\002ned)f(by)h(clients,)g(and)g(w)o(ould)f(end)h
(if)g(the)g(client)h(died.)-2 3288 y
SDict begin H.S end
 -2 3288 a -2 3288
a
SDict begin 13 H.A end
 -2 3288 a -2 3288 a
SDict begin [/View [/XYZ H.V]/Dest (0:3386) cvn /DEST pdfmark end
 -2 3288 a 396 3378 a Fk(The)f(simpler)f
(alternati)n(v)o(e)g(to)h(using)g(sessions)g(is)h(to)f(de\002ne)g(e)n
(v)o(ery)e(ephemeral)g(v)n(alue)i(with)g(a)g("time)g(to)g(li)n(v)o(e")g
(that)g(tells)396 3486 y(the)g(serv)o(er)g(when)f(to)i(e)o(xpire)e(the)
h(v)n(alue.)f(Clients)i(then)f(refresh)f(v)n(alues,)h(and)f(if)i(the)o
(y)e(don')o(t,)g(the)h(v)n(alues)g(e)o(xpire.)-2 3670
y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 13 H.A end
 -2 3670 a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:3387) cvn /DEST pdfmark end
 -2 3670 a 396
3760 a Fk(I'm)g(going)f(to)h(implement)f(that)h(simpler)g(model)f
(because)h(we)h(don')o(t)d(kno)n(w)h(yet)h(that)h(it')-5
b(s)21 b(w)o(orth)f(making)e(a)j(more)396 3868 y(comple)o(x)e(one.)g
(The)h(dif)n(ference)e(is)j(really)f(in)g(performance.)d(If)j(clients)h
(ha)n(v)o(e)f(a)g(handful)f(of)g(ephemeral)g(v)n(alues,)h(it')-5
b(s)396 3976 y(\002ne)20 b(to)g(set)h(a)f(TTL)f(on)h(each)f(one.)g(If)g
(clients)i(use)e(masses)i(of)e(ephemeral)g(v)n(alues,)g(it')-5
b(s)20 b(more)f(ef)n(\002cient)h(to)g(attach)f(them)396
4083 y(to)i(sessions,)f(and)g(e)o(xpire)f(them)h(in)g(b)n(ulk.)-2
4267 y
SDict begin H.S end
 -2 4267 a -2 4267 a
SDict begin 13 H.A end
 -2 4267 a -2 4267 a
SDict begin [/View [/XYZ H.V]/Dest (0:3388) cvn /DEST pdfmark end
 -2 4267
a 396 4357 a Fk(First)h(of)n(f,)f(we)g(need)g(a)g(w)o(ay)g(to)h(encode)
e(the)h(TTL)g(in)g(the)g(k)o(e)o(y-v)n(alue)e(message.)i(W)-7
b(e)21 b(could)f(add)f(a)i(frame.)e(The)396 4465 y(problem)g(with)h
(using)g(frames)f(for)h(properties)f(is)i(that)f(each)g(time)g(we)h(w)o
(ant)f(to)h(add)e(a)i(ne)n(w)f(property)-5 b(,)17 b(we)k(ha)n(v)o(e)e
(to)396 4573 y(change)g(the)h(structure)g(of)g(our)f(kvmsg)g(class.)i
(It)f(breaks)g(compatibility)-5 b(.)18 b(So)i(let')-5
b(s)21 b(add)f(a)h('properties')d(frame)h(to)h(the)396
4681 y(message,)g(and)g(code)f(to)i(let)f(us)h(get)f(and)g(put)g
(property)e(v)n(alues.)p Black 3759 5569 a Ff(280)p Black
eop end
%%Page: 281 294
TeXDict begin 281 293 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.281) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3389) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Ne)o(xt,)i(we)g(need)g(a)h(w)o(ay)f(to)g(say)-5
b(,)20 b("delete)g(this)h(v)n(alue".)e(Up)h(to)g(no)n(w)g(serv)o(ers)g
(and)f(clients)i(ha)n(v)o(e)e(al)o(w)o(ays)i(blindly)396
180 y(inserted)f(or)g(updated)e(ne)n(w)i(v)n(alues)g(into)g(their)g
(hash)g(table.)g(W)-7 b(e')o(ll)21 b(say)g(that)f(if)g(the)h(v)n(alue)e
(is)i(empty)-5 b(,)19 b(that)h(means)396 288 y("delete)g(this)h(k)o(e)o
(y".)396 562 y(Here')-5 b(s)21 b(a)f(more)g(complete)f(v)o(ersion)g(of)
h(the)g(kvmsg)f(class,)i(which)f(implements)f(a)h('properties')e(frame)
i(\(and)f(adds)h(a)396 670 y(UUID)g(frame,)g(which)f(we')o(ll)i(need)e
(later)i(on\).)e(It)h(also)h(handles)e(empty)g(v)n(alues)h(by)g
(deleting)f(the)h(k)o(e)o(y)g(from)f(the)h(hash,)396
778 y(if)h(necessary:)-2 796 y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796
a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c) cvn /DEST pdfmark end
 -2 796 a 396 979 a Fg(Example)g(5-27.)d(K)n(ey-v)o(alue)h
(message)h(class)h(-)f(full)h(\(kvmsg)o(.c\))-2 1079
y
SDict begin H.S end
 -2 1079 a -2 1079 a
SDict begin 11.7 H.A end
 -2 1079 a -2 1079 a
SDict begin [/View [/XYZ H.V]/Dest (0:3393) cvn /DEST pdfmark end
 -2 1079 a 396
1160 a Fe(/)441 1173 y(*)576 1160 y
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)441 1270 y(*)576 1257 y(kvmsg)44
b(-)g(key-value)g(message)f(class)h(for)h(example)e(applications)441
1367 y(*)576 1354 y(=====================================)o(======)o
(======)o(======)o(======)o(=====)o(===)3714 1367 y(*)3759
1354 y(/)396 1548 y(#include)h("kvmsg.h")396 1645 y(#include)g
(<uuid/uuid.h>)396 1742 y(#include)g("zlist.h")396 1937
y(//)90 b(Keys)44 b(are)g(short)g(strings)396 2034 y(#define)g
(KVMSG_KEY_MAX)132 b(255)396 2228 y(//)90 b(Message)43
b(is)i(formatted)e(on)i(wire)f(as)g(4)h(frames:)396 2325
y(//)90 b(frame)44 b(0:)g(key)g(\(0MQ)h(string\))396
2422 y(//)90 b(frame)44 b(1:)g(sequence)g(\(8)g(bytes,)g(network)g
(order\))396 2520 y(//)90 b(frame)44 b(2:)g(uuid)g(\(blob,)g(16)h
(bytes\))396 2617 y(//)90 b(frame)44 b(3:)g(properties)f(\(0MQ)h
(string\))396 2714 y(//)90 b(frame)44 b(4:)g(body)g(\(blob\))396
2811 y(#define)g(FRAME_KEY)312 b(0)396 2908 y(#define)44
b(FRAME_SEQ)312 b(1)396 3005 y(#define)44 b(FRAME_UUID)267
b(2)396 3102 y(#define)44 b(FRAME_PROPS)222 b(3)396 3200
y(#define)44 b(FRAME_BODY)267 b(4)396 3297 y(#define)44
b(KVMSG_FRAMES)177 b(5)396 3491 y(//)90 b(Structure)43
b(of)h(our)h(class)396 3588 y(struct)f(_kvmsg)g({)576
3685 y(//)89 b(Presence)43 b(indicators)h(for)g(each)g(frame)576
3782 y(int)g(present)g([KVMSG_FRAMES];)576 3879 y(//)89
b(Corresponding)43 b(0MQ)h(message)g(frames,)f(if)i(any)576
3977 y(zmq_msg_t)e(frame)h([KVMSG_FRAMES];)576 4074 y(//)89
b(Key,)44 b(copied)g(into)g(safe)g(C)h(string)576 4171
y(char)f(key)g([KVMSG_KEY_MAX)f(+)h(1];)576 4268 y(//)89
b(List)44 b(of)h(properties,)e(as)h(name=value)f(strings)576
4365 y(zlist_t)934 4378 y(*)979 4365 y(props;)576 4462
y(size_t)g(props_size;)396 4559 y(};)-2 4734 y
SDict begin H.S end
 -2 4734
a -2 4734 a
SDict begin 13 H.A end
 -2 4734 a -2 4734 a
SDict begin [/View [/XYZ H.V]/Dest (0:3394) cvn /DEST pdfmark end
 -2 4734 a 396 4833 a
Fk(These)20 b(tw)o(o)h(helpers)e(serialize)i(a)f(list)i(of)d
(properties)g(to)i(and)e(from)g(a)i(message)f(frame:)-2
4851 y
SDict begin H.S end
 -2 4851 a -2 4851 a
SDict begin 13 H.A end
 -2 4851 a -2 4851 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-1) cvn /DEST pdfmark
end
 -2 4851
a Black 3759 5569 a Ff(281)p Black eop end
%%Page: 282 295
TeXDict begin 282 294 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.282) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-28.)d(K)n(ey-v)o(alue)h(message)h(class)h
(-)f(full)h(\(kvmsg)o(.c\))e(-)i(pr)o(operty)d(encoding)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3397) cvn /DEST pdfmark end
 -2 172 a 396
350 a Fe(static)44 b(void)396 447 y(s_encode_props)f(\(kvmsg_t)1472
460 y(*)1517 447 y(self\))396 544 y({)576 641 y(zmq_msg_t)1024
654 y(*)1069 641 y(msg)h(=)h(&self->frame)e([FRAME_PROPS];)576
738 y(if)h(\(self->present)f([FRAME_PROPS]\))755 835
y(zmq_msg_close)g(\(msg\);)576 1030 y(zmq_msg_init_size)f(\(msg,)i
(self->props_size\);)576 1127 y(char)800 1140 y(*)845
1127 y(prop)g(=)g(zlist_first)f(\(self->props\);)576
1224 y(char)800 1237 y(*)845 1224 y(dest)h(=)g(\(char)1427
1237 y(*)1472 1224 y(\))h(zmq_msg_data)e(\(msg\);)576
1321 y(while)h(\(prop\))f({)755 1418 y(strcpy)h(\(dest,)g(prop\);)755
1515 y(dest)g(+=)h(strlen)e(\(prop\);)755 1626 y(*)800
1613 y(dest++)h(=)g('\\n';)755 1710 y(prop)g(=)h(zlist_next)e
(\(self->props\);)576 1807 y(})576 1904 y(self->present)f
([FRAME_PROPS])h(=)i(1;)396 2001 y(})396 2195 y(static)f(void)396
2292 y(s_decode_props)f(\(kvmsg_t)1472 2305 y(*)1517
2292 y(self\))396 2390 y({)576 2487 y(zmq_msg_t)1024
2500 y(*)1069 2487 y(msg)h(=)h(&self->frame)e([FRAME_PROPS];)576
2584 y(self->props_size)f(=)i(0;)576 2681 y(while)g(\(zlist_size)f
(\(self->props\)\))755 2778 y(free)h(\(zlist_pop)f(\(self->props\)\);)
576 2972 y(size_t)g(remainder)h(=)g(zmq_msg_size)f(\(msg\);)576
3070 y(char)800 3083 y(*)845 3070 y(prop)h(=)g(\(char)1427
3083 y(*)1472 3070 y(\))h(zmq_msg_data)e(\(msg\);)576
3167 y(char)800 3180 y(*)845 3167 y(eoln)h(=)g(memchr)g(\(prop,)g
('\\n',)g(remainder\);)576 3264 y(while)g(\(eoln\))f({)755
3374 y(*)800 3361 y(eoln)h(=)h(0;)755 3458 y(zlist_append)e
(\(self->props,)f(strdup)i(\(prop\)\);)755 3555 y(self->props_size)e
(+=)j(strlen)e(\(prop\))h(+)h(1;)755 3652 y(remainder)e(-=)i(strlen)f
(\(prop\))f(+)i(1;)755 3750 y(prop)f(=)h(eoln)f(+)h(1;)755
3847 y(eoln)f(=)h(memchr)f(\(prop,)f('\\n',)h(remainder\);)576
3944 y(})396 4041 y(})-2 4215 y
SDict begin H.S end
 -2 4215 a -2 4215 a
SDict begin 13 H.A end
 -2
4215 a -2 4215 a
SDict begin [/View [/XYZ H.V]/Dest (0:3398) cvn /DEST pdfmark end
 -2 4215 a 396 4315 a Fk(Here)20 b(are)g(the)h
(constructor)d(and)i(destructor)e(for)i(the)g(class:)-2
4316 y
SDict begin H.S end
 -2 4316 a -2 4316 a
SDict begin 13 H.A end
 -2 4316 a -2 4316 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-2) cvn /DEST pdfmark
end
 -2 4316
a 396 4516 a Fg(Example)h(5-29.)d(K)n(ey-v)o(alue)h(message)h(class)h
(-)f(full)h(\(kvmsg)o(.c\))e(-)i(constructor)e(and)h(destructor)-2
4616 y
SDict begin H.S end
 -2 4616 a -2 4616 a
SDict begin 11.7 H.A end
 -2 4616 a -2 4616 a
SDict begin [/View [/XYZ H.V]/Dest (0:3401) cvn /DEST pdfmark end
 -2 4616
a 396 4794 a Fe(//)90 b(Constructor,)42 b(takes)i(a)h(sequence)f
(number)f(for)i(the)f(new)g(kvmsg)g(instance:)396 4891
y(kvmsg_t)755 4904 y(*)396 4988 y(kvmsg_new)g(\(int64_t)f(sequence\))
396 5085 y({)p Black 3759 5569 a Ff(282)p Black eop end
%%Page: 283 296
TeXDict begin 283 295 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.283) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(kvmsg_t)755 183 y(*)800 170 y(self;)576
364 y(self)44 b(=)g(\(kvmsg_t)1293 377 y(*)1338 364 y(\))g(zmalloc)g
(\(sizeof)g(\(kvmsg_t\)\);)576 461 y(self->props)f(=)h(zlist_new)g
(\(\);)576 558 y(kvmsg_set_sequence)d(\(self,)j(sequence\);)576
655 y(return)f(self;)396 752 y(})396 947 y(//)90 b(zhash_free_fn)42
b(callback)i(helper)g(that)g(does)g(the)g(low)h(level)f(destruction:)
396 1044 y(void)396 1141 y(kvmsg_free)f(\(void)1158 1154
y(*)1203 1141 y(ptr\))396 1238 y({)576 1335 y(if)h(\(ptr\))g({)755
1432 y(kvmsg_t)1114 1445 y(*)1159 1432 y(self)g(=)g(\(kvmsg_t)1876
1445 y(*)1921 1432 y(\))g(ptr;)755 1530 y(//)89 b(Destroy)44
b(message)g(frames)f(if)i(any)755 1627 y(int)f(frame_nbr;)755
1724 y(for)g(\(frame_nbr)f(=)i(0;)g(frame_nbr)e(<)i(KVMSG_FRAMES;)d
(frame_nbr++\))934 1821 y(if)j(\(self->present)d([frame_nbr]\))1114
1918 y(zmq_msg_close)g(\(&self->frame)h([frame_nbr]\);)755
2112 y(//)89 b(Destroy)44 b(property)f(list)755 2209
y(while)h(\(zlist_size)f(\(self->props\)\))934 2307 y(free)h
(\(zlist_pop)g(\(self->props\)\);)755 2404 y(zlist_destroy)f
(\(&self->props\);)755 2598 y(//)89 b(Free)44 b(object)g(itself)755
2695 y(free)g(\(self\);)576 2792 y(})396 2889 y(})396
3084 y(//)90 b(Destructor)396 3181 y(void)396 3278 y(kvmsg_destroy)43
b(\(kvmsg_t)1427 3291 y(**)1517 3278 y(self_p\))396 3375
y({)576 3472 y(assert)g(\(self_p\);)576 3569 y(if)h(\()755
3582 y(*)800 3569 y(self_p\))f({)755 3666 y(kvmsg_free)g(\()1293
3679 y(*)1338 3666 y(self_p\);)755 3777 y(*)800 3764
y(self_p)h(=)g(NULL;)576 3861 y(})396 3958 y(})-2 4132
y
SDict begin H.S end
 -2 4132 a -2 4132 a
SDict begin 13 H.A end
 -2 4132 a -2 4132 a
SDict begin [/View [/XYZ H.V]/Dest (0:3402) cvn /DEST pdfmark end
 -2 4132 a 396
4232 a Fk(The)20 b(recv)g(method)f(reads)h(a)g(k)o(e)o(y-v)n(alue)e
(message)i(from)f(sock)o(et,)h(and)g(returns)f(a)i(ne)n(w)f(kvmsg)f
(instance:)-2 4250 y
SDict begin H.S end
 -2 4250 a -2 4250 a
SDict begin 13 H.A end
 -2 4250 a -2
4250 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-3) cvn /DEST pdfmark
end
 -2 4250 a 396 4433 a Fg(Example)i(5-30.)d(K)n(ey-v)o(alue)h
(message)h(class)h(-)f(full)h(\(kvmsg)o(.c\))e(-)i(r)o(ecv)e(method)-2
4533 y
SDict begin H.S end
 -2 4533 a -2 4533 a
SDict begin 11.7 H.A end
 -2 4533 a -2 4533 a
SDict begin [/View [/XYZ H.V]/Dest (0:3405) cvn /DEST pdfmark end
 -2 4533
a 396 4711 a Fe(kvmsg_t)755 4724 y(*)396 4808 y(kvmsg_recv)43
b(\(void)1158 4821 y(*)1203 4808 y(socket\))396 4905
y({)576 5002 y(//)89 b(This)44 b(method)g(is)g(almost)g(unchanged)g
(from)g(kvsimple)396 5099 y(...)p Black 3759 5569 a Ff(283)p
Black eop end
%%Page: 284 297
TeXDict begin 284 296 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.284) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(if)44 b(\(self\))755 170 y(s_decode_props)e
(\(self\);)576 267 y(return)h(self;)396 364 y(})396 655
y(//)90 b(-------------------------------------)o(------)o(------)o
(------)o(------)o(-----)o(---)396 752 y(//)g(Send)44
b(key-value)f(message)h(to)g(socket;)g(any)g(empty)g(frames)g(are)g
(sent)h(as)f(such.)396 947 y(void)396 1044 y(kvmsg_send)f(\(kvmsg_t)
1293 1057 y(*)1338 1044 y(self,)h(void)1831 1057 y(*)1876
1044 y(socket\))396 1141 y({)576 1238 y(assert)f(\(self\);)576
1335 y(assert)g(\(socket\);)576 1530 y(s_encode_props)f(\(self\);)576
1627 y(//)89 b(The)44 b(rest)g(of)h(the)f(method)g(is)h(unchanged)e
(from)h(kvsimple)396 1724 y(...)-2 1891 y
SDict begin H.S end
 -2 1891 a -2
1891 a
SDict begin 13 H.A end
 -2 1891 a -2 1891 a
SDict begin [/View [/XYZ H.V]/Dest (0:3406) cvn /DEST pdfmark end
 -2 1891 a 396 1998 a Fk(The)20
b(dup)f(method)g(duplicates)h(a)g(kvmsg)f(instance,)h(returns)f(the)i
(ne)n(w)e(instance:)-2 2016 y
SDict begin H.S end
 -2 2016 a -2 2016 a
SDict begin 13 H.A end
 -2
2016 a -2 2016 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-4) cvn /DEST pdfmark
end
 -2 2016 a 396 2199 a Fg(Example)i(5-31.)d(K)n(ey-v)o
(alue)h(message)h(class)h(-)f(full)h(\(kvmsg)o(.c\))e(-)i(dup)g(method)
-2 2299 y
SDict begin H.S end
 -2 2299 a -2 2299 a
SDict begin 11.7 H.A end
 -2 2299 a -2 2299 a
SDict begin [/View [/XYZ H.V]/Dest (0:3409) cvn /DEST pdfmark end
 -2
2299 a 396 2476 a Fe(kvmsg_t)755 2489 y(*)396 2574 y(kvmsg_dup)44
b(\(kvmsg_t)1248 2587 y(*)1293 2574 y(self\))396 2671
y({)576 2768 y(kvmsg_t)934 2781 y(*)979 2768 y(kvmsg)g(=)h(kvmsg_new)e
(\(0\);)576 2865 y(int)h(frame_nbr;)576 2962 y(for)g(\(frame_nbr)f(=)i
(0;)f(frame_nbr)g(<)g(KVMSG_FRAMES;)f(frame_nbr++\))g({)755
3059 y(if)h(\(self->present)f([frame_nbr]\))g({)934 3156
y(zmq_msg_t)1383 3169 y(*)1428 3156 y(src)h(=)g(&self->frame)f
([frame_nbr];)934 3253 y(zmq_msg_t)1383 3266 y(*)1428
3253 y(dst)h(=)g(&kvmsg->frame)f([frame_nbr];)934 3351
y(zmq_msg_init_size)f(\(dst,)i(zmq_msg_size)f(\(src\)\);)934
3448 y(memcpy)h(\(zmq_msg_data)f(\(dst\),)1293 3545 y(zmq_msg_data)g
(\(src\),)h(zmq_msg_size)e(\(src\)\);)934 3642 y(kvmsg->present)h
([frame_nbr])g(=)h(1;)755 3739 y(})576 3836 y(})576 3933
y(kvmsg->props_size)e(=)i(zlist_size)f(\(self->props\);)576
4031 y(char)800 4044 y(*)845 4031 y(prop)h(=)g(\(char)1427
4044 y(*)1472 4031 y(\))h(zlist_first)e(\(self->props\);)576
4128 y(while)h(\(prop\))f({)755 4225 y(zlist_append)g(\(kvmsg->props,)f
(strdup)i(\(prop\)\);)755 4322 y(prop)g(=)h(\(char)1338
4335 y(*)1383 4322 y(\))f(zlist_next)f(\(self->props\);)576
4419 y(})576 4516 y(return)g(kvmsg;)396 4613 y(})396
4808 y(//)90 b(The)44 b(key,)g(sequence,)f(body,)h(and)h(size)f
(methods)g(are)g(the)g(same)g(as)h(in)f(kvsimple.)396
4905 y(...)p Black 3759 5569 a Ff(284)p Black eop end
%%Page: 285 298
TeXDict begin 285 297 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.285) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3410) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(These)i(methods)f(get/set)i(the)f(UUID)g(for)g(the)g
(k)o(e)o(y-v)n(alue)e(message:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90
a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-5) cvn /DEST pdfmark
end
 -2 90 a 396 274 a Fg(Example)j(5-32.)d(K)n(ey-v)o
(alue)h(message)h(class)h(-)f(full)h(\(kvmsg)o(.c\))e(-)i(UUID)f
(methods)-2 374 y
SDict begin H.S end
 -2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374 a
SDict begin [/View [/XYZ H.V]/Dest (0:3413) cvn /DEST pdfmark end

-2 374 a 396 551 a Fe(byte)620 564 y(*)396 648 y(kvmsg_uuid)43
b(\(kvmsg_t)1293 661 y(*)1338 648 y(self\))396 745 y({)576
843 y(assert)g(\(self\);)576 940 y(if)h(\(self->present)f([FRAME_UUID])
576 1037 y(&&)89 b(zmq_msg_size)43 b(\(&self->frame)f([FRAME_UUID]\))h
(==)i(sizeof)e(\(uuid_t\)\))755 1134 y(return)h(\(byte)1338
1147 y(*)1383 1134 y(\))g(zmq_msg_data)f(\(&self->frame)g
([FRAME_UUID]\);)576 1231 y(else)755 1328 y(return)h(NULL;)396
1425 y(})396 1620 y(//)90 b(Sets)44 b(the)g(UUID)g(to)h(a)f(random)g
(generated)g(value)396 1717 y(void)396 1814 y(kvmsg_set_uuid)f
(\(kvmsg_t)1472 1827 y(*)1517 1814 y(self\))396 1911
y({)576 2008 y(assert)g(\(self\);)576 2105 y(zmq_msg_t)1024
2118 y(*)1069 2105 y(msg)h(=)h(&self->frame)e([FRAME_UUID];)576
2202 y(uuid_t)g(uuid;)576 2300 y(uuid_generate)f(\(uuid\);)576
2397 y(if)i(\(self->present)f([FRAME_UUID]\))755 2494
y(zmq_msg_close)g(\(msg\);)576 2591 y(zmq_msg_init_size)f(\(msg,)i
(sizeof)f(\(uuid\)\);)576 2688 y(memcpy)g(\(zmq_msg_data)g(\(msg\),)h
(uuid,)g(sizeof)g(\(uuid\)\);)576 2785 y(self->present)e([FRAME_UUID])h
(=)i(1;)396 2882 y(})-2 3057 y
SDict begin H.S end
 -2 3057 a -2 3057 a
SDict begin 13 H.A end
 -2
3057 a -2 3057 a
SDict begin [/View [/XYZ H.V]/Dest (0:3414) cvn /DEST pdfmark end
 -2 3057 a 396 3156 a Fk(These)20 b(methods)f(get/set)i
(a)g(speci\002ed)e(message)h(property:)-2 3174 y
SDict begin H.S end
 -2 3174
a -2 3174 a
SDict begin 13 H.A end
 -2 3174 a -2 3174 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-6) cvn /DEST pdfmark
end
 -2 3174 a 396 3358 a
Fg(Example)h(5-33.)d(K)n(ey-v)o(alue)h(message)h(class)h(-)f(full)h
(\(kvmsg)o(.c\))e(-)i(pr)o(operty)d(methods)-2 3458 y
SDict begin H.S end

-2 3458 a -2 3458 a
SDict begin 11.7 H.A end
 -2 3458 a -2 3458 a
SDict begin [/View [/XYZ H.V]/Dest (0:3417) cvn /DEST pdfmark end
 -2 3458 a 396
3732 a Fe(//)90 b(Get)44 b(message)g(property,)f(return)h("")g(if)h(no)
f(such)g(property)g(is)g(defined.)396 3829 y(char)620
3842 y(*)396 3926 y(kvmsg_get_prop)f(\(kvmsg_t)1472 3939
y(*)1517 3926 y(self,)h(char)2010 3939 y(*)2055 3926
y(name\))396 4023 y({)576 4121 y(assert)f(\(strchr)h(\(name,)g('='\))g
(==)h(NULL\);)576 4218 y(char)800 4231 y(*)845 4218 y(prop)f(=)g
(zlist_first)f(\(self->props\);)576 4315 y(size_t)g(namelen)h(=)h
(strlen)f(\(name\);)576 4412 y(while)g(\(prop\))f({)755
4509 y(if)h(\(strlen)g(\(prop\))g(>)h(namelen)755 4606
y(&&)89 b(memcmp)44 b(\(prop,)g(name,)g(namelen\))f(==)i(0)755
4703 y(&&)89 b(prop)44 b([namelen])g(==)g('='\))934 4801
y(return)g(prop)g(+)h(namelen)f(+)g(1;)755 4898 y(prop)g(=)h
(zlist_next)e(\(self->props\);)576 4995 y(})576 5092
y(return)g("";)p Black 3759 5569 a Ff(285)p Black eop
end
%%Page: 286 299
TeXDict begin 286 298 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.286) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(})396 364 y(//)90 b(Set)44 b(message)g(property.)f
(Property)g(name)i(cannot)e(contain)h('='.)g(Max)h(length)e(of)396
461 y(//)90 b(value)44 b(is)g(255)g(chars.)396 558 y(void)396
655 y(kvmsg_set_prop)f(\(kvmsg_t)1472 668 y(*)1517 655
y(self,)h(char)2010 668 y(*)2055 655 y(name,)g(char)2548
668 y(*)2593 655 y(format,)g(...\))396 752 y({)576 850
y(assert)f(\(strchr)h(\(name,)g('='\))g(==)h(NULL\);)576
1044 y(char)f(value)g([255)g(+)h(1];)576 1141 y(va_list)e(args;)576
1238 y(assert)g(\(self\);)576 1335 y(va_start)g(\(args,)h(format\);)576
1432 y(vsnprintf)f(\(value,)h(255,)g(format,)f(args\);)576
1530 y(va_end)g(\(args\);)576 1724 y(//)89 b(Allocate)43
b(name=value)h(string)576 1821 y(char)800 1834 y(*)845
1821 y(prop)g(=)g(malloc)g(\(strlen)g(\(name\))g(+)g(strlen)g
(\(value\))g(+)h(2\);)576 2015 y(//)89 b(Remove)44 b(existing)f
(property)h(if)g(any)576 2112 y(sprintf)f(\(prop,)h("\045s=",)g
(name\);)576 2209 y(char)800 2222 y(*)845 2209 y(existing)f(=)i
(zlist_first)e(\(self->props\);)576 2307 y(while)h(\(existing\))f({)755
2404 y(if)h(\(memcmp)g(\(prop,)g(existing,)f(strlen)h(\(prop\)\))g(==)g
(0\))h({)934 2501 y(self->props_size)d(-=)j(strlen)f(\(existing\))f(+)i
(1;)934 2598 y(zlist_remove)e(\(self->props,)g(existing\);)934
2695 y(free)h(\(existing\);)934 2792 y(break;)755 2889
y(})755 2987 y(existing)f(=)i(zlist_next)e(\(self->props\);)576
3084 y(})576 3181 y(//)89 b(Add)44 b(new)h(name=value)e(property)g
(string)576 3278 y(strcat)g(\(prop,)h(value\);)576 3375
y(zlist_append)e(\(self->props,)h(prop\);)576 3472 y(self->props_size)f
(+=)i(strlen)g(\(prop\))g(+)h(1;)396 3569 y(})-2 3744
y
SDict begin H.S end
 -2 3744 a -2 3744 a
SDict begin 13 H.A end
 -2 3744 a -2 3744 a
SDict begin [/View [/XYZ H.V]/Dest (0:3418) cvn /DEST pdfmark end
 -2 3744 a 396
3843 a Fk(The)20 b(store)g(method)f(stores)h(the)g(k)o(e)o(y-v)n(alue)e
(message)i(into)g(a)g(hash)g(map,)f(unless)h(the)g(k)o(e)o(y)g(and)f(v)
n(alue)h(are)g(both)f(null.)g(It)396 3951 y(nulli\002es)i(the)f(kvmsg)f
(reference)f(so)j(that)f(the)h(object)e(is)i(o)n(wned)e(by)h(the)g
(hash)g(map,)g(not)g(the)g(caller:)-2 3969 y
SDict begin H.S end
 -2 3969
a -2 3969 a
SDict begin 13 H.A end
 -2 3969 a -2 3969 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-7) cvn /DEST pdfmark
end
 -2 3969 a 396 4153 a
Fg(Example)h(5-34.)d(K)n(ey-v)o(alue)h(message)h(class)h(-)f(full)h
(\(kvmsg)o(.c\))e(-)i(stor)o(e)e(method)-2 4252 y
SDict begin H.S end
 -2
4252 a -2 4252 a
SDict begin 11.7 H.A end
 -2 4252 a -2 4252 a
SDict begin [/View [/XYZ H.V]/Dest (0:3421) cvn /DEST pdfmark end
 -2 4252 a 396 4430
a Fe(void)396 4527 y(kvmsg_store)43 b(\(kvmsg_t)1338
4540 y(**)1428 4527 y(self_p,)g(zhash_t)2145 4540 y(*)2190
4527 y(hash\))396 4624 y({)576 4721 y(assert)g(\(self_p\);)576
4818 y(if)h(\()755 4831 y(*)800 4818 y(self_p\))f({)755
4916 y(kvmsg_t)1114 4929 y(*)1159 4916 y(self)h(=)1472
4929 y(*)1517 4916 y(self_p;)755 5013 y(assert)g(\(self\);)755
5110 y(if)g(\(kvmsg_size)f(\(self\)\))h({)p Black 3757
5569 a Ff(286)p Black eop end
%%Page: 287 300
TeXDict begin 287 299 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.287) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 934 72 a Fe(if)45 b(\(self->present)d([FRAME_KEY])934
170 y(&&)90 b(self->present)42 b([FRAME_BODY]\))h({)1114
267 y(zhash_update)f(\(hash,)i(kvmsg_key)g(\(self\),)f(self\);)1114
364 y(zhash_freefn)f(\(hash,)i(kvmsg_key)g(\(self\),)f(kvmsg_free\);)
934 461 y(})755 558 y(})755 655 y(else)934 752 y(zhash_delete)g
(\(hash,)h(kvmsg_key)f(\(self\)\);)755 960 y(*)800 947
y(self_p)h(=)g(NULL;)576 1044 y(})396 1141 y(})-2 1315
y
SDict begin H.S end
 -2 1315 a -2 1315 a
SDict begin 13 H.A end
 -2 1315 a -2 1315 a
SDict begin [/View [/XYZ H.V]/Dest (0:3422) cvn /DEST pdfmark end
 -2 1315 a 396
1415 a Fk(The)20 b(dump)f(method)g(e)o(xtends)g(the)h(kvsimple)f
(implementation)f(with)j(support)e(for)g(message)h(properties:)-2
1433 y
SDict begin H.S end
 -2 1433 a -2 1433 a
SDict begin 13 H.A end
 -2 1433 a -2 1433 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-8) cvn /DEST pdfmark
end
 -2 1433
a 396 1616 a Fg(Example)h(5-35.)d(K)n(ey-v)o(alue)h(message)h(class)h
(-)f(full)h(\(kvmsg)o(.c\))e(-)i(dump)g(method)-2 1716
y
SDict begin H.S end
 -2 1716 a -2 1716 a
SDict begin 11.7 H.A end
 -2 1716 a -2 1716 a
SDict begin [/View [/XYZ H.V]/Dest (0:3425) cvn /DEST pdfmark end
 -2 1716 a 396
1894 a Fe(void)396 1991 y(kvmsg_dump)43 b(\(kvmsg_t)1293
2004 y(*)1338 1991 y(self\))396 2088 y({)396 2185 y(...)755
2282 y(fprintf)h(\(stderr,)f("[size:\045zd])g(",)i(size\);)755
2379 y(if)f(\(zlist_size)f(\(self->props\)\))g({)934
2476 y(fprintf)h(\(stderr,)f("["\);)934 2574 y(char)1158
2587 y(*)1203 2574 y(prop)h(=)h(zlist_first)e(\(self->props\);)934
2671 y(while)h(\(prop\))g({)1114 2768 y(fprintf)f(\(stderr,)h
("\045s;",)g(prop\);)1114 2865 y(prop)g(=)g(zlist_next)g
(\(self->props\);)934 2962 y(})934 3059 y(fprintf)g(\(stderr,)f("]"\);)
755 3156 y(})396 3253 y(...)-2 3421 y
SDict begin H.S end
 -2 3421 a -2 3421
a
SDict begin 13 H.A end
 -2 3421 a -2 3421 a
SDict begin [/View [/XYZ H.V]/Dest (0:3426) cvn /DEST pdfmark end
 -2 3421 a 396 3527 a Fk(The)20
b(selftest)h(method)e(is)i(the)f(same)h(as)f(in)h(kvsimple)e(with)h
(added)f(support)g(for)h(the)g(uuid)f(and)h(property)e(features)i(of)
396 3635 y(kvmsg:)-2 3653 y
SDict begin H.S end
 -2 3653 a -2 3653 a
SDict begin 13 H.A end
 -2 3653
a -2 3653 a
SDict begin [/View [/XYZ H.V]/Dest (0:kvmsg-c-9) cvn /DEST pdfmark
end
 -2 3653 a 396 3837 a Fg(Example)h(5-36.)d(K)n(ey-v)o(alue)h
(message)h(class)h(-)f(full)h(\(kvmsg)o(.c\))e(-)i(test)f(method)-2
3937 y
SDict begin H.S end
 -2 3937 a -2 3937 a
SDict begin 11.7 H.A end
 -2 3937 a -2 3937 a
SDict begin [/View [/XYZ H.V]/Dest (0:3429) cvn /DEST pdfmark end
 -2 3937
a 396 4114 a Fe(int)396 4211 y(kvmsg_test)43 b(\(int)i(verbose\))396
4308 y({)396 4405 y(...)576 4503 y(//)89 b(Test)44 b(send)g(and)h
(receive)e(of)i(simple)f(message)576 4600 y(kvmsg)g(=)g(kvmsg_new)g
(\(1\);)576 4697 y(kvmsg_set_key)87 b(\(kvmsg,)44 b("key"\);)576
4794 y(kvmsg_set_uuid)e(\(kvmsg\);)576 4891 y(kvmsg_set_body)g
(\(kvmsg,)i(\(byte)1876 4904 y(*)1921 4891 y(\))g("body",)g(4\);)576
4988 y(if)g(\(verbose\))755 5085 y(kvmsg_dump)f(\(kvmsg\);)p
Black 3756 5569 a Ff(287)p Black eop end
%%Page: 288 301
TeXDict begin 288 300 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.288) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(kvmsg_send)43 b(\(kvmsg,)g(output\);)576
170 y(kvmsg_store)g(\(&kvmsg,)g(kvmap\);)576 364 y(kvmsg)h(=)g
(kvmsg_recv)f(\(input\);)576 461 y(if)h(\(verbose\))755
558 y(kvmsg_dump)f(\(kvmsg\);)576 655 y(assert)g(\(streq)h(\(kvmsg_key)
f(\(kvmsg\),)h("key"\)\);)576 752 y(kvmsg_store)f(\(&kvmsg,)g(kvmap\);)
576 947 y(//)89 b(Test)44 b(send)g(and)h(receive)e(of)i(message)e(with)
i(properties)576 1044 y(kvmsg)f(=)g(kvmsg_new)g(\(2\);)576
1141 y(kvmsg_set_prop)e(\(kvmsg,)i("prop1",)f("value1"\);)576
1238 y(kvmsg_set_prop)f(\(kvmsg,)i("prop2",)f("value1"\);)576
1335 y(kvmsg_set_prop)f(\(kvmsg,)i("prop2",)f("value2"\);)576
1432 y(kvmsg_set_key)87 b(\(kvmsg,)44 b("key"\);)576
1530 y(kvmsg_set_uuid)e(\(kvmsg\);)576 1627 y(kvmsg_set_body)g
(\(kvmsg,)i(\(byte)1876 1640 y(*)1921 1627 y(\))g("body",)g(4\);)576
1724 y(assert)f(\(streq)h(\(kvmsg_get_prop)f(\(kvmsg,)g("prop2"\),)h
("value2"\)\);)576 1821 y(if)g(\(verbose\))755 1918 y(kvmsg_dump)f
(\(kvmsg\);)576 2015 y(kvmsg_send)g(\(kvmsg,)g(output\);)576
2112 y(kvmsg_destroy)f(\(&kvmsg\);)576 2307 y(kvmsg)i(=)g(kvmsg_recv)f
(\(input\);)576 2404 y(if)h(\(verbose\))755 2501 y(kvmsg_dump)f
(\(kvmsg\);)576 2598 y(assert)g(\(streq)h(\(kvmsg_key)f(\(kvmsg\),)h
("key"\)\);)576 2695 y(assert)f(\(streq)h(\(kvmsg_get_prop)f(\(kvmsg,)g
("prop2"\),)h("value2"\)\);)576 2792 y(kvmsg_destroy)e(\(&kvmsg\);)396
2889 y(...)-2 3057 y
SDict begin H.S end
 -2 3057 a -2 3057 a
SDict begin 13 H.A end
 -2 3057 a -2
3057 a
SDict begin [/View [/XYZ H.V]/Dest (0:3430) cvn /DEST pdfmark end
 -2 3057 a 396 3163 a Fk(The)20 b(Model)g(Fi)n(v)o(e)g(client)g
(is)h(almost)f(identical)g(to)g(Model)g(F)o(our)-5 b(.)19
b(Dif)n(f)h(is)h(your)e(friend.)g(It)i(uses)f(the)h(full)f(kvmsg)f
(class)396 3271 y(instead)h(of)g(kvsimple,)f(and)h(sets)h(a)g
(randomized)c(')o(ttl')j(property)e(\(measured)h(in)h(seconds\))f(on)h
(each)g(message:)-2 3372 y
SDict begin H.S end
 -2 3372 a -2 3372 a
SDict begin 11.7 H.A end
 -2 3372
a -2 3372 a
SDict begin [/View [/XYZ H.V]/Dest (0:3431) cvn /DEST pdfmark end
 -2 3372 a 396 3451 a Fe(kvmsg_set_prop)43
b(\(kvmsg,)g("ttl",)h("\045d",)g(randof)g(\(30\)\);)-2
3629 y
SDict begin H.S end
 -2 3629 a -2 3629 a
SDict begin 13 H.A end
 -2 3629 a -2 3629 a
SDict begin [/View [/XYZ H.V]/Dest (0:3432) cvn /DEST pdfmark end
 -2 3629
a 396 3725 a Fk(The)20 b(Model)g(Fi)n(v)o(e)g(serv)o(er)f(has)h
(totally)g(changed.)f(Instead)g(of)h(a)h(poll)f(loop,)f(we')l(re)g(no)n
(w)h(using)g(a)g(reactor)-5 b(.)20 b(This)g(just)396
3833 y(mak)o(es)g(it)h(simpler)f(to)g(mix)g(timers)h(and)e(sock)o(et)h
(e)n(v)o(ents.)g(Unfortunately)d(in)j(C)i(the)e(reactor)f(style)i(is)g
(more)e(v)o(erbose.)396 3941 y(Y)-9 b(our)19 b(mileage)h(will)h(v)n
(ary)e(in)i(other)e(languages.)f(But)j(reactors)f(seem)g(to)g(be)h(a)f
(better)g(w)o(ay)g(of)g(b)n(uilding)f(more)396 4049 y(comple)o(x)g
(\330MQ)h(applications.)f(Here')-5 b(s)20 b(the)h(serv)o(er:)-2
4067 y
SDict begin H.S end
 -2 4067 a -2 4067 a
SDict begin 13 H.A end
 -2 4067 a -2 4067 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv5-c) cvn /DEST pdfmark
end
 -2 4067
a 396 4251 a Fg(Example)g(5-37.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Fi)o(v)o(e)f(\(clonesr)o(v5.c\))-2 4350
y
SDict begin H.S end
 -2 4350 a -2 4350 a
SDict begin 11.7 H.A end
 -2 4350 a -2 4350 a
SDict begin [/View [/XYZ H.V]/Dest (0:3435) cvn /DEST pdfmark end
 -2 4350 a 396
4431 a Fe(//)396 4528 y(//)90 b(Clone)44 b(server)f(Model)h(Five)396
4625 y(//)396 4819 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)396 4916 y(#include)f("kvmsg.c")396
5111 y(//)90 b(zloop)44 b(reactor)f(handlers)p Black
3759 5569 a Ff(288)p Black eop end
%%Page: 289 302
TeXDict begin 289 301 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.289) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(static)44 b(int)g(s_snapshots)88 b(\(zloop_t)1876
85 y(*)1921 72 y(loop,)44 b(zmq_pollitem_t)2862 85 y(*)2907
72 y(poller,)g(void)3490 85 y(*)3535 72 y(args\);)396
170 y(static)g(int)g(s_collector)88 b(\(zloop_t)1876
183 y(*)1921 170 y(loop,)44 b(zmq_pollitem_t)2862 183
y(*)2907 170 y(poller,)g(void)3490 183 y(*)3535 170 y(args\);)396
267 y(static)g(int)g(s_flush_ttl)88 b(\(zloop_t)1876
280 y(*)1921 267 y(loop,)44 b(zmq_pollitem_t)2862 280
y(*)2907 267 y(poller,)g(void)3490 280 y(*)3535 267 y(args\);)396
461 y(//)90 b(Our)44 b(server)g(is)g(defined)g(by)g(these)g(properties)
396 558 y(typedef)g(struct)g({)576 655 y(zctx_t)889 668
y(*)934 655 y(ctx;)717 b(//)89 b(Context)44 b(wrapper)576
752 y(zhash_t)934 765 y(*)979 752 y(kvmap;)582 b(//)89
b(Key-value)44 b(store)576 850 y(zloop_t)934 863 y(*)979
850 y(loop;)627 b(//)89 b(zloop)44 b(reactor)576 947
y(int)g(port;)851 b(//)89 b(Main)44 b(port)h(we're)f(working)f(on)576
1044 y(int64_t)g(sequence;)492 b(//)89 b(How)45 b(many)f(updates)f
(we're)h(at)576 1141 y(void)800 1154 y(*)845 1141 y(snapshot;)581
b(//)89 b(Handle)44 b(snapshot)g(requests)576 1238 y(void)800
1251 y(*)845 1238 y(publisher;)536 b(//)89 b(Publish)44
b(updates)g(to)g(clients)576 1335 y(void)800 1348 y(*)845
1335 y(collector;)536 b(//)89 b(Collect)44 b(updates)g(from)g(clients)
396 1432 y(})h(clonesrv_t;)396 1724 y(int)g(main)f(\(void\))396
1821 y({)576 1918 y(clonesrv_t)1069 1931 y(*)1114 1918
y(self)g(=)g(\(clonesrv_t)1965 1931 y(*)2010 1918 y(\))h(zmalloc)f
(\(sizeof)f(\(clonesrv_t\)\);)576 2112 y(self->port)g(=)h(5556;)576
2209 y(self->ctx)f(=)i(zctx_new)e(\(\);)576 2307 y(self->kvmap)g(=)h
(zhash_new)g(\(\);)576 2404 y(self->loop)f(=)h(zloop_new)g(\(\);)576
2501 y(zloop_set_verbose)e(\(self->loop,)g(FALSE\);)576
2695 y(//)89 b(Set)44 b(up)h(our)f(clone)g(server)g(sockets)576
2792 y(self->snapshot)87 b(=)45 b(zsocket_new)e(\(self->ctx,)g
(ZMQ_ROUTER\);)576 2889 y(self->publisher)f(=)j(zsocket_new)e
(\(self->ctx,)g(ZMQ_PUB\);)576 2987 y(self->collector)f(=)j
(zsocket_new)e(\(self->ctx,)g(ZMQ_PULL\);)576 3084 y(zsocket_bind)f
(\(self->snapshot,)87 b("tcp://)2280 3097 y(*)2325 3084
y(:\045d",)43 b(self->port\);)576 3181 y(zsocket_bind)f
(\(self->publisher,)g("tcp://)2280 3194 y(*)2325 3181
y(:\045d",)h(self->port)g(+)i(1\);)576 3278 y(zsocket_bind)d
(\(self->collector,)g("tcp://)2280 3291 y(*)2325 3278
y(:\045d",)h(self->port)g(+)i(2\);)576 3472 y(//)89 b(Register)43
b(our)i(handlers)e(with)h(reactor)576 3569 y(zmq_pollitem_t)e(poller)i
(=)h({)f(self->snapshot,)f(0,)h(ZMQ_POLLIN)f(};)576 3666
y(zloop_poller)f(\(self->loop,)h(&poller,)h(s_snapshots,)f(self\);)576
3764 y(poller.socket)f(=)j(self->collector;)576 3861
y(zloop_poller)d(\(self->loop,)h(&poller,)h(s_collector,)f(self\);)576
3958 y(zloop_timer)87 b(\(self->loop,)43 b(1000,)h(0,)h(s_flush_ttl,)e
(self\);)576 4152 y(//)89 b(Run)44 b(reactor)g(until)g(process)g
(interrupted)576 4249 y(zloop_start)f(\(self->loop\);)576
4444 y(zloop_destroy)f(\(&self->loop\);)576 4541 y(zhash_destroy)g
(\(&self->kvmap\);)576 4638 y(zctx_destroy)g(\(&self->ctx\);)576
4735 y(free)i(\(self\);)576 4832 y(return)f(0;)396 4929
y(})p Black 3759 5569 a Ff(289)p Black eop end
%%Page: 290 303
TeXDict begin 290 302 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.290) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3436) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(W)-7 b(e)22 b(handle)d(ICANHAZ?)h(requests)g(by)f
(sending)g(snapshot)h(data)g(to)g(the)g(client)h(that)f(requested)f
(it:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv5-c-1) cvn /DEST pdfmark
end
 -2 90 a
396 274 a Fg(Example)i(5-38.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Fi)o(v)o(e)f(\(clonesr)o(v5.c\))f(-)h(send)h
(snapshots)-2 374 y
SDict begin H.S end
 -2 374 a -2 374 a
SDict begin 11.7 H.A end
 -2 374 a -2 374
a
SDict begin [/View [/XYZ H.V]/Dest (0:3439) cvn /DEST pdfmark end
 -2 374 a 396 551 a Fe(//)90 b(Routing)43 b(information)g(for)i(a)f
(key-value)g(snapshot)396 648 y(typedef)g(struct)g({)576
745 y(void)800 758 y(*)845 745 y(socket;)492 b(//)89
b(ROUTER)44 b(socket)g(to)g(send)g(to)576 843 y(zframe_t)979
856 y(*)1024 843 y(identity;)223 b(//)89 b(Identity)43
b(of)i(peer)f(who)g(requested)g(state)576 940 y(char)800
953 y(*)845 940 y(subtree;)447 b(//)89 b(Client)44 b(subtree)f
(specification)396 1037 y(})i(kvroute_t;)396 1231 y(//)90
b(We)44 b(call)g(this)g(function)g(for)g(each)g(key-value)g(pair)g(in)g
(our)h(hash)f(table)396 1328 y(static)g(int)396 1425
y(s_send_single)f(\(const)h(char)1562 1438 y(*)1607 1425
y(key,)g(void)2055 1438 y(*)2100 1425 y(data,)g(void)2593
1438 y(*)2638 1425 y(args\))396 1522 y({)576 1620 y(kvroute_t)1024
1633 y(*)1069 1620 y(kvroute)f(=)i(\(kvroute_t)2010 1633
y(*)2055 1620 y(\))g(args;)576 1717 y(kvmsg_t)934 1730
y(*)979 1717 y(kvmsg)f(=)h(\(kvmsg_t)1741 1730 y(*)1786
1717 y(\))g(data;)576 1814 y(if)f(\(strlen)g(\(kvroute->subtree\))e(<=)
i(strlen)g(\(kvmsg_key)f(\(kvmsg\)\))576 1911 y(&&)89
b(memcmp)44 b(\(kvroute->subtree,)1114 2008 y(kvmsg_key)f(\(kvmsg\),)g
(strlen)h(\(kvroute->subtree\)\))e(==)i(0\))h({)755 2105
y(zframe_send)e(\(&kvroute->identity,)176 b(//)89 b(Choose)44
b(recipient)934 2202 y(kvroute->socket,)e(ZFRAME_MORE)h(+)i
(ZFRAME_REUSE\);)755 2300 y(kvmsg_send)e(\(kvmsg,)h(kvroute->socket\);)
576 2397 y(})576 2494 y(return)f(0;)396 2591 y(})-2 2765
y
SDict begin H.S end
 -2 2765 a -2 2765 a
SDict begin 13 H.A end
 -2 2765 a -2 2765 a
SDict begin [/View [/XYZ H.V]/Dest (0:3440) cvn /DEST pdfmark end
 -2 2765 a 396
2865 a Fk(This)21 b(is)g(the)f(reactor)f(handler)g(for)g(the)i
(snapshot)e(sock)o(et;)h(it)h(accepts)f(just)h(the)f(ICANHAZ?)g
(request)g(and)f(replies)396 2973 y(with)i(a)f(state)h(snapshot)f
(ending)e(with)j(a)f(KTHXB)m(AI)h(message:)-2 2991 y
SDict begin H.S end

-2 2991 a -2 2991 a
SDict begin 13 H.A end
 -2 2991 a -2 2991 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv5-c-2) cvn /DEST pdfmark
end
 -2 2991 a 396
3174 a Fg(Example)g(5-39.)d(Clone)j(ser)o(v)o(er)-8 b(,)20
b(Model)h(Fi)o(v)o(e)f(\(clonesr)o(v5.c\))f(-)h(snapshot)h(handler)-2
3274 y
SDict begin H.S end
 -2 3274 a -2 3274 a
SDict begin 11.7 H.A end
 -2 3274 a -2 3274 a
SDict begin [/View [/XYZ H.V]/Dest (0:3443) cvn /DEST pdfmark end
 -2 3274
a 396 3451 a Fe(static)44 b(int)396 3549 y(s_snapshots)f(\(zloop_t)1338
3562 y(*)1383 3549 y(loop,)h(zmq_pollitem_t)2324 3562
y(*)2369 3549 y(poller,)g(void)2952 3562 y(*)2997 3549
y(args\))396 3646 y({)576 3743 y(clonesrv_t)1069 3756
y(*)1114 3743 y(self)g(=)g(\(clonesrv_t)1965 3756 y(*)2010
3743 y(\))h(args;)576 3937 y(zframe_t)979 3950 y(*)1024
3937 y(identity)e(=)i(zframe_recv)e(\(poller->socket\);)576
4034 y(if)h(\(identity\))f({)755 4131 y(//)89 b(Request)44
b(is)g(in)h(second)f(frame)g(of)g(message)755 4229 y(char)979
4242 y(*)1024 4229 y(request)g(=)g(zstr_recv)g(\(poller->socket\);)755
4326 y(char)979 4339 y(*)1024 4326 y(subtree)g(=)g(NULL;)755
4423 y(if)g(\(streq)g(\(request,)g("ICANHAZ?"\)\))e({)934
4520 y(free)i(\(request\);)934 4617 y(subtree)g(=)h(zstr_recv)e
(\(poller->socket\);)755 4714 y(})755 4811 y(else)934
4909 y(printf)h(\("E:)g(bad)h(request,)e(aborting\\n"\);)755
5103 y(if)h(\(subtree\))g({)p Black 3759 5569 a Ff(290)p
Black eop end
%%Page: 291 304
TeXDict begin 291 303 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.291) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 934 72 a Fe(//)90 b(Send)44 b(state)g(socket)g(to)g(client)934
170 y(kvroute_t)g(routing)f(=)i({)g(poller->socket,)d(identity,)h
(subtree)h(};)934 267 y(zhash_foreach)f(\(self->kvmap,)g
(s_send_single,)f(&routing\);)934 461 y(//)90 b(Now)44
b(send)g(END)g(message)g(with)g(sequence)g(number)934
558 y(zclock_log)f(\("I:)i(sending)e(shapshot=\045d",)g(\(int\))h
(self->sequence\);)934 655 y(zframe_send)f(\(&identity,)g
(poller->socket,)g(ZFRAME_MORE\);)934 752 y(kvmsg_t)1293
765 y(*)1338 752 y(kvmsg)h(=)g(kvmsg_new)g(\(self->sequence\);)934
850 y(kvmsg_set_key)88 b(\(kvmsg,)43 b("KTHXBAI"\);)934
947 y(kvmsg_set_body)g(\(kvmsg,)g(\(byte)2234 960 y(*)2279
947 y(\))i(subtree,)e(0\);)934 1044 y(kvmsg_send)223
b(\(kvmsg,)43 b(poller->socket\);)934 1141 y(kvmsg_destroy)g
(\(&kvmsg\);)934 1238 y(free)h(\(subtree\);)755 1335
y(})755 1432 y(zframe_destroy\(&identity\);)576 1530
y(})576 1627 y(return)f(0;)396 1724 y(})-2 1898 y
SDict begin H.S end
 -2
1898 a -2 1898 a
SDict begin 13 H.A end
 -2 1898 a -2 1898 a
SDict begin [/View [/XYZ H.V]/Dest (0:3444) cvn /DEST pdfmark end
 -2 1898 a 396 1998
a Fk(W)-7 b(e)22 b(store)e(each)g(update)f(with)h(a)h(ne)n(w)f
(sequence)f(number)m(,)f(and)h(if)i(necessary)-5 b(,)18
b(a)j(time-to-li)n(v)o(e.)d(W)-7 b(e)22 b(publish)d(updates)396
2106 y(immediately)g(on)h(our)f(publisher)g(sock)o(et:)-2
2124 y
SDict begin H.S end
 -2 2124 a -2 2124 a
SDict begin 13 H.A end
 -2 2124 a -2 2124 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv5-c-3) cvn /DEST pdfmark
end
 -2 2124
a 396 2307 a Fg(Example)i(5-40.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Fi)o(v)o(e)f(\(clonesr)o(v5.c\))f(-)h(collect)g
(updates)-2 2407 y
SDict begin H.S end
 -2 2407 a -2 2407 a
SDict begin 11.7 H.A end
 -2 2407 a -2 2407
a
SDict begin [/View [/XYZ H.V]/Dest (0:3447) cvn /DEST pdfmark end
 -2 2407 a 396 2584 a Fe(static)44 b(int)396 2681 y(s_collector)f
(\(zloop_t)1338 2694 y(*)1383 2681 y(loop,)h(zmq_pollitem_t)2324
2694 y(*)2369 2681 y(poller,)g(void)2952 2694 y(*)2997
2681 y(args\))396 2779 y({)576 2876 y(clonesrv_t)1069
2889 y(*)1114 2876 y(self)g(=)g(\(clonesrv_t)1965 2889
y(*)2010 2876 y(\))h(args;)576 3070 y(kvmsg_t)934 3083
y(*)979 3070 y(kvmsg)f(=)h(kvmsg_recv)e(\(poller->socket\);)576
3167 y(if)h(\(kvmsg\))g({)755 3264 y(kvmsg_set_sequence)e(\(kvmsg,)h
(++self->sequence\);)755 3361 y(kvmsg_send)g(\(kvmsg,)h
(self->publisher\);)755 3459 y(int)g(ttl)h(=)f(atoi)g(\(kvmsg_get_prop)
f(\(kvmsg,)g("ttl"\)\);)755 3556 y(if)h(\(ttl\))934 3653
y(kvmsg_set_prop)f(\(kvmsg,)g("ttl",)1114 3750 y("\045")h(PRId64,)g
(zclock_time)f(\(\))h(+)h(ttl)2593 3763 y(*)2683 3750
y(1000\);)755 3847 y(kvmsg_store)e(\(&kvmsg,)g(self->kvmap\);)755
3944 y(zclock_log)g(\("I:)h(publishing)f(update=\045d",)g(\(int\))h
(self->sequence\);)576 4041 y(})576 4138 y(return)f(0;)396
4236 y(})-2 4410 y
SDict begin H.S end
 -2 4410 a -2 4410 a
SDict begin 13 H.A end
 -2 4410 a -2 4410
a
SDict begin [/View [/XYZ H.V]/Dest (0:3448) cvn /DEST pdfmark end
 -2 4410 a 396 4510 a Fk(At)21 b(re)o(gular)e(interv)n(als)g(we)i
(\003ush)f(ephemeral)f(v)n(alues)g(that)i(ha)n(v)o(e)e(e)o(xpired.)g
(This)h(could)f(be)h(slo)n(w)h(on)f(v)o(ery)f(lar)o(ge)g(data)396
4618 y(sets:)-2 4619 y
SDict begin H.S end
 -2 4619 a -2 4619 a
SDict begin 13 H.A end
 -2 4619 a
-2 4619 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv5-c-4) cvn /DEST pdfmark
end
 -2 4619 a Black 3759 5569 a Ff(291)p Black
eop end
%%Page: 292 305
TeXDict begin 292 304 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.292) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-41.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Fi)o(v)o(e)f(\(clonesr)o(v5.c\))f(-)h(\003ush)i
(ephemeral)e(v)o(alues)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2
172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3451) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(//)90 b(If)44 b(key-value)f(pair)i
(has)f(expired,)f(delete)h(it)h(and)f(publish)g(the)396
447 y(//)90 b(fact)44 b(to)g(listening)g(clients.)396
544 y(static)g(int)396 641 y(s_flush_single)f(\(const)h(char)1607
654 y(*)1652 641 y(key,)g(void)2100 654 y(*)2145 641
y(data,)g(void)2638 654 y(*)2683 641 y(args\))396 738
y({)576 835 y(clonesrv_t)1069 848 y(*)1114 835 y(self)g(=)g
(\(clonesrv_t)1965 848 y(*)2010 835 y(\))h(args;)576
1030 y(kvmsg_t)934 1043 y(*)979 1030 y(kvmsg)f(=)h(\(kvmsg_t)1741
1043 y(*)1786 1030 y(\))g(data;)576 1127 y(int64_t)e(ttl;)576
1224 y(sscanf)g(\(kvmsg_get_prop)g(\(kvmsg,)g("ttl"\),)h("\045")g
(PRId64,)g(&ttl\);)576 1321 y(if)g(\(ttl)g(&&)h(zclock_time)e(\(\))h
(>=)h(ttl\))f({)755 1418 y(kvmsg_set_sequence)e(\(kvmsg,)h
(++self->sequence\);)755 1515 y(kvmsg_set_body)f(\(kvmsg,)i(\(byte)2055
1528 y(*)2100 1515 y(\))h("",)f(0\);)755 1613 y(kvmsg_send)f(\(kvmsg,)h
(self->publisher\);)755 1710 y(kvmsg_store)f(\(&kvmsg,)g
(self->kvmap\);)755 1807 y(zclock_log)g(\("I:)h(publishing)f
(delete=\045d",)g(\(int\))h(self->sequence\);)576 1904
y(})576 2001 y(return)f(0;)396 2098 y(})396 2292 y(static)h(int)396
2390 y(s_flush_ttl)f(\(zloop_t)1338 2403 y(*)1383 2390
y(loop,)h(zmq_pollitem_t)2324 2403 y(*)2369 2390 y(poller,)g(void)2952
2403 y(*)2997 2390 y(args\))396 2487 y({)576 2584 y(clonesrv_t)1069
2597 y(*)1114 2584 y(self)g(=)g(\(clonesrv_t)1965 2597
y(*)2010 2584 y(\))h(args;)576 2681 y(if)f(\(self->kvmap\))755
2778 y(zhash_foreach)f(\(self->kvmap,)f(s_flush_single,)h(args\);)576
2875 y(return)g(0;)396 2972 y(})-2 3064 y
SDict begin H.S end
 -2 3064 a -2
3064 a
SDict begin 13 H.A end
 -2 3064 a -2 3064 a
SDict begin [/View [/XYZ H.V]/Dest (0:3452) cvn /DEST pdfmark end
 -2 3064 a 396 3384 a Fb(5.3.6.)36
b(Clone)e(Ser)q(ver)g(Reliability)2063 3384 y
SDict begin H.S end
 2063 3384
a 2063 3384 a
SDict begin 18.72 H.A end
 2063 3384 a 2063 3384 a
SDict begin [/View [/XYZ H.V]/Dest (10.72.26.2) cvn /DEST pdfmark end
 2063 3384 a -2
3574 a
SDict begin H.S end
 -2 3574 a -2 3574 a
SDict begin 13 H.A end
 -2 3574 a -2 3574 a
SDict begin [/View [/XYZ H.V]/Dest (0:3454) cvn /DEST pdfmark end
 -2 3574
a 396 3658 a Fk(Clone)20 b(models)g(one)g(to)g(\002)n(v)o(e)g(are)g
(relati)n(v)o(ely)f(simple.)h(W)-7 b(e')l(re)20 b(no)n(w)g(going)f(to)h
(get)g(into)g(unpleasantly)f(comple)o(x)396 3765 y(territory)g(here)h
(that)g(has)g(me)h(getting)e(up)h(for)f(another)g(espresso.)h(Y)-9
b(ou)19 b(should)h(appreciate)f(that)h(making)f("reliable")396
3873 y(messaging)h(is)h(comple)o(x)d(enough)g(that)j(you)e(al)o(w)o
(ays)h(need)g(to)g(ask,)h("do)e(we)i(actually)e(need)h(this?")g(before)
f(jumping)396 3981 y(into)h(it.)h(If)f(you)f(can)h(get)g(a)o(w)o(ay)g
(with)h(unreliable,)d(or)i("good)f(enough")f(reliability)-5
b(,)19 b(you)g(can)h(mak)o(e)g(a)g(huge)g(win)g(in)396
4089 y(terms)g(of)g(cost)h(and)f(comple)o(xity)-5 b(.)17
b(Sure,)j(you)f(may)h(lose)g(some)g(data)g(no)n(w)g(and)g(then.)f(It)i
(is)g(often)e(a)i(good)d(trade-of)n(f.)396 4197 y(Ha)n(ving)i(said,)g
(that,)g(and)g(\(sips\))g(since)g(the)h(espresso)f(is)h(really)e(good,)
g(let')-5 b(s)21 b(jump)f(in!)-2 4381 y
SDict begin H.S end
 -2 4381 a -2
4381 a
SDict begin 13 H.A end
 -2 4381 a -2 4381 a
SDict begin [/View [/XYZ H.V]/Dest (0:3455) cvn /DEST pdfmark end
 -2 4381 a 396 4471 a Fk(As)h(you)f(play)f
(with)i(model)e(three,)g(you')o(ll)h(stop)g(and)f(restart)i(the)f(serv)
o(er)-5 b(.)19 b(It)i(might)e(look)h(lik)o(e)g(it)h(reco)o(v)o(ers,)d
(b)n(ut)j(of)396 4579 y(course)f(it')-5 b(s)21 b(applying)d(updates)i
(to)g(an)g(empty)f(state,)i(instead)f(of)g(the)g(proper)f(current)g
(state.)h(An)o(y)g(ne)n(w)g(client)g(joining)396 4687
y(the)g(netw)o(ork)f(will)i(get)g(just)f(the)h(latest)g(updates,)e
(instead)h(of)g(all)g(of)g(them.)g(So)g(let')-5 b(s)21
b(w)o(ork)f(out)g(a)g(design)g(for)f(making)396 4795
y(Clone)h(w)o(ork)g(despite)g(serv)o(er)f(f)o(ailures.)-2
4979 y
SDict begin H.S end
 -2 4979 a -2 4979 a
SDict begin 13 H.A end
 -2 4979 a -2 4979 a
SDict begin [/View [/XYZ H.V]/Dest (0:3456) cvn /DEST pdfmark end
 -2 4979
a 396 5069 a Fk(Let')-5 b(s)21 b(list)g(the)g(f)o(ailures)e(we)i(w)o
(ant)f(to)h(be)f(able)g(to)g(handle:)-2 5070 y
SDict begin H.S end
 -2 5070
a -2 5070 a
SDict begin 13 H.A end
 -2 5070 a -2 5070 a
SDict begin [/View [/XYZ H.V]/Dest (0:3457) cvn /DEST pdfmark end
 -2 5070 a -2 5080 a
SDict begin H.S end
 -2
5080 a -2 5080 a
SDict begin 13 H.A end
 -2 5080 a -2 5080 a
SDict begin [/View [/XYZ H.V]/Dest (0:3458) cvn /DEST pdfmark end
 -2 5080 a Black
3759 5569 a Ff(292)p Black eop end
%%Page: 293 306
TeXDict begin 293 305 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.293) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:3488) cvn /DEST pdfmark end
 -2 -201 a 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e
(Publish-Subscribe)p Black Black 396 72 a Fj(\225)p Black
479 72 a
SDict begin H.S end
 479 72 a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3459) cvn /DEST pdfmark end
 479 72 a
Fk(Clone)i(serv)o(er)f(process)g(crashes)h(and)f(is)h(automatically)f
(or)g(manually)f(restarted.)h(The)h(process)f(loses)h(its)h(state)f
(and)479 180 y(has)h(to)f(get)g(it)h(back)f(from)f(some)n(where.)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:3460) cvn /DEST pdfmark end
 -2 198 a Black
396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330
a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:3461) cvn /DEST pdfmark end
 479 330 a Fk(Clone)h(serv)o(er)g(machine)f(dies)h
(and)g(is)h(of)n(f-line)e(for)g(a)i(signi\002cant)f(time.)g(Clients)h
(ha)n(v)o(e)e(to)i(switch)f(to)h(an)f(alternate)479 438
y(serv)o(er)g(some)n(where.)-2 439 y
SDict begin H.S end
 -2 439 a -2 439
a
SDict begin 13 H.A end
 -2 439 a -2 439 a
SDict begin [/View [/XYZ H.V]/Dest (0:3462) cvn /DEST pdfmark end
 -2 439 a Black 396 587 a Fj(\225)p
Black 479 587 a
SDict begin H.S end
 479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587
a
SDict begin [/View [/XYZ H.V]/Dest (0:3463) cvn /DEST pdfmark end
 479 587 a Fk(Clone)g(serv)o(er)g(process)f(or)h(machine)f(gets)i
(disconnected)d(from)h(the)h(netw)o(ork,)f(e.g.)h(a)g(switch)h(dies.)f
(It)h(may)e(come)479 695 y(back)h(at)g(some)g(point,)g(b)n(ut)g(in)g
(the)g(meantime)g(clients)g(need)g(an)g(alternate)f(serv)o(er)-5
b(.)-2 879 y
SDict begin H.S end
 -2 879 a -2 879 a
SDict begin 13 H.A end
 -2 879 a -2 879 a
SDict begin [/View [/XYZ H.V]/Dest (0:3464) cvn /DEST pdfmark end
 -2 879
a 396 969 a Fk(Our)20 b(\002rst)h(step)g(is)g(to)f(add)g(a)g(second)g
(serv)o(er)-5 b(.)19 b(W)-7 b(e)21 b(can)f(use)h(the)f(Binary)g(Star)g
(pattern)g(from)f(Chapter)g(four)g(to)i(or)o(ganize)396
1077 y(these)g(into)f(primary)e(and)i(backup.)e(Binary)i(Star)g(is)h(a)
g(reactor)m(,)e(so)h(it')-5 b(s)22 b(useful)d(that)i(we)f(already)f
(ref)o(actored)g(the)h(last)396 1185 y(serv)o(er)g(model)f(into)h(a)g
(reactor)g(style.)-2 1369 y
SDict begin H.S end
 -2 1369 a -2 1369 a
SDict begin 13 H.A end
 -2 1369
a -2 1369 a
SDict begin [/View [/XYZ H.V]/Dest (0:3465) cvn /DEST pdfmark end
 -2 1369 a 396 1459 a Fk(W)-7 b(e)22 b(need)d(to)h(ensure)g
(that)g(updates)g(are)g(not)g(lost)g(if)h(the)f(primary)f(serv)o(er)g
(crashes.)h(The)g(simplest)g(technique)f(is)i(to)396
1567 y(send)f(them)g(to)g(both)g(serv)o(ers.)-2 1734
y
SDict begin H.S end
 -2 1734 a -2 1734 a
SDict begin 13 H.A end
 -2 1734 a -2 1734 a
SDict begin [/View [/XYZ H.V]/Dest (0:3466) cvn /DEST pdfmark end
 -2 1734 a 396
1841 a Fk(The)g(backup)f(serv)o(er)g(can)h(then)g(act)g(as)h(a)g
(client,)f(and)f(k)o(eep)h(its)h(state)g(synchronized)d(by)h(recei)n
(ving)g(updates)g(as)i(all)396 1949 y(clients)g(do.)e(It')o(ll)i(also)f
(get)g(ne)n(w)g(updates)g(from)f(clients.)h(It)h(can')o(t)e(yet)h
(store)g(these)h(in)f(its)h(hash)f(table,)g(b)n(ut)g(it)h(can)f(hold)
396 2057 y(onto)g(them)f(for)h(a)h(while.)-2 2224 y
SDict begin H.S end
 -2
2224 a -2 2224 a
SDict begin 13 H.A end
 -2 2224 a -2 2224 a
SDict begin [/View [/XYZ H.V]/Dest (0:3467) cvn /DEST pdfmark end
 -2 2224 a 396 2331
a Fk(So,)f(Model)g(Six)g(introduces)f(these)h(changes)g(o)o(v)o(er)e
(Model)i(Fi)n(v)o(e:)-2 2349 y
SDict begin H.S end
 -2 2349 a -2 2349 a
SDict begin 13 H.A end
 -2
2349 a -2 2349 a
SDict begin [/View [/XYZ H.V]/Dest (0:3468) cvn /DEST pdfmark end
 -2 2349 a -2 2359 a
SDict begin H.S end
 -2 2359 a -2 2359
a
SDict begin 13 H.A end
 -2 2359 a -2 2359 a
SDict begin [/View [/XYZ H.V]/Dest (0:3469) cvn /DEST pdfmark end
 -2 2359 a Black 396 2501 a Fj(\225)p
Black 479 2501 a
SDict begin H.S end
 479 2501 a 479 2501 a
SDict begin 13 H.A end
 479 2501 a 479
2501 a
SDict begin [/View [/XYZ H.V]/Dest (0:3470) cvn /DEST pdfmark end
 479 2501 a Fk(W)-7 b(e)21 b(use)f(a)g(pub-sub)e(\003o)n(w)i
(instead)f(of)h(a)g(push-pull)e(\003o)n(w)i(for)f(client)h(updates)f
(\(to)g(the)h(serv)o(ers\).)f(The)g(reasons:)g(push)479
2609 y(sock)o(ets)i(will)g(block)e(if)h(there)g(is)h(no)f(recipient,)f
(and)h(the)o(y)f(round-robin,)d(so)21 b(we')l(d)e(need)h(to)g(open)f
(tw)o(o)i(of)f(them.)479 2717 y(W)-7 b(e')o(ll)22 b(bind)d(the)h(serv)o
(ers')f(SUB)j(sock)o(ets)e(and)g(connect)f(the)h(clients')g(PUB)h(sock)
o(ets)g(to)f(them.)f(This)i(tak)o(es)f(care)g(of)479
2825 y(f)o(anning)f(out)h(from)f(one)g(client)i(to)f(tw)o(o)h(serv)o
(ers.)-2 2843 y
SDict begin H.S end
 -2 2843 a -2 2843 a
SDict begin 13 H.A end
 -2 2843 a -2 2843
a
SDict begin [/View [/XYZ H.V]/Dest (0:3471) cvn /DEST pdfmark end
 -2 2843 a Black 396 2974 a Fj(\225)p Black 479 2974
a
SDict begin H.S end
 479 2974 a 479 2974 a
SDict begin 13 H.A end
 479 2974 a 479 2974 a
SDict begin [/View [/XYZ H.V]/Dest (0:3472) cvn /DEST pdfmark end
 479 2974
a Fk(W)-7 b(e)22 b(add)d(heartbeats)g(to)i(serv)o(er)e(updates)g(\(to)h
(clients\),)g(so)g(that)h(a)f(client)g(can)g(detect)g(when)g(the)g
(primary)e(serv)o(er)i(has)479 3082 y(died.)g(It)g(can)g(then)g(switch)
g(o)o(v)o(er)f(to)i(the)f(backup)e(serv)o(er)-5 b(.)-2
3100 y
SDict begin H.S end
 -2 3100 a -2 3100 a
SDict begin 13 H.A end
 -2 3100 a -2 3100 a
SDict begin [/View [/XYZ H.V]/Dest (0:3473) cvn /DEST pdfmark end
 -2 3100
a Black 396 3231 a Fj(\225)p Black 479 3231 a
SDict begin H.S end
 479 3231
a 479 3231 a
SDict begin 13 H.A end
 479 3231 a 479 3231 a
SDict begin [/View [/XYZ H.V]/Dest (0:3474) cvn /DEST pdfmark end
 479 3231 a Fk(W)e(e)22
b(connect)d(the)h(tw)o(o)g(serv)o(ers)g(using)g(the)g(Binary)f(Star)
2133 3231 y
SDict begin H.S end
 2133 3231 a 2133 3231 a
SDict begin 13 H.A end
 2133 3231 a 2133
3231 a
SDict begin [/View [/XYZ H.V]/Dest (0:3475) cvn /DEST pdfmark end
 2133 3231 a Fe(bstar)h Fk(reactor)f(class.)i(Binary)f(Star)g
(relies)h(on)f(the)g(clients)479 3339 y(to)h(')l(v)n(ote')e(by)h
(making)e(an)j(e)o(xplicit)e(request)h(to)g(the)g(serv)o(er)g(the)o(y)f
(consider)g("master".)h(W)-7 b(e')o(ll)21 b(use)f(snapshot)479
3447 y(requests)g(for)g(this.)-2 3465 y
SDict begin H.S end
 -2 3465 a -2
3465 a
SDict begin 13 H.A end
 -2 3465 a -2 3465 a
SDict begin [/View [/XYZ H.V]/Dest (0:3476) cvn /DEST pdfmark end
 -2 3465 a Black 396 3597 a
Fj(\225)p Black 479 3597 a
SDict begin H.S end
 479 3597 a 479 3597 a
SDict begin 13 H.A end
 479
3597 a 479 3597 a
SDict begin [/View [/XYZ H.V]/Dest (0:3477) cvn /DEST pdfmark end
 479 3597 a Fk(W)-7 b(e)22 b(mak)o(e)d(all)i(update)e
(messages)i(uniquely)d(identi\002able)h(by)h(adding)f(a)h(UUID)h
(\002eld.)f(The)g(client)g(generates)f(this,)479 3705
y(and)h(the)g(serv)o(er)f(propagates)f(it)j(back)f(on)g(re-published)d
(updates.)-2 3723 y
SDict begin H.S end
 -2 3723 a -2 3723 a
SDict begin 13 H.A end
 -2 3723 a -2
3723 a
SDict begin [/View [/XYZ H.V]/Dest (0:3478) cvn /DEST pdfmark end
 -2 3723 a Black 396 3854 a Fj(\225)p Black 479
3854 a
SDict begin H.S end
 479 3854 a 479 3854 a
SDict begin 13 H.A end
 479 3854 a 479 3854 a
SDict begin [/View [/XYZ H.V]/Dest (0:3479) cvn /DEST pdfmark end
 479
3854 a Fk(The)j(sla)n(v)o(e)g(serv)o(er)f(k)o(eeps)h(a)g("pending)e
(list")i(of)g(updates)f(that)h(it)h(has)f(recei)n(v)o(ed)e(from)h
(clients,)h(b)n(ut)g(not)f(yet)h(from)f(the)479 3962
y(master)h(serv)o(er)-5 b(.)20 b(Or)m(,)g(updates)f(it')-5
b(s)21 b(recei)n(v)o(ed)e(from)g(the)h(master)m(,)g(b)n(ut)g(not)g(yet)
g(clients.)g(The)g(list)i(is)f(ordered)d(from)479 4070
y(oldest)i(to)h(ne)n(west,)f(so)g(that)h(it)f(is)i(easy)e(to)g(remo)o
(v)o(e)e(updates)i(of)n(f)f(the)i(head.)-2 4254 y
SDict begin H.S end
 -2
4254 a -2 4254 a
SDict begin 13 H.A end
 -2 4254 a -2 4254 a
SDict begin [/View [/XYZ H.V]/Dest (0:3480) cvn /DEST pdfmark end
 -2 4254 a 396 4344
a Fk(It')-5 b(s)21 b(useful)f(to)g(design)g(the)g(client)g(logic)g(as)h
(a)f(\002nite)h(state)g(machine.)e(The)g(client)i(c)o(ycles)f(through)e
(three)h(states:)-2 4362 y
SDict begin H.S end
 -2 4362 a -2 4362 a
SDict begin 13 H.A end
 -2 4362
a -2 4362 a
SDict begin [/View [/XYZ H.V]/Dest (0:3481) cvn /DEST pdfmark end
 -2 4362 a -2 4372 a
SDict begin H.S end
 -2 4372 a -2 4372 a
SDict begin 13 H.A end
 -2
4372 a -2 4372 a
SDict begin [/View [/XYZ H.V]/Dest (0:3482) cvn /DEST pdfmark end
 -2 4372 a Black 396 4514 a Fj(\225)p
Black 479 4514 a
SDict begin H.S end
 479 4514 a 479 4514 a
SDict begin 13 H.A end
 479 4514 a 479
4514 a
SDict begin [/View [/XYZ H.V]/Dest (0:3483) cvn /DEST pdfmark end
 479 4514 a Fk(The)h(client)g(opens)g(and)f(connects)h(its)h
(sock)o(ets,)f(and)g(then)f(requests)h(a)h(snapshot)e(from)g(the)h
(\002rst)h(serv)o(er)-5 b(.)20 b(T)-7 b(o)20 b(a)n(v)n(oid)479
4622 y(request)g(storms,)g(it)h(will)g(ask)f(an)o(y)f(gi)n(v)o(en)g
(serv)o(er)h(only)f(twice.)h(One)g(request)g(might)f(get)i(lost,)f
(that')l(d)f(be)i(bad)e(luck.)479 4730 y(T)-7 b(w)o(o)21
b(getting)e(lost)i(w)o(ould)e(be)h(carelessness.)-2 4748
y
SDict begin H.S end
 -2 4748 a -2 4748 a
SDict begin 13 H.A end
 -2 4748 a -2 4748 a
SDict begin [/View [/XYZ H.V]/Dest (0:3484) cvn /DEST pdfmark end
 -2 4748 a Black
396 4879 a Fj(\225)p Black 479 4879 a
SDict begin H.S end
 479 4879 a 479
4879 a
SDict begin 13 H.A end
 479 4879 a 479 4879 a
SDict begin [/View [/XYZ H.V]/Dest (0:3485) cvn /DEST pdfmark end
 479 4879 a Fk(The)g(client)g(w)o(aits)i
(for)d(a)i(reply)e(\(snapshot)g(data\))h(from)f(the)h(current)f(serv)o
(er)m(,)g(and)g(if)i(it)g(gets)f(it,)h(it)g(stores)f(it.)h(If)f(there)
479 4987 y(is)h(no)f(reply)g(within)g(some)g(timeout,)f(it)i(f)o(ails)g
(o)o(v)o(er)d(to)j(the)f(ne)o(xt)f(serv)o(er)-5 b(.)-2
5005 y
SDict begin H.S end
 -2 5005 a -2 5005 a
SDict begin 13 H.A end
 -2 5005 a -2 5005 a
SDict begin [/View [/XYZ H.V]/Dest (0:3486) cvn /DEST pdfmark end
 -2 5005
a Black 3759 5569 a Ff(293)p Black eop end
%%Page: 294 307
TeXDict begin 294 306 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.294) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3487) cvn /DEST pdfmark end
 479 72 a Fk(When)i(the)h(client)f(has)g
(gotten)f(its)j(snapshot,)d(it)i(w)o(aits)g(for)e(and)h(processes)g
(updates.)f(Again,)g(if)i(it)f(doesn')o(t)f(hear)479
180 y(an)o(ything)f(from)i(the)g(serv)o(er)f(within)h(some)g(timeout,)f
(it)i(f)o(ails)g(o)o(v)o(er)e(to)h(the)g(ne)o(xt)g(serv)o(er)-5
b(.)396 454 y(The)19 b(client)h(loops)f(fore)n(v)o(er)-5
b(.)17 b(It')-5 b(s)21 b(quite)e(lik)o(ely)g(during)f(startup)h(or)g(f)
o(ail-o)o(v)o(er)f(that)h(some)g(clients)h(may)f(be)h(trying)e(to)i
(talk)396 562 y(to)h(the)f(primary)e(serv)o(er)i(while)g(others)g(are)g
(trying)f(to)h(talk)g(to)h(the)f(backup)f(serv)o(er)-5
b(.)19 b(The)h(Binary)g(Star)g(state)h(machine)396 670
y(handles)f(this\()p 0 TeXcolorgray 819 670 a
SDict begin H.S end
 819 670
a Fk(Figure)f(5-6)1168 670 y
SDict begin 13 H.L end
 1168 670 a 1168 670 a
SDict begin [/Subtype /Link/Dest (0:figure-68) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 1168
670 a Black -2 w Fk(\),)i(hopefully)d(accurately)-5 b(.)18
b(\(One)i(of)f(the)i(jo)o(ys)f(of)g(making)f(designs)h(lik)o(e)g(this)h
(is)g(we)f(cannot)396 778 y(pro)o(v)o(e)e(the)o(y)h(are)g(right,)g(we)g
(can)h(only)e(pro)o(v)o(e)g(them)h(wrong.)f(So)i(it')-5
b(s)20 b(lik)o(e)g(a)g(guy)e(f)o(alling)h(of)n(f)g(a)h(tall)g(b)n
(uilding.)e(So)i(f)o(ar)m(,)e(so)396 886 y(good...)g(so)j(f)o(ar)m(,)e
(so)i(good...\))-2 904 y
SDict begin H.S end
 -2 904 a -2 904 a
SDict begin 13 H.A end
 -2 904 a -2
904 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-68) cvn /DEST pdfmark
end
 -2 904 a 396 1087 a Fg(Figur)o(e)f(5-6.)f(Clone)h(Client)h
(Finite)f(State)g(Machine)-2 1187 y
SDict begin H.S end
 -2 1187 a -2 1187
a
SDict begin 13 H.A end
 -2 1187 a -2 1187 a
SDict begin [/View [/XYZ H.V]/Dest (0:3492) cvn /DEST pdfmark end
 -2 1187 a 396 3887 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3887 a
@beginspecial 0 @llx -319 @lly 294 @urx 0 @ury 2940 @rwi
@setspecial
%%BeginDocument: images/fig68.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -319 294 0
%%HiResBoundingBox: 0.0 -319.0 294.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
26.100210189819336 -29.100210189819336 moveto
26.100210189819336 -73.10021209716797 lineto
110.10021209716797 -73.10021209716797 lineto
110.10021209716797 -29.100210189819336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
26.100210189819336 -128.10020446777344 moveto
26.100210189819336 -183.10020446777344 lineto
110.10021209716797 -183.10020446777344 lineto
110.10021209716797 -128.10020446777344 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
26.100210189819336 -238.10020446777344 moveto
26.100210189819336 -293.1002197265625 lineto
110.10021209716797 -293.1002197265625 lineto
110.10021209716797 -238.10020446777344 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
24.0 -27.0 moveto
24.0 -71.0 lineto
108.0 -71.0 lineto
108.0 -27.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.7 setlinewidth
1 setlinecap
[] 0 setdash
newpath
24.0 -27.0 moveto
24.0 -71.0 lineto
108.0 -71.0 lineto
108.0 -27.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
24.0 -126.0 moveto
24.0 -181.0 lineto
108.0 -181.0 lineto
108.0 -126.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
24.0 -126.0 moveto
24.0 -181.0 lineto
108.0 -181.0 lineto
108.0 -126.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
24.0 -236.0 moveto
24.0 -291.0 lineto
108.0 -291.0 lineto
108.0 -236.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
24.0 -236.0 moveto
24.0 -291.0 lineto
108.0 -291.0 lineto
108.0 -236.0 lineto
closepath
stroke
newpath
115.0 -38.0 moveto
273.0 -38.0 lineto
275.0 -38.0 276.0 -40.0 276.0 -44.0 curveto
276.0 -275.0 lineto
276.0 -275.0 lineto
276.0 -278.3333333333333 275.0 -280.0 273.0 -280.0 curveto
168.0 -280.0 lineto
168.0 -280.0 lineto
stroke
newpath
115.0 -49.0 moveto
252.0 -49.0 lineto
254.0 -49.0 255.0 -51.0 255.0 -55.0 curveto
255.0 -165.0 lineto
255.0 -165.0 lineto
255.0 -168.33333333333334 254.0 -170.0 252.0 -170.0 curveto
168.0 -170.0 lineto
168.0 -170.0 lineto
stroke
newpath
94.0 -115.0 moveto
94.0 -99.0 lineto
94.0 -95.0 95.33333333333333 -93.0 98.0 -93.0 curveto
210.0 -93.0 lineto
210.0 -93.0 lineto
212.0 -93.0 213.0 -95.0 213.0 -99.0 curveto
213.0 -132.0 lineto
213.0 -132.0 lineto
213.0 -135.33333333333334 212.0 -137.0 210.0 -137.0 curveto
154.0 -137.0 lineto
154.0 -137.0 lineto
stroke
newpath
66.0 -198.0 moveto
66.0 -225.0 lineto
stroke
newpath
94.0 -225.0 moveto
94.0 -209.0 lineto
94.0 -205.0 95.33333333333333 -203.0 98.0 -203.0 curveto
210.0 -203.0 lineto
210.0 -203.0 lineto
212.0 -203.0 213.0 -205.0 213.0 -209.0 curveto
213.0 -242.0 lineto
213.0 -242.0 lineto
213.0 -245.33333333333334 212.0 -247.0 210.0 -247.0 curveto
154.0 -247.0 lineto
154.0 -247.0 lineto
stroke
newpath
66.0 -71.0 moveto
66.0 -115.0 lineto
stroke
newpath
108.0 -137.0 moveto
118.0 -137.0 lineto
stroke
newpath
108.0 -170.0 moveto
118.0 -170.0 lineto
stroke
newpath
108.0 -247.0 moveto
118.0 -247.0 lineto
stroke
newpath
108.0 -280.0 moveto
118.0 -280.0 lineto
stroke
newpath
119.0 -33.0 moveto
112.0 -38.0 lineto
119.0 -44.0 lineto
closepath
fill
newpath
119.0 -44.0 moveto
112.0 -49.0 lineto
119.0 -55.0 lineto
closepath
fill
newpath
63.0 -110.0 moveto
66.0 -121.0 lineto
70.0 -110.0 lineto
closepath
fill
newpath
91.0 -110.0 moveto
94.0 -121.0 lineto
98.0 -110.0 lineto
closepath
fill
newpath
63.0 -220.0 moveto
66.0 -231.0 lineto
70.0 -220.0 lineto
closepath
fill
newpath
91.0 -220.0 moveto
94.0 -231.0 lineto
98.0 -220.0 lineto
closepath
fill
/Helvetica findfont
11 scalefont setfont
48.0 -54.0 moveto
(Initial) show
19.0 -87.0 moveto
(Request snapshot) show
120.0 -142.0 moveto
(INPUT) show
119.0 -153.0 moveto
(Store snapshot) show
44.0 -153.0 moveto
(Syncing) show
119.0 -175.0 moveto
(SILENCE) show
119.0 -186.0 moveto
(Failover to next) show
44.0 -196.0 moveto
(KTHXBAI) show
120.0 -252.0 moveto
(INPUT) show
119.0 -263.0 moveto
(Store update) show
44.0 -263.0 moveto
(Active) show
119.0 -285.0 moveto
(SILENCE) show
119.0 -296.0 moveto
(Failover to next) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3887 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3887 a -2 4053 a
SDict begin H.S end
 -2 4053
a -2 4053 a
SDict begin 13 H.A end
 -2 4053 a -2 4053 a
SDict begin [/View [/XYZ H.V]/Dest (0:3495) cvn /DEST pdfmark end
 -2 4053 a 396 4161 a
Fk(F)o(ail-o)o(v)o(er)f(happens)f(as)j(follo)n(ws:)-2
4179 y
SDict begin H.S end
 -2 4179 a -2 4179 a
SDict begin 13 H.A end
 -2 4179 a -2 4179 a
SDict begin [/View [/XYZ H.V]/Dest (0:3496) cvn /DEST pdfmark end
 -2 4179
a -2 4189 a
SDict begin H.S end
 -2 4189 a -2 4189 a
SDict begin 13 H.A end
 -2 4189 a -2 4189 a
SDict begin [/View [/XYZ H.V]/Dest (0:3497) cvn /DEST pdfmark end
 -2
4189 a Black 396 4331 a Fj(\225)p Black 479 4331 a
SDict begin H.S end
 479
4331 a 479 4331 a
SDict begin 13 H.A end
 479 4331 a 479 4331 a
SDict begin [/View [/XYZ H.V]/Dest (0:3498) cvn /DEST pdfmark end
 479 4331 a Fk(The)f(client)g
(detects)h(that)f(primary)f(serv)o(er)g(is)i(no)f(longer)f(sending)g
(heartbeats,)g(so)h(has)h(died.)e(The)h(client)g(connects)479
4439 y(to)h(the)f(backup)e(serv)o(er)i(and)f(requests)h(a)h(ne)n(w)f
(state)h(snapshot.)-2 4457 y
SDict begin H.S end
 -2 4457 a -2 4457 a
SDict begin 13 H.A end
 -2 4457
a -2 4457 a
SDict begin [/View [/XYZ H.V]/Dest (0:3499) cvn /DEST pdfmark end
 -2 4457 a Black 396 4589 a Fj(\225)p Black
479 4589 a
SDict begin H.S end
 479 4589 a 479 4589 a
SDict begin 13 H.A end
 479 4589 a 479 4589
a
SDict begin [/View [/XYZ H.V]/Dest (0:3500) cvn /DEST pdfmark end
 479 4589 a Fk(The)f(backup)f(serv)o(er)g(starts)i(to)f(recei)n(v)o(e)
f(snapshot)h(requests)g(from)f(clients,)h(and)g(detects)g(that)g
(primary)f(serv)o(er)g(has)479 4697 y(gone,)g(so)i(tak)o(es)f(o)o(v)o
(er)f(as)i(primary)-5 b(.)-2 4715 y
SDict begin H.S end
 -2 4715 a -2 4715
a
SDict begin 13 H.A end
 -2 4715 a -2 4715 a
SDict begin [/View [/XYZ H.V]/Dest (0:3501) cvn /DEST pdfmark end
 -2 4715 a Black 396 4846 a Fj(\225)p
Black 479 4846 a
SDict begin H.S end
 479 4846 a 479 4846 a
SDict begin 13 H.A end
 479 4846 a 479
4846 a
SDict begin [/View [/XYZ H.V]/Dest (0:3502) cvn /DEST pdfmark end
 479 4846 a Fk(The)20 b(backup)f(serv)o(er)g(applies)h(its)h
(pending)d(list)k(to)e(its)h(o)n(wn)f(hash)g(table,)g(and)f(then)h
(starts)h(to)f(process)g(state)479 4954 y(snapshot)g(requests.)p
Black 3759 5569 a Ff(294)p Black eop end
%%Page: 295 308
TeXDict begin 295 307 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.295) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3503) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(When)i(the)g(primary)f(serv)o(er)g(comes)h(back)g
(on-line,)e(it)j(will:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90
a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:3504) cvn /DEST pdfmark end
 -2 90 a -2 100 a
SDict begin H.S end
 -2 100 a -2 100 a
SDict begin 13 H.A end
 -2 100 a
-2 100 a
SDict begin [/View [/XYZ H.V]/Dest (0:3505) cvn /DEST pdfmark end
 -2 100 a Black 396 243 a Fj(\225)p Black 479
243 a
SDict begin H.S end
 479 243 a 479 243 a
SDict begin 13 H.A end
 479 243 a 479 243 a
SDict begin [/View [/XYZ H.V]/Dest (0:3506) cvn /DEST pdfmark end
 479 243
a Fk(Start)g(up)f(as)h(sla)n(v)o(e)f(serv)o(er)m(,)f(and)g(connect)g
(to)i(the)f(backup)e(serv)o(er)i(as)h(a)f(Clone)g(client.)-2
261 y
SDict begin H.S end
 -2 261 a -2 261 a
SDict begin 13 H.A end
 -2 261 a -2 261 a
SDict begin [/View [/XYZ H.V]/Dest (0:3507) cvn /DEST pdfmark end
 -2 261 a Black
396 392 a Fj(\225)p Black 479 392 a
SDict begin H.S end
 479 392 a 479 392
a
SDict begin 13 H.A end
 479 392 a 479 392 a
SDict begin [/View [/XYZ H.V]/Dest (0:3508) cvn /DEST pdfmark end
 479 392 a Fk(Start)h(to)f(recei)n(v)o(e)f
(updates)h(from)f(clients,)h(via)g(its)i(SUB)f(sock)o(et.)-2
576 y
SDict begin H.S end
 -2 576 a -2 576 a
SDict begin 13 H.A end
 -2 576 a -2 576 a
SDict begin [/View [/XYZ H.V]/Dest (0:3509) cvn /DEST pdfmark end
 -2 576 a 396
666 a Fk(W)-7 b(e)22 b(mak)o(e)d(some)h(assumptions:)-2
684 y
SDict begin H.S end
 -2 684 a -2 684 a
SDict begin 13 H.A end
 -2 684 a -2 684 a
SDict begin [/View [/XYZ H.V]/Dest (0:3510) cvn /DEST pdfmark end
 -2 684 a -2
694 a
SDict begin H.S end
 -2 694 a -2 694 a
SDict begin 13 H.A end
 -2 694 a -2 694 a
SDict begin [/View [/XYZ H.V]/Dest (0:3511) cvn /DEST pdfmark end
 -2 694 a Black
396 836 a Fj(\225)p Black 479 836 a
SDict begin H.S end
 479 836 a 479 836
a
SDict begin 13 H.A end
 479 836 a 479 836 a
SDict begin [/View [/XYZ H.V]/Dest (0:3512) cvn /DEST pdfmark end
 479 836 a Fk(That)g(at)h(least)g(one)e(serv)o(er)
h(will)h(k)o(eep)e(running.)f(If)i(both)g(serv)o(ers)f(crash,)h(we)g
(lose)h(all)g(serv)o(er)e(state)i(and)f(there')-5 b(s)20
b(no)479 944 y(w)o(ay)h(to)f(reco)o(v)o(er)e(it.)-2 962
y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:3513) cvn /DEST pdfmark end
 -2 962 a Black
396 1094 a Fj(\225)p Black 479 1094 a
SDict begin H.S end
 479 1094 a 479
1094 a
SDict begin 13 H.A end
 479 1094 a 479 1094 a
SDict begin [/View [/XYZ H.V]/Dest (0:3514) cvn /DEST pdfmark end
 479 1094 a Fk(That)i(multiple)g(clients)g
(do)g(not)g(update)f(the)h(same)h(hash)f(k)o(e)o(ys,)f(at)i(the)f(same)
g(time.)h(Client)f(updates)g(will)h(arri)n(v)o(e)e(at)479
1202 y(the)h(tw)o(o)h(serv)o(ers)f(in)g(a)h(dif)n(ferent)d(order)-5
b(.)19 b(So,)h(the)h(backup)d(serv)o(er)h(may)h(apply)f(updates)h(from)
f(its)i(pending)d(list)k(in)e(a)479 1310 y(dif)n(ferent)f(order)g(than)
g(the)i(primary)d(serv)o(er)i(w)o(ould)f(or)h(did.)g(Updates)f(from)h
(one)f(client)h(will)h(al)o(w)o(ays)g(arri)n(v)o(e)e(in)h(the)479
1417 y(same)h(order)e(on)g(both)h(serv)o(ers,)f(so)i(that)f(is)h(safe.)
-2 1595 y
SDict begin H.S end
 -2 1595 a -2 1595 a
SDict begin 13 H.A end
 -2 1595 a -2 1595 a
SDict begin [/View [/XYZ H.V]/Dest (0:3515) cvn /DEST pdfmark end
 -2
1595 a 396 1691 a Fk(So)g(the)f(architecture)f(for)g(our)g(high-a)n(v)n
(ailability)f(serv)o(er)i(pair)g(using)f(the)h(Binary)g(Star)h(pattern)
e(has)h(tw)o(o)h(serv)o(ers)e(and)396 1799 y(a)i(set)g(of)f(clients)g
(that)h(talk)f(to)g(both)g(serv)o(ers\()p 0 TeXcolorgray
1702 1799 a
SDict begin H.S end
 1702 1799 a Fk(Figure)e(5-7)2050 1799 y
SDict begin 13 H.L end
 2050
1799 a 2050 1799 a
SDict begin [/Subtype /Link/Dest (0:figure-69) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2050 1799 a Black -2 w Fk(\).)-2 1817
y
SDict begin H.S end
 -2 1817 a -2 1817 a
SDict begin 13 H.A end
 -2 1817 a -2 1817 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-69) cvn /DEST pdfmark
end
 -2 1817 a 396
2001 a Fg(Figur)o(e)i(5-7.)f(High-a)n(v)o(ailability)e(Clone)k(Ser)o(v)
o(er)f(P)o(air)-2 2101 y
SDict begin H.S end
 -2 2101 a -2 2101 a
SDict begin 13 H.A end
 -2 2101
a -2 2101 a
SDict begin [/View [/XYZ H.V]/Dest (0:3519) cvn /DEST pdfmark end
 -2 2101 a 396 3342 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3342 a @beginspecial
0 @llx -144 @lly 260 @urx 0 @ury 2600 @rwi @setspecial
%%BeginDocument: images/fig69.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -144 260 0
%%HiResBoundingBox: 0.0 -144.0 260.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
11.200119972229004 -16.20012092590332 moveto
11.200119972229004 -40.20011901855469 lineto
95.20011901855469 -40.20011901855469 lineto
95.20011901855469 -16.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
11.200119972229004 -40.20011901855469 moveto
11.200119972229004 -49.20011901855469 lineto
11.200119972229004 -51.20011901855469 11.86678663889567 -52.20011901855469 13.200119972229004 -52.20011901855469 curveto
34.40011978149414 -52.20011901855469 lineto
34.20011901855469 -52.20011901855469 lineto
34.20011901855469 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
35.20011901855469 -40.20011901855469 moveto
35.20011901855469 -52.20011901855469 lineto
70.20011901855469 -52.20011901855469 lineto
70.20011901855469 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
71.20011901855469 -40.20011901855469 moveto
71.20011901855469 -52.20011901855469 lineto
93.20011901855469 -52.20011901855469 lineto
94.53345235188802 -52.20011901855469 95.20011901855469 -51.20011901855469 95.20011901855469 -49.20011901855469 curveto
95.20011901855469 -40.20011901855469 lineto
95.20011901855469 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
167.2001190185547 -16.20012092590332 moveto
167.2001190185547 -49.20011901855469 lineto
167.2001190185547 -51.20011901855469 167.86678568522134 -52.20011901855469 169.2001190185547 -52.20011901855469 curveto
249.2001190185547 -52.20011901855469 lineto
249.2001190185547 -52.20011901855469 lineto
250.53345235188803 -52.20011901855469 251.2001190185547 -51.20011901855469 251.2001190185547 -49.20011901855469 curveto
251.2001190185547 -17.000120162963867 lineto
251.2001190185547 -16.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
167.2001190185547 -16.20012092590332 moveto
167.2001190185547 -40.20011901855469 lineto
251.2001190185547 -40.20011901855469 lineto
251.2001190185547 -16.20012092590332 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
167.2001190185547 -40.20011901855469 moveto
167.2001190185547 -49.20011901855469 lineto
167.2001190185547 -51.20011901855469 167.86678568522134 -52.20011901855469 169.2001190185547 -52.20011901855469 curveto
190.40011596679688 -52.20011901855469 lineto
190.2001190185547 -52.20011901855469 lineto
190.2001190185547 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
191.2001190185547 -40.20011901855469 moveto
191.2001190185547 -52.20011901855469 lineto
226.2001190185547 -52.20011901855469 lineto
226.2001190185547 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
227.2001190185547 -40.20011901855469 moveto
227.2001190185547 -52.20011901855469 lineto
249.2001190185547 -52.20011901855469 lineto
250.53345235188803 -52.20011901855469 251.2001190185547 -51.20011901855469 251.2001190185547 -49.20011901855469 curveto
251.2001190185547 -40.20011901855469 lineto
251.2001190185547 -40.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
13.200119972229004 -94.20011901855469 moveto
11.86678663889567 -94.20011901855469 11.200119972229004 -95.20011901855469 11.200119972229004 -97.20011901855469 curveto
11.200119972229004 -106.20011901855469 lineto
34.20011901855469 -106.20011901855469 lineto
34.20011901855469 -94.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
35.20011901855469 -94.20011901855469 moveto
35.20011901855469 -106.20011901855469 lineto
70.20011901855469 -106.20011901855469 lineto
70.20011901855469 -94.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
71.20011901855469 -94.20011901855469 moveto
71.20011901855469 -106.20011901855469 lineto
95.20011901855469 -106.20011901855469 lineto
95.20011901855469 -97.20011901855469 lineto
95.20011901855469 -95.20011901855469 94.53345235188802 -94.20011901855469 93.20011901855469 -94.20011901855469 curveto
72.0001220703125 -94.20011901855469 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
11.200119972229004 -106.20011901855469 moveto
11.200119972229004 -130.2001190185547 lineto
95.20011901855469 -130.2001190185547 lineto
95.20011901855469 -106.20011901855469 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
10.0 -15.0 moveto
10.0 -39.0 lineto
94.0 -39.0 lineto
94.0 -15.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.4 setlinewidth
1 setlinecap
[] 0 setdash
newpath
10.0 -15.0 moveto
10.0 -39.0 lineto
94.0 -39.0 lineto
94.0 -15.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
10.0 -39.0 moveto
10.0 -48.0 lineto
10.0 -50.0 10.666666666666666 -51.0 12.0 -51.0 curveto
33.20000076293945 -51.0 lineto
33.0 -51.0 lineto
33.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
10.0 -39.0 moveto
10.0 -48.0 lineto
10.0 -50.0 10.666666666666666 -51.0 12.0 -51.0 curveto
33.20000076293945 -51.0 lineto
33.0 -51.0 lineto
33.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
34.0 -39.0 moveto
34.0 -51.0 lineto
69.0 -51.0 lineto
69.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
34.0 -39.0 moveto
34.0 -51.0 lineto
69.0 -51.0 lineto
69.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
70.0 -39.0 moveto
70.0 -51.0 lineto
92.0 -51.0 lineto
93.33333333333333 -51.0 94.0 -50.0 94.0 -48.0 curveto
94.0 -39.0 lineto
94.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
70.0 -39.0 moveto
70.0 -51.0 lineto
92.0 -51.0 lineto
93.33333333333333 -51.0 94.0 -50.0 94.0 -48.0 curveto
94.0 -39.0 lineto
94.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
166.0 -15.0 moveto
166.0 -48.0 lineto
166.0 -50.0 166.66666666666666 -51.0 168.0 -51.0 curveto
248.0 -51.0 lineto
248.0 -51.0 lineto
249.33333333333334 -51.0 250.0 -50.0 250.0 -48.0 curveto
250.0 -15.800000190734863 lineto
250.0 -15.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
166.0 -15.0 moveto
166.0 -48.0 lineto
166.0 -50.0 166.66666666666666 -51.0 168.0 -51.0 curveto
248.0 -51.0 lineto
248.0 -51.0 lineto
249.33333333333334 -51.0 250.0 -50.0 250.0 -48.0 curveto
250.0 -15.800000190734863 lineto
250.0 -15.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
166.0 -15.0 moveto
166.0 -39.0 lineto
250.0 -39.0 lineto
250.0 -15.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
166.0 -15.0 moveto
166.0 -39.0 lineto
250.0 -39.0 lineto
250.0 -15.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
166.0 -39.0 moveto
166.0 -48.0 lineto
166.0 -50.0 166.66666666666666 -51.0 168.0 -51.0 curveto
189.1999969482422 -51.0 lineto
189.0 -51.0 lineto
189.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
166.0 -39.0 moveto
166.0 -48.0 lineto
166.0 -50.0 166.66666666666666 -51.0 168.0 -51.0 curveto
189.1999969482422 -51.0 lineto
189.0 -51.0 lineto
189.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
190.0 -39.0 moveto
190.0 -51.0 lineto
225.0 -51.0 lineto
225.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
190.0 -39.0 moveto
190.0 -51.0 lineto
225.0 -51.0 lineto
225.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
226.0 -39.0 moveto
226.0 -51.0 lineto
248.0 -51.0 lineto
249.33333333333334 -51.0 250.0 -50.0 250.0 -48.0 curveto
250.0 -39.0 lineto
250.0 -39.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
226.0 -39.0 moveto
226.0 -51.0 lineto
248.0 -51.0 lineto
249.33333333333334 -51.0 250.0 -50.0 250.0 -48.0 curveto
250.0 -39.0 lineto
250.0 -39.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
12.0 -93.0 moveto
10.666666666666666 -93.0 10.0 -94.0 10.0 -96.0 curveto
10.0 -105.0 lineto
33.0 -105.0 lineto
33.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
12.0 -93.0 moveto
10.666666666666666 -93.0 10.0 -94.0 10.0 -96.0 curveto
10.0 -105.0 lineto
33.0 -105.0 lineto
33.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
34.0 -93.0 moveto
34.0 -105.0 lineto
69.0 -105.0 lineto
69.0 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
34.0 -93.0 moveto
34.0 -105.0 lineto
69.0 -105.0 lineto
69.0 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
70.0 -93.0 moveto
70.0 -105.0 lineto
94.0 -105.0 lineto
94.0 -96.0 lineto
94.0 -94.0 93.33333333333333 -93.0 92.0 -93.0 curveto
70.80000305175781 -93.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
70.0 -93.0 moveto
70.0 -105.0 lineto
94.0 -105.0 lineto
94.0 -96.0 lineto
94.0 -94.0 93.33333333333333 -93.0 92.0 -93.0 curveto
70.80000305175781 -93.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
10.0 -105.0 moveto
10.0 -129.0 lineto
94.0 -129.0 lineto
94.0 -105.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
10.0 -105.0 moveto
10.0 -129.0 lineto
94.0 -129.0 lineto
94.0 -105.0 lineto
closepath
stroke
newpath
98.0 -27.0 moveto
162.0 -27.0 lineto
stroke
newpath
22.0 -51.0 moveto
22.0 -87.0 lineto
stroke
newpath
54.0 -57.0 moveto
54.0 -93.0 lineto
stroke
newpath
100.0 -24.0 moveto
96.0 -27.0 lineto
100.0 -30.0 lineto
closepath
fill
newpath
160.0 -24.0 moveto
164.0 -27.0 lineto
160.0 -30.0 lineto
closepath
fill
newpath
54.0 -54.0 moveto
52.0 -60.0 lineto
56.0 -60.0 lineto
closepath
fill
newpath
82.0 -54.0 moveto
80.0 -60.0 lineto
84.0 -60.0 lineto
closepath
fill
newpath
238.0 -54.0 moveto
236.0 -60.0 lineto
240.0 -60.0 lineto
closepath
fill
newpath
20.0 -84.0 moveto
22.0 -90.0 lineto
24.0 -84.0 lineto
closepath
fill
newpath
82.0 -57.0 moveto
82.0 -75.0 lineto
stroke
newpath
238.0 -57.0 moveto
238.0 -72.0 lineto
238.0 -74.0 237.33333333333334 -75.0 236.0 -75.0 curveto
82.0 -75.0 lineto
82.0 -75.0 lineto
stroke
newpath
82.0 -93.0 moveto
82.0 -75.0 lineto
stroke
/Helvetica findfont
5 scalefont setfont
123.0 -23.0 moveto
(Binary) show
44.0 -29.0 moveto
(Primary) show
198.0 -29.0 moveto
(Backup) show
127.0 -35.0 moveto
(Star) show
16.0 -47.0 moveto
(PUB) show
41.0 -47.0 moveto
(ROUTER) show
76.0 -47.0 moveto
(SUB) show
172.0 -47.0 moveto
(PUB) show
197.0 -47.0 moveto
(ROUTER) show
232.0 -47.0 moveto
(SUB) show
16.0 -101.0 moveto
(SUB) show
42.0 -101.0 moveto
(DEALER) show
76.0 -101.0 moveto
(PUB) show
44.0 -119.0 moveto
(Client) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3342 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3342 a -2 3508 a
SDict begin H.S end
 -2 3508
a -2 3508 a
SDict begin 13 H.A end
 -2 3508 a -2 3508 a
SDict begin [/View [/XYZ H.V]/Dest (0:3522) cvn /DEST pdfmark end
 -2 3508 a 396 3616 a
Fk(As)h(a)g(\002rst)g(step)f(to)h(b)n(uilding)e(this,)h(we')l(re)g
(going)e(to)j(ref)o(actor)e(the)h(client)g(as)h(a)g(reusable)e(class.)i
(This)f(is)i(partly)d(for)h(fun)396 3724 y(\(writing)g(asynchronous)d
(classes)k(with)f(\330MQ)h(is)g(lik)o(e)g(an)f(e)o(x)o(ercise)f(in)h
(ele)o(gance\),)e(b)n(ut)i(mainly)g(because)f(we)i(w)o(ant)396
3832 y(Clone)f(to)h(be)f(really)g(easy)g(to)g(plug-in)f(to)h(random)f
(applications.)f(Since)j(resilience)e(depends)g(on)h(clients)h(beha)n
(ving)396 3940 y(correctly)-5 b(,)18 b(it')-5 b(s)22
b(much)d(easier)h(to)h(guarantee)d(this)j(when)e(there')-5
b(s)21 b(a)f(reusable)g(client)g(API.)g(When)g(we)h(start)f(to)h
(handle)396 4048 y(f)o(ail-o)o(v)o(er)e(in)h(clients,)g(it)h(does)f
(get)g(a)h(little)g(comple)o(x)d(\(imagine)h(mixing)g(a)i(Freelance)e
(client)i(with)f(a)h(Clone)f(client\).)396 4156 y(So,)g(reusability)g
(aho)o(y!)-2 4340 y
SDict begin H.S end
 -2 4340 a -2 4340 a
SDict begin 13 H.A end
 -2 4340 a -2
4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:3523) cvn /DEST pdfmark end
 -2 4340 a 396 4430 a Fk(My)g(usual)f(design)f(approach)g(is)i
(to)g(\002rst)g(design)e(an)i(API)g(that)f(feels)h(right,)e(then)h(to)h
(implement)e(that.)h(So,)g(we)h(start)g(by)396 4538 y(taking)g(the)g
(clone)f(client,)h(and)g(re)n(writing)f(it)i(to)f(sit)h(on)f(top)g(of)g
(some)g(presumed)f(class)i(API)f(called)3304 4538 y
SDict begin H.S end
 3304
4538 a 3304 4538 a
SDict begin 13 H.A end
 3304 4538 a 3304 4538 a
SDict begin [/View [/XYZ H.V]/Dest (0:3524) cvn /DEST pdfmark end
 3304 4538
a Fg(clone)p Fk(.)g(T)l(urning)396 4645 y(random)f(code)g(into)h(an)g
(API)h(means)f(de\002ning)e(a)j(reasonably)e(stable)h(and)g(abstract)g
(contract)f(with)h(applications.)f(F)o(or)396 4753 y(e)o(xample,)g(in)h
(Model)g(Fi)n(v)o(e,)f(the)i(client)f(opened)e(three)i(separate)g(sock)
o(ets)g(to)h(the)f(serv)o(er)m(,)f(using)g(endpoints)g(that)h(were)396
4861 y(hard-coded)d(in)k(the)f(source.)f(W)-7 b(e)22
b(could)d(mak)o(e)h(an)g(API)g(with)h(three)e(methods,)g(lik)o(e)i
(this:)-2 4956 y
SDict begin H.S end
 -2 4956 a -2 4956 a
SDict begin 11.7 H.A end
 -2 4956 a -2 4956
a
SDict begin [/View [/XYZ H.V]/Dest (0:3525) cvn /DEST pdfmark end
 -2 4956 a 396 5042 a Fe(//)90 b(Specify)43 b(endpoints)h(for)g(each)g
(socket)g(we)g(need)396 5139 y(clone_subscribe)f(\(clone,)g
("tcp://localhost:5556"\);)p Black 3759 5569 a Ff(295)p
Black eop end
%%Page: 296 309
TeXDict begin 296 308 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.296) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(clone_snapshot)88 b(\(clone,)43 b
("tcp://localhost:5557"\);)396 170 y(clone_updates)133
b(\(clone,)43 b("tcp://localhost:5558"\);)396 364 y(//)90
b(Times)44 b(two,)g(since)g(we)g(have)g(two)h(servers)396
461 y(clone_subscribe)e(\(clone,)g("tcp://localhost:5566"\);)396
558 y(clone_snapshot)88 b(\(clone,)43 b("tcp://localhost:5567"\);)396
655 y(clone_updates)133 b(\(clone,)43 b("tcp://localhost:5568"\);)-2
833 y
SDict begin H.S end
 -2 833 a -2 833 a
SDict begin 13 H.A end
 -2 833 a -2 833 a
SDict begin [/View [/XYZ H.V]/Dest (0:3526) cvn /DEST pdfmark end
 -2 833 a 396
929 a Fk(But)21 b(this)g(is)g(both)e(v)o(erbose)g(and)h(fragile.)f(It')
-5 b(s)21 b(not)e(a)i(good)e(idea)h(to)g(e)o(xpose)f(the)i(internals)e
(of)h(a)h(design)e(to)396 1037 y(applications.)g(T)-7
b(oday)i(,)19 b(we)h(use)h(three)e(sock)o(ets.)h(T)-7
b(omorro)n(w)i(,)18 b(tw)o(o,)i(or)g(four)-5 b(.)19 b(Do)h(we)h(really)
f(w)o(ant)g(to)g(go)g(and)g(change)396 1145 y(e)n(v)o(ery)f
(application)g(that)h(uses)h(the)f(clone)g(class?)h(So)f(to)g(hide)g
(these)g(sausage)g(f)o(actory)f(details,)i(we)f(mak)o(e)g(a)h(small)396
1253 y(abstraction,)e(lik)o(e)i(this:)-2 1348 y
SDict begin H.S end
 -2 1348
a -2 1348 a
SDict begin 11.7 H.A end
 -2 1348 a -2 1348 a
SDict begin [/View [/XYZ H.V]/Dest (0:3527) cvn /DEST pdfmark end
 -2 1348 a 396 1433 a
Fe(//)90 b(Specify)43 b(primary)h(and)g(backup)g(servers)396
1530 y(clone_connect)f(\(clone,)h("tcp://localhost:5551"\);)396
1627 y(clone_connect)f(\(clone,)h("tcp://localhost:5561"\);)-2
1805 y
SDict begin H.S end
 -2 1805 a -2 1805 a
SDict begin 13 H.A end
 -2 1805 a -2 1805 a
SDict begin [/View [/XYZ H.V]/Dest (0:3528) cvn /DEST pdfmark end
 -2 1805
a 396 1901 a Fk(Which)20 b(has)h(the)f(adv)n(antage)e(of)i(simplicity)g
(\(one)f(serv)o(er)h(sits)h(at)g(one)f(endpoint\))d(b)n(ut)k(has)f(an)g
(impact)g(on)g(our)f(internal)396 2009 y(design.)h(W)-7
b(e)21 b(no)n(w)f(need)f(to)h(someho)n(w)f(turn)h(that)g(single)g
(endpoint)e(into)i(three)g(endpoints.)f(One)h(w)o(ay)g(w)o(ould)f(be)h
(to)396 2117 y(bak)o(e)g(the)g(kno)n(wledge)e("client)i(and)g(serv)o
(er)f(talk)h(o)o(v)o(er)f(three)h(consecuti)n(v)o(e)e(ports")i(into)g
(our)f(client-serv)o(er)g(protocol.)396 2225 y(Another)g(w)o(ay)h(w)o
(ould)g(be)g(to)g(get)g(the)h(tw)o(o)f(missing)g(endpoints)f(from)g
(the)h(serv)o(er)-5 b(.)20 b(W)-7 b(e')o(ll)21 b(tak)o(e)f(the)h
(simplest)f(w)o(ay)-5 b(,)396 2333 y(which)20 b(is:)-2
2334 y
SDict begin H.S end
 -2 2334 a -2 2334 a
SDict begin 13 H.A end
 -2 2334 a -2 2334 a
SDict begin [/View [/XYZ H.V]/Dest (0:3529) cvn /DEST pdfmark end
 -2 2334
a -2 2344 a
SDict begin H.S end
 -2 2344 a -2 2344 a
SDict begin 13 H.A end
 -2 2344 a -2 2344 a
SDict begin [/View [/XYZ H.V]/Dest (0:3530) cvn /DEST pdfmark end
 -2
2344 a Black 396 2503 a Fj(\225)p Black 479 2503 a
SDict begin H.S end
 479
2503 a 479 2503 a
SDict begin 13 H.A end
 479 2503 a 479 2503 a
SDict begin [/View [/XYZ H.V]/Dest (0:3531) cvn /DEST pdfmark end
 479 2503 a Fk(The)g(serv)o(er)f
(state)i(router)e(\(R)m(OUTER\))h(is)h(at)g(port)f(P)-9
b(.)-2 2521 y
SDict begin H.S end
 -2 2521 a -2 2521 a
SDict begin 13 H.A end
 -2 2521 a -2 2521 a
SDict begin [/View [/XYZ H.V]/Dest (0:3532) cvn /DEST pdfmark end

-2 2521 a Black 396 2653 a Fj(\225)p Black 479 2653 a
SDict begin H.S end

479 2653 a 479 2653 a
SDict begin 13 H.A end
 479 2653 a 479 2653 a
SDict begin [/View [/XYZ H.V]/Dest (0:3533) cvn /DEST pdfmark end
 479 2653
a Fk(The)20 b(serv)o(er)f(updates)h(publisher)f(\(PUB\))h(is)h(at)g
(port)e(P)i(+)g(1.)-2 2671 y
SDict begin H.S end
 -2 2671 a -2 2671 a
SDict begin 13 H.A end
 -2 2671
a -2 2671 a
SDict begin [/View [/XYZ H.V]/Dest (0:3534) cvn /DEST pdfmark end
 -2 2671 a Black 396 2802 a Fj(\225)p Black
479 2802 a
SDict begin H.S end
 479 2802 a 479 2802 a
SDict begin 13 H.A end
 479 2802 a 479 2802
a
SDict begin [/View [/XYZ H.V]/Dest (0:3535) cvn /DEST pdfmark end
 479 2802 a Fk(The)f(serv)o(er)f(updates)h(subscriber)f(\(SUB\))h(is)h
(at)g(port)f(P)h(+)f(2.)-2 2986 y
SDict begin H.S end
 -2 2986 a -2 2986 a
SDict begin 13 H.A end

-2 2986 a -2 2986 a
SDict begin [/View [/XYZ H.V]/Dest (0:3536) cvn /DEST pdfmark end
 -2 2986 a 396 3076 a Fk(The)g(clone)g(class)h(has)f
(the)g(same)h(structure)e(as)i(the)f(\003cliapi)h(class)g(from)e
(Chapter)g(F)o(our)-5 b(.)20 b(It)g(consists)h(of)f(tw)o(o)h(parts:)-2
3094 y
SDict begin H.S end
 -2 3094 a -2 3094 a
SDict begin 13 H.A end
 -2 3094 a -2 3094 a
SDict begin [/View [/XYZ H.V]/Dest (0:3537) cvn /DEST pdfmark end
 -2 3094
a -2 3104 a
SDict begin H.S end
 -2 3104 a -2 3104 a
SDict begin 13 H.A end
 -2 3104 a -2 3104 a
SDict begin [/View [/XYZ H.V]/Dest (0:3538) cvn /DEST pdfmark end
 -2
3104 a Black 396 3246 a Fj(\225)p Black 479 3246 a
SDict begin H.S end
 479
3246 a 479 3246 a
SDict begin 13 H.A end
 479 3246 a 479 3246 a
SDict begin [/View [/XYZ H.V]/Dest (0:3539) cvn /DEST pdfmark end
 479 3246 a Fk(An)f
(asynchronous)e(clone)h(agent)h(that)g(runs)g(in)g(a)h(background)c
(thread.)i(The)g(agent)h(handles)f(all)i(netw)o(ork)e(I/O,)479
3354 y(talking)h(to)g(serv)o(ers)g(in)g(real-time,)f(no)h(matter)g
(what)g(the)g(application)f(is)i(doing.)-2 3372 y
SDict begin H.S end
 -2
3372 a -2 3372 a
SDict begin 13 H.A end
 -2 3372 a -2 3372 a
SDict begin [/View [/XYZ H.V]/Dest (0:3540) cvn /DEST pdfmark end
 -2 3372 a Black
396 3504 a Fj(\225)p Black 479 3504 a
SDict begin H.S end
 479 3504 a 479
3504 a
SDict begin 13 H.A end
 479 3504 a 479 3504 a
SDict begin [/View [/XYZ H.V]/Dest (0:3541) cvn /DEST pdfmark end
 479 3504 a Fk(A)g(synchronous)c('clone')i
(class)i(which)f(runs)g(in)g(the)g(caller')-5 b(s)21
b(thread.)e(When)h(you)f(create)h(a)h(clone)e(object,)h(that)479
3612 y(automatically)f(launches)g(an)h(agent)g(thread,)f(and)h(when)f
(you)g(destro)o(y)h(a)g(clone)g(object,)f(it)i(kills)g(the)f(agent)g
(thread.)-2 3796 y
SDict begin H.S end
 -2 3796 a -2 3796 a
SDict begin 13 H.A end
 -2 3796 a -2 3796
a
SDict begin [/View [/XYZ H.V]/Dest (0:3542) cvn /DEST pdfmark end
 -2 3796 a 396 3886 a Fk(The)g(frontend)e(class)j(talks)g(to)f(the)g
(agent)g(class)h(o)o(v)o(er)e(an)2063 3886 y
SDict begin H.S end
 2063 3886
a 2063 3886 a
SDict begin 13 H.A end
 2063 3886 a 2063 3886 a
SDict begin [/View [/XYZ H.V]/Dest (0:3543) cvn /DEST pdfmark end
 2063 3886 a Fe(inproc)h
Fk('pipe')f(sock)o(et.)h(In)g(C,)g(the)h(CZMQ)f(thread)f(layer)396
3994 y(creates)h(this)h(pipe)f(automatically)f(for)g(us)i(as)g(it)g
(starts)g(an)f("attached)f(thread".)g(This)h(is)h(a)g(natural)e
(pattern)h(for)396 4102 y(multithreading)e(o)o(v)o(er)h(\330MQ.)-2
4286 y
SDict begin H.S end
 -2 4286 a -2 4286 a
SDict begin 13 H.A end
 -2 4286 a -2 4286 a
SDict begin [/View [/XYZ H.V]/Dest (0:3544) cvn /DEST pdfmark end
 -2 4286
a 396 4376 a Fk(W)m(ithout)h(\330MQ,)g(this)h(kind)e(of)h(asynchronous)
d(class)k(design)f(w)o(ould)f(be)i(weeks)f(of)g(really)g(hard)f(w)o
(ork.)g(W)m(ith)i(\330MQ,)396 4483 y(it)g(w)o(as)g(a)g(day)e(or)h(tw)o
(o)h(of)f(w)o(ork.)f(The)h(results)g(are)h(kind)e(of)h(comple)o(x,)e
(gi)n(v)o(en)h(the)h(simplicity)g(of)g(the)g(Clone)g(protocol)396
4591 y(it')-5 b(s)22 b(actually)d(running.)f(There)h(are)h(some)g
(reasons)g(for)g(this.)g(W)-7 b(e)22 b(could)d(turn)g(this)i(into)f(a)h
(reactor)m(,)d(b)n(ut)i(that')l(d)g(mak)o(e)f(it)396
4699 y(harder)g(to)h(use)h(in)f(applications.)f(So)h(the)h(API)f(looks)
g(a)g(bit)h(lik)o(e)f(a)h(k)o(e)o(y-v)n(alue)d(table)i(that)g
(magically)f(talks)i(to)f(some)396 4807 y(serv)o(ers:)-2
4891 y
SDict begin H.S end
 -2 4891 a -2 4891 a
SDict begin 11.7 H.A end
 -2 4891 a -2 4891 a
SDict begin [/View [/XYZ H.V]/Dest (0:3545) cvn /DEST pdfmark end
 -2 4891
a 396 4987 a Fe(clone_t)755 5000 y(*)800 4987 y(clone_new)43
b(\(void\);)396 5085 y(void)h(clone_destroy)f(\(clone_t)1652
5098 y(**)1742 5085 y(self_p\);)p Black 3757 5569 a Ff(296)p
Black eop end
%%Page: 297 310
TeXDict begin 297 309 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.297) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(void)44 b(clone_connect)f(\(clone_t)1652
85 y(*)1697 72 y(self,)g(char)2190 85 y(*)2235 72 y(address,)g(char)
2862 85 y(*)2907 72 y(service\);)396 170 y(void)h(clone_set)g
(\(clone_t)1472 183 y(*)1517 170 y(self,)g(char)2010
183 y(*)2055 170 y(key,)g(char)2503 183 y(*)2548 170
y(value\);)396 267 y(char)620 280 y(*)665 267 y(clone_get)g(\(clone_t)
1517 280 y(*)1562 267 y(self,)g(char)2055 280 y(*)2100
267 y(key\);)-2 444 y
SDict begin H.S end
 -2 444 a -2 444 a
SDict begin 13 H.A end
 -2 444 a -2 444
a
SDict begin [/View [/XYZ H.V]/Dest (0:3546) cvn /DEST pdfmark end
 -2 444 a 396 541 a Fk(So)21 b(here)e(is)i(Model)f(Six)g(of)g(the)h
(clone)e(client,)h(which)g(has)g(no)n(w)g(become)f(just)i(a)f(thin)g
(shell)h(using)e(the)i(clone)e(class:)-2 559 y
SDict begin H.S end
 -2 559
a -2 559 a
SDict begin 13 H.A end
 -2 559 a -2 559 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonecli6-c) cvn /DEST pdfmark
end
 -2 559 a 396 742 a Fg(Example)i(5-42.)d
(Clone)j(client,)f(Model)h(Six)f(\(clonecli6.c\))-2 842
y
SDict begin H.S end
 -2 842 a -2 842 a
SDict begin 11.7 H.A end
 -2 842 a -2 842 a
SDict begin [/View [/XYZ H.V]/Dest (0:3549) cvn /DEST pdfmark end
 -2 842 a 396 922
a Fe(//)396 1019 y(//)90 b(Clone)44 b(client)f(Model)h(Six)396
1116 y(//)396 1311 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g
(without)g(creating)f(a)i(library)396 1408 y(#include)f("clone.c")396
1602 y(#define)g(SUBTREE)g("/client/")396 1796 y(int)h(main)f(\(void\))
396 1894 y({)576 1991 y(//)89 b(Create)44 b(distributed)f(hash)h
(instance)576 2088 y(clone_t)934 2101 y(*)979 2088 y(clone)g(=)h
(clone_new)e(\(\);)576 2282 y(//)89 b(Specify)44 b(configuration)576
2379 y(clone_subtree)e(\(clone,)i(SUBTREE\);)576 2476
y(clone_connect)e(\(clone,)i("tcp://localhost",)e("5556"\);)576
2574 y(clone_connect)g(\(clone,)i("tcp://localhost",)e("5566"\);)576
2768 y(//)89 b(Set)44 b(random)g(tuples)g(into)g(the)g(distributed)f
(hash)576 2865 y(while)h(\(!zctx_interrupted\))d({)755
2962 y(//)89 b(Set)45 b(random)e(value,)h(check)g(it)h(was)f(stored)755
3059 y(char)g(key)g([255];)755 3156 y(char)g(value)g([10];)755
3253 y(sprintf)g(\(key,)g("\045s\045d",)f(SUBTREE,)h(randof)g
(\(10000\)\);)755 3351 y(sprintf)g(\(value,)f("\045d",)h(randof)g
(\(1000000\)\);)755 3448 y(clone_set)f(\(clone,)h(key,)g(value,)g
(randof)g(\(30\)\);)755 3545 y(sleep)g(\(1\);)576 3642
y(})576 3739 y(clone_destroy)e(\(&clone\);)576 3836 y(return)h(0;)-2
4011 y
SDict begin H.S end
 -2 4011 a -2 4011 a
SDict begin 13 H.A end
 -2 4011 a -2 4011 a
SDict begin [/View [/XYZ H.V]/Dest (0:3550) cvn /DEST pdfmark end
 -2 4011
a 396 4110 a Fk(And)20 b(here)g(is)h(the)f(actual)g(clone)g(class)h
(implementation:)-2 4128 y
SDict begin H.S end
 -2 4128 a -2 4128 a
SDict begin 13 H.A end
 -2 4128
a -2 4128 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c) cvn /DEST pdfmark end
 -2 4128 a 396 4312 a Fg(Example)g(5-43.)d(Clone)j(class)f
(\(clone.c\))-2 4411 y
SDict begin H.S end
 -2 4411 a -2 4411 a
SDict begin 11.7 H.A end
 -2 4411 a
-2 4411 a
SDict begin [/View [/XYZ H.V]/Dest (0:3553) cvn /DEST pdfmark end
 -2 4411 a 396 4492 a Fe(/)441 4505 y(*)576
4492 y(=====================================)o(======)o(======)o
(======)o(======)o(=====)o(===)441 4602 y(*)576 4589
y(clone)44 b(-)g(client-side)f(Clone)h(Pattern)g(class)441
4699 y(*)576 4686 y(=====================================)o(======)o
(======)o(======)o(======)o(=====)o(===)3714 4699 y(*)3759
4686 y(/)396 4880 y(#include)g("clone.h")396 5075 y(//)90
b(If)44 b(no)h(server)e(replies)h(within)g(this)g(time,)g(abandon)g
(request)p Black 3756 5569 a Ff(297)p Black eop end
%%Page: 298 311
TeXDict begin 298 310 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.298) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(#define)44 b(GLOBAL_TIMEOUT)87 b(4000)179
b(//)89 b(msecs)396 364 y(//)h(=====================================)o
(======)o(======)o(======)o(======)o(=====)o(===)396
461 y(//)g(Synchronous)43 b(part,)h(works)g(in)g(our)g(application)f
(thread)396 655 y(//)90 b(-------------------------------------)o
(------)o(------)o(------)o(------)o(-----)o(---)396
752 y(//)g(Structure)43 b(of)h(our)h(class)396 947 y(struct)f(_clone_t)
g({)576 1044 y(zctx_t)889 1057 y(*)934 1044 y(ctx;)717
b(//)89 b(Our)45 b(context)e(wrapper)576 1141 y(void)800
1154 y(*)845 1141 y(pipe;)761 b(//)89 b(Pipe)44 b(through)g(to)h(clone)
f(agent)396 1238 y(};)396 1432 y(//)90 b(This)44 b(is)g(the)h(thread)e
(that)i(handles)e(our)i(real)f(clone)g(class)396 1530
y(static)g(void)g(clone_agent)f(\(void)1741 1543 y(*)1786
1530 y(args,)h(zctx_t)2369 1543 y(*)2414 1530 y(ctx,)g(void)2862
1543 y(*)2907 1530 y(pipe\);)-2 1707 y
SDict begin H.S end
 -2 1707 a -2 1707
a
SDict begin 13 H.A end
 -2 1707 a -2 1707 a
SDict begin [/View [/XYZ H.V]/Dest (0:3554) cvn /DEST pdfmark end
 -2 1707 a 396 1803 a Fk(Constructor)19
b(and)h(destructor)e(for)i(the)g(clone)g(class:)-2 1804
y
SDict begin H.S end
 -2 1804 a -2 1804 a
SDict begin 13 H.A end
 -2 1804 a -2 1804 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-1) cvn /DEST pdfmark
end
 -2 1804 a 396
2005 a Fg(Example)h(5-44.)d(Clone)j(class)f(\(clone.c\))g(-)g
(constructor)f(and)i(destructor)-2 2105 y
SDict begin H.S end
 -2 2105 a -2
2105 a
SDict begin 11.7 H.A end
 -2 2105 a -2 2105 a
SDict begin [/View [/XYZ H.V]/Dest (0:3557) cvn /DEST pdfmark end
 -2 2105 a 396 2282 a Fe(clone_t)755
2295 y(*)396 2379 y(clone_new)44 b(\(void\))396 2476
y({)576 2574 y(clone_t)755 2684 y(*)800 2671 y(self;)576
2865 y(self)g(=)g(\(clone_t)1293 2878 y(*)1338 2865 y(\))g(zmalloc)g
(\(sizeof)g(\(clone_t\)\);)576 2962 y(self->ctx)f(=)i(zctx_new)e(\(\);)
576 3059 y(self->pipe)g(=)h(zthread_fork)f(\(self->ctx,)g(clone_agent,)
g(NULL\);)576 3156 y(return)g(self;)396 3253 y(})396
3448 y(void)396 3545 y(clone_destroy)g(\(clone_t)1427
3558 y(**)1517 3545 y(self_p\))396 3642 y({)576 3739
y(assert)g(\(self_p\);)576 3836 y(if)h(\()755 3849 y(*)800
3836 y(self_p\))f({)755 3933 y(clone_t)1114 3946 y(*)1159
3933 y(self)h(=)1472 3946 y(*)1517 3933 y(self_p;)755
4031 y(zctx_destroy)f(\(&self->ctx\);)755 4128 y(free)h(\(self\);)755
4238 y(*)800 4225 y(self_p)g(=)g(NULL;)576 4322 y(})396
4419 y(})-2 4593 y
SDict begin H.S end
 -2 4593 a -2 4593 a
SDict begin 13 H.A end
 -2 4593 a -2 4593
a
SDict begin [/View [/XYZ H.V]/Dest (0:3558) cvn /DEST pdfmark end
 -2 4593 a 396 4693 a Fk(Specify)20 b(subtree)f(for)h(snapshot)f(and)h
(updates,)f(do)h(before)e(connect.)h(Sends)h([SUBTREE][subtree])e(to)j
(the)f(agent:)-2 4711 y
SDict begin H.S end
 -2 4711 a -2 4711 a
SDict begin 13 H.A end
 -2 4711 a
-2 4711 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-2) cvn /DEST pdfmark
end
 -2 4711 a Black 3759 5569 a Ff(298)p Black
eop end
%%Page: 299 312
TeXDict begin 299 311 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.299) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-45.)d(Clone)j(class)f(\(clone.c\))g(-)g
(subtr)o(ee)g(method)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172
a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3561) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(void)44 b(clone_subtree)f(\(clone_t)
1652 363 y(*)1697 350 y(self,)g(char)2190 363 y(*)2235
350 y(subtree\))396 447 y({)576 544 y(assert)g(\(self\);)576
641 y(zmsg_t)889 654 y(*)934 641 y(msg)i(=)f(zmsg_new)g(\(\);)576
738 y(zmsg_addstr)f(\(msg,)h("SUBTREE"\);)576 835 y(zmsg_addstr)f
(\(msg,)h(subtree\);)576 933 y(zmsg_send)f(\(&msg,)h(self->pipe\);)396
1030 y(})-2 1204 y
SDict begin H.S end
 -2 1204 a -2 1204 a
SDict begin 13 H.A end
 -2 1204 a -2 1204
a
SDict begin [/View [/XYZ H.V]/Dest (0:3562) cvn /DEST pdfmark end
 -2 1204 a 396 1304 a Fk(Connect)20 b(to)g(ne)n(w)g(serv)o(er)f
(endpoint.)f(Sends)j([CONNECT][endpoint][service])15
b(to)20 b(the)g(agent:)-2 1322 y
SDict begin H.S end
 -2 1322 a -2 1322 a
SDict begin 13 H.A end

-2 1322 a -2 1322 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-3) cvn /DEST pdfmark
end
 -2 1322 a 396 1505 a Fg(Example)h(5-46.)d(Clone)j
(class)f(\(clone.c\))g(-)g(connect)g(method)-2 1605 y
SDict begin H.S end

-2 1605 a -2 1605 a
SDict begin 11.7 H.A end
 -2 1605 a -2 1605 a
SDict begin [/View [/XYZ H.V]/Dest (0:3565) cvn /DEST pdfmark end
 -2 1605 a 396
1782 a Fe(void)396 1879 y(clone_connect)43 b(\(clone_t)1427
1892 y(*)1472 1879 y(self,)h(char)1965 1892 y(*)2010
1879 y(address,)g(char)2638 1892 y(*)2683 1879 y(service\))396
1977 y({)576 2074 y(assert)f(\(self\);)576 2171 y(zmsg_t)889
2184 y(*)934 2171 y(msg)i(=)f(zmsg_new)g(\(\);)576 2268
y(zmsg_addstr)f(\(msg,)h("CONNECT"\);)576 2365 y(zmsg_addstr)f(\(msg,)h
(address\);)576 2462 y(zmsg_addstr)f(\(msg,)h(service\);)576
2559 y(zmsg_send)f(\(&msg,)h(self->pipe\);)396 2657 y(})-2
2831 y
SDict begin H.S end
 -2 2831 a -2 2831 a
SDict begin 13 H.A end
 -2 2831 a -2 2831 a
SDict begin [/View [/XYZ H.V]/Dest (0:3566) cvn /DEST pdfmark end
 -2 2831
a 396 2931 a Fk(Set)21 b(ne)n(w)f(v)n(alue)g(in)g(distrib)n(uted)f
(hash)h(table.)g(Sends)g([SET][k)o(e)o(y][v)n(alue][ttl])15
b(to)21 b(the)f(agent:)-2 2948 y
SDict begin H.S end
 -2 2948 a -2 2948 a
SDict begin 13 H.A end

-2 2948 a -2 2948 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-4) cvn /DEST pdfmark
end
 -2 2948 a 396 3132 a Fg(Example)h(5-47.)d(Clone)j
(class)f(\(clone.c\))g(-)g(set)h(method)-2 3232 y
SDict begin H.S end
 -2
3232 a -2 3232 a
SDict begin 11.7 H.A end
 -2 3232 a -2 3232 a
SDict begin [/View [/XYZ H.V]/Dest (0:3569) cvn /DEST pdfmark end
 -2 3232 a 396 3409
a Fe(void)396 3506 y(clone_set)44 b(\(clone_t)1248 3519
y(*)1293 3506 y(self,)g(char)1786 3519 y(*)1831 3506
y(key,)g(char)2279 3519 y(*)2324 3506 y(value,)g(int)g(ttl\))396
3603 y({)576 3701 y(char)g(ttlstr)g([10];)576 3798 y(sprintf)f
(\(ttlstr,)h("\045d",)g(ttl\);)576 3992 y(assert)f(\(self\);)576
4089 y(zmsg_t)889 4102 y(*)934 4089 y(msg)i(=)f(zmsg_new)g(\(\);)576
4186 y(zmsg_addstr)f(\(msg,)h("SET"\);)576 4283 y(zmsg_addstr)f(\(msg,)
h(key\);)576 4380 y(zmsg_addstr)f(\(msg,)h(value\);)576
4478 y(zmsg_addstr)f(\(msg,)h(ttlstr\);)576 4575 y(zmsg_send)f(\(&msg,)
h(self->pipe\);)396 4672 y(})-2 4846 y
SDict begin H.S end
 -2 4846 a -2 4846
a
SDict begin 13 H.A end
 -2 4846 a -2 4846 a
SDict begin [/View [/XYZ H.V]/Dest (0:3570) cvn /DEST pdfmark end
 -2 4846 a 396 4946 a Fk(Lookup)18
b(v)n(alue)i(in)g(distrib)n(uted)f(hash)h(table.)g(Sends)g([GET][k)o(e)
o(y])e(to)i(the)g(agent)g(and)g(w)o(aits)h(for)e(a)i(v)n(alue)f
(response.)f(If)396 5054 y(there)h(is)h(no)f(clone)f(a)n(v)n(ailable,)h
(will)h(e)n(v)o(entually)d(return)h(NULL:)-2 5072 y
SDict begin H.S end
 -2
5072 a -2 5072 a
SDict begin 13 H.A end
 -2 5072 a -2 5072 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-5) cvn /DEST pdfmark
end
 -2 5072 a Black
3759 5569 a Ff(299)p Black eop end
%%Page: 300 313
TeXDict begin 300 312 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.300) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-48.)d(Clone)j(class)f(\(clone.c\))g(-)g
(get)g(method)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2
172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3573) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(char)620 363 y(*)396 447
y(clone_get)44 b(\(clone_t)1248 460 y(*)1293 447 y(self,)g(char)1786
460 y(*)1831 447 y(key\))396 544 y({)576 641 y(assert)f(\(self\);)576
738 y(assert)g(\(key\);)576 835 y(zmsg_t)889 848 y(*)934
835 y(msg)i(=)f(zmsg_new)g(\(\);)576 933 y(zmsg_addstr)f(\(msg,)h
("GET"\);)576 1030 y(zmsg_addstr)f(\(msg,)h(key\);)576
1127 y(zmsg_send)f(\(&msg,)h(self->pipe\);)576 1321 y(zmsg_t)889
1334 y(*)934 1321 y(reply)g(=)h(zmsg_recv)e(\(self->pipe\);)576
1418 y(if)h(\(reply\))g({)755 1515 y(char)979 1528 y(*)1024
1515 y(value)g(=)h(zmsg_popstr)e(\(reply\);)755 1613
y(zmsg_destroy)g(\(&reply\);)755 1710 y(return)h(value;)576
1807 y(})576 1904 y(return)f(NULL;)396 2001 y(})-2 2175
y
SDict begin H.S end
 -2 2175 a -2 2175 a
SDict begin 13 H.A end
 -2 2175 a -2 2175 a
SDict begin [/View [/XYZ H.V]/Dest (0:3574) cvn /DEST pdfmark end
 -2 2175 a 396
2275 a Fk(The)20 b(back-end)e(agent)i(manages)f(a)i(set)g(of)e(serv)o
(ers,)h(which)g(we)g(implement)f(using)h(our)f(simple)h(class)h(model:)
-2 2293 y
SDict begin H.S end
 -2 2293 a -2 2293 a
SDict begin 13 H.A end
 -2 2293 a -2 2293 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-6) cvn /DEST pdfmark
end
 -2
2293 a 396 2476 a Fg(Example)g(5-49.)d(Clone)j(class)f(\(clone.c\))g(-)
g(w)o(orking)g(with)h(ser)o(v)o(ers)-2 2576 y
SDict begin H.S end
 -2 2576
a -2 2576 a
SDict begin 11.7 H.A end
 -2 2576 a -2 2576 a
SDict begin [/View [/XYZ H.V]/Dest (0:3577) cvn /DEST pdfmark end
 -2 2576 a 396 2851 a
Fe(typedef)44 b(struct)g({)576 2948 y(char)800 2961 y(*)845
2948 y(address;)626 b(//)89 b(Server)44 b(address)576
3045 y(int)g(port;)851 b(//)89 b(Server)44 b(port)576
3142 y(void)800 3155 y(*)845 3142 y(snapshot;)581 b(//)89
b(Snapshot)44 b(socket)576 3239 y(void)800 3252 y(*)845
3239 y(subscriber;)491 b(//)89 b(Incoming)44 b(updates)576
3336 y(uint64_t)f(expiry;)537 b(//)89 b(When)44 b(server)g(expires)576
3434 y(uint)g(requests;)626 b(//)89 b(How)45 b(many)f(snapshot)f
(requests)h(made?)396 3531 y(})h(server_t;)396 3725 y(static)f
(server_t)1114 3738 y(*)396 3822 y(server_new)f(\(zctx_t)1248
3835 y(*)1293 3822 y(ctx,)h(char)1741 3835 y(*)1786 3822
y(address,)g(int)g(port,)g(char)2862 3835 y(*)2907 3822
y(subtree\))396 3919 y({)576 4016 y(server_t)979 4029
y(*)1024 4016 y(self)g(=)h(\(server_t)1786 4029 y(*)1831
4016 y(\))g(zmalloc)e(\(sizeof)h(\(server_t\)\);)576
4211 y(zclock_log)f(\("I:)h(adding)g(server)g(\045s:\045d...",)f
(address,)g(port\);)576 4308 y(self->address)f(=)j(strdup)f
(\(address\);)576 4405 y(self->port)f(=)h(port;)576 4599
y(self->snapshot)e(=)j(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)576
4696 y(zsocket_connect)e(\(self->snapshot,)g("\045s:\045d",)i(address,)
f(port\);)576 4794 y(self->subscriber)f(=)i(zsocket_new)f(\(ctx,)h
(ZMQ_SUB\);)576 4891 y(zsocket_connect)e(\(self->subscriber,)g
("\045s:\045d",)h(address,)h(port)g(+)h(1\);)576 4988
y(zsockopt_set_subscribe)c(\(self->subscriber,)h(subtree\);)576
5085 y(return)h(self;)p Black 3759 5569 a Ff(300)p Black
eop end
%%Page: 301 314
TeXDict begin 301 313 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.301) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(})396 267 y(static)44 b(void)396 364
y(server_destroy)f(\(server_t)1517 377 y(**)1607 364
y(self_p\))396 461 y({)576 558 y(assert)g(\(self_p\);)576
655 y(if)h(\()755 668 y(*)800 655 y(self_p\))f({)755
752 y(server_t)1158 765 y(*)1203 752 y(self)h(=)1517
765 y(*)1562 752 y(self_p;)755 850 y(free)g(\(self->address\);)755
947 y(free)g(\(self\);)755 1057 y(*)800 1044 y(self_p)g(=)g(NULL;)576
1141 y(})396 1238 y(})-2 1412 y
SDict begin H.S end
 -2 1412 a -2 1412 a
SDict begin 13 H.A end
 -2
1412 a -2 1412 a
SDict begin [/View [/XYZ H.V]/Dest (0:3578) cvn /DEST pdfmark end
 -2 1412 a 396 1512 a Fk(Here)20 b(is)h(the)g
(implementation)d(of)i(the)g(back-end)e(agent)h(itself:)-2
1530 y
SDict begin H.S end
 -2 1530 a -2 1530 a
SDict begin 13 H.A end
 -2 1530 a -2 1530 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-7) cvn /DEST pdfmark
end
 -2 1530
a 396 1713 a Fg(Example)i(5-50.)d(Clone)j(class)f(\(clone.c\))g(-)g
(back-end)g(agent)g(class)-2 1813 y
SDict begin H.S end
 -2 1813 a -2 1813
a
SDict begin 11.7 H.A end
 -2 1813 a -2 1813 a
SDict begin [/View [/XYZ H.V]/Dest (0:3581) cvn /DEST pdfmark end
 -2 1813 a 396 1991 a Fe(//)90 b(Number)43
b(of)i(servers)f(we)g(will)g(talk)g(to)396 2088 y(#define)g(SERVER_MAX)
267 b(2)396 2282 y(//)90 b(Server)43 b(considered)h(dead)g(if)g(silent)
g(for)g(this)h(long)396 2379 y(#define)f(SERVER_TTL)267
b(5000)179 b(//)89 b(msecs)396 2574 y(//)h(States)43
b(we)i(can)f(be)h(in)396 2671 y(#define)f(STATE_INITIAL)312
b(0)134 b(//)89 b(Before)44 b(asking)g(server)g(for)g(state)396
2768 y(#define)g(STATE_SYNCING)312 b(1)134 b(//)89 b(Getting)44
b(state)g(from)g(server)396 2865 y(#define)g(STATE_ACTIVE)357
b(2)134 b(//)89 b(Getting)44 b(new)g(updates)g(from)g(server)396
3059 y(typedef)g(struct)g({)576 3156 y(zctx_t)889 3169
y(*)934 3156 y(ctx;)717 b(//)89 b(Context)44 b(wrapper)576
3253 y(void)800 3266 y(*)845 3253 y(pipe;)761 b(//)89
b(Pipe)44 b(back)h(to)f(application)576 3351 y(zhash_t)934
3364 y(*)979 3351 y(kvmap;)582 b(//)89 b(Actual)44 b(key/value)f(table)
576 3448 y(char)800 3461 y(*)845 3448 y(subtree;)626
b(//)89 b(Subtree)44 b(specification,)e(if)j(any)576
3545 y(server_t)979 3558 y(*)1024 3545 y(server)f([SERVER_MAX];)576
3642 y(uint)g(nbr_servers;)491 b(//)89 b(0)45 b(to)f(SERVER_MAX)576
3739 y(uint)g(state;)761 b(//)89 b(Current)44 b(state)576
3836 y(uint)g(cur_server;)536 b(//)89 b(If)45 b(active,)e(server)h(0)h
(or)f(1)576 3933 y(int64_t)f(sequence;)492 b(//)89 b(Last)44
b(kvmsg)g(processed)576 4031 y(void)800 4044 y(*)845
4031 y(publisher;)536 b(//)89 b(Outgoing)44 b(updates)396
4128 y(})h(agent_t;)396 4322 y(static)f(agent_t)1069
4335 y(*)396 4419 y(agent_new)g(\(zctx_t)1203 4432 y(*)1248
4419 y(ctx,)g(void)1696 4432 y(*)1741 4419 y(pipe\))396
4516 y({)576 4613 y(agent_t)934 4626 y(*)979 4613 y(self)g(=)h
(\(agent_t)1696 4626 y(*)1741 4613 y(\))g(zmalloc)f(\(sizeof)f
(\(agent_t\)\);)576 4711 y(self->ctx)g(=)i(ctx;)576 4808
y(self->pipe)e(=)h(pipe;)576 4905 y(self->kvmap)f(=)h(zhash_new)g
(\(\);)576 5002 y(self->subtree)e(=)j(strdup)f(\(""\);)576
5099 y(self->state)f(=)h(STATE_INITIAL;)p Black 3759
5569 a Ff(301)p Black eop end
%%Page: 302 315
TeXDict begin 302 314 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.302) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(self->publisher)42 b(=)j(zsocket_new)e(\(self->ctx,)g
(ZMQ_PUB\);)576 170 y(return)g(self;)396 267 y(})396
461 y(static)h(void)396 558 y(agent_destroy)f(\(agent_t)1427
571 y(**)1517 558 y(self_p\))396 655 y({)576 752 y(assert)g
(\(self_p\);)576 850 y(if)h(\()755 863 y(*)800 850 y(self_p\))f({)755
947 y(agent_t)1114 960 y(*)1159 947 y(self)h(=)1472 960
y(*)1517 947 y(self_p;)755 1044 y(int)g(server_nbr;)755
1141 y(for)g(\(server_nbr)f(=)i(0;)f(server_nbr)g(<)g
(self->nbr_servers;)e(server_nbr++\))934 1238 y(server_destroy)h
(\(&self->server)f([server_nbr]\);)755 1335 y(zhash_destroy)h
(\(&self->kvmap\);)755 1432 y(free)h(\(self->subtree\);)755
1530 y(free)g(\(self\);)755 1640 y(*)800 1627 y(self_p)g(=)g(NULL;)576
1724 y(})396 1821 y(})-2 1995 y
SDict begin H.S end
 -2 1995 a -2 1995 a
SDict begin 13 H.A end
 -2
1995 a -2 1995 a
SDict begin [/View [/XYZ H.V]/Dest (0:3582) cvn /DEST pdfmark end
 -2 1995 a 396 2095 a Fk(Here)20 b(we)h(handle)e(the)h
(dif)n(ferent)f(control)g(messages)h(from)f(the)h(front-end;)e
(SUBTREE,)j(CONNECT)-6 b(,)20 b(SET)-6 b(,)20 b(and)396
2203 y(GET)l(:)-2 2204 y
SDict begin H.S end
 -2 2204 a -2 2204 a
SDict begin 13 H.A end
 -2 2204
a -2 2204 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-8) cvn /DEST pdfmark
end
 -2 2204 a 396 2404 a Fg(Example)h(5-51.)d(Clone)j(class)f
(\(clone.c\))g(-)g(handling)h(a)f(contr)o(ol)f(message)-2
2504 y
SDict begin H.S end
 -2 2504 a -2 2504 a
SDict begin 11.7 H.A end
 -2 2504 a -2 2504 a
SDict begin [/View [/XYZ H.V]/Dest (0:3585) cvn /DEST pdfmark end
 -2 2504
a 396 2681 a Fe(static)44 b(int)396 2779 y(agent_control_message)e
(\(agent_t)1786 2792 y(*)1831 2779 y(self\))396 2876
y({)576 2973 y(zmsg_t)889 2986 y(*)934 2973 y(msg)j(=)f(zmsg_recv)g
(\(self->pipe\);)576 3070 y(char)800 3083 y(*)845 3070
y(command)f(=)i(zmsg_popstr)e(\(msg\);)576 3167 y(if)h(\(command)g(==)g
(NULL\))755 3264 y(return)g(-1;)268 b(//)90 b(Interrupted)576
3459 y(if)44 b(\(streq)g(\(command,)f("SUBTREE"\)\))g({)755
3556 y(free)h(\(self->subtree\);)755 3653 y(self->subtree)f(=)h
(zmsg_popstr)f(\(msg\);)576 3750 y(})576 3847 y(else)576
3944 y(if)h(\(streq)g(\(command,)f("CONNECT"\)\))g({)755
4041 y(char)979 4054 y(*)1024 4041 y(address)h(=)g(zmsg_popstr)f
(\(msg\);)755 4138 y(char)979 4151 y(*)1024 4138 y(service)h(=)g
(zmsg_popstr)f(\(msg\);)755 4236 y(if)h(\(self->nbr_servers)e(<)j
(SERVER_MAX\))e({)934 4333 y(self->server)g([self->nbr_servers++])e(=)k
(server_new)e(\()1114 4430 y(self->ctx,)g(address,)g(atoi)h
(\(service\),)g(self->subtree\);)934 4527 y(//)90 b(We)44
b(broadcast)f(updates)h(to)h(all)f(known)g(servers)934
4624 y(zsocket_connect)f(\(self->publisher,)f("\045s:\045d",)1114
4721 y(address,)h(atoi)h(\(service\))g(+)g(2\);)755 4818
y(})755 4916 y(else)934 5013 y(zclock_log)f(\("E:)i(too)f(many)g
(servers)g(\(max.)g(\045d\)",)g(SERVER_MAX\);)755 5110
y(free)g(\(address\);)p Black 3759 5569 a Ff(302)p Black
eop end
%%Page: 303 316
TeXDict begin 303 315 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.303) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(free)44 b(\(service\);)576 170 y(})576
267 y(else)-2 434 y
SDict begin H.S end
 -2 434 a -2 434 a
SDict begin 13 H.A end
 -2 434 a -2 434
a
SDict begin [/View [/XYZ H.V]/Dest (0:3586) cvn /DEST pdfmark end
 -2 434 a 396 541 a Fk(When)20 b(we)h(set)g(a)f(property)-5
b(,)18 b(we)i(push)g(the)g(ne)n(w)g(k)o(e)o(y-v)n(alue)e(pair)i(onto)f
(all)i(our)f(connected)e(serv)o(ers:)-2 559 y
SDict begin H.S end
 -2 559
a -2 559 a
SDict begin 13 H.A end
 -2 559 a -2 559 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-9) cvn /DEST pdfmark
end
 -2 559 a 396 742 a Fg(Example)j(5-52.)d
(Clone)j(class)f(\(clone.c\))g(-)g(set)h(and)f(get)g(commands)-2
842 y
SDict begin H.S end
 -2 842 a -2 842 a
SDict begin 11.7 H.A end
 -2 842 a -2 842 a
SDict begin [/View [/XYZ H.V]/Dest (0:3589) cvn /DEST pdfmark end
 -2 842 a 755
922 a Fe(char)979 935 y(*)1024 922 y(key)44 b(=)h(zmsg_popstr)e
(\(msg\);)755 1019 y(char)979 1032 y(*)1024 1019 y(value)h(=)h
(zmsg_popstr)e(\(msg\);)755 1116 y(char)979 1129 y(*)1024
1116 y(ttl)h(=)h(zmsg_popstr)e(\(msg\);)755 1214 y(zhash_update)g
(\(self->kvmap,)f(key,)j(\(byte)2459 1227 y(*)2504 1214
y(\))f(value\);)755 1311 y(zhash_freefn)f(\(self->kvmap,)f(key,)j
(free\);)755 1505 y(//)89 b(Send)44 b(key-value)g(pair)g(on)g(to)h
(server)755 1602 y(kvmsg_t)1114 1615 y(*)1159 1602 y(kvmsg)e(=)i
(kvmsg_new)e(\(0\);)755 1699 y(kvmsg_set_key)87 b(\(kvmsg,)44
b(key\);)755 1796 y(kvmsg_set_uuid)e(\(kvmsg\);)755 1894
y(kvmsg_fmt_body)g(\(kvmsg,)i("\045s",)g(value\);)755
1991 y(kvmsg_set_prop)e(\(kvmsg,)i("ttl",)g(ttl\);)755
2088 y(kvmsg_send)222 b(\(kvmsg,)44 b(self->publisher\);)755
2185 y(kvmsg_destroy)f(\(&kvmsg\);)755 2282 y(free)h(\(ttl\);)755
2379 y(free)g(\(key\);)582 b(//)89 b(Value)44 b(is)h(owned)f(by)g(hash)
g(table)576 2476 y(})576 2574 y(else)576 2671 y(if)g(\(streq)g
(\(command,)f("GET"\)\))h({)755 2768 y(char)979 2781
y(*)1024 2768 y(key)g(=)h(zmsg_popstr)e(\(msg\);)755
2865 y(char)979 2878 y(*)1024 2865 y(value)h(=)h(zhash_lookup)d
(\(self->kvmap,)h(key\);)755 2962 y(if)h(\(value\))934
3059 y(zstr_send)g(\(self->pipe,)e(value\);)755 3156
y(else)934 3253 y(zstr_send)i(\(self->pipe,)e(""\);)755
3351 y(free)i(\(key\);)755 3448 y(free)g(\(value\);)576
3545 y(})576 3642 y(free)g(\(command\);)576 3739 y(zmsg_destroy)e
(\(&msg\);)576 3836 y(return)h(0;)396 3933 y(})-2 4108
y
SDict begin H.S end
 -2 4108 a -2 4108 a
SDict begin 13 H.A end
 -2 4108 a -2 4108 a
SDict begin [/View [/XYZ H.V]/Dest (0:3590) cvn /DEST pdfmark end
 -2 4108 a 396
4207 a Fk(The)19 b(asynchronous)e(agent)h(manages)h(a)h(serv)o(er)e
(pool)h(and)f(handles)h(the)g(request/reply)f(dialog)g(when)h(the)g
(application)396 4315 y(asks)i(for)f(it:)-2 4316 y
SDict begin H.S end
 -2
4316 a -2 4316 a
SDict begin 13 H.A end
 -2 4316 a -2 4316 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-10) cvn /DEST pdfmark
end
 -2 4316 a 396 4517
a Fg(Example)h(5-53.)d(Clone)j(class)f(\(clone.c\))g(-)g(back-end)g
(agent)-2 4617 y
SDict begin H.S end
 -2 4617 a -2 4617 a
SDict begin 11.7 H.A end
 -2 4617 a -2 4617
a
SDict begin [/View [/XYZ H.V]/Dest (0:3593) cvn /DEST pdfmark end
 -2 4617 a 396 4794 a Fe(static)44 b(void)396 4891 y(clone_agent)f
(\(void)1203 4904 y(*)1248 4891 y(args,)h(zctx_t)1831
4904 y(*)1876 4891 y(ctx,)g(void)2324 4904 y(*)2369 4891
y(pipe\))396 4988 y({)576 5085 y(agent_t)934 5098 y(*)979
5085 y(self)g(=)h(agent_new)e(\(ctx,)h(pipe\);)p Black
3759 5569 a Ff(303)p Black eop end
%%Page: 304 317
TeXDict begin 304 316 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.304) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 170 a Fe(while)44 b(\(true\))f({)755 267 y(zmq_pollitem_t)f
(poll_set)i([])g(=)h({)934 364 y({)g(pipe,)f(0,)g(ZMQ_POLLIN,)f(0)i(},)
934 461 y({)g(0,)179 b(0,)44 b(ZMQ_POLLIN,)f(0)i(})755
558 y(};)755 655 y(int)f(poll_timer)f(=)i(-1;)755 752
y(int)f(poll_size)g(=)g(2;)755 850 y(server_t)1158 863
y(*)1203 850 y(server)g(=)h(self->server)e([self->cur_server];)755
947 y(switch)h(\(self->state\))e({)934 1044 y(case)i(STATE_INITIAL:)
1114 1141 y(//)89 b(In)44 b(this)h(state)f(we)g(ask)g(the)h(server)f
(for)g(a)h(snapshot,)1114 1238 y(//)89 b(if)44 b(we)h(have)f(a)h
(server)f(to)g(talk)g(to...)1114 1335 y(if)g(\(self->nbr_servers)e(>)j
(0\))f({)1293 1432 y(zclock_log)f(\("I:)h(waiting)g(for)g(server)g(at)h
(\045s:\045d...",)1472 1530 y(server->address,)d(server->port\);)1293
1627 y(if)i(\(server->requests)e(<)j(2\))g({)1472 1724
y(zstr_sendm)e(\(server->snapshot,)f("ICANHAZ?"\);)1472
1821 y(zstr_send)88 b(\(server->snapshot,)42 b(self->subtree\);)1472
1918 y(server->requests++;)1293 2015 y(})1293 2112 y(server->expiry)g
(=)j(zclock_time)e(\(\))i(+)f(SERVER_TTL;)1293 2209 y(self->state)f(=)i
(STATE_SYNCING;)1293 2307 y(poll_set)e([1].socket)h(=)g
(server->snapshot;)1114 2404 y(})1114 2501 y(else)1293
2598 y(poll_size)f(=)i(1;)1114 2695 y(break;)934 2889
y(case)f(STATE_SYNCING:)1114 2987 y(//)89 b(In)44 b(this)h(state)f(we)g
(read)g(from)g(snapshot)g(and)g(we)h(expect)1114 3084
y(//)89 b(the)44 b(server)g(to)h(respond,)e(else)h(we)h(fail)f(over.)
1114 3181 y(poll_set)f([1].socket)g(=)i(server->snapshot;)1114
3278 y(break;)934 3472 y(case)f(STATE_ACTIVE:)1114 3569
y(//)89 b(In)44 b(this)h(state)f(we)g(read)g(from)g(subscriber)g(and)g
(we)g(expect)1114 3666 y(//)89 b(the)44 b(server)g(to)h(give)f(hugz,)g
(else)g(we)g(fail)h(over.)1114 3764 y(poll_set)e([1].socket)g(=)i
(server->subscriber;)1114 3861 y(break;)755 3958 y(})755
4055 y(if)f(\(server\))g({)934 4152 y(poll_timer)f(=)i
(\(server->expiry)d(-)j(zclock_time)e(\(\)\))1427 4262
y(*)1517 4249 y(ZMQ_POLL_MSEC;)934 4346 y(if)i(\(poll_timer)e(<)h(0\))
1114 4444 y(poll_timer)f(=)h(0;)755 4541 y(})-2 4715
y
SDict begin H.S end
 -2 4715 a -2 4715 a
SDict begin 13 H.A end
 -2 4715 a -2 4715 a
SDict begin [/View [/XYZ H.V]/Dest (0:3594) cvn /DEST pdfmark end
 -2 4715 a 396
4815 a Fk(W)-7 b(e')l(re)21 b(ready)e(to)h(process)g(incoming)e
(messages;)j(if)f(nothing)f(at)h(all)h(comes)f(from)f(our)h(serv)o(er)f
(within)h(the)g(timeout,)396 4923 y(that)h(means)e(the)i(serv)o(er)e
(is)i(dead:)-2 4924 y
SDict begin H.S end
 -2 4924 a -2 4924 a
SDict begin 13 H.A end
 -2 4924 a -2
4924 a
SDict begin [/View [/XYZ H.V]/Dest (0:clone-c-11) cvn /DEST pdfmark
end
 -2 4924 a Black 3759 5569 a Ff(304)p Black eop
end
%%Page: 305 318
TeXDict begin 305 317 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.305) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-54.)d(Clone)j(class)f(\(clone.c\))g(-)g
(client)g(poll)h(loop)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172
a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3597) cvn /DEST pdfmark end
 -2 172 a 755 253 a Fe(int)44 b(rc)h(=)f(zmq_poll)g
(\(poll_set,)f(poll_size,)g(poll_timer\);)755 350 y(if)h(\(rc)h(==)f
(-1\))934 447 y(break;)627 b(//)89 b(Context)44 b(has)g(been)g(shut)h
(down)755 641 y(if)f(\(poll_set)g([0].revents)f(&)h(ZMQ_POLLIN\))f({)
934 738 y(if)i(\(agent_control_message)c(\(self\)\))1114
835 y(break;)447 b(//)89 b(Interrupted)755 933 y(})755
1030 y(else)755 1127 y(if)44 b(\(poll_set)g([1].revents)f(&)h
(ZMQ_POLLIN\))f({)934 1224 y(kvmsg_t)1293 1237 y(*)1338
1224 y(kvmsg)h(=)g(kvmsg_recv)g(\(poll_set)f([1].socket\);)934
1321 y(if)i(\(!kvmsg\))1114 1418 y(break;)447 b(//)89
b(Interrupted)934 1613 y(//)h(Anything)43 b(from)h(server)g(resets)g
(its)g(expiry)g(time)934 1710 y(server->expiry)f(=)h(zclock_time)f
(\(\))i(+)g(SERVER_TTL;)934 1807 y(if)g(\(self->state)e(==)h
(STATE_SYNCING\))f({)1114 1904 y(//)89 b(Store)44 b(in)g(snapshot)g
(until)g(we're)g(finished)1114 2001 y(server->requests)e(=)i(0;)1114
2098 y(if)g(\(streq)g(\(kvmsg_key)f(\(kvmsg\),)h("KTHXBAI"\)\))f({)1293
2195 y(self->sequence)f(=)j(kvmsg_sequence)e(\(kvmsg\);)1293
2292 y(self->state)g(=)i(STATE_ACTIVE;)1293 2390 y(zclock_log)e(\("I:)h
(received)g(from)g(\045s:\045d)g(snapshot=\045d",)1472
2487 y(server->address,)e(server->port,)1472 2584 y(\(int\))i
(self->sequence\);)1293 2681 y(kvmsg_destroy)f(\(&kvmsg\);)1114
2778 y(})1114 2875 y(else)1293 2972 y(kvmsg_store)g(\(&kvmsg,)g
(self->kvmap\);)934 3070 y(})934 3167 y(else)934 3264
y(if)i(\(self->state)e(==)h(STATE_ACTIVE\))f({)1114 3361
y(//)89 b(Discard)44 b(out-of-sequence)e(updates,)h(incl.)h(hugz)1114
3458 y(if)g(\(kvmsg_sequence)e(\(kvmsg\))i(>)h(self->sequence\))d({)
1293 3555 y(self->sequence)g(=)j(kvmsg_sequence)e(\(kvmsg\);)1293
3652 y(kvmsg_store)g(\(&kvmsg,)g(self->kvmap\);)1293
3750 y(zclock_log)g(\("I:)h(received)g(from)g(\045s:\045d)g
(update=\045d",)1472 3847 y(server->address,)e(server->port,)1472
3944 y(\(int\))i(self->sequence\);)1114 4041 y(})1114
4138 y(else)1293 4235 y(kvmsg_destroy)f(\(&kvmsg\);)934
4332 y(})755 4429 y(})755 4527 y(else)h({)934 4624 y(//)90
b(Server)43 b(has)i(died,)f(failover)f(to)i(next)934
4721 y(zclock_log)e(\("I:)i(server)e(at)i(\045s:\045d)f(didn't)g(give)g
(hugz",)1293 4818 y(server->address,)e(server->port\);)934
4915 y(self->cur_server)g(=)j(\(self->cur_server)d(+)j(1\))f(\045)h
(self->nbr_servers;)934 5012 y(self->state)e(=)i(STATE_INITIAL;)755
5109 y(})p Black 3759 5569 a Ff(305)p Black eop end
%%Page: 306 319
TeXDict begin 306 318 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.306) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(})576 170 y(agent_destroy)42 b(\(&self\);)396
267 y(})-2 441 y
SDict begin H.S end
 -2 441 a -2 441 a
SDict begin 13 H.A end
 -2 441 a -2 441 a
SDict begin [/View [/XYZ H.V]/Dest (0:3598) cvn /DEST pdfmark end

-2 441 a 396 541 a Fk(Finally)-5 b(,)20 b(here)f(is)i(the)g(sixth)f
(and)g(last)h(model)e(of)h(the)g(clone)g(serv)o(er:)-2
559 y
SDict begin H.S end
 -2 559 a -2 559 a
SDict begin 13 H.A end
 -2 559 a -2 559 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c) cvn /DEST pdfmark
end
 -2 559 a 396
742 a Fg(Example)h(5-55.)d(Clone)j(ser)o(v)o(er)-8 b(,)20
b(Model)h(Six)f(\(clonesr)o(v6.c\))-2 842 y
SDict begin H.S end
 -2 842 a
-2 842 a
SDict begin 11.7 H.A end
 -2 842 a -2 842 a
SDict begin [/View [/XYZ H.V]/Dest (0:3601) cvn /DEST pdfmark end
 -2 842 a 396 922 a Fe(//)396
1019 y(//)90 b(Clone)44 b(server)f(Model)h(Six)396 1116
y(//)396 1311 y(//)90 b(Lets)44 b(us)g(build)g(this)g(source)g(without)
g(creating)f(a)i(library)396 1408 y(#include)f("bstar.c")396
1505 y(#include)g("kvmsg.c")-2 1683 y
SDict begin H.S end
 -2 1683 a -2 1683
a
SDict begin 13 H.A end
 -2 1683 a -2 1683 a
SDict begin [/View [/XYZ H.V]/Dest (0:3602) cvn /DEST pdfmark end
 -2 1683 a 396 1779 a Fk(W)-7 b(e)22
b(de\002ne)d(a)i(set)g(of)f(reactor)f(handlers)g(and)h(our)f(serv)o(er)
g(object)h(structure:)-2 1797 y
SDict begin H.S end
 -2 1797 a -2 1797 a
SDict begin 13 H.A end
 -2
1797 a -2 1797 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-1) cvn /DEST pdfmark
end
 -2 1797 a 396 1980 a Fg(Example)h(5-56.)d(Clone)j(ser)
o(v)o(er)-8 b(,)20 b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h
(de\002nitions)-2 2080 y
SDict begin H.S end
 -2 2080 a -2 2080 a
SDict begin 11.7 H.A end
 -2 2080
a -2 2080 a
SDict begin [/View [/XYZ H.V]/Dest (0:3605) cvn /DEST pdfmark end
 -2 2080 a 396 2258 a Fe(//)90 b(Bstar)44
b(reactor)f(handlers)396 2355 y(static)h(int)g(s_snapshots)88
b(\(zloop_t)1876 2368 y(*)1921 2355 y(loop,)44 b(zmq_pollitem_t)2862
2368 y(*)2907 2355 y(poller,)g(void)3490 2368 y(*)3535
2355 y(args\);)396 2452 y(static)g(int)g(s_collector)88
b(\(zloop_t)1876 2465 y(*)1921 2452 y(loop,)44 b(zmq_pollitem_t)2862
2465 y(*)2907 2452 y(poller,)g(void)3490 2465 y(*)3535
2452 y(args\);)396 2549 y(static)g(int)g(s_flush_ttl)88
b(\(zloop_t)1876 2562 y(*)1921 2549 y(loop,)44 b(zmq_pollitem_t)2862
2562 y(*)2907 2549 y(poller,)g(void)3490 2562 y(*)3535
2549 y(args\);)396 2646 y(static)g(int)g(s_send_hugz)88
b(\(zloop_t)1876 2659 y(*)1921 2646 y(loop,)44 b(zmq_pollitem_t)2862
2659 y(*)2907 2646 y(poller,)g(void)3490 2659 y(*)3535
2646 y(args\);)396 2743 y(static)g(int)g(s_new_master)f(\(zloop_t)1876
2756 y(*)1921 2743 y(loop,)h(zmq_pollitem_t)2862 2756
y(*)2907 2743 y(poller,)g(void)3490 2756 y(*)3535 2743
y(args\);)396 2840 y(static)g(int)g(s_new_slave)88 b(\(zloop_t)1876
2853 y(*)1921 2840 y(loop,)44 b(zmq_pollitem_t)2862 2853
y(*)2907 2840 y(poller,)g(void)3490 2853 y(*)3535 2840
y(args\);)396 2938 y(static)g(int)g(s_subscriber)f(\(zloop_t)1876
2951 y(*)1921 2938 y(loop,)h(zmq_pollitem_t)2862 2951
y(*)2907 2938 y(poller,)g(void)3490 2951 y(*)3535 2938
y(args\);)396 3132 y(//)90 b(Our)44 b(server)g(is)g(defined)g(by)g
(these)g(properties)396 3229 y(typedef)g(struct)g({)576
3326 y(zctx_t)889 3339 y(*)934 3326 y(ctx;)717 b(//)89
b(Context)44 b(wrapper)576 3423 y(zhash_t)934 3436 y(*)979
3423 y(kvmap;)582 b(//)89 b(Key-value)44 b(store)576
3520 y(bstar_t)934 3533 y(*)979 3520 y(bstar;)582 b(//)89
b(Bstar)44 b(reactor)g(core)576 3618 y(int64_t)f(sequence;)492
b(//)89 b(How)45 b(many)f(updates)f(we're)h(at)576 3715
y(int)g(port;)851 b(//)89 b(Main)44 b(port)h(we're)f(working)f(on)576
3812 y(int)h(peer;)851 b(//)89 b(Main)44 b(port)h(of)f(our)g(peer)576
3909 y(void)800 3922 y(*)845 3909 y(publisher;)536 b(//)89
b(Publish)44 b(updates)g(and)g(hugz)576 4006 y(void)800
4019 y(*)845 4006 y(collector;)536 b(//)89 b(Collect)44
b(updates)g(from)g(clients)576 4103 y(void)800 4116 y(*)845
4103 y(subscriber;)491 b(//)89 b(Get)45 b(updates)e(from)h(peer)576
4200 y(zlist_t)934 4213 y(*)979 4200 y(pending;)492 b(//)89
b(Pending)44 b(updates)g(from)g(clients)576 4297 y(Bool)g(primary;)671
b(//)89 b(TRUE)44 b(if)h(we're)f(primary)576 4395 y(Bool)g(master;)716
b(//)89 b(TRUE)44 b(if)h(we're)f(master)576 4492 y(Bool)g(slave;)761
b(//)89 b(TRUE)44 b(if)h(we're)f(slave)396 4589 y(})h(clonesrv_t;)-2
4765 y
SDict begin H.S end
 -2 4765 a -2 4765 a
SDict begin 13 H.A end
 -2 4765 a -2 4765 a
SDict begin [/View [/XYZ H.V]/Dest (0:3606) cvn /DEST pdfmark end
 -2 4765
a 396 4863 a Fk(The)20 b(main)g(task)g(parses)h(the)f(command)e(line)i
(to)h(decide)e(whether)g(to)i(start)f(as)h(primary)e(or)h(backup)e
(serv)o(er)-5 b(.)20 b(W)-7 b(e')l(re)396 4971 y(using)20
b(the)g(Binary)g(Star)g(pattern)g(for)f(reliability)-5
b(.)19 b(This)i(interconnects)d(the)i(tw)o(o)h(serv)o(ers)e(so)i(the)o
(y)e(can)h(agree)g(on)396 5079 y(which)g(is)h(primary)-5
b(,)18 b(and)i(which)f(is)i(backup.)e(T)-7 b(o)20 b(allo)n(w)g(the)g
(tw)o(o)h(serv)o(ers)f(to)g(run)f(on)h(the)g(same)h(box,)e(we)h(use)h
(dif)n(ferent)p Black 3757 5569 a Ff(306)p Black eop
end
%%Page: 307 320
TeXDict begin 307 319 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.307) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fk(ports)i(for)g(primary)e(and)i(backup.)e(Ports)j
(5003/5004)c(are)j(used)g(to)g(interconnect)e(the)i(serv)o(ers.)g
(Ports)g(5556/5566)d(are)396 180 y(used)j(to)h(recei)n(v)o(e)e(v)n
(oting)g(e)n(v)o(ents)h(\(snapshot)e(requests)i(in)h(the)f(clone)f
(pattern\).)g(Ports)i(5557/5567)c(are)j(used)g(by)f(the)396
288 y(publisher)m(,)f(and)i(ports)g(5558/5568)d(by)j(the)g(collector:)
-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-2) cvn /DEST pdfmark
end
 -2 306 a
396 490 a Fg(Example)h(5-57.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h(main)h(task)f(setup)-2
590 y
SDict begin H.S end
 -2 590 a -2 590 a
SDict begin 11.7 H.A end
 -2 590 a -2 590 a
SDict begin [/View [/XYZ H.V]/Dest (0:3609) cvn /DEST pdfmark end
 -2 590 a 396
767 a Fe(int)45 b(main)f(\(int)g(argc,)g(char)1517 780
y(*)1562 767 y(argv)g([]\))396 864 y({)576 961 y(clonesrv_t)1069
974 y(*)1114 961 y(self)g(=)g(\(clonesrv_t)1965 974 y(*)2010
961 y(\))h(zmalloc)f(\(sizeof)f(\(clonesrv_t\)\);)576
1058 y(if)h(\(argc)g(==)h(2)f(&&)h(streq)f(\(argv)g([1],)g("-p"\)\))g
({)755 1156 y(zclock_log)f(\("I:)h(primary)g(master,)g(waiting)f(for)i
(backup)e(\(slave\)"\);)755 1253 y(self->bstar)g(=)i(bstar_new)e
(\(BSTAR_PRIMARY,)f("tcp://)2863 1266 y(*)2908 1253 y(:5003",)1876
1350 y("tcp://localhost:5004"\);)755 1447 y(bstar_voter)h
(\(self->bstar,)g("tcp://)2236 1460 y(*)2281 1447 y(:5556",)f
(ZMQ_ROUTER,)h(s_snapshots,)g(self\);)755 1544 y(self->port)g(=)i
(5556;)755 1641 y(self->peer)e(=)i(5566;)755 1738 y(self->primary)e(=)h
(TRUE;)576 1835 y(})576 1933 y(else)576 2030 y(if)g(\(argc)g(==)h(2)f
(&&)h(streq)f(\(argv)g([1],)g("-b"\)\))g({)755 2127 y(zclock_log)f
(\("I:)h(backup)g(slave,)g(waiting)g(for)g(primary)g(\(master\)"\);)755
2224 y(self->bstar)f(=)i(bstar_new)e(\(BSTAR_BACKUP,)f("tcp://)2818
2237 y(*)2863 2224 y(:5004",)1876 2321 y("tcp://localhost:5003"\);)755
2418 y(bstar_voter)h(\(self->bstar,)g("tcp://)2236 2431
y(*)2281 2418 y(:5566",)f(ZMQ_ROUTER,)h(s_snapshots,)g(self\);)755
2515 y(self->port)g(=)i(5566;)755 2613 y(self->peer)e(=)i(5556;)755
2710 y(self->primary)e(=)h(FALSE;)576 2807 y(})576 2904
y(else)g({)755 3001 y(printf)g(\("Usage:)f(clonesrv4)h({)g(-p)h(|)f(-b)
h(}\\n"\);)755 3098 y(free)f(\(self\);)755 3195 y(exit)g(\(0\);)576
3292 y(})576 3390 y(//)89 b(Primary)44 b(server)f(will)i(become)e
(first)h(master)576 3487 y(if)g(\(self->primary\))755
3584 y(self->kvmap)f(=)i(zhash_new)e(\(\);)576 3778 y(self->ctx)g(=)i
(zctx_new)e(\(\);)576 3875 y(self->pending)f(=)j(zlist_new)e(\(\);)576
3972 y(bstar_set_verbose)f(\(self->bstar,)g(TRUE\);)576
4167 y(//)89 b(Set)44 b(up)h(our)f(clone)g(server)g(sockets)576
4264 y(self->publisher)e(=)j(zsocket_new)e(\(self->ctx,)g(ZMQ_PUB\);)
576 4361 y(self->collector)f(=)j(zsocket_new)e(\(self->ctx,)g
(ZMQ_SUB\);)576 4458 y(zsockopt_set_subscribe)e(\(self->collector,)h
(""\);)576 4555 y(zsocket_bind)g(\(self->publisher,)g("tcp://)2280
4568 y(*)2325 4555 y(:\045d",)h(self->port)g(+)i(1\);)576
4652 y(zsocket_bind)d(\(self->collector,)g("tcp://)2280
4665 y(*)2325 4652 y(:\045d",)h(self->port)g(+)i(2\);)576
4847 y(//)89 b(Set)44 b(up)h(our)f(own)g(clone)g(client)g(interface)g
(to)g(peer)576 4944 y(self->subscriber)e(=)i(zsocket_new)f
(\(self->ctx,)g(ZMQ_SUB\);)576 5041 y(zsockopt_set_subscribe)e
(\(self->subscriber,)h(""\);)576 5138 y(zsocket_connect)g
(\(self->subscriber,)g("tcp://localhost:\045d",)f(self->peer)i(+)i
(1\);)p Black 3756 5569 a Ff(307)p Black eop end
%%Page: 308 321
TeXDict begin 308 320 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.308) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3610) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(After)i(we')l(v)o(e)f(set-up)h(our)f(sock)o(ets)i(we)
f(re)o(gister)g(our)f(binary)g(star)i(e)n(v)o(ent)e(handlers,)g(and)g
(then)h(start)h(the)f(bstar)g(reactor)-5 b(.)396 180
y(This)21 b(\002nishes)f(when)g(the)g(user)g(presses)g(Ctrl-C,)h(or)f
(the)g(process)g(recei)n(v)o(es)f(a)i(SIGINT)f(interrupt:)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-3) cvn /DEST pdfmark
end
 -2 198 a 396
382 a Fg(Example)h(5-58.)d(Clone)j(ser)o(v)o(er)-8 b(,)20
b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h(main)h(task)f(body)-2
482 y
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:3613) cvn /DEST pdfmark end
 -2 482 a 576
659 a Fe(//)89 b(Register)43 b(state)h(change)g(handlers)576
756 y(bstar_new_master)e(\(self->bstar,)g(s_new_master,)h(self\);)576
853 y(bstar_new_slave)f(\(self->bstar,)h(s_new_slave,)f(self\);)576
1048 y(//)89 b(Register)43 b(our)i(other)f(handlers)f(with)h(the)h
(bstar)f(reactor)576 1145 y(zmq_pollitem_t)e(poller)i(=)h({)f
(self->collector,)e(0,)j(ZMQ_POLLIN)e(};)576 1242 y(zloop_poller)f
(\(bstar_zloop)h(\(self->bstar\),)g(&poller,)g(s_collector,)g(self\);)
576 1339 y(zloop_timer)87 b(\(bstar_zloop)43 b(\(self->bstar\),)g
(1000,)h(0,)g(s_flush_ttl,)f(self\);)576 1436 y(zloop_timer)87
b(\(bstar_zloop)43 b(\(self->bstar\),)g(1000,)h(0,)g(s_send_hugz,)f
(self\);)576 1630 y(//)89 b(Start)44 b(the)g(Bstar)g(reactor)576
1728 y(bstar_start)f(\(self->bstar\);)576 1922 y(//)89
b(Interrupted,)43 b(so)h(shut)g(down)576 2019 y(while)g(\(zlist_size)f
(\(self->pending\)\))f({)755 2116 y(kvmsg_t)1114 2129
y(*)1159 2116 y(kvmsg)h(=)i(\(kvmsg_t)1921 2129 y(*)1966
2116 y(\))f(zlist_pop)f(\(self->pending\);)755 2213 y(kvmsg_destroy)g
(\(&kvmsg\);)576 2310 y(})576 2407 y(zlist_destroy)f
(\(&self->pending\);)576 2505 y(bstar_destroy)g(\(&self->bstar\);)576
2602 y(zhash_destroy)g(\(&self->kvmap\);)576 2699 y(zctx_destroy)g
(\(&self->ctx\);)576 2796 y(free)i(\(self\);)576 2990
y(return)f(0;)396 3087 y(})396 3282 y(//)90 b(We)44 b(handle)g
(ICANHAZ?)f(requests)h(exactly)g(as)g(in)h(the)f(clonesrv5)f(example.)
396 3379 y(...)-2 3546 y
SDict begin H.S end
 -2 3546 a -2 3546 a
SDict begin 13 H.A end
 -2 3546
a -2 3546 a
SDict begin [/View [/XYZ H.V]/Dest (0:3614) cvn /DEST pdfmark end
 -2 3546 a 396 3653 a Fk(The)20 b(collector)f(is)i(more)f
(comple)o(x)e(than)i(in)g(the)h(clonesrv5)d(e)o(xample)h(since)h(ho)n
(w)g(process)g(updates)f(depends)g(on)396 3761 y(whether)g(we')l(re)h
(master)g(or)g(sla)n(v)o(e.)g(The)g(master)g(applies)g(them)g
(immediately)f(to)h(its)h(kvmap,)e(whereas)h(the)g(sla)n(v)o(e)396
3869 y(queues)g(them)f(as)i(pending:)-2 3887 y
SDict begin H.S end
 -2 3887
a -2 3887 a
SDict begin 13 H.A end
 -2 3887 a -2 3887 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-4) cvn /DEST pdfmark
end
 -2 3887 a 396 4070 a
Fg(Example)g(5-59.)d(Clone)j(ser)o(v)o(er)-8 b(,)20 b(Model)h(Six)f
(\(clonesr)o(v6.c\))f(-)h(collect)g(updates)-2 4170 y
SDict begin H.S end

-2 4170 a -2 4170 a
SDict begin 11.7 H.A end
 -2 4170 a -2 4170 a
SDict begin [/View [/XYZ H.V]/Dest (0:3617) cvn /DEST pdfmark end
 -2 4170 a 396
4347 a Fe(//)90 b(If)44 b(message)g(was)g(already)g(on)g(pending)g
(list,)g(remove)g(it)g(and)h(return)e(TRUE,)396 4444
y(//)90 b(else)44 b(return)g(FALSE.)396 4542 y(static)g(int)396
4639 y(s_was_pending)f(\(clonesrv_t)1562 4652 y(*)1607
4639 y(self,)h(kvmsg_t)2234 4652 y(*)2279 4639 y(kvmsg\))396
4736 y({)576 4833 y(kvmsg_t)934 4846 y(*)979 4833 y(held)g(=)h
(\(kvmsg_t)1696 4846 y(*)1741 4833 y(\))g(zlist_first)e
(\(self->pending\);)576 4930 y(while)h(\(held\))f({)755
5027 y(if)h(\(memcmp)g(\(kvmsg_uuid)f(\(kvmsg\),)1293
5124 y(kvmsg_uuid)g(\(held\),)h(sizeof)g(\(uuid_t\)\))f(==)h(0\))h({)p
Black 3759 5569 a Ff(308)p Black eop end
%%Page: 309 322
TeXDict begin 309 321 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.309) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 934 72 a Fe(zlist_remove)43 b(\(self->pending,)f(held\);)934
170 y(return)i(TRUE;)755 267 y(})755 364 y(held)g(=)h(\(kvmsg_t)1472
377 y(*)1517 364 y(\))g(zlist_next)e(\(self->pending\);)576
461 y(})576 558 y(return)g(FALSE;)396 655 y(})396 850
y(static)h(int)396 947 y(s_collector)f(\(zloop_t)1338
960 y(*)1383 947 y(loop,)h(zmq_pollitem_t)2324 960 y(*)2369
947 y(poller,)g(void)2952 960 y(*)2997 947 y(args\))396
1044 y({)576 1141 y(clonesrv_t)1069 1154 y(*)1114 1141
y(self)g(=)g(\(clonesrv_t)1965 1154 y(*)2010 1141 y(\))h(args;)576
1335 y(kvmsg_t)934 1348 y(*)979 1335 y(kvmsg)f(=)h(kvmsg_recv)e
(\(poller->socket\);)576 1432 y(if)h(\(kvmsg\))g({)755
1530 y(if)g(\(self->master\))f({)934 1627 y(kvmsg_set_sequence)f
(\(kvmsg,)i(++self->sequence\);)934 1724 y(kvmsg_send)f(\(kvmsg,)h
(self->publisher\);)934 1821 y(int)h(ttl)f(=)h(atoi)f(\(kvmsg_get_prop)
e(\(kvmsg,)i("ttl"\)\);)934 1918 y(if)h(\(ttl\))1114
2015 y(kvmsg_set_prop)d(\(kvmsg,)i("ttl",)1293 2112 y("\045")g(PRId64,)
g(zclock_time)f(\(\))h(+)h(ttl)2772 2125 y(*)2862 2112
y(1000\);)934 2209 y(kvmsg_store)e(\(&kvmsg,)h(self->kvmap\);)934
2307 y(zclock_log)f(\("I:)i(publishing)e(update=\045d",)g(\(int\))h
(self->sequence\);)755 2404 y(})755 2501 y(else)g({)934
2598 y(//)90 b(If)44 b(we)h(already)e(got)i(message)e(from)h(master,)g
(drop)g(it,)h(else)934 2695 y(//)90 b(hold)44 b(on)g(pending)g(list)934
2792 y(if)h(\(s_was_pending)d(\(self,)i(kvmsg\)\))1114
2889 y(kvmsg_destroy)e(\(&kvmsg\);)934 2987 y(else)1114
3084 y(zlist_append)g(\(self->pending,)h(kvmsg\);)755
3181 y(})576 3278 y(})576 3375 y(return)g(0;)396 3472
y(})396 3666 y(//)90 b(We)44 b(purge)g(ephemeral)f(values)h(using)g
(exactly)g(the)g(same)g(code)h(as)f(in)396 3764 y(//)90
b(the)44 b(previous)f(clonesrv5)h(example.)396 3861 y(...)-2
4028 y
SDict begin H.S end
 -2 4028 a -2 4028 a
SDict begin 13 H.A end
 -2 4028 a -2 4028 a
SDict begin [/View [/XYZ H.V]/Dest (0:3618) cvn /DEST pdfmark end
 -2 4028
a 396 4135 a Fk(W)-7 b(e)22 b(send)e(a)g(HUGZ)g(message)g(once)g(a)h
(second)e(to)h(all)h(subscribers)e(so)i(that)f(the)o(y)g(can)g(detect)g
(if)g(our)g(serv)o(er)f(dies.)396 4243 y(The)o(y')o(ll)g(then)h(switch)
h(o)o(v)o(er)d(to)j(the)f(backup)e(serv)o(er)m(,)h(which)h(will)h
(become)e(master:)-2 4261 y
SDict begin H.S end
 -2 4261 a -2 4261 a
SDict begin 13 H.A end
 -2 4261
a -2 4261 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-5) cvn /DEST pdfmark
end
 -2 4261 a 396 4444 a Fg(Example)i(5-60.)d(Clone)j(ser)o(v)o
(er)-8 b(,)20 b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h(heartbeating)-2
4544 y
SDict begin H.S end
 -2 4544 a -2 4544 a
SDict begin 11.7 H.A end
 -2 4544 a -2 4544 a
SDict begin [/View [/XYZ H.V]/Dest (0:3621) cvn /DEST pdfmark end
 -2 4544
a 396 4721 a Fe(static)44 b(int)396 4818 y(s_send_hugz)f(\(zloop_t)1338
4831 y(*)1383 4818 y(loop,)h(zmq_pollitem_t)2324 4831
y(*)2369 4818 y(poller,)g(void)2952 4831 y(*)2997 4818
y(args\))396 4916 y({)576 5013 y(clonesrv_t)1069 5026
y(*)1114 5013 y(self)g(=)g(\(clonesrv_t)1965 5026 y(*)2010
5013 y(\))h(args;)p Black 3759 5569 a Ff(309)p Black
eop end
%%Page: 310 323
TeXDict begin 310 322 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.310) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(kvmsg_t)934 85 y(*)979 72 y(kvmsg)44
b(=)h(kvmsg_new)e(\(self->sequence\);)576 170 y(kvmsg_set_key)87
b(\(kvmsg,)44 b("HUGZ"\);)576 267 y(kvmsg_set_body)e(\(kvmsg,)i(\(byte)
1876 280 y(*)1921 267 y(\))g("",)h(0\);)576 364 y(kvmsg_send)222
b(\(kvmsg,)44 b(self->publisher\);)576 461 y(kvmsg_destroy)e
(\(&kvmsg\);)576 655 y(return)h(0;)396 752 y(})-2 927
y
SDict begin H.S end
 -2 927 a -2 927 a
SDict begin 13 H.A end
 -2 927 a -2 927 a
SDict begin [/View [/XYZ H.V]/Dest (0:3622) cvn /DEST pdfmark end
 -2 927 a 396 1026
a Fk(When)20 b(we)h(switch)f(from)g(sla)n(v)o(e)g(to)g(master)m(,)g(we)
g(apply)g(our)f(pending)f(list)k(so)e(that)g(our)g(kvmap)f(is)i
(up-to-date.)c(When)396 1134 y(we)k(switch)f(to)h(sla)n(v)o(e,)f(we)g
(wipe)h(our)e(kvmap)g(and)g(grab)h(a)g(ne)n(w)g(snapshot)g(from)f(the)h
(master:)-2 1152 y
SDict begin H.S end
 -2 1152 a -2 1152 a
SDict begin 13 H.A end
 -2 1152 a -2 1152
a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-6) cvn /DEST pdfmark
end
 -2 1152 a 396 1336 a Fg(Example)h(5-61.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h(handling)h(state)f
(changes)-2 1436 y
SDict begin H.S end
 -2 1436 a -2 1436 a
SDict begin 11.7 H.A end
 -2 1436 a -2 1436
a
SDict begin [/View [/XYZ H.V]/Dest (0:3625) cvn /DEST pdfmark end
 -2 1436 a 396 1613 a Fe(static)44 b(int)396 1710 y(s_new_master)f
(\(zloop_t)1383 1723 y(*)1428 1710 y(loop,)g(zmq_pollitem_t)2369
1723 y(*)2414 1710 y(unused,)g(void)2997 1723 y(*)3042
1710 y(args\))396 1807 y({)576 1904 y(clonesrv_t)1069
1917 y(*)1114 1904 y(self)h(=)g(\(clonesrv_t)1965 1917
y(*)2010 1904 y(\))h(args;)576 2099 y(self->master)d(=)j(TRUE;)576
2196 y(self->slave)e(=)h(FALSE;)576 2390 y(//)89 b(Stop)44
b(subscribing)f(to)i(updates)576 2487 y(zmq_pollitem_t)d(poller)i(=)h
({)f(self->subscriber,)e(0,)j(ZMQ_POLLIN)e(};)576 2584
y(zloop_poller_end)f(\(bstar_zloop)h(\(self->bstar\),)f(&poller\);)576
2779 y(//)89 b(Apply)44 b(pending)g(list)g(to)g(own)h(hash)f(table)576
2876 y(while)g(\(zlist_size)f(\(self->pending\)\))f({)755
2973 y(kvmsg_t)1114 2986 y(*)1159 2973 y(kvmsg)h(=)i(\(kvmsg_t)1921
2986 y(*)1966 2973 y(\))f(zlist_pop)f(\(self->pending\);)755
3070 y(kvmsg_set_sequence)f(\(kvmsg,)h(++self->sequence\);)755
3167 y(kvmsg_send)g(\(kvmsg,)h(self->publisher\);)755
3264 y(kvmsg_store)f(\(&kvmsg,)g(self->kvmap\);)755 3361
y(zclock_log)g(\("I:)h(publishing)f(pending=\045d",)g(\(int\))h
(self->sequence\);)576 3459 y(})576 3556 y(return)f(0;)396
3653 y(})396 3847 y(static)h(int)396 3944 y(s_new_slave)f(\(zloop_t)
1338 3957 y(*)1383 3944 y(loop,)h(zmq_pollitem_t)2324
3957 y(*)2369 3944 y(unused,)g(void)2952 3957 y(*)2997
3944 y(args\))396 4041 y({)576 4138 y(clonesrv_t)1069
4151 y(*)1114 4138 y(self)g(=)g(\(clonesrv_t)1965 4151
y(*)2010 4138 y(\))h(args;)576 4333 y(zhash_destroy)d
(\(&self->kvmap\);)576 4430 y(self->master)g(=)j(FALSE;)576
4527 y(self->slave)e(=)h(TRUE;)576 4721 y(//)89 b(Start)44
b(subscribing)f(to)h(updates)576 4818 y(zmq_pollitem_t)e(poller)i(=)h
({)f(self->subscriber,)e(0,)j(ZMQ_POLLIN)e(};)576 4916
y(zloop_poller)f(\(bstar_zloop)h(\(self->bstar\),)g(&poller,)g
(s_subscriber,)g(self\);)576 5110 y(return)g(0;)p Black
3759 5569 a Ff(310)p Black eop end
%%Page: 311 324
TeXDict begin 311 323 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.311) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fe(})-2 247 y
SDict begin H.S end
 -2 247 a -2 247 a
SDict begin 13 H.A end
 -2 247
a -2 247 a
SDict begin [/View [/XYZ H.V]/Dest (0:3626) cvn /DEST pdfmark end
 -2 247 a 396 346 a Fk(When)i(we)h(get)f(an)g(update,)f(we)i
(create)e(a)i(ne)n(w)f(kvmap)f(if)h(necessary)-5 b(,)19
b(and)h(then)g(add)f(our)h(update)f(to)h(our)f(kvmap.)396
454 y(W)-7 b(e')l(re)21 b(al)o(w)o(ays)f(sla)n(v)o(e)h(in)f(this)h
(case:)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:clonesrv6-c-7) cvn /DEST pdfmark
end
 -2
472 a 396 656 a Fg(Example)g(5-62.)d(Clone)j(ser)o(v)o(er)-8
b(,)20 b(Model)h(Six)f(\(clonesr)o(v6.c\))f(-)h(subscriber)i(handler)-2
756 y
SDict begin H.S end
 -2 756 a -2 756 a
SDict begin 11.7 H.A end
 -2 756 a -2 756 a
SDict begin [/View [/XYZ H.V]/Dest (0:3629) cvn /DEST pdfmark end
 -2 756 a 396
933 a Fe(static)44 b(int)396 1030 y(s_subscriber)f(\(zloop_t)1383
1043 y(*)1428 1030 y(loop,)g(zmq_pollitem_t)2369 1043
y(*)2414 1030 y(poller,)g(void)2997 1043 y(*)3042 1030
y(args\))396 1127 y({)576 1224 y(clonesrv_t)1069 1237
y(*)1114 1224 y(self)h(=)g(\(clonesrv_t)1965 1237 y(*)2010
1224 y(\))h(args;)576 1322 y(//)89 b(Get)44 b(state)g(snapshot)g(if)g
(necessary)576 1419 y(if)g(\(self->kvmap)f(==)h(NULL\))g({)755
1516 y(self->kvmap)f(=)i(zhash_new)e(\(\);)755 1613 y(void)979
1626 y(*)1024 1613 y(snapshot)g(=)i(zsocket_new)e(\(self->ctx,)g
(ZMQ_DEALER\);)755 1710 y(zsocket_connect)f(\(snapshot,)h
("tcp://localhost:\045d",)f(self->peer\);)755 1807 y(zclock_log)h
(\("I:)h(asking)g(for)g(snapshot)g(from:)g(tcp://localhost:\045d",)1293
1904 y(self->peer\);)755 2001 y(zstr_sendm)f(\(snapshot,)g
("ICANHAZ?"\);)755 2099 y(zstr_send)g(\(snapshot,)g(""\);)i(//)f(blank)
g(subtree)g(to)g(get)h(all)755 2196 y(while)f(\(true\))g({)934
2293 y(kvmsg_t)1293 2306 y(*)1338 2293 y(kvmsg)g(=)g(kvmsg_recv)g
(\(snapshot\);)934 2390 y(if)h(\(!kvmsg\))1114 2487 y(break;)447
b(//)89 b(Interrupted)934 2584 y(if)45 b(\(streq)f(\(kvmsg_key)f
(\(kvmsg\),)g("KTHXBAI"\)\))g({)1114 2681 y(self->sequence)f(=)j
(kvmsg_sequence)d(\(kvmsg\);)1114 2779 y(kvmsg_destroy)g(\(&kvmsg\);)
1114 2876 y(break;)447 b(//)89 b(Done)934 2973 y(})934
3070 y(kvmsg_store)43 b(\(&kvmsg,)h(self->kvmap\);)755
3167 y(})755 3264 y(zclock_log)f(\("I:)h(received)g(snapshot=\045d",)e
(\(int\))i(self->sequence\);)755 3361 y(zsocket_destroy)e(\(self->ctx,)
h(snapshot\);)576 3459 y(})576 3556 y(//)89 b(Find)44
b(and)g(remove)g(update)g(off)g(pending)g(list)576 3653
y(kvmsg_t)934 3666 y(*)979 3653 y(kvmsg)g(=)h(kvmsg_recv)e
(\(poller->socket\);)576 3750 y(if)h(\(!kvmsg\))755 3847
y(return)g(0;)576 4041 y(if)g(\(strneq)g(\(kvmsg_key)f(\(kvmsg\),)g
("HUGZ"\)\))h({)755 4138 y(if)g(\(!s_was_pending)f(\(self,)h(kvmsg\)\))
f({)934 4236 y(//)90 b(If)44 b(master)g(update)g(came)g(before)g
(client)g(update,)f(flip)h(it)934 4333 y(//)90 b(around,)43
b(store)h(master)g(update)g(\(with)g(sequence\))f(on)i(pending)934
4430 y(//)90 b(list)44 b(and)g(use)g(to)h(clear)f(client)g(update)g
(when)g(it)g(comes)g(later)934 4527 y(zlist_append)f(\(self->pending,)f
(kvmsg_dup)i(\(kvmsg\)\);)755 4624 y(})755 4721 y(//)89
b(If)45 b(update)f(is)g(more)g(recent)g(than)g(our)h(kvmap,)e(apply)h
(it)755 4818 y(if)g(\(kvmsg_sequence)f(\(kvmsg\))g(>)i
(self->sequence\))d({)934 4916 y(self->sequence)h(=)h(kvmsg_sequence)f
(\(kvmsg\);)934 5013 y(kvmsg_store)g(\(&kvmsg,)h(self->kvmap\);)934
5110 y(zclock_log)f(\("I:)i(received)e(update=\045d",)g(\(int\))h
(self->sequence\);)p Black 3759 5569 a Ff(311)p Black
eop end
%%Page: 312 325
TeXDict begin 312 324 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.312) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 755 72 a Fe(})755 170 y(else)934 267 y(kvmsg_destroy)43
b(\(&kvmsg\);)576 364 y(})576 461 y(else)755 558 y(kvmsg_destroy)g
(\(&kvmsg\);)576 752 y(return)g(0;)396 850 y(})-2 1024
y
SDict begin H.S end
 -2 1024 a -2 1024 a
SDict begin 13 H.A end
 -2 1024 a -2 1024 a
SDict begin [/View [/XYZ H.V]/Dest (0:3630) cvn /DEST pdfmark end
 -2 1024 a 396
1124 a Fk(This)21 b(main)e(program)f(is)k(only)d(a)i(fe)n(w)f(hundred)e
(lines)i(of)g(code,)f(b)n(ut)h(it)h(took)f(some)g(time)g(to)g(get)h(w)o
(orking.)d(T)-7 b(o)20 b(be)396 1231 y(accurate,)f(b)n(uilding)g(Model)
h(Six)g(took)g(about)f(a)h(full)h(week)e(of)h("sweet)h(god,)e(this)i
(is)g(just)g(too)e(comple)o(x)g(for)g(the)396 1339 y(Guide")h(hacking.)
e(W)-7 b(e')l(v)o(e)20 b(assembled)g(pretty)f(much)g(e)n(v)o(erything)f
(and)i(the)g(kitchen)f(sink)h(into)g(this)h(small)396
1447 y(application.)e(W)-7 b(e)21 b(ha)n(v)o(e)f(f)o(ail-o)o(v)o(er)m
(,)d(ephemeral)i(v)n(alues,)g(subtrees,)h(and)g(so)g(on.)g(What)g
(surprised)f(me)i(w)o(as)g(that)f(the)396 1555 y(upfront)e(design)i(w)o
(as)h(pretty)e(accurate.)g(But)i(the)f(details)h(of)f(writing)f(and)h
(deb)n(ugging)e(so)i(man)o(y)f(sock)o(et)h(\003o)n(ws)h(is)396
1663 y(something)e(special.)h(Here')-5 b(s)20 b(ho)n(w)g(I)h(made)e
(this)i(w)o(ork:)-2 1681 y
SDict begin H.S end
 -2 1681 a -2 1681 a
SDict begin 13 H.A end
 -2 1681
a -2 1681 a
SDict begin [/View [/XYZ H.V]/Dest (0:3631) cvn /DEST pdfmark end
 -2 1681 a -2 1691 a
SDict begin H.S end
 -2 1691 a -2 1691 a
SDict begin 13 H.A end
 -2
1691 a -2 1691 a
SDict begin [/View [/XYZ H.V]/Dest (0:3632) cvn /DEST pdfmark end
 -2 1691 a Black 396 1833 a Fj(\225)p
Black 479 1833 a
SDict begin H.S end
 479 1833 a 479 1833 a
SDict begin 13 H.A end
 479 1833 a 479
1833 a
SDict begin [/View [/XYZ H.V]/Dest (0:3633) cvn /DEST pdfmark end
 479 1833 a Fk(By)g(using)f(reactors)f(\(bstar)m(,)g(on)h(top)g
(of)g(zloop\),)f(which)g(remo)o(v)o(e)f(a)j(lot)f(of)g(grunt-w)o(ork)e
(from)h(the)h(code,)f(and)h(lea)n(v)o(e)479 1941 y(what)g(remains)g
(simpler)g(and)f(more)h(ob)o(vious.)e(The)i(whole)g(serv)o(er)f(runs)h
(as)h(one)e(thread,)g(so)i(there')-5 b(s)20 b(no)479
2049 y(inter)n(-thread)f(weirdness)g(going)g(on.)h(Just)h(pass)f(a)h
(structure)e(pointer)g(\(')-5 b(self)5 b('\))20 b(around)e(to)i(all)h
(handlers,)e(which)g(can)479 2157 y(do)h(their)g(thing)f(happily)-5
b(.)19 b(One)h(nice)g(side-ef)n(fect)f(of)h(using)f(reactors)h(is)h
(that)f(code,)g(being)f(less)i(tightly)f(inte)o(grated)479
2265 y(into)g(a)h(poll)f(loop,)f(is)i(much)e(easier)i(to)f(reuse.)g
(Lar)o(ge)f(chunks)f(of)i(Model)g(Six)g(are)h(tak)o(en)e(from)g(Model)h
(Fi)n(v)o(e.)-2 2283 y
SDict begin H.S end
 -2 2283 a -2 2283 a
SDict begin 13 H.A end
 -2 2283 a
-2 2283 a
SDict begin [/View [/XYZ H.V]/Dest (0:3634) cvn /DEST pdfmark end
 -2 2283 a Black 396 2415 a Fj(\225)p Black
479 2415 a
SDict begin H.S end
 479 2415 a 479 2415 a
SDict begin 13 H.A end
 479 2415 a 479 2415
a
SDict begin [/View [/XYZ H.V]/Dest (0:3635) cvn /DEST pdfmark end
 479 2415 a Fk(By)h(b)n(uilding)e(it)i(piece)f(by)f(piece,)h(and)g
(getting)f(each)h(piece)g(w)o(orking)2534 2415 y
SDict begin H.S end
 2534
2415 a 2534 2415 a
SDict begin 13 H.A end
 2534 2415 a 2534 2415 a
SDict begin [/View [/XYZ H.V]/Dest (0:3636) cvn /DEST pdfmark end
 2534 2415
a Fg(pr)o(operly)f Fk(before)g(going)g(onto)g(the)h(ne)o(xt)479
2522 y(one.)g(Since)g(there)g(are)g(four)f(or)h(\002)n(v)o(e)g(main)f
(sock)o(et)i(\003o)n(ws,)f(that)g(meant)g(quite)g(a)g(lot)h(of)f(deb)n
(ugging)d(and)j(testing.)g(I)479 2630 y(deb)n(ug)f(just)i(by)f
(printing)e(stuf)n(f)i(to)h(the)f(console)f(\(e.g.)h(dumping)e
(messages\).)h(There')-5 b(s)20 b(no)g(sense)g(in)h(actually)479
2738 y(opening)e(a)h(deb)n(ugger)e(for)i(this)g(kind)g(of)g(w)o(ork.)-2
2756 y
SDict begin H.S end
 -2 2756 a -2 2756 a
SDict begin 13 H.A end
 -2 2756 a -2 2756 a
SDict begin [/View [/XYZ H.V]/Dest (0:3637) cvn /DEST pdfmark end
 -2 2756
a Black 396 2888 a Fj(\225)p Black 479 2888 a
SDict begin H.S end
 479 2888
a 479 2888 a
SDict begin 13 H.A end
 479 2888 a 479 2888 a
SDict begin [/View [/XYZ H.V]/Dest (0:3638) cvn /DEST pdfmark end
 479 2888 a Fk(By)h(al)o(w)o(ays)g
(testing)f(under)f(V)-9 b(algrind,)18 b(so)j(that)f(I'm)f(sure)i(there)
e(are)h(no)g(memory)f(leaks.)h(In)g(C)h(this)f(is)i(a)e(major)479
2996 y(concern,)f(you)g(can')o(t)g(dele)o(gate)g(to)h(some)g(garbage)e
(collector)-5 b(.)20 b(Using)g(proper)e(and)i(consistent)g
(abstractions)f(lik)o(e)479 3104 y(kvmsg)g(and)h(CZMQ)h(helps)f
(enormously)-5 b(.)-2 3288 y
SDict begin H.S end
 -2 3288 a -2 3288 a
SDict begin 13 H.A end
 -2 3288
a -2 3288 a
SDict begin [/View [/XYZ H.V]/Dest (0:3639) cvn /DEST pdfmark end
 -2 3288 a 396 3378 a Fk(I'm)20 b(sure)g(the)g(code)g(still)
h(has)f(\003a)o(ws)h(which)f(kind)f(readers)h(will)h(spend)e(week)o
(ends)g(deb)n(ugging)f(and)i(\002xing)f(for)h(me.)396
3486 y(I'm)g(happ)o(y)f(enough)f(with)i(this)h(model)e(to)i(use)f(it)h
(as)g(the)f(basis)h(for)e(real)i(applications.)-2 3670
y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 13 H.A end
 -2 3670 a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:3640) cvn /DEST pdfmark end
 -2 3670 a 396
3759 a Fk(T)-7 b(o)20 b(test)h(the)f(sixth)f(model,)g(start)h(the)g
(primary)e(serv)o(er)h(and)g(backup)f(serv)o(er)m(,)h(and)g(a)h(set)h
(of)e(clients,)h(in)g(an)o(y)f(order)-5 b(.)19 b(Then)396
3867 y(kill)i(and)e(restart)i(one)e(of)h(the)g(serv)o(ers,)g(randomly)
-5 b(,)17 b(and)j(k)o(eep)f(doing)g(this.)i(If)f(the)g(design)g(and)f
(code)h(is)h(accurate,)396 3975 y(clients)g(will)g(continue)d(to)j(get)
f(the)g(same)h(stream)f(of)g(updates)f(from)g(whate)n(v)o(er)g(serv)o
(er)g(is)i(currently)e(master)-5 b(.)-2 4004 y
SDict begin H.S end
 -2 4004
a -2 4004 a
SDict begin 13 H.A end
 -2 4004 a -2 4004 a
SDict begin [/View [/XYZ H.V]/Dest (0:3641) cvn /DEST pdfmark end
 -2 4004 a 396 4314 a
Fb(5.3.7.)36 b(Clone)e(Pr)n(otocol)f(Speci\002cation)2352
4314 y
SDict begin H.S end
 2352 4314 a 2352 4314 a
SDict begin 18.72 H.A end
 2352 4314 a 2352 4314
a
SDict begin [/View [/XYZ H.V]/Dest (10.72.27.2) cvn /DEST pdfmark end
 2352 4314 a -2 4505 a
SDict begin H.S end
 -2 4505 a -2 4505 a
SDict begin 13 H.A end
 -2 4505 a
-2 4505 a
SDict begin [/View [/XYZ H.V]/Dest (0:3643) cvn /DEST pdfmark end
 -2 4505 a 396 4588 a Fk(After)20 b(this)h(much)e(w)o(ork)h
(to)g(b)n(uild)g(reliable)g(pub-sub,)e(we)i(w)o(ant)g(some)g(guarantee)
f(that)h(we)h(can)f(safely)g(b)n(uild)396 4696 y(applications)f(to)i(e)
o(xploit)e(the)h(w)o(ork.)f(A)i(good)e(start)h(is)i(to)e(write-up)f
(the)h(protocol.)e(This)j(lets)g(us)f(mak)o(e)396 4804
y(implementations)f(in)h(other)f(languages)g(and)h(lets)h(us)f(impro)o
(v)o(e)e(the)i(design)g(on)g(paper)m(,)e(rather)i(than)f(hands-deep)f
(in)396 4912 y(code.)p Black 3759 5569 a Ff(312)p Black
eop end
%%Page: 313 326
TeXDict begin 313 325 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.313) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3644) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Here,)i(then,)g(is)h(the)f(Clustered)g(Hashmap)f
(Protocol,)g(which)h("de\002nes)g(a)g(cluster)n(-wide)g(k)o(e)o(y-v)n
(alue)e(hashmap,)g(and)396 180 y(mechanisms)h(for)h(sharing)f(this)i
(across)f(a)h(set)g(of)f(clients.)g(CHP)h(allo)n(ws)g(clients)f(to)g(w)
o(ork)g(with)g(subtrees)g(of)g(the)396 288 y(hashmap,)f(to)h(update)f
(v)n(alues,)h(and)g(to)g(de\002ne)g(ephemeral)e(v)n(alues.")-2
306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:3645) cvn /DEST pdfmark end
 -2 306 a -2
316 a
SDict begin H.S end
 -2 316 a -2 316 a
SDict begin 13 H.A end
 -2 316 a -2 316 a
SDict begin [/View [/XYZ H.V]/Dest (0:3646) cvn /DEST pdfmark end
 -2 316 a Black
396 459 a Fj(\225)p Black 479 459 a
SDict begin H.S end
 479 459 a 479 459
a
SDict begin 13 H.A end
 479 459 a 479 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:3647) cvn /DEST pdfmark end
 479 459 a Fk(http://rfc.zeromq.or)o(g/spec:12)-2
601 y
SDict begin H.S end
 -2 601 a -2 601 a
SDict begin 13 H.A end
 -2 601 a -2 601 a
SDict begin [/View [/XYZ H.V]/Dest (0:3648) cvn /DEST pdfmark end
 -2 601 a 359
x Fn(5.4.)39 b(The)g(Espresso)f(P)l(attern)1750 960 y
SDict begin H.S end

1750 960 a 1750 960 a
SDict begin 22.464 H.A end
 1750 960 a 1750 960 a
SDict begin [/View [/XYZ H.V]/Dest (10.73.1) cvn /DEST pdfmark end
 1750 960
a -2 1156 a
SDict begin H.S end
 -2 1156 a -2 1156 a
SDict begin 13 H.A end
 -2 1156 a -2 1156 a
SDict begin [/View [/XYZ H.V]/Dest (0:3650) cvn /DEST pdfmark end
 -2
1156 a 396 1234 a Fk(here)20 b(is)h(a)g(fun)e(little)i(machine)e(that)h
(e)o(xploits)g(the)g(zmq_proxy[3])c(method)j(to)h(sho)n(w)g(you)f
(what')-5 b(s)21 b(happening)c(on)j(a)396 1342 y(pub-sub)f(netw)o(ork.)
f(It')-5 b(s)21 b(decepti)n(v)o(ely)d(simple:)-2 1360
y
SDict begin H.S end
 -2 1360 a -2 1360 a
SDict begin 13 H.A end
 -2 1360 a -2 1360 a
SDict begin [/View [/XYZ H.V]/Dest (0:espresso-c) cvn /DEST pdfmark
end
 -2 1360 a 396
1543 a Fg(Example)j(5-63.)d(Espr)o(esso)j(Machine)g(\(espr)o(esso.c\))
-2 1643 y
SDict begin H.S end
 -2 1643 a -2 1643 a
SDict begin 11.7 H.A end
 -2 1643 a -2 1643 a
SDict begin [/View [/XYZ H.V]/Dest (0:3653) cvn /DEST pdfmark end
 -2
1643 a 396 1724 a Fe(//)396 1821 y(//)90 b(Espresso)43
b(Pattern)396 1918 y(//)90 b(This)44 b(shows)g(how)g(to)h(capture)e
(data)h(using)g(a)h(pub-sub)f(proxy)396 2015 y(//)396
2112 y(#include)g("czmq.h")396 2306 y(//)90 b(The)44
b(subscriber)f(thread)h(requests)f(messages)h(starting)f(with)396
2404 y(//)90 b(A)44 b(and)h(B,)f(then)g(reads)g(and)h(counts)e
(incoming)h(messages.)396 2598 y(static)g(void)396 2695
y(subscriber_thread)e(\(void)1472 2708 y(*)1517 2695
y(args,)i(zctx_t)2100 2708 y(*)2145 2695 y(ctx,)g(void)2593
2708 y(*)2638 2695 y(pipe\))396 2792 y({)576 2889 y(//)89
b(Subscribe)43 b(to)i("A")f(and)g("B")576 2986 y(void)800
2999 y(*)845 2986 y(subscriber)f(=)h(zsocket_new)f(\(ctx,)h(ZMQ_SUB\);)
576 3083 y(zsocket_connect)e(\(subscriber,)h("tcp://localhost:6001"\);)
576 3181 y(zsockopt_set_subscribe)e(\(subscriber,)i("A"\);)576
3278 y(zsockopt_set_subscribe)e(\(subscriber,)i("B"\);)576
3472 y(int)h(count)g(=)h(0;)576 3569 y(while)f(\(true\))f({)755
3666 y(char)979 3679 y(*)1024 3666 y(string)h(=)g(zstr_recv)g
(\(subscriber\);)755 3763 y(if)g(\(!string\))934 3861
y(break;)627 b(//)89 b(Interrupted)755 3958 y(free)44
b(\(string\);)755 4055 y(count++;)576 4152 y(})576 4249
y(printf)f(\("Subscriber)g(received)h(\045d)g(messages\\n",)f(count\);)
396 4346 y(})-2 4520 y
SDict begin H.S end
 -2 4520 a -2 4520 a
SDict begin 13 H.A end
 -2 4520 a
-2 4520 a
SDict begin [/View [/XYZ H.V]/Dest (0:3654) cvn /DEST pdfmark end
 -2 4520 a 396 4620 a Fk(The)20 b(publisher)f(sends)h(random)e
(messages)j(starting)f(with)g(A-J:)-2 4638 y
SDict begin H.S end
 -2 4638
a -2 4638 a
SDict begin 13 H.A end
 -2 4638 a -2 4638 a
SDict begin [/View [/XYZ H.V]/Dest (0:espresso-c-1) cvn /DEST pdfmark
end
 -2 4638 a Black 3759
5569 a Ff(313)p Black eop end
%%Page: 314 327
TeXDict begin 314 326 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.314) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 396 72 a Fg(Example)j(5-64.)d(Espr)o(esso)j(Machine)g(\(espr)o
(esso.c\))e(-)i(publisher)g(thr)o(ead)-2 172 y
SDict begin H.S end
 -2 172
a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:3657) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(static)44
b(void)396 447 y(publisher_thread)e(\(void)1427 460 y(*)1472
447 y(args,)i(zctx_t)2055 460 y(*)2100 447 y(ctx,)g(void)2548
460 y(*)2593 447 y(pipe\))396 544 y({)576 641 y(void)800
654 y(*)845 641 y(publisher)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_PUB\);)576
738 y(zsocket_bind)e(\(publisher,)h("tcp://)2011 751
y(*)2056 738 y(:6000"\);)576 933 y(while)h(\(true\))f({)755
1030 y(char)h(string)g([10];)755 1127 y(sprintf)g(\(string,)f
("\045c-\04505d",)g(randof)h(\(10\))g(+)h('A',)f(randof)g
(\(100000\)\);)755 1224 y(if)g(\(zstr_send)g(\(publisher,)f(string\))g
(==)i(-1\))934 1321 y(break;)627 b(//)89 b(Interrupted)755
1418 y(zclock_sleep)43 b(\(100\);)223 b(//)89 b(Wait)44
b(for)h(1/10th)f(second)576 1515 y(})396 1613 y(})-2
1787 y
SDict begin H.S end
 -2 1787 a -2 1787 a
SDict begin 13 H.A end
 -2 1787 a -2 1787 a
SDict begin [/View [/XYZ H.V]/Dest (0:3658) cvn /DEST pdfmark end
 -2 1787
a 396 1887 a Fk(The)20 b(listener)g(recei)n(v)o(es)g(all)g(messages)h
(\003o)n(wing)e(through)f(the)i(proxy)-5 b(,)18 b(on)i(its)h(pipe.)f
(In)g(CZMQ,)g(the)g(pipe)g(is)h(a)g(pair)e(of)396 1994
y(ZMQ_P)-8 b(AIR)20 b(sock)o(ets)h(that)f(connects)f(attached)h(child)g
(threads.)f(In)h(other)f(languages)g(your)g(mileage)g(may)h(v)n(ary:)-2
2012 y
SDict begin H.S end
 -2 2012 a -2 2012 a
SDict begin 13 H.A end
 -2 2012 a -2 2012 a
SDict begin [/View [/XYZ H.V]/Dest (0:espresso-c-2) cvn /DEST pdfmark
end
 -2 2012
a 396 2196 a Fg(Example)h(5-65.)d(Espr)o(esso)j(Machine)g(\(espr)o
(esso.c\))e(-)i(listener)f(thr)o(ead)-2 2296 y
SDict begin H.S end
 -2 2296
a -2 2296 a
SDict begin 11.7 H.A end
 -2 2296 a -2 2296 a
SDict begin [/View [/XYZ H.V]/Dest (0:3661) cvn /DEST pdfmark end
 -2 2296 a 396 2473 a
Fe(static)44 b(void)396 2570 y(listener_thread)f(\(void)1383
2583 y(*)1428 2570 y(args,)g(zctx_t)2010 2583 y(*)2055
2570 y(ctx,)h(void)2503 2583 y(*)2548 2570 y(pipe\))396
2667 y({)576 2764 y(//)89 b(Print)44 b(everything)f(that)h(arrives)g
(on)g(pipe)576 2862 y(while)g(\(true\))f({)755 2959 y(char)979
2972 y(*)1024 2959 y(string)h(=)g(zstr_recv)g(\(pipe\);)755
3056 y(if)g(\(!string\))934 3153 y(break;)627 b(//)89
b(Interrupted)755 3250 y(puts)44 b(\(string\);)755 3347
y(free)g(\(string\);)576 3444 y(})396 3542 y(})-2 3716
y
SDict begin H.S end
 -2 3716 a -2 3716 a
SDict begin 13 H.A end
 -2 3716 a -2 3716 a
SDict begin [/View [/XYZ H.V]/Dest (0:3662) cvn /DEST pdfmark end
 -2 3716 a 396
3816 a Fk(The)20 b(main)g(task)g(starts)h(the)g(subscriber)e(and)g
(publisher)m(,)f(and)i(then)g(sets)h(itself)g(up)f(as)h(a)f(listening)g
(proxy)-5 b(.)18 b(The)i(listener)396 3923 y(runs)g(as)h(a)g(child)e
(thread:)-2 3924 y
SDict begin H.S end
 -2 3924 a -2 3924 a
SDict begin 13 H.A end
 -2 3924 a -2 3924
a
SDict begin [/View [/XYZ H.V]/Dest (0:espresso-c-3) cvn /DEST pdfmark
end
 -2 3924 a 396 4125 a Fg(Example)i(5-66.)d(Espr)o(esso)j(Machine)g
(\(espr)o(esso.c\))e(-)i(main)f(thr)o(ead)-2 4225 y
SDict begin H.S end
 -2
4225 a -2 4225 a
SDict begin 11.7 H.A end
 -2 4225 a -2 4225 a
SDict begin [/View [/XYZ H.V]/Dest (0:3665) cvn /DEST pdfmark end
 -2 4225 a 396 4402
a Fe(int)45 b(main)f(\(void\))396 4499 y({)576 4596 y(//)89
b(Start)44 b(child)g(threads)576 4693 y(zctx_t)889 4706
y(*)934 4693 y(ctx)h(=)f(zctx_new)g(\(\);)576 4791 y(zthread_fork)e
(\(ctx,)i(publisher_thread,)e(NULL\);)576 4888 y(zthread_fork)g(\(ctx,)
i(subscriber_thread,)e(NULL\);)576 5082 y(void)800 5095
y(*)845 5082 y(subscriber)h(=)h(zsocket_new)f(\(ctx,)h(ZMQ_XSUB\);)p
Black 3759 5569 a Ff(314)p Black eop end
%%Page: 315 328
TeXDict begin 315 327 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.315) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(zsocket_connect)42 b(\(subscriber,)h
("tcp://localhost:6000"\);)576 170 y(void)800 183 y(*)845
170 y(publisher)g(=)i(zsocket_new)e(\(ctx,)h(ZMQ_XPUB\);)576
267 y(zsocket_bind)e(\(publisher,)h("tcp://)2011 280
y(*)2056 267 y(:6001"\);)576 364 y(void)800 377 y(*)845
364 y(listener)g(=)i(zthread_fork)e(\(ctx,)h(listener_thread,)e
(NULL\);)576 461 y(zmq_proxy)h(\(subscriber,)g(publisher,)g
(listener\);)576 655 y(puts)h(\(")g(interrupted"\);)576
850 y(//)89 b(Tell)44 b(attached)g(threads)f(to)i(exit)576
947 y(zctx_destroy)d(\(&ctx\);)576 1044 y(return)h(0;)396
1141 y(})-2 1232 y
SDict begin H.S end
 -2 1232 a -2 1232 a
SDict begin 13 H.A end
 -2 1232 a -2 1232
a
SDict begin [/View [/XYZ H.V]/Dest (0:3666) cvn /DEST pdfmark end
 -2 1232 a 369 x Fn(5.5.)c(Last)g(V)-9 b(alue)39 b(Cac)o(hing)1593
1601 y
SDict begin H.S end
 1593 1601 a 1593 1601 a
SDict begin 22.464 H.A end
 1593 1601 a 1593 1601
a
SDict begin [/View [/XYZ H.V]/Dest (10.74.1) cvn /DEST pdfmark end
 1593 1601 a -2 1799 a
SDict begin H.S end
 -2 1799 a -2 1799 a
SDict begin 13 H.A end
 -2 1799 a
-2 1799 a
SDict begin [/View [/XYZ H.V]/Dest (0:3668) cvn /DEST pdfmark end
 -2 1799 a 396 1875 a Fk(If)20 b(you')l(v)o(e)e(used)i
(commercial)f(publish-subscribe)e(systems)k(you)e(may)h(be)g(used)g(to)
g(some)g(features)g(that)g(are)g(missing)396 1983 y(in)h(the)f(f)o(ast)
h(and)e(cheerful)g(\330MQ)h(pub-sub)f(model.)g(One)h(of)g(these)g(is)h
("last)g(v)n(alue)f(caching".)e(The)i(problem)f(this)396
2091 y(solv)o(es)h(is)h(ho)n(w)f(a)h(ne)n(w)f(subscriber)f(catches)h
(up)g(when)f(it)i(joins)f(the)g(netw)o(ork.)f(The)h(theory)f(is)i(that)
f(publishers)f(get)396 2199 y(noti\002ed)h(when)f(a)i(ne)n(w)f
(subscriber)f(joins)h(and)g(subscribes)f(to)i(some)f(speci\002c)g
(topics.)g(The)g(publisher)f(can)h(then)396 2307 y(re-broadcast)e(the)j
(last)g(message)f(for)f(those)h(topics.)-2 2491 y
SDict begin H.S end
 -2
2491 a -2 2491 a
SDict begin 13 H.A end
 -2 2491 a -2 2491 a
SDict begin [/View [/XYZ H.V]/Dest (0:3669) cvn /DEST pdfmark end
 -2 2491 a 396 2581
a Fk(First)h(I')o(ll)g(e)o(xplain)e(why)g(\330MQ)h(does)g(not)g(do)g
(this,)g(and)g(then)g(I')o(ll)g(sho)n(w)g(ho)n(w)g(to)g(do)g(it)h(an)o
(yho)n(w)-5 b(.)-2 2765 y
SDict begin H.S end
 -2 2765 a -2 2765 a
SDict begin 13 H.A end
 -2 2765
a -2 2765 a
SDict begin [/View [/XYZ H.V]/Dest (0:3670) cvn /DEST pdfmark end
 -2 2765 a 396 2855 a Fk(W)e(e)22 b(don')o(t)c(do)i(it)h
(because)e(in)i(lar)o(ge)e(pub-sub)f(systems)j(the)f(v)n(olumes)f(of)h
(data)g(mak)o(e)g(it)h(pretty)f(much)f(impossible.)g(T)-7
b(o)396 2963 y(mak)o(e)19 b(really)g(lar)o(ge-scale)f(pub-sub)f(netw)o
(orks)h(you)h(need)f(a)i(protocol)d(lik)o(e)j(PGM)f(that)h(e)o(xploits)
e(an)h(upscale)g(Ethernet)396 3071 y(switch')-5 b(s)21
b(ability)f(to)g(multicast)h(data)f(to)g(thousands)f(of)h(subscribers.)
f(T)m(rying)g(to)h(do)g(a)g(TCP)h(unicast)f(from)g(the)396
3179 y(publisher)f(to)h(each)g(of)g(thousands)f(of)h(subscribers)f
(just)i(doesn')o(t)e(scale.)h(Y)-9 b(ou)20 b(get)g(weird)g(spik)o(es,)g
(unf)o(air)f(distrib)n(ution)396 3286 y(\(some)h(subscribers)f(getting)
h(the)g(message)g(before)f(others\),)g(netw)o(ork)g(congestion,)f(and)i
(general)f(unhappiness.)-2 3470 y
SDict begin H.S end
 -2 3470 a -2 3470 a
SDict begin 13 H.A end

-2 3470 a -2 3470 a
SDict begin [/View [/XYZ H.V]/Dest (0:3671) cvn /DEST pdfmark end
 -2 3470 a 396 3560 a Fk(PGM)i(is)g(a)g(one-w)o(ay)d
(protocol:)h(the)h(publisher)f(sends)h(a)h(message)f(to)g(a)h
(multicast)f(address)g(at)g(the)h(switch,)f(which)396
3668 y(then)g(rebroadcasts)f(that)h(to)g(all)h(interested)f
(subscribers.)f(The)g(publisher)g(ne)n(v)o(er)g(sees)i(when)f
(subscribers)f(join)h(or)396 3776 y(lea)n(v)o(e:)g(this)h(all)g
(happens)e(in)h(the)g(switch,)h(which)e(we)i(don')o(t)d(really)i(w)o
(ant)g(to)h(start)f(reprogramming.)-2 3960 y
SDict begin H.S end
 -2 3960
a -2 3960 a
SDict begin 13 H.A end
 -2 3960 a -2 3960 a
SDict begin [/View [/XYZ H.V]/Dest (0:3672) cvn /DEST pdfmark end
 -2 3960 a 396 4050 a
Fk(OK,)h(b)n(ut)f(in)g(a)h(lo)n(wer)n(-v)n(olume)d(netw)o(ork,)h(with)h
(a)h(fe)n(w)f(dozen)f(subscribers,)g(and)g(a)i(limited)f(number)e(of)i
(topics,)g(ho)n(w)396 4158 y(do)g(we)h(mak)o(e)e(a)i(L)-8
b(VC)20 b(using)g(\330MQ?)g(The)g(answer)g(is)h(to)g(create)f(a)g
(proxy)f(that)h(sits)h(between)f(the)g(publisher)f(and)396
4266 y(subscribers;)h(an)g(analog)f(for)g(the)i(switch,)f(b)n(ut)g(one)
g(we)g(can)g(program)e(ourselv)o(es.)-2 4450 y
SDict begin H.S end
 -2 4450
a -2 4450 a
SDict begin 13 H.A end
 -2 4450 a -2 4450 a
SDict begin [/View [/XYZ H.V]/Dest (0:3673) cvn /DEST pdfmark end
 -2 4450 a 396 4540 a
Fk(I')o(ll)j(start)f(by)g(making)f(a)i(publisher)d(and)i(subscriber)f
(that)h(highlight)f(the)h(w)o(orst)g(case)h(scenario.)e(This)i
(publisher)d(is)396 4648 y(pathological.)g(It)j(starts)g(by)e
(immediately)g(sending)g(messages)i(to)f(each)g(of)g(a)g(thousand)f
(topics,)h(and)f(then)h(it)h(sends)396 4756 y(one)f(update)f(a)i
(second)e(to)h(a)h(random)d(topic.)i(A)h(subscriber)d(connects,)h(and)h
(subscribes)g(to)g(a)h(topic.)e(W)m(ithout)h(L)-8 b(VC,)20
b(a)396 4864 y(subscriber)f(w)o(ould)h(ha)n(v)o(e)f(to)i(w)o(ait)g(an)f
(a)n(v)o(erage)f(of)h(500)f(seconds)g(to)i(get)f(an)o(y)f(data.)h(T)-7
b(o)21 b(add)e(some)h(drama,)f(let')-5 b(s)396 4972 y(pretend)19
b(there')-5 b(s)20 b(an)g(escaped)g(con)m(vict)f(called)h(Roth)g
(threatening)e(to)i(rip)g(the)h(head)e(of)n(f)h(Roger)f(the)h(to)o(y)h
(b)n(unn)o(y)d(if)i(we)396 5080 y(can')o(t)f(\002x)i(that)f(8.3)g
(minutes')f(delay)-5 b(.)p Black 3759 5569 a Ff(315)p
Black eop end
%%Page: 316 329
TeXDict begin 316 328 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.316) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3674) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Here')-5 b(s)21 b(the)f(publisher)f(code.)g(Note)h
(that)g(it)h(has)g(the)f(command)e(line)i(option)f(to)i(connect)e(to)h
(some)g(address,)f(b)n(ut)396 180 y(otherwise)h(binds)f(to)i(an)f
(endpoint.)e(W)-7 b(e')o(ll)21 b(use)g(this)f(later)h(to)f(connect)f
(to)h(our)g(last)h(v)n(alue)e(cache:)-2 198 y
SDict begin H.S end
 -2 198
a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:pathopub-c) cvn /DEST pdfmark
end
 -2 198 a 396 382 a Fg(Example)i(5-67.)d(P)
o(athologic)h(Publisher)i(\(pathopub)m(.c\))-2 482 y
SDict begin H.S end

-2 482 a -2 482 a
SDict begin 11.7 H.A end
 -2 482 a -2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:3677) cvn /DEST pdfmark end
 -2 482 a 396 562
a Fe(//)396 659 y(//)90 b(Pathological)42 b(publisher)396
756 y(//)90 b(Sends)44 b(out)g(1,000)g(topics)g(and)g(then)g(one)h
(random)e(update)h(per)h(second)396 853 y(//)396 950
y(#include)f("czmq.h")396 1145 y(int)h(main)f(\(int)g(argc,)g(char)1517
1158 y(*)1562 1145 y(argv)g([]\))396 1242 y({)576 1339
y(zctx_t)889 1352 y(*)934 1339 y(context)g(=)h(zctx_new)e(\(\);)576
1436 y(void)800 1449 y(*)845 1436 y(publisher)g(=)i(zsocket_new)e
(\(context,)g(ZMQ_PUB\);)576 1533 y(if)h(\(argc)g(==)h(2\))755
1630 y(zsocket_connect)d(\(publisher,)h(argv)h([1]\);)576
1728 y(else)755 1825 y(zsocket_bind)f(\(publisher,)g("tcp://)2191
1838 y(*)2236 1825 y(:5556"\);)576 2019 y(//)89 b(Ensure)44
b(subscriber)f(connection)g(has)h(time)h(to)f(complete)576
2116 y(sleep)g(\(1\);)576 2310 y(//)89 b(Send)44 b(out)g(all)h(1,000)f
(topic)g(messages)576 2407 y(int)g(topic_nbr;)576 2505
y(for)g(\(topic_nbr)f(=)i(0;)f(topic_nbr)g(<)g(1000;)g(topic_nbr++\))f
({)755 2602 y(zstr_sendfm)g(\(publisher,)g("\04503d",)h(topic_nbr,)f
(ZMQ_SNDMORE\);)755 2699 y(zstr_send)g(\(publisher,)g("Save)h
(Roger"\);)576 2796 y(})576 2893 y(//)89 b(Send)44 b(one)g(random)g
(update)g(per)g(second)576 2990 y(srandom)f(\(\(unsigned\))g(time)h
(\(NULL\)\);)576 3087 y(while)g(\(!zctx_interrupted\))d({)755
3185 y(sleep)j(\(1\);)755 3282 y(zstr_sendfm)f(\(publisher,)g
("\04503d",)h(randof)f(\(1000\),)h(ZMQ_SNDMORE\);)755
3379 y(zstr_send)f(\(publisher,)g("Off)h(with)h(his)f(head!"\);)576
3476 y(})576 3573 y(zctx_destroy)e(\(&context\);)576
3670 y(return)h(0;)396 3767 y(})-2 3942 y
SDict begin H.S end
 -2 3942 a -2
3942 a
SDict begin 13 H.A end
 -2 3942 a -2 3942 a
SDict begin [/View [/XYZ H.V]/Dest (0:3678) cvn /DEST pdfmark end
 -2 3942 a 396 4041 a Fk(And)20
b(here')-5 b(s)20 b(the)g(subscriber:)-2 4042 y
SDict begin H.S end
 -2 4042
a -2 4042 a
SDict begin 13 H.A end
 -2 4042 a -2 4042 a
SDict begin [/View [/XYZ H.V]/Dest (0:pathosub-c) cvn /DEST pdfmark
end
 -2 4042 a 396 4243 a
Fg(Example)h(5-68.)d(P)o(athologic)h(Subscriber)i(\(pathosub)m(.c\))-2
4343 y
SDict begin H.S end
 -2 4343 a -2 4343 a
SDict begin 11.7 H.A end
 -2 4343 a -2 4343 a
SDict begin [/View [/XYZ H.V]/Dest (0:3681) cvn /DEST pdfmark end
 -2 4343
a 396 4423 a Fe(//)396 4520 y(//)90 b(Pathological)42
b(subscriber)396 4617 y(//)90 b(Subscribes)43 b(to)h(one)h(random)e
(topic)h(and)h(prints)f(received)f(messages)396 4714
y(//)396 4811 y(#include)h("czmq.h")396 5006 y(int)h(main)f(\(int)g
(argc,)g(char)1517 5019 y(*)1562 5006 y(argv)g([]\))396
5103 y({)p Black 3757 5569 a Ff(316)p Black eop end
%%Page: 317 330
TeXDict begin 317 329 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.317) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 72 a Fe(zctx_t)889 85 y(*)934 72 y(context)44
b(=)h(zctx_new)e(\(\);)576 170 y(void)800 183 y(*)845
170 y(subscriber)g(=)h(zsocket_new)f(\(context,)h(ZMQ_SUB\);)576
267 y(if)g(\(argc)g(==)h(2\))755 364 y(zsocket_connect)d(\(subscriber,)
h(argv)h([1]\);)576 461 y(else)755 558 y(zsocket_connect)e
(\(subscriber,)h("tcp://localhost:5556"\);)576 752 y(srandom)g
(\(\(unsigned\))g(time)h(\(NULL\)\);)576 850 y(char)g(subscription)f
([5];)576 947 y(sprintf)g(\(subscription,)g("\04503d",)g(randof)h
(\(1000\)\);)576 1044 y(zsocket_set_subscribe)d(\(subscriber,)i
(subscription\);)576 1238 y(while)h(\(true\))f({)755
1335 y(char)979 1348 y(*)1024 1335 y(topic)h(=)h(zstr_recv)e
(\(subscriber\);)755 1432 y(if)h(\(!topic\))934 1530
y(break;)755 1627 y(char)979 1640 y(*)1024 1627 y(data)g(=)h(zstr_recv)
e(\(subscriber\);)755 1724 y(assert)h(\(streq)g(\(topic,)f
(subscription\)\);)755 1821 y(puts)h(\(data\);)755 1918
y(free)g(\(topic\);)755 2015 y(free)g(\(data\);)576 2112
y(})576 2209 y(zctx_destroy)e(\(&context\);)576 2307
y(return)h(0;)396 2404 y(})-2 2578 y
SDict begin H.S end
 -2 2578 a -2 2578
a
SDict begin 13 H.A end
 -2 2578 a -2 2578 a
SDict begin [/View [/XYZ H.V]/Dest (0:3682) cvn /DEST pdfmark end
 -2 2578 a 396 2678 a Fk(T)m(ry)20
b(b)n(uilding)f(and)h(running)e(these:)i(\002rst)h(the)f(subscriber)m
(,)f(then)g(the)h(publisher)-5 b(.)19 b(Y)-9 b(ou')o(ll)20
b(see)h(the)f(subscriber)f(reports)396 2786 y(getting)h("Sa)n(v)o(e)g
(Roger")f(as)i(you')l(d)e(e)o(xpect:)-2 2887 y
SDict begin H.S end
 -2 2887
a -2 2887 a
SDict begin 11.7 H.A end
 -2 2887 a -2 2887 a
SDict begin [/View [/XYZ H.V]/Dest (0:3683) cvn /DEST pdfmark end
 -2 2887 a 396 2966 a
Fe(./pathosub)43 b(&)396 3063 y(./pathopub)-2 3240 y
SDict begin H.S end

-2 3240 a -2 3240 a
SDict begin 13 H.A end
 -2 3240 a -2 3240 a
SDict begin [/View [/XYZ H.V]/Dest (0:3684) cvn /DEST pdfmark end
 -2 3240 a 396
3337 a Fk(It')-5 b(s)21 b(when)f(you)f(run)g(a)i(second)e(subscriber)g
(that)i(you)e(understand)f(Roger')-5 b(s)20 b(predicament.)e(Y)-9
b(ou)19 b(ha)n(v)o(e)h(to)g(lea)n(v)o(e)g(it)h(an)396
3445 y(a)o(wful)f(long)f(time)i(before)d(it)j(reports)f(getting)f(an)o
(y)g(data.)h(So,)g(here')-5 b(s)20 b(our)g(last)h(v)n(alue)e(cache.)h
(As)h(I)f(promised,)f(it')-5 b(s)21 b(a)396 3553 y(proxy)e(that)h
(binds)g(to)g(tw)o(o)g(sock)o(ets)h(and)e(then)h(handles)g(messages)g
(on)g(both)f(them:)-2 3571 y
SDict begin H.S end
 -2 3571 a -2 3571 a
SDict begin 13 H.A end
 -2 3571
a -2 3571 a
SDict begin [/View [/XYZ H.V]/Dest (0:lvcache-c) cvn /DEST pdfmark
end
 -2 3571 a 396 3754 a Fg(Example)i(5-69.)d(Last)j(V)-8
b(alue)21 b(Caching)f(Pr)o(oxy)e(\(lvcache.c\))-2 3854
y
SDict begin H.S end
 -2 3854 a -2 3854 a
SDict begin 11.7 H.A end
 -2 3854 a -2 3854 a
SDict begin [/View [/XYZ H.V]/Dest (0:3687) cvn /DEST pdfmark end
 -2 3854 a 396
3934 a Fe(//)396 4031 y(//)90 b(Last)44 b(value)g(cache)396
4129 y(//)90 b(Uses)44 b(XPUB)g(subscription)f(messages)g(to)i(re-send)
e(data)396 4226 y(//)396 4323 y(#include)h("czmq.h")396
4517 y(int)h(main)f(\(void\))396 4614 y({)576 4711 y(zctx_t)889
4724 y(*)934 4711 y(context)g(=)h(zctx_new)e(\(\);)576
4808 y(void)800 4821 y(*)845 4808 y(frontend)g(=)i(zsocket_new)e
(\(context,)g(ZMQ_SUB\);)576 4906 y(zsocket_bind)f(\(frontend,)i
("tcp://)1967 4919 y(*)2012 4906 y(:5557"\);)576 5003
y(void)800 5016 y(*)845 5003 y(backend)f(=)i(zsocket_new)e(\(context,)g
(ZMQ_XPUB\);)576 5100 y(zsocket_bind)f(\(backend,)i("tcp://)1922
5113 y(*)1967 5100 y(:5558"\);)p Black 3756 5569 a Ff(317)p
Black eop end
%%Page: 318 331
TeXDict begin 318 330 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.318) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 576 170 a Fe(//)89 b(Subscribe)43 b(to)i(every)f(single)g(topic)g
(from)g(publisher)576 267 y(zsocket_set_subscribe)d(\(frontend,)i
(""\);)576 461 y(//)89 b(Store)44 b(last)g(instance)g(of)g(each)g
(topic)g(in)h(a)f(cache)576 558 y(zhash_t)934 571 y(*)979
558 y(cache)g(=)h(zhash_new)e(\(\);)-2 734 y
SDict begin H.S end
 -2 734 a
-2 734 a
SDict begin 13 H.A end
 -2 734 a -2 734 a
SDict begin [/View [/XYZ H.V]/Dest (0:3688) cvn /DEST pdfmark end
 -2 734 a 396 832 a Fk(W)-7
b(e)22 b(route)d(topic)h(updates)f(from)g(frontend)f(to)j(back)o(end,)d
(and)i(we)g(handle)f(subscriptions)g(by)h(sending)f(whate)n(v)o(er)g
(we)396 940 y(cached,)g(if)i(an)o(ything:)-2 958 y
SDict begin H.S end
 -2
958 a -2 958 a
SDict begin 13 H.A end
 -2 958 a -2 958 a
SDict begin [/View [/XYZ H.V]/Dest (0:lvcache-c-1) cvn /DEST pdfmark
end
 -2 958 a 396 1141 a
Fg(Example)g(5-70.)d(Last)j(V)-8 b(alue)21 b(Caching)f(Pr)o(oxy)e
(\(lvcache.c\))g(-)j(main)g(poll)f(loop)-2 1241 y
SDict begin H.S end
 -2
1241 a -2 1241 a
SDict begin 11.7 H.A end
 -2 1241 a -2 1241 a
SDict begin [/View [/XYZ H.V]/Dest (0:3691) cvn /DEST pdfmark end
 -2 1241 a 755 1419
a Fe(zmq_pollitem_t)42 b(items)i([])h(=)g({)934 1516
y({)g(frontend,)e(0,)i(ZMQ_POLLIN,)e(0)h(},)934 1613
y({)h(backend,)88 b(0,)45 b(ZMQ_POLLIN,)e(0)h(})755 1710
y(};)755 1807 y(if)g(\(zmq_poll)g(\(items,)f(2,)i(1000)2055
1820 y(*)2145 1807 y(ZMQ_POLL_MSEC\))d(==)j(-1\))934
1904 y(break;)627 b(//)89 b(Interrupted)755 2099 y(//)g(Any)45
b(new)f(topic)g(data)g(we)h(cache)f(and)g(then)g(forward)755
2196 y(if)g(\(items)g([0].revents)f(&)i(ZMQ_POLLIN\))e({)934
2293 y(char)1158 2306 y(*)1203 2293 y(topic)h(=)h(zstr_recv)e
(\(frontend\);)934 2390 y(char)1158 2403 y(*)1203 2390
y(current)h(=)h(zstr_recv)e(\(frontend\);)934 2487 y(if)i(\(!topic\))
1114 2584 y(break;)934 2681 y(char)1158 2694 y(*)1203
2681 y(previous)f(=)g(zhash_lookup)f(\(cache,)h(topic\);)934
2779 y(if)h(\(previous\))e({)1114 2876 y(zhash_delete)f(\(cache,)i
(topic\);)1114 2973 y(free)g(\(previous\);)934 3070 y(})934
3167 y(zhash_insert)f(\(cache,)h(topic,)g(current\);)934
3264 y(zstr_sendm)f(\(backend,)h(topic\);)934 3361 y(zstr_send)g
(\(backend,)f(current\);)934 3459 y(free)h(\(topic\);)755
3556 y(})-2 3730 y
SDict begin H.S end
 -2 3730 a -2 3730 a
SDict begin 13 H.A end
 -2 3730 a -2 3730
a
SDict begin [/View [/XYZ H.V]/Dest (0:3692) cvn /DEST pdfmark end
 -2 3730 a 396 3830 a Fk(When)20 b(we)h(get)f(a)h(ne)n(w)f
(subscription)e(we)j(pull)f(data)g(from)f(the)h(cache:)-2
3848 y
SDict begin H.S end
 -2 3848 a -2 3848 a
SDict begin 13 H.A end
 -2 3848 a -2 3848 a
SDict begin [/View [/XYZ H.V]/Dest (0:lvcache-c-2) cvn /DEST pdfmark
end
 -2 3848
a 396 4031 a Fg(Example)h(5-71.)d(Last)j(V)-8 b(alue)21
b(Caching)f(Pr)o(oxy)e(\(lvcache.c\))g(-)j(handle)g(subscriptions)-2
4131 y
SDict begin H.S end
 -2 4131 a -2 4131 a
SDict begin 11.7 H.A end
 -2 4131 a -2 4131 a
SDict begin [/View [/XYZ H.V]/Dest (0:3695) cvn /DEST pdfmark end
 -2 4131
a 934 4211 a Fe(zframe_t)1338 4224 y(*)1383 4211 y(frame)44
b(=)g(zframe_recv)f(\(backend\);)934 4308 y(if)i(\(!frame\))1114
4405 y(break;)934 4503 y(//)90 b(Event)44 b(is)g(one)g(byte)h(0=unsub)e
(or)i(1=sub,)f(followed)f(by)i(topic)934 4600 y(byte)1158
4613 y(*)1203 4600 y(event)f(=)h(zframe_data)e(\(frame\);)934
4697 y(if)i(\(event)f([0])g(==)g(1\))h({)1114 4794 y(char)1338
4807 y(*)1383 4794 y(topic)f(=)g(zmalloc)g(\(zframe_size)f
(\(frame\)\);)1114 4891 y(memcpy)g(\(topic,)h(event)g(+)h(1,)f
(zframe_size)f(\(frame\))h(-)h(1\);)1114 4988 y(printf)e(\("Sending)h
(cached)g(topic)g(\045s\\n",)f(topic\);)1114 5085 y(char)1338
5098 y(*)1383 5085 y(previous)g(=)i(zhash_lookup)e(\(cache,)g(topic\);)
p Black 3759 5569 a Ff(318)p Black eop end
%%Page: 319 332
TeXDict begin 319 331 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.319) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2550 -132 a Ff(Chapter)20 b(5.)g(Advanced)e(Publish-Subscribe)p
Black 1114 72 a Fe(if)44 b(\(previous\))f({)1293 170
y(zstr_sendm)g(\(backend,)g(topic\);)1293 267 y(zstr_send)g(\(backend,)
h(previous\);)1114 364 y(})1114 461 y(free)g(\(topic\);)934
558 y(})934 655 y(zframe_destroy)f(\(&frame\);)755 752
y(})576 850 y(})576 947 y(zctx_destroy)f(\(&context\);)576
1044 y(zhash_destroy)g(\(&cache\);)576 1141 y(return)h(0;)396
1238 y(})-2 1412 y
SDict begin H.S end
 -2 1412 a -2 1412 a
SDict begin 13 H.A end
 -2 1412 a -2 1412
a
SDict begin [/View [/XYZ H.V]/Dest (0:3696) cvn /DEST pdfmark end
 -2 1412 a 396 1512 a Fk(No)n(w)-5 b(,)20 b(run)f(the)h(proxy)-5
b(,)18 b(then)i(the)g(publisher:)-2 1613 y
SDict begin H.S end
 -2 1613 a
-2 1613 a
SDict begin 11.7 H.A end
 -2 1613 a -2 1613 a
SDict begin [/View [/XYZ H.V]/Dest (0:3697) cvn /DEST pdfmark end
 -2 1613 a 396 1692 a Fe(./lvcache)44
b(&)396 1789 y(./pathopub)f(tcp://localhost:5557)-2 1967
y
SDict begin H.S end
 -2 1967 a -2 1967 a
SDict begin 13 H.A end
 -2 1967 a -2 1967 a
SDict begin [/View [/XYZ H.V]/Dest (0:3698) cvn /DEST pdfmark end
 -2 1967 a 396
2063 a Fk(And)20 b(no)n(w)g(run)f(as)i(man)o(y)e(instances)h(of)g(the)g
(subscriber)f(as)i(you)e(w)o(ant)i(to)f(try)-5 b(,)19
b(each)h(time)h(connecting)d(to)i(the)g(proxy)396 2171
y(on)g(port)g(5558:)-2 2272 y
SDict begin H.S end
 -2 2272 a -2 2272 a
SDict begin 11.7 H.A end
 -2
2272 a -2 2272 a
SDict begin [/View [/XYZ H.V]/Dest (0:3699) cvn /DEST pdfmark end
 -2 2272 a 396 2351 a Fe(./pathosub)43
b(tcp://localhost:5558)-2 2529 y
SDict begin H.S end
 -2 2529 a -2 2529 a
SDict begin 13 H.A end

-2 2529 a -2 2529 a
SDict begin [/View [/XYZ H.V]/Dest (0:3700) cvn /DEST pdfmark end
 -2 2529 a 396 2625 a Fk(Each)20 b(subscriber)f
(happily)g(reports)g("Sa)n(v)o(e)h(Roger",)f(and)h(Roth)g(the)h
(Escaped)e(Con)m(vict)g(slinks)i(back)e(to)i(his)f(cell)h(for)396
2733 y(dinner)e(and)h(a)g(nice)g(cup)g(of)g(hot)g(milk,)g(which)f(is)i
(all)g(he)f(really)g(w)o(anted)g(an)o(yho)n(w)e(and)i(could)f(someone)g
(call)i(his)f(mum)396 2841 y(and)g(tell)h(her)f(his)g(clean)g(socks)g
(are)g(almost)h(all)f(up.)-2 3025 y
SDict begin H.S end
 -2 3025 a -2 3025
a
SDict begin 13 H.A end
 -2 3025 a -2 3025 a
SDict begin [/View [/XYZ H.V]/Dest (0:3701) cvn /DEST pdfmark end
 -2 3025 a 396 3115 a Fk(One)g(note:)g(the)g(XPUB)
i(sock)o(et)e(by)f(def)o(ault)h(does)g(not)g(report)f(duplicate)g
(subscriptions,)f(which)i(is)h(what)f(you)g(w)o(ant)396
3223 y(when)g(you')l(re)e(nai)n(v)o(ely)h(connecting)f(an)i(XPUB)h(to)g
(an)f(XSUB.)h(Our)f(e)o(xample)e(sneakily)i(gets)g(around)f(this)h(by)g
(using)396 3331 y(random)f(topics)h(so)g(the)h(chance)e(of)h(it)h(not)e
(w)o(orking)g(is)i(one)f(in)g(a)h(million.)e(In)h(a)h(real)f(L)-8
b(VC)20 b(proxy)f(you')o(ll)g(w)o(ant)h(to)h(use)396
3439 y(the)f(ZMQ_XPUB_VERBOSE)g(option)f(that)i(we)f(implement)f(in)h
(Chapter)g(7)g(as)h(an)f(e)o(x)o(ercise.)p Black 3759
5569 a Ff(319)p Black eop end
%%Page: 320 333
TeXDict begin 320 332 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.320) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:3702) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(6.)f(The)h(Human)h(Scale)2324
115 y
SDict begin H.S end
 2324 115 a 2324 115 a
SDict begin 26.957 H.A end
 2324 115 a 2324 115 a
SDict begin [/View [/XYZ H.V]/Dest (11.0) cvn /DEST pdfmark end
 2324
115 a -2 371 a
SDict begin H.S end
 -2 371 a -2 371 a
SDict begin 13 H.A end
 -2 371 a -2 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:3704) cvn /DEST pdfmark end
 -2
371 a 396 443 a Fk(If)20 b(you')l(v)o(e)e(survi)n(v)o(ed)h(the)h
(\002rst)h(\002)n(v)o(e)f(chapters,)f(congratulations.)e(It)k(w)o(as)g
(hard)e(for)h(for)f(me)h(too.)g(Happily)f(the)h(jok)o(es)396
551 y(and)g(the)g(code)g(mostly)f(write)i(themselv)o(es,)e(so)i(we')o
(ll)f(continue)f(with)h(our)g(journe)o(y)e(of)i(e)o(xploring)d(\330MQ.)
k(In)e(this)396 659 y(chapter)g(I'm)h(going)f(to)h(step)h(back)e(from)g
(the)i(nuts)f(and)f(bolts)i(of)f(\330MQ')-5 b(s)20 b(technical)g
(machinery)-5 b(,)17 b(and)j(look)f(more)h(at)396 767
y(ho)n(w)g(to)g(use)h(\330MQ)f(successfully)g(in)g(lar)o(ger)f
(projects.)-2 951 y
SDict begin H.S end
 -2 951 a -2 951 a
SDict begin 13 H.A end
 -2 951 a -2 951
a
SDict begin [/View [/XYZ H.V]/Dest (0:3705) cvn /DEST pdfmark end
 -2 951 a 396 1041 a Fk(W)-7 b(e')o(ll)22 b(co)o(v)o(er:)-2
1042 y
SDict begin H.S end
 -2 1042 a -2 1042 a
SDict begin 13 H.A end
 -2 1042 a -2 1042 a
SDict begin [/View [/XYZ H.V]/Dest (0:3706) cvn /DEST pdfmark end
 -2 1042
a -2 1052 a
SDict begin H.S end
 -2 1052 a -2 1052 a
SDict begin 13 H.A end
 -2 1052 a -2 1052 a
SDict begin [/View [/XYZ H.V]/Dest (0:3707) cvn /DEST pdfmark end
 -2
1052 a Black 396 1211 a Fj(\225)p Black 479 1211 a
SDict begin H.S end
 479
1211 a 479 1211 a
SDict begin 13 H.A end
 479 1211 a 479 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:3708) cvn /DEST pdfmark end
 479 1211 a Fk(What)f("softw)o
(are)f(architecture")e(is)j(really)f(about.)-2 1229 y
SDict begin H.S end

-2 1229 a -2 1229 a
SDict begin 13 H.A end
 -2 1229 a -2 1229 a
SDict begin [/View [/XYZ H.V]/Dest (0:3709) cvn /DEST pdfmark end
 -2 1229 a Black
396 1360 a Fj(\225)p Black 479 1360 a
SDict begin H.S end
 479 1360 a 479
1360 a
SDict begin 13 H.A end
 479 1360 a 479 1360 a
SDict begin [/View [/XYZ H.V]/Dest (0:3710) cvn /DEST pdfmark end
 479 1360 a Fk(The)g(Simplicity-Oriented)e
(Design)i(process)g(and)f(its)j(ugly)d(cousins)h(Cod)g(and)g(T)-7
b(od.)-2 1378 y
SDict begin H.S end
 -2 1378 a -2 1378 a
SDict begin 13 H.A end
 -2 1378 a -2 1378
a
SDict begin [/View [/XYZ H.V]/Dest (0:3711) cvn /DEST pdfmark end
 -2 1378 a Black 396 1510 a Fj(\225)p Black 479 1510
a
SDict begin H.S end
 479 1510 a 479 1510 a
SDict begin 13 H.A end
 479 1510 a 479 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:3712) cvn /DEST pdfmark end
 479 1510
a Fk(Ho)n(w)20 b(to)h(use)f(\330MQ)h(to)f(go)g(from)f(idea)h(to)g(w)o
(orking)f(prototype)f(safely)-5 b(.)-2 1528 y
SDict begin H.S end
 -2 1528
a -2 1528 a
SDict begin 13 H.A end
 -2 1528 a -2 1528 a
SDict begin [/View [/XYZ H.V]/Dest (0:3713) cvn /DEST pdfmark end
 -2 1528 a Black 396 1659
a Fj(\225)p Black 479 1659 a
SDict begin H.S end
 479 1659 a 479 1659 a
SDict begin 13 H.A end
 479
1659 a 479 1659 a
SDict begin [/View [/XYZ H.V]/Dest (0:3714) cvn /DEST pdfmark end
 479 1659 a Fk(Dif)n(ferent)19 b(w)o(ays)i(to)f
(serialize)g(your)f(data)h(as)h(\330MQ)g(messages.)-2
1677 y
SDict begin H.S end
 -2 1677 a -2 1677 a
SDict begin 13 H.A end
 -2 1677 a -2 1677 a
SDict begin [/View [/XYZ H.V]/Dest (0:3715) cvn /DEST pdfmark end
 -2 1677
a Black 396 1809 a Fj(\225)p Black 479 1809 a
SDict begin H.S end
 479 1809
a 479 1809 a
SDict begin 13 H.A end
 479 1809 a 479 1809 a
SDict begin [/View [/XYZ H.V]/Dest (0:3716) cvn /DEST pdfmark end
 479 1809 a Fk(Ho)n(w)f(to)h
(code-generate)c(binary)i(serialization)g(codecs.)-2
1826 y
SDict begin H.S end
 -2 1826 a -2 1826 a
SDict begin 13 H.A end
 -2 1826 a -2 1826 a
SDict begin [/View [/XYZ H.V]/Dest (0:3717) cvn /DEST pdfmark end
 -2 1826
a Black 396 1958 a Fj(\225)p Black 479 1958 a
SDict begin H.S end
 479 1958
a 479 1958 a
SDict begin 13 H.A end
 479 1958 a 479 1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:3718) cvn /DEST pdfmark end
 479 1958 a Fk(Ho)n(w)h(to)h(b)n
(uild)e(custom)h(code)g(generators.)-2 1976 y
SDict begin H.S end
 -2 1976
a -2 1976 a
SDict begin 13 H.A end
 -2 1976 a -2 1976 a
SDict begin [/View [/XYZ H.V]/Dest (0:3719) cvn /DEST pdfmark end
 -2 1976 a Black 396 2107
a Fj(\225)p Black 479 2107 a
SDict begin H.S end
 479 2107 a 479 2107 a
SDict begin 13 H.A end
 479
2107 a 479 2107 a
SDict begin [/View [/XYZ H.V]/Dest (0:3720) cvn /DEST pdfmark end
 479 2107 a Fk(Ho)n(w)g(to)h(write)f(and)g(license)g
(an)g(protocol)f(speci\002cation.)-2 2125 y
SDict begin H.S end
 -2 2125 a
-2 2125 a
SDict begin 13 H.A end
 -2 2125 a -2 2125 a
SDict begin [/View [/XYZ H.V]/Dest (0:3721) cvn /DEST pdfmark end
 -2 2125 a Black 396 2257
a Fj(\225)p Black 479 2257 a
SDict begin H.S end
 479 2257 a 479 2257 a
SDict begin 13 H.A end
 479
2257 a 479 2257 a
SDict begin [/View [/XYZ H.V]/Dest (0:3722) cvn /DEST pdfmark end
 479 2257 a Fk(Ho)n(w)h(to)h(do)e(f)o(ast)i
(restartable)f(\002le)h(transfer)e(o)o(v)o(er)g(\330MQ.)-2
2272 y
SDict begin H.S end
 -2 2272 a -2 2272 a
SDict begin 13 H.A end
 -2 2272 a -2 2272 a
SDict begin [/View [/XYZ H.V]/Dest (0:3723) cvn /DEST pdfmark end
 -2 2272
a Black 396 2406 a Fj(\225)p Black 479 2406 a
SDict begin H.S end
 479 2406
a 479 2406 a
SDict begin 13 H.A end
 479 2406 a 479 2406 a
SDict begin [/View [/XYZ H.V]/Dest (0:3724) cvn /DEST pdfmark end
 479 2406 a Fk(Ho)n(w)h(to)h(do)e
(credit-based)g(\003o)n(w)h(control.)-2 2407 y
SDict begin H.S end
 -2 2407
a -2 2407 a
SDict begin 13 H.A end
 -2 2407 a -2 2407 a
SDict begin [/View [/XYZ H.V]/Dest (0:3725) cvn /DEST pdfmark end
 -2 2407 a Black 396 2556
a Fj(\225)p Black 479 2556 a
SDict begin H.S end
 479 2556 a 479 2556 a
SDict begin 13 H.A end
 479
2556 a 479 2556 a
SDict begin [/View [/XYZ H.V]/Dest (0:3726) cvn /DEST pdfmark end
 479 2556 a Fk(Ho)n(w)g(to)h(do)e(heartbeating)g(for)g
(dif)n(ferent)g(\330MQ)h(patterns.)-2 2574 y
SDict begin H.S end
 -2 2574
a -2 2574 a
SDict begin 13 H.A end
 -2 2574 a -2 2574 a
SDict begin [/View [/XYZ H.V]/Dest (0:3727) cvn /DEST pdfmark end
 -2 2574 a Black 396 2705
a Fj(\225)p Black 479 2705 a
SDict begin H.S end
 479 2705 a 479 2705 a
SDict begin 13 H.A end
 479
2705 a 479 2705 a
SDict begin [/View [/XYZ H.V]/Dest (0:3728) cvn /DEST pdfmark end
 479 2705 a Fk(Ho)n(w)g(to)h(b)n(uild)e(protocol)g
(serv)o(ers)h(and)f(clients)i(as)g(state)g(machines.)-2
2723 y
SDict begin H.S end
 -2 2723 a -2 2723 a
SDict begin 13 H.A end
 -2 2723 a -2 2723 a
SDict begin [/View [/XYZ H.V]/Dest (0:3729) cvn /DEST pdfmark end
 -2 2723
a Black 396 2855 a Fj(\225)p Black 479 2855 a
SDict begin H.S end
 479 2855
a 479 2855 a
SDict begin 13 H.A end
 479 2855 a 479 2855 a
SDict begin [/View [/XYZ H.V]/Dest (0:3730) cvn /DEST pdfmark end
 479 2855 a Fk(Ho)n(w)f(to)h(mak)o(e)
e(a)i(secure)f(protocol)e(o)o(v)o(er)h(\330MQ)i(\(yay!\).)-2
2873 y
SDict begin H.S end
 -2 2873 a -2 2873 a
SDict begin 13 H.A end
 -2 2873 a -2 2873 a
SDict begin [/View [/XYZ H.V]/Dest (0:3731) cvn /DEST pdfmark end
 -2 2873
a Black 396 3004 a Fj(\225)p Black 479 3004 a
SDict begin H.S end
 479 3004
a 479 3004 a
SDict begin 13 H.A end
 479 3004 a 479 3004 a
SDict begin [/View [/XYZ H.V]/Dest (0:3732) cvn /DEST pdfmark end
 479 3004 a Fk(A)g(lar)o(ge-scale)e
(\002le)i(publishing)d(system)i(\(FileMQ\).)-2 3022 y
SDict begin H.S end

-2 3022 a -2 3022 a
SDict begin 13 H.A end
 -2 3022 a -2 3022 a
SDict begin [/View [/XYZ H.V]/Dest (0:3733) cvn /DEST pdfmark end
 -2 3022 a 359
x Fn(6.1.)39 b(The)g(T)-11 b(ale)38 b(of)i(T)-9 b(w)m(o)39
b(Bridg)q(es)1915 3381 y
SDict begin H.S end
 1915 3381 a 1915 3381 a
SDict begin 22.464 H.A end
 1915
3381 a 1915 3381 a
SDict begin [/View [/XYZ H.V]/Dest (11.75.1) cvn /DEST pdfmark end
 1915 3381 a -2 3579 a
SDict begin H.S end
 -2 3579 a -2
3579 a
SDict begin 13 H.A end
 -2 3579 a -2 3579 a
SDict begin [/View [/XYZ H.V]/Dest (0:3735) cvn /DEST pdfmark end
 -2 3579 a 396 3655 a Fk(T)-7
b(w)o(o)21 b(old)f(engineers)e(were)j(talking)e(of)h(their)g(li)n(v)o
(es)g(and)g(boasting)f(of)h(their)g(greatest)g(projects.)f(One)h(of)g
(the)g(engineers)396 3763 y(e)o(xplained)f(ho)n(w)g(he)h(had)g
(designed)f(one)h(of)f(the)i(greatest)f(bridges)f(e)n(v)o(er)g(made.)-2
3947 y
SDict begin H.S end
 -2 3947 a -2 3947 a
SDict begin 13 H.A end
 -2 3947 a -2 3947 a
SDict begin [/View [/XYZ H.V]/Dest (0:3736) cvn /DEST pdfmark end
 -2 3947
a 396 4037 a Fk("W)-7 b(e)21 b(b)n(uilt)g(it)g(across)f(a)h(ri)n(v)o
(er)e(gor)o(ge,")f(he)i(told)g(his)g(friend.)f("It)i(w)o(as)g(wide)f
(and)f(deep.)h(W)-7 b(e)21 b(spent)f(tw)o(o)g(years)g(studying)396
4145 y(the)g(land,)f(and)g(choosing)f(designs)h(and)g(materials.)h(W)-7
b(e)20 b(hired)f(the)h(best)g(engineers)e(and)h(designed)g(the)g
(bridge,)f(which)396 4253 y(took)i(another)e(\002)n(v)o(e)i(years.)g(W)
-7 b(e)21 b(contracted)e(the)h(lar)o(gest)g(engineering)d(\002rms)k(to)
f(b)n(uild)g(the)g(structures,)f(the)i(to)n(wers,)396
4361 y(the)f(tollbooths,)f(and)g(the)h(roads)f(that)h(w)o(ould)f
(connect)g(the)h(bridge)f(to)h(the)f(main)h(highw)o(ays.)f(Dozens)g
(died)g(during)g(the)396 4469 y(construction.)f(Under)h(the)i(road)e
(le)n(v)o(el)h(we)g(had)g(trains,)g(and)g(a)g(special)h(path)e(for)h(c)
o(yclists.)g(That)g(bridge)f(represented)396 4577 y(years)h(of)g(my)g
(life.")-2 4761 y
SDict begin H.S end
 -2 4761 a -2 4761 a
SDict begin 13 H.A end
 -2 4761 a -2 4761
a
SDict begin [/View [/XYZ H.V]/Dest (0:3737) cvn /DEST pdfmark end
 -2 4761 a 396 4851 a Fk(The)g(second)f(man)g(re\003ected)h(for)f(a)i
(while,)e(then)h(spok)o(e.)f("One)h(e)n(v)o(ening)e(me)i(and)f(a)i
(friend)d(got)i(drunk)e(on)i(v)n(odka,)e(and)396 4959
y(we)j(thre)n(w)f(a)g(rope)f(across)i(a)f(gor)o(ge,")e(he)i(said.)h
("Just)f(a)h(rope,)e(tied)h(to)h(tw)o(o)f(trees.)g(There)g(were)g(tw)o
(o)g(villages,)g(one)g(at)396 5067 y(each)g(side.)g(At)h(\002rst,)g
(people)e(pulled)g(packages)g(across)h(that)h(rope)e(with)h(a)h(pulle)o
(y)e(and)h(string.)f(Then)h(someone)f(thre)n(w)p Black
3759 5569 a Ff(320)p Black eop end
%%Page: 321 334
TeXDict begin 321 333 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.321) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(a)i(second)e(rope,)g(and)h(b)n(uilt)g(a)h(foot)e(w)o
(alk.)h(It)h(w)o(as)g(dangerous,)d(b)n(ut)i(the)g(kids)g(lo)o(v)o(ed)f
(it.)i(A)f(group)f(of)h(men)f(then)h(reb)n(uilt)396 180
y(that,)g(made)g(it)h(solid,)f(and)f(w)o(omen)h(started)g(to)g(cross,)g
(e)n(v)o(eryday)-5 b(,)17 b(with)k(their)f(produce.)e(A)i(mark)o(et)g
(gre)n(w)f(up)h(on)g(one)396 288 y(side)h(of)f(the)g(bridge,)f(and)g
(slo)n(wly)h(that)h(became)e(a)h(lar)o(ge)g(to)n(wn,)f(since)i(there)e
(w)o(as)i(a)g(lot)f(of)g(space)g(for)g(houses.)f(The)396
396 y(rope)h(bridge)e(got)i(replaced)f(with)i(a)f(w)o(ooden)f(bridge,)g
(to)h(allo)n(w)g(horses)g(and)g(carts)g(to)g(cross.)h(Then)e(the)h(to)n
(wn)g(b)n(uilt)g(a)396 504 y(real)g(stone)g(bridge,)f(with)h(metal)h
(beams.)e(Later)m(,)h(the)o(y)f(replaced)g(the)h(stone)g(part)g(with)h
(steel,)f(and)g(today)f(there')-5 b(s)20 b(a)396 612
y(suspension)f(bridge)g(standing)g(in)i(that)f(same)g(spot.")-2
796 y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:3738) cvn /DEST pdfmark end
 -2 796 a 396
886 a Fk(The)g(\002rst)h(engineer)e(w)o(as)i(silent.)f("Funn)o(y)f
(thing,")g(he)h(said,)g("my)g(bridge)f(w)o(as)i(demolished)d(about)i
(ten)g(years)g(after)396 994 y(we)h(b)n(uilt)f(it.)h(T)l(urns)f(out)f
(it)i(w)o(as)g(b)n(uilt)g(in)f(the)g(wrong)f(place)h(and)g(no-one)e(w)o
(anted)i(to)g(use)g(it.)h(Some)f(guys)g(had)f(thro)n(wn)396
1102 y(a)i(rope)e(across)h(the)h(gor)o(ge,)d(a)i(fe)n(w)g(miles)h
(further)e(do)n(wnstream,)f(and)i(that')-5 b(s)20 b(where)g(e)n(v)o
(eryone)e(went.")-2 1130 y
SDict begin H.S end
 -2 1130 a -2 1130 a
SDict begin 13 H.A end
 -2 1130
a -2 1130 a
SDict begin [/View [/XYZ H.V]/Dest (0:3739) cvn /DEST pdfmark end
 -2 1130 a 359 x Fn(6.2.)39 b(Code)f(on)i(the)f(Human)f
(Scale)2048 1489 y
SDict begin H.S end
 2048 1489 a 2048 1489 a
SDict begin 22.464 H.A end
 2048 1489
a 2048 1489 a
SDict begin [/View [/XYZ H.V]/Dest (11.76.1) cvn /DEST pdfmark end
 2048 1489 a -2 1657 a
SDict begin H.S end
 -2 1657 a -2 1657
a
SDict begin 13 H.A end
 -2 1657 a -2 1657 a
SDict begin [/View [/XYZ H.V]/Dest (0:3741) cvn /DEST pdfmark end
 -2 1657 a 396 1763 a Fk(T)-7 b(o)21
b(write)f(a)h(poem)e(that)h(captures)f(the)i(heart,)e(\002rst)i(learn)f
(the)g(language.)e(T)-7 b(o)21 b(use)f(\330MQ)g(successfully)g(at)h
(scale)f(you)396 1871 y(ha)n(v)o(e)g(to)g(learn)g(tw)o(o)g(languages.)f
(The)g(\002rst)i(is)g(\330MQ)g(itself.)f(This)h(tak)o(es)f(e)n(v)o(en)f
(the)h(best)h(of)f(us)g(time.)g(It')-5 b(s)21 b(a)g(truism)f(that)396
1979 y(if)h(you)e(try)h(to)g(port)g(an)g(old)g(architecture)e(onto)i
(\330MQ,)g(the)g(results)h(are)f(going)f(to)h(be)g(weird.)g(\330MQ')-5
b(s)21 b(language)d(is)396 2087 y(subtle)i(and)g(profound)d(and)j(when)
f(you)h(master)g(it)h(you)e(will)i(\002nd)f(yourself)f(remo)o(ving)e
(old)j(comple)o(xity)-5 b(,)18 b(not)396 2195 y(con)m(v)o(erting)g(it.)
-2 2379 y
SDict begin H.S end
 -2 2379 a -2 2379 a
SDict begin 13 H.A end
 -2 2379 a -2 2379 a
SDict begin [/View [/XYZ H.V]/Dest (0:3742) cvn /DEST pdfmark end
 -2
2379 a 396 2469 a Fk(Ho)n(we)n(v)o(er)h(the)h(real)g(challenge)f(of)h
(using)g(\330MQ)g(is)h(that)g(old)e(barriers)h(f)o(all)g(a)o(w)o(ay)-5
b(,)20 b(and)f(the)h(size)h(of)f(the)g(projects)g(you)396
2577 y(can)g(do)g(increases)g(hugely)-5 b(.)18 b(Non-distrib)n(uted)g
(code)i(is)h(often)e(a)i(single-person)d(project.)h(Y)-9
b(ou)19 b(can)h(w)o(ork)g(in)g(your)396 2685 y(corner)m(,)e(perhaps)h
(for)h(years,)g(lik)o(e)g(an)g(author)f(on)h(a)h(book.)d(It')-5
b(s)21 b(all)g(about)e(concentration.)e(But)k(distrib)n(uted)e(code)h
(is)396 2793 y(dif)n(ferent.)f(T)-7 b(o)20 b(quote)f(my)h(f)o(a)n(v)n
(orite)g(author)m(,)e(it)j("has)f(to)h(talk)f(to)g(code,)g(has)g(to)g
(be)g(chatty)-5 b(,)19 b(sociable,)h(well-connected".)-2
2977 y
SDict begin H.S end
 -2 2977 a -2 2977 a
SDict begin 13 H.A end
 -2 2977 a -2 2977 a
SDict begin [/View [/XYZ H.V]/Dest (0:3743) cvn /DEST pdfmark end
 -2 2977
a 396 3067 a Fk(Writing)g(distrib)n(uted)g(code)f(is)i(lik)o(e)g
(playing)d(li)n(v)o(e)i(music:)h(it')-5 b(s)21 b(all)g(about)e(other)g
(people.)g(Concentration)f(is)j(w)o(orthless)396 3175
y(if)g(you)e(can')o(t)g(listen.)i(No-one)d(enjo)o(ys)i(listening)g(to)g
(an)g(amazingly)f(pro\002cient)g(musician)g(who')-5 b(s)21
b(out)e(of)h(time)h(with)396 3283 y(the)f(rest)h(of)f(the)g(group)f
(and)g(can')o(t)h(read)f(the)h(mood)f(of)h(the)g(audience.)f(A)i(li)n
(v)o(e)f(jam)g(is)h(entrancing)d(not)i(because)g(of)f(the)396
3391 y(technical)h(quality)f(b)n(ut)h(because)g(of)g(the)g(real-time)f
(creati)n(v)o(e)h(ener)o(gy)-5 b(.)-2 3575 y
SDict begin H.S end
 -2 3575
a -2 3575 a
SDict begin 13 H.A end
 -2 3575 a -2 3575 a
SDict begin [/View [/XYZ H.V]/Dest (0:3744) cvn /DEST pdfmark end
 -2 3575 a 396 3665 a
Fk(And)20 b(so)h(it)f(goes)g(with)h(distrib)n(uted)e(code.)g(Real-time)
h(creati)n(v)o(e)g(ener)o(gy)e(is)j(what)f(wins,)g(not)g(pure)g
(technical)f(quality)-5 b(,)396 3773 y(and)20 b(certainly)f(not)h
(technical)f(quality)h(combined)e(with)i(inability)g(to)g(w)o(ork)g
(with)g(others.)-2 3957 y
SDict begin H.S end
 -2 3957 a -2 3957 a
SDict begin 13 H.A end
 -2 3957
a -2 3957 a
SDict begin [/View [/XYZ H.V]/Dest (0:3745) cvn /DEST pdfmark end
 -2 3957 a 396 4047 a Fk(All)h(this)g(is)g(\002ne)f(in)h
(theory)-5 b(.)18 b(Here)i(comes)g(the)g(catch:)g(w)o(orking)f(with)h
(other)f(people)g(is)2950 4047 y
SDict begin H.S end
 2950 4047 a 2950 4047
a
SDict begin 13 H.A end
 2950 4047 a 2950 4047 a
SDict begin [/View [/XYZ H.V]/Dest (0:3746) cvn /DEST pdfmark end
 2950 4047 a Ff(plain)g(har)m(d)r
Fk(.)h(W)-7 b(e)21 b(can)f(e)o(xpect)f(a)396 4154 y(musician)h(to)g(be)
g(naturally)f(social.)h(But)h(softw)o(are)f(de)n(v)o(elopers?)e(W)-7
b(e')l(re)20 b(the)g(v)o(ery)f(caricature)g(of)h(anti-social)396
4262 y(tunnel-visioned)e(hermits.)h(Other)h(people)f(are)h(hard)f(w)o
(ork.)h(The)o(y')l(re)e(slo)n(w)-5 b(,)20 b(the)o(y)f(mak)o(e)h(mistak)
o(es,)g(the)o(y)g(ask)g(too)396 4370 y(man)o(y)f(questions,)g(the)o(y)h
(don')o(t)e(respect)i(our)g(code,)f(the)o(y)g(mak)o(e)h(wrong)f
(assumptions,)g(the)o(y)h(ar)o(gue.)-2 4554 y
SDict begin H.S end
 -2 4554
a -2 4554 a
SDict begin 13 H.A end
 -2 4554 a -2 4554 a
SDict begin [/View [/XYZ H.V]/Dest (0:3747) cvn /DEST pdfmark end
 -2 4554 a 396 4644 a
Fk(My)g(response)g(isn')o(t)f(v)o(ery)g(sympathetic.)g(T)-7
b(o)21 b(succeed)e(in)h(the)h(softw)o(are)e(industry)g(as)i(it)g(turns)
f(into)g(something)f(more)396 4752 y(lik)o(e)i(a)f(ne)n(v)o(er)n
(-ending)d(li)n(v)o(e)j(jam,)g(we)h(ha)n(v)o(e)e(to)i(learn)e(to)i(put)
f(a)o(w)o(ay)f(our)h(e)o(gos,)f(w)o(ork)h(successfully)f(with)i
(others,)e(w)o(orry)396 4860 y(less)j(about)d(our)g(o)n(wn)h(skills)h
(and)f(look)f(more)g(at)i(others,)e(put)h(a)o(w)o(ay)g(our)g(natural)f
(insolence)g(and)h(attitude,)f(and)h(to)396 4968 y(learn)g(to)g(lik)o
(e)h(and)e(trust)i(other)e(people.)p Black 3759 5569
a Ff(321)p Black eop end
%%Page: 322 335
TeXDict begin 322 334 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.322) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3748) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(So)i(this)f(is)i(what)e(this)g(chapter)f(is)j(really)
d(about:)h(writing)f(code)h(at)h(scale)f(by)g(understanding)d(ourselv)o
(es)i(much)g(better)-5 b(.)396 180 y(Of)21 b(course)e(these)h(lessons)h
(apply)e(to)i(all)f(lar)o(ge-scale)f(applications.)g(Using)h(\330MQ)g
(we)h(just)g(hit)f(the)g(problem)f(sooner)396 288 y(than)h(we')l(d)g(e)
o(xpect.)-2 317 y
SDict begin H.S end
 -2 317 a -2 317 a
SDict begin 13 H.A end
 -2 317 a -2 317 a
SDict begin [/View [/XYZ H.V]/Dest (0:3749) cvn /DEST pdfmark end

-2 317 a 359 x Fn(6.3.)39 b(Psyc)o(hology)e(of)i(Software)f(De)n
(velopment)2844 676 y
SDict begin H.S end
 2844 676 a 2844 676 a
SDict begin 22.464 H.A end
 2844 676
a 2844 676 a
SDict begin [/View [/XYZ H.V]/Dest (11.77.1) cvn /DEST pdfmark end
 2844 676 a -2 874 a
SDict begin H.S end
 -2 874 a -2 874 a
SDict begin 13 H.A end
 -2
874 a -2 874 a
SDict begin [/View [/XYZ H.V]/Dest (0:3751) cvn /DEST pdfmark end
 -2 874 a 396 950 a Fk(Dirkjan)20 b(Ochtman)f(pointed)g
(me)h(to)1473 950 y
SDict begin H.S end
 1473 950 a 1473 950 a
SDict begin 13 H.A end
 1473 950 a
1473 950 a
SDict begin [/View [/XYZ H.V]/Dest (0:3752) cvn /DEST pdfmark end
 1473 950 a Fk(W)m(ikipedia')-5 b(s)20 b(de\002nition)f(of)h
(Softw)o(are)f(Architecture)396 1058 y(\(http://en.wikipedia.or)o
(g/wiki/Softw)o(are)o(_ar)o(chitectu)o(re\))14 b(as)21
b("the)f(set)h(of)f(structures)g(needed)f(to)h(reason)f(about)h(the)396
1166 y(system,)g(which)g(comprise)f(softw)o(are)h(elements,)g
(relations)f(among)g(them,)h(and)f(properties)g(of)h(both".)f(F)o(or)h
(me)g(this)396 1274 y(v)n(apid)f(and)h(circular)f(jar)o(gon)g(is)i(a)f
(good)f(e)o(xample)g(of)h(ho)n(w)g(miserably)f(little)i(we)f
(understand)e(about)i(what)g(actually)396 1382 y(mak)o(es)g(a)h
(successful)f(lar)o(ge)f(scale)i(softw)o(are)f(architecture.)-2
1566 y
SDict begin H.S end
 -2 1566 a -2 1566 a
SDict begin 13 H.A end
 -2 1566 a -2 1566 a
SDict begin [/View [/XYZ H.V]/Dest (0:3753) cvn /DEST pdfmark end
 -2 1566
a 396 1655 a Fk(Architecture)e(is)j(the)e(art)h(and)e(science)i(of)f
(making)f(lar)o(ge)g(arti\002cial)i(structures)f(for)g(human)f(use.)h
(If)g(there)g(is)i(one)d(thing)396 1763 y(I')l(v)o(e)h(learned)g(and)h
(applied)f(successfully)h(in)g(30)g(years)g(of)g(making)f(lar)o(ger)f
(and)i(lar)o(ger)f(softw)o(are)h(systems)g(it)h(is)g(this:)396
1871 y(softw)o(are)f(is)h(about)e(people.)g(Lar)o(ge)g(structures)h(in)
g(themselv)o(es)f(are)i(meaningless.)e(It')-5 b(s)20
b(ho)n(w)g(the)o(y)g(function)e(for)396 1979 y
SDict begin H.S end
 396 1979
a 396 1979 a
SDict begin 13 H.A end
 396 1979 a 396 1979 a
SDict begin [/View [/XYZ H.V]/Dest (0:3754) cvn /DEST pdfmark end
 396 1979 a Ff(human)h(use)h
Fk(that)h(matters.)f(And)f(in)i(softw)o(are,)e(human)g(use)h(starts)h
(with)g(the)f(programmers)d(who)j(mak)o(e)g(the)g(softw)o(are)396
2087 y(itself.)-2 2254 y
SDict begin H.S end
 -2 2254 a -2 2254 a
SDict begin 13 H.A end
 -2 2254
a -2 2254 a
SDict begin [/View [/XYZ H.V]/Dest (0:3755) cvn /DEST pdfmark end
 -2 2254 a 396 2361 a Fk(The)g(core)g(problems)f(in)h(softw)
o(are)g(architecture)e(are)i(dri)n(v)o(en)f(by)h(human)e(psychology)-5
b(,)17 b(not)j(technology)-5 b(.)17 b(There)j(are)396
2469 y(man)o(y)f(w)o(ays)i(our)e(psychology)f(af)n(fects)i(our)f(w)o
(ork.)g(I)i(could)e(point)g(to)i(the)f(w)o(ay)g(teams)h(seem)f(to)g
(get)h(stupider)e(as)i(the)o(y)396 2577 y(get)f(lar)o(ger)m(,)f(or)h
(ha)n(v)o(e)f(to)i(w)o(ork)e(across)h(lar)o(ger)f(distances.)h(Does)g
(that)h(mean)e(the)i(smaller)f(the)g(team,)g(the)g(more)396
2685 y(ef)n(fecti)n(v)o(e?)f(Ho)n(w)h(then)g(does)g(a)g(lar)o(ge)f
(global)h(community)e(lik)o(e)i(\330MQ)h(manage)e(to)h(w)o(ork)f
(successfully?)-2 2869 y
SDict begin H.S end
 -2 2869 a -2 2869 a
SDict begin 13 H.A end
 -2 2869
a -2 2869 a
SDict begin [/View [/XYZ H.V]/Dest (0:3756) cvn /DEST pdfmark end
 -2 2869 a 396 2959 a Fk(The)h(\330MQ)h(community)d(w)o
(asn')o(t)h(accidental,)g(it)i(w)o(as)g(a)g(deliberate)e(design,)g(my)h
(contrib)n(ution)e(to)j(the)f(early)f(days)396 3067 y(when)h(the)g
(code)g(came)f(out)h(of)g(a)h(cellar)f(in)g(Bratisla)n(v)n(a.)h(The)f
(design)f(w)o(as)i(based)f(on)g(my)g(pet)g(science)g(of)g("Social)396
3175 y(Architecture",)f(which)1110 3175 y
SDict begin H.S end
 1110 3175 a
1110 3175 a
SDict begin 13 H.A end
 1110 3175 a 1110 3175 a
SDict begin [/View [/XYZ H.V]/Dest (0:3757) cvn /DEST pdfmark end
 1110 3175 a Fk(W)m(ikipedia)h
(de\002nes)g(\(http://en.wikipedia.or)o(g/wiki/So)o(cial_ar)o(chitectu)
o(re\))14 b(\(what)20 b(a)396 3283 y(coincidence!\))e(as)j("the)f
(process,)f(and)h(the)g(product,)e(of)i(planning,)e(designing,)h(and)g
(gro)n(wing)g(an)h(on-line)396 3391 y(community)-5 b(.")-2
3575 y
SDict begin H.S end
 -2 3575 a -2 3575 a
SDict begin 13 H.A end
 -2 3575 a -2 3575 a
SDict begin [/View [/XYZ H.V]/Dest (0:3758) cvn /DEST pdfmark end
 -2 3575
a 396 3665 a Fk(One)20 b(of)g(the)g(tenets)g(of)g(Social)g
(Architecture)f(is)i(that)1956 3665 y
SDict begin H.S end
 1956 3665 a 1956
3665 a
SDict begin 13 H.A end
 1956 3665 a 1956 3665 a
SDict begin [/View [/XYZ H.V]/Dest (0:3759) cvn /DEST pdfmark end
 1956 3665 a Ff(how)f(we)h(or)m(ganize)e
Fk(is)i(more)e(signi\002cant)h(than)3333 3665 y
SDict begin H.S end
 3333
3665 a 3333 3665 a
SDict begin 13 H.A end
 3333 3665 a 3333 3665 a
SDict begin [/View [/XYZ H.V]/Dest (0:3760) cvn /DEST pdfmark end
 3333 3665
a Ff(who)g(we)h(ar)m(e)p Fk(.)f(The)396 3773 y(same)h(group,)d(or)o
(ganized)f(dif)n(ferently)-5 b(,)17 b(can)j(produce)f(entirely)g
(opposite)g(results.)h(W)-7 b(e)22 b(are)e(lik)o(e)g(peers)g(in)h(a)f
(\330MQ)396 3880 y(netw)o(ork,)f(and)h(our)f(communication)e(patterns)j
(ha)n(v)o(e)g(dramatic)f(impact)h(on)f(our)h(performance.)d(Ordinary)h
(people,)396 3988 y(well)j(connected,)d(can)i(f)o(ar)g(outperform)d(a)k
(team)f(of)g(e)o(xperts)f(w)o(orking)g(in)h(the)h(wrong)d(patterns.)i
(If)g(you')l(re)e(the)396 4096 y(architect)i(of)g(a)g(lar)o(ger)f
(\330MQ)i(application,)d(you')l(re)g(going)h(to)i(ha)n(v)o(e)e(to)i
(help)e(others)h(\002nd)g(the)g(right)g(patterns)f(for)396
4204 y(w)o(orking)g(together)-5 b(.)19 b(Do)h(this)h(right,)e(and)h
(your)f(project)g(can)h(succeed.)f(Do)i(it)f(wrong,)f(and)h(your)f
(project)g(will)i(f)o(ail.)-2 4388 y
SDict begin H.S end
 -2 4388 a -2 4388
a
SDict begin 13 H.A end
 -2 4388 a -2 4388 a
SDict begin [/View [/XYZ H.V]/Dest (0:3761) cvn /DEST pdfmark end
 -2 4388 a 396 4478 a Fk(The)f(tw)o(o)h(most)f
(important)e(psychological)g(elements)i(are)g(IMO)h(that)f(we')l(re)f
(really)h(bad)g(at)h(understanding)396 4586 y(comple)o(xity)-5
b(,)18 b(and)h(that)i(we)f(are)g(so)h(good)e(at)h(w)o(orking)f
(together)g(to)h(di)n(vide)f(and)h(conquer)e(lar)o(ge)h(problems.)g(W)
-7 b(e')l(re)396 4694 y(highly)19 b(social)i(apes,)f(and)f(kind)h(of)g
(smart,)g(b)n(ut)g(only)f(in)i(the)f(right)f(kind)h(of)g(cro)n(wd.)-2
4878 y
SDict begin H.S end
 -2 4878 a -2 4878 a
SDict begin 13 H.A end
 -2 4878 a -2 4878 a
SDict begin [/View [/XYZ H.V]/Dest (0:3762) cvn /DEST pdfmark end
 -2 4878
a 396 4968 a Fk(So)h(here)e(is)i(my)f(short)g(list)h(of)f(the)h
(Psychological)d(Elements)i(of)g(Softw)o(are)f(Architecture:)-2
4986 y
SDict begin H.S end
 -2 4986 a -2 4986 a
SDict begin 13 H.A end
 -2 4986 a -2 4986 a
SDict begin [/View [/XYZ H.V]/Dest (0:3763) cvn /DEST pdfmark end
 -2 4986
a -2 4996 a
SDict begin H.S end
 -2 4996 a -2 4996 a
SDict begin 13 H.A end
 -2 4996 a -2 4996 a
SDict begin [/View [/XYZ H.V]/Dest (0:3764) cvn /DEST pdfmark end
 -2
4996 a Black 3759 5569 a Ff(322)p Black eop end
%%Page: 323 336
TeXDict begin 323 335 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.323) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3765) cvn /DEST pdfmark end
 479 72 a 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3766) cvn /DEST pdfmark end
 479 72 a Fg(Stupidity)p
Fk(:)i(our)e(mental)h(bandwidth)e(is)j(limited,)f(so)h(we')l(re)e(all)i
(stupid)f(at)g(some)g(point.)g(The)f(architecture)g(has)i(to)479
180 y(be)f(simple)h(to)f(understand.)e(This)i(is)h(the)f(number)f(one)g
(rule:)h(simplicity)g(beats)h(functionality)-5 b(,)17
b(e)n(v)o(ery)i(single)h(time.)479 288 y(If)g(you)g(can')o(t)f
(understand)f(an)i(architecture)f(on)g(a)i(cold)f(gray)f(Monday)g
(morning)f(before)g(cof)n(fee,)h(it)i(is)g(too)479 396
y(comple)o(x.)-2 414 y
SDict begin H.S end
 -2 414 a -2 414 a
SDict begin 13 H.A end
 -2 414 a -2
414 a
SDict begin [/View [/XYZ H.V]/Dest (0:3767) cvn /DEST pdfmark end
 -2 414 a Black 396 546 a Fj(\225)p Black 479 546
a
SDict begin H.S end
 479 546 a 479 546 a
SDict begin 13 H.A end
 479 546 a 479 546 a
SDict begin [/View [/XYZ H.V]/Dest (0:3768) cvn /DEST pdfmark end
 479 546 a 479
546 a
SDict begin H.S end
 479 546 a 479 546 a
SDict begin 13 H.A end
 479 546 a 479 546 a
SDict begin [/View [/XYZ H.V]/Dest (0:3769) cvn /DEST pdfmark end
 479 546
a Fg(Sel\002shness)p Fk(:)h(we)f(act)g(only)e(out)h(of)g
(self-interest,)f(so)i(the)f(architecture)f(must)h(create)g(space)g
(and)f(opportunity)f(for)479 654 y(sel\002sh)j(acts)f(that)g(bene\002t)
g(the)g(whole.)f(Sel\002shness)h(is)h(often)e(indirect)g(and)g(subtle.)
h(F)o(or)f(e)o(xample)g(I')o(ll)h(spend)f(hours)479 762
y(helping)g(someone)g(else)i(understand)d(something)h(because)g(that)h
(could)g(be)g(w)o(orth)f(days)h(to)h(me)f(later)-5 b(.)-2
780 y
SDict begin H.S end
 -2 780 a -2 780 a
SDict begin 13 H.A end
 -2 780 a -2 780 a
SDict begin [/View [/XYZ H.V]/Dest (0:3770) cvn /DEST pdfmark end
 -2 780 a Black
396 911 a Fj(\225)p Black 479 911 a
SDict begin H.S end
 479 911 a 479 911
a
SDict begin 13 H.A end
 479 911 a 479 911 a
SDict begin [/View [/XYZ H.V]/Dest (0:3771) cvn /DEST pdfmark end
 479 911 a 479 911 a
SDict begin H.S end
 479 911 a 479
911 a
SDict begin 13 H.A end
 479 911 a 479 911 a
SDict begin [/View [/XYZ H.V]/Dest (0:3772) cvn /DEST pdfmark end
 479 911 a Fg(Laziness)p Fk(:)22
b(we)e(mak)o(e)g(lots)h(of)e(assumptions,)h(man)o(y)f(of)g(which)h(are)
g(wrong.)f(W)-7 b(e)21 b(are)f(happiest)g(when)f(we)i(can)479
1019 y(spend)f(the)g(least)h(ef)n(fort)e(to)h(get)g(a)h(result,)f(to)g
(test)i(an)e(assumption)f(quickly)-5 b(,)18 b(so)i(the)h(architecture)d
(has)j(to)f(mak)o(e)g(this)479 1127 y(possible.)g(Speci\002cally)-5
b(,)19 b(that)h(means)g(it)h(must)f(be)h(simple.)-2 1145
y
SDict begin H.S end
 -2 1145 a -2 1145 a
SDict begin 13 H.A end
 -2 1145 a -2 1145 a
SDict begin [/View [/XYZ H.V]/Dest (0:3773) cvn /DEST pdfmark end
 -2 1145 a Black
396 1276 a Fj(\225)p Black 479 1276 a
SDict begin H.S end
 479 1276 a 479
1276 a
SDict begin 13 H.A end
 479 1276 a 479 1276 a
SDict begin [/View [/XYZ H.V]/Dest (0:3774) cvn /DEST pdfmark end
 479 1276 a 479 1276 a
SDict begin H.S end
 479
1276 a 479 1276 a
SDict begin 13 H.A end
 479 1276 a 479 1276 a
SDict begin [/View [/XYZ H.V]/Dest (0:3775) cvn /DEST pdfmark end
 479 1276 a Fg(J)o(ealousy)p
Fk(:)e(we')l(re)h(jealous)g(of)g(others,)f(which)h(means)g(we')o(ll)g
(o)o(v)o(ercome)e(our)h(stupidity)h(and)f(laziness)i(to)f(pro)o(v)o(e)
479 1384 y(others)g(wrong,)f(and)g(beat)h(them)g(in)g(competition.)f
(The)g(architecture)g(thus)h(has)h(to)f(create)g(space)g(for)g(public)
479 1492 y(competition)f(based)h(on)f(f)o(air)h(rules)h(that)f(an)o
(yone)e(can)i(understand.)-2 1510 y
SDict begin H.S end
 -2 1510 a -2 1510
a
SDict begin 13 H.A end
 -2 1510 a -2 1510 a
SDict begin [/View [/XYZ H.V]/Dest (0:3776) cvn /DEST pdfmark end
 -2 1510 a Black 396 1642 a Fj(\225)p
Black 479 1642 a
SDict begin H.S end
 479 1642 a 479 1642 a
SDict begin 13 H.A end
 479 1642 a 479
1642 a
SDict begin [/View [/XYZ H.V]/Dest (0:3777) cvn /DEST pdfmark end
 479 1642 a 479 1642 a
SDict begin H.S end
 479 1642 a 479 1642 a
SDict begin 13 H.A end
 479
1642 a 479 1642 a
SDict begin [/View [/XYZ H.V]/Dest (0:3778) cvn /DEST pdfmark end
 479 1642 a Fg(Recipr)o(ocity)p Fk(:)f(we')o(ll)i(pay)
e(e)o(xtra)h(in)g(terms)g(of)g(hard)f(w)o(ork,)h(e)n(v)o(en)f(mone)o(y)
-5 b(,)18 b(to)i(punish)f(cheats)h(and)g(enforce)f(f)o(air)479
1750 y(rules.)h(The)g(architecture)f(should)g(be)h(hea)n(vily)f
(rule-based,)g(telling)h(people)f(ho)n(w)g(to)i(w)o(ork)e(together)m(,)
g(b)n(ut)h(not)g(what)479 1857 y(to)h(w)o(ork)e(on.)-2
1858 y
SDict begin H.S end
 -2 1858 a -2 1858 a
SDict begin 13 H.A end
 -2 1858 a -2 1858 a
SDict begin [/View [/XYZ H.V]/Dest (0:3779) cvn /DEST pdfmark end
 -2 1858
a Black 396 2007 a Fj(\225)p Black 479 2007 a
SDict begin H.S end
 479 2007
a 479 2007 a
SDict begin 13 H.A end
 479 2007 a 479 2007 a
SDict begin [/View [/XYZ H.V]/Dest (0:3780) cvn /DEST pdfmark end
 479 2007 a 479 2007
a
SDict begin H.S end
 479 2007 a 479 2007 a
SDict begin 13 H.A end
 479 2007 a 479 2007 a
SDict begin [/View [/XYZ H.V]/Dest (0:3781) cvn /DEST pdfmark end
 479 2007
a Fg(Pride)p Fk(:)i(we')l(re)e(intensely)h(a)o(w)o(are)g(of)g(our)f
(social)i(status,)f(and)g(we')o(ll)g(w)o(ork)g(hard)f(to)i(a)n(v)n(oid)
e(looking)g(stupid)h(or)479 2115 y(incompetent)e(in)j(public.)e(The)h
(architecture)e(has)j(to)f(mak)o(e)g(sure)g(e)n(v)o(ery)f(piece)h(we)g
(mak)o(e)g(has)g(our)g(name)f(on)h(it,)h(so)479 2223
y(we')o(ll)g(ha)n(v)o(e)e(sleepless)i(nights)f(stressing)g(about)g
(what)g(others)f(will)i(say)g(about)e(our)g(w)o(ork.)-2
2241 y
SDict begin H.S end
 -2 2241 a -2 2241 a
SDict begin 13 H.A end
 -2 2241 a -2 2241 a
SDict begin [/View [/XYZ H.V]/Dest (0:3782) cvn /DEST pdfmark end
 -2 2241
a Black 396 2372 a Fj(\225)p Black 479 2372 a
SDict begin H.S end
 479 2372
a 479 2372 a
SDict begin 13 H.A end
 479 2372 a 479 2372 a
SDict begin [/View [/XYZ H.V]/Dest (0:3783) cvn /DEST pdfmark end
 479 2372 a 479 2372
a
SDict begin H.S end
 479 2372 a 479 2372 a
SDict begin 13 H.A end
 479 2372 a 479 2372 a
SDict begin [/View [/XYZ H.V]/Dest (0:3784) cvn /DEST pdfmark end
 479 2372
a Fg(Gr)o(eed)p Fk(:)h(we')l(re)g(ultimately)f(economic)g(animals)h
(\(see)g(sel\002shness\),)g(so)h(the)f(architecture)f(has)h(to)g(gi)n
(v)o(e)g(us)479 2480 y(economic)f(incenti)n(v)o(e)g(to)h(in)m(v)o(est)f
(in)i(making)e(it)i(happen.)d(Maybe)h(it')-5 b(s)21 b(polishing)e(our)h
(reputation)e(as)j(e)o(xperts,)479 2588 y(maybe)e(it')-5
b(s)21 b(literally)f(making)f(mone)o(y)f(from)h(some)h(skill)h(or)f
(component.)d(It)j(doesn')o(t)f(matter)h(what)g(it)g(is,)h(b)n(ut)f
(there)479 2696 y(must)h(be)f(economic)e(incenti)n(v)o(e.)h(Think)g(of)
h(architecture)e(as)j(a)g(mark)o(et)e(place,)h(not)g(an)g(engineering)e
(design.)-2 2714 y
SDict begin H.S end
 -2 2714 a -2 2714 a
SDict begin 13 H.A end
 -2 2714 a -2 2714
a
SDict begin [/View [/XYZ H.V]/Dest (0:3785) cvn /DEST pdfmark end
 -2 2714 a Black 396 2845 a Fj(\225)p Black 479 2845
a
SDict begin H.S end
 479 2845 a 479 2845 a
SDict begin 13 H.A end
 479 2845 a 479 2845 a
SDict begin [/View [/XYZ H.V]/Dest (0:3786) cvn /DEST pdfmark end
 479 2845
a 479 2845 a
SDict begin H.S end
 479 2845 a 479 2845 a
SDict begin 13 H.A end
 479 2845 a 479 2845
a
SDict begin [/View [/XYZ H.V]/Dest (0:3787) cvn /DEST pdfmark end
 479 2845 a Fg(Conf)n(ormity)p Fk(:)h(we')l(re)h(happiest)f(to)h
(conform,)e(out)i(of)g(fear)g(and)f(laziness,)i(so)f(the)h
(architecture)d(should)h(be)479 2953 y(strongly)g(rule-based,)f(and)i
(rules)g(should)f(be)i(clear)m(,)e(accurate,)g(well-documented,)e(and)j
(enforced.)-2 2971 y
SDict begin H.S end
 -2 2971 a -2 2971 a
SDict begin 13 H.A end
 -2 2971 a -2
2971 a
SDict begin [/View [/XYZ H.V]/Dest (0:3788) cvn /DEST pdfmark end
 -2 2971 a Black 396 3103 a Fj(\225)p Black 479
3103 a
SDict begin H.S end
 479 3103 a 479 3103 a
SDict begin 13 H.A end
 479 3103 a 479 3103 a
SDict begin [/View [/XYZ H.V]/Dest (0:3789) cvn /DEST pdfmark end
 479
3103 a 479 3103 a
SDict begin H.S end
 479 3103 a 479 3103 a
SDict begin 13 H.A end
 479 3103 a 479
3103 a
SDict begin [/View [/XYZ H.V]/Dest (0:3790) cvn /DEST pdfmark end
 479 3103 a Fg(F)n(ear)p Fk(:)g(we')l(re)g(unwilling)f(to)h(tak)o
(e)g(risks,)h(especially)e(if)i(it)g(mak)o(es)f(us)g(look)g(stupid.)f
(Fear)h(of)g(f)o(ailure)g(is)h(a)g(major)479 3211 y(reason)f(people)f
(conform)f(and)h(follo)n(w)h(the)g(group)f(in)h(mass)h(stupidity)-5
b(.)19 b(The)g(architecture)g(should)g(mak)o(e)h(silent)479
3319 y(e)o(xperimentation)d(easy)k(and)e(cheap,)g(gi)n(ving)g(people)g
(opportunity)f(for)h(success)i(without)e(punishing)g(f)o(ailure.)-2
3503 y
SDict begin H.S end
 -2 3503 a -2 3503 a
SDict begin 13 H.A end
 -2 3503 a -2 3503 a
SDict begin [/View [/XYZ H.V]/Dest (0:3791) cvn /DEST pdfmark end
 -2 3503
a 396 3593 a Fk(These)h(strate)o(gies)g(w)o(ork)g(on)g(lar)o(ge)f
(scale)i(b)n(ut)f(also)g(on)g(small)h(scale,)f(within)g(an)g(or)o
(ganization)d(or)j(team.)-2 3621 y
SDict begin H.S end
 -2 3621 a -2 3621
a
SDict begin 13 H.A end
 -2 3621 a -2 3621 a
SDict begin [/View [/XYZ H.V]/Dest (0:3792) cvn /DEST pdfmark end
 -2 3621 a 359 x Fn(6.4.)39 b(The)g(Bad,)g(the)g
(Ugl)n(y)-11 b(,)38 b(and)h(the)g(Delicious)2745 3980
y
SDict begin H.S end
 2745 3980 a 2745 3980 a
SDict begin 22.464 H.A end
 2745 3980 a 2745 3980 a
SDict begin [/View [/XYZ H.V]/Dest (11.78.1) cvn /DEST pdfmark end
 2745
3980 a -2 4178 a
SDict begin H.S end
 -2 4178 a -2 4178 a
SDict begin 13 H.A end
 -2 4178 a -2 4178
a
SDict begin [/View [/XYZ H.V]/Dest (0:3794) cvn /DEST pdfmark end
 -2 4178 a 396 4254 a Fk(Comple)o(xity)19 b(is)i(easy)-5
b(,)20 b(it')-5 b(s)21 b(simplicity)f(that)g(is)h(hard.)e(Whether)h
(our)f(softw)o(are)h(is)h(bad,)f(ugly)-5 b(,)18 b(or)i(so)h(delicious)e
(that)i(it)396 4362 y(feels)f(wrong)f(to)h(consume)f(alone,)g(doesn')o
(t)f(depend)h(so)h(much)f(on)g(our)g(indi)n(vidual)g(skills)h(as)h(ho)n
(w)e(we)i(w)o(ork)e(together)-5 b(.)396 4470 y(That)20
b(is,)h(our)f(processes.)-2 4654 y
SDict begin H.S end
 -2 4654 a -2 4654
a
SDict begin 13 H.A end
 -2 4654 a -2 4654 a
SDict begin [/View [/XYZ H.V]/Dest (0:3795) cvn /DEST pdfmark end
 -2 4654 a 396 4744 a Fk(There)g(are)g(man)o(y)f
(aspects)h(to)h(getting)e(product-b)n(uilding)d(teams)21
b(and)e(or)o(ganizations)e(to)k(think)e(wisely)-5 b(.)20
b(Y)-9 b(ou)20 b(need)396 4852 y(di)n(v)o(ersity)-5 b(,)19
b(freedom,)f(challenge,)g(resources,)h(and)h(so)h(on.)e(I)i(discuss)f
(these)h(in)f(detail)g(in)2988 4852 y
SDict begin H.S end
 2988 4852 a 2988
4852 a
SDict begin 13 H.A end
 2988 4852 a 2988 4852 a
SDict begin [/View [/XYZ H.V]/Dest (0:3796) cvn /DEST pdfmark end
 2988 4852 a Fk(Softw)o(are)g(and)g
(Silicon)396 4960 y(\(http://swsi.info\).)f(Ho)n(we)n(v)o(er)m(,)f(e)n
(v)o(en)h(if)h(you)g(ha)n(v)o(e)f(all)i(the)f(right)g(ingredients,)e
(the)i(def)o(ault)g(processes)g(that)g(skilled)396 5068
y(engineers)f(and)h(designers)f(de)n(v)o(elop)f(will)j(result)g(in)f
(comple)o(x,)e(hard-to-use)g(products.)p Black 3759 5569
a Ff(323)p Black eop end
%%Page: 324 337
TeXDict begin 324 336 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.324) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3797) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)h(classic)h(errors)f(are:)g(to)g(focus)g(on)f
(ideas,)i(not)e(problems;)g(to)i(focus)e(on)h(the)g(wrong)f(problems;)g
(to)h(misjudge)f(the)396 180 y(v)n(alue)h(of)g(solving)f(problems;)g
(to)h(not)g(use)g(ones')g(o)n(wn)g(w)o(ork;)f(and)h(in)g(man)o(y)f
(other)h(w)o(ays)g(to)g(misjudge)g(the)g(real)396 288
y(mark)o(et.)-2 455 y
SDict begin H.S end
 -2 455 a -2 455 a
SDict begin 13 H.A end
 -2 455 a -2 455
a
SDict begin [/View [/XYZ H.V]/Dest (0:3798) cvn /DEST pdfmark end
 -2 455 a 396 562 a Fk(I')o(ll)g(propose)e(a)i(process)f(called)g
("Simplicity)g(Oriented)f(Design",)h(or)g(SOD,)h(which)f(is)h(as)g(f)o
(ar)g(as)g(I)f(can)h(tell)g(a)f(reliable,)396 670 y(repeatable)g(w)o
(ay)h(of)g(de)n(v)o(eloping)e(simple)i(and)f(ele)o(gant)g(products.)g
(This)h(process)g(or)o(ganizes)e(people)h(into)h(\003e)o(xible)396
778 y(supply)f(chains)h(that)h(are)f(able)g(to)g(na)n(vigate)f(a)i
(problem)d(landscape)h(rapidly)g(and)h(cheaply)-5 b(.)18
b(The)o(y)h(do)h(this)h(by)396 886 y(b)n(uilding,)e(testing,)h(and)f(k)
o(eeping)g(or)h(discarding)f(minimal)g(plausible)h(solutions,)f(called)
h("patches".)f(Li)n(ving)396 994 y(products)g(consist)h(of)f(long)g
(series)i(of)f(patches,)f(applied)g(one)g(atop)g(the)h(other)-5
b(.)20 b(Y)-8 b(es,)20 b(you)f(may)g(recognize)f(the)i(process)396
1102 y(by)g(which)g(we)g(de)n(v)o(elop)f(\330MQ.)-2 1286
y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:3799) cvn /DEST pdfmark end
 -2 1286 a 396
1376 a Fk(Let')-5 b(s)21 b(\002rst)g(look)e(at)i(the)f(more)g(common)e
(and)i(less)h(jo)o(yful)e(processes,)h(T)o(OD)g(and)f(COD.)-2
1394 y
SDict begin H.S end
 -2 1394 a -2 1394 a
SDict begin 13 H.A end
 -2 1394 a -2 1394 a
SDict begin [/View [/XYZ H.V]/Dest (0:3800) cvn /DEST pdfmark end
 -2 1394
a 396 1704 a Fb(6.4.1.)36 b(T)-10 b(rash-Oriented)34
b(Design)2006 1704 y
SDict begin H.S end
 2006 1704 a 2006 1704 a
SDict begin 18.72 H.A end
 2006 1704
a 2006 1704 a
SDict begin [/View [/XYZ H.V]/Dest (11.78.28.2) cvn /DEST pdfmark end
 2006 1704 a -2 1897 a
SDict begin H.S end
 -2 1897 a -2 1897
a
SDict begin 13 H.A end
 -2 1897 a -2 1897 a
SDict begin [/View [/XYZ H.V]/Dest (0:3802) cvn /DEST pdfmark end
 -2 1897 a 396 1978 a Fk(The)20
b(most)f(popular)f(design)h(process)h(in)g(lar)o(ge)e(b)n(usinesses)i
(seems)h(to)f(be)f("T)m(rash)h(Oriented)e(Design",)h(or)h(T)o(OD.)f(T)o
(OD)396 2086 y(feeds)h(of)n(f)g(the)g(belief)g(that)g(all)h(we)f(need)g
(to)g(mak)o(e)g(mone)o(y)e(are)j(great)e(ideas.)h(It')-5
b(s)21 b(tenacious)f(nonsense)f(b)n(ut)h(a)396 2194 y(po)n(werful)f
(crutch)g(for)g(people)h(who)f(lack)h(imagination.)e(The)i(theory)f
(goes)h(that)g(ideas)h(are)f(rare,)f(so)i(the)f(trick)g(is)h(to)396
2302 y(capture)e(them.)h(It')-5 b(s)21 b(lik)o(e)f(non-musicians)e
(being)h(a)o(wed)h(by)g(a)h(guitar)e(player)m(,)g(not)h(realizing)f
(that)h(great)g(talent)g(is)h(so)396 2410 y(cheap)f(it)h(literally)f
(plays)g(on)f(the)i(streets)f(for)g(coins.)-2 2594 y
SDict begin H.S end

-2 2594 a -2 2594 a
SDict begin 13 H.A end
 -2 2594 a -2 2594 a
SDict begin [/View [/XYZ H.V]/Dest (0:3803) cvn /DEST pdfmark end
 -2 2594 a 396
2684 a Fk(The)g(main)g(output)f(of)h(T)o(ODs)g(are)g(e)o(xpensi)n(v)o
(e)e("ideations":)i(concepts,)f(design)g(documents,)f(and)i(products)f
(that)h(go)396 2792 y(straight)g(into)g(the)g(trash)g(can.)g(It)h(w)o
(orks)e(as)i(follo)n(ws:)-2 2810 y
SDict begin H.S end
 -2 2810 a -2 2810
a
SDict begin 13 H.A end
 -2 2810 a -2 2810 a
SDict begin [/View [/XYZ H.V]/Dest (0:3804) cvn /DEST pdfmark end
 -2 2810 a -2 2820 a
SDict begin H.S end
 -2 2820 a -2
2820 a
SDict begin 13 H.A end
 -2 2820 a -2 2820 a
SDict begin [/View [/XYZ H.V]/Dest (0:3805) cvn /DEST pdfmark end
 -2 2820 a Black 396 2962 a
Fj(\225)p Black 479 2962 a
SDict begin H.S end
 479 2962 a 479 2962 a
SDict begin 13 H.A end
 479
2962 a 479 2962 a
SDict begin [/View [/XYZ H.V]/Dest (0:3806) cvn /DEST pdfmark end
 479 2962 a Fk(The)f(Creati)n(v)o(e)g(People)g(come)f
(up)h(with)g(long)g(lists)h(of)f("we)h(could)e(do)h(X)g(and)g(Y".)g(I')
l(v)o(e)f(seen)i(endlessly)e(detailed)479 3070 y(lists)j(of)e(e)n(v)o
(erything)d(amazing)i(a)i(product)d(could)i(do.)f(Once)h(the)g(creati)n
(v)o(e)f(w)o(ork)h(of)g(idea)g(generation)e(has)479 3178
y(happened,)g(it')-5 b(s)21 b(just)g(a)g(matter)e(of)h(e)o(x)o
(ecution,)e(of)i(course.)-2 3196 y
SDict begin H.S end
 -2 3196 a -2 3196
a
SDict begin 13 H.A end
 -2 3196 a -2 3196 a
SDict begin [/View [/XYZ H.V]/Dest (0:3807) cvn /DEST pdfmark end
 -2 3196 a Black 396 3327 a Fj(\225)p
Black 479 3327 a
SDict begin H.S end
 479 3327 a 479 3327 a
SDict begin 13 H.A end
 479 3327 a 479
3327 a
SDict begin [/View [/XYZ H.V]/Dest (0:3808) cvn /DEST pdfmark end
 479 3327 a Fk(So)h(the)f(managers)f(and)g(their)h(consultants)g
(pass)g(their)g(brilliant,)g(w)o(orld-shattering)e(ideas)i(to)g
(designers)g(who)479 3435 y(create)g(acres)g(of)g(detailed,)g
(preciously)e(re\002ned)i(design)f(documents.)f(The)i(designers)g(tak)o
(e)g(the)g(tens)h(of)e(ideas)i(the)479 3543 y(managers)e(came)h(up)g
(with,)g(and)g(turn)f(them)h(into)g(hundreds)e(of)i(amazing,)f(w)o
(orld-changing)d(designs.)-2 3561 y
SDict begin H.S end
 -2 3561 a -2 3561
a
SDict begin 13 H.A end
 -2 3561 a -2 3561 a
SDict begin [/View [/XYZ H.V]/Dest (0:3809) cvn /DEST pdfmark end
 -2 3561 a Black 396 3692 a Fj(\225)p
Black 479 3692 a
SDict begin H.S end
 479 3692 a 479 3692 a
SDict begin 13 H.A end
 479 3692 a 479
3692 a
SDict begin [/View [/XYZ H.V]/Dest (0:3810) cvn /DEST pdfmark end
 479 3692 a Fk(These)k(designs)g(get)g(gi)n(v)o(en)f(to)i
(engineers)d(who)i(scratch)g(their)g(heads)g(and)f(w)o(onder)g(who)h
(the)g(heck)g(came)g(up)f(with)479 3800 y(such)h(stupid)g(nonsense.)f
(The)o(y)g(start)i(to)f(ar)o(gue)f(back)g(b)n(ut)h(the)h(designs)e
(come)h(from)f(up)h(high,)f(and)h(really)-5 b(,)19 b(it')-5
b(s)21 b(not)479 3908 y(up)f(to)g(engineers)f(to)i(ar)o(gue)d(with)j
(creati)n(v)o(e)e(people)g(and)h(e)o(xpensi)n(v)o(e)e(consultants.)-2
3926 y
SDict begin H.S end
 -2 3926 a -2 3926 a
SDict begin 13 H.A end
 -2 3926 a -2 3926 a
SDict begin [/View [/XYZ H.V]/Dest (0:3811) cvn /DEST pdfmark end
 -2 3926
a Black 396 4058 a Fj(\225)p Black 479 4058 a
SDict begin H.S end
 479 4058
a 479 4058 a
SDict begin 13 H.A end
 479 4058 a 479 4058 a
SDict begin [/View [/XYZ H.V]/Dest (0:3812) cvn /DEST pdfmark end
 479 4058 a Fk(So)j(the)f(engineers)f
(creep)g(back)h(to)g(their)g(cubicles,)g(humiliated)f(and)g(threatened)
g(into)h(b)n(uilding)f(the)h(gigantic)f(b)n(ut)479 4166
y(oh-so-ele)o(gant)e(pile)k(of)e(junk.)h(It)g(is)h(bone-breakingly)16
b(hard)j(w)o(ork)h(since)g(the)g(designs)g(tak)o(e)h(no)e(account)g(of)
479 4274 y(practical)h(costs.)g(Minor)g(whims)g(might)f(tak)o(e)i
(weeks)f(of)g(w)o(ork)f(to)i(b)n(uild.)e(As)i(the)f(project)g(gets)g
(delayed,)f(the)479 4381 y(managers)g(b)n(ully)h(the)g(engineers)f
(into)h(gi)n(ving)f(up)h(their)g(e)n(v)o(enings)e(and)i(week)o(ends.)-2
4399 y
SDict begin H.S end
 -2 4399 a -2 4399 a
SDict begin 13 H.A end
 -2 4399 a -2 4399 a
SDict begin [/View [/XYZ H.V]/Dest (0:3813) cvn /DEST pdfmark end
 -2 4399
a Black 396 4531 a Fj(\225)p Black 479 4531 a
SDict begin H.S end
 479 4531
a 479 4531 a
SDict begin 13 H.A end
 479 4531 a 479 4531 a
SDict begin [/View [/XYZ H.V]/Dest (0:3814) cvn /DEST pdfmark end
 479 4531 a Fk(Ev)o(entually)-5
b(,)18 b(something)h(resembling)f(a)j(w)o(orking)e(product)f(mak)o(es)i
(it)h(out)f(of)g(the)g(door)-5 b(.)19 b(It')-5 b(s)21
b(creak)o(y)e(and)g(fragile,)479 4639 y(comple)o(x)g(and)g(ugly)-5
b(.)19 b(The)h(designers)f(curse)h(the)g(engineers)f(for)h(their)g
(incompetence)e(and)h(pay)h(more)f(consultants)479 4747
y(to)i(put)e(lipstick)i(onto)e(the)h(pig,)g(and)g(slo)n(wly)g(the)g
(product)e(starts)j(to)g(look)e(a)i(little)g(nicer)-5
b(.)-2 4765 y
SDict begin H.S end
 -2 4765 a -2 4765 a
SDict begin 13 H.A end
 -2 4765 a -2 4765 a
SDict begin [/View [/XYZ H.V]/Dest (0:3815) cvn /DEST pdfmark end

-2 4765 a Black 396 4896 a Fj(\225)p Black 479 4896 a
SDict begin H.S end

479 4896 a 479 4896 a
SDict begin 13 H.A end
 479 4896 a 479 4896 a
SDict begin [/View [/XYZ H.V]/Dest (0:3816) cvn /DEST pdfmark end
 479 4896
a Fk(By)21 b(this)g(time,)f(the)g(managers)f(ha)n(v)o(e)g(started)i(to)
f(try)g(to)g(sell)h(the)g(product)d(and)i(the)o(y)f(\002nd,)h
(shockingly)-5 b(,)17 b(that)j(no-one)479 5004 y(w)o(ants)h(it.)g
(Undaunted)d(and)h(courageously)f(the)o(y)h(b)n(uild)h(million-dollar)e
(web)i(sites)h(and)f(ad)g(campaigns)f(to)h(e)o(xplain)p
Black 3759 5569 a Ff(324)p Black eop end
%%Page: 325 338
TeXDict begin 325 337 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.325) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 479 72 a Fk(to)i(the)f(public)f(why)g(the)o(y)h(absolutely)f
(need)g(this)i(product.)d(The)o(y)h(do)h(deals)h(with)f(other)f(b)n
(usinesses)i(to)f(force)g(the)479 180 y(product)f(on)g(the)i(lazy)-5
b(,)19 b(stupid)h(and)f(ungrateful)f(mark)o(et.)-2 198
y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:3817) cvn /DEST pdfmark end
 -2 198 a Black
396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330
a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:3818) cvn /DEST pdfmark end
 479 330 a Fk(After)i(twelv)o(e)g(months)f(of)h
(intense)g(mark)o(eting,)f(the)h(product)e(still)j(isn')o(t)f(making)f
(pro\002ts.)h(W)-7 b(orse,)20 b(it)h(suf)n(fers)479 438
y(dramatic)f(f)o(ailures)f(and)h(gets)h(branded)d(in)i(the)g(press)h
(as)g(a)f(disaster)-5 b(.)21 b(The)f(compan)o(y)d(quietly)j(shelv)o(es)
g(it,)g(\002res)h(the)479 546 y(consultants,)e(b)n(uys)h(a)h(competing)
d(product)h(from)g(a)h(small)h(start-up)e(and)h(re-brands)e(that)j(as)f
(its)i(o)n(wn)d(V)-9 b(ersion)20 b(2.)479 654 y(Hundreds)f(of)h
(millions)g(of)g(dollars)f(end-up)g(in)h(the)g(trash.)-2
672 y
SDict begin H.S end
 -2 672 a -2 672 a
SDict begin 13 H.A end
 -2 672 a -2 672 a
SDict begin [/View [/XYZ H.V]/Dest (0:3819) cvn /DEST pdfmark end
 -2 672 a Black
396 803 a Fj(\225)p Black 479 803 a
SDict begin H.S end
 479 803 a 479 803
a
SDict begin 13 H.A end
 479 803 a 479 803 a
SDict begin [/View [/XYZ H.V]/Dest (0:3820) cvn /DEST pdfmark end
 479 803 a Fk(Meanwhile,)f(another)g(visionary)g
(manager)m(,)f(some)n(where)h(in)h(the)g(Or)o(ganization,)d(drinks)j(a)
g(little)h(too)f(much)479 911 y(tequila)g(with)g(some)g(mark)o(eting)f
(people)g(and)h(has)g(a)h(Brilliant)f(Idea.)-2 1095 y
SDict begin H.S end

-2 1095 a -2 1095 a
SDict begin 13 H.A end
 -2 1095 a -2 1095 a
SDict begin [/View [/XYZ H.V]/Dest (0:3821) cvn /DEST pdfmark end
 -2 1095 a 396
1185 a Fk(T)m(rash-Oriented)e(Design)i(w)o(ould)g(be)g(a)g(caricature)f
(if)i(it)g(w)o(asn')o(t)f(so)g(common.)e(Something)h(lik)o(e)h(19)g
(out)g(of)g(20)396 1293 y(mark)o(et-ready)e(products)g(b)n(uilt)j(by)f
(lar)o(ge)f(\002rms)h(are)g(f)o(ailures)g(\(yes,)g(87\045)g(of)g
(statistics)i(are)e(made)f(up)h(on)g(the)g(spot\).)396
1401 y(The)g(remaining)e(one)i(in)g(20)g(probably)e(only)h(succeeds)h
(because)f(the)i(competitors)d(are)i(so)h(bad)f(and)f(the)h(mark)o
(eting)f(is)396 1509 y(so)i(aggressi)n(v)o(e.)-2 1693
y
SDict begin H.S end
 -2 1693 a -2 1693 a
SDict begin 13 H.A end
 -2 1693 a -2 1693 a
SDict begin [/View [/XYZ H.V]/Dest (0:3822) cvn /DEST pdfmark end
 -2 1693 a 396
1783 a Fk(The)f(main)g(lessons)h(of)e(T)o(OD)h(are)g(quite)g
(straight-forw)o(ard)e(b)n(ut)i(hard)f(to)h(sw)o(allo)n(w)-5
b(.)20 b(The)o(y)f(are:)-2 1801 y
SDict begin H.S end
 -2 1801 a -2 1801 a
SDict begin 13 H.A end

-2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:3823) cvn /DEST pdfmark end
 -2 1801 a -2 1811 a
SDict begin H.S end
 -2 1811 a -2
1811 a
SDict begin 13 H.A end
 -2 1811 a -2 1811 a
SDict begin [/View [/XYZ H.V]/Dest (0:3824) cvn /DEST pdfmark end
 -2 1811 a Black 396 1953 a
Fj(\225)p Black 479 1953 a
SDict begin H.S end
 479 1953 a 479 1953 a
SDict begin 13 H.A end
 479
1953 a 479 1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:3825) cvn /DEST pdfmark end
 479 1953 a Fk(Ideas)h(are)g(cheap.)f(No)i(e)o
(xceptions.)d(There)h(are)h(no)g(brilliant)g(ideas.)g(An)o(yone)e(who)i
(tries)h(to)f(start)h(a)g(discussion)479 2061 y(with)g("oooh,)d(we)j
(can)f(do)f(this)i(too!")f(should)f(be)h(beaten)f(do)n(wn)g(with)i(all)
g(the)f(passion)g(one)f(reserv)o(es)h(for)f(tra)n(v)o(eling)479
2169 y(e)n(v)n(angelists.)h(It)g(is)h(lik)o(e)g(sitting)f(in)g(a)h
(cafe)f(at)h(the)f(foot)f(of)h(a)h(mountain,)d(drinking)g(a)j(hot)f
(chocolate)f(and)g(telling)479 2277 y(others,)h("he)o(y)-5
b(,)18 b(I)j(ha)n(v)o(e)e(a)i(great)f(idea,)f(we)i(can)f(climb)g(that)g
(mountain!)e(And)i(b)n(uild)g(a)g(chalet)g(on)g(top!)g(W)m(ith)g(tw)o
(o)479 2385 y(saunas!)g(And)g(a)g(garden!)e(He)o(y)-5
b(,)19 b(and)h(we)h(can)f(mak)o(e)f(it)i(solar)f(po)n(wered!)f(Dude,)g
(that')-5 b(s)21 b(a)o(wesome!)e(What)h(color)479 2493
y(should)f(we)i(paint)f(it?)h(Green!)e(No,)h(blue!)f(OK,)i(go)e(and)h
(mak)o(e)g(it,)g(I')o(ll)h(stay)f(here)g(and)g(mak)o(e)f(spreadsheets)h
(and)479 2600 y(graphics!")-2 2618 y
SDict begin H.S end
 -2 2618 a -2 2618
a
SDict begin 13 H.A end
 -2 2618 a -2 2618 a
SDict begin [/View [/XYZ H.V]/Dest (0:3826) cvn /DEST pdfmark end
 -2 2618 a Black 396 2750 a Fj(\225)p
Black 479 2750 a
SDict begin H.S end
 479 2750 a 479 2750 a
SDict begin 13 H.A end
 479 2750 a 479
2750 a
SDict begin [/View [/XYZ H.V]/Dest (0:3827) cvn /DEST pdfmark end
 479 2750 a Fk(The)g(starting)g(point)f(for)h(a)h(good)d(design)i
(process)g(is)h(to)f(collect)g(real)g(problems)f(that)h(confront)e
(real)j(people.)e(The)479 2858 y(second)h(step)g(is)h(to)g(e)n(v)n
(aluate)e(these)h(problems)f(with)h(the)g(basic)h(question,)e("ho)n(w)g
(much)g(is)j(it)f(w)o(orth)e(to)h(solv)o(e)g(this)479
2966 y(problem?")e(Ha)n(ving)i(done)f(that,)h(we)h(can)f(collect)g
(that)g(set)h(of)f(problems)f(that)h(are)g(w)o(orth)g(solving.)-2
2984 y
SDict begin H.S end
 -2 2984 a -2 2984 a
SDict begin 13 H.A end
 -2 2984 a -2 2984 a
SDict begin [/View [/XYZ H.V]/Dest (0:3828) cvn /DEST pdfmark end
 -2 2984
a Black 396 3115 a Fj(\225)p Black 479 3115 a
SDict begin H.S end
 479 3115
a 479 3115 a
SDict begin 13 H.A end
 479 3115 a 479 3115 a
SDict begin [/View [/XYZ H.V]/Dest (0:3829) cvn /DEST pdfmark end
 479 3115 a Fk(Good)g(solutions)f(to)
h(real)h(problems)d(will)j(succeed)f(as)h(products.)d(Their)i(success)h
(will)f(depend)f(on)h(ho)n(w)f(good)g(and)479 3223 y(cheap)h(the)g
(solution)f(is,)i(and)f(ho)n(w)f(important)g(the)h(problem)f(is)i
(\(and)e(sadly)-5 b(,)19 b(ho)n(w)h(big)g(the)g(mark)o(eting)f(b)n
(udgets)479 3331 y(are\).)h(But)h(their)e(success)i(will)g(also)g
(depend)d(on)i(ho)n(w)g(much)f(the)o(y)g(demand)g(in)h(ef)n(fort)f(to)i
(use,)f(in)g(other)g(w)o(ords)f(ho)n(w)479 3439 y(simple)h(the)o(y)g
(are.)-2 3623 y
SDict begin H.S end
 -2 3623 a -2 3623 a
SDict begin 13 H.A end
 -2 3623 a -2 3623
a
SDict begin [/View [/XYZ H.V]/Dest (0:3830) cvn /DEST pdfmark end
 -2 3623 a 396 3713 a Fk(Hence)g(after)g(slaying)g(the)g(dragon)e(of)i
(utter)g(irrele)n(v)n(ance,)e(we)j(attack)f(the)g(demon)f(of)g(comple)o
(xity)-5 b(.)-2 3741 y
SDict begin H.S end
 -2 3741 a -2 3741 a
SDict begin 13 H.A end
 -2 3741 a
-2 3741 a
SDict begin [/View [/XYZ H.V]/Dest (0:3831) cvn /DEST pdfmark end
 -2 3741 a 396 4051 a Fb(6.4.2.)36 b(Comple)n(xity-Oriented)g
(Design)2333 4051 y
SDict begin H.S end
 2333 4051 a 2333 4051 a
SDict begin 18.72 H.A end
 2333 4051
a 2333 4051 a
SDict begin [/View [/XYZ H.V]/Dest (11.78.29.2) cvn /DEST pdfmark end
 2333 4051 a -2 4244 a
SDict begin H.S end
 -2 4244 a -2 4244
a
SDict begin 13 H.A end
 -2 4244 a -2 4244 a
SDict begin [/View [/XYZ H.V]/Dest (0:3833) cvn /DEST pdfmark end
 -2 4244 a 396 4325 a Fk(Really)21
b(good)e(engineering)e(teams)k(and)e(small)i(\002rms)f(can)g(usually)g
(b)n(uild)g(decent)f(products.)g(But)h(the)h(v)n(ast)f(majority)396
4433 y(of)g(products)f(still)i(end)f(up)g(being)f(too)h(comple)o(x)e
(and)i(less)h(successful)f(than)g(the)o(y)f(might)h(be.)g(This)g(is)h
(because)396 4541 y(specialist)g(teams,)f(e)n(v)o(en)f(the)i(best,)f
(often)f(stubbornly)f(apply)h(a)i(process)f(I)g(call)h("Comple)o
(xity-Oriented)16 b(Design",)k(or)396 4649 y(COD,)h(which)f(w)o(orks)g
(as)g(follo)n(ws:)-2 4661 y
SDict begin H.S end
 -2 4661 a -2 4661 a
SDict begin 13 H.A end
 -2 4661
a -2 4661 a
SDict begin [/View [/XYZ H.V]/Dest (0:3834) cvn /DEST pdfmark end
 -2 4661 a -2 4671 a
SDict begin H.S end
 -2 4671 a -2 4671 a
SDict begin 13 H.A end
 -2
4671 a -2 4671 a
SDict begin [/View [/XYZ H.V]/Dest (0:3835) cvn /DEST pdfmark end
 -2 4671 a Black 396 4819 a Fj(\225)p
Black 479 4819 a
SDict begin H.S end
 479 4819 a 479 4819 a
SDict begin 13 H.A end
 479 4819 a 479
4819 a
SDict begin [/View [/XYZ H.V]/Dest (0:3836) cvn /DEST pdfmark end
 479 4819 a Fk(Management)e(correctly)h(identi\002es)h(some)h
(interesting)e(and)g(dif)n(\002cult)h(problem)e(with)j(economic)d(v)n
(alue.)i(In)g(doing)479 4927 y(so)h(the)o(y)e(already)g(leapfrog)g(o)o
(v)o(er)g(an)o(y)g(T)o(OD)h(team.)-2 4945 y
SDict begin H.S end
 -2 4945 a
-2 4945 a
SDict begin 13 H.A end
 -2 4945 a -2 4945 a
SDict begin [/View [/XYZ H.V]/Dest (0:3837) cvn /DEST pdfmark end
 -2 4945 a Black 3759 5569
a Ff(325)p Black eop end
%%Page: 326 339
TeXDict begin 326 338 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.326) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3838) cvn /DEST pdfmark end
 479 72 a Fk(The)h(team)g(with)h
(enthusiasm)e(start)i(to)f(b)n(uild)g(prototypes)e(and)i(core)f
(layers.)h(These)g(w)o(ork)g(as)h(designed)e(and)g(thus)479
180 y(encouraged,)e(the)k(team)f(go)g(of)n(f)f(into)h(intense)g(design)
f(and)h(architecture)f(discussions,)g(coming)g(up)h(with)g(ele)o(gant)
479 288 y(schemas)g(that)h(look)e(beautiful)g(and)h(solid.)-2
289 y
SDict begin H.S end
 -2 289 a -2 289 a
SDict begin 13 H.A end
 -2 289 a -2 289 a
SDict begin [/View [/XYZ H.V]/Dest (0:3839) cvn /DEST pdfmark end
 -2 289 a Black
396 438 a Fj(\225)p Black 479 438 a
SDict begin H.S end
 479 438 a 479 438
a
SDict begin 13 H.A end
 479 438 a 479 438 a
SDict begin [/View [/XYZ H.V]/Dest (0:3840) cvn /DEST pdfmark end
 479 438 a Fk(Management)e(comes)i(back)g(and)g
(challenges)f(team)h(with)g(yet)g(more)g(dif)n(\002cult)f(problems.)g
(W)-7 b(e)21 b(tend)f(to)g(equate)479 546 y(v)n(alue)g(with)g(cost,)g
(so)h(the)f(harder)f(the)h(problem,)e(and)i(more)f(e)o(xpensi)n(v)o(e)g
(to)h(solv)o(e,)f(the)i(more)e(the)h(solution)g(should)479
654 y(be)g(w)o(orth,)g(in)g(their)g(minds.)-2 666 y
SDict begin H.S end
 -2
666 a -2 666 a
SDict begin 13 H.A end
 -2 666 a -2 666 a
SDict begin [/View [/XYZ H.V]/Dest (0:3841) cvn /DEST pdfmark end
 -2 666 a Black 396 803
a Fj(\225)p Black 479 803 a
SDict begin H.S end
 479 803 a 479 803 a
SDict begin 13 H.A end
 479 803
a 479 803 a
SDict begin [/View [/XYZ H.V]/Dest (0:3842) cvn /DEST pdfmark end
 479 803 a Fk(The)g(team,)g(being)f(engineers)g(and)h(thus)g
(lo)o(ving)f(to)h(b)n(uild)g(stuf)n(f,)f(b)n(uild)h(stuf)n(f.)g(The)o
(y)f(b)n(uild)h(and)f(b)n(uild)h(and)g(b)n(uild)479 911
y(and)g(end-up)e(with)j(massi)n(v)o(e,)e(perfectly-designed)e(comple)o
(xity)-5 b(.)-2 929 y
SDict begin H.S end
 -2 929 a -2 929 a
SDict begin 13 H.A end
 -2 929 a -2 929
a
SDict begin [/View [/XYZ H.V]/Dest (0:3843) cvn /DEST pdfmark end
 -2 929 a Black 396 1060 a Fj(\225)p Black 479 1060
a
SDict begin H.S end
 479 1060 a 479 1060 a
SDict begin 13 H.A end
 479 1060 a 479 1060 a
SDict begin [/View [/XYZ H.V]/Dest (0:3844) cvn /DEST pdfmark end
 479 1060
a Fk(The)20 b(products)f(go)h(to)g(mark)o(et,)f(and)h(the)g(mark)o(et)f
(scratches)i(its)g(head)e(and)h(asks,)g("seriously)-5
b(,)19 b(is)i(this)g(the)f(best)h(you)479 1168 y(can)f(do?")g(People)g
(do)f(use)i(the)f(products,)e(especially)i(if)h(the)o(y)e(aren')o(t)g
(spending)f(their)i(o)n(wn)g(mone)o(y)f(in)h(climbing)479
1276 y(the)g(learning)f(curv)o(e.)-2 1294 y
SDict begin H.S end
 -2 1294 a
-2 1294 a
SDict begin 13 H.A end
 -2 1294 a -2 1294 a
SDict begin [/View [/XYZ H.V]/Dest (0:3845) cvn /DEST pdfmark end
 -2 1294 a Black 396 1426
a Fj(\225)p Black 479 1426 a
SDict begin H.S end
 479 1426 a 479 1426 a
SDict begin 13 H.A end
 479
1426 a 479 1426 a
SDict begin [/View [/XYZ H.V]/Dest (0:3846) cvn /DEST pdfmark end
 479 1426 a Fk(Management)f(gets)j(positi)n(v)o(e)e
(feedback)g(from)g(its)i(lar)o(ger)e(customers,)g(who)h(share)g(the)g
(same)g(idea)g(that)h(high)e(cost)479 1534 y(\(in)h(training)f(and)h
(use\))g(means)g(high)f(v)n(alue.)h(and)f(so)i(continues)e(to)h(push)g
(the)g(process.)-2 1552 y
SDict begin H.S end
 -2 1552 a -2 1552 a
SDict begin 13 H.A end
 -2 1552
a -2 1552 a
SDict begin [/View [/XYZ H.V]/Dest (0:3847) cvn /DEST pdfmark end
 -2 1552 a Black 396 1683 a Fj(\225)p Black
479 1683 a
SDict begin H.S end
 479 1683 a 479 1683 a
SDict begin 13 H.A end
 479 1683 a 479 1683
a
SDict begin [/View [/XYZ H.V]/Dest (0:3848) cvn /DEST pdfmark end
 479 1683 a Fk(Meanwhile)g(some)n(where)e(across)j(the)f(w)o(orld,)f
(a)i(small)f(team)h(is)g(solving)e(the)h(same)g(problem)f(using)h(a)g
(better)479 1791 y(process,)g(and)f(a)i(year)f(later)g(smashes)g(the)h
(mark)o(et)e(to)h(little)h(pieces.)-2 1975 y
SDict begin H.S end
 -2 1975
a -2 1975 a
SDict begin 13 H.A end
 -2 1975 a -2 1975 a
SDict begin [/View [/XYZ H.V]/Dest (0:3849) cvn /DEST pdfmark end
 -2 1975 a 396 2065 a
Fk(COD)g(is)g(characterized)e(by)g(a)i(team)f(obsessi)n(v)o(ely)f
(solving)h(the)g(wrong)f(problems)g(to)h(the)g(point)g(of)f(collecti)n
(v)o(e)396 2173 y(insanity)-5 b(.)19 b(COD)i(products)e(tend)h(to)g(be)
g(lar)o(ge,)f(ambitious,)g(comple)o(x,)f(and)i(unpopular)-5
b(.)18 b(Much)h(open)g(source)h(softw)o(are)396 2281
y(is)h(the)e(output)f(of)h(COD)i(processes.)e(It)g(is)i(insanely)d
(hard)h(for)g(engineers)f(to)2619 2281 y
SDict begin H.S end
 2619 2281 a
2619 2281 a
SDict begin 13 H.A end
 2619 2281 a 2619 2281 a
SDict begin [/View [/XYZ H.V]/Dest (0:3850) cvn /DEST pdfmark end
 2619 2281 a Fg(stop)h
Fk(e)o(xtending)e(a)j(design)f(to)h(co)o(v)o(er)e(more)396
2389 y(potential)h(problems.)f(The)o(y)h(ar)o(gue,)f("what)h(if)h
(someone)f(w)o(ants)h(to)g(do)f(X?")h(b)n(ut)g(ne)n(v)o(er)e(ask)i
(themselv)o(es,)f("what)g(is)i(the)396 2497 y(real)f(v)n(alue)g(of)g
(solving)f(X?")-2 2681 y
SDict begin H.S end
 -2 2681 a -2 2681 a
SDict begin 13 H.A end
 -2 2681
a -2 2681 a
SDict begin [/View [/XYZ H.V]/Dest (0:3851) cvn /DEST pdfmark end
 -2 2681 a 396 2771 a Fk(A)i(good)e(e)o(xample)g(of)g(COD)i
(in)g(practice)e(is)i(Bluetooth,)e(a)i(comple)o(x,)d(o)o(v)o(er)n
(-designed)f(set)k(of)f(protocols)f(that)h(users)396
2879 y(hate.)g(It)h(continues)e(to)h(e)o(xist)g(only)g(because)f(in)h
(a)h(massi)n(v)o(ely-patented)d(industry)g(there)i(are)g(no)g(real)g
(alternati)n(v)o(es.)396 2987 y(Bluetooth)g(is)h(perfectly)d(secure,)i
(which)g(is)h(close)f(to)h(pointless)e(for)h(a)h(proximity)d(protocol.)
g(At)j(the)f(same)h(time)f(it)396 3094 y(lacks)h(a)f(standard)f(API)i
(for)e(de)n(v)o(elopers,)f(meaning)h(it')-5 b(s)21 b(really)f(costly)g
(to)g(use)h(Bluetooth)e(in)h(applications.)-2 3278 y
SDict begin H.S end

-2 3278 a -2 3278 a
SDict begin 13 H.A end
 -2 3278 a -2 3278 a
SDict begin [/View [/XYZ H.V]/Dest (0:3852) cvn /DEST pdfmark end
 -2 3278 a 396
3368 a Fk(On)g(the)f(#zeromq)f(IRC)i(channel,)e(W)m(intre)h(once)g
(wrote)g(of)g(ho)n(w)g(enraged)f(he)h(w)o(as)h(man)o(y)e(years)i(ago)e
(when)h(he)h("found)396 3476 y(that)h(XMMS)f(2)g(had)g(a)h(w)o(orking)d
(plugin)h(system)i(b)n(ut)f(could)f(not)h(actually)f(play)h(music.")-2
3660 y
SDict begin H.S end
 -2 3660 a -2 3660 a
SDict begin 13 H.A end
 -2 3660 a -2 3660 a
SDict begin [/View [/XYZ H.V]/Dest (0:3853) cvn /DEST pdfmark end
 -2 3660
a 396 3750 a Fk(COD)h(is)g(a)g(form)e(of)h(lar)o(ge-scale)f("rabbit)g
(holing",)g(in)h(which)g(designers)f(and)h(engineers)f(cannot)g
(distance)396 3858 y(themselv)o(es)h(from)e(the)j(technical)e(details)h
(of)g(their)g(w)o(ork.)f(The)o(y)g(add)g(more)g(and)h(more)f(features,)
g(utterly)g(misreading)396 3966 y(the)h(economics)f(of)h(their)g(w)o
(ork.)-2 4133 y
SDict begin H.S end
 -2 4133 a -2 4133 a
SDict begin 13 H.A end
 -2 4133 a -2 4133
a
SDict begin [/View [/XYZ H.V]/Dest (0:3854) cvn /DEST pdfmark end
 -2 4133 a 396 4240 a Fk(The)g(main)g(lessons)h(of)e(COD)i(are)g(also)
f(simple)g(b)n(ut)g(hard)g(for)f(e)o(xperts)h(to)g(sw)o(allo)n(w)-5
b(.)20 b(The)o(y)f(are:)-2 4258 y
SDict begin H.S end
 -2 4258 a -2 4258 a
SDict begin 13 H.A end

-2 4258 a -2 4258 a
SDict begin [/View [/XYZ H.V]/Dest (0:3855) cvn /DEST pdfmark end
 -2 4258 a -2 4268 a
SDict begin H.S end
 -2 4268 a -2
4268 a
SDict begin 13 H.A end
 -2 4268 a -2 4268 a
SDict begin [/View [/XYZ H.V]/Dest (0:3856) cvn /DEST pdfmark end
 -2 4268 a Black 396 4410 a
Fj(\225)p Black 479 4410 a
SDict begin H.S end
 479 4410 a 479 4410 a
SDict begin 13 H.A end
 479
4410 a 479 4410 a
SDict begin [/View [/XYZ H.V]/Dest (0:3857) cvn /DEST pdfmark end
 479 4410 a Fk(Making)g(stuf)n(f)h(that)g(you)g(don')o
(t)e(immediately)h(ha)n(v)o(e)h(a)g(need)g(for)f(is)j(pointless.)d
(Doesn')o(t)g(matter)h(ho)n(w)g(talented)f(or)479 4518
y(brilliant)h(you)f(are,)h(if)h(you)e(just)i(sit)g(do)n(wn)e(and)h(mak)
o(e)f(stuf)n(f)h(people)f(are)h(not)g(actually)g(asking)f(for)m(,)g
(you)h(are)g(most)479 4626 y(lik)o(ely)g(w)o(asting)h(your)d(time.)-2
4644 y
SDict begin H.S end
 -2 4644 a -2 4644 a
SDict begin 13 H.A end
 -2 4644 a -2 4644 a
SDict begin [/View [/XYZ H.V]/Dest (0:3858) cvn /DEST pdfmark end
 -2 4644
a Black 396 4776 a Fj(\225)p Black 479 4776 a
SDict begin H.S end
 479 4776
a 479 4776 a
SDict begin 13 H.A end
 479 4776 a 479 4776 a
SDict begin [/View [/XYZ H.V]/Dest (0:3859) cvn /DEST pdfmark end
 479 4776 a Fk(Problems)i(are)g(not)g
(equal.)f(Some)h(are)g(simple,)g(and)g(some)g(are)g(comple)o(x.)e
(Ironically)-5 b(,)18 b(solving)h(the)h(simpler)479 4884
y(problems)f(often)g(has)i(more)e(v)n(alue)h(to)g(more)f(people)h(than)
f(solving)g(the)i(really)e(hard)h(ones.)f(So)i(if)f(you)g(allo)n(w)479
4992 y(engineers)f(to)i(just)f(w)o(ork)g(on)g(random)e(things,)h(the)o
(y')o(ll)h(most)g(focus)g(on)f(the)i(most)f(interesting)f(b)n(ut)h
(least)479 5099 y(w)o(orthwhile)f(things.)-2 5117 y
SDict begin H.S end
 -2
5117 a -2 5117 a
SDict begin 13 H.A end
 -2 5117 a -2 5117 a
SDict begin [/View [/XYZ H.V]/Dest (0:3860) cvn /DEST pdfmark end
 -2 5117 a Black
3757 5569 a Ff(326)p Black eop end
%%Page: 327 340
TeXDict begin 327 339 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.327) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3861) cvn /DEST pdfmark end
 479 72 a Fk(Engineers)g(and)h(designers)f
(lo)o(v)o(e)g(to)i(mak)o(e)e(stuf)n(f)h(and)g(decoration,)e(and)h(this)
i(ine)n(vitably)e(leads)h(to)h(comple)o(xity)-5 b(.)17
b(It)479 180 y(is)k(crucial)f(to)g(ha)n(v)o(e)g(a)h("stop)f
(mechanism",)e(a)j(w)o(ay)f(to)g(set)h(short,)f(hard)f(deadlines)h
(that)g(force)f(people)g(to)i(mak)o(e)479 288 y(smaller)m(,)f(simpler)g
(answers)g(to)g(just)h(the)f(most)g(crucial)g(problems.)-2
348 y
SDict begin H.S end
 -2 348 a -2 348 a
SDict begin 13 H.A end
 -2 348 a -2 348 a
SDict begin [/View [/XYZ H.V]/Dest (0:3862) cvn /DEST pdfmark end
 -2 348 a 396
658 a Fb(6.4.3.)36 b(Simplicity-Oriented)f(Design)2255
658 y
SDict begin H.S end
 2255 658 a 2255 658 a
SDict begin 18.72 H.A end
 2255 658 a 2255 658 a
SDict begin [/View [/XYZ H.V]/Dest (11.78.30.2) cvn /DEST pdfmark end
 2255
658 a -2 851 a
SDict begin H.S end
 -2 851 a -2 851 a
SDict begin 13 H.A end
 -2 851 a -2 851 a
SDict begin [/View [/XYZ H.V]/Dest (0:3864) cvn /DEST pdfmark end
 -2
851 a 396 932 a Fk(Finally)-5 b(,)20 b(we)g(come)g(to)g(the)g(rare)g(b)
n(ut)g(precious)f(Simplicity-Oriented)f(Design.)i(This)g(process)g
(starts)h(with)f(a)396 1040 y(realization:)g(we)g(do)g(not)g(kno)n(w)f
(what)h(we)h(ha)n(v)o(e)e(to)i(mak)o(e)e(until)h(after)g(we)h(start)f
(making)f(it.)i(Coming)e(up)h(with)g(ideas,)396 1148
y(or)g(lar)o(ge-scale)f(designs)h(isn')o(t)g(just)g(w)o(asteful,)g(it')
-5 b(s)22 b(a)e(direct)g(hindrance)e(to)j(designing)d(the)i(truly)g
(accurate)f(solutions.)396 1256 y(The)h(really)f(juic)o(y)g(problems)f
(are)i(hidden)e(lik)o(e)i(f)o(ar)g(v)n(alle)o(ys,)f(and)g(an)o(y)g
(acti)n(vity)g(e)o(xcept)g(acti)n(v)o(e)g(scouting)g(creates)g(a)i(fog)
396 1364 y(that)g(hides)f(those)g(distant)g(v)n(alle)o(ys.)f(Y)-9
b(ou)20 b(need)f(to)i(k)o(eep)e(mobile,)g(pack)h(light,)g(and)f(mo)o(v)
o(e)g(f)o(ast.)-2 1548 y
SDict begin H.S end
 -2 1548 a -2 1548 a
SDict begin 13 H.A end
 -2 1548
a -2 1548 a
SDict begin [/View [/XYZ H.V]/Dest (0:3865) cvn /DEST pdfmark end
 -2 1548 a 396 1638 a Fk(SOD)i(w)o(orks)f(as)h(follo)n(ws:)
-2 1639 y
SDict begin H.S end
 -2 1639 a -2 1639 a
SDict begin 13 H.A end
 -2 1639 a -2 1639 a
SDict begin [/View [/XYZ H.V]/Dest (0:3866) cvn /DEST pdfmark end
 -2
1639 a -2 1649 a
SDict begin H.S end
 -2 1649 a -2 1649 a
SDict begin 13 H.A end
 -2 1649 a -2 1649
a
SDict begin [/View [/XYZ H.V]/Dest (0:3867) cvn /DEST pdfmark end
 -2 1649 a Black 396 1808 a Fj(\225)p Black 479 1808
a
SDict begin H.S end
 479 1808 a 479 1808 a
SDict begin 13 H.A end
 479 1808 a 479 1808 a
SDict begin [/View [/XYZ H.V]/Dest (0:3868) cvn /DEST pdfmark end
 479 1808
a Fk(W)-7 b(e)22 b(collect)e(a)g(set)h(of)f(interesting)g(problems)e
(\(by)i(looking)e(at)j(ho)n(w)f(people)f(use)h(technology)e(or)i(other)
f(products\))479 1916 y(and)h(we)g(line)h(these)f(up)g(from)f(simple)h
(to)h(comple)o(x,)d(looking)g(for)i(and)f(identifying)g(patterns)g(of)h
(use.)-2 1934 y
SDict begin H.S end
 -2 1934 a -2 1934 a
SDict begin 13 H.A end
 -2 1934 a -2 1934
a
SDict begin [/View [/XYZ H.V]/Dest (0:3869) cvn /DEST pdfmark end
 -2 1934 a Black 396 2065 a Fj(\225)p Black 479 2065
a
SDict begin H.S end
 479 2065 a 479 2065 a
SDict begin 13 H.A end
 479 2065 a 479 2065 a
SDict begin [/View [/XYZ H.V]/Dest (0:3870) cvn /DEST pdfmark end
 479 2065
a Fk(W)-7 b(e)22 b(tak)o(e)e(the)g(simplest,)g(most)h(dramatic)e
(problem)f(and)i(we)h(solv)o(e)e(this)i(with)f(a)h(minimal)f(plausible)
f(solution,)g(or)479 2173 y("patch".)g(Each)h(patch)g(solv)o(es)g(e)o
(xactly)f(a)i(genuine)d(and)i(agreed)f(problem)f(in)j(a)f(brutally)f
(minimal)h(f)o(ashion.)-2 2191 y
SDict begin H.S end
 -2 2191 a -2 2191 a
SDict begin 13 H.A end

-2 2191 a -2 2191 a
SDict begin [/View [/XYZ H.V]/Dest (0:3871) cvn /DEST pdfmark end
 -2 2191 a Black 396 2323 a Fj(\225)p
Black 479 2323 a
SDict begin H.S end
 479 2323 a 479 2323 a
SDict begin 13 H.A end
 479 2323 a 479
2323 a
SDict begin [/View [/XYZ H.V]/Dest (0:3872) cvn /DEST pdfmark end
 479 2323 a Fk(W)-7 b(e)22 b(apply)d(one)h(measure)f(of)h
(quality)f(to)i(patches,)e(namely)g("can)h(this)h(be)f(done)f(an)o(y)g
(simpler)h(while)g(still)i(solving)479 2430 y(the)e(stated)h(problem?")
d(W)-7 b(e)21 b(can)f(measure)g(comple)o(xity)e(in)i(terms)h(of)e
(concepts)h(and)f(models)h(that)g(the)g(user)g(has)h(to)479
2538 y(learn)f(or)g(guess)g(in)g(order)f(to)i(use)f(the)g(patch.)g(The)
g(fe)n(wer)m(,)f(the)h(better)-5 b(.)20 b(A)h(perfect)e(patch)g(solv)o
(es)h(a)h(problem)d(with)479 2646 y(zero)i(learning)f(required)f(by)i
(the)g(user)-5 b(.)-2 2664 y
SDict begin H.S end
 -2 2664 a -2 2664 a
SDict begin 13 H.A end
 -2 2664
a -2 2664 a
SDict begin [/View [/XYZ H.V]/Dest (0:3873) cvn /DEST pdfmark end
 -2 2664 a Black 396 2796 a Fj(\225)p Black
479 2796 a
SDict begin H.S end
 479 2796 a 479 2796 a
SDict begin 13 H.A end
 479 2796 a 479 2796
a
SDict begin [/View [/XYZ H.V]/Dest (0:3874) cvn /DEST pdfmark end
 479 2796 a Fk(Our)20 b(product)f(de)n(v)o(elopment)e(consists)j(of)g
(a)h(patch)f(that)g(solv)o(es)g(the)g(problem)f("we)h(need)f(a)i(proof)
e(of)g(concept")g(and)479 2904 y(then)h(e)n(v)n(olv)o(es)f(in)i(an)f
(unbrok)o(en)d(line)k(to)f(a)h(mature)e(series)i(of)f(products,)e
(through)g(hundreds)g(or)i(thousands)f(of)479 3012 y(patches)h(piled)g
(on)g(top)f(of)h(each)g(other)-5 b(.)-2 3030 y
SDict begin H.S end
 -2 3030
a -2 3030 a
SDict begin 13 H.A end
 -2 3030 a -2 3030 a
SDict begin [/View [/XYZ H.V]/Dest (0:3875) cvn /DEST pdfmark end
 -2 3030 a Black 396 3161
a Fj(\225)p Black 479 3161 a
SDict begin H.S end
 479 3161 a 479 3161 a
SDict begin 13 H.A end
 479
3161 a 479 3161 a
SDict begin [/View [/XYZ H.V]/Dest (0:3876) cvn /DEST pdfmark end
 479 3161 a Fk(W)e(e)22 b(do)d(not)h(do)943
3161 y
SDict begin H.S end
 943 3161 a 943 3161 a
SDict begin 13 H.A end
 943 3161 a 943 3161 a
SDict begin [/View [/XYZ H.V]/Dest (0:3877) cvn /DEST pdfmark end
 943
3161 a Ff(anything)e Fk(that)j(is)g(not)f(a)g(patch.)g(W)-7
b(e)21 b(enforce)e(this)h(rule)g(with)h(formal)e(processes)h(that)g
(demand)e(that)479 3269 y(e)n(v)o(ery)h(acti)n(vity)h(or)g(task)g(is)h
(tied)g(to)f(a)h(genuine)d(and)i(agreed)f(problem,)f(e)o(xplicitly)h
(enunciated)g(and)g(documented.)-2 3287 y
SDict begin H.S end
 -2 3287 a -2
3287 a
SDict begin 13 H.A end
 -2 3287 a -2 3287 a
SDict begin [/View [/XYZ H.V]/Dest (0:3878) cvn /DEST pdfmark end
 -2 3287 a Black 396 3418 a
Fj(\225)p Black 479 3418 a
SDict begin H.S end
 479 3418 a 479 3418 a
SDict begin 13 H.A end
 479
3418 a 479 3418 a
SDict begin [/View [/XYZ H.V]/Dest (0:3879) cvn /DEST pdfmark end
 479 3418 a Fk(W)-7 b(e)22 b(b)n(uild)d(our)h
(projects)f(into)h(a)h(supply)e(chain)h(where)f(each)h(project)f(can)h
(pro)o(vide)f(problems)f(to)j(its)g("suppliers")479 3526
y(and)f(recei)n(v)o(e)f(patches)h(in)g(return.)f(The)h(supply)f(chain)g
(creates)i(the)f("stop)g(mechanism")f(since)h(when)g(people)f(are)479
3634 y(impatiently)g(w)o(aiting)h(for)g(an)g(answer)m(,)f(we)i
(necessarily)e(cut)i(our)e(w)o(ork)h(short.)-2 3652 y
SDict begin H.S end

-2 3652 a -2 3652 a
SDict begin 13 H.A end
 -2 3652 a -2 3652 a
SDict begin [/View [/XYZ H.V]/Dest (0:3880) cvn /DEST pdfmark end
 -2 3652 a Black
396 3784 a Fj(\225)p Black 479 3784 a
SDict begin H.S end
 479 3784 a 479
3784 a
SDict begin 13 H.A end
 479 3784 a 479 3784 a
SDict begin [/View [/XYZ H.V]/Dest (0:3881) cvn /DEST pdfmark end
 479 3784 a Fk(Indi)n(viduals)e(are)h(free)
g(to)h(w)o(ork)f(on)g(an)o(y)g(projects,)g(and)g(pro)o(vide)e(patches)i
(at)h(an)o(y)f(place)g(the)o(y)g(feel)g(it')-5 b(s)21
b(w)o(orthwhile.)479 3892 y(No)f(indi)n(viduals)f("o)n(wn")h(an)o(y)f
(project,)g(e)o(xcept)g(to)i(enforce)d(the)i(formal)g(processes.)f(A)i
(single)f(project)f(can)h(ha)n(v)o(e)479 4000 y(man)o(y)f(v)n
(ariations,)g(each)h(a)h(collection)e(of)h(dif)n(ferent,)e(competing)g
(patches.)-2 4018 y
SDict begin H.S end
 -2 4018 a -2 4018 a
SDict begin 13 H.A end
 -2 4018 a -2
4018 a
SDict begin [/View [/XYZ H.V]/Dest (0:3882) cvn /DEST pdfmark end
 -2 4018 a Black 396 4149 a Fj(\225)p Black 479
4149 a
SDict begin H.S end
 479 4149 a 479 4149 a
SDict begin 13 H.A end
 479 4149 a 479 4149 a
SDict begin [/View [/XYZ H.V]/Dest (0:3883) cvn /DEST pdfmark end
 479
4149 a Fk(Projects)j(e)o(xport)d(formal)h(and)h(documented)d(interf)o
(aces)j(so)h(that)f(upstream)f(\(client\))h(projects)f(are)h(una)o(w)o
(are)f(of)479 4257 y(change)g(happening)f(in)i(supplier)f(projects.)h
(Thus)g(multiple)f(supplier)g(projects)h(can)g(compete)f(for)h(client)g
(projects,)479 4365 y(in)h(ef)n(fect)e(creating)g(a)i(free)f(and)f
(competiti)n(v)o(e)g(mark)o(et.)-2 4383 y
SDict begin H.S end
 -2 4383 a -2
4383 a
SDict begin 13 H.A end
 -2 4383 a -2 4383 a
SDict begin [/View [/XYZ H.V]/Dest (0:3884) cvn /DEST pdfmark end
 -2 4383 a Black 396 4514 a
Fj(\225)p Black 479 4514 a
SDict begin H.S end
 479 4514 a 479 4514 a
SDict begin 13 H.A end
 479
4514 a 479 4514 a
SDict begin [/View [/XYZ H.V]/Dest (0:3885) cvn /DEST pdfmark end
 479 4514 a Fk(W)-7 b(e)22 b(tie)e(our)g(supply)f
(chain)h(to)g(real)g(users)g(and)g(e)o(xternal)f(clients)i(and)e(we)i
(dri)n(v)o(e)e(the)h(whole)g(process)f(by)h(rapid)479
4622 y(c)o(ycles)g(so)h(that)f(a)h(problem)d(recei)n(v)o(ed)h(from)g
(outside)h(users)g(can)g(be)g(analyzed,)f(e)n(v)n(aluated,)f(and)i
(solv)o(ed)f(with)h(a)479 4730 y(patch)g(in)g(a)h(fe)n(w)f(hours.)-2
4748 y
SDict begin H.S end
 -2 4748 a -2 4748 a
SDict begin 13 H.A end
 -2 4748 a -2 4748 a
SDict begin [/View [/XYZ H.V]/Dest (0:3886) cvn /DEST pdfmark end
 -2 4748
a Black 396 4880 a Fj(\225)p Black 479 4880 a
SDict begin H.S end
 479 4880
a 479 4880 a
SDict begin 13 H.A end
 479 4880 a 479 4880 a
SDict begin [/View [/XYZ H.V]/Dest (0:3887) cvn /DEST pdfmark end
 479 4880 a Fk(At)h(e)n(v)o(ery)e
(moment)g(from)g(the)h(v)o(ery)f(\002rst)i(patch,)e(our)h(product)e(is)
j(shippable.)e(This)h(is)i(essential,)e(because)g(a)g(lar)o(ge)479
4988 y(proportion)e(of)h(patches)h(will)h(be)f(wrong)f(\(10-30\045\))f
(and)i(only)f(by)h(gi)n(ving)f(the)h(product)e(to)j(users)f(can)g(we)h
(kno)n(w)479 5095 y(which)f(patches)g(ha)n(v)o(e)f(become)g(problems)g
(and)h(themselv)o(es)f(need)h(solving.)p Black 3756 5569
a Ff(327)p Black eop end
%%Page: 328 341
TeXDict begin 328 340 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.328) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3888) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(SOD)i(is)g(a)g(form)e(of)h("hill)g(climbing)f
(algorithm",)f(a)j(reliable)f(w)o(ay)g(of)g(\002nding)f(optimal)g
(solutions)h(to)g(the)h(most)396 180 y(signi\002cant)f(problems)f(in)h
(an)g(unkno)n(wn)e(landscape.)h(Y)-9 b(ou)19 b(don')o(t)g(need)g(to)i
(be)f(a)g(genius)g(to)g(use)h(SOD)g(successfully)-5 b(,)396
288 y(you)20 b(just)g(need)g(to)g(be)g(able)g(to)h(see)f(the)h(dif)n
(ference)d(between)h(the)h(fog)g(of)g(acti)n(vity)f(and)h(the)g
(progress)f(to)n(w)o(ards)h(ne)n(w)396 396 y(real)g(problems.)-2
580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:3889) cvn /DEST pdfmark end
 -2 580 a 396
670 a Fk(A)h(really)f(good)f(designer)g(with)h(a)h(good)d(team)j(can)f
(use)g(SOD)h(to)f(b)n(uild)g(w)o(orld-class)g(products,)e(rapidly)h
(and)396 778 y(accurately)-5 b(.)18 b(T)-7 b(o)20 b(get)g(the)g(most)g
(out)f(of)h(SOD,)g(the)g(designer)e(has)i(to)g(use)g(the)g(product)e
(continuously)-5 b(,)17 b(from)h(day)i(1,)f(and)396 886
y(de)n(v)o(elop)g(his)h(or)g(her)g(ability)g(to)g(smell)h(out)f
(problems)e(such)i(as)h(inconsistenc)o(y)-5 b(,)18 b(surprising)h(beha)
n(vior)m(,)f(and)i(other)396 994 y(forms)g(of)g(friction.)e(W)-7
b(e)22 b(naturally)d(o)o(v)o(erlook)e(man)o(y)i(anno)o(yances)f(b)n(ut)
i(a)h(good)e(designer)g(picks)h(these)g(up,)g(and)f(thinks)396
1102 y(about)g(ho)n(w)h(to)g(patch)g(them.)g(Design)g(is)h(about)e
(remo)o(ving)f(friction)h(in)h(the)g(use)h(of)f(a)g(product.)-2
1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:3890) cvn /DEST pdfmark end
 -2 1286
a 396 1376 a Fk(In)g(an)g(open)f(source)h(setting,)g(we)g(do)g(this)h
(w)o(ork)e(in)i(public.)e(There')-5 b(s)20 b(no)f("let')-5
b(s)21 b(open)f(the)g(code")f(moment.)g(Projects)396
1484 y(that)i(do)e(this)i(are)f(in)h(my)e(vie)n(w)h(missing)h(the)f
(point)f(of)h(open)f(source,)g(which)h(is)h(to)g(engage)d(your)h(users)
h(in)h(your)396 1592 y(e)o(xploration,)d(and)h(to)i(b)n(uild)e
(community)f(around)h(the)h(seed)g(of)g(the)g(architecture.)-2
1703 y
SDict begin H.S end
 -2 1703 a -2 1703 a
SDict begin 13 H.A end
 -2 1703 a -2 1703 a
SDict begin [/View [/XYZ H.V]/Dest (0:3891) cvn /DEST pdfmark end
 -2 1703
a 359 x Fn(6.5.)39 b(Messa)o(g)q(e)f(Oriented)g(P)l(attern)f(f)m(or)j
(Elastic)e(Design)3293 2062 y
SDict begin H.S end
 3293 2062 a 3293 2062 a
SDict begin 22.464 H.A end

3293 2062 a 3293 2062 a
SDict begin [/View [/XYZ H.V]/Dest (11.79.1) cvn /DEST pdfmark end
 3293 2062 a -2 2260 a
SDict begin H.S end
 -2 2260
a -2 2260 a
SDict begin 13 H.A end
 -2 2260 a -2 2260 a
SDict begin [/View [/XYZ H.V]/Dest (0:3893) cvn /DEST pdfmark end
 -2 2260 a 396 2336 a
Fk(No)n(w)20 b(I')o(ll)h(introduce)d(MOPED,)i(which)g(is)h(a)g(SOD)f
(pattern)g(custom-designed)d(for)j(\330MQ)g(architectures.)f(It)h(w)o
(as)396 2444 y(either)g(MOPED)g(or)g(BIKE,)h(the)f(Backron)o
(ym-Induced)15 b(Kinetic)20 b(Ef)n(fect.)f(That')-5 b(s)20
b(short)g(for)g(BICICLE,)g(the)396 2552 y(Backron)o(ym-In\003ated)c
(See)21 b(if)g(I)f(Care)g(Less)h(Ef)n(fect.)f(In)g(life,)g(one)f
(learns)h(to)h(go)e(with)i(the)f(least)h(embarrassing)396
2660 y(choices.)-2 2827 y
SDict begin H.S end
 -2 2827 a -2 2827 a
SDict begin 13 H.A end
 -2 2827
a -2 2827 a
SDict begin [/View [/XYZ H.V]/Dest (0:3894) cvn /DEST pdfmark end
 -2 2827 a 396 2934 a Fk(Speaking)e(of)h(embarrassments,)e
(just)j(as)g(\330MQ)f(lets)h(us)g(aim)f(for)g(really)g(massi)n(v)o(e)g
(architectures,)e(it)j(also,)f(lik)o(e)h(an)o(y)396 3042
y(technology)d(that)i(remo)o(v)o(es)f(friction,)g(opens)g(the)h(door)f
(to)i(truly)e(massi)n(v)o(e)h(blunders.)f(If)h(\330MQ)g(is)h(the)f(A)m
(CME)396 3150 y(rock)o(et-propelled)d(shoe)j(of)g(distrib)n(uted)f
(softw)o(are)h(de)n(v)o(elopment,)d(a)j(lot)h(of)f(us)g(are)g(lik)o(e)h
(W)m(ile)g(E.)f(Co)o(yote,)g(slamming)396 3258 y(full)g(speed)g(into)g
(the)g(pro)o(v)o(erbial)e(desert)i(clif)n(f.)-2 3442
y
SDict begin H.S end
 -2 3442 a -2 3442 a
SDict begin 13 H.A end
 -2 3442 a -2 3442 a
SDict begin [/View [/XYZ H.V]/Dest (0:3895) cvn /DEST pdfmark end
 -2 3442 a 396
3532 a Fk(So)h(MOPED)f(is)h(meant)f(to)g(sa)n(v)o(e)h(us)f(from)f(such)
h(mistak)o(es.)g(P)o(artly)g(it')-5 b(s)22 b(about)d(slo)n(wing)g(do)n
(wn,)g(partly)h(it')-5 b(s)21 b(about)396 3640 y(ensuring)e(that)h
(when)g(you)f(mo)o(v)o(e)g(f)o(ast,)h(you)g(go)f(-)i(and)f(this)g(is)h
(essential,)g(dear)e(reader)h(-)g(in)g(the)3188 3640
y
SDict begin H.S end
 3188 3640 a 3188 3640 a
SDict begin 13 H.A end
 3188 3640 a 3188 3640 a
SDict begin [/View [/XYZ H.V]/Dest (0:3896) cvn /DEST pdfmark end
 3188
3640 a Ff(right)g(dir)m(ection)p Fk(.)f(It')-5 b(s)396
3748 y(my)20 b(standard)f(intervie)n(w)g(riddle:)h(what')-5
b(s)20 b(the)h(rarest)f(property)e(of)i(an)o(y)f(softw)o(are)h(system,)
g(the)g(absolute)g(hardest)396 3856 y(thing)g(to)g(get)g(right,)g(the)g
(lack)g(of)g(which)f(causes)i(the)f(slo)n(w)h(or)f(f)o(ast)g(death)g
(of)g(the)g(v)n(ast)g(majority)g(of)f(projects?)h(The)396
3964 y(answer)g(is)h(not)f(code)g(quality)-5 b(,)18 b(funding,)g
(performance,)f(or)j(e)n(v)o(en)f(\(though)f(it')-5 b(s)22
b(a)e(close)h(answer\),)e(popularity)-5 b(.)17 b(The)396
4071 y(answer)j(is)h("accurac)o(y".)-2 4255 y
SDict begin H.S end
 -2 4255
a -2 4255 a
SDict begin 13 H.A end
 -2 4255 a -2 4255 a
SDict begin [/View [/XYZ H.V]/Dest (0:3897) cvn /DEST pdfmark end
 -2 4255 a 396 4345 a
Fk(If)f(you')l(v)o(e)e(read)i(the)g(Guide)g(observ)n(antly)e(you')o(ll)
h(ha)n(v)o(e)h(seen)g(MOPED)g(in)h(action)e(already)-5
b(.)19 b(The)h(de)n(v)o(elopment)d(of)396 4453 y(Majordomo)h(in)i
(Chapter)g(4)g(is)h(a)g(near)n(-perfect)d(case.)i(But)h(cute)f(names)g
(are)g(w)o(orth)g(a)g(thousand)f(w)o(ords.)-2 4637 y
SDict begin H.S end

-2 4637 a -2 4637 a
SDict begin 13 H.A end
 -2 4637 a -2 4637 a
SDict begin [/View [/XYZ H.V]/Dest (0:3898) cvn /DEST pdfmark end
 -2 4637 a 396
4727 a Fk(The)h(goal)g(of)g(MOPED)g(is)h(to)g(de\002ne)e(a)i(process,)e
(a)i(pattern)e(by)h(which)g(we)g(can)g(tak)o(e)g(a)h(rough)e(use)h
(case)h(for)e(a)i(ne)n(w)396 4835 y(distrib)n(uted)f(application,)e
(and)i(go)f(from)h("hello)f(w)o(orld")h(to)g(fully-w)o(orking)d
(prototype)h(in)i(an)o(y)g(language)e(in)j(under)d(a)396
4943 y(week.)p Black 3759 5569 a Ff(328)p Black eop end
%%Page: 329 342
TeXDict begin 329 341 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.329) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:3927) cvn /DEST pdfmark end
 -2 -201 a 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3899) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Using)h(MOPED,)g(you)g(gro)n(w)-5 b(,)18
b(more)i(than)f(b)n(uild,)h(a)h(w)o(orking)d(\330MQ)j(architecture)d
(from)h(the)i(ground-up,)16 b(with)396 180 y(minimal)k(risk)g(of)g(f)o
(ailure.)f(By)i(focusing)e(on)g(the)i(contracts,)e(rather)g(than)h(the)
g(implementations,)e(you)h(a)n(v)n(oid)h(the)h(risk)396
288 y(of)f(premature)e(optimization.)h(By)h(dri)n(ving)f(the)h(design)g
(process)f(through)f(ultra-short)h(test-based)h(c)o(ycles,)g(you)f(can)
396 396 y(be)h(more)g(certain)f(what)i(you)e(ha)n(v)o(e)g(w)o(orks,)h
(before)f(you)g(add)h(more.)-2 580 y
SDict begin H.S end
 -2 580 a -2 580
a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:3900) cvn /DEST pdfmark end
 -2 580 a 396 670 a Fk(W)-7 b(e)22
b(can)e(turn)f(this)i(into)f(\002)n(v)o(e)g(real)g(steps:)-2
688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:3901) cvn /DEST pdfmark end
 -2 688 a -2
698 a
SDict begin H.S end
 -2 698 a -2 698 a
SDict begin 13 H.A end
 -2 698 a -2 698 a
SDict begin [/View [/XYZ H.V]/Dest (0:3902) cvn /DEST pdfmark end
 -2 698 a Black
396 840 a Fj(\225)p Black 479 840 a
SDict begin H.S end
 479 840 a 479 840
a
SDict begin 13 H.A end
 479 840 a 479 840 a
SDict begin [/View [/XYZ H.V]/Dest (0:3903) cvn /DEST pdfmark end
 479 840 a Fk(Step)h(1:)f(internalize)f(the)h
(\330MQ)h(semantics.)-2 858 y
SDict begin H.S end
 -2 858 a -2 858 a
SDict begin 13 H.A end
 -2 858
a -2 858 a
SDict begin [/View [/XYZ H.V]/Dest (0:3904) cvn /DEST pdfmark end
 -2 858 a Black 396 990 a Fj(\225)p Black 479
990 a
SDict begin H.S end
 479 990 a 479 990 a
SDict begin 13 H.A end
 479 990 a 479 990 a
SDict begin [/View [/XYZ H.V]/Dest (0:3905) cvn /DEST pdfmark end
 479 990
a Fk(Step)g(2:)f(dra)o(w)f(a)i(rough)e(architecture.)-2
1008 y
SDict begin H.S end
 -2 1008 a -2 1008 a
SDict begin 13 H.A end
 -2 1008 a -2 1008 a
SDict begin [/View [/XYZ H.V]/Dest (0:3906) cvn /DEST pdfmark end
 -2 1008
a Black 396 1139 a Fj(\225)p Black 479 1139 a
SDict begin H.S end
 479 1139
a 479 1139 a
SDict begin 13 H.A end
 479 1139 a 479 1139 a
SDict begin [/View [/XYZ H.V]/Dest (0:3907) cvn /DEST pdfmark end
 479 1139 a Fk(Step)i(3:)f(decide)f
(on)h(the)g(contracts.)-2 1157 y
SDict begin H.S end
 -2 1157 a -2 1157 a
SDict begin 13 H.A end

-2 1157 a -2 1157 a
SDict begin [/View [/XYZ H.V]/Dest (0:3908) cvn /DEST pdfmark end
 -2 1157 a Black 396 1289 a Fj(\225)p
Black 479 1289 a
SDict begin H.S end
 479 1289 a 479 1289 a
SDict begin 13 H.A end
 479 1289 a 479
1289 a
SDict begin [/View [/XYZ H.V]/Dest (0:3909) cvn /DEST pdfmark end
 479 1289 a Fk(Step)h(4:)f(mak)o(e)g(a)g(minimal)g(end-to-end)d
(solution.)-2 1307 y
SDict begin H.S end
 -2 1307 a -2 1307 a
SDict begin 13 H.A end
 -2 1307 a -2
1307 a
SDict begin [/View [/XYZ H.V]/Dest (0:3910) cvn /DEST pdfmark end
 -2 1307 a Black 396 1438 a Fj(\225)p Black 479
1438 a
SDict begin H.S end
 479 1438 a 479 1438 a
SDict begin 13 H.A end
 479 1438 a 479 1438 a
SDict begin [/View [/XYZ H.V]/Dest (0:3911) cvn /DEST pdfmark end
 479
1438 a Fk(Step)k(5:)f(solv)o(e)g(one)f(problem)g(and)h(repeat.)-2
1456 y
SDict begin H.S end
 -2 1456 a -2 1456 a
SDict begin 13 H.A end
 -2 1456 a -2 1456 a
SDict begin [/View [/XYZ H.V]/Dest (0:3912) cvn /DEST pdfmark end
 -2 1456
a 396 1766 a Fb(6.5.1.)36 b(Step)d(1:)g(Internaliz)q(e)i(the)f
(Semantics)2595 1766 y
SDict begin H.S end
 2595 1766 a 2595 1766 a
SDict begin 18.72 H.A end
 2595 1766
a 2595 1766 a
SDict begin [/View [/XYZ H.V]/Dest (11.79.31.2) cvn /DEST pdfmark end
 2595 1766 a -2 1957 a
SDict begin H.S end
 -2 1957 a -2 1957
a
SDict begin 13 H.A end
 -2 1957 a -2 1957 a
SDict begin [/View [/XYZ H.V]/Dest (0:3914) cvn /DEST pdfmark end
 -2 1957 a 396 2040 a Fk(T)-7 b(o)21
b(repeat)e(myself:)h(you)f(must)i(learn)e(\330MQ')-5
b(s)21 b(language.)d(The)i(only)g(w)o(ay)g(to)g(learn)g(a)g(language)f
(is)i(to)f(use)h(it.)f(There')-5 b(s)396 2148 y(no)20
b(w)o(ay)g(to)h(a)n(v)n(oid)f(this)g(in)m(v)o(estment,)f(no)g(tapes)i
(you)e(can)h(play)g(while)g(you)f(sleep,)h(no)g(chips)g(you)f(can)h
(plug)g(in)g(to)396 2256 y(magically)f(become)g(smarter)-5
b(.)20 b(Read)h(the)f(Guide,)f(w)o(ork)h(through)e(the)i(code)g(e)o
(xamples,)e(understand)g(what')-5 b(s)21 b(going)396
2364 y(on,)f(and)f(\(most)h(importantly\))e(write)j(some)f(e)o(xamples)
f(yourself,)f(and)i(then)2646 2364 y
SDict begin H.S end
 2646 2364 a 2646
2364 a
SDict begin 13 H.A end
 2646 2364 a 2646 2364 a
SDict begin [/View [/XYZ H.V]/Dest (0:3915) cvn /DEST pdfmark end
 2646 2364 a Ff(thr)l(ow)g(them)g(away)p
Fk(.)-2 2548 y
SDict begin H.S end
 -2 2548 a -2 2548 a
SDict begin 13 H.A end
 -2 2548 a -2 2548
a
SDict begin [/View [/XYZ H.V]/Dest (0:3916) cvn /DEST pdfmark end
 -2 2548 a 396 2638 a Fk(At)h(a)g(certain)e(point)h(you')o(ll)f(feel)h
(a)h(clicking)e(noise)h(in)g(your)f(brain.)h(Maybe)f(you')o(ll)g(ha)n
(v)o(e)h(a)g(weird)g(chili-induced)396 2746 y(dream)f(where)h(little)h
(\330MQ)g(tasks)f(run)g(around)e(trying)h(to)h(eat)h(you)e(ali)n(v)o
(e.)h(Maybe)f(you')o(ll)g(just)i(think)f("aaahh,)f(so)396
2854 y
SDict begin H.S end
 396 2854 a 396 2854 a
SDict begin 13 H.A end
 396 2854 a 396 2854 a
SDict begin [/View [/XYZ H.V]/Dest (0:3917) cvn /DEST pdfmark end
 396
2854 a Ff(that')m(s)h Fk(what)g(it)h(means!")e(If)h(we)h(did)f(our)f(w)
o(ork)h(right,)f(it)i(should)e(tak)o(e)h(2-3)g(days.)f(Ho)n(we)n(v)o
(er)g(long)g(it)i(tak)o(es,)g(until)f(you)396 2962 y(start)h(thinking)e
(in)h(terms)g(of)g(\330MQ)g(sock)o(ets)h(and)e(patterns,)h(you')l(re)e
(not)i(ready)f(for)h(step)g(2.)-2 2990 y
SDict begin H.S end
 -2 2990 a -2
2990 a
SDict begin 13 H.A end
 -2 2990 a -2 2990 a
SDict begin [/View [/XYZ H.V]/Dest (0:3918) cvn /DEST pdfmark end
 -2 2990 a 396 3300 a Fb(6.5.2.)36
b(Step)d(2:)g(Dra)n(w)h(a)g(Rough)g(Ar)n(c)o(hitecture)2696
3300 y
SDict begin H.S end
 2696 3300 a 2696 3300 a
SDict begin 18.72 H.A end
 2696 3300 a 2696 3300
a
SDict begin [/View [/XYZ H.V]/Dest (11.79.32.2) cvn /DEST pdfmark end
 2696 3300 a -2 3493 a
SDict begin H.S end
 -2 3493 a -2 3493 a
SDict begin 13 H.A end
 -2 3493 a
-2 3493 a
SDict begin [/View [/XYZ H.V]/Dest (0:3920) cvn /DEST pdfmark end
 -2 3493 a 396 3574 a Fk(Whiteboard)18 b(time.)i(Get)g(a)g
(couple)f(of)g(colleagues)g(and)g(try)h(to)f(dra)o(w)g(your)g
(architecture)f(on)h(a)h(whiteboard.)e(you)h(w)o(ant)396
3682 y(to)i(dra)o(w)e(box)o(es)g(connected)g(with)h(arro)n(ws,)f(sho)n
(wing)g(the)i(\003o)n(w)f(of)g(w)o(ork,)f(data,)h(results,)g(etc.)g
(Since)h(we)f(li)n(v)o(e)g(in)h(a)396 3790 y(gra)n(vity)f(well,)g(it')
-5 b(s)21 b(best)g(to)f(dra)o(w)g(the)g(main)g(arro)n(ws)f(going)g(do)n
(wn.)g(Almost)h(all)h(architectures)e(ha)n(v)o(e)h(a)3416
3790 y
SDict begin H.S end
 3416 3790 a 3416 3790 a
SDict begin 13 H.A end
 3416 3790 a 3416 3790
a
SDict begin [/View [/XYZ H.V]/Dest (0:3921) cvn /DEST pdfmark end
 3416 3790 a Ff(dir)m(ection)p Fk(,)f(and)396 3898 y(a)i(certain)f
(symmetry)-5 b(,)18 b(and)h(what)i(you)e(w)o(ant)h(to)g(do)g(is)h
(capture)e(that)i(as)g(simply)e(and)h(cleanly)g(as)h(you)e(can.)-2
4082 y
SDict begin H.S end
 -2 4082 a -2 4082 a
SDict begin 13 H.A end
 -2 4082 a -2 4082 a
SDict begin [/View [/XYZ H.V]/Dest (0:3922) cvn /DEST pdfmark end
 -2 4082
a 396 4172 a Fk(Ignore)g(an)o(ything)f(that')-5 b(s)20
b(not)g(central)g(to)g(the)h(core)e(problem.)f(Ignore)h(logging,)f
(error)h(handling,)f(reco)o(v)o(ery)g(from)396 4280 y(f)o(ailures,)i
(etc.)g(What)h(you)e(lea)n(v)o(e)h(out)g(is)h(as)g(important)e(as)i
(what)f(you)f(capture:)g(you)g(can)h(al)o(w)o(ays)h(add,)e(b)n(ut)i
(it')-5 b(s)21 b(v)o(ery)396 4388 y(hard)f(to)g(remo)o(v)o(e.)e(When)i
(you)f(ha)n(v)o(e)h(a)g(simple,)g(clean)g(dra)o(wing,)f(you')l(re)f
(ready)h(for)h(step)g(3.)-2 4416 y
SDict begin H.S end
 -2 4416 a -2 4416
a
SDict begin 13 H.A end
 -2 4416 a -2 4416 a
SDict begin [/View [/XYZ H.V]/Dest (0:3923) cvn /DEST pdfmark end
 -2 4416 a 396 4726 a Fb(6.5.3.)36
b(Step)d(3:)g(Decide)j(on)d(the)h(Contracts)2535 4726
y
SDict begin H.S end
 2535 4726 a 2535 4726 a
SDict begin 18.72 H.A end
 2535 4726 a 2535 4726 a
SDict begin [/View [/XYZ H.V]/Dest (11.79.33.2) cvn /DEST pdfmark end
 2535
4726 a -2 4917 a
SDict begin H.S end
 -2 4917 a -2 4917 a
SDict begin 13 H.A end
 -2 4917 a -2 4917
a
SDict begin [/View [/XYZ H.V]/Dest (0:3925) cvn /DEST pdfmark end
 -2 4917 a 396 5000 a Fk(Human)19 b(scale)i(depends)e(on)h(contracts,)
f(and)h(the)g(more)f(e)o(xplicit)h(the)o(y)f(are,)h(the)g(better)g
(things)g(scale.)g(Y)-9 b(ou)20 b(don')o(t)e(care)396
5108 y
SDict begin H.S end
 396 5108 a 396 5108 a
SDict begin 13 H.A end
 396 5108 a 396 5108 a
SDict begin [/View [/XYZ H.V]/Dest (0:3926) cvn /DEST pdfmark end
 396
5108 a Ff(how)i Fk(things)g(happen,)e(only)i(the)g(results.)g(If)g(I)h
(send)f(an)g(email,)g(I)g(don')o(t)f(care)h(ho)n(w)f(it)i(arri)n(v)o
(es)f(at)g(its)h(destination,)e(so)p Black 3759 5569
a Ff(329)p Black eop end
%%Page: 330 343
TeXDict begin 330 342 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.330) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(long)h(as)h(the)f(contract)f(\(it)h(arri)n(v)o(es)g
(within)g(a)g(fe)n(w)h(minutes,)e(it')-5 b(s)21 b(not)f(modi\002ed,)f
(it)i(doesn')o(t)d(get)j(lost\))f(is)h(respected.)396
346 y(And)f(to)g(b)n(uild)g(a)h(lar)o(ge)e(system)h(that)h(w)o(orks)e
(well,)i(you)e(must)h(focus)g(on)g(the)g(contracts,)f(before)g(the)396
454 y(implementations.)f(It)j(may)e(sound)g(ob)o(vious)f(b)n(ut)j(all)f
(too)g(often,)f(people)g(for)o(get)f(and)i(ignore)f(this,)h(or)g(are)g
(just)h(too)e(shy)396 562 y(to)i(impose)e(themselv)o(es.)g(I)i(wish)f
(I)h(could)e(say)h(\330MQ)h(had)f(done)f(this)h(properly)e(b)n(ut)j
(for)e(years)h(our)g(public)f(contracts)396 670 y(were)h(second-rate)f
(afterthoughts)f(instead)i(of)f(primary)g(in-your)n(-f)o(ace)f(pieces)i
(of)g(w)o(ork.)-2 854 y
SDict begin H.S end
 -2 854 a -2 854 a
SDict begin 13 H.A end
 -2 854 a -2
854 a
SDict begin [/View [/XYZ H.V]/Dest (0:3928) cvn /DEST pdfmark end
 -2 854 a 396 944 a Fk(So)h(what)f(is)h(a)g(contract)e(in)h(a)h
(distrib)n(uted)e(system?)h(There)g(are,)f(in)i(my)f(e)o(xperience,)d
(tw)o(o)k(types)f(of)g(contract:)-2 962 y
SDict begin H.S end
 -2 962 a -2
962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:3929) cvn /DEST pdfmark end
 -2 962 a -2 972 a
SDict begin H.S end
 -2 972 a -2
972 a
SDict begin 13 H.A end
 -2 972 a -2 972 a
SDict begin [/View [/XYZ H.V]/Dest (0:3930) cvn /DEST pdfmark end
 -2 972 a Black 396 1114 a Fj(\225)p
Black 479 1114 a
SDict begin H.S end
 479 1114 a 479 1114 a
SDict begin 13 H.A end
 479 1114 a 479
1114 a
SDict begin [/View [/XYZ H.V]/Dest (0:3931) cvn /DEST pdfmark end
 479 1114 a Fk(The)g(APIs)h(to)f(client)h(applications.)d
(Remember)h(the)i(Psychological)d(Elements.)i(The)f(APIs)i(need)f(to)g
(be)g(as)479 1222 y(absolutely)841 1222 y
SDict begin H.S end
 841 1222 a
841 1222 a
SDict begin 13 H.A end
 841 1222 a 841 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:3932) cvn /DEST pdfmark end
 841 1222 a Ff(simple)p
Fk(,)1099 1222 y
SDict begin H.S end
 1099 1222 a 1099 1222 a
SDict begin 13 H.A end
 1099 1222 a
1099 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:3933) cvn /DEST pdfmark end
 1099 1222 a Ff(consistent)q Fk(,)g(and)1615
1222 y
SDict begin H.S end
 1615 1222 a 1615 1222 a
SDict begin 13 H.A end
 1615 1222 a 1615 1222
a
SDict begin [/View [/XYZ H.V]/Dest (0:3934) cvn /DEST pdfmark end
 1615 1222 a Ff(familiar)i Fk(as)f(possible.)e(Y)-8
b(es,)20 b(you)g(can)f(generate)g(API)i(documentation)c(from)479
1330 y(code,)j(b)n(ut)g(you)f(must)h(\002rst)h(design)f(it,)g(and)g
(designing)f(an)h(API)g(is)h(often)f(hard.)-2 1348 y
SDict begin H.S end

-2 1348 a -2 1348 a
SDict begin 13 H.A end
 -2 1348 a -2 1348 a
SDict begin [/View [/XYZ H.V]/Dest (0:3935) cvn /DEST pdfmark end
 -2 1348 a Black
396 1480 a Fj(\225)p Black 479 1480 a
SDict begin H.S end
 479 1480 a 479
1480 a
SDict begin 13 H.A end
 479 1480 a 479 1480 a
SDict begin [/View [/XYZ H.V]/Dest (0:3936) cvn /DEST pdfmark end
 479 1480 a Fk(The)g(protocols)f(that)h
(connect)f(the)h(pieces.)g(It)h(sounds)e(lik)o(e)i(rock)o(et)e
(science,)h(b)n(ut)g(it')-5 b(s)21 b(really)f(just)h(a)g(simple)f
(trick,)479 1588 y(and)g(one)g(that)g(\330MQ)g(mak)o(es)g(particularly)
f(easy)-5 b(.)19 b(In)h(f)o(act)h(the)o(y')l(re)d(so)j(simple)f(to)g
(write,)g(and)g(need)g(so)g(little)479 1696 y(b)n(ureaucrac)o(y)e(that)
i(I)g(call)h(them)f("unprotocols".)-2 1880 y
SDict begin H.S end
 -2 1880
a -2 1880 a
SDict begin 13 H.A end
 -2 1880 a -2 1880 a
SDict begin [/View [/XYZ H.V]/Dest (0:3937) cvn /DEST pdfmark end
 -2 1880 a 396 1970 a
Fk(Y)-9 b(ou)20 b(write)g(minimal)g(contracts)f(that)i(are)f(mostly)f
(just)i(place)f(mark)o(ers.)f(Most)i(messages)f(and)g(most)g(API)g
(methods)396 2077 y(will)h(be)f(missing,)g(or)g(empty)-5
b(.)19 b(Y)-9 b(ou)19 b(also)i(w)o(ant)f(to)h(write)f(do)n(wn)f(an)o(y)
g(kno)n(wn)g(technical)h(requirements)e(in)i(terms)g(of)396
2185 y(throughput,)d(latenc)o(y)-5 b(,)19 b(reliability)-5
b(,)19 b(etc.)h(These)g(are)g(the)g(criteria)g(on)g(which)g(you)f(will)
i(accept,)f(or)f(reject,)h(an)o(y)396 2293 y(particular)f(piece)h(of)g
(w)o(ork.)-2 2322 y
SDict begin H.S end
 -2 2322 a -2 2322 a
SDict begin 13 H.A end
 -2 2322 a -2
2322 a
SDict begin [/View [/XYZ H.V]/Dest (0:3938) cvn /DEST pdfmark end
 -2 2322 a 396 2632 a Fb(6.5.4.)36 b(Step)d(4:)g(Write)h(a)f
(Minimal)i(End-to-End)d(Solution)3226 2632 y
SDict begin H.S end
 3226 2632
a 3226 2632 a
SDict begin 18.72 H.A end
 3226 2632 a 3226 2632 a
SDict begin [/View [/XYZ H.V]/Dest (11.79.34.2) cvn /DEST pdfmark end
 3226 2632 a -2
2823 a
SDict begin H.S end
 -2 2823 a -2 2823 a
SDict begin 13 H.A end
 -2 2823 a -2 2823 a
SDict begin [/View [/XYZ H.V]/Dest (0:3940) cvn /DEST pdfmark end
 -2 2823
a 396 2906 a Fk(The)20 b(goal)g(is)h(to)f(test)h(out)f(the)g(o)o(v)o
(erall)f(architecture)g(as)i(rapidly)e(as)i(possible.)e(Mak)o(e)h(sk)o
(eleton)g(applications)f(that)h(call)396 3014 y(the)g(APIs,)h(and)f(sk)
o(eleton)f(stacks)i(that)f(implement)f(both)h(sides)g(of)g(e)n(v)o(ery)
f(protocol.)f(Y)-9 b(ou)20 b(w)o(ant)g(to)h(get)f(a)g(w)o(orking)396
3122 y(end-to-end)e("hello)h(w)o(orld")h(as)h(soon)e(as)i(you)f(can.)f
(Y)-9 b(ou)20 b(w)o(ant)g(to)h(be)f(able)g(to)g(test)h(code,)e(as)i
(you)f(write)g(it,)h(to)396 3230 y(weed-out)e(the)h(brok)o(en)f
(assumptions)g(and)h(ine)n(vitable)f(errors)g(you)g(mak)o(e.)h(Do)g
(not)g(go)g(of)n(f)f(and)h(spend)f(six)i(months)396 3337
y(writing)f(a)g(test)i(suite!)e(Instead,)f(mak)o(e)h(a)g(minimal)g
(bare-bones)e(application)h(that)h(uses)h(our)e(still-hypothetical)f
(API.)-2 3522 y
SDict begin H.S end
 -2 3522 a -2 3522 a
SDict begin 13 H.A end
 -2 3522 a -2 3522
a
SDict begin [/View [/XYZ H.V]/Dest (0:3941) cvn /DEST pdfmark end
 -2 3522 a 396 3611 a Fk(If)i(you)g(design)f(an)h(API)h(wearing)e(the)
h(hat)g(of)g(the)g(person)g(who)f(implements)g(it,)i(you')o(ll)e(start)
i(to)f(think)g(of)396 3719 y(performance,)d(features,)j(options,)f(and)
g(so)i(on.)e(Y)-9 b(ou')o(ll)20 b(mak)o(e)g(it)h(more)e(comple)o(x,)f
(more)h(irre)o(gular)m(,)f(and)i(more)396 3827 y(surprising)f(than)g
(it)h(should)f(be.)g(But,)h(and)f(here')-5 b(s)20 b(the)g(trick)f
(\(it')-5 b(s)21 b(a)f(cheap)f(one,)g(w)o(as)h(big)f(in)h(Japan\),)f
(if)h(you)f(design)g(an)396 3935 y(API)i(while)f(wearing)f(the)h(hat)h
(of)e(the)i(poor)e(suck)o(er)g(who)h(has)g(to)h(actually)e(write)i
(apps)f(that)g(use)g(it,)h(you)e(use)i(all)f(that)396
4043 y(laziness)h(and)f(fear)f(to)i(our)e(adv)n(antage.)-2
4227 y
SDict begin H.S end
 -2 4227 a -2 4227 a
SDict begin 13 H.A end
 -2 4227 a -2 4227 a
SDict begin [/View [/XYZ H.V]/Dest (0:3942) cvn /DEST pdfmark end
 -2 4227
a 396 4317 a Fk(Write)i(do)n(wn)e(the)h(protocols,)f(on)h(a)g(wiki)h
(or)f(shared)f(document,)f(in)i(such)g(a)h(w)o(ay)f(that)g(you)g(can)g
(e)o(xplain)f(e)n(v)o(ery)396 4425 y(command)f(clearly)i(without)g(too)
f(much)h(detail.)g(Strip)g(of)n(f)f(an)o(y)h(real)g(functionality)-5
b(,)17 b(because)j(it')o(ll)h(create)f(inertia)g(that)396
4533 y(just)g(mak)o(es)g(it)g(harder)e(to)i(mo)o(v)o(e)e(stuf)n(f)i
(around.)d(Y)-9 b(ou)19 b(can)h(al)o(w)o(ays)g(add)f(weight.)g(Don')o
(t)f(spend)h(ef)n(fort)g(de\002ning)f(formal)396 4641
y(message)i(structures:)g(pass)h(the)f(minimum)f(around,)f(in)i(the)g
(simplest)h(possible)f(f)o(ashion,)f(using)g(\330MQ')-5
b(s)21 b(multi-part)396 4749 y(framing.)-2 4933 y
SDict begin H.S end
 -2
4933 a -2 4933 a
SDict begin 13 H.A end
 -2 4933 a -2 4933 a
SDict begin [/View [/XYZ H.V]/Dest (0:3943) cvn /DEST pdfmark end
 -2 4933 a 396 5023
a Fk(Our)e(goal)h(is)g(to)g(get)f(the)h(simplest)g(test)g(case)g(w)o
(orking,)e(without)g(an)o(y)h(a)n(v)n(oidable)g(functionality)-5
b(.)17 b(Ev)o(erything)f(you)j(can)396 5131 y(chop)g(of)n(f)h(the)g
(list)h(of)f(things)g(to)g(do,)g(you)f(chop.)g(Ignore)g(the)h(groans)f
(from)g(colleagues)g(and)h(bosses.)g(I')o(ll)g(repeat)g(this)p
Black 3759 5569 a Ff(330)p Black eop end
%%Page: 331 344
TeXDict begin 331 343 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.331) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(once)h(again:)f(you)g(can)1078 72 y
SDict begin H.S end

1078 72 a 1078 72 a
SDict begin 13 H.A end
 1078 72 a 1078 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3944) cvn /DEST pdfmark end
 1078 72 a Ff(always)i
Fk(add)e(functionality)-5 b(,)18 b(that')-5 b(s)20 b(relati)n(v)o(ely)f
(easy)-5 b(.)20 b(But)h(aim)f(to)g(k)o(eep)g(the)g(o)o(v)o(erall)f
(weight)h(to)396 180 y(a)h(minimum.)-2 191 y
SDict begin H.S end
 -2 191 a
-2 191 a
SDict begin 13 H.A end
 -2 191 a -2 191 a
SDict begin [/View [/XYZ H.V]/Dest (0:3945) cvn /DEST pdfmark end
 -2 191 a 396 519 a Fb(6.5.5.)36
b(Step)d(5:)g(Solve)i(One)e(Pr)n(ob)o(lem)g(and)h(Repeat)2929
519 y
SDict begin H.S end
 2929 519 a 2929 519 a
SDict begin 18.72 H.A end
 2929 519 a 2929 519 a
SDict begin [/View [/XYZ H.V]/Dest (11.79.35.2) cvn /DEST pdfmark end
 2929
519 a -2 710 a
SDict begin H.S end
 -2 710 a -2 710 a
SDict begin 13 H.A end
 -2 710 a -2 710 a
SDict begin [/View [/XYZ H.V]/Dest (0:3947) cvn /DEST pdfmark end
 -2
710 a 396 793 a Fk(Y)-9 b(ou')l(re)19 b(no)n(w)g(in)i(the)f(Happ)o(y)f
(Loop)g(of)h(issue-dri)n(v)o(en)e(de)n(v)o(elopment)g(where)h(you)h
(can)g(start)g(to)h(solv)o(e)e(tangible)396 901 y(problems)f(instead)i
(of)f(adding)f(features.)h(Write)h(issues)h(that)f(state)g(a)g(clear)g
(problem,)d(and)i(propose)f(a)j(solution.)d(K)n(eep)396
1009 y(in)j(mind,)e(as)i(you)e(design)g(the)h(API,)h(your)e(standards)g
(for)g(names,)h(consistenc)o(y)-5 b(,)18 b(and)i(beha)n(vior)-5
b(.)18 b(Writing)i(these)h(do)n(wn)396 1117 y(in)g(prose)e(often)h
(helps)g(k)o(eep)f(them)h(sane.)-2 1301 y
SDict begin H.S end
 -2 1301 a -2
1301 a
SDict begin 13 H.A end
 -2 1301 a -2 1301 a
SDict begin [/View [/XYZ H.V]/Dest (0:3948) cvn /DEST pdfmark end
 -2 1301 a 396 1391 a Fk(From)g(here,)f(e)n
(v)o(ery)g(single)h(change)f(you)g(mak)o(e)h(to)g(the)h(architecture)d
(and)i(code)f(is)j(no)n(w)d(pro)o(v)o(en)f(by)i(running)e(the)i(test)
396 1499 y(case,)h(w)o(atching)e(it)i(not)f(w)o(ork,)f(making)g(the)h
(change,)f(and)g(then)h(w)o(atching)f(it)i(w)o(ork.)-2
1683 y
SDict begin H.S end
 -2 1683 a -2 1683 a
SDict begin 13 H.A end
 -2 1683 a -2 1683 a
SDict begin [/View [/XYZ H.V]/Dest (0:3949) cvn /DEST pdfmark end
 -2 1683
a 396 1773 a Fk(No)n(w)f(you)g(go)f(through)f(the)j(whole)e(c)o(ycle)h
(\(e)o(xtending)e(the)i(test)h(case,)f(\002xing)g(the)g(API,)g
(updating)f(the)h(protocol,)396 1880 y(e)o(xtending)e(the)i(code,)g(as)
h(needed\),)d(taking)h(problems)g(one)h(at)g(a)h(time)f(and)g(testing)g
(the)g(solutions)g(indi)n(vidually)-5 b(.)17 b(It)396
1988 y(should)i(tak)o(e)i(about)e(10-30)f(minutes)i(for)g(each)f(c)o
(ycle,)h(with)g(the)g(occasional)g(spik)o(e)g(due)f(to)i(random)d
(confusion.)-2 2100 y
SDict begin H.S end
 -2 2100 a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2
2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:3950) cvn /DEST pdfmark end
 -2 2100 a 359 x Fn(6.6.)39 b(Unpr)m(otocols)1122
2459 y
SDict begin H.S end
 1122 2459 a 1122 2459 a
SDict begin 22.464 H.A end
 1122 2459 a 1122 2459
a
SDict begin [/View [/XYZ H.V]/Dest (11.80.1) cvn /DEST pdfmark end
 1122 2459 a -2 2489 a
SDict begin H.S end
 -2 2489 a -2 2489 a
SDict begin 13 H.A end
 -2 2489 a
-2 2489 a
SDict begin [/View [/XYZ H.V]/Dest (0:3952) cvn /DEST pdfmark end
 -2 2489 a 396 2787 a Fb(6.6.1.)d(Wh)n(y)d(Unpr)n(otocols?)
1786 2787 y
SDict begin H.S end
 1786 2787 a 1786 2787 a
SDict begin 18.72 H.A end
 1786 2787 a 1786
2787 a
SDict begin [/View [/XYZ H.V]/Dest (11.80.36.2) cvn /DEST pdfmark end
 1786 2787 a -2 2978 a
SDict begin H.S end
 -2 2978 a -2 2978 a
SDict begin 13 H.A end
 -2 2978
a -2 2978 a
SDict begin [/View [/XYZ H.V]/Dest (0:3954) cvn /DEST pdfmark end
 -2 2978 a 396 3061 a Fk(When)20 b(this)h(man)f(thinks)f(of)
h(protocols,)f(this)i(man)e(thinks)h(of)g(massi)n(v)o(e)g(documents)e
(written)i(by)g(committees,)f(o)o(v)o(er)396 3169 y(years.)h(This)g
(man)g(thinks)g(of)g(the)g(IETF)-7 b(,)20 b(W3C,)h(ISO,)f(Oasis,)h(re)o
(gulatory)d(capture,)h(FRAND)i(patent)e(license)396 3277
y(disputes,)h(and)g(soon)f(after)m(,)g(this)i(man)f(thinks)g(of)g
(retirement)e(to)j(a)f(nice)h(little)g(f)o(arm)e(in)i(northern)d(Boli)n
(via)i(up)g(in)g(the)396 3385 y(mountains)f(where)h(the)g(only)f(other)
g(needlessly)h(stubborn)e(beings)i(are)g(the)g(goats)g(che)n(wing)f(up)
h(the)g(cof)n(fee)f(plants.)-2 3569 y
SDict begin H.S end
 -2 3569 a -2 3569
a
SDict begin 13 H.A end
 -2 3569 a -2 3569 a
SDict begin [/View [/XYZ H.V]/Dest (0:3955) cvn /DEST pdfmark end
 -2 3569 a 396 3659 a Fk(No)n(w)-5
b(,)20 b(I')l(v)o(e)f(nothing)f(personal)h(against)h(committees.)f(The)
h(useless)h(folk)e(need)h(a)h(place)e(to)i(sit)g(out)f(their)g(li)n(v)o
(es)g(with)396 3767 y(minimal)g(risk)g(of)g(reproducing,)d(after)j
(all,)g(that)g(only)g(seems)g(f)o(air)-5 b(.)21 b(But)f(most)h
(committee)e(protocols)g(tend)g(to)n(w)o(ards)396 3875
y(comple)o(xity)f(\(the)i(ones)g(that)g(w)o(ork\),)f(or)h(trash)g
(\(the)g(ones)g(we)h(don')o(t)d(talk)j(about\).)d(There')-5
b(s)20 b(a)h(fe)n(w)f(reasons)f(for)h(this.)396 3983
y(One)g(is)h(the)g(amount)d(of)i(mone)o(y)f(at)i(stak)o(e.)f(More)f
(mone)o(y)g(means)h(more)f(people)g(who)h(w)o(ant)g(their)g(particular)
396 4090 y(prejudices)f(and)h(assumptions)f(e)o(xpressed)g(in)h(prose.)
g(But)g(tw)o(o)h(is)g(the)f(lack)g(of)g(good)f(abstractions)g(on)h
(which)g(to)396 4198 y(b)n(uild.)g(People)g(ha)n(v)o(e)f(tried)h(to)g
(b)n(uild)g(reusable)g(protocol)e(abstractions,)h(lik)o(e)i(BEEP)-9
b(.)20 b(Most)g(did)g(not)g(stick,)g(and)g(those)396
4306 y(that)h(did,)e(lik)o(e)i(SO)m(AP)g(and)e(XMPP)-9
b(,)21 b(are)f(on)g(the)g(comple)o(x)e(side)j(of)f(things.)-2
4490 y
SDict begin H.S end
 -2 4490 a -2 4490 a
SDict begin 13 H.A end
 -2 4490 a -2 4490 a
SDict begin [/View [/XYZ H.V]/Dest (0:3956) cvn /DEST pdfmark end
 -2 4490
a 396 4580 a Fk(It)h(used)f(to)g(be,)g(decades)f(ago,)h(when)f(the)i
(Internet)e(w)o(as)i(a)f(young)f(modest)g(thing,)g(that)i(protocols)d
(were)i(short)g(and)396 4688 y(sweet.)h(The)o(y)e(weren')o(t)g(e)n(v)o
(en)g("standards",)g(b)n(ut)h("requests)g(for)f(comments",)g(which)h
(is)h(as)g(modest)e(as)i(you)e(can)h(get.)396 4796 y(It')-5
b(s)21 b(been)f(one)f(of)h(my)g(goals)g(since)g(we)h(started)f(iMatix)g
(in)h(1995)d(to)j(\002nd)f(a)g(w)o(ay)h(for)e(ordinary)f(people)h(lik)o
(e)i(me)f(to)396 4904 y(write)h(small,)f(accurate)f(protocols)g
(without)h(the)g(o)o(v)o(erhead)d(of)j(the)g(committees.)p
Black 3759 5569 a Ff(331)p Black eop end
%%Page: 332 345
TeXDict begin 332 344 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.332) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:3957) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(No)n(w)-5 b(,)20 b(\330MQ)g(does)g(appear)f(to)h(pro)
o(vide)f(a)h(li)n(ving,)f(successful)h(protocol)f(abstraction)g(layer)h
(with)g(its)h("we')o(ll)g(carry)396 180 y(multi-part)e(messages)h(o)o
(v)o(er)f(random)g(transports")g(w)o(ay)h(of)g(w)o(orking.)e(Since)i
(\330MQ)h(deals)f(silently)g(with)h(framing,)396 288
y(connections,)d(and)i(routing,)e(it')-5 b(s)22 b(surprisingly)c(easy)i
(to)h(write)f(full)g(protocol)f(specs)h(on)g(top)g(of)g(\330MQ,)g(and)g
(in)396 396 y(Chapters)g(four)f(and)h(\002)n(v)o(e)g(I)g(sho)n(wed)g
(ho)n(w)f(to)i(do)e(this.)-2 580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end

-2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:3958) cvn /DEST pdfmark end
 -2 580 a 396 670 a Fk(Some)n(where)g(around)f
(mid-2007,)g(I)i(kick)o(ed-of)n(f)e(the)i(Digital)g(Standards)f(Or)o
(ganization)f(to)i(de\002ne)g(ne)n(w)g(simpler)396 778
y(w)o(ays)g(of)g(producing)d(little)k(standards,)e(protocols,)f
(speci\002cations.)h(In)h(my)f(defense,)g(it)i(w)o(as)f(a)h(quiet)e
(summer)-5 b(.)19 b(At)i(the)396 886 y(time)565 886 y
SDict begin H.S end

565 886 a 565 886 a
SDict begin 13 H.A end
 565 886 a 565 886 a
SDict begin [/View [/XYZ H.V]/Dest (0:3959) cvn /DEST pdfmark end
 565 886 a Fk(I)f(wrote)g(that)g
(\(http://www)-5 b(.digistan.or)o(g/spec:1\))15 b(a)20
b(ne)n(w)g(speci\002cation)g(should)f(tak)o(e)h("minutes)g(to)g(e)o
(xplain,)396 994 y(hours)f(to)i(design,)e(days)h(to)g(write,)h(weeks)f
(to)g(pro)o(v)o(e,)e(months)h(to)i(become)e(mature,)g(and)g(years)h(to)
h(replace.")-2 1178 y
SDict begin H.S end
 -2 1178 a -2 1178 a
SDict begin 13 H.A end
 -2 1178 a -2
1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:3960) cvn /DEST pdfmark end
 -2 1178 a 396 1268 a Fk(In)f(2010)f(we)i(started)f(calling)f
(such)h(little)h(speci\002cations)f("unprotocols",)d(which)j(some)g
(people)f(might)h(mistak)o(e)g(for)396 1376 y(a)h(dastardly)e(plan)h
(for)f(w)o(orld)h(domination)e(by)i(a)g(shado)n(wy)f(international)g
(or)o(ganization,)d(b)n(ut)k(which)g(really)g(just)396
1484 y(means,)g("protocols)f(without)g(the)h(goats".)-2
1512 y
SDict begin H.S end
 -2 1512 a -2 1512 a
SDict begin 13 H.A end
 -2 1512 a -2 1512 a
SDict begin [/View [/XYZ H.V]/Dest (0:3961) cvn /DEST pdfmark end
 -2 1512
a 396 1822 a Fb(6.6.2.)36 b(Ho)n(w)d(to)h(Write)f(Unpr)n(otocols)2192
1822 y
SDict begin H.S end
 2192 1822 a 2192 1822 a
SDict begin 18.72 H.A end
 2192 1822 a 2192 1822
a
SDict begin [/View [/XYZ H.V]/Dest (11.80.37.2) cvn /DEST pdfmark end
 2192 1822 a -2 2013 a
SDict begin H.S end
 -2 2013 a -2 2013 a
SDict begin 13 H.A end
 -2 2013 a
-2 2013 a
SDict begin [/View [/XYZ H.V]/Dest (0:3963) cvn /DEST pdfmark end
 -2 2013 a 396 2096 a Fk(When)20 b(you)g(start)g(to)h(write)f
(an)g(unprotocol)e(speci\002cation)h(document,)f(stick)j(to)f(a)h
(consistent)e(structure)h(so)g(that)g(your)396 2204 y(readers)g(kno)n
(w)f(what)h(to)g(e)o(xpect.)f(Here)h(is)h(the)g(structure)e(I)h(use:)-2
2222 y
SDict begin H.S end
 -2 2222 a -2 2222 a
SDict begin 13 H.A end
 -2 2222 a -2 2222 a
SDict begin [/View [/XYZ H.V]/Dest (0:3964) cvn /DEST pdfmark end
 -2 2222
a -2 2232 a
SDict begin H.S end
 -2 2232 a -2 2232 a
SDict begin 13 H.A end
 -2 2232 a -2 2232 a
SDict begin [/View [/XYZ H.V]/Dest (0:3965) cvn /DEST pdfmark end
 -2
2232 a Black 396 2374 a Fj(\225)p Black 479 2374 a
SDict begin H.S end
 479
2374 a 479 2374 a
SDict begin 13 H.A end
 479 2374 a 479 2374 a
SDict begin [/View [/XYZ H.V]/Dest (0:3966) cvn /DEST pdfmark end
 479 2374 a Fk(Co)o(v)o(er)f
(section:)h(with)h(a)f(1-line)g(summary)-5 b(,)18 b(URL)j(to)f(the)g
(spec,)g(formal)g(name,)f(v)o(ersion,)g(who)g(to)i(blame.)-2
2392 y
SDict begin H.S end
 -2 2392 a -2 2392 a
SDict begin 13 H.A end
 -2 2392 a -2 2392 a
SDict begin [/View [/XYZ H.V]/Dest (0:3967) cvn /DEST pdfmark end
 -2 2392
a Black 396 2524 a Fj(\225)p Black 479 2524 a
SDict begin H.S end
 479 2524
a 479 2524 a
SDict begin 13 H.A end
 479 2524 a 479 2524 a
SDict begin [/View [/XYZ H.V]/Dest (0:3968) cvn /DEST pdfmark end
 479 2524 a Fk(License)f(for)g(the)g
(te)o(xt:)g(absolutely)f(needed)g(for)h(public)f(speci\002cations.)-2
2542 y
SDict begin H.S end
 -2 2542 a -2 2542 a
SDict begin 13 H.A end
 -2 2542 a -2 2542 a
SDict begin [/View [/XYZ H.V]/Dest (0:3969) cvn /DEST pdfmark end
 -2 2542
a Black 396 2673 a Fj(\225)p Black 479 2673 a
SDict begin H.S end
 479 2673
a 479 2673 a
SDict begin 13 H.A end
 479 2673 a 479 2673 a
SDict begin [/View [/XYZ H.V]/Dest (0:3970) cvn /DEST pdfmark end
 479 2673 a Fk(The)h(change)f
(process:)h(i.e.)g(ho)n(w)g(I)g(as)h(a)g(reader)e(\002x)h(problems)f
(in)h(the)g(speci\002cation?)-2 2691 y
SDict begin H.S end
 -2 2691 a -2 2691
a
SDict begin 13 H.A end
 -2 2691 a -2 2691 a
SDict begin [/View [/XYZ H.V]/Dest (0:3971) cvn /DEST pdfmark end
 -2 2691 a Black 396 2823 a Fj(\225)p
Black 479 2823 a
SDict begin H.S end
 479 2823 a 479 2823 a
SDict begin 13 H.A end
 479 2823 a 479
2823 a
SDict begin [/View [/XYZ H.V]/Dest (0:3972) cvn /DEST pdfmark end
 479 2823 a Fk(Use)h(of)f(language:)f(MUST)-6 b(,)20
b(MA)-9 b(Y)e(,)20 b(SHOULD,)h(etc.)f(with)g(a)h(reference)d(to)j(RFC)g
(2119.)-2 2841 y
SDict begin H.S end
 -2 2841 a -2 2841 a
SDict begin 13 H.A end
 -2 2841 a -2 2841
a
SDict begin [/View [/XYZ H.V]/Dest (0:3973) cvn /DEST pdfmark end
 -2 2841 a Black 396 2972 a Fj(\225)p Black 479 2972
a
SDict begin H.S end
 479 2972 a 479 2972 a
SDict begin 13 H.A end
 479 2972 a 479 2972 a
SDict begin [/View [/XYZ H.V]/Dest (0:3974) cvn /DEST pdfmark end
 479 2972
a Fk(Maturity)f(indicator:)f(is)i(this)f(a)h(e)o(xperimental,)d(draft,)
h(stable,)h(le)o(gac)o(y)-5 b(,)18 b(retired?)-2 2990
y
SDict begin H.S end
 -2 2990 a -2 2990 a
SDict begin 13 H.A end
 -2 2990 a -2 2990 a
SDict begin [/View [/XYZ H.V]/Dest (0:3975) cvn /DEST pdfmark end
 -2 2990 a Black
396 3122 a Fj(\225)p Black 479 3122 a
SDict begin H.S end
 479 3122 a 479
3122 a
SDict begin 13 H.A end
 479 3122 a 479 3122 a
SDict begin [/View [/XYZ H.V]/Dest (0:3976) cvn /DEST pdfmark end
 479 3122 a Fk(Goals)j(of)f(the)g
(protocol:)e(what)j(problems)d(is)j(it)g(trying)e(to)i(solv)o(e?)-2
3140 y
SDict begin H.S end
 -2 3140 a -2 3140 a
SDict begin 13 H.A end
 -2 3140 a -2 3140 a
SDict begin [/View [/XYZ H.V]/Dest (0:3977) cvn /DEST pdfmark end
 -2 3140
a Black 396 3271 a Fj(\225)p Black 479 3271 a
SDict begin H.S end
 479 3271
a 479 3271 a
SDict begin 13 H.A end
 479 3271 a 479 3271 a
SDict begin [/View [/XYZ H.V]/Dest (0:3978) cvn /DEST pdfmark end
 479 3271 a Fk(F)o(ormal)f(grammar:)e
(pre)n(v)o(ents)h(ar)o(guments)f(due)i(to)g(dif)n(ferent)f
(interpretation)f(of)i(the)g(te)o(xt.)-2 3289 y
SDict begin H.S end
 -2 3289
a -2 3289 a
SDict begin 13 H.A end
 -2 3289 a -2 3289 a
SDict begin [/View [/XYZ H.V]/Dest (0:3979) cvn /DEST pdfmark end
 -2 3289 a Black 396 3421
a Fj(\225)p Black 479 3421 a
SDict begin H.S end
 479 3421 a 479 3421 a
SDict begin 13 H.A end
 479
3421 a 479 3421 a
SDict begin [/View [/XYZ H.V]/Dest (0:3980) cvn /DEST pdfmark end
 479 3421 a Fk(T)-6 b(echnical)20 b(e)o(xplanation:)e
(semantics)i(of)g(each)g(message,)f(error)g(handling,)f(etc.)-2
3438 y
SDict begin H.S end
 -2 3438 a -2 3438 a
SDict begin 13 H.A end
 -2 3438 a -2 3438 a
SDict begin [/View [/XYZ H.V]/Dest (0:3981) cvn /DEST pdfmark end
 -2 3438
a Black 396 3570 a Fj(\225)p Black 479 3570 a
SDict begin H.S end
 479 3570
a 479 3570 a
SDict begin 13 H.A end
 479 3570 a 479 3570 a
SDict begin [/View [/XYZ H.V]/Dest (0:3982) cvn /DEST pdfmark end
 479 3570 a Fk(Security)i
(discussion:)g(e)o(xplicitly)-5 b(,)18 b(ho)n(w)i(secure)f(the)i
(protocol)d(is.)-2 3588 y
SDict begin H.S end
 -2 3588 a -2 3588 a
SDict begin 13 H.A end
 -2 3588
a -2 3588 a
SDict begin [/View [/XYZ H.V]/Dest (0:3983) cvn /DEST pdfmark end
 -2 3588 a Black 396 3719 a Fj(\225)p Black
479 3719 a
SDict begin H.S end
 479 3719 a 479 3719 a
SDict begin 13 H.A end
 479 3719 a 479 3719
a
SDict begin [/View [/XYZ H.V]/Dest (0:3984) cvn /DEST pdfmark end
 479 3719 a Fk(References:)i(to)g(other)g(documents,)e(protocols,)g
(etc.)-2 3903 y
SDict begin H.S end
 -2 3903 a -2 3903 a
SDict begin 13 H.A end
 -2 3903 a -2 3903
a
SDict begin [/View [/XYZ H.V]/Dest (0:3985) cvn /DEST pdfmark end
 -2 3903 a 396 3993 a Fk(Writing)i(clear)m(,)g(e)o(xpressi)n(v)o(e)e
(te)o(xt)i(is)i(hard.)d(Do)h(a)n(v)n(oid)g(trying)f(to)h(describe)g
(implementations)e(of)i(the)g(protocol.)396 4101 y(Remember)f(that)g
(you')l(re)f(writing)h(a)h(contract.)e(Y)-9 b(ou)19 b(describe)f(in)i
(clear)f(language)f(the)i(obligations)d(and)i(e)o(xpectations)396
4209 y(of)h(each)g(party)-5 b(,)19 b(the)h(le)n(v)o(el)g(of)g
(obligation,)e(and)h(the)h(penalties)g(for)g(breaking)e(the)i(rules.)g
(Y)-9 b(ou)20 b(do)g(not)f(try)h(to)h(de\002ne)396 4317
y
SDict begin H.S end
 396 4317 a 396 4317 a
SDict begin 13 H.A end
 396 4317 a 396 4317 a
SDict begin [/View [/XYZ H.V]/Dest (0:3986) cvn /DEST pdfmark end
 396 4317
a Ff(how)f Fk(each)g(party)g(honors)e(its)k(part)d(of)h(the)h(deal.)-2
4501 y
SDict begin H.S end
 -2 4501 a -2 4501 a
SDict begin 13 H.A end
 -2 4501 a -2 4501 a
SDict begin [/View [/XYZ H.V]/Dest (0:3987) cvn /DEST pdfmark end
 -2 4501
a 396 4591 a Fk(If)f(you)g(need)f(reference)g(material)g(to)i(start)f
(with,)h(read)e(the)h(http://rfc.zeromq.or)o(g)15 b(site,)21
b(which)f(has)g(a)h(b)n(unch)e(of)396 4699 y(unprotocols)f(that)i(you)g
(can)g(cop)o(y/paste)f(from.)-2 4883 y
SDict begin H.S end
 -2 4883 a -2 4883
a
SDict begin 13 H.A end
 -2 4883 a -2 4883 a
SDict begin [/View [/XYZ H.V]/Dest (0:3988) cvn /DEST pdfmark end
 -2 4883 a 396 4973 a Fk(Here)h(are)g(some)g(k)o
(e)o(y)g(points)g(about)f(unprotocols:)-2 4991 y
SDict begin H.S end
 -2 4991
a -2 4991 a
SDict begin 13 H.A end
 -2 4991 a -2 4991 a
SDict begin [/View [/XYZ H.V]/Dest (0:3989) cvn /DEST pdfmark end
 -2 4991 a -2 5001 a
SDict begin H.S end
 -2
5001 a -2 5001 a
SDict begin 13 H.A end
 -2 5001 a -2 5001 a
SDict begin [/View [/XYZ H.V]/Dest (0:3990) cvn /DEST pdfmark end
 -2 5001 a Black
3759 5569 a Ff(332)p Black eop end
%%Page: 333 346
TeXDict begin 333 345 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.333) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:3991) cvn /DEST pdfmark end
 479 72 a Fk(As)i(long)f(as)h(your)d
(process)i(is)h(open)f(then)f(you)h(don')o(t)e(need)i(a)g(committee:)f
(just)i(mak)o(e)f(clean)g(minimal)f(designs)479 180 y(and)h(mak)o(e)g
(sure)g(an)o(yone)e(is)j(free)f(to)g(impro)o(v)o(e)e(them.)-2
198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:3992) cvn /DEST pdfmark end
 -2 198 a Black
396 330 a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330
a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:3993) cvn /DEST pdfmark end
 479 330 a Fk(If)i(use)h(an)f(e)o(xisting)f
(license)i(then)e(you)h(don')o(t)e(ha)n(v)o(e)i(le)o(gal)f(w)o(orries)h
(afterw)o(ards.)f(I)i(use)f(GPLv3)g(for)f(my)h(public)479
438 y(speci\002cations)g(and)g(advise)g(you)f(to)h(do)g(the)g(same.)g
(F)o(or)g(in-house)f(w)o(ork,)g(standard)g(cop)o(yright)f(is)j
(perfect.)-2 456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456 a -2 456
a
SDict begin [/View [/XYZ H.V]/Dest (0:3994) cvn /DEST pdfmark end
 -2 456 a Black 396 587 a Fj(\225)p Black 479 587 a
SDict begin H.S end

479 587 a 479 587 a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:3995) cvn /DEST pdfmark end
 479 587 a Fk(The)f(formality)f
(is)i(v)n(aluable.)e(That)h(is,)h(learn)e(to)i(write)f(a)h(formal)e
(grammar)f(such)i(as)h(ABNF)g(\(Augmented)479 695 y(Backus-Naur)e(F)o
(orm\))g(and)h(use)g(this)h(to)f(fully)g(document)e(your)h(messages.)-2
713 y
SDict begin H.S end
 -2 713 a -2 713 a
SDict begin 13 H.A end
 -2 713 a -2 713 a
SDict begin [/View [/XYZ H.V]/Dest (0:3996) cvn /DEST pdfmark end
 -2 713 a Black
396 845 a Fj(\225)p Black 479 845 a
SDict begin H.S end
 479 845 a 479 845
a
SDict begin 13 H.A end
 479 845 a 479 845 a
SDict begin [/View [/XYZ H.V]/Dest (0:3997) cvn /DEST pdfmark end
 479 845 a Fk(Use)i(a)g(mark)o(et-dri)n(v)o(en)c
(life-c)o(ycle)i(process)g(lik)o(e)1921 845 y
SDict begin H.S end
 1921 845
a 1921 845 a
SDict begin 13 H.A end
 1921 845 a 1921 845 a
SDict begin [/View [/XYZ H.V]/Dest (0:3998) cvn /DEST pdfmark end
 1921 845 a Fk(Digistan')-5
b(s)20 b(COSS)i(\(http://www)-5 b(.digistan.or)o(g/spec:1\))14
b(so)21 b(that)479 953 y(people)e(place)h(the)h(right)e(weight)h(on)g
(your)f(specs)h(as)h(the)o(y)f(mature)f(\(or)g(don')o(t\).)-2
1012 y
SDict begin H.S end
 -2 1012 a -2 1012 a
SDict begin 13 H.A end
 -2 1012 a -2 1012 a
SDict begin [/View [/XYZ H.V]/Dest (0:3999) cvn /DEST pdfmark end
 -2 1012
a 396 1322 a Fb(6.6.3.)36 b(Wh)n(y)d(use)h(the)g(GPLv3)g(f)n(or)e(Pub)o
(lic)i(Speci\002cations?)3338 1322 y
SDict begin H.S end
 3338 1322 a 3338
1322 a
SDict begin 18.72 H.A end
 3338 1322 a 3338 1322 a
SDict begin [/View [/XYZ H.V]/Dest (11.80.38.2) cvn /DEST pdfmark end
 3338 1322 a -2 1513 a
SDict begin H.S end

-2 1513 a -2 1513 a
SDict begin 13 H.A end
 -2 1513 a -2 1513 a
SDict begin [/View [/XYZ H.V]/Dest (0:4001) cvn /DEST pdfmark end
 -2 1513 a 396
1596 a Fk(The)20 b(license)g(you)g(choose)f(is)i(particularly)e
(crucial)g(for)h(public)f(speci\002cations.)h(T)m(raditionally)-5
b(,)17 b(protocols)i(are)396 1704 y(published)g(under)g(custom)g
(licenses,)i(where)e(the)h(authors)g(o)n(wn)f(the)h(te)o(xt)g(and)g
(deri)n(v)o(ed)f(w)o(orks)g(are)h(forbidden.)e(This)396
1812 y(sounds)i(great)f(\(after)h(all,)g(who)g(w)o(ants)h(to)f(see)h(a)
f(protocol)f(fork)o(ed?\))f(b)n(ut)i(it')-5 b(s)22 b(in)e(f)o(act)g
(highly)f(risk)o(y)-5 b(.)19 b(A)i(protocol)396 1920
y(committee)f(is)h(vulnerable)d(to)i(capture,)f(and)h(if)g(the)g
(protocol)f(is)i(important)e(and)g(v)n(aluable,)g(the)h(incenti)n(v)o
(e)f(for)396 2028 y(capture)g(gro)n(ws.)-2 2212 y
SDict begin H.S end
 -2
2212 a -2 2212 a
SDict begin 13 H.A end
 -2 2212 a -2 2212 a
SDict begin [/View [/XYZ H.V]/Dest (0:4002) cvn /DEST pdfmark end
 -2 2212 a 396 2302
a Fk(Once)h(captured,)f(lik)o(e)h(some)g(wild)g(animals,)g(an)g
(important)f(protocol)f(will)j(often)f(die.)g(The)g(real)g(problem)e
(is)j(there')-5 b(s)396 2410 y(no)20 b(w)o(ay)g(to)744
2410 y
SDict begin H.S end
 744 2410 a 744 2410 a
SDict begin 13 H.A end
 744 2410 a 744 2410 a
SDict begin [/View [/XYZ H.V]/Dest (0:4003) cvn /DEST pdfmark end
 744
2410 a Ff(fr)m(ee)g Fk(a)h(capti)n(v)o(e)e(protocol)g(published)f
(under)h(a)i(con)m(v)o(entional)c(license.)j(The)g(w)o(ord)f("free")h
(isn')o(t)g(just)g(an)396 2518 y(adjecti)n(v)o(e)f(to)i(describe)e
(speech)h(or)g(air)m(,)f(it')-5 b(s)22 b(also)e(a)h(v)o(erb,)e(and)g
(the)i(right)e(to)h(fork)g(a)g(w)o(ork,)3034 2518 y
SDict begin H.S end
 3034
2518 a 3034 2518 a
SDict begin 13 H.A end
 3034 2518 a 3034 2518 a
SDict begin [/View [/XYZ H.V]/Dest (0:4004) cvn /DEST pdfmark end
 3034 2518
a Ff(a)o(gainst)g(the)g(wishes)h(of)g(the)396 2626 y(owner)r
Fk(,)f(is)h(essential)g(to)f(a)n(v)n(oiding)f(capture.)-2
2810 y
SDict begin H.S end
 -2 2810 a -2 2810 a
SDict begin 13 H.A end
 -2 2810 a -2 2810 a
SDict begin [/View [/XYZ H.V]/Dest (0:4005) cvn /DEST pdfmark end
 -2 2810
a 396 2900 a Fk(Let)i(me)f(e)o(xplain)f(this)i(in)f(shorter)f(w)o
(ords.)h(Imagine)f(iMatix)h(writes)g(a)h(protocol)d(today)-5
b(,)19 b(that')-5 b(s)21 b(really)f(amazing)f(and)396
3007 y(popular)-5 b(.)19 b(W)-7 b(e)21 b(publish)e(the)i(spec)f(and)g
(man)o(y)f(people)g(implement)g(it.)h(Those)g(implementations)e(are)i
(f)o(ast)h(and)396 3115 y(a)o(wesome,)e(and)h(free)g(as)h(in)f(beer)-5
b(.)20 b(And)g(the)o(y)f(start)i(to)f(threaten)f(an)h(e)o(xisting)g(b)n
(usiness.)g(Their)g(e)o(xpensi)n(v)o(e)396 3223 y(commercial)f(product)
f(is)j(slo)n(wer)f(and)g(can')o(t)f(compete.)g(So)i(one)e(day)h(the)o
(y)f(come)h(to)g(our)g(iMatix)g(of)n(\002ce)g(in)396
3331 y(Maetang-Dong,)d(South)j(K)m(orea,)f(and)h(of)n(fer)f(to)h(b)n
(uy)g(our)f(\002rm.)h(Since)h(we')l(re)e(spending)g(v)n(ast)h(amounts)f
(on)h(sushi)g(and)396 3439 y(beer)g(and)g(GFEs,)g(we)h(accept)f
(gratefully)-5 b(.)17 b(W)m(ith)k(e)n(vil)f(laughter)f(the)h(ne)n(w)g
(o)n(wners)g(of)f(the)i(protocol)d(stop)i(impro)o(ving)396
3547 y(the)g(public)g(v)o(ersion,)e(and)i(close)g(the)h
(speci\002cation)e(and)h(add)f(patented)g(e)o(xtensions.)g(Their)h(ne)n
(w)g(products)e(support)396 3655 y(this,)j(and)e(the)o(y)h(tak)o(e)g(o)
o(v)o(er)f(the)h(whole)g(mark)o(et.)-2 3839 y
SDict begin H.S end
 -2 3839
a -2 3839 a
SDict begin 13 H.A end
 -2 3839 a -2 3839 a
SDict begin [/View [/XYZ H.V]/Dest (0:4006) cvn /DEST pdfmark end
 -2 3839 a 396 3929 a
Fk(When)g(you)g(contrib)n(ute)e(to)j(an)f(open)f(source)g(project,)g
(you)h(really)g(w)o(ant)g(to)g(kno)n(w)f(your)g(hard)h(w)o(ork)f(w)o
(on')o(t)g(used)396 4037 y(against)h(you)f(by)h(a)g(closed-source)f
(competitor)-5 b(.)18 b(Which)i(is)i(why)d(the)h(GPL)h(beats)f(the)g
("more)f(permissi)n(v)o(e")396 4145 y(BSD/MIT/X11)h(licenses.)g(These)g
(license)g(gi)n(v)o(e)f(permission)g(to)h(cheat.)f(This)h(applies)g
(just)h(as)f(much)f(to)h(protocols)f(as)396 4253 y(to)i(source)e(code.)
-2 4420 y
SDict begin H.S end
 -2 4420 a -2 4420 a
SDict begin 13 H.A end
 -2 4420 a -2 4420 a
SDict begin [/View [/XYZ H.V]/Dest (0:4007) cvn /DEST pdfmark end
 -2
4420 a 396 4527 a Fk(When)g(you)g(implement)f(a)i(GPLv3)e
(speci\002cation,)h(your)f(applications)g(are)h(of)g(course)f(yours,)h
(and)f(licensed)h(an)o(y)g(w)o(ay)396 4635 y(you)g(lik)o(e.)g(But)i
(you)d(can)i(be)f(sure)g(and)g(certain)g(of)h(tw)o(o)g(things.)e(One,)i
(that)f(speci\002cation)g(will)3158 4635 y
SDict begin H.S end
 3158 4635
a 3158 4635 a
SDict begin 13 H.A end
 3158 4635 a 3158 4635 a
SDict begin [/View [/XYZ H.V]/Dest (0:4008) cvn /DEST pdfmark end
 3158 4635 a Ff(e)o(ver)j
Fk(be)d(embraced)f(and)396 4743 y(e)o(xtended)g(into)i(proprietary)e
(forms.)h(An)o(y)h(deri)n(v)o(ed)e(forms)i(of)f(the)i(speci\002cation)e
(must)h(also)h(be)f(GPLv3.)f(T)-7 b(w)o(o,)396 4851 y(no-one)19
b(who)g(e)n(v)o(er)h(implements)f(or)h(uses)g(the)h(protocol)d(will)j
(e)n(v)o(er)e(launch)g(a)i(patent)f(attack)g(on)g(an)o(ything)e(it)j
(co)o(v)o(ers.)-2 4879 y
SDict begin H.S end
 -2 4879 a -2 4879 a
SDict begin 13 H.A end
 -2 4879
a -2 4879 a
SDict begin [/View [/XYZ H.V]/Dest (0:4009) cvn /DEST pdfmark end
 -2 4879 a Black 3759 5569 a Ff(333)p Black
eop end
%%Page: 334 347
TeXDict begin 334 346 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.334) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 77 a Fb(6.6.4.)36 b(Using)e(ABNF)1425 77 y
SDict begin H.S end

1425 77 a 1425 77 a
SDict begin 18.72 H.A end
 1425 77 a 1425 77 a
SDict begin [/View [/XYZ H.V]/Dest (11.80.39.2) cvn /DEST pdfmark end
 1425 77 a -2
269 a
SDict begin H.S end
 -2 269 a -2 269 a
SDict begin 13 H.A end
 -2 269 a -2 269 a
SDict begin [/View [/XYZ H.V]/Dest (0:4011) cvn /DEST pdfmark end
 -2 269 a 396
351 a Fk(My)20 b(advice)g(when)f(writing)h(protocol)e(specs)j(is)g(to)f
(learn,)g(and)g(use)g(a)h(formal)e(grammar)-5 b(.)18
b(It')-5 b(s)21 b(just)g(less)g(hassle)g(than)396 459
y(allo)n(wing)f(others)f(to)i(interpret)e(what)h(you)f(mean,)g(and)h
(then)g(reco)o(v)o(er)e(from)h(the)h(ine)n(vitable)f(f)o(alse)i
(assumptions.)e(The)396 566 y(tar)o(get)h(of)f(your)g(grammar)g(is)i
(other)e(people,)g(engineers,)g(not)h(compilers.)-2 751
y
SDict begin H.S end
 -2 751 a -2 751 a
SDict begin 13 H.A end
 -2 751 a -2 751 a
SDict begin [/View [/XYZ H.V]/Dest (0:4012) cvn /DEST pdfmark end
 -2 751 a 396 840
a Fk(My)g(f)o(a)n(v)n(orite)g(grammar)f(is)i(ABNF)-7
b(,)21 b(as)g(de\002ned)e(by)1919 840 y
SDict begin H.S end
 1919 840 a 1919
840 a
SDict begin 13 H.A end
 1919 840 a 1919 840 a
SDict begin [/View [/XYZ H.V]/Dest (0:4013) cvn /DEST pdfmark end
 1919 840 a Fk(RFC)j(2234)c(\(http://www)-5
b(.ietf.or)o(g/rfc/rfc223)o(4.)o(txt\),)14 b(because)20
b(it)396 948 y(is)h(probably)d(the)i(simplest)h(and)f(most)g(widely)g
(used)g(formal)f(language)f(for)i(de\002ning)f(bidirectional)396
1056 y(communications)f(protocols.)g(Most)j(IETF)f(\(Internet)e
(Engineering)g(T)-7 b(ask)21 b(F)o(orce\))e(speci\002cations)g(use)i
(ABNF)-7 b(,)396 1164 y(which)20 b(is)h(good)e(compan)o(y)f(to)i(be)g
(in.)-2 1348 y
SDict begin H.S end
 -2 1348 a -2 1348 a
SDict begin 13 H.A end
 -2 1348 a -2 1348
a
SDict begin [/View [/XYZ H.V]/Dest (0:4014) cvn /DEST pdfmark end
 -2 1348 a 396 1438 a Fk(I')o(ll)h(gi)n(v)o(e)e(a)i(30-second)d(crash)
i(course)f(in)h(writing)g(ABNF)-7 b(.)21 b(It)g(may)e(remind)g(you)h
(of)g(re)o(gular)e(e)o(xpressions.)h(Y)-9 b(ou)19 b(write)396
1546 y(the)h(grammar)f(as)i(rules.)f(Each)f(rule)h(tak)o(es)h(the)f
(form)f("name)h(=)g(elements".)g(An)g(element)g(can)g(be)g(another)e
(rule)396 1654 y(\(which)i(you)f(de\002ne)h(belo)n(w)f(as)i(another)e
(rule\),)g(or)h(a)h(pre-de\002ned)c("terminal")j(lik)o(e)g(CRLF)-7
b(,)22 b(OCTET)-6 b(,)19 b(or)h(a)h(number)-5 b(.)396
1762 y
SDict begin H.S end
 396 1762 a 396 1762 a
SDict begin 13 H.A end
 396 1762 a 396 1762 a
SDict begin [/View [/XYZ H.V]/Dest (0:4015) cvn /DEST pdfmark end
 396
1762 a Fk(The)20 b(RFC)i(\(http://www)-5 b(.ietf.or)o(g/rfc/rfc22)o(34)
o(.tx)o(t\))15 b(lists)22 b(all)e(the)h(terminals.)e(T)-7
b(o)20 b(de\002ne)g(alternati)n(v)o(e)f(elements,)h(use)396
1870 y("element)g(/)h(element".)e(T)-7 b(o)20 b(de\002ne)g(repetition,)
f(use)h("*")g(\(read)f(the)h(RFC)i(since)e(it')-5 b(s)22
b(not)e(intuiti)n(v)o(e\).)e(T)-7 b(o)21 b(group)396
1978 y(elements,)f(use)g(parentheses.)-2 2162 y
SDict begin H.S end
 -2 2162
a -2 2162 a
SDict begin 13 H.A end
 -2 2162 a -2 2162 a
SDict begin [/View [/XYZ H.V]/Dest (0:4016) cvn /DEST pdfmark end
 -2 2162 a 396 2252 a
Fk(I'm)g(not)g(sure)g(if)g(this)h(e)o(xtension)e(is)i(proper)m(,)d(b)n
(ut)i(I)g(then)g(pre\002x)g(elements)f(with)i("C:")g(and)e("S:")i(to)f
(indicate)g(whether)396 2360 y(the)o(y)g(come)f(from)g(the)i(client)f
(or)g(serv)o(er)-5 b(.)-2 2544 y
SDict begin H.S end
 -2 2544 a -2 2544 a
SDict begin 13 H.A end

-2 2544 a -2 2544 a
SDict begin [/View [/XYZ H.V]/Dest (0:4017) cvn /DEST pdfmark end
 -2 2544 a 396 2634 a Fk(Here')g(s)21
b(a)f(piece)g(of)g(ABNF)h(for)f(an)g(unprotocol)e(called)i(NOM)g(that)g
(we')o(ll)h(come)e(back)h(to)g(later)g(in)h(this)g(chapter:)-2
2735 y
SDict begin H.S end
 -2 2735 a -2 2735 a
SDict begin 11.7 H.A end
 -2 2735 a -2 2735 a
SDict begin [/View [/XYZ H.V]/Dest (0:4018) cvn /DEST pdfmark end
 -2 2735
a 396 2814 a Fe(nom-protocol)178 b(=)44 b(open-peering)1786
2827 y(*)1831 2814 y(use-peering)396 3008 y(open-peering)178
b(=)44 b(C:OHAI)g(\()h(S:OHAI-OK)e(/)i(S:WTF)f(\))396
3202 y(use-peering)223 b(=)44 b(C:ICANHAZ)1114 3300 y(/)g
(S:CHEEZBURGER)1114 3397 y(/)g(C:HUGZ)g(S:HUGZ-OK)1114
3494 y(/)g(S:HUGZ)g(C:HUGZ-OK)-2 3666 y
SDict begin H.S end
 -2 3666 a -2
3666 a
SDict begin 13 H.A end
 -2 3666 a -2 3666 a
SDict begin [/View [/XYZ H.V]/Dest (0:4019) cvn /DEST pdfmark end
 -2 3666 a 396 3768 a Fk(I')l(v)o(e)19
b(actually)h(used)g(these)g(k)o(e)o(yw)o(ords)f(\(OHAI,)g(WTF\))i(in)f
(commercial)f(projects.)h(The)o(y)f(mak)o(e)g(de)n(v)o(elopers)f
(giggly)396 3876 y(and)i(happ)o(y)-5 b(.)18 b(The)o(y)h(confuse)g
(management.)f(The)o(y')l(re)g(good)h(in)h(\002rst)h(drafts)f(that)g
(you)f(w)o(ant)i(to)f(thro)n(w)g(a)o(w)o(ay)f(later)-5
b(.)-2 3987 y
SDict begin H.S end
 -2 3987 a -2 3987 a
SDict begin 13 H.A end
 -2 3987 a -2 3987 a
SDict begin [/View [/XYZ H.V]/Dest (0:4020) cvn /DEST pdfmark end

-2 3987 a 359 x Fn(6.7.)39 b(Serializing)e(y)l(our)j(Data)1694
4346 y
SDict begin H.S end
 1694 4346 a 1694 4346 a
SDict begin 22.464 H.A end
 1694 4346 a 1694 4346
a
SDict begin [/View [/XYZ H.V]/Dest (11.81.1) cvn /DEST pdfmark end
 1694 4346 a -2 4544 a
SDict begin H.S end
 -2 4544 a -2 4544 a
SDict begin 13 H.A end
 -2 4544 a
-2 4544 a
SDict begin [/View [/XYZ H.V]/Dest (0:4022) cvn /DEST pdfmark end
 -2 4544 a 396 4620 a Fk(When)20 b(we)h(start)g(to)f(design)f
(a)i(protocol,)d(one)i(of)g(the)g(\002rst)h(questions)e(we)i(f)o(ace)f
(is)h(ho)n(w)f(we)g(encode)f(data)h(on)g(the)g(wire.)396
4728 y(There)g(is,)h(sadly)-5 b(,)19 b(no)h(uni)n(v)o(ersal)e(answer)-5
b(.)21 b(There)e(are)h(a)h(half-dozen)c(dif)n(ferent)i(w)o(ays)h(to)h
(serialize)f(data,)g(each)g(with)396 4836 y(pros)g(and)g(cons.)f(W)-7
b(e')o(ll)22 b(e)o(xplore)c(these.)p Black 3759 5569
a Ff(334)p Black eop end
%%Page: 335 348
TeXDict begin 335 347 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.335) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4023) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Ho)n(we)n(v)o(er)m(,)f(there)i(is)h(a)g(general)e
(lesson)h(I')l(v)o(e)f(learned)g(o)o(v)o(er)g(a)i(couple)e(of)h
(decades)f(of)h(writing)g(protocols)f(small)h(and)396
180 y(lar)o(ge.)f(I)i(call)f(this)h(the)f("Cheap)g(and)g(Nasty")g
(pattern:)f(you)h(can)g(often)f(split)i(your)e(w)o(ork)g(into)h(tw)o(o)
h(layers,)e(and)h(solv)o(e)396 288 y(these)h(separately)-5
b(,)18 b(one)i(using)g(a)g("cheap")f(approach,)f(the)i(other)g(using)f
(a)i("nasty")f(approach.)-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2
306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:4024) cvn /DEST pdfmark end
 -2 306 a 396 616 a Fb(6.7.1.)36 b(Cheap)e(and)g(Nasty)
1697 616 y
SDict begin H.S end
 1697 616 a 1697 616 a
SDict begin 18.72 H.A end
 1697 616 a 1697 616
a
SDict begin [/View [/XYZ H.V]/Dest (11.81.40.2) cvn /DEST pdfmark end
 1697 616 a -2 807 a
SDict begin H.S end
 -2 807 a -2 807 a
SDict begin 13 H.A end
 -2 807 a -2 807
a
SDict begin [/View [/XYZ H.V]/Dest (0:4026) cvn /DEST pdfmark end
 -2 807 a 396 890 a Fk(The)20 b(k)o(e)o(y)g(insight)g(to)g(making)f
(Cheap)h(and)f(Nasty)i(w)o(ork)e(is)i(to)g(realize)f(that)g(man)o(y)f
(protocols)g(mix)h(a)g(lo)n(w-v)n(olume)396 998 y(chatty)g(part)g(for)f
(control,)g(and)h(a)g(high-v)n(olume)e(asynchronous)f(part)j(for)f
(data.)h(F)o(or)g(instance,)g(HTTP)g(has)g(a)h(chatty)396
1106 y(dialog)f(to)g(authenticate)f(and)g(get)i(pages,)e(and)h(an)g
(asynchronous)d(dialog)j(to)g(stream)g(data.)g(FTP)h(actually)e(splits)
i(this)396 1214 y(o)o(v)o(er)e(tw)o(o)i(ports;)e(one)h(port)g(for)f
(control)g(and)h(one)f(port)h(for)f(data.)-2 1398 y
SDict begin H.S end
 -2
1398 a -2 1398 a
SDict begin 13 H.A end
 -2 1398 a -2 1398 a
SDict begin [/View [/XYZ H.V]/Dest (0:4027) cvn /DEST pdfmark end
 -2 1398 a 396 1488
a Fk(Protocol)g(designers)h(who)f(don')o(t)g(separate)h(control)f(from)
g(data)h(tend)g(to)g(mak)o(e)g(a)o(wful)f(protocols,)g(because)g(the)
396 1596 y(trade-of)n(fs)g(in)h(the)g(tw)o(o)h(cases)g(are)f(almost)g
(totally)g(opposite.)f(What)h(is)h(perfect)f(for)f(control)g(is)i
(terrible)f(for)f(data,)h(and)396 1704 y(what')-5 b(s)21
b(ideal)f(for)f(data)h(just)g(doesn')o(t)f(w)o(ork)g(for)h(control.)e
(It')-5 b(s)21 b(especially)e(true)h(when)f(we)i(w)o(ant)f
(high-performance)15 b(at)396 1812 y(the)20 b(same)h(time)f(as)h(e)o
(xtensibility)e(and)h(good)f(error)g(checking.)-2 1996
y
SDict begin H.S end
 -2 1996 a -2 1996 a
SDict begin 13 H.A end
 -2 1996 a -2 1996 a
SDict begin [/View [/XYZ H.V]/Dest (0:4028) cvn /DEST pdfmark end
 -2 1996 a 396
2086 a Fk(Let')-5 b(s)21 b(break)e(this)i(do)n(wn)e(using)h(a)g
(classic)h(client-serv)o(er)e(use-case.)h(The)f(client)i(connects)e(to)
h(the)g(serv)o(er)m(,)f(and)396 2194 y(authenticates.)g(It)i(then)e
(asks)i(for)f(some)g(resource.)e(The)i(serv)o(er)g(chats)g(back,)f
(then)h(starts)h(to)f(send)g(data)g(back)g(to)g(the)396
2302 y(client.)g(Ev)o(entually)e(the)j(client)f(disconnects)f(or)h(the)
g(serv)o(er)g(\002nishes,)g(and)f(the)i(con)m(v)o(ersation)c(is)k(o)o
(v)o(er)-5 b(.)-2 2486 y
SDict begin H.S end
 -2 2486 a -2 2486 a
SDict begin 13 H.A end
 -2 2486
a -2 2486 a
SDict begin [/View [/XYZ H.V]/Dest (0:4029) cvn /DEST pdfmark end
 -2 2486 a 396 2576 a Fk(No)n(w)g(,)20 b(before)e(starting)i
(to)h(design)e(these)i(messages,)f(stop)g(and)f(think,)h(and)f(let')-5
b(s)21 b(compare)e(the)h(control)f(dialog,)g(and)396
2684 y(the)h(data)h(\003o)n(w:)-2 2685 y
SDict begin H.S end
 -2 2685 a -2
2685 a
SDict begin 13 H.A end
 -2 2685 a -2 2685 a
SDict begin [/View [/XYZ H.V]/Dest (0:4030) cvn /DEST pdfmark end
 -2 2685 a -2 2695 a
SDict begin H.S end
 -2 2695
a -2 2695 a
SDict begin 13 H.A end
 -2 2695 a -2 2695 a
SDict begin [/View [/XYZ H.V]/Dest (0:4031) cvn /DEST pdfmark end
 -2 2695 a Black 396 2854
a Fj(\225)p Black 479 2854 a
SDict begin H.S end
 479 2854 a 479 2854 a
SDict begin 13 H.A end
 479
2854 a 479 2854 a
SDict begin [/View [/XYZ H.V]/Dest (0:4032) cvn /DEST pdfmark end
 479 2854 a Fk(The)f(control)f(dialog)g(lasts)j(a)e
(short)g(time)h(and)e(in)m(v)n(olv)o(e)g(v)o(ery)g(fe)n(w)h(messages.)g
(The)g(data)g(\003o)n(w)g(could)f(last)j(for)d(hours)479
2962 y(or)h(days,)g(and)g(in)m(v)n(olv)o(e)e(billions)i(of)g(messages.)
-2 2980 y
SDict begin H.S end
 -2 2980 a -2 2980 a
SDict begin 13 H.A end
 -2 2980 a -2 2980 a
SDict begin [/View [/XYZ H.V]/Dest (0:4033) cvn /DEST pdfmark end
 -2
2980 a Black 396 3111 a Fj(\225)p Black 479 3111 a
SDict begin H.S end
 479
3111 a 479 3111 a
SDict begin 13 H.A end
 479 3111 a 479 3111 a
SDict begin [/View [/XYZ H.V]/Dest (0:4034) cvn /DEST pdfmark end
 479 3111 a Fk(The)g(control)f
(dialog)g(is)j(where)d(all)i(the)f("normal")f(errors)g(happen,)f(e.g.)i
(not)g(authenticated,)e(not)i(found,)e(payment)479 3219
y(required,)g(censored,)h(etc.)h(An)o(y)g(errors)f(that)h(happen)f
(during)f(the)j(data)f(\003o)n(w)g(are)g(e)o(xceptional)e(\(disk)i
(full,)g(serv)o(er)479 3327 y(crashed\).)-2 3342 y
SDict begin H.S end
 -2
3342 a -2 3342 a
SDict begin 13 H.A end
 -2 3342 a -2 3342 a
SDict begin [/View [/XYZ H.V]/Dest (0:4035) cvn /DEST pdfmark end
 -2 3342 a Black
396 3477 a Fj(\225)p Black 479 3477 a
SDict begin H.S end
 479 3477 a 479
3477 a
SDict begin 13 H.A end
 479 3477 a 479 3477 a
SDict begin [/View [/XYZ H.V]/Dest (0:4036) cvn /DEST pdfmark end
 479 3477 a Fk(The)g(control)f(dialog)g(is)
j(where)d(things)h(will)h(change)e(o)o(v)o(er)f(time,)j(as)f(we)h(add)f
(more)f(options,)g(parameters,)g(and)g(so)479 3584 y(on.)h(The)g(data)g
(\003o)n(w)g(should)f(barely)g(change)g(o)o(v)o(er)g(time)h(since)h
(the)f(semantics)g(of)g(a)h(resource)e(are)h(f)o(airly)g(constant)479
3692 y(o)o(v)o(er)f(time.)-2 3693 y
SDict begin H.S end
 -2 3693 a -2 3693
a
SDict begin 13 H.A end
 -2 3693 a -2 3693 a
SDict begin [/View [/XYZ H.V]/Dest (0:4037) cvn /DEST pdfmark end
 -2 3693 a Black 396 3842 a Fj(\225)p
Black 479 3842 a
SDict begin H.S end
 479 3842 a 479 3842 a
SDict begin 13 H.A end
 479 3842 a 479
3842 a
SDict begin [/View [/XYZ H.V]/Dest (0:4038) cvn /DEST pdfmark end
 479 3842 a Fk(The)h(control)f(dialog)g(is)j(essentially)e(a)g
(synchronous)e(request/reply)g(dialog.)h(The)h(data)g(\003o)n(w)g(is)h
(essentially)g(a)479 3950 y(1-w)o(ay)f(asynchronous)d(\003o)n(w)-5
b(.)-2 4134 y
SDict begin H.S end
 -2 4134 a -2 4134 a
SDict begin 13 H.A end
 -2 4134 a -2 4134 a
SDict begin [/View [/XYZ H.V]/Dest (0:4039) cvn /DEST pdfmark end

-2 4134 a 396 4224 a Fk(These)20 b(dif)n(ferences)f(are)h(critical.)g
(When)g(we)g(talk)h(about)e(performance,)e(it)k(applies)2868
4224 y
SDict begin H.S end
 2868 4224 a 2868 4224 a
SDict begin 13 H.A end
 2868 4224 a 2868 4224
a
SDict begin [/View [/XYZ H.V]/Dest (0:4040) cvn /DEST pdfmark end
 2868 4224 a Ff(only)f Fk(to)g(data)g(\003o)n(ws.)g(It')-5
b(s)396 4332 y(pathological)18 b(to)j(design)e(a)i(one-time)e(control)g
(dialog)g(to)h(be)h(f)o(ast.)f(When)g(we)h(talk)f(about)f(the)h(cost)h
(of)f(serialization,)396 4440 y(thus,)g(this)h(only)e(applies)h(to)h
(the)f(data)g(\003o)n(w)-5 b(.)19 b(The)h(cost)h(of)f
(encoding/decoding)15 b(the)21 b(control)d(\003o)n(w)j(could)e(be)h
(huge,)396 4548 y(and)g(for)f(man)o(y)g(cases)i(it)g(w)o(ould)f(not)g
(change)e(a)j(thing.)e(So,)h(we)h(encode)e(control)g(using)h("Cheap",)f
(and)h(we)g(encode)396 4655 y(data)g(\003o)n(ws)h(using)f("Nasty".)-2
4839 y
SDict begin H.S end
 -2 4839 a -2 4839 a
SDict begin 13 H.A end
 -2 4839 a -2 4839 a
SDict begin [/View [/XYZ H.V]/Dest (0:4041) cvn /DEST pdfmark end
 -2 4839
a 396 4929 a Fk(Cheap)g(is)h(essentially)g(synchronous,)c(v)o(erbose,)h
(descripti)n(v)o(e,)h(and)g(\003e)o(xible.)h(A)g(Cheap)g(message)g(is)h
(full)f(of)g(rich)396 5037 y(information)e(that)i(can)g(change)f(for)h
(each)g(application.)e(Y)-9 b(our)19 b(goal)h(as)h(designer)e(is)i(to)f
(mak)o(e)g(this)h(information)d(easy)p Black 3759 5569
a Ff(335)p Black eop end
%%Page: 336 349
TeXDict begin 336 348 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.336) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(to)i(encode)d(and)i(to)g(parse,)g(tri)n(vial)g(to)h
(e)o(xtend)d(for)i(e)o(xperimentation)d(or)j(gro)n(wth,)f(and)g(highly)
g(rob)n(ust)h(against)f(change)396 180 y(both)h(forw)o(ards)f(and)g
(backw)o(ards.)g(The)h(Cheap)g(part)g(of)f(a)i(protocol)e(looks)g(lik)o
(e)i(this:)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198
a
SDict begin [/View [/XYZ H.V]/Dest (0:4042) cvn /DEST pdfmark end
 -2 198 a -2 208 a
SDict begin H.S end
 -2 208 a -2 208 a
SDict begin 13 H.A end
 -2 208 a -2 208
a
SDict begin [/View [/XYZ H.V]/Dest (0:4043) cvn /DEST pdfmark end
 -2 208 a Black 396 351 a Fj(\225)p Black 479 351 a
SDict begin H.S end

479 351 a 479 351 a
SDict begin 13 H.A end
 479 351 a 479 351 a
SDict begin [/View [/XYZ H.V]/Dest (0:4044) cvn /DEST pdfmark end
 479 351 a Fk(It)g(uses)f(a)h
(simple)f(self-describing)e(structured)h(encoding)f(for)i(data,)g(be)g
(it)h(XML,)f(JSON,)h(HTTP-style)e(headers,)479 459 y(or)h(some)g(other)
-5 b(.)20 b(An)o(y)f(encoding)f(is)j(\002ne)g(so)f(long)g(as)h(there)e
(are)h(standard)f(simple)i(parsers)f(for)f(it)i(in)f(your)f(tar)o(get)
479 566 y(languages.)-2 584 y
SDict begin H.S end
 -2 584 a -2 584 a
SDict begin 13 H.A end
 -2 584
a -2 584 a
SDict begin [/View [/XYZ H.V]/Dest (0:4045) cvn /DEST pdfmark end
 -2 584 a Black 396 716 a Fj(\225)p Black 479
716 a
SDict begin H.S end
 479 716 a 479 716 a
SDict begin 13 H.A end
 479 716 a 479 716 a
SDict begin [/View [/XYZ H.V]/Dest (0:4046) cvn /DEST pdfmark end
 479 716
a Fk(It)i(uses)f(a)h(straight)f(request-reply)e(model)h(where)h(each)f
(request)h(has)g(a)h(success/f)o(ailure)f(reply)-5 b(.)18
b(This)j(mak)o(es)f(it)479 824 y(tri)n(vial)g(to)h(write)f(correct)f
(clients)i(and)e(serv)o(ers)h(for)g(a)g(Cheap)g(dialog.)-2
842 y
SDict begin H.S end
 -2 842 a -2 842 a
SDict begin 13 H.A end
 -2 842 a -2 842 a
SDict begin [/View [/XYZ H.V]/Dest (0:4047) cvn /DEST pdfmark end
 -2 842 a Black
396 973 a Fj(\225)p Black 479 973 a
SDict begin H.S end
 479 973 a 479 973
a
SDict begin 13 H.A end
 479 973 a 479 973 a
SDict begin [/View [/XYZ H.V]/Dest (0:4048) cvn /DEST pdfmark end
 479 973 a Fk(It)h(doesn')o(t)d(try)-5
b(,)20 b(e)n(v)o(en)f(mar)o(ginally)-5 b(,)17 b(to)k(be)f(f)o(ast.)g
(Performance)e(doesn')o(t)h(matter)h(when)f(you)h(do)f(something)g
(once)h(or)479 1081 y(a)h(fe)n(w)f(times)h(per)e(session.)-2
1265 y
SDict begin H.S end
 -2 1265 a -2 1265 a
SDict begin 13 H.A end
 -2 1265 a -2 1265 a
SDict begin [/View [/XYZ H.V]/Dest (0:4049) cvn /DEST pdfmark end
 -2 1265
a 396 1355 a Fk(A)i(Cheap)f(parser)f(is)j(something)c(you)i(tak)o(e)g
(of)n(f)f(the)h(shelf,)g(and)g(thro)n(w)f(data)h(at.)h(It)f(shouldn')o
(t)e(crash,)i(shouldn')o(t)e(leak)396 1463 y(memory)-5
b(,)18 b(should)h(be)h(highly)f(tolerant,)g(and)h(should)f(be)h(relati)
n(v)o(ely)f(simple)i(to)f(w)o(ork)f(with.)i(That')-5
b(s)20 b(it.)-2 1647 y
SDict begin H.S end
 -2 1647 a -2 1647 a
SDict begin 13 H.A end
 -2 1647 a
-2 1647 a
SDict begin [/View [/XYZ H.V]/Dest (0:4050) cvn /DEST pdfmark end
 -2 1647 a 396 1737 a Fk(Nasty)g(ho)n(we)n(v)o(er)e(is)j
(essentially)f(asynchronous,)d(terse,)j(silent,)g(and)f(in\003e)o
(xible.)g(A)h(Nasty)g(message)g(carries)f(minimal)396
1845 y(information)f(that)i(practically)g(ne)n(v)o(er)e(changes.)h(Y)-9
b(our)19 b(goal)h(as)h(designer)e(is)i(to)g(mak)o(e)e(this)i
(information)d(ultraf)o(ast)i(to)396 1953 y(parse,)g(and)g(possibly)f
(e)n(v)o(en)g(impossible)h(to)g(e)o(xtend)f(and)h(e)o(xperiment)e
(with.)i(The)g(ideal)g(Nasty)g(pattern)g(looks)f(lik)o(e)396
2061 y(this:)-2 2062 y
SDict begin H.S end
 -2 2062 a -2 2062 a
SDict begin 13 H.A end
 -2 2062 a
-2 2062 a
SDict begin [/View [/XYZ H.V]/Dest (0:4051) cvn /DEST pdfmark end
 -2 2062 a -2 2072 a
SDict begin H.S end
 -2 2072 a -2 2072 a
SDict begin 13 H.A end
 -2
2072 a -2 2072 a
SDict begin [/View [/XYZ H.V]/Dest (0:4052) cvn /DEST pdfmark end
 -2 2072 a Black 396 2231 a Fj(\225)p
Black 479 2231 a
SDict begin H.S end
 479 2231 a 479 2231 a
SDict begin 13 H.A end
 479 2231 a 479
2231 a
SDict begin [/View [/XYZ H.V]/Dest (0:4053) cvn /DEST pdfmark end
 479 2231 a Fk(It)i(uses)f(a)h(hand-optimized)c(binary)i(layout)g
(for)h(data,)g(where)f(e)n(v)o(ery)g(bit)h(is)i(precisely)d(crafted.)-2
2249 y
SDict begin H.S end
 -2 2249 a -2 2249 a
SDict begin 13 H.A end
 -2 2249 a -2 2249 a
SDict begin [/View [/XYZ H.V]/Dest (0:4054) cvn /DEST pdfmark end
 -2 2249
a Black 396 2380 a Fj(\225)p Black 479 2380 a
SDict begin H.S end
 479 2380
a 479 2380 a
SDict begin 13 H.A end
 479 2380 a 479 2380 a
SDict begin [/View [/XYZ H.V]/Dest (0:4055) cvn /DEST pdfmark end
 479 2380 a Fk(It)i(uses)f(a)h(pure)e
(asynchronous)f(model)h(where)h(one)f(or)h(both)f(peers)h(send)g(data)g
(without)g(ackno)n(wledgments)d(\(or)j(if)479 2488 y(the)o(y)g(do,)f
(the)o(y)h(use)g(sneak)o(y)f(asynchronous)f(techniques)g(lik)o(e)j
(credit-based)d(\003o)n(w)j(control\).)-2 2506 y
SDict begin H.S end
 -2 2506
a -2 2506 a
SDict begin 13 H.A end
 -2 2506 a -2 2506 a
SDict begin [/View [/XYZ H.V]/Dest (0:4056) cvn /DEST pdfmark end
 -2 2506 a Black 396 2638
a Fj(\225)p Black 479 2638 a
SDict begin H.S end
 479 2638 a 479 2638 a
SDict begin 13 H.A end
 479
2638 a 479 2638 a
SDict begin [/View [/XYZ H.V]/Dest (0:4057) cvn /DEST pdfmark end
 479 2638 a Fk(It)g(doesn')o(t)d(try)-5
b(,)20 b(e)n(v)o(en)f(mar)o(ginally)-5 b(,)17 b(to)k(be)f(friendly)-5
b(.)18 b(Performance)g(is)j(all)g(that)f(matters)g(when)g(you)f(are)h
(doing)479 2746 y(something)f(se)n(v)o(eral)h(million)f(times)i(per)f
(second.)-2 2930 y
SDict begin H.S end
 -2 2930 a -2 2930 a
SDict begin 13 H.A end
 -2 2930 a -2 2930
a
SDict begin [/View [/XYZ H.V]/Dest (0:4058) cvn /DEST pdfmark end
 -2 2930 a 396 3020 a Fk(A)h(Nasty)f(parser)g(is)h(something)e(you)g
(write)h(by)g(hand,)f(which)h(writes)g(or)g(reads)g(bits,)h(bytes,)f(w)
o(ords,)f(and)h(inte)o(gers)396 3128 y(indi)n(vidually)e(and)h
(precisely)-5 b(.)19 b(It)h(rejects)g(an)o(ything)e(it)i(doesn')o(t)e
(lik)o(e,)i(does)g(no)f(memory)f(allocations)h(at)i(all,)f(and)f(ne)n
(v)o(er)396 3236 y(crashes.)-2 3402 y
SDict begin H.S end
 -2 3402 a -2 3402
a
SDict begin 13 H.A end
 -2 3402 a -2 3402 a
SDict begin [/View [/XYZ H.V]/Dest (0:4059) cvn /DEST pdfmark end
 -2 3402 a 396 3510 a Fk(Cheap)h(and)g(Nasty)g
(isn')o(t)g(a)h(uni)n(v)o(ersal)d(pattern;)i(not)g(all)h(protocols)d
(ha)n(v)o(e)i(this)h(dichotomy)-5 b(.)17 b(Also,)j(ho)n(w)g(you)f(use)
396 3618 y(Cheap)h(and)f(Nasty)h(will)h(depend.)d(In)h(some)h(cases,)g
(it)h(can)e(be)h(tw)o(o)g(parts)g(of)f(a)i(single)e(protocol.)f(In)i
(other)f(cases)h(it)h(can)396 3725 y(be)f(tw)o(o)h(protocols,)d(one)i
(layered)f(on)h(top)g(of)g(the)g(other)-5 b(.)-2 3754
y
SDict begin H.S end
 -2 3754 a -2 3754 a
SDict begin 13 H.A end
 -2 3754 a -2 3754 a
SDict begin [/View [/XYZ H.V]/Dest (0:4060) cvn /DEST pdfmark end
 -2 3754 a 396
4064 a Fb(6.7.2.)36 b(\330MQ)c(Framing)1518 4064 y
SDict begin H.S end
 1518
4064 a 1518 4064 a
SDict begin 18.72 H.A end
 1518 4064 a 1518 4064 a
SDict begin [/View [/XYZ H.V]/Dest (11.81.41.2) cvn /DEST pdfmark end
 1518 4064
a -2 4257 a
SDict begin H.S end
 -2 4257 a -2 4257 a
SDict begin 13 H.A end
 -2 4257 a -2 4257 a
SDict begin [/View [/XYZ H.V]/Dest (0:4062) cvn /DEST pdfmark end
 -2
4257 a 396 4338 a Fk(The)20 b(simplest)h(and)e(most)i(widely)e(used)h
(serialization)g(format)f(for)g(\330MQ)i(applications)e(is)i(\330MQ')-5
b(s)21 b(o)n(wn)e(multi-part)396 4446 y(framing.)g(F)o(or)g(e)o
(xample,)g(here)h(is)h(ho)n(w)e(the)1681 4446 y
SDict begin H.S end
 1681
4446 a 1681 4446 a
SDict begin 13 H.A end
 1681 4446 a 1681 4446 a
SDict begin [/View [/XYZ H.V]/Dest (0:4063) cvn /DEST pdfmark end
 1681 4446
a Fk(Majordomo)e(Protocol)i(\(http://rfc.zeromq.or)o(g/spec:7\))14
b(de\002nes)20 b(a)396 4554 y(request:)-2 4655 y
SDict begin H.S end
 -2 4655
a -2 4655 a
SDict begin 11.7 H.A end
 -2 4655 a -2 4655 a
SDict begin [/View [/XYZ H.V]/Dest (0:4064) cvn /DEST pdfmark end
 -2 4655 a 396 4734 a
Fe(Frame)44 b(0:)h(Empty)f(frame)396 4831 y(Frame)g(1:)h("MDPW01")e
(\(six)h(bytes,)g(representing)f(MDP/Worker)g(v0.1\))396
4928 y(Frame)h(2:)h(0x02)f(\(one)g(byte,)g(representing)f(REQUEST\))396
5025 y(Frame)h(3:)h(Client)f(address)f(\(envelope)h(stack\))396
5122 y(Frame)g(4:)h(Empty)f(\(zero)g(bytes,)g(envelope)f(delimiter\))p
Black 3757 5569 a Ff(336)p Black eop end
%%Page: 337 350
TeXDict begin 337 349 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.337) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(Frames)44 b(5+:)g(Request)g(body)g(\(opaque)g
(binary\))-2 250 y
SDict begin H.S end
 -2 250 a -2 250 a
SDict begin 13 H.A end
 -2 250 a -2 250
a
SDict begin [/View [/XYZ H.V]/Dest (0:4065) cvn /DEST pdfmark end
 -2 250 a 396 346 a Fk(T)-7 b(o)21 b(read)e(and)h(write)g(this)h(in)f
(code)g(is)h(easy)-5 b(.)20 b(But)g(this)h(is)g(a)g(classic)g(e)o
(xample)e(of)h(a)g(control)f(\003o)n(w)h(\(the)g(whole)g(of)g(MDP)396
454 y(is,)h(really)-5 b(,)19 b(since)i(it')-5 b(s)21
b(a)g(chatty)e(request-reply)f(protocol\).)g(When)i(we)g(came)g(to)h
(impro)o(v)o(e)d(MDP)i(for)g(the)g(second)396 562 y(v)o(ersion,)f(we)i
(had)e(to)h(change)f(this)i(framing.)d(Excellent,)i(we)g(brok)o(e)f
(all)i(e)o(xisting)e(implementations!)-2 746 y
SDict begin H.S end
 -2 746
a -2 746 a
SDict begin 13 H.A end
 -2 746 a -2 746 a
SDict begin [/View [/XYZ H.V]/Dest (0:4066) cvn /DEST pdfmark end
 -2 746 a 396 836 a Fk(Backw)o(ards)h
(compatibility)f(is)i(hard,)e(b)n(ut)h(using)g(\330MQ)g(framing)f(for)g
(control)g(\003o)n(ws)2910 836 y
SDict begin H.S end
 2910 836 a 2910 836
a
SDict begin 13 H.A end
 2910 836 a 2910 836 a
SDict begin [/View [/XYZ H.V]/Dest (0:4067) cvn /DEST pdfmark end
 2910 836 a Ff(does)h(not)g(help)p
Fk(.)f(Here')-5 b(s)21 b(ho)n(w)e(I)396 944 y(should)g(ha)n(v)o(e)g
(designed)f(this)i(protocol)e(if)i(I')l(d)e(follo)n(wed)g(by)i(o)n(wn)f
(advice)f(\(and)h(I')o(ll)h(\002x)f(this)h(in)g(the)g(ne)o(xt)e(v)o
(ersion\).)g(It')-5 b(s)396 1052 y(split)21 b(into)f(a)h(Cheap)e(part)h
(and)g(a)h(Nasty)f(part,)g(and)f(uses)i(the)f(\330MQ)h(framing)d(to)j
(separate)e(these:)-2 1153 y
SDict begin H.S end
 -2 1153 a -2 1153 a
SDict begin 11.7 H.A end
 -2 1153
a -2 1153 a
SDict begin [/View [/XYZ H.V]/Dest (0:4068) cvn /DEST pdfmark end
 -2 1153 a 396 1232 a Fe(Frame)44 b(0:)h("MDP/2.0")e(for)h
(protocol)g(name)g(and)g(version)396 1329 y(Frame)g(1:)h(command)e
(header)396 1427 y(Frame)h(2:)h(command)e(body)-2 1604
y
SDict begin H.S end
 -2 1604 a -2 1604 a
SDict begin 13 H.A end
 -2 1604 a -2 1604 a
SDict begin [/View [/XYZ H.V]/Dest (0:4069) cvn /DEST pdfmark end
 -2 1604 a 396
1701 a Fk(Where)20 b(we')l(d)g(e)o(xpect)f(the)h(parse)g(the)g(command)
f(header)g(in)h(the)g(v)n(arious)f(intermediaries)g(\(client)h(API,)g
(brok)o(er)m(,)e(and)396 1808 y(w)o(ork)o(er)h(API\),)h(and)g(pass)h
(the)f(command)e(body)h(untouched)f(from)h(application)f(to)j
(application.)-2 1837 y
SDict begin H.S end
 -2 1837 a -2 1837 a
SDict begin 13 H.A end
 -2 1837 a
-2 1837 a
SDict begin [/View [/XYZ H.V]/Dest (0:4070) cvn /DEST pdfmark end
 -2 1837 a 396 2147 a Fb(6.7.3.)36 b(Serialization)e(Langua)o
(g)q(es)2095 2147 y
SDict begin H.S end
 2095 2147 a 2095 2147 a
SDict begin 18.72 H.A end
 2095 2147
a 2095 2147 a
SDict begin [/View [/XYZ H.V]/Dest (11.81.42.2) cvn /DEST pdfmark end
 2095 2147 a -2 2340 a
SDict begin H.S end
 -2 2340 a -2 2340
a
SDict begin 13 H.A end
 -2 2340 a -2 2340 a
SDict begin [/View [/XYZ H.V]/Dest (0:4072) cvn /DEST pdfmark end
 -2 2340 a 396 2421 a Fk(Serialization)20
b(languages)e(ha)n(v)o(e)i(their)g(f)o(ashions.)f(XML)i(used)f(to)g(be)
g(big)g(as)h(in)f(popular)m(,)e(then)i(it)h(got)e(big)h(as)h(in)396
2529 y(o)o(v)o(er)n(-engineered,)16 b(and)k(then)f(it)i(fell)g(into)f
(the)g(hands)f(of)h("Enterprise)f(Information)e(Architects")j(and)g
(it')-5 b(s)21 b(not)f(been)396 2637 y(seen)h(ali)n(v)o(e)e(since.)h(T)
-7 b(oday')i(s)20 b(XML)g(is)h(the)g(epitome)e(of)h("some)n(where)e(in)
j(that)f(mess)h(is)g(small,)f(ele)o(gant)f(language)396
2745 y(trying)g(to)i(escape".)-2 2929 y
SDict begin H.S end
 -2 2929 a -2
2929 a
SDict begin 13 H.A end
 -2 2929 a -2 2929 a
SDict begin [/View [/XYZ H.V]/Dest (0:4073) cvn /DEST pdfmark end
 -2 2929 a 396 3019 a Fk(Still)g(XML,)f(w)o
(as)i(w)o(ay)-5 b(,)19 b(w)o(ay)h(better)g(than)g(its)h(predecessors)e
(which)h(included)e(such)i(monsters)g(as)h(the)f(Standard)396
3127 y(Generalized)f(Markup)g(Language)f(\(SGML\),)h(which)h(in)g(turn)
g(were)g(a)g(cool)g(breeze)g(compared)e(to)i(mind-torturing)396
3235 y(beasts)h(lik)o(e)f(EDIF)-6 b(A)m(CT)g(.)20 b(So)g(the)g(history)
g(of)g(serialization)f(languages)g(seems)i(to)f(be)g(of)g(gradually)e
(emer)o(ging)g(sanity)-5 b(,)396 3342 y(hidden)19 b(by)h(w)o(a)n(v)o
(es)g(of)g(re)n(v)n(olting)f(EIAs)h(doing)f(their)h(best)h(to)f(hold)f
(onto)h(their)g(jobs.)-2 3526 y
SDict begin H.S end
 -2 3526 a -2 3526 a
SDict begin 13 H.A end
 -2
3526 a -2 3526 a
SDict begin [/View [/XYZ H.V]/Dest (0:4074) cvn /DEST pdfmark end
 -2 3526 a 396 3616 a Fk(JSON)h(popped)e(out)g(of)h
(the)h(Ja)n(v)n(aScript)e(w)o(orld)h(as)h(a)g(quick-and-dirty)16
b("I')l(d)j(rather)g(resign)h(than)g(use)g(XML)g(here")396
3724 y(w)o(ay)g(to)g(thro)n(w)g(data)g(onto)f(the)h(wire)g(and)f(get)h
(it)h(back)e(again.)g(JSON)i(is)g(just)g(minimal)e(XML)h(e)o(xpressed,)
e(sneakily)-5 b(,)19 b(as)396 3832 y(Ja)n(v)n(aScript)h(source)g(code.)
-2 4016 y
SDict begin H.S end
 -2 4016 a -2 4016 a
SDict begin 13 H.A end
 -2 4016 a -2 4016 a
SDict begin [/View [/XYZ H.V]/Dest (0:4075) cvn /DEST pdfmark end
 -2
4016 a 396 4106 a Fk(Here')-5 b(s)21 b(a)f(simple)g(e)o(xample)f(of)h
(using)g(JSON)h(in)f(a)h(Cheap)f(protocol:)-2 4207 y
SDict begin H.S end

-2 4207 a -2 4207 a
SDict begin 11.7 H.A end
 -2 4207 a -2 4207 a
SDict begin [/View [/XYZ H.V]/Dest (0:4076) cvn /DEST pdfmark end
 -2 4207 a 396
4286 a Fe("protocol":)43 b({)576 4384 y("name":)g("MTL",)576
4481 y("version":)g(1)396 4578 y(},)396 4675 y("virtual-host":)g
("test-env")-2 4842 y
SDict begin H.S end
 -2 4842 a -2 4842 a
SDict begin 13 H.A end
 -2 4842 a -2
4842 a
SDict begin [/View [/XYZ H.V]/Dest (0:4077) cvn /DEST pdfmark end
 -2 4842 a 396 4949 a Fk(The)20 b(same)g(in)h(XML)f(w)o(ould)g
(be)g(\(XML)g(forces)f(us)i(to)f(in)m(v)o(ent)f(a)h(single)g(top-le)n
(v)o(el)f(entity\):)-2 5050 y
SDict begin H.S end
 -2 5050 a -2 5050 a
SDict begin 11.7 H.A end
 -2
5050 a -2 5050 a
SDict begin [/View [/XYZ H.V]/Dest (0:4078) cvn /DEST pdfmark end
 -2 5050 a 396 5129 a Fe(<command>)p
Black 3756 5569 a Ff(337)p Black eop end
%%Page: 338 351
TeXDict begin 338 350 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.338) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(<protocol)43 b(name)h(=)h("MTL")f(version)f(=)i("1")f
(/>)576 170 y(<virtual-host>test-env</virtual-host>)396
267 y(</command>)-2 439 y
SDict begin H.S end
 -2 439 a -2 439 a
SDict begin 13 H.A end
 -2 439 a
-2 439 a
SDict begin [/View [/XYZ H.V]/Dest (0:4079) cvn /DEST pdfmark end
 -2 439 a 396 541 a Fk(And)20 b(using)g(plain-old)e(HTTP-style)
i(headers:)-2 642 y
SDict begin H.S end
 -2 642 a -2 642 a
SDict begin 11.7 H.A end
 -2 642 a -2 642
a
SDict begin [/View [/XYZ H.V]/Dest (0:4080) cvn /DEST pdfmark end
 -2 642 a 396 721 a Fe(Protocol:)44 b(MTL/1.0)396 818
y(Virtual-host:)f(test-env)-2 985 y
SDict begin H.S end
 -2 985 a -2 985 a
SDict begin 13 H.A end

-2 985 a -2 985 a
SDict begin [/View [/XYZ H.V]/Dest (0:4081) cvn /DEST pdfmark end
 -2 985 a 396 1092 a Fk(These)20 b(are)g(all)h(pretty)
f(equi)n(v)n(alent)e(so)j(long)e(as)i(you)e(don')o(t)g(go)h(o)o(v)o
(erboard)c(with)21 b(v)n(alidating)d(parsers,)i(schemas)g(and)396
1200 y(such)g("trust)g(us,)h(this)f(is)i(all)e(for)g(your)f(o)n(wn)h
(good")e(nonsense.)h(A)i(Cheap)f(serialization)f(language)g(gi)n(v)o
(es)g(you)h(space)396 1308 y(for)g(e)o(xperimentation)d(for)i(free)h
(\("ignore)f(an)o(y)g(elements/attrib)n(utes/headers)f(that)i(you)g
(don')o(t)e(recognize"\),)g(and)h(it')-5 b(s)396 1416
y(simple)20 b(to)h(write)f(generic)f(parsers)h(that)g(e.g.)g(thunk)f(a)
i(command)d(into)i(a)g(hash)g(table,)g(or)g(vice-v)o(ersa.)-2
1600 y
SDict begin H.S end
 -2 1600 a -2 1600 a
SDict begin 13 H.A end
 -2 1600 a -2 1600 a
SDict begin [/View [/XYZ H.V]/Dest (0:4082) cvn /DEST pdfmark end
 -2 1600
a 396 1690 a Fk(Ho)n(we)n(v)o(er)f(it')-5 b(s)21 b(not)f(all)h(roses.)f
(While)h(modern)d(scripting)h(languages)g(support)g(JSON)i(and)f(XML)g
(easily)g(enough,)396 1798 y(older)g(languages)e(do)i(not.)g(If)g(you)f
(use)i(XML)f(or)g(JSON,)h(you)e(create)h(non-tri)n(vial)e
(dependencies.)g(It')-5 b(s)21 b(also)396 1906 y(some)n(what)f(of)g(a)g
(pain)g(to)g(w)o(ork)g(with)g(tree-structured)e(data)i(in)g(a)h
(language)d(lik)o(e)j(C.)-2 2090 y
SDict begin H.S end
 -2 2090 a -2 2090
a
SDict begin 13 H.A end
 -2 2090 a -2 2090 a
SDict begin [/View [/XYZ H.V]/Dest (0:4083) cvn /DEST pdfmark end
 -2 2090 a 396 2180 a Fk(So)g(you)e(can)h(dri)n(v)
o(e)f(your)g(choice)g(according)f(to)j(the)f(languages)f(you')l(re)f
(aiming)h(for)-5 b(.)20 b(If)g(your)f(uni)n(v)o(erse)g(is)i(a)g
(scripting)396 2288 y(language)d(then)h(go)g(for)g(JSON.)i(If)e(you)g
(are)g(aiming)g(to)h(b)n(uild)f(protocols)f(for)h(wider)g(system)h
(use,)g(k)o(eep)f(things)g(simple)396 2395 y(for)h(C)h(de)n(v)o
(elopers)d(and)i(stick)g(to)h(HTTP-style)e(headers.)-2
2424 y
SDict begin H.S end
 -2 2424 a -2 2424 a
SDict begin 13 H.A end
 -2 2424 a -2 2424 a
SDict begin [/View [/XYZ H.V]/Dest (0:4084) cvn /DEST pdfmark end
 -2 2424
a 396 2734 a Fb(6.7.4.)36 b(Serialization)e(Libraries)1970
2734 y
SDict begin H.S end
 1970 2734 a 1970 2734 a
SDict begin 18.72 H.A end
 1970 2734 a 1970 2734
a
SDict begin [/View [/XYZ H.V]/Dest (11.81.43.2) cvn /DEST pdfmark end
 1970 2734 a -2 2901 a
SDict begin H.S end
 -2 2901 a -2 2901 a
SDict begin 13 H.A end
 -2 2901 a
-2 2901 a
SDict begin [/View [/XYZ H.V]/Dest (0:4086) cvn /DEST pdfmark end
 -2 2901 a 396 3008 a Fk(The)20 b(msgpack.or)o(g)d(site)k
(says,)f("It')-5 b(s)21 b(lik)o(e)g(JSON.)g(b)n(ut)f(f)o(ast)h(and)e
(small.)i(MessageP)o(ack)e(is)i(an)f(ef)n(\002cient)g(binary)396
3116 y(serialization)g(format.)f(It)h(lets)h(you)f(e)o(xchange)e(data)i
(among)e(multiple)i(languages)f(lik)o(e)h(JSON)h(b)n(ut)f(it')-5
b(s)22 b(f)o(aster)e(and)396 3224 y(smaller)-5 b(.)21
b(F)o(or)e(e)o(xample,)g(small)i(inte)o(gers)e(\(lik)o(e)h(\003ags)h
(or)f(error)f(code\))g(are)h(encoded)e(into)i(a)h(single)f(byte,)f(and)
h(typical)396 3332 y(short)g(strings)g(only)g(require)e(an)j(e)o(xtra)e
(byte)h(in)g(addition)f(to)h(the)h(strings)f(themselv)o(es.")-2
3516 y
SDict begin H.S end
 -2 3516 a -2 3516 a
SDict begin 13 H.A end
 -2 3516 a -2 3516 a
SDict begin [/View [/XYZ H.V]/Dest (0:4087) cvn /DEST pdfmark end
 -2 3516
a 396 3606 a Fk(I'm)g(going)f(to)h(mak)o(e)g(the)g(perhaps)f(unpopular)
e(claim)k(that)f("f)o(ast)h(and)e(small")i(are)f(features)f(that)i
(solv)o(e)396 3714 y(non-problems.)c(The)j(only)f(real)h(problem)f
(that)h(serialization)g(libraries)g(solv)o(e)f(is,)i(as)g(f)o(ar)f(as)h
(I)f(can)g(tell,)h(the)f(need)g(to)396 3822 y(document)e(the)j(message)
f(contracts)f(and)h(actually)f(serialize)i(data)f(to)g(and)g(from)f
(the)h(wire.)-2 4006 y
SDict begin H.S end
 -2 4006 a -2 4006 a
SDict begin 13 H.A end
 -2 4006 a
-2 4006 a
SDict begin [/View [/XYZ H.V]/Dest (0:4088) cvn /DEST pdfmark end
 -2 4006 a 396 4095 a Fk(Let')-5 b(s)21 b(start)g(with)f("f)o
(ast)h(and)e(small".)i(It')-5 b(s)21 b(based)e(on)h(a)h(tw)o(o-part)e
(ar)o(gument.)f(First,)i(that)h(making)d(your)h(messages)396
4203 y(smaller)m(,)h(and)g(that)g(reducing)e(CPU)j(cost)g(for)e
(encoding)f(and)i(decoding)e(will)j(mak)o(e)f(a)g(signi\002cant)g(dif)n
(ferent)f(to)h(your)396 4311 y(application')-5 b(s)19
b(performance.)e(Second,)i(that)i(this)f(equally)f(v)n(alid)h
(across-the-board)d(to)k(all)f(messages.)-2 4495 y
SDict begin H.S end
 -2
4495 a -2 4495 a
SDict begin 13 H.A end
 -2 4495 a -2 4495 a
SDict begin [/View [/XYZ H.V]/Dest (0:4089) cvn /DEST pdfmark end
 -2 4495 a 396 4585
a Fk(But)h(most)f(real)g(applications)f(tend)h(to)g(f)o(all)h(into)f
(one)g(of)g(tw)o(o)g(cate)o(gories.)f(Either)h(the)g(speed)g(of)f
(serialization)h(and)396 4693 y(size)h(of)f(encoding)e(is)j(mar)o
(ginal)e(compared)f(to)i(other)f(costs,)i(such)f(as)h(database)e
(access)i(or)f(application)f(code)396 4801 y(performance.)e(Or)m(,)j
(netw)o(ork)f(performance)e(really)j(is)h(critical,)f(and)g(then)g(all)
g(signi\002cant)g(costs)h(occur)e(in)h(a)h(fe)n(w)396
4909 y(speci\002c)g(message)f(types.)p Black 3759 5569
a Ff(338)p Black eop end
%%Page: 339 352
TeXDict begin 339 351 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.339) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4090) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Thus,)h(aiming)f(for)h("f)o(ast)g(and)g(small")h
(across)f(the)g(board)f(is)i(a)g(f)o(alse)f(optimization.)f(Y)-9
b(ou)19 b(neither)g(get)i(the)f(easy)396 180 y(\003e)o(xibility)g(of)g
(Cheap)g(for)f(your)g(infrequent)f(control)h(\003o)n(ws,)h(nor)g(do)f
(you)h(get)g(the)g(brutal)g(ef)n(\002cienc)o(y)e(of)i(Nasty)h(for)396
288 y(your)e(high-v)n(olume)e(data)j(\003o)n(ws.)h(W)-7
b(orse,)20 b(the)g(assumption)f(that)h(all)h(messages)f(are)g(equal)f
(in)i(some)e(w)o(ay)i(can)e(corrupt)396 396 y(your)g(protocol)g
(design.)g(Cheap)h(and)f(Nasty)i(isn')o(t)f(only)f(about)g
(serialization)h(strate)o(gies,)g(it')-5 b(s)21 b(also)g(about)396
504 y(synchronous)d(vs.)i(asynchronous,)d(error)i(handling,)f(and)i
(the)g(cost)h(of)e(change.)-2 688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end

-2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:4091) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(My)h(e)o(xperience)e(is)k(that)
e(most)g(performance)d(problems)i(in)h(message-based)f(applications)g
(can)h(be)g(solv)o(ed)g(by)f(\(a\))396 886 y(impro)o(ving)f(the)i
(application)f(itself)h(and)g(\(b\))g(hand-optimizing)c(the)k(high-v)n
(olume)e(data)i(\003o)n(ws.)g(And)g(to)396 994 y(hand-optimize)e(your)h
(most)h(critical)g(data)g(\003o)n(ws,)h(you)e(need)g(to)i(cheat,)e(kno)
n(w)g(and)h(e)o(xploit)f(f)o(acts)i(about)e(your)g(data,)396
1102 y(which)h(is)h(something)e(general-purpose)d(serializers)21
b(cannot)e(do.)-2 1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286
a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:4092) cvn /DEST pdfmark end
 -2 1286 a 396 1376 a Fk(No)n(w)h(to)h(documentation:)c(the)
j(need)g(to)g(write)g(our)g(contracts)f(e)o(xplicitly)g(and)h(formally)
-5 b(,)18 b(not)i(in)g(code.)g(This)g(is)h(a)396 1484
y(v)n(alid)f(problem)e(to)j(solv)o(e,)e(indeed)g(one)h(of)g(the)g(main)
g(ones)g(if)g(we')l(re)g(to)g(b)n(uild)g(a)h(long-lasting)d(lar)o
(ge-scale)396 1592 y(message-based)h(architecture.)-2
1776 y
SDict begin H.S end
 -2 1776 a -2 1776 a
SDict begin 13 H.A end
 -2 1776 a -2 1776 a
SDict begin [/View [/XYZ H.V]/Dest (0:4093) cvn /DEST pdfmark end
 -2 1776
a 396 1866 a Fk(Here)h(is)h(ho)n(w)f(we)h(describe)e(a)i(typical)e
(message)h(using)g(the)g(MessageP)o(ack)g(IDL:)-2 1967
y
SDict begin H.S end
 -2 1967 a -2 1967 a
SDict begin 11.7 H.A end
 -2 1967 a -2 1967 a
SDict begin [/View [/XYZ H.V]/Dest (0:4094) cvn /DEST pdfmark end
 -2 1967 a 396
2046 a Fe(message)44 b(Person)g({)486 2143 y(1:)g(string)g(surname)486
2240 y(2:)g(string)g(firstname)486 2337 y(3:)g(optional)g(string)g
(email)396 2434 y(})-2 2609 y
SDict begin H.S end
 -2 2609 a -2 2609 a
SDict begin 13 H.A end
 -2
2609 a -2 2609 a
SDict begin [/View [/XYZ H.V]/Dest (0:4095) cvn /DEST pdfmark end
 -2 2609 a 396 2708 a Fk(No)n(w)-5 b(,)20
b(the)g(same)g(message)g(using)g(the)g(protob)n(ufs)e(IDL:)-2
2809 y
SDict begin H.S end
 -2 2809 a -2 2809 a
SDict begin 11.7 H.A end
 -2 2809 a -2 2809 a
SDict begin [/View [/XYZ H.V]/Dest (0:4096) cvn /DEST pdfmark end
 -2 2809
a 396 2889 a Fe(message)44 b(Person)g({)486 2986 y(required)f(string)h
(surname)g(=)h(1;)486 3083 y(required)e(string)h(firstname)g(=)g(2;)486
3180 y(optional)f(string)h(email)g(=)h(3;)396 3277 y(})-2
3451 y
SDict begin H.S end
 -2 3451 a -2 3451 a
SDict begin 13 H.A end
 -2 3451 a -2 3451 a
SDict begin [/View [/XYZ H.V]/Dest (0:4097) cvn /DEST pdfmark end
 -2 3451
a 396 3551 a Fk(It)21 b(w)o(orks)f(b)n(ut)g(in)g(most)g(practical)g
(cases,)h(wins)f(you)f(little)j(o)o(v)o(er)c(a)j(serialization)e
(language)g(back)o(ed)g(by)h(decent)396 3659 y(speci\002cations)g
(written)g(by)g(hand)f(or)h(produced)d(mechanically)i(\(we')o(ll)h
(come)g(to)g(this\).)g(The)g(price)g(you')o(ll)f(pay)h(is)h(an)396
3767 y(e)o(xtra)f(dependenc)o(y)-5 b(,)16 b(and)k(quite)g(probably)-5
b(,)17 b(w)o(orse)j(o)o(v)o(erall)f(performance)e(than)j(if)g(you)g
(used)f(Cheap)h(and)g(Nasty)-5 b(.)-2 3795 y
SDict begin H.S end
 -2 3795
a -2 3795 a
SDict begin 13 H.A end
 -2 3795 a -2 3795 a
SDict begin [/View [/XYZ H.V]/Dest (0:4098) cvn /DEST pdfmark end
 -2 3795 a 396 4105 a
Fb(6.7.5.)36 b(Hand-written)d(Binar)q(y)i(Serialization)2602
4105 y
SDict begin H.S end
 2602 4105 a 2602 4105 a
SDict begin 18.72 H.A end
 2602 4105 a 2602 4105
a
SDict begin [/View [/XYZ H.V]/Dest (11.81.44.2) cvn /DEST pdfmark end
 2602 4105 a -2 4296 a
SDict begin H.S end
 -2 4296 a -2 4296 a
SDict begin 13 H.A end
 -2 4296 a
-2 4296 a
SDict begin [/View [/XYZ H.V]/Dest (0:4100) cvn /DEST pdfmark end
 -2 4296 a 396 4379 a Fk(As)21 b(you')o(ll)e(gather)g(from)g
(this)h(book,)f(my)g(preferred)f(language)g(for)i(systems)g
(programming)d(is)k(C)g(\(upgraded)c(to)j(C99,)396 4487
y(with)h(a)f(constructor/destructor)d(API)j(model)f(and)h(generic)f
(containers\).)g(There)g(are)h(tw)o(o)g(reasons)g(I)h(lik)o(e)f(this)
396 4595 y(modernized)e(C)j(language:)e(\002rstly)-5
b(,)20 b(I'm)f(too)h(weak-minded)e(to)i(learn)g(a)g(big)g(language)f
(lik)o(e)h(C++.)h(Life)f(just)g(seems)396 4703 y(\002lled)h(with)f
(more)f(interesting)h(things)f(to)i(understand.)d(Secondly)-5
b(,)18 b(I)i(\002nd)g(that)g(this)h(speci\002c)f(le)n(v)o(el)g(of)g
(manual)396 4811 y(control)f(lets)i(me)f(produce)f(better)g(results,)i
(and)e(f)o(aster)-5 b(.)p Black 3759 5569 a Ff(339)p
Black eop end
%%Page: 340 353
TeXDict begin 340 352 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.340) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4101) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)h(point)g(here)f(isn')o(t)h(C)h(vs.)g(C++)f(b)n
(ut)g(the)h(v)n(alue)e(of)h(manual)f(control)g(for)h(high-end)e
(professional)g(users.)i(It')-5 b(s)21 b(no)396 180 y(accident)f(that)g
(the)g(best)h(cars)f(and)g(cameras)f(and)h(espresso)g(machines)f(in)i
(the)f(w)o(orld)g(ha)n(v)o(e)f(manual)g(controls.)g(That)396
288 y(le)n(v)o(el)g(of)g(on-the-spot)e(\002ne-tuning)h(often)g(mak)o
(es)h(the)h(dif)n(ference)d(between)h(w)o(orld-class)h(success,)h(and)e
(second-best.)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2
472 a
SDict begin [/View [/XYZ H.V]/Dest (0:4102) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(When)i(you)g(are)g(really)-5
b(,)19 b(truly)-5 b(,)19 b(concerned)f(about)h(the)h(speed)g(of)g
(serialization)f(and/or)g(the)h(size)h(of)f(the)g(result)h(\(often)396
670 y(these)g(contradict)d(each)i(other\),)f(you)g(need)h(hand-written)
e(binary)h(serialization,)g(in)h(other)g(w)o(ords,)f(let')-5
b(s)21 b(hear)f(it)h(for)396 778 y(Mr)-5 b(.)21 b(Nasty!)-2
962 y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:4103) cvn /DEST pdfmark end
 -2 962 a 396
1052 a Fk(Y)-9 b(our)19 b(basic)i(process)f(for)f(writing)h(an)g(ef)n
(\002cient)g(Nasty)g(encoder/decoder)c(\(codec\))j(is:)-2
1070 y
SDict begin H.S end
 -2 1070 a -2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:4104) cvn /DEST pdfmark end
 -2 1070
a -2 1080 a
SDict begin H.S end
 -2 1080 a -2 1080 a
SDict begin 13 H.A end
 -2 1080 a -2 1080 a
SDict begin [/View [/XYZ H.V]/Dest (0:4105) cvn /DEST pdfmark end
 -2
1080 a Black 396 1222 a Fj(\225)p Black 479 1222 a
SDict begin H.S end
 479
1222 a 479 1222 a
SDict begin 13 H.A end
 479 1222 a 479 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:4106) cvn /DEST pdfmark end
 479 1222 a Fk(Build)i
(representati)n(v)o(e)d(data)i(sets)h(and)f(test)h(applications)e(that)
h(can)g(stress-test)h(your)e(codec.)-2 1240 y
SDict begin H.S end
 -2 1240
a -2 1240 a
SDict begin 13 H.A end
 -2 1240 a -2 1240 a
SDict begin [/View [/XYZ H.V]/Dest (0:4107) cvn /DEST pdfmark end
 -2 1240 a Black 396 1372
a Fj(\225)p Black 479 1372 a
SDict begin H.S end
 479 1372 a 479 1372 a
SDict begin 13 H.A end
 479
1372 a 479 1372 a
SDict begin [/View [/XYZ H.V]/Dest (0:4108) cvn /DEST pdfmark end
 479 1372 a Fk(Write)i(a)g(\002rst)g(dumb)e(v)o
(ersion)f(of)i(the)h(codec.)-2 1373 y
SDict begin H.S end
 -2 1373 a -2 1373
a
SDict begin 13 H.A end
 -2 1373 a -2 1373 a
SDict begin [/View [/XYZ H.V]/Dest (0:4109) cvn /DEST pdfmark end
 -2 1373 a Black 396 1521 a Fj(\225)p
Black 479 1521 a
SDict begin H.S end
 479 1521 a 479 1521 a
SDict begin 13 H.A end
 479 1521 a 479
1521 a
SDict begin [/View [/XYZ H.V]/Dest (0:4110) cvn /DEST pdfmark end
 479 1521 a Fk(T)-6 b(est,)21 b(measure,)e(impro)o(v)o(e,)f(and)h
(repeat)h(until)g(you)f(run)h(out)g(of)g(time)g(and/or)f(mone)o(y)-5
b(.)-2 1705 y
SDict begin H.S end
 -2 1705 a -2 1705 a
SDict begin 13 H.A end
 -2 1705 a -2 1705 a
SDict begin [/View [/XYZ H.V]/Dest (0:4111) cvn /DEST pdfmark end

-2 1705 a 396 1795 a Fk(Here)20 b(are)g(some)g(of)g(the)h(techniques)d
(we)j(use)f(to)h(mak)o(e)e(our)h(codecs)g(better:)-2
1813 y
SDict begin H.S end
 -2 1813 a -2 1813 a
SDict begin 13 H.A end
 -2 1813 a -2 1813 a
SDict begin [/View [/XYZ H.V]/Dest (0:4112) cvn /DEST pdfmark end
 -2 1813
a -2 1823 a
SDict begin H.S end
 -2 1823 a -2 1823 a
SDict begin 13 H.A end
 -2 1823 a -2 1823 a
SDict begin [/View [/XYZ H.V]/Dest (0:4113) cvn /DEST pdfmark end
 -2
1823 a Black 396 1965 a Fj(\225)p Black 479 1965 a
SDict begin H.S end
 479
1965 a 479 1965 a
SDict begin 13 H.A end
 479 1965 a 479 1965 a
SDict begin [/View [/XYZ H.V]/Dest (0:4114) cvn /DEST pdfmark end
 479 1965 a 479
1965 a
SDict begin H.S end
 479 1965 a 479 1965 a
SDict begin 13 H.A end
 479 1965 a 479 1965 a
SDict begin [/View [/XYZ H.V]/Dest (0:4115) cvn /DEST pdfmark end
 479
1965 a Ff(Use)h(a)f(pr)l(o\002ler)-9 b(.)20 b Fk(There')-5
b(s)20 b(simply)g(no)f(w)o(ay)i(to)f(kno)n(w)f(what)h(your)f(code)h(is)
h(doing)e(until)h(you')l(v)o(e)e(pro\002led)h(it,)h(for)479
2073 y(function)f(counts)g(and)h(for)f(CPU)j(cost)e(per)g(function.)e
(Once)i(you)f(\002nd)h(your)f(hot-spots,)g(\002x)i(them.)-2
2091 y
SDict begin H.S end
 -2 2091 a -2 2091 a
SDict begin 13 H.A end
 -2 2091 a -2 2091 a
SDict begin [/View [/XYZ H.V]/Dest (0:4116) cvn /DEST pdfmark end
 -2 2091
a Black 396 2223 a Fj(\225)p Black 479 2223 a
SDict begin H.S end
 479 2223
a 479 2223 a
SDict begin 13 H.A end
 479 2223 a 479 2223 a
SDict begin [/View [/XYZ H.V]/Dest (0:4117) cvn /DEST pdfmark end
 479 2223 a 479 2223
a
SDict begin H.S end
 479 2223 a 479 2223 a
SDict begin 13 H.A end
 479 2223 a 479 2223 a
SDict begin [/View [/XYZ H.V]/Dest (0:4118) cvn /DEST pdfmark end
 479 2223
a Ff(Eliminate)f(memory)g(allocations.)f Fk(On)h(a)g(modern)f(Linux)g
(k)o(ernel)g(the)i(heap)e(is)i(v)o(ery)e(f)o(ast,)i(b)n(ut)f(it')-5
b(s)21 b(still)h(the)479 2331 y(bottleneck)d(in)h(most)g(nai)n(v)o(e)g
(codecs.)f(On)h(older)g(k)o(ernels)f(the)i(heap)e(can)h(be)g
(tragically)g(slo)n(w)-5 b(.)19 b(Use)i(local)f(v)n(ariables)479
2439 y(\(the)g(stack\))g(instead)g(of)g(the)g(heap)g(where)f(you)h
(can.)-2 2457 y
SDict begin H.S end
 -2 2457 a -2 2457 a
SDict begin 13 H.A end
 -2 2457 a -2 2457
a
SDict begin [/View [/XYZ H.V]/Dest (0:4119) cvn /DEST pdfmark end
 -2 2457 a Black 396 2588 a Fj(\225)p Black 479 2588
a
SDict begin H.S end
 479 2588 a 479 2588 a
SDict begin 13 H.A end
 479 2588 a 479 2588 a
SDict begin [/View [/XYZ H.V]/Dest (0:4120) cvn /DEST pdfmark end
 479 2588
a 479 2588 a
SDict begin H.S end
 479 2588 a 479 2588 a
SDict begin 13 H.A end
 479 2588 a 479 2588
a
SDict begin [/View [/XYZ H.V]/Dest (0:4121) cvn /DEST pdfmark end
 479 2588 a Ff(T)-8 b(est)22 b(on)e(dif)o(fer)m(ent)f(platforms)h(and)
f(with)i(dif)o(fer)m(ent)f(compiler)o(s)g(and)f(compiler)h(options.)f
Fk(Apart)h(from)f(the)i(heap,)479 2696 y(there)f(are)g(man)o(y)f(other)
g(dif)n(ferences.)g(Y)-9 b(ou)19 b(need)h(to)g(learn)g(the)g(main)g
(ones,)g(and)f(allo)n(w)h(for)g(these.)-2 2714 y
SDict begin H.S end
 -2 2714
a -2 2714 a
SDict begin 13 H.A end
 -2 2714 a -2 2714 a
SDict begin [/View [/XYZ H.V]/Dest (0:4122) cvn /DEST pdfmark end
 -2 2714 a Black 396 2845
a Fj(\225)p Black 479 2845 a
SDict begin H.S end
 479 2845 a 479 2845 a
SDict begin 13 H.A end
 479
2845 a 479 2845 a
SDict begin [/View [/XYZ H.V]/Dest (0:4123) cvn /DEST pdfmark end
 479 2845 a 479 2845 a
SDict begin H.S end
 479 2845 a 479
2845 a
SDict begin 13 H.A end
 479 2845 a 479 2845 a
SDict begin [/View [/XYZ H.V]/Dest (0:4124) cvn /DEST pdfmark end
 479 2845 a Ff(Use)h(state)g(to)f(compr)m
(ess)g(better)-9 b(.)20 b Fk(If)g(you)g(are)g(concerned)e(about)h
(codec)g(performance,)e(you)j(are)g(almost)g(de\002nitely)479
2953 y(sending)f(the)i(same)f(kinds)g(of)f(data)i(man)o(y)e(times.)h
(There)f(will)i(be)f(redundanc)o(y)d(between)j(instances)g(of)g(data.)f
(Y)-9 b(ou)479 3061 y(can)20 b(detect)g(these,)g(and)g(use)g(that)h(to)
f(compress)f(\(e.g.)h(a)g(short)g(v)n(alue)g(that)g(means)g("same)g(as)
h(last)g(time"\).)-2 3079 y
SDict begin H.S end
 -2 3079 a -2 3079 a
SDict begin 13 H.A end
 -2 3079
a -2 3079 a
SDict begin [/View [/XYZ H.V]/Dest (0:4125) cvn /DEST pdfmark end
 -2 3079 a Black 396 3211 a Fj(\225)p Black
479 3211 a
SDict begin H.S end
 479 3211 a 479 3211 a
SDict begin 13 H.A end
 479 3211 a 479 3211
a
SDict begin [/View [/XYZ H.V]/Dest (0:4126) cvn /DEST pdfmark end
 479 3211 a 479 3211 a
SDict begin H.S end
 479 3211 a 479 3211 a
SDict begin 13 H.A end
 479 3211
a 479 3211 a
SDict begin [/View [/XYZ H.V]/Dest (0:4127) cvn /DEST pdfmark end
 479 3211 a Ff(Know)g(your)f(data.)f Fk(The)h(best)g
(compression)f(techniques)f(\(in)i(terms)h(of)f(CPU)h(cost)f(for)g
(compactness\))f(require)479 3319 y(kno)n(wing)g(about)g(the)h(data.)g
(F)o(or)g(e)o(xample)e(the)j(techniques)d(to)j(compress)e(a)i(w)o(ord)e
(list,)i(a)g(video,)e(and)h(a)g(stream)g(of)479 3427
y(stock)g(mark)o(et)g(data)g(are)g(all)h(dif)n(ferent.)-2
3428 y
SDict begin H.S end
 -2 3428 a -2 3428 a
SDict begin 13 H.A end
 -2 3428 a -2 3428 a
SDict begin [/View [/XYZ H.V]/Dest (0:4128) cvn /DEST pdfmark end
 -2 3428
a Black 396 3576 a Fj(\225)p Black 479 3576 a
SDict begin H.S end
 479 3576
a 479 3576 a
SDict begin 13 H.A end
 479 3576 a 479 3576 a
SDict begin [/View [/XYZ H.V]/Dest (0:4129) cvn /DEST pdfmark end
 479 3576 a 479 3576
a
SDict begin H.S end
 479 3576 a 479 3576 a
SDict begin 13 H.A end
 479 3576 a 479 3576 a
SDict begin [/View [/XYZ H.V]/Dest (0:4130) cvn /DEST pdfmark end
 479 3576
a Ff(Be)g(r)m(eady)e(to)i(br)m(eak)e(the)i(rules.)f Fk(Do)g(you)g
(really)f(need)h(to)g(encode)f(inte)o(gers)h(in)g(big-endian)e(netw)o
(ork)h(byte)g(order?)479 3684 y(x86)h(and)f(ARM)i(account)e(for)h
(almost)g(all)h(modern)d(CPUs,)j(yet)f(use)h(little-endian)e(\(ARM)h
(is)h(actually)f(bi-endian)479 3792 y(b)n(ut)g(Android,)f(lik)o(e)h(W)m
(indo)n(ws)g(and)f(iOS,)i(is)g(little-endian\).)-2 3848
y
SDict begin H.S end
 -2 3848 a -2 3848 a
SDict begin 13 H.A end
 -2 3848 a -2 3848 a
SDict begin [/View [/XYZ H.V]/Dest (0:4131) cvn /DEST pdfmark end
 -2 3848 a 396
4161 a Fb(6.7.6.)36 b(Code)e(Generation)1691 4161 y
SDict begin H.S end
 1691
4161 a 1691 4161 a
SDict begin 18.72 H.A end
 1691 4161 a 1691 4161 a
SDict begin [/View [/XYZ H.V]/Dest (11.81.45.2) cvn /DEST pdfmark end
 1691 4161
a -2 4329 a
SDict begin H.S end
 -2 4329 a -2 4329 a
SDict begin 13 H.A end
 -2 4329 a -2 4329 a
SDict begin [/View [/XYZ H.V]/Dest (0:4133) cvn /DEST pdfmark end
 -2
4329 a 396 4435 a Fk(Reading)20 b(the)g(pre)n(vious)f(tw)o(o)h
(sections,)g(you)f(might)h(ha)n(v)o(e)f(w)o(ondered,)f("could)i(I)g
(write)g(my)g(o)n(wn)g(IDL)g(generator)e(that)396 4543
y(w)o(as)j(better)f(than)g(a)g(general-purpose)d(one?")i(If)h(this)h
(thought)e(w)o(andered)f(into)i(your)f(mind,)g(it)i(probably)d(left)j
(pretty)396 4651 y(soon)f(after)m(,)f(chased)h(by)g(dark)f
(calculations)g(about)g(ho)n(w)h(much)f(w)o(ork)h(that)g(actually)g(in)
m(v)n(olv)o(ed.)-2 4835 y
SDict begin H.S end
 -2 4835 a -2 4835 a
SDict begin 13 H.A end
 -2 4835
a -2 4835 a
SDict begin [/View [/XYZ H.V]/Dest (0:4134) cvn /DEST pdfmark end
 -2 4835 a 396 4925 a Fk(What)h(if)f(I)h(told)f(you)f(of)h
(a)g(w)o(ay)h(to)f(b)n(uild)g(custom)f(IDL)i(generators)d(cheaply)h
(and)h(quickly?)e(A)j(w)o(ay)f(to)h(get)f(perfectly)396
5033 y(documented)d(contracts,)i(code)g(that)h(is)h(as)f(e)n(vil)g(and)
f(domain-speci\002c)f(as)i(you)f(need,)g(and)g(all)h(you)f(need)g(to)h
(do)f(is)i(sign)396 5141 y(a)o(w)o(ay)f(your)f(soul)h(\()950
5141 y
SDict begin H.S end
 950 5141 a 950 5141 a
SDict begin 13 H.A end
 950 5141 a 950 5141 a
SDict begin [/View [/XYZ H.V]/Dest (0:4135) cvn /DEST pdfmark end
 950
5141 a Ff(who)g(e)o(ver)g(r)m(eally)h(used)f(that,)f(amirite?)p
Fk(\))h(right)g(here...)p Black 3759 5569 a Ff(340)p
Black eop end
%%Page: 341 354
TeXDict begin 341 353 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.341) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4147) cvn /DEST pdfmark end
 -2 -201 a 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4136) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(At)i(iMatix,)f(until)g(a)h(fe)n(w)f(years)g(ago,)f
(we)i(used)f(code)f(generation)f(to)j(b)n(uild)e(e)n(v)o(er)h(lar)o
(ger)f(and)g(more)h(ambitious)396 180 y(systems)h(until)f(we)h(decided)
d(the)j(technology)c(\(GSL\))j(w)o(as)h(too)f(dangerous)e(for)i(common)
e(use,)i(and)g(we)g(sealed)h(the)396 288 y(archi)n(v)o(e)e(and)h(lock)o
(ed)f(it,)i(with)f(hea)n(vy)f(chains,)h(in)g(a)h(deep)e(dungeon.)f(W)-7
b(ell,)21 b(we)g(actually)e(posted)h(it)h(on)e(github)m(.)g(If)h(you)
396 396 y(w)o(ant)g(to)h(try)f(the)g(e)o(xamples)f(that)h(are)g(coming)
e(up,)i(grab)2060 396 y
SDict begin H.S end
 2060 396 a 2060 396 a
SDict begin 13 H.A end
 2060 396
a 2060 396 a
SDict begin [/View [/XYZ H.V]/Dest (0:4137) cvn /DEST pdfmark end
 2060 396 a Fk(the)g(repository)e(\(https://github)m
(.com/imatix/gsl\))e(and)j(b)n(uild)396 504 y(yourself)g(a)747
504 y
SDict begin H.S end
 747 504 a 747 504 a
SDict begin 13 H.A end
 747 504 a 747 504 a
SDict begin [/View [/XYZ H.V]/Dest (0:4138) cvn /DEST pdfmark end
 747 504
a Fe(gsl)h Fk(command.)e(T)-7 b(yping)19 b("mak)o(e")g(in)i(the)f(src)g
(subdirectory)e(should)h(do)h(it)h(\(and)e(if)i(you')l(re)d(that)i(guy)
g(who)396 612 y(lo)o(v)o(es)g(W)m(indo)n(ws,)f(I'm)h(sure)g(you')o(ll)f
(send)h(a)h(patch)e(with)i(project)e(\002les\).)-2 796
y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:4139) cvn /DEST pdfmark end
 -2 796 a 396 886
a Fk(This)i(section)f(isn')o(t)f(really)h(about)f(GSL)i(at)g(all,)f(b)n
(ut)g(about)g(a)g(useful)g(and)g(little-kno)n(wn)e(trick)i(that')-5
b(s)21 b(useful)e(for)396 994 y(ambitious)h(architects)f(who)h(w)o(ant)
g(to)h(scale)g(themselv)o(es,)e(as)i(well)f(as)h(their)f(w)o(ork.)f
(Once)h(you)g(learn)f(the)i(trick)f(is,)g(you)396 1102
y(can)g(whip)g(up)g(your)f(o)n(wn)g(code)h(generators)e(in)j(a)f(short)
g(time.)g(The)g(code)g(generators)e(most)i(softw)o(are)g(engineers)396
1210 y(kno)n(w)f(about)h(come)f(with)i(a)f(single)g(hard-coded)d
(model.)j(F)o(or)f(instance,)h(Ragel)g("compiles)g(e)o(x)o(ecutable)e
(\002nite)j(state)396 1318 y(machines)f(from)f(re)o(gular)f
(languages",)h(i.e.)h(Ragel')-5 b(s)21 b(model)e(is)i(a)g(re)o(gular)d
(language.)h(This)h(certainly)f(w)o(orks)h(for)g(a)396
1426 y(good)f(set)i(of)f(problems)f(b)n(ut)h(it')-5 b(s)21
b(f)o(ar)f(from)f(uni)n(v)o(ersal.)g(Ho)n(w)h(do)g(you)f(describe)h(an)
g(API)g(in)g(Ragel?)h(Or)f(a)h(project)396 1534 y(mak)o(e\002le?)e(Or)h
(e)n(v)o(en)e(a)i(\002nite-state)g(machine)e(lik)o(e)i(the)f(one)g(we)h
(used)f(to)h(design)f(the)g(Binary)g(Star)h(pattern)f(in)g(Chapter)396
1642 y(4?)-2 1808 y
SDict begin H.S end
 -2 1808 a -2 1808 a
SDict begin 13 H.A end
 -2 1808 a -2
1808 a
SDict begin [/View [/XYZ H.V]/Dest (0:4140) cvn /DEST pdfmark end
 -2 1808 a 396 1916 a Fk(All)i(these)f(w)o(ould)g(bene\002t)g
(from)f(code)g(generation,)f(b)n(ut)i(there')-5 b(s)21
b(no)e(uni)n(v)o(ersal)g(model.)g(So)i(the)f(trick)g(is)h(to)f(design)
396 2023 y(your)f(o)n(wn)h(models)f(as)i(you)f(need)f(them,)h(then)f
(mak)o(e)h(code)g(generators)e(as)j(cheap)e(compilers)h(for)f(that)i
(model.)e(Y)-9 b(ou)396 2131 y(need)20 b(some)g(e)o(xperience)e(in)i
(ho)n(w)g(to)g(mak)o(e)g(good)f(models,)g(and)h(you)f(need)h(a)g
(technology)e(that)i(mak)o(es)g(it)h(cheap)e(to)396 2239
y(b)n(uild)h(custom)g(code)f(generators.)f(Scripting)i(languages)e(lik)
o(e)j(Perl)f(and)g(Python)f(are)h(a)h(good)e(option.)f(Ho)n(we)n(v)o
(er)h(we)396 2347 y(actually)h(b)n(uilt)g(GSL)h(speci\002cally)f(for)f
(this,)i(and)e(that')-5 b(s)21 b(what)f(I)h(prefer)-5
b(.)-2 2531 y
SDict begin H.S end
 -2 2531 a -2 2531 a
SDict begin 13 H.A end
 -2 2531 a -2 2531 a
SDict begin [/View [/XYZ H.V]/Dest (0:4141) cvn /DEST pdfmark end

-2 2531 a 396 2621 a Fk(Let')g(s)21 b(tak)o(e)f(a)h(simple)f(e)o
(xample)f(that)h(ties)h(into)f(what)g(we)h(already)e(kno)n(w)-5
b(.)18 b(W)-7 b(e')o(ll)22 b(see)f(more)e(e)o(xtensi)n(v)o(e)g(e)o
(xamples)396 2729 y(later)m(,)h(because)f(I)i(really)f(do)f(belie)n(v)o
(e)h(that)g(code)f(generation)g(is)i(crucial)e(kno)n(wledge)f(for)i
(lar)o(ge-scale)f(w)o(ork.)g(In)396 2837 y(Chapter)h(4,)g(we)g(de)n(v)o
(eloped)e(the)1361 2837 y
SDict begin H.S end
 1361 2837 a 1361 2837 a
SDict begin 13 H.A end
 1361
2837 a 1361 2837 a
SDict begin [/View [/XYZ H.V]/Dest (0:4142) cvn /DEST pdfmark end
 1361 2837 a Fk(Majordomo)g(Protocol)h(\(MDP\))h
(\(http://rfc.zeromq.or)o(g/spec:7)o(\),)14 b(and)20
b(wrote)396 2945 y(clients,)h(brok)o(ers,)d(and)i(w)o(ork)o(ers)f(for)h
(that.)g(No)n(w)g(could)f(we)i(generate)e(those)h(pieces)g
(mechanically)-5 b(,)18 b(by)i(b)n(uilding)e(our)396
3053 y(o)n(wn)i(interf)o(ace)f(description)g(language)f(and)i(code)g
(generators?)-2 3237 y
SDict begin H.S end
 -2 3237 a -2 3237 a
SDict begin 13 H.A end
 -2 3237 a
-2 3237 a
SDict begin [/View [/XYZ H.V]/Dest (0:4143) cvn /DEST pdfmark end
 -2 3237 a 396 3327 a Fk(When)g(we)h(write)f(a)h(GSL)f(model,)
f(we)i(can)f(use)1793 3327 y
SDict begin H.S end
 1793 3327 a 1793 3327 a
SDict begin 13 H.A end

1793 3327 a 1793 3327 a
SDict begin [/View [/XYZ H.V]/Dest (0:4144) cvn /DEST pdfmark end
 1793 3327 a Ff(any)g Fk(semantics)g(we)h(lik)o
(e,)f(in)g(other)g(w)o(ords)g(we)g(can)g(in)m(v)o(ent)396
3435 y(domain-speci\002c)e(languages)h(on)h(the)g(spot.)g(I')o(ll)g(in)
m(v)o(ent)f(a)i(couple)e(-)h(see)h(if)f(you)g(can)g(guess)g(what)g(the)
o(y)g(represent:)-2 3536 y
SDict begin H.S end
 -2 3536 a -2 3536 a
SDict begin 11.7 H.A end
 -2 3536
a -2 3536 a
SDict begin [/View [/XYZ H.V]/Dest (0:4145) cvn /DEST pdfmark end
 -2 3536 a 396 3615 a Fe(slideshow)576 3712
y(name)44 b(=)g(Cookery)g(level)g(3)576 3809 y(page)755
3906 y(title)g(=)h(French)e(Cuisine)755 4004 y(item)h(=)h(Overview)755
4101 y(item)f(=)h(The)f(historical)f(cuisine)755 4198
y(item)h(=)h(The)f(nouvelle)g(cuisine)755 4295 y(item)g(=)h(Why)f(the)g
(French)g(live)g(longer)576 4392 y(page)755 4489 y(title)g(=)h
(Overview)755 4586 y(item)f(=)h(Soups)f(and)g(salads)755
4684 y(item)g(=)h(Le)f(plat)g(principal)755 4781 y(item)g(=)h
(B\303\251chamel)e(and)h(other)g(sauces)755 4878 y(item)g(=)h
(Pastries,)e(cakes,)h(and)g(quiches)755 4975 y(item)g(=)h
(Souffl\303\251)e(-)i(cheese)f(to)g(strawberry)p Black
3759 5569 a Ff(341)p Black eop end
%%Page: 342 355
TeXDict begin 342 354 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.342) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4146) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Ho)n(w)h(about)g(this)g(one:)396 253
y Fe(table)576 350 y(name)44 b(=)g(person)576 447 y(column)755
544 y(name)g(=)h(firstname)755 641 y(type)f(=)h(string)576
738 y(column)755 835 y(name)f(=)h(lastname)755 933 y(type)f(=)h(string)
576 1030 y(column)755 1127 y(name)f(=)h(rating)755 1224
y(type)f(=)h(integer)-2 1402 y
SDict begin H.S end
 -2 1402 a -2 1402 a
SDict begin 13 H.A end
 -2
1402 a -2 1402 a
SDict begin [/View [/XYZ H.V]/Dest (0:4148) cvn /DEST pdfmark end
 -2 1402 a 396 1498 a Fk(The)20 b(\002rst)h(we)g(could)
e(compile)g(into)h(a)h(presentation.)d(The)i(second,)f(into)h(SQL)g(to)
h(create)f(and)f(w)o(ork)h(with)g(a)h(database)396 1606
y(table.)f(So)h(for)e(this)i(e)o(x)o(ercise)e(our)h(domain)e(language,)
h(our)g(model,)g(consists)i(of)f("classes")h(that)f(contain)f
("messages")396 1714 y(that)i(contain)e("\002elds")h(of)g(v)n(arious)f
(types.)h(It')-5 b(s)21 b(deliberately)d(f)o(amiliar)-5
b(.)20 b(Here)g(is)i(the)e(MDP)g(client)h(protocol:)-2
1815 y
SDict begin H.S end
 -2 1815 a -2 1815 a
SDict begin 11.7 H.A end
 -2 1815 a -2 1815 a
SDict begin [/View [/XYZ H.V]/Dest (0:4149) cvn /DEST pdfmark end
 -2 1815
a 396 1894 a Fe(<class)44 b(name)g(=)h("mdp_client">)576
1991 y(MDP/Client)576 2088 y(<header>)755 2185 y(<field)f(name)g(=)h
("empty")e(type)h(=)h("string")f(value)g(=)g("")934 2283
y(>Empty)g(frame</field>)755 2380 y(<field)g(name)g(=)h("protocol")e
(type)h(=)h("string")e(value)h(=)h("MDPC01")934 2477
y(>Protocol)f(identifier</field>)576 2574 y(</header>)576
2671 y(<message)f(name)h(=)h("request">)755 2768 y(Client)f(request)f
(to)i(broker)755 2865 y(<field)f(name)g(=)h("service")e(type)h(=)h
("string">Service)d(name</field>)755 2962 y(<field)i(name)g(=)h("body")
e(type)i(=)f("frame">Request)f(body</field>)576 3060
y(</message>)576 3157 y(<message)g(name)h(=)h("reply">)755
3254 y(Response)e(back)i(to)f(client)755 3351 y(<field)g(name)g(=)h
("service")e(type)h(=)h("string">Service)d(name</field>)755
3448 y(<field)i(name)g(=)h("body")e(type)i(=)f("frame">Response)e
(body</field>)576 3545 y(</message>)396 3642 y(</class>)-2
3814 y
SDict begin H.S end
 -2 3814 a -2 3814 a
SDict begin 13 H.A end
 -2 3814 a -2 3814 a
SDict begin [/View [/XYZ H.V]/Dest (0:4150) cvn /DEST pdfmark end
 -2 3814
a 396 3916 a Fk(And)20 b(here)g(is)h(the)f(MDP)h(w)o(ork)o(er)e
(protocol:)-2 4017 y
SDict begin H.S end
 -2 4017 a -2 4017 a
SDict begin 11.7 H.A end
 -2 4017 a -2
4017 a
SDict begin [/View [/XYZ H.V]/Dest (0:4151) cvn /DEST pdfmark end
 -2 4017 a 396 4097 a Fe(<class)44 b(name)g(=)h("mdp_worker">)576
4194 y(MDP/Worker)576 4291 y(<header>)755 4388 y(<field)f(name)g(=)h
("empty")e(type)h(=)h("string")f(value)g(=)g("")934 4485
y(>Empty)g(frame</field>)755 4582 y(<field)g(name)g(=)h("protocol")e
(type)h(=)h("string")e(value)h(=)h("MDPW01")934 4679
y(>Protocol)f(identifier</field>)755 4777 y(<field)g(name)g(=)h("id")f
(type)g(=)h("octet">Message)d(identifier</field>)576
4874 y(</header>)576 4971 y(<message)h(name)h(=)h("ready")f(id)g(=)h
("1">)755 5068 y(Worker)f(tells)g(broker)g(it)g(is)h(ready)755
5165 y(<field)f(name)g(=)h("service")e(type)h(=)h("string">Service)d
(name</field>)p Black 3759 5569 a Ff(342)p Black eop
end
%%Page: 343 356
TeXDict begin 343 355 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.343) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(</message>)576 170 y(<message)43 b(name)h(=)h
("request")e(id)i(=)f("2">)755 267 y(Client)g(request)f(to)i(broker)755
364 y(<field)f(name)g(=)h("client")e(type)h(=)h("frame">Client)d
(address</field>)755 461 y(<field)i(name)g(=)h("body")e(type)i(=)f
("frame">Request)f(body</field>)576 558 y(</message>)576
655 y(<message)g(name)h(=)h("reply")f(id)g(=)h("3">)755
752 y(Worker)f(returns)f(reply)h(to)h(broker)755 850
y(<field)f(name)g(=)h("client")e(type)h(=)h("frame">Client)d
(address</field>)755 947 y(<field)i(name)g(=)h("body")e(type)i(=)f
("frame">Request)f(body</field>)576 1044 y(</message>)576
1141 y(<message)g(name)h(=)h("hearbeat")e(id)i(=)f("4">)755
1238 y(Either)g(peer)g(tells)g(the)g(other)g(it's)g(still)g(alive)576
1335 y(</message>)576 1432 y(<message)f(name)h(=)h("disconnect")e(id)h
(=)h("5">)755 1530 y(Either)f(peer)g(tells)g(other)g(the)g(party)g(is)h
(over)576 1627 y(</message>)396 1724 y(</class>)-2 1896
y
SDict begin H.S end
 -2 1896 a -2 1896 a
SDict begin 13 H.A end
 -2 1896 a -2 1896 a
SDict begin [/View [/XYZ H.V]/Dest (0:4152) cvn /DEST pdfmark end
 -2 1896 a 396
1998 a Fk(GSL)21 b(uses)g(XML)f(as)h(its)g(modeling)d(language.)h(XML)h
(has)g(a)h(poor)e(reputation,)f(ha)n(ving)h(been)g(dragged)g(through)f
(too)396 2106 y(man)o(y)h(enterprise)g(se)n(wers)i(to)f(smell)h(sweet,)
f(b)n(ut)h(it)g(has)f(some)g(strong)f(positi)n(v)o(es,)h(as)h(long)e
(as)i(you)e(k)o(eep)h(it)h(simple.)396 2214 y(An)o(y)f(w)o(ay)g(to)g
(write)h(a)f(self-describing)e(hierarchy)g(of)i(items)h(and)e(attrib)n
(utes)i(w)o(ould)e(w)o(ork.)-2 2398 y
SDict begin H.S end
 -2 2398 a -2 2398
a
SDict begin 13 H.A end
 -2 2398 a -2 2398 a
SDict begin [/View [/XYZ H.V]/Dest (0:4153) cvn /DEST pdfmark end
 -2 2398 a 396 2488 a Fk(No)n(w)h(here)g(is)h(a)g
(short)f(IDL)g(generator)e(written)i(in)g(GSL)h(that)f(turns)g(our)f
(protocol)g(models)g(into)h(documentation:)-2 2589 y
SDict begin H.S end

-2 2589 a -2 2589 a
SDict begin 11.7 H.A end
 -2 2589 a -2 2589 a
SDict begin [/View [/XYZ H.V]/Dest (0:4154) cvn /DEST pdfmark end
 -2 2589 a 396
2668 a Fe(.#)90 b(Trivial)43 b(IDL)i(generator)e(\(specs.gsl\))396
2765 y(.#)396 2862 y(.output)h("$\(class.name\).md")396
2959 y(##)h(The)f($\(string.trim)f(\(class.?\224\):left\))f(Protocol)
396 3056 y(.for)i(message)396 3153 y(.)135 b(frames)43
b(=)i(count)f(\(class->header.field\))d(+)k(count)f(\(field\))396
3348 y(A)h($\(message.NAME\))d(command)i(consists)f(of)i(a)g
(multi-part)e(message)g(of)i($\(frames\))396 3445 y(frames:)396
3639 y(.)135 b(for)44 b(class->header.field)396 3736
y(.)314 b(if)44 b(name)h(=)f("id")396 3846 y(*)486 3833
y(Frame)g($\(item)g(\(\)\):)g(0x$\(message.id:\04502x\))d(\(1)k(byte,)f
($\(message.NAME\)\))396 3931 y(.)314 b(else)396 4041
y(*)486 4028 y(Frame)44 b($\(item)g(\(\)\):)g("$\(value:\)")f
(\($\(string.length)f(\("$\(value\)"\)\))h(\\)396 4125
y(bytes,)h($\(field.:\)\))396 4222 y(.)314 b(endif)396
4319 y(.)135 b(endfor)396 4416 y(.)g(index)44 b(=)g(count)g
(\(class->header.field\))e(+)i(1)396 4513 y(.)135 b(for)44
b(field)396 4623 y(*)486 4610 y(Frame)g($\(index\):)f($\(field.?\224\))
g(\\)396 4708 y(.)314 b(if)44 b(type)h(=)f("string")396
4805 y(\(printable)f(string\))396 4902 y(.)314 b(elsif)44
b(type)g(=)h("frame")396 4999 y(\(opaque)f(binary\))396
5096 y(.)493 b(index)44 b(+=)h(1)p Black 3759 5569 a
Ff(343)p Black eop end
%%Page: 344 357
TeXDict begin 344 356 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.344) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(.)314 b(else)396 170 y(.)493 b(echo)44
b("E:)h(unknown)e(field)h(type:)g($\(type\)")396 267
y(.)314 b(endif)396 364 y(.)g(index)44 b(+=)g(1)396 461
y(.)135 b(endfor)396 558 y(.endfor)-2 725 y
SDict begin H.S end
 -2 725 a
-2 725 a
SDict begin 13 H.A end
 -2 725 a -2 725 a
SDict begin [/View [/XYZ H.V]/Dest (0:4155) cvn /DEST pdfmark end
 -2 725 a 396 832 a Fk(The)20
b(XML)g(models)g(and)g(this)g(script)h(are)f(in)g(the)g(subdirectory)e
(e)o(xamples/Chapter6.)f(T)-7 b(o)21 b(do)e(the)i(code)e(generation)f
(I)396 940 y(gi)n(v)o(e)i(this)g(command:)-2 1041 y
SDict begin H.S end
 -2
1041 a -2 1041 a
SDict begin 11.7 H.A end
 -2 1041 a -2 1041 a
SDict begin [/View [/XYZ H.V]/Dest (0:4156) cvn /DEST pdfmark end
 -2 1041 a 396 1120
a Fe(gsl)45 b(-script:specs)d(mdp_client.xml)h(mdp_worker.xml)-2
1298 y
SDict begin H.S end
 -2 1298 a -2 1298 a
SDict begin 13 H.A end
 -2 1298 a -2 1298 a
SDict begin [/View [/XYZ H.V]/Dest (0:4157) cvn /DEST pdfmark end
 -2 1298
a 396 1394 a Fk(Here)20 b(is)h(the)g(Markdo)n(wn)d(te)o(xt)i(we)g(get)g
(for)g(the)g(w)o(ork)o(er)f(protocol:)-2 1495 y
SDict begin H.S end
 -2 1495
a -2 1495 a
SDict begin 11.7 H.A end
 -2 1495 a -2 1495 a
SDict begin [/View [/XYZ H.V]/Dest (0:4158) cvn /DEST pdfmark end
 -2 1495 a 396 1574 a
Fe(##)45 b(The)f(MDP/Worker)f(Protocol)396 1769 y(A)i(READY)f(command)g
(consists)f(of)i(a)f(multi-part)f(message)h(of)h(4)396
1866 y(frames:)396 2073 y(*)486 2060 y(Frame)f(1:)g("")h(\(0)f(bytes,)g
(Empty)g(frame\))396 2170 y(*)486 2157 y(Frame)g(2:)g("MDPW01")g(\(6)g
(bytes,)g(Protocol)g(identifier\))396 2267 y(*)486 2254
y(Frame)g(3:)g(0x01)h(\(1)f(byte,)g(READY\))396 2364
y(*)486 2351 y(Frame)g(4:)g(Service)g(name)g(\(printable)f(string\))396
2546 y(A)i(REQUEST)f(command)f(consists)h(of)g(a)h(multi-part)e
(message)h(of)g(5)396 2643 y(frames:)396 2850 y(*)486
2837 y(Frame)g(1:)g("")h(\(0)f(bytes,)g(Empty)g(frame\))396
2947 y(*)486 2934 y(Frame)g(2:)g("MDPW01")g(\(6)g(bytes,)g(Protocol)g
(identifier\))396 3044 y(*)486 3031 y(Frame)g(3:)g(0x02)h(\(1)f(byte,)g
(REQUEST\))396 3142 y(*)486 3129 y(Frame)g(4:)g(Client)g(address)g
(\(opaque)g(binary\))396 3239 y(*)486 3226 y(Frame)g(6:)g(Request)g
(body)g(\(opaque)g(binary\))396 3420 y(A)h(REPLY)f(command)g(consists)f
(of)i(a)f(multi-part)f(message)h(of)h(5)396 3517 y(frames:)396
3724 y(*)486 3711 y(Frame)f(1:)g("")h(\(0)f(bytes,)g(Empty)g(frame\))
396 3821 y(*)486 3808 y(Frame)g(2:)g("MDPW01")g(\(6)g(bytes,)g
(Protocol)g(identifier\))396 3919 y(*)486 3906 y(Frame)g(3:)g(0x03)h
(\(1)f(byte,)g(REPLY\))396 4016 y(*)486 4003 y(Frame)g(4:)g(Client)g
(address)g(\(opaque)g(binary\))396 4113 y(*)486 4100
y(Frame)g(6:)g(Request)g(body)g(\(opaque)g(binary\))396
4294 y(A)h(HEARBEAT)e(command)h(consists)g(of)g(a)h(multi-part)e
(message)h(of)g(3)396 4391 y(frames:)396 4599 y(*)486
4586 y(Frame)g(1:)g("")h(\(0)f(bytes,)g(Empty)g(frame\))396
4696 y(*)486 4683 y(Frame)g(2:)g("MDPW01")g(\(6)g(bytes,)g(Protocol)g
(identifier\))396 4793 y(*)486 4780 y(Frame)g(3:)g(0x04)h(\(1)f(byte,)g
(HEARBEAT\))396 4974 y(A)h(DISCONNECT)e(command)h(consists)f(of)i(a)f
(multi-part)g(message)f(of)i(3)396 5071 y(frames:)p Black
3759 5569 a Ff(344)p Black eop end
%%Page: 345 358
TeXDict begin 345 357 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.345) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 85 a Fe(*)486 72 y(Frame)44 b(1:)g("")h(\(0)f(bytes,)g(Empty)
g(frame\))396 183 y(*)486 170 y(Frame)g(2:)g("MDPW01")g(\(6)g(bytes,)g
(Protocol)g(identifier\))396 280 y(*)486 267 y(Frame)g(3:)g(0x05)h(\(1)
f(byte,)g(DISCONNECT\))-2 444 y
SDict begin H.S end
 -2 444 a -2 444 a
SDict begin 13 H.A end
 -2
444 a -2 444 a
SDict begin [/View [/XYZ H.V]/Dest (0:4159) cvn /DEST pdfmark end
 -2 444 a 396 541 a Fk(Which)20 b(as)h(you)f(can)g(see)g
(is)h(close)g(to)f(what)g(I)h(wrote)e(by)h(hand)f(in)i(the)f(original)f
(spec.)h(No)n(w)-5 b(,)19 b(if)i(you)e(ha)n(v)o(e)h(cloned)f(the)396
649 y(Guide)h(repository)e(and)i(you)f(are)h(looking)f(at)i(the)f(code)
f(in)i(e)o(xamples/Chapter6,)c(you)i(can)h(generate)f(the)h(MDP)396
757 y(client)g(and)g(w)o(ork)o(er)f(codecs.)h(W)-7 b(e)21
b(pass)g(the)f(same)g(tw)o(o)h(models)e(to)i(a)f(dif)n(ferent)f(code)g
(generator:)-2 858 y
SDict begin H.S end
 -2 858 a -2 858 a
SDict begin 11.7 H.A end
 -2 858 a -2 858
a
SDict begin [/View [/XYZ H.V]/Dest (0:4160) cvn /DEST pdfmark end
 -2 858 a 396 937 a Fe(gsl)45 b(-script:codec_c)d(mdp_client.xml)g
(mdp_worker.xml)-2 1114 y
SDict begin H.S end
 -2 1114 a -2 1114 a
SDict begin 13 H.A end
 -2 1114
a -2 1114 a
SDict begin [/View [/XYZ H.V]/Dest (0:4161) cvn /DEST pdfmark end
 -2 1114 a 396 1211 a Fk(Which)20 b(gi)n(v)o(es)g(us)h
(mdp_client)d(and)i(mdp_w)o(ork)o(er)d(classes.)k(Actually)f(MDP)g(is)h
(so)g(simple)f(that)g(it')-5 b(s)22 b(barely)d(w)o(orth)396
1319 y(the)h(ef)n(fort)g(of)f(writing)h(the)g(code)g(generator)-5
b(.)18 b(The)i(pro\002t)g(comes)g(when)f(we)i(w)o(ant)f(to)g(change)f
(the)h(protocol)f(\(which)396 1427 y(we)i(did)f(for)f(the)h(standalone)
f(Majordomo)f(project\).)h(Y)-9 b(ou)19 b(modify)g(the)h(protocol,)e
(run)i(the)g(command,)e(and)i(out)f(pops)396 1534 y(more)h(perfect)f
(code.)-2 1719 y
SDict begin H.S end
 -2 1719 a -2 1719 a
SDict begin 13 H.A end
 -2 1719 a -2 1719
a
SDict begin [/View [/XYZ H.V]/Dest (0:4162) cvn /DEST pdfmark end
 -2 1719 a 396 1808 a Fk(The)546 1808 y
SDict begin H.S end
 546 1808 a 546
1808 a
SDict begin 13 H.A end
 546 1808 a 546 1808 a
SDict begin [/View [/XYZ H.V]/Dest (0:4163) cvn /DEST pdfmark end
 546 1808 a Fe(codec_c.gsl)g
Fk(code)h(generator)e(is)j(not)f(short,)f(b)n(ut)i(the)f(resulting)f
(codecs)h(are)g(much)f(better)h(than)g(the)396 1916 y(hand-written)e
(code)i(I)g(originally)f(put)h(together)e(for)i(Majordomo.)e(F)o(or)h
(instance)h(the)g(hand-written)e(code)i(had)g(no)396
2024 y(error)f(checking,)g(and)g(w)o(ould)h(die)g(if)g(you)g(passed)g
(it)h(bogus)e(messages.)-2 2208 y
SDict begin H.S end
 -2 2208 a -2 2208 a
SDict begin 13 H.A end

-2 2208 a -2 2208 a
SDict begin [/View [/XYZ H.V]/Dest (0:4164) cvn /DEST pdfmark end
 -2 2208 a 396 2298 a Fk(I'm)h(no)n(w)g(going)e(to)j
(e)o(xplain)e(the)h(pros)g(and)f(cons)h(of)g(GSL-po)n(wered)e
(model-oriented)f(code)j(generation.)e(Po)n(wer)396 2406
y(does)i(not)g(come)g(for)f(free)h(and)g(one)f(of)h(the)g(greatest)g
(traps)g(in)h(our)e(b)n(usiness)i(is)g(the)f(ability)g(to)g(in)m(v)o
(ent)f(concepts)g(out)h(of)396 2514 y(thin)g(air)-5 b(.)21
b(GSL)f(mak)o(es)g(this)h(particularly)e(easy)-5 b(,)19
b(so)i(can)f(be)g(a)g(particularly)f(dangerous)f(tool.)-2
2698 y
SDict begin H.S end
 -2 2698 a -2 2698 a
SDict begin 13 H.A end
 -2 2698 a -2 2698 a
SDict begin [/View [/XYZ H.V]/Dest (0:4165) cvn /DEST pdfmark end
 -2 2698
a -2 2698 a
SDict begin H.S end
 -2 2698 a -2 2698 a
SDict begin 13 H.A end
 -2 2698 a -2 2698 a
SDict begin [/View [/XYZ H.V]/Dest (0:4166) cvn /DEST pdfmark end
 -2
2698 a 396 2788 a Ff(Do)i(not)g(in)m(vent)g(concepts)p
Fk(.)f(The)h(job)f(of)h(a)h(designer)e(is)i(to)f(remo)o(v)o(e)f
(problems,)f(not)i(to)g(add)g(features.)-2 2972 y
SDict begin H.S end
 -2
2972 a -2 2972 a
SDict begin 13 H.A end
 -2 2972 a -2 2972 a
SDict begin [/View [/XYZ H.V]/Dest (0:4167) cvn /DEST pdfmark end
 -2 2972 a 396 3062
a Fk(So,)g(\002rst,)h(the)f(adv)n(antages)f(of)h(model-oriented)d(code)
i(generation:)-2 3080 y
SDict begin H.S end
 -2 3080 a -2 3080 a
SDict begin 13 H.A end
 -2 3080 a
-2 3080 a
SDict begin [/View [/XYZ H.V]/Dest (0:4168) cvn /DEST pdfmark end
 -2 3080 a -2 3090 a
SDict begin H.S end
 -2 3090 a -2 3090 a
SDict begin 13 H.A end
 -2
3090 a -2 3090 a
SDict begin [/View [/XYZ H.V]/Dest (0:4169) cvn /DEST pdfmark end
 -2 3090 a Black 396 3232 a Fj(\225)p
Black 479 3232 a
SDict begin H.S end
 479 3232 a 479 3232 a
SDict begin 13 H.A end
 479 3232 a 479
3232 a
SDict begin [/View [/XYZ H.V]/Dest (0:4170) cvn /DEST pdfmark end
 479 3232 a Fk(Y)-9 b(ou)20 b(can)g(create)g('perfect')e
(abstractions)i(that)g(map)g(to)g(your)f(real)h(w)o(orld.)g(So,)g(our)f
(protocol)g(model)g(maps)h(100\045)479 3340 y(to)h(the)f(')l(real)g(w)o
(orld')f(of)h(Majordomo.)d(This)k(w)o(ould)e(be)h(impossible)g(without)
f(the)h(freedom)f(to)h(tune)g(and)g(change)479 3448 y(the)g(model)g(in)
g(an)o(y)g(w)o(ay)-5 b(.)-2 3466 y
SDict begin H.S end
 -2 3466 a -2 3466
a
SDict begin 13 H.A end
 -2 3466 a -2 3466 a
SDict begin [/View [/XYZ H.V]/Dest (0:4171) cvn /DEST pdfmark end
 -2 3466 a Black 396 3598 a Fj(\225)p
Black 479 3598 a
SDict begin H.S end
 479 3598 a 479 3598 a
SDict begin 13 H.A end
 479 3598 a 479
3598 a
SDict begin [/View [/XYZ H.V]/Dest (0:4172) cvn /DEST pdfmark end
 479 3598 a Fk(Y)c(ou)20 b(can)g(de)n(v)o(elop)e(these)j(perfect)
e(models)g(quickly)g(and)h(cheaply)-5 b(.)-2 3616 y
SDict begin H.S end
 -2
3616 a -2 3616 a
SDict begin 13 H.A end
 -2 3616 a -2 3616 a
SDict begin [/View [/XYZ H.V]/Dest (0:4173) cvn /DEST pdfmark end
 -2 3616 a Black
396 3747 a Fj(\225)p Black 479 3747 a
SDict begin H.S end
 479 3747 a 479
3747 a
SDict begin 13 H.A end
 479 3747 a 479 3747 a
SDict begin [/View [/XYZ H.V]/Dest (0:4174) cvn /DEST pdfmark end
 479 3747 a Fk(Y)c(ou)20
b(can)g(generate)1072 3747 y
SDict begin H.S end
 1072 3747 a 1072 3747 a
SDict begin 13 H.A end

1072 3747 a 1072 3747 a
SDict begin [/View [/XYZ H.V]/Dest (0:4175) cvn /DEST pdfmark end
 1072 3747 a Ff(any)f Fk(te)o(xt)h(output.)f
(From)h(a)g(single)h(model)e(you)g(can)h(create)g(documentation,)d
(code)j(in)g(an)o(y)479 3855 y(language,)f(test)i(tools,)f(literally)g
(an)o(y)f(output)g(you)g(can)h(think)g(of.)-2 3873 y
SDict begin H.S end

-2 3873 a -2 3873 a
SDict begin 13 H.A end
 -2 3873 a -2 3873 a
SDict begin [/View [/XYZ H.V]/Dest (0:4176) cvn /DEST pdfmark end
 -2 3873 a Black
396 4004 a Fj(\225)p Black 479 4004 a
SDict begin H.S end
 479 4004 a 479
4004 a
SDict begin 13 H.A end
 479 4004 a 479 4004 a
SDict begin [/View [/XYZ H.V]/Dest (0:4177) cvn /DEST pdfmark end
 479 4004 a Fk(Y)-9 b(ou)20
b(can)g(generate)f(\(and)g(I)h(mean)g(this)h(literally\))1936
4004 y
SDict begin H.S end
 1936 4004 a 1936 4004 a
SDict begin 13 H.A end
 1936 4004 a 1936 4004
a
SDict begin [/View [/XYZ H.V]/Dest (0:4178) cvn /DEST pdfmark end
 1936 4004 a Ff(perfect)h Fk(output)d(since)i(it')-5
b(s)21 b(cheap)e(to)i(impro)o(v)o(e)d(your)g(code)479
4112 y(generators)h(to)h(an)o(y)g(le)n(v)o(el)f(you)h(w)o(ant.)-2
4130 y
SDict begin H.S end
 -2 4130 a -2 4130 a
SDict begin 13 H.A end
 -2 4130 a -2 4130 a
SDict begin [/View [/XYZ H.V]/Dest (0:4179) cvn /DEST pdfmark end
 -2 4130
a Black 396 4262 a Fj(\225)p Black 479 4262 a
SDict begin H.S end
 479 4262
a 479 4262 a
SDict begin 13 H.A end
 479 4262 a 479 4262 a
SDict begin [/View [/XYZ H.V]/Dest (0:4180) cvn /DEST pdfmark end
 479 4262 a Fk(Y)-9
b(ou)20 b(get)g(a)h(single)f(source)f(that)i(combines)d
(speci\002cations)i(and)g(semantics.)-2 4280 y
SDict begin H.S end
 -2 4280
a -2 4280 a
SDict begin 13 H.A end
 -2 4280 a -2 4280 a
SDict begin [/View [/XYZ H.V]/Dest (0:4181) cvn /DEST pdfmark end
 -2 4280 a Black 396 4411
a Fj(\225)p Black 479 4411 a
SDict begin H.S end
 479 4411 a 479 4411 a
SDict begin 13 H.A end
 479
4411 a 479 4411 a
SDict begin [/View [/XYZ H.V]/Dest (0:4182) cvn /DEST pdfmark end
 479 4411 a Fk(Y)-9 b(ou)20 b(can)g(le)n(v)o(erage)e
(a)j(small)g(team)f(to)g(a)h(massi)n(v)o(e)f(size.)g(At)h(iMatix)f(we)h
(produced)d(the)i(million-line)f(OpenAMQ)479 4519 y(messaging)h
(product)e(out)i(of)g(perhaps)f(85K)g(lines)i(of)f(input)f(models,)h
(including)e(the)i(code)g(generation)e(scripts)479 4627
y(themselv)o(es.)-2 4794 y
SDict begin H.S end
 -2 4794 a -2 4794 a
SDict begin 13 H.A end
 -2 4794
a -2 4794 a
SDict begin [/View [/XYZ H.V]/Dest (0:4183) cvn /DEST pdfmark end
 -2 4794 a 396 4901 a Fk(No)n(w)i(the)h(disadv)n(antages:)-2
4919 y
SDict begin H.S end
 -2 4919 a -2 4919 a
SDict begin 13 H.A end
 -2 4919 a -2 4919 a
SDict begin [/View [/XYZ H.V]/Dest (0:4184) cvn /DEST pdfmark end
 -2 4919
a -2 4929 a
SDict begin H.S end
 -2 4929 a -2 4929 a
SDict begin 13 H.A end
 -2 4929 a -2 4929 a
SDict begin [/View [/XYZ H.V]/Dest (0:4185) cvn /DEST pdfmark end
 -2
4929 a Black 396 5071 a Fj(\225)p Black 479 5071 a
SDict begin H.S end
 479
5071 a 479 5071 a
SDict begin 13 H.A end
 479 5071 a 479 5071 a
SDict begin [/View [/XYZ H.V]/Dest (0:4186) cvn /DEST pdfmark end
 479 5071 a Fk(Y)-9
b(ou)20 b(add)g(tool)f(dependencies)f(to)j(your)e(project.)-2
5089 y
SDict begin H.S end
 -2 5089 a -2 5089 a
SDict begin 13 H.A end
 -2 5089 a -2 5089 a
SDict begin [/View [/XYZ H.V]/Dest (0:4187) cvn /DEST pdfmark end
 -2 5089
a Black 3759 5569 a Ff(345)p Black eop end
%%Page: 346 359
TeXDict begin 346 358 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.346) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:4188) cvn /DEST pdfmark end
 479 72 a Fk(Y)-9 b(ou)20
b(may)g(get)g(carried)f(a)o(w)o(ay)h(and)g(create)f(models)h(for)g(the)
g(pure)f(jo)o(y)h(of)g(creating)f(them.)-2 90 y
SDict begin H.S end
 -2 90
a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:4189) cvn /DEST pdfmark end
 -2 90 a Black 396 222 a Fj(\225)p
Black 479 222 a
SDict begin H.S end
 479 222 a 479 222 a
SDict begin 13 H.A end
 479 222 a 479 222
a
SDict begin [/View [/XYZ H.V]/Dest (0:4190) cvn /DEST pdfmark end
 479 222 a Fk(Y)-9 b(ou)20 b(may)g(alienate)g(ne)n(wcomers)e(to)j
(your)e(w)o(ork,)g(who)h(will)h(see)f("strange)g(stuf)n(f".)-2
240 y
SDict begin H.S end
 -2 240 a -2 240 a
SDict begin 13 H.A end
 -2 240 a -2 240 a
SDict begin [/View [/XYZ H.V]/Dest (0:4191) cvn /DEST pdfmark end
 -2 240 a Black
396 371 a Fj(\225)p Black 479 371 a
SDict begin H.S end
 479 371 a 479 371
a
SDict begin 13 H.A end
 479 371 a 479 371 a
SDict begin [/View [/XYZ H.V]/Dest (0:4192) cvn /DEST pdfmark end
 479 371 a Fk(Y)-9 b(ou)20 b(may)g(gi)n(v)o(e)f
(people)g(a)i(strong)e(e)o(xcuse)g(to)i(not)f(in)m(v)o(est)f(in)h(your)
f(project.)-2 555 y
SDict begin H.S end
 -2 555 a -2 555 a
SDict begin 13 H.A end
 -2 555 a -2 555
a
SDict begin [/View [/XYZ H.V]/Dest (0:4193) cvn /DEST pdfmark end
 -2 555 a 396 645 a Fk(Cynically)-5 b(,)19 b(model-oriented)e(ab)n
(use)j(w)o(orks)g(great)g(in)g(en)m(vironments)e(where)h(you)h(w)o(ant)
g(to)g(produce)e(huge)i(amounts)396 753 y(of)g(perfect)f(code)h(that)g
(you)f(can)h(maintain)g(with)g(little)h(ef)n(fort,)e(and)h(which)2582
753 y
SDict begin H.S end
 2582 753 a 2582 753 a
SDict begin 13 H.A end
 2582 753 a 2582 753 a
SDict begin [/View [/XYZ H.V]/Dest (0:4194) cvn /DEST pdfmark end
 2582
753 a Ff(no-one)f(can)g(e)o(ver)i(tak)o(e)f(away)g(fr)l(om)h(you.)396
861 y Fk(Personally)-5 b(,)19 b(I)h(lik)o(e)h(to)f(cross)g(my)g(ri)n(v)
o(ers)g(and)f(mo)o(v)o(e)g(on.)h(But)g(if)h(long-term)d(job)i(security)
g(is)h(your)e(thing,)g(this)i(is)396 969 y(almost)f(perfect.)-2
1153 y
SDict begin H.S end
 -2 1153 a -2 1153 a
SDict begin 13 H.A end
 -2 1153 a -2 1153 a
SDict begin [/View [/XYZ H.V]/Dest (0:4195) cvn /DEST pdfmark end
 -2 1153
a 396 1243 a Fk(So)h(if)f(you)f(do)h(use)h(GSL)f(and)g(w)o(ant)g(to)h
(create)e(open)h(communities)e(around)h(your)g(w)o(ork,)g(here)h(is)h
(my)e(advice:)-2 1261 y
SDict begin H.S end
 -2 1261 a -2 1261 a
SDict begin 13 H.A end
 -2 1261 a
-2 1261 a
SDict begin [/View [/XYZ H.V]/Dest (0:4196) cvn /DEST pdfmark end
 -2 1261 a -2 1271 a
SDict begin H.S end
 -2 1271 a -2 1271 a
SDict begin 13 H.A end
 -2
1271 a -2 1271 a
SDict begin [/View [/XYZ H.V]/Dest (0:4197) cvn /DEST pdfmark end
 -2 1271 a Black 396 1413 a Fj(\225)p
Black 479 1413 a
SDict begin H.S end
 479 1413 a 479 1413 a
SDict begin 13 H.A end
 479 1413 a 479
1413 a
SDict begin [/View [/XYZ H.V]/Dest (0:4198) cvn /DEST pdfmark end
 479 1413 a Fk(Use)i(only)f(where)f(you)g(w)o(ould)h(otherwise)f
(be)i(writing)e(tiresome)h(code)f(by)h(hand.)-2 1431
y
SDict begin H.S end
 -2 1431 a -2 1431 a
SDict begin 13 H.A end
 -2 1431 a -2 1431 a
SDict begin [/View [/XYZ H.V]/Dest (0:4199) cvn /DEST pdfmark end
 -2 1431 a Black
396 1563 a Fj(\225)p Black 479 1563 a
SDict begin H.S end
 479 1563 a 479
1563 a
SDict begin 13 H.A end
 479 1563 a 479 1563 a
SDict begin [/View [/XYZ H.V]/Dest (0:4200) cvn /DEST pdfmark end
 479 1563 a Fk(Design)g(natural)g(models)f
(that)h(are)h(what)f(people)f(w)o(ould)g(e)o(xpect)g(to)i(see.)-2
1581 y
SDict begin H.S end
 -2 1581 a -2 1581 a
SDict begin 13 H.A end
 -2 1581 a -2 1581 a
SDict begin [/View [/XYZ H.V]/Dest (0:4201) cvn /DEST pdfmark end
 -2 1581
a Black 396 1712 a Fj(\225)p Black 479 1712 a
SDict begin H.S end
 479 1712
a 479 1712 a
SDict begin 13 H.A end
 479 1712 a 479 1712 a
SDict begin [/View [/XYZ H.V]/Dest (0:4202) cvn /DEST pdfmark end
 479 1712 a Fk(Write)g(the)f(code)g
(by)g(hand)f(\002rst)i(so)f(you)f(kno)n(w)h(what)g(to)g(generate.)-2
1730 y
SDict begin H.S end
 -2 1730 a -2 1730 a
SDict begin 13 H.A end
 -2 1730 a -2 1730 a
SDict begin [/View [/XYZ H.V]/Dest (0:4203) cvn /DEST pdfmark end
 -2 1730
a Black 396 1862 a Fj(\225)p Black 479 1862 a
SDict begin H.S end
 479 1862
a 479 1862 a
SDict begin 13 H.A end
 479 1862 a 479 1862 a
SDict begin [/View [/XYZ H.V]/Dest (0:4204) cvn /DEST pdfmark end
 479 1862 a Fk(Do)g(not)g(o)o(v)o
(eruse.)f(K)n(eep)g(it)i(simple!)1556 1862 y
SDict begin H.S end
 1556 1862
a 1556 1862 a
SDict begin 13 H.A end
 1556 1862 a 1556 1862 a
SDict begin [/View [/XYZ H.V]/Dest (0:4205) cvn /DEST pdfmark end
 1556 1862 a Ff(Do)f(not)g(g)o(et)
h(too)e(meta!!)-2 1880 y
SDict begin H.S end
 -2 1880 a -2 1880 a
SDict begin 13 H.A end
 -2 1880
a -2 1880 a
SDict begin [/View [/XYZ H.V]/Dest (0:4206) cvn /DEST pdfmark end
 -2 1880 a Black 396 2011 a Fj(\225)p Black
479 2011 a
SDict begin H.S end
 479 2011 a 479 2011 a
SDict begin 13 H.A end
 479 2011 a 479 2011
a
SDict begin [/View [/XYZ H.V]/Dest (0:4207) cvn /DEST pdfmark end
 479 2011 a Fk(Introduce)f(gradually)h(into)g(a)i(project.)-2
2029 y
SDict begin H.S end
 -2 2029 a -2 2029 a
SDict begin 13 H.A end
 -2 2029 a -2 2029 a
SDict begin [/View [/XYZ H.V]/Dest (0:4208) cvn /DEST pdfmark end
 -2 2029
a Black 396 2160 a Fj(\225)p Black 479 2160 a
SDict begin H.S end
 479 2160
a 479 2160 a
SDict begin 13 H.A end
 479 2160 a 479 2160 a
SDict begin [/View [/XYZ H.V]/Dest (0:4209) cvn /DEST pdfmark end
 479 2160 a Fk(Put)g(the)f(generated)
e(code)i(into)g(your)f(repositories.)-2 2344 y
SDict begin H.S end
 -2 2344
a -2 2344 a
SDict begin 13 H.A end
 -2 2344 a -2 2344 a
SDict begin [/View [/XYZ H.V]/Dest (0:4210) cvn /DEST pdfmark end
 -2 2344 a 396 2434 a
Fk(W)-7 b(e')l(re)21 b(already)e(using)g(GSL)i(in)f(some)g(projects)g
(around)e(\330MQ,)i(for)g(e)o(xample)f(the)h(high-le)n(v)o(el)e(C)j
(binding,)d(CZMQ,)396 2542 y(uses)j(GSL)g(to)f(generate)f(the)h(sock)o
(et)g(options)f(class)j(\(zsock)o(opt\).)c(A)i(300-line)f(code)g
(generator)g(turns)g(78)h(lines)h(of)396 2650 y(XML)f(model)g(into)g
(1,500)e(lines)j(of)f(perfect)f(b)n(ut)h(really)g(boring)f(code.)g
(That')-5 b(s)20 b(a)h(good)e(win.)-2 2762 y
SDict begin H.S end
 -2 2762
a -2 2762 a
SDict begin 13 H.A end
 -2 2762 a -2 2762 a
SDict begin [/View [/XYZ H.V]/Dest (0:4211) cvn /DEST pdfmark end
 -2 2762 a 359 x Fn(6.8.)39
b(T)-11 b(ransf)o(erring)36 b(Files)1477 3121 y
SDict begin H.S end
 1477
3121 a 1477 3121 a
SDict begin 22.464 H.A end
 1477 3121 a 1477 3121 a
SDict begin [/View [/XYZ H.V]/Dest (11.82.1) cvn /DEST pdfmark end
 1477 3121
a -2 3319 a
SDict begin H.S end
 -2 3319 a -2 3319 a
SDict begin 13 H.A end
 -2 3319 a -2 3319 a
SDict begin [/View [/XYZ H.V]/Dest (0:4213) cvn /DEST pdfmark end
 -2
3319 a 396 3395 a Fk(Let')-5 b(s)21 b(tak)o(e)f(a)h(break)e(from)g(the)
h(lecturing)f(and)h(get)g(back)g(to)g(our)f(\002rst)i(lo)o(v)o(e)f(and)
f(the)h(reason)g(for)f(doing)g(all)i(of)f(this:)396 3503
y(code.)-2 3670 y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 13 H.A end
 -2 3670 a -2 3670
a
SDict begin [/View [/XYZ H.V]/Dest (0:4214) cvn /DEST pdfmark end
 -2 3670 a 396 3777 a Fk("Ho)n(w)g(do)g(I)g(send)g(a)h(\002le?")g(is)g
(a)f(common)f(question)g(on)g(the)i(\330MQ)f(mailing)g(lists.)h(Not)f
(surprising,)f(because)g(\002le)396 3885 y(transfer)h(is)h(perhaps)e
(the)h(oldest)g(and)g(most)g(ob)o(vious)e(type)i(of)g(messaging.)f
(Sending)g(\002les)i(around)d(netw)o(orks)i(has)396 3993
y(lots)h(of)f(use-cases)g(apart)f(from)g(anno)o(ying)f(the)i(cop)o
(yright)e(cartels.)i(\330MQ)g(is)h(v)o(ery)e(good,)f(out)i(of)g(the)g
(box,)e(at)j(sending)396 4100 y(e)n(v)o(ents)f(and)f(tasks)i(b)n(ut)f
(less)i(good)d(at)h(sending)f(\002les.)-2 4285 y
SDict begin H.S end
 -2 4285
a -2 4285 a
SDict begin 13 H.A end
 -2 4285 a -2 4285 a
SDict begin [/View [/XYZ H.V]/Dest (0:4215) cvn /DEST pdfmark end
 -2 4285 a 396 4374 a
Fk(I')l(v)o(e)g(promised,)g(for)g(a)i(year)f(or)g(tw)o(o,)g(to)g(write)
g(a)h(proper)e(e)o(xplanation.)e(Here')-5 b(s)21 b(a)f(gratuitous)f
(piece)h(of)g(information)396 4482 y(to)h(brighten)d(your)h(morning:)f
(the)i(w)o(ord)g("proper")e(comes)i(from)f(the)h(archaic)g(French)f
("propre")f(which)i(means)396 4590 y("clean".)g(The)g(dark)f(age)h
(English)f(common)g(folk,)g(not)h(being)f(f)o(amiliar)h(with)g(hot)g(w)
o(ater)g(and)g(soap,)g(changed)e(the)396 4698 y(w)o(ord)i(to)g(mean)g
("foreign")e(or)i("upper)n(-class",)f(as)h(in)h("that')-5
b(s)20 b(proper)f(food!")f(b)n(ut)i(later)h(the)f(w)o(ord)f(meant)h
(just)h("real",)396 4806 y(as)g(in)g("that')-5 b(s)20
b(a)h(proper)d(mess)j(you')l(v)o(e)d(gotten)h(us)i(into!")p
Black 3757 5569 a Ff(346)p Black eop end
%%Page: 347 360
TeXDict begin 347 359 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.347) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4216) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(So,)h(\002le)h(transfer)-5 b(.)20 b(There)f(are)h(se)
n(v)o(eral)g(reasons)g(you)f(can')o(t)g(just)i(pick)f(up)f(a)i(random)d
(\002le,)j(blindfold)d(it,)j(and)e(sho)o(v)o(e)g(it)396
180 y(whole)h(into)g(a)g(message.)g(The)g(most)g(ob)o(vious)f(being)g
(that)h(despite)g(decades)g(of)g(determined)e(gro)n(wth)h(in)h(RAM)h
(sizes)396 288 y(\(and)e(who)h(among)f(us)h(old-timers)f(doesn')o(t)f
(fondly)h(remember)f(sa)n(ving)i(up)f(for)h(that)g(1,014-byte)d(memory)
h(e)o(xtension)396 396 y(card?!\),)h(disk)h(sizes)h(obstinately)e
(remain)h(much)f(lar)o(ger)-5 b(.)19 b(Ev)o(en)g(if)h(we)h(could)e
(send)h(a)h(\002le)g(with)f(one)g(instruction)f(\(say)-5
b(,)396 504 y(using)20 b(a)h(system)f(call)h(lik)o(e)f(send\002le\),)f
(we')l(d)h(hit)g(the)h(reality)f(that)g(netw)o(orks)f(are)h(not)g
(in\002nitely)g(f)o(ast,)g(nor)g(perfectly)396 612 y(reliable.)g(After)
g(trying)f(to)h(upload)f(a)h(lar)o(ge)g(\002le)h(se)n(v)o(eral)e(times)
i(on)f(a)g(slo)n(w)h(\003ak)o(y)e(netw)o(ork)g(\(W)m(iFi,)i(an)o
(yone?\),)c(you')o(ll)396 720 y(realize)j(that)h(a)f(proper)f(\002le)h
(transfer)g(protocol)e(needs)i(a)h(w)o(ay)f(to)g(reco)o(v)o(er)e(from)i
(f)o(ailures.)f(That)h(is,)h(a)g(w)o(ay)f(to)g(send)396
828 y(only)g(the)g(part)g(of)g(a)g(\002le)h(that)f(w)o(asn')o(t)g(yet)g
(recei)n(v)o(ed.)-2 1012 y
SDict begin H.S end
 -2 1012 a -2 1012 a
SDict begin 13 H.A end
 -2 1012
a -2 1012 a
SDict begin [/View [/XYZ H.V]/Dest (0:4217) cvn /DEST pdfmark end
 -2 1012 a 396 1102 a Fk(Finally)-5 b(,)20
b(after)g(all)g(this,)h(if)f(you)g(b)n(uild)f(a)i(proper)d(\002le)j
(serv)o(er)m(,)e(you')o(ll)g(notice)h(that)g(simply)g(sending)f(massi)n
(v)o(e)h(amounts)396 1210 y(of)g(data)g(to)h(lots)f(of)g(clients)h
(creates)f(that)g(situation)g(we)h(lik)o(e)f(to)g(call,)h(in)f(the)g
(technical)g(parlance,)e("serv)o(er)i(went)396 1318 y(belly-up)f(due)g
(to)i(all)f(a)n(v)n(ailable)g(heap)g(memory)e(being)h(eaten)h(by)g(a)h
(poorly-designed)16 b(application".)i(A)j(proper)e(\002le)396
1426 y(transfer)h(protocol)e(needs)i(to)g(pay)g(attention)f(to)h
(memory)f(use.)-2 1610 y
SDict begin H.S end
 -2 1610 a -2 1610 a
SDict begin 13 H.A end
 -2 1610
a -2 1610 a
SDict begin [/View [/XYZ H.V]/Dest (0:4218) cvn /DEST pdfmark end
 -2 1610 a 396 1700 a Fk(W)-7 b(e')o(ll)22
b(solv)o(e)d(these)i(problems)d(properly)-5 b(,)18 b(one)i(by)f(one,)h
(which)f(should)h(hopefully)d(get)k(us)f(to)h(a)f(good)f(and)h(proper)e
(\002le)396 1808 y(transfer)i(protocol)e(running)g(o)o(v)o(er)h
(\330MQ.)h(First,)h(let')-5 b(s)21 b(generate)e(a)i(1GB)f(test)h
(\002le)g(with)f(random)f(data)h(\(real)396 1916 y(po)n(wer)n(-of-tw)o
(o-giga-lik)o(e-V)-11 b(on-)o(Neum)o(man)o(-in)o(tend)o(ed,)14
b(not)20 b(the)g(f)o(ak)o(e)g(silicon)g(ones)g(the)h(memory)d(industry)
h(lik)o(es)i(to)396 2023 y(sell\):)-2 2121 y
SDict begin H.S end
 -2 2121
a -2 2121 a
SDict begin 11.7 H.A end
 -2 2121 a -2 2121 a
SDict begin [/View [/XYZ H.V]/Dest (0:4219) cvn /DEST pdfmark end
 -2 2121 a 396 2204 a
Fe(dd)45 b(if=/dev/urandom)d(of=testdata)h(bs=1M)h(count=1024)-2
2376 y
SDict begin H.S end
 -2 2376 a -2 2376 a
SDict begin 13 H.A end
 -2 2376 a -2 2376 a
SDict begin [/View [/XYZ H.V]/Dest (0:4220) cvn /DEST pdfmark end
 -2 2376
a 396 2478 a Fk(This)21 b(is)g(lar)o(ge)e(enough)f(to)i(be)h
(troublesome)d(when)h(we)i(ha)n(v)o(e)f(lots)g(of)g(clients)h(asking)e
(for)h(the)g(same)g(\002le)h(at)g(once,)e(and)396 2586
y(on)h(man)o(y)e(machines,)h(1GB)h(is)h(going)e(to)h(be)f(too)h(lar)o
(ge)f(to)h(allocate)g(in)g(memory)e(an)o(yho)n(w)-5 b(.)17
b(As)k(a)f(base)g(reference,)e(let')-5 b(s)396 2693 y(measure)20
b(ho)n(w)f(long)h(it)h(tak)o(es)f(to)g(cop)o(y)g(this)g(\002le)h(from)e
(disk)i(back)e(to)h(disk.)g(This)h(will)g(tell)g(us)f(ho)n(w)g(much)f
(our)g(\002le)396 2801 y(transfer)h(protocol)e(adds)i(on)g(top)g
(\(including)e('netw)o(ork')g(costs\):)-2 2902 y
SDict begin H.S end
 -2 2902
a -2 2902 a
SDict begin 11.7 H.A end
 -2 2902 a -2 2902 a
SDict begin [/View [/XYZ H.V]/Dest (0:4221) cvn /DEST pdfmark end
 -2 2902 a 396 2982 a
Fe($)45 b(time)f(cp)h(testdata)e(testdata2)396 3176 y(real)179
b(0m7.143s)396 3273 y(user)g(0m0.012s)396 3370 y(sys)224
b(0m1.188s)-2 3548 y
SDict begin H.S end
 -2 3548 a -2 3548 a
SDict begin 13 H.A end
 -2 3548 a -2
3548 a
SDict begin [/View [/XYZ H.V]/Dest (0:4222) cvn /DEST pdfmark end
 -2 3548 a 396 3644 a Fk(The)20 b(4-\002gure)f(precision)g(is)i
(misleading;)e(e)o(xpect)g(v)n(ariations)g(of)h(25\045)g(either)g(w)o
(ay)-5 b(.)20 b(This)g(is)h(just)g(an)f("order)f(of)396
3752 y(magnitude")f(measurement.)-2 3936 y
SDict begin H.S end
 -2 3936 a
-2 3936 a
SDict begin 13 H.A end
 -2 3936 a -2 3936 a
SDict begin [/View [/XYZ H.V]/Dest (0:4223) cvn /DEST pdfmark end
 -2 3936 a 396 4026 a Fk(Here')-5
b(s)21 b(our)e(\002rst)i(cut)f(at)h(the)f(code,)f(where)h(the)g(client)
g(asks)h(for)f(the)g(test)h(data)f(and)g(the)g(serv)o(er)f(just)i
(sends)f(it,)h(without)396 4134 y(stopping)e(for)h(breath,)f(as)h(a)h
(series)g(of)f(messages,)g(where)f(each)h(message)g(holds)g(one)g
('chunk':)-2 4152 y
SDict begin H.S end
 -2 4152 a -2 4152 a
SDict begin 13 H.A end
 -2 4152 a -2
4152 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio1-c) cvn /DEST pdfmark
end
 -2 4152 a 396 4335 a Fg(Example)h(6-1.)e(File)h(transfer)g
(test,)g(model)g(1)h(\(\002leio1.c\))-2 4435 y
SDict begin H.S end
 -2 4435
a -2 4435 a
SDict begin 11.7 H.A end
 -2 4435 a -2 4435 a
SDict begin [/View [/XYZ H.V]/Dest (0:4226) cvn /DEST pdfmark end
 -2 4435 a 396 4515 a
Fe(//)90 b(File)44 b(Transfer)f(model)h(#1)396 4613 y(//)396
4710 y(//)90 b(In)44 b(which)g(the)g(server)g(sends)g(the)h(entire)e
(file)i(to)f(the)g(client)g(in)396 4807 y(//)90 b(large)44
b(chunks)f(with)i(no)f(attempt)g(at)g(flow)g(control.)396
5001 y(#include)g(<czmq.h>)396 5098 y(#define)g(CHUNK_SIZE)88
b(250000)p Black 3756 5569 a Ff(347)p Black eop end
%%Page: 348 361
TeXDict begin 348 360 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.348) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 170 a Fe(static)44 b(void)396 267 y(client_thread)f(\(void)
1293 280 y(*)1338 267 y(args,)h(zctx_t)1921 280 y(*)1966
267 y(ctx,)g(void)2414 280 y(*)2459 267 y(pipe\))396
364 y({)576 461 y(void)800 474 y(*)845 461 y(dealer)f(=)i(zsocket_new)e
(\(ctx,)h(ZMQ_DEALER\);)576 558 y(zsocket_connect)e(\(dealer,)h
("tcp://127.0.0.1:6000"\);)576 752 y(zstr_send)g(\(dealer,)g
("fetch"\);)576 850 y(size_t)g(total)h(=)h(0;)314 b(//)89
b(Total)44 b(bytes)g(received)576 947 y(size_t)f(chunks)h(=)h(0;)269
b(//)89 b(Total)44 b(chunks)g(received)576 1141 y(while)g(\(true\))f({)
755 1238 y(zframe_t)1158 1251 y(*)1203 1238 y(frame)h(=)h(zframe_recv)e
(\(dealer\);)755 1335 y(if)h(\(!frame\))934 1432 y(break;)627
b(//)89 b(Shutting)44 b(down,)g(quit)755 1530 y(chunks++;)755
1627 y(size_t)g(size)g(=)h(zframe_size)e(\(frame\);)755
1724 y(zframe_destroy)f(\(&frame\);)755 1821 y(total)i(+=)g(size;)755
1918 y(if)g(\(size)g(==)h(0\))934 2015 y(break;)627 b(//)89
b(Whole)44 b(file)g(received)576 2112 y(})576 2209 y(printf)f
(\("\045zd)h(chunks)g(received,)g(\045zd)g(bytes\\n",)f(chunks,)h
(total\);)576 2307 y(zstr_send)f(\(pipe,)h("OK"\);)396
2404 y(})396 2598 y(static)g(void)396 2695 y(free_chunk)f(\(void)1158
2708 y(*)1203 2695 y(data,)h(void)1696 2708 y(*)1741
2695 y(arg\))396 2792 y({)576 2889 y(free)g(\(data\);)396
2987 y(})-2 3161 y
SDict begin H.S end
 -2 3161 a -2 3161 a
SDict begin 13 H.A end
 -2 3161 a -2 3161
a
SDict begin [/View [/XYZ H.V]/Dest (0:4227) cvn /DEST pdfmark end
 -2 3161 a 396 3261 a Fk(The)20 b(serv)o(er)f(thread)h(reads)g(the)g
(\002le)h(from)e(disk)h(in)g(chunks,)f(and)h(sends)g(each)g(chunk)e(to)
j(the)f(client)g(as)h(a)g(separate)396 3368 y(message.)f(W)-7
b(e)21 b(only)f(ha)n(v)o(e)f(one)h(test)h(\002le,)g(so)f(open)f(that)i
(once)e(and)h(then)g(serv)o(e)f(it)i(out)f(as)h(needed:)-2
3386 y
SDict begin H.S end
 -2 3386 a -2 3386 a
SDict begin 13 H.A end
 -2 3386 a -2 3386 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio1-c-1) cvn /DEST pdfmark
end
 -2 3386
a 396 3570 a Fg(Example)g(6-2.)e(File)h(transfer)g(test,)g(model)g(1)h
(\(\002leio1.c\))e(-)h(File)g(ser)o(v)o(er)h(thr)o(ead)-2
3670 y
SDict begin H.S end
 -2 3670 a -2 3670 a
SDict begin 11.7 H.A end
 -2 3670 a -2 3670 a
SDict begin [/View [/XYZ H.V]/Dest (0:4230) cvn /DEST pdfmark end
 -2 3670
a 396 3847 a Fe(static)44 b(void)396 3944 y(server_thread)f(\(void)1293
3957 y(*)1338 3944 y(args,)h(zctx_t)1921 3957 y(*)1966
3944 y(ctx,)g(void)2414 3957 y(*)2459 3944 y(pipe\))396
4041 y({)576 4138 y(FILE)800 4151 y(*)845 4138 y(file)g(=)g(fopen)g
(\("testdata",)f("r"\);)576 4236 y(assert)g(\(file\);)576
4430 y(void)800 4443 y(*)845 4430 y(router)g(=)i(zsocket_new)e(\(ctx,)h
(ZMQ_ROUTER\);)576 4527 y(//)89 b(Default)44 b(HWM)g(is)g(1000,)g
(which)g(will)h(drop)f(messages)f(here)576 4624 y(//)89
b(since)44 b(we)g(send)h(more)f(than)g(1,000)g(chunks)g(of)g(test)g
(data,)576 4721 y(//)89 b(so)44 b(set)h(an)f(infinite)g(HWM)g(as)h(a)f
(simple,)g(stupid)g(solution:)576 4818 y(zsocket_set_hwm)e(\(router,)h
(0\);)576 4916 y(zsocket_bind)f(\(router,)i("tcp://)1877
4929 y(*)1922 4916 y(:6000"\);)576 5013 y(while)g(\(true\))f({)755
5110 y(//)89 b(First)44 b(frame)g(in)h(each)f(message)g(is)g(the)g
(sender)g(identity)p Black 3759 5569 a Ff(348)p Black
eop end
%%Page: 349 362
TeXDict begin 349 361 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.349) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 755 72 a Fe(zframe_t)1158 85 y(*)1203 72 y(identity)44
b(=)g(zframe_recv)f(\(router\);)755 170 y(if)h(\(!identity\))934
267 y(break;)627 b(//)89 b(Shutting)44 b(down,)g(quit)755
461 y(//)89 b(Second)44 b(frame)g(is)h("fetch")e(command)755
558 y(char)979 571 y(*)1024 558 y(command)h(=)g(zstr_recv)g
(\(router\);)755 655 y(assert)g(\(streq)g(\(command,)f("fetch"\)\);)755
752 y(free)h(\(command\);)755 947 y(while)g(\(true\))g({)934
1044 y(byte)1158 1057 y(*)1203 1044 y(data)g(=)h(malloc)f
(\(CHUNK_SIZE\);)934 1141 y(assert)g(\(data\);)934 1238
y(size_t)g(size)g(=)h(fread)f(\(data,)g(1,)g(CHUNK_SIZE,)f(file\);)934
1335 y(zframe_t)1338 1348 y(*)1383 1335 y(chunk)h(=)g
(zframe_new_zero_copy)e(\(data,)i(size,)g(free_chunk,)e(NULL\);)934
1432 y(zframe_send)h(\(&identity,)g(router,)h(ZFRAME_REUSE)f(+)h
(ZFRAME_MORE\);)934 1530 y(zframe_send)f(\(&chunk,)h(router,)f(0\);)934
1627 y(if)i(\(size)f(==)g(0\))1114 1724 y(break;)447
b(//)89 b(Always)44 b(end)g(with)h(a)f(zero-size)g(frame)755
1821 y(})755 1918 y(zframe_destroy)e(\(&identity\);)576
2015 y(})576 2112 y(fclose)h(\(file\);)396 2209 y(})-2
2384 y
SDict begin H.S end
 -2 2384 a -2 2384 a
SDict begin 13 H.A end
 -2 2384 a -2 2384 a
SDict begin [/View [/XYZ H.V]/Dest (0:4231) cvn /DEST pdfmark end
 -2 2384
a 396 2483 a Fk(The)20 b(main)g(task)g(starts)h(the)g(client)f(and)g
(serv)o(er)f(threads;)g(it')-5 b(s)22 b(easier)e(to)g(test)h(this)g(as)
g(a)g(single)f(process)g(with)g(threads,)396 2591 y(than)g(as)h
(multiple)e(processes:)-2 2609 y
SDict begin H.S end
 -2 2609 a -2 2609 a
SDict begin 13 H.A end

-2 2609 a -2 2609 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio1-c-2) cvn /DEST pdfmark
end
 -2 2609 a 396 2793 a Fg(Example)i(6-3.)e(File)h
(transfer)g(test,)g(model)g(1)h(\(\002leio1.c\))e(-)h(File)g(main)h
(thr)o(ead)-2 2893 y
SDict begin H.S end
 -2 2893 a -2 2893 a
SDict begin 11.7 H.A end
 -2 2893 a -2
2893 a
SDict begin [/View [/XYZ H.V]/Dest (0:4234) cvn /DEST pdfmark end
 -2 2893 a 396 3070 a Fe(int)45 b(main)f(\(void\))396
3167 y({)576 3264 y(//)89 b(Start)44 b(child)g(threads)576
3361 y(zctx_t)889 3374 y(*)934 3361 y(ctx)h(=)f(zctx_new)g(\(\);)576
3459 y(zthread_fork)e(\(ctx,)i(server_thread,)f(NULL\);)576
3556 y(void)800 3569 y(*)845 3556 y(client)g(=)576 3653
y(zthread_fork)f(\(ctx,)i(client_thread,)f(NULL\);)576
3750 y(//)89 b(Loop)44 b(until)g(client)g(tells)g(us)g(it's)h(done)576
3847 y(char)800 3860 y(*)845 3847 y(string)e(=)i(zstr_recv)e
(\(client\);)576 3944 y(free)h(\(string\);)576 4041 y(//)89
b(Kill)44 b(server)g(thread)576 4138 y(zctx_destroy)e(\(&ctx\);)576
4236 y(return)h(0;)396 4333 y(})-2 4507 y
SDict begin H.S end
 -2 4507 a -2
4507 a
SDict begin 13 H.A end
 -2 4507 a -2 4507 a
SDict begin [/View [/XYZ H.V]/Dest (0:4235) cvn /DEST pdfmark end
 -2 4507 a 396 4607 a Fk(It')-5
b(s)21 b(pretty)f(simple)g(b)n(ut)g(we)g(already)g(run)f(into)h(a)h
(problem:)d(if)j(we)f(send)g(too)g(much)f(data)h(to)h(the)f(R)m(OUTER)g
(sock)o(et,)396 4715 y(we)h(can)f(easily)g(o)o(v)o(er\003o)n(w)f(it.)h
(The)g(simple)g(b)n(ut)g(stupid)g(solution)g(is)h(to)f(put)g(an)g
(in\002nite)g(high-w)o(ater)f(mark)g(on)h(the)396 4823
y(sock)o(et.)g(It')-5 b(s)21 b(stupid)f(because)f(we)i(no)n(w)e(ha)n(v)
o(e)h(no)g(protection)e(against)i(e)o(xhausting)e(the)i(serv)o(er')-5
b(s)20 b(memory)-5 b(.)18 b(Y)-8 b(et)396 4931 y(without)20
b(an)g(in\002nite)g(HWM)h(we)f(risk)h(losing)e(chunks)g(of)h(lar)o(ge)f
(\002les.)p Black 3759 5569 a Ff(349)p Black eop end
%%Page: 350 363
TeXDict begin 350 362 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.350) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4236) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(T)m(ry)h(this:)h(set)g(the)f(HWM)h(to)f(1,000)f(\(in)
h(\330MQ/3.x)f(this)i(is)g(the)f(def)o(ault\))f(and)h(then)g(reduce)f
(the)h(chunk)e(size)j(to)g(100K)396 180 y(so)g(we)f(send)g(10K)g
(chunks)f(in)h(one)g(go.)g(Run)g(the)g(test,)h(and)e(you')o(ll)h(see)g
(it)h(ne)n(v)o(er)e(\002nishes.)h(As)h(the)g(zmq_sock)o(et[3])396
288 y(man)f(page)f(says)i(with)g(cheerful)d(brutality)-5
b(,)19 b(for)g(the)i(R)m(OUTER)f(sock)o(et:)g("ZMQ_HWM)g(option)f
(action:)h(Drop".)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a
-2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:4237) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(W)-7 b(e)22 b(ha)n(v)o(e)d(to)i(control)
e(the)h(amount)f(of)g(data)i(the)f(serv)o(er)f(sends)h(up-front.)e
(There')-5 b(s)20 b(no)f(point)h(in)g(it)h(sending)e(more)g(than)396
670 y(the)h(netw)o(ork)f(can)h(handle.)f(Let')-5 b(s)21
b(try)f(sending)f(one)h(chunk)e(at)j(a)g(time.)f(In)g(this)g(v)o
(ersion)f(of)h(the)h(protocol,)d(the)i(client)396 778
y(will)h(e)o(xplicitly)e(say)-5 b(,"gi)n(v)o(e)19 b(me)h(chunk)f(N",)h
(and)f(the)i(serv)o(er)e(will)i(fetch)f(that)g(speci\002c)g(chunk)f
(from)g(disk)h(and)g(send)g(it.)-2 962 y
SDict begin H.S end
 -2 962 a -2
962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:4238) cvn /DEST pdfmark end
 -2 962 a 396 1052 a Fk(Here')-5
b(s)21 b(the)f(impro)o(v)o(ed)d(second)j(model,)f(where)g(the)i(client)
f(asks)g(for)g(one)g(chunk)e(at)j(a)g(time,)f(and)f(the)i(serv)o(er)e
(only)396 1160 y(sends)h(one)g(chunk)f(for)g(each)h(request)g(it)h
(gets)f(from)f(the)h(client:)-2 1178 y
SDict begin H.S end
 -2 1178 a -2 1178
a
SDict begin 13 H.A end
 -2 1178 a -2 1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio2-c) cvn /DEST pdfmark
end
 -2 1178 a 396 1361 a Fg(Example)h(6-4.)e(File)h
(transfer)g(test,)g(model)g(2)h(\(\002leio2.c\))-2 1461
y
SDict begin H.S end
 -2 1461 a -2 1461 a
SDict begin 11.7 H.A end
 -2 1461 a -2 1461 a
SDict begin [/View [/XYZ H.V]/Dest (0:4241) cvn /DEST pdfmark end
 -2 1461 a 396
1542 a Fe(//)90 b(File)44 b(Transfer)f(model)h(#2)396
1639 y(//)396 1736 y(//)90 b(In)44 b(which)g(the)g(client)g(requests)g
(each)g(chunk)g(individually,)f(thus)396 1833 y(//)90
b(eliminating)43 b(server)g(queue)h(overflows,)g(but)g(at)g(a)h(cost)f
(in)h(speed.)396 2027 y(#include)f(<czmq.h>)396 2124
y(#define)g(CHUNK_SIZE)88 b(250000)396 2319 y(static)44
b(void)396 2416 y(client_thread)f(\(void)1293 2429 y(*)1338
2416 y(args,)h(zctx_t)1921 2429 y(*)1966 2416 y(ctx,)g(void)2414
2429 y(*)2459 2416 y(pipe\))396 2513 y({)576 2610 y(void)800
2623 y(*)845 2610 y(dealer)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)
576 2707 y(zsocket_set_hwm)e(\(dealer,)h(1\);)576 2804
y(zsocket_connect)f(\(dealer,)h("tcp://127.0.0.1:6000"\);)576
2999 y(size_t)g(total)h(=)h(0;)314 b(//)89 b(Total)44
b(bytes)g(received)576 3096 y(size_t)f(chunks)h(=)h(0;)269
b(//)89 b(Total)44 b(chunks)g(received)576 3290 y(while)g(\(true\))f({)
755 3387 y(//)89 b(Ask)45 b(for)f(next)g(chunk)755 3484
y(zstr_sendfm)f(\(dealer,)g("fetch"\);)755 3581 y(zstr_sendfm)g
(\(dealer,)g("\045ld",)h(total\);)755 3679 y(zstr_sendf)88
b(\(dealer,)43 b("\045ld",)h(CHUNK_SIZE\);)755 3873 y(zframe_t)1158
3886 y(*)1203 3873 y(chunk)g(=)h(zframe_recv)e(\(dealer\);)755
3970 y(if)h(\(!chunk\))934 4067 y(break;)627 b(//)89
b(Shutting)44 b(down,)g(quit)755 4164 y(chunks++;)755
4261 y(size_t)g(size)g(=)h(zframe_size)e(\(chunk\);)755
4358 y(zframe_destroy)f(\(&chunk\);)755 4456 y(total)i(+=)g(size;)755
4553 y(if)g(\(size)g(<)h(CHUNK_SIZE\))934 4650 y(break;)627
b(//)89 b(Last)44 b(chunk)g(received;)g(exit)576 4747
y(})576 4844 y(printf)f(\("\045zd)h(chunks)g(received,)g(\045zd)g
(bytes\\n",)f(chunks,)h(total\);)576 4941 y(zstr_send)f(\(pipe,)h
("OK"\);)396 5038 y(})p Black 3759 5569 a Ff(350)p Black
eop end
%%Page: 351 364
TeXDict begin 351 363 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.351) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(static)44 b(void)396 170 y(free_chunk)f(\(void)1158
183 y(*)1203 170 y(data,)h(void)1696 183 y(*)1741 170
y(arg\))396 267 y({)576 364 y(free)g(\(data\);)396 461
y(})-2 635 y
SDict begin H.S end
 -2 635 a -2 635 a
SDict begin 13 H.A end
 -2 635 a -2 635 a
SDict begin [/View [/XYZ H.V]/Dest (0:4242) cvn /DEST pdfmark end
 -2 635
a 396 735 a Fk(The)20 b(serv)o(er)f(thread)g(w)o(aits)i(for)e(a)i
(chunk)d(request)i(from)f(a)h(client,)g(reads)f(that)i(chunk)d(and)h
(sends)h(it)h(back)e(to)i(the)f(client:)-2 753 y
SDict begin H.S end
 -2 753
a -2 753 a
SDict begin 13 H.A end
 -2 753 a -2 753 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio2-c-1) cvn /DEST pdfmark
end
 -2 753 a 396 936 a Fg(Example)h(6-5.)e
(File)h(transfer)g(test,)g(model)g(2)h(\(\002leio2.c\))e(-)h(File)g
(ser)o(v)o(er)h(thr)o(ead)-2 1036 y
SDict begin H.S end
 -2 1036 a -2 1036
a
SDict begin 11.7 H.A end
 -2 1036 a -2 1036 a
SDict begin [/View [/XYZ H.V]/Dest (0:4245) cvn /DEST pdfmark end
 -2 1036 a 396 1214 a Fe(static)44
b(void)396 1311 y(server_thread)f(\(void)1293 1324 y(*)1338
1311 y(args,)h(zctx_t)1921 1324 y(*)1966 1311 y(ctx,)g(void)2414
1324 y(*)2459 1311 y(pipe\))396 1408 y({)576 1505 y(FILE)800
1518 y(*)845 1505 y(file)g(=)g(fopen)g(\("testdata",)f("r"\);)576
1602 y(assert)g(\(file\);)576 1796 y(void)800 1809 y(*)845
1796 y(router)g(=)i(zsocket_new)e(\(ctx,)h(ZMQ_ROUTER\);)576
1894 y(zsocket_set_hwm)e(\(router,)h(1\);)576 1991 y(zsocket_bind)f
(\(router,)i("tcp://)1877 2004 y(*)1922 1991 y(:6000"\);)576
2088 y(while)g(\(true\))f({)755 2185 y(//)89 b(First)44
b(frame)g(in)h(each)f(message)g(is)g(the)g(sender)g(identity)755
2282 y(zframe_t)1158 2295 y(*)1203 2282 y(identity)g(=)g(zframe_recv)f
(\(router\);)755 2379 y(if)h(\(!identity\))934 2476 y(break;)627
b(//)89 b(Shutting)44 b(down,)g(quit)755 2671 y(//)89
b(Second)44 b(frame)g(is)h("fetch")e(command)755 2768
y(char)979 2781 y(*)1024 2768 y(command)h(=)g(zstr_recv)g(\(router\);)
755 2865 y(assert)g(\(streq)g(\(command,)f("fetch"\)\);)755
2962 y(free)h(\(command\);)755 3156 y(//)89 b(Third)44
b(frame)g(is)h(chunk)f(offset)g(in)g(file)755 3253 y(char)979
3266 y(*)1024 3253 y(offset_str)f(=)i(zstr_recv)e(\(router\);)755
3351 y(size_t)h(offset)g(=)g(atoi)g(\(offset_str\);)755
3448 y(free)g(\(offset_str\);)755 3642 y(//)89 b(Fourth)44
b(frame)g(is)h(maximum)e(chunk)h(size)755 3739 y(char)979
3752 y(*)1024 3739 y(chunksz_str)f(=)i(zstr_recv)e(\(router\);)755
3836 y(size_t)h(chunksz)f(=)i(atoi)f(\(chunksz_str\);)755
3933 y(free)g(\(chunksz_str\);)755 4128 y(//)89 b(Read)44
b(chunk)g(of)h(data)f(from)g(file)755 4225 y(fseek)g(\(file,)g(offset,)
f(SEEK_SET\);)755 4322 y(byte)979 4335 y(*)1024 4322
y(data)h(=)h(malloc)f(\(chunksz\);)755 4419 y(assert)g(\(data\);)755
4613 y(//)89 b(Send)44 b(resulting)g(chunk)g(to)g(client)755
4711 y(size_t)g(size)g(=)h(fread)f(\(data,)f(1,)i(chunksz,)e(file\);)
755 4808 y(zframe_t)1158 4821 y(*)1203 4808 y(chunk)h(=)h
(zframe_new_zero_copy)c(\(data,)j(size,)g(free_chunk,)f(NULL\);)755
4905 y(zframe_send)g(\(&identity,)g(router,)h(ZFRAME_MORE\);)755
5002 y(zframe_send)f(\(&chunk,)g(router,)h(0\);)576 5099
y(})p Black 3759 5569 a Ff(351)p Black eop end
%%Page: 352 365
TeXDict begin 352 364 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.352) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(fclose)43 b(\(file\);)396 170 y(})396
364 y(//)90 b(The)44 b(main)g(task)g(is)h(just)f(the)g(same)g(as)h(in)f
(the)h(first)f(model.)396 461 y(...)-2 628 y
SDict begin H.S end
 -2 628 a
-2 628 a
SDict begin 13 H.A end
 -2 628 a -2 628 a
SDict begin [/View [/XYZ H.V]/Dest (0:4246) cvn /DEST pdfmark end
 -2 628 a 396 735 a Fk(It)21
b(is)g(much)e(slo)n(wer)h(no)n(w)-5 b(,)19 b(because)h(of)g(the)g
(to-and-fro)d(chatting)i(between)h(client)g(and)g(serv)o(er)-5
b(.)19 b(W)-7 b(e)21 b(pay)f(about)f(300)396 843 y(microseconds)g(for)g
(each)h(request-reply)e(round-trips,)f(on)j(a)h(local)f(loop)f
(connection)f(\(client)i(and)g(serv)o(er)f(on)h(the)396
951 y(same)h(box\).)d(It)j(doesn')o(t)d(sound)i(lik)o(e)g(much)f(b)n
(ut)h(it)h(adds)f(up)g(quickly:)-2 1052 y
SDict begin H.S end
 -2 1052 a -2
1052 a
SDict begin 11.7 H.A end
 -2 1052 a -2 1052 a
SDict begin [/View [/XYZ H.V]/Dest (0:4247) cvn /DEST pdfmark end
 -2 1052 a 396 1131 a Fe($)45
b(time)f(./fileio1)396 1228 y(4296)g(chunks)g(received,)g(1073741824)f
(bytes)396 1422 y(real)179 b(0m0.669s)396 1520 y(user)g(0m0.056s)396
1617 y(sys)224 b(0m1.048s)396 1811 y($)45 b(time)f(./fileio2)396
1908 y(4295)g(chunks)g(received,)g(1073741824)f(bytes)396
2102 y(real)179 b(0m2.389s)396 2200 y(user)g(0m0.312s)396
2297 y(sys)224 b(0m2.136s)-2 2474 y
SDict begin H.S end
 -2 2474 a -2 2474
a
SDict begin 13 H.A end
 -2 2474 a -2 2474 a
SDict begin [/View [/XYZ H.V]/Dest (0:4248) cvn /DEST pdfmark end
 -2 2474 a 396 2571 a Fk(There)20
b(are)g(tw)o(o)g(v)n(aluable)f(lessons)i(here.)e(First,)i(while)f
(request-reply)e(is)j(easy)-5 b(,)20 b(it')-5 b(s)21
b(also)f(too)g(slo)n(w)h(for)e(high-v)n(olume)396 2679
y(data)h(\003o)n(ws.)h(P)o(aying)e(that)h(300)f(microseconds)g(once)g
(w)o(ould)h(be)g(\002ne.)g(P)o(aying)f(it)i(for)e(e)n(v)o(ery)g(single)
h(chunk)f(isn')o(t)396 2786 y(acceptable,)g(particularly)g(on)g(real)i
(netw)o(orks)e(with)h(latencies)g(of)g(perhaps)f(1,000)g(times)i
(higher)-5 b(.)-2 2970 y
SDict begin H.S end
 -2 2970 a -2 2970 a
SDict begin 13 H.A end
 -2 2970
a -2 2970 a
SDict begin [/View [/XYZ H.V]/Dest (0:4249) cvn /DEST pdfmark end
 -2 2970 a 396 3060 a Fk(The)20 b(second)f(point)h(is)h
(something)e(I')l(v)o(e)g(said)h(before)f(b)n(ut)h(will)h(repeat:)f
(it')-5 b(s)21 b(incredibly)e(easy)h(to)g(e)o(xperiment,)396
3168 y(measure,)f(and)h(impro)o(v)o(e)e(our)h(protocols)g(o)o(v)o(er)g
(\330MQ.)h(And)g(when)f(the)i(cost)f(of)g(something)f(comes)h(w)o(ay)g
(do)n(wn,)f(you)396 3276 y(can)h(af)n(ford)f(a)h(lot)h(more)e(of)h(it.)
h(Do)f(learn)g(to)g(de)n(v)o(elop)e(and)i(pro)o(v)o(e)e(your)h
(protocols)g(in)h(isolation:)g(I')l(v)o(e)f(seen)h(teams)396
3384 y(w)o(aste)h(time)g(trying)e(to)h(impro)o(v)o(e)e(poorly-designed)
e(protocols)j(that)h(are)g(too)g(deeply)f(embedded)f(in)j(applications)
e(to)396 3492 y(be)h(easily)h(testable)f(or)g(\002xable.)-2
3676 y
SDict begin H.S end
 -2 3676 a -2 3676 a
SDict begin 13 H.A end
 -2 3676 a -2 3676 a
SDict begin [/View [/XYZ H.V]/Dest (0:4250) cvn /DEST pdfmark end
 -2 3676
a 396 3766 a Fk(Our)g(model)f(2)i(\002le)g(transfer)e(protocol)f(isn')o
(t)i(so)h(bad,)e(apart)h(from)f(performance:)-2 3784
y
SDict begin H.S end
 -2 3784 a -2 3784 a
SDict begin 13 H.A end
 -2 3784 a -2 3784 a
SDict begin [/View [/XYZ H.V]/Dest (0:4251) cvn /DEST pdfmark end
 -2 3784 a -2
3794 a
SDict begin H.S end
 -2 3794 a -2 3794 a
SDict begin 13 H.A end
 -2 3794 a -2 3794 a
SDict begin [/View [/XYZ H.V]/Dest (0:4252) cvn /DEST pdfmark end
 -2 3794
a Black 396 3936 a Fj(\225)p Black 479 3936 a
SDict begin H.S end
 479 3936
a 479 3936 a
SDict begin 13 H.A end
 479 3936 a 479 3936 a
SDict begin [/View [/XYZ H.V]/Dest (0:4253) cvn /DEST pdfmark end
 479 3936 a Fk(It)i(completely)d
(eliminates)i(an)o(y)g(risk)g(of)g(memory)e(e)o(xhaustion.)g(T)-7
b(o)20 b(pro)o(v)o(e)f(that)h(we)g(set)h(the)g(high-w)o(ater)d(mark)h
(to)i(1)479 4044 y(in)g(both)e(sender)g(and)h(recei)n(v)o(er)-5
b(.)-2 4045 y
SDict begin H.S end
 -2 4045 a -2 4045 a
SDict begin 13 H.A end
 -2 4045 a -2 4045 a
SDict begin [/View [/XYZ H.V]/Dest (0:4254) cvn /DEST pdfmark end

-2 4045 a Black 396 4194 a Fj(\225)p Black 479 4194 a
SDict begin H.S end

479 4194 a 479 4194 a
SDict begin 13 H.A end
 479 4194 a 479 4194 a
SDict begin [/View [/XYZ H.V]/Dest (0:4255) cvn /DEST pdfmark end
 479 4194
a Fk(It)21 b(lets)g(the)f(client)g(choose)g(the)g(chunk)e(size,)j
(which)f(is)h(useful)e(because)h(if)g(there')-5 b(s)21
b(an)o(y)e(tuning)g(of)h(the)g(chunk)f(size)479 4302
y(to)i(be)f(done,)f(for)g(netw)o(ork)g(conditions,)g(for)g(\002le)i
(types,)f(or)g(to)g(reduce)f(memory)g(consumption)e(further)m(,)h(it')
-5 b(s)22 b(the)479 4410 y(client)f(that)f(should)f(be)h(doing)f(this.)
-2 4428 y
SDict begin H.S end
 -2 4428 a -2 4428 a
SDict begin 13 H.A end
 -2 4428 a -2 4428 a
SDict begin [/View [/XYZ H.V]/Dest (0:4256) cvn /DEST pdfmark end
 -2
4428 a Black 396 4559 a Fj(\225)p Black 479 4559 a
SDict begin H.S end
 479
4559 a 479 4559 a
SDict begin 13 H.A end
 479 4559 a 479 4559 a
SDict begin [/View [/XYZ H.V]/Dest (0:4257) cvn /DEST pdfmark end
 479 4559 a Fk(It)i(gi)n(v)o(es)
e(us)i(fully)f(restartable)f(\002le)i(transfers.)-2 4577
y
SDict begin H.S end
 -2 4577 a -2 4577 a
SDict begin 13 H.A end
 -2 4577 a -2 4577 a
SDict begin [/View [/XYZ H.V]/Dest (0:4258) cvn /DEST pdfmark end
 -2 4577 a Black
396 4708 a Fj(\225)p Black 479 4708 a
SDict begin H.S end
 479 4708 a 479
4708 a
SDict begin 13 H.A end
 479 4708 a 479 4708 a
SDict begin [/View [/XYZ H.V]/Dest (0:4259) cvn /DEST pdfmark end
 479 4708 a Fk(It)g(allo)n(ws)f(the)g
(client)h(to)f(cancel)g(the)g(\002le)h(transfer)e(at)i(an)o(y)e(point)h
(in)g(time.)p Black 3759 5569 a Ff(352)p Black eop end
%%Page: 353 366
TeXDict begin 353 365 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.353) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4260) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(If)h(we)g(just)h(didn')o(t)d(ha)n(v)o(e)i(to)g(do)f
(a)h(request)g(for)f(each)h(chunk,)e(it')l(d)h(be)h(a)h(usable)e
(protocol.)f(What)j(we)f(need)f(is)i(a)f(w)o(ay)g(for)396
180 y(the)g(serv)o(er)g(to)g(send)g(multiple)g(chunks,)e(without)i(w)o
(aiting)g(for)f(the)i(client)f(to)g(request)g(or)g(ackno)n(wledge)d
(each)j(one.)396 288 y(What)h(are)f(the)g(options?)-2
306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:4261) cvn /DEST pdfmark end
 -2 306 a -2
316 a
SDict begin H.S end
 -2 316 a -2 316 a
SDict begin 13 H.A end
 -2 316 a -2 316 a
SDict begin [/View [/XYZ H.V]/Dest (0:4262) cvn /DEST pdfmark end
 -2 316 a Black
396 459 a Fj(\225)p Black 479 459 a
SDict begin H.S end
 479 459 a 479 459
a
SDict begin 13 H.A end
 479 459 a 479 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:4263) cvn /DEST pdfmark end
 479 459 a Fk(The)g(serv)o(er)f(could)h(send)g(10)
f(chunks)g(at)i(once,)e(then)h(w)o(ait)h(for)e(a)i(single)f(ackno)n
(wledgment.)d(That')-5 b(s)20 b(e)o(xactly)f(lik)o(e)479
566 y(multiplying)g(the)h(chunk)e(size)j(by)f(10,)g(so)g(pointless.)g
(And)g(yes,)g(it')-5 b(s)21 b(just)g(as)g(pointless)f(for)f(all)i(v)n
(alues)f(of)g(10.)-2 584 y
SDict begin H.S end
 -2 584 a -2 584 a
SDict begin 13 H.A end
 -2 584 a
-2 584 a
SDict begin [/View [/XYZ H.V]/Dest (0:4264) cvn /DEST pdfmark end
 -2 584 a Black 396 716 a Fj(\225)p Black 479
716 a
SDict begin H.S end
 479 716 a 479 716 a
SDict begin 13 H.A end
 479 716 a 479 716 a
SDict begin [/View [/XYZ H.V]/Dest (0:4265) cvn /DEST pdfmark end
 479 716
a Fk(The)g(serv)o(er)f(could)h(send)g(chunks)f(without)g(an)o(y)g
(chatter)h(from)f(the)h(client)h(b)n(ut)f(with)g(a)h(slight)f(delay)g
(between)f(each)479 824 y(send,)h(so)h(that)f(it)h(w)o(ould)e(send)h
(chunks)f(only)g(as)i(f)o(ast)g(as)g(the)f(netw)o(ork)f(could)h(handle)
f(them.)g(This)i(w)o(ould)e(require)479 932 y(the)h(serv)o(er)g(to)g
(kno)n(w)f(what')-5 b(s)21 b(happening)c(at)k(the)f(netw)o(ork)f(layer)
m(,)h(which)f(sounds)h(lik)o(e)g(hard)f(w)o(ork.)h(It)g(also)h(breaks)
479 1040 y(layering)d(horribly)-5 b(.)17 b(And)i(what)g(happens)g(if)g
(the)h(netw)o(ork)e(is)i(really)f(f)o(ast)h(b)n(ut)g(the)f(client)h
(itself)g(is)g(slo)n(w?)g(Where)f(are)479 1148 y(chunks)g(queued)g
(then?)-2 1166 y
SDict begin H.S end
 -2 1166 a -2 1166 a
SDict begin 13 H.A end
 -2 1166 a -2 1166
a
SDict begin [/View [/XYZ H.V]/Dest (0:4266) cvn /DEST pdfmark end
 -2 1166 a Black 396 1297 a Fj(\225)p Black 479 1297
a
SDict begin H.S end
 479 1297 a 479 1297 a
SDict begin 13 H.A end
 479 1297 a 479 1297 a
SDict begin [/View [/XYZ H.V]/Dest (0:4267) cvn /DEST pdfmark end
 479 1297
a Fk(The)h(serv)o(er)f(could)h(try)g(to)g(sp)o(y)g(on)g(the)g(sending)f
(queue,)g(i.e.)h(see)h(ho)n(w)f(full)g(it)h(is,)g(and)e(send)h(only)f
(when)h(the)g(queue)479 1405 y(isn')o(t)g(full.)g(W)-7
b(ell,)21 b(\330MQ)g(doesn')o(t)d(allo)n(w)j(that)f(because)f(it)i
(doesn')o(t)e(w)o(ork,)g(for)h(the)g(same)g(reason)g(as)h(throttling)
479 1513 y(doesn')o(t)e(w)o(ork.)g(The)h(serv)o(er)f(and)h(netw)o(ork)f
(may)h(be)g(more)f(than)h(f)o(ast)h(enough,)d(b)n(ut)i(the)g(client)g
(may)g(be)g(a)h(slo)n(w)479 1621 y(little)g(de)n(vice.)-2
1622 y
SDict begin H.S end
 -2 1622 a -2 1622 a
SDict begin 13 H.A end
 -2 1622 a -2 1622 a
SDict begin [/View [/XYZ H.V]/Dest (0:4268) cvn /DEST pdfmark end
 -2 1622
a Black 396 1770 a Fj(\225)p Black 479 1770 a
SDict begin H.S end
 479 1770
a 479 1770 a
SDict begin 13 H.A end
 479 1770 a 479 1770 a
SDict begin [/View [/XYZ H.V]/Dest (0:4269) cvn /DEST pdfmark end
 479 1770 a Fk(W)-7
b(e)22 b(could)d(modify)f(libzmq)i(to)g(tak)o(e)g(some)g(other)g
(action)f(on)h(reaching)f(HWM.)h(Perhaps)g(it)h(could)e(block?)g(That)
479 1878 y(w)o(ould)h(mean)f(that)i(a)f(single)g(slo)n(w)h(client)f(w)o
(ould)g(block)f(the)h(whole)g(serv)o(er)m(,)e(so)j(no)f(thank)f(you.)g
(Maybe)g(it)i(could)479 1986 y(return)e(an)h(error)f(to)i(the)f
(caller?)g(Then)f(the)i(serv)o(er)e(could)g(do)h(something)f(smart)h
(lik)o(e...)g(well,)g(there)g(isn')o(t)g(really)479 2094
y(an)o(ything)e(it)j(could)f(do)f(that')-5 b(s)21 b(an)o(y)e(better)h
(than)g(dropping)d(the)k(message.)-2 2278 y
SDict begin H.S end
 -2 2278 a
-2 2278 a
SDict begin 13 H.A end
 -2 2278 a -2 2278 a
SDict begin [/View [/XYZ H.V]/Dest (0:4270) cvn /DEST pdfmark end
 -2 2278 a 396 2368 a Fk(Apart)f(from)f
(being)g(comple)o(x)g(and)h(v)n(ariously)e(unpleasant,)h(none)g(of)h
(these)g(options)f(w)o(ould)h(e)n(v)o(en)f(w)o(ork.)g(What)i(we)396
2476 y(need)f(is)h(a)g(w)o(ay)f(for)f(the)i(client)f(to)g(tell)h(the)f
(serv)o(er)m(,)f(asynchronously)e(and)i(in)i(the)f(background,)c(that)
21 b(it')-5 b(s)21 b(ready)e(for)396 2584 y(more.)g(Some)h(kind)g(of)g
(asynchronous)d(\003o)n(w)j(control.)f(If)h(we)g(do)g(this)h(right,)e
(data)h(should)g(\003o)n(w)g(without)f(interruption)396
2692 y(from)g(the)i(serv)o(er)e(to)h(the)h(client,)e(b)n(ut)i(only)e
(as)i(long)e(as)i(the)f(client)h(is)g(reading)e(it.)h(Let')-5
b(s)21 b(re)n(vie)n(w)f(our)f(three)h(protocols.)396
2800 y(This)h(w)o(as)g(the)f(\002rst)h(one:)-2 2884 y
SDict begin H.S end

-2 2884 a -2 2884 a
SDict begin 11.7 H.A end
 -2 2884 a -2 2884 a
SDict begin [/View [/XYZ H.V]/Dest (0:4271) cvn /DEST pdfmark end
 -2 2884 a 396
2980 a Fe(C:)45 b(fetch)396 3077 y(S:)g(chunk)f(1)396
3174 y(S:)h(chunk)f(2)396 3271 y(S:)h(chunk)f(3)396 3368
y(....)-2 3536 y
SDict begin H.S end
 -2 3536 a -2 3536 a
SDict begin 13 H.A end
 -2 3536 a -2 3536
a
SDict begin [/View [/XYZ H.V]/Dest (0:4272) cvn /DEST pdfmark end
 -2 3536 a 396 3642 a Fk(And)20 b(the)g(second)f(introduced)f(a)j
(request)e(for)h(each)g(chunk:)-2 3743 y
SDict begin H.S end
 -2 3743 a -2
3743 a
SDict begin 11.7 H.A end
 -2 3743 a -2 3743 a
SDict begin [/View [/XYZ H.V]/Dest (0:4273) cvn /DEST pdfmark end
 -2 3743 a 396 3823 a Fe(C:)45
b(fetch)f(chunk)g(1)396 3920 y(S:)h(send)f(chunk)g(1)396
4017 y(C:)h(fetch)f(chunk)g(2)396 4114 y(S:)h(send)f(chunk)g(2)396
4211 y(C:)h(fetch)f(chunk)g(3)396 4308 y(S:)h(send)f(chunk)g(3)396
4405 y(C:)h(fetch)f(chunk)g(4)396 4503 y(....)-2 4670
y
SDict begin H.S end
 -2 4670 a -2 4670 a
SDict begin 13 H.A end
 -2 4670 a -2 4670 a
SDict begin [/View [/XYZ H.V]/Dest (0:4274) cvn /DEST pdfmark end
 -2 4670 a 396
4777 a Fk(No)n(w)20 b(-)h(w)o(a)n(v)o(es)f(hands)g(mysteriously)e(-)j
(here')-5 b(s)20 b(a)g(changed)f(protocol)f(that)j(\002x)o(es)f(the)g
(performance)d(problem:)-2 4878 y
SDict begin H.S end
 -2 4878 a -2 4878 a
SDict begin 11.7 H.A end

-2 4878 a -2 4878 a
SDict begin [/View [/XYZ H.V]/Dest (0:4275) cvn /DEST pdfmark end
 -2 4878 a 396 4957 a Fe(C:)45 b(fetch)f(chunk)g(1)
396 5054 y(C:)h(fetch)f(chunk)g(2)396 5151 y(C:)h(fetch)f(chunk)g(3)p
Black 3759 5569 a Ff(353)p Black eop end
%%Page: 354 367
TeXDict begin 354 366 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.354) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(S:)45 b(send)f(chunk)g(1)396 170 y(C:)h(fetch)f
(chunk)g(4)396 267 y(S:)h(send)f(chunk)g(2)396 364 y(S:)h(send)f(chunk)
g(3)396 461 y(....)-2 628 y
SDict begin H.S end
 -2 628 a -2 628 a
SDict begin 13 H.A end
 -2 628
a -2 628 a
SDict begin [/View [/XYZ H.V]/Dest (0:4276) cvn /DEST pdfmark end
 -2 628 a 396 735 a Fk(It)21 b(looks)e(suspiciously)h
(similar)-5 b(.)20 b(In)g(f)o(act)h(it')-5 b(s)21 b(identical)f(e)o
(xcept)f(that)h(we)h(send)f(multiple)f(requests)h(without)f(w)o(aiting)
396 843 y(for)h(a)g(reply)g(for)f(each)h(one.)g(This)g(is)h(a)g
(technique)d(called)i("pipelining")f(and)g(it)i(w)o(orks)f(because)f
(our)h(DEALER)g(and)396 951 y(R)m(OUTER)h(sock)o(ets)f(are)g(fully)g
(asynchronous.)-2 1135 y
SDict begin H.S end
 -2 1135 a -2 1135 a
SDict begin 13 H.A end
 -2 1135
a -2 1135 a
SDict begin [/View [/XYZ H.V]/Dest (0:4277) cvn /DEST pdfmark end
 -2 1135 a 396 1225 a Fk(Here')-5 b(s)21 b(the)f(third)f
(model)h(of)g(our)f(\002le)i(transfer)e(test-bench,)g(with)h
(pipelining.)f(The)g(client)i(sends)f(a)h(number)d(of)396
1333 y(requests)i(ahead)f(\(the)h("credit"\))f(and)h(then)g(each)g
(time)g(it)h(processes)f(an)g(incoming)e(chunk,)h(it)i(sends)f(one)g
(more)396 1441 y(credit.)g(The)g(serv)o(er)f(will)i(ne)n(v)o(er)e(send)
h(more)f(chunks)g(than)h(the)g(client)g(has)h(ask)o(ed)f(for:)-2
1442 y
SDict begin H.S end
 -2 1442 a -2 1442 a
SDict begin 13 H.A end
 -2 1442 a -2 1442 a
SDict begin [/View [/XYZ H.V]/Dest (0:fileio3-c) cvn /DEST pdfmark
end
 -2 1442
a 396 1642 a Fg(Example)h(6-6.)e(File)h(transfer)g(test,)g(model)g(3)h
(\(\002leio3.c\))-2 1742 y
SDict begin H.S end
 -2 1742 a -2 1742 a
SDict begin 11.7 H.A end
 -2 1742
a -2 1742 a
SDict begin [/View [/XYZ H.V]/Dest (0:4280) cvn /DEST pdfmark end
 -2 1742 a 396 1822 a Fe(//)90 b(File)44 b(Transfer)f(model)
h(#3)396 1919 y(//)396 2016 y(//)90 b(In)44 b(which)g(the)g(client)g
(requests)g(each)g(chunk)g(individually,)f(using)396
2114 y(//)90 b(command)43 b(pipelining)g(to)i(give)f(us)h(a)f
(credit-based)f(flow)h(control.)396 2308 y(#include)g(<czmq.h>)396
2405 y(#define)g(CHUNK_SIZE)88 b(250000)396 2502 y(#define)44
b(PIPELINE)178 b(10)396 2696 y(static)44 b(void)396 2794
y(client_thread)f(\(void)1293 2807 y(*)1338 2794 y(args,)h(zctx_t)1921
2807 y(*)1966 2794 y(ctx,)g(void)2414 2807 y(*)2459 2794
y(pipe\))396 2891 y({)576 2988 y(void)800 3001 y(*)845
2988 y(dealer)f(=)i(zsocket_new)e(\(ctx,)h(ZMQ_DEALER\);)576
3085 y(zsocket_set_hwm)e(\(dealer,)h(PIPELINE\);)576
3182 y(zsocket_connect)f(\(dealer,)h("tcp://127.0.0.1:6000"\);)576
3376 y(//)89 b(We'll)44 b(allow)g(up)g(to)h(five)f(chunks)g(in)g
(transit)g(at)h(once)576 3473 y(size_t)e(credit)h(=)h(PIPELINE;)576
3668 y(size_t)e(total)h(=)h(0;)314 b(//)89 b(Total)44
b(bytes)g(received)576 3765 y(size_t)f(chunks)h(=)h(0;)269
b(//)89 b(Total)44 b(chunks)g(received)576 3862 y(size_t)f(offset)h(=)h
(0;)269 b(//)89 b(Offset)44 b(of)g(next)g(chunk)g(request)576
4056 y(while)g(\(true\))f({)755 4153 y(while)h(\(credit\))f({)934
4251 y(//)90 b(Ask)44 b(for)g(next)g(chunk)934 4348 y(zstr_sendfm)f
(\(dealer,)h("fetch"\);)934 4445 y(zstr_sendfm)f(\(dealer,)h("\045ld",)
g(offset\);)934 4542 y(zstr_sendf)88 b(\(dealer,)44 b("\045ld",)g
(CHUNK_SIZE\);)934 4639 y(offset)g(+=)h(CHUNK_SIZE;)934
4736 y(credit--;)755 4833 y(})755 4931 y(zframe_t)1158
4944 y(*)1203 4931 y(chunk)f(=)h(zframe_recv)e(\(dealer\);)755
5028 y(if)h(\(!chunk\))934 5125 y(break;)627 b(//)89
b(Shutting)44 b(down,)g(quit)p Black 3759 5569 a Ff(354)p
Black eop end
%%Page: 355 368
TeXDict begin 355 367 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.355) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 755 72 a Fe(chunks++;)755 170 y(credit++;)755 267
y(size_t)44 b(size)g(=)h(zframe_size)e(\(chunk\);)755
364 y(zframe_destroy)f(\(&chunk\);)755 461 y(total)i(+=)g(size;)755
558 y(if)g(\(size)g(<)h(CHUNK_SIZE\))934 655 y(break;)627
b(//)89 b(Last)44 b(chunk)g(received;)g(exit)576 752
y(})576 850 y(printf)f(\("\045zd)h(chunks)g(received,)g(\045zd)g
(bytes\\n",)f(chunks,)h(total\);)576 947 y(zstr_send)f(\(pipe,)h
("OK"\);)396 1044 y(})396 1238 y(//)90 b(The)44 b(rest)g(of)h(the)f
(code)g(is)h(exactly)e(the)i(same)f(as)g(in)h(model)f(2,)g(except)396
1335 y(//)90 b(that)44 b(we)g(set)h(the)f(HWM)g(on)h(the)f(server's)g
(ROUTER)f(socket)h(to)h(PIPELINE)396 1432 y(//)90 b(to)44
b(act)g(as)h(a)g(sanity)e(check.)396 1530 y(...)-2 1697
y
SDict begin H.S end
 -2 1697 a -2 1697 a
SDict begin 13 H.A end
 -2 1697 a -2 1697 a
SDict begin [/View [/XYZ H.V]/Dest (0:4281) cvn /DEST pdfmark end
 -2 1697 a 396
1803 a Fk(What)21 b(we')l(v)o(e)e(achie)n(v)o(ed)g(here,)g(with)h(a)h
(little)g(magic,)e(is)i(to)g(tak)o(e)f(control)f(of)h(the)g(end-to-end)
e(pipeline)h(including)f(all)396 1911 y(netw)o(ork)h(b)n(uf)n(fers)g
(and)h(\330MQ)g(queues)g(at)g(sender)g(and)g(recei)n(v)o(er)m(,)e(and)h
(then)h(ensure)g(that)g(pipeline)f(is)i(al)o(w)o(ays)g(\002lled)396
2019 y(with)g(data)f(while)g(ne)n(v)o(er)f(gro)n(wing)f(be)o(yond)g(a)i
(prede\002ned)f(limit.)h(More)f(than)h(that,)g(the)g(client)g(decides)g
(e)o(xactly)f(when)396 2127 y(to)i(send)f("credit")f(to)h(the)h(sender)
-5 b(.)19 b(It)i(could)e(be)h(when)g(it)h(recei)n(v)o(es)e(a)i(chunk,)d
(or)i(when)g(it)g(has)h(fully)e(processed)h(a)396 2235
y(chunk.)f(And)g(this)i(happens)e(asynchronously)-5 b(,)16
b(with)21 b(no)e(signi\002cant)h(performance)d(cost.)-2
2419 y
SDict begin H.S end
 -2 2419 a -2 2419 a
SDict begin 13 H.A end
 -2 2419 a -2 2419 a
SDict begin [/View [/XYZ H.V]/Dest (0:4282) cvn /DEST pdfmark end
 -2 2419
a 396 2509 a Fk(In)j(the)g(third)g(model)f(I)i(chose)e(a)i(pipeline)e
(size)i(of)f(10)g(messages)g(\(each)g(message)g(is)h(a)f(chunk\).)f
(This)h(will)h(cost)f(a)396 2617 y(maximum)f(of)h(2.5MB)f(memory)g(per)
h(client.)g(So)g(with)g(1GB)h(of)f(memory)e(we)j(can)f(handle)f(at)i
(least)g(400)e(clients.)h(W)-7 b(e)396 2725 y(can)20
b(try)g(to)h(calculate)e(the)i(ideal)f(pipeline)f(size.)i(It)f(tak)o
(es)h(about)e(0.7)g(seconds)h(to)g(send)g(the)g(1GB)h(\002le,)g(which)e
(is)i(about)396 2833 y(160)f(microseconds)e(for)h(a)i(chunk.)d(A)j
(round)e(trip)h(is)h(300)e(microseconds,)f(so)j(the)f(pipeline)f(needs)
h(to)g(be)g(at)h(least)g(3-5)396 2941 y(to)g(k)o(eep)e(the)h(serv)o(er)
g(b)n(usy)-5 b(.)19 b(In)h(practice,)f(I)i(still)g(got)f(performance)d
(spik)o(es)k(with)f(a)h(pipeline)e(of)h(5,)g(probably)e(because)396
3049 y(the)i(credit)g(messages)h(sometimes)f(get)g(delayed)f(by)g
(outgoing)f(data.)i(So)h(at)f(10,)g(it)h(w)o(orks)f(consistently)-5
b(.)-2 3150 y
SDict begin H.S end
 -2 3150 a -2 3150 a
SDict begin 11.7 H.A end
 -2 3150 a -2 3150 a
SDict begin [/View [/XYZ H.V]/Dest (0:4283) cvn /DEST pdfmark end

-2 3150 a 396 3229 a Fe($)45 b(time)f(./fileio3)396 3326
y(4291)g(chunks)g(received,)g(1072741824)f(bytes)396
3520 y(real)179 b(0m0.777s)396 3618 y(user)g(0m0.096s)396
3715 y(sys)224 b(0m1.120s)-2 3892 y
SDict begin H.S end
 -2 3892 a -2 3892
a
SDict begin 13 H.A end
 -2 3892 a -2 3892 a
SDict begin [/View [/XYZ H.V]/Dest (0:4284) cvn /DEST pdfmark end
 -2 3892 a 396 3989 a Fk(Do)20 b(measure)g
(rigorously)-5 b(.)17 b(Y)-9 b(our)20 b(calculations)f(may)h(be)g(good)
e(b)n(ut)j(the)f(real)g(w)o(orld)g(tends)g(to)g(ha)n(v)o(e)g(its)h(o)n
(wn)f(opinions.)-2 4173 y
SDict begin H.S end
 -2 4173 a -2 4173 a
SDict begin 13 H.A end
 -2 4173
a -2 4173 a
SDict begin [/View [/XYZ H.V]/Dest (0:4285) cvn /DEST pdfmark end
 -2 4173 a 396 4263 a Fk(What)h(we')l(v)o(e)e(made)h(is)h
(clearly)e(not)h(yet)g(a)h(real)f(\002le)h(transfer)e(protocol,)g(b)n
(ut)h(it)h(pro)o(v)o(es)d(the)j(pattern)e(and)h(I)g(think)f(it)i(is)396
4371 y(the)f(simplest)h(plausible)f(design.)f(F)o(or)h(a)g(real)g(w)o
(orking)f(protocol)g(we')l(d)g(w)o(ant)h(to)h(add)e(some)h(or)g(all)h
(of:)-2 4389 y
SDict begin H.S end
 -2 4389 a -2 4389 a
SDict begin 13 H.A end
 -2 4389 a -2 4389
a
SDict begin [/View [/XYZ H.V]/Dest (0:4286) cvn /DEST pdfmark end
 -2 4389 a -2 4399 a
SDict begin H.S end
 -2 4399 a -2 4399 a
SDict begin 13 H.A end
 -2 4399 a -2
4399 a
SDict begin [/View [/XYZ H.V]/Dest (0:4287) cvn /DEST pdfmark end
 -2 4399 a Black 396 4541 a Fj(\225)p Black 479
4541 a
SDict begin H.S end
 479 4541 a 479 4541 a
SDict begin 13 H.A end
 479 4541 a 479 4541 a
SDict begin [/View [/XYZ H.V]/Dest (0:4288) cvn /DEST pdfmark end
 479
4541 a Fk(Authentication)e(and)g(access)i(controls,)e(e)n(v)o(en)g
(without)h(encryption:)e(the)i(point)f(isn')o(t)h(to)g(protect)g
(sensiti)n(v)o(e)g(data)479 4649 y(b)n(ut)g(to)h(catch)f(errors)f(lik)o
(e)i(sending)e(test)i(data)f(to)g(production)e(serv)o(ers.)-2
4667 y
SDict begin H.S end
 -2 4667 a -2 4667 a
SDict begin 13 H.A end
 -2 4667 a -2 4667 a
SDict begin [/View [/XYZ H.V]/Dest (0:4289) cvn /DEST pdfmark end
 -2 4667
a Black 396 4798 a Fj(\225)p Black 479 4798 a
SDict begin H.S end
 479 4798
a 479 4798 a
SDict begin 13 H.A end
 479 4798 a 479 4798 a
SDict begin [/View [/XYZ H.V]/Dest (0:4290) cvn /DEST pdfmark end
 479 4798 a Fk(A)j(Cheap-style)e
(request)h(including)e(\002le)j(path,)f(optional)e(compression,)h(and)g
(other)h(stuf)n(f)g(we')l(v)o(e)f(learned)g(is)479 4906
y(useful)h(from)f(HTTP)h(\(such)g(as)h(If-Modi\002ed-Since\).)-2
4921 y
SDict begin H.S end
 -2 4921 a -2 4921 a
SDict begin 13 H.A end
 -2 4921 a -2 4921 a
SDict begin [/View [/XYZ H.V]/Dest (0:4291) cvn /DEST pdfmark end
 -2 4921
a Black 396 5055 a Fj(\225)p Black 479 5055 a
SDict begin H.S end
 479 5055
a 479 5055 a
SDict begin 13 H.A end
 479 5055 a 479 5055 a
SDict begin [/View [/XYZ H.V]/Dest (0:4292) cvn /DEST pdfmark end
 479 5055 a Fk(A)g(Cheap-style)e
(response,)g(at)i(least)g(for)f(the)g(\002rst)h(chunk,)d(that)i(pro)o
(vides)f(meta)h(data)g(such)g(as)h(\002le)g(size)g(\(so)f(the)479
5163 y(client)h(can)f(pre-allocate)e(and)i(a)n(v)n(oid)g(unpleasant)e
(disk-full)i(situations\).)-2 5181 y
SDict begin H.S end
 -2 5181 a -2 5181
a
SDict begin 13 H.A end
 -2 5181 a -2 5181 a
SDict begin [/View [/XYZ H.V]/Dest (0:4293) cvn /DEST pdfmark end
 -2 5181 a Black 3759 5569 a Ff(355)p
Black eop end
%%Page: 356 369
TeXDict begin 356 368 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.356) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:4294) cvn /DEST pdfmark end
 479 72 a Fk(The)h(ability)g(to)g(fetch)g
(a)h(set)g(of)f(\002les)h(in)f(one)g(go,)f(otherwise)h(the)g(protocol)f
(becomes)g(inef)n(\002cient)g(for)h(lar)o(ge)f(sets)i(of)479
180 y(small)g(\002les.)-2 181 y
SDict begin H.S end
 -2 181 a -2 181 a
SDict begin 13 H.A end
 -2
181 a -2 181 a
SDict begin [/View [/XYZ H.V]/Dest (0:4295) cvn /DEST pdfmark end
 -2 181 a Black 396 330 a Fj(\225)p Black
479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330 a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:4296) cvn /DEST pdfmark end
 479
330 a Fk(Con\002rmation)e(from)g(the)h(client)g(when)g(it')-5
b(s)21 b(fully)f(recei)n(v)o(ed)f(a)h(\002le,)h(to)f(reco)o(v)o(er)e
(from)h(chunks)g(that)i(might)e(be)h(lost)479 438 y(of)g(the)g(client)h
(disconnects)e(une)o(xpectedly)-5 b(.)-2 622 y
SDict begin H.S end
 -2 622
a -2 622 a
SDict begin 13 H.A end
 -2 622 a -2 622 a
SDict begin [/View [/XYZ H.V]/Dest (0:4297) cvn /DEST pdfmark end
 -2 622 a 396 712 a Fk(So)21
b(f)o(ar)m(,)e(our)h(semantic)g(has)g(been)f("fetch";)h(that)g(is,)h
(the)f(recipient)g(kno)n(ws)f(\(someho)n(w\),)f(that)i(the)o(y)g(need)f
(a)i(speci\002c)396 820 y(\002le,)g(so)f(the)o(y)g(ask)g(for)g(it.)h
(The)e(kno)n(wledge)f(of)i(which)g(\002les)h(e)o(xist,)f(and)g(where)f
(the)o(y)h(are)g(is)h(then)f(passed)g(out-of-band)396
928 y(\(e.g.)g(in)g(HTTP)-9 b(,)20 b(by)g(links)g(in)g(the)g(HTML)g
(page\).)-2 1112 y
SDict begin H.S end
 -2 1112 a -2 1112 a
SDict begin 13 H.A end
 -2 1112 a -2 1112
a
SDict begin [/View [/XYZ H.V]/Dest (0:4298) cvn /DEST pdfmark end
 -2 1112 a 396 1202 a Fk(Ho)n(w)g(about)g(a)g("push")g(semantic?)f
(There)h(are)g(tw)o(o)g(plausible)g(use-cases)g(for)g(this.)g(First,)h
(if)f(we)h(adopt)e(a)i(centralized)396 1310 y(architecture)e(with)h
(\002les)h(on)f(a)h(main)f("serv)o(er")f(\(not)g(something)g(I'm)h(adv)
n(ocating,)e(b)n(ut)i(people)f(do)h(sometimes)g(lik)o(e)396
1417 y(this\),)g(then)g(it')-5 b(s)21 b(v)o(ery)e(useful)h(to)g(allo)n
(w)h(clients)f(to)g(upload)f(\002les)i(to)g(the)f(serv)o(er)-5
b(.)19 b(Second,)g(it)i(lets)g(do)f(a)h(kind)e(of)396
1525 y(pub-sub)g(for)g(\002les,)i(where)f(the)g(client)g(asks)h(for)e
(all)i(ne)n(w)f(\002les)h(of)f(some)g(type;)g(as)h(the)f(serv)o(er)f
(gets)i(these,)f(it)h(forw)o(ards)396 1633 y(them)f(to)g(the)h(client.)
-2 1800 y
SDict begin H.S end
 -2 1800 a -2 1800 a
SDict begin 13 H.A end
 -2 1800 a -2 1800 a
SDict begin [/View [/XYZ H.V]/Dest (0:4299) cvn /DEST pdfmark end
 -2
1800 a 396 1907 a Fk(A)g(fetch)f(semantic)g(is)h(synchronous,)c(while)j
(a)h(push)e(semantic)h(is)h(asynchronous.)c(Asynchronous)h(is)j(less)g
(chatty)-5 b(,)19 b(so)396 2015 y(f)o(aster)-5 b(.)21
b(Also,)f(you)f(can)h(do)g(cute)g(things)g(lik)o(e)g("subscribe)g(to)g
(this)h(path")e(so)i(creating)e(a)i(publish-subscribe)c(\002le)396
2123 y(transfer)j(architecture.)e(That)i(is)h(so)g(ob)o(viously)d(a)o
(wesome)h(that)h(I)h(shouldn')o(t)d(need)h(to)h(e)o(xplain)f(what)i
(problem)d(it)396 2231 y(solv)o(es.)-2 2398 y
SDict begin H.S end
 -2 2398
a -2 2398 a
SDict begin 13 H.A end
 -2 2398 a -2 2398 a
SDict begin [/View [/XYZ H.V]/Dest (0:4300) cvn /DEST pdfmark end
 -2 2398 a 396 2505 a
Fk(Still,)j(here)e(is)i(the)f(problem)e(with)h(the)h(fetch)g(semantic:)
f(that)h(out-of-band)c(route)j(to)h(tell)h(clients)f(what)f(\002les)i
(e)o(xist.)f(No)396 2613 y(matter)g(ho)n(w)g(you)f(do)h(this,)g(it)h
(ends)f(up)g(comple)o(x.)e(Either)i(clients)g(ha)n(v)o(e)g(to)g(poll,)g
(or)g(you)f(need)h(a)g(separate)g(pub-sub)396 2721 y(channel)f(to)i(k)o
(eep)e(clients)i(up)f(to)g(date,)g(or)g(you)f(need)g(user)h
(interaction.)-2 2905 y
SDict begin H.S end
 -2 2905 a -2 2905 a
SDict begin 13 H.A end
 -2 2905 a
-2 2905 a
SDict begin [/View [/XYZ H.V]/Dest (0:4301) cvn /DEST pdfmark end
 -2 2905 a 396 2995 a Fk(Thinking)e(this)j(through)d(a)j
(little)g(more,)e(though,)f(we)j(can)f(see)g(that)h(fetch)e(is)j(just)e
(a)h(special)f(case)h(of)396 3103 y(publish-subscribe.)c(So)k(we)f(can)
g(get)h(the)f(best)g(of)g(both)g(w)o(orlds.)f(Here)h(is)i(the)e
(general)f(design:)-2 3121 y
SDict begin H.S end
 -2 3121 a -2 3121 a
SDict begin 13 H.A end
 -2 3121
a -2 3121 a
SDict begin [/View [/XYZ H.V]/Dest (0:4302) cvn /DEST pdfmark end
 -2 3121 a -2 3131 a
SDict begin H.S end
 -2 3131 a -2 3131 a
SDict begin 13 H.A end
 -2
3131 a -2 3131 a
SDict begin [/View [/XYZ H.V]/Dest (0:4303) cvn /DEST pdfmark end
 -2 3131 a Black 396 3273 a Fj(\225)p
Black 479 3273 a
SDict begin H.S end
 479 3273 a 479 3273 a
SDict begin 13 H.A end
 479 3273 a 479
3273 a
SDict begin [/View [/XYZ H.V]/Dest (0:4304) cvn /DEST pdfmark end
 479 3273 a Fk(Fetch)i(this)f(path)-2 3291 y
SDict begin H.S end
 -2
3291 a -2 3291 a
SDict begin 13 H.A end
 -2 3291 a -2 3291 a
SDict begin [/View [/XYZ H.V]/Dest (0:4305) cvn /DEST pdfmark end
 -2 3291 a Black
396 3422 a Fj(\225)p Black 479 3422 a
SDict begin H.S end
 479 3422 a 479
3422 a
SDict begin 13 H.A end
 479 3422 a 479 3422 a
SDict begin [/View [/XYZ H.V]/Dest (0:4306) cvn /DEST pdfmark end
 479 3422 a Fk(Here)g(is)h(credit)f
(\(repeat\))-2 3606 y
SDict begin H.S end
 -2 3606 a -2 3606 a
SDict begin 13 H.A end
 -2 3606 a -2
3606 a
SDict begin [/View [/XYZ H.V]/Dest (0:4307) cvn /DEST pdfmark end
 -2 3606 a 396 3696 a Fk(T)-7 b(o)20 b(mak)o(e)f(this)h(w)o(ork)f
(\(and)g(we)h(will,)g(my)f(dear)g(readers\),)f(we)i(need)f(to)h(be)f(a)
h(little)h(more)d(e)o(xplicit)h(about)g(ho)n(w)g(we)h(send)396
3804 y(credit)g(to)g(the)h(serv)o(er)-5 b(.)19 b(The)h(cute)g(trick)g
(of)g(treating)f(a)i(pipelined)e("fetch)g(chunk")g(request)g(as)i
(credit)f(w)o(on')o(t)f(\003y)i(since)396 3912 y(the)f(client)h(doesn')
o(t)d(kno)n(w)i(an)o(y)f(longer)g(what)h(\002les)h(actually)f(e)o
(xist,)g(ho)n(w)f(lar)o(ge)h(the)o(y)f(are,)h(an)o(ything.)e(If)i(the)g
(client)396 4020 y(says,)h("I'm)e(good)g(for)h(250,000)d(bytes)j(of)g
(data",)g(this)h(should)e(w)o(ork)g(equally)g(for)h(one)g(\002le)g(of)g
(250K)g(bytes,)f(or)h(100)396 4128 y(\002les)h(of)f(2,500)f(bytes.)-2
4312 y
SDict begin H.S end
 -2 4312 a -2 4312 a
SDict begin 13 H.A end
 -2 4312 a -2 4312 a
SDict begin [/View [/XYZ H.V]/Dest (0:4308) cvn /DEST pdfmark end
 -2 4312
a 396 4402 a Fk(And)h(this)h(gi)n(v)o(es)e(us)i("credit-based)d(\003o)n
(w)j(control",)d(which)i(ef)n(fecti)n(v)o(ely)e(remo)o(v)o(es)h(the)h
(need)f(for)h(HWMs,)h(and)f(an)o(y)396 4510 y(risk)h(of)e(memory)g(o)o
(v)o(er\003o)n(w)-5 b(.)-2 4538 y
SDict begin H.S end
 -2 4538 a -2 4538 a
SDict begin 13 H.A end

-2 4538 a -2 4538 a
SDict begin [/View [/XYZ H.V]/Dest (0:4309) cvn /DEST pdfmark end
 -2 4538 a Black 3757 5569 a Ff(356)p
Black eop end
%%Page: 357 370
TeXDict begin 357 369 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.357) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 94 a Fn(6.9.)39 b(Hear)s(tbeating)1160 94 y
SDict begin H.S end

1160 94 a 1160 94 a
SDict begin 22.464 H.A end
 1160 94 a 1160 94 a
SDict begin [/View [/XYZ H.V]/Dest (11.83.1) cvn /DEST pdfmark end
 1160 94 a -2
292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:4311) cvn /DEST pdfmark end
 -2 292 a 396
368 a Fk(Just)21 b(as)g(a)g(real)f(protocol)e(needs)i(to)h(solv)o(e)e
(the)i(problem)d(of)i(\003o)n(w)g(control,)f(it)i(also)f(needs)g(to)g
(solv)o(e)g(the)g(problem)f(of)396 476 y(kno)n(wing)g(whether)g(a)h
(peer)g(is)h(ali)n(v)o(e)f(or)g(dead.)f(This)h(is)i(not)d(an)i(issue)f
(speci\002c)h(to)f(\330MQ.)g(TCP)h(has)g(a)f(long)g(timeout)396
584 y(\(30)g(minutes)f(or)h(so\),)g(that)h(means)e(that)i(it)g(can)f
(be)g(impossible)f(to)i(kno)n(w)e(whether)g(a)i(peer)e(has)i(died,)e
(been)396 692 y(disconnected,)f(or)i(gone)f(on)h(a)h(week)o(end)e(to)h
(Prague)f(with)i(a)f(case)h(of)f(v)n(odka,)f(a)h(redhead,)e(and)i(a)h
(lar)o(ge)e(e)o(xpense)396 800 y(account.)-2 967 y
SDict begin H.S end
 -2
967 a -2 967 a
SDict begin 13 H.A end
 -2 967 a -2 967 a
SDict begin [/View [/XYZ H.V]/Dest (0:4312) cvn /DEST pdfmark end
 -2 967 a 396 1074 a
Fk(Heartbeating)g(is)i(not)f(easy)g(to)g(get)h(right,)e(and)h(as)h
(with)f(\003o)n(w)g(control)f(it)i(can)f(mak)o(e)g(the)g(dif)n(ference)
e(between)i(a)396 1182 y(w)o(orking,)f(and)g(f)o(ailing)h
(architecture.)e(So)j(using)e(our)h(standard)f(approach,)f(let')-5
b(s)21 b(start)g(with)f(the)g(simplest)h(possible)396
1290 y(heartbeat)e(design,)h(and)f(de)n(v)o(elop)f(better)i(and)g
(better)g(designs)g(until)g(we)g(ha)n(v)o(e)g(one)f(with)i(no)e
(visible)i(f)o(aults.)-2 1308 y
SDict begin H.S end
 -2 1308 a -2 1308 a
SDict begin 13 H.A end
 -2
1308 a -2 1308 a
SDict begin [/View [/XYZ H.V]/Dest (0:4313) cvn /DEST pdfmark end
 -2 1308 a 396 1618 a Fb(6.9.1.)36 b(Shrug)o(ging)c(It)
i(Off)1638 1618 y
SDict begin H.S end
 1638 1618 a 1638 1618 a
SDict begin 18.72 H.A end
 1638 1618 a
1638 1618 a
SDict begin [/View [/XYZ H.V]/Dest (11.83.46.2) cvn /DEST pdfmark end
 1638 1618 a -2 1810 a
SDict begin H.S end
 -2 1810 a -2 1810 a
SDict begin 13 H.A end

-2 1810 a -2 1810 a
SDict begin [/View [/XYZ H.V]/Dest (0:4315) cvn /DEST pdfmark end
 -2 1810 a 396 1892 a Fk(A)21 b(decent)e(\002rst)i
(iteration)f(is)h(to)f(do)g(no)g(heartbeating)e(at)j(all)f(and)g(see)h
(what)f(actually)g(happens.)e(Man)o(y)h(if)i(not)f(most)396
2000 y(\330MQ)h(applications)e(do)g(this.)i(\330MQ)f(encourages)f(this)
h(by)g(hiding)f(peers)h(in)g(man)o(y)f(cases.)i(What)g(problems)d(does)
396 2108 y(this)j(approach)d(cause?)-2 2126 y
SDict begin H.S end
 -2 2126
a -2 2126 a
SDict begin 13 H.A end
 -2 2126 a -2 2126 a
SDict begin [/View [/XYZ H.V]/Dest (0:4316) cvn /DEST pdfmark end
 -2 2126 a -2 2136 a
SDict begin H.S end
 -2
2136 a -2 2136 a
SDict begin 13 H.A end
 -2 2136 a -2 2136 a
SDict begin [/View [/XYZ H.V]/Dest (0:4317) cvn /DEST pdfmark end
 -2 2136 a Black
396 2278 a Fj(\225)p Black 479 2278 a
SDict begin H.S end
 479 2278 a 479
2278 a
SDict begin 13 H.A end
 479 2278 a 479 2278 a
SDict begin [/View [/XYZ H.V]/Dest (0:4318) cvn /DEST pdfmark end
 479 2278 a Fk(When)i(we)g(use)g(a)h(R)m
(OUTER)f(sock)o(et)g(in)g(an)g(application)e(that)i(tracks)g(peers,)f
(as)i(peers)f(disconnect)e(and)i(reconnect,)479 2386
y(the)g(application)f(will)i(leak)f(memory)f(and)g(get)i(slo)n(wer)f
(and)f(slo)n(wer)-5 b(.)-2 2404 y
SDict begin H.S end
 -2 2404 a -2 2404 a
SDict begin 13 H.A end

-2 2404 a -2 2404 a
SDict begin [/View [/XYZ H.V]/Dest (0:4319) cvn /DEST pdfmark end
 -2 2404 a Black 396 2535 a Fj(\225)p
Black 479 2535 a
SDict begin H.S end
 479 2535 a 479 2535 a
SDict begin 13 H.A end
 479 2535 a 479
2535 a
SDict begin [/View [/XYZ H.V]/Dest (0:4320) cvn /DEST pdfmark end
 479 2535 a Fk(When)20 b(we)h(use)f(SUB)i(or)d(DEALER-based)g
(data)h(recipients,)g(we)g(can')o(t)f(tell)i(the)g(dif)n(ference)d
(between)h(good)479 2643 y(silence)i(\(there')-5 b(s)19
b(no)h(data\))g(and)f(bad)h(silence)g(\(the)g(other)g(end)f(died\).)g
(When)h(a)h(recipient)e(kno)n(ws)h(the)g(other)f(side)479
2751 y(died,)h(it)h(can)f(for)f(e)o(xample)g(switch)i(o)o(v)o(er)d(to)j
(a)f(backup)f(route.)-2 2769 y
SDict begin H.S end
 -2 2769 a -2 2769 a
SDict begin 13 H.A end
 -2
2769 a -2 2769 a
SDict begin [/View [/XYZ H.V]/Dest (0:4321) cvn /DEST pdfmark end
 -2 2769 a Black 396 2900 a Fj(\225)p
Black 479 2900 a
SDict begin H.S end
 479 2900 a 479 2900 a
SDict begin 13 H.A end
 479 2900 a 479
2900 a
SDict begin [/View [/XYZ H.V]/Dest (0:4322) cvn /DEST pdfmark end
 479 2900 a Fk(If)h(we)h(use)f(a)h(TCP)g(connection)d(that)i
(stays)h(silent)g(for)e(a)i(long)e(while,)h(it)h(will,)g(in)f(some)g
(netw)o(orks,)f(just)i(die.)479 3008 y(Sending)e(something)g
(\(technically)-5 b(,)18 b(a)j("k)o(eep-ali)n(v)o(e")d(more)h(than)h(a)
g(heartbeat\),)f(will)i(k)o(eep)e(the)i(netw)o(ork)e(ali)n(v)o(e.)-2
3068 y
SDict begin H.S end
 -2 3068 a -2 3068 a
SDict begin 13 H.A end
 -2 3068 a -2 3068 a
SDict begin [/View [/XYZ H.V]/Dest (0:4323) cvn /DEST pdfmark end
 -2 3068
a 396 3378 a Fb(6.9.2.)36 b(One-W)-5 b(a)n(y)34 b(Hear)r(tbeats)1891
3378 y
SDict begin H.S end
 1891 3378 a 1891 3378 a
SDict begin 18.72 H.A end
 1891 3378 a 1891 3378
a
SDict begin [/View [/XYZ H.V]/Dest (11.83.47.2) cvn /DEST pdfmark end
 1891 3378 a -2 3569 a
SDict begin H.S end
 -2 3569 a -2 3569 a
SDict begin 13 H.A end
 -2 3569 a
-2 3569 a
SDict begin [/View [/XYZ H.V]/Dest (0:4325) cvn /DEST pdfmark end
 -2 3569 a 396 3652 a Fk(So,)20 b(our)g(\002rst)h(solution)e
(is)i(to)g(sending)e(a)h("heartbeat")f(message)h(from)f(each)h(node)f
(to)i(its)g(peers,)e(e)n(v)o(ery)g(second)h(or)f(so.)396
3760 y(When)h(one)f(node)g(hears)g(nothing)f(from)h(another)m(,)f
(within)h(some)h(timeout)f(\(se)n(v)o(eral)g(seconds,)f(typically\),)h
(it)h(will)h(treat)396 3868 y(that)g(peer)e(as)i(dead.)e(Sounds)h
(good,)e(right?)i(Sadly)f(no.)h(This)g(w)o(orks)g(in)h(some)f(cases)g
(b)n(ut)h(has)f(nasty)g(edge)g(cases)h(in)396 3976 y(other)f(cases.)-2
4143 y
SDict begin H.S end
 -2 4143 a -2 4143 a
SDict begin 13 H.A end
 -2 4143 a -2 4143 a
SDict begin [/View [/XYZ H.V]/Dest (0:4326) cvn /DEST pdfmark end
 -2 4143
a 396 4250 a Fk(F)o(or)g(PUB-SUB,)h(this)g(does)f(w)o(ork,)f(and)h(it')
-5 b(s)21 b(the)f(only)g(model)f(you)g(can)h(use.)g(SUB)i(sock)o(ets)e
(cannot)f(talk)h(back)g(to)396 4358 y(PUB)h(sock)o(ets,)g(b)n(ut)f(PUB)
h(sock)o(ets)f(can)g(happily)f(send)h("I'm)g(ali)n(v)o(e")f(messages)i
(to)f(their)g(subscribers.)-2 4542 y
SDict begin H.S end
 -2 4542 a -2 4542
a
SDict begin 13 H.A end
 -2 4542 a -2 4542 a
SDict begin [/View [/XYZ H.V]/Dest (0:4327) cvn /DEST pdfmark end
 -2 4542 a 396 4632 a Fk(As)h(an)f(optimization,)f
(you)g(can)h(send)g(heartbeats)f(only)h(when)f(there)h(is)h(no)f(real)g
(data)g(to)g(send.)g(Furthermore,)e(you)396 4740 y(can)i(send)g
(heartbeats)g(progressi)n(v)o(ely)d(slo)n(wer)j(and)g(slo)n(wer)m(,)f
(if)i(netw)o(ork)e(acti)n(vity)h(is)h(an)f(issue)h(\(e.g.)e(on)h
(mobile)396 4847 y(netw)o(orks)g(where)f(acti)n(vity)h(drains)g(the)g
(battery\).)e(As)j(long)f(as)h(the)f(recipient)f(can)h(detect)g(a)h(f)o
(ailure)e(\(sharp)h(stop)g(in)396 4955 y(acti)n(vity\),)f(that')-5
b(s)21 b(\002ne.)p Black 3756 5569 a Ff(357)p Black eop
end
%%Page: 358 371
TeXDict begin 358 370 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.358) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4328) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(No)n(w)h(the)h(typical)e(problems)g(with)h(this)h
(design:)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:4329) cvn /DEST pdfmark end
 -2 90
a -2 100 a
SDict begin H.S end
 -2 100 a -2 100 a
SDict begin 13 H.A end
 -2 100 a -2 100 a
SDict begin [/View [/XYZ H.V]/Dest (0:4330) cvn /DEST pdfmark end
 -2 100
a Black 396 243 a Fj(\225)p Black 479 243 a
SDict begin H.S end
 479 243 a
479 243 a
SDict begin 13 H.A end
 479 243 a 479 243 a
SDict begin [/View [/XYZ H.V]/Dest (0:4331) cvn /DEST pdfmark end
 479 243 a Fk(It)g(can)f(be)g(inaccurate)f
(when)g(we)i(send)f(lar)o(ge)f(amounts)g(of)h(data,)g(since)g
(heartbeats)g(will)h(be)f(delayed)f(behind)f(that)479
351 y(data.)i(If)g(heartbeats)f(are)i(delayed,)d(you)i(can)g(get)g(f)o
(alse)g(timeouts)g(and)g(disconnections)e(due)i(to)g(netw)o(ork)479
459 y(congestion.)f(Thus,)g(al)o(w)o(ays)i(treat)1506
459 y
SDict begin H.S end
 1506 459 a 1506 459 a
SDict begin 13 H.A end
 1506 459 a 1506 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:4332) cvn /DEST pdfmark end
 1506
459 a Ff(any)f Fk(incoming)e(data)i(as)h(a)g(heartbeat,)d(whether)i(or)
g(not)f(the)i(sender)e(optimizes)479 566 y(out)h(heartbeats.)-2
567 y
SDict begin H.S end
 -2 567 a -2 567 a
SDict begin 13 H.A end
 -2 567 a -2 567 a
SDict begin [/View [/XYZ H.V]/Dest (0:4333) cvn /DEST pdfmark end
 -2 567 a Black
396 716 a Fj(\225)p Black 479 716 a
SDict begin H.S end
 479 716 a 479 716
a
SDict begin 13 H.A end
 479 716 a 479 716 a
SDict begin [/View [/XYZ H.V]/Dest (0:4334) cvn /DEST pdfmark end
 479 716 a Fk(While)h(the)f(PUB-SUB)i(pattern)d
(will)i(drop)e(messages)h(for)g(disappeared)e(recipients,)h(PUSH)i(and)
f(DEALER)479 824 y(sock)o(ets)h(will)g(queue)e(them.)g(So,)h(if)h(you)e
(send)h(heartbeats)f(to)i(a)f(dead)g(peer)m(,)f(and)h(it)g(comes)g
(back,)g(it')o(ll)g(get)h(all)f(the)479 932 y(heartbeats)g(you)f(sent.)
h(Which)g(can)g(be)g(thousands.)f(Whoa,)h(whoa!)-2 950
y
SDict begin H.S end
 -2 950 a -2 950 a
SDict begin 13 H.A end
 -2 950 a -2 950 a
SDict begin [/View [/XYZ H.V]/Dest (0:4335) cvn /DEST pdfmark end
 -2 950 a Black
396 1081 a Fj(\225)p Black 479 1081 a
SDict begin H.S end
 479 1081 a 479
1081 a
SDict begin 13 H.A end
 479 1081 a 479 1081 a
SDict begin [/View [/XYZ H.V]/Dest (0:4336) cvn /DEST pdfmark end
 479 1081 a Fk(This)h(design)e(assumes)i
(that)f(heartbeat)f(timeouts)h(are)g(the)g(same)g(across)h(the)f(whole)
f(netw)o(ork.)g(But)i(that)f(w)o(on')o(t)f(be)479 1189
y(accurate.)g(Some)h(peers)g(will)h(w)o(ant)f(v)o(ery)f(aggressi)n(v)o
(e)g(heart-beating,)f(to)i(detect)g(f)o(aults)h(rapidly)-5
b(.)18 b(And)i(some)g(will)479 1297 y(w)o(ant)h(v)o(ery)e(relax)o(ed)f
(heart-beating,)g(to)i(let)h(sleeping)f(netw)o(orks)f(lie,)h(and)g(sa)n
(v)o(e)g(po)n(wer)-5 b(.)-2 1357 y
SDict begin H.S end
 -2 1357 a -2 1357
a
SDict begin 13 H.A end
 -2 1357 a -2 1357 a
SDict begin [/View [/XYZ H.V]/Dest (0:4337) cvn /DEST pdfmark end
 -2 1357 a 396 1667 a Fb(6.9.3.)36
b(Ping-P)-5 b(ong)33 b(Hear)r(tbeats)1973 1667 y
SDict begin H.S end
 1973
1667 a 1973 1667 a
SDict begin 18.72 H.A end
 1973 1667 a 1973 1667 a
SDict begin [/View [/XYZ H.V]/Dest (11.83.48.2) cvn /DEST pdfmark end
 1973 1667
a -2 1859 a
SDict begin H.S end
 -2 1859 a -2 1859 a
SDict begin 13 H.A end
 -2 1859 a -2 1859 a
SDict begin [/View [/XYZ H.V]/Dest (0:4339) cvn /DEST pdfmark end
 -2
1859 a 396 1941 a Fk(Our)20 b(third)g(design)f(uses)i(a)g(ping-pong)c
(dialog.)i(One)h(peer)f(sends)i(a)f(ping)g(command)e(to)i(the)g(other)m
(,)f(which)h(replies)396 2049 y(with)h(a)f(pong)f(command.)f(Neither)i
(command)e(has)i(an)o(y)g(payload.)e(Pings)i(and)g(pongs)f(are)h(not)g
(correlated.)f(Since)h(the)396 2156 y(roles)g(of)g("client")g(and)g
("serv)o(er")f(are)h(often)f(arbitrary)-5 b(,)18 b(we)j(specify)f(that)
g(either)g(peer)f(can)h(in)h(f)o(act)f(send)g(a)h(ping)e(and)396
2264 y(e)o(xpect)g(a)i(pong)e(in)h(response.)f(Ho)n(we)n(v)o(er)m(,)f
(since)j(the)f(timeouts)g(depend)e(on)i(netw)o(ork)f(topologies)g(kno)n
(wn)f(best)j(to)396 2372 y(dynamic)e(clients,)h(it)h(is)g(usually)f
(the)g(client)g(which)g(pings)g(the)g(serv)o(er)-5 b(.)-2
2556 y
SDict begin H.S end
 -2 2556 a -2 2556 a
SDict begin 13 H.A end
 -2 2556 a -2 2556 a
SDict begin [/View [/XYZ H.V]/Dest (0:4340) cvn /DEST pdfmark end
 -2 2556
a 396 2646 a Fk(This)21 b(w)o(orks)e(for)h(all)h(R)m(OUTER-based)e
(brok)o(ers.)g(The)h(same)g(optimizations)f(we)h(used)g(in)h(the)f
(second)f(model)g(mak)o(e)396 2754 y(this)i(w)o(ork)f(e)n(v)o(en)f
(better:)h(treat)g(an)o(y)f(incoming)g(data)h(as)h(a)f(pong,)f(and)g
(only)h(send)g(a)g(ping)g(when)f(not)h(otherwise)396
2862 y(sending)f(data.)-2 2974 y
SDict begin H.S end
 -2 2974 a -2 2974 a
SDict begin 13 H.A end

-2 2974 a -2 2974 a
SDict begin [/View [/XYZ H.V]/Dest (0:4341) cvn /DEST pdfmark end
 -2 2974 a 359 x Fn(6.10.)39 b(State)f(Mac)o(hines)
1402 3333 y
SDict begin H.S end
 1402 3333 a 1402 3333 a
SDict begin 22.464 H.A end
 1402 3333 a 1402
3333 a
SDict begin [/View [/XYZ H.V]/Dest (11.84.1) cvn /DEST pdfmark end
 1402 3333 a -2 3501 a
SDict begin H.S end
 -2 3501 a -2 3501 a
SDict begin 13 H.A end
 -2 3501
a -2 3501 a
SDict begin [/View [/XYZ H.V]/Dest (0:4343) cvn /DEST pdfmark end
 -2 3501 a 396 3607 a Fk(Softw)o(are)20 b(engineers)f(tend)h
(to)g(treat)g(\(\002nite\))g(state)h(machines)e(as)i(a)g(kind)e(of)h
(intermediary)e(interpreter)-5 b(.)19 b(That)h(is,)g(you)396
3715 y(tak)o(e)h(a)f(re)o(gular)f(language)f(and)i(compile)f(that)h
(into)g(a)h(state)g(machine,)e(then)g(e)o(x)o(ecute)g(the)h(state)h
(machine.)e(The)h(state)396 3823 y(machine)f(itself)i(is)g(rarely)f
(visible)g(to)g(the)g(de)n(v)o(eloper:)e(it')-5 b(s)21
b(an)g(internal)e(representation,)f(optimized,)g(compressed,)396
3930 y(and)i(bizarre.)-2 4097 y
SDict begin H.S end
 -2 4097 a -2 4097 a
SDict begin 13 H.A end
 -2
4097 a -2 4097 a
SDict begin [/View [/XYZ H.V]/Dest (0:4344) cvn /DEST pdfmark end
 -2 4097 a 396 4204 a Fk(Ho)n(we)n(v)o(er)e(it)j(turns)
e(out)g(that)h(state)g(machines)e(are)i(also)g(v)n(aluable)e(as)i(a)g
(\002rst-class)h(modeling)c(languages)i(for)f(protocol)396
4312 y(handlers,)h(i.e.)h(\330MQ)h(clients)f(and)g(serv)o(ers.)f
(\330MQ)i(mak)o(es)f(it)h(rather)e(easy)h(to)h(design)e(protocols,)g(b)
n(ut)h(we')l(v)o(e)f(ne)n(v)o(er)396 4420 y(de\002ned)g(a)i(good)e
(pattern)g(for)h(writing)f(those)h(clients)h(and)e(serv)o(ers)h
(properly)-5 b(.)-2 4604 y
SDict begin H.S end
 -2 4604 a -2 4604 a
SDict begin 13 H.A end
 -2 4604
a -2 4604 a
SDict begin [/View [/XYZ H.V]/Dest (0:4345) cvn /DEST pdfmark end
 -2 4604 a 396 4694 a Fk(A)21 b(protocol)d(has)j(at)g(least)
f(tw)o(o)h(le)n(v)o(els:)-2 4712 y
SDict begin H.S end
 -2 4712 a -2 4712
a
SDict begin 13 H.A end
 -2 4712 a -2 4712 a
SDict begin [/View [/XYZ H.V]/Dest (0:4346) cvn /DEST pdfmark end
 -2 4712 a -2 4722 a
SDict begin H.S end
 -2 4722 a -2
4722 a
SDict begin 13 H.A end
 -2 4722 a -2 4722 a
SDict begin [/View [/XYZ H.V]/Dest (0:4347) cvn /DEST pdfmark end
 -2 4722 a Black 396 4864 a
Fj(\225)p Black 479 4864 a
SDict begin H.S end
 479 4864 a 479 4864 a
SDict begin 13 H.A end
 479
4864 a 479 4864 a
SDict begin [/View [/XYZ H.V]/Dest (0:4348) cvn /DEST pdfmark end
 479 4864 a Fk(Ho)n(w)f(we)h(represent)e(indi)n
(vidual)f(messages)j(on)e(the)i(wire.)-2 4882 y
SDict begin H.S end
 -2 4882
a -2 4882 a
SDict begin 13 H.A end
 -2 4882 a -2 4882 a
SDict begin [/View [/XYZ H.V]/Dest (0:4349) cvn /DEST pdfmark end
 -2 4882 a Black 396 5014
a Fj(\225)p Black 479 5014 a
SDict begin H.S end
 479 5014 a 479 5014 a
SDict begin 13 H.A end
 479
5014 a 479 5014 a
SDict begin [/View [/XYZ H.V]/Dest (0:4350) cvn /DEST pdfmark end
 479 5014 a Fk(Ho)n(w)f(messages)h(\003o)n(w)f
(between)f(peers,)h(and)g(the)g(signi\002cance)f(of)h(each)g(message.)p
Black 3759 5569 a Ff(358)p Black eop end
%%Page: 359 372
TeXDict begin 359 371 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.359) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4351) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(W)-7 b(e')l(v)o(e)20 b(seen)h(in)f(this)h(chapter)e
(ho)n(w)g(to)i(produce)d(codecs)h(that)i(handle)e(serialization.)g
(That')-5 b(s)20 b(a)h(good)e(start.)h(But)h(if)g(we)396
180 y(lea)n(v)o(e)f(the)g(second)g(job)g(to)g(de)n(v)o(elopers,)e(that)
i(gi)n(v)o(es)g(them)g(a)g(lot)h(of)f(room)f(to)h(interpret.)f(As)i(we)
f(mak)o(e)g(more)396 288 y(ambitious)g(protocols)e(\(\002le)j(transfer)
e(+)i(heart-beating)c(+)k(credit)f(+)g(authentication\),)e(it)j
(becomes)e(less)i(and)f(less)h(sane)396 396 y(to)g(try)f(to)g
(implement)f(clients)h(and)g(serv)o(ers)g(by)f(hand.)-2
580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:4352) cvn /DEST pdfmark end
 -2 580 a 396
670 a Fk(Y)-8 b(es,)21 b(people)e(do)g(this)i(almost)f(systematically)
-5 b(.)19 b(But)i(the)f(costs)h(are)f(high,)f(and)h(the)o(y')l(re)f(a)n
(v)n(oidable.)g(I')o(ll)h(e)o(xplain)f(ho)n(w)396 778
y(to)i(model)e(protocols)g(using)g(state)i(machines,)e(and)h(ho)n(w)g
(to)g(generate)f(neat)h(and)g(solid)g(code)f(from)h(those)g(models.)-2
962 y
SDict begin H.S end
 -2 962 a -2 962 a
SDict begin 13 H.A end
 -2 962 a -2 962 a
SDict begin [/View [/XYZ H.V]/Dest (0:4353) cvn /DEST pdfmark end
 -2 962 a 396
1052 a Fk(My)g(e)o(xperience)e(with)j(using)e(state)i(machines)f(as)h
(a)f(softw)o(are)g(construction)e(tool)i(dates)h(to)f(1985)f(and)g(my)h
(\002rst)h(real)396 1160 y(job)f(making)f(tools)h(for)g(application)e
(de)n(v)o(elopers.)g(In)i(1991)f(I)h(turned)f(that)i(kno)n(wledge)d
(into)h(a)i(free)f(softw)o(are)g(tool)396 1268 y(called)g(Libero,)f
(which)h(spat)g(out)g(e)o(x)o(ecutable)e(state)j(machines)f(from)f(a)h
(simple)h(te)o(xt)f(model.)-2 1452 y
SDict begin H.S end
 -2 1452 a -2 1452
a
SDict begin 13 H.A end
 -2 1452 a -2 1452 a
SDict begin [/View [/XYZ H.V]/Dest (0:4354) cvn /DEST pdfmark end
 -2 1452 a 396 1542 a Fk(The)g(thing)g(about)f
(Libero')-5 b(s)19 b(model)h(w)o(as)h(that)f(it)h(w)o(as)g(readable.)e
(That)g(is,)i(you)f(described)f(your)f(program)g(logic)i(as)396
1650 y(named)f(states,)i(each)f(accepting)f(a)i(set)g(of)f(e)n(v)o
(ents,)f(each)h(doing)f(some)h(real)g(w)o(ork.)f(The)h(resulting)f
(state)i(machine)396 1758 y(hook)o(ed)e(into)h(your)e(application)h
(code,)g(dri)n(ving)g(it)i(lik)o(e)f(a)h(boss.)-2 1942
y
SDict begin H.S end
 -2 1942 a -2 1942 a
SDict begin 13 H.A end
 -2 1942 a -2 1942 a
SDict begin [/View [/XYZ H.V]/Dest (0:4355) cvn /DEST pdfmark end
 -2 1942 a 396
2032 a Fk(Libero)e(w)o(as)i(charmingly)d(good)h(at)i(its)g(job,)f
(\003uent)f(in)i(man)o(y)e(languages,)f(and)i(modestly)f(popular)g(gi)n
(v)o(en)f(the)396 2140 y(enigmatic)h(nature)h(of)g(state)h(machines.)e
(W)-7 b(e)21 b(used)f(Libero)f(in)h(anger)f(in)i(dozens)e(of)h(lar)o
(ge)f(distrib)n(uted)h(applications,)396 2248 y(one)g(of)g(which)f(w)o
(as)i(\002nally)f(switched)g(of)n(f)g(in)g(2011.)f(State-machine)f(dri)
n(v)o(en)h(code)h(construction)e(w)o(ork)o(ed)h(so)h(well)396
2356 y(that)h(it')-5 b(s)21 b(some)n(what)e(impressi)n(v)o(e)g(this)i
(approach)d(ne)n(v)o(er)h(hit)h(the)h(mainstream)e(of)h(softw)o(are)f
(engineering.)-2 2540 y
SDict begin H.S end
 -2 2540 a -2 2540 a
SDict begin 13 H.A end
 -2 2540 a
-2 2540 a
SDict begin [/View [/XYZ H.V]/Dest (0:4356) cvn /DEST pdfmark end
 -2 2540 a 396 2630 a Fk(So)i(in)f(this)h(section)f(I'm)f
(going)g(to)i(e)o(xplain)d(Libero')-5 b(s)20 b(model,)f(and)h(sho)n(w)g
(ho)n(w)f(to)i(use)f(it)h(to)f(generate)f(\330MQ)i(clients)396
2737 y(and)f(serv)o(ers.)f(W)-7 b(e')o(ll)22 b(use)e(GSL)h(again)e(b)n
(ut)h(lik)o(e)g(I)h(said,)f(the)g(principles)f(are)i(general)e(and)g
(you)h(can)g(put)f(together)g(code)396 2845 y(generators)g(using)g(an)o
(y)h(scripting)f(language.)-2 3029 y
SDict begin H.S end
 -2 3029 a -2 3029
a
SDict begin 13 H.A end
 -2 3029 a -2 3029 a
SDict begin [/View [/XYZ H.V]/Dest (0:4357) cvn /DEST pdfmark end
 -2 3029 a 396 3119 a Fk(As)i(a)g(w)o(ork)o(ed)e
(e)o(xample)g(let')-5 b(s)21 b(see)g(ho)n(w)e(to)i(carry-on)d(a)i
(stateful)g(dialog)g(with)g(a)h(peer)e(on)h(a)h(R)m(OUTER)f(sock)o(et.)
g(W)-7 b(e')o(ll)396 3227 y(de)n(v)o(elop)19 b(the)h(serv)o(er)f(using)
h(a)g(state)h(machine)e(\(and)h(the)g(client)g(by)g(hand\).)e(W)-7
b(e)22 b(ha)n(v)o(e)d(a)i(simple)f(protocol)f(that)h(I')o(ll)g(call)396
3335 y("NOM".)g(I'm)g(using)g(the)g(oh-so-v)o(ery-serious)1805
3335 y
SDict begin H.S end
 1805 3335 a 1805 3335 a
SDict begin 13 H.A end
 1805 3335 a 1805 3335
a
SDict begin [/View [/XYZ H.V]/Dest (0:4358) cvn /DEST pdfmark end
 1805 3335 a Fk(k)o(e)o(yw)o(ords)e(for)i(unprotocols)e
(\(http://unprotocols.or)o(g/b)o(log)o(:2\))396 3443
y(proposal:)-2 3544 y
SDict begin H.S end
 -2 3544 a -2 3544 a
SDict begin 11.7 H.A end
 -2 3544 a -2
3544 a
SDict begin [/View [/XYZ H.V]/Dest (0:4359) cvn /DEST pdfmark end
 -2 3544 a 396 3623 a Fe(nom-protocol)178 b(=)44
b(open-peering)1786 3636 y(*)1831 3623 y(use-peering)396
3818 y(open-peering)178 b(=)44 b(C:OHAI)g(\()h(S:OHAI-OK)e(/)i(S:WTF)f
(\))396 4012 y(use-peering)223 b(=)44 b(C:ICANHAZ)1114
4109 y(/)g(S:CHEEZBURGER)1114 4206 y(/)g(C:HUGZ)g(S:HUGZ-OK)1114
4303 y(/)g(S:HUGZ)g(C:HUGZ-OK)-2 4475 y
SDict begin H.S end
 -2 4475 a -2
4475 a
SDict begin 13 H.A end
 -2 4475 a -2 4475 a
SDict begin [/View [/XYZ H.V]/Dest (0:4360) cvn /DEST pdfmark end
 -2 4475 a 396 4577 a Fk(I')l(v)o(e)19
b(not)h(found)f(a)h(quick)f(w)o(ay)i(to)f(e)o(xplain)f(the)h(true)g
(nature)f(of)h(state)h(machine)e(programming.)e(In)i(my)h(e)o
(xperience,)e(it)396 4685 y(in)m(v)n(ariably)g(tak)o(es)j(a)f(fe)n(w)h
(days)e(of)h(practice.)g(After)g(three)f(or)h(four)f(days')h(e)o
(xposure)e(to)i(the)h(idea)f(there)f(is)j(a)396 4793
y(near)n(-audible)c('click!')h(as)i(something)e(in)h(the)h(brain)e
(connects)g(all)i(the)f(pieces)g(together)-5 b(.)19 b(W)-7
b(e')o(ll)22 b(mak)o(e)d(it)i(concrete)e(by)396 4901
y(looking)g(at)h(the)h(state)g(machine)e(for)g(our)h(NOM)g(serv)o(er)-5
b(.)p Black 3759 5569 a Ff(359)p Black eop end
%%Page: 360 373
TeXDict begin 360 372 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.360) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4387) cvn /DEST pdfmark end
 -2 -201 a 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4361) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(A)i(useful)f(thing)f(about)g(state)i(machines)f(is)h
(that)f(you)f(can)h(read)g(them)g(state)h(by)e(state.)i(Each)f(state)h
(has)f(a)h(unique)396 180 y(descripti)n(v)o(e)e(name,)g(and)h(one)g(or)
g(more)1562 180 y
SDict begin H.S end
 1562 180 a 1562 180 a
SDict begin 13 H.A end
 1562 180 a 1562
180 a
SDict begin [/View [/XYZ H.V]/Dest (0:4362) cvn /DEST pdfmark end
 1562 180 a Ff(e)o(vents)p Fk(,)g(which)f(we)i(list)g(in)f(an)o(y)
g(order)-5 b(.)19 b(F)o(or)h(each)g(e)n(v)o(ent)f(we)h(perform)f(zero)g
(or)396 288 y(more)588 288 y
SDict begin H.S end
 588 288 a 588 288 a
SDict begin 13 H.A end
 588
288 a 588 288 a
SDict begin [/View [/XYZ H.V]/Dest (0:4363) cvn /DEST pdfmark end
 588 288 a Ff(actions)p Fk(,)g(and)h(we)g(then)g(mo)o(v)
o(e)f(to)h(a)1637 288 y
SDict begin H.S end
 1637 288 a 1637 288 a
SDict begin 13 H.A end
 1637 288
a 1637 288 a
SDict begin [/View [/XYZ H.V]/Dest (0:4364) cvn /DEST pdfmark end
 1637 288 a Ff(ne)n(xt)g(state)h Fk(\(or)e(stay)i(in)f(the)
g(same)h(state\).)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a
-2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:4365) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(In)f(a)h(\330MQ)f(protocol)f(serv)o(er)m
(,)f(we)j(ha)n(v)o(e)f(a)g(state)h(machine)e(instance)2413
562 y
SDict begin H.S end
 2413 562 a 2413 562 a
SDict begin 13 H.A end
 2413 562 a 2413 562 a
SDict begin [/View [/XYZ H.V]/Dest (0:4366) cvn /DEST pdfmark end
 2413
562 a Ff(per)h(client)q Fk(.)h(That)f(sounds)f(comple)o(x)g(b)n(ut)h
(it)h(isn')o(t,)396 670 y(as)g(we')o(ll)g(see.)f(W)-7
b(e)22 b(describe)d(our)g(\002rst)i(state)g(\(Start\))f(as)h(ha)n(ving)
e(one)h(v)n(alid)f(e)n(v)o(ent,)g("OHAI".)h(W)-7 b(e)22
b(check)d(the)h(user')-5 b(s)396 778 y(credentials)20
b(and)f(then)h(arri)n(v)o(e)f(in)h(the)h(Authenticated)d(state\()p
0 TeXcolorgray 2166 778 a
SDict begin H.S end
 2166 778 a Fk(Figure)h(6-1)2515
778 y
SDict begin 13 H.L end
 2515 778 a 2515 778 a
SDict begin [/Subtype /Link/Dest (0:figure-70) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 2515 778 a Black -1 w Fk(\).)-2
796 y
SDict begin H.S end
 -2 796 a -2 796 a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-70) cvn /DEST pdfmark
end
 -2 796 a 396
979 a Fg(Figur)o(e)h(6-1.)f(The)i('Start')e(State)-2
1079 y
SDict begin H.S end
 -2 1079 a -2 1079 a
SDict begin 13 H.A end
 -2 1079 a -2 1079 a
SDict begin [/View [/XYZ H.V]/Dest (0:4370) cvn /DEST pdfmark end
 -2 1079
a 396 1821 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1821 a @beginspecial 0 @llx -84 @lly
310 @urx 0 @ury 3100 @rwi @setspecial
%%BeginDocument: images/fig70.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -84 310 0
%%HiResBoundingBox: 0.0 -84.0 310.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -18.500150680541992 moveto
14.500150044759115 -18.500150680541992 13.500149726867676 -19.833484013875324 13.500149726867676 -22.500150680541992 curveto
13.500149726867676 -29.500150680541992 lineto
13.500149726867676 -31.500149408976238 14.500150044759115 -32.50014877319336 16.500150680541992 -32.50014877319336 curveto
111.50015258789062 -32.50014877319336 lineto
111.50015258789062 -32.50014877319336 lineto
112.83348592122395 -32.50014877319336 113.50015258789062 -31.500149408976238 113.50015258789062 -29.500150680541992 curveto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -19.833484013875324 112.83348592122395 -18.500150680541992 111.50015258789062 -18.500150680541992 curveto
16.500150680541992 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -46.50014877319336 moveto
23.500150680541992 -60.50014877319336 lineto
93.50015258789062 -60.50014877319336 lineto
93.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -46.50014877319336 moveto
199.50015258789062 -46.50014877319336 198.50015258789062 -47.833482106526695 198.50015258789062 -50.50014877319336 curveto
198.50015258789062 -57.50014877319336 lineto
198.50015258789062 -59.50014877319336 199.50015258789062 -60.50014877319336 201.50015258789062 -60.50014877319336 curveto
296.5001525878906 -60.50014877319336 lineto
296.5001525878906 -60.50014877319336 lineto
297.83348592122394 -60.50014877319336 298.5001525878906 -59.50014877319336 298.5001525878906 -57.50014877319336 curveto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -47.833482106526695 297.83348592122394 -46.50014877319336 296.5001525878906 -46.50014877319336 curveto
201.50015258789062 -46.50014877319336 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
stroke
newpath
95.0 -52.0 moveto
192.0 -52.0 lineto
stroke
newpath
22.0 -35.0 moveto
22.0 -45.0 lineto
stroke
newpath
190.0 -49.0 moveto
195.0 -52.0 lineto
190.0 -56.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
23.0 -28.0 moveto
(Start) show
30.0 -56.0 moveto
(OHAI) show
210.0 -56.0 moveto
(Authenticated) show
112.0 -70.0 moveto
(Check Credentials) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1821 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1821 a -2 1987 a
SDict begin H.S end
 -2 1987
a -2 1987 a
SDict begin 13 H.A end
 -2 1987 a -2 1987 a
SDict begin [/View [/XYZ H.V]/Dest (0:4373) cvn /DEST pdfmark end
 -2 1987 a 396 2095 a
Fk(The)h(Check)g(Credentials)g(action)g(produces)e(either)i(an)g('ok')f
(or)h(an)g('error')e(e)n(v)o(ent.)h(It')-5 b(s)21 b(in)g(the)f
(Authenticated)e(state)396 2203 y(that)j(we)f(handle)f(these)i(tw)o(o)f
(possible)g(e)n(v)o(ents,)f(by)h(sending)f(an)h(appropriate)e(reply)h
(back)h(to)g(the)g(client\()p 0 TeXcolorgray 3450 2203
a
SDict begin H.S end
 3450 2203 a Fk(Figure)f(6-2)3799 2203 y
SDict begin 13 H.L end
 3799 2203 a
3799 2203 a
SDict begin [/Subtype /Link/Dest (0:figure-71) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3799 2203 a Black -1 w Fk(\).)396 2311 y(If)h
(authentication)e(f)o(ailed,)i(we)h(return)e(to)h(the)g(Start)h(state)g
(where)e(the)i(client)f(can)g(try)g(again.)-2 2329 y
SDict begin H.S end

-2 2329 a -2 2329 a
SDict begin 13 H.A end
 -2 2329 a -2 2329 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-71) cvn /DEST pdfmark
end
 -2 2329 a 396
2512 a Fg(Figur)o(e)g(6-2.)f(The)i('A)l(uthenticated')e(State)-2
2612 y
SDict begin H.S end
 -2 2612 a -2 2612 a
SDict begin 13 H.A end
 -2 2612 a -2 2612 a
SDict begin [/View [/XYZ H.V]/Dest (0:4377) cvn /DEST pdfmark end
 -2 2612
a 396 3645 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 3645 a @beginspecial 0 @llx -119 @lly
310 @urx 0 @ury 3100 @rwi @setspecial
%%BeginDocument: images/fig71.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -119 310 0
%%HiResBoundingBox: 0.0 -119.0 310.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -18.500150680541992 moveto
14.500150044759115 -18.500150680541992 13.500149726867676 -19.833484013875324 13.500149726867676 -22.500150680541992 curveto
13.500149726867676 -29.500150680541992 lineto
13.500149726867676 -31.500149408976238 14.500150044759115 -32.50014877319336 16.500150680541992 -32.50014877319336 curveto
111.50015258789062 -32.50014877319336 lineto
111.50015258789062 -32.50014877319336 lineto
112.83348592122395 -32.50014877319336 113.50015258789062 -31.500149408976238 113.50015258789062 -29.500150680541992 curveto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -19.833484013875324 112.83348592122395 -18.500150680541992 111.50015258789062 -18.500150680541992 curveto
16.500150680541992 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -46.50014877319336 moveto
23.500150680541992 -60.50014877319336 lineto
93.50015258789062 -60.50014877319336 lineto
93.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -81.50015258789062 moveto
23.500150680541992 -95.50015258789062 lineto
93.50015258789062 -95.50015258789062 lineto
93.50015258789062 -81.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -46.50014877319336 moveto
199.50015258789062 -46.50014877319336 198.50015258789062 -47.833482106526695 198.50015258789062 -50.50014877319336 curveto
198.50015258789062 -57.50014877319336 lineto
198.50015258789062 -59.50014877319336 199.50015258789062 -60.50014877319336 201.50015258789062 -60.50014877319336 curveto
296.5001525878906 -60.50014877319336 lineto
296.5001525878906 -60.50014877319336 lineto
297.83348592122394 -60.50014877319336 298.5001525878906 -59.50014877319336 298.5001525878906 -57.50014877319336 curveto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -47.833482106526695 297.83348592122394 -46.50014877319336 296.5001525878906 -46.50014877319336 curveto
201.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -81.50015258789062 moveto
199.50015258789062 -81.50015258789062 198.50015258789062 -82.83348592122395 198.50015258789062 -85.50015258789062 curveto
198.50015258789062 -92.50015258789062 lineto
198.50015258789062 -94.50015258789062 199.50015258789062 -95.50015258789062 201.50015258789062 -95.50015258789062 curveto
296.5001525878906 -95.50015258789062 lineto
296.5001525878906 -95.50015258789062 lineto
297.83348592122394 -95.50015258789062 298.5001525878906 -94.50015258789062 298.5001525878906 -92.50015258789062 curveto
298.5001525878906 -85.50015258789062 lineto
298.5001525878906 -85.50015258789062 lineto
298.5001525878906 -82.83348592122395 297.83348592122394 -81.50015258789062 296.5001525878906 -81.50015258789062 curveto
201.50015258789062 -81.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -80.0 moveto
22.0 -94.0 lineto
92.0 -94.0 lineto
92.0 -80.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -80.0 moveto
22.0 -94.0 lineto
92.0 -94.0 lineto
92.0 -80.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -80.0 moveto
198.0 -80.0 197.0 -81.33333333333333 197.0 -84.0 curveto
197.0 -91.0 lineto
197.0 -93.0 198.0 -94.0 200.0 -94.0 curveto
295.0 -94.0 lineto
295.0 -94.0 lineto
296.3333333333333 -94.0 297.0 -93.0 297.0 -91.0 curveto
297.0 -84.0 lineto
297.0 -84.0 lineto
297.0 -81.33333333333333 296.3333333333333 -80.0 295.0 -80.0 curveto
200.0 -80.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -80.0 moveto
198.0 -80.0 197.0 -81.33333333333333 197.0 -84.0 curveto
197.0 -91.0 lineto
197.0 -93.0 198.0 -94.0 200.0 -94.0 curveto
295.0 -94.0 lineto
295.0 -94.0 lineto
296.3333333333333 -94.0 297.0 -93.0 297.0 -91.0 curveto
297.0 -84.0 lineto
297.0 -84.0 lineto
297.0 -81.33333333333333 296.3333333333333 -80.0 295.0 -80.0 curveto
200.0 -80.0 lineto
closepath
stroke
newpath
95.0 -52.0 moveto
192.0 -52.0 lineto
stroke
newpath
150.0 -66.0 moveto
154.0 -66.0 lineto
stroke
newpath
95.0 -87.0 moveto
192.0 -87.0 lineto
stroke
newpath
22.0 -35.0 moveto
22.0 -45.0 lineto
stroke
newpath
22.0 -59.0 moveto
22.0 -80.0 lineto
stroke
newpath
190.0 -49.0 moveto
195.0 -52.0 lineto
190.0 -56.0 lineto
closepath
fill
newpath
190.0 -84.0 moveto
195.0 -87.0 lineto
190.0 -91.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
25.0 -28.0 moveto
(Authenticated) show
30.0 -56.0 moveto
(ok) show
205.0 -56.0 moveto
(Ready) show
108.0 -70.0 moveto
(Send OHAI OK) show
33.0 -91.0 moveto
(error) show
208.0 -91.0 moveto
(Start) show
105.0 -105.0 moveto
(Send WTF) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 3645 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 3645 a -2 3811 a
SDict begin H.S end
 -2 3811
a -2 3811 a
SDict begin 13 H.A end
 -2 3811 a -2 3811 a
SDict begin [/View [/XYZ H.V]/Dest (0:4380) cvn /DEST pdfmark end
 -2 3811 a 396 3919 a
Fk(When)h(authentication)e(has)j(succeeded,)d(we)j(arri)n(v)o(e)e(in)h
(the)h(Ready)f(state.)g(Here)g(we)h(ha)n(v)o(e)e(three)h(possible)g(e)n
(v)o(ents:)g(an)396 4027 y(ICANHAZ)h(or)e(HUGZ)i(message)f(from)f(the)h
(client,)g(or)g(a)h(heartbeat)e(timer)h(e)n(v)o(ent\()p
0 TeXcolorgray 2839 4027 a
SDict begin H.S end
 2839 4027 a Fk(Figure)d(6-3)3186
4027 y
SDict begin 13 H.L end
 3186 4027 a 3186 4027 a
SDict begin [/Subtype /Link/Dest (0:figure-72) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end
 3186 4027 a Black -1 w
Fk(\).)-2 4045 y
SDict begin H.S end
 -2 4045 a -2 4045 a
SDict begin 13 H.A end
 -2 4045 a -2 4045
a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-72) cvn /DEST pdfmark
end
 -2 4045 a Black 3759 5569 a Ff(360)p Black eop end
%%Page: 361 374
TeXDict begin 361 373 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.361) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fg(Figur)o(e)h(6-3.)f(The)i('Ready')e(State)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:4384) cvn /DEST pdfmark end
 -2 172 a 396
1497 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1497 a @beginspecial 0 @llx -154 @lly 310
@urx 0 @ury 3100 @rwi @setspecial
%%BeginDocument: images/fig72.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -154 310 0
%%HiResBoundingBox: 0.0 -154.0 310.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
16.500150680541992 -18.500150680541992 moveto
14.500150044759115 -18.500150680541992 13.500149726867676 -19.833484013875324 13.500149726867676 -22.500150680541992 curveto
13.500149726867676 -29.500150680541992 lineto
13.500149726867676 -31.500149408976238 14.500150044759115 -32.50014877319336 16.500150680541992 -32.50014877319336 curveto
111.50015258789062 -32.50014877319336 lineto
111.50015258789062 -32.50014877319336 lineto
112.83348592122395 -32.50014877319336 113.50015258789062 -31.500149408976238 113.50015258789062 -29.500150680541992 curveto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -22.500150680541992 lineto
113.50015258789062 -19.833484013875324 112.83348592122395 -18.500150680541992 111.50015258789062 -18.500150680541992 curveto
16.500150680541992 -18.500150680541992 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -46.50014877319336 moveto
23.500150680541992 -60.50014877319336 lineto
93.50015258789062 -60.50014877319336 lineto
93.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -81.50015258789062 moveto
23.500150680541992 -95.50015258789062 lineto
93.50015258789062 -95.50015258789062 lineto
93.50015258789062 -81.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
23.500150680541992 -116.50015258789062 moveto
23.500150680541992 -130.50015258789062 lineto
93.50015258789062 -130.50015258789062 lineto
93.50015258789062 -116.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -46.50014877319336 moveto
199.50015258789062 -46.50014877319336 198.50015258789062 -47.833482106526695 198.50015258789062 -50.50014877319336 curveto
198.50015258789062 -57.50014877319336 lineto
198.50015258789062 -59.50014877319336 199.50015258789062 -60.50014877319336 201.50015258789062 -60.50014877319336 curveto
296.5001525878906 -60.50014877319336 lineto
296.5001525878906 -60.50014877319336 lineto
297.83348592122394 -60.50014877319336 298.5001525878906 -59.50014877319336 298.5001525878906 -57.50014877319336 curveto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -50.50014877319336 lineto
298.5001525878906 -47.833482106526695 297.83348592122394 -46.50014877319336 296.5001525878906 -46.50014877319336 curveto
201.50015258789062 -46.50014877319336 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -81.50015258789062 moveto
199.50015258789062 -81.50015258789062 198.50015258789062 -82.83348592122395 198.50015258789062 -85.50015258789062 curveto
198.50015258789062 -92.50015258789062 lineto
198.50015258789062 -94.50015258789062 199.50015258789062 -95.50015258789062 201.50015258789062 -95.50015258789062 curveto
296.5001525878906 -95.50015258789062 lineto
296.5001525878906 -95.50015258789062 lineto
297.83348592122394 -95.50015258789062 298.5001525878906 -94.50015258789062 298.5001525878906 -92.50015258789062 curveto
298.5001525878906 -85.50015258789062 lineto
298.5001525878906 -85.50015258789062 lineto
298.5001525878906 -82.83348592122395 297.83348592122394 -81.50015258789062 296.5001525878906 -81.50015258789062 curveto
201.50015258789062 -81.50015258789062 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
201.50015258789062 -116.50015258789062 moveto
199.50015258789062 -116.50015258789062 198.50015258789062 -117.83348592122395 198.50015258789062 -120.50015258789062 curveto
198.50015258789062 -127.50015258789062 lineto
198.50015258789062 -129.50015258789062 199.50015258789062 -130.50015258789062 201.50015258789062 -130.50015258789062 curveto
296.5001525878906 -130.50015258789062 lineto
296.5001525878906 -130.50015258789062 lineto
297.83348592122394 -130.50015258789062 298.5001525878906 -129.50015258789062 298.5001525878906 -127.50015258789062 curveto
298.5001525878906 -120.50015258789062 lineto
298.5001525878906 -120.50015258789062 lineto
298.5001525878906 -117.83348592122395 297.83348592122394 -116.50015258789062 296.5001525878906 -116.50015258789062 curveto
201.50015258789062 -116.50015258789062 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.5 setlinewidth
1 setlinecap
[] 0 setdash
newpath
15.0 -17.0 moveto
13.0 -17.0 12.0 -18.333333333333332 12.0 -21.0 curveto
12.0 -28.0 lineto
12.0 -30.0 13.0 -31.0 15.0 -31.0 curveto
110.0 -31.0 lineto
110.0 -31.0 lineto
111.33333333333333 -31.0 112.0 -30.0 112.0 -28.0 curveto
112.0 -21.0 lineto
112.0 -21.0 lineto
112.0 -18.333333333333332 111.33333333333333 -17.0 110.0 -17.0 curveto
15.0 -17.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -45.0 moveto
22.0 -59.0 lineto
92.0 -59.0 lineto
92.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -80.0 moveto
22.0 -94.0 lineto
92.0 -94.0 lineto
92.0 -80.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -80.0 moveto
22.0 -94.0 lineto
92.0 -94.0 lineto
92.0 -80.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -115.0 moveto
22.0 -129.0 lineto
92.0 -129.0 lineto
92.0 -115.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
22.0 -115.0 moveto
22.0 -129.0 lineto
92.0 -129.0 lineto
92.0 -115.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -45.0 moveto
198.0 -45.0 197.0 -46.333333333333336 197.0 -49.0 curveto
197.0 -56.0 lineto
197.0 -58.0 198.0 -59.0 200.0 -59.0 curveto
295.0 -59.0 lineto
295.0 -59.0 lineto
296.3333333333333 -59.0 297.0 -58.0 297.0 -56.0 curveto
297.0 -49.0 lineto
297.0 -49.0 lineto
297.0 -46.333333333333336 296.3333333333333 -45.0 295.0 -45.0 curveto
200.0 -45.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -80.0 moveto
198.0 -80.0 197.0 -81.33333333333333 197.0 -84.0 curveto
197.0 -91.0 lineto
197.0 -93.0 198.0 -94.0 200.0 -94.0 curveto
295.0 -94.0 lineto
295.0 -94.0 lineto
296.3333333333333 -94.0 297.0 -93.0 297.0 -91.0 curveto
297.0 -84.0 lineto
297.0 -84.0 lineto
297.0 -81.33333333333333 296.3333333333333 -80.0 295.0 -80.0 curveto
200.0 -80.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -80.0 moveto
198.0 -80.0 197.0 -81.33333333333333 197.0 -84.0 curveto
197.0 -91.0 lineto
197.0 -93.0 198.0 -94.0 200.0 -94.0 curveto
295.0 -94.0 lineto
295.0 -94.0 lineto
296.3333333333333 -94.0 297.0 -93.0 297.0 -91.0 curveto
297.0 -84.0 lineto
297.0 -84.0 lineto
297.0 -81.33333333333333 296.3333333333333 -80.0 295.0 -80.0 curveto
200.0 -80.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
200.0 -115.0 moveto
198.0 -115.0 197.0 -116.33333333333333 197.0 -119.0 curveto
197.0 -126.0 lineto
197.0 -128.0 198.0 -129.0 200.0 -129.0 curveto
295.0 -129.0 lineto
295.0 -129.0 lineto
296.3333333333333 -129.0 297.0 -128.0 297.0 -126.0 curveto
297.0 -119.0 lineto
297.0 -119.0 lineto
297.0 -116.33333333333333 296.3333333333333 -115.0 295.0 -115.0 curveto
200.0 -115.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
200.0 -115.0 moveto
198.0 -115.0 197.0 -116.33333333333333 197.0 -119.0 curveto
197.0 -126.0 lineto
197.0 -128.0 198.0 -129.0 200.0 -129.0 curveto
295.0 -129.0 lineto
295.0 -129.0 lineto
296.3333333333333 -129.0 297.0 -128.0 297.0 -126.0 curveto
297.0 -119.0 lineto
297.0 -119.0 lineto
297.0 -116.33333333333333 296.3333333333333 -115.0 295.0 -115.0 curveto
200.0 -115.0 lineto
closepath
stroke
newpath
95.0 -52.0 moveto
192.0 -52.0 lineto
stroke
newpath
95.0 -87.0 moveto
192.0 -87.0 lineto
stroke
newpath
150.0 -101.0 moveto
154.0 -101.0 lineto
stroke
newpath
95.0 -122.0 moveto
192.0 -122.0 lineto
stroke
newpath
22.0 -35.0 moveto
22.0 -45.0 lineto
stroke
newpath
22.0 -59.0 moveto
22.0 -80.0 lineto
stroke
newpath
22.0 -94.0 moveto
22.0 -115.0 lineto
stroke
newpath
190.0 -49.0 moveto
195.0 -52.0 lineto
190.0 -56.0 lineto
closepath
fill
newpath
190.0 -84.0 moveto
195.0 -87.0 lineto
190.0 -91.0 lineto
closepath
fill
newpath
190.0 -119.0 moveto
195.0 -122.0 lineto
190.0 -126.0 lineto
closepath
fill
/Helvetica findfont
7 scalefont setfont
20.0 -28.0 moveto
(Ready) show
30.0 -56.0 moveto
(ICANHAZ) show
205.0 -56.0 moveto
(Ready) show
105.0 -70.0 moveto
(Send CHEEZBURGER) show
31.0 -90.0 moveto
(HUGZ) show
205.0 -91.0 moveto
(Ready) show
106.0 -105.0 moveto
(Send HUGZ OK) show
33.0 -126.0 moveto
(heartbeat) show
205.0 -126.0 moveto
(Ready) show
105.0 -140.0 moveto
(Send HUGZ) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1497 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1497 a 274 x Fk(There)h(are)g(a)g(fe)n(w)g
(more)g(things)g(about)f(this)i(state)f(machine)g(model)f(that)h(are)g
(w)o(orth)g(kno)n(wing:)-2 1789 y
SDict begin H.S end
 -2 1789 a -2 1789 a
SDict begin 13 H.A end

-2 1789 a -2 1789 a
SDict begin [/View [/XYZ H.V]/Dest (0:4388) cvn /DEST pdfmark end
 -2 1789 a -2 1799 a
SDict begin H.S end
 -2 1799 a -2
1799 a
SDict begin 13 H.A end
 -2 1799 a -2 1799 a
SDict begin [/View [/XYZ H.V]/Dest (0:4389) cvn /DEST pdfmark end
 -2 1799 a Black 396 1941 a
Fj(\225)p Black 479 1941 a
SDict begin H.S end
 479 1941 a 479 1941 a
SDict begin 13 H.A end
 479
1941 a 479 1941 a
SDict begin [/View [/XYZ H.V]/Dest (0:4390) cvn /DEST pdfmark end
 479 1941 a Fk(Ev)o(ents)g(in)g(upper)f(case)i(\(lik)o
(e)f("HUGZ"\))f(are)h('e)o(xternal)f(e)n(v)o(ents')g(that)i(come)e
(from)g(the)h(client)h(as)g(messages.)-2 1959 y
SDict begin H.S end
 -2 1959
a -2 1959 a
SDict begin 13 H.A end
 -2 1959 a -2 1959 a
SDict begin [/View [/XYZ H.V]/Dest (0:4391) cvn /DEST pdfmark end
 -2 1959 a Black 396 2091
a Fj(\225)p Black 479 2091 a
SDict begin H.S end
 479 2091 a 479 2091 a
SDict begin 13 H.A end
 479
2091 a 479 2091 a
SDict begin [/View [/XYZ H.V]/Dest (0:4392) cvn /DEST pdfmark end
 479 2091 a Fk(Ev)o(ents)f(in)g(lo)n(wer)g(case)g
(\(lik)o(e)h("heartbeat"\))d(are)i('internal)f(e)n(v)o(ents',)g
(produced)f(by)i(code)f(in)h(the)h(serv)o(er)-5 b(.)-2
2109 y
SDict begin H.S end
 -2 2109 a -2 2109 a
SDict begin 13 H.A end
 -2 2109 a -2 2109 a
SDict begin [/View [/XYZ H.V]/Dest (0:4393) cvn /DEST pdfmark end
 -2 2109
a Black 396 2240 a Fj(\225)p Black 479 2240 a
SDict begin H.S end
 479 2240
a 479 2240 a
SDict begin 13 H.A end
 479 2240 a 479 2240 a
SDict begin [/View [/XYZ H.V]/Dest (0:4394) cvn /DEST pdfmark end
 479 2240 a Fk(The)20
b("Send)g(SOMETHING")f(actions)h(are)g(shorthand)f(for)g(sending)g(a)i
(speci\002c)f(reply)f(back)h(to)g(the)h(client.)-2 2258
y
SDict begin H.S end
 -2 2258 a -2 2258 a
SDict begin 13 H.A end
 -2 2258 a -2 2258 a
SDict begin [/View [/XYZ H.V]/Dest (0:4395) cvn /DEST pdfmark end
 -2 2258 a Black
396 2390 a Fj(\225)p Black 479 2390 a
SDict begin H.S end
 479 2390 a 479
2390 a
SDict begin 13 H.A end
 479 2390 a 479 2390 a
SDict begin [/View [/XYZ H.V]/Dest (0:4396) cvn /DEST pdfmark end
 479 2390 a Fk(Ev)o(ents)f(that)g(aren')o
(t)f(de\002ned)g(in)h(a)h(particular)e(state)i(are)f(silently)g
(ignored.)-2 2574 y
SDict begin H.S end
 -2 2574 a -2 2574 a
SDict begin 13 H.A end
 -2 2574 a -2
2574 a
SDict begin [/View [/XYZ H.V]/Dest (0:4397) cvn /DEST pdfmark end
 -2 2574 a 396 2664 a Fk(No)n(w)-5 b(,)20 b(the)g(original)f
(source)g(for)h(these)g(pretty)g(pictures)f(is)i(an)g(XML)f(model:)-2
2765 y
SDict begin H.S end
 -2 2765 a -2 2765 a
SDict begin 11.7 H.A end
 -2 2765 a -2 2765 a
SDict begin [/View [/XYZ H.V]/Dest (0:4398) cvn /DEST pdfmark end
 -2 2765
a 396 2844 a Fe(<class)44 b(name)g(=)h("nom_server")e(script)h(=)g
("server_c">)396 3038 y(<state)g(name)g(=)h("start">)576
3135 y(<event)e(name)i(=)f("OHAI")g(next)g(=)h("authenticated">)755
3232 y(<action)f(name)g(=)g("check)g(credentials")f(/>)576
3329 y(</event>)396 3427 y(</state>)396 3621 y(<state)h(name)g(=)h
("authenticated">)576 3718 y(<event)e(name)i(=)f("ok")g(next)h(=)f
("ready">)755 3815 y(<action)g(name)g(=)g("send")g(message)g
(="OHAI-OK")f(/>)576 3912 y(</event>)576 4009 y(<event)g(name)i(=)f
("error")g(next)g(=)h("start">)755 4107 y(<action)f(name)g(=)g("send")g
(message)g(=)h("WTF")f(/>)576 4204 y(</event>)396 4301
y(</state>)396 4495 y(<state)g(name)g(=)h("ready">)576
4592 y(<event)e(name)i(=)f("ICANHAZ">)755 4689 y(<action)g(name)g(=)g
("send")g(message)g(=)h("CHEEZBURGER")d(/>)576 4787 y(</event>)576
4884 y(<event)h(name)i(=)f("HUGZ">)755 4981 y(<action)g(name)g(=)g
("send")g(message)g(=)h("HUGZ-OK")e(/>)576 5078 y(</event>)p
Black 3759 5569 a Ff(361)p Black eop end
%%Page: 362 375
TeXDict begin 362 374 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.362) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(<event)43 b(name)i(=)f("heartbeat">)755
170 y(<action)g(name)g(=)g("send")g(message)g(=)h("HUGZ")e(/>)576
267 y(</event>)396 364 y(</state>)396 461 y(</class>)-2
633 y
SDict begin H.S end
 -2 633 a -2 633 a
SDict begin 13 H.A end
 -2 633 a -2 633 a
SDict begin [/View [/XYZ H.V]/Dest (0:4399) cvn /DEST pdfmark end
 -2 633 a 396
735 a Fk(The)20 b(code)g(generator)e(is)j(in)f(e)o
(xamples/Chapter6/serv)o(er_c.gsl.)15 b(It)21 b(is)g(a)g(f)o(airly)e
(complete)g(tool)h(that)h(I')o(ll)f(use)g(and)396 843
y(e)o(xpand)f(for)g(more)g(serious)h(w)o(ork)g(later)-5
b(.)20 b(It)h(generates:)-2 861 y
SDict begin H.S end
 -2 861 a -2 861 a
SDict begin 13 H.A end
 -2
861 a -2 861 a
SDict begin [/View [/XYZ H.V]/Dest (0:4400) cvn /DEST pdfmark end
 -2 861 a -2 871 a
SDict begin H.S end
 -2 871 a -2 871 a
SDict begin 13 H.A end
 -2
871 a -2 871 a
SDict begin [/View [/XYZ H.V]/Dest (0:4401) cvn /DEST pdfmark end
 -2 871 a Black 396 1013 a Fj(\225)p Black
479 1013 a
SDict begin H.S end
 479 1013 a 479 1013 a
SDict begin 13 H.A end
 479 1013 a 479 1013
a
SDict begin [/View [/XYZ H.V]/Dest (0:4402) cvn /DEST pdfmark end
 479 1013 a Fk(A)g(serv)o(er)e(class)i(in)g(C)g(\(nom_serv)o(er)-5
b(.c,)17 b(nom_serv)o(er)-5 b(.h\))17 b(that)j(implements)f(the)h
(whole)g(protocol)e(\003o)n(w)-5 b(.)-2 1031 y
SDict begin H.S end
 -2 1031
a -2 1031 a
SDict begin 13 H.A end
 -2 1031 a -2 1031 a
SDict begin [/View [/XYZ H.V]/Dest (0:4403) cvn /DEST pdfmark end
 -2 1031 a Black 396 1163
a Fj(\225)p Black 479 1163 a
SDict begin H.S end
 479 1163 a 479 1163 a
SDict begin 13 H.A end
 479
1163 a 479 1163 a
SDict begin [/View [/XYZ H.V]/Dest (0:4404) cvn /DEST pdfmark end
 479 1163 a Fk(A)21 b(selftest)g(method)e(that)h(runs)
g(the)g(selftest)h(steps)g(listed)f(in)h(the)f(XML)g(\002le.)-2
1181 y
SDict begin H.S end
 -2 1181 a -2 1181 a
SDict begin 13 H.A end
 -2 1181 a -2 1181 a
SDict begin [/View [/XYZ H.V]/Dest (0:4405) cvn /DEST pdfmark end
 -2 1181
a Black 396 1312 a Fj(\225)p Black 479 1312 a
SDict begin H.S end
 479 1312
a 479 1312 a
SDict begin 13 H.A end
 479 1312 a 479 1312 a
SDict begin [/View [/XYZ H.V]/Dest (0:4406) cvn /DEST pdfmark end
 479 1312 a Fk(Documentation)e(in)i
(the)h(form)e(of)h(graphics)f(\(the)g(pretty)h(pictures\).)-2
1496 y
SDict begin H.S end
 -2 1496 a -2 1496 a
SDict begin 13 H.A end
 -2 1496 a -2 1496 a
SDict begin [/View [/XYZ H.V]/Dest (0:4407) cvn /DEST pdfmark end
 -2 1496
a 396 1586 a Fk(Here')-5 b(s)21 b(a)f(simple)g(C)i(main)d(program)f
(that)j(starts)g(the)f(generated)e(NOM)j(serv)o(er:)-2
1687 y
SDict begin H.S end
 -2 1687 a -2 1687 a
SDict begin 11.7 H.A end
 -2 1687 a -2 1687 a
SDict begin [/View [/XYZ H.V]/Dest (0:4408) cvn /DEST pdfmark end
 -2 1687
a 396 1766 a Fe(#include)44 b("czmq.h")396 1863 y(#include)g
("nom_server.h")396 2058 y(int)h(main)f(\(int)g(argc,)g(char)1517
2071 y(*)1562 2058 y(argv)g([]\))396 2155 y({)576 2252
y(printf)f(\("Starting)h(NOM)g(protocol)f(server)h(on)h(port)f
(6000...\\n"\);)576 2349 y(nom_server_t)1158 2362 y(*)1203
2349 y(server)g(=)h(nom_server_new)d(\(\);)576 2446 y(nom_server_bind)g
(\(server,)h("tcp://)2011 2459 y(*)2056 2446 y(:6000"\);)576
2543 y(nom_server_wait)f(\(server\);)576 2640 y(nom_server_destroy)f
(\(&server\);)576 2737 y(return)i(0;)396 2835 y(})-2
3009 y
SDict begin H.S end
 -2 3009 a -2 3009 a
SDict begin 13 H.A end
 -2 3009 a -2 3009 a
SDict begin [/View [/XYZ H.V]/Dest (0:4409) cvn /DEST pdfmark end
 -2 3009
a 396 3109 a Fk(The)20 b(generated)f(nom_serv)o(er)e(class)k(is)g(a)g
(f)o(airly)f(classic)h(model.)e(It)h(accepts)g(client)h(messages)f(on)g
(a)g(R)m(OUTER)396 3217 y(sock)o(et.)g(The)g(\002rst)h(frame)e(on)h(e)n
(v)o(ery)f(request)g(is)i(the)g(client')-5 b(s)20 b(identity)-5
b(.)19 b(The)h(serv)o(er)f(manages)h(a)g(set)h(of)f(clients,)g(each)396
3324 y(with)h(state.)f(As)h(messages)g(arri)n(v)o(e,)d(it)j(feeds)f
(these)h(as)g('e)n(v)o(ents')d(to)j(the)f(state)h(machine.)e(Here')-5
b(s)20 b(the)g(core)g(of)g(the)g(state)396 3432 y(machine,)f(as)i(a)g
(mix)f(of)f(GSL)i(commands)d(and)i(the)g(C)h(code)f(we)h(intend)e(to)h
(generate:)-2 3533 y
SDict begin H.S end
 -2 3533 a -2 3533 a
SDict begin 11.7 H.A end
 -2 3533 a -2
3533 a
SDict begin [/View [/XYZ H.V]/Dest (0:4410) cvn /DEST pdfmark end
 -2 3533 a 396 3613 a Fe(client_execute)43 b(\(client_t)1517
3626 y(*)1562 3613 y(self,)h(int)g(event\))396 3710 y({)576
3807 y(self->next_event)e(=)i(event;)576 3904 y(while)g
(\(self->next_event\))d({)755 4001 y(self->event)i(=)i
(self->next_event;)755 4098 y(self->next_event)d(=)j(0;)755
4195 y(switch)f(\(self->state\))e({)396 4292 y(.for)i(class.state)934
4390 y(case)g($\(name:c\)_state:)396 4487 y(.)135 b(for)44
b(event)396 4584 y(.)314 b(if)44 b(index)g(\(\))h(>)g(1)1114
4681 y(else)396 4778 y(.)314 b(endif)1114 4875 y(if)44
b(\(self->event)f(==)h($\(name:c\)_event\))f({)396 4972
y(.)314 b(for)44 b(action)396 5070 y(.)493 b(if)45 b(name)f(=)h("send")
1293 5167 y(zmsg_addstr)e(\(self->reply,)g("$\(message:\)"\);)p
Black 3759 5569 a Ff(362)p Black eop end
%%Page: 363 376
TeXDict begin 363 375 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.363) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(.)493 b(else)1114 170 y($\(name:c\)_action)42
b(\(self\);)396 267 y(.)493 b(endif)396 364 y(.)314 b(endfor)396
461 y(.)g(if)44 b(defined)g(\(event.next\))1293 558 y(self->state)f(=)i
($\(next:c\)_state;)396 655 y(.)314 b(endif)1114 752
y(})396 850 y(.)135 b(endfor)1114 947 y(break;)396 1044
y(.endfor)755 1141 y(})755 1238 y(if)44 b(\(zmsg_size)g
(\(self->reply\))e(>)j(1\))f({)934 1335 y(zmsg_send)g(\(&self->reply,)e
(self->router\);)934 1432 y(self->reply)h(=)i(zmsg_new)e(\(\);)934
1530 y(zmsg_add)h(\(self->reply,)e(zframe_dup)i(\(self->address\)\);)
755 1627 y(})576 1724 y(})396 1821 y(})-2 1995 y
SDict begin H.S end
 -2 1995
a -2 1995 a
SDict begin 13 H.A end
 -2 1995 a -2 1995 a
SDict begin [/View [/XYZ H.V]/Dest (0:4411) cvn /DEST pdfmark end
 -2 1995 a 396 2095 a
Fk(Each)20 b(client)g(is)h(held)f(as)h(an)f(object)g(with)g(v)n(arious)
f(properties,)g(including)f(the)i(v)n(ariables)g(we)g(need)g(to)g
(represent)f(a)396 2203 y(state)i(machine)e(instance:)-2
2287 y
SDict begin H.S end
 -2 2287 a -2 2287 a
SDict begin 11.7 H.A end
 -2 2287 a -2 2287 a
SDict begin [/View [/XYZ H.V]/Dest (0:4412) cvn /DEST pdfmark end
 -2 2287
a 396 2383 a Fe(event_t)44 b(next_event;)402 b(//)89
b(Next)44 b(event)396 2480 y(state_t)g(state;)627 b(//)89
b(Current)44 b(state)396 2577 y(event_t)g(event;)627
b(//)89 b(Current)44 b(event)-2 2753 y
SDict begin H.S end
 -2 2753 a -2 2753
a
SDict begin 13 H.A end
 -2 2753 a -2 2753 a
SDict begin [/View [/XYZ H.V]/Dest (0:4413) cvn /DEST pdfmark end
 -2 2753 a 396 2851 a Fk(Y)-9 b(ou)19
b(will)i(see)f(by)f(no)n(w)g(that)h(we)g(are)g(generating)e
(technically-perfect)e(code)j(that)h(has)g(the)g(precise)f(design)g
(and)g(shape)396 2959 y(we)i(w)o(ant.)f(The)g(only)f(clue)h(that)g(the)
h(nom_serv)o(er)c(class)k(isn')o(t)f(hand-written)e(is)j(that)g(the)f
(code)f(is)3263 2959 y
SDict begin H.S end
 3263 2959 a 3263 2959 a
SDict begin 13 H.A end
 3263 2959
a 3263 2959 a
SDict begin [/View [/XYZ H.V]/Dest (0:4414) cvn /DEST pdfmark end
 3263 2959 a Ff(too)h(good)r Fk(.)f(People)396
3067 y(who)h(complain)f(that)h(code)g(generators)e(produce)g(poor)h
(code)h(are)g(ob)o(viously)e(used)i(to)g(poor)f(code)h(generators.)e
(It)i(is)396 3175 y(tri)n(vial)g(to)h(e)o(xtend)d(our)i(model)f(as)i
(we)g(need)e(it.)i(F)o(or)f(e)o(xample,)e(here')-5 b(s)20
b(ho)n(w)g(we)g(generate)f(the)i(selftest)g(code.)-2
3359 y
SDict begin H.S end
 -2 3359 a -2 3359 a
SDict begin 13 H.A end
 -2 3359 a -2 3359 a
SDict begin [/View [/XYZ H.V]/Dest (0:4415) cvn /DEST pdfmark end
 -2 3359
a 396 3449 a Fk(First,)g(we)g(add)e(a)i("selftest")g(item)f(to)g(the)g
(state)h(machine)e(and)h(write)g(our)g(tests.)h(W)-7
b(e')l(re)20 b(not)g(using)g(an)o(y)f(XML)396 3557 y(grammar)g(or)h(v)n
(alidators)f(so)h(it)h(really)f(is)h(just)g(a)f(matter)g(of)g(opening)f
(the)h(editor)f(and)h(adding)f(half-a-dozen)e(lines)j(of)396
3665 y(te)o(xt:)-2 3749 y
SDict begin H.S end
 -2 3749 a -2 3749 a
SDict begin 11.7 H.A end
 -2 3749
a -2 3749 a
SDict begin [/View [/XYZ H.V]/Dest (0:4416) cvn /DEST pdfmark end
 -2 3749 a 396 3845 a Fe(<selftest>)576 3942
y(<step)44 b(send)g(=)g("OHAI")g(body)g(=)h("Sleepy")f(recv)g(=)g
("WTF")g(/>)576 4039 y(<step)g(send)g(=)g("OHAI")g(body)g(=)h("Joe")f
(recv)g(=)h("OHAI-OK")e(/>)576 4136 y(<step)h(send)g(=)g("ICANHAZ")g
(recv)g(=)h("CHEEZBURGER")d(/>)576 4234 y(<step)i(send)g(=)g("HUGZ")g
(recv)g(=)h("HUGZ-OK")e(/>)576 4331 y(<step)h(recv)g(=)g("HUGZ")g(/>)
396 4428 y(</selftest>)-2 4600 y
SDict begin H.S end
 -2 4600 a -2 4600 a
SDict begin 13 H.A end

-2 4600 a -2 4600 a
SDict begin [/View [/XYZ H.V]/Dest (0:4417) cvn /DEST pdfmark end
 -2 4600 a 396 4702 a Fk(Designing)19
b(on)h(the)g(\003y)-5 b(,)20 b(I)g(decided)f(that)i("send")e(and)h
("recv")f(were)h(a)h(nice)f(w)o(ay)g(to)h(e)o(xpress)e("send)h(this)h
(request,)e(then)396 4810 y(e)o(xpect)g(this)i(reply".)e(Here')-5
b(s)21 b(the)f(GSL)g(code)g(that)g(turns)g(this)h(model)e(into)h(real)g
(code:)-2 4911 y
SDict begin H.S end
 -2 4911 a -2 4911 a
SDict begin 11.7 H.A end
 -2 4911 a -2 4911
a
SDict begin [/View [/XYZ H.V]/Dest (0:4418) cvn /DEST pdfmark end
 -2 4911 a 396 4990 a Fe(.for)44 b(class->selftest.step)396
5087 y(.)135 b(if)44 b(defined)g(\(send\))p Black 3759
5569 a Ff(363)p Black eop end
%%Page: 364 377
TeXDict begin 364 376 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.364) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4426) cvn /DEST pdfmark end
 -2 -201 a 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(msg)44 b(=)h(zmsg_new)e(\(\);)576 170
y(zmsg_addstr)g(\(msg,)h("$\(send:\)"\);)396 267 y(.)314
b(if)44 b(defined)g(\(body\))576 364 y(zmsg_addstr)f(\(msg,)h
("$\(body:\)"\);)396 461 y(.)314 b(endif)576 558 y(zmsg_send)43
b(\(&msg,)h(dealer\);)396 752 y(.)135 b(endif)396 850
y(.)g(if)44 b(defined)g(\(recv\))576 947 y(msg)g(=)h(zmsg_recv)e
(\(dealer\);)576 1044 y(assert)g(\(msg\);)576 1141 y(command)g(=)i
(zmsg_popstr)e(\(msg\);)576 1238 y(assert)g(\(streq)h(\(command,)g
("$\(recv:\)"\)\);)576 1335 y(free)g(\(command\);)576
1432 y(zmsg_destroy)e(\(&msg\);)396 1627 y(.)135 b(endif)396
1724 y(.endfor)-2 1891 y
SDict begin H.S end
 -2 1891 a -2 1891 a
SDict begin 13 H.A end
 -2 1891
a -2 1891 a
SDict begin [/View [/XYZ H.V]/Dest (0:4419) cvn /DEST pdfmark end
 -2 1891 a 396 1998 a Fk(Finally)-5 b(,)20
b(one)f(of)h(the)g(more)g(trick)o(y)f(b)n(ut)h(absolutely)f(essential)i
(parts)f(of)g(an)o(y)f(state)i(machine)e(generator)g(is)3516
1998 y
SDict begin H.S end
 3516 1998 a 3516 1998 a
SDict begin 13 H.A end
 3516 1998 a 3516 1998
a
SDict begin [/View [/XYZ H.V]/Dest (0:4420) cvn /DEST pdfmark end
 3516 1998 a Ff(how)h(do)g(I)396 2106 y(plug)g(this)g(into)g(my)h(own)
f(code?)f Fk(As)i(a)g(minimal)e(e)o(xample)g(for)h(this)g(e)o(x)o
(ercise)f(I)i(w)o(anted)f(to)g(implement)f(the)h("check)396
2214 y(credentials")g(action)f(by)h(accepting)f(all)i(OHAIs)f(from)f
(my)h(friend)f(Joe)i(\(Hi)f(Joe!\))g(and)f(reject)i(e)n(v)o(eryone)c
(else')-5 b(s)396 2322 y(OHAIs.)21 b(After)e(some)h(thought)f(I)h
(decided)f(to)i(grab)e(code)g(directly)h(from)f(the)h(state)h(machine)e
(model.)g(So)i(in)396 2429 y(nom_serv)o(er)-5 b(.xml,)17
b(you')o(ll)i(see)i(this:)-2 2530 y
SDict begin H.S end
 -2 2530 a -2 2530
a
SDict begin 11.7 H.A end
 -2 2530 a -2 2530 a
SDict begin [/View [/XYZ H.V]/Dest (0:4421) cvn /DEST pdfmark end
 -2 2530 a 396 2610 a Fe(<action)44
b(name)g(=)h("check)f(credentials">)576 2707 y(char)800
2720 y(*)845 2707 y(body)g(=)g(zmsg_popstr)f(\(self->request\);)576
2804 y(if)h(\(body)g(&&)h(streq)f(\(body,)f("Joe"\)\))755
2901 y(self->next_event)f(=)j(ok_event;)576 2998 y(else)755
3095 y(self->next_event)d(=)j(error_event;)576 3192 y(free)f(\(body\);)
396 3290 y(</action>)-2 3462 y
SDict begin H.S end
 -2 3462 a -2 3462 a
SDict begin 13 H.A end
 -2
3462 a -2 3462 a
SDict begin [/View [/XYZ H.V]/Dest (0:4422) cvn /DEST pdfmark end
 -2 3462 a 396 3564 a Fk(And)20 b(the)g(code)g
(generator)e(grabs)i(that)g(custom)f(code)h(and)g(inserts)g(it)h(into)f
(the)g(generated)f(nom_serv)o(er)-5 b(.c)17 b(\002le:)-2
3665 y
SDict begin H.S end
 -2 3665 a -2 3665 a
SDict begin 11.7 H.A end
 -2 3665 a -2 3665 a
SDict begin [/View [/XYZ H.V]/Dest (0:4423) cvn /DEST pdfmark end
 -2 3665
a 396 3744 a Fe(.for)44 b(class.action)396 3841 y(static)g(void)396
3938 y($\(name:c\)_action)e(\(client_t)1607 3951 y(*)1652
3938 y(self\))i({)396 4035 y($\(string.trim)f(\(.\):\))396
4132 y(})396 4229 y(.endfor)-2 4397 y
SDict begin H.S end
 -2 4397 a -2 4397
a
SDict begin 13 H.A end
 -2 4397 a -2 4397 a
SDict begin [/View [/XYZ H.V]/Dest (0:4424) cvn /DEST pdfmark end
 -2 4397 a 396 4503 a Fk(And)20
b(no)n(w)g(we)g(ha)n(v)o(e)g(something)e(quite)i(ele)o(gant:)f(a)i
(single)f(source)f(\002le)i(that)g(describes)e(my)h(serv)o(er)f(state)i
(machine,)396 4611 y(and)f(which)g(also)g(contains)g(the)g(nati)n(v)o
(e)f(implementations)f(for)i(my)g(actions.)f(A)i(nice)f(mix)g(of)g
(high-le)n(v)o(el)e(and)396 4719 y(lo)n(w-le)n(v)o(el)h(that)h(is)i
(about)d(90\045)h(smaller)g(than)g(the)g(C)h(code.)p
Black 3759 5569 a Ff(364)p Black eop end
%%Page: 365 378
TeXDict begin 365 377 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.365) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4425) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Be)n(w)o(are,)h(as)h(your)e(head)h(spins)g(with)h
(notions)e(of)h(all)h(the)f(amazing)f(things)g(you)h(could)f(produce)f
(with)j(such)e(le)n(v)o(erage.)396 180 y(While)i(this)g(approach)d(gi)n
(v)o(es)h(you)h(real)g(po)n(wer)m(,)e(it)j(also)g(mo)o(v)o(es)e(you)g
(a)o(w)o(ay)h(from)f(your)g(peers,)h(and)f(if)i(you)e(go)h(too)g(f)o
(ar)m(,)396 288 y(you')o(ll)g(\002nd)f(yourself)g(w)o(orking)g(alone.)
396 562 y(By)i(the)f(w)o(ay)-5 b(,)20 b(this)g(simple)h(little)g(state)
g(machine)e(design)g(e)o(xposes)g(just)i(three)f(v)n(ariables)f(to)i
(our)e(custom)h(code:)-2 580 y
SDict begin H.S end
 -2 580 a -2 580 a
SDict begin 13 H.A end
 -2 580
a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:4427) cvn /DEST pdfmark end
 -2 580 a -2 590 a
SDict begin H.S end
 -2 590 a -2 590 a
SDict begin 13 H.A end
 -2 590
a -2 590 a
SDict begin [/View [/XYZ H.V]/Dest (0:4428) cvn /DEST pdfmark end
 -2 590 a Black 396 733 a Fj(\225)p Black 479
733 a
SDict begin H.S end
 479 733 a 479 733 a
SDict begin 13 H.A end
 479 733 a 479 733 a
SDict begin [/View [/XYZ H.V]/Dest (0:4429) cvn /DEST pdfmark end
 479 733
a 479 733 a
SDict begin H.S end
 479 733 a 479 733 a
SDict begin 13 H.A end
 479 733 a 479 733 a
SDict begin [/View [/XYZ H.V]/Dest (0:4430) cvn /DEST pdfmark end
 479
733 a Fe(self->next_event)-2 743 y
SDict begin H.S end
 -2 743 a -2 743 a
SDict begin 13 H.A end

-2 743 a -2 743 a
SDict begin [/View [/XYZ H.V]/Dest (0:4431) cvn /DEST pdfmark end
 -2 743 a Black 396 882 a Fj(\225)p
Black 479 882 a
SDict begin H.S end
 479 882 a 479 882 a
SDict begin 13 H.A end
 479 882 a 479 882
a
SDict begin [/View [/XYZ H.V]/Dest (0:4432) cvn /DEST pdfmark end
 479 882 a 479 882 a
SDict begin H.S end
 479 882 a 479 882 a
SDict begin 13 H.A end
 479 882 a 479
882 a
SDict begin [/View [/XYZ H.V]/Dest (0:4433) cvn /DEST pdfmark end
 479 882 a Fe(self->request)-2 894 y
SDict begin H.S end
 -2 894 a -2
894 a
SDict begin 13 H.A end
 -2 894 a -2 894 a
SDict begin [/View [/XYZ H.V]/Dest (0:4434) cvn /DEST pdfmark end
 -2 894 a Black 396 1031 a Fj(\225)p
Black 479 1031 a
SDict begin H.S end
 479 1031 a 479 1031 a
SDict begin 13 H.A end
 479 1031 a 479
1031 a
SDict begin [/View [/XYZ H.V]/Dest (0:4435) cvn /DEST pdfmark end
 479 1031 a 479 1031 a
SDict begin H.S end
 479 1031 a 479 1031 a
SDict begin 13 H.A end
 479
1031 a 479 1031 a
SDict begin [/View [/XYZ H.V]/Dest (0:4436) cvn /DEST pdfmark end
 479 1031 a Fe(self->reply)-2 1209 y
SDict begin H.S end

-2 1209 a -2 1209 a
SDict begin 13 H.A end
 -2 1209 a -2 1209 a
SDict begin [/View [/XYZ H.V]/Dest (0:4437) cvn /DEST pdfmark end
 -2 1209 a 396
1305 a Fk(In)g(the)g(Libero)f(state)i(machine)e(model)h(there)f(are)i
(a)f(fe)n(w)g(more)g(concepts)f(that)h(we')l(v)o(e)f(not)h(used)g
(here,)g(b)n(ut)g(which)f(we)396 1413 y(will)i(need)f(when)f(we)i
(write)f(lar)o(ger)f(state)i(machines:)-2 1431 y
SDict begin H.S end
 -2 1431
a -2 1431 a
SDict begin 13 H.A end
 -2 1431 a -2 1431 a
SDict begin [/View [/XYZ H.V]/Dest (0:4438) cvn /DEST pdfmark end
 -2 1431 a -2 1441 a
SDict begin H.S end
 -2
1441 a -2 1441 a
SDict begin 13 H.A end
 -2 1441 a -2 1441 a
SDict begin [/View [/XYZ H.V]/Dest (0:4439) cvn /DEST pdfmark end
 -2 1441 a Black
396 1583 a Fj(\225)p Black 479 1583 a
SDict begin H.S end
 479 1583 a 479
1583 a
SDict begin 13 H.A end
 479 1583 a 479 1583 a
SDict begin [/View [/XYZ H.V]/Dest (0:4440) cvn /DEST pdfmark end
 479 1583 a Fk(Exceptions,)e(which)g(lets)i
(us)g(write)f(terser)h(state)f(machines.)g(When)g(an)g(action)f(raises)
i(an)f(e)o(xception,)e(further)479 1691 y(processing)h(on)h(the)g(e)n
(v)o(ent)f(stops.)i(The)e(state)i(machine)e(can)h(then)g(de\002ne)g(ho)
n(w)f(to)i(handle)e(e)o(xception)f(e)n(v)o(ents.)-2 1709
y
SDict begin H.S end
 -2 1709 a -2 1709 a
SDict begin 13 H.A end
 -2 1709 a -2 1709 a
SDict begin [/View [/XYZ H.V]/Dest (0:4441) cvn /DEST pdfmark end
 -2 1709 a Black
396 1841 a Fj(\225)p Black 479 1841 a
SDict begin H.S end
 479 1841 a 479
1841 a
SDict begin 13 H.A end
 479 1841 a 479 1841 a
SDict begin [/View [/XYZ H.V]/Dest (0:4442) cvn /DEST pdfmark end
 479 1841 a Fk(Def)o(aults)h(state,)g
(where)f(we)h(can)g(de\002ne)f(def)o(ault)g(handling)e(for)i(e)n(v)o
(ents)g(\(especially)g(useful)g(for)g(e)o(xception)f(e)n(v)o(ents\).)-2
1900 y
SDict begin H.S end
 -2 1900 a -2 1900 a
SDict begin 13 H.A end
 -2 1900 a -2 1900 a
SDict begin [/View [/XYZ H.V]/Dest (0:4443) cvn /DEST pdfmark end
 -2 1900
a 359 x Fn(6.11.)39 b(A)l(uthentication)c(using)k(SASL)2203
2259 y
SDict begin H.S end
 2203 2259 a 2203 2259 a
SDict begin 22.464 H.A end
 2203 2259 a 2203 2259
a
SDict begin [/View [/XYZ H.V]/Dest (11.85.1) cvn /DEST pdfmark end
 2203 2259 a -2 2457 a
SDict begin H.S end
 -2 2457 a -2 2457 a
SDict begin 13 H.A end
 -2 2457 a
-2 2457 a
SDict begin [/View [/XYZ H.V]/Dest (0:4445) cvn /DEST pdfmark end
 -2 2457 a 396 2533 a Fk(When)20 b(we)h(designed)e(AMQP)h(in)h
(2007,)d(we)j(chose)1930 2533 y
SDict begin H.S end
 1930 2533 a 1930 2533
a
SDict begin 13 H.A end
 1930 2533 a 1930 2533 a
SDict begin [/View [/XYZ H.V]/Dest (0:4446) cvn /DEST pdfmark end
 1930 2533 a Fk(SASL)396 2641
y(\(http://en.wikipedia.or)o(g/wiki/Simple_)o(Auth)o(enticatio)o(n_)o
(and)o(_Secu)o(rity)o(_Lay)o(er\))14 b(for)20 b(the)g(authentication)e
(layer)m(,)396 2749 y(one)i(of)g(the)g(ideas)g(we)h(took)e(from)g(the)i
(BEEP)f(protocol)f(frame)n(w)o(ork.)f(SASL)i(looks)g(comple)o(x)f(at)h
(\002rst,)h(b)n(ut)f(it')-5 b(s)396 2857 y(simple)20
b(and)g(\002ts)h(v)o(ery)e(nicely)h(into)g(a)h(\330MQ-based)e
(protocol.)f(What)j(I)f(especially)g(lik)o(e)g(about)f(SASL)i(is)g
(that)g(it')-5 b(s)396 2965 y(scalable.)20 b(Y)-9 b(ou)20
b(can)g(start)g(with)h(anon)o(ymous)c(access,)k(or)f(plain)f(te)o(xt)h
(authentication)f(and)g(no)h(security)-5 b(,)19 b(and)h(gro)n(w)f(to)
396 3073 y(more)h(secure)f(mechanisms)h(o)o(v)o(er)e(time,)j(without)e
(changing)f(your)h(protocol)g(one)g(bit.)-2 3257 y
SDict begin H.S end
 -2
3257 a -2 3257 a
SDict begin 13 H.A end
 -2 3257 a -2 3257 a
SDict begin [/View [/XYZ H.V]/Dest (0:4447) cvn /DEST pdfmark end
 -2 3257 a 396 3347
a Fk(I'm)h(not)g(going)f(to)h(gi)n(v)o(e)f(a)i(deep)e(e)o(xplanation)f
(no)n(w)-5 b(,)19 b(since)i(we')o(ll)f(see)h(SASL)g(in)f(action)g(some)
n(what)f(later)-5 b(.)21 b(But)f(I')o(ll)396 3455 y(e)o(xplain)f(the)h
(principle)f(so)i(you')l(re)d(already)h(some)n(what)h(prepared.)-2
3639 y
SDict begin H.S end
 -2 3639 a -2 3639 a
SDict begin 13 H.A end
 -2 3639 a -2 3639 a
SDict begin [/View [/XYZ H.V]/Dest (0:4448) cvn /DEST pdfmark end
 -2 3639
a 396 3729 a Fk(In)g(the)g(NOM)h(protocol)d(the)j(client)f(started)g
(with)g(an)g(OHAI)h(command,)c(which)j(the)g(serv)o(er)g(either)f
(accepted)h(\("Hi)396 3837 y(Joe!"\))g(or)g(rejected.)f(This)h(is)i
(simple)e(b)n(ut)g(not)g(scalable)g(since)g(serv)o(er)g(and)f(client)h
(ha)n(v)o(e)g(to)g(agree)g(upfront)e(what)i(kind)396
3945 y(of)g(authentication)e(the)o(y')l(re)h(going)g(to)h(do.)-2
4129 y
SDict begin H.S end
 -2 4129 a -2 4129 a
SDict begin 13 H.A end
 -2 4129 a -2 4129 a
SDict begin [/View [/XYZ H.V]/Dest (0:4449) cvn /DEST pdfmark end
 -2 4129
a 396 4219 a Fk(What)h(SASL)f(introduced,)e(and)h(which)h(is)h(genius,)
e(is)i(a)f(fully)f(abstracted)h(and)f(ne)o(gotiable)f(security)i(layer)
f(that')-5 b(s)21 b(still)396 4327 y(easy)g(to)f(implement)f(at)i(the)f
(protocol)e(le)n(v)o(el.)i(It)g(w)o(orks)g(as)h(follo)n(ws:)-2
4345 y
SDict begin H.S end
 -2 4345 a -2 4345 a
SDict begin 13 H.A end
 -2 4345 a -2 4345 a
SDict begin [/View [/XYZ H.V]/Dest (0:4450) cvn /DEST pdfmark end
 -2 4345
a -2 4355 a
SDict begin H.S end
 -2 4355 a -2 4355 a
SDict begin 13 H.A end
 -2 4355 a -2 4355 a
SDict begin [/View [/XYZ H.V]/Dest (0:4451) cvn /DEST pdfmark end
 -2
4355 a Black 396 4497 a Fj(\225)p Black 479 4497 a
SDict begin H.S end
 479
4497 a 479 4497 a
SDict begin 13 H.A end
 479 4497 a 479 4497 a
SDict begin [/View [/XYZ H.V]/Dest (0:4452) cvn /DEST pdfmark end
 479 4497 a Fk(The)f(client)g
(connects.)-2 4498 y
SDict begin H.S end
 -2 4498 a -2 4498 a
SDict begin 13 H.A end
 -2 4498 a -2
4498 a
SDict begin [/View [/XYZ H.V]/Dest (0:4453) cvn /DEST pdfmark end
 -2 4498 a Black 396 4646 a Fj(\225)p Black 479
4646 a
SDict begin H.S end
 479 4646 a 479 4646 a
SDict begin 13 H.A end
 479 4646 a 479 4646 a
SDict begin [/View [/XYZ H.V]/Dest (0:4454) cvn /DEST pdfmark end
 479
4646 a Fk(The)g(serv)o(er)f(challenges)h(the)g(client,)g(passing)g(a)g
(list)i(of)d(security)h("mechanisms")f(that)h(it)h(kno)n(ws)f(about.)-2
4664 y
SDict begin H.S end
 -2 4664 a -2 4664 a
SDict begin 13 H.A end
 -2 4664 a -2 4664 a
SDict begin [/View [/XYZ H.V]/Dest (0:4455) cvn /DEST pdfmark end
 -2 4664
a Black 396 4796 a Fj(\225)p Black 479 4796 a
SDict begin H.S end
 479 4796
a 479 4796 a
SDict begin 13 H.A end
 479 4796 a 479 4796 a
SDict begin [/View [/XYZ H.V]/Dest (0:4456) cvn /DEST pdfmark end
 479 4796 a Fk(The)g(client)g
(chooses)g(a)h(security)e(mechanism)g(that)h(it)h(kno)n(ws)f(about,)f
(and)g(answers)i(the)f(serv)o(er')-5 b(s)19 b(challenge)g(with)479
4904 y(a)i(blob)e(of)h(opaque)f(data)h(that)g(\(and)f(here')-5
b(s)20 b(the)h(neat)f(trick\))f(some)h(generic)f(security)h(library)f
(calculates)h(and)g(gi)n(v)o(es)479 5012 y(to)h(the)f(client.)-2
5013 y
SDict begin H.S end
 -2 5013 a -2 5013 a
SDict begin 13 H.A end
 -2 5013 a -2 5013 a
SDict begin [/View [/XYZ H.V]/Dest (0:4457) cvn /DEST pdfmark end
 -2 5013
a Black 3759 5569 a Ff(365)p Black eop end
%%Page: 366 379
TeXDict begin 366 378 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.366) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:4458) cvn /DEST pdfmark end
 479 72 a Fk(The)h(serv)o(er)f(tak)o(es)i
(the)f(security)g(mechanism)f(the)h(client)g(choose,)f(and)h(that)g
(blob)g(of)f(data,)h(and)g(passes)h(it)g(to)f(its)479
180 y(o)n(wn)g(security)g(library)-5 b(.)-2 198 y
SDict begin H.S end
 -2
198 a -2 198 a
SDict begin 13 H.A end
 -2 198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:4459) cvn /DEST pdfmark end
 -2 198 a Black 396 330
a Fj(\225)p Black 479 330 a
SDict begin H.S end
 479 330 a 479 330 a
SDict begin 13 H.A end
 479 330
a 479 330 a
SDict begin [/View [/XYZ H.V]/Dest (0:4460) cvn /DEST pdfmark end
 479 330 a Fk(The)20 b(library)f(either)h(accepts)g(the)g
(client')-5 b(s)21 b(answer)m(,)e(or)h(the)g(serv)o(er)g(challenges)f
(again.)-2 514 y
SDict begin H.S end
 -2 514 a -2 514 a
SDict begin 13 H.A end
 -2 514 a -2 514 a
SDict begin [/View [/XYZ H.V]/Dest (0:4461) cvn /DEST pdfmark end

-2 514 a 396 604 a Fk(There)h(are)g(a)g(number)f(of)h(free)f(SASL)i
(libraries.)f(When)g(we)g(come)g(to)g(real)g(code,)g(we')o(ll)g
(implement)f(just)i(tw)o(o)396 712 y(mechanisms,)e(ANONYMOUS)i(and)e
(PLAIN,)h(which)g(don')o(t)e(need)i(an)o(y)f(special)h(libraries.)-2
896 y
SDict begin H.S end
 -2 896 a -2 896 a
SDict begin 13 H.A end
 -2 896 a -2 896 a
SDict begin [/View [/XYZ H.V]/Dest (0:4462) cvn /DEST pdfmark end
 -2 896 a 396
986 a Fk(T)-7 b(o)21 b(support)d(SASL)j(we)g(ha)n(v)o(e)e(to)i(add)e
(an)h(optional)f(challenge/response)f(step)i(to)h(our)e("open-peering")
e(\003o)n(w)-5 b(.)19 b(Here)h(is)396 1094 y(what)g(the)h(resulting)e
(protocol)f(grammar)h(looks)h(lik)o(e)g(\(I'm)f(modifying)f(NOM)i(to)h
(do)f(this\):)-2 1195 y
SDict begin H.S end
 -2 1195 a -2 1195 a
SDict begin 11.7 H.A end
 -2 1195 a
-2 1195 a
SDict begin [/View [/XYZ H.V]/Dest (0:4463) cvn /DEST pdfmark end
 -2 1195 a 396 1274 a Fe(secure-nom)268 b(=)44
b(open-peering)1786 1287 y(*)1831 1274 y(use-peering)396
1468 y(open-peering)178 b(=)44 b(C:OHAI)1517 1481 y(*)1562
1468 y(\()h(S:ORLY)e(C:YARLY)h(\))h(\()f(S:OHAI-OK)g(/)g(S:WTF)g(\))396
1662 y(ORLY)538 b(=)44 b(1)1248 1675 y(*)1293 1662 y(mechanism)f
(challenge)396 1759 y(mechanism)313 b(=)44 b(string)396
1857 y(challenge)313 b(=)1203 1870 y(*)1248 1857 y(OCTET)396
2051 y(YARLY)493 b(=)44 b(mechanism)g(response)396 2148
y(response)358 b(=)1203 2161 y(*)1248 2148 y(OCTET)-2
2326 y
SDict begin H.S end
 -2 2326 a -2 2326 a
SDict begin 13 H.A end
 -2 2326 a -2 2326 a
SDict begin [/View [/XYZ H.V]/Dest (0:4464) cvn /DEST pdfmark end
 -2 2326
a 396 2422 a Fk(Where)20 b(ORL)-8 b(Y)21 b(and)e(Y)-10
b(ARL)i(Y)21 b(contain)e(a)i(string)e(\(a)i(list)g(of)f(mechanisms)f
(in)h(ORL)-8 b(Y)d(,)21 b(one)f(mechanism)e(in)j(Y)-10
b(ARL)i(Y\))396 2530 y(and)20 b(a)h(blob)e(of)h(opaque)e(data.)i
(Depending)e(on)i(the)g(mechanism,)f(the)h(initial)h(challenge)d(from)i
(the)g(serv)o(er)f(may)h(be)396 2638 y(empty)-5 b(.)19
b(W)-7 b(e)21 b(don')o(t)e(care)h(a)g(jot:)h(we)f(just)h(pass)g(this)g
(to)f(the)g(security)g(library)f(to)h(deal)g(with.)-2
2822 y
SDict begin H.S end
 -2 2822 a -2 2822 a
SDict begin 13 H.A end
 -2 2822 a -2 2822 a
SDict begin [/View [/XYZ H.V]/Dest (0:4465) cvn /DEST pdfmark end
 -2 2822
a 396 2912 a Fk(The)g(SASL)770 2912 y
SDict begin H.S end
 770 2912 a 770
2912 a
SDict begin 13 H.A end
 770 2912 a 770 2912 a
SDict begin [/View [/XYZ H.V]/Dest (0:4466) cvn /DEST pdfmark end
 770 2912 a Fk(RFC)i
(\(http://tools.ietf.or)o(g/html/rfc4)o(422)o(\))14 b(goes)20
b(into)g(detail)h(about)e(other)g(features)h(\(that)g(we)g(don')o(t)396
3020 y(need\),)f(the)h(kinds)g(of)g(w)o(ays)g(SASL)h(could)e(be)i
(attack)o(ed,)e(and)h(so)g(on.)-2 3204 y
SDict begin H.S end
 -2 3204 a -2
3204 a
SDict begin 13 H.A end
 -2 3204 a -2 3204 a
SDict begin [/View [/XYZ H.V]/Dest (0:4467) cvn /DEST pdfmark end
 -2 3204 a 396 3294 a Fk(Unless)h(you')l(re)d
(a)j(security)f(geek,)f(all)i(you)e(should)g(care)h(about)f(is)i(the)g
(impact)e(on)h(the)g(protocol,)e(which)i(is)h(as)g(simple)396
3402 y(as)g(I')l(v)o(e)e(e)o(xplained)f(here.)-2 3430
y
SDict begin H.S end
 -2 3430 a -2 3430 a
SDict begin 13 H.A end
 -2 3430 a -2 3430 a
SDict begin [/View [/XYZ H.V]/Dest (0:4468) cvn /DEST pdfmark end
 -2 3430 a 359
x Fn(6.12.)39 b(Lar)n(g)q(e-scale)e(File)i(Pub)o(lishing)2215
3789 y
SDict begin H.S end
 2215 3789 a 2215 3789 a
SDict begin 22.464 H.A end
 2215 3789 a 2215 3789
a
SDict begin [/View [/XYZ H.V]/Dest (11.86.1) cvn /DEST pdfmark end
 2215 3789 a -2 3987 a
SDict begin H.S end
 -2 3987 a -2 3987 a
SDict begin 13 H.A end
 -2 3987 a
-2 3987 a
SDict begin [/View [/XYZ H.V]/Dest (0:4470) cvn /DEST pdfmark end
 -2 3987 a 396 4063 a Fk(Let')-5 b(s)21 b(put)e(all)h(these)g
(techniques)e(together)h(into)g(a)h(\002le)h(distrib)n(ution)d(system)i
(that)g(I')o(ll)g(call)g(FileMQ.)g(This)g(is)g(going)f(to)396
4171 y(be)h(a)h(real)f(product,)e(li)n(ving)i(on)1310
4171 y
SDict begin H.S end
 1310 4171 a 1310 4171 a
SDict begin 13 H.A end
 1310 4171 a 1310 4171
a
SDict begin [/View [/XYZ H.V]/Dest (0:4471) cvn /DEST pdfmark end
 1310 4171 a Fk(github)m(.com)d(\(https://github)m
(.com/hintjens/\002lemq\).)d(What)21 b(we')o(ll)f(mak)o(e)g(here)g(is)h
(a)396 4279 y(\002rst)g(v)o(ersion)e(of)h(FileMQ,)g(as)h(a)g(training)e
(tool.)h(If)g(the)g(concept)f(w)o(orks,)h(the)g(real)g(thing)f(may)h(e)
n(v)o(entually)e(get)j(its)g(o)n(wn)396 4387 y(Guide.)-2
4388 y
SDict begin H.S end
 -2 4388 a -2 4388 a
SDict begin 13 H.A end
 -2 4388 a -2 4388 a
SDict begin [/View [/XYZ H.V]/Dest (0:4472) cvn /DEST pdfmark end
 -2 4388
a 396 4715 a Fb(6.12.1.)36 b(Wh)n(y)d(make)i(FileMQ?)1888
4715 y
SDict begin H.S end
 1888 4715 a 1888 4715 a
SDict begin 18.72 H.A end
 1888 4715 a 1888 4715
a
SDict begin [/View [/XYZ H.V]/Dest (11.86.49.2) cvn /DEST pdfmark end
 1888 4715 a -2 4906 a
SDict begin H.S end
 -2 4906 a -2 4906 a
SDict begin 13 H.A end
 -2 4906 a
-2 4906 a
SDict begin [/View [/XYZ H.V]/Dest (0:4474) cvn /DEST pdfmark end
 -2 4906 a 396 4989 a Fk(Why)20 b(mak)o(e)g(a)g(\002le)h
(distrib)n(ution)e(system?)h(I)h(already)e(e)o(xplained)f(ho)n(w)i(to)g
(send)g(lar)o(ge)f(\002les)j(o)o(v)o(er)c(\330MQ,)j(and)e(it')-5
b(s)396 5097 y(really)20 b(quite)g(simple.)g(But)h(if)f(you)f(w)o(ant)i
(to)f(mak)o(e)g(messaging)f(accessible)h(to)h(a)f(million)g(times)h
(more)e(people)g(than)p Black 3757 5569 a Ff(366)p Black
eop end
%%Page: 367 380
TeXDict begin 367 379 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.367) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(can)h(use)h(\330MQ,)f(you)f(need)h(another)e(kind)i
(of)g(API.)g(An)g(API)h(that)f(my)g(\002)n(v)o(e-year)e(old)i(son)g
(can)g(understand.)e(An)i(API)396 180 y(that)h(is)g(uni)n(v)o(ersal,)d
(requires)h(no)h(programming,)d(and)i(w)o(orks)h(with)g(just)h(about)e
(e)n(v)o(ery)g(single)h(application.)-2 364 y
SDict begin H.S end
 -2 364
a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:4475) cvn /DEST pdfmark end
 -2 364 a 396 454 a Fk(Y)-8
b(es,)21 b(I'm)e(talking)h(about)f(the)h(\002le)h(system.)f(It')-5
b(s)21 b(the)f(DropBox)f(pattern:)g(chuck)g(your)g(\002les)i(some)n
(where,)e(and)g(the)o(y)396 562 y(get)h(magically)g(copied)f(some)n
(where)g(else,)h(when)g(the)g(netw)o(ork)f(connects)g(again.)-2
746 y
SDict begin H.S end
 -2 746 a -2 746 a
SDict begin 13 H.A end
 -2 746 a -2 746 a
SDict begin [/View [/XYZ H.V]/Dest (0:4476) cvn /DEST pdfmark end
 -2 746 a 396
836 a Fk(Ho)n(we)n(v)o(er)g(what)h(I'm)g(aiming)f(for)h(is)h(a)f(fully)
g(decentralized)e(architecture)h(that)h(looks)g(more)f(lik)o(e)i(git,)f
(that)g(doesn')o(t)396 944 y(need)g(an)o(y)f(cloud)g(services)i
(\(though)d(we)i(could)f(put)h(FileMQ)h(in)f(the)g(cloud\),)f(and)h
(which)f(does)h(multicast,)g(i.e.)g(can)396 1052 y(send)g(\002les)h(to)
g(man)o(y)e(places)h(at)h(once.)-2 1236 y
SDict begin H.S end
 -2 1236 a -2
1236 a
SDict begin 13 H.A end
 -2 1236 a -2 1236 a
SDict begin [/View [/XYZ H.V]/Dest (0:4477) cvn /DEST pdfmark end
 -2 1236 a 396 1326 a Fk(FileMQ)g(has)f(to)h
(be)f(secure\(able\),)e(has)i(to)h(be)f(easily)g(hook)o(ed)f(into)h
(random)e(scripting)h(languages,)g(and)g(has)i(to)f(be)g(as)396
1434 y(f)o(ast)h(as)g(possible)f(across)g(our)g(domestic)f(and)h(of)n
(\002ce)f(netw)o(orks.)-2 1618 y
SDict begin H.S end
 -2 1618 a -2 1618 a
SDict begin 13 H.A end

-2 1618 a -2 1618 a
SDict begin [/View [/XYZ H.V]/Dest (0:4478) cvn /DEST pdfmark end
 -2 1618 a 396 1708 a Fk(I)i(w)o(ant)f(to)g(use)h
(it)g(to)f(back-up)e(photos)h(from)h(my)f(mobile)h(phone)e(to)j(my)f
(laptop,)f(o)o(v)o(er)f(W)m(iFi.)j(T)-7 b(o)21 b(share)f(presentation)
396 1816 y(slides)h(in)f(real-time)g(across)g(\002fty)g(laptops)g(in)g
(a)h(conference.)d(T)-7 b(o)20 b(share)g(documents)e(with)j(colleagues)
e(in)h(a)h(meeting.)396 1924 y(T)-7 b(o)21 b(send)f(earthquak)o(e)e
(data)i(from)f(sensors)h(to)g(central)g(clusters.)g(T)-7
b(o)21 b(back-up)d(video)h(from)g(my)h(phone)f(as)i(I)f(tak)o(e)g(it,)
396 2032 y(during)f(protests)h(or)g(riots.)g(T)-7 b(o)20
b(synchronize)e(con\002guration)g(\002les)j(across)f(a)h(cloud)e(of)h
(Linux)f(serv)o(ers.)-2 2216 y
SDict begin H.S end
 -2 2216 a -2 2216 a
SDict begin 13 H.A end
 -2
2216 a -2 2216 a
SDict begin [/View [/XYZ H.V]/Dest (0:4479) cvn /DEST pdfmark end
 -2 2216 a 396 2306 a Fk(A)i(visionary)e(idea,)h(isn')o
(t)f(it?)i(W)-7 b(ell,)21 b(ideas)g(are)f(cheap.)f(The)h(hard)f(part)h
(is)h(making)e(this,)h(and)g(making)f(it)i(simple.)-2
2334 y
SDict begin H.S end
 -2 2334 a -2 2334 a
SDict begin 13 H.A end
 -2 2334 a -2 2334 a
SDict begin [/View [/XYZ H.V]/Dest (0:4480) cvn /DEST pdfmark end
 -2 2334
a 396 2644 a Fb(6.12.2.)36 b(Initial)f(Design)f(Cut)g(-)f(the)g(API)
2289 2644 y
SDict begin H.S end
 2289 2644 a 2289 2644 a
SDict begin 18.72 H.A end
 2289 2644 a 2289
2644 a
SDict begin [/View [/XYZ H.V]/Dest (11.86.50.2) cvn /DEST pdfmark end
 2289 2644 a -2 2837 a
SDict begin H.S end
 -2 2837 a -2 2837 a
SDict begin 13 H.A end
 -2 2837
a -2 2837 a
SDict begin [/View [/XYZ H.V]/Dest (0:4482) cvn /DEST pdfmark end
 -2 2837 a 396 2918 a Fk(Here')-5 b(s)21 b(the)f(w)o(ay)g(I)
h(see)f(the)h(\002rst)f(design.)g(FileMQ)g(has)h(to)f(be)g(distrib)n
(uted,)f(so)i(e)n(v)o(ery)e(node)g(can)h(be)g(a)h(serv)o(er)e(and)h(a)
396 3026 y(client)g(at)h(the)f(same)h(time.)f(But)h(I)f(don')o(t)f(w)o
(ant)h(the)g(protocol)f(to)h(be)g(symmetric,)f(because)h(that)g(seems)g
(forced.)f(W)-7 b(e)396 3134 y(ha)n(v)o(e)20 b(a)g(natural)g(\003o)n(w)
g(of)g(\002les)h(from)e(point)h(A)g(to)h(point)e(B,)i(where)f(A)g(is)i
(the)e("serv)o(er")f(and)g(B)j(is)f(the)f("client".)g(If)g(\002les)396
3242 y(\003o)n(w)h(back)e(the)h(other)g(w)o(ay)-5 b(,)19
b(we)i(ha)n(v)o(e)e(tw)o(o)i(\003o)n(ws.)f(So,)g(FileMQ)h(is)2372
3242 y
SDict begin H.S end
 2372 3242 a 2372 3242 a
SDict begin 13 H.A end
 2372 3242 a 2372 3242
a
SDict begin [/View [/XYZ H.V]/Dest (0:4483) cvn /DEST pdfmark end
 2372 3242 a Ff(not)h Fk(a)e(synchronization)d(protocol,)h(though)396
3350 y(synchronizing)f(tw)o(o)k(directories)e(is)i(going)e(to)h(be)h(a)
f(common)e(use)j(case.)-2 3534 y
SDict begin H.S end
 -2 3534 a -2 3534 a
SDict begin 13 H.A end

-2 3534 a -2 3534 a
SDict begin [/View [/XYZ H.V]/Dest (0:4484) cvn /DEST pdfmark end
 -2 3534 a 396 3624 a Fk(Thus,)f(I'm)f(going)g(to)i
(b)n(uild)e(FileMQ)i(as)g(tw)o(o)g(pieces:)f(a)g(client,)g(and)g(a)h
(serv)o(er)-5 b(.)19 b(Then,)g(I')o(ll)i(put)f(these)g(together)f(in)h
(a)396 3732 y(main)g(application)f(\(the)h("\002lemq")f(tool\))h(that)g
(can)g(act)h(both)e(as)i(client)f(and)g(serv)o(er)-5
b(.)19 b(The)h(tw)o(o)h(pieces)f(will)h(look)e(quite)396
3840 y(similar)i(to)f(the)g(nom_serv)o(er)m(,)d(with)j(the)h(same)f
(kind)f(of)h(API:)-2 3935 y
SDict begin H.S end
 -2 3935 a -2 3935 a
SDict begin 11.7 H.A end
 -2 3935
a -2 3935 a
SDict begin [/View [/XYZ H.V]/Dest (0:4485) cvn /DEST pdfmark end
 -2 3935 a 396 4020 a Fe(fmq_server_t)979
4033 y(*)1024 4020 y(server)44 b(=)g(fmq_server_new)f(\(\);)396
4117 y(fmq_server_bind)g(\(server,)g("tcp://)1832 4130
y(*)1877 4117 y(:6000"\);)396 4214 y(fmq_server_publish)f(\(server,)i
("/home/ph/filemq/share",)c("/public"\);)396 4311 y(fmq_server_publish)
i(\(server,)i("/home/ph/photos/stream",)c("/photostream"\);)396
4506 y(fmq_client_t)979 4519 y(*)1024 4506 y(client)k(=)g
(fmq_client_new)f(\(\);)396 4603 y(fmq_client_connect)f(\(client,)i
("tcp://pieter.filemq.org:6000"\);)396 4700 y(fmq_client_subscribe)e
(\(server,)h("/public/",)g("/home/ph/filemq/share"\);)396
4797 y(fmq_client_subscribe)f(\(server,)h("/photostream/",)f
("/home/ph/photos/stream"\);)396 4991 y(while)i(\(!zctx_interrupted\))
576 5088 y(sleep)g(\(1\);)p Black 3756 5569 a Ff(367)p
Black eop end
%%Page: 368 381
TeXDict begin 368 380 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.368) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 170 a Fe(fmq_server_destroy)42 b(\(&server\);)396
267 y(fmq_client_destroy)g(\(&client\);)-2 444 y
SDict begin H.S end
 -2 444
a -2 444 a
SDict begin 13 H.A end
 -2 444 a -2 444 a
SDict begin [/View [/XYZ H.V]/Dest (0:4486) cvn /DEST pdfmark end
 -2 444 a 396 541 a Fk(If)20
b(we)h(wrap)f(this)g(C)h(API)g(in)f(other)g(languages,)e(we)j(can)f
(easily)g(script)g(FileMQ,)h(embed)e(it)i(applications,)e(port)g(it)i
(to)396 649 y(smartphones,)d(and)i(so)h(on.)-2 677 y
SDict begin H.S end

-2 677 a -2 677 a
SDict begin 13 H.A end
 -2 677 a -2 677 a
SDict begin [/View [/XYZ H.V]/Dest (0:4487) cvn /DEST pdfmark end
 -2 677 a 396 987
a Fb(6.12.3.)36 b(Initial)f(Design)f(Cut)g(-)f(the)g(Pr)n(otocol)2573
987 y
SDict begin H.S end
 2573 987 a 2573 987 a
SDict begin 18.72 H.A end
 2573 987 a 2573 987 a
SDict begin [/View [/XYZ H.V]/Dest (11.86.51.2) cvn /DEST pdfmark end
 2573
987 a -2 1180 a
SDict begin H.S end
 -2 1180 a -2 1180 a
SDict begin 13 H.A end
 -2 1180 a -2 1180
a
SDict begin [/View [/XYZ H.V]/Dest (0:4489) cvn /DEST pdfmark end
 -2 1180 a 396 1261 a Fk(T)-7 b(o)21 b(start)f(with)h(we)f(write)h(do)
n(wn)e(the)h(protocol)e(as)j(an)f(ABNF)i(grammar)-5 b(.)18
b(Our)i(grammar)f(starts)i(with)f(the)g(\003o)n(w)h(of)396
1369 y(commands)e(between)g(the)h(client)h(and)e(serv)o(er)-5
b(.)20 b(Y)-9 b(ou)19 b(should)g(recognize)g(these)h(as)h(a)g
(combination)d(of)i(the)g(v)n(arious)396 1477 y(techniques)f(we')l(v)o
(e)g(seen)i(already:)-2 1578 y
SDict begin H.S end
 -2 1578 a -2 1578 a
SDict begin 11.7 H.A end
 -2
1578 a -2 1578 a
SDict begin [/View [/XYZ H.V]/Dest (0:4490) cvn /DEST pdfmark end
 -2 1578 a 396 1657 a Fe(filemq-protocol)43
b(=)h(open-peering)1786 1670 y(*)1831 1657 y(use-peering)f([)i
(close-peering)d(])396 1851 y(open-peering)178 b(=)44
b(C:OHAI)1517 1864 y(*)1562 1851 y(\()h(S:ORLY)e(C:YARLY)h(\))h(\()f
(S:OHAI-OK)g(/)g(error)g(\))396 2046 y(use-peering)223
b(=)44 b(C:ICANHAZ)g(\()g(S:ICANHAZ-OK)f(/)i(error)f(\))1114
2143 y(/)g(C:NOM)1114 2240 y(/)g(S:CHEEZBURGER)1114 2337
y(/)g(C:HUGZ)g(S:HUGZ-OK)1114 2434 y(/)g(S:HUGZ)g(C:HUGZ-OK)396
2628 y(close-peering)133 b(=)44 b(C:KTHXBAI)g(/)g(S:KTHXBAI)396
2823 y(error)493 b(=)44 b(S:SRSLY)g(/)h(S:RTFM)-2 2995
y
SDict begin H.S end
 -2 2995 a -2 2995 a
SDict begin 13 H.A end
 -2 2995 a -2 2995 a
SDict begin [/View [/XYZ H.V]/Dest (0:4491) cvn /DEST pdfmark end
 -2 2995 a 396
3097 a Fk(Here)20 b(are)g(the)h(messages)f(to)g(and)g(from)f(the)h
(serv)o(er:)-2 3198 y
SDict begin H.S end
 -2 3198 a -2 3198 a
SDict begin 11.7 H.A end
 -2 3198 a -2
3198 a
SDict begin [/View [/XYZ H.V]/Dest (0:4492) cvn /DEST pdfmark end
 -2 3198 a 396 3277 a Fe(;)135 b(The)44 b(client)g(opens)g
(peering)f(to)i(the)f(server)396 3374 y(OHAI)538 b(=)44
b(\045x01)g(protocol)g(version)g(identity)396 3471 y(protocol)358
b(=)44 b(string)358 b(;)45 b(Must)f(be)g("FILEMQ")396
3568 y(string)448 b(=)44 b(size)1427 3581 y(*)1472 3568
y(VCHAR)396 3665 y(size)538 b(=)44 b(OCTET)396 3763 y(version)403
b(=)44 b(\045x01)396 3860 y(identity)358 b(=)44 b(16OCTET)396
4054 y(;)135 b(The)44 b(server)g(challenges)f(the)h(client)g(using)g
(the)g(SASL)h(model)396 4151 y(ORLY)538 b(=)44 b(\045x02)g(mechanisms)g
(challenge)396 4248 y(mechanisms)268 b(=)44 b(size)g(1)1472
4261 y(*)1517 4248 y(mechanism)396 4345 y(mechanism)313
b(=)44 b(string)396 4443 y(challenge)313 b(=)1203 4456
y(*)1248 4443 y(OCTET)358 b(;)45 b(0MQ)f(frame)396 4637
y(;)135 b(The)44 b(client)g(responds)f(with)h(SASL)h(authentication)d
(information)396 4734 y(YARLY)493 b(=)44 b(\045x03)g(mechanism)g
(response)396 4831 y(response)358 b(=)1203 4844 y(*)1248
4831 y(OCTET)g(;)45 b(0MQ)f(frame)396 5025 y(;)135 b(The)44
b(server)g(grants)g(the)g(client)g(access)396 5122 y(OHAI-OK)403
b(=)44 b(\045x04)p Black 3759 5569 a Ff(368)p Black eop
end
%%Page: 369 382
TeXDict begin 369 381 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.369) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 170 a Fe(;)135 b(The)44 b(client)g(subscribes)f(to)h(a)h
(path)396 267 y(ICANHAZ)403 b(=)44 b(\045x05)g(path)h(options)396
364 y(path)538 b(=)44 b(string)358 b(;)45 b(Full)f(or)g(partial)g(path)
396 461 y(options)403 b(=)44 b(dictionary)396 558 y(dictionary)268
b(=)44 b(size)1427 571 y(*)1472 558 y(key-value)396 655
y(key-value)313 b(=)44 b(string)358 b(;)45 b(Formatted)e(as)h
(name=value)396 850 y(;)135 b(The)44 b(server)g(confirms)f(the)i
(subscription)396 947 y(ICANHAZ-OK)268 b(=)44 b(\045x06)396
1141 y(;)135 b(The)44 b(client)g(sends)g(credit)g(to)g(the)g(server)396
1238 y(NOM)583 b(=)44 b(\045x07)g(credit)396 1335 y(credit)448
b(=)44 b(number)396 1432 y(number)448 b(=)44 b(8OCTET)358
b(;)45 b(64-bit)e(integer,)h(network)g(order)396 1530
y(sequence)358 b(=)44 b(number)396 1724 y(;)135 b(The)44
b(server)g(sends)g(a)g(chunk)g(of)h(file)f(data)396 1821
y(CHEEZBURGER)223 b(=)44 b(\045x08)g(sequence)g(operation)f(filename)
1203 1918 y(offset)h(headers)g(chunk)396 2015 y(sequence)358
b(=)44 b(number)396 2112 y(operation)313 b(=)44 b(OCTET)396
2209 y(filename)358 b(=)44 b(string)396 2307 y(offset)448
b(=)44 b(number)396 2404 y(headers)403 b(=)44 b(dictionary)396
2501 y(chunk)493 b(=)44 b(FRAME)396 2695 y(;)135 b(Client)43
b(or)i(server)f(sends)g(a)g(heartbeat,)g(the)g(other)g(peer)g(responds)
396 2792 y(HUGZ)538 b(=)44 b(\045x09)396 2889 y(HUGZ-OK)403
b(=)44 b(\045x0A)396 3084 y(;)135 b(Client)43 b(closes)h(the)h(peering)
396 3181 y(KTHXBAI)403 b(=)44 b(\045x0B)-2 3348 y
SDict begin H.S end
 -2
3348 a -2 3348 a
SDict begin 13 H.A end
 -2 3348 a -2 3348 a
SDict begin [/View [/XYZ H.V]/Dest (0:4493) cvn /DEST pdfmark end
 -2 3348 a 396 3455
a Fk(And)20 b(here)g(are)g(the)g(dif)n(ferent)e(w)o(ays)j(the)f(serv)o
(er)g(can)g(tell)g(the)h(client)f(things)g(went)g(wrong:)-2
3556 y
SDict begin H.S end
 -2 3556 a -2 3556 a
SDict begin 11.7 H.A end
 -2 3556 a -2 3556 a
SDict begin [/View [/XYZ H.V]/Dest (0:4494) cvn /DEST pdfmark end
 -2 3556
a 396 3635 a Fe(;)135 b(Server)43 b(error)h(replies)396
3732 y(S:SRSLY)403 b(=)44 b(\045x80)g(reason)179 b(;)44
b(Refused)g(due)g(to)h(access)f(rights)396 3829 y(S:RTFM)448
b(=)44 b(\045x81)g(reason)179 b(;)44 b(Client)g(sent)g(an)h(invalid)f
(command)-2 4003 y
SDict begin H.S end
 -2 4003 a -2 4003 a
SDict begin 13 H.A end
 -2 4003 a -2 4003
a
SDict begin [/View [/XYZ H.V]/Dest (0:4495) cvn /DEST pdfmark end
 -2 4003 a 396 4103 a Fk(The)20 b(FILEMQ/1.0)f(protocol)f(is)j
(speci\002ed)f(on)g(the)1918 4103 y
SDict begin H.S end
 1918 4103 a 1918
4103 a
SDict begin 13 H.A end
 1918 4103 a 1918 4103 a
SDict begin [/View [/XYZ H.V]/Dest (0:4496) cvn /DEST pdfmark end
 1918 4103 a Fk(\330MQ)h(unprotocols)c
(website)k(\(http://rfc.zeromq.or)o(g/spe)o(c:19)o(\).)-2
4132 y
SDict begin H.S end
 -2 4132 a -2 4132 a
SDict begin 13 H.A end
 -2 4132 a -2 4132 a
SDict begin [/View [/XYZ H.V]/Dest (0:4497) cvn /DEST pdfmark end
 -2 4132
a 396 4442 a Fb(6.12.4.)36 b(Building)f(and)e(T)-10 b(r)q(ying)35
b(FileMQ)2341 4442 y
SDict begin H.S end
 2341 4442 a 2341 4442 a
SDict begin 18.72 H.A end
 2341 4442
a 2341 4442 a
SDict begin [/View [/XYZ H.V]/Dest (11.86.52.2) cvn /DEST pdfmark end
 2341 4442 a -2 4634 a
SDict begin H.S end
 -2 4634 a -2 4634
a
SDict begin 13 H.A end
 -2 4634 a -2 4634 a
SDict begin [/View [/XYZ H.V]/Dest (0:4499) cvn /DEST pdfmark end
 -2 4634 a 396 4716 a Fk(The)19
b(FileMQ)h(stack)f(is)1093 4716 y
SDict begin H.S end
 1093 4716 a 1093 4716
a
SDict begin 13 H.A end
 1093 4716 a 1093 4716 a
SDict begin [/View [/XYZ H.V]/Dest (0:4500) cvn /DEST pdfmark end
 1093 4716 a Fk(on)g(github)f
(\(https://github)m(.com/hintjens/\002lemq\).)c(It)19
b(w)o(orks)g(lik)o(e)h(a)f(classic)h(C/C++)h(project:)-2
4817 y
SDict begin H.S end
 -2 4817 a -2 4817 a
SDict begin 11.7 H.A end
 -2 4817 a -2 4817 a
SDict begin [/View [/XYZ H.V]/Dest (0:4501) cvn /DEST pdfmark end
 -2 4817
a 396 4896 a Fe(git)45 b(clone)f(git://github.com/hintjens/filemq.git)
396 4993 y(cd)h(filemq)396 5090 y(./autogen.sh)p Black
3759 5569 a Ff(369)p Black eop end
%%Page: 370 383
TeXDict begin 370 382 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.370) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fe(./configure)396 170 y(make)44 b(check)-2
337 y
SDict begin H.S end
 -2 337 a -2 337 a
SDict begin 13 H.A end
 -2 337 a -2 337 a
SDict begin [/View [/XYZ H.V]/Dest (0:4502) cvn /DEST pdfmark end
 -2 337 a 396
444 a Fk(Y)-9 b(ou)20 b(w)o(ant)g(to)h(be)f(using)f(the)i(latest)g
(CZMQ)f(master)g(for)g(this.)g(No)n(w)g(try)g(running)e(the)2912
444 y
SDict begin H.S end
 2912 444 a 2912 444 a
SDict begin 13 H.A end
 2912 444 a 2912 444 a
SDict begin [/View [/XYZ H.V]/Dest (0:4503) cvn /DEST pdfmark end
 2912
444 a Fe(track)h Fk(command,)f(which)i(is)h(a)396 552
y(simple)f(tool)g(that)h(uses)f(FileMQ)h(to)f(track)g(changes)f(in)i
(one)e(directory)g(in)h(another:)-2 653 y
SDict begin H.S end
 -2 653 a -2
653 a
SDict begin 11.7 H.A end
 -2 653 a -2 653 a
SDict begin [/View [/XYZ H.V]/Dest (0:4504) cvn /DEST pdfmark end
 -2 653 a 396 732 a Fe(cd)45 b(src)396
829 y(./track)f(./fmqroot/send)e(./fmqroot/recv)-2 1006
y
SDict begin H.S end
 -2 1006 a -2 1006 a
SDict begin 13 H.A end
 -2 1006 a -2 1006 a
SDict begin [/View [/XYZ H.V]/Dest (0:4505) cvn /DEST pdfmark end
 -2 1006 a 396
1103 a Fk(And)20 b(open)f(tw)o(o)i(\002le)f(na)n(vigator)f(windo)n(ws,)
g(one)h(into)1975 1103 y
SDict begin H.S end
 1975 1103 a 1975 1103 a
SDict begin 13 H.A end
 1975
1103 a 1975 1103 a
SDict begin [/View [/XYZ H.V]/Dest (0:4506) cvn /DEST pdfmark end
 1975 1103 a Fe(src/fmqroot/send)f
Fk(and)g(one)h(into)3145 1103 y
SDict begin H.S end
 3145 1103 a 3145 1103
a
SDict begin 13 H.A end
 3145 1103 a 3145 1103 a
SDict begin [/View [/XYZ H.V]/Dest (0:4507) cvn /DEST pdfmark end
 3145 1103 a Fe(src/fmqroot/recv)p
Fk(.)396 1211 y(Drop)g(\002les)h(into)f(the)g(send)g(folder)f(and)h
(you')o(ll)f(see)i(them)e(arri)n(v)o(e)g(in)i(the)f(recv)g(folder)-5
b(.)19 b(The)h(serv)o(er)f(checks)h(once)f(per)396 1319
y(second)h(for)f(ne)n(w)h(\002les.)h(Delete)f(\002les)i(in)e(the)g
(send)g(folder)m(,)f(and)g(the)o(y')l(re)g(deleted)g(in)i(the)f(recv)f
(folder)g(similarly)-5 b(.)-2 1503 y
SDict begin H.S end
 -2 1503 a -2 1503
a
SDict begin 13 H.A end
 -2 1503 a -2 1503 a
SDict begin [/View [/XYZ H.V]/Dest (0:4508) cvn /DEST pdfmark end
 -2 1503 a 396 1593 a Fk(I)21 b(use)f(track)g(for)
f(things)h(lik)o(e)h(updating)d(my)i(MP3)g(player)f(mounted)g(as)h(a)h
(USB)g(dri)n(v)o(e.)e(As)i(I)f(add)g(or)g(remo)o(v)o(e)e(\002les)j(in)
396 1701 y(my)f(laptop')-5 b(s)20 b(Music)g(folder)m(,)f(the)h(same)g
(changes)f(happen)g(on)h(the)g(MP3)g(player)-5 b(.)19
b(FILEMQ)h(isn')o(t)g(a)h(full)f(replication)396 1808
y(protocol)f(it)i(might)e(become)g(one.)-2 1837 y
SDict begin H.S end
 -2
1837 a -2 1837 a
SDict begin 13 H.A end
 -2 1837 a -2 1837 a
SDict begin [/View [/XYZ H.V]/Dest (0:4509) cvn /DEST pdfmark end
 -2 1837 a 396 2147
a Fb(6.12.5.)36 b(Internal)e(Ar)n(c)o(hitecture)1960
2147 y
SDict begin H.S end
 1960 2147 a 1960 2147 a
SDict begin 18.72 H.A end
 1960 2147 a 1960 2147
a
SDict begin [/View [/XYZ H.V]/Dest (11.86.53.2) cvn /DEST pdfmark end
 1960 2147 a -2 2314 a
SDict begin H.S end
 -2 2314 a -2 2314 a
SDict begin 13 H.A end
 -2 2314 a
-2 2314 a
SDict begin [/View [/XYZ H.V]/Dest (0:4511) cvn /DEST pdfmark end
 -2 2314 a 396 2421 a Fk(T)-7 b(o)21 b(b)n(uild)e(FileMQ)i(I)f
(used)g(a)h(lot)f(of)g(code)g(generation,)e(possibly)h(too)h(much.)f
(Ho)n(we)n(v)o(er)g(the)h(code)g(generators)e(are)i(all)396
2529 y(reusable)g(in)g(other)f(stacks.)i(The)o(y)e(are)h(an)g(e)n(v)n
(olution)f(of)h(the)g(set)h(we)f(sa)o(w)h(earlier:)-2
2547 y
SDict begin H.S end
 -2 2547 a -2 2547 a
SDict begin 13 H.A end
 -2 2547 a -2 2547 a
SDict begin [/View [/XYZ H.V]/Dest (0:4512) cvn /DEST pdfmark end
 -2 2547
a -2 2557 a
SDict begin H.S end
 -2 2557 a -2 2557 a
SDict begin 13 H.A end
 -2 2557 a -2 2557 a
SDict begin [/View [/XYZ H.V]/Dest (0:4513) cvn /DEST pdfmark end
 -2
2557 a Black 396 2699 a Fj(\225)p Black 479 2699 a
SDict begin H.S end
 479
2699 a 479 2699 a
SDict begin 13 H.A end
 479 2699 a 479 2699 a
SDict begin [/View [/XYZ H.V]/Dest (0:4514) cvn /DEST pdfmark end
 479 2699 a Fk(codec_c.gsl)e(-)h
(generates)f(a)i(message)f(codec)f(for)h(a)g(gi)n(v)o(en)f(protocol.)-2
2717 y
SDict begin H.S end
 -2 2717 a -2 2717 a
SDict begin 13 H.A end
 -2 2717 a -2 2717 a
SDict begin [/View [/XYZ H.V]/Dest (0:4515) cvn /DEST pdfmark end
 -2 2717
a Black 396 2848 a Fj(\225)p Black 479 2848 a
SDict begin H.S end
 479 2848
a 479 2848 a
SDict begin 13 H.A end
 479 2848 a 479 2848 a
SDict begin [/View [/XYZ H.V]/Dest (0:4516) cvn /DEST pdfmark end
 479 2848 a Fk(serv)o(er_c.gsl)g(-)h
(generates)f(a)i(serv)o(er)e(class)i(for)f(a)h(protocol)d(and)i(state)h
(machine.)-2 2866 y
SDict begin H.S end
 -2 2866 a -2 2866 a
SDict begin 13 H.A end
 -2 2866 a -2
2866 a
SDict begin [/View [/XYZ H.V]/Dest (0:4517) cvn /DEST pdfmark end
 -2 2866 a Black 396 2998 a Fj(\225)p Black 479
2998 a
SDict begin H.S end
 479 2998 a 479 2998 a
SDict begin 13 H.A end
 479 2998 a 479 2998 a
SDict begin [/View [/XYZ H.V]/Dest (0:4518) cvn /DEST pdfmark end
 479
2998 a Fk(client_c.gsl)f(-)g(generates)f(a)i(client)f(class)h(for)f(a)g
(protocol)f(and)g(state)i(machine.)-2 3182 y
SDict begin H.S end
 -2 3182
a -2 3182 a
SDict begin 13 H.A end
 -2 3182 a -2 3182 a
SDict begin [/View [/XYZ H.V]/Dest (0:4519) cvn /DEST pdfmark end
 -2 3182 a 396 3272 a
Fk(The)f(best)h(w)o(ay)f(to)g(learn)g(to)g(use)h(GSL)f(code)g
(generation)e(is)j(to)f(translate)g(these)h(into)f(a)g(language)f(of)h
(your)f(choice)g(and)396 3380 y(mak)o(e)h(your)f(o)n(wn)h(demo)f
(protocols)g(and)g(stacks.)i(Y)-9 b(ou')o(ll)19 b(\002nd)h(it)h(f)o
(airly)f(easy)-5 b(.)19 b(FileMQ)i(itself)g(doesn')o(t)e(try)h(to)g
(support)396 3488 y(multiple)g(languages.)e(It)j(could)e(b)n(ut)h(it')l
(d)g(mak)o(e)g(things)g(needlessly)f(comple)o(x.)-2 3672
y
SDict begin H.S end
 -2 3672 a -2 3672 a
SDict begin 13 H.A end
 -2 3672 a -2 3672 a
SDict begin [/View [/XYZ H.V]/Dest (0:4520) cvn /DEST pdfmark end
 -2 3672 a 396
3762 a Fk(The)g(FileMQ)h(architecture)e(actually)h(slices)h(into)g(tw)o
(o)f(layers.)g(There')-5 b(s)19 b(a)h(generic)e(set)j(of)e(classes)h
(to)g(handle)e(chunks,)396 3870 y(directories,)h(\002les,)i(patches,)f
(SASL)g(security)-5 b(,)19 b(and)h(con\002guration)d(\002les.)k(Then,)e
(there')-5 b(s)21 b(the)f(generated)e(stack:)396 3978
y(messages,)i(client,)g(and)g(serv)o(er)-5 b(.)19 b(If)i(I)f(w)o(as)h
(creating)e(a)i(ne)n(w)f(project)f(I')l(d)g(fork)h(the)g(whole)f
(FileMQ)i(project,)e(and)h(go)396 4086 y(and)g(modify)f(the)h(three)f
(models:)-2 4103 y
SDict begin H.S end
 -2 4103 a -2 4103 a
SDict begin 13 H.A end
 -2 4103 a -2 4103
a
SDict begin [/View [/XYZ H.V]/Dest (0:4521) cvn /DEST pdfmark end
 -2 4103 a -2 4113 a
SDict begin H.S end
 -2 4113 a -2 4113 a
SDict begin 13 H.A end
 -2 4113 a -2
4113 a
SDict begin [/View [/XYZ H.V]/Dest (0:4522) cvn /DEST pdfmark end
 -2 4113 a Black 396 4256 a Fj(\225)p Black 479
4256 a
SDict begin H.S end
 479 4256 a 479 4256 a
SDict begin 13 H.A end
 479 4256 a 479 4256 a
SDict begin [/View [/XYZ H.V]/Dest (0:4523) cvn /DEST pdfmark end
 479
4256 a Fk(fmq_msg.xml)f(-)i(which)g(de\002nes)g(the)g(message)g
(formats)-2 4274 y
SDict begin H.S end
 -2 4274 a -2 4274 a
SDict begin 13 H.A end
 -2 4274 a -2 4274
a
SDict begin [/View [/XYZ H.V]/Dest (0:4524) cvn /DEST pdfmark end
 -2 4274 a Black 396 4405 a Fj(\225)p Black 479 4405
a
SDict begin H.S end
 479 4405 a 479 4405 a
SDict begin 13 H.A end
 479 4405 a 479 4405 a
SDict begin [/View [/XYZ H.V]/Dest (0:4525) cvn /DEST pdfmark end
 479 4405
a Fk(fmq_client.xml)e(-)i(which)g(de\002nes)g(the)g(client)g(state)h
(machine,)e(API,)h(and)g(implementation.)-2 4423 y
SDict begin H.S end
 -2
4423 a -2 4423 a
SDict begin 13 H.A end
 -2 4423 a -2 4423 a
SDict begin [/View [/XYZ H.V]/Dest (0:4526) cvn /DEST pdfmark end
 -2 4423 a Black
396 4555 a Fj(\225)p Black 479 4555 a
SDict begin H.S end
 479 4555 a 479
4555 a
SDict begin 13 H.A end
 479 4555 a 479 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:4527) cvn /DEST pdfmark end
 479 4555 a Fk(fmq_serv)o(er)-5
b(.xml)17 b(-)k(which)e(does)h(the)g(same)h(for)e(the)i(serv)o(er)-5
b(.)-2 4739 y
SDict begin H.S end
 -2 4739 a -2 4739 a
SDict begin 13 H.A end
 -2 4739 a -2 4739 a
SDict begin [/View [/XYZ H.V]/Dest (0:4528) cvn /DEST pdfmark end

-2 4739 a 396 4829 a Fk(Y)c(ou')l(d)19 b(w)o(ant)h(to)h(rename)e
(things,)g(to)h(a)n(v)n(oid)g(confusion.)e(Why)i(didn')o(t)f(I)h(mak)o
(e)g(the)g(reusable)f(classes)j(into)e(a)g(separate)396
4936 y(library?)f(The)h(answer)g(is)h(tw)o(o-fold.)e(First,)h(no-one)f
(actually)g(needs)h(this)h(\(yet\).)e(Second,)g(it')l(d)h(mak)o(e)g
(things)f(more)396 5044 y(comple)o(x)g(for)g(you)h(as)g(you)g(b)n(uild)
g(and)f(play)h(with)g(FileMQ.)h(It')-5 b(s)21 b(ne)n(v)o(er)d(w)o(orth)
i(adding)f(comple)o(xity)f(to)i(solv)o(e)g(a)396 5152
y(theoretical)f(problem.)p Black 3759 5569 a Ff(370)p
Black eop end
%%Page: 371 384
TeXDict begin 371 383 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.371) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4555) cvn /DEST pdfmark end
 -2 -201 a 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4529) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Although)g(I)h(wrote)g(FileMQ)h(in)f(C,)h(it')-5
b(s)21 b(easy)f(to)h(map)e(to)i(other)e(languages.)g(It)h(is)h(quite)f
(amazing)f(ho)n(w)h(nice)g(C)396 180 y(becomes)g(when)f(you)g(add)h
(CZMQ')-5 b(s)21 b(generic)e(zlist)i(and)f(zhash)g(containers,)e(and)i
(class)h(style.)g(Let)f(me)g(go)g(through)396 288 y(the)g(classes)i
(quickly:)-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306
a
SDict begin [/View [/XYZ H.V]/Dest (0:4530) cvn /DEST pdfmark end
 -2 306 a -2 316 a
SDict begin H.S end
 -2 316 a -2 316 a
SDict begin 13 H.A end
 -2 316 a -2 316
a
SDict begin [/View [/XYZ H.V]/Dest (0:4531) cvn /DEST pdfmark end
 -2 316 a Black 396 459 a Fj(\225)p Black 479 459 a
SDict begin H.S end

479 459 a 479 459 a
SDict begin 13 H.A end
 479 459 a 479 459 a
SDict begin [/View [/XYZ H.V]/Dest (0:4532) cvn /DEST pdfmark end
 479 459 a Fk(fmq_sasl:)e
(encodes)f(and)h(decodes)f(a)h(SASL)h(challenge.)e(I)h(only)g
(implemented)e(the)i(PLAIN)g(mechanism,)f(which)479 566
y(is)i(enough)e(to)h(pro)o(v)o(e)e(the)i(concept.)-2
584 y
SDict begin H.S end
 -2 584 a -2 584 a
SDict begin 13 H.A end
 -2 584 a -2 584 a
SDict begin [/View [/XYZ H.V]/Dest (0:4533) cvn /DEST pdfmark end
 -2 584 a Black
396 716 a Fj(\225)p Black 479 716 a
SDict begin H.S end
 479 716 a 479 716
a
SDict begin 13 H.A end
 479 716 a 479 716 a
SDict begin [/View [/XYZ H.V]/Dest (0:4534) cvn /DEST pdfmark end
 479 716 a Fk(fmq_chunk:)d(w)o(orks)j(with)g(v)n
(ariable)g(sized)g(blobs.)f(Not)i(as)g(ef)n(\002cient)e(as)i(\330MQ')-5
b(s)21 b(messages)f(b)n(ut)h(the)o(y)e(do)h(less)479
824 y(weirdness)g(and)g(so)g(are)g(easier)h(to)f(understand.)e(The)i
(chunk)e(class)k(has)e(methods)f(to)h(read)g(and)g(write)g(chunks)f
(from)479 932 y(disk.)-2 933 y
SDict begin H.S end
 -2 933 a -2 933 a
SDict begin 13 H.A end
 -2 933
a -2 933 a
SDict begin [/View [/XYZ H.V]/Dest (0:4535) cvn /DEST pdfmark end
 -2 933 a Black 396 1081 a Fj(\225)p Black
479 1081 a
SDict begin H.S end
 479 1081 a 479 1081 a
SDict begin 13 H.A end
 479 1081 a 479 1081
a
SDict begin [/View [/XYZ H.V]/Dest (0:4536) cvn /DEST pdfmark end
 479 1081 a Fk(fmq_\002le:)g(w)o(orks)h(with)h(\002les,)g(which)e(may)
h(or)g(may)g(not)f(e)o(xist)i(on)f(disk.)f(Gi)n(v)o(es)i(you)e
(information)f(about)h(a)i(\002le)479 1189 y(\(lik)o(e)f(size\),)h
(lets)g(you)e(read)h(and)f(write)i(to)f(\002les,)h(remo)o(v)o(e)d
(\002les,)j(check)e(if)i(a)g(\002le)f(e)o(xists,)h(and)e(check)h(if)g
(a)h(\002le)g(is)479 1297 y("stable")f(\(more)f(on)h(that)h(later\).)-2
1312 y
SDict begin H.S end
 -2 1312 a -2 1312 a
SDict begin 13 H.A end
 -2 1312 a -2 1312 a
SDict begin [/View [/XYZ H.V]/Dest (0:4537) cvn /DEST pdfmark end
 -2 1312
a Black 396 1446 a Fj(\225)p Black 479 1446 a
SDict begin H.S end
 479 1446
a 479 1446 a
SDict begin 13 H.A end
 479 1446 a 479 1446 a
SDict begin [/View [/XYZ H.V]/Dest (0:4538) cvn /DEST pdfmark end
 479 1446 a Fk(fmq_dir:)e(w)o(orks)g
(with)i(directories,)e(reading)f(them)i(from)f(disk)i(and)e(comparing)f
(tw)o(o)j(directories)e(to)h(see)h(what)479 1554 y(changed.)d(When)i
(there)g(are)g(changes,)f(returns)h(a)g(list)h(of)f("patches".)-2
1572 y
SDict begin H.S end
 -2 1572 a -2 1572 a
SDict begin 13 H.A end
 -2 1572 a -2 1572 a
SDict begin [/View [/XYZ H.V]/Dest (0:4539) cvn /DEST pdfmark end
 -2 1572
a Black 396 1704 a Fj(\225)p Black 479 1704 a
SDict begin H.S end
 479 1704
a 479 1704 a
SDict begin 13 H.A end
 479 1704 a 479 1704 a
SDict begin [/View [/XYZ H.V]/Dest (0:4540) cvn /DEST pdfmark end
 479 1704 a Fk(fmq_patch:)e(w)o(orks)
i(with)g(one)f(patch,)h(which)f(really)h(just)g(says)h("create)e(this)i
(\002le")g(or)e("delete)h(this)h(\002le")f(\(referring)479
1812 y(to)h(a)f(fmq_\002le)f(item)i(each)f(time\).)-2
1830 y
SDict begin H.S end
 -2 1830 a -2 1830 a
SDict begin 13 H.A end
 -2 1830 a -2 1830 a
SDict begin [/View [/XYZ H.V]/Dest (0:4541) cvn /DEST pdfmark end
 -2 1830
a Black 396 1961 a Fj(\225)p Black 479 1961 a
SDict begin H.S end
 479 1961
a 479 1961 a
SDict begin 13 H.A end
 479 1961 a 479 1961 a
SDict begin [/View [/XYZ H.V]/Dest (0:4542) cvn /DEST pdfmark end
 479 1961 a Fk(fmq_con\002g:)e(w)o
(orks)i(with)g(con\002guration)e(data.)h(I')o(ll)i(come)e(back)h(to)g
(client)g(and)g(serv)o(er)f(con\002guration)f(later)-5
b(.)-2 2145 y
SDict begin H.S end
 -2 2145 a -2 2145 a
SDict begin 13 H.A end
 -2 2145 a -2 2145 a
SDict begin [/View [/XYZ H.V]/Dest (0:4543) cvn /DEST pdfmark end

-2 2145 a 396 2235 a Fk(Ev)o(ery)19 b(class)i(has)g(a)f(test)h(method,)
e(and)g(the)i(main)f(de)n(v)o(elopment)d(c)o(ycle)j(is)h("edit,)f
(test".)g(These)g(are)g(mostly)g(simple)396 2343 y(self)h(tests)g(b)n
(ut)f(the)o(y)g(mak)o(e)g(the)g(dif)n(ference)e(between)h(code)h(I)g
(can)g(trust.)g(and)g(code)g(I)g(kno)n(w)f(will)i(still)g(break.)e(It')
-5 b(s)21 b(a)396 2451 y(safe)g(bet)f(that)g(an)o(y)g(code)f(that)h
(isn')o(t)g(co)o(v)o(ered)e(by)i(a)h(test)g(case)f(will)h(ha)n(v)o(e)f
(undisco)o(v)o(ered)d(errors.)i(I'm)h(not)f(a)i(f)o(an)f(of)396
2559 y(e)o(xternal)f(test)i(harnesses.)f(But)h(internal)e(test)i(code)f
(that)g(you)f(write)i(as)f(you)g(write)g(your)f(functionality)-5
b(...)17 b(that')-5 b(s)21 b(lik)o(e)396 2667 y(the)f(handle)g(on)f(a)i
(knife.)-2 2834 y
SDict begin H.S end
 -2 2834 a -2 2834 a
SDict begin 13 H.A end
 -2 2834 a -2 2834
a
SDict begin [/View [/XYZ H.V]/Dest (0:4544) cvn /DEST pdfmark end
 -2 2834 a 396 2941 a Fk(Y)-9 b(ou)19 b(should,)f(really)-5
b(,)19 b(be)g(able)g(to)h(read)e(the)i(source)e(code)h(and)g(rapidly)f
(understand)f(what)j(these)f(classes)i(are)e(doing.)f(If)396
3049 y(you)i(can')o(t)f(read)g(the)i(code)e(happily)-5
b(,)18 b(tell)j(me.)f(If)g(you)f(w)o(ant)i(to)f(port)g(the)g(FileMQ)h
(implementation)c(into)j(other)396 3157 y(languages,)f(start)h(by)g
(forking)e(the)j(whole)e(repository)g(and)g(later)i(we')o(ll)f(see)h
(if)f(it')-5 b(s)22 b(possible)e(to)g(do)g(this)g(in)h(one)396
3265 y(o)o(v)o(erall)e(repo.)-2 3293 y
SDict begin H.S end
 -2 3293 a -2 3293
a
SDict begin 13 H.A end
 -2 3293 a -2 3293 a
SDict begin [/View [/XYZ H.V]/Dest (0:4545) cvn /DEST pdfmark end
 -2 3293 a 396 3603 a Fb(6.12.6.)36
b(Pub)o(lic)e(API)1385 3603 y
SDict begin H.S end
 1385 3603 a 1385 3603 a
SDict begin 18.72 H.A end

1385 3603 a 1385 3603 a
SDict begin [/View [/XYZ H.V]/Dest (11.86.54.2) cvn /DEST pdfmark end
 1385 3603 a -2 3771 a
SDict begin H.S end
 -2 3771
a -2 3771 a
SDict begin 13 H.A end
 -2 3771 a -2 3771 a
SDict begin [/View [/XYZ H.V]/Dest (0:4547) cvn /DEST pdfmark end
 -2 3771 a 396 3877 a
Fk(The)20 b(public)f(API)i(consists)g(of)f(tw)o(o)g(classes)h(\(as)g
(we)f(sk)o(etched)g(earlier\):)-2 3895 y
SDict begin H.S end
 -2 3895 a -2
3895 a
SDict begin 13 H.A end
 -2 3895 a -2 3895 a
SDict begin [/View [/XYZ H.V]/Dest (0:4548) cvn /DEST pdfmark end
 -2 3895 a -2 3905 a
SDict begin H.S end
 -2 3905
a -2 3905 a
SDict begin 13 H.A end
 -2 3905 a -2 3905 a
SDict begin [/View [/XYZ H.V]/Dest (0:4549) cvn /DEST pdfmark end
 -2 3905 a Black 396 4047
a Fj(\225)p Black 479 4047 a
SDict begin H.S end
 479 4047 a 479 4047 a
SDict begin 13 H.A end
 479
4047 a 479 4047 a
SDict begin [/View [/XYZ H.V]/Dest (0:4550) cvn /DEST pdfmark end
 479 4047 a Fk(fmq_client:)f(pro)o(vides)f(the)i
(client)h(API,)f(with)g(methods)f(to)i(connect)e(to)h(a)h(serv)o(er)m
(,)d(con\002gure)h(the)h(client,)g(and)479 4155 y(subscribe)g(to)g
(paths.)-2 4173 y
SDict begin H.S end
 -2 4173 a -2 4173 a
SDict begin 13 H.A end
 -2 4173 a -2 4173
a
SDict begin [/View [/XYZ H.V]/Dest (0:4551) cvn /DEST pdfmark end
 -2 4173 a Black 396 4305 a Fj(\225)p Black 479 4305
a
SDict begin H.S end
 479 4305 a 479 4305 a
SDict begin 13 H.A end
 479 4305 a 479 4305 a
SDict begin [/View [/XYZ H.V]/Dest (0:4552) cvn /DEST pdfmark end
 479 4305
a Fk(fmq_serv)o(er:)e(pro)o(vides)g(the)j(serv)o(er)e(API,)h(with)h
(methods)e(to)h(bind)f(to)i(a)f(port,)g(con\002gure)e(the)i(serv)o(er)m
(,)f(and)h(publish)479 4413 y(a)h(path.)-2 4597 y
SDict begin H.S end
 -2
4597 a -2 4597 a
SDict begin 13 H.A end
 -2 4597 a -2 4597 a
SDict begin [/View [/XYZ H.V]/Dest (0:4553) cvn /DEST pdfmark end
 -2 4597 a 396 4687
a Fk(If)f(I)h(w)o(as)g(a)f(k)o(een)g(young)e(de)n(v)o(eloper)g(eager)i
(to)g(use)g(FileMQ)h(in)f(another)f(language,)f(I')l(d)i(probably)e
(spend)h(a)i(happ)o(y)396 4795 y(week)o(end)e(writing)h(a)g(binding)f
(for)g(this)i(public)f(API,)g(then)f(stick)i(it)g(in)f(a)h
(subdirectory)d(of)i(the)g(\002lemq)g(project)f(called,)396
4902 y(say)-5 b(,)20 b("bindings/",)e(and)i(mak)o(e)g(a)g(pull)g
(request.)p Black 3759 5569 a Ff(371)p Black eop end
%%Page: 372 385
TeXDict begin 372 384 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.372) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4554) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)h(actual)g(API)h(methods)e(come)g(from)g(the)i
(state)g(machine)e(description,)f(lik)o(e)j(this)f(\(for)f(the)i(serv)o
(er\):)396 253 y Fe(<method)44 b(name)g(=)h("bind">)396
350 y(<argument)f(name)g(=)g("endpoint")g(type)g(=)g("string")g(/>)396
447 y(zmq_bind)g(\(self->router,)e(endpoint\);)396 544
y(</method>)396 738 y(<method)i(name)g(=)h("publish">)396
835 y(<argument)f(name)g(=)g("location")g(type)g(=)g("string")g(/>)396
933 y(<argument)g(name)g(=)g("alias")g(type)g(=)h("string")e(/>)396
1030 y(mount_t)755 1043 y(*)800 1030 y(mount)h(=)g(mount_new)g
(\(location,)f(alias\);)396 1127 y(zlist_append)g(\(self->mounts,)g
(mount\);)396 1224 y(</method>)396 1418 y(<method)h(name)g(=)h("set)f
(anonymous">)396 1515 y(<argument)g(name)g(=)g("access")g(type)g(=)h
("number")e(/>)396 1613 y(//)90 b(Enable)43 b(anonymous)h(access)g
(without)f(a)i(config)f(file)396 1710 y(fmq_config_path_set)e
(\(self->config,)g("security/anonymous",)g(access?)h("1")i(:"0"\);)396
1807 y(</method>)-2 1896 y
SDict begin H.S end
 -2 1896 a -2 1896 a
SDict begin 13 H.A end
 -2 1896
a -2 1896 a
SDict begin [/View [/XYZ H.V]/Dest (0:4556) cvn /DEST pdfmark end
 -2 1896 a 396 2218 a Fb(6.12.7.)36 b(Design)f(Notes)1558
2218 y
SDict begin H.S end
 1558 2218 a 1558 2218 a
SDict begin 18.72 H.A end
 1558 2218 a 1558 2218
a
SDict begin [/View [/XYZ H.V]/Dest (11.86.55.2) cvn /DEST pdfmark end
 1558 2218 a -2 2411 a
SDict begin H.S end
 -2 2411 a -2 2411 a
SDict begin 13 H.A end
 -2 2411 a
-2 2411 a
SDict begin [/View [/XYZ H.V]/Dest (0:4558) cvn /DEST pdfmark end
 -2 2411 a 396 2492 a Fk(The)20 b(hardest)g(part)f(of)h
(making)f(FileMQ)i(w)o(asn')o(t)f(the)g(protocol)e(part,)i(b)n(ut)g
(maintaining)f(accurate)g(state)i(internally)-5 b(.)396
2600 y(An)20 b(FTP)h(or)f(HTTP)g(serv)o(er)g(is)h(essentially)f
(stateless.)h(But)g(a)g(publish/subscribe)d(serv)o(er)3011
2600 y
SDict begin H.S end
 3011 2600 a 3011 2600 a
SDict begin 13 H.A end
 3011 2600 a 3011 2600
a
SDict begin [/View [/XYZ H.V]/Dest (0:4559) cvn /DEST pdfmark end
 3011 2600 a Ff(has)i Fk(to)g(maintain)396 2708 y(subscriptions,)f(at)
i(least.)-2 2892 y
SDict begin H.S end
 -2 2892 a -2 2892 a
SDict begin 13 H.A end
 -2 2892 a -2 2892
a
SDict begin [/View [/XYZ H.V]/Dest (0:4560) cvn /DEST pdfmark end
 -2 2892 a 396 2982 a Fk(So)g(I')o(ll)f(go)g(through)e(some)i(of)g
(the)g(design)g(aspects:)-2 3000 y
SDict begin H.S end
 -2 3000 a -2 3000
a
SDict begin 13 H.A end
 -2 3000 a -2 3000 a
SDict begin [/View [/XYZ H.V]/Dest (0:4561) cvn /DEST pdfmark end
 -2 3000 a -2 3010 a
SDict begin H.S end
 -2 3010 a -2
3010 a
SDict begin 13 H.A end
 -2 3010 a -2 3010 a
SDict begin [/View [/XYZ H.V]/Dest (0:4562) cvn /DEST pdfmark end
 -2 3010 a Black 396 3152 a
Fj(\225)p Black 479 3152 a
SDict begin H.S end
 479 3152 a 479 3152 a
SDict begin 13 H.A end
 479
3152 a 479 3152 a
SDict begin [/View [/XYZ H.V]/Dest (0:4563) cvn /DEST pdfmark end
 479 3152 a Fk(The)g(client)g(detects)h(if)f(the)g
(serv)o(er)g(has)g(died)g(by)g(the)g(lack)g(of)g(heartbeats)f(\(HUGZ\))
h(coming)f(from)g(the)h(serv)o(er)-5 b(.)19 b(It)479
3260 y(then)h(restarts)h(its)g(dialog)e(by)h(sending)f(an)h(OHAI.)g
(There')-5 b(s)20 b(no)f(timeout)h(on)g(the)g(OHAI)g(since)h(the)f
(\330MQ)479 3368 y(DEALER)g(sock)o(et)h(will)f(queue)f(an)i(outgoing)d
(message)i(inde\002nitely)-5 b(.)-2 3386 y
SDict begin H.S end
 -2 3386 a
-2 3386 a
SDict begin 13 H.A end
 -2 3386 a -2 3386 a
SDict begin [/View [/XYZ H.V]/Dest (0:4564) cvn /DEST pdfmark end
 -2 3386 a Black 396 3517
a Fj(\225)p Black 479 3517 a
SDict begin H.S end
 479 3517 a 479 3517 a
SDict begin 13 H.A end
 479
3517 a 479 3517 a
SDict begin [/View [/XYZ H.V]/Dest (0:4565) cvn /DEST pdfmark end
 479 3517 a Fk(The)20 b(serv)o(er)f(detects)i(if)f(a)h
(client)f(has)g(died)g(by)g(its)h(lack)f(of)g(response)f(\(HUGZ-OK\))g
(to)i(a)f(heartbeat.)f(In)h(that)g(case)h(it)479 3625
y(deletes)g(all)f(state)h(for)f(the)g(client)g(including)f(its)i
(subscriptions.)-2 3643 y
SDict begin H.S end
 -2 3643 a -2 3643 a
SDict begin 13 H.A end
 -2 3643
a -2 3643 a
SDict begin [/View [/XYZ H.V]/Dest (0:4566) cvn /DEST pdfmark end
 -2 3643 a Black 396 3775 a Fj(\225)p Black
479 3775 a
SDict begin H.S end
 479 3775 a 479 3775 a
SDict begin 13 H.A end
 479 3775 a 479 3775
a
SDict begin [/View [/XYZ H.V]/Dest (0:4567) cvn /DEST pdfmark end
 479 3775 a Fk(The)f(client)g(API)h(holds)f(subscriptions)e(in)j
(memory)d(and)i(replays)f(them)h(when)g(it)h(has)f(connected)e
(successfully)-5 b(.)479 3883 y(This)21 b(means)f(the)g(called)g(can)g
(subscribe)f(at)i(an)o(y)e(time)i(\(and)e(doesn')o(t)f(care)i(when)g
(connections)e(and)479 3990 y(authentication)g(actually)i(happen\).)-2
4008 y
SDict begin H.S end
 -2 4008 a -2 4008 a
SDict begin 13 H.A end
 -2 4008 a -2 4008 a
SDict begin [/View [/XYZ H.V]/Dest (0:4568) cvn /DEST pdfmark end
 -2 4008
a Black 396 4140 a Fj(\225)p Black 479 4140 a
SDict begin H.S end
 479 4140
a 479 4140 a
SDict begin 13 H.A end
 479 4140 a 479 4140 a
SDict begin [/View [/XYZ H.V]/Dest (0:4569) cvn /DEST pdfmark end
 479 4140 a Fk(The)g(serv)o(er)f(and)
h(client)g(use)h(virtual)e(paths,)h(much)f(lik)o(e)i(an)f(HTTP)g(or)g
(FTP)h(serv)o(er)-5 b(.)19 b(Y)-9 b(ou)20 b(publish)f(one)h(or)g(more)
479 4248 y("mount)f(points")h(each)g(corresponding)c(to)21
b(a)f(directory)f(on)h(the)g(serv)o(er)-5 b(.)19 b(Each)h(of)g(these)g
(maps)g(to)h(some)f(virtual)479 4356 y(path,)g(for)f(instance)h("/")h
(if)f(you)f(ha)n(v)o(e)h(only)f(one)h(mount)f(point.)g(Clients)i(then)f
(subscribe)f(to)i(virtual)e(paths,)h(and)479 4464 y(\002les)h(arri)n(v)
o(e)e(in)i(an)f(inbox)f(directory)-5 b(.)18 b(W)-7 b(e)21
b(don')o(t)e(send)g(physical)h(\002le)g(names)g(across)g(the)h(netw)o
(ork.)-2 4482 y
SDict begin H.S end
 -2 4482 a -2 4482 a
SDict begin 13 H.A end
 -2 4482 a -2 4482
a
SDict begin [/View [/XYZ H.V]/Dest (0:4570) cvn /DEST pdfmark end
 -2 4482 a Black 396 4613 a Fj(\225)p Black 479 4613
a
SDict begin H.S end
 479 4613 a 479 4613 a
SDict begin 13 H.A end
 479 4613 a 479 4613 a
SDict begin [/View [/XYZ H.V]/Dest (0:4571) cvn /DEST pdfmark end
 479 4613
a Fk(There)e(are)h(some)f(timing)h(issues:)g(if)g(the)g(serv)o(er)f(is)
i(creating)e(its)h(mount)f(points,)g(while)h(clients)g(are)f(connected)
f(and)479 4721 y(subscribing,)h(the)h(subscriptions)f(w)o(on')o(t)g
(attach)h(to)g(the)g(right)g(mount)f(points.)g(So,)i(we)f(bind)g(the)g
(serv)o(er)f(port)h(as)479 4829 y(last)h(thing.)-2 4847
y
SDict begin H.S end
 -2 4847 a -2 4847 a
SDict begin 13 H.A end
 -2 4847 a -2 4847 a
SDict begin [/View [/XYZ H.V]/Dest (0:4572) cvn /DEST pdfmark end
 -2 4847 a Black
396 4978 a Fj(\225)p Black 479 4978 a
SDict begin H.S end
 479 4978 a 479
4978 a
SDict begin 13 H.A end
 479 4978 a 479 4978 a
SDict begin [/View [/XYZ H.V]/Dest (0:4573) cvn /DEST pdfmark end
 479 4978 a Fk(Clients)g(can)f(reconnect)f
(at)h(an)o(y)g(point;)f(if)i(the)f(client)g(sends)h(OHAI,)f(that)g
(signals)g(the)g(end)g(of)g(an)o(y)f(pre)n(vious)479
5086 y(con)m(v)o(ersation)f(and)h(the)i(start)f(of)g(a)h(ne)n(w)f(one.)
f(I)i(might)e(one)h(day)f(mak)o(e)h(subscriptions)f(durable)g(so)h
(that)h(the)o(y)p Black 3759 5569 a Ff(372)p Black eop
end
%%Page: 373 386
TeXDict begin 373 385 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.373) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 479 72 a Fk(survi)n(v)o(e)g(a)i(disconnection.)c(The)j(client)h
(stack,)f(after)f(reconnecting,)f(replays)h(an)o(y)h(subscriptions)f
(the)h(caller)479 180 y(application)f(already)g(made.)-2
240 y
SDict begin H.S end
 -2 240 a -2 240 a
SDict begin 13 H.A end
 -2 240 a -2 240 a
SDict begin [/View [/XYZ H.V]/Dest (0:4574) cvn /DEST pdfmark end
 -2 240 a 396
550 a Fb(6.12.8.)36 b(Reliabilty)1324 550 y
SDict begin H.S end
 1324 550
a 1324 550 a
SDict begin 18.72 H.A end
 1324 550 a 1324 550 a
SDict begin [/View [/XYZ H.V]/Dest (11.86.56.2) cvn /DEST pdfmark end
 1324 550 a -2 741
a
SDict begin H.S end
 -2 741 a -2 741 a
SDict begin 13 H.A end
 -2 741 a -2 741 a
SDict begin [/View [/XYZ H.V]/Dest (0:4576) cvn /DEST pdfmark end
 -2 741 a 396 824
a Fk(As)21 b(it)g(stands,)f(FileMQ)h(implements)e(the)h(classic)h
(\330MQ)g(publish-subscribe)c(pattern.)i(That)h(is,)h(clients)g(recei)n
(v)o(e)e(a)396 932 y(stream)h(of)g(updates)g(b)n(ut)g(with)g(no)g
(guarantees)f(about)g(o)o(v)o(erall)g(consistenc)o(y)-5
b(.)18 b(T)-7 b(o)20 b(mak)o(e)g(FileMQ)h(reliable)f(we')l(d)f(ha)n(v)o
(e)396 1040 y(to)i(add)e(some)h(functionality:)-2 1058
y
SDict begin H.S end
 -2 1058 a -2 1058 a
SDict begin 13 H.A end
 -2 1058 a -2 1058 a
SDict begin [/View [/XYZ H.V]/Dest (0:4577) cvn /DEST pdfmark end
 -2 1058 a -2
1068 a
SDict begin H.S end
 -2 1068 a -2 1068 a
SDict begin 13 H.A end
 -2 1068 a -2 1068 a
SDict begin [/View [/XYZ H.V]/Dest (0:4578) cvn /DEST pdfmark end
 -2 1068
a Black 396 1210 a Fj(\225)p Black 479 1210 a
SDict begin H.S end
 479 1210
a 479 1210 a
SDict begin 13 H.A end
 479 1210 a 479 1210 a
SDict begin [/View [/XYZ H.V]/Dest (0:4579) cvn /DEST pdfmark end
 479 1210 a Fk(A)h(w)o(ay)f(for)g
(clients)g(to)h(request)e(all)i(patches)f(since)g(a)h(certain)e(time)i
(\(possibly)-5 b(,)18 b(all)j(patches\).)-2 1228 y
SDict begin H.S end
 -2
1228 a -2 1228 a
SDict begin 13 H.A end
 -2 1228 a -2 1228 a
SDict begin [/View [/XYZ H.V]/Dest (0:4580) cvn /DEST pdfmark end
 -2 1228 a Black
396 1359 a Fj(\225)p Black 479 1359 a
SDict begin H.S end
 479 1359 a 479
1359 a
SDict begin 13 H.A end
 479 1359 a 479 1359 a
SDict begin [/View [/XYZ H.V]/Dest (0:4581) cvn /DEST pdfmark end
 479 1359 a Fk(A)g(w)o(ay)f(for)g(the)g
(serv)o(er)f(to)i(store)f(patches)g(and)f(subscriptions)g(persistently)
-5 b(.)-2 1419 y
SDict begin H.S end
 -2 1419 a -2 1419 a
SDict begin 13 H.A end
 -2 1419 a -2 1419
a
SDict begin [/View [/XYZ H.V]/Dest (0:4582) cvn /DEST pdfmark end
 -2 1419 a 396 1729 a Fb(6.12.9.)36 b(Con\002guration)1578
1729 y
SDict begin H.S end
 1578 1729 a 1578 1729 a
SDict begin 18.72 H.A end
 1578 1729 a 1578 1729
a
SDict begin [/View [/XYZ H.V]/Dest (11.86.57.2) cvn /DEST pdfmark end
 1578 1729 a -2 1922 a
SDict begin H.S end
 -2 1922 a -2 1922 a
SDict begin 13 H.A end
 -2 1922 a
-2 1922 a
SDict begin [/View [/XYZ H.V]/Dest (0:4584) cvn /DEST pdfmark end
 -2 1922 a 396 2003 a Fk(I')l(v)o(e)19 b(written)h(man)o(y)f
(serv)o(ers,)h(lik)o(e)g(the)g(Xitami)h(web)f(serv)o(er)f(that)h(w)o
(as)h(popular)e(in)h(the)g(late)h(90')-5 b(s,)20 b(and)f(the)396
2111 y(OpenAMQ)h(messaging)f(serv)o(er)-5 b(.)19 b(Getting)h
(con\002guration)e(easy)i(and)g(ob)o(vious)e(w)o(as)j(a)g(lar)o(ge)e
(part)h(of)g(making)e(these)396 2219 y(serv)o(ers)i(fun)f(to)i(use.)-2
2386 y
SDict begin H.S end
 -2 2386 a -2 2386 a
SDict begin 13 H.A end
 -2 2386 a -2 2386 a
SDict begin [/View [/XYZ H.V]/Dest (0:4585) cvn /DEST pdfmark end
 -2 2386
a 396 2493 a Fk(W)-7 b(e)22 b(typically)d(aim)h(to)h(solv)o(e)e(a)i
(number)d(of)i(problems:)-2 2511 y
SDict begin H.S end
 -2 2511 a -2 2511
a
SDict begin 13 H.A end
 -2 2511 a -2 2511 a
SDict begin [/View [/XYZ H.V]/Dest (0:4586) cvn /DEST pdfmark end
 -2 2511 a -2 2521 a
SDict begin H.S end
 -2 2521 a -2
2521 a
SDict begin 13 H.A end
 -2 2521 a -2 2521 a
SDict begin [/View [/XYZ H.V]/Dest (0:4587) cvn /DEST pdfmark end
 -2 2521 a Black 396 2663 a
Fj(\225)p Black 479 2663 a
SDict begin H.S end
 479 2663 a 479 2663 a
SDict begin 13 H.A end
 479
2663 a 479 2663 a
SDict begin [/View [/XYZ H.V]/Dest (0:4588) cvn /DEST pdfmark end
 479 2663 a Fk(Ship)g(def)o(ault)g(con\002guration)d
(\002les)k(with)g(the)f(product.)-2 2681 y
SDict begin H.S end
 -2 2681 a
-2 2681 a
SDict begin 13 H.A end
 -2 2681 a -2 2681 a
SDict begin [/View [/XYZ H.V]/Dest (0:4589) cvn /DEST pdfmark end
 -2 2681 a Black 396 2813
a Fj(\225)p Black 479 2813 a
SDict begin H.S end
 479 2813 a 479 2813 a
SDict begin 13 H.A end
 479
2813 a 479 2813 a
SDict begin [/View [/XYZ H.V]/Dest (0:4590) cvn /DEST pdfmark end
 479 2813 a Fk(Allo)n(w)h(users)f(to)g(add)g(custom)f
(con\002guration)f(\002les)j(that)f(are)h(ne)n(v)o(er)d(o)o(v)o
(erwritten.)-2 2831 y
SDict begin H.S end
 -2 2831 a -2 2831 a
SDict begin 13 H.A end
 -2 2831 a -2
2831 a
SDict begin [/View [/XYZ H.V]/Dest (0:4591) cvn /DEST pdfmark end
 -2 2831 a Black 396 2962 a Fj(\225)p Black 479
2962 a
SDict begin H.S end
 479 2962 a 479 2962 a
SDict begin 13 H.A end
 479 2962 a 479 2962 a
SDict begin [/View [/XYZ H.V]/Dest (0:4592) cvn /DEST pdfmark end
 479
2962 a Fk(Allo)n(w)j(users)f(to)g(con\002gure)f(from)g(the)h
(command-line.)-2 3146 y
SDict begin H.S end
 -2 3146 a -2 3146 a
SDict begin 13 H.A end
 -2 3146
a -2 3146 a
SDict begin [/View [/XYZ H.V]/Dest (0:4593) cvn /DEST pdfmark end
 -2 3146 a 396 3236 a Fk(And)f(then)g(layer)g(these)h(one)e
(on)h(the)h(other)m(,)e(so)i(command-line)c(settings)k(o)o(v)o(erride)d
(custom)i(settings,)g(which)g(o)o(v)o(erride)396 3344
y(def)o(ault)h(settings.)g(It)g(can)g(be)h(a)f(lot)h(of)f(w)o(ork)f(to)
h(do)g(this)h(right.)e(F)o(or)h(FileMQ)h(I')l(v)o(e)e(tak)o(en)h(a)g
(some)n(what)f(simpler)h(tack:)396 3452 y(all)h(con\002guration)d(is)j
(done)e(from)g(the)h(API.)-2 3636 y
SDict begin H.S end
 -2 3636 a -2 3636
a
SDict begin 13 H.A end
 -2 3636 a -2 3636 a
SDict begin [/View [/XYZ H.V]/Dest (0:4594) cvn /DEST pdfmark end
 -2 3636 a 396 3726 a Fk(So)h(this)f(is)i(ho)n(w)d
(we)i(start)f(and)g(con\002gure)e(the)j(serv)o(er)m(,)d(for)i(e)o
(xample:)-2 3827 y
SDict begin H.S end
 -2 3827 a -2 3827 a
SDict begin 11.7 H.A end
 -2 3827 a -2 3827
a
SDict begin [/View [/XYZ H.V]/Dest (0:4595) cvn /DEST pdfmark end
 -2 3827 a 396 3906 a Fe(server)44 b(=)h(fmq_server_new)d(\(\);)396
4003 y(fmq_server_configure)g(\(server,)h("server_test.cfg"\);)396
4100 y(fmq_server_publish)f(\(server,)i("./fmqroot/send",)e("/"\);)396
4197 y(fmq_server_publish)g(\(server,)i("./fmqroot/logs",)e("/logs"\);)
396 4294 y(fmq_server_bind)h(\(server,)g("tcp://)1832
4307 y(*)1877 4294 y(:6000"\);)-2 4472 y
SDict begin H.S end
 -2 4472 a -2
4472 a
SDict begin 13 H.A end
 -2 4472 a -2 4472 a
SDict begin [/View [/XYZ H.V]/Dest (0:4596) cvn /DEST pdfmark end
 -2 4472 a 396 4568 a Fk(W)-7
b(e)21 b(do)f(use)g(a)h(speci\002c)f(format)f(for)g(the)h(con\002g)f
(\002les,)i(which)e(is)2280 4568 y
SDict begin H.S end
 2280 4568 a 2280 4568
a
SDict begin 13 H.A end
 2280 4568 a 2280 4568 a
SDict begin [/View [/XYZ H.V]/Dest (0:4597) cvn /DEST pdfmark end
 2280 4568 a Fk(ZPL)h(\(http://rfc.zeromq.or)o
(g/spec:4\))o(,)15 b(a)20 b(minimalist)396 4676 y(syntax)g(that)g(we)h
(started)f(using)f(for)h(\330MQ)g("de)n(vices")g(a)g(fe)n(w)h(years)e
(ago,)h(b)n(ut)g(which)g(w)o(orks)g(well)g(for)g(an)o(y)f(serv)o(er:)-2
4777 y
SDict begin H.S end
 -2 4777 a -2 4777 a
SDict begin 11.7 H.A end
 -2 4777 a -2 4777 a
SDict begin [/View [/XYZ H.V]/Dest (0:4598) cvn /DEST pdfmark end
 -2 4777
a 396 4857 a Fe(#)135 b(Configure)43 b(server)h(for)g(plain)g(access)
396 4954 y(#)396 5051 y(server)576 5148 y(monitor)f(=)i(1)583
b(#)134 b(Check)44 b(mount)g(points)p Black 3759 5569
a Ff(373)p Black eop end
%%Page: 374 387
TeXDict begin 374 386 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.374) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 576 72 a Fe(heartbeat)43 b(=)i(1)493 b(#)134 b(Heartbeat)43
b(to)i(clients)396 267 y(publish)576 364 y(location)e(=)i
(./fmqroot/logs)576 461 y(virtual)e(=)i(/logs)396 655
y(security)576 752 y(echo)f(=)g(I:)h(use)f(guest/guest)f(to)i(login)f
(to)g(server)576 850 y(#)134 b(These)44 b(are)g(SASL)g(mechanisms)g(we)
g(accept)576 947 y(anonymous)f(=)i(0)576 1044 y(plain)f(=)g(1)755
1141 y(account)934 1238 y(login)g(=)h(guest)934 1335
y(password)f(=)g(guest)934 1432 y(group)g(=)h(guest)755
1530 y(account)934 1627 y(login)f(=)h(super)934 1724
y(password)f(=)g(secret)934 1821 y(group)g(=)h(admin)-2
1998 y
SDict begin H.S end
 -2 1998 a -2 1998 a
SDict begin 13 H.A end
 -2 1998 a -2 1998 a
SDict begin [/View [/XYZ H.V]/Dest (0:4599) cvn /DEST pdfmark end
 -2 1998
a 396 2095 a Fk(One)20 b(cute)g(thing)g(\(which)f(seems)i(useful\))e
(the)h(generated)f(serv)o(er)g(code)h(does)g(is)h(to)f(parse)g(this)h
(con\002g)e(\002le)i(\(when)e(you)396 2203 y(use)i(the)f(fmq_serv)o
(er_con\002gure\()o(\))15 b(method\))j(and)i(e)o(x)o(ecute)f(an)o(y)g
(section)h(that)g(matches)g(an)g(API)h(method.)d(Thus)i(the)396
2311 y('publish')f(section)h(w)o(orks)g(as)h(a)f(fmq_serv)o
(er_publish\(\))15 b(method.)-2 2422 y
SDict begin H.S end
 -2 2422 a -2 2422
a
SDict begin 13 H.A end
 -2 2422 a -2 2422 a
SDict begin [/View [/XYZ H.V]/Dest (0:4600) cvn /DEST pdfmark end
 -2 2422 a 359 x Fn(6.13.)39 b(File)g(Stability)
1204 2781 y
SDict begin H.S end
 1204 2781 a 1204 2781 a
SDict begin 22.464 H.A end
 1204 2781 a 1204
2781 a
SDict begin [/View [/XYZ H.V]/Dest (11.87.1) cvn /DEST pdfmark end
 1204 2781 a -2 2977 a
SDict begin H.S end
 -2 2977 a -2 2977 a
SDict begin 13 H.A end
 -2 2977
a -2 2977 a
SDict begin [/View [/XYZ H.V]/Dest (0:4602) cvn /DEST pdfmark end
 -2 2977 a 396 3055 a Fk(It)20 b(is)h(quite)f(common)e(to)i
(poll)g(a)g(directory)e(for)i(changes)f(and)g(then)g(do)h(something)e
('interesting')h(with)h(ne)n(w)g(\002les.)g(But)396 3163
y(as)h(one)f(process)g(is)h(writing)e(to)i(a)f(\002le,)h(other)e
(processes)h(ha)n(v)o(e)g(no)f(idea)i(when)e(the)h(\002le)h(has)g(been)
e(fully)h(written.)f(One)396 3271 y(solution)h(is)h(to)f(add)g(a)g
(second)g("indicator")e(\002le)j(which)f(we)g(create)g(after)g
(creating)f(the)h(\002rst)h(\002le.)g(This)f(is)i(intrusi)n(v)o(e,)396
3379 y(ho)n(we)n(v)o(er)-5 b(.)-2 3546 y
SDict begin H.S end
 -2 3546 a -2
3546 a
SDict begin 13 H.A end
 -2 3546 a -2 3546 a
SDict begin [/View [/XYZ H.V]/Dest (0:4603) cvn /DEST pdfmark end
 -2 3546 a 396 3653 a Fk(There)20
b(is)h(a)f(neater)g(w)o(ay)-5 b(,)20 b(which)f(is)i(to)g(detect)f(when)
f(a)i(\002le)g(is)g("stable",)f(i.e.)g(no-one)e(is)j(writing)f(to)g(it)
h(an)o(y)f(longer)-5 b(.)396 3761 y(FileMQ)21 b(does)f(this)h(by)e
(checking)g(the)h(modi\002cation)f(time)h(of)g(the)g(\002le.)h(If)f
(it')-5 b(s)21 b(more)e(than)h(a)h(second)e(old,)h(then)f(the)396
3869 y(\002le)i(is)g(considered)e(stable,)h(at)h(least)f(stable)h
(enough)d(to)i(be)h(shipped)e(of)n(f)g(to)h(clients.)h(If)f(a)g
(process)g(comes)g(along)f(after)396 3977 y(\002)n(v)o(e)h(minutes)g
(and)g(appends)e(to)j(the)f(\002le,)h(it')o(ll)f(be)h(shipped)e(of)n(f)
g(again.)-2 4161 y
SDict begin H.S end
 -2 4161 a -2 4161 a
SDict begin 13 H.A end
 -2 4161 a -2 4161
a
SDict begin [/View [/XYZ H.V]/Dest (0:4604) cvn /DEST pdfmark end
 -2 4161 a 396 4251 a Fk(F)o(or)h(this)h(to)f(w)o(ork,)f(and)h(this)h
(is)g(a)g(requirement)c(for)j(an)o(y)f(application)g(hoping)g(to)h(use)
g(FileMQ)h(successfully)-5 b(,)19 b(do)h(not)396 4359
y(b)n(uf)n(fer)f(more)g(than)h(a)h(second')-5 b(s)19
b(w)o(orth)h(of)g(data)g(in)g(memory)f(before)g(writing.)g(If)h(you)f
(use)i(v)o(ery)e(lar)o(ge)g(block)g(sizes,)396 4467 y(the)h(\002le)h
(may)f(look)f(stable)i(when)e(it')-5 b(s)22 b(not.)-2
4495 y
SDict begin H.S end
 -2 4495 a -2 4495 a
SDict begin 13 H.A end
 -2 4495 a -2 4495 a
SDict begin [/View [/XYZ H.V]/Dest (0:4605) cvn /DEST pdfmark end
 -2 4495
a Black 3759 5569 a Ff(374)p Black eop end
%%Page: 375 388
TeXDict begin 375 387 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.375) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black -2 94 a Fn(6.14.)39 b(T)-9 b(est)39 b(Use)g(Case)1330
94 y
SDict begin H.S end
 1330 94 a 1330 94 a
SDict begin 22.464 H.A end
 1330 94 a 1330 94 a
SDict begin [/View [/XYZ H.V]/Dest (11.88.1) cvn /DEST pdfmark end
 1330 94
a -2 262 a
SDict begin H.S end
 -2 262 a -2 262 a
SDict begin 13 H.A end
 -2 262 a -2 262 a
SDict begin [/View [/XYZ H.V]/Dest (0:4607) cvn /DEST pdfmark end
 -2 262
a 396 368 a Fk(T)-7 b(o)21 b(properly)d(test)j(something)d(lik)o(e)j
(FileMQ)g(we)f(need)g(a)g(test)h(case)g(that)f(plays)g(with)h(li)n(v)o
(e)f(data.)f(One)h(of)g(my)g(ongoing)396 476 y(chores)g(is)h(to)f
(manage)f(the)h(MP3)h(tracks)f(on)f(my)h(music)g(player)m(,)f(which)h
(is)h(a)f(Sansa)h(Clip)g(re\003ashed)e(with)h(Rock)g(Box)396
584 y(\(highly)d(recommended\).)e(As)k(I)g(do)n(wnload)e(tracks)h(into)
g(my)h(Music)f(folder)g(I)g(w)o(ant)h(to)g(cop)o(y)f(these)g(to)h(my)f
(player)m(,)f(and)396 692 y(as)k(I)f(\002nd)g(tracks)g(that)g(anno)o(y)
e(me,)i(I)g(delete)g(them)g(in)g(the)g(Music)g(folder)f(and)g(w)o(ant)h
(those)g(gone)f(from)g(my)g(player)g(too.)-2 876 y
SDict begin H.S end
 -2
876 a -2 876 a
SDict begin 13 H.A end
 -2 876 a -2 876 a
SDict begin [/View [/XYZ H.V]/Dest (0:4608) cvn /DEST pdfmark end
 -2 876 a 396 966 a Fk(This)i(is)g
(kind)e(of)h(o)o(v)o(er)n(-kill)f(for)g(a)i(po)n(werful)d(\002le)j
(distrib)n(ution)e(protocol.)f(I)j(could)e(write)h(this)h(using)f(a)g
(bash)g(or)g(Perl)396 1074 y(script)g(b)n(ut)h(to)f(be)g(honest)g(the)g
(hardest)f(w)o(ork)h(in)g(FileMQ)h(w)o(as)g(the)f(directory)f
(comparison)f(code,)h(and)h(I)g(w)o(ant)g(to)396 1182
y(bene\002t)g(from)f(that.)h(So)h(I)f(put)g(together)f(a)h(simple)g
(tool)g(called)g("track")g(which)g(calls)g(the)h(FileMQ)f(API.)h(From)e
(the)396 1290 y(command)f(line)j(this)f(runs)g(with)h(tw)o(o)f(ar)o
(guments;)e(the)i(sending)f(and)h(the)g(recei)n(ving)f(directories:)-2
1391 y
SDict begin H.S end
 -2 1391 a -2 1391 a
SDict begin 11.7 H.A end
 -2 1391 a -2 1391 a
SDict begin [/View [/XYZ H.V]/Dest (0:4609) cvn /DEST pdfmark end
 -2 1391
a 396 1470 a Fe(./track)44 b(/home/ph/Music)e(/media/3230-6364/MUSIC)-2
1647 y
SDict begin H.S end
 -2 1647 a -2 1647 a
SDict begin 13 H.A end
 -2 1647 a -2 1647 a
SDict begin [/View [/XYZ H.V]/Dest (0:4610) cvn /DEST pdfmark end
 -2 1647
a 396 1744 a Fk(The)20 b(code)g(is)h(a)f(neat)g(e)o(xample)f(of)h(ho)n
(w)g(to)g(use)h(the)f(FileMQ)g(API)h(to)f(do)g(local)g(\002le)h
(distrib)n(ution.)e(Here)h(is)h(the)f(full)396 1852 y(program,)e(minus)
i(the)g(license)g(te)o(xt)g(\(it')-5 b(s)21 b(MIT/X11)e(licensed\):)-2
1953 y
SDict begin H.S end
 -2 1953 a -2 1953 a
SDict begin 11.7 H.A end
 -2 1953 a -2 1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:4611) cvn /DEST pdfmark end
 -2 1953
a 396 2032 a Fe(#include)44 b("czmq.h")396 2129 y(#include)g
("../include/fmq.h")396 2323 y(int)h(main)f(\(int)g(argc,)g(char)1517
2336 y(*)1562 2323 y(argv)g([]\))396 2420 y({)576 2518
y(if)g(\(argc)g(<)h(3\))f({)755 2615 y(puts)g(\("usage:)g(track)g
(original-directory)d(tracking-directory"\);)755 2712
y(return)j(0;)576 2809 y(})576 2906 y(fmq_server_t)1158
2919 y(*)1203 2906 y(server)g(=)h(fmq_server_new)d(\(\);)576
3003 y(fmq_server_configure)f(\(server,)j("anonymous.cfg"\);)576
3100 y(fmq_server_publish)d(\(server,)j(argv)g([1],)g("/"\);)576
3197 y(fmq_server_set_anonymous)c(\(server,)k(true\);)576
3295 y(fmq_server_bind)e(\(server,)h("tcp://)2011 3308
y(*)2056 3295 y(:6000"\);)576 3489 y(fmq_client_t)1158
3502 y(*)1203 3489 y(client)h(=)h(fmq_client_new)d(\(\);)576
3586 y(fmq_client_connect)131 b(\(client,)44 b
("tcp://localhost:6000"\);)576 3683 y(fmq_client_set_inbox)d(\(client,)
j(argv)g([2]\);)576 3780 y(fmq_client_subscribe)d(\(client,)j("/"\);)
576 3975 y(while)g(\(!zctx_interrupted\))755 4072 y(sleep)g(\(1\);)576
4169 y(puts)g(\("interrupted"\);)576 4363 y(fmq_server_destroy)d
(\(&server\);)576 4460 y(fmq_client_destroy)g(\(&client\);)576
4557 y(return)i(0;)396 4655 y(})-2 4829 y
SDict begin H.S end
 -2 4829 a -2
4829 a
SDict begin 13 H.A end
 -2 4829 a -2 4829 a
SDict begin [/View [/XYZ H.V]/Dest (0:4612) cvn /DEST pdfmark end
 -2 4829 a 396 4928 a Fk(Note)20
b(ho)n(w)g(we)h(w)o(ork)e(with)i(physical)e(paths)h(in)g(this)h(tool.)e
(The)h(serv)o(er)g(publishes)f(the)h(physical)f(path)396
5036 y("/home/ph/Music")f(and)i(maps)g(this)g(to)h(the)f(virtual)f
(path)h("/".)h(The)e(client)i(subscribes)e(to)i("/")f(and)g(recei)n(v)o
(es)f(all)i(\002les)p Black 3759 5569 a Ff(375)p Black
eop end
%%Page: 376 389
TeXDict begin 376 388 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.376) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2917 -132 a Ff(Chapter)20 b(6.)g(The)g(Human)f(Scale)p
Black 396 72 a Fk(in)i("/media/3230-6364/MUSIC".)15 b(I)20
b(could)f(use)i(an)o(y)e(structure)g(within)h(the)h(serv)o(er)e
(directory)-5 b(,)18 b(and)h(it)i(w)o(ould)f(be)396 180
y(copied)f(f)o(aithfully)g(to)i(the)f(client')-5 b(s)20
b(inbox.)p Black 3757 5569 a Ff(376)p Black eop end
%%Page: 377 390
TeXDict begin 377 389 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.377) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:4613) cvn /DEST pdfmark end
 -2 -11 a 130 x Fh(Chapter)48 b(7.)f(The)h(\330MQ)h(Comm)m(unity)2644
119 y
SDict begin H.S end
 2644 119 a 2644 119 a
SDict begin 26.957 H.A end
 2644 119 a 2644 119 a
SDict begin [/View [/XYZ H.V]/Dest (12.0) cvn /DEST pdfmark end
 2644
119 a -2 375 a
SDict begin H.S end
 -2 375 a -2 375 a
SDict begin 13 H.A end
 -2 375 a -2 375 a
SDict begin [/View [/XYZ H.V]/Dest (0:4615) cvn /DEST pdfmark end
 -2
375 a 396 447 a Fk(People)20 b(sometimes)g(ask)g(what')-5
b(s)21 b(special)f(about)f(\330MQ.)i(My)f(standard)f(answer)h(is,)g
(it')-5 b(s)22 b(true)e(that)g(\330MQ)g(is)h(ar)o(guably)396
555 y(the)f(best)g(answer)g(we)g(ha)n(v)o(e)f(to)h(the)g(v)o(e)o(xing)e
(question)h(of)g("ho)n(w)h(do)f(we)h(mak)o(e)g(the)g(distrib)n(uted)f
(softw)o(are)g(that)h(the)g(21st)396 663 y(century)e(demands?")h(b)n
(ut)g(more)g(than)g(that,)h(\330MQ)g(is)h(special)e(because)g(of)h(its)
g(community)-5 b(.)17 b(This)j(is)h(ultimately)e(what)396
771 y(separates)h(the)g(w)o(olv)o(es)g(from)g(the)g(sheep.)-2
955 y
SDict begin H.S end
 -2 955 a -2 955 a
SDict begin 13 H.A end
 -2 955 a -2 955 a
SDict begin [/View [/XYZ H.V]/Dest (0:4616) cvn /DEST pdfmark end
 -2 955 a 396
1045 a Fk(There)g(are)g(three)f(main)h(open)f(source)h(patterns.)f
(One,)h(the)g(lar)o(ge)f(\002rm)i(dumping)d(code)h(to)h(break)g(the)g
(mark)o(et)f(for)396 1153 y(others.)h(This)g(is)h(the)f(Apache)g(F)o
(oundation)d(model.)j(T)-7 b(w)o(o,)20 b(tin)o(y)f(teams)i(or)f(small)g
(\002rms)h(b)n(uilding)e(their)h(dream.)f(This)396 1261
y(is)i(the)g(most)f(common)e(open)h(source)h(model,)f(and)g(it)i(can)f
(be)g(v)o(ery)g(successful)f(commercially)-5 b(.)18 b(Three,)h
(aggressi)n(v)o(e)396 1369 y(and)h(di)n(v)o(erse)f(communities)g(that)h
(sw)o(arm)g(o)o(v)o(er)f(a)i(problem)d(landscape.)h(This)h(is)i(the)e
(Linux)f(model,)g(and)h(the)g(one)f(we)396 1477 y(aspire)h(to)h(with)f
(\330MQ.)-2 1661 y
SDict begin H.S end
 -2 1661 a -2 1661 a
SDict begin 13 H.A end
 -2 1661 a -2 1661
a
SDict begin [/View [/XYZ H.V]/Dest (0:4617) cvn /DEST pdfmark end
 -2 1661 a 396 1751 a Fk(It')-5 b(s)21 b(hard)e(to)i(o)o(v)o(er)n
(-emphasize)c(the)j(po)n(wer)f(and)h(persistence)g(of)f(a)i(w)o(orking)
e(open)g(source)g(community)-5 b(.)18 b(There)h(really)396
1858 y(does)h(not)g(seem)g(to)h(be)f(a)h(better)e(w)o(ay)i(of)e(making)
g(softw)o(are)h(for)g(the)g(long)f(term.)h(Not)g(only)g(does)f(the)i
(community)396 1966 y(choose)f(the)g(best)g(problems)f(to)h(solv)o(e,)g
(it)h(solv)o(es)f(them)g(minimally)-5 b(,)18 b(carefully)-5
b(,)18 b(and)i(it)h(then)f(looks)f(after)h(these)396
2074 y(answers)g(for)g(years,)g(decades,)f(until)h(the)o(y')l(re)e(no)i
(longer)f(rele)n(v)n(ant,)g(and)g(then)h(it)h(quietly)f(puts)g(them)f
(a)o(w)o(ay)-5 b(.)-2 2258 y
SDict begin H.S end
 -2 2258 a -2 2258 a
SDict begin 13 H.A end
 -2 2258
a -2 2258 a
SDict begin [/View [/XYZ H.V]/Dest (0:4618) cvn /DEST pdfmark end
 -2 2258 a 396 2348 a Fk(T)e(o)21 b(really)e(bene\002t)h
(from)f(\330MQ,)h(you)g(need)f(to)i(understand)d(the)i(community)-5
b(.)17 b(At)k(some)f(stage)g(you')o(ll)g(w)o(ant)g(to)396
2456 y(submit)g(a)h(patch,)e(an)h(issue,)h(an)f(add-on.)e(Y)-9
b(ou)19 b(might)h(w)o(ant)g(to)h(ask)f(someone)f(for)h(help.)f(Y)-9
b(ou)20 b(will)h(probably)c(w)o(ant)k(to)396 2564 y(bet)f(a)h(part)f
(of)g(your)f(b)n(usiness)h(on)g(\330MQ,)g(and)g(when)f(I)i(tell)g(you)e
(that)h(the)g(community)e(is)k(much,)d(much)g(more)396
2672 y(important)f(than)i(the)g(compan)o(y)d(which)i(backs)h(the)f
(product,)f(e)n(v)o(en)h(though)f(I'm)h(CEO)h(of)g(that)g(compan)o(y)-5
b(,)16 b(this)21 b(should)396 2780 y(be)f(signi\002cant.)-2
2964 y
SDict begin H.S end
 -2 2964 a -2 2964 a
SDict begin 13 H.A end
 -2 2964 a -2 2964 a
SDict begin [/View [/XYZ H.V]/Dest (0:4619) cvn /DEST pdfmark end
 -2 2964
a 396 3054 a Fk(In)g(this)h(chapter)e(I'm)h(going)e(to)j(look)e(at)i
(our)e(community)f(from)h(se)n(v)o(eral)h(angles,)g(and)f(conclude)g
(by)h(e)o(xplaining)e(in)396 3162 y(detail)i(our)g(contract)f(for)h
(collaboration,)d(which)1842 3162 y
SDict begin H.S end
 1842 3162 a 1842
3162 a
SDict begin 13 H.A end
 1842 3162 a 1842 3162 a
SDict begin [/View [/XYZ H.V]/Dest (0:4620) cvn /DEST pdfmark end
 1842 3162 a Fk(we)j(call)h("C4")f
(\(http://rfc.zeromq.or)o(g/spec:16)o(\).)14 b(Y)-9 b(ou)20
b(should)f(\002nd)396 3270 y(the)h(discussion)g(useful)g(for)f(your)g
(o)n(wn)h(w)o(ork.)f(W)-7 b(e')l(v)o(e)20 b(also)h(adapted)e(the)h
(\330MQ)g(C4)h(process)f(for)f(closed)h(source)396 3378
y(projects,)g(with)g(good)f(success.)-2 3562 y
SDict begin H.S end
 -2 3562
a -2 3562 a
SDict begin 13 H.A end
 -2 3562 a -2 3562 a
SDict begin [/View [/XYZ H.V]/Dest (0:4621) cvn /DEST pdfmark end
 -2 3562 a 396 3652 a
Fk(W)-7 b(e')o(ll)22 b(co)o(v)o(er:)-2 3653 y
SDict begin H.S end
 -2 3653
a -2 3653 a
SDict begin 13 H.A end
 -2 3653 a -2 3653 a
SDict begin [/View [/XYZ H.V]/Dest (0:4622) cvn /DEST pdfmark end
 -2 3653 a -2 3663 a
SDict begin H.S end
 -2
3663 a -2 3663 a
SDict begin 13 H.A end
 -2 3663 a -2 3663 a
SDict begin [/View [/XYZ H.V]/Dest (0:4623) cvn /DEST pdfmark end
 -2 3663 a Black
396 3822 a Fj(\225)p Black 479 3822 a
SDict begin H.S end
 479 3822 a 479
3822 a
SDict begin 13 H.A end
 479 3822 a 479 3822 a
SDict begin [/View [/XYZ H.V]/Dest (0:4624) cvn /DEST pdfmark end
 479 3822 a Fk(The)e(rough)f(structure)g
(of)h(\330MQ)g(as)h(a)g(set)g(of)f(projects.)-2 3840
y
SDict begin H.S end
 -2 3840 a -2 3840 a
SDict begin 13 H.A end
 -2 3840 a -2 3840 a
SDict begin [/View [/XYZ H.V]/Dest (0:4625) cvn /DEST pdfmark end
 -2 3840 a Black
396 3971 a Fj(\225)p Black 479 3971 a
SDict begin H.S end
 479 3971 a 479
3971 a
SDict begin 13 H.A end
 479 3971 a 479 3971 a
SDict begin [/View [/XYZ H.V]/Dest (0:4626) cvn /DEST pdfmark end
 479 3971 a Fk(Why)g(we)h(use)f(the)g(LGPL)
h(and)e(not)h(the)g(BSD)h(license.)-2 3989 y
SDict begin H.S end
 -2 3989
a -2 3989 a
SDict begin 13 H.A end
 -2 3989 a -2 3989 a
SDict begin [/View [/XYZ H.V]/Dest (0:4627) cvn /DEST pdfmark end
 -2 3989 a Black 396 4121
a Fj(\225)p Black 479 4121 a
SDict begin H.S end
 479 4121 a 479 4121 a
SDict begin 13 H.A end
 479
4121 a 479 4121 a
SDict begin [/View [/XYZ H.V]/Dest (0:4628) cvn /DEST pdfmark end
 479 4121 a Fk(Ho)n(w)f(we)h(designed)e(and)g(gre)n(w)
h(the)g(\330MQ)h(community)-5 b(.)-2 4139 y
SDict begin H.S end
 -2 4139 a
-2 4139 a
SDict begin 13 H.A end
 -2 4139 a -2 4139 a
SDict begin [/View [/XYZ H.V]/Dest (0:4629) cvn /DEST pdfmark end
 -2 4139 a Black 396 4270
a Fj(\225)p Black 479 4270 a
SDict begin H.S end
 479 4270 a 479 4270 a
SDict begin 13 H.A end
 479
4270 a 479 4270 a
SDict begin [/View [/XYZ H.V]/Dest (0:4630) cvn /DEST pdfmark end
 479 4270 a Fk(The)20 b(b)n(usiness)h(that)f(backs)g
(\330MQ.)-2 4285 y
SDict begin H.S end
 -2 4285 a -2 4285 a
SDict begin 13 H.A end
 -2 4285 a -2 4285
a
SDict begin [/View [/XYZ H.V]/Dest (0:4631) cvn /DEST pdfmark end
 -2 4285 a Black 396 4420 a Fj(\225)p Black 479 4420
a
SDict begin H.S end
 479 4420 a 479 4420 a
SDict begin 13 H.A end
 479 4420 a 479 4420 a
SDict begin [/View [/XYZ H.V]/Dest (0:4632) cvn /DEST pdfmark end
 479 4420
a Fk(Who)g(o)n(wns)g(the)h(\330MQ)f(source)f(code.)-2
4435 y
SDict begin H.S end
 -2 4435 a -2 4435 a
SDict begin 13 H.A end
 -2 4435 a -2 4435 a
SDict begin [/View [/XYZ H.V]/Dest (0:4633) cvn /DEST pdfmark end
 -2 4435
a Black 396 4569 a Fj(\225)p Black 479 4569 a
SDict begin H.S end
 479 4569
a 479 4569 a
SDict begin 13 H.A end
 479 4569 a 479 4569 a
SDict begin [/View [/XYZ H.V]/Dest (0:4634) cvn /DEST pdfmark end
 479 4569 a Fk(Ho)n(w)h(to)h(mak)o(e)
e(and)h(submit)g(a)h(patch)e(to)h(\330MQ.)-2 4587 y
SDict begin H.S end
 -2
4587 a -2 4587 a
SDict begin 13 H.A end
 -2 4587 a -2 4587 a
SDict begin [/View [/XYZ H.V]/Dest (0:4635) cvn /DEST pdfmark end
 -2 4587 a Black
396 4719 a Fj(\225)p Black 479 4719 a
SDict begin H.S end
 479 4719 a 479
4719 a
SDict begin 13 H.A end
 479 4719 a 479 4719 a
SDict begin [/View [/XYZ H.V]/Dest (0:4636) cvn /DEST pdfmark end
 479 4719 a Fk(Who)g(has)h(special)f
(rights)g(to)g(mak)o(e)g(commits)g(to)g(\330MQ.)-2 4737
y
SDict begin H.S end
 -2 4737 a -2 4737 a
SDict begin 13 H.A end
 -2 4737 a -2 4737 a
SDict begin [/View [/XYZ H.V]/Dest (0:4637) cvn /DEST pdfmark end
 -2 4737 a Black
396 4868 a Fj(\225)p Black 479 4868 a
SDict begin H.S end
 479 4868 a 479
4868 a
SDict begin 13 H.A end
 479 4868 a 479 4868 a
SDict begin [/View [/XYZ H.V]/Dest (0:4638) cvn /DEST pdfmark end
 479 4868 a Fk(Ho)n(w)g(we)h(guarantee)d
(compatibility)h(with)h(old)g(code.)-2 4886 y
SDict begin H.S end
 -2 4886
a -2 4886 a
SDict begin 13 H.A end
 -2 4886 a -2 4886 a
SDict begin [/View [/XYZ H.V]/Dest (0:4639) cvn /DEST pdfmark end
 -2 4886 a Black 396 5017
a Fj(\225)p Black 479 5017 a
SDict begin H.S end
 479 5017 a 479 5017 a
SDict begin 13 H.A end
 479
5017 a 479 5017 a
SDict begin [/View [/XYZ H.V]/Dest (0:4640) cvn /DEST pdfmark end
 479 5017 a Fk(Why)g(we)h(don')o(t)d(use)j(public)e
(git)h(branches.)-2 5035 y
SDict begin H.S end
 -2 5035 a -2 5035 a
SDict begin 13 H.A end
 -2 5035
a -2 5035 a
SDict begin [/View [/XYZ H.V]/Dest (0:4641) cvn /DEST pdfmark end
 -2 5035 a Black 396 5167 a Fj(\225)p Black
479 5167 a
SDict begin H.S end
 479 5167 a 479 5167 a
SDict begin 13 H.A end
 479 5167 a 479 5167
a
SDict begin [/View [/XYZ H.V]/Dest (0:4642) cvn /DEST pdfmark end
 479 5167 a Fk(Who)g(decides)g(on)g(the)g(\330MQ)h(road-map?)-2
5185 y
SDict begin H.S end
 -2 5185 a -2 5185 a
SDict begin 13 H.A end
 -2 5185 a -2 5185 a
SDict begin [/View [/XYZ H.V]/Dest (0:4643) cvn /DEST pdfmark end
 -2 5185
a Black 3756 5569 a Ff(377)p Black eop end
%%Page: 378 391
TeXDict begin 378 390 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.378) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4663) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:4644) cvn /DEST pdfmark end
 479 72 a Fk(A)h(w)o(ork)o(ed)e(e)o(xample)
g(of)h(a)g(change)f(to)i(libzmq.)-2 90 y
SDict begin H.S end
 -2 90 a -2 90
a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:4645) cvn /DEST pdfmark end
 -2 90 a 360 x Fn(7.1.)39 b(Ar)m(c)o(hitecture)d(of)k
(the)f(\330MQ)f(Comm)m(unity)2759 450 y
SDict begin H.S end
 2759 450 a 2759
450 a
SDict begin 22.464 H.A end
 2759 450 a 2759 450 a
SDict begin [/View [/XYZ H.V]/Dest (12.89.1) cvn /DEST pdfmark end
 2759 450 a -2 645 a
SDict begin H.S end
 -2 645
a -2 645 a
SDict begin 13 H.A end
 -2 645 a -2 645 a
SDict begin [/View [/XYZ H.V]/Dest (0:4647) cvn /DEST pdfmark end
 -2 645 a 396 724 a Fk(Y)-9
b(ou)20 b(kno)n(w)f(that)h(\330MQ)h(is)g(an)f(LGPL-licensed)f(project.)
g(In)h(f)o(act)g(it')-5 b(s)22 b(a)e(collection)f(of)h(projects,)g(b)n
(uilt)g(around)e(the)396 831 y(core)i(library)-5 b(,)817
831 y
SDict begin H.S end
 817 831 a 817 831 a
SDict begin 13 H.A end
 817 831 a 817 831 a
SDict begin [/View [/XYZ H.V]/Dest (0:4648) cvn /DEST pdfmark end
 817 831
a Fe(libzmq)p Fk(.)20 b(I')o(ll)g(visualize)g(these)g(projects)g(as)h
(an)f(e)o(xpanding)d(galaxy:)-2 849 y
SDict begin H.S end
 -2 849 a -2 849
a
SDict begin 13 H.A end
 -2 849 a -2 849 a
SDict begin [/View [/XYZ H.V]/Dest (0:4649) cvn /DEST pdfmark end
 -2 849 a -2 859 a
SDict begin H.S end
 -2 859 a -2 859
a
SDict begin 13 H.A end
 -2 859 a -2 859 a
SDict begin [/View [/XYZ H.V]/Dest (0:4650) cvn /DEST pdfmark end
 -2 859 a Black 396 1002 a Fj(\225)p
Black 479 1002 a
SDict begin H.S end
 479 1002 a 479 1002 a
SDict begin 13 H.A end
 479 1002 a 479
1002 a
SDict begin [/View [/XYZ H.V]/Dest (0:4651) cvn /DEST pdfmark end
 479 1002 a Fk(At)k(the)f(core,)g(libzmq)f(is)i(the)f(\330MQ)h
(core)e(library)-5 b(.)19 b(It')-5 b(s)21 b(written)f(in)g(C++,)h(with)
f(a)h(lo)n(w-le)n(v)o(el)e(C)i(API.)f(The)g(code)f(is)479
1110 y(nasty)-5 b(,)20 b(mainly)f(because)h(it')-5 b(s)21
b(highly)e(optimized)g(b)n(ut)h(also)g(because)g(it')-5
b(s)21 b(written)f(in)g(C++,)h(a)g(language)d(that)i(lends)479
1218 y(itself)h(to)f(subtle)h(and)e(deep)h(nastiness.)g(Martin)g
(Sustrik)g(wrote)g(the)g(b)n(ulk)f(of)h(this)h(code)f(originally)-5
b(,)18 b(today)h(it)i(has)479 1325 y(dozens)f(of)g(people)f(who)g
(maintain)h(dif)n(ferent)e(parts)i(of)g(it.)h(Sustrik,)f(incidentally)
-5 b(,)18 b(has)i(said)h(he')l(d)e(use)h(C)h(if)g(he)f(did)479
1433 y(this)h(again,)e(and)h(has)g(started)g(a)h(re)n(write)e(in)i(C)g
(called)f("nano".)-2 1451 y
SDict begin H.S end
 -2 1451 a -2 1451 a
SDict begin 13 H.A end
 -2 1451
a -2 1451 a
SDict begin [/View [/XYZ H.V]/Dest (0:4652) cvn /DEST pdfmark end
 -2 1451 a Black 396 1583 a Fj(\225)p Black
479 1583 a
SDict begin H.S end
 479 1583 a 479 1583 a
SDict begin 13 H.A end
 479 1583 a 479 1583
a
SDict begin [/View [/XYZ H.V]/Dest (0:4653) cvn /DEST pdfmark end
 479 1583 a Fk(Around)f(libzmq)g(there)h(are)g(about)f(50)h
("bindings".)e(These)i(are)g(indi)n(vidual)f(projects)g(that)i(create)f
(higher)n(-le)n(v)o(el)479 1691 y(APIs)h(for)f(\330MQ,)g(or)g(at)g
(least)h(map)f(the)g(lo)n(w-le)n(v)o(el)f(API)i(into)f(other)f
(languages.)g(The)g(bindings)g(v)n(ary)g(in)i(quality)479
1799 y(from)e(e)o(xperimental)f(to)j(utterly)e(a)o(wesome.)g(By)i(f)o
(ar)f(the)g(most)h(a)o(wesome)e(binding)g(is)3000 1799
y
SDict begin H.S end
 3000 1799 a 3000 1799 a
SDict begin 13 H.A end
 3000 1799 a 3000 1799 a
SDict begin [/View [/XYZ H.V]/Dest (0:4654) cvn /DEST pdfmark end
 3000
1799 a Fk(PyZMQ)479 1907 y(\(https://github)m(.com/zeromq/p)o(yz)o
(mq\))o(,)c(which)k(w)o(as)i(one)f(of)g(the)g(\002rst)h(community)d
(projects)i(on)f(top)h(of)g(\330MQ.)g(If)479 2015 y(you)g(are)g(a)g
(binding)f(author)m(,)f(you)h(should)h(really)f(study)h(PyZMQ)g(and)g
(aspire)g(to)g(making)f(your)g(code)g(and)479 2122 y(community)f(as)j
(a)o(wesome.)-2 2140 y
SDict begin H.S end
 -2 2140 a -2 2140 a
SDict begin 13 H.A end
 -2 2140 a
-2 2140 a
SDict begin [/View [/XYZ H.V]/Dest (0:4655) cvn /DEST pdfmark end
 -2 2140 a Black 396 2272 a Fj(\225)p Black
479 2272 a
SDict begin H.S end
 479 2272 a 479 2272 a
SDict begin 13 H.A end
 479 2272 a 479 2272
a
SDict begin [/View [/XYZ H.V]/Dest (0:4656) cvn /DEST pdfmark end
 479 2272 a Fk(A)g(lot)f(of)g(languages)f(ha)n(v)o(e)h(multiple)f
(bindings)g(\(Erlang,)f(Ruby)-5 b(,)19 b(C#,)i(at)g(least\))f(written)g
(by)g(dif)n(ferent)e(people)i(o)o(v)o(er)479 2380 y(time,)g(or)g
(taking)g(dif)n(ferent)e(approaches.)g(W)-7 b(e)21 b(don')o(t)e(re)o
(gulate)g(these)h(in)h(an)o(y)e(w)o(ay)-5 b(.)20 b(There)f(are)h(no)g
("of)n(\002cial")479 2488 y(bindings.)f(Y)-9 b(ou)19
b(v)n(ote)h(by)g(using)g(one)g(or)f(the)i(other)m(,)d(contrib)n(uting)g
(to)j(it,)f(or)g(ignoring)e(it.)-2 2506 y
SDict begin H.S end
 -2 2506 a -2
2506 a
SDict begin 13 H.A end
 -2 2506 a -2 2506 a
SDict begin [/View [/XYZ H.V]/Dest (0:4657) cvn /DEST pdfmark end
 -2 2506 a Black 396 2637 a
Fj(\225)p Black 479 2637 a
SDict begin H.S end
 479 2637 a 479 2637 a
SDict begin 13 H.A end
 479
2637 a 479 2637 a
SDict begin [/View [/XYZ H.V]/Dest (0:4658) cvn /DEST pdfmark end
 479 2637 a Fk(On)i(top)g(of)g(the)g(bindings)f(are)h
(a)h(lot)f(of)g(projects)g(that)g(use)h(\330MQ)f(or)g(b)n(uild)g(on)g
(it.)g(See)h(the)f("Labs")g(page)f(on)h(the)479 2745
y(wiki)h(for)e(a)i(long)e(list)i(of)f(projects)g(and)g(proto-projects)d
(that)j(use)h(\330MQ)f(in)h(some)f(w)o(ay)-5 b(.)19 b(There)h(are)g
(frame)n(w)o(orks,)479 2853 y(web)g(serv)o(ers)g(lik)o(e)g(Mongrel2,)e
(brok)o(ers)h(lik)o(e)i(Majordomo,)c(and)j(enterprise)f(open)g(source)h
(tools)g(lik)o(e)g(Storm.)-2 3037 y
SDict begin H.S end
 -2 3037 a -2 3037
a
SDict begin 13 H.A end
 -2 3037 a -2 3037 a
SDict begin [/View [/XYZ H.V]/Dest (0:4659) cvn /DEST pdfmark end
 -2 3037 a 396 3127 a Fk(Libzmq,)f(most)h(of)g
(the)g(bindings,)f(and)h(some)g(of)f(the)i(outer)e(projects)h(sit)h(in)
f(the)2748 3127 y
SDict begin H.S end
 2748 3127 a 2748 3127 a
SDict begin 13 H.A end
 2748 3127 a
2748 3127 a
SDict begin [/View [/XYZ H.V]/Dest (0:4660) cvn /DEST pdfmark end
 2748 3127 a Fk(\330MQ)h(community)d("or)o(ganization")396
3235 y(\(https://github)m(.com/or)o(gan)o(ization)o(s/zerom)o(q\))c(on)
19 b(GitHub)m(.)g(This)h(or)o(ganization)d(is)j("run")f(by)h(a)g(group)
e(consisting)h(of)396 3343 y(the)h(most)h(senior)e(binding)g(authors.)g
(There')-5 b(s)19 b(v)o(ery)h(little)h(to)f(run)f(since)i(it')-5
b(s)21 b(almost)f(all)h(self-managing)d(and)h(there')-5
b(s)396 3451 y(zero)20 b(con\003ict)g(these)g(days.)-2
3635 y
SDict begin H.S end
 -2 3635 a -2 3635 a
SDict begin 13 H.A end
 -2 3635 a -2 3635 a
SDict begin [/View [/XYZ H.V]/Dest (0:4661) cvn /DEST pdfmark end
 -2 3635
a 396 3725 a Fk(iMatix,)g(my)g(\002rm,)g(plays)g(a)h(speci\002c)f(role)
g(in)g(the)g(community)-5 b(.)18 b(W)-7 b(e)21 b(o)n(wn)f(the)g
(trademarks)f(and)g(enforce)g(them)396 3833 y(discretely)-5
b(,)19 b(to)i(mak)o(e)e(sure)h(that)h(if)f(you)f(do)n(wnload)f(a)j
(package)e(calling)h(itself)g("ZeroMQ",)f(you)g(can)h(trust)h(what)f
(you)396 3941 y(are)g(getting.)g(People)f(ha)n(v)o(e)h(on)g(rare)f
(occasion)h(tried)g(to)g(hijack)g(the)g(name,)f(maybe)g(belie)n(ving)g
(that)h("free)g(softw)o(are")396 4049 y(means)g(there)g(is)h(no)f
(property)e(at)i(stak)o(e,)h(or)f(no-one)e(willing)i(to)g(defend)f(it.)
i(One)f(thing)f(you')o(ll)g(understand)g(from)g(this)396
4157 y(chapter)g(is)i(ho)n(w)f(seriously)g(we)g(tak)o(e)g(the)h
(process)e(behind)g(our)h(softw)o(are)f(\(and)h(I)g(mean)g("us")g(as)h
(a)f(community)-5 b(,)18 b(not)i(a)396 4264 y(compan)o(y\).)d(iMatix)i
(backs)g(the)g(community)f(by)g(enforcing)f(that)j(process)f(on)g(an)o
(ything)e(calling)i(itself)h("ZeroMQ")e(or)396 4372 y("\330MQ".)i(W)-7
b(e)22 b(also)e(put)g(mone)o(y)e(and)i(time)g(into)g(the)h(softw)o(are)
e(and)h(packaging)e(for)h(reasons)h(I')o(ll)h(e)o(xplain)e(later)-5
b(.)-2 4556 y
SDict begin H.S end
 -2 4556 a -2 4556 a
SDict begin 13 H.A end
 -2 4556 a -2 4556 a
SDict begin [/View [/XYZ H.V]/Dest (0:4662) cvn /DEST pdfmark end

-2 4556 a 396 4646 a Fk(It)21 b(is)g(not)f(a)g(charity)g(e)o(x)o
(ercise.)f(\330MQ)h(is)h(a)g(for)n(-pro\002t)d(project,)h(and)h(a)h(v)o
(ery)e(pro\002table)g(one.)g(The)h(pro\002ts)g(are)g(just)396
4754 y(widely)g(distrib)n(uted)f(among)g(all)i(those)f(who)g(in)m(v)o
(est)f(in)h(it.)h(It')-5 b(s)21 b(really)f(that)g(simple:)g(tak)o(e)g
(the)h(time)f(to)g(become)f(an)396 4862 y(e)o(xpert)g(in)h(\330MQ,)h
(or)e(b)n(uild)h(something)f(useful)g(on)h(top)g(of)g(\330MQ,)g(and)g
(you')o(ll)f(\002nd)h(your)f(v)n(alue)g(as)i(an)f(indi)n(vidual,)e(or)
396 4970 y(team,)i(or)g(compan)o(y)e(increasing.)h(iMatix)h(enjo)o(ys)g
(the)g(same)g(bene\002ts)g(as)h(e)n(v)o(eryone)d(else)j(in)f(the)g
(community)-5 b(.)18 b(It')-5 b(s)p Black 3759 5569 a
Ff(378)p Black eop end
%%Page: 379 392
TeXDict begin 379 391 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.379) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(win-win)g(to)g(e)n(v)o(eryone)e(e)o(xcept)h(our)g
(competitors,)g(who)h(\002nd)g(themselv)o(es)f(f)o(acing)g(a)i(threat)f
(the)o(y)f(can')o(t)h(beat)g(and)396 180 y(can')o(t)f(really)h(escape.)
g(\330MQ)g(dominates)g(the)g(future)f(w)o(orld)g(of)h(massi)n(v)o(ely)g
(distrib)n(uted)f(softw)o(are.)396 454 y(My)h(\002rm)g(doesn')o(t)f
(just)i(ha)n(v)o(e)e(the)i(community')-5 b(s)18 b(back,)h(we)i(also)f
(b)n(uilt)g(the)h(community)-5 b(.)17 b(This)j(w)o(as)h(deliberate)e(w)
o(ork;)396 562 y(in)i(the)f(original)f(\330MQ)h(white)h(paper)e(from)g
(2007)g(there)g(were)h(tw)o(o)h(projects.)e(One)h(w)o(as)h(technical,)f
(ho)n(w)f(to)i(mak)o(e)e(a)396 670 y(better)h(messaging)f(system.)h
(The)g(second)g(w)o(as)h(ho)n(w)e(to)i(b)n(uild)e(a)i(community)d(that)
i(could)g(tak)o(e)g(the)g(softw)o(are)g(to)396 778 y(through)e(to)j
(dominant)d(success.)j(Softw)o(are)e(dies,)h(b)n(ut)h(community)d
(survi)n(v)o(es.)-2 807 y
SDict begin H.S end
 -2 807 a -2 807 a
SDict begin 13 H.A end
 -2 807 a
-2 807 a
SDict begin [/View [/XYZ H.V]/Dest (0:4664) cvn /DEST pdfmark end
 -2 807 a 359 x Fn(7.2.)39 b(Ho)n(w)g(to)g(Make)f(Reall)n(y)h
(Lar)n(g)q(e)g(Ar)m(c)o(hitectures)3006 1166 y
SDict begin H.S end
 3006 1166
a 3006 1166 a
SDict begin 22.464 H.A end
 3006 1166 a 3006 1166 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.1) cvn /DEST pdfmark end
 3006 1166 a -2
1364 a
SDict begin H.S end
 -2 1364 a -2 1364 a
SDict begin 13 H.A end
 -2 1364 a -2 1364 a
SDict begin [/View [/XYZ H.V]/Dest (0:4666) cvn /DEST pdfmark end
 -2 1364
a 396 1440 a Fk(There)20 b(are,)g(it)g(has)h(been)e(said)i(\(at)f
(least)h(by)f(people)f(reading)g(this)h(sentence)g(out)g(loud\),)f(tw)o
(o)h(w)o(ays)h(to)f(mak)o(e)g(really)396 1548 y(lar)o(ge-scale)f(softw)
o(are.)h(Option)f(One)h(is)h(to)g(thro)n(w)e(massi)n(v)o(e)h(amounts)f
(of)h(mone)o(y)e(and)i(problems)f(at)h(empires)g(of)396
1655 y(smart)g(people,)f(and)h(hope)f(that)h(what)h(emer)o(ges)d(is)k
(not)d(yet)i(another)d(career)i(killer)-5 b(.)20 b(If)g(you')l(re)e(v)o
(ery)h(luck)o(y)-5 b(,)19 b(and)g(are)396 1763 y(b)n(uilding)g(on)h
(lots)h(of)f(e)o(xperience,)d(and)j(ha)n(v)o(e)g(k)o(ept)g(your)e
(teams)j(solid,)f(and)g(are)g(not)f(aiming)h(for)f(technical)396
1871 y(brilliance,)g(and)h(are)g(furthermore)d(incredibly)i(luck)o(y)-5
b(,)18 b(it)j(w)o(orks.)-2 2055 y
SDict begin H.S end
 -2 2055 a -2 2055 a
SDict begin 13 H.A end

-2 2055 a -2 2055 a
SDict begin [/View [/XYZ H.V]/Dest (0:4667) cvn /DEST pdfmark end
 -2 2055 a 396 2145 a Fk(But)g(gambling)d(with)i
(hundreds)e(of)i(millions)g(of)g(others')g(mone)o(y)e(isn')o(t)i(for)f
(e)n(v)o(eryone.)f(F)o(or)i(the)g(rest)h(of)f(us)g(who)g(w)o(ant)396
2253 y(to)h(b)n(uild)e(lar)o(ge-scale)g(softw)o(are,)h(there')-5
b(s)20 b(Option)f(T)-7 b(w)o(o,)20 b(which)g(is)h(open)e(source,)h(and)
f(more)h(speci\002cally)-5 b(,)3543 2253 y
SDict begin H.S end
 3543 2253
a 3543 2253 a
SDict begin 13 H.A end
 3543 2253 a 3543 2253 a
SDict begin [/View [/XYZ H.V]/Dest (0:4668) cvn /DEST pdfmark end
 3543 2253 a Ff(fr)m(ee)396
2361 y(softwar)m(e)p Fk(.)21 b(If)f(you')l(re)e(asking)i(ho)n(w)f(the)h
(choice)g(of)g(softw)o(are)g(license)g(is)h(rele)n(v)n(ant)e(to)h(the)h
(scale)f(of)g(the)g(softw)o(are)g(you)396 2469 y(b)n(uild,)g(that')-5
b(s)20 b(the)h(right)e(question.)-2 2653 y
SDict begin H.S end
 -2 2653 a
-2 2653 a
SDict begin 13 H.A end
 -2 2653 a -2 2653 a
SDict begin [/View [/XYZ H.V]/Dest (0:4669) cvn /DEST pdfmark end
 -2 2653 a 396 2743 a Fk(The)g(brilliant)g
(and)g(visionary)f(Eben)g(Moglen)h(once)f(said,)i(roughly)-5
b(,)16 b(that)k(a)g(free)f(softw)o(are)g(license)g(is)h(the)g(contract)
e(on)396 2851 y(which)i(a)h(community)d(b)n(uilds.)h(When)h(I)h(heard)e
(this,)h(about)g(ten)g(years)g(ago,)f(the)h(idea)g(came)g(to)h(me,)3344
2851 y
SDict begin H.S end
 3344 2851 a 3344 2851 a
SDict begin 13 H.A end
 3344 2851 a 3344 2851
a
SDict begin [/View [/XYZ H.V]/Dest (0:4670) cvn /DEST pdfmark end
 3344 2851 a Ff(can)e(we)396 2959 y(deliber)o(ately)g(gr)l(ow)i(fr)m
(ee)g(softwar)m(e)g(communities)p Fk(?)-2 3142 y
SDict begin H.S end
 -2 3142
a -2 3142 a
SDict begin 13 H.A end
 -2 3142 a -2 3142 a
SDict begin [/View [/XYZ H.V]/Dest (0:4671) cvn /DEST pdfmark end
 -2 3142 a 396 3233 a
Fk(T)-6 b(en)20 b(years)g(later)m(,)g(the)g(answer)g(is)h("yes",)f(and)
g(there)f(is)j(almost)e(a)g(science)g(to)h(it.)f(I)h(say)f("almost")g
(because)g(we)g(don')o(t)396 3341 y(yet)g(ha)n(v)o(e)g(enough)e(e)n
(vidence)h(of)h(people)f(doing)g(this)i(deliberately)d(with)j(a)f
(documented,)e(reproducible)f(process.)i(It)396 3449
y(is)i(what)g(I'm)e(trying)g(to)i(do)e(with)1372 3449
y
SDict begin H.S end
 1372 3449 a 1372 3449 a
SDict begin 13 H.A end
 1372 3449 a 1372 3449 a
SDict begin [/View [/XYZ H.V]/Dest (0:4672) cvn /DEST pdfmark end
 1372
3449 a Fk(Social)h(Architecture)f(\(http://softw)o
(areandsilicon.com/chapter)o(:2#)o(toc5)o(\).)14 b(\330MQ)396
3557 y(came)20 b(after)g(W)m(ikidot,)f(after)h(Digistan)g(and)g(after)g
(the)g(F)o(oundation)e(for)h(a)i(Free)f(Information)e(Infrastructure)f
(\(aka)j(the)396 3665 y(FFII,)g(an)h(NGO)f(that)g(\002ghts)h(against)e
(softw)o(are)h(patents\).)f(Which)h(came)g(after)g(a)h(lot)f(of)g(less)
h(successful)f(community)396 3773 y(projects)g(lik)o(e)g(Xitami)h(and)e
(Libero.)g(My)h(main)g(tak)o(ea)o(w)o(ay)f(from)h(a)g(long)g(career)f
(of)h(projects)g(of)f(e)n(v)o(ery)g(concei)n(v)n(able)396
3880 y(format)g(is:)j(if)e(you)f(w)o(ant)i(to)f(b)n(uild)g(truly)f(lar)
o(ge-scale)g(and)h(long-lasting)e(softw)o(are,)i(aim)g(to)g(b)n(uild)g
(a)h(free)f(softw)o(are)396 3988 y(community)-5 b(.)-2
4006 y
SDict begin H.S end
 -2 4006 a -2 4006 a
SDict begin 13 H.A end
 -2 4006 a -2 4006 a
SDict begin [/View [/XYZ H.V]/Dest (0:4673) cvn /DEST pdfmark end
 -2 4006
a 396 4317 a Fb(7.2.1.)36 b(The)d(Game)1305 4317 y
SDict begin H.S end
 1305
4317 a 1305 4317 a
SDict begin 18.72 H.A end
 1305 4317 a 1305 4317 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.58.2) cvn /DEST pdfmark end
 1305 4317
a -2 4484 a
SDict begin H.S end
 -2 4484 a -2 4484 a
SDict begin 13 H.A end
 -2 4484 a -2 4484 a
SDict begin [/View [/XYZ H.V]/Dest (0:4675) cvn /DEST pdfmark end
 -2
4484 a 396 4590 a Fk(Softw)o(are)20 b(is)h(my)f(b)n(usiness:)g(I)h
(code)e(to)i(eat,)f(and)g(to)g(feed)g(my)f(kids)i(and)e(to)i(mak)o(e)e
(sure)h(my)g(wife)h(doesn')o(t)d(lea)n(v)o(e)i(me)396
4698 y(for)g(someone)f(nicer)g(and)h(better)g(looking.)e(Y)-9
b(ou)20 b(see)g(the)h(challenge.)d(Of)j(course)e(I)2819
4698 y
SDict begin H.S end
 2819 4698 a 2819 4698 a
SDict begin 13 H.A end
 2819 4698 a 2819 4698
a
SDict begin [/View [/XYZ H.V]/Dest (0:4676) cvn /DEST pdfmark end
 2819 4698 a Ff(lo)o(ve)i Fk(coding)d(and)i(that)g(sensation)396
4806 y(of)g(sculpting)f(perfect)h(functionality)e(out)i(of)f(the)i(ra)o
(w)f(mass)g(of)g(possibility)-5 b(.)19 b(But)i(the)f(w)o(orld)g(doesn')
o(t)f(care)h(ho)n(w)396 4914 y(passionately)f(we)i(feel.)f(W)-7
b(e)21 b(wrest)g(our)e(li)n(ving)h(from)f(a)i(mark)o(et)e(that)h(is)h
(lar)o(gely)e(uninterested,)g(and)g(often)h(hostile)396
5022 y(when)g(it)h(does)f(notice.)f(This)h(is)i(the)e(Game,)g(and)f
(the)h(detailed)g(strate)o(gy)f(of)h(ho)n(w)g(to)g(win)h(it)f(is)i(for)
d(another)g(book,)396 5130 y(though)g(if)h(you)f(mak)o(e)h(it)h(to)f
(the)h(end)e(of)h(this)h(chapter)e(I')o(ll)h(toss)h(in)g(a)f(fe)n(w)g
(cheap)g(gimmicks.)p Black 3759 5569 a Ff(379)p Black
eop end
%%Page: 380 393
TeXDict begin 380 392 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.380) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4677) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(But)h(roughly:)d(you)h(identify)g(and)h(destro)o(y)f
(your)g(competitors,)g(you)g(de)n(v)o(elop)f(acti)n(v)o(e)i(strate)o
(gies,)g(you)f(learn)h(rapidly)-5 b(,)396 180 y(mo)o(v)o(e)19
b(quickly)-5 b(,)18 b(and)i(in)g(general)f(appreciate)g(the)h(Game)g
(as)h(a)g(constant)e(competition)g(in)h(which)g(e)n(v)o(ery)f
(participant)f(is)396 288 y(an)i(ally)-5 b(,)20 b(an)g(enemy)-5
b(,)19 b(or)h(the)g(ground)e(o)o(v)o(er)g(which)i(you)f(are)i
(\002ghting.)d(Friend,)i(foe,)f(or)h(food.)-2 317 y
SDict begin H.S end
 -2
317 a -2 317 a
SDict begin 13 H.A end
 -2 317 a -2 317 a
SDict begin [/View [/XYZ H.V]/Dest (0:4678) cvn /DEST pdfmark end
 -2 317 a 396 627 a Fb(7.2.2.)36
b(The)d(Contract)1465 627 y
SDict begin H.S end
 1465 627 a 1465 627 a
SDict begin 18.72 H.A end
 1465
627 a 1465 627 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.59.2) cvn /DEST pdfmark end
 1465 627 a -2 794 a
SDict begin H.S end
 -2 794 a -2 794
a
SDict begin 13 H.A end
 -2 794 a -2 794 a
SDict begin [/View [/XYZ H.V]/Dest (0:4680) cvn /DEST pdfmark end
 -2 794 a 396 901 a Fk(Here)20 b(is)h(a)g(true)f
(story)-5 b(,)19 b(it)i(happened)d(to)i(the)g(eldest)h(brother)n
(-in-la)o(w)c(of)j(the)g(cousin)g(of)g(a)g(friend)f(of)h(mine')-5
b(s)21 b(colleague)396 1009 y(at)g(w)o(ork.)e(His)i(name)f(w)o(as,)h
(and)e(still)j(is,)f(P)o(atrick.)-2 1187 y
SDict begin H.S end
 -2 1187 a
-2 1187 a
SDict begin 13 H.A end
 -2 1187 a -2 1187 a
SDict begin [/View [/XYZ H.V]/Dest (0:4681) cvn /DEST pdfmark end
 -2 1187 a 396 1283 a Fk(P)o(atrick)f(w)o
(as)g(a)h(computer)d(scientist,)i(with)g(a)g(PhD)g(in)h(adv)n(anced)c
(netw)o(ork)i(topologies.)f(He)i(spent)g(tw)o(o)g(years)g(and)f(his)396
1391 y(sa)n(vings)h(b)n(uilding)f(a)i(ne)n(w)f(product,)e(and)i(choose)
f(the)h(BSD)h(license)g(because)e(he)h(belie)n(v)o(ed)f(that)h(w)o
(ould)g(get)g(him)396 1499 y(more)g(adoption.)e(He)i(w)o(ork)o(ed)f(in)
i(his)f(attic,)h(at)g(great)e(personal)g(cost,)i(and)e(proudly)f
(published)h(his)h(w)o(ork.)g(People)396 1606 y(applauded,)e(for)i(it)g
(w)o(as)h(truly)f(f)o(antastic,)g(and)g(his)g(mailing)g(lists)h(were)f
(soon)g(ab)n(uzz)g(with)g(acti)n(vity)g(and)f(patches)h(and)396
1714 y(happ)o(y)f(chatter)-5 b(.)20 b(Man)o(y)f(companies)g(told)h(him)
g(ho)n(w)f(the)o(y)h(were)g(sa)n(ving)g(millions)g(using)g(his)g(w)o
(ork.)f(Some)h(of)g(them)396 1822 y(e)n(v)o(en)f(paid)h(him)g(for)g
(consultanc)o(y)e(and)h(training.)g(He)i(w)o(as)g(in)m(vited)e(to)h
(speak)g(at)h(conferences)d(and)h(started)i(collecting)396
1930 y(badges)e(with)h(his)g(name)f(on)g(them.)g(He)h(started)g(a)g
(small)g(b)n(usiness,)f(hired)g(a)h(friend)f(to)g(w)o(ork)g(with)h
(him,)f(and)g(dreamed)396 2038 y(of)h(making)f(it)i(big.)-2
2222 y
SDict begin H.S end
 -2 2222 a -2 2222 a
SDict begin 13 H.A end
 -2 2222 a -2 2222 a
SDict begin [/View [/XYZ H.V]/Dest (0:4682) cvn /DEST pdfmark end
 -2 2222
a 396 2312 a Fk(Then)f(one)f(day)-5 b(,)19 b(someone)g(pointed)g(him)h
(to)g(a)h(ne)n(w)f(project,)f(GPL)i(licensed,)e(which)h(had)f(fork)o
(ed)g(his)i(w)o(ork)e(and)h(w)o(as)396 2420 y(impro)o(ving)e(on)i(it.)g
(He)h(w)o(as)g(irritated)e(and)h(upset,)g(and)f(ask)o(ed)h(ho)n(w)g
(people)f(--)h(fello)n(w)g(open)f(sourcers,)g(no)h(less!)h(--)396
2528 y(w)o(ould)f(so)g(shamelessly)g(steal)h(his)g(code.)e(There)g
(were)i(long)e(ar)o(guments)f(on)i(the)g(list)h(about)f(whether)f(it)i
(w)o(as)g(e)n(v)o(en)396 2636 y(le)o(gal)f(to)g(relicense)g(their)g
(BSD)h(code)f(as)g(GPL)h(code.)e(T)l(urned)g(out,)h(it)h(w)o(as.)f(He)h
(tried)f(to)g(ignore)f(the)h(ne)n(w)g(project)g(b)n(ut)396
2744 y(then)g(he)g(soon)g(realized)f(that)h(ne)n(w)g(patches)g(coming)f
(from)g(that)h(project)2541 2744 y
SDict begin H.S end
 2541 2744 a 2541 2744
a
SDict begin 13 H.A end
 2541 2744 a 2541 2744 a
SDict begin [/View [/XYZ H.V]/Dest (0:4683) cvn /DEST pdfmark end
 2541 2744 a Ff(couldn')n(t)e(e)o(ven)h(be)h
(mer)m(g)o(ed)g(bac)n(k)i Fk(into)e(his)396 2852 y(w)o(ork!)-2
3019 y
SDict begin H.S end
 -2 3019 a -2 3019 a
SDict begin 13 H.A end
 -2 3019 a -2 3019 a
SDict begin [/View [/XYZ H.V]/Dest (0:4684) cvn /DEST pdfmark end
 -2 3019
a 396 3126 a Fk(W)-7 b(orse,)21 b(the)f(GPL)h(project)e(got)h(popular)e
(and)i(some)g(of)g(his)g(core)g(contrib)n(utors)e(made)i(\002rst)h
(small,)f(and)g(then)g(lar)o(ger)396 3234 y(patches)g(to)g(it.)h
(Again,)e(he)h(couldn')o(t)e(use)j(those)f(changes,)e(and)i(he)g(felt)h
(abandoned.)c(P)o(atrick)j(went)g(into)g(a)396 3342 y(depression,)f
(his)h(girlfriend)f(left)h(him)g(for)g(an)g(international)e(currenc)o
(y)g(dealer)i(called,)g(weirdly)-5 b(,)18 b(P)o(atrice,)i(and)g(he)396
3450 y(stopped)f(all)i(w)o(ork)f(on)f(the)i(project.)e(He)h(felt)h
(betrayed,)d(and)i(utterly)f(miserable.)g(He)i(\002red)f(his)h(friend,)
d(who)i(took)f(it)396 3557 y(rather)h(badly)f(and)g(told)h(e)n(v)o
(eryone)e(that)i(P)o(atrick)g(w)o(as)h(a)g(closet)f(banjo)f(player)-5
b(.)20 b(Finally)g(P)o(atrick)g(took)f(a)i(job)e(as)i(a)396
3665 y(project)f(manager)e(for)i(a)g(cloud)g(compan)o(y)-5
b(,)17 b(and)i(by)h(the)g(age)g(of)g(forty)-5 b(,)19
b(he)h(had)g(stopped)f(programming)d(e)n(v)o(en)k(for)f(fun.)-2
3849 y
SDict begin H.S end
 -2 3849 a -2 3849 a
SDict begin 13 H.A end
 -2 3849 a -2 3849 a
SDict begin [/View [/XYZ H.V]/Dest (0:4685) cvn /DEST pdfmark end
 -2 3849
a 396 3939 a Fk(Poor)h(P)o(atrick,)f(I)i(almost)f(felt)g(sorry)g(for)f
(him.)h(Then)f(I)i(ask)o(ed)f(him,)f("why)h(didn')o(t)e(you)h(choose)h
(the)g(GPL?")g("Because)396 4047 y(it')-5 b(s)22 b(a)e(restricti)n(v)o
(e)g(viral)g(license",)f(he)i(replied.)e(I)h(told)g(him,)g(you)f(may)h
(ha)n(v)o(e)f(a)i(PhD,)f(and)g(you)f(may)h(be)g(the)g(eldest)396
4155 y(brother)n(-in-la)o(w)e(of)i(the)g(cousin)f(of)h(a)h(friend)e(of)
h(my)g(colleague,)e(b)n(ut)i(you)g(are)g(an)g(idiot)g(and)g(Monique)e
(w)o(as)j(smart)f(to)396 4263 y(lea)n(v)o(e)g(you.)f(Y)-9
b(ou)20 b(published)f(your)f(w)o(ork)i(saying,)f("please)h(steal)h(my)f
(code)g(as)h(long)e(as)i(you)e(k)o(eep)h(this)h('please)e(steal)396
4371 y(my)h(code')f(statement)h(in)h(the)f(resulting)f(w)o(ork",)g(and)
h(when)g(people)f(did)g(e)o(xactly)h(that,)g(you)f(got)h(upset.)g(W)-7
b(orse,)20 b(you)396 4479 y(were)g(a)g(hypocrite)d(because)i(when)g
(the)o(y)g(did)g(it)h(in)g(secret,)f(you)g(were)g(happ)o(y)-5
b(,)18 b(b)n(ut)h(when)g(the)o(y)g(did)g(it)h(openly)-5
b(,)18 b(you)h(felt)396 4587 y(betrayed.)-2 4771 y
SDict begin H.S end
 -2
4771 a -2 4771 a
SDict begin 13 H.A end
 -2 4771 a -2 4771 a
SDict begin [/View [/XYZ H.V]/Dest (0:4686) cvn /DEST pdfmark end
 -2 4771 a 396 4861
a Fk(Seeing)h(your)f(hard)g(w)o(ork)h(captured)e(by)i(a)h(smarter)e
(team)i(and)e(then)h(used)g(against)f(you)h(is)h(enormously)d(painful,)
g(so)396 4969 y(why)i(e)n(v)o(en)f(mak)o(e)g(that)i(possible?)f(Ev)o
(ery)e(proprietary)g(project)h(that)i(uses)f(BSD)h(code)f(is)h
(capturing)d(it.)j(A)g(public)396 5077 y(GPL)g(fork)e(is)i(perhaps)e
(more)g(humiliating,)g(b)n(ut)h(it')-5 b(s)21 b(fully)f
(self-in\003icted.)p Black 3759 5569 a Ff(380)p Black
eop end
%%Page: 381 394
TeXDict begin 381 393 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.381) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4701) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4687) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(BSD)h(is)h(lik)o(e)e(food.)f(It)h(literally)g(\(and)g
(I)g(mean)g(that)g(metaphorically\))d(whispers)j("eat)h(me")f(in)g(the)
g(little)h(v)n(oice)f(one)396 180 y(imagines)g(a)g(cube)g(of)g(cheese)g
(might)f(use)i(when)e(it')-5 b(s)22 b(sitting)e(ne)o(xt)g(to)g(an)g
(empty)f(bottle)h(of)g(Orv)n(al.)g(The)f(BSD)j(license,)396
288 y(lik)o(e)f(its)g(near)f(clone)f(MIT/X11,)g(w)o(as)i(designed)e
(speci\002cally)h(by)f(a)i(uni)n(v)o(ersity)e(\(Berk)o(ele)o(y\))f
(with)j(no)e(pro\002t)h(moti)n(v)o(e,)396 396 y(to)h(leak)f(w)o(ork)f
(and)h(ef)n(fort.)f(It)h(is)h(a)g(w)o(ay)f(to)g(push)g(subsidized)f
(technology)f(at)j(belo)n(w)e(its)j(cost)e(price,)g(a)g(dumping)e(of)
396 504 y(under)n(-priced)g(code)h(in)h(the)h(hope)e(that)h(it)h(will)g
(break)e(the)h(mark)o(et)g(for)f(others.)h(BSD)h(is)g(an)3066
504 y
SDict begin H.S end
 3066 504 a 3066 504 a
SDict begin 13 H.A end
 3066 504 a 3066 504 a
SDict begin [/View [/XYZ H.V]/Dest (0:4688) cvn /DEST pdfmark end
 3066
504 a Ff(e)n(xcellent)h Fk(tool)e(in)g(the)396 612 y(Game,)g(b)n(ut)g
(only)g(if)g(you')l(re)e(a)j(lar)o(ge)e(well-funded)f(institution)i
(that)g(can)g(af)n(ford)e(to)j(use)f(Option)g(One.)f(The)h(Apache)396
720 y(license)h(is)g(BSD)g(in)f(a)h(suit.)-2 887 y
SDict begin H.S end
 -2
887 a -2 887 a
SDict begin 13 H.A end
 -2 887 a -2 887 a
SDict begin [/View [/XYZ H.V]/Dest (0:4689) cvn /DEST pdfmark end
 -2 887 a 396 994 a Fk(F)o(or)f(us)h
(small)f(b)n(usinesses)h(who)f(aim)g(our)f(in)m(v)o(estments)g(lik)o(e)
i(precious)e(b)n(ullets,)h(leaking)f(w)o(ork)h(and)f(ef)n(fort)g(is)396
1102 y(unacceptable.)f(Breaking)h(the)h(mark)o(et)g(is)h(great,)f(b)n
(ut)g(we)g(cannot)f(af)n(ford)g(to)h(subsidize)g(our)f(competitors.)g
(The)h(BSD)396 1210 y(netw)o(orking)e(stack)j(ended)e(up)h(putting)f(W)
m(indo)n(ws)g(on)h(the)g(Internet.)f(W)-7 b(e)21 b(cannot)e(af)n(ford)g
(battles)h(with)h(those)f(we)396 1318 y(should)f(naturally)g(be)h
(allies)h(with.)g(W)-7 b(e)21 b(cannot)e(af)n(ford)g(to)h(mak)o(e)g
(fundamental)d(b)n(usiness)k(errors)e(because)h(in)g(the)396
1426 y(end,)g(that)g(means)g(we)g(ha)n(v)o(e)g(to)g(\002re)h(people.)-2
1610 y
SDict begin H.S end
 -2 1610 a -2 1610 a
SDict begin 13 H.A end
 -2 1610 a -2 1610 a
SDict begin [/View [/XYZ H.V]/Dest (0:4690) cvn /DEST pdfmark end
 -2 1610
a 396 1700 a Fk(It)g(comes)f(do)n(wn)f(to)h(beha)n(vioral)f(economics)f
(and)i(game)f(theory)-5 b(.)2324 1700 y
SDict begin H.S end
 2324 1700 a 2324
1700 a
SDict begin 13 H.A end
 2324 1700 a 2324 1700 a
SDict begin [/View [/XYZ H.V]/Dest (0:4691) cvn /DEST pdfmark end
 2324 1700 a Ff(The)20
b(license)g(we)h(c)o(hoose)e(modi\002es)h(the)g(economics)396
1808 y(of)h(those)f(who)g(use)g(our)g(work)q Fk(.)h(In)f(the)g(Game)g
(there)g(are)g(friends,)f(foes,)h(and)g(food.)e(BSD)k(mak)o(es)e(most)g
(people)f(see)i(us)396 1916 y(as)g(lunch.)e(Closed)i(source)e(mak)o(es)
h(most)g(people)f(see)i(us)g(as)g(enemies)e(\(do)h(you)2738
1916 y
SDict begin H.S end
 2738 1916 a 2738 1916 a
SDict begin 13 H.A end
 2738 1916 a 2738 1916
a
SDict begin [/View [/XYZ H.V]/Dest (0:4692) cvn /DEST pdfmark end
 2738 1916 a Ff(lik)o(e)h Fk(paying)e(people)g(for)g(softw)o(are?\))
396 2023 y(GPL,)i(ho)n(we)n(v)o(er)m(,)c(mak)o(es)j(most)h(people,)d
(with)j(the)f(e)o(xception)e(of)i(the)g(P)o(atricks)g(of)g(the)g(w)o
(orld,)g(our)f(allies.)i(An)o(y)f(fork)396 2131 y(of)g(\330MQ)h(is)g
(license)f(compatible)f(with)h(\330MQ,)g(to)h(the)f(point)f(where)h(we)
2561 2131 y
SDict begin H.S end
 2561 2131 a 2561 2131 a
SDict begin 13 H.A end
 2561 2131 a 2561
2131 a
SDict begin [/View [/XYZ H.V]/Dest (0:4693) cvn /DEST pdfmark end
 2561 2131 a Ff(encour)o(a)o(g)o(e)f Fk(forks)g(as)i(a)g(v)n
(aluable)e(tool)h(for)396 2239 y(e)o(xperimentation.)d(Y)-8
b(es,)20 b(it)h(can)f(be)g(weird)g(to)h(see)f(someone)f(try)h(run)g(of)
n(f)f(with)h(the)h(ball)f(b)n(ut,)g(and)g(here')-5 b(s)20
b(the)g(secret,)3837 2239 y
SDict begin H.S end
 3837 2239 a 3837 2239 a
SDict begin 13 H.A end
 3837
2239 a 3837 2239 a
SDict begin [/View [/XYZ H.V]/Dest (0:4694) cvn /DEST pdfmark end
 3837 2239 a Ff(I)396 2347 y(can)g(g)o(et)g(it)h(bac)
n(k)f(any)g(time)g(I)h(want.)-2 2375 y
SDict begin H.S end
 -2 2375 a -2 2375
a
SDict begin 13 H.A end
 -2 2375 a -2 2375 a
SDict begin [/View [/XYZ H.V]/Dest (0:4695) cvn /DEST pdfmark end
 -2 2375 a 396 2686 a Fb(7.2.3.)36
b(The)d(Pr)n(ocess)1436 2686 y
SDict begin H.S end
 1436 2686 a 1436 2686
a
SDict begin 18.72 H.A end
 1436 2686 a 1436 2686 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.60.2) cvn /DEST pdfmark end
 1436 2686 a -2 2853 a
SDict begin H.S end
 -2 2853
a -2 2853 a
SDict begin 13 H.A end
 -2 2853 a -2 2853 a
SDict begin [/View [/XYZ H.V]/Dest (0:4697) cvn /DEST pdfmark end
 -2 2853 a 396 2960 a
Fk(If)20 b(you')l(v)o(e)e(accepted)h(my)h(thesis)h(up)f(to)g(no)n(w)-5
b(,)19 b(great!)h(No)n(w)-5 b(,)19 b(I')o(ll)h(e)o(xplain)f(the)i
(rough)d(process)i(by)g(which)f(we)i(actually)396 3068
y(b)n(uild)f(an)g(open)f(source)h(community)-5 b(.)17
b(This)j(w)o(as)i(ho)n(w)d(we)i(b)n(uilt)f(or)g(gre)n(w)g(or)g(gently)f
(steered)h(the)g(\330MQ)g(community)396 3176 y(into)g(e)o(xistence.)-2
3342 y
SDict begin H.S end
 -2 3342 a -2 3342 a
SDict begin 13 H.A end
 -2 3342 a -2 3342 a
SDict begin [/View [/XYZ H.V]/Dest (0:4698) cvn /DEST pdfmark end
 -2 3342
a 396 3450 a Fk(Y)-9 b(ou)20 b(recall)g(the)g(simplicity-oriented)e
(design)h(process)h(from)f(Chapter)h(6,)g(where)f(I)i(claimed)e(that)i
(we)f(b)n(uild)396 3557 y(successfully)g(accurate)f(softw)o(are)h(by)g
(successfully)f(e)o(xploring)f(the)i(problem)f(landscape,)f(rather)i
(than)g(by)f(sheer)396 3665 y(intellectual)h(ef)n(fort.)f(K)n(eep)h
(this)g(in)h(mind.)e(No)n(w)-5 b(,)19 b(see)i(your)e(community)f(as)j
(a)g(group)d(e)o(xploring)g(that)i(landscape)f(and)396
3773 y(sharing)g(the)i(results)f(of)g(their)g(w)o(ork.)-2
3957 y
SDict begin H.S end
 -2 3957 a -2 3957 a
SDict begin 13 H.A end
 -2 3957 a -2 3957 a
SDict begin [/View [/XYZ H.V]/Dest (0:4699) cvn /DEST pdfmark end
 -2 3957
a 396 4047 a Fk(Y)-9 b(our)19 b(goal)h(as)h(leader)f(of)g(a)g
(community)e(is)j(to)g(moti)n(v)n(ate)e(people)g(to)h(get)h(out)e
(there)h(and)g(e)o(xplore;)e(to)j(ensure)e(the)o(y)h(can)396
4155 y(do)g(so)h(safely)f(and)f(without)h(disturbing)e(others;)i(to)g
(re)n(w)o(ard)g(them)f(when)h(the)o(y)f(mak)o(e)h(successful)g(disco)o
(v)o(eries;)f(and)396 4263 y(to)i(ensure)e(the)o(y)h(share)f(their)h
(kno)n(wledge)e(with)j(e)n(v)o(eryone)c(else)k(\(and)f(not)f(because)h
(we)h(ask)f(them,)f(not)h(because)g(the)o(y)396 4371
y(feel)g(generous,)f(b)n(ut)h(because)f(it')-5 b(s)22
b(The)e(La)o(w\).)-2 4555 y
SDict begin H.S end
 -2 4555 a -2 4555 a
SDict begin 13 H.A end
 -2 4555
a -2 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:4700) cvn /DEST pdfmark end
 -2 4555 a 396 4645 a Fk(It)g(is)g(an)g(iterati)n(v)o(e)e
(process.)h(Y)-9 b(ou)19 b(mak)o(e)g(a)g(small)h(product,)d(at)j(your)e
(o)n(wn)h(cost,)h(b)n(ut)f(in)h(public)e(vie)n(w)-5 b(.)19
b(Y)-9 b(ou)18 b(then)h(b)n(uild)g(a)396 4753 y(small)i(community)d
(around)g(that)j(product.)d(If)i(you)f(ha)n(v)o(e)h(a)g(small)h(b)n(ut)
f(real)g(hit,)g(the)h(community)d(then)h(helps)h(design)396
4861 y(and)g(b)n(uild)f(the)h(ne)o(xt)f(v)o(ersion,)f(and)i(gro)n(ws)f
(lar)o(ger)-5 b(.)19 b(And)g(then)g(that)h(community)e(b)n(uilds)i(the)
f(ne)o(xt)h(v)o(ersion,)e(and)h(so)h(on.)396 4969 y(It')-5
b(s)21 b(e)n(vident)e(that)h(you)g(remain)f(part)h(of)g(the)g
(community)-5 b(,)17 b(maybe)j(e)n(v)o(en)f(a)h(majority)f(contrib)n
(utor)m(,)f(b)n(ut)i(the)g(more)p Black 3759 5569 a Ff(381)p
Black eop end
%%Page: 382 395
TeXDict begin 382 394 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.382) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(control)f(you)h(try)f(to)i(assert)g(o)o(v)o(er)d(the)
j(material)e(results,)i(the)f(less)h(people)e(will)i(w)o(ant)g(to)f
(participate.)f(Plan)h(your)f(o)n(wn)396 180 y(retirement)g(well)i
(before)e(someone)g(decides)g(you)h(are)g(their)g(ne)o(xt)f(problem.)-2
209 y
SDict begin H.S end
 -2 209 a -2 209 a
SDict begin 13 H.A end
 -2 209 a -2 209 a
SDict begin [/View [/XYZ H.V]/Dest (0:4701) cvn /DEST pdfmark end
 -2 209 a 396
519 a Fb(7.2.4.)36 b(Crazy)-10 b(,)34 b(Beautiful,)h(and)f(Easy)2213
519 y
SDict begin H.S end
 2213 519 a 2213 519 a
SDict begin 18.72 H.A end
 2213 519 a 2213 519 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.61.2) cvn /DEST pdfmark end
 2213
519 a -2 710 a
SDict begin H.S end
 -2 710 a -2 710 a
SDict begin 13 H.A end
 -2 710 a -2 710 a
SDict begin [/View [/XYZ H.V]/Dest (0:4703) cvn /DEST pdfmark end
 -2
710 a 396 793 a Fk(Y)-9 b(ou)19 b(need)g(a)h(goal)f(that')-5
b(s)20 b(crazy)f(and)f(simple)i(enough)d(to)j(get)g(people)e(out)h(of)g
(bed)g(in)h(the)f(morning.)e(Y)-9 b(our)19 b(community)396
901 y(has)i(to)f(attract)g(the)g(v)o(ery)g(best)g(people)f(and)h(that)g
(demands)f(something)g(special.)h(W)m(ith)g(\330MQ,)g(we)h(said)f(we)h
(were)396 1009 y(going)e(to)h(mak)o(e)g("the)g(F)o(astest.)h
(Messaging.)e(Ev)o(er)-5 b(.",)20 b(which)f(quali\002es)h(as)h(a)g
(good)e(moti)n(v)n(ator)-5 b(.)18 b(If)i(we')l(d)g(said,)g(we')l(re)396
1117 y(going)f(to)h(mak)o(e)g("a)h(smart)f(transport)f(layer)h(that')o
(ll)g(connect)f(your)g(mo)o(ving)f(pieces)i(cheaply)f(and)h(\003e)o
(xibly)f(across)396 1225 y(your)g(enterprise",)g(we')l(d)g(ha)n(v)o(e)h
(f)o(ailed.)-2 1409 y
SDict begin H.S end
 -2 1409 a -2 1409 a
SDict begin 13 H.A end
 -2 1409 a -2
1409 a
SDict begin [/View [/XYZ H.V]/Dest (0:4704) cvn /DEST pdfmark end
 -2 1409 a 396 1499 a Fk(Then)g(your)f(w)o(ork)g(must)h(be)g
(beautiful,)f(immediately)g(useful)h(and)f(attracti)n(v)o(e.)g(Y)-9
b(our)20 b(contrib)n(utors)e(are)i(users)g(who)396 1606
y(w)o(ant)h(to)f(e)o(xplore)e(just)j(a)g(little)g(be)o(yond)d(where)h
(the)o(y)h(are)g(no)n(w)-5 b(.)19 b(Mak)o(e)h(it)h(simple,)f(ele)o
(gant,)e(brutally)h(clean.)h(The)396 1714 y(e)o(xperience)e(when)i
(people)f(run)g(or)h(use)h(your)e(w)o(ork)g(should)g(be)i(an)f
(emotional)f(one.)g(The)o(y)g(should)3321 1714 y
SDict begin H.S end
 3321
1714 a 3321 1714 a
SDict begin 13 H.A end
 3321 1714 a 3321 1714 a
SDict begin [/View [/XYZ H.V]/Dest (0:4705) cvn /DEST pdfmark end
 3321 1714
a Ff(feel)i Fk(something,)396 1822 y(and)f(if)g(you)f(accurately)g
(solv)o(ed)g(e)n(v)o(en)h(just)g(one)g(big)f(problem)g(that)h(until)g
(then)g(the)o(y)f(didn')o(t)g(quite)g(realize)h(the)o(y)g(f)o(aced,)396
1930 y(you')o(ll)g(ha)n(v)o(e)f(a)i(small)f(part)g(of)g(their)g(soul.)
-2 2114 y
SDict begin H.S end
 -2 2114 a -2 2114 a
SDict begin 13 H.A end
 -2 2114 a -2 2114 a
SDict begin [/View [/XYZ H.V]/Dest (0:4706) cvn /DEST pdfmark end
 -2
2114 a 396 2204 a Fk(And)g(then,)f(easy)i(to)f(understand,)e(use,)i
(and)g(join.)f(T)-7 b(oo)20 b(man)o(y)f(projects)h(ha)n(v)o(e)f
(barriers)h(to)g(access:)h(put)f(yourself)f(in)396 2312
y(the)h(other)g(person')-5 b(s)19 b(mind)h(and)f(see)i(all)g(the)f
(reasons)g(the)o(y)f(come)h(to)g(your)f(site,)i(thinking)e("Uhm,)g
(interesting)396 2420 y(project,)g(b)n(ut...")h(and)f(then)h(lea)n(v)o
(e.)g(Y)-9 b(ou)19 b(w)o(ant)i(them)e(to)i(stay)-5 b(,)20
b(try)g(it,)g(just)h(once.)e(Use)i(GitHub)f(and)g(put)g(the)g(issue)396
2528 y(track)o(er)g(right)f(there.)-2 2712 y
SDict begin H.S end
 -2 2712
a -2 2712 a
SDict begin 13 H.A end
 -2 2712 a -2 2712 a
SDict begin [/View [/XYZ H.V]/Dest (0:4707) cvn /DEST pdfmark end
 -2 2712 a 396 2802 a
Fk(If)h(you)g(do)f(these)i(things)e(well,)i(your)e(community)f(will)j
(be)f(smart)g(b)n(ut)g(more)g(importantly)-5 b(,)17 b(will)k(be)f
(intellectually)396 2910 y(and)g(geographically)d(di)n(v)o(erse.)i
(This)h(is)i(really)d(important.)g(A)h(group)f(of)h(lik)o(e-minded)e(e)
o(xperts)h(cannot)g(e)o(xplore)g(the)396 3018 y(problem)g(landscape)g
(well.)h(The)o(y)f(tend)h(to)g(mak)o(e)g(big)g(mistak)o(es.)g(Di)n(v)o
(ersity)g(beats)g(education)f(an)o(y)g(time.)-2 3046
y
SDict begin H.S end
 -2 3046 a -2 3046 a
SDict begin 13 H.A end
 -2 3046 a -2 3046 a
SDict begin [/View [/XYZ H.V]/Dest (0:4708) cvn /DEST pdfmark end
 -2 3046 a 396
3356 a Fb(7.2.5.)36 b(Strang)q(er)-7 b(,)33 b(meet)h(Strang)q(er)2086
3356 y
SDict begin H.S end
 2086 3356 a 2086 3356 a
SDict begin 18.72 H.A end
 2086 3356 a 2086 3356
a
SDict begin [/View [/XYZ H.V]/Dest (12.90.62.2) cvn /DEST pdfmark end
 2086 3356 a -2 3549 a
SDict begin H.S end
 -2 3549 a -2 3549 a
SDict begin 13 H.A end
 -2 3549 a
-2 3549 a
SDict begin [/View [/XYZ H.V]/Dest (0:4710) cvn /DEST pdfmark end
 -2 3549 a 396 3630 a Fk(Ho)n(w)20 b(much)g(up-front)d
(agreement)i(do)h(tw)o(o)g(people)f(need)h(to)g(w)o(ork)g(together)e
(on)i(something?)f(In)h(most)396 3738 y(or)o(ganizations,)d(a)k(lot.)f
(But)h(you)e(can)h(bring)f(this)i(cost)f(do)n(wn)f(to)i(near)n(-zero,)d
(and)i(then)f(people)g(can)h(collaborate)396 3846 y(without)g(ha)n
(ving)f(e)n(v)o(er)g(met,)h(done)f(a)i(phone)e(conference,)e(meeting,)i
(or)h(b)n(usiness)h(trip)f(to)g(discuss)h(Roles)g(and)396
3954 y(Responsibilities)g(o)o(v)o(er)d(w)o(ay)j(too)e(man)o(y)g
(bottles)i(of)e(soju.)-2 4138 y
SDict begin H.S end
 -2 4138 a -2 4138 a
SDict begin 13 H.A end
 -2
4138 a -2 4138 a
SDict begin [/View [/XYZ H.V]/Dest (0:4711) cvn /DEST pdfmark end
 -2 4138 a 396 4228 a Fk(Y)-9 b(ou)20
b(need)f(well-written)h(rules)g(that)g(are)g(designed)f(by)h(c)o
(ynical)f(people)h(lik)o(e)g(me)g(to)h(force)e(strangers)g(into)h
(mutually)396 4336 y(bene\002cial)g(collaboration)e(instead)i(of)g
(con\003ict.)f(The)h(GPL)h(is)g(a)f(good)f(start.)i(GitHub)e(and)h(its)
h(fork/mer)o(ge)c(strate)o(gy)396 4444 y(is)k(a)g(good)e(follo)n(w-up.)
f(And)h(then)h(you)f(w)o(ant)i(something)d(lik)o(e)j(our)2380
4444 y
SDict begin H.S end
 2380 4444 a 2380 4444 a
SDict begin 13 H.A end
 2380 4444 a 2380 4444
a
SDict begin [/View [/XYZ H.V]/Dest (0:4712) cvn /DEST pdfmark end
 2380 4444 a Fk(C4)g(rulebook)d(\(http://rfc.zeromq.or)o(g/spe)o(c:16)
o(\))396 4552 y(to)j(control)e(ho)n(w)g(w)o(ork)h(actually)f(happens.)
-2 4736 y
SDict begin H.S end
 -2 4736 a -2 4736 a
SDict begin 13 H.A end
 -2 4736 a -2 4736 a
SDict begin [/View [/XYZ H.V]/Dest (0:4713) cvn /DEST pdfmark end
 -2
4736 a 396 4826 a Fk(C4)i(\(which)e(I)i(no)n(w)e(use)i(for)e(e)n(v)o
(ery)g(ne)n(w)h(open)f(source)h(project\))f(has)h(detailed)g(and)f
(tested)i(answers)f(to)g(a)h(lot)f(of)396 4934 y(common)e(mistak)o(es)i
(people)e(mak)o(e.)h(F)o(or)g(e)o(xample,)e(the)j(sin)g(of)f(w)o
(orking)f(of)n(f-line)g(in)h(a)h(corner)e(with)i(others)f("because)396
5042 y(it')-5 b(s)22 b(f)o(aster".)d(T)m(ransparenc)o(y)f(is)j
(essential)g(to)f(get)g(trust,)g(which)g(is)h(essential)g(to)f(get)g
(scale.)h(By)g(forcing)d(e)n(v)o(ery)h(single)396 5150
y(change)g(through)f(a)j(single)f(transparent)e(process,)i(you)f(b)n
(uild)h(real)g(trust)h(in)f(the)g(results.)p Black 3759
5569 a Ff(382)p Black eop end
%%Page: 383 396
TeXDict begin 383 395 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.383) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4714) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Another)f(cardinal)g(sin)i(that)f(man)o(y)f(open)g
(source)h(de)n(v)o(elopers)e(mak)o(e)i(is)h(to)f(place)g(themselv)o(es)
f(abo)o(v)o(e)g(others.)g("I)396 180 y(founded)f(this)j(project)e(thus)
h(my)g(intellect)g(is)h(superior)e(to)i(that)f(of)g(others".)f(It')-5
b(s)21 b(not)f(just)h(immodest)e(and)g(rude,)h(and)396
288 y(usually)g(inaccurate,)f(it')-5 b(s)21 b(also)f(poor)f(b)n
(usiness.)h(The)g(rules)g(must)h(apply)e(equally)g(to)h(e)n(v)o
(eryone,)e(without)h(distinction.)396 396 y(Y)-9 b(ou)20
b(are)g(part)g(of)g(the)g(community)-5 b(.)17 b(Y)-9
b(our)20 b(job,)f(as)i(founder)d(of)i(a)h(project,)e(is)i(not)f(to)g
(impose)g(your)e(vision)i(of)g(the)396 504 y(product)f(o)o(v)o(er)f
(others,)i(b)n(ut)g(to)g(mak)o(e)g(sure)g(the)g(rules)h(are)f(good,)e
(honest,)i(and)2683 504 y
SDict begin H.S end
 2683 504 a 2683 504 a
SDict begin 13 H.A end
 2683
504 a 2683 504 a
SDict begin [/View [/XYZ H.V]/Dest (0:4715) cvn /DEST pdfmark end
 2683 504 a Ff(enfor)m(ced)r Fk(.)-2
533 y
SDict begin H.S end
 -2 533 a -2 533 a
SDict begin 13 H.A end
 -2 533 a -2 533 a
SDict begin [/View [/XYZ H.V]/Dest (0:4716) cvn /DEST pdfmark end
 -2 533 a 396
843 a Fb(7.2.6.)36 b(In\002nite)e(Pr)n(oper)r(ty)1646
843 y
SDict begin H.S end
 1646 843 a 1646 843 a
SDict begin 18.72 H.A end
 1646 843 a 1646 843 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.63.2) cvn /DEST pdfmark end
 1646
843 a -2 1033 a
SDict begin H.S end
 -2 1033 a -2 1033 a
SDict begin 13 H.A end
 -2 1033 a -2 1033
a
SDict begin [/View [/XYZ H.V]/Dest (0:4718) cvn /DEST pdfmark end
 -2 1033 a 396 1117 a Fk(One)20 b(of)g(the)g(saddest)h(myths)e(of)h
(the)g(kno)n(wledge)e(b)n(usiness)j(is)g(that)f(ideas)h(are)f(a)g
(sensible)h(form)e(of)h(property)-5 b(.)17 b(It')-5 b(s)396
1225 y(medie)n(v)n(al)19 b(nonsense)g(that)i(should)e(ha)n(v)o(e)g
(been)h(junk)o(ed)f(along)g(with)h(sla)n(v)o(ery)-5 b(,)19
b(b)n(ut)i(sadly)f(it')-5 b(s)21 b(still)g(making)e(too)h(man)o(y)396
1333 y(po)n(werful)f(people)g(too)h(much)f(mone)o(y)-5
b(.)-2 1517 y
SDict begin H.S end
 -2 1517 a -2 1517 a
SDict begin 13 H.A end
 -2 1517 a -2 1517 a
SDict begin [/View [/XYZ H.V]/Dest (0:4719) cvn /DEST pdfmark end

-2 1517 a 396 1606 a Fk(Ideas)20 b(are)g(cheap.)f(What)i(does)f(w)o
(ork)f(sensibly)h(as)h(property)d(is)j(the)g(hard)e(w)o(ork)g(we)i(do)f
(in)g(b)n(uilding)f(a)i(mark)o(et.)e("Y)-9 b(ou)396 1714
y(eat)21 b(what)f(you)f(kill")i(is)g(the)f(right)g(model)f(for)g
(encouraging)f(people)h(to)h(w)o(ork)g(hard.)f(Whether)g(it')-5
b(s)21 b(moral)f(authority)396 1822 y(o)o(v)o(er)f(a)i(project,)e(mone)
o(y)f(from)h(consulting,)g(or)h(the)g(sale)h(of)f(a)g(trademark)f(to)h
(some)g(lar)o(ge,)f(rich)h(\002rm:)g(if)h(you)e(mak)o(e)h(it,)396
1930 y(you)g(o)n(wn)f(it.)i(But)g(what)f(you)f(really)h(o)n(wn)f(is)j
("footf)o(all",)c(participants)i(in)g(your)f(project,)g(which)h
(ultimately)f(de\002nes)396 2038 y(your)g(po)n(wer)g(in)i(the)f(Game.)
-2 2222 y
SDict begin H.S end
 -2 2222 a -2 2222 a
SDict begin 13 H.A end
 -2 2222 a -2 2222 a
SDict begin [/View [/XYZ H.V]/Dest (0:4720) cvn /DEST pdfmark end
 -2
2222 a 396 2312 a Fk(T)-7 b(o)20 b(do)g(this)g(requires)f(in\002nite)g
(free)h(space.)f(Thankfully)-5 b(,)17 b(GitHub)i(solv)o(ed)g(this)i
(problem)d(for)h(us,)h(for)f(which)g(I)h(will)h(die)396
2420 y(a)g(grateful)e(person)g(\(there)g(are)h(man)o(y)f(reasons)h(to)g
(be)h(grateful)e(in)h(life,)g(which)g(I)g(w)o(on')o(t)f(list)j(here)d
(because)h(we)g(only)396 2528 y(ha)n(v)o(e)g(a)g(hundred)e(or)i(so)h
(pages)f(left,)g(b)n(ut)g(this)h(is)g(one)e(of)h(them\).)-2
2712 y
SDict begin H.S end
 -2 2712 a -2 2712 a
SDict begin 13 H.A end
 -2 2712 a -2 2712 a
SDict begin [/View [/XYZ H.V]/Dest (0:4721) cvn /DEST pdfmark end
 -2 2712
a 396 2802 a Fk(Y)-9 b(ou)20 b(cannot)f(scale)i(a)f(single)g(project)g
(with)g(man)o(y)f(o)n(wners)g(lik)o(e)i(you)e(can)h(scale)h(a)g
(collection)e(of)h(man)o(y)f(small)396 2910 y(projects,)h(each)f(with)i
(fe)n(wer)e(o)n(wners.)h(When)g(we)g(embrace)f(forks,)g(a)i(person)e
(can)h(become)f(an)h("o)n(wner")f(with)h(a)396 3018 y(single)g(click.)g
(No)n(w)g(the)o(y)g(just)h(ha)n(v)o(e)e(to)h(con)m(vince)f(others)g(to)
i(join,)e(by)h(demonstrating)e(their)i(unique)f(v)n(alue.)-2
3202 y
SDict begin H.S end
 -2 3202 a -2 3202 a
SDict begin 13 H.A end
 -2 3202 a -2 3202 a
SDict begin [/View [/XYZ H.V]/Dest (0:4722) cvn /DEST pdfmark end
 -2 3202
a 396 3292 a Fk(So)i(in)f(\330MQ)g(we)h(aimed)f(to)g(mak)o(e)g(it)h
(easy)f(to)g(write)h(bindings)d(on)i(top)g(of)g(the)g(core)g(library)-5
b(,)18 b(and)i(we)g(stopped)g(trying)396 3400 y(to)h(mak)o(e)e(those)h
(bindings)f(ourselv)o(es.)g(This)h(created)g(space)g(for)f(others)h(to)
g(mak)o(e)g(those,)g(become)f(their)h(o)n(wners,)f(get)396
3508 y(that)i(credit.)-2 3519 y
SDict begin H.S end
 -2 3519 a -2 3519 a
SDict begin 13 H.A end
 -2
3519 a -2 3519 a
SDict begin [/View [/XYZ H.V]/Dest (0:4723) cvn /DEST pdfmark end
 -2 3519 a 396 3846 a Fb(7.2.7.)36 b(Care)e(and)f
(Feeding)1730 3846 y
SDict begin H.S end
 1730 3846 a 1730 3846 a
SDict begin 18.72 H.A end
 1730 3846
a 1730 3846 a
SDict begin [/View [/XYZ H.V]/Dest (12.90.64.2) cvn /DEST pdfmark end
 1730 3846 a -2 4039 a
SDict begin H.S end
 -2 4039 a -2 4039
a
SDict begin 13 H.A end
 -2 4039 a -2 4039 a
SDict begin [/View [/XYZ H.V]/Dest (0:4725) cvn /DEST pdfmark end
 -2 4039 a 396 4120 a Fk(I)21 b(wish)f(a)h
(community)d(could)h(be)h(100\045)g(self-steering,)f(and)g(perhaps)g
(one)h(day)f(this)i(will)g(w)o(ork,)e(b)n(ut)i(today)e(it')-5
b(s)21 b(not)396 4228 y(the)f(case.)h(W)-7 b(e')l(re)20
b(v)o(ery)f(close)h(with)g(\330MQ,)g(b)n(ut)g(from)f(my)h(e)o
(xperience)e(a)i(community)e(needs)i(four)f(types)h(of)f(care)h(and)396
4336 y(feeding:)-2 4354 y
SDict begin H.S end
 -2 4354 a -2 4354 a
SDict begin 13 H.A end
 -2 4354
a -2 4354 a
SDict begin [/View [/XYZ H.V]/Dest (0:4726) cvn /DEST pdfmark end
 -2 4354 a -2 4364 a
SDict begin H.S end
 -2 4364 a -2 4364 a
SDict begin 13 H.A end
 -2
4364 a -2 4364 a
SDict begin [/View [/XYZ H.V]/Dest (0:4727) cvn /DEST pdfmark end
 -2 4364 a Black 396 4506 a Fj(\225)p
Black 479 4506 a
SDict begin H.S end
 479 4506 a 479 4506 a
SDict begin 13 H.A end
 479 4506 a 479
4506 a
SDict begin [/View [/XYZ H.V]/Dest (0:4728) cvn /DEST pdfmark end
 479 4506 a Fk(First,)h(simply)f(because)f(most)i(people)e(are)h
(too)g(nice,)g(we)g(need)g(some)g(kind)f(of)h(symbolic)f(leadership)g
(or)h(o)n(wners)479 4614 y(who)g(pro)o(vide)e(ultimate)i(authority)f
(in)h(case)h(of)e(con\003ict.)h(Usually)g(it')-5 b(s)21
b(the)g(founders)d(of)i(the)g(community)-5 b(.)17 b(I')l(v)o(e)479
4722 y(seen)k(it)f(w)o(ork)g(with)g(self-elected)g(groups)f(of)g
("elders",)h(b)n(ut)g(old)g(men)g(lik)o(e)g(to)h(talk)f(a)g(lot.)h(I')l
(v)o(e)e(seen)h(communities)479 4830 y(split)h(o)o(v)o(er)e(the)h
(question)f("who)h(is)h(in)f(char)o(ge?",)e(and)i(setting)g(up)g(le)o
(gal)f(entities,)i(with)f(boards,)f(and)h(such,)f(seems)479
4938 y(to)i(mak)o(e)e(such)h(ar)o(guments)e(w)o(orse,)i(not)g(better)-5
b(.)20 b(Maybe)f(because)h(there)f(seems)i(to)f(be)g(more)g(to)g
(\002ght)g(o)o(v)o(er)-5 b(.)19 b(One)h(of)479 5046 y(the)g(real)h
(bene\002ts)f(of)g(free)f(softw)o(are)h(is)h(that)g(it')-5
b(s)21 b(al)o(w)o(ays)g(remixable,)d(so)j(instead)f(of)f(\002ghting)h
(o)o(v)o(er)e(a)j(pie,)f(one)479 5154 y(simply)g(forks)f(the)i(pie.)-2
5172 y
SDict begin H.S end
 -2 5172 a -2 5172 a
SDict begin 13 H.A end
 -2 5172 a -2 5172 a
SDict begin [/View [/XYZ H.V]/Dest (0:4729) cvn /DEST pdfmark end
 -2 5172
a Black 3759 5569 a Ff(383)p Black eop end
%%Page: 384 397
TeXDict begin 384 396 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.384) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black Black 396 72 a Fj(\225)p Black 479 72 a
SDict begin H.S end
 479 72
a 479 72 a
SDict begin 13 H.A end
 479 72 a 479 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:4730) cvn /DEST pdfmark end
 479 72 a Fk(Second,)f(communities)g(need)g
(li)n(ving)h(rules,)g(and)f(thus)i(the)o(y)e(need)h(a)g(la)o(wyer)g
(able)g(to)g(formulate)f(and)g(write)i(these)479 180
y(do)n(wn.)e(Rules)i(are)f(critical;)h(when)e(done)g(right,)h(the)o(y)f
(remo)o(v)o(e)f(friction.)h(When)h(done)f(wrong,)g(or)h(ne)o(glected,)e
(we)479 288 y(see)j(real)f(friction)f(and)h(ar)o(gument)e(that)i(can)g
(dri)n(v)o(e)f(a)o(w)o(ay)h(the)g(nice)g(majority)-5
b(,)19 b(lea)n(ving)g(the)i(ar)o(gumentati)n(v)o(e)16
b(core)k(in)479 396 y(char)o(ge)f(of)h(the)g(b)n(urning)e(house.)h(One)
i(thing)e(I')l(v)o(e)g(tried)h(to)g(do)g(with)g(the)h(\330MQ)f(and)g
(pre)n(vious)e(communities)h(is)479 504 y(create)h(reusable)g(rules,)f
(which)h(perhaps)f(means)h(we)h(don')o(t)d(need)i(la)o(wyers)f(as)i
(much.)-2 522 y
SDict begin H.S end
 -2 522 a -2 522 a
SDict begin 13 H.A end
 -2 522 a -2 522 a
SDict begin [/View [/XYZ H.V]/Dest (0:4731) cvn /DEST pdfmark end
 -2
522 a Black 396 654 a Fj(\225)p Black 479 654 a
SDict begin H.S end
 479 654
a 479 654 a
SDict begin 13 H.A end
 479 654 a 479 654 a
SDict begin [/View [/XYZ H.V]/Dest (0:4732) cvn /DEST pdfmark end
 479 654 a Fk(Thirdly)-5
b(,)18 b(communities)h(need)h(some)g(kind)f(of)h(\002nancial)g
(backing.)e(This)i(is)i(the)e(jagged)f(rock)g(that)h(breaks)g(most)479
762 y(ships.)g(If)h(you)e(starv)o(e)h(a)g(community)-5
b(,)18 b(it)i(becomes)g(more)f(creati)n(v)o(e)g(b)n(ut)h(the)h(core)e
(contrib)n(utors)g(b)n(urn)g(out.)h(If)g(you)479 869
y(pour)f(too)h(much)f(mone)o(y)g(into)h(it,)g(you)g(attract)g(the)g
(professionals,)f(who)g(ne)n(v)o(er)g(say)i("no",)e(and)h(the)g
(community)479 977 y(loses)h(its)g(di)n(v)o(ersity)e(and)h(creati)n
(vity)-5 b(.)19 b(If)h(you)f(create)h(a)g(fund)f(for)h(people)f(to)h
(share,)g(the)o(y)g(will)g(\002ght)g(\(bitterly\))f(o)o(v)o(er)479
1085 y(it.)i(W)m(ith)f(\330MQ)h(we)f(\(iMatix\))g(spend)f(our)h(time)g
(and)g(mone)o(y)e(on)i(mark)o(eting)f(and)g(packaging)f(\(lik)o(e)i
(this)h(book\),)479 1193 y(and)f(basic)g(care)g(-)h(b)n(ug)e(\002x)o
(es,)h(releases,)h(website.)-2 1211 y
SDict begin H.S end
 -2 1211 a -2 1211
a
SDict begin 13 H.A end
 -2 1211 a -2 1211 a
SDict begin [/View [/XYZ H.V]/Dest (0:4733) cvn /DEST pdfmark end
 -2 1211 a Black 396 1343 a Fj(\225)p
Black 479 1343 a
SDict begin H.S end
 479 1343 a 479 1343 a
SDict begin 13 H.A end
 479 1343 a 479
1343 a
SDict begin [/View [/XYZ H.V]/Dest (0:4734) cvn /DEST pdfmark end
 479 1343 a Fk(Lastly)-5 b(,)20 b(sales)h(and)f(commercial)e
(mediation.)h(There)g(is)j(a)e(natural)f(mark)o(et)h(between)f(e)o
(xpert)g(contrib)n(utors)g(and)479 1451 y(customers,)g(b)n(ut)g(both)g
(are)g(some)n(what)g(incompetent)e(at)j(talking)f(to)h(each)f(other)-5
b(.)19 b(Customers)g(assume)h(that)f(support)479 1559
y(is)i(free)e(or)g(v)o(ery)f(cheap,)h(since)g(the)h(softw)o(are)f(is)h
(free.)f(Contrib)n(utors)f(are)i(shy)f(at)h(asking)f(a)h(f)o(air)f
(rate)h(for)e(their)i(w)o(ork.)479 1667 y(It)h(mak)o(es)f(for)f(a)i
(dif)n(\002cult)f(mark)o(et.)f(A)i(gro)n(wing)d(part)i(of)g(my)g(w)o
(ork)f(and)h(my)g(\002rm')-5 b(s)20 b(pro\002ts)g(is)h(simply)f
(connecting)479 1774 y(\330MQ)h(users)f(who)g(w)o(ant)g(help,)g(with)g
(e)o(xperts)f(from)g(the)i(community)d(able)i(to)g(pro)o(vide)e(it,)j
(and)e(ensuring)g(both)479 1882 y(sides)i(are)f(happ)o(y)f(with)h(the)h
(results.)-2 2066 y
SDict begin H.S end
 -2 2066 a -2 2066 a
SDict begin 13 H.A end
 -2 2066 a -2
2066 a
SDict begin [/View [/XYZ H.V]/Dest (0:4735) cvn /DEST pdfmark end
 -2 2066 a 396 2156 a Fk(I')l(v)o(e)e(seen)i(communities)d(of)i
(brilliant)g(people)f(with)h(noble)g(goals)g(dying)e(because)i(the)g
(founders)e(got)i(some)g(or)g(all)h(of)396 2264 y(these)f(four)f
(things)g(wrong.)f(The)i(core)f(problem)f(is)j(that)f(you)e(can')o(t)h
(e)o(xpect)g(consistently)g(great)g(leadership)g(from)g(an)o(y)396
2372 y(one)h(compan)o(y)-5 b(,)17 b(person,)i(or)h(group.)e(What)j(w)o
(orks)e(today)h(often)f(w)o(on')o(t)g(w)o(ork)h(tomorro)n(w)-5
b(,)17 b(yet)j(structures)g(become)396 2480 y(more)g(solid,)g(not)f
(more)h(\003e)o(xible,)f(o)o(v)o(er)g(time.)-2 2658 y
SDict begin H.S end

-2 2658 a -2 2658 a
SDict begin 13 H.A end
 -2 2658 a -2 2658 a
SDict begin [/View [/XYZ H.V]/Dest (0:4736) cvn /DEST pdfmark end
 -2 2658 a 396
2754 a Fk(The)h(best)h(answer)e(I)i(can)f(\002nd)g(is)h(a)g(mix)f(of)f
(tw)o(o)i(things.)e(One,)h(the)g(GPL)h(and)f(its)h(guarantee)d(of)i
(remixability)-5 b(.)18 b(No)396 2862 y(matter)i(ho)n(w)g(bad)f(the)i
(authority)-5 b(,)18 b(no)h(matter)h(ho)n(w)g(much)f(the)o(y)h(try)g
(to)g(pri)n(v)n(atize)f(and)h(capture)f(the)h(community')-5
b(s)396 2970 y(w)o(ork,)20 b(if)g(it')-5 b(s)21 b(GPL)g(licensed,)e
(that)i(w)o(ork)e(can)h(w)o(alk)h(a)o(w)o(ay)e(and)h(\002nd)g(a)h
(better)e(authority)-5 b(.)18 b(Before)i(you)f(say)-5
b(,)20 b("all)h(open)396 3078 y(source)f(of)n(fers)f(this,")h(think)g
(it)h(through.)c(I)k(can)f(kill)g(a)h(BSD-licensed)f(project)f(by)h
(hiring)f(the)h(core)g(contrib)n(utors,)e(and)396 3186
y(not)i(releasing)g(an)o(y)f(ne)n(w)h(patches.)f(But)i(e)n(v)o(en)e
(with)i(a)f(billion)g(of)g(dollars)g(I)2594 3186 y
SDict begin H.S end
 2594
3186 a 2594 3186 a
SDict begin 13 H.A end
 2594 3186 a 2594 3186 a
SDict begin [/View [/XYZ H.V]/Dest (0:4737) cvn /DEST pdfmark end
 2594 3186
a Ff(cannot)g Fk(kill)h(a)f(GPL-licensed)g(project.)396
3294 y(T)-7 b(w)o(o,)20 b(the)h(philosophical)d(anarchist)h(model)h(of)
g(authority:)e(we)j(choose)e(it,)i(it)g(does)f(not)f(o)n(wn)h(us.)-2
3405 y
SDict begin H.S end
 -2 3405 a -2 3405 a
SDict begin 13 H.A end
 -2 3405 a -2 3405 a
SDict begin [/View [/XYZ H.V]/Dest (0:4738) cvn /DEST pdfmark end
 -2 3405
a 359 x Fn(7.3.)39 b(The)g(\330MQ)f(Pr)m(ocess)h(-)g(C4)1821
3764 y
SDict begin H.S end
 1821 3764 a 1821 3764 a
SDict begin 22.464 H.A end
 1821 3764 a 1821 3764
a
SDict begin [/View [/XYZ H.V]/Dest (12.91.1) cvn /DEST pdfmark end
 1821 3764 a -2 3938 a
SDict begin H.S end
 -2 3938 a -2 3938 a
SDict begin 13 H.A end
 -2 3938 a
-2 3938 a
SDict begin [/View [/XYZ H.V]/Dest (0:4740) cvn /DEST pdfmark end
 -2 3938 a 396 4038 a Fk(When)20 b(we)h(say)f(\330MQ)h(we)f
(sometimes)g(mean)g(libzmq,)f(the)h(core)g(library)-5
b(.)18 b(In)i(early)g(2012)f(we)h(synthesized)f(the)396
4146 y(libzmq)h(process)f(into)h(a)h(formal)e(protocol)f(for)i
(collaboration)e(that)i(we)h(called)f(the)2845 4146 y
SDict begin H.S end

2845 4146 a 2845 4146 a
SDict begin 13 H.A end
 2845 4146 a 2845 4146 a
SDict begin [/View [/XYZ H.V]/Dest (0:4741) cvn /DEST pdfmark end
 2845
4146 a Fk(Collecti)n(v)o(e)g(Code)g(Construction)396
4254 y(Contract)g(\(http://rfc.zeromq.or)o(g)o(/spec:16)o(\),)14
b(or)19 b(C4.)h(Y)-9 b(ou)20 b(can)f(see)i(this)f(as)h(a)f(layer)f(abo)
o(v)o(e)f(the)i(GPL.)g(In)g(f)o(act)g(libzmq)396 4362
y(doesn')o(t)f(quite)h(stick)g(to)h(C4,)f(since)g(for)g(historic)g
(reasons)g(we)g(use)h(Jira)f(instead)g(of)g(the)g(GitHub)g(issue)h
(track)o(er)-5 b(.)19 b(But)396 4470 y(apart)h(from)f(that,)h(these)h
(are)f(our)f(rules,)h(and)g(I')o(ll)g(e)o(xplain)f(the)h(reasoning)f
(behind)f(each)i(one.)-2 4654 y
SDict begin H.S end
 -2 4654 a -2 4654 a
SDict begin 13 H.A end
 -2
4654 a -2 4654 a
SDict begin [/View [/XYZ H.V]/Dest (0:4742) cvn /DEST pdfmark end
 -2 4654 a 396 4744 a Fk(C4)h(is)g(an)f(e)n(v)n
(olution)f(of)h(the)g(GitHub)1502 4744 y
SDict begin H.S end
 1502 4744 a
1502 4744 a
SDict begin 13 H.A end
 1502 4744 a 1502 4744 a
SDict begin [/View [/XYZ H.V]/Dest (0:4743) cvn /DEST pdfmark end
 1502 4744 a Fk(F)o(ork)f(+)i(Pull)f
(Model)g(\(http://help.github)m(.com/send)o(-pu)o(ll-re)o(qu)o
(ests/\).)15 b(Y)-9 b(ou)396 4852 y(may)20 b(get)g(the)g(feeling)g(I'm)
f(a)i(f)o(an)f(of)g(git)g(and)g(GitHub)m(.)f(This)h(w)o(ould)g(be)g
(accurate:)f(these)i(tw)o(o)f(tools)h(ha)n(v)o(e)e(made)h(such)396
4960 y(a)h(positi)n(v)o(e)e(impact)h(on)g(our)f(w)o(ork)h(o)o(v)o(er)f
(the)h(last)h(years,)e(and)h(especially)g(when)f(it)i(comes)f(to)h(b)n
(uilding)d(community)-5 b(.)-2 4978 y
SDict begin H.S end
 -2 4978 a -2 4978
a
SDict begin 13 H.A end
 -2 4978 a -2 4978 a
SDict begin [/View [/XYZ H.V]/Dest (0:4744) cvn /DEST pdfmark end
 -2 4978 a Black 3759 5569 a Ff(384)p
Black eop end
%%Page: 385 398
TeXDict begin 385 397 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.385) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4761) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 74 a Fb(7.3.1.)36 b(Langua)o(g)q(e)1292 74
y
SDict begin H.S end
 1292 74 a 1292 74 a
SDict begin 18.72 H.A end
 1292 74 a 1292 74 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.65.2) cvn /DEST pdfmark end
 1292 74 a -2
101 a
SDict begin H.S end
 -2 101 a -2 101 a
SDict begin 13 H.A end
 -2 101 a -2 101 a
SDict begin [/View [/XYZ H.V]/Dest (0:4746) cvn /DEST pdfmark end
 -2 101 a -2
184 a
SDict begin H.S end
 -2 184 a -2 184 a
SDict begin 11.7 H.A end
 -2 184 a -2 184 a
SDict begin [/View [/XYZ H.V]/Dest (0:4747) cvn /DEST pdfmark end
 -2 184 a 479
254 a Fa(The)19 b(k)o(e)o(y)h(w)o(ords)f("MUST",)g("MUST)g(NO)m(T",)f
("REQ)o(UIRED",)h("SHALL",)f("SHALL)g(NO)m(T",)g("SHOULD",)g("SHOULD)
479 351 y(NO)m(T",)h("RECOMMENDED",)f("MA)-8 b(Y",)20
b(and)f("OPTION)m(AL")f(in)h(this)g(document)h(are)f(to)f(be)h
(interpreted)g(as)g(described)h(in)479 449 y(RFC)e(2119.)-2
616 y
SDict begin H.S end
 -2 616 a -2 616 a
SDict begin 13 H.A end
 -2 616 a -2 616 a
SDict begin [/View [/XYZ H.V]/Dest (0:4748) cvn /DEST pdfmark end
 -2 616 a 396
723 a Fk(By)j(starting)f(with)g(the)g(RFC)i(2119)d(language,)f(the)i
(C4)h(te)o(xt)f(mak)o(es)g(v)o(ery)f(clear)h(its)h(intention)e(to)i
(act)f(as)h(a)g(protocol)396 830 y(rather)f(than)f(a)i(randomly)d
(written)i(set)h(of)f(recommendations.)d(A)j(protocol)f(is)i(a)f
(contract)g(between)f(parties,)h(that)396 938 y(de\002nes)g(the)g
(rights)g(and)g(obligations)e(of)i(each)g(party)-5 b(.)19
b(These)h(can)g(be)g(peers)g(in)g(a)h(netw)o(ork.)e(The)o(y)g(can)h(be)
g(strangers)396 1046 y(w)o(orking)f(in)h(the)g(same)h(project.)-2
1230 y
SDict begin H.S end
 -2 1230 a -2 1230 a
SDict begin 13 H.A end
 -2 1230 a -2 1230 a
SDict begin [/View [/XYZ H.V]/Dest (0:4749) cvn /DEST pdfmark end
 -2 1230
a 396 1320 a Fk(I)g(think)e(C4)i(is)g(the)f(\002rst)h(time)f(an)o(yone)
f(has)h(attempted)f(to)i(codify)e(a)h(community')-5 b(s)18
b(rulebook)g(as)j(a)g(formal)e(and)396 1428 y(reusable)h(protocol)e
(spec.)i(Before,)g(our)f(rules)h(were)g(spread)g(out)f(o)o(v)o(er)g(se)
n(v)o(eral)h(wiki)g(pages,)g(and)f(quite)h(speci\002c)h(to)396
1536 y(libzmq)f(in)g(man)o(y)f(w)o(ays.)h(But)h(e)o(xperience)d
(teaches)i(us)h(that)f(the)g(more)g(formal)f(and)g(accurate)h(and)f
(reusable)h(the)396 1644 y(rules,)g(the)g(easier)h(it)g(is)g(for)e
(strangers)h(to)g(collaborate)f(up-front.)e(And)j(less)h(friction)f
(means)f(a)i(more)e(scalable)396 1752 y(community)-5
b(.)18 b(At)i(the)h(time)f(of)g(C4,)g(we)h(also)f(had)g(some)g
(disagreement)e(in)j(the)f(libzmq)f(o)o(v)o(er)g(precisely)h(what)g
(process)396 1860 y(we)h(were)f(using.)f(Not)i(e)n(v)o(eryone)c(felt)k
(bound)d(by)i(the)g(same)g(rules.)g(Let')-5 b(s)21 b(just)g(say)f(some)
g(people)f(felt)i(the)o(y)e(had)h(a)396 1968 y(special)h(status,)f
(which)g(created)f(friction)g(with)i(the)f(rest)h(of)f(the)g(community)
-5 b(.)17 b(So)k(codi\002cation)d(made)i(things)g(clear)-5
b(.)-2 2152 y
SDict begin H.S end
 -2 2152 a -2 2152 a
SDict begin 13 H.A end
 -2 2152 a -2 2152 a
SDict begin [/View [/XYZ H.V]/Dest (0:4750) cvn /DEST pdfmark end

-2 2152 a 396 2242 a Fk(It')g(s)21 b(easy)f(to)h(use)f(C4:)h(just)g
(host)f(your)f(project)g(on)h(GitHub,)f(get)i(one)e(other)h(person)f
(to)h(join,)g(and)f(open)g(the)i(\003oor)e(to)396 2350
y(pull)h(requests.)g(In)g(your)f(README,)h(put)g(a)g(link)g(to)g(C4)h
(and)f(that')-5 b(s)20 b(it.)h(W)-7 b(e')l(v)o(e)20 b(done)f(this)i(in)
f(quite)g(a)h(fe)n(w)f(projects)396 2458 y(and)g(it)h(does)f(seem)g(to)
g(w)o(ork.)g(I')l(v)o(e)f(been)g(pleasantly)h(surprised)f(a)h(fe)n(w)h
(times)f(just)h(applying)d(these)j(rules)f(to)g(my)g(o)n(wn)396
2566 y(w)o(ork,)g(lik)o(e)g(CZMQ.)g(W)-7 b(e)22 b(are)e(none)f(of)h
(us,)g(as)h(I')o(ll)g(e)o(xplain)d(later)j(in)f(this)h(chapter)m(,)d
(so)j(amazing)e(that)h(we)h(can)f(w)o(ork)396 2674 y(without)g(others.)
-2 2685 y
SDict begin H.S end
 -2 2685 a -2 2685 a
SDict begin 13 H.A end
 -2 2685 a -2 2685 a
SDict begin [/View [/XYZ H.V]/Dest (0:4751) cvn /DEST pdfmark end
 -2
2685 a 396 3012 a Fb(7.3.2.)36 b(Goals)1060 3012 y
SDict begin H.S end
 1060
3012 a 1060 3012 a
SDict begin 18.72 H.A end
 1060 3012 a 1060 3012 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.66.2) cvn /DEST pdfmark end
 1060 3012
a -2 3013 a
SDict begin H.S end
 -2 3013 a -2 3013 a
SDict begin 13 H.A end
 -2 3013 a -2 3013 a
SDict begin [/View [/XYZ H.V]/Dest (0:4753) cvn /DEST pdfmark end
 -2
3013 a -2 3097 a
SDict begin H.S end
 -2 3097 a -2 3097 a
SDict begin 11.7 H.A end
 -2 3097 a -2 3097
a
SDict begin [/View [/XYZ H.V]/Dest (0:4754) cvn /DEST pdfmark end
 -2 3097 a 479 3192 a Fa(C4)19 b(is)g(meant)g(to)g(pro)o(vide)h(a)e
(reusable)i(optimal)f(collaboration)h(model)g(for)e(open)i(source)g
(softw)o(are)f(projects.)-2 3374 y
SDict begin H.S end
 -2 3374 a -2 3374
a
SDict begin 13 H.A end
 -2 3374 a -2 3374 a
SDict begin [/View [/XYZ H.V]/Dest (0:4755) cvn /DEST pdfmark end
 -2 3374 a 396 3466 a Fk(The)h(short)g(term)g
(reason)f(for)h(writing)f(C4)i(w)o(as)g(to)f(end)g(ar)o(gument)e(o)o(v)
o(er)h(the)h(libzmq)f(contrib)n(ution)f(process.)i(The)396
3574 y(dissenters)g(went)h(of)n(f)e(else)n(where.)1413
3574 y
SDict begin H.S end
 1413 3574 a 1413 3574 a
SDict begin 13 H.A end
 1413 3574 a 1413 3574
a
SDict begin [/View [/XYZ H.V]/Dest (0:4756) cvn /DEST pdfmark end
 1413 3574 a Fk(The)h(\330MQ)h(community)d(blossomed)396
3682 y(\(https://github)m(.com/zeromq/libzm)o(q/gr)o(aph)o(s/con)o
(trib)n(uto)o(rs\),)c(smoothly)19 b(and)h(easily)-5 b(,)20
b(as)g(I')l(d)g(predicted.)e(Most)396 3790 y(people)h(were)h
(surprised,)f(b)n(ut)h(grati\002ed.)g(There')-5 b(s)19
b(been)h(no)g(real)g(criticisms)h(of)e(C4)i(e)o(xcept)e(its)i
(branching)d(polic)o(y)-5 b(,)396 3898 y(which)20 b(I')o(ll)g(come)g
(to)g(later)h(since)f(it)h(deserv)o(es)e(its)i(o)n(wn)f(discussion.)-2
4065 y
SDict begin H.S end
 -2 4065 a -2 4065 a
SDict begin 13 H.A end
 -2 4065 a -2 4065 a
SDict begin [/View [/XYZ H.V]/Dest (0:4757) cvn /DEST pdfmark end
 -2 4065
a 396 4172 a Fk(There')-5 b(s)20 b(a)h(reason)e(I'm)h(bringing)e(up)i
(history)f(here:)h(as)h(founder)d(of)h(a)i(community)-5
b(,)17 b(you)j(are)g(asking)f(people)g(to)396 4280 y(in)m(v)o(est)h(in)
g(your)f(property)-5 b(,)17 b(trademark,)i(branding.)e(In)j(return,)f
(and)h(this)g(is)h(what)g(we)f(do)g(with)g(\330MQ,)g(you)g(can)g(use)
396 4388 y(that)h(branding)c(to)k(set)g(a)f(bar)g(for)g(quality)-5
b(.)18 b(When)i(you)g(do)n(wnload)e(a)j(product)d(labeled)h(as)i
("\330MQ",)f(you)g(kno)n(w)f(that)396 4496 y(it')-5 b(s)22
b(been)d(produced)f(to)i(certain)g(standards.)f(It')-5
b(s)21 b(a)f(basic)h(rule)f(of)f(quality:)h(write)g(do)n(wn)f(your)g
(process,)h(otherwise)396 4604 y(you)g(cannot)f(impro)o(v)o(e)f(it.)i
(Our)g(processes)g(aren')o(t)f(perfect,)g(the)o(y)g(can')o(t)h(e)n(v)o
(er)f(be.)h(But)g(an)o(y)g(\003a)o(w)g(in)h(them)f(can)f(be)396
4711 y(\002x)o(ed,)h(and)f(tested.)-2 4889 y
SDict begin H.S end
 -2 4889
a -2 4889 a
SDict begin 13 H.A end
 -2 4889 a -2 4889 a
SDict begin [/View [/XYZ H.V]/Dest (0:4758) cvn /DEST pdfmark end
 -2 4889 a 396 4985 a
Fk(Making)g(C4)i(reusable)e(is)i(therefore)e(really)h(important.)e(T)-7
b(o)20 b(learn)g(more)f(about)h(the)g(best)g(possible)g(process)g(we)h
(need)396 5093 y(to)g(get)f(results)g(from)f(the)i(widest)f(range)f(of)
h(projects.)-2 5111 y
SDict begin H.S end
 -2 5111 a -2 5111 a
SDict begin 13 H.A end
 -2 5111 a -2
5111 a
SDict begin [/View [/XYZ H.V]/Dest (0:4759) cvn /DEST pdfmark end
 -2 5111 a Black 3759 5569 a Ff(385)p Black eop
end
%%Page: 386 399
TeXDict begin 386 398 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.386) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4778) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4760) cvn /DEST pdfmark end
 -2
-11 a 479 72 a Fa(It)f(has)g(these)g(speci\002c)g(goals:)479
211 y(T)-6 b(o)19 b(maximize)g(the)g(scale)g(of)g(the)g(community)h
(around)h(a)d(project,)h(by)h(reducing)g(the)f(friction)f(for)h(ne)n(w)
h(Contrib)o(utors)f(and)479 308 y(creating)h(a)e(scaled)i
(participation)f(model)h(with)e(strong)i(positi)n(v)o(e)f(feedbacks;)-2
490 y
SDict begin H.S end
 -2 490 a -2 490 a
SDict begin 13 H.A end
 -2 490 a -2 490 a
SDict begin [/View [/XYZ H.V]/Dest (0:4762) cvn /DEST pdfmark end
 -2 490 a 396
582 a Fk(The)h(number)f(one)g(goal)h(is)h(size)g(and)e(health)h(of)g
(the)g(community)-5 b(.)18 b(Not)i(technical)f(quality)-5
b(,)19 b(not)h(pro\002ts,)g(not)396 690 y(performance,)d(not)i(mark)o
(et)g(share.)g(Simply)-5 b(,)19 b(number)f(of)h(people)g(who)g(contrib)
n(ute)f(to)i(the)g(project.)e(The)i(science)f(here)396
798 y(is)i(simple:)g(the)f(lar)o(ger)f(the)h(community)-5
b(,)17 b(the)j(more)g(accurate)f(the)h(results.)-2 816
y
SDict begin H.S end
 -2 816 a -2 816 a
SDict begin 13 H.A end
 -2 816 a -2 816 a
SDict begin [/View [/XYZ H.V]/Dest (0:4763) cvn /DEST pdfmark end
 -2 816 a -2 899
a
SDict begin H.S end
 -2 899 a -2 899 a
SDict begin 11.7 H.A end
 -2 899 a -2 899 a
SDict begin [/View [/XYZ H.V]/Dest (0:4764) cvn /DEST pdfmark end
 -2 899 a 479 978
a Fa(T)-6 b(o)19 b(relie)n(v)o(e)g(dependencies)i(on)f(k)o(e)o(y)f
(indi)n(viduals)h(by)g(separating)f(dif)n(ferent)g(skill)g(sets)g(so)g
(that)g(there)g(is)f(a)h(lar)o(ger)g(pool)g(of)479 1075
y(competence)i(in)e(an)o(y)g(required)h(domain;)-2 1258
y
SDict begin H.S end
 -2 1258 a -2 1258 a
SDict begin 13 H.A end
 -2 1258 a -2 1258 a
SDict begin [/View [/XYZ H.V]/Dest (0:4765) cvn /DEST pdfmark end
 -2 1258 a 396
1349 a Fk(Perhaps)g(the)g(w)o(orst)g(problem)f(we)h(f)o(aced)g(in)h
(libzmq)e(w)o(as)i(dependence)d(on)h(people)g(who)h(could)f(at)i(the)f
(same)h(time)396 1457 y(understand)d(the)j(code,)e(manage)g(GitHub)h
(branches,)e(and)i(mak)o(e)g(clean)f(releases.)i(It')-5
b(s)21 b(lik)o(e)f(looking)e(for)i(athletes)396 1565
y(who)g(can)g(run)f(both)h(marathons)e(and)i(sprint,)g(swim,)g(and)g
(also)g(lift)h(weights.)f(W)-7 b(e)21 b(humans)e(are)h(really)g(good)f
(at)396 1673 y(specialization.)g(Asking)h(us)g(to)h(be)f(really)g(good)
f(at)h(tw)o(o)h(contradictory)c(things)j(just)h(reduces)e(the)h(number)
e(of)396 1781 y(candidates)h(sharply)-5 b(,)17 b(which)i(is)h(a)g(Bad)g
(Thing)e(for)h(an)o(y)f(project.)h(W)-7 b(e)20 b(had)f(this)h(problem)d
(se)n(v)o(erely)i(in)g(libzmq)g(in)g(2009)396 1889 y(or)h(so,)g(and)g
(\002x)o(ed)g(it)h(by)e(splitting)h(the)h(role)e(of)h(maintainer)f
(into)h(tw)o(o:)h(one)e(person)g(mak)o(es)h(patches,)g(another)f
(person)396 1997 y(mak)o(es)h(releases.)-2 1998 y
SDict begin H.S end
 -2
1998 a -2 1998 a
SDict begin 13 H.A end
 -2 1998 a -2 1998 a
SDict begin [/View [/XYZ H.V]/Dest (0:4766) cvn /DEST pdfmark end
 -2 1998 a -2 2081
a
SDict begin H.S end
 -2 2081 a -2 2081 a
SDict begin 11.7 H.A end
 -2 2081 a -2 2081 a
SDict begin [/View [/XYZ H.V]/Dest (0:4767) cvn /DEST pdfmark end
 -2 2081 a 479
2177 a Fa(T)-6 b(o)19 b(allo)n(w)g(the)g(project)g(to)g(de)n(v)o(elop)h
(f)o(aster)f(and)h(more)f(accurately)-5 b(,)19 b(by)h(increasing)f(the)
g(di)n(v)o(ersity)h(of)f(the)g(decision)g(making)479
2274 y(process;)-2 2456 y
SDict begin H.S end
 -2 2456 a -2 2456 a
SDict begin 13 H.A end
 -2 2456
a -2 2456 a
SDict begin [/View [/XYZ H.V]/Dest (0:4768) cvn /DEST pdfmark end
 -2 2456 a 396 2548 a Fk(This)i(is)g(theory)-5
b(,)18 b(not)i(fully)f(pro)o(v)o(en)f(b)n(ut)i(not)g(f)o(alsi\002ed.)g
(The)g(di)n(v)o(ersity)f(of)h(the)g(community)e(and)i(number)e(of)i
(people)396 2656 y(who)g(can)g(weigh)g(into)g(discussions,)f(without)h
(fear)g(of)f(being)h(criticized)f(or)h(dismissed,)g(the)h(f)o(aster)f
(and)f(more)396 2764 y(accurately)g(the)h(softw)o(are)g(should)f(de)n
(v)o(elop,)f(Speed)i(is)h(quite)f(subjecti)n(v)o(e)f(here.)g(Going)h(v)
o(ery)f(f)o(ast)i(in)f(the)g(wrong)396 2872 y(direction)f(is)i(not)f
(just)h(useless,)g(it')-5 b(s)21 b(acti)n(v)o(ely)e(damaging)f(\(and)i
(we)g(suf)n(fered)f(a)h(lot)h(of)f(that)g(in)g(libzmq)g(before)f(we)396
2980 y(switched)h(to)h(C4\).)-2 2995 y
SDict begin H.S end
 -2 2995 a -2 2995
a
SDict begin 13 H.A end
 -2 2995 a -2 2995 a
SDict begin [/View [/XYZ H.V]/Dest (0:4769) cvn /DEST pdfmark end
 -2 2995 a -2 3078 a
SDict begin H.S end
 -2 3078 a -2
3078 a
SDict begin 11.7 H.A end
 -2 3078 a -2 3078 a
SDict begin [/View [/XYZ H.V]/Dest (0:4770) cvn /DEST pdfmark end
 -2 3078 a 479 3160 a Fa(T)-6
b(o)19 b(support)h(the)f(natural)g(life-c)o(ycle)g(of)g(project)g(v)o
(ersions)g(from)g(e)o(xperimental)h(through)g(to)f(stable,)g(by)g(allo)
n(wing)g(safe)479 3257 y(e)o(xperimentation,)h(rapid)f(f)o(ailure,)g
(and)h(isolation)f(of)g(stable)g(code;)-2 3439 y
SDict begin H.S end
 -2 3439
a -2 3439 a
SDict begin 13 H.A end
 -2 3439 a -2 3439 a
SDict begin [/View [/XYZ H.V]/Dest (0:4771) cvn /DEST pdfmark end
 -2 3439 a 396 3531 a
Fk(T)-7 b(o)21 b(be)f(honest,)f(this)i(goal)e(seems)i(to)f(be)h(f)o
(ading)e(into)h(irrele)n(v)n(ance.)e(It')-5 b(s)21 b(quite)e(an)h
(interesting)g(ef)n(fect)f(of)h(the)h(process:)396 3639
y
SDict begin H.S end
 396 3639 a 396 3639 a
SDict begin 13 H.A end
 396 3639 a 396 3639 a
SDict begin [/View [/XYZ H.V]/Dest (0:4772) cvn /DEST pdfmark end
 396 3639
a Ff(the)f(git)h(master)g(is)g(almost)f(always)g(perfectly)h(stable)p
Fk(.)e(This)i(has)f(to)h(do)e(with)i(the)f(size)h(of)f(changes,)f(and)g
(their)396 3747 y("latenc)o(y",)g(i.e.)h(the)g(time)h(between)e
(someone)g(writing)h(the)g(code,)f(and)h(someone)f(actually)g(using)h
(it)h(fully)-5 b(.)19 b(Ho)n(we)n(v)o(er)m(,)396 3855
y(people)g(still)j(e)o(xpect)d("stable")h(releases,)g(so)h(we')o(ll)f
(k)o(eep)g(this)h(goal)f(there)f(for)h(a)g(while.)-2
3873 y
SDict begin H.S end
 -2 3873 a -2 3873 a
SDict begin 13 H.A end
 -2 3873 a -2 3873 a
SDict begin [/View [/XYZ H.V]/Dest (0:4773) cvn /DEST pdfmark end
 -2 3873
a -2 3956 a
SDict begin H.S end
 -2 3956 a -2 3956 a
SDict begin 11.7 H.A end
 -2 3956 a -2 3956 a
SDict begin [/View [/XYZ H.V]/Dest (0:4774) cvn /DEST pdfmark end
 -2
3956 a 479 4035 a Fa(T)-6 b(o)19 b(reduce)h(the)f(internal)g(comple)o
(xity)h(of)e(project)i(repositories,)f(thus)g(making)h(it)e(easier)h
(for)g(Contrib)o(utors)g(to)f(participate)479 4132 y(and)i(reducing)g
(the)f(scope)h(for)f(error;)-2 4314 y
SDict begin H.S end
 -2 4314 a -2 4314
a
SDict begin 13 H.A end
 -2 4314 a -2 4314 a
SDict begin [/View [/XYZ H.V]/Dest (0:4775) cvn /DEST pdfmark end
 -2 4314 a 396 4406 a Fk(Curious)h(observ)n
(ation:)e(people)h(who)h(thri)n(v)o(e)f(in)h(comple)o(x)f(situations)h
(lik)o(e)g(to)h(create)f(comple)o(xity)e(because)h(it)i(k)o(eeps)396
4514 y(their)f(v)n(alue)g(high.)f(It')-5 b(s)21 b(the)f(Cobra)g(Ef)n
(fect)f(\(Google)g(it\).)h(Git)h(made)f(branches)e(easy)j(and)e(left)i
(us)f(with)h(the)f(all)h(too)396 4622 y(common)e(syndrome)f(of)i("git)g
(is)h(easy)f(once)g(you)f(understand)f(that)j(a)f(git)h(branch)d(is)j
(just)g(a)g(folded)e(\002)n(v)o(e-dimensional)396 4730
y(lepton)h(space)g(that)g(has)g(a)h(detached)e(history)g(with)i(no)e
(interv)o(ening)f(cache".)h(De)n(v)o(elopers)g(should)g(not)h(be)g
(made)g(to)396 4838 y(feel)g(stupid)g(by)g(their)g(tools.)g(I')l(v)o(e)
f(too)h(man)o(y)f(top-class)h(de)n(v)o(elopers)e(confused)g(by)i
(repository)e(structures,)i(to)g(accept)396 4946 y(con)m(v)o(entional)d
(wisdom)j(on)g(git)g(branches.)f(W)-7 b(e')o(ll)21 b(come)f(back)f(to)i
(dispose)e(of)h(git)h(branches)e(shortly)-5 b(,)18 b(dear)i(reader)-5
b(.)-2 4964 y
SDict begin H.S end
 -2 4964 a -2 4964 a
SDict begin 13 H.A end
 -2 4964 a -2 4964 a
SDict begin [/View [/XYZ H.V]/Dest (0:4776) cvn /DEST pdfmark end

-2 4964 a Black 3757 5569 a Ff(386)p Black eop end
%%Page: 387 400
TeXDict begin 387 399 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.387) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4777) cvn /DEST pdfmark end
 -2
-11 a 479 72 a Fa(T)-6 b(o)19 b(enforce)g(collecti)n(v)o(e)f(o)n
(wnership)i(of)e(the)h(project,)f(which)h(increases)g(economic)h
(incenti)n(v)o(e)f(to)f(Contrib)o(utors)h(and)g(reduces)479
170 y(the)g(risk)g(of)g(hijack)g(by)h(hostile)f(entities.)396
444 y Fk(Ultimately)-5 b(,)20 b(we')l(re)f(economic)g(creatures,)g(and)
g(the)i(sense)f(that)g("we)h(o)n(wn)f(this,)g(and)g(our)f(w)o(ork)h
(can)g(ne)n(v)o(er)e(be)j(used)396 552 y(against)f(us")g(mak)o(es)g(it)
g(much)f(easier)h(for)g(people)f(to)h(in)m(v)o(est)f(in)h(an)g(open)f
(source)g(project)g(lik)o(e)i(\330MQ.)f(And)f(it)i(can')o(t)e(be)396
659 y(just)i(a)g(feeling,)e(it)i(has)f(to)g(be)g(real.)g(There)g(are)g
(a)h(number)d(of)i(aspects)g(to)h(making)e(collecti)n(v)o(e)g(o)n
(wnership)f(w)o(ork,)i(we')o(ll)396 767 y(see)h(these)f(one)g(by)g(one)
f(as)i(we)g(go)f(through)e(C4.)-2 796 y
SDict begin H.S end
 -2 796 a -2 796
a
SDict begin 13 H.A end
 -2 796 a -2 796 a
SDict begin [/View [/XYZ H.V]/Dest (0:4779) cvn /DEST pdfmark end
 -2 796 a 396 1106 a Fb(7.3.3.)36
b(Preliminaries)1478 1106 y
SDict begin H.S end
 1478 1106 a 1478 1106 a
SDict begin 18.72 H.A end
 1478
1106 a 1478 1106 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.67.2) cvn /DEST pdfmark end
 1478 1106 a -2 1107 a
SDict begin H.S end
 -2 1107 a -2
1107 a
SDict begin 13 H.A end
 -2 1107 a -2 1107 a
SDict begin [/View [/XYZ H.V]/Dest (0:4781) cvn /DEST pdfmark end
 -2 1107 a -2 1190 a
SDict begin H.S end
 -2 1190
a -2 1190 a
SDict begin 11.7 H.A end
 -2 1190 a -2 1190 a
SDict begin [/View [/XYZ H.V]/Dest (0:4782) cvn /DEST pdfmark end
 -2 1190 a 479 1286 a
Fa(The)19 b(project)g(SHALL)f(use)h(the)g(git)g(distrib)o(uted)f(re)n
(vision)i(control)f(system.)-2 1468 y
SDict begin H.S end
 -2 1468 a -2 1468
a
SDict begin 13 H.A end
 -2 1468 a -2 1468 a
SDict begin [/View [/XYZ H.V]/Dest (0:4783) cvn /DEST pdfmark end
 -2 1468 a 396 1560 a Fk(Git)i(has)g(its)g(f)o
(aults.)f(Its)h(command-line)c(API)k(is)g(horribly)d(inconsistent,)h
(and)h(it)h(has)f(a)h(comple)o(x,)d(messy)i(internal)396
1668 y(model)g(that)g(it)h(sho)o(v)o(es)e(in)h(your)f(f)o(ace)h(at)h
(the)f(slightest)h(pro)o(v)n(ocation.)c(But)k(despite)f(doing)f(its)i
(best)f(to)h(mak)o(e)e(its)j(users)396 1776 y(feel)d(stupid,)f(git)i
(does)e(its)i(job)f(really)-5 b(,)18 b(really)g(well.)h(More)g
(pragmatically)-5 b(,)16 b(I')l(v)o(e)i(found)f(that)i(if)g(you)f(stay)
i(a)o(w)o(ay)e(certain)396 1884 y(areas)j(\(branches!\),)c(people)i
(learn)h(git)g(rapidly)f(and)h(don')o(t)e(mak)o(e)i(man)o(y)f(mistak)o
(es.)h(That)g(data)g(w)o(orks)g(for)g(me.)-2 1902 y
SDict begin H.S end
 -2
1902 a -2 1902 a
SDict begin 13 H.A end
 -2 1902 a -2 1902 a
SDict begin [/View [/XYZ H.V]/Dest (0:4784) cvn /DEST pdfmark end
 -2 1902 a -2 1985
a
SDict begin H.S end
 -2 1985 a -2 1985 a
SDict begin 11.7 H.A end
 -2 1985 a -2 1985 a
SDict begin [/View [/XYZ H.V]/Dest (0:4785) cvn /DEST pdfmark end
 -2 1985 a 479
2064 a Fa(The)f(project)g(SHALL)f(be)h(hosted)h(on)f(github)m(.com)h
(or)f(equi)n(v)n(alent,)h(herein)f(called)g(the)g("Platform".)-2
2246 y
SDict begin H.S end
 -2 2246 a -2 2246 a
SDict begin 13 H.A end
 -2 2246 a -2 2246 a
SDict begin [/View [/XYZ H.V]/Dest (0:4786) cvn /DEST pdfmark end
 -2 2246
a 396 2338 a Fk(I'm)h(sure)g(one)g(day)f(some)h(lar)o(ge)f(\002rm)i
(will)g(b)n(uy)e(github)g(and)h(break)f(it,)i(and)e(another)g(platform)
g(will)i(rise)f(in)h(its)g(place.)396 2446 y(Github)f(serv)o(es)g(up)f
(a)i(near)n(-perfect)d(set)j(of)f(minimal,)f(f)o(ast,)i(simple)f
(tools.)g(I')l(v)o(e)f(thro)n(wn)g(hundreds)f(of)i(people)f(at)i(it,)
396 2554 y(and)f(the)o(y)f(all)i(stick,)f(lik)o(e)h(\003ies)g(stuck)f
(in)g(a)h(dish)f(of)g(hone)o(y)-5 b(.)-2 2572 y
SDict begin H.S end
 -2 2572
a -2 2572 a
SDict begin 13 H.A end
 -2 2572 a -2 2572 a
SDict begin [/View [/XYZ H.V]/Dest (0:4787) cvn /DEST pdfmark end
 -2 2572 a -2 2655 a
SDict begin H.S end
 -2
2655 a -2 2655 a
SDict begin 11.7 H.A end
 -2 2655 a -2 2655 a
SDict begin [/View [/XYZ H.V]/Dest (0:4788) cvn /DEST pdfmark end
 -2 2655 a 479 2734
a Fa(The)19 b(project)g(SHALL)f(use)h(the)g(Platform)f(issue)h(track)o
(er)l(.)-2 2916 y
SDict begin H.S end
 -2 2916 a -2 2916 a
SDict begin 13 H.A end
 -2 2916 a -2 2916
a
SDict begin [/View [/XYZ H.V]/Dest (0:4789) cvn /DEST pdfmark end
 -2 2916 a 396 3008 a Fk(W)-7 b(e)22 b(made)d(the)h(mistak)o(e)h(in)f
(libzmq)f(of)h(switching)g(to)g(Jira)h(\(mainly)e(because)g(a)i(no)n(w)
f(departed)e(person)h(didn')o(t)g(lik)o(e)396 3116 y(GitHub\).)g(Jira)i
(is)g(a)g(great)f(e)o(xample)e(of)i(ho)n(w)g(to)g(turn)g(something)e
(useful)i(into)g(a)h(comple)o(x)d(mess)j(because)e(the)396
3224 y(b)n(usiness)i(depends)e(on)g(selling)h(more)g("features".)f(But)
i(e)n(v)o(en)e(without)g(criticizing)h(Jira,)g(k)o(eeping)f(the)h
(issue)h(track)o(er)396 3332 y(on)f(the)g(same)h(platform)d(means)i
(one)g(less)h(UI)f(to)h(learn,)e(one)h(less)h(login,)e(and)h(inte)o
(gration)e(between)i(issues)h(and)396 3440 y(patches.)-2
3458 y
SDict begin H.S end
 -2 3458 a -2 3458 a
SDict begin 13 H.A end
 -2 3458 a -2 3458 a
SDict begin [/View [/XYZ H.V]/Dest (0:4790) cvn /DEST pdfmark end
 -2 3458
a -2 3541 a
SDict begin H.S end
 -2 3541 a -2 3541 a
SDict begin 11.7 H.A end
 -2 3541 a -2 3541 a
SDict begin [/View [/XYZ H.V]/Dest (0:4791) cvn /DEST pdfmark end
 -2
3541 a 479 3620 a Fa(The)e(project)g(SHOULD)f(ha)o(v)o(e)h(clearly)g
(documented)i(guidelines)f(for)f(code)g(style.)-2 3802
y
SDict begin H.S end
 -2 3802 a -2 3802 a
SDict begin 13 H.A end
 -2 3802 a -2 3802 a
SDict begin [/View [/XYZ H.V]/Dest (0:4792) cvn /DEST pdfmark end
 -2 3802 a 396
3894 a Fk(This)i(is)g(a)f(protocol)f(plug-in:)g(insert)h(code)f(style)i
(guidelines)e(here.)g(If)h(you)g(don')o(t)e(document)g(the)j(code)e
(style)i(you)396 4002 y(use,)f(you)g(ha)n(v)o(e)f(no)h(basis)h(e)o
(xcept)e(prejudice)g(to)h(reject)g(patches.)-2 4020 y
SDict begin H.S end

-2 4020 a -2 4020 a
SDict begin 13 H.A end
 -2 4020 a -2 4020 a
SDict begin [/View [/XYZ H.V]/Dest (0:4793) cvn /DEST pdfmark end
 -2 4020 a -2
4227 a
SDict begin H.S end
 -2 4227 a -2 4227 a
SDict begin 11.7 H.A end
 -2 4227 a -2 4227 a
SDict begin [/View [/XYZ H.V]/Dest (0:4794) cvn /DEST pdfmark end
 -2 4227
a 479 4306 a Fa(A)f("Contrib)o(utor")h(is)e(a)h(person)h(who)f(wishes)g
(to)g(pro)o(vide)h(a)f(patch,)g(being)h(a)f(set)f(of)h(commits)g(that)g
(solv)o(e)g(some)h(clearly)479 4403 y(identi\002ed)f(problem.)-2
4461 y
SDict begin H.S end
 -2 4461 a -2 4461 a
SDict begin 11.7 H.A end
 -2 4461 a -2 4461 a
SDict begin [/View [/XYZ H.V]/Dest (0:4795) cvn /DEST pdfmark end
 -2 4461
a 479 4542 a Fa(A)g("Maintainer")h(is)f(a)g(person)h(who)f(mer)o(ge)g
(patches)h(to)f(the)g(project.)g(Maintainers)g(are)g(not)g(de)n(v)o
(elopers;)h(their)f(job)g(is)g(to)479 4639 y(enforce)h(process.)-2
4821 y
SDict begin H.S end
 -2 4821 a -2 4821 a
SDict begin 13 H.A end
 -2 4821 a -2 4821 a
SDict begin [/View [/XYZ H.V]/Dest (0:4796) cvn /DEST pdfmark end
 -2 4821
a 396 4913 a Fk(No)n(w)g(to)h(de\002nitions)e(of)h(the)g(parties,)g
(and)g(the)g(splitting)g(of)g(roles)g(that)g(sa)n(v)o(ed)g(us)h(from)e
(the)h(sin)h(of)f(structural)396 5021 y(dependenc)o(y)d(on)j(rare)g
(indi)n(viduals.)e(This)j(w)o(ork)o(ed)e(well)h(in)h(libzmq,)e(b)n(ut)h
(as)h(you)e(will)i(see)g(it)g(depends)e(on)h(the)g(rest)g(of)p
Black 3756 5569 a Ff(387)p Black eop end
%%Page: 388 401
TeXDict begin 388 400 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.388) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(the)g(process.)g(C4)h(isn')o(t)e(a)i(b)n(uf)n(fet;)e
(you)h(will)h(need)e(the)h(whole)g(process)g(\(or)f(something)g(v)o
(ery)g(lik)o(e)i(it\),)f(or)g(it)h(w)o(on')o(t)396 180
y(hold)f(together)-5 b(.)-2 198 y
SDict begin H.S end
 -2 198 a -2 198 a
SDict begin 13 H.A end
 -2
198 a -2 198 a
SDict begin [/View [/XYZ H.V]/Dest (0:4797) cvn /DEST pdfmark end
 -2 198 a -2 406 a
SDict begin H.S end
 -2 406 a -2 406 a
SDict begin 11.7 H.A end
 -2
406 a -2 406 a
SDict begin [/View [/XYZ H.V]/Dest (0:4798) cvn /DEST pdfmark end
 -2 406 a 479 485 a Fa(Contrib)o(utors)19
b(SHALL)f(NO)m(T)g(ha)o(v)o(e)h(commit)g(access)h(to)e(the)h
(repository)h(unless)g(the)o(y)f(are)g(also)g(Maintainers.)-2
543 y
SDict begin H.S end
 -2 543 a -2 543 a
SDict begin 11.7 H.A end
 -2 543 a -2 543 a
SDict begin [/View [/XYZ H.V]/Dest (0:4799) cvn /DEST pdfmark end
 -2 543 a 479
624 a Fa(Maintainers)h(SHALL)d(ha)o(v)o(e)i(commit)g(access)h(to)f(the)
g(repository)-5 b(.)-2 806 y
SDict begin H.S end
 -2 806 a -2 806 a
SDict begin 13 H.A end
 -2 806
a -2 806 a
SDict begin [/View [/XYZ H.V]/Dest (0:4800) cvn /DEST pdfmark end
 -2 806 a 396 898 a Fk(What)21 b(we)f(w)o(anted)g(to)g(a)n(v)
n(oid)g(w)o(as)h(people)e(pushing)g(their)h(changes)f(directly)h(to)g
(master)-5 b(.)20 b(This)h(w)o(as)g(the)f(biggest)396
1006 y(source)g(of)g(trouble)f(in)h(libzmq)f(historically:)h(lar)o(ge)f
(masses)i(of)f(ra)o(w)g(code)f(that)i(took)e(months)g(or)h(years)g(to)g
(fully)396 1114 y(stabilize.)g(W)-7 b(e)22 b(e)n(v)o(entually)c(follo)n
(wed)h(other)g(\330MQ)i(projects)e(lik)o(e)i(PyZMQ)f(in)g(using)g(pull)
g(requests.)f(W)-7 b(e)22 b(went)396 1222 y(further)m(,)c(and)i
(stipulated)g(that)1290 1222 y
SDict begin H.S end
 1290 1222 a 1290 1222
a
SDict begin 13 H.A end
 1290 1222 a 1290 1222 a
SDict begin [/View [/XYZ H.V]/Dest (0:4801) cvn /DEST pdfmark end
 1290 1222 a Ff(all)g Fk(changes)g(had)f(to)i
(follo)n(w)e(the)h(same)h(path.)e(No)h(e)o(xceptions)f(for)g("special)i
(people".)-2 1239 y
SDict begin H.S end
 -2 1239 a -2 1239 a
SDict begin 13 H.A end
 -2 1239 a -2
1239 a
SDict begin [/View [/XYZ H.V]/Dest (0:4802) cvn /DEST pdfmark end
 -2 1239 a -2 1322 a
SDict begin H.S end
 -2 1322 a -2 1322 a
SDict begin 11.7 H.A end
 -2 1322
a -2 1322 a
SDict begin [/View [/XYZ H.V]/Dest (0:4803) cvn /DEST pdfmark end
 -2 1322 a 479 1402 a Fa(Ev)o(eryone,)f(without)e
(distinction)h(or)g(discrimination,)f(SHALL)g(ha)o(v)o(e)g(an)h(equal)h
(right)e(to)h(become)g(a)g(Contrib)o(utor)f(under)i(the)479
1499 y(terms)f(of)g(this)g(contract.)-2 1666 y
SDict begin H.S end
 -2 1666
a -2 1666 a
SDict begin 13 H.A end
 -2 1666 a -2 1666 a
SDict begin [/View [/XYZ H.V]/Dest (0:4804) cvn /DEST pdfmark end
 -2 1666 a 396 1773 a
Fk(W)-7 b(e)22 b(had)d(to)i(state)g(this)f(e)o(xplicitly)-5
b(.)19 b(It)h(used)g(to)h(be)f(that)g(the)g(libzmq)g("maintainers")e(w)
o(ould)i(reject)g(patches)g(simply)396 1881 y(because)g(the)o(y)f
(didn')o(t)g(lik)o(e)h(them.)g(No)n(w)-5 b(,)19 b(that)i(may)e(sound)g
(reasonable)g(to)h(the)h(author)e(of)g(a)i(library)e(\(though)f(libzmq)
396 1989 y(w)o(as)j(not)f(written)g(by)g(an)o(y)f(one)h(person\))f(b)n
(ut)h(let')-5 b(s)21 b(remember)d(our)i(goal)f(of)h(creating)g(a)g(w)o
(ork)g(that)g(is)h(o)n(wned)e(by)h(as)396 2097 y(man)o(y)f(people)g(as)
h(possible.)f(Saying)h("I)f(don')o(t)g(lik)o(e)h(your)e(patch)i(so)g
(I'm)f(going)g(to)h(reject)f(it")i(is)g(equi)n(v)n(alent)d(to)i
(saying,)396 2204 y("I)h(claim)f(to)g(o)n(wn)g(this)g(and)g(I)h(think)e
(I'm)h(better)f(than)h(you,)f(and)h(I)g(don')o(t)f(trust)h(you".)f
(Those)h(are)g(toxic)g(messages)g(to)396 2312 y(gi)n(v)o(e)g(to)g
(others)g(who)f(are)i(thinking)d(of)i(becoming)e(your)h(co-in)m(v)o
(estors.)-2 2496 y
SDict begin H.S end
 -2 2496 a -2 2496 a
SDict begin 13 H.A end
 -2 2496 a -2 2496
a
SDict begin [/View [/XYZ H.V]/Dest (0:4805) cvn /DEST pdfmark end
 -2 2496 a 396 2586 a Fk(I)i(think)e(this)i(\002ght)f(between)f(indi)n
(vidual)g(e)o(xpertise)g(and)g(collecti)n(v)o(e)h(intelligence)f(plays)
h(out)g(in)g(other)f(areas.)h(It)396 2694 y(de\002ned)f(W)m(ikipedia,)g
(and)h(still)h(does,)f(a)h(decade)e(after)h(that)g(w)o(ork)g(surpassed)
f(an)o(ything)f(b)n(uilt)j(by)e(small)i(groups)e(of)396
2802 y(e)o(xperts.)g(F)o(or)h(me,)g(we)h(mak)o(e)e(softw)o(are)h(by)g
(synthesizing)f(kno)n(wledge,)f(much)h(as)i(we)f(mak)o(e)g(W)m
(ikipedia)f(articles.)-2 2831 y
SDict begin H.S end
 -2 2831 a -2 2831 a
SDict begin 13 H.A end
 -2
2831 a -2 2831 a
SDict begin [/View [/XYZ H.V]/Dest (0:4806) cvn /DEST pdfmark end
 -2 2831 a 396 3141 a Fb(7.3.4.)36 b(Licensing)f(and)f
(Owner)n(ship)2181 3141 y
SDict begin H.S end
 2181 3141 a 2181 3141 a
SDict begin 18.72 H.A end
 2181
3141 a 2181 3141 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.68.2) cvn /DEST pdfmark end
 2181 3141 a -2 3167 a
SDict begin H.S end
 -2 3167 a -2
3167 a
SDict begin 13 H.A end
 -2 3167 a -2 3167 a
SDict begin [/View [/XYZ H.V]/Dest (0:4808) cvn /DEST pdfmark end
 -2 3167 a -2 3250 a
SDict begin H.S end
 -2 3250
a -2 3250 a
SDict begin 11.7 H.A end
 -2 3250 a -2 3250 a
SDict begin [/View [/XYZ H.V]/Dest (0:4809) cvn /DEST pdfmark end
 -2 3250 a 479 3321 a
Fa(The)19 b(project)g(SHALL)f(use)h(the)g(GPLv3)g(or)f(a)h(v)n(ariant)h
(thereof)f(\(LGPL,)e(A)m(GPL\).)-2 3503 y
SDict begin H.S end
 -2 3503 a -2
3503 a
SDict begin 13 H.A end
 -2 3503 a -2 3503 a
SDict begin [/View [/XYZ H.V]/Dest (0:4810) cvn /DEST pdfmark end
 -2 3503 a 396 3595 a Fk(I')l(v)o(e)i
(already)g(e)o(xplained)g(ho)n(w)g(full)h(remixability)f(creates)h
(better)g(scale)h(and)e(why)h(the)g(GPL)g(and)g(its)h(v)n(ariants)f
(seems)396 3703 y(the)g(optimal)g(contract)f(for)h(remixable)e(softw)o
(are.)i(If)g(you')l(re)e(a)j(lar)o(ge)e(b)n(usiness)i(aiming)e(to)h
(dump)f(code)h(on)f(the)396 3811 y(mark)o(et,)g(you)h(w)o(on')o(t)f(w)o
(ant)h(C4,)h(b)n(ut)f(then)g(you)f(w)o(on')o(t)g(really)h(care)g(about)
f(community)f(either)-5 b(.)-2 3829 y
SDict begin H.S end
 -2 3829 a -2 3829
a
SDict begin 13 H.A end
 -2 3829 a -2 3829 a
SDict begin [/View [/XYZ H.V]/Dest (0:4811) cvn /DEST pdfmark end
 -2 3829 a -2 3912 a
SDict begin H.S end
 -2 3912 a -2
3912 a
SDict begin 11.7 H.A end
 -2 3912 a -2 3912 a
SDict begin [/View [/XYZ H.V]/Dest (0:4812) cvn /DEST pdfmark end
 -2 3912 a 479 3991 a Fa(All)18
b(contrib)o(utions)i(to)f(the)g(project)g(source)h(code)f
(\("patches"\))i(SHALL)c(use)j(the)f(same)g(license)g(as)g(the)g
(project.)-2 4173 y
SDict begin H.S end
 -2 4173 a -2 4173 a
SDict begin 13 H.A end
 -2 4173 a -2
4173 a
SDict begin [/View [/XYZ H.V]/Dest (0:4813) cvn /DEST pdfmark end
 -2 4173 a 396 4265 a Fk(This)i(remo)o(v)o(es)d(the)i(need)g(for)
f(an)o(y)h(speci\002c)g(license)h(or)e(contrib)n(ution)f(agreement)h
(for)h(patches.)f(Y)-9 b(ou)20 b(fork)f(the)h(GPL)396
4373 y(code,)g(you)f(publish)g(your)g(remix)o(ed)g(v)o(ersion)f(on)i
(github,)f(you)g(or)h(an)o(yone)e(else)j(can)f(then)g(submit)g(that)g
(as)h(a)g(patch)e(to)396 4481 y(the)g(original)f(code.)h(BSD)h(doesn')o
(t)d(allo)n(w)i(this.)h(An)o(y)e(w)o(ork)h(that)g(contains)f(BSD)i
(code)f(may)g(also)g(contain)f(unlicensed)396 4589 y(proprietary)g
(code)h(so)i(you)e(need)h(e)o(xplicit)f(action)h(from)f(the)h(author)f
(of)h(the)g(code)g(before)f(you)g(can)h(remix)f(it.)-2
4607 y
SDict begin H.S end
 -2 4607 a -2 4607 a
SDict begin 13 H.A end
 -2 4607 a -2 4607 a
SDict begin [/View [/XYZ H.V]/Dest (0:4814) cvn /DEST pdfmark end
 -2 4607
a -2 4690 a
SDict begin H.S end
 -2 4690 a -2 4690 a
SDict begin 11.7 H.A end
 -2 4690 a -2 4690 a
SDict begin [/View [/XYZ H.V]/Dest (0:4815) cvn /DEST pdfmark end
 -2
4690 a 479 4769 a Fa(All)f(patches)i(are)f(o)n(wned)h(by)g(their)e
(authors.)i(There)e(SHALL)g(NO)m(T)g(be)h(an)o(y)h(cop)o(yright)g
(assignment)g(process.)-2 4951 y
SDict begin H.S end
 -2 4951 a -2 4951 a
SDict begin 13 H.A end

-2 4951 a -2 4951 a
SDict begin [/View [/XYZ H.V]/Dest (0:4816) cvn /DEST pdfmark end
 -2 4951 a 396 5043 a Fk(Here)g(we)h(come)e(to)i
(the)f(k)o(e)o(y)g(reason)f(people)g(trust)h(their)g(in)m(v)o(estments)
f(in)i(\330MQ:)f(it')-5 b(s)21 b(logistically)f(impossible)g(to)396
5151 y(b)n(uy)g(the)g(cop)o(yrights)f(to)h(create)g(a)g(closed-source)f
(competitor)f(to)i(\330MQ.)h(iMatix)f(can')o(t)f(do)h(this)h(either)-5
b(.)20 b(And)f(the)p Black 3759 5569 a Ff(388)p Black
eop end
%%Page: 389 402
TeXDict begin 389 401 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.389) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(more)g(people)f(send)h(patches,)f(the)h(harder)f(it)i
(becomes.)e(\330MQ)i(isn')o(t)e(just)i(free)f(and)g(open)f(today)-5
b(,)18 b(this)j(speci\002c)f(rule)396 180 y(means)g(it)g(will)h(remain)
e(so)h(fore)n(v)o(er)-5 b(.)18 b(Note)i(that)g(it')-5
b(s)21 b(not)f(the)f(case)i(in)f(all)g(GPL)h(projects,)e(man)o(y)f(of)i
(which)f(still)i(ask)f(for)396 288 y(cop)o(yright)e(transfer)i(back)f
(to)i(the)f(maintainers.)-2 306 y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2
306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:4817) cvn /DEST pdfmark end
 -2 306 a -2 389 a
SDict begin H.S end
 -2 389 a -2 389 a
SDict begin 11.7 H.A end
 -2
389 a -2 389 a
SDict begin [/View [/XYZ H.V]/Dest (0:4818) cvn /DEST pdfmark end
 -2 389 a 479 468 a Fa(The)f(project)g(SHALL)f(be)h(o)n
(wned)h(collecti)n(v)o(ely)f(by)h(all)e(its)g(Contrib)o(utors.)-2
651 y
SDict begin H.S end
 -2 651 a -2 651 a
SDict begin 13 H.A end
 -2 651 a -2 651 a
SDict begin [/View [/XYZ H.V]/Dest (0:4819) cvn /DEST pdfmark end
 -2 651 a 396
742 a Fk(This)j(is)g(perhaps)e(redundant)e(b)n(ut)k(w)o(orth)e(saying:)
h(if)g(e)n(v)o(eryone)e(o)n(wns)i(their)g(patches,)f(then)h(the)g
(resulting)g(whole)f(is)396 850 y(also)i(o)n(wned)e(by)h(e)n(v)o(ery)e
(contrib)n(utor)-5 b(.)19 b(There')-5 b(s)19 b(no)h(le)o(gal)g(concept)
f(of)g(o)n(wning)g(lines)i(of)f(code:)f(the)i("w)o(ork")e(is)i(at)g
(least)396 958 y(a)g(source)e(\002le.)-2 959 y
SDict begin H.S end
 -2 959
a -2 959 a
SDict begin 13 H.A end
 -2 959 a -2 959 a
SDict begin [/View [/XYZ H.V]/Dest (0:4820) cvn /DEST pdfmark end
 -2 959 a -2 1042 a
SDict begin H.S end
 -2 1042
a -2 1042 a
SDict begin 11.7 H.A end
 -2 1042 a -2 1042 a
SDict begin [/View [/XYZ H.V]/Dest (0:4821) cvn /DEST pdfmark end
 -2 1042 a 479 1138 a
Fa(Each)g(Contrib)o(utor)g(SHALL)f(be)h(responsible)h(for)f
(identifying)g(themselv)o(es)h(in)f(the)g(project)g(Contrib)o(utor)g
(list.)-2 1321 y
SDict begin H.S end
 -2 1321 a -2 1321 a
SDict begin 13 H.A end
 -2 1321 a -2 1321
a
SDict begin [/View [/XYZ H.V]/Dest (0:4822) cvn /DEST pdfmark end
 -2 1321 a 396 1412 a Fk(I.e.)h(the)g(maintainers)f(are)h(not)g(karma)
g(accountants.)e(An)o(yone)g(who)i(w)o(ants)h(credit)f(has)g(to)g
(claim)h(it)f(themselv)o(es.)-2 1441 y
SDict begin H.S end
 -2 1441 a -2 1441
a
SDict begin 13 H.A end
 -2 1441 a -2 1441 a
SDict begin [/View [/XYZ H.V]/Dest (0:4823) cvn /DEST pdfmark end
 -2 1441 a 396 1751 a Fb(7.3.5.)36
b(P)l(atc)o(h)e(Requirements)1878 1751 y
SDict begin H.S end
 1878 1751 a
1878 1751 a
SDict begin 18.72 H.A end
 1878 1751 a 1878 1751 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.69.2) cvn /DEST pdfmark end
 1878 1751 a -2 1942
a
SDict begin H.S end
 -2 1942 a -2 1942 a
SDict begin 13 H.A end
 -2 1942 a -2 1942 a
SDict begin [/View [/XYZ H.V]/Dest (0:4825) cvn /DEST pdfmark end
 -2 1942 a 396
2025 a Fk(In)20 b(this)h(section)f(we)g(de\002ne)g(the)g(obligations)f
(of)h(the)g(contrib)n(utor:)e(speci\002cally)-5 b(,)19
b(what)h(constitutes)g(a)h("v)n(alid")e(patch,)396 2133
y(so)i(maintainers)e(ha)n(v)o(e)h(rules)g(the)o(y)f(can)h(use)h(to)f
(accept)g(or)g(reject)g(patches.)-2 2151 y
SDict begin H.S end
 -2 2151 a
-2 2151 a
SDict begin 13 H.A end
 -2 2151 a -2 2151 a
SDict begin [/View [/XYZ H.V]/Dest (0:4826) cvn /DEST pdfmark end
 -2 2151 a -2 2234 a
SDict begin H.S end
 -2
2234 a -2 2234 a
SDict begin 11.7 H.A end
 -2 2234 a -2 2234 a
SDict begin [/View [/XYZ H.V]/Dest (0:4827) cvn /DEST pdfmark end
 -2 2234 a 479 2313
a Fa(Maintainers)g(and)f(Contrib)o(utors)g(MUST)g(ha)o(v)o(e)g(a)g
(Platform)f(account)i(and)g(SHOULD)d(use)i(their)g(real)g(names)g(or)g
(a)479 2410 y(well-kno)n(wn)h(alias.)-2 2577 y
SDict begin H.S end
 -2 2577
a -2 2577 a
SDict begin 13 H.A end
 -2 2577 a -2 2577 a
SDict begin [/View [/XYZ H.V]/Dest (0:4828) cvn /DEST pdfmark end
 -2 2577 a 396 2684 a
Fk(In)g(the)g(w)o(orst)h(case)f(scenario,)g(where)f(someone)g(has)h
(submitted)g(toxic)g(code)f(\(patented,)f(or)i(o)n(wned)f(by)h(someone)
396 2792 y(else\),)h(we)f(need)g(to)g(be)g(able)g(to)g(trace)h(who)e
(and)h(when,)f(so)i(we)f(can)g(remo)o(v)o(e)f(the)h(code.)f(Asking)h
(for)f(real)h(names)g(or)g(a)396 2900 y(well-kno)n(wn)f(alias)h(is)i(a)
e(theoretical)f(strate)o(gy)h(to)g(reducing)e(the)j(risk)f(of)g(bogus)f
(patches.)g(W)-7 b(e)22 b(don')o(t)c(kno)n(w)h(if)i(this)396
3008 y(actually)f(w)o(orks)g(because)f(we)i(ha)n(v)o(en')o(t)d(had)i
(the)g(problem)e(yet.)-2 3026 y
SDict begin H.S end
 -2 3026 a -2 3026 a
SDict begin 13 H.A end
 -2
3026 a -2 3026 a
SDict begin [/View [/XYZ H.V]/Dest (0:4829) cvn /DEST pdfmark end
 -2 3026 a -2 3109 a
SDict begin H.S end
 -2 3109 a -2 3109
a
SDict begin 11.7 H.A end
 -2 3109 a -2 3109 a
SDict begin [/View [/XYZ H.V]/Dest (0:4830) cvn /DEST pdfmark end
 -2 3109 a 479 3188 a Fa(A)h(patch)g(SHOULD)f(be)h
(a)g(minimal)g(and)h(accurate)f(answer)g(to)g(e)o(xactly)h(one)f
(identi\002ed)g(and)h(agreed)f(problem.)-2 3370 y
SDict begin H.S end
 -2
3370 a -2 3370 a
SDict begin 13 H.A end
 -2 3370 a -2 3370 a
SDict begin [/View [/XYZ H.V]/Dest (0:4831) cvn /DEST pdfmark end
 -2 3370 a 396 3462
a Fk(Recall)i(the)f(Simplicity)g(Oriented)f(Design)h(pattern)g(from)f
(Chapter)g(6.)h(This)h(implements)e(that.)h(One)g(clear)g(problem,)396
3570 y(one)g(minimal)f(solution,)h(apply)-5 b(,)18 b(test,)j(repeat.)-2
3588 y
SDict begin H.S end
 -2 3588 a -2 3588 a
SDict begin 13 H.A end
 -2 3588 a -2 3588 a
SDict begin [/View [/XYZ H.V]/Dest (0:4832) cvn /DEST pdfmark end
 -2 3588
a -2 3671 a
SDict begin H.S end
 -2 3671 a -2 3671 a
SDict begin 11.7 H.A end
 -2 3671 a -2 3671 a
SDict begin [/View [/XYZ H.V]/Dest (0:4833) cvn /DEST pdfmark end
 -2
3671 a 479 3750 a Fa(A)e(patch)g(MUST)g(adhere)g(to)g(the)g(code)h
(style)f(guidelines)h(of)f(the)g(project)g(if)f(these)h(are)g
(de\002ned.)-2 3932 y
SDict begin H.S end
 -2 3932 a -2 3932 a
SDict begin 13 H.A end
 -2 3932 a -2
3932 a
SDict begin [/View [/XYZ H.V]/Dest (0:4834) cvn /DEST pdfmark end
 -2 3932 a 396 4024 a Fk(This)h(is)h(just)g(sanity:)f(I')l(v)o(e)
e(spent)i(time)g(cleaning)f(up)g(other)h(peoples')e(patches)i(because)f
(the)o(y)g(insisted)h(on)g(putting)f(the)396 4132 y('else')h(beside)g
(the)g('if)5 b(')20 b(instead)g(of)g(just)g(belo)n(w)g(as)h(Nature)f
(intended.)e(Consistent)i(code)g(is)h(healthier)-5 b(.)-2
4150 y
SDict begin H.S end
 -2 4150 a -2 4150 a
SDict begin 13 H.A end
 -2 4150 a -2 4150 a
SDict begin [/View [/XYZ H.V]/Dest (0:4835) cvn /DEST pdfmark end
 -2 4150
a -2 4233 a
SDict begin H.S end
 -2 4233 a -2 4233 a
SDict begin 11.7 H.A end
 -2 4233 a -2 4233 a
SDict begin [/View [/XYZ H.V]/Dest (0:4836) cvn /DEST pdfmark end
 -2
4233 a 479 4312 a Fa(A)19 b(patch)g(MUST)g(adhere)g(to)g(the)g("Ev)o
(olution)h(of)f(Public)f(Contracts")i(guidelines)g(de\002ned)f(belo)n
(w)-5 b(.)-2 4494 y
SDict begin H.S end
 -2 4494 a -2 4494 a
SDict begin 13 H.A end
 -2 4494 a -2
4494 a
SDict begin [/View [/XYZ H.V]/Dest (0:4837) cvn /DEST pdfmark end
 -2 4494 a 396 4586 a Fk(Ah,)20 b(the)g(pain,)g(the)g(pain.)g
(I'm)f(not)h(speaking)f(of)h(the)g(time)g(at)h(age)f(eight)g(when)g(I)g
(stepped)f(on)h(a)h(plank)e(with)h(a)h(4-inch)396 4694
y(nail)g(protruding)c(from)i(it.)i(That)f(w)o(as)h(relati)n(v)o(ely)e
(OK.)h(I'm)g(speaking)f(of)g(2010-2011)e(when)j(we)g(had)g(multiple)396
4802 y(parallel)g(releases)h(of)e(\330MQ,)i(each)e(with)i(dif)n(ferent)
1920 4802 y
SDict begin H.S end
 1920 4802 a 1920 4802 a
SDict begin 13 H.A end
 1920 4802 a 1920
4802 a
SDict begin [/View [/XYZ H.V]/Dest (0:4838) cvn /DEST pdfmark end
 1920 4802 a Ff(incompatible)e Fk(APIs)h(or)g(wire)h(protocols.)d
(It)j(w)o(as)g(an)f(e)o(x)o(ercise)f(in)396 4910 y(bad)h(rules)g
(pointlessly)g(enforced.)e(The)h(rule)h(w)o(as)h("if)g(you)e(change)g
(the)h(API)g(or)g(protocol,)f(you)g(SHALL)h(create)g(a)396
5018 y(ne)n(w)g(major)g(v)o(ersion".)e(Gi)n(v)o(e)i(me)g(the)g(nail)h
(through)d(the)i(foot,)f(that)i(hurt)e(less.)p Black
3759 5569 a Ff(389)p Black eop end
%%Page: 390 403
TeXDict begin 390 402 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.390) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4839) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(One)g(of)g(the)g(big)g(changes)f(we)i(made)f(with)g
(C4)h(w)o(as)g(simply)e(to)i(ban,)e(outright,)g(this)h(kind)g(of)g
(sanctioned)e(sabotage.)396 180 y(Amazingly)-5 b(,)18
b(it')-5 b(s)22 b(not)d(e)n(v)o(en)h(hard.)f(W)-7 b(e)21
b(just)g(don')o(t)d(allo)n(w)i(the)h(breaking)d(of)i(e)o(xisting)f
(public)h(contracts,)f(period,)396 288 y(unless)i(e)n(v)o(eryone)c
(agrees,)j(in)g(which)g(case)g(no)g(period.)-2 306 y
SDict begin H.S end

-2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:4840) cvn /DEST pdfmark end
 -2 306 a -2 389 a
SDict begin H.S end

-2 389 a -2 389 a
SDict begin 11.7 H.A end
 -2 389 a -2 389 a
SDict begin [/View [/XYZ H.V]/Dest (0:4841) cvn /DEST pdfmark end
 -2 389 a 479 468
a Fa(A)f(patch)g(SHALL)f(NO)m(T)g(include)i(non-tri)n(vial)f(code)h
(from)f(other)g(projects)g(unless)h(the)f(Contrib)o(utor)g(is)f(the)h
(original)g(author)479 566 y(of)g(that)g(code.)-2 732
y
SDict begin H.S end
 -2 732 a -2 732 a
SDict begin 13 H.A end
 -2 732 a -2 732 a
SDict begin [/View [/XYZ H.V]/Dest (0:4842) cvn /DEST pdfmark end
 -2 732 a 396 840
a Fk(This)i(rule)e(has)i(tw)o(o)f(ef)n(fects.)g(The)g(\002rst)h(is)g
(that)f(it)h(forces)f(people)f(to)h(mak)o(e)g(minimal)f(solutions,)h
(since)g(the)o(y)g(cannot)396 948 y(simply)g(import)f(sw)o(athes)i(of)f
(e)o(xisting)f(code.)h(In)g(the)g(cases)h(where)e(I')l(v)o(e)g(seen)i
(this)f(happen)f(to)h(projects,)g(it')-5 b(s)21 b(al)o(w)o(ays)396
1055 y(bad)f(unless)g(the)g(imported)f(code)g(is)j(v)o(ery)d(cleanly)g
(separated.)g(The)h(second)f(is)i(that)g(it)g(a)n(v)n(oids)f(license)g
(ar)o(guments.)396 1163 y(Y)-9 b(ou)20 b(write)g(the)g(patch,)g(you)f
(are)h(allo)n(wed)g(to)g(publish)f(it)i(as)g(LGPL,)f(and)g(we)g(can)g
(mer)o(ge)f(it)i(back)f(in.)g(But)g(you)g(\002nd)g(a)396
1271 y(200-line)f(code)g(fragment)g(on)g(the)i(web,)f(and)f(try)h(to)g
(paste)h(that,)f(we')o(ll)g(refuse.)-2 1289 y
SDict begin H.S end
 -2 1289
a -2 1289 a
SDict begin 13 H.A end
 -2 1289 a -2 1289 a
SDict begin [/View [/XYZ H.V]/Dest (0:4843) cvn /DEST pdfmark end
 -2 1289 a -2 1372 a
SDict begin H.S end
 -2
1372 a -2 1372 a
SDict begin 11.7 H.A end
 -2 1372 a -2 1372 a
SDict begin [/View [/XYZ H.V]/Dest (0:4844) cvn /DEST pdfmark end
 -2 1372 a 479 1451
a Fa(A)f(patch)g(MUST)g(compile)g(cleanly)h(on)f(at)g(least)f(the)h
(most)g(important)g(tar)o(get)g(Platforms.)-2 1634 y
SDict begin H.S end

-2 1634 a -2 1634 a
SDict begin 13 H.A end
 -2 1634 a -2 1634 a
SDict begin [/View [/XYZ H.V]/Dest (0:4845) cvn /DEST pdfmark end
 -2 1634 a 396
1725 a Fk(This)i(is)g(probably)d(asking)h(a)i(lot)f(since)h(most)f
(contrib)n(utors)e(ha)n(v)o(e)i(only)f(one)h(platform)e(to)j(w)o(ork)e
(on.)h(Also,)g(why)f(is)396 1833 y(Platform)h(capitalized?)-2
1851 y
SDict begin H.S end
 -2 1851 a -2 1851 a
SDict begin 13 H.A end
 -2 1851 a -2 1851 a
SDict begin [/View [/XYZ H.V]/Dest (0:4846) cvn /DEST pdfmark end
 -2 1851
a -2 1934 a
SDict begin H.S end
 -2 1934 a -2 1934 a
SDict begin 11.7 H.A end
 -2 1934 a -2 1934 a
SDict begin [/View [/XYZ H.V]/Dest (0:4847) cvn /DEST pdfmark end
 -2
1934 a 479 2014 a Fa(A)f("Correct)g(P)o(atch")g(is)g(one)g(that)g
(satis\002es)f(the)h(abo)o(v)o(e)h(requirements.)-2 2196
y
SDict begin H.S end
 -2 2196 a -2 2196 a
SDict begin 13 H.A end
 -2 2196 a -2 2196 a
SDict begin [/View [/XYZ H.V]/Dest (0:4848) cvn /DEST pdfmark end
 -2 2196 a 396
2288 a Fk(Just)h(in)g(case)f(it)h(w)o(asn')o(t)f(clear)m(,)f(we')l(re)h
(back)f(to)i(le)o(galese)e(and)h(de\002nitions.)-2 2316
y
SDict begin H.S end
 -2 2316 a -2 2316 a
SDict begin 13 H.A end
 -2 2316 a -2 2316 a
SDict begin [/View [/XYZ H.V]/Dest (0:4849) cvn /DEST pdfmark end
 -2 2316 a 396
2626 a Fb(7.3.6.)36 b(De)n(velopment)g(Pr)n(ocess)1973
2626 y
SDict begin H.S end
 1973 2626 a 1973 2626 a
SDict begin 18.72 H.A end
 1973 2626 a 1973 2626
a
SDict begin [/View [/XYZ H.V]/Dest (12.91.70.2) cvn /DEST pdfmark end
 1973 2626 a -2 2817 a
SDict begin H.S end
 -2 2817 a -2 2817 a
SDict begin 13 H.A end
 -2 2817 a
-2 2817 a
SDict begin [/View [/XYZ H.V]/Dest (0:4851) cvn /DEST pdfmark end
 -2 2817 a 396 2900 a Fk(In)20 b(this)h(section)f(we)g(aim)h
(to)f(describe)f(the)i(actual)f(de)n(v)o(elopment)d(process,)i(step)i
(by)f(step.)-2 2918 y
SDict begin H.S end
 -2 2918 a -2 2918 a
SDict begin 13 H.A end
 -2 2918 a -2
2918 a
SDict begin [/View [/XYZ H.V]/Dest (0:4852) cvn /DEST pdfmark end
 -2 2918 a -2 3001 a
SDict begin H.S end
 -2 3001 a -2 3001 a
SDict begin 11.7 H.A end
 -2 3001
a -2 3001 a
SDict begin [/View [/XYZ H.V]/Dest (0:4853) cvn /DEST pdfmark end
 -2 3001 a 479 3080 a Fa(Change)g(on)g(the)f(project)g
(SHALL)e(be)i(go)o(v)o(erned)i(by)e(the)g(pattern)g(of)g(accurately)h
(identifying)g(problems)f(and)h(applying)479 3177 y(minimal,)f
(accurate)g(solutions)h(to)f(these)g(problems.)-2 3359
y
SDict begin H.S end
 -2 3359 a -2 3359 a
SDict begin 13 H.A end
 -2 3359 a -2 3359 a
SDict begin [/View [/XYZ H.V]/Dest (0:4854) cvn /DEST pdfmark end
 -2 3359 a 396
3451 a Fk(This)h(is)h(a)f(blatant)f(attempt)g(to)h(ram)f(through)f
(thirty)h(years')g(softw)o(are)g(design)g(e)o(xperience.)e(It')-5
b(s)21 b(a)f(profoundly)c(simple)396 3559 y(approach)i(to)j(design:)e
(mak)o(e)h(minimal,)f(accurate)h(solutions)f(to)i(real)f(problems.)e
(Nothing)h(more)h(or)f(less.)i(Note)g(the)396 3667 y(stress)g(on)f
("accurac)o(y",)e(a)j(rare)f(b)n(ut)g(essential)h(ingredient.)d(In)i
(\330MQ)g(we)h(don')o(t)d(ha)n(v)o(e)i(feature)f(requests.)g(T)m
(reating)396 3775 y(ne)n(w)h(features)g(the)g(same)g(as)h(b)n(ugs)f
(confuses)f(ne)n(wbies.)h(But)h(this)f(process)g(w)o(orks,)g(and)f(not)
h(just)h(in)f(open)f(source.)396 3883 y(Enunciating)f(the)i(problem)f
(we')l(re)g(trying)h(to)g(solv)o(e,)f(with)i(e)n(v)o(ery)e(single)h
(change,)e(is)j(k)o(e)o(y)f(to)g(deciding)f(whether)g(the)396
3991 y(change)g(is)i(w)o(orth)f(making)f(or)h(not.)-2
4009 y
SDict begin H.S end
 -2 4009 a -2 4009 a
SDict begin 13 H.A end
 -2 4009 a -2 4009 a
SDict begin [/View [/XYZ H.V]/Dest (0:4855) cvn /DEST pdfmark end
 -2 4009
a -2 4092 a
SDict begin H.S end
 -2 4092 a -2 4092 a
SDict begin 11.7 H.A end
 -2 4092 a -2 4092 a
SDict begin [/View [/XYZ H.V]/Dest (0:4856) cvn /DEST pdfmark end
 -2
4092 a 479 4171 a Fa(T)-6 b(o)19 b(initiate)f(changes,)i(a)f(user)g
(SHALL)f(log)h(an)g(issue)g(on)h(the)f(project)g(Platform)f(issue)h
(track)o(er)l(.)-2 4353 y
SDict begin H.S end
 -2 4353 a -2 4353 a
SDict begin 13 H.A end
 -2 4353
a -2 4353 a
SDict begin [/View [/XYZ H.V]/Dest (0:4857) cvn /DEST pdfmark end
 -2 4353 a 396 4445 a Fk(This)i(is)g(meant)e(to)i(stop)f(us)
g(going)f(of)n(f-line)g(and)h(w)o(orking)e(in)j(a)f(ghetto,)f(either)h
(by)g(ourselv)o(es)f(or)h(with)g(others.)396 4553 y(Although)f(we)h
(tend)g(to)g(accept)g(pull)g(requests)g(that)g(ha)n(v)o(e)g(clear)g(ar)
o(gumentation,)c(this)21 b(rule)f(lets)h(us)g(say)f("stop")g(to)396
4661 y(confused)f(or)h(too-lar)o(ge)e(patches.)-2 4679
y
SDict begin H.S end
 -2 4679 a -2 4679 a
SDict begin 13 H.A end
 -2 4679 a -2 4679 a
SDict begin [/View [/XYZ H.V]/Dest (0:4858) cvn /DEST pdfmark end
 -2 4679 a -2
4762 a
SDict begin H.S end
 -2 4762 a -2 4762 a
SDict begin 11.7 H.A end
 -2 4762 a -2 4762 a
SDict begin [/View [/XYZ H.V]/Dest (0:4859) cvn /DEST pdfmark end
 -2 4762
a 479 4841 a Fa(The)h(user)g(SHOULD)f(write)g(the)h(issue)g(by)h
(describing)g(the)f(problem)g(the)o(y)h(f)o(ace)f(or)g(observ)o(e.)p
Black 3759 5569 a Ff(390)p Black eop end
%%Page: 391 404
TeXDict begin 391 403 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.391) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4860) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk("Problem:)f(we)i(need)e(feature)h(X.)g(Solution:)f
(mak)o(e)h(it")h(is)g(not)f(a)g(good)f(issue.)i("Problem:)e(user)h
(cannot)f(do)h(common)396 180 y(tasks)h(A)g(or)f(B)h(e)o(xcept)e(by)h
(using)f(a)i(comple)o(x)d(w)o(orkaround.)f(Solution:)j(mak)o(e)f
(feature)h(X")g(is)h(a)g(decent)e(e)o(xplanation.)396
288 y(Since)h(e)n(v)o(eryone)e(I')l(v)o(e)h(e)n(v)o(er)h(w)o(ork)o(ed)f
(with)h(has)g(needed)f(to)i(learn)e(this,)i(it)g(seems)f(w)o(orth)g
(re-stating:)f(document)g(the)396 396 y(real)h(problem)f(\002rst,)i
(solution)e(second.)-2 414 y
SDict begin H.S end
 -2 414 a -2 414 a
SDict begin 13 H.A end
 -2 414
a -2 414 a
SDict begin [/View [/XYZ H.V]/Dest (0:4861) cvn /DEST pdfmark end
 -2 414 a -2 497 a
SDict begin H.S end
 -2 497 a -2 497 a
SDict begin 11.7 H.A end
 -2 497
a -2 497 a
SDict begin [/View [/XYZ H.V]/Dest (0:4862) cvn /DEST pdfmark end
 -2 497 a 479 576 a Fa(The)g(user)g(SHOULD)f(seek)h
(consensus)i(on)f(the)e(accurac)o(y)j(of)d(their)h(observ)n(ation,)h
(and)g(the)f(v)n(alue)g(of)g(solving)h(the)f(problem.)-2
759 y
SDict begin H.S end
 -2 759 a -2 759 a
SDict begin 13 H.A end
 -2 759 a -2 759 a
SDict begin [/View [/XYZ H.V]/Dest (0:4863) cvn /DEST pdfmark end
 -2 759 a 396
850 a Fk(And)h(since)g(man)o(y)f(apparent)g(problems)g(are)h
(illusionary)-5 b(,)18 b(by)i(stating)g(the)g(problem)f(e)o(xplicitly)g
(we)h(gi)n(v)o(e)g(others)f(a)396 958 y(chance)g(to)i(correct)e(our)g
(logic.)h("Y)-9 b(ou')l(re)18 b(only)i(using)g(A)g(and)g(B)h(a)g(lot)f
(because)g(function)e(C)j(is)g(unreliable.)e(Solution:)396
1066 y(mak)o(e)h(function)e(C)k(w)o(ork)d(properly)-5
b(.")-2 1084 y
SDict begin H.S end
 -2 1084 a -2 1084 a
SDict begin 13 H.A end
 -2 1084 a -2 1084
a
SDict begin [/View [/XYZ H.V]/Dest (0:4864) cvn /DEST pdfmark end
 -2 1084 a -2 1167 a
SDict begin H.S end
 -2 1167 a -2 1167 a
SDict begin 11.7 H.A end
 -2 1167 a -2
1167 a
SDict begin [/View [/XYZ H.V]/Dest (0:4865) cvn /DEST pdfmark end
 -2 1167 a 479 1246 a Fa(Users)19 b(SHALL)e(NO)m(T)i(log)g
(feature)g(requests,)g(ideas,)g(suggestions,)h(or)f(an)o(y)g(solutions)
h(to)f(problems)g(that)g(are)g(not)g(e)o(xplicitly)479
1344 y(documented)i(and)f(pro)o(v)n(able.)-2 1526 y
SDict begin H.S end
 -2
1526 a -2 1526 a
SDict begin 13 H.A end
 -2 1526 a -2 1526 a
SDict begin [/View [/XYZ H.V]/Dest (0:4866) cvn /DEST pdfmark end
 -2 1526 a 396 1618
a Fk(There)g(are)g(se)n(v)o(eral)f(reasons)h(for)g(not)f(logging)g
(ideas,)h(suggestions,)f(or)h(feature)f(requests.)h(In)g(our)f(e)o
(xperience)f(these)396 1725 y(just)j(accumulate)e(in)h(the)g(issue)h
(track)o(er)f(until)g(someone)e(deletes)j(them.)e(But)i(more)e
(profoundly)-5 b(,)16 b(when)k(we)h(treat)f(all)396 1833
y(change)f(as)i(problem)e(solutions,)g(we)h(can)g(prioritize)g(tri)n
(vially)-5 b(.)19 b(Either)g(the)h(problem)f(is)i(real)f(and)g(someone)
f(w)o(ants)h(to)396 1941 y(solv)o(e)g(it,)h(no)n(w)-5
b(,)19 b(or)h(it')-5 b(s)21 b(not)f(on)g(the)g(table.)g(Thus,)f
(wish-lists)i(are)f(of)n(f)g(the)g(table.)-2 1953 y
SDict begin H.S end
 -2
1953 a -2 1953 a
SDict begin 13 H.A end
 -2 1953 a -2 1953 a
SDict begin [/View [/XYZ H.V]/Dest (0:4867) cvn /DEST pdfmark end
 -2 1953 a -2 2036
a
SDict begin H.S end
 -2 2036 a -2 2036 a
SDict begin 11.7 H.A end
 -2 2036 a -2 2036 a
SDict begin [/View [/XYZ H.V]/Dest (0:4868) cvn /DEST pdfmark end
 -2 2036 a 479
2121 a Fa(Thus,)f(the)g(release)g(history)g(of)g(the)g(project)g(SHALL)
f(be)h(a)g(list)f(of)h(meaningful)h(issues)f(logged)h(and)g(solv)o(ed.)
-2 2304 y
SDict begin H.S end
 -2 2304 a -2 2304 a
SDict begin 13 H.A end
 -2 2304 a -2 2304 a
SDict begin [/View [/XYZ H.V]/Dest (0:4869) cvn /DEST pdfmark end
 -2
2304 a 396 2395 a Fk(I')l(d)g(lo)o(v)o(e)f(the)h(GitHub)g(issue)h
(track)o(er)e(to)h(simply)g(list)i(all)e(the)h(issues)g(we)f(solv)o(ed)
f(in)i(each)f(release.)g(T)-7 b(oday)19 b(we)h(still)396
2503 y(ha)n(v)o(e)g(to)g(write)g(that)g(by)g(hand.)f(If)g(one)h(puts)g
(the)g(issue)h(number)d(in)i(each)g(commit,)f(and)g(if)h(one)g(uses)g
(the)g(GitHub)g(issue)396 2611 y(track)o(er)m(,)f(which)h(we)g(sadly)g
(don')o(t)f(yet)h(do)g(for)f(\330MQ,)i(this)f(release)h(history)e(is)i
(easier)f(to)h(produce)d(mechanically)-5 b(.)-2 2629
y
SDict begin H.S end
 -2 2629 a -2 2629 a
SDict begin 13 H.A end
 -2 2629 a -2 2629 a
SDict begin [/View [/XYZ H.V]/Dest (0:4870) cvn /DEST pdfmark end
 -2 2629 a -2
2712 a
SDict begin H.S end
 -2 2712 a -2 2712 a
SDict begin 11.7 H.A end
 -2 2712 a -2 2712 a
SDict begin [/View [/XYZ H.V]/Dest (0:4871) cvn /DEST pdfmark end
 -2 2712
a 479 2791 a Fa(T)f(o)18 b(w)o(ork)g(on)h(an)f(issue,)g(a)g(Contrib)o
(utor)g(SHALL)e(fork)i(the)g(project)g(repository)h(and)g(then)f(w)o
(ork)g(on)h(their)e(fork)o(ed)i(repository)-5 b(.)-2
2974 y
SDict begin H.S end
 -2 2974 a -2 2974 a
SDict begin 13 H.A end
 -2 2974 a -2 2974 a
SDict begin [/View [/XYZ H.V]/Dest (0:4872) cvn /DEST pdfmark end
 -2 2974
a 396 3065 a Fk(Here)20 b(we)h(e)o(xplain)e(the)h(GitHub)g(fork)f(+)h
(pull)g(request)g(model)f(so)i(that)f(ne)n(wcomers)f(only)g(ha)n(v)o(e)
h(to)g(learn)g(one)g(process)396 3173 y(\(C4\))g(in)h(order)d(to)j
(contrib)n(ute.)-2 3188 y
SDict begin H.S end
 -2 3188 a -2 3188 a
SDict begin 13 H.A end
 -2 3188
a -2 3188 a
SDict begin [/View [/XYZ H.V]/Dest (0:4873) cvn /DEST pdfmark end
 -2 3188 a -2 3271 a
SDict begin H.S end
 -2 3271 a -2 3271 a
SDict begin 11.7 H.A end
 -2
3271 a -2 3271 a
SDict begin [/View [/XYZ H.V]/Dest (0:4874) cvn /DEST pdfmark end
 -2 3271 a 479 3354 a Fa(T)-6 b(o)19
b(submit)g(a)g(patch,)g(a)g(Contrib)o(utor)g(SHALL)e(create)i(a)g
(Platform)f(pull)h(request)h(back)g(to)e(the)h(project.)-2
3536 y
SDict begin H.S end
 -2 3536 a -2 3536 a
SDict begin 13 H.A end
 -2 3536 a -2 3536 a
SDict begin [/View [/XYZ H.V]/Dest (0:4875) cvn /DEST pdfmark end
 -2 3536
a 396 3627 a Fk(GitHub)h(has)h(made)e(this)i(so)f(simple)h(that)f(we)g
(don')o(t)f(need)g(to)i(learn)e(git)i(commands)d(to)j(do)e(it,)i(for)f
(which)f(I'm)h(deeply)396 3735 y(grateful.)f(Sometimes,)h(I')o(ll)g
(tell)h(people)e(who)h(I)g(don')o(t)e(particularly)h(lik)o(e)h(that)h
(command-line)c(git)j(is)i(a)o(wesome)d(and)396 3843
y(all)i(the)o(y)f(need)f(to)h(do)g(is)h(learn)f(git')-5
b(s)21 b(internal)e(model)g(in)i(detail)f(before)f(trying)g(to)h(use)h
(it)g(on)e(real)i(w)o(ork.)e(When)h(I)g(see)396 3951
y(them)g(se)n(v)o(eral)g(months)f(later)h(the)o(y)g(look...)e(dif)n
(ferent.)-2 3969 y
SDict begin H.S end
 -2 3969 a -2 3969 a
SDict begin 13 H.A end
 -2 3969 a -2 3969
a
SDict begin [/View [/XYZ H.V]/Dest (0:4876) cvn /DEST pdfmark end
 -2 3969 a -2 4052 a
SDict begin H.S end
 -2 4052 a -2 4052 a
SDict begin 11.7 H.A end
 -2 4052 a -2
4052 a
SDict begin [/View [/XYZ H.V]/Dest (0:4877) cvn /DEST pdfmark end
 -2 4052 a 479 4131 a Fa(A)h(Contrib)o(utor)g(SHALL)e(NO)m(T)h
(commit)h(changes)i(directly)e(to)g(the)g(project.)-2
4314 y
SDict begin H.S end
 -2 4314 a -2 4314 a
SDict begin 13 H.A end
 -2 4314 a -2 4314 a
SDict begin [/View [/XYZ H.V]/Dest (0:4878) cvn /DEST pdfmark end
 -2 4314
a 396 4405 a Fk(An)o(yone)g(who)g(submits)h(a)h(patch)f(is)h(a)f
(contrib)n(utor)m(,)e(and)i(all)g(contrib)n(utors)f(follo)n(w)g(the)h
(same)h(rules.)f(No)g(special)396 4513 y(pri)n(vile)o(ges)f(to)h(the)h
(original)e(authors,)g(because)g(otherwise)h(we')l(re)f(not)h(b)n
(uilding)f(a)i(community)-5 b(,)17 b(b)n(ut)j(boosting)f(our)396
4621 y(e)o(gos.)-2 4639 y
SDict begin H.S end
 -2 4639 a -2 4639 a
SDict begin 13 H.A end
 -2 4639
a -2 4639 a
SDict begin [/View [/XYZ H.V]/Dest (0:4879) cvn /DEST pdfmark end
 -2 4639 a -2 4722 a
SDict begin H.S end
 -2 4722 a -2 4722 a
SDict begin 11.7 H.A end
 -2
4722 a -2 4722 a
SDict begin [/View [/XYZ H.V]/Dest (0:4880) cvn /DEST pdfmark end
 -2 4722 a 479 4801 a Fa(T)-6 b(o)19
b(discuss)h(a)e(patch,)i(people)f(MA)-8 b(Y)20 b(comment)f(on)h(the)f
(Platform)f(pull)h(request,)g(on)g(the)g(commit,)g(or)g(else)n(where.)p
Black 3759 5569 a Ff(391)p Black eop end
%%Page: 392 405
TeXDict begin 392 404 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.392) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4881) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Randomly)f(distrib)n(uted)g(discussions)h(may)g(be)g
(confusing)e(if)j(you')l(re)d(w)o(alking)h(up)h(for)g(the)g(\002rst)h
(time,)f(b)n(ut)g(GitHub)396 180 y(solv)o(es)g(this)g(for)f(all)h
(current)e(participants)h(by)g(sending)g(emails)h(to)f(those)h(who)f
(need)g(to)h(follo)n(w)e(what')-5 b(s)20 b(going)f(on.)g(W)-7
b(e)396 288 y(had)20 b(the)g(same)g(e)o(xperience)f(and)g(the)h(same)h
(solution)e(in)h(W)m(ikidot,)g(and)f(it)i(w)o(orks.)f(There')-5
b(s)20 b(no)f(e)n(vidence)g(that)396 396 y(discussing)h(in)g(dif)n
(ferent)f(places)h(has)g(an)o(y)g(ne)o(gati)n(v)o(e)e(ef)n(fect.)-2
414 y
SDict begin H.S end
 -2 414 a -2 414 a
SDict begin 13 H.A end
 -2 414 a -2 414 a
SDict begin [/View [/XYZ H.V]/Dest (0:4882) cvn /DEST pdfmark end
 -2 414 a -2
497 a
SDict begin H.S end
 -2 497 a -2 497 a
SDict begin 11.7 H.A end
 -2 497 a -2 497 a
SDict begin [/View [/XYZ H.V]/Dest (0:4883) cvn /DEST pdfmark end
 -2 497 a 479
576 a Fa(T)-6 b(o)19 b(accept)h(or)e(reject)h(a)g(patch,)g(a)g
(Maintainer)h(SHALL)d(use)i(the)g(Platform)f(interf)o(ace.)-2
759 y
SDict begin H.S end
 -2 759 a -2 759 a
SDict begin 13 H.A end
 -2 759 a -2 759 a
SDict begin [/View [/XYZ H.V]/Dest (0:4884) cvn /DEST pdfmark end
 -2 759 a 396
850 a Fk(W)-7 b(orking)20 b(via)g(the)g(GitHub)g(web)g(user)g(interf)o
(ace)f(means)h(pull)g(requests)g(are)g(logged)f(as)i(issues,)f(with)h
(w)o(ork\003o)n(w)e(and)396 958 y(discussion.)h(I'm)f(sure)h(there)g
(are)g(more)g(comple)o(x)e(w)o(ays)j(to)f(w)o(ork.)f(Comple)o(xity)g
(is)i(easy)-5 b(,)20 b(it')-5 b(s)21 b(simplicity)f(that')-5
b(s)396 1066 y(incredibly)19 b(hard.)-2 1084 y
SDict begin H.S end
 -2 1084
a -2 1084 a
SDict begin 13 H.A end
 -2 1084 a -2 1084 a
SDict begin [/View [/XYZ H.V]/Dest (0:4885) cvn /DEST pdfmark end
 -2 1084 a -2 1167 a
SDict begin H.S end
 -2
1167 a -2 1167 a
SDict begin 11.7 H.A end
 -2 1167 a -2 1167 a
SDict begin [/View [/XYZ H.V]/Dest (0:4886) cvn /DEST pdfmark end
 -2 1167 a 479 1246
a Fa(Maintainers)h(SHALL)d(NO)m(T)i(accept)g(their)g(o)n(wn)g(patches.)
-2 1429 y
SDict begin H.S end
 -2 1429 a -2 1429 a
SDict begin 13 H.A end
 -2 1429 a -2 1429 a
SDict begin [/View [/XYZ H.V]/Dest (0:4887) cvn /DEST pdfmark end
 -2
1429 a 396 1520 a Fk(There)h(w)o(as)h(a)f(rule)g(we)h(de\002ned)e(in)h
(the)g(FFII)h(years)f(ago)f(to)i(stop)f(people)f(b)n(urning)f(out:)i
(no)g(less)h(than)f(tw)o(o)g(people)g(on)396 1628 y(an)o(y)g(project.)f
(One-person)f(projects)h(tend)h(to)g(end)g(in)g(tears,)h(or)f(at)g
(least)h(bitter)f(silence.)g(W)-7 b(e)22 b(ha)n(v)o(e)d(quite)h(a)h
(lot)f(of)g(data)396 1736 y(on)g(b)n(urnout,)e(why)h(it)i(happens,)e
(and)h(ho)n(w)f(to)i(pre)n(v)o(ent)d(it)j(\(e)n(v)o(en)e(cure)g(it\).)i
(I')o(ll)f(e)o(xplore)f(this)h(later)h(in)f(the)g(chapter)m(,)396
1844 y(since)h(if)f(you)f(w)o(ork)h(with)g(or)g(on)g(open)f(source)h
(you)f(need)g(to)i(be)f(a)o(w)o(are)g(of)g(the)g(risks.)g(The)g("no)g
(mer)o(ging)e(your)h(o)n(wn)396 1952 y(patch")h(rule)g(has)g(tw)o(o)g
(goals.)g(First,)h(if)f(you)g(w)o(ant)g(your)f(project)g(to)i(be)f
(C4-certi\002ed,)f(you)g(ha)n(v)o(e)h(to)g(get)g(at)h(least)g(one)396
2060 y(other)f(person)f(to)h(help.)g(If)g(no-one)e(w)o(ants)j(to)f
(help)g(you,)f(perhaps)g(you)g(need)g(to)i(rethink)e(your)g(project.)g
(Second,)396 2168 y(ha)n(ving)g(a)i(control)e(for)g(e)n(v)o(ery)g
(patch)h(mak)o(es)g(it)h(much)e(more)g(satisfying,)h(k)o(eeps)g(us)g
(more)g(focused,)e(and)i(stops)g(us)396 2276 y(breaking)f(the)h(rules)g
(because)f(we')l(re)h(in)g(a)h(hurry)-5 b(,)18 b(or)i(just)g(feeling)g
(lazy)-5 b(.)-2 2294 y
SDict begin H.S end
 -2 2294 a -2 2294 a
SDict begin 13 H.A end
 -2 2294 a
-2 2294 a
SDict begin [/View [/XYZ H.V]/Dest (0:4888) cvn /DEST pdfmark end
 -2 2294 a -2 2377 a
SDict begin H.S end
 -2 2377 a -2 2377 a
SDict begin 11.7 H.A end
 -2
2377 a -2 2377 a
SDict begin [/View [/XYZ H.V]/Dest (0:4889) cvn /DEST pdfmark end
 -2 2377 a 479 2456 a Fa(Maintainers)20
b(SHALL)d(NO)m(T)i(mak)o(e)g(v)n(alue)h(judgments)g(on)f(correct)h
(patches.)-2 2638 y
SDict begin H.S end
 -2 2638 a -2 2638 a
SDict begin 13 H.A end
 -2 2638 a -2
2638 a
SDict begin [/View [/XYZ H.V]/Dest (0:4890) cvn /DEST pdfmark end
 -2 2638 a 396 2730 a Fk(W)-7 b(e)22 b(already)d(said)h(this)h(b)
n(ut)f(it')-5 b(s)21 b(w)o(orth)f(repeating:)f(the)h(role)g(of)g
(Maintainer)f(is)i(not)f(to)g(judge)f(a)i(patch')-5 b(s)20
b(substance,)396 2838 y(only)g(its)h(technical)e(quality)-5
b(.)19 b(The)h(substanti)n(v)o(e)f(w)o(orth)h(of)f(a)i(patch)f(only)f
(emer)o(ges)g(o)o(v)o(er)g(time:)h(people)f(use)i(it,)f(and)396
2946 y(lik)o(e)h(it,)f(or)g(the)o(y)g(do)g(not.)f(And)h(if)g(no-one)f
(is)i(using)e(a)i(patch,)e(e)n(v)o(entually)g(it')o(ll)i(anno)o(y)d
(someone)h(else)i(who)f(will)396 3054 y(remo)o(v)o(e)f(it,)h(and)g
(no-one)e(will)j(complain.)-2 3072 y
SDict begin H.S end
 -2 3072 a -2 3072
a
SDict begin 13 H.A end
 -2 3072 a -2 3072 a
SDict begin [/View [/XYZ H.V]/Dest (0:4891) cvn /DEST pdfmark end
 -2 3072 a -2 3155 a
SDict begin H.S end
 -2 3155 a -2
3155 a
SDict begin 11.7 H.A end
 -2 3155 a -2 3155 a
SDict begin [/View [/XYZ H.V]/Dest (0:4892) cvn /DEST pdfmark end
 -2 3155 a 479 3234 a Fa(Maintainers)f(SHALL)
d(mer)o(ge)i(correct)g(patches)h(rapidly)-5 b(.)-2 3416
y
SDict begin H.S end
 -2 3416 a -2 3416 a
SDict begin 13 H.A end
 -2 3416 a -2 3416 a
SDict begin [/View [/XYZ H.V]/Dest (0:4893) cvn /DEST pdfmark end
 -2 3416 a 396
3508 a Fk(There)20 b(is)h(a)f(criteria)g(I)h(call)f("change)f(latenc)o
(y")g(which)h(is)h(the)f(round-trip)e(time)i(from)f(identifying)f(a)j
(problem)d(to)396 3616 y(testing)i(a)h(solution.)e(The)h(f)o(aster)g
(the)h(better)-5 b(.)19 b(If)i(maintainers)e(cannot)g(respond)f(to)j
(pull)f(requests)f(as)i(rapidly)e(as)396 3724 y(people)g(e)o(xpect,)g
(the)o(y')l(re)g(not)h(doing)f(their)g(job)h(\(or)g(the)o(y)f(need)h
(more)f(hands\).)-2 3742 y
SDict begin H.S end
 -2 3742 a -2 3742 a
SDict begin 13 H.A end
 -2 3742
a -2 3742 a
SDict begin [/View [/XYZ H.V]/Dest (0:4894) cvn /DEST pdfmark end
 -2 3742 a -2 3825 a
SDict begin H.S end
 -2 3825 a -2 3825 a
SDict begin 11.7 H.A end
 -2
3825 a -2 3825 a
SDict begin [/View [/XYZ H.V]/Dest (0:4895) cvn /DEST pdfmark end
 -2 3825 a 479 3904 a Fa(Maintainers)h(SHOULD)e(ask)h
(for)g(impro)o(v)o(ements)h(to)e(incorrect)i(patches)f(and)h(SHOULD)e
(reject)g(incorrect)i(patches)f(if)g(the)479 4001 y(Contrib)o(utor)g
(does)h(not)f(respond)h(constructi)n(v)o(ely)-5 b(.)-2
4183 y
SDict begin H.S end
 -2 4183 a -2 4183 a
SDict begin 13 H.A end
 -2 4183 a -2 4183 a
SDict begin [/View [/XYZ H.V]/Dest (0:4896) cvn /DEST pdfmark end
 -2 4183
a 396 4275 a Fk(Initially)20 b(I)g(felt)h(it)g(w)o(as)g(w)o(orth)e(mer)
o(ging)f(all)j(patches)f(no)g(matter)f(ho)n(w)h(poor)-5
b(.)19 b(There')-5 b(s)20 b(an)g(element)g(of)g(trolling)396
4383 y(in)m(v)n(olv)o(ed.)e(Mer)o(ging)g(brok)o(en)h(code)g(to)i
(master)f(might,)f(I)h(felt,)h(pull)f(in)g(more)f(contrib)n(utors.)f
(But)j(people)e(were)396 4491 y(uncomfortable)e(with)j(this)g(so)h(we)f
(de\002ned)f(the)h("correct)e(patch")i(rules,)f(and)h(the)f
(Maintainer')-5 b(s)20 b(role)f(in)h(checking)e(for)396
4599 y(quality)-5 b(.)19 b(On)h(the)g(ne)o(gati)n(v)o(e)e(side)j(I)f
(think)g(we)g(didn')o(t)f(tak)o(e)h(some)g(interesting)g(risks)g(which)
g(could)f(ha)n(v)o(e)h(paid)f(of)n(f)h(with)396 4707
y(more)g(participants.)f(On)h(the)g(positi)n(v)o(e)f(side)i(this)g(has)
f(led)g(to)g(\330MQ)h(master)f(\(and)f(in)i(all)f(projects)g(that)g
(use)h(C4\))f(being)396 4815 y(practically)f(production)f(quality)-5
b(,)19 b(practically)g(all)i(the)f(time.)-2 4833 y
SDict begin H.S end
 -2
4833 a -2 4833 a
SDict begin 13 H.A end
 -2 4833 a -2 4833 a
SDict begin [/View [/XYZ H.V]/Dest (0:4897) cvn /DEST pdfmark end
 -2 4833 a -2 4916
a
SDict begin H.S end
 -2 4916 a -2 4916 a
SDict begin 11.7 H.A end
 -2 4916 a -2 4916 a
SDict begin [/View [/XYZ H.V]/Dest (0:4898) cvn /DEST pdfmark end
 -2 4916 a 479
4995 a Fa(An)o(y)g(Contrib)o(utor)e(who)i(has)f(v)n(alue)h(judgments)g
(on)f(a)g(correct)g(patch)h(SHOULD)d(e)o(xpress)j(these)f(via)g(their)g
(o)n(wn)g(patches.)p Black 3759 5569 a Ff(392)p Black
eop end
%%Page: 393 406
TeXDict begin 393 405 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.393) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4899) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(In)g(essence,)g(the)g(goal)g(here)g(is)h(to)f(allo)n
(w)g(users)h(to)f(try)g(patches)g(rather)f(than)h(to)g(spend)g(time)g
(ar)o(guing)e(pros)i(and)f(cons.)396 180 y(As)i(easy)g(as)f(it)h(is)g
(to)g(mak)o(e)f(a)g(patch,)g(it')-5 b(s)21 b(as)g(easy)f(to)g(re)n(v)o
(ert)f(it)i(with)g(another)d(patch.)i(Y)-9 b(ou)19 b(might)h(think)f
(this)i(w)o(ould)396 288 y(lead)f(to)h("patch)e(w)o(ars")i(b)n(ut)f
(that)g(hasn')o(t)f(happened.)f(W)-7 b(e')l(v)o(e)20
b(had)g(a)g(handful)f(of)g(cases)i(in)g(libzmq)e(where)h(patches)f(by)
396 396 y(one)h(contrib)n(utor)e(were)i(killed)g(by)g(another)e(person)
h(who)h(felt)h(the)f(e)o(xperimentation)d(w)o(asn')o(t)j(going)f(in)h
(the)g(right)396 504 y(direction.)f(It)h(is)i(easier)e(than)g(seeking)f
(up-front)f(consensus.)-2 522 y
SDict begin H.S end
 -2 522 a -2 522 a
SDict begin 13 H.A end
 -2
522 a -2 522 a
SDict begin [/View [/XYZ H.V]/Dest (0:4900) cvn /DEST pdfmark end
 -2 522 a -2 605 a
SDict begin H.S end
 -2 605 a -2 605 a
SDict begin 11.7 H.A end
 -2
605 a -2 605 a
SDict begin [/View [/XYZ H.V]/Dest (0:4901) cvn /DEST pdfmark end
 -2 605 a 479 684 a Fa(Maintainers)i(MA)-8
b(Y)19 b(commit)g(changes)h(to)f(non-source)i(documentation)g(directly)
e(to)f(the)h(project.)-2 867 y
SDict begin H.S end
 -2 867 a -2 867 a
SDict begin 13 H.A end
 -2 867
a -2 867 a
SDict begin [/View [/XYZ H.V]/Dest (0:4902) cvn /DEST pdfmark end
 -2 867 a 396 958 a Fk(This)i(e)o(xit)f(allo)n(ws)g
(maintainers)f(who)h(are)g(making)f(release)h(notes)g(to)g(push)g
(those)g(without)g(ha)n(ving)f(to)h(create)g(an)396 1066
y(issue)h(which)f(w)o(ould)f(then)h(af)n(fect)g(the)g(release)g(notes,)
g(leading)f(to)h(stress)h(on)f(the)g(space)h(time)f(f)o(abric)g(and)f
(possibly)396 1174 y(in)m(v)n(oluntary)f(rerouting)g(backw)o(ards)h(in)
h(the)g(fourth)f(dimension)g(to)h(before)f(the)h(in)m(v)o(ention)e(of)i
(cold)g(beer)-5 b(.)19 b(Shudder)-5 b(.)396 1282 y(Simpler)20
b(to)g(agree)g(that)g(release)g(notes)g(aren')o(t)f(changes)g(to)i(the)
f(softw)o(are.)-2 1310 y
SDict begin H.S end
 -2 1310 a -2 1310 a
SDict begin 13 H.A end
 -2 1310
a -2 1310 a
SDict begin [/View [/XYZ H.V]/Dest (0:4903) cvn /DEST pdfmark end
 -2 1310 a 396 1621 a Fb(7.3.7.)36 b(Creating)e(Stab)o(le)g
(Releases)2153 1621 y
SDict begin H.S end
 2153 1621 a 2153 1621 a
SDict begin 18.72 H.A end
 2153 1621
a 2153 1621 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.71.2) cvn /DEST pdfmark end
 2153 1621 a -2 1813 a
SDict begin H.S end
 -2 1813 a -2 1813
a
SDict begin 13 H.A end
 -2 1813 a -2 1813 a
SDict begin [/View [/XYZ H.V]/Dest (0:4905) cvn /DEST pdfmark end
 -2 1813 a 396 1895 a Fk(F)o(or)20
b(a)h(production)c(system)k(we)f(w)o(ant)g(some)g(guarantee)f(of)h
(stability)-5 b(.)20 b(In)f(the)i(past)f(this)h(meant)f(taking)f
(unstable)g(code)396 2002 y(and)h(then)g(o)o(v)o(er)e(months)i
(hammering)e(out)h(the)i(b)n(ugs)f(and)f(f)o(aults)i(until)f(it)h(w)o
(as)g(safe)f(to)g(trust.)g(iMatix')-5 b(s)21 b(job,)f(for)f(years,)396
2110 y(has)i(been)e(to)i(do)e(this)i(to)f(libzmq,)g(turning)e(ra)o(w)i
(code)g(into)g(packages)f(by)g(allo)n(wing)h(only)f(b)n(ug)h(\002x)o
(es,)g(and)f(no)h(ne)n(w)396 2218 y(code,)g(into)f(a)i("stabilization)f
(branch".)e(It')-5 b(s)21 b(surprisingly)d(not)i(as)h(thankless)f(as)h
(it)g(sounds.)-2 2402 y
SDict begin H.S end
 -2 2402 a -2 2402 a
SDict begin 13 H.A end
 -2 2402 a
-2 2402 a
SDict begin [/View [/XYZ H.V]/Dest (0:4906) cvn /DEST pdfmark end
 -2 2402 a 396 2492 a Fk(No)n(w)-5 b(,)20 b(since)g(we)h(went)
f(full)g(speed)g(with)g(C4,)g(we')l(v)o(e)g(found)e(that)i(git)h
(master)f(of)g(libzmq)f(is)i(mostly)f(perfect,)f(most)h(of)396
2600 y(the)g(time.)h(This)f(frees)g(our)f(time)i(to)f(do)g(more)f
(interesting)h(things,)f(such)h(as)h(b)n(uilding)e(ne)n(w)h(open)f
(source)g(layers)h(on)396 2708 y(top)g(of)g(libzmq.)f(Ho)n(we)n(v)o(er)
m(,)f(people)h(still)j(w)o(ant)e(that)g(guarantee:)f(man)o(y)g(users)h
(will)h(simply)f(not)g(install)h(e)o(xcept)e(from)396
2816 y(an)h("of)n(\002cial")g(release.)g(So)g(a)h(stable)f(release)h
(today)e(means)h(tw)o(o)g(things.)g(First,)h(a)f(snapshot)f(of)h(the)h
(master)f(tak)o(en)f(at)i(a)396 2924 y(time)g(when)e(there)h(were)g(no)
g(ne)n(w)g(changes)f(for)g(a)i(while,)f(and)g(no)g(dramatic)f(open)g(b)
n(ugs.)h(Second,)f(a)h(w)o(ay)g(to)396 3032 y(\002ne-tune)f(that)h
(snapshot)g(to)g(\002x)h(the)f(critical)g(issues)h(remaining)e(in)h
(it.)-2 3216 y
SDict begin H.S end
 -2 3216 a -2 3216 a
SDict begin 13 H.A end
 -2 3216 a -2 3216
a
SDict begin [/View [/XYZ H.V]/Dest (0:4907) cvn /DEST pdfmark end
 -2 3216 a 396 3306 a Fk(This)h(is)g(the)f(process)g(we)g(e)o(xplain)f
(in)i(this)f(section.)-2 3324 y
SDict begin H.S end
 -2 3324 a -2 3324 a
SDict begin 13 H.A end
 -2
3324 a -2 3324 a
SDict begin [/View [/XYZ H.V]/Dest (0:4908) cvn /DEST pdfmark end
 -2 3324 a -2 3407 a
SDict begin H.S end
 -2 3407 a -2 3407
a
SDict begin 11.7 H.A end
 -2 3407 a -2 3407 a
SDict begin [/View [/XYZ H.V]/Dest (0:4909) cvn /DEST pdfmark end
 -2 3407 a 479 3486 a Fa(The)f(project)g(SHALL)f
(ha)o(v)o(e)h(one)g(branch)h(\("master"\))g(that)f(al)o(w)o(ays)h
(holds)f(the)g(latest)f(in-progress)i(v)o(ersion)g(and)f(SHOULD)479
3583 y(al)o(w)o(ays)h(b)o(uild.)-2 3765 y
SDict begin H.S end
 -2 3765 a -2
3765 a
SDict begin 13 H.A end
 -2 3765 a -2 3765 a
SDict begin [/View [/XYZ H.V]/Dest (0:4910) cvn /DEST pdfmark end
 -2 3765 a 396 3857 a Fk(This)g(is)h
(redundant)d(since)i(e)n(v)o(ery)e(patch)h(al)o(w)o(ays)i(b)n(uilds)e
(b)n(ut)h(it')-5 b(s)21 b(w)o(orth)e(restating.)h(If)f(the)h(master)g
(doesn')o(t)e(b)n(uild)i(\(and)396 3965 y(pass)h(its)g(tests\),)g
(someone)e(needs)h(w)o(aking)f(up.)-2 3983 y
SDict begin H.S end
 -2 3983
a -2 3983 a
SDict begin 13 H.A end
 -2 3983 a -2 3983 a
SDict begin [/View [/XYZ H.V]/Dest (0:4911) cvn /DEST pdfmark end
 -2 3983 a -2 4066 a
SDict begin H.S end
 -2
4066 a -2 4066 a
SDict begin 11.7 H.A end
 -2 4066 a -2 4066 a
SDict begin [/View [/XYZ H.V]/Dest (0:4912) cvn /DEST pdfmark end
 -2 4066 a 479 4145
a Fa(The)g(project)g(SHALL)f(NO)m(T)g(use)h(topic)g(branches)i(for)d
(an)o(y)i(reason.)f(Personal)g(forks)g(MA)-8 b(Y)20 b(use)f(topic)g
(branches.)-2 4328 y
SDict begin H.S end
 -2 4328 a -2 4328 a
SDict begin 13 H.A end
 -2 4328 a -2
4328 a
SDict begin [/View [/XYZ H.V]/Dest (0:4913) cvn /DEST pdfmark end
 -2 4328 a 396 4419 a Fk(I')o(ll)h(come)g(to)g(branches)e(soon.)h
(In)h(short)f(\(or)g("tl;dr",)h(as)g(the)o(y)f(say)h(on)g(the)g(webs\))
f(branches)g(mak)o(e)g(the)h(repository)e(too)396 4527
y(comple)o(x)h(and)g(fragile,)h(and)f(require)g(upfront)f(agreement,)h
(all)h(of)g(which)g(are)g(e)o(xpensi)n(v)o(e)e(and)i(a)n(v)n(oidable.)
-2 4545 y
SDict begin H.S end
 -2 4545 a -2 4545 a
SDict begin 13 H.A end
 -2 4545 a -2 4545 a
SDict begin [/View [/XYZ H.V]/Dest (0:4914) cvn /DEST pdfmark end
 -2
4545 a -2 4753 a
SDict begin H.S end
 -2 4753 a -2 4753 a
SDict begin 11.7 H.A end
 -2 4753 a -2 4753
a
SDict begin [/View [/XYZ H.V]/Dest (0:4915) cvn /DEST pdfmark end
 -2 4753 a 479 4832 a Fa(T)-6 b(o)19 b(mak)o(e)g(a)g(stable)g(release)
g(someone)h(SHALL)d(fork)i(the)f(repository)i(by)f(cop)o(ying)h(it)e
(and)i(thus)f(become)h(maintainer)f(of)f(this)479 4929
y(repository)-5 b(.)-2 4987 y
SDict begin H.S end
 -2 4987 a -2 4987 a
SDict begin 11.7 H.A end
 -2
4987 a -2 4987 a
SDict begin [/View [/XYZ H.V]/Dest (0:4916) cvn /DEST pdfmark end
 -2 4987 a 479 5068 a Fa(F)o(orking)19
b(a)g(project)h(for)e(stabilization)h(MA)-8 b(Y)19 b(be)h(done)g
(unilaterally)f(and)g(without)g(agreement)h(of)f(project)g
(maintainers.)p Black 3759 5569 a Ff(393)p Black eop
end
%%Page: 394 407
TeXDict begin 394 406 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.394) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4935) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4917) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(It')-5 b(s)21 b(free)f(softw)o(are.)f(No-one)g(has)i
(a)f(monopoly)e(on)h(it.)i(If)f(you)f(think)h(the)g(maintainers)f
(aren')o(t)g(producing)f(stable)396 180 y(releases)j(right,)e(fork)g
(the)h(repository)f(and)g(do)h(it)h(yourself.)e(F)o(orking)f(isn')o(t)i
(a)h(f)o(ailure,)e(it')-5 b(s)21 b(an)f(essential)h(tool)f(for)396
288 y(competition.)e(Y)-9 b(ou)20 b(can')o(t)f(BTW)i(do)f(this)h(with)f
(branches,)f(which)h(means)f(a)i(branch-based)c(release)k(polic)o(y)e
(gi)n(v)o(es)g(the)396 396 y(project)h(maintainers)f(a)h(monopoly)-5
b(.)17 b(And)j(that')-5 b(s)21 b(bad)e(because)h(the)o(y')o(ll)f
(become)g(lazier)h(and)g(more)f(arrogant)f(than)i(if)396
504 y(real)g(competition)f(is)i(chasing)e(their)h(heels.)-2
522 y
SDict begin H.S end
 -2 522 a -2 522 a
SDict begin 13 H.A end
 -2 522 a -2 522 a
SDict begin [/View [/XYZ H.V]/Dest (0:4918) cvn /DEST pdfmark end
 -2 522 a -2
605 a
SDict begin H.S end
 -2 605 a -2 605 a
SDict begin 11.7 H.A end
 -2 605 a -2 605 a
SDict begin [/View [/XYZ H.V]/Dest (0:4919) cvn /DEST pdfmark end
 -2 605 a 479
684 a Fa(Maintainers)g(of)f(the)g(stabilization)g(project)g(SHALL)e
(maintain)j(it)e(through)i(pull)f(requests)g(which)h(MA)-8
b(Y)19 b(cherry-pick)479 781 y(patches)h(from)f(the)g(fork)o(ed)h
(project.)-2 964 y
SDict begin H.S end
 -2 964 a -2 964 a
SDict begin 13 H.A end
 -2 964 a -2 964
a
SDict begin [/View [/XYZ H.V]/Dest (0:4920) cvn /DEST pdfmark end
 -2 964 a 396 1055 a Fk(Perhaps)g(the)g(C4)h(process)e(should)h(just)g
(say)h(that)f(stabilization)g(projects)f(ha)n(v)o(e)h(maintainers)f
(and)h(contrib)n(utors)e(lik)o(e)396 1163 y(an)o(y)i(project.)f(That')
-5 b(s)20 b(all)h(this)g(rule)e(means.)-2 1181 y
SDict begin H.S end
 -2 1181
a -2 1181 a
SDict begin 13 H.A end
 -2 1181 a -2 1181 a
SDict begin [/View [/XYZ H.V]/Dest (0:4921) cvn /DEST pdfmark end
 -2 1181 a -2 1264 a
SDict begin H.S end
 -2
1264 a -2 1264 a
SDict begin 11.7 H.A end
 -2 1264 a -2 1264 a
SDict begin [/View [/XYZ H.V]/Dest (0:4922) cvn /DEST pdfmark end
 -2 1264 a 479 1344
a Fa(A)g(patch)g(to)g(a)g(repository)h(declared)g("stable")f(SHALL)f
(be)h(accompanied)i(by)e(a)g(reproducible)i(test)d(case.)-2
1526 y
SDict begin H.S end
 -2 1526 a -2 1526 a
SDict begin 13 H.A end
 -2 1526 a -2 1526 a
SDict begin [/View [/XYZ H.V]/Dest (0:4923) cvn /DEST pdfmark end
 -2 1526
a 396 1618 a Fk(Be)n(w)o(are)j(of)f(a)g(one-size)g(\002ts)h(all)g
(process.)e(Ne)n(w)i(code)e(does)h(not)g(need)f(the)i(same)f(paranoia)f
(as)h(code)g(which)g(people)396 1725 y(are)g(trusting)f(for)g
(production)d(use.)k(In)f(the)h(normal)e(de)n(v)o(elopment)f(process)i
(we)h(did)f(not)g(mention)g(test)h(cases.)g(There')-5
b(s)396 1833 y(a)21 b(reason)e(for)h(this.)g(While)h(I)f(lo)o(v)o(e)g
(testable)g(patches,)g(man)o(y)f(changes)g(aren')o(t)g(easily)h(or)g
(at)h(all)f(testable.)g(Ho)n(we)n(v)o(er)f(to)396 1941
y(stabilize)i(a)f(code)g(base)g(you)f(w)o(ant)i(to)f(\002x)h(only)e
(serious)h(b)n(ugs,)g(and)f(you)g(w)o(ant)i(to)f(be)g(100\045)g(sure)g
(e)n(v)o(ery)f(change)f(is)396 2049 y(accurate.)h(This)i(means)f
(before/after)e(tests)j(for)e(e)n(v)o(ery)g(change.)-2
2067 y
SDict begin H.S end
 -2 2067 a -2 2067 a
SDict begin 13 H.A end
 -2 2067 a -2 2067 a
SDict begin [/View [/XYZ H.V]/Dest (0:4924) cvn /DEST pdfmark end
 -2 2067
a -2 2150 a
SDict begin H.S end
 -2 2150 a -2 2150 a
SDict begin 11.7 H.A end
 -2 2150 a -2 2150 a
SDict begin [/View [/XYZ H.V]/Dest (0:4925) cvn /DEST pdfmark end
 -2
2150 a 479 2229 a Fa(A)g(stabilization)g(repository)h(SHOULD)d
(progress)j(through)g(these)f(phases:)h("unstable",)g("candidate",)h
("stable",)f(and)f(then)479 2327 y("le)o(gac)o(y".)h(That)f(is,)f(the)h
(def)o(ault)g(beha)o(vior)h(of)f(stabilization)g(repositories)g(is)g
(to)f(die.)-2 2509 y
SDict begin H.S end
 -2 2509 a -2 2509 a
SDict begin 13 H.A end
 -2 2509 a -2
2509 a
SDict begin [/View [/XYZ H.V]/Dest (0:4926) cvn /DEST pdfmark end
 -2 2509 a 396 2600 a Fk(This)j(may)e(be)h(o)o(v)o(er)n
(-detailed.)e(The)i(k)o(e)o(y)f(point)h(here)f(is)i(that)g(these)f
(fork)o(ed)f(stabilization)g(repositories)h(all)g(die)h(in)f(the)396
2708 y(end,)g(as)h(master)f(continues)f(to)h(e)n(v)n(olv)o(e)f(and)h
(continues)f(to)h(be)g(fork)o(ed)f(of)n(f)g(for)h(production)d
(releases.)-2 2737 y
SDict begin H.S end
 -2 2737 a -2 2737 a
SDict begin 13 H.A end
 -2 2737 a -2
2737 a
SDict begin [/View [/XYZ H.V]/Dest (0:4927) cvn /DEST pdfmark end
 -2 2737 a 396 3047 a Fb(7.3.8.)36 b(Ev)l(olution)e(of)f(Pub)o
(lic)h(Contracts)2397 3047 y
SDict begin H.S end
 2397 3047 a 2397 3047 a
SDict begin 18.72 H.A end

2397 3047 a 2397 3047 a
SDict begin [/View [/XYZ H.V]/Dest (12.91.72.2) cvn /DEST pdfmark end
 2397 3047 a -2 3214 a
SDict begin H.S end
 -2 3214
a -2 3214 a
SDict begin 13 H.A end
 -2 3214 a -2 3214 a
SDict begin [/View [/XYZ H.V]/Dest (0:4929) cvn /DEST pdfmark end
 -2 3214 a 396 3321 a
Fk(By)21 b("public)e(contracts")g(I)i(mean)e(APIs)i(and)f(protocols.)e
(Up)j(until)f(the)g(end)f(of)h(2011,)f(libzmq')-5 b(s)20
b(naturally)f(happ)o(y)396 3429 y(state)i(w)o(as)g(marred)e(by)h(brok)o
(en)e(promises)i(and)g(brok)o(en)e(contracts.)h(W)-7
b(e)22 b(stopped)d(making)f(promises)i(\(aka)396 3537
y("roadmaps"\))e(for)i(libzmq)f(completely)-5 b(,)18
b(and)i(our)f(dominant)g(theory)g(of)g(change)g(is)i(no)n(w)f(that)g
(it)h(emer)o(ges)e(carefully)396 3645 y(and)h(accurately)f(o)o(v)o(er)g
(time.)h(At)g(a)h(2012)e(Chicago)g(meetup,)g(Garrett)h(Smith)g(and)g
(Chuck)f(Remes)i(called)f(this)h(the)396 3753 y("drunk)o(en)d(stumble)i
(to)g(greatness",)f(which)h(is)h(ho)n(w)f(I)g(think)g(of)g(it)h(no)n(w)
-5 b(.)-2 3937 y
SDict begin H.S end
 -2 3937 a -2 3937 a
SDict begin 13 H.A end
 -2 3937 a -2 3937
a
SDict begin [/View [/XYZ H.V]/Dest (0:4930) cvn /DEST pdfmark end
 -2 3937 a 396 4027 a Fk(W)e(e)22 b(stopped)d(breaking)f(public)h
(contracts)h(simply)f(by)h(banning)f(the)h(practice.)f(Before)h(then)f
(it)i(had)f(been)f("OK")i(\(as)396 4134 y(in)g(we)f(did)g(it,)h(and)e
(e)n(v)o(eryone)f(complained)g(bitterly)-5 b(,)19 b(and)h(we)g(ignored)
f(them\))g(to)i(break)e(the)h(API)g(or)g(protocol)f(so)396
4242 y(long)h(as)h(we)f(changed)e(the)j(major)e(v)o(ersion)g(number)-5
b(.)19 b(Sounds)g(\002ne,)h(until)g(you)f(get)h(\330MQ)h(v)o(ersion)e
(2.0,)g(3.0,)g(and)h(4.0,)396 4350 y(all)h(in)f(de)n(v)o(elopment)e(at)
i(the)h(same)f(time,)g(and)g(not)g(speaking)e(to)j(each)f(other)-5
b(.)-2 4368 y
SDict begin H.S end
 -2 4368 a -2 4368 a
SDict begin 13 H.A end
 -2 4368 a -2 4368 a
SDict begin [/View [/XYZ H.V]/Dest (0:4931) cvn /DEST pdfmark end

-2 4368 a -2 4451 a
SDict begin H.S end
 -2 4451 a -2 4451 a
SDict begin 11.7 H.A end
 -2 4451 a -2
4451 a
SDict begin [/View [/XYZ H.V]/Dest (0:4932) cvn /DEST pdfmark end
 -2 4451 a 479 4531 a Fa(All)18 b(Public)h(Contracts)g(\(APIs)f
(or)h(protocols\))h(SHOULD)d(be)j(documented.)-2 4713
y
SDict begin H.S end
 -2 4713 a -2 4713 a
SDict begin 13 H.A end
 -2 4713 a -2 4713 a
SDict begin [/View [/XYZ H.V]/Dest (0:4933) cvn /DEST pdfmark end
 -2 4713 a 396
4804 a Fk(Y)-9 b(ou')l(d)19 b(think)g(this)i(w)o(as)g(a)g(gi)n(v)o(en)e
(for)g(professional)g(softw)o(are)g(engineers)g(b)n(ut)i(no,)e(it')-5
b(s)21 b(not.)f(So,)g(it')-5 b(s)21 b(a)g(rule.)f(Y)-9
b(ou)19 b(w)o(ant)396 4912 y(C4)i(certi\002cation)e(for)h(your)f
(project,)g(you)g(mak)o(e)h(sure)g(your)f(public)g(contracts)h(are)g
(documented.)d(No)j("it')-5 b(s)21 b(speci\002ed)396
5020 y(in)g(the)f(code")f(e)o(xcuses.)h(Code)g(is)h(not)f(a)g
(contract.)f(\(Y)-8 b(es,)20 b(I)h(intend)e(at)i(some)f(point)f(to)h
(create)g(a)h(C4)g(certi\002cation)396 5128 y(process)f(to)g(act)h(as)g
(a)f(quality)g(indicator)f(for)g(open)g(source)h(projects.\))-2
5146 y
SDict begin H.S end
 -2 5146 a -2 5146 a
SDict begin 13 H.A end
 -2 5146 a -2 5146 a
SDict begin [/View [/XYZ H.V]/Dest (0:4934) cvn /DEST pdfmark end
 -2 5146
a Black 3759 5569 a Ff(394)p Black eop end
%%Page: 395 408
TeXDict begin 395 407 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.395) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 479 72 a Fa(All)e(Public)h(Contracts)g(SHALL)f(use)h(Semantic)g
(V)-8 b(ersioning.)-2 255 y
SDict begin H.S end
 -2 255 a -2 255 a
SDict begin 13 H.A end
 -2 255
a -2 255 a
SDict begin [/View [/XYZ H.V]/Dest (0:4936) cvn /DEST pdfmark end
 -2 255 a 396 346 a Fk(This)21 b(rule)e(is)j(mainly)d(here)h
(because)f(people)g(ask)o(ed)h(for)g(it.)g(I')l(v)o(e)f(no)h(real)g(lo)
o(v)o(e)g(for)f(it,)i(since)f(Semantic)g(V)-9 b(ersioning)19
b(is)396 454 y(what)h(led)h(to)f(the)g(so-called)g("why)f(does)h
(\330MQ)g(not)g(speak)g(to)g(itself?!")g(debacle.)f(I')l(v)o(e)g(ne)n
(v)o(er)g(seen)i(the)f(problem)e(that)396 562 y(this)j(solv)o(ed.)e
(Something)g(about)g(runtime)g(v)n(alidation)g(of)h(library)f(v)o
(ersions,)g(or)h(some-such.)-2 580 y
SDict begin H.S end
 -2 580 a -2 580
a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:4937) cvn /DEST pdfmark end
 -2 580 a -2 663 a
SDict begin H.S end
 -2 663 a -2 663
a
SDict begin 11.7 H.A end
 -2 663 a -2 663 a
SDict begin [/View [/XYZ H.V]/Dest (0:4938) cvn /DEST pdfmark end
 -2 663 a 479 742 a Fa(All)e(Public)h(Contracts)g
(SHOULD)f(ha)o(v)o(e)h(space)h(for)e(e)o(xtensibility)h(and)h(e)o
(xperimentation.)-2 925 y
SDict begin H.S end
 -2 925 a -2 925 a
SDict begin 13 H.A end
 -2 925 a
-2 925 a
SDict begin [/View [/XYZ H.V]/Dest (0:4939) cvn /DEST pdfmark end
 -2 925 a 396 1016 a Fk(No)n(w)-5 b(,)20 b(the)g(real)g(thing)g
(is)h(that)f(public)f(contracts)1821 1016 y
SDict begin H.S end
 1821 1016
a 1821 1016 a
SDict begin 13 H.A end
 1821 1016 a 1821 1016 a
SDict begin [/View [/XYZ H.V]/Dest (0:4940) cvn /DEST pdfmark end
 1821 1016 a Ff(do)h(c)o(hang)o(e)
p Fk(.)e(It')-5 b(s)21 b(not)e(about)h(not)g(changing)e(them.)h(It')-5
b(s)21 b(about)396 1124 y(changing)d(them)i(safely)-5
b(.)20 b(This)g(means)g(educating)e(\(especially)i(protocol\))e
(designers)h(to)i(create)e(that)i(space)f(up)g(front.)-2
1142 y
SDict begin H.S end
 -2 1142 a -2 1142 a
SDict begin 13 H.A end
 -2 1142 a -2 1142 a
SDict begin [/View [/XYZ H.V]/Dest (0:4941) cvn /DEST pdfmark end
 -2 1142
a -2 1225 a
SDict begin H.S end
 -2 1225 a -2 1225 a
SDict begin 11.7 H.A end
 -2 1225 a -2 1225 a
SDict begin [/View [/XYZ H.V]/Dest (0:4942) cvn /DEST pdfmark end
 -2
1225 a 479 1305 a Fa(A)f(patch)g(that)g(modi\002es)g(a)g(Public)g
(Contract)g(SHOULD)e(not)j(break)f(e)o(xisting)g(applications)h(unless)
g(there)f(is)f(prior)479 1402 y(consensus)j(on)e(the)g(v)n(alue)h(of)f
(doing)h(this.)-2 1584 y
SDict begin H.S end
 -2 1584 a -2 1584 a
SDict begin 13 H.A end
 -2 1584
a -2 1584 a
SDict begin [/View [/XYZ H.V]/Dest (0:4943) cvn /DEST pdfmark end
 -2 1584 a 396 1676 a Fk(Sometimes)g(the)g(patch)g(is)h
(\002xing)e(a)i(bad)f(API)g(that)h(no-one)d(is)j(using.)e(It')-5
b(s)21 b(a)g(freedom)d(we)j(need)e(b)n(ut)h(it)h(should)f(be)396
1784 y(based)g(on)g(consensus,)f(not)h(one)f(person')-5
b(s)20 b(dogma.)e(Ho)n(we)n(v)o(er)m(,)h(making)f(random)h(changes)g
(just)i('because')d(is)k(nasty)-5 b(.)396 1891 y(Lik)o(e,)20
b(in)g(\330MQ/3.x,)g(renaming)e(ZMQ_NOBLOCK)i(to)g(ZMQ_DONTW)-10
b(AIT)k(.)19 b(Sure,)g(it')-5 b(s)22 b(closer)e(to)g(the)g(POSIX)396
1999 y(sock)o(et)g(recv\(\))f(call,)i(b)n(ut)f(is)h(that)f(w)o(orth)g
(breaking)e(thousands)h(of)h(applications?)f(No-one)f(e)n(v)o(er)i
(reported)e(it)j(as)g(an)396 2107 y(issue.)g(T)-7 b(o)20
b(misquote)f(Stallman:)1374 2107 y
SDict begin H.S end
 1374 2107 a 1374 2107
a
SDict begin 13 H.A end
 1374 2107 a 1374 2107 a
SDict begin [/View [/XYZ H.V]/Dest (0:4944) cvn /DEST pdfmark end
 1374 2107 a Ff(your)h(fr)m(eedom)g(to)g(cr)m
(eate)h(an)e(ideal)h(world)h(stops)f(one)g(inc)o(h)f(fr)l(om)i(my)g
(application.)-2 2125 y
SDict begin H.S end
 -2 2125 a -2 2125 a
SDict begin 13 H.A end
 -2 2125 a
-2 2125 a
SDict begin [/View [/XYZ H.V]/Dest (0:4945) cvn /DEST pdfmark end
 -2 2125 a -2 2208 a
SDict begin H.S end
 -2 2208 a -2 2208 a
SDict begin 11.7 H.A end
 -2
2208 a -2 2208 a
SDict begin [/View [/XYZ H.V]/Dest (0:4946) cvn /DEST pdfmark end
 -2 2208 a 479 2288 a Fa(A)e(patch)g(that)g(introduces)
h(ne)n(w)f(features)h(to)e(a)h(Public)g(Contract)g(SHOULD)f(do)h(so)g
(using)h(ne)n(w)f(names.)-2 2470 y
SDict begin H.S end
 -2 2470 a -2 2470
a
SDict begin 13 H.A end
 -2 2470 a -2 2470 a
SDict begin [/View [/XYZ H.V]/Dest (0:4947) cvn /DEST pdfmark end
 -2 2470 a 396 2561 a Fk(W)-7 b(e)22
b(had)d(the)h(e)o(xperience)f(in)h(\330MQ)g(once)g(or)g(twice)g(of)g
(ne)n(w)g(features)g(using)f(old)h(names)g(\(or)g(w)o(orse,)g(using)f
(names)396 2669 y(that)i(were)724 2669 y
SDict begin H.S end
 724 2669 a 724
2669 a
SDict begin 13 H.A end
 724 2669 a 724 2669 a
SDict begin [/View [/XYZ H.V]/Dest (0:4948) cvn /DEST pdfmark end
 724 2669 a Ff(still)g(in)f(use)h
Fk(else)n(where\).)e(\330MQ/3.0)g(had)h(a)g(ne)n(wly)g(introduced)e("R)
m(OUTER")i(sock)o(et)g(that)g(w)o(as)h(totally)396 2777
y(dif)n(ferent)e(from)g(the)h(e)o(xisting)g(R)m(OUTER)g(sock)o(et)g(in)
g(2.x.)g(Dear)g(lord,)f(you)g(should)h(be)g(f)o(ace-palming,)d(why?)j
(The)396 2885 y(reason:)g(apparently)-5 b(,)17 b(e)n(v)o(en)j(smart)g
(people)f(sometimes)h(need)f(re)o(gulation)f(to)j(stop)f(them)g(doing)f
(silly)h(things.)-2 2903 y
SDict begin H.S end
 -2 2903 a -2 2903 a
SDict begin 13 H.A end
 -2 2903
a -2 2903 a
SDict begin [/View [/XYZ H.V]/Dest (0:4949) cvn /DEST pdfmark end
 -2 2903 a -2 2986 a
SDict begin H.S end
 -2 2986 a -2 2986 a
SDict begin 11.7 H.A end
 -2
2986 a -2 2986 a
SDict begin [/View [/XYZ H.V]/Dest (0:4950) cvn /DEST pdfmark end
 -2 2986 a 479 3065 a Fa(Old)f(names)h(SHOULD)d(be)j
(deprecated)g(in)f(a)f(systematic)i(f)o(ashion)g(by)f(marking)h(ne)n(w)
f(names)h(as)e("e)o(xperimental")j(until)479 3163 y(the)o(y)f(are)e
(stable,)h(then)g(marking)h(the)f(old)g(names)h(as)f("deprecated".)-2
3345 y
SDict begin H.S end
 -2 3345 a -2 3345 a
SDict begin 13 H.A end
 -2 3345 a -2 3345 a
SDict begin [/View [/XYZ H.V]/Dest (0:4951) cvn /DEST pdfmark end
 -2 3345
a 396 3437 a Fk(This)i(life-c)o(ycle)e(notation)g(has)h(the)g(great)g
(bene\002t)g(of)g(actually)f(telling)h(users)g(what)h(is)g(going)e(on,)
g(with)h(a)h(consistent)396 3544 y(direction.)e("Experimental")f(means)
i("we)g(ha)n(v)o(e)g(introduced)d(this)k(and)f(intend)f(to)h(mak)o(e)g
(it)h(stable)g(if)f(it)h(w)o(orks".)e(Not,)396 3652 y("we)i(ha)n(v)o(e)
e(introduced)f(this)j(and)e(will)i(remo)o(v)o(e)e(it)i(at)f(an)o(y)g
(time)g(if)h(we)f(feel)g(lik)o(e)h(it".)f(One)g(assumes)h(that)f(code)g
(which)396 3760 y(survi)n(v)o(es)f(more)h(than)f(one)h(patch)g(c)o
(ycle)f(is)j(meant)d(to)i(be)f(there.)f("Deprecated")g(means)g("we)i
(ha)n(v)o(e)f(replaced)e(this)j(and)396 3868 y(intend)f(to)g(remo)o(v)o
(e)e(it".)-2 3869 y
SDict begin H.S end
 -2 3869 a -2 3869 a
SDict begin 13 H.A end
 -2 3869 a -2
3869 a
SDict begin [/View [/XYZ H.V]/Dest (0:4952) cvn /DEST pdfmark end
 -2 3869 a -2 3952 a
SDict begin H.S end
 -2 3952 a -2 3952 a
SDict begin 11.7 H.A end
 -2 3952
a -2 3952 a
SDict begin [/View [/XYZ H.V]/Dest (0:4953) cvn /DEST pdfmark end
 -2 3952 a 479 4048 a Fa(When)h(suf)n(\002cient)g(time)g
(has)g(passed,)h(old)f(deprecated)h(names)g(SHOULD)d(be)j(mark)o(ed)g
("le)o(gac)o(y")g(and)f(e)n(v)o(entually)h(remo)o(v)o(ed.)-2
4231 y
SDict begin H.S end
 -2 4231 a -2 4231 a
SDict begin 13 H.A end
 -2 4231 a -2 4231 a
SDict begin [/View [/XYZ H.V]/Dest (0:4954) cvn /DEST pdfmark end
 -2 4231
a 396 4322 a Fk(Which)g(in)h(theory)e(gi)n(v)o(es)g(applications)g
(time)i(to)f(mo)o(v)o(e)f(onto)g(stable)i(ne)n(w)f(contracts)f(b)n(ut)h
(without)g(risk.)g(Y)-9 b(ou)19 b(can)396 4430 y(upgrade)f(\002rst,)j
(mak)o(e)f(sure)g(things)g(w)o(ork,)f(and)h(then,)f(o)o(v)o(er)g(time,)
h(\002x)g(things)g(up)g(to)g(remo)o(v)o(e)f(dependencies)f(on)396
4538 y(deprecated)h(and)g(le)o(gac)o(y)g(APIs)i(and)e(protocols.)-2
4556 y
SDict begin H.S end
 -2 4556 a -2 4556 a
SDict begin 13 H.A end
 -2 4556 a -2 4556 a
SDict begin [/View [/XYZ H.V]/Dest (0:4955) cvn /DEST pdfmark end
 -2 4556
a -2 4639 a
SDict begin H.S end
 -2 4639 a -2 4639 a
SDict begin 11.7 H.A end
 -2 4639 a -2 4639 a
SDict begin [/View [/XYZ H.V]/Dest (0:4956) cvn /DEST pdfmark end
 -2
4639 a 479 4718 a Fa(Old)g(names)h(SHALL)d(NO)m(T)h(be)i(reused)f(by)h
(ne)n(w)f(features.)-2 4901 y
SDict begin H.S end
 -2 4901 a -2 4901 a
SDict begin 13 H.A end
 -2
4901 a -2 4901 a
SDict begin [/View [/XYZ H.V]/Dest (0:4957) cvn /DEST pdfmark end
 -2 4901 a 396 4992 a Fk(Ah,)h(yes,)g(the)g(jo)o(y)g
(when)f(\330MQ/3.x)g(renamed)g(the)h(top-used)e(API)i(functions)f
(\(zmq_send)f(and)h(zmq_recv\))f(and)h(then)396 5100
y(rec)o(ycled)g(the)h(old)g(names)g(for)f(ne)n(w)h(methods)g(that)g
(were)g(utterly)f(incompatible)g(\(and)g(which)h(I)g(suspect)g(fe)n(w)g
(people)p Black 3759 5569 a Ff(395)p Black eop end
%%Page: 396 409
TeXDict begin 396 408 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.396) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:4971) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(actually)g(use\).)g(Y)-9 b(ou)19 b(should)g(be)i
(slapping)e(yourself)g(in)h(confusion)e(again,)h(b)n(ut)h(really)-5
b(,)19 b(this)i(is)g(what)f(happened)e(and)i(I)396 180
y(w)o(as)h(as)g(guilty)f(as)h(an)o(yone.)d(After)i(all,)g(we)h(did)f
(change)e(the)j(v)o(ersion)e(number!)f(Semantic)h(V)-9
b(ersion)20 b(FTW!!)g(The)g(only)396 288 y(bene\002t)g(of)g(that)g(e)o
(xperience)e(w)o(as)j(to)g(get)f(this)h(rule.)-2 306
y
SDict begin H.S end
 -2 306 a -2 306 a
SDict begin 13 H.A end
 -2 306 a -2 306 a
SDict begin [/View [/XYZ H.V]/Dest (0:4958) cvn /DEST pdfmark end
 -2 306 a -2 389
a
SDict begin H.S end
 -2 389 a -2 389 a
SDict begin 11.7 H.A end
 -2 389 a -2 389 a
SDict begin [/View [/XYZ H.V]/Dest (0:4959) cvn /DEST pdfmark end
 -2 389 a 479 468
a Fa(When)e(old)h(names)f(are)g(remo)o(v)o(ed,)h(their)e
(implementations)i(MUST)e(pro)o(v)o(ok)o(e)j(an)e(e)o(xception)h
(\(assertion\))f(if)f(used)i(by)479 566 y(applications.)-2
748 y
SDict begin H.S end
 -2 748 a -2 748 a
SDict begin 13 H.A end
 -2 748 a -2 748 a
SDict begin [/View [/XYZ H.V]/Dest (0:4960) cvn /DEST pdfmark end
 -2 748 a 396
840 a Fk(I')l(v)o(e)f(not)h(tested)h(this)f(rule)g(to)h(be)f(certain)f
(it)i(mak)o(es)f(sense.)h(Perhaps)e(what)h(it)h(means)f(is)h("if)g(you)
e(can')o(t)g(pro)o(v)n(ok)o(e)f(a)396 948 y(compile)i(error)f(because)g
(the)h(API)h(is)g(dynamic,)d(pro)o(v)n(ok)o(e)g(an)j(assertion".)-2
1132 y
SDict begin H.S end
 -2 1132 a -2 1132 a
SDict begin 13 H.A end
 -2 1132 a -2 1132 a
SDict begin [/View [/XYZ H.V]/Dest (0:4961) cvn /DEST pdfmark end
 -2 1132
a 396 1222 a Fk(C4)g(is)g(not)f(perfect,)f(fe)n(w)h(things)g(are.)g
(The)f(process)h(for)g(changing)e(it)j(\(Digistan')-5
b(s)20 b(COSS\))h(is)g(a)g(little)g(outdated)d(no)n(w:)396
1329 y(it)j(relies)g(on)f(a)g(single-editor)f(w)o(ork\003o)n(w)g(with)h
(the)g(ability)g(to)h(fork,)d(b)n(ut)j(not)e(mer)o(ge.)g(This)h(seems)h
(to)f(w)o(ork)g(b)n(ut)g(it)396 1437 y(could)f(be)i(better)e(to)i(use)f
(C4)h(for)e(protocols)g(lik)o(e)i(C4.)-2 1549 y
SDict begin H.S end
 -2 1549
a -2 1549 a
SDict begin 13 H.A end
 -2 1549 a -2 1549 a
SDict begin [/View [/XYZ H.V]/Dest (0:4962) cvn /DEST pdfmark end
 -2 1549 a 359 x Fn(7.4.)39
b(W)-9 b(orked)39 b(Example)1426 1908 y
SDict begin H.S end
 1426 1908 a 1426
1908 a
SDict begin 22.464 H.A end
 1426 1908 a 1426 1908 a
SDict begin [/View [/XYZ H.V]/Dest (12.92.1) cvn /DEST pdfmark end
 1426 1908 a -2 2104 a
SDict begin H.S end

-2 2104 a -2 2104 a
SDict begin 13 H.A end
 -2 2104 a -2 2104 a
SDict begin [/View [/XYZ H.V]/Dest (0:4964) cvn /DEST pdfmark end
 -2 2104 a 396
2182 a Fk(In)486 2182 y
SDict begin H.S end
 486 2182 a 486 2182 a
SDict begin 13 H.A end
 486 2182
a 486 2182 a
SDict begin [/View [/XYZ H.V]/Dest (0:4965) cvn /DEST pdfmark end
 486 2182 a Fk(this)21 b(email)f(thread)f
(\(http://lists.zeromq.or)o(g/pipermail/zero)o(mq)o(-d)o(e)n(v/2)o(01)o
(2-)o(Octob)o(er/0)o(188)o(38)o(.h)o(tml\),)14 b(Dan)396
2290 y(Goes)21 b(asks)f(ho)n(w)g(to)g(mak)o(e)g(a)h(publisher)d(that)j
(kno)n(ws)e(when)h(a)g(ne)n(w)g(client)h(subscribes,)e(and)h(sends)g
(out)g(pre)n(vious)396 2398 y(matching)f(messages.)h(It')-5
b(s)21 b(a)g(standard)e(pub-sub)f(technique)g(called)i("last)h(v)n
(alue)f(caching".)e(No)n(w)j(o)o(v)o(er)d(a)j(1-w)o(ay)396
2506 y(transport)d(lik)o(e)i(pgm)f(\(where)f(subscribers)h(literally)g
(send)g(no)g(pack)o(ets)g(back)g(to)g(publishers\))f(this)i(can')o(t)f
(be)g(done.)f(But)396 2614 y(o)o(v)o(er)h(TCP)-9 b(,)21
b(it)g(can,)e(if)i(we)f(use)h(an)f(XPUB)h(sock)o(et)f(and)g(if)g(that)g
(sock)o(et)h(didn')o(t)d(cle)n(v)o(erly)h(\002lter)i(out)e(duplicate)
396 2721 y(subscriptions)g(to)i(reduce)e(upstream)g(traf)n(\002c.)-2
2906 y
SDict begin H.S end
 -2 2906 a -2 2906 a
SDict begin 13 H.A end
 -2 2906 a -2 2906 a
SDict begin [/View [/XYZ H.V]/Dest (0:4966) cvn /DEST pdfmark end
 -2 2906
a 396 2995 a Fk(Though)f(I'm)i(not)g(an)g(e)o(xpert)f(contrib)n(utor)f
(to)i(libzmq,)f(this)i(seems)g(a)f(fun)g(problem)e(to)j(solv)o(e.)e(Ho)
n(w)h(hard)g(could)f(it)396 3103 y(be?)h(I)h(start)f(by)g(forking)e
(the)j(libzmq)e(repository)f(to)j(my)f(o)n(wn)f(GitHub)h(account,)f
(and)g(then)h(clone)g(it)h(to)f(my)g(laptop,)396 3211
y(where)g(I)g(b)n(uild)g(it:)-2 3295 y
SDict begin H.S end
 -2 3295 a -2 3295
a
SDict begin 11.7 H.A end
 -2 3295 a -2 3295 a
SDict begin [/View [/XYZ H.V]/Dest (0:4967) cvn /DEST pdfmark end
 -2 3295 a 396 3391 a Fe(git)45
b(clone)f(git@github.com:hintjens/libzmq.git)396 3489
y(cd)h(libzmq)396 3586 y(./autogen.sh)396 3683 y(./configure)396
3780 y(make)-2 3947 y
SDict begin H.S end
 -2 3947 a -2 3947 a
SDict begin 13 H.A end
 -2 3947 a -2
3947 a
SDict begin [/View [/XYZ H.V]/Dest (0:4968) cvn /DEST pdfmark end
 -2 3947 a 396 4054 a Fk(Since)20 b(the)h(libzmq)e(code)h(is)h
(neat)f(and)f(well-or)o(ganized)e(it)k(w)o(as)g(quite)f(easy)g(to)h
(\002nd)f(the)g(main)g(\002les)h(to)f(change)396 4162
y(\(xpub)m(.cpp)d(and)j(xpub)m(.hpp\).)c(Each)k(sock)o(et)g(type)f(has)
i(its)g(o)n(wn)f(source)f(\002le)i(and)f(class.)g(The)o(y)g(inherit)f
(from)396 4270 y(sock)o(et_base.cpp,)f(which)h(has)i(this)g(hook)d(for)
i(sock)o(et-speci\002c)f(options:)-2 4371 y
SDict begin H.S end
 -2 4371 a
-2 4371 a
SDict begin 11.7 H.A end
 -2 4371 a -2 4371 a
SDict begin [/View [/XYZ H.V]/Dest (0:4969) cvn /DEST pdfmark end
 -2 4371 a 396 4450 a Fe(//)90
b(First,)43 b(check)h(whether)g(specific)g(socket)f(type)i(overloads)e
(the)h(option.)396 4547 y(int)h(rc)f(=)h(xsetsockopt)e(\(option_,)g
(optval_,)h(optvallen_\);)396 4644 y(if)h(\(rc)f(==)h(0)f(||)h(errno)f
(!=)g(EINVAL\))576 4741 y(return)f(rc;)396 4936 y(//)90
b(If)44 b(the)g(socket)g(type)g(doesn't)g(support)g(the)g(option,)g
(pass)g(it)g(to)396 5033 y(//)90 b(the)44 b(generic)g(option)f(parser.)
396 5130 y(return)h(options.setsockopt)e(\(option_,)h(optval_,)h
(optvallen_\);)p Black 3757 5569 a Ff(396)p Black eop
end
%%Page: 397 410
TeXDict begin 397 409 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.397) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4970) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Then)g(I)g(check)f(where)h(the)g(XPUB)h(sock)o(et)f
(\002lters)h(out)f(duplicate)f(subscriptions,)g(in)h(its)h(xread_acti)n
(v)n(ated)d(method:)396 253 y Fe(bool)44 b(unique;)396
350 y(if)h(\()576 363 y(*)621 350 y(data)f(==)g(0\))576
447 y(unique)f(=)i(subscriptions.rm)d(\(data)i(+)h(1,)f(size)h(-)f(1,)h
(pipe_\);)396 544 y(else)576 641 y(unique)e(=)i(subscriptions.add)d
(\(data)i(+)h(1,)f(size)g(-)h(1,)g(pipe_\);)396 835 y(//)90
b(If)44 b(the)g(subscription)f(is)i(not)f(a)h(duplicate)e(store)h(it)h
(so)f(that)g(it)h(can)f(be)396 933 y(//)90 b(passed)43
b(to)i(used)f(on)h(next)f(recv)g(call.)396 1030 y(if)h(\(unique)e(&&)i
(options.type)e(!=)h(ZMQ_PUB\))576 1127 y(pending.push_back)e(\(blob_t)
h(\(data,)h(size\)\);)-2 1304 y
SDict begin H.S end
 -2 1304 a -2 1304 a
SDict begin 13 H.A end
 -2
1304 a -2 1304 a
SDict begin [/View [/XYZ H.V]/Dest (0:4972) cvn /DEST pdfmark end
 -2 1304 a 396 1401 a Fk(At)21 b(this)g(stage)f(I'm)g
(not)g(too)f(concerned)f(with)j(the)f(details)g(of)g(ho)n(w)g
(subscriptions.rm)e(and)i(.add)f(w)o(ork.)g(The)h(code)396
1509 y(seems)h(ob)o(vious)d(e)o(xcept)i(that)g("subscription")e(also)j
(includes)e(unsubscription,)f(which)h(confused)g(me)h(for)g(a)g(fe)n(w)
396 1617 y(seconds.)f(If)g(there')-5 b(s)19 b(an)o(ything)e(else)j
(weird)f(in)g(the)g(rm)g(and)g(add)g(methods,)f(that')-5
b(s)19 b(a)h(separate)f(issue)g(to)h(\002x)f(later)-5
b(.)20 b(T)m(ime)396 1725 y(to)h(mak)o(e)e(an)h(issue)h(for)f(this)h
(change.)d(I)j(head)e(o)o(v)o(er)g(to)h(the)g(zeromq.jira.com)d(site,)k
(log)f(in,)g(and)g(create)g(a)g(ne)n(w)g(entry)-5 b(.)-2
1909 y
SDict begin H.S end
 -2 1909 a -2 1909 a
SDict begin 13 H.A end
 -2 1909 a -2 1909 a
SDict begin [/View [/XYZ H.V]/Dest (0:4973) cvn /DEST pdfmark end
 -2 1909
a 396 1999 a Fk(Jira)21 b(kindly)e(of)n(fers)g(me)h(the)h(traditional)e
(choice)g(between)g("b)n(ug")h(and)f("ne)n(w)h(feature")f(and)h(I)g
(spend)g(thirty)g(seconds)396 2107 y(w)o(ondering)e(where)i(this)h
(counter)n(-producti)n(v)o(e)15 b(historical)20 b(distinction)f(came)h
(from.)f(Presumably)-5 b(,)18 b(the)i("we')o(ll)h(\002x)396
2214 y(b)n(ugs)f(for)g(free)g(b)n(ut)g(you)f(pay)h(for)f(ne)n(w)h
(features")g(commercial)e(proposal,)h(which)g(stems)i(from)e(the)i
("you)e(tell)i(us)f(what)396 2322 y(you)g(w)o(ant)g(and)g(we')o(ll)g
(mak)o(e)g(it)h(for)e($X")h(model)g(of)g(softw)o(are)f(de)n(v)o
(elopment,)e(and)j(which)g(generally)e(leads)j(to)f("we)396
2430 y(spent)g(three)g(times)h($X)f(and)f(we)i(got)f(what?!")f(email)i
(Fists)g(of)f(Fury)-5 b(.)-2 2614 y
SDict begin H.S end
 -2 2614 a -2 2614
a
SDict begin 13 H.A end
 -2 2614 a -2 2614 a
SDict begin [/View [/XYZ H.V]/Dest (0:4974) cvn /DEST pdfmark end
 -2 2614 a 396 2704 a Fk(Putting)20
b(such)g(thoughts)f(aside,)h(I)g(create)1616 2704 y
SDict begin H.S end
 1616
2704 a 1616 2704 a
SDict begin 13 H.A end
 1616 2704 a 1616 2704 a
SDict begin [/View [/XYZ H.V]/Dest (0:4975) cvn /DEST pdfmark end
 1616 2704
a Fk(an)g(issue)h(#443)e(\(https://zeromq.jira.com/bro)n(wse/LIBZM)o
(Q-44)o(3\))14 b(and)396 2812 y(described)19 b(the)h(problem)f(and)g
(plausible)h(solution:)-2 2830 y
SDict begin H.S end
 -2 2830 a -2 2830 a
SDict begin 13 H.A end

-2 2830 a -2 2830 a
SDict begin [/View [/XYZ H.V]/Dest (0:4976) cvn /DEST pdfmark end
 -2 2830 a -2 3038 a
SDict begin H.S end
 -2 3038 a -2
3038 a
SDict begin 11.7 H.A end
 -2 3038 a -2 3038 a
SDict begin [/View [/XYZ H.V]/Dest (0:4977) cvn /DEST pdfmark end
 -2 3038 a 479 3117 a Fa(Problem:)f(XPUB)f
(sock)o(et)i(\002lters)e(out)h(duplicate)g(subscriptions)h
(\(deliberate)g(design\).)f(Ho)n(we)n(v)o(er)h(this)e(mak)o(es)i(it)479
3214 y(impossible)g(to)f(do)g(subscription-based)i(intelligence.)e(See)
479 3311 y(http://lists.zeromq.or)o(g/pipermail/zeromq-de)n
(v/2012-October/018838.html)24 b(for)19 b(a)g(use-case.)-2
3369 y
SDict begin H.S end
 -2 3369 a -2 3369 a
SDict begin 11.7 H.A end
 -2 3369 a -2 3369 a
SDict begin [/View [/XYZ H.V]/Dest (0:4978) cvn /DEST pdfmark end
 -2 3369
a 479 3450 a Fa(Solution:)g(mak)o(e)h(this)e(beha)o(viour)i
(con\002gurable)h(with)d(a)h(sock)o(et)h(option.)-2 3632
y
SDict begin H.S end
 -2 3632 a -2 3632 a
SDict begin 13 H.A end
 -2 3632 a -2 3632 a
SDict begin [/View [/XYZ H.V]/Dest (0:4979) cvn /DEST pdfmark end
 -2 3632 a 396
3724 a Fk(Naming)g(time.)g(The)f(API)i(sits)g(in)g(include/zmq.h,)c(so)
k(this)f(is)h(where)f(I)g(added)f(the)i(option)e(name.)g(When)h(you)f
(in)m(v)o(ent)396 3832 y(a)i(concept,)e(in)h(an)g(API)h(or)e(an)o
(ywhere,)1545 3832 y
SDict begin H.S end
 1545 3832 a 1545 3832 a
SDict begin 13 H.A end
 1545 3832
a 1545 3832 a
SDict begin [/View [/XYZ H.V]/Dest (0:4980) cvn /DEST pdfmark end
 1545 3832 a Ff(please)h Fk(tak)o(e)h(a)f(moment)f(to)h
(choose)g(a)g(name)g(that)g(is)h(e)o(xplicit)f(and)g(short)f(and)396
3940 y(ob)o(vious.)f(Don')o(t)h(f)o(all)i(back)f(on)f(generic)g(names)h
(which)g(need)f(additional)g(conte)o(xt)g(to)i(understand.)c(Y)-9
b(ou)20 b(ha)n(v)o(e)f(one)396 4048 y(chance)g(to)i(tell)g(the)f
(reader)f(what)h(your)f(concept)g(is,)i(and)f(does.)f(A)i(name)f(lik)o
(e)396 4155 y(ZMQ_SUBSCRIPTION_FOR)-5 b(W)-10 b(ARDING_FLA)m(G)20
b(is)h(terrible.)e(It)i(technically)e(kind)g(of)h(aims)h(in)f(the)g
(right)396 4263 y(direction)f(b)n(ut)h(is)h(miserably)f(long)f(and)h
(obscure.)e(I)j(chose)f(ZMQ_XPUB_VERBOSE:)g(short)f(and)h(e)o(xplicit)g
(and)396 4371 y(clearly)g(an)g(on/of)n(f)f(switch)h(with)h("of)n(f")e
(being)g(the)h(def)o(ault)g(setting.)-2 4555 y
SDict begin H.S end
 -2 4555
a -2 4555 a
SDict begin 13 H.A end
 -2 4555 a -2 4555 a
SDict begin [/View [/XYZ H.V]/Dest (0:4981) cvn /DEST pdfmark end
 -2 4555 a 396 4645 a
Fk(So,)g(time)h(to)f(add)g(a)g(pri)n(v)n(ate)g(property)e(to)i(the)g
(xpub)f(class)i(de\002nition)e(in)i(xpub)m(.hpp:)-2 4746
y
SDict begin H.S end
 -2 4746 a -2 4746 a
SDict begin 11.7 H.A end
 -2 4746 a -2 4746 a
SDict begin [/View [/XYZ H.V]/Dest (0:4982) cvn /DEST pdfmark end
 -2 4746 a 396
4825 a Fe(//)45 b(If)f(true,)g(send)g(all)h(subscription)e(messages)g
(upstream,)g(not)i(just)396 4923 y(//)g(unique)f(ones)396
5020 y(bool)g(verbose;)p Black 3756 5569 a Ff(397)p Black
eop end
%%Page: 398 411
TeXDict begin 398 410 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.398) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4983) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(And)g(then)g(lift)g(some)g(code)g(from)f(router)-5
b(.cpp)18 b(to)i(implement)f(the)i(xsetsock)o(opt)e(method.)f(Finally)
-5 b(,)19 b(change)g(the)396 180 y(xread_acti)n(v)n(ated)e(method)i(to)
i(use)f(this)h(ne)n(w)f(option,)e(and)i(while)g(at)h(it,)g(mak)o(e)e
(that)i(test)g(on)f(sock)o(et)g(type)f(more)396 288 y(e)o(xplicit)h
(too:)-2 389 y
SDict begin H.S end
 -2 389 a -2 389 a
SDict begin 11.7 H.A end
 -2 389 a -2 389 a
SDict begin [/View [/XYZ H.V]/Dest (0:4984) cvn /DEST pdfmark end
 -2
389 a 396 468 a Fe(//)90 b(If)44 b(the)g(subscription)f(is)i(not)f(a)h
(duplicate)e(store)h(it)h(so)f(that)g(it)h(can)f(be)396
566 y(//)90 b(passed)43 b(to)i(used)f(on)h(next)f(recv)g(call.)396
663 y(if)h(\(options.type)d(==)j(ZMQ_XPUB)e(&&)i(\(unique)f(||)g
(verbose\)\))576 760 y(pending.push_back)e(\(blob_t)h(\(data,)h
(size\)\);)-2 937 y
SDict begin H.S end
 -2 937 a -2 937 a
SDict begin 13 H.A end
 -2 937 a -2 937
a
SDict begin [/View [/XYZ H.V]/Dest (0:4985) cvn /DEST pdfmark end
 -2 937 a 396 1034 a Fk(The)20 b(thing)g(b)n(uilds)g(nicely)f(\002rst)
i(time.)f(Which)g(mak)o(es)g(me)h(a)f(little)h(suspicious,)f(b)n(ut)g
(being)f(lazy)h(and)g(jet-lagged)f(I)396 1142 y(don')o(t)g(immediately)
g(mak)o(e)g(a)i(test)g(case)g(to)f(actually)g(try)g(out)g(the)g
(change.)e(The)i(process)g(doesn')o(t)f(demand)f(that,)i(e)n(v)o(en)396
1250 y(if)h(usually)e(I')l(d)h(do)g(it)g(just)h(to)g(catch)e(that)i
(ine)n(vitable)e(10\045)h(of)g(mistak)o(es)g(we)h(all)g(mak)o(e.)e(I)h
(do)g(ho)n(we)n(v)o(er)e(document)h(this)396 1358 y(ne)n(w)h(option)f
(on)h(the)g(doc/zmq_setsock)o(opt.txt)d(man)i(page.)g(In)h(the)h(w)o
(orst)f(case)h(I)f(added)f(a)i(patch)e(that)i(w)o(asn')o(t)e(really)396
1466 y(useful.)h(But)g(I)h(certainly)e(didn')o(t)g(break)g(an)o
(ything.)-2 1650 y
SDict begin H.S end
 -2 1650 a -2 1650 a
SDict begin 13 H.A end
 -2 1650 a -2 1650
a
SDict begin [/View [/XYZ H.V]/Dest (0:4986) cvn /DEST pdfmark end
 -2 1650 a 396 1740 a Fk(I)i(don')o(t)d(implement)h(a)i(matching)d
(zmq_getsock)o(opt,)f(since)k("minimal")e(means)h(what)g(it)h(says.)f
(There')-5 b(s)20 b(no)g(ob)o(vious)396 1847 y(use)h(case)f(for)g
(getting)f(the)h(v)n(alue)g(of)g(an)g(option)f(that)h(you)g(presumably)
e(just)i(set,)h(in)f(code.)g(Symmetry)e(isn')o(t)i(a)h(v)n(alid)396
1955 y(reason)f(to)g(double)f(the)h(size)h(of)f(a)g(patch.)g(I)g(did)g
(ha)n(v)o(e)g(to)g(document)e(the)i(ne)n(w)g(option)f(since)i(the)f
(process)g(says,)g("All)396 2063 y(Public)g(Contracts)g(SHOULD)h(be)f
(documented.")-2 2230 y
SDict begin H.S end
 -2 2230 a -2 2230 a
SDict begin 13 H.A end
 -2 2230 a
-2 2230 a
SDict begin [/View [/XYZ H.V]/Dest (0:4987) cvn /DEST pdfmark end
 -2 2230 a 396 2337 a Fk(Committing)f(the)i(code,)e(I)h(push)g
(the)g(patch)g(to)g(my)g(fork)o(ed)e(repository)h(\(the)h('origin'\):)
-2 2438 y
SDict begin H.S end
 -2 2438 a -2 2438 a
SDict begin 11.7 H.A end
 -2 2438 a -2 2438 a
SDict begin [/View [/XYZ H.V]/Dest (0:4988) cvn /DEST pdfmark end
 -2
2438 a 396 2517 a Fe(git)45 b(commit)e(-a)i(-m)f("Fixed)g(issue)g
(#443")396 2615 y(git)h(push)f(origin)g(master)-2 2792
y
SDict begin H.S end
 -2 2792 a -2 2792 a
SDict begin 13 H.A end
 -2 2792 a -2 2792 a
SDict begin [/View [/XYZ H.V]/Dest (0:4989) cvn /DEST pdfmark end
 -2 2792 a 396
2889 a Fk(Switching)20 b(to)g(the)g(GitHub)g(web)g(interf)o(ace,)f(I)i
(go)e(to)i(my)f(libzmq)f(fork,)g(and)h(press)g(the)g(big)g("Pull)g
(Request")h(b)n(utton)396 2997 y(at)g(the)f(top.)g(GitHub)g(asks)g(me)h
(for)e(a)i(title,)f(so)h(I)f(enter)g("Added)f(ZMQ_XPUB_VERBOSE)h
(option".)f(I'm)g(not)h(sure)396 3104 y(why)g(it)g(asks)h(this)g(since)
f(I)h(made)e(a)i(neat)f(commit)f(message)h(b)n(ut)h(he)o(y)-5
b(,)18 b(let')-5 b(s)22 b(go)d(with)i(the)f(\003o)n(w)g(here.)-2
3288 y
SDict begin H.S end
 -2 3288 a -2 3288 a
SDict begin 13 H.A end
 -2 3288 a -2 3288 a
SDict begin [/View [/XYZ H.V]/Dest (0:4990) cvn /DEST pdfmark end
 -2 3288
a 396 3378 a Fk(This)h(mak)o(es)f(a)g(nice)g(little)h(pull)f(request)g
(with)g(tw)o(o)h(commits.)e(The)h(one)g(I')l(d)f(made)h(a)g(month)f
(ago)h(on)g(the)g(release)396 3486 y(notes,)g(to)g(prepare)f(for)h(the)
g(3.2.1)f(release)h(\(a)g(month)f(passes)i(so)f(quickly)f(when)h(you)f
(spend)h(most)g(of)g(it)h(in)f(airports\),)396 3594 y(and)f(my)h(\002x)
g(for)f(issue)h(#443)e(\(37)h(ne)n(w)h(lines)g(of)f(code\).)g(GitHub)g
(lets)h(you)f(continue)f(to)i(mak)o(e)f(commits)h(after)f(you')l(v)o(e)
396 3702 y(kick)o(ed)h(of)n(f)f(a)i(pull)f(request.)f(The)o(y)g(get)h
(queued)f(up,)g(and)h(mer)o(ged)e(in)i(one)g(go.)g(That)g(is)h(easy)f
(b)n(ut)g(the)g(maintainer)f(may)396 3810 y(refuse)h(the)g(whole)g(b)n
(undle)f(based)h(on)f(one)h(patch)g(that)g(doesn')o(t)f(look)g(v)n
(alid.)-2 3994 y
SDict begin H.S end
 -2 3994 a -2 3994 a
SDict begin 13 H.A end
 -2 3994 a -2 3994
a
SDict begin [/View [/XYZ H.V]/Dest (0:4991) cvn /DEST pdfmark end
 -2 3994 a 396 4084 a Fk(Since)h(Dan)h(is)g(w)o(aiting)f(\(at)g(least)
h(in)f(my)g(highly)f(optimistic)h(imagination\))e(for)i(this)g(\002x,)h
(I)f(go)g(back)f(to)i(the)396 4192 y(zeromq-de)n(v)c(list)k(and)e(tell)
i(him)e(I')l(v)o(e)g(made)g(the)h(patch,)f(with)h(a)g(link)g(to)g(the)g
(commit.)f(The)g(f)o(aster)h(I)g(get)g(feedback,)e(the)396
4300 y(better)-5 b(.)20 b(It')-5 b(s)21 b(1am)f(in)g(South)g(K)m(orea)f
(as)i(I)g(mak)o(e)e(this)i(patch,)e(so)i(early)f(e)n(v)o(ening)e(in)i
(Europe,)f(and)g(morning)f(in)j(the)396 4408 y(States.)g(Y)-9
b(ou)19 b(learn)h(to)g(count)f(timezones)g(when)g(you)g(w)o(ork)g(with)
i(people)d(across)i(the)g(w)o(orld.)f(Ian)h(is)h(in)f(a)g(conference,)
396 4516 y(Mikk)o(o)f(is)i(getting)d(on)i(a)g(plane,)f(and)g(Chuck)g
(is)h(probably)e(in)h(the)h(of)n(\002ce,)f(b)n(ut)h(three)f(hours)f
(later)m(,)i(Ian)f(mer)o(ges)f(the)i(pull)396 4624 y(request.)-2
4808 y
SDict begin H.S end
 -2 4808 a -2 4808 a
SDict begin 13 H.A end
 -2 4808 a -2 4808 a
SDict begin [/View [/XYZ H.V]/Dest (0:4992) cvn /DEST pdfmark end
 -2 4808
a 396 4898 a Fk(After)g(Ian)g(mer)o(ges)f(the)h(pull)g(request,)f(I)i
(re-synchronize)c(my)j(fork)f(with)h(the)g(upstream)f(libzmq)h
(repository)-5 b(.)18 b(First,)i(I)396 5006 y(add)g(a)h(')l(remote')d
(that)i(tells)h(git)g(where)e(this)i(repository)e(sits)i(\(I)f(do)g
(this)h(just)f(once)g(in)g(the)g(directory)f(where)g(I'm)396
5114 y(w)o(orking\):)p Black 3759 5569 a Ff(398)p Black
eop end
%%Page: 399 412
TeXDict begin 399 411 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.399) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:4993) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fe(git)45 b(remote)e(add)i(upstream)e
(git://github.com/zeromq/libzmq.git)-2 250 y
SDict begin H.S end
 -2 250 a
-2 250 a
SDict begin 13 H.A end
 -2 250 a -2 250 a
SDict begin [/View [/XYZ H.V]/Dest (0:4994) cvn /DEST pdfmark end
 -2 250 a 396 346 a Fk(And)20
b(then)g(I)g(pull)g(changes)f(back)h(from)f(the)h(upstream)f(master)h
(and)g(check)f(the)h(git)h(log)f(to)g(double-check:)-2
447 y
SDict begin H.S end
 -2 447 a -2 447 a
SDict begin 11.7 H.A end
 -2 447 a -2 447 a
SDict begin [/View [/XYZ H.V]/Dest (0:4995) cvn /DEST pdfmark end
 -2 447 a 396
527 a Fe(git)45 b(pull)f(--rebase)f(upstream)h(master)396
624 y(git)h(log)-2 801 y
SDict begin H.S end
 -2 801 a -2 801 a
SDict begin 13 H.A end
 -2 801 a -2
801 a
SDict begin [/View [/XYZ H.V]/Dest (0:4996) cvn /DEST pdfmark end
 -2 801 a 396 898 a Fk(And)20 b(that)g(is)h(pretty)f(much)f(it,)i
(in)f(terms)g(of)g(ho)n(w)g(much)f(git)i(one)e(needs)h(to)g(learn)g
(and)g(use)g(to)g(contrib)n(ute)f(patches)h(to)396 1006
y(libzmq.)f(Six)i(git)f(commands)f(and)g(some)h(clicking)g(on)g(web)g
(pages.)f(Most)i(importantly)d(to)i(me)g(as)h(a)g(naturally)e(lazy)-5
b(,)396 1114 y(stupid,)20 b(and)f(easily)i(confused)d(de)n(v)o(eloper)m
(,)g(I)i(don')o(t)e(ha)n(v)o(e)i(to)g(learn)g(git')-5
b(s)21 b(internal)e(models,)h(and)f(ne)n(v)o(er)g(ha)n(v)o(e)h(to)g(do)
396 1222 y(an)o(ything)e(in)m(v)n(olving)g(those)i(infernal)f(engines)h
(of)g(structural)f(comple)o(xity)f(we)j(call)f("git)h(branches".)d(Ne)o
(xt)i(up,)f(the)396 1329 y(attempted)g(assassination)i(of)f(git)g
(branches.)f(Let')-5 b(s)20 b(li)n(v)o(e)g(dangerously!)-2
1358 y
SDict begin H.S end
 -2 1358 a -2 1358 a
SDict begin 13 H.A end
 -2 1358 a -2 1358 a
SDict begin [/View [/XYZ H.V]/Dest (0:4997) cvn /DEST pdfmark end
 -2 1358
a 359 x Fn(7.5.)39 b(Git)g(Branc)o(hes)e(Considered)g(Harmful)2581
1717 y
SDict begin H.S end
 2581 1717 a 2581 1717 a
SDict begin 22.464 H.A end
 2581 1717 a 2581 1717
a
SDict begin [/View [/XYZ H.V]/Dest (12.93.1) cvn /DEST pdfmark end
 2581 1717 a -2 1885 a
SDict begin H.S end
 -2 1885 a -2 1885 a
SDict begin 13 H.A end
 -2 1885 a
-2 1885 a
SDict begin [/View [/XYZ H.V]/Dest (0:4999) cvn /DEST pdfmark end
 -2 1885 a 396 1991 a Fk(One)20 b(of)g(git')-5
b(s)21 b(most)f(popular)f(features)g(is)i(ho)n(w)f(easy)g(it)h(mak)o
(es)f(branches.)f(Almost)h(all)h(projects)e(that)i(use)f(git)h(use)396
2099 y(branches,)e(and)g(the)i(selection)f(of)f(the)i("best")f
(branching)e(strate)o(gy)h(is)i(lik)o(e)g(a)f(rite)h(of)f(passage)g
(for)f(an)h(open)f(source)396 2207 y(project.)g(V)-5
b(incent)20 b(Driessen')-5 b(s)1314 2207 y
SDict begin H.S end
 1314 2207
a 1314 2207 a
SDict begin 13 H.A end
 1314 2207 a 1314 2207 a
SDict begin [/View [/XYZ H.V]/Dest (0:5000) cvn /DEST pdfmark end
 1314 2207 a Fk(git-\003o)n(w)19
b(\(http://n)m(vie.com/posts/a-successful-git-br)o(anch)o(ing)o(-m)o
(od)o(el/\))c(is)21 b(maybe)396 2315 y(the)f(best)h(kno)n(wn.)d(It)j
(has)f('base')g(branches)f(\(master)m(,)g(de)n(v)o(elop\),)f('feature')
g(branches,)h(')l(release')g(branches,)g('hot\002x')396
2423 y(branches,)g(and)g(')-5 b(support')19 b(branches.)g(Man)o(y)g
(teams)h(ha)n(v)o(e)g(adopted)e(git-\003o)n(w)-5 b(,)19
b(which)h(e)n(v)o(en)f(has)i(git)f(e)o(xtensions)f(to)396
2531 y(support)g(it.)i(I'm)e(a)i(great)f(belie)n(v)o(er)f(in)h(popular)
e(wisdom,)i(b)n(ut)g(sometimes)g(you)f(ha)n(v)o(e)h(to)g(recognize)f
(mass)h(delusion)396 2638 y(for)g(what)g(it)h(is.)-2
2805 y
SDict begin H.S end
 -2 2805 a -2 2805 a
SDict begin 13 H.A end
 -2 2805 a -2 2805 a
SDict begin [/View [/XYZ H.V]/Dest (0:5001) cvn /DEST pdfmark end
 -2 2805
a 396 2912 a Fk(Here)f(is)h(a)g(section)f(of)g(C4)h(that)f(might)f(ha)n
(v)o(e)h(shock)o(ed)f(you)g(when)h(you)f(\002rst)i(read)f(it:)-2
2930 y
SDict begin H.S end
 -2 2930 a -2 2930 a
SDict begin 13 H.A end
 -2 2930 a -2 2930 a
SDict begin [/View [/XYZ H.V]/Dest (0:5002) cvn /DEST pdfmark end
 -2 2930
a -2 3013 a
SDict begin H.S end
 -2 3013 a -2 3013 a
SDict begin 11.7 H.A end
 -2 3013 a -2 3013 a
SDict begin [/View [/XYZ H.V]/Dest (0:5003) cvn /DEST pdfmark end
 -2
3013 a 479 3093 a Fa(The)f(project)g(SHALL)f(NO)m(T)g(use)h(topic)g
(branches)i(for)d(an)o(y)i(reason.)f(Personal)g(forks)g(MA)-8
b(Y)20 b(use)f(topic)g(branches.)-2 3275 y
SDict begin H.S end
 -2 3275 a
-2 3275 a
SDict begin 13 H.A end
 -2 3275 a -2 3275 a
SDict begin [/View [/XYZ H.V]/Dest (0:5004) cvn /DEST pdfmark end
 -2 3275 a 396 3367 a Fk(T)-7
b(o)21 b(be)f(clear)m(,)f(it')-5 b(s)924 3367 y
SDict begin H.S end
 924 3367
a 924 3367 a
SDict begin 13 H.A end
 924 3367 a 924 3367 a
SDict begin [/View [/XYZ H.V]/Dest (0:5005) cvn /DEST pdfmark end
 924 3367 a Ff(public)19
b(br)o(anc)o(hes)f(in)j(shar)m(ed)e(r)m(epositories)i
Fk(that)f(I'm)g(talking)f(about.)g(Using)h(branches)f(for)h(pri)n(v)n
(ate)396 3475 y(w)o(ork,)g(e.g.)f(to)i(w)o(ork)e(on)h(dif)n(ferent)e
(issues,)j(appears)f(to)g(w)o(ork)f(well)i(enough,)d(though)g(it')-5
b(s)22 b(more)d(comple)o(xity)f(than)i(I)396 3582 y(personally)f(enjo)o
(y)-5 b(.)19 b(T)-7 b(o)20 b(channel)f(Stallman)h(again:)1907
3582 y
SDict begin H.S end
 1907 3582 a 1907 3582 a
SDict begin 13 H.A end
 1907 3582 a 1907 3582
a
SDict begin [/View [/XYZ H.V]/Dest (0:5006) cvn /DEST pdfmark end
 1907 3582 a Ff(your)g(fr)m(eedom)g(to)g(cr)m(eate)g(comple)n(xity)g
(ends)g(one)g(inc)o(h)f(fr)l(om)i(our)396 3690 y(shar)m(ed)f(workspace)
o(.)-2 3873 y
SDict begin H.S end
 -2 3873 a -2 3873 a
SDict begin 13 H.A end
 -2 3873 a -2 3873 a
SDict begin [/View [/XYZ H.V]/Dest (0:5007) cvn /DEST pdfmark end

-2 3873 a 396 3964 a Fk(Lik)o(e)g(the)h(rest)f(of)g(C4,)h(the)f(rules)g
(on)g(branches)e(are)j(not)e(accidental.)h(The)o(y)f(came)h(from)f(our)
g(e)o(xperience)f(making)396 4072 y(\330MQ,)i(starting)g(when)g(Martin)
g(Sustrik)g(and)f(I)i(rethought)d(ho)n(w)h(to)i(mak)o(e)e(stable)i
(releases.)f(W)-7 b(e)21 b(both)f(lo)o(v)o(e)f(and)396
4180 y(appreciate)g(simplicity)h(\(some)g(people)f(seem)h(to)h(ha)n(v)o
(e)e(a)i(remarkable)d(tolerance)h(for)h(comple)o(xity\).)d(W)-7
b(e)21 b(chatted)f(for)396 4288 y(a)h(while...)e(I)i(ask)o(ed)f(him,)f
("I'm)h(going)f(to)h(start)h(making)e(a)h(stable)h(release,)f(w)o(ould)
f(it)i(be)f(OK)h(for)e(me)i(to)f(mak)o(e)g(a)396 4396
y(branch)f(in)g(the)h(git)g(you')l(re)e(w)o(orking)g(in?")i(Martin)f
(didn')o(t)g(lik)o(e)h(the)f(idea.)h("OK,)g(if)g(I)g(fork)e(the)i
(repository)-5 b(,)18 b(I)i(can)f(mo)o(v)o(e)396 4504
y(patches)h(from)f(your)g(repo)g(to)i(that)f(one".)f(That)h(felt)h
(much)e(better)h(to)g(both)f(of)h(us.)-2 4688 y
SDict begin H.S end
 -2 4688
a -2 4688 a
SDict begin 13 H.A end
 -2 4688 a -2 4688 a
SDict begin [/View [/XYZ H.V]/Dest (0:5008) cvn /DEST pdfmark end
 -2 4688 a 396 4778 a
Fk(The)g(response)f(from)h(man)o(y)e(in)j(the)f(\330MQ)g(community)e(w)
o(as)k(shock)d(and)h(horror)-5 b(.)18 b(People)i(felt)g(we)h(were)f
(being)f(lazy)396 4886 y(and)h(making)f(contrib)n(utors)f(w)o(ork)i
(harder)e(to)j(\002nd)f(the)g("right")f(repository)-5
b(.)18 b(Still,)j(this)g(seemed)e(simple,)h(and)g(indeed)396
4994 y(it)h(w)o(ork)o(ed)e(smoothly)-5 b(.)18 b(The)i(best)h(part)f(w)o
(as)h(that)f(we)h(each)e(w)o(ork)o(ed)g(as)i(we)g(w)o(anted)f(to.)g
(Whereas)g(before,)e(the)j(\330MQ)396 5102 y(repository)e(had)g(felt)i
(horribly)d(comple)o(x)g(\(and)i(it)h(w)o(asn')o(t)e(e)n(v)o(en)h(an)o
(ything)e(lik)o(e)i(git-\003o)n(w\),)f(this)i(felt)f(simple.)g(And)g
(it)p Black 3759 5569 a Ff(399)p Black eop end
%%Page: 400 413
TeXDict begin 400 412 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.400) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(w)o(ork)o(ed.)f(The)h(only)f(do)n(wnside)g(w)o(as)i
(that)g(we)f(lost)h(a)f(single)h(uni\002ed)e(history)-5
b(.)19 b(No)n(w)-5 b(,)19 b(perhaps)g(historians)h(will)h(feel)396
180 y(robbed,)d(b)n(ut)j(I)f(honestly)f(can')o(t)g(see)i(that)f(the)h
(historical)e(minutiae)h(of)g(who)f(changed)g(what,)h(when,)f
(including)f(e)n(v)o(ery)396 288 y(branch)h(and)h(e)o(xperiment,)d(are)
j(w)o(orth)g(an)o(y)f(signi\002cant)h(pain)g(or)g(friction.)-2
472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:5009) cvn /DEST pdfmark end
 -2 472 a 396
562 a Fk(People)g(ha)n(v)o(e)g(gotten)f(used)h(to)g(the)g("multiple)g
(repositories")f(approach)f(in)i(ZeroMQ)f(and)h(we')l(v)o(e)f(started)h
(using)g(that)396 670 y(in)h(other)e(projects)h(quite)f(successfully)-5
b(.)19 b(My)h(o)n(wn)g(opinion)e(is)k(that)e(history)f(will)i(judge)e
(git)i(branches)e(and)g(patterns)396 778 y(lik)o(e)i(git-\003o)n(w)e
(as)i(a)g(comple)o(x)d(solution)i(to)g(imaginary)e(problems)h
(inherited)g(from)g(the)h(days)g(of)g(Sub)o(v)o(ersion)e(and)396
886 y(monolithic)h(repositories.)-2 1070 y
SDict begin H.S end
 -2 1070 a
-2 1070 a
SDict begin 13 H.A end
 -2 1070 a -2 1070 a
SDict begin [/View [/XYZ H.V]/Dest (0:5010) cvn /DEST pdfmark end
 -2 1070 a 396 1160 a Fk(More)h
(profoundly)-5 b(,)16 b(and)k(perhaps)e(this)j(is)g(why)f(the)g
(majority)f(seems)i(to)f(be)g("wrong":)f(I)h(think)g(the)g(the)g
(branches)f(vs.)396 1268 y(forks)h(ar)o(gument)d(is)22
b(really)d(a)i(deeper)e(design)h(vs.)g(e)n(v)n(olv)o(e)f(ar)o(gument)f
(about)h(ho)n(w)h(to)g(mak)o(e)g(softw)o(are)g(optimally)-5
b(.)18 b(I')o(ll)396 1376 y(address)i(that)g(deeper)f(ar)o(gument)f(in)
i(the)h(ne)o(xt)e(section.)h(F)o(or)g(no)n(w)-5 b(,)19
b(I')o(ll)h(try)g(to)g(be)h(scienti\002c)f(about)f(my)h(irrational)f
(hate)396 1484 y(of)h(branches,)f(by)h(looking)e(at)j(a)f(number)f(of)h
(criteria,)f(and)h(compare)e(branches)h(and)h(forks)f(in)i(each)e(one.)
-2 1502 y
SDict begin H.S end
 -2 1502 a -2 1502 a
SDict begin 13 H.A end
 -2 1502 a -2 1502 a
SDict begin [/View [/XYZ H.V]/Dest (0:5011) cvn /DEST pdfmark end
 -2
1502 a 396 1812 a Fb(7.5.1.)36 b(Simplicity)f(vs.)f(Comple)n(xity)2166
1812 y
SDict begin H.S end
 2166 1812 a 2166 1812 a
SDict begin 18.72 H.A end
 2166 1812 a 2166 1812
a
SDict begin [/View [/XYZ H.V]/Dest (12.93.73.2) cvn /DEST pdfmark end
 2166 1812 a -2 2003 a
SDict begin H.S end
 -2 2003 a -2 2003 a
SDict begin 13 H.A end
 -2 2003 a
-2 2003 a
SDict begin [/View [/XYZ H.V]/Dest (0:5013) cvn /DEST pdfmark end
 -2 2003 a -2 2003 a
SDict begin H.S end
 -2 2003 a -2 2003 a
SDict begin 13 H.A end
 -2
2003 a -2 2003 a
SDict begin [/View [/XYZ H.V]/Dest (0:5014) cvn /DEST pdfmark end
 -2 2003 a 396 2086 a Ff(The)21 b(simpler)-9
b(,)20 b(the)g(better)-9 b(.)-2 2269 y
SDict begin H.S end
 -2 2269 a -2 2269
a
SDict begin 13 H.A end
 -2 2269 a -2 2269 a
SDict begin [/View [/XYZ H.V]/Dest (0:5015) cvn /DEST pdfmark end
 -2 2269 a 396 2360 a Fk(There)20
b(is)h(no)f(inherent)e(reason)i(branches)f(are)h(more)f(comple)o(x)g
(than)g(forks.)g(Ho)n(we)n(v)o(er)m(,)f(git-\003o)n(w)i(uses)3414
2360 y
SDict begin H.S end
 3414 2360 a 3414 2360 a
SDict begin 13 H.A end
 3414 2360 a 3414 2360
a
SDict begin [/View [/XYZ H.V]/Dest (0:5016) cvn /DEST pdfmark end
 3414 2360 a Ff(\002ve)g(types)g Fk(of)396 2468 y(branch,)f(whereas)g
(C4)i(uses)g(tw)o(o)f(types)g(of)g(fork)f(\(de)n(v)o(elopment,)e(and)j
(stable\))g(and)f(one)h(branch)f(\(master\).)396 2576
y(Circumstantial)h(e)n(vidence)f(is)i(thus)f(that)g(branches)f(lead)h
(to)g(more)g(comple)o(xity)e(than)i(forks.)f(F)o(or)h(ne)n(w)g(users,)g
(it)h(is)396 2684 y(de\002nitely)-5 b(,)19 b(and)h(we')l(v)o(e)f
(measured)g(this)h(in)h(practice,)e(easier)h(to)h(learn)f(to)g(w)o(ork)
f(with)i(man)o(y)e(repositories)g(and)h(no)396 2792 y(branches)f(e)o
(xcept)g(master)-5 b(.)-2 2820 y
SDict begin H.S end
 -2 2820 a -2 2820 a
SDict begin 13 H.A end

-2 2820 a -2 2820 a
SDict begin [/View [/XYZ H.V]/Dest (0:5017) cvn /DEST pdfmark end
 -2 2820 a 396 3130 a Fb(7.5.2.)36
b(Chang)q(e)e(Latenc)o(y)1650 3130 y
SDict begin H.S end
 1650 3130 a 1650
3130 a
SDict begin 18.72 H.A end
 1650 3130 a 1650 3130 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.74.2) cvn /DEST pdfmark end
 1650 3130 a -2 3323 a
SDict begin H.S end

-2 3323 a -2 3323 a
SDict begin 13 H.A end
 -2 3323 a -2 3323 a
SDict begin [/View [/XYZ H.V]/Dest (0:5019) cvn /DEST pdfmark end
 -2 3323 a -2
3323 a
SDict begin H.S end
 -2 3323 a -2 3323 a
SDict begin 13 H.A end
 -2 3323 a -2 3323 a
SDict begin [/View [/XYZ H.V]/Dest (0:5020) cvn /DEST pdfmark end
 -2 3323
a 396 3404 a Ff(The)21 b(smaller)f(and)g(mor)m(e)g(r)o(apid)f(the)i
(delivery)-5 b(,)20 b(the)g(better)-9 b(.)-2 3587 y
SDict begin H.S end
 -2
3587 a -2 3587 a
SDict begin 13 H.A end
 -2 3587 a -2 3587 a
SDict begin [/View [/XYZ H.V]/Dest (0:5021) cvn /DEST pdfmark end
 -2 3587 a 396 3678
a Fk(De)n(v)o(elopment)18 b(branches)h(seem)h(to)h(correlate)e
(strongly)g(with)h(lar)o(ge,)f(slo)n(w)-5 b(,)20 b(risk)o(y)f(deli)n(v)
o(eries.)g("Sorry)-5 b(,)19 b(I)h(ha)n(v)o(e)g(to)396
3786 y(mer)o(ge)f(this)i(branch)d(before)h(we)i(can)f(test)h(the)f(ne)n
(w)g(v)o(ersion")f(signals)h(a)h(breakdo)n(wn)c(in)k(process.)e(It')-5
b(s)21 b(certainly)e(not)396 3894 y(ho)n(w)h(C4)h(w)o(orks,)e(which)h
(is)h(by)f(focusing)e(tightly)i(on)g(indi)n(vidual)e(problems)h(and)h
(their)g(minimal)f(solutions.)396 4002 y(Allo)n(wing)h(branches)e(in)j
(de)n(v)o(elopment)c(raises)k(change)e(latenc)o(y)-5
b(.)18 b(F)o(orks)i(ha)n(v)o(e)g(a)g(dif)n(ferent)f(outcome:)g(it')-5
b(s)21 b(up)f(to)g(the)396 4110 y(fork)o(er)f(to)h(ensure)g(his)g
(changes)g(mer)o(ge)e(cleanly)-5 b(,)19 b(and)h(to)g(k)o(eep)g(them)g
(simple)g(so)g(the)o(y)g(w)o(on')o(t)f(be)h(rejected.)-2
4138 y
SDict begin H.S end
 -2 4138 a -2 4138 a
SDict begin 13 H.A end
 -2 4138 a -2 4138 a
SDict begin [/View [/XYZ H.V]/Dest (0:5022) cvn /DEST pdfmark end
 -2 4138
a 396 4448 a Fb(7.5.3.)36 b(Learning)e(Cur)q(ve)1606
4448 y
SDict begin H.S end
 1606 4448 a 1606 4448 a
SDict begin 18.72 H.A end
 1606 4448 a 1606 4448
a
SDict begin [/View [/XYZ H.V]/Dest (12.93.75.2) cvn /DEST pdfmark end
 1606 4448 a -2 4641 a
SDict begin H.S end
 -2 4641 a -2 4641 a
SDict begin 13 H.A end
 -2 4641 a
-2 4641 a
SDict begin [/View [/XYZ H.V]/Dest (0:5024) cvn /DEST pdfmark end
 -2 4641 a -2 4641 a
SDict begin H.S end
 -2 4641 a -2 4641 a
SDict begin 13 H.A end
 -2
4641 a -2 4641 a
SDict begin [/View [/XYZ H.V]/Dest (0:5025) cvn /DEST pdfmark end
 -2 4641 a 396 4722 a Ff(The)21 b(smoother)e(the)i
(learning)e(curve)o(,)h(the)g(better)-9 b(.)-2 4905 y
SDict begin H.S end

-2 4905 a -2 4905 a
SDict begin 13 H.A end
 -2 4905 a -2 4905 a
SDict begin [/View [/XYZ H.V]/Dest (0:5026) cvn /DEST pdfmark end
 -2 4905 a 396
4996 a Fk(Evidence)19 b(de\002nitely)g(sho)n(ws)i(that)f(learning)f(to)
h(use)g(git)h(branches)e(is)i(comple)o(x.)d(F)o(or)i(some)g(people)f
(this)i(is)g(OK.)f(F)o(or)396 5104 y(most)g(de)n(v)o(elopers,)e(e)n(v)o
(ery)h(c)o(ycle)h(spent)g(learning)f(git)h(is)h(a)g(c)o(ycle)f(lost)g
(on)g(more)f(producti)n(v)o(e)f(things.)h(I')l(v)o(e)g(been)h(told)p
Black 3759 5569 a Ff(400)p Black eop end
%%Page: 401 414
TeXDict begin 401 413 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.401) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(se)n(v)o(eral)g(times,)g(by)g(dif)n(ferent)f(people,)
f(that)j(I)f(do)g(not)g(lik)o(e)g(branches)f(because)g(I)i("ne)n(v)o
(er)e(properly)f(learned)h(git".)h(That)396 180 y(is)h(f)o(air)g(b)n
(ut)f(it)h(is)g(a)f(criticism)h(of)f(the)g(tool,)g(not)f(the)i(human.)
-2 203 y
SDict begin H.S end
 -2 203 a -2 203 a
SDict begin 13 H.A end
 -2 203 a -2 203 a
SDict begin [/View [/XYZ H.V]/Dest (0:5027) cvn /DEST pdfmark end
 -2 203 a
396 519 a Fb(7.5.4.)36 b(Cost)d(of)h(F)n(ailure)1563
519 y
SDict begin H.S end
 1563 519 a 1563 519 a
SDict begin 18.72 H.A end
 1563 519 a 1563 519 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.76.2) cvn /DEST pdfmark end
 1563
519 a -2 686 a
SDict begin H.S end
 -2 686 a -2 686 a
SDict begin 13 H.A end
 -2 686 a -2 686 a
SDict begin [/View [/XYZ H.V]/Dest (0:5029) cvn /DEST pdfmark end
 -2
686 a -2 686 a
SDict begin H.S end
 -2 686 a -2 686 a
SDict begin 13 H.A end
 -2 686 a -2 686 a
SDict begin [/View [/XYZ H.V]/Dest (0:5030) cvn /DEST pdfmark end
 -2
686 a 396 793 a Ff(The)21 b(lower)f(the)h(cost)f(of)g(failur)m(e)o(,)h
(the)f(better)-9 b(.)-2 976 y
SDict begin H.S end
 -2 976 a -2 976 a
SDict begin 13 H.A end
 -2 976
a -2 976 a
SDict begin [/View [/XYZ H.V]/Dest (0:5031) cvn /DEST pdfmark end
 -2 976 a 396 1067 a Fk(Branches)20 b(demand)f(more)g
(perfection)f(from)h(de)n(v)o(elopers)f(since)j(mistak)o(es)f
(potentially)f(af)n(fect)h(others.)f(This)i(raises)396
1175 y(the)f(cost)h(of)f(f)o(ailure.)f(F)o(orks)h(mak)o(e)g(f)o(ailure)
f(e)o(xtremely)g(cheap)g(since)h(literally)h(nothing)d(that)i(happens)f
(in)h(a)h(fork)e(can)396 1283 y(af)n(fect)h(others)g(not)f(using)h
(that)g(fork.)-2 1311 y
SDict begin H.S end
 -2 1311 a -2 1311 a
SDict begin 13 H.A end
 -2 1311 a
-2 1311 a
SDict begin [/View [/XYZ H.V]/Dest (0:5032) cvn /DEST pdfmark end
 -2 1311 a 396 1621 a Fb(7.5.5.)36 b(Upfr)n(ont)c(Coor)n
(dination)1932 1621 y
SDict begin H.S end
 1932 1621 a 1932 1621 a
SDict begin 18.72 H.A end
 1932 1621
a 1932 1621 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.77.2) cvn /DEST pdfmark end
 1932 1621 a -2 1812 a
SDict begin H.S end
 -2 1812 a -2 1812
a
SDict begin 13 H.A end
 -2 1812 a -2 1812 a
SDict begin [/View [/XYZ H.V]/Dest (0:5034) cvn /DEST pdfmark end
 -2 1812 a -2 1812 a
SDict begin H.S end
 -2 1812 a -2
1812 a
SDict begin 13 H.A end
 -2 1812 a -2 1812 a
SDict begin [/View [/XYZ H.V]/Dest (0:5035) cvn /DEST pdfmark end
 -2 1812 a 396 1895 a Ff(The)21
b(less)g(need)e(for)i(upfr)l(ont)e(coor)m(dination,)f(the)i(better)-9
b(.)-2 2078 y
SDict begin H.S end
 -2 2078 a -2 2078 a
SDict begin 13 H.A end
 -2 2078 a -2 2078 a
SDict begin [/View [/XYZ H.V]/Dest (0:5036) cvn /DEST pdfmark end

-2 2078 a 396 2169 a Fk(Y)g(ou)20 b(can)g(do)g(a)g(hostile)g(fork.)f(Y)
-9 b(ou)20 b(cannot)f(do)h(a)g(hostile)g(branch.)f(Branches)h(depend)e
(on)i(upfront)e(coordination,)396 2277 y(which)i(is)h(e)o(xpensi)n(v)o
(e)d(and)i(fragile.)f(One)h(person)f(can)h(v)o(eto)g(the)g(desires)g
(of)g(a)h(whole)e(group.)g(In)h(the)g(\330MQ)396 2385
y(community)e(for)i(e)o(xample)f(we)h(were)g(unable)f(to)i(agree)e(on)h
(a)h(git)f(branching)e(model)h(for)h(a)g(year)-5 b(.)20
b(W)-7 b(e)21 b(solv)o(ed)f(that)g(by)396 2493 y(using)g(forking)e
(instead.)i(The)g(problem)e(went)i(a)o(w)o(ay)-5 b(.)-2
2521 y
SDict begin H.S end
 -2 2521 a -2 2521 a
SDict begin 13 H.A end
 -2 2521 a -2 2521 a
SDict begin [/View [/XYZ H.V]/Dest (0:5037) cvn /DEST pdfmark end
 -2 2521
a 396 2831 a Fb(7.5.6.)36 b(Scalability)1318 2831 y
SDict begin H.S end
 1318
2831 a 1318 2831 a
SDict begin 18.72 H.A end
 1318 2831 a 1318 2831 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.78.2) cvn /DEST pdfmark end
 1318 2831
a -2 3022 a
SDict begin H.S end
 -2 3022 a -2 3022 a
SDict begin 13 H.A end
 -2 3022 a -2 3022 a
SDict begin [/View [/XYZ H.V]/Dest (0:5039) cvn /DEST pdfmark end
 -2
3022 a -2 3022 a
SDict begin H.S end
 -2 3022 a -2 3022 a
SDict begin 13 H.A end
 -2 3022 a -2 3022
a
SDict begin [/View [/XYZ H.V]/Dest (0:5040) cvn /DEST pdfmark end
 -2 3022 a 396 3105 a Ff(The)21 b(mor)m(e)f(you)f(can)h(scale)g(a)h
(pr)l(oject,)f(the)g(better)-9 b(.)-2 3288 y
SDict begin H.S end
 -2 3288
a -2 3288 a
SDict begin 13 H.A end
 -2 3288 a -2 3288 a
SDict begin [/View [/XYZ H.V]/Dest (0:5041) cvn /DEST pdfmark end
 -2 3288 a 396 3379 a
Fk(The)20 b(strong)f(assumption)g(in)i(all)g(branch)d(strate)o(gies)i
(is)h(that)g(the)f(repository)2643 3379 y
SDict begin H.S end
 2643 3379 a
2643 3379 a
SDict begin 13 H.A end
 2643 3379 a 2643 3379 a
SDict begin [/View [/XYZ H.V]/Dest (0:5042) cvn /DEST pdfmark end
 2643 3379 a Ff(is)h
Fk(the)g(project.)e(But)h(there)g(is)h(a)g(limit)g(to)396
3487 y(ho)n(w)e(man)o(y)f(people)h(you)f(can)i(get)f(in)h(agreement)d
(to)j(w)o(ork)f(together)f(in)i(one)f(repository)-5 b(.)17
b(As)j(I)f(e)o(xplained,)f(the)h(cost)h(of)396 3595 y(upfront)e
(coordination)g(can)i(become)f(f)o(atal.)h(A)h(more)e(realistic)i
(project)e(scales)i(by)f(allo)n(wing)f(an)o(yone)f(to)j(start)f(their)
396 3703 y(o)n(wn)g(repositories,)f(and)g(ensuring)g(these)h(can)g(w)o
(ork)g(together)-5 b(.)19 b(A)i(project)e(lik)o(e)h(\330MQ)h(has)f
(dozens)g(of)g(repositories.)396 3811 y(F)o(orking)f(looks)g(more)h
(scalable)g(than)g(branching.)-2 3839 y
SDict begin H.S end
 -2 3839 a -2
3839 a
SDict begin 13 H.A end
 -2 3839 a -2 3839 a
SDict begin [/View [/XYZ H.V]/Dest (0:5043) cvn /DEST pdfmark end
 -2 3839 a 396 4150 a Fb(7.5.7.)36
b(Surprise)d(and)h(Expectations)2235 4150 y
SDict begin H.S end
 2235 4150
a 2235 4150 a
SDict begin 18.72 H.A end
 2235 4150 a 2235 4150 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.79.2) cvn /DEST pdfmark end
 2235 4150 a -2
4340 a
SDict begin H.S end
 -2 4340 a -2 4340 a
SDict begin 13 H.A end
 -2 4340 a -2 4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:5045) cvn /DEST pdfmark end
 -2 4340
a -2 4340 a
SDict begin H.S end
 -2 4340 a -2 4340 a
SDict begin 13 H.A end
 -2 4340 a -2 4340 a
SDict begin [/View [/XYZ H.V]/Dest (0:5046) cvn /DEST pdfmark end
 -2
4340 a 396 4423 a Ff(The)21 b(less)g(surprising)o(,)f(the)g(better)-9
b(.)-2 4607 y
SDict begin H.S end
 -2 4607 a -2 4607 a
SDict begin 13 H.A end
 -2 4607 a -2 4607 a
SDict begin [/View [/XYZ H.V]/Dest (0:5047) cvn /DEST pdfmark end

-2 4607 a 396 4697 a Fk(People)20 b(e)o(xpect)f(branches)g(and)h
(\002nd)g(forks)f(to)h(be)g(uncommon)e(and)h(thus)i(confusing.)d(This)i
(is)h(the)f(one)g(aspect)g(where)396 4805 y(branches)f(win.)h(If)g(you)
f(use)i(branches,)d(a)j(single)f(patch)g(will)h(ha)n(v)o(e)e(the)h
(same)h(commit)e(hash)h(tag,)g(whereas)g(across)396 4913
y(forks)g(the)g(patch)f(will)i(ha)n(v)o(e)f(dif)n(ferent)e(hash)i
(tags.)h(That)f(mak)o(es)g(it)h(harder)d(to)j(track)e(patches)h(as)h
(the)o(y)f(cross)g(forks,)396 5021 y(true.)g(But)h(seriously)-5
b(,)1043 5021 y
SDict begin H.S end
 1043 5021 a 1043 5021 a
SDict begin 13 H.A end
 1043 5021 a 1043
5021 a
SDict begin [/View [/XYZ H.V]/Dest (0:5048) cvn /DEST pdfmark end
 1043 5021 a Ff(having)19 b(to)i(tr)o(ac)n(k)f(he)n(xadecimal)f
(hash)g(ta)o(gs)i(is)g(not)f(a)g(featur)m(e)p Fk(.)g(It')-5
b(s)20 b(a)h(b)n(ug.)e(Sometimes)h(better)396 5129 y(w)o(ays)h(of)f(w)o
(orking)e(just)j(are)f(surprising)f(at)i(\002rst.)-2
5158 y
SDict begin H.S end
 -2 5158 a -2 5158 a
SDict begin 13 H.A end
 -2 5158 a -2 5158 a
SDict begin [/View [/XYZ H.V]/Dest (0:5049) cvn /DEST pdfmark end
 -2 5158
a Black 3759 5569 a Ff(401)p Black eop end
%%Page: 402 415
TeXDict begin 402 414 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.402) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 77 a Fb(7.5.8.)36 b(Economics)f(of)e(P)l(ar)r(ticipation)2267
77 y
SDict begin H.S end
 2267 77 a 2267 77 a
SDict begin 18.72 H.A end
 2267 77 a 2267 77 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.80.2) cvn /DEST pdfmark end
 2267 77
a -2 267 a
SDict begin H.S end
 -2 267 a -2 267 a
SDict begin 13 H.A end
 -2 267 a -2 267 a
SDict begin [/View [/XYZ H.V]/Dest (0:5051) cvn /DEST pdfmark end
 -2 267
a -2 267 a
SDict begin H.S end
 -2 267 a -2 267 a
SDict begin 13 H.A end
 -2 267 a -2 267 a
SDict begin [/View [/XYZ H.V]/Dest (0:5052) cvn /DEST pdfmark end
 -2 267
a 396 351 a Ff(The)21 b(mor)m(e)f(tangible)f(the)h(r)m(e)o(war)m(ds,)g
(the)g(better)-9 b(.)-2 534 y
SDict begin H.S end
 -2 534 a -2 534 a
SDict begin 13 H.A end
 -2 534
a -2 534 a
SDict begin [/View [/XYZ H.V]/Dest (0:5053) cvn /DEST pdfmark end
 -2 534 a 396 625 a Fk(People)20 b(lik)o(e)g(to)h(o)n(wn)e
(their)h(w)o(ork,)g(and)f(get)i(credit)e(for)h(it.)h(This)f(is)h(much)e
(easier)i(with)f(forks)f(than)h(with)g(branches.)396
733 y(F)o(orks)g(create)g(more)f(competition,)f(in)j(a)f(healthy)f(w)o
(ay)-5 b(,)20 b(while)g(branches)f(suppress)g(competition)g(and)g
(force)h(people)396 840 y(to)h(collaborate)d(and)i(share)g(credit.)f
(This)i(sounds)e(positi)n(v)o(e)g(b)n(ut)i(in)f(my)g(e)o(xperience)e
(it)j(de-moti)n(v)n(ates)d(people.)h(A)396 948 y(branch)g(isn')o(t)h(a)
g(product)f(you)g(can)h("o)n(wn",)f(whereas)h(a)h(fork)e(can)h(be.)-2
977 y
SDict begin H.S end
 -2 977 a -2 977 a
SDict begin 13 H.A end
 -2 977 a -2 977 a
SDict begin [/View [/XYZ H.V]/Dest (0:5054) cvn /DEST pdfmark end
 -2 977 a 396
1287 a Fb(7.5.9.)36 b(Rob)n(ustness)f(in)e(Con\003ict)2027
1287 y
SDict begin H.S end
 2027 1287 a 2027 1287 a
SDict begin 18.72 H.A end
 2027 1287 a 2027 1287
a
SDict begin [/View [/XYZ H.V]/Dest (12.93.81.2) cvn /DEST pdfmark end
 2027 1287 a -2 1454 a
SDict begin H.S end
 -2 1454 a -2 1454 a
SDict begin 13 H.A end
 -2 1454 a
-2 1454 a
SDict begin [/View [/XYZ H.V]/Dest (0:5056) cvn /DEST pdfmark end
 -2 1454 a -2 1454 a
SDict begin H.S end
 -2 1454 a -2 1454 a
SDict begin 13 H.A end
 -2
1454 a -2 1454 a
SDict begin [/View [/XYZ H.V]/Dest (0:5057) cvn /DEST pdfmark end
 -2 1454 a 396 1561 a Ff(The)21 b(mor)m(e)f(a)g(model)g
(can)f(survive)i(con\003ict,)e(the)h(better)-9 b(.)-2
1744 y
SDict begin H.S end
 -2 1744 a -2 1744 a
SDict begin 13 H.A end
 -2 1744 a -2 1744 a
SDict begin [/View [/XYZ H.V]/Dest (0:5058) cvn /DEST pdfmark end
 -2 1744
a 396 1835 a Fk(Lik)o(e)20 b(it)h(or)f(not,)g(people)f(\002ght)h(o)o(v)
o(er)f(e)o(go,)g(status,)h(beliefs,)g(and)g(theories)g(of)f(the)i(w)o
(orld.)e(Challenge)g(is)j(a)e(necessary)396 1943 y(part)g(of)g
(science.)f(If)h(your)f(or)o(ganizational)d(model)k(depends)e(on)i
(agreement,)e(you)h(w)o(on')o(t)g(survi)n(v)o(e)f(the)i(\002rst)h(real)
f(\002ght.)396 2051 y(Branches)g(do)g(not)g(survi)n(v)o(e)e(real)j(ar)o
(guments)d(and)h(\002ghts.)h(Whereas)h(forks)e(can)h(be)g(hostile,)g
(and)g(still)h(bene\002t)f(all)396 2159 y(parties.)g(And)g(this)h(is)g
(indeed)e(ho)n(w)g(free)h(softw)o(are)g(w)o(orks.)-2
2187 y
SDict begin H.S end
 -2 2187 a -2 2187 a
SDict begin 13 H.A end
 -2 2187 a -2 2187 a
SDict begin [/View [/XYZ H.V]/Dest (0:5059) cvn /DEST pdfmark end
 -2 2187
a 396 2497 a Fb(7.5.10.)36 b(Guarantees)f(of)e(Isolation)2122
2497 y
SDict begin H.S end
 2122 2497 a 2122 2497 a
SDict begin 18.72 H.A end
 2122 2497 a 2122 2497
a
SDict begin [/View [/XYZ H.V]/Dest (12.93.82.2) cvn /DEST pdfmark end
 2122 2497 a -2 2665 a
SDict begin H.S end
 -2 2665 a -2 2665 a
SDict begin 13 H.A end
 -2 2665 a
-2 2665 a
SDict begin [/View [/XYZ H.V]/Dest (0:5061) cvn /DEST pdfmark end
 -2 2665 a -2 2665 a
SDict begin H.S end
 -2 2665 a -2 2665 a
SDict begin 13 H.A end
 -2
2665 a -2 2665 a
SDict begin [/View [/XYZ H.V]/Dest (0:5062) cvn /DEST pdfmark end
 -2 2665 a 396 2771 a Ff(The)21 b(str)l(ong)o(er)f(the)
g(isolation)g(between)g(pr)l(oduction)e(code)h(and)h(e)n(xperiment,)f
(the)i(better)-9 b(.)-2 2954 y
SDict begin H.S end
 -2 2954 a -2 2954 a
SDict begin 13 H.A end
 -2
2954 a -2 2954 a
SDict begin [/View [/XYZ H.V]/Dest (0:5063) cvn /DEST pdfmark end
 -2 2954 a 396 3045 a Fk(People)20 b(mak)o(e)g(mistak)o
(es.)g(I')l(v)o(e)f(seen)h(e)o(xperimental)e(code)i(pushed)f(to)h
(mainline)f(production)f(by)i(error)-5 b(.)19 b(I')l(v)o(e)g(seen)396
3153 y(people)g(mak)o(e)h(bad)g(panic)f(changes)g(under)g(stress.)i
(But)g(the)f(real)g(f)o(ault)g(is)i(in)e(allo)n(wing)f(tw)o(o)i
(entirely)e(separate)396 3261 y(generations)g(of)h(product)e(to)i(e)o
(xist)h(in)f(the)g(same)h(protected)d(space.)i(If)g(you)g(can)g(push)f
(to)h(random-branch-x)c(you)j(can)396 3369 y(push)h(to)g(master)-5
b(.)20 b(Branches)g(do)g(not)g(guarantee)e(isolation)i(of)g(production)
d(critical)k(code.)e(F)o(orks)h(do.)-2 3397 y
SDict begin H.S end
 -2 3397
a -2 3397 a
SDict begin 13 H.A end
 -2 3397 a -2 3397 a
SDict begin [/View [/XYZ H.V]/Dest (0:5064) cvn /DEST pdfmark end
 -2 3397 a 396 3707 a
Fb(7.5.11.)36 b(Visibility)1285 3707 y
SDict begin H.S end
 1285 3707 a 1285
3707 a
SDict begin 18.72 H.A end
 1285 3707 a 1285 3707 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.83.2) cvn /DEST pdfmark end
 1285 3707 a -2 3898 a
SDict begin H.S end

-2 3898 a -2 3898 a
SDict begin 13 H.A end
 -2 3898 a -2 3898 a
SDict begin [/View [/XYZ H.V]/Dest (0:5066) cvn /DEST pdfmark end
 -2 3898 a -2
3898 a
SDict begin H.S end
 -2 3898 a -2 3898 a
SDict begin 13 H.A end
 -2 3898 a -2 3898 a
SDict begin [/View [/XYZ H.V]/Dest (0:5067) cvn /DEST pdfmark end
 -2 3898
a 396 3981 a Ff(The)21 b(mor)m(e)f(visible)g(our)g(work,)h(the)f
(better)-9 b(.)-2 4158 y
SDict begin H.S end
 -2 4158 a -2 4158 a
SDict begin 13 H.A end
 -2 4158
a -2 4158 a
SDict begin [/View [/XYZ H.V]/Dest (0:5068) cvn /DEST pdfmark end
 -2 4158 a 396 4255 a Fk(F)o(orks)20 b(ha)n(v)o(e)f(w)o
(atchers,)h(issues,)h(a)g(README,)f(a)g(wiki.)g(Branches)g(ha)n(v)o(e)g
(none)f(of)h(these.)g(People)g(try)g(forks,)f(b)n(uild)396
4363 y(them,)h(break)f(them,)h(patch)f(them.)h(Branches)f(sit)j(there)d
(until)h(someone)f(remembers)g(to)h(w)o(ork)g(on)f(them.)h(F)o(orks)g
(ha)n(v)o(e)396 4471 y(do)n(wnloads)f(and)g(tarballs.)h(Branches)g(do)g
(not.)f(When)h(we)h(look)e(for)h(self-or)o(ganization,)c(the)k(more)g
(visible)g(and)396 4579 y(declarati)n(v)o(e)f(the)h(problems,)f(the)h
(f)o(aster)g(and)g(more)f(accurately)g(we)i(can)f(w)o(ork.)-2
4607 y
SDict begin H.S end
 -2 4607 a -2 4607 a
SDict begin 13 H.A end
 -2 4607 a -2 4607 a
SDict begin [/View [/XYZ H.V]/Dest (0:5069) cvn /DEST pdfmark end
 -2 4607
a Black 3759 5569 a Ff(402)p Black eop end
%%Page: 403 416
TeXDict begin 403 415 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.403) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 77 a Fb(7.5.12.)36 b(Conc)n(lusions)1508 77
y
SDict begin H.S end
 1508 77 a 1508 77 a
SDict begin 18.72 H.A end
 1508 77 a 1508 77 a
SDict begin [/View [/XYZ H.V]/Dest (12.93.84.2) cvn /DEST pdfmark end
 1508 77 a -2
244 a
SDict begin H.S end
 -2 244 a -2 244 a
SDict begin 13 H.A end
 -2 244 a -2 244 a
SDict begin [/View [/XYZ H.V]/Dest (0:5071) cvn /DEST pdfmark end
 -2 244 a 396
351 a Fk(In)20 b(this)h(section)f(I')l(v)o(e)f(listed)i(a)f(series)h
(of)f(ar)o(guments,)e(most)i(of)g(which)g(came)f(from)h(fello)n(w)f
(team)i(members.)d(Here')-5 b(s)396 459 y(ho)n(w)20 b(it)h(seems)f(to)h
(break)e(do)n(wn:)g(git)i(v)o(eterans)e(insist)i(that)f(branches)f(are)
h(the)g(w)o(ay)h(to)f(w)o(ork,)f(whereas)h(ne)n(wcomers)396
566 y(tend)g(to)g(feel)h(intimidated)e(when)g(ask)o(ed)h(to)g(na)n
(vigate)f(git)i(branches.)d(Git)j(is)g(not)f(an)g(easy)h(tool)f(to)g
(master)-5 b(.)20 b(What)396 674 y(we')l(v)o(e)f(disco)o(v)o(ered,)f
(accidentally)-5 b(,)18 b(is)k(that)e(when)f(you)h(stop)g(using)f
(branches)2693 674 y
SDict begin H.S end
 2693 674 a 2693 674 a
SDict begin 13 H.A end
 2693 674 a
2693 674 a
SDict begin [/View [/XYZ H.V]/Dest (0:5072) cvn /DEST pdfmark end
 2693 674 a Ff(at)i(all)p Fk(,)f(git)g(becomes)g(tri)n(vial)g
(to)g(use.)g(It)396 782 y(literally)g(comes)g(do)n(wn)f(to)i(six)f
(commands)f(\(clone,)g(remote,)g(commit,)g(log,)h(push,)f(and)h
(pull\).)f(Furthermore,)f(a)396 890 y(branch-free)g(process)h(actually)
h(w)o(orks,)g(we')l(v)o(e)f(used)h(it)h(for)e(a)i(couple)e(of)h(years)g
(no)n(w)-5 b(,)19 b(and)g(no)h(visible)g(do)n(wnside)396
998 y(e)o(xcept)f(surprise)h(to)g(the)h(v)o(eterans,)e(and)g(gro)n(wth)
g(of)h("single")g(projects)f(o)o(v)o(er)g(multiple)h(repositories.)-2
1182 y
SDict begin H.S end
 -2 1182 a -2 1182 a
SDict begin 13 H.A end
 -2 1182 a -2 1182 a
SDict begin [/View [/XYZ H.V]/Dest (0:5073) cvn /DEST pdfmark end
 -2 1182
a 396 1272 a Fk(If)g(you)g(can')o(t)f(use)h(forks,)f(perhaps)g(because)
h(your)f(\002rm)h(doesn')o(t)f(trust)h(github')-5 b(s)19
b(pri)n(v)n(ate)g(repositories,)g(then)h(you)396 1380
y(perhaps)f(topic)h(branches)f(\(one)g(per)h(issue\))g(will)h(w)o(ork.)
f(Y)-9 b(ou')o(ll)19 b(still)i(suf)n(fer)f(the)g(costs)h(of)f(getting)f
(upfront)396 1488 y(consensus,)g(lo)n(w)i(competiti)n(v)o(eness,)d(and)
h(risk)i(of)f(human)e(error)-5 b(.)-2 1599 y
SDict begin H.S end
 -2 1599
a -2 1599 a
SDict begin 13 H.A end
 -2 1599 a -2 1599 a
SDict begin [/View [/XYZ H.V]/Dest (0:5074) cvn /DEST pdfmark end
 -2 1599 a 360 x Fn(7.6.)39
b(The)g(Myth)f(of)i(Intellig)q(ent)e(Design)2321 1959
y
SDict begin H.S end
 2321 1959 a 2321 1959 a
SDict begin 22.464 H.A end
 2321 1959 a 2321 1959 a
SDict begin [/View [/XYZ H.V]/Dest (12.94.1) cvn /DEST pdfmark end
 2321
1959 a -2 2157 a
SDict begin H.S end
 -2 2157 a -2 2157 a
SDict begin 13 H.A end
 -2 2157 a -2 2157
a
SDict begin [/View [/XYZ H.V]/Dest (0:5076) cvn /DEST pdfmark end
 -2 2157 a 396 2233 a Fk(The)20 b(dominant)f(theory)f(of)i(design)g
(is)h(that)f(you)g(tak)o(e)g(smart,)g(creati)n(v)o(e)f(people)g(and)h
(mone)o(y)-5 b(,)18 b(and)h(produce)f(amazing)396 2340
y(products.)h(The)h(smarter)f(the)h(people,)f(the)i(better)e(the)i
(results.)f(I'm)f(going)g(to)i(claim)f(that)g(theory)f(is)i(bogus,)e(a)
i(myth)396 2448 y(based)f(on)g(magical)f(thinking)g(that)h(treats)h
(the)f("in)m(v)o(ention")e(as)j(a)f(product)f(of)g(indi)n(vidual)g("in)
m(v)o(entor")f(minds.)h(As)i(an)396 2556 y(alternati)n(v)o(e)e(I')o(ll)
i(present)e(the)h(Theory)f(of)h(Heuristic)g(Inno)o(v)n(ation,)d(which)i
(states)j(roughly)c(that)i(we)g(do)g(not)g(in)m(v)o(ent)396
2664 y(solutions,)g(we)g(disco)o(v)o(er)f(them,)g(and)h(that)g(disco)o
(v)o(ery)e(process)i(can)g(be)g(highly)f(automated.)-2
2848 y
SDict begin H.S end
 -2 2848 a -2 2848 a
SDict begin 13 H.A end
 -2 2848 a -2 2848 a
SDict begin [/View [/XYZ H.V]/Dest (0:5077) cvn /DEST pdfmark end
 -2 2848
a 396 2938 a Fk(Presenting)h(\330MQ)g(at)h(the)f(Mix-IT)f(conference)f
(in)i(L)-5 b(yon)20 b(in)g(early)g(2012,)e(I)j(w)o(as)g(ask)o(ed)f(se)n
(v)o(eral)f(times)i(for)f(the)396 3046 y("road-map".)c(My)i(answer)h(w)
o(as,)g(There)e(is)j(no)e(road-map,)e(and)i(road-maps)e(are)j(bad)f
(for)g(se)n(v)o(eral)g(reasons.)f(First,)i(the)o(y)396
3154 y(mak)o(e)h(promises)g(we)g(can)g(rarely)f(k)o(eep,)h(which)g
(causes)g(problems)f(for)g(our)h(users.)g(Second,)f(the)o(y)g(claim)h
(territory)396 3262 y(and)g(mak)o(e)g(it)h(harder)d(for)i(others)g(to)g
(participate.)f(Lastly)-5 b(,)20 b(the)o(y)f(preempt)g(the)h(thinking)f
(process)g(of)h(the)g(community)-5 b(.)396 3370 y(The)20
b(audience)f(didn')o(t)g(really)g(lik)o(e)i(my)f(answer)-5
b(.)20 b(So)g(un-French.)e(Softw)o(are)h(engineers)g(don')o(t)g(lik)o
(e)h(the)h(notion)e(that)396 3478 y(po)n(werful,)f(ef)n(fecti)n(v)o(e)h
(solutions)h(can)g(come)f(into)h(e)o(xistence)g(without)f(an)h
(intelligent)g(designer)f(acti)n(v)o(ely)g(thinking)396
3586 y(things)h(through.)e(And)h(yet)h(no-one)f(in)h(that)g(room)f(w)o
(ould)g(question)g(e)n(v)n(olution.)g(A)h(strange)g(iron)o(y)-5
b(,)18 b(and)h(one)h(I)g(w)o(anted)396 3694 y(to)h(e)o(xplore)d
(further)h(as)i(it)g(underpins)d(the)i(direction)f(the)h(\330MQ)h
(community)d(has)i(tak)o(en)g(o)o(v)o(er)e(the)j(last)g(year)e(or)h
(so.)-2 3878 y
SDict begin H.S end
 -2 3878 a -2 3878 a
SDict begin 13 H.A end
 -2 3878 a -2 3878
a
SDict begin [/View [/XYZ H.V]/Dest (0:5078) cvn /DEST pdfmark end
 -2 3878 a 396 3968 a Fk(In)g(the)g(dominant)f(theory)-5
b(,)18 b(brilliant)i(indi)n(viduals)e(re\003ect)j(on)e(lar)o(ge)h
(problem)e(sets)j(and)f(then)g(carefully)f(and)g(precisely)396
4076 y(create)h(a)h(solution.)e(Sometimes)h(the)o(y)f(will)i(ha)n(v)o
(e)f("eureka")e(moments)i(where)f(the)o(y)h("get")g(brilliantly)f
(simple)396 4184 y(answers)h(to)h(whole)e(lar)o(ge)h(problem)e(sets.)j
(The)f(in)m(v)o(entor)m(,)d(and)j(the)g(process)g(of)g(in)m(v)o(ention)
e(are)i(rare,)f(precious,)g(and)396 4291 y(can)h(command)e(a)j
(monopoly)-5 b(.)17 b(History)j(is)h(full)f(of)g(such)g(heroic)f(indi)n
(viduals.)f(W)-7 b(e)22 b(o)n(we)e(them)g(our)f(modern)f(w)o(orld.)-2
4475 y
SDict begin H.S end
 -2 4475 a -2 4475 a
SDict begin 13 H.A end
 -2 4475 a -2 4475 a
SDict begin [/View [/XYZ H.V]/Dest (0:5079) cvn /DEST pdfmark end
 -2 4475
a 396 4565 a Fk(Looking)g(closer)m(,)i(ho)n(we)n(v)o(er)m(,)d(the)k(f)o
(acts)f(don')o(t)f(match.)g(History)h(doesn')o(t)f(sho)n(w)h(lone)f(in)
m(v)o(entors.)f(It)j(sho)n(ws)f(luck)o(y)396 4673 y(people)f(who)h
(steal)g(or)g(claim)g(o)n(wnership)f(of)g(ideas)i(that)f(are)g(being)f
(w)o(ork)o(ed)g(on)g(by)h(man)o(y)-5 b(.)18 b(It)i(sho)n(ws)g
(brilliant)g(people)396 4781 y(striking)g(luck)o(y)f(once,)g(and)h
(then)f(spending)g(decades)g(on)h(fruitless)g(and)g(pointless)g
(quests.)g(The)g(best)g(kno)n(wn)396 4889 y(lar)o(ge-scale)f(in)m(v)o
(entors)f(lik)o(e)j(Thomas)e(Edison)g(were)h(in)h(f)o(act)f(just)h(v)o
(ery)e(good)g(at)h(systematic)h(broad)d(research)i(done)396
4997 y(by)g(lar)o(ge)f(teams.)h(It')-5 b(s)21 b(lik)o(e)g(claiming)e
(that)h(Ste)n(v)o(e)g(Jobs)h(in)m(v)o(ented)d(e)n(v)o(ery)h(de)n(vice)g
(made)h(by)f(Apple.)h(It)g(is)h(a)g(nice)f(myth,)396
5105 y(good)f(for)h(mark)o(eting,)e(b)n(ut)i(utterly)g(useless)h(as)g
(practical)e(science.)p Black 3759 5569 a Ff(403)p Black
eop end
%%Page: 404 417
TeXDict begin 404 416 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.404) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5080) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(Recent)h(history)-5 b(,)18 b(much)i(better)f
(documented)f(and)i(less)h(easy)f(to)g(manipulate,)f(sho)n(ws)h(this)h
(well.)f(The)g(Internet)f(is)396 180 y(surely)h(one)g(of)f(the)i(most)f
(inno)o(v)n(ati)n(v)o(e)e(and)h(f)o(ast-mo)o(ving)f(areas)i(of)g
(technology)-5 b(,)17 b(and)j(one)g(of)g(the)g(best)g(documented.)396
288 y(It)h(has)f(no)g(in)m(v)o(entor)-5 b(.)18 b(Instead)i(it)g(has)h
(a)g(massi)n(v)o(e)e(economy)g(of)g(people)h(who)f(ha)n(v)o(e)h
(carefully)f(and)g(progressi)n(v)o(ely)396 396 y(solv)o(ed)h(a)g(long)g
(series)g(of)g(immediate)g(problems,)e(documented)g(their)i(answers,)f
(and)h(made)g(those)g(a)n(v)n(ailable)f(to)i(all.)396
504 y(The)f(inno)o(v)n(ati)n(v)o(e)e(nature)h(of)h(the)g(Internet)f
(comes)h(not)g(from)f(a)i(small,)f(select)h(band)e(of)h(Einsteins.)g
(It)g(comes)g(from)396 612 y(RFCs)i(an)o(yone)d(can)g(use)i(and)f
(impro)o(v)o(e,)d(made)j(by)g(hundreds)e(and)h(thousands)g(of)h(smart,)
g(b)n(ut)g(not)g(uniquely)f(smart,)396 720 y(indi)n(viduals.)g(It)h
(comes)g(from)f(open)g(source)h(softw)o(are)g(an)o(yone)e(can)i(use)g
(and)g(impro)o(v)o(e.)e(It)i(comes)g(from)f(sharing,)396
828 y(scale)i(of)f(community)-5 b(,)17 b(and)j(the)g(continuous)e
(accretion)h(of)h(good)f(solutions)h(and)f(disposal)h(of)g(bad)g(ones.)
-2 1012 y
SDict begin H.S end
 -2 1012 a -2 1012 a
SDict begin 13 H.A end
 -2 1012 a -2 1012 a
SDict begin [/View [/XYZ H.V]/Dest (0:5081) cvn /DEST pdfmark end
 -2
1012 a 396 1102 a Fk(Here)g(thus)g(is)i(my)d("Theory)g(of)h(Heuristic)g
(Inno)o(v)n(ation":)-2 1120 y
SDict begin H.S end
 -2 1120 a -2 1120 a
SDict begin 13 H.A end
 -2
1120 a -2 1120 a
SDict begin [/View [/XYZ H.V]/Dest (0:5082) cvn /DEST pdfmark end
 -2 1120 a -2 1130 a
SDict begin H.S end
 -2 1130 a -2 1130
a
SDict begin 13 H.A end
 -2 1130 a -2 1130 a
SDict begin [/View [/XYZ H.V]/Dest (0:5083) cvn /DEST pdfmark end
 -2 1130 a Black 463 1272 a Fk(1.)p
Black 546 1272 a
SDict begin H.S end
 546 1272 a 546 1272 a
SDict begin 13 H.A end
 546 1272 a 546
1272 a
SDict begin [/View [/XYZ H.V]/Dest (0:5084) cvn /DEST pdfmark end
 546 1272 a Fk(There)f(is)i(an)f(in\002nite)g(problem/solution)d
(terrain.)-2 1290 y
SDict begin H.S end
 -2 1290 a -2 1290 a
SDict begin 13 H.A end
 -2 1290 a -2
1290 a
SDict begin [/View [/XYZ H.V]/Dest (0:5085) cvn /DEST pdfmark end
 -2 1290 a Black 463 1422 a Fk(2.)p Black 546 1422
a
SDict begin H.S end
 546 1422 a 546 1422 a
SDict begin 13 H.A end
 546 1422 a 546 1422 a
SDict begin [/View [/XYZ H.V]/Dest (0:5086) cvn /DEST pdfmark end
 546 1422
a Fk(This)j(terrain)g(changes)f(o)o(v)o(er)f(time)j(according)d(to)i(e)
o(xternal)f(conditions.)-2 1440 y
SDict begin H.S end
 -2 1440 a -2 1440 a
SDict begin 13 H.A end

-2 1440 a -2 1440 a
SDict begin [/View [/XYZ H.V]/Dest (0:5087) cvn /DEST pdfmark end
 -2 1440 a Black 463 1571 a Fk(3.)p
Black 546 1571 a
SDict begin H.S end
 546 1571 a 546 1571 a
SDict begin 13 H.A end
 546 1571 a 546
1571 a
SDict begin [/View [/XYZ H.V]/Dest (0:5088) cvn /DEST pdfmark end
 546 1571 a Fk(W)-7 b(e)21 b(can)f(only)f(accurately)g(percei)n
(v)o(e)g(problems)g(we)h(are)g(close)h(to.)-2 1589 y
SDict begin H.S end

-2 1589 a -2 1589 a
SDict begin 13 H.A end
 -2 1589 a -2 1589 a
SDict begin [/View [/XYZ H.V]/Dest (0:5089) cvn /DEST pdfmark end
 -2 1589 a Black
463 1720 a Fk(4.)p Black 546 1720 a
SDict begin H.S end
 546 1720 a 546 1720
a
SDict begin 13 H.A end
 546 1720 a 546 1720 a
SDict begin [/View [/XYZ H.V]/Dest (0:5090) cvn /DEST pdfmark end
 546 1720 a Fk(W)-7 b(e)21 b(can)f(rank)f(the)i
(cost/bene\002t)e(economics)g(of)h(problems)f(using)g(a)i(mark)o(et)e
(for)h(solutions.)-2 1738 y
SDict begin H.S end
 -2 1738 a -2 1738 a
SDict begin 13 H.A end
 -2 1738
a -2 1738 a
SDict begin [/View [/XYZ H.V]/Dest (0:5091) cvn /DEST pdfmark end
 -2 1738 a Black 463 1870 a Fk(5.)p Black
546 1870 a
SDict begin H.S end
 546 1870 a 546 1870 a
SDict begin 13 H.A end
 546 1870 a 546 1870
a
SDict begin [/View [/XYZ H.V]/Dest (0:5092) cvn /DEST pdfmark end
 546 1870 a Fk(There)f(is)i(an)f(optimal)g(solution)f(to)h(an)o(y)g
(solv)n(able)f(problem.)-2 1888 y
SDict begin H.S end
 -2 1888 a -2 1888 a
SDict begin 13 H.A end

-2 1888 a -2 1888 a
SDict begin [/View [/XYZ H.V]/Dest (0:5093) cvn /DEST pdfmark end
 -2 1888 a Black 463 2019 a Fk(6.)p
Black 546 2019 a
SDict begin H.S end
 546 2019 a 546 2019 a
SDict begin 13 H.A end
 546 2019 a 546
2019 a
SDict begin [/View [/XYZ H.V]/Dest (0:5094) cvn /DEST pdfmark end
 546 2019 a Fk(W)-7 b(e)21 b(can)f(approach)e(this)j(optimal)e
(solution)h(heuristically)-5 b(,)18 b(and)i(mechanically)-5
b(.)-2 2037 y
SDict begin H.S end
 -2 2037 a -2 2037 a
SDict begin 13 H.A end
 -2 2037 a -2 2037 a
SDict begin [/View [/XYZ H.V]/Dest (0:5095) cvn /DEST pdfmark end

-2 2037 a Black 463 2169 a Fk(7.)p Black 546 2169 a
SDict begin H.S end
 546
2169 a 546 2169 a
SDict begin 13 H.A end
 546 2169 a 546 2169 a
SDict begin [/View [/XYZ H.V]/Dest (0:5096) cvn /DEST pdfmark end
 546 2169 a Fk(Our)20
b(intelligence)f(can)h(mak)o(e)f(this)i(process)f(f)o(aster)g(b)n(ut)g
(does)g(not)g(replace)g(it.)-2 2353 y
SDict begin H.S end
 -2 2353 a -2 2353
a
SDict begin 13 H.A end
 -2 2353 a -2 2353 a
SDict begin [/View [/XYZ H.V]/Dest (0:5097) cvn /DEST pdfmark end
 -2 2353 a 396 2443 a Fk(It')-5
b(s)21 b(an)f(approximation.)d(Feel)k(free)f(to)g(send)g(me)g(patches.)
f(There)h(are)g(a)h(fe)n(w)f(tak)o(ea)o(w)o(ays)f(from)g(this:)-2
2461 y
SDict begin H.S end
 -2 2461 a -2 2461 a
SDict begin 13 H.A end
 -2 2461 a -2 2461 a
SDict begin [/View [/XYZ H.V]/Dest (0:5098) cvn /DEST pdfmark end
 -2 2461
a -2 2471 a
SDict begin H.S end
 -2 2471 a -2 2471 a
SDict begin 13 H.A end
 -2 2471 a -2 2471 a
SDict begin [/View [/XYZ H.V]/Dest (0:5099) cvn /DEST pdfmark end
 -2
2471 a Black 396 2613 a Fj(\225)p Black 479 2613 a
SDict begin H.S end
 479
2613 a 479 2613 a
SDict begin 13 H.A end
 479 2613 a 479 2613 a
SDict begin [/View [/XYZ H.V]/Dest (0:5100) cvn /DEST pdfmark end
 479 2613 a 479
2613 a
SDict begin H.S end
 479 2613 a 479 2613 a
SDict begin 13 H.A end
 479 2613 a 479 2613 a
SDict begin [/View [/XYZ H.V]/Dest (0:5101) cvn /DEST pdfmark end
 479
2613 a Ff(Individual)f(cr)m(eativity)j(matter)o(s)g(less)g(than)e(pr)l
(ocess.)i Fk(Smarter)e(people)g(may)h(w)o(ork)g(f)o(aster)g(b)n(ut)g
(the)o(y)g(may)f(w)o(ork)h(in)479 2721 y(the)g(wrong)f(direction.)g
(It')-5 b(s)21 b(the)f(collecti)n(v)o(e)f(vision)h(of)g(reality)g(that)
g(k)o(eeps)g(us)h(honest)e(and)h(rele)n(v)n(ant.)-2 2739
y
SDict begin H.S end
 -2 2739 a -2 2739 a
SDict begin 13 H.A end
 -2 2739 a -2 2739 a
SDict begin [/View [/XYZ H.V]/Dest (0:5102) cvn /DEST pdfmark end
 -2 2739 a Black
396 2870 a Fj(\225)p Black 479 2870 a
SDict begin H.S end
 479 2870 a 479
2870 a
SDict begin 13 H.A end
 479 2870 a 479 2870 a
SDict begin [/View [/XYZ H.V]/Dest (0:5103) cvn /DEST pdfmark end
 479 2870 a 479 2870 a
SDict begin H.S end
 479
2870 a 479 2870 a
SDict begin 13 H.A end
 479 2870 a 479 2870 a
SDict begin [/View [/XYZ H.V]/Dest (0:5104) cvn /DEST pdfmark end
 479 2870 a Ff(W)-8
b(e)21 b(don')n(t)e(need)g(r)l(oad-maps)g(if)i(we)g(have)f(a)g(good)f
(pr)l(ocess.)h Fk(Functionality)f(will)i(emer)o(ge)d(and)i(e)n(v)n(olv)
o(e)f(o)o(v)o(er)g(time)479 2978 y(as)i(solutions)f(compete)f(for)g
(mark)o(et)h(share.)-2 2996 y
SDict begin H.S end
 -2 2996 a -2 2996 a
SDict begin 13 H.A end
 -2
2996 a -2 2996 a
SDict begin [/View [/XYZ H.V]/Dest (0:5105) cvn /DEST pdfmark end
 -2 2996 a Black 396 3128 a Fj(\225)p
Black 479 3128 a
SDict begin H.S end
 479 3128 a 479 3128 a
SDict begin 13 H.A end
 479 3128 a 479
3128 a
SDict begin [/View [/XYZ H.V]/Dest (0:5106) cvn /DEST pdfmark end
 479 3128 a 479 3128 a
SDict begin H.S end
 479 3128 a 479 3128 a
SDict begin 13 H.A end
 479
3128 a 479 3128 a
SDict begin [/View [/XYZ H.V]/Dest (0:5107) cvn /DEST pdfmark end
 479 3128 a Ff(W)-8 b(e)21 b(don')n(t)e(in)m(vent)g
(solutions,)h(so)g(muc)o(h)g(as)g(disco)o(ver)g(them.)g
Fk(All)h(sympathies)e(to)i(the)f(creati)n(v)o(e)f(soul.)h(It')-5
b(s)21 b(just)g(an)479 3236 y(information)d(processing)h(machine)g
(that)h(lik)o(es)h(to)f(polish)g(its)h(o)n(wn)f(e)o(go)f(and)h(collect)
g(karma.)-2 3254 y
SDict begin H.S end
 -2 3254 a -2 3254 a
SDict begin 13 H.A end
 -2 3254 a -2 3254
a
SDict begin [/View [/XYZ H.V]/Dest (0:5108) cvn /DEST pdfmark end
 -2 3254 a Black 396 3385 a Fj(\225)p Black 479 3385
a
SDict begin H.S end
 479 3385 a 479 3385 a
SDict begin 13 H.A end
 479 3385 a 479 3385 a
SDict begin [/View [/XYZ H.V]/Dest (0:5109) cvn /DEST pdfmark end
 479 3385
a 479 3385 a
SDict begin H.S end
 479 3385 a 479 3385 a
SDict begin 13 H.A end
 479 3385 a 479 3385
a
SDict begin [/View [/XYZ H.V]/Dest (0:5110) cvn /DEST pdfmark end
 479 3385 a Ff(Intellig)o(ence)f(is)i(a)g(social)f(ef)o(fect,)f
(though)g(it)i(feels)g(per)o(sonal.)e Fk(A)i(person)e(cut-of)n(f)f
(from)h(others)h(e)n(v)o(entually)e(stops)479 3493 y(thinking.)h(W)-7
b(e)21 b(can)f(neither)f(collect)h(problems)f(nor)h(measure)f
(solutions)h(without)f(other)g(people.)-2 3511 y
SDict begin H.S end
 -2 3511
a -2 3511 a
SDict begin 13 H.A end
 -2 3511 a -2 3511 a
SDict begin [/View [/XYZ H.V]/Dest (0:5111) cvn /DEST pdfmark end
 -2 3511 a Black 396 3642
a Fj(\225)p Black 479 3642 a
SDict begin H.S end
 479 3642 a 479 3642 a
SDict begin 13 H.A end
 479
3642 a 479 3642 a
SDict begin [/View [/XYZ H.V]/Dest (0:5112) cvn /DEST pdfmark end
 479 3642 a 479 3642 a
SDict begin H.S end
 479 3642 a 479
3642 a
SDict begin 13 H.A end
 479 3642 a 479 3642 a
SDict begin [/View [/XYZ H.V]/Dest (0:5113) cvn /DEST pdfmark end
 479 3642 a Ff(The)i(size)g(and)e(diver)o
(sity)i(of)f(the)h(community)e(is)i(a)f(k)o(e)n(y)g(factor)-9
b(.)20 b Fk(Lar)o(ger)m(,)e(more)h(di)n(v)o(erse)g(communities)g
(collect)h(more)479 3750 y(rele)n(v)n(ant)f(problems,)g(and)g(solv)o(e)
h(them)g(more)f(accurately)-5 b(,)19 b(and)g(do)h(this)h(f)o(aster)m(,)
f(than)f(a)i(small)g(e)o(xpert)d(group.)-2 3934 y
SDict begin H.S end
 -2
3934 a -2 3934 a
SDict begin 13 H.A end
 -2 3934 a -2 3934 a
SDict begin [/View [/XYZ H.V]/Dest (0:5114) cvn /DEST pdfmark end
 -2 3934 a 396 4024
a Fk(People)i(ha)n(v)o(e)g(pointed)e(out)i(that)h(hill-climbing)d
(algorithms)h(\(what)h(this)g(is,)h(essentially\))f(ha)n(v)o(e)g(kno)n
(wn)e(limitations.)396 4132 y(One)i(gets)h(stuck)f(on)g(local)g(peaks,)
f(mainly)-5 b(.)19 b(But)i(this)g(is)g(nonetheless)e(ho)n(w)g(life)i
(itself)g(w)o(orks:)f(collecting)f(tin)o(y)396 4240 y(incremental)g
(impro)o(v)o(ements)e(o)o(v)o(er)i(long)g(periods)h(of)g(time.)g(There)
f(is)i(no)f(intelligent)f(designer)-5 b(.)20 b(W)-7 b(e)21
b(reduce)e(the)h(risk)396 4348 y(of)g(local)g(peaks)g(by)g(spreading)e
(out)i(widely)g(across)g(the)g(landscape)g(b)n(ut)g(it)h(is)g(some)n
(what)e(moot.)g(The)h(limitations)396 4456 y(aren')o(t)f(optional,)g
(the)o(y)g(are)h(physical)f(la)o(ws.)i(The)f(theory)f(says,)2264
4456 y
SDict begin H.S end
 2264 4456 a 2264 4456 a
SDict begin 13 H.A end
 2264 4456 a 2264 4456
a
SDict begin [/View [/XYZ H.V]/Dest (0:5115) cvn /DEST pdfmark end
 2264 4456 a Ff(this)i(is)g(how)f(inno)o(vation)e(r)m(eally)j(works,)f
(so)h(better)396 4564 y(embr)o(ace)f(it)h(and)e(work)i(with)f(it,)h
(than)e(try)i(to)g(work)g(on)e(the)i(basis)f(of)g(belief)12
b Fk(.)-2 4747 y
SDict begin H.S end
 -2 4747 a -2 4747 a
SDict begin 13 H.A end
 -2 4747 a -2 4747
a
SDict begin [/View [/XYZ H.V]/Dest (0:5116) cvn /DEST pdfmark end
 -2 4747 a 396 4838 a Fk(And)20 b(in)g(f)o(act)h(once)e(you)g(see)i
(all)g(inno)o(v)n(ation)d(as)j(more)e(or)h(less)h(successful)f
(hill-climbing,)e(you)h(realize)i(why)e(some)396 4946
y(teams)h(and)g(companies)e(and)i(products)e(get)i(stuck)g(in)g(a)g(ne)
n(v)o(er)n(-ne)n(v)o(er)d(land)j(of)f(diminishing)f(prospects.)h(The)o
(y)g(simply)396 5054 y(don')o(t)g(ha)n(v)o(e)g(the)i(di)n(v)o(ersity)e
(and)g(collecti)n(v)o(e)g(intelligence)h(to)g(\002nd)g(better)g(hills)g
(to)h(climb)m(.)e(When)h(Nokia)g(killed)g(their)396 5162
y(open)f(source)h(projects,)f(the)o(y)h(cut)g(their)g(o)n(wn)f(throat.)
p Black 3759 5569 a Ff(404)p Black eop end
%%Page: 405 418
TeXDict begin 405 417 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.405) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5117) cvn /DEST pdfmark end
 -2
-11 a 102 x Fn(7.7.)39 b(Burnout)837 91 y
SDict begin H.S end
 837 91 a 837
91 a
SDict begin 22.464 H.A end
 837 91 a 837 91 a
SDict begin [/View [/XYZ H.V]/Dest (12.95.1) cvn /DEST pdfmark end
 837 91 a -2 259 a
SDict begin H.S end
 -2 259 a -2
259 a
SDict begin 13 H.A end
 -2 259 a -2 259 a
SDict begin [/View [/XYZ H.V]/Dest (0:5119) cvn /DEST pdfmark end
 -2 259 a 396 365 a Fk(The)20
b(\330MQ)h(community)d(has)i(been)f(and)h(still)h(is)h(hea)n(vily)d
(dependent)f(on)i(pro-bono)d(indi)n(vidual)h(ef)n(forts.)i(I')l(d)f
(lik)o(e)h(to)396 473 y(think)g(that)g(e)n(v)o(eryone)e(w)o(as)j
(compensated)d(in)i(some)g(w)o(ay)h(for)e(their)h(contrib)n(utions,)e
(and)i(I)g(belie)n(v)o(e)f(that)i(with)f(\330MQ,)396
581 y(contrib)n(uting)e(means)i(gaining)f(e)o(xpertise)g(in)h(an)g(e)o
(xtraordinarily)d(v)n(aluable)i(technology)-5 b(,)17
b(which)j(means)g(impro)o(v)o(ed)396 689 y(professional)f(options.)-2
873 y
SDict begin H.S end
 -2 873 a -2 873 a
SDict begin 13 H.A end
 -2 873 a -2 873 a
SDict begin [/View [/XYZ H.V]/Dest (0:5120) cvn /DEST pdfmark end
 -2 873 a 396
963 a Fk(Ho)n(we)n(v)o(er)g(not)h(all)h(projects)e(will)i(be)f(so)h
(luck)o(y)e(and)g(if)i(you)e(w)o(ork)h(with)g(or)g(in)g(open)f(source)h
(you)f(should)g(understand)396 1071 y(the)h(risk)h(of)f(b)n(urnout)e
(that)i(v)n(olunteers)f(f)o(ace.)h(This)h(applies)f(to)g(all)h
(pro-bono)c(communities.)h(In)i(this)h(section)f(I')o(ll)396
1179 y(e)o(xplain)f(what)h(causes)h(b)n(urnout,)d(ho)n(w)i(to)g
(recognize)e(it,)j(ho)n(w)f(to)g(pre)n(v)o(ent)e(it,)j(and)f(\(if)g(it)
h(happens\))d(ho)n(w)i(to)g(try)g(to)h(treat)396 1287
y(it.)g(Disclaimer:)f(I'm)g(not)g(a)g(psychiatrist)g(and)f(this)i
(article)f(is)h(based)f(on)g(my)g(o)n(wn)g(e)o(xperiences)e(of)i(w)o
(orking)e(in)396 1394 y(pro-bono)f(conte)o(xts)j(for)f(the)h(last)h(20)
f(years,)g(including)e(free)i(softw)o(are)g(projects,)f(and)h(NGOs)h
(such)f(as)h(the)3567 1394 y
SDict begin H.S end
 3567 1394 a 3567 1394 a
SDict begin 13 H.A end

3567 1394 a 3567 1394 a
SDict begin [/View [/XYZ H.V]/Dest (0:5121) cvn /DEST pdfmark end
 3567 1394 a Fk(FFII)396 1502
y(\(http://www)-5 b(.f)n(\002i.or)o(g\).)-2 1686 y
SDict begin H.S end
 -2
1686 a -2 1686 a
SDict begin 13 H.A end
 -2 1686 a -2 1686 a
SDict begin [/View [/XYZ H.V]/Dest (0:5122) cvn /DEST pdfmark end
 -2 1686 a 396 1776
a Fk(In)20 b(a)h(pro-bono)c(conte)o(xt)i(we')l(re)g(e)o(xpected)g(to)h
(w)o(ork)g(without)f(direct)h(or)g(ob)o(vious)e(economic)h(incenti)n(v)
o(e.)g(That)g(is,)i(we)396 1884 y(sacri\002ce)g(f)o(amily)e(life,)i
(professional)d(adv)n(ancement,)g(free)h(time,)h(and)g(health)g(in)g
(order)f(to)h(accomplish)f(some)h(goal)396 1992 y(we)g(ha)n(v)o(e)f
(decided)g(to)h(accomplish.)e(In)h(an)o(y)g(project,)g(we)h(need)f
(some)g(kind)g(of)h(re)n(w)o(ard)e(to)i(mak)o(e)f(it)i(w)o(orth)e
(continuing)396 2100 y(each)h(day)-5 b(.)19 b(In)h(most)g(pro-bono)d
(projects)j(the)g(re)n(w)o(ards)g(are)g(v)o(ery)f(indirect,)g
(super\002cially)g(not)h(economical)f(at)h(all.)396 2208
y(Mostly)-5 b(,)20 b(we)g(do)g(things)g(because)f(people)g(say)-5
b(,)20 b("he)o(y)-5 b(,)19 b(great!")g(Karma)h(is)h(a)f(po)n(werful)f
(moti)n(v)n(ator)-5 b(.)-2 2392 y
SDict begin H.S end
 -2 2392 a -2 2392 a
SDict begin 13 H.A end

-2 2392 a -2 2392 a
SDict begin [/View [/XYZ H.V]/Dest (0:5123) cvn /DEST pdfmark end
 -2 2392 a 396 2482 a Fk(Ho)n(we)n(v)o(er)m(,)18
b(we)j(are)f(economic)f(beings,)g(and)g(sooner)h(or)f(later)m(,)h(if)h
(a)f(project)g(costs)g(us)h(a)g(great)e(deal)h(and)g(does)g(not)396
2590 y(bring)f(economic)g(re)n(w)o(ards)g(of)h(some)g(kind)g(\(mone)o
(y)-5 b(,)17 b(f)o(ame,)j(a)g(ne)n(w)g(job,...\))f(we)i(start)f(to)h
(suf)n(fer)-5 b(.)19 b(At)i(a)f(certain)g(stage)h(it)396
2698 y(seems)g(our)e(subconscious)g(simply)h(gets)g(disgusted,)f(and)h
(says,)g("enough)e(is)k(enough!")17 b(and)j(refuses)g(to)g(go)g(an)o(y)
396 2806 y(further)-5 b(.)19 b(If)h(we)h(try)f(to)g(force)f(ourselv)o
(es,)g(we)i(can)f(literally)g(get)g(sick.)-2 2990 y
SDict begin H.S end
 -2
2990 a -2 2990 a
SDict begin 13 H.A end
 -2 2990 a -2 2990 a
SDict begin [/View [/XYZ H.V]/Dest (0:5124) cvn /DEST pdfmark end
 -2 2990 a 396 3080
a Fk(This)h(is)g(what)f(I)g(call)h("b)n(urnout",)d(though)g(the)i(term)
g(is)h(also)g(used)f(for)f(other)h(kinds)g(of)f(e)o(xhaustion.)f(T)-7
b(oo)20 b(much)396 3188 y(in)m(v)o(estment)f(on)h(a)g(project,)f(with)i
(too)f(little)h(economic)d(re)n(w)o(ard,)h(for)h(too)g(long.)f(W)-7
b(e)21 b(are)f(great)g(at)h(manipulating)396 3296 y(ourselv)o(es,)e
(and)h(others,)f(and)h(this)h(is)g(often)e(part)h(of)g(the)g(process)g
(that)g(leads)g(to)h(b)n(urnout.)d(W)-7 b(e)21 b(tell)g(ourselv)o(es)e
(that)h(it')-5 b(s)396 3404 y(for)20 b(a)g(good)f(cause,)h(that)g(the)h
(other)e(guy)g(is)i(doing)e(OK,)i(so)f(we)h(should)e(be)h(able)g(to)h
(as)f(well.)-2 3588 y
SDict begin H.S end
 -2 3588 a -2 3588 a
SDict begin 13 H.A end
 -2 3588 a -2
3588 a
SDict begin [/View [/XYZ H.V]/Dest (0:5125) cvn /DEST pdfmark end
 -2 3588 a 396 3678 a Fk(When)g(I)h(got)f(b)n(urnt)f(out)h(on)g
(open)f(source)g(projects)h(lik)o(e)g(Xitami,)g(I)h(remember)d(clearly)
i(ho)n(w)f(I)i(felt.)f(I)g(simply)396 3786 y(stopped)f(w)o(orking)g(on)
h(it,)g(refused)f(to)i(answer)e(an)o(y)h(more)f(emails,)h(and)g(told)g
(people)f(to)h(for)o(get)f(about)g(it.)i(Y)-9 b(ou)19
b(can)h(tell)396 3893 y(when)f(someone')-5 b(s)19 b(b)n(urnt)g(out.)g
(The)o(y)f(go)h(of)n(f-line,)f(and)h(e)n(v)o(eryone)e(starts)j(saying,)
f("he')-5 b(s)20 b(acting)f(strange...)f(depressed,)396
4001 y(or)i(tired...")-2 4168 y
SDict begin H.S end
 -2 4168 a -2 4168 a
SDict begin 13 H.A end
 -2
4168 a -2 4168 a
SDict begin [/View [/XYZ H.V]/Dest (0:5126) cvn /DEST pdfmark end
 -2 4168 a 396 4275 a Fk(Diagnosis)g(is)h(simple.)f
(Has)h(someone)e(w)o(ork)o(ed)g(a)i(lot)f(on)g(a)g(project)g(that)g(w)o
(as)h(not)f(paying)f(back)g(in)h(an)o(y)g(w)o(ay?)g(Did)396
4383 y(she)h(mak)o(e)e(e)o(xceptional)g(sacri\002ces?)h(Did)g(he)h
(lose)f(or)g(abandon)e(his)j(job)f(or)f(studies)i(to)f(do)g(the)g
(project?)f(If)h(you')l(re)396 4491 y(answering)f("yes",)h(it')-5
b(s)21 b(b)n(urnout.)-2 4675 y
SDict begin H.S end
 -2 4675 a -2 4675 a
SDict begin 13 H.A end
 -2
4675 a -2 4675 a
SDict begin [/View [/XYZ H.V]/Dest (0:5127) cvn /DEST pdfmark end
 -2 4675 a 396 4765 a Fk(There)e(are)h(three)f(simple)h
(techniques)e(I')l(v)o(e)g(de)n(v)o(eloped)g(o)o(v)o(er)g(the)i(years)f
(to)h(reduce)e(the)i(risk)g(of)f(b)n(urnout)f(in)i(the)g(teams)396
4873 y(I)h(w)o(ork)e(with:)-2 4874 y
SDict begin H.S end
 -2 4874 a -2 4874
a
SDict begin 13 H.A end
 -2 4874 a -2 4874 a
SDict begin [/View [/XYZ H.V]/Dest (0:5128) cvn /DEST pdfmark end
 -2 4874 a -2 4884 a
SDict begin H.S end
 -2 4884 a -2
4884 a
SDict begin 13 H.A end
 -2 4884 a -2 4884 a
SDict begin [/View [/XYZ H.V]/Dest (0:5129) cvn /DEST pdfmark end
 -2 4884 a Black 396 5043 a
Fj(\225)p Black 479 5043 a
SDict begin H.S end
 479 5043 a 479 5043 a
SDict begin 13 H.A end
 479
5043 a 479 5043 a
SDict begin [/View [/XYZ H.V]/Dest (0:5130) cvn /DEST pdfmark end
 479 5043 a 479 5043 a
SDict begin H.S end
 479 5043 a 479
5043 a
SDict begin 13 H.A end
 479 5043 a 479 5043 a
SDict begin [/View [/XYZ H.V]/Dest (0:5131) cvn /DEST pdfmark end
 479 5043 a Ff(No-one)g(is)j(irr)m
(eplaceable)o(.)c Fk(W)-7 b(orking)19 b(solo)i(on)e(a)i(critical)f(or)g
(popular)e(project)i(--)g(the)g(concentration)e(of)479
5151 y(responsibility)h(on)h(one)g(person)f(who)g(cannot)g(set)i(their)
f(o)n(wn)g(limits)h(--)f(is)h(probably)d(the)i(main)g(f)o(actor)-5
b(.)20 b(It')-5 b(s)21 b(a)p Black 3759 5569 a Ff(405)p
Black eop end
%%Page: 406 419
TeXDict begin 406 418 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.406) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 479 72 a Fk(management)e(truism:)i(if)h(someone)e(in)h(your)f(or)
o(ganization)e(is)k(irreplaceable,)d(get)i(rid)g(of)g(him)g(or)g(her)-5
b(.)-2 90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:5132) cvn /DEST pdfmark end
 -2 90 a Black
396 222 a Fj(\225)p Black 479 222 a
SDict begin H.S end
 479 222 a 479 222
a
SDict begin 13 H.A end
 479 222 a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:5133) cvn /DEST pdfmark end
 479 222 a 479 222 a
SDict begin H.S end
 479 222 a 479
222 a
SDict begin 13 H.A end
 479 222 a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:5134) cvn /DEST pdfmark end
 479 222 a Ff(W)d(e)21 b(need)f(day)g(jobs)g
(to)g(pay)g(the)g(bills.)g Fk(This)h(can)f(be)g(hard)f(b)n(ut)h(seems)h
(necessary)-5 b(.)19 b(Getting)h(mone)o(y)e(from)479
330 y(some)n(where)h(else)i(mak)o(es)f(it)h(much)e(easier)h(to)h
(sustain)f(a)h(sacri\002cial)f(project.)-2 348 y
SDict begin H.S end
 -2 348
a -2 348 a
SDict begin 13 H.A end
 -2 348 a -2 348 a
SDict begin [/View [/XYZ H.V]/Dest (0:5135) cvn /DEST pdfmark end
 -2 348 a Black 396 479 a
Fj(\225)p Black 479 479 a
SDict begin H.S end
 479 479 a 479 479 a
SDict begin 13 H.A end
 479 479
a 479 479 a
SDict begin [/View [/XYZ H.V]/Dest (0:5136) cvn /DEST pdfmark end
 479 479 a 479 479 a
SDict begin H.S end
 479 479 a 479 479 a
SDict begin 13 H.A end
 479
479 a 479 479 a
SDict begin [/View [/XYZ H.V]/Dest (0:5137) cvn /DEST pdfmark end
 479 479 a Ff(T)-8 b(eac)o(h)20 b(people)f(about)g(b)n
(urnout.)g Fk(This)h(should)f(IMO)i(be)f(a)g(basic)h(course)e(in)h
(colle)o(ges)g(and)g(uni)n(v)o(ersities,)f(as)479 587
y(pro-bono)e(w)o(ork)j(becomes)f(a)i(more)e(common)f(w)o(ay)j(for)e
(young)g(people)g(to)h(e)o(xperiment)e(professionally)-5
b(.)-2 771 y
SDict begin H.S end
 -2 771 a -2 771 a
SDict begin 13 H.A end
 -2 771 a -2 771 a
SDict begin [/View [/XYZ H.V]/Dest (0:5138) cvn /DEST pdfmark end
 -2 771
a 396 861 a Fk(When)20 b(someone)f(is)i(w)o(orking)d(alone)i(on)g(a)g
(critical)g(project,)f(you)2333 861 y
SDict begin H.S end
 2333 861 a 2333
861 a
SDict begin 13 H.A end
 2333 861 a 2333 861 a
SDict begin [/View [/XYZ H.V]/Dest (0:5139) cvn /DEST pdfmark end
 2333 861 a Ff(know)h Fk(the)o(y)g(are)g
(going)e(blo)n(w)i(their)g(fuses)g(sooner)f(or)396 969
y(later)-5 b(.)21 b(It')-5 b(s)21 b(actually)e(f)o(airly)h
(predictable:)f(something)f(lik)o(e)j(18-36)d(months)h(depending)f(on)i
(the)g(indi)n(vidual)f(and)g(ho)n(w)396 1077 y(much)g(economic)g
(stress)i(the)o(y)f(f)o(ace)g(in)g(their)g(pri)n(v)n(ate)f(li)n(v)o
(es.)h(I')l(v)o(e)f(not)h(seen)h(an)o(yone)d(b)n(urn-out)g(after)i
(half)g(a)g(year)m(,)f(nor)396 1185 y(last)i(\002)n(v)o(e)f(years)g(in)
h(a)f(unre)n(w)o(arding)e(project.)-2 1369 y
SDict begin H.S end
 -2 1369
a -2 1369 a
SDict begin 13 H.A end
 -2 1369 a -2 1369 a
SDict begin [/View [/XYZ H.V]/Dest (0:5140) cvn /DEST pdfmark end
 -2 1369 a 396 1459 a
Fk(There)i(is)h(a)f(simple)h(cure)e(for)h(b)n(urnout)e(which)i(w)o
(orks)g(in)g(at)h(least)g(some)f(cases:)h(get)f(paid)g(decently)f(for)g
(your)g(w)o(ork.)396 1567 y(Ho)n(we)n(v)o(er)g(this)i(pretty)e(much)g
(destro)o(ys)h(the)g(freedom)f(of)g(mo)o(v)o(ement)f(\(across)i(that)g
(in\002nite)g(problem)f(landscape\))396 1675 y(that)i(the)f(v)n
(olunteer)e(enjo)o(ys.)-2 1703 y
SDict begin H.S end
 -2 1703 a -2 1703 a
SDict begin 13 H.A end

-2 1703 a -2 1703 a
SDict begin [/View [/XYZ H.V]/Dest (0:5141) cvn /DEST pdfmark end
 -2 1703 a 359 x Fn(7.8.)39 b(P)l(atterns)e(f)m(or)j
(The)f(Game)1810 2062 y
SDict begin H.S end
 1810 2062 a 1810 2062 a
SDict begin 22.464 H.A end
 1810
2062 a 1810 2062 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.1) cvn /DEST pdfmark end
 1810 2062 a -2 2230 a
SDict begin H.S end
 -2 2230 a -2
2230 a
SDict begin 13 H.A end
 -2 2230 a -2 2230 a
SDict begin [/View [/XYZ H.V]/Dest (0:5143) cvn /DEST pdfmark end
 -2 2230 a 396 2336 a Fk(I')o(ll)21
b(end)e(this)i(code-free)d(chapter)h(with)i(a)f(series)h(of)f(patterns)
g(for)f(success)i(in)f(softw)o(are)g(engineering.)d(The)o(y)j(aim)g(to)
396 2444 y(capture)f(the)i(essence)f(of)g(what)g(di)n(vides)f(glorious)
g(success)i(from)e(tragic)h(f)o(ailure.)f(The)o(y)h(were)g(described)e
(as)396 2552 y("religious)h(maniacal)h(dogma")f(by)g(a)i(manager)m(,)d
(and)i("an)o(ything)e(else)i(w)o(ould)g(be)g(ef)n(\002ng)f(insane")h
(by)g(a)h(colleague,)d(in)396 2660 y(a)j(single)e(day)-5
b(.)19 b(F)o(or)h(me,)f(the)o(y)h(are)f(science.)h(But)g(treat)g(the)g
(Lazy)g(Perfectionist)f(and)g(others)h(as)g(tools)g(to)g(use,)g
(sharpen,)396 2768 y(and)g(thro)n(w)f(a)o(w)o(ay)h(if)h(something)d
(better)i(comes)g(along.)-2 2786 y
SDict begin H.S end
 -2 2786 a -2 2786
a
SDict begin 13 H.A end
 -2 2786 a -2 2786 a
SDict begin [/View [/XYZ H.V]/Dest (0:5144) cvn /DEST pdfmark end
 -2 2786 a 396 3096 a Fb(7.8.1.)36
b(The)d(Lazy)h(P)l(erf)o(ectionist)1991 3096 y
SDict begin H.S end
 1991 3096
a 1991 3096 a
SDict begin 18.72 H.A end
 1991 3096 a 1991 3096 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.85.2) cvn /DEST pdfmark end
 1991 3096 a -2
3287 a
SDict begin H.S end
 -2 3287 a -2 3287 a
SDict begin 13 H.A end
 -2 3287 a -2 3287 a
SDict begin [/View [/XYZ H.V]/Dest (0:5146) cvn /DEST pdfmark end
 -2 3287
a -2 3287 a
SDict begin H.S end
 -2 3287 a -2 3287 a
SDict begin 13 H.A end
 -2 3287 a -2 3287 a
SDict begin [/View [/XYZ H.V]/Dest (0:5147) cvn /DEST pdfmark end
 -2
3287 a 396 3370 a Ff(Ne)o(ver)21 b(design)f(anything)e(that')m(s)h(not)
h(a)h(pr)m(ecise)f(minimal)g(answer)h(to)f(a)g(pr)l(oblem)g(we)h(can)e
(identify)h(and)g(have)f(to)396 3478 y(solve)o(.)-2 3645
y
SDict begin H.S end
 -2 3645 a -2 3645 a
SDict begin 13 H.A end
 -2 3645 a -2 3645 a
SDict begin [/View [/XYZ H.V]/Dest (0:5148) cvn /DEST pdfmark end
 -2 3645 a 396
3752 a Fk(The)h(Lazy)g(Perfectionist)f(spends)h(his)h(idle)f(time)g
(observing)e(others)i(and)g(identifying)e(problems)h(that)h(are)g(w)o
(orth)396 3860 y(solving.)f(He)i(looks)e(for)h(agreement)f(on)g(those)h
(problems,)f(al)o(w)o(ays)i(asking,)e("what)h(is)h(the)3057
3860 y
SDict begin H.S end
 3057 3860 a 3057 3860 a
SDict begin 13 H.A end
 3057 3860 a 3057 3860
a
SDict begin [/View [/XYZ H.V]/Dest (0:5149) cvn /DEST pdfmark end
 3057 3860 a Ff(r)m(eal)g Fk(problem".)d(Then)h(he)396
3968 y(mo)o(v)o(es,)g(precisely)g(and)g(minimally)-5
b(,)18 b(to)i(b)n(uild,)f(or)h(get)g(others)f(to)h(b)n(uild,)f(a)h
(usable)g(answer)f(to)h(one)f(problem.)f(He)i(uses,)396
4076 y(or)g(gets)h(others)e(to)i(use)f(those)g(solutions.)f(And)h(he)g
(repeats)g(this)h(until)f(there)g(are)g(no)g(problems)e(left)j(to)f
(solv)o(e,)g(or)g(time)396 4184 y(or)g(mone)o(y)f(runs)g(out.)-2
4212 y
SDict begin H.S end
 -2 4212 a -2 4212 a
SDict begin 13 H.A end
 -2 4212 a -2 4212 a
SDict begin [/View [/XYZ H.V]/Dest (0:5150) cvn /DEST pdfmark end
 -2 4212
a 396 4522 a Fb(7.8.2.)36 b(The)d(Bene)n(v)l(olent)k(T)-7
b(yrant)2005 4522 y
SDict begin H.S end
 2005 4522 a 2005 4522 a
SDict begin 18.72 H.A end
 2005 4522
a 2005 4522 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.86.2) cvn /DEST pdfmark end
 2005 4522 a -2 4713 a
SDict begin H.S end
 -2 4713 a -2 4713
a
SDict begin 13 H.A end
 -2 4713 a -2 4713 a
SDict begin [/View [/XYZ H.V]/Dest (0:5152) cvn /DEST pdfmark end
 -2 4713 a -2 4713 a
SDict begin H.S end
 -2 4713 a -2
4713 a
SDict begin 13 H.A end
 -2 4713 a -2 4713 a
SDict begin [/View [/XYZ H.V]/Dest (0:5153) cvn /DEST pdfmark end
 -2 4713 a 396 4796 a Ff(The)21
b(contr)l(ol)e(of)i(a)f(lar)m(g)o(e)g(for)m(ce)g(is)i(the)e(same)g
(principle)g(as)g(the)g(contr)l(ol)g(of)h(a)f(fe)o(w)h(men:)e(it)i(is)h
(mer)m(ely)e(a)g(question)f(of)396 4904 y(dividing)g(up)h(their)h
(number)o(s.)e Fk(--)h(Sun)g(Tzu)p Black 3757 5569 a
Ff(406)p Black eop end
%%Page: 407 420
TeXDict begin 407 419 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.407) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5154) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)g(Bene)n(v)n(olent)f(T)-7 b(yrant)20
b(di)n(vides)f(lar)o(ge)g(problems)g(into)h(smaller)g(ones)g(and)g
(thro)n(ws)g(them)f(at)i(groups)e(to)h(focus)g(on.)396
180 y(He)h(brok)o(ers)e(contracts)g(between)h(these)g(groups,)e(in)j
(the)f(form)f(of)h(APIs)h(and)e(unprotocols.)f(The)i(Bene)n(v)n(olent)f
(T)-7 b(yrant)396 288 y(constructs)20 b(a)g(supply)f(chain)h(that)g
(starts)h(with)g(problems,)d(and)i(results)g(in)h(usable)f(solutions.)f
(He)i(is)g(ruthless)f(about)396 396 y(ho)n(w)g(the)g(supply)f(chain)h
(w)o(orks,)f(b)n(ut)i(does)f(not)f(tell)i(people)e(on)h(what)g(to)h(w)o
(ork,)e(nor)g(ho)n(w)h(to)g(do)g(their)g(w)o(ork.)-2
425 y
SDict begin H.S end
 -2 425 a -2 425 a
SDict begin 13 H.A end
 -2 425 a -2 425 a
SDict begin [/View [/XYZ H.V]/Dest (0:5155) cvn /DEST pdfmark end
 -2 425 a 396
735 a Fb(7.8.3.)36 b(The)d(Ear)r(th)h(and)f(Sky)1773
735 y
SDict begin H.S end
 1773 735 a 1773 735 a
SDict begin 18.72 H.A end
 1773 735 a 1773 735 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.87.2) cvn /DEST pdfmark end
 1773
735 a -2 926 a
SDict begin H.S end
 -2 926 a -2 926 a
SDict begin 13 H.A end
 -2 926 a -2 926 a
SDict begin [/View [/XYZ H.V]/Dest (0:5157) cvn /DEST pdfmark end
 -2
926 a -2 926 a
SDict begin H.S end
 -2 926 a -2 926 a
SDict begin 13 H.A end
 -2 926 a -2 926 a
SDict begin [/View [/XYZ H.V]/Dest (0:5158) cvn /DEST pdfmark end
 -2
926 a 396 1009 a Ff(The)21 b(ideal)e(team)h(consists)h(of)g(two)f
(sides:)h(one)e(writing)i(code)o(,)e(and)h(one)f(pr)l(o)o(viding)g
(feedbac)n(k.)-2 1192 y
SDict begin H.S end
 -2 1192 a -2 1192 a
SDict begin 13 H.A end
 -2 1192 a
-2 1192 a
SDict begin [/View [/XYZ H.V]/Dest (0:5159) cvn /DEST pdfmark end
 -2 1192 a 396 1283 a Fk(The)h(Earth)g(and)f(Sk)o(y)h(w)o(ork)
g(together)e(as)j(a)g(whole,)e(in)i(close)f(proximity)-5
b(,)18 b(b)n(ut)i(the)o(y)f(communicate)f(formally)h(through)396
1391 y(an)h(issue)h(tracking.)e(Sk)o(y)g(seeks)i(out)f(problems,)e
(from)i(others)f(and)h(from)f(their)h(o)n(wn)g(use)g(of)g(the)g
(product,)e(and)i(feeds)396 1499 y(these)h(to)f(Earth.)f(Earth)h
(rapidly)f(answers)h(with)g(testable)h(solutions.)e(Earth)h(and)f(Sk)o
(y)h(can)g(w)o(ork)g(through)e(dozens)h(of)396 1606 y(issues)i(in)g(a)f
(day)-5 b(.)19 b(Sk)o(y)h(talks)h(to)f(other)f(users,)h(and)g(Earth)g
(talks)g(to)h(other)e(de)n(v)o(elopers.)f(Earth)h(and)h(Sk)o(y)g(may)f
(be)i(tw)o(o)396 1714 y(people,)e(or)h(tw)o(o)g(small)h(groups.)-2
1743 y
SDict begin H.S end
 -2 1743 a -2 1743 a
SDict begin 13 H.A end
 -2 1743 a -2 1743 a
SDict begin [/View [/XYZ H.V]/Dest (0:5160) cvn /DEST pdfmark end
 -2 1743
a 396 2053 a Fb(7.8.4.)36 b(The)d(Open)h(Door)1592 2053
y
SDict begin H.S end
 1592 2053 a 1592 2053 a
SDict begin 18.72 H.A end
 1592 2053 a 1592 2053 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.88.2) cvn /DEST pdfmark end
 1592
2053 a -2 2244 a
SDict begin H.S end
 -2 2244 a -2 2244 a
SDict begin 13 H.A end
 -2 2244 a -2 2244
a
SDict begin [/View [/XYZ H.V]/Dest (0:5162) cvn /DEST pdfmark end
 -2 2244 a -2 2244 a
SDict begin H.S end
 -2 2244 a -2 2244 a
SDict begin 13 H.A end
 -2 2244 a -2
2244 a
SDict begin [/View [/XYZ H.V]/Dest (0:5163) cvn /DEST pdfmark end
 -2 2244 a 396 2327 a Ff(The)21 b(accur)o(acy)d(of)j(knowledg)o
(e)e(comes)h(fr)l(om)h(diver)o(sity)-5 b(.)-2 2510 y
SDict begin H.S end

-2 2510 a -2 2510 a
SDict begin 13 H.A end
 -2 2510 a -2 2510 a
SDict begin [/View [/XYZ H.V]/Dest (0:5164) cvn /DEST pdfmark end
 -2 2510 a 396
2601 a Fk(The)20 b(Open)g(Door)f(accepts)h(contrib)n(utions)e(from)i
(almost)g(an)o(yone.)e(He)i(does)g(not)g(ar)o(gue)f(quality)g(or)h
(direction,)396 2709 y(instead)g(allo)n(wing)f(others)h(to)g(ar)o(gue)f
(that)h(and)g(so)h(get)f(more)f(engaged.)f(He)i(calculates)h(that)f(e)n
(v)o(en)f(a)i(troll)f(will)h(bring)396 2817 y(more)f(di)n(v)o(erse)f
(opinion)f(to)j(the)f(group.)e(He)j(lets)g(the)f(group)e(form)h(its)j
(opinion)c(about)h(what)i(goes)e(into)h(stable)h(code,)396
2925 y(and)f(he)g(enforces)f(this)i(opinion)d(with)j(help)e(of)h(a)h
(Bene)n(v)n(olent)e(T)-7 b(yrant.)-2 2953 y
SDict begin H.S end
 -2 2953 a
-2 2953 a
SDict begin 13 H.A end
 -2 2953 a -2 2953 a
SDict begin [/View [/XYZ H.V]/Dest (0:5165) cvn /DEST pdfmark end
 -2 2953 a 396 3263 a Fb(7.8.5.)36
b(The)d(Laughing)i(Clo)n(wn)1902 3263 y
SDict begin H.S end
 1902 3263 a 1902
3263 a
SDict begin 18.72 H.A end
 1902 3263 a 1902 3263 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.89.2) cvn /DEST pdfmark end
 1902 3263 a -2 3456 a
SDict begin H.S end

-2 3456 a -2 3456 a
SDict begin 13 H.A end
 -2 3456 a -2 3456 a
SDict begin [/View [/XYZ H.V]/Dest (0:5167) cvn /DEST pdfmark end
 -2 3456 a -2
3456 a
SDict begin H.S end
 -2 3456 a -2 3456 a
SDict begin 13 H.A end
 -2 3456 a -2 3456 a
SDict begin [/View [/XYZ H.V]/Dest (0:5168) cvn /DEST pdfmark end
 -2 3456
a 396 3537 a Ff(P)-7 b(erfection)20 b(pr)m(ecludes)g(participation.)-2
3720 y
SDict begin H.S end
 -2 3720 a -2 3720 a
SDict begin 13 H.A end
 -2 3720 a -2 3720 a
SDict begin [/View [/XYZ H.V]/Dest (0:5169) cvn /DEST pdfmark end
 -2 3720
a 396 3811 a Fk(The)g(Laughing)e(Clo)n(wn,)i(often)f(acting)h(as)h(the)
f(Happ)o(y)f(F)o(ailure,)h(mak)o(es)g(no)g(claim)g(to)g(high)g
(competence.)e(Instead)h(his)396 3919 y(antics)i(and)e(b)n(umbling)g
(attempts)h(pro)o(v)n(ok)o(e)e(others)i(into)g(rescuing)f(him)h(from)f
(his)h(o)n(wn)g(tragedy)-5 b(.)18 b(Someho)n(w)396 4027
y(ho)n(we)n(v)o(er)m(,)g(he)i(al)o(w)o(ays)h(identi\002es)f(the)g
(right)g(problems)e(to)j(solv)o(e.)e(People)h(are)g(so)h(b)n(usy)f(pro)
o(ving)d(him)j(wrong)f(the)o(y)396 4135 y(don')o(t)g(realize)h(the)o
(y')l(re)e(doing)h(v)n(aluable)g(w)o(ork.)-2 4163 y
SDict begin H.S end
 -2
4163 a -2 4163 a
SDict begin 13 H.A end
 -2 4163 a -2 4163 a
SDict begin [/View [/XYZ H.V]/Dest (0:5170) cvn /DEST pdfmark end
 -2 4163 a 396 4473
a Fb(7.8.6.)36 b(The)d(Mindful)h(General)1877 4473 y
SDict begin H.S end

1877 4473 a 1877 4473 a
SDict begin 18.72 H.A end
 1877 4473 a 1877 4473 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.90.2) cvn /DEST pdfmark end
 1877
4473 a -2 4641 a
SDict begin H.S end
 -2 4641 a -2 4641 a
SDict begin 13 H.A end
 -2 4641 a -2 4641
a
SDict begin [/View [/XYZ H.V]/Dest (0:5172) cvn /DEST pdfmark end
 -2 4641 a -2 4641 a
SDict begin H.S end
 -2 4641 a -2 4641 a
SDict begin 13 H.A end
 -2 4641 a -2
4641 a
SDict begin [/View [/XYZ H.V]/Dest (0:5173) cvn /DEST pdfmark end
 -2 4641 a 396 4747 a Ff(Mak)o(e)21 b(no)e(plans.)h(Set)g(goals,)
f(de)o(velop)g(str)o(ate)m(gies)h(and)f(tactics.)-2 4930
y
SDict begin H.S end
 -2 4930 a -2 4930 a
SDict begin 13 H.A end
 -2 4930 a -2 4930 a
SDict begin [/View [/XYZ H.V]/Dest (0:5174) cvn /DEST pdfmark end
 -2 4930 a 396
5021 a Fk(The)h(Mindful)f(General)h(operates)f(in)h(unkno)n(wn)e
(territory)-5 b(,)18 b(solving)h(problems)g(that)h(are)h(hidden)d
(until)i(the)o(y)g(are)396 5129 y(nearby)-5 b(.)18 b(Thus)i(he)g(mak)o
(es)g(no)g(plans,)g(b)n(ut)g(seeks)h(opportunities,)c(then)j(e)o
(xploits)f(them)h(rapidly)f(and)h(accurately)-5 b(.)18
b(He)p Black 3756 5569 a Ff(407)p Black eop end
%%Page: 408 421
TeXDict begin 408 420 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.408) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:5199) cvn /DEST pdfmark end
 -2 -201 a 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 72 a Fk(de)n(v)o(elops)f(tactics)i(and)e(strate)o(gies)h(in)h
(the)f(\002eld,)g(and)g(teaches)g(these)g(to)h(his)f(men)g(so)g(the)o
(y)g(can)g(mo)o(v)o(e)f(independently)-5 b(,)396 180
y(and)20 b(together)-5 b(.)-2 209 y
SDict begin H.S end
 -2 209 a -2 209 a
SDict begin 13 H.A end

-2 209 a -2 209 a
SDict begin [/View [/XYZ H.V]/Dest (0:5175) cvn /DEST pdfmark end
 -2 209 a 396 519 a Fb(7.8.7.)36 b(The)d(Social)i
(Engineer)1871 519 y
SDict begin H.S end
 1871 519 a 1871 519 a
SDict begin 18.72 H.A end
 1871 519 a
1871 519 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.91.2) cvn /DEST pdfmark end
 1871 519 a -2 712 a
SDict begin H.S end
 -2 712 a -2 712 a
SDict begin 13 H.A end
 -2 712
a -2 712 a
SDict begin [/View [/XYZ H.V]/Dest (0:5177) cvn /DEST pdfmark end
 -2 712 a -2 712 a
SDict begin H.S end
 -2 712 a -2 712 a
SDict begin 13 H.A end
 -2 712
a -2 712 a
SDict begin [/View [/XYZ H.V]/Dest (0:5178) cvn /DEST pdfmark end
 -2 712 a 396 793 a Ff(If)21 b(you)e(know)h(the)h(enemy)e
(and)h(know)g(your)o(self)o(,)g(you)g(need)f(not)h(fear)h(the)f(r)m
(esult)h(of)f(a)g(hundr)m(ed)f(battles.)g Fk(--)i(Sun)e(Tzu)-2
976 y
SDict begin H.S end
 -2 976 a -2 976 a
SDict begin 13 H.A end
 -2 976 a -2 976 a
SDict begin [/View [/XYZ H.V]/Dest (0:5179) cvn /DEST pdfmark end
 -2 976 a 396
1067 a Fk(The)h(Social)g(Engineer)f(reads)h(the)g(hearts)g(and)g(minds)
f(of)h(those)g(he)g(w)o(orks)g(with)h(and)e(for)-5 b(.)20
b(He)h(asks,)f(of)g(e)n(v)o(eryone,)396 1175 y("what)g(mak)o(es)g(this)
h(person)e(angry)-5 b(,)18 b(insecure,)h(ar)o(gumentati)n(v)o(e,)e
(calm,)j(happ)o(y?")f(He)h(studies)h(their)e(moods)h(and)396
1283 y(dispositions.)g(W)m(ith)g(this)h(kno)n(wledge)d(he)i(can)g
(encourage)e(those)i(who)f(are)i(useful,)e(and)h(discourage)e(those)i
(who)g(are)396 1391 y(not.)g(The)g(Social)g(Engineer)f(ne)n(v)o(er)f
(acts)j(on)f(his)h(o)n(wn)e(emotions.)-2 1419 y
SDict begin H.S end
 -2 1419
a -2 1419 a
SDict begin 13 H.A end
 -2 1419 a -2 1419 a
SDict begin [/View [/XYZ H.V]/Dest (0:5180) cvn /DEST pdfmark end
 -2 1419 a 396 1729 a
Fb(7.8.8.)36 b(The)d(Constant)i(Gar)n(dener)2055 1729
y
SDict begin H.S end
 2055 1729 a 2055 1729 a
SDict begin 18.72 H.A end
 2055 1729 a 2055 1729 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.92.2) cvn /DEST pdfmark end
 2055
1729 a -2 1897 a
SDict begin H.S end
 -2 1897 a -2 1897 a
SDict begin 13 H.A end
 -2 1897 a -2 1897
a
SDict begin [/View [/XYZ H.V]/Dest (0:5182) cvn /DEST pdfmark end
 -2 1897 a -2 1897 a
SDict begin H.S end
 -2 1897 a -2 1897 a
SDict begin 13 H.A end
 -2 1897 a -2
1897 a
SDict begin [/View [/XYZ H.V]/Dest (0:5183) cvn /DEST pdfmark end
 -2 1897 a 396 2003 a Ff(He)21 b(will)g(win)g(whose)f(army)h(is)g
(animated)d(by)j(the)f(same)g(spirit)h(thr)l(oughout)d(all)j(its)g(r)o
(anks.)f Fk(--)g(Sun)g(Tzu)-2 2186 y
SDict begin H.S end
 -2 2186 a -2 2186
a
SDict begin 13 H.A end
 -2 2186 a -2 2186 a
SDict begin [/View [/XYZ H.V]/Dest (0:5184) cvn /DEST pdfmark end
 -2 2186 a 396 2277 a Fk(The)g(Constant)g
(Gardener)f(gro)n(ws)g(a)i(process)f(from)f(a)h(small)h(seed,)f(step)h
(by)e(step)i(as)g(more)e(people)g(come)h(into)g(the)396
2385 y(project.)f(He)i(mak)o(es)f(e)n(v)o(ery)f(change)g(for)g(a)i
(precise)f(reason,)f(with)h(agreement)f(from)g(e)n(v)o(eryone.)e(He)k
(ne)n(v)o(er)e(imposes)h(a)396 2493 y(process)g(from)f(abo)o(v)o(e)g(b)
n(ut)h(lets)h(others)f(come)f(to)i(consensus,)e(then)g(he)i(enforces)d
(that)j(consensus.)e(In)h(this)h(w)o(ay)396 2601 y(e)n(v)o(eryone)d(o)n
(wns)i(the)g(process)g(together)f(and)g(by)h(o)n(wning)f(it,)h(the)o(y)
g(are)g(attached)f(to)i(it.)-2 2629 y
SDict begin H.S end
 -2 2629 a -2 2629
a
SDict begin 13 H.A end
 -2 2629 a -2 2629 a
SDict begin [/View [/XYZ H.V]/Dest (0:5185) cvn /DEST pdfmark end
 -2 2629 a 396 2939 a Fb(7.8.9.)36
b(The)d(Rolling)i(Stone)1745 2939 y
SDict begin H.S end
 1745 2939 a 1745
2939 a
SDict begin 18.72 H.A end
 1745 2939 a 1745 2939 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.93.2) cvn /DEST pdfmark end
 1745 2939 a -2 3132 a
SDict begin H.S end

-2 3132 a -2 3132 a
SDict begin 13 H.A end
 -2 3132 a -2 3132 a
SDict begin [/View [/XYZ H.V]/Dest (0:5187) cvn /DEST pdfmark end
 -2 3132 a -2
3132 a
SDict begin H.S end
 -2 3132 a -2 3132 a
SDict begin 13 H.A end
 -2 3132 a -2 3132 a
SDict begin [/View [/XYZ H.V]/Dest (0:5188) cvn /DEST pdfmark end
 -2 3132
a 396 3213 a Ff(After)21 b(cr)l(ossing)f(a)h(river)-9
b(,)20 b(you)g(should)f(g)o(et)i(far)f(away)g(fr)l(om)h(it.)g
Fk(--)f(Sun)g(Tzu)-2 3396 y
SDict begin H.S end
 -2 3396 a -2 3396 a
SDict begin 13 H.A end
 -2 3396
a -2 3396 a
SDict begin [/View [/XYZ H.V]/Dest (0:5189) cvn /DEST pdfmark end
 -2 3396 a 396 3487 a Fk(The)g(Rolling)g(Stone)g(accepts)g
(his)h(o)n(wn)e(mortality)g(and)h(transience.)f(He)i(has)f(no)g
(attachment)f(to)h(his)h(past)f(w)o(ork.)g(He)396 3595
y(accepts)g(that)h(all)f(that)h(we)f(mak)o(e)g(is)h(destined)f(for)f
(the)h(trash)h(can,)e(it)i(is)g(just)g(a)g(matter)f(of)f(time.)i(W)m
(ith)f(precise,)396 3703 y(minimal)g(in)m(v)o(estments,)e(he)j(can)f
(mo)o(v)o(e)e(rapidly)h(a)o(w)o(ay)h(from)f(the)h(past)h(and)f(stay)g
(focused)f(on)h(the)g(present)g(and)f(near)396 3811 y(future.)g(Abo)o
(v)o(e)g(all)h(he)h(has)f(no)g(e)o(go)f(and)h(no)g(pride)f(to)h(be)g
(hurt)g(by)g(the)g(actions)g(of)g(others.)-2 3839 y
SDict begin H.S end
 -2
3839 a -2 3839 a
SDict begin 13 H.A end
 -2 3839 a -2 3839 a
SDict begin [/View [/XYZ H.V]/Dest (0:5190) cvn /DEST pdfmark end
 -2 3839 a 396 4150
a Fb(7.8.10.)36 b(The)e(Pirate)f(Gang)1711 4150 y
SDict begin H.S end
 1711
4150 a 1711 4150 a
SDict begin 18.72 H.A end
 1711 4150 a 1711 4150 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.94.2) cvn /DEST pdfmark end
 1711 4150
a -2 4342 a
SDict begin H.S end
 -2 4342 a -2 4342 a
SDict begin 13 H.A end
 -2 4342 a -2 4342 a
SDict begin [/View [/XYZ H.V]/Dest (0:5192) cvn /DEST pdfmark end
 -2
4342 a -2 4342 a
SDict begin H.S end
 -2 4342 a -2 4342 a
SDict begin 13 H.A end
 -2 4342 a -2 4342
a
SDict begin [/View [/XYZ H.V]/Dest (0:5193) cvn /DEST pdfmark end
 -2 4342 a 396 4423 a Ff(Code)o(,)20 b(lik)o(e)h(all)f(knowledg)o(e)o
(,)f(works)i(best)g(as)g(collective)e(--)h(not)g(private)g(--)g(pr)l
(operty)-5 b(.)-2 4607 y
SDict begin H.S end
 -2 4607 a -2 4607 a
SDict begin 13 H.A end
 -2 4607
a -2 4607 a
SDict begin [/View [/XYZ H.V]/Dest (0:5194) cvn /DEST pdfmark end
 -2 4607 a 396 4697 a Fk(The)20 b(Pirate)h(Gang)e(or)o
(ganizes)f(freely)h(around)g(problems.)f(It)j(accepts)f(authority)e
(insof)o(ar)i(as)h(authority)d(pro)o(vides)396 4805 y(goals)i(and)g
(resources.)f(The)h(Pirate)g(Gang)g(o)n(wns)g(and)f(shares)i(all)f(it)h
(mak)o(es:)f(e)n(v)o(ery)f(w)o(ork)h(is)h(fully)e(remixable)g(by)396
4913 y(others)h(in)g(the)g(Pirate)h(Gang.)e(The)h(gang)f(mo)o(v)o(es)g
(rapidly)g(as)i(ne)n(w)f(problems)e(emer)o(ge,)h(and)g(is)j(quick)d(to)
h(abandon)e(old)396 5021 y(solutions)i(if)g(those)g(stop)h(being)e
(rele)n(v)n(ant.)g(No)h(persons)f(or)h(groups)f(can)h(monopolize)e(an)o
(y)h(part)h(of)g(the)g(supply)f(chain.)-2 5050 y
SDict begin H.S end
 -2 5050
a -2 5050 a
SDict begin 13 H.A end
 -2 5050 a -2 5050 a
SDict begin [/View [/XYZ H.V]/Dest (0:5195) cvn /DEST pdfmark end
 -2 5050 a Black 3759
5569 a Ff(408)p Black eop end
%%Page: 409 422
TeXDict begin 409 421 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.409) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 74 a Fb(7.8.11.)36 b(The)e(Flash)g(Mob)1632
74 y
SDict begin H.S end
 1632 74 a 1632 74 a
SDict begin 18.72 H.A end
 1632 74 a 1632 74 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.95.2) cvn /DEST pdfmark end
 1632 74
a -2 242 a
SDict begin H.S end
 -2 242 a -2 242 a
SDict begin 13 H.A end
 -2 242 a -2 242 a
SDict begin [/View [/XYZ H.V]/Dest (0:5197) cvn /DEST pdfmark end
 -2 242
a -2 242 a
SDict begin H.S end
 -2 242 a -2 242 a
SDict begin 13 H.A end
 -2 242 a -2 242 a
SDict begin [/View [/XYZ H.V]/Dest (0:5198) cvn /DEST pdfmark end
 -2 242
a 396 348 a Ff(W)-8 b(ater)21 b(shapes)f(its)h(cour)o(se)f(accor)m
(ding)f(to)h(the)g(natur)m(e)g(of)g(the)g(gr)l(ound)f(o)o(ver)i(whic)o
(h)f(it)g(\003ows.)h Fk(--)f(Sun)g(Tzu)396 622 y(The)g(Flash)h(Mob)e
(comes)h(together)f(in)h(space)h(and)e(time)i(as)f(needed,)f(then)h
(disperses)g(as)h(soon)e(as)i(the)o(y)f(can.)g(Physical)396
730 y(closeness)h(is)g(essential)f(for)g(high-bandwidth)c
(communications.)i(But)j(o)o(v)o(er)d(time)j(it)g(creates)f(technical)f
(ghettos,)396 838 y(where)h(Earth)f(gets)i(separated)e(from)g(Sk)o(y)-5
b(.)19 b(The)h(Flash)h(Mob)e(tends)h(to)h(collect)f(a)h(lot)f(of)g
(frequent)e(\003ier)j(miles.)-2 866 y
SDict begin H.S end
 -2 866 a -2 866
a
SDict begin 13 H.A end
 -2 866 a -2 866 a
SDict begin [/View [/XYZ H.V]/Dest (0:5200) cvn /DEST pdfmark end
 -2 866 a 396 1176 a Fb(7.8.12.)36
b(The)e(Canar)q(y)h(W)-5 b(atc)o(her)1946 1176 y
SDict begin H.S end
 1946
1176 a 1946 1176 a
SDict begin 18.72 H.A end
 1946 1176 a 1946 1176 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.96.2) cvn /DEST pdfmark end
 1946 1176
a -2 1367 a
SDict begin H.S end
 -2 1367 a -2 1367 a
SDict begin 13 H.A end
 -2 1367 a -2 1367 a
SDict begin [/View [/XYZ H.V]/Dest (0:5202) cvn /DEST pdfmark end
 -2
1367 a -2 1367 a
SDict begin H.S end
 -2 1367 a -2 1367 a
SDict begin 13 H.A end
 -2 1367 a -2 1367
a
SDict begin [/View [/XYZ H.V]/Dest (0:5203) cvn /DEST pdfmark end
 -2 1367 a 396 1450 a Ff(P)e(ain)20 b(is)h(not,)f(g)o(ener)o(ally)-5
b(,)19 b(a)i(Good)e(Sign.)-2 1633 y
SDict begin H.S end
 -2 1633 a -2 1633
a
SDict begin 13 H.A end
 -2 1633 a -2 1633 a
SDict begin [/View [/XYZ H.V]/Dest (0:5204) cvn /DEST pdfmark end
 -2 1633 a 396 1724 a Fk(The)h(Canary)g(W)-7
b(atcher)20 b(measures)g(the)g(quality)f(of)h(an)g(or)o(ganization)d
(by)j(the)g(their)g(o)n(wn)g(pain)f(le)n(v)o(el,)h(and)g(the)396
1832 y(observ)o(ed)e(pain)i(le)n(v)o(els)g(of)g(those)g(he)g(w)o(orks)g
(with.)g(He)h(brings)e(ne)n(w)h(participants)f(into)h(e)o(xisting)g(or)
o(ganizations)d(so)396 1940 y(the)o(y)j(can)g(e)o(xpress)f(the)h(ra)o
(w)g(pain)g(of)g(the)g(innocent.)f(He)h(may)g(use)g(alcohol)g(to)g(get)
g(others)g(to)g(v)o(erbalize)f(their)h(pain)396 2048
y(points.)g(He)g(asks)h(others,)e(and)h(himself,)g("are)g(you)f(happ)o
(y)g(in)h(this)h(process,)e(and)h(if)g(not,)g(why)f(not?")h(When)g(an)
396 2156 y(or)o(ganization)d(causes)k(pain)e(in)i(himself)e(or)h
(others,)g(he)g(treats)g(that)h(as)g(a)f(problem)f(to)h(be)g(\002x)o
(ed.)g(People)f(should)g(feel)396 2264 y(jo)o(y)h(in)h(their)f(w)o
(ork.)-2 2292 y
SDict begin H.S end
 -2 2292 a -2 2292 a
SDict begin 13 H.A end
 -2 2292 a -2 2292
a
SDict begin [/View [/XYZ H.V]/Dest (0:5205) cvn /DEST pdfmark end
 -2 2292 a 396 2602 a Fb(7.8.13.)36 b(The)e(Hangman)1584
2602 y
SDict begin H.S end
 1584 2602 a 1584 2602 a
SDict begin 18.72 H.A end
 1584 2602 a 1584 2602
a
SDict begin [/View [/XYZ H.V]/Dest (12.96.97.2) cvn /DEST pdfmark end
 1584 2602 a -2 2795 a
SDict begin H.S end
 -2 2795 a -2 2795 a
SDict begin 13 H.A end
 -2 2795 a
-2 2795 a
SDict begin [/View [/XYZ H.V]/Dest (0:5207) cvn /DEST pdfmark end
 -2 2795 a -2 2795 a
SDict begin H.S end
 -2 2795 a -2 2795 a
SDict begin 13 H.A end
 -2
2795 a -2 2795 a
SDict begin [/View [/XYZ H.V]/Dest (0:5208) cvn /DEST pdfmark end
 -2 2795 a 396 2876 a Ff(Ne)o(ver)21
b(interrupt)f(other)o(s)g(when)g(the)n(y)g(ar)m(e)g(making)g(mistak)o
(es.)-2 3059 y
SDict begin H.S end
 -2 3059 a -2 3059 a
SDict begin 13 H.A end
 -2 3059 a -2 3059
a
SDict begin [/View [/XYZ H.V]/Dest (0:5209) cvn /DEST pdfmark end
 -2 3059 a 396 3150 a Fk(The)g(Hangman)f(kno)n(ws)g(that)h(we)h(learn)
f(only)f(by)h(making)f(mistak)o(es,)h(and)g(he)g(gi)n(v)o(es)f(others)h
(copious)f(rope)g(with)396 3258 y(which)h(to)g(learn.)g(He)g(only)g
(pulls)g(the)g(rope)f(gently)-5 b(,)19 b(when)h(it')-5
b(s)21 b(time.)f(A)h(little)g(tug)f(to)g(remind)f(the)h(other)f(of)h
(their)396 3366 y(precarious)f(position.)g(Allo)n(wing)g(others)h(to)g
(learn)g(by)g(f)o(ailure)f(gi)n(v)o(es)h(the)g(good)f(reason)g(to)i
(stay)-5 b(,)20 b(and)f(the)i(bad)e(e)o(xcuse)396 3474
y(to)i(lea)n(v)o(e.)e(The)h(Hangman)f(is)i(endlessly)f(patient,)f
(because)h(there)f(is)j(no)d(shortcut)h(to)g(the)g(learning)f(process.)
-2 3503 y
SDict begin H.S end
 -2 3503 a -2 3503 a
SDict begin 13 H.A end
 -2 3503 a -2 3503 a
SDict begin [/View [/XYZ H.V]/Dest (0:5210) cvn /DEST pdfmark end
 -2
3503 a 396 3813 a Fb(7.8.14.)36 b(The)e(Historian)1558
3813 y
SDict begin H.S end
 1558 3813 a 1558 3813 a
SDict begin 18.72 H.A end
 1558 3813 a 1558 3813
a
SDict begin [/View [/XYZ H.V]/Dest (12.96.98.2) cvn /DEST pdfmark end
 1558 3813 a -2 3980 a
SDict begin H.S end
 -2 3980 a -2 3980 a
SDict begin 13 H.A end
 -2 3980 a
-2 3980 a
SDict begin [/View [/XYZ H.V]/Dest (0:5212) cvn /DEST pdfmark end
 -2 3980 a -2 3980 a
SDict begin H.S end
 -2 3980 a -2 3980 a
SDict begin 13 H.A end
 -2
3980 a -2 3980 a
SDict begin [/View [/XYZ H.V]/Dest (0:5213) cvn /DEST pdfmark end
 -2 3980 a 396 4087 a Ff(K)m(eeping)20
b(the)g(public)f(r)m(ecor)m(d)h(may)g(be)g(tedious,)g(b)n(ut)g(it')m(s)
h(the)f(only)f(way)i(to)f(pr)m(e)o(vent)g(collusion.)-2
4270 y
SDict begin H.S end
 -2 4270 a -2 4270 a
SDict begin 13 H.A end
 -2 4270 a -2 4270 a
SDict begin [/View [/XYZ H.V]/Dest (0:5214) cvn /DEST pdfmark end
 -2 4270
a 396 4361 a Fk(The)g(Historian)g(forces)f(discussion)h(into)g(the)g
(public)g(vie)n(w)-5 b(,)19 b(to)h(pre)n(v)o(ent)f(collusion)g(to)h(o)n
(wn)g(areas)g(of)g(w)o(ork.)f(The)396 4469 y(Pirate)i(Gang)e(depends)g
(on)h(full)g(and)g(equal)f(communications)f(that)i(do)g(not)g(depend)e
(on)i(momentary)e(presence.)396 4576 y(No-one)h(really)h(reads)g(the)g
(archi)n(v)o(es,)f(b)n(ut)h(the)g(simply)g(possibility)g(stops)g(most)g
(ab)n(uses.)h(The)e(Historian)h(encourages)396 4684 y(the)g(right)g
(tool)g(for)g(the)g(job:)g(email)g(for)f(transient)h(discussions,)g
(IRC)h(for)f(chatter)m(,)f(wikis)h(for)g(kno)n(wledge,)e(issue)396
4792 y(tracking)h(for)h(recording)e(opportunities.)-2
4821 y
SDict begin H.S end
 -2 4821 a -2 4821 a
SDict begin 13 H.A end
 -2 4821 a -2 4821 a
SDict begin [/View [/XYZ H.V]/Dest (0:5215) cvn /DEST pdfmark end
 -2 4821
a Black 3759 5569 a Ff(409)p Black eop end
%%Page: 410 423
TeXDict begin 410 422 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.410) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2769 -132 a Ff(Chapter)20 b(7.)g(The)h(\330MQ)f(Community)p
Black 396 74 a Fb(7.8.15.)36 b(The)e(Pr)n(o)n(v)l(ocateur)1730
74 y
SDict begin H.S end
 1730 74 a 1730 74 a
SDict begin 18.72 H.A end
 1730 74 a 1730 74 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.99.2) cvn /DEST pdfmark end
 1730 74
a -2 242 a
SDict begin H.S end
 -2 242 a -2 242 a
SDict begin 13 H.A end
 -2 242 a -2 242 a
SDict begin [/View [/XYZ H.V]/Dest (0:5217) cvn /DEST pdfmark end
 -2 242
a -2 242 a
SDict begin H.S end
 -2 242 a -2 242 a
SDict begin 13 H.A end
 -2 242 a -2 242 a
SDict begin [/View [/XYZ H.V]/Dest (0:5218) cvn /DEST pdfmark end
 -2 242
a 396 348 a Ff(When)20 b(a)g(man)g(knows)g(he)g(is)i(to)e(be)g(hang)o
(ed)e(in)j(a)f(fortnight,)f(it)i(concentr)o(ates)e(his)i(mind)e
(wonderfully)-5 b(.)20 b Fk(--)g(Samuel)396 456 y(Johnson)-2
623 y
SDict begin H.S end
 -2 623 a -2 623 a
SDict begin 13 H.A end
 -2 623 a -2 623 a
SDict begin [/View [/XYZ H.V]/Dest (0:5219) cvn /DEST pdfmark end
 -2 623 a 396
730 a Fk(The)g(Pro)o(v)n(ocateur)e(creates)i(deadlines,)f(enemies,)h
(and)g(the)g(occasional)f(impossibility)-5 b(.)19 b(T)-6
b(eams)20 b(w)o(ork)g(best)g(when)396 838 y(the)o(y)g(don')o(t)e(ha)n
(v)o(e)i(time)g(for)g(the)g(crap.)f(Deadlines)h(bring)f(people)g
(together)g(and)h(focus)f(the)h(collecti)n(v)o(e)g(mind.)f(An)396
946 y(e)o(xternal)g(enemy)g(can)h(mo)o(v)o(e)f(a)i(passi)n(v)o(e)e
(team)i(into)f(action.)f(The)h(Pro)o(v)n(ocateur)e(ne)n(v)o(er)h(tak)o
(es)h(the)g(deadline)f(too)396 1054 y(seriously)-5 b(.)19
b(The)h(product)e(is)1233 1054 y
SDict begin H.S end
 1233 1054 a 1233 1054
a
SDict begin 13 H.A end
 1233 1054 a 1233 1054 a
SDict begin [/View [/XYZ H.V]/Dest (0:5220) cvn /DEST pdfmark end
 1233 1054 a Ff(always)i Fk(ready)f(to)h
(ship.)g(But)h(he)f(gently)f(reminds)h(the)g(team)g(of)g(the)g(stak)o
(es:)h(f)o(ail,)f(and)g(we)396 1162 y(all)h(look)e(for)h(other)f(jobs.)
-2 1190 y
SDict begin H.S end
 -2 1190 a -2 1190 a
SDict begin 13 H.A end
 -2 1190 a -2 1190 a
SDict begin [/View [/XYZ H.V]/Dest (0:5221) cvn /DEST pdfmark end
 -2
1190 a 396 1500 a Fb(7.8.16.)36 b(The)e(Mystic)1412 1500
y
SDict begin H.S end
 1412 1500 a 1412 1500 a
SDict begin 18.72 H.A end
 1412 1500 a 1412 1500 a
SDict begin [/View [/XYZ H.V]/Dest (12.96.100.2) cvn /DEST pdfmark
end
 1412
1500 a -2 1691 a
SDict begin H.S end
 -2 1691 a -2 1691 a
SDict begin 13 H.A end
 -2 1691 a -2 1691
a
SDict begin [/View [/XYZ H.V]/Dest (0:5223) cvn /DEST pdfmark end
 -2 1691 a -2 1691 a
SDict begin H.S end
 -2 1691 a -2 1691 a
SDict begin 13 H.A end
 -2 1691 a -2
1691 a
SDict begin [/View [/XYZ H.V]/Dest (0:5224) cvn /DEST pdfmark end
 -2 1691 a 396 1774 a Ff(When)20 b(people)f(ar)m(gue)h(or)g
(complain,)f(just)h(write)i(them)e(a)g(Sun)f(Tzu)i(quotation)d
Fk(--)i(Mikk)o(o)g(K)m(oppanen)-2 1958 y
SDict begin H.S end
 -2 1958 a -2
1958 a
SDict begin 13 H.A end
 -2 1958 a -2 1958 a
SDict begin [/View [/XYZ H.V]/Dest (0:5225) cvn /DEST pdfmark end
 -2 1958 a 396 2048 a Fk(The)g(Mystic)h(ne)n
(v)o(er)d(ar)o(gues)h(directly)-5 b(.)19 b(He)i(kno)n(ws)e(that)h(to)h
(ar)o(gue)d(with)j(an)f(emotional)f(person)g(only)g(creates)h(more)396
2156 y(emotion.)f(Instead)g(he)i(side-steps)f(the)g(discussion.)f(It')
-5 b(s)21 b(hard)f(to)g(be)g(angry)f(at)i(a)f(Chinese)g(general,)f
(especially)h(when)396 2264 y(he)g(has)h(been)e(dead)h(for)f(2,400)g
(years.)h(The)f(Mystic)i(plays)f(Hangman)e(when)i(people)f(insist)i(on)
f(the)g(right)g(to)g(get)g(it)396 2372 y(wrong.)p Black
3759 5569 a Ff(410)p Black eop end
%%Page: 411 424
TeXDict begin 411 423 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.411) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:5226) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(8.)f(A)i(Univer)m(se)e(of)h(Mo)m(ving)
g(Pieces)3236 115 y
SDict begin H.S end
 3236 115 a 3236 115 a
SDict begin 26.957 H.A end
 3236 115 a
3236 115 a
SDict begin [/View [/XYZ H.V]/Dest (13.0) cvn /DEST pdfmark end
 3236 115 a -2 373 a
SDict begin H.S end
 -2 373 a -2 373 a
SDict begin 13 H.A end
 -2 373
a -2 373 a
SDict begin [/View [/XYZ H.V]/Dest (0:5228) cvn /DEST pdfmark end
 -2 373 a 396 443 a Fk(So)21 b(f)o(ar)f(in)g(this)h(book)e
(I')l(v)o(e)g(aimed)g(to)i(tak)o(e)f(you)f(though)g(a)h(journe)o(y)e
(of)i(understanding)d(\330MQ)k(in)f(its)h(man)o(y)e(aspects.)396
551 y(By)i(no)n(w)f(you)f(may)h(ha)n(v)o(e)f(started)h(to)h(b)n(uild)e
(your)g(o)n(wn)h(products)f(using)g(the)i(techniques)d(I)j(e)o
(xplained,)d(and)h(others)396 659 y(you')l(v)o(e)e(\002gured)i(out)g
(yourself.)f(Y)-9 b(ou)19 b(will)h(start)g(to)g(f)o(ace)f(questions)g
(about)f(to)i(mak)o(e)f(these)h(products)e(w)o(ork)h(in)g(the)h(real)
396 767 y(w)o(orld.)-2 933 y
SDict begin H.S end
 -2 933 a -2 933 a
SDict begin 13 H.A end
 -2 933
a -2 933 a
SDict begin [/View [/XYZ H.V]/Dest (0:5229) cvn /DEST pdfmark end
 -2 933 a 396 1041 a Fk(But)h(what)f(is)h(that)g("real)f(w)o
(orld"?)f(My)h(vie)n(w)g(is)h(that)g(it)f(is)i(becoming)c(a)i(w)o(orld)
g(of)g(e)n(v)o(er)f(increasing)g(numbers)g(of)396 1149
y(mo)o(ving)f(pieces.)i(Some)g(people)f(use)i(the)f(phrase)g(the)g
("Internet)f(of)g(Things",)g(suggesting)g(that)i(we')o(ll)f(see)h(a)g
(ne)n(w)396 1256 y(cate)o(gory)e(of)h(de)n(vices)f(that)h(are)h(more)e
(numerous)f(b)n(ut)i(rather)g(stupider)f(than)h(our)f(current)g(smart)h
(phones)f(and)h(tablets)396 1364 y(and)g(laptops)g(and)f(serv)o(ers.)h
(Ho)n(we)n(v)o(er)m(,)e(I)i(don')o(t)f(think)g(the)h(data)g(points)g
(this)h(w)o(ay)f(at)h(all.)f(Y)-8 b(es,)20 b(more)g(and)f(more)396
1472 y(de)n(vices,)h(b)n(ut)g(the)o(y')l(re)e(not)i(stupid)g(at)h(all.)
f(The)o(y')l(re)e(smart)j(and)e(po)n(werful)g(and)g(getting)h(more)f
(so)i(all)f(the)g(time.)-2 1656 y
SDict begin H.S end
 -2 1656 a -2 1656 a
SDict begin 13 H.A end

-2 1656 a -2 1656 a
SDict begin [/View [/XYZ H.V]/Dest (0:5230) cvn /DEST pdfmark end
 -2 1656 a 396 1746 a Fk(The)g(mechanism)f(at)i(w)o
(ork)e(is)i(something)e(I)h(call)h("Cost)g(Gra)n(vity")f(and)f(it)i
(has)g(the)f(ef)n(fect)f(of)h(cutting)g(the)g(cost)g(of)396
1854 y(technology)e(by)i(half)g(e)n(v)o(ery)e(18-24)h(months.)g(Or)m(,)
h(put)g(another)e(w)o(ay)-5 b(,)20 b(our)f(global)h(computing)d
(capacity)j(doubles)396 1962 y(e)n(v)o(ery)f(tw)o(o)i(years,)e(o)o(v)o
(er)g(and)h(o)o(v)o(er)e(and)i(o)o(v)o(er)-5 b(.)19 b(The)h(future)f
(is)i(\002lled)g(with)f(trillions)g(of)g(de)n(vices)g(that)g(are)g
(fully)396 2070 y(po)n(werful)f(multi-core)f(computers:)h(the)o(y)g
(don')o(t)g(run)g(some)h(cut-do)n(wn)f("operating)f(system)i(for)g
(things")f(b)n(ut)i(full)396 2178 y(operating)e(systems)h(and)g(full)g
(applications.)-2 2362 y
SDict begin H.S end
 -2 2362 a -2 2362 a
SDict begin 13 H.A end
 -2 2362
a -2 2362 a
SDict begin [/View [/XYZ H.V]/Dest (0:5231) cvn /DEST pdfmark end
 -2 2362 a 396 2452 a Fk(And)g(this)h(is)g(the)f(w)o(orld)g
(we')l(re)f(aiming)h(at)g(with)h(\330MQ.)f(When)g(we)g(talk)h(of)f
("scale")g(we)h(don')o(t)d(mean)i(hundreds)e(of)396 2560
y(computers,)h(or)h(e)n(v)o(en)f(thousands.)f(Think)h(of)h(clouds)g(of)
g(tin)o(y)f(smart)i(and)e(perhaps)g(self-replicating)g(machines)396
2668 y(surrounding)e(e)n(v)o(ery)i(person,)g(\002lling)h(e)n(v)o(ery)f
(space,)h(co)o(v)o(ering)e(e)n(v)o(ery)g(w)o(all,)j(\002lling)f(the)g
(cracks)g(and)g(e)n(v)o(entually)-5 b(,)396 2776 y(becoming)18
b(so)j(much)e(a)i(part)f(of)g(us)g(that)g(we)h(get)f(them)g(before)f
(birth)g(and)h(the)o(y)g(follo)n(w)f(us)i(to)f(death.)-2
2960 y
SDict begin H.S end
 -2 2960 a -2 2960 a
SDict begin 13 H.A end
 -2 2960 a -2 2960 a
SDict begin [/View [/XYZ H.V]/Dest (0:5232) cvn /DEST pdfmark end
 -2 2960
a 396 3050 a Fk(These)g(clouds)g(of)g(tin)o(y)f(machines)h(talk)g(to)g
(each)g(other)m(,)f(all)i(the)f(time,)g(o)o(v)o(er)f(short-range)f
(wireless)j(links,)f(using)f(the)396 3158 y(Internet)g(Protocol.)g(The)
o(y)g(create)h(mesh)g(netw)o(orks,)f(pass)i(information)d(and)h(tasks)i
(around)d(lik)o(e)j(nerv)n(ous)e(signals.)396 3266 y(The)o(y)g(augment)
g(our)g(memory)-5 b(,)18 b(vision,)i(e)n(v)o(ery)f(aspect)h(of)g(our)f
(communications,)f(and)h(physical)g(functions.)g(And)g(it')-5
b(s)396 3373 y(\330MQ)21 b(that)f(po)n(wers)f(their)h(con)m(v)o
(ersations)e(and)i(e)n(v)o(ents)f(and)h(e)o(xchanges)e(of)i(w)o(ork)g
(and)f(information.)-2 3558 y
SDict begin H.S end
 -2 3558 a -2 3558 a
SDict begin 13 H.A end
 -2
3558 a -2 3558 a
SDict begin [/View [/XYZ H.V]/Dest (0:5233) cvn /DEST pdfmark end
 -2 3558 a 396 3647 a Fk(No)n(w)-5 b(,)20
b(to)g(mak)o(e)g(e)n(v)o(en)f(a)i(thin)f(imitation)f(of)h(this)h(come)e
(true)h(today)-5 b(,)19 b(we)h(need)g(to)g(solv)o(e)g(a)h(set)g(of)e
(technical)h(problems)396 3755 y(\(ho)n(w)g(do)f(peers)h(disco)o(v)o
(er)f(each)h(other)m(,)e(ho)n(w)i(do)g(the)o(y)f(talk)i(to)f(e)o
(xisting)f(netw)o(orks)h(lik)o(e)g(the)g(W)-7 b(eb,)21
b(ho)n(w)f(do)f(the)o(y)396 3863 y(protect)h(the)g(information)e(the)o
(y)h(carry)-5 b(,)19 b(ho)n(w)g(do)h(we)h(track)e(and)h(monitor)f
(them,)g(to)i(get)f(some)g(idea)g(of)g(what)g(the)o(y')l(re)396
3971 y(doing\).)f(Then)g(we)h(need)g(to)g(do)g(what)g(most)g(engineers)
f(for)o(get)g(about:)g(package)g(this)i(solution)e(into)h(a)h(frame)n
(w)o(ork)396 4079 y(that)g(is)g(dead)e(easy)h(for)g(ordinary)e(de)n(v)o
(elopers)g(to)i(use.)-2 4263 y
SDict begin H.S end
 -2 4263 a -2 4263 a
SDict begin 13 H.A end
 -2
4263 a -2 4263 a
SDict begin [/View [/XYZ H.V]/Dest (0:5234) cvn /DEST pdfmark end
 -2 4263 a 396 4353 a Fk(This)h(is)g(what)f(we')o(ll)g
(attempt)g(in)h(this)f(chapter:)f(to)i(b)n(uild)f(a)g(frame)n(w)o(ork)e
(for)i(distrib)n(uted)f(applications,)g(as)i(an)f(API)396
4461 y(and)g(an)g(implementation.)e(It')-5 b(s)21 b(not)e(a)i(small)g
(challenge)e(b)n(ut)h(I')l(v)o(e)f(claimed)g(often)h(that)g(\330MQ)h
(mak)o(es)f(such)g(problems)396 4569 y(simple,)g(so)h(let')-5
b(s)21 b(see)g(if)f(that')-5 b(s)21 b(still)g(true.)-2
4753 y
SDict begin H.S end
 -2 4753 a -2 4753 a
SDict begin 13 H.A end
 -2 4753 a -2 4753 a
SDict begin [/View [/XYZ H.V]/Dest (0:5235) cvn /DEST pdfmark end
 -2 4753
a 396 4843 a Fk(W)-7 b(e')o(ll)22 b(co)o(v)o(er:)-2 4844
y
SDict begin H.S end
 -2 4844 a -2 4844 a
SDict begin 13 H.A end
 -2 4844 a -2 4844 a
SDict begin [/View [/XYZ H.V]/Dest (0:5236) cvn /DEST pdfmark end
 -2 4844 a -2
4854 a
SDict begin H.S end
 -2 4854 a -2 4854 a
SDict begin 13 H.A end
 -2 4854 a -2 4854 a
SDict begin [/View [/XYZ H.V]/Dest (0:5237) cvn /DEST pdfmark end
 -2 4854
a Black 396 5013 a Fj(\225)p Black 479 5013 a
SDict begin H.S end
 479 5013
a 479 5013 a
SDict begin 13 H.A end
 479 5013 a 479 5013 a
SDict begin [/View [/XYZ H.V]/Dest (0:5238) cvn /DEST pdfmark end
 479 5013 a Fk(Building)e(a)g(basic)h
(frame)n(w)o(ork)d(for)h(distrib)n(uted)h(computing.)-2
5031 y
SDict begin H.S end
 -2 5031 a -2 5031 a
SDict begin 13 H.A end
 -2 5031 a -2 5031 a
SDict begin [/View [/XYZ H.V]/Dest (0:5239) cvn /DEST pdfmark end
 -2 5031
a Black 3759 5569 a Ff(411)p Black eop end
%%Page: 412 425
TeXDict begin 412 424 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.412) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black -2 94 a Fn(8.1.)39 b(Design)f(f)m(or)h(The)g
(Real)g(W)-9 b(orld)2059 94 y
SDict begin H.S end
 2059 94 a 2059 94 a
SDict begin 22.464 H.A end
 2059
94 a 2059 94 a
SDict begin [/View [/XYZ H.V]/Dest (13.97.1) cvn /DEST pdfmark end
 2059 94 a -2 292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2
292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:5241) cvn /DEST pdfmark end
 -2 292 a 396 368 a Fk(Whether)20 b(we')l(re)f
(connecting)f(a)j(roomful)d(of)i(mobile)g(de)n(vices)f(o)o(v)o(er)g(W)m
(iFi,)i(or)f(a)h(cluster)f(of)g(virtual)f(box)o(es)g(o)o(v)o(er)396
476 y(simulated)h(Ethernet,)f(we)h(will)h(hit)g(the)f(same)g(kinds)g
(of)g(problems.)e(These)i(are:)-2 494 y
SDict begin H.S end
 -2 494 a -2 494
a
SDict begin 13 H.A end
 -2 494 a -2 494 a
SDict begin [/View [/XYZ H.V]/Dest (0:5242) cvn /DEST pdfmark end
 -2 494 a -2 504 a
SDict begin H.S end
 -2 504 a -2 504
a
SDict begin 13 H.A end
 -2 504 a -2 504 a
SDict begin [/View [/XYZ H.V]/Dest (0:5243) cvn /DEST pdfmark end
 -2 504 a Black 396 646 a Fj(\225)p
Black 479 646 a
SDict begin H.S end
 479 646 a 479 646 a
SDict begin 13 H.A end
 479 646 a 479 646
a
SDict begin [/View [/XYZ H.V]/Dest (0:5244) cvn /DEST pdfmark end
 479 646 a 479 646 a
SDict begin H.S end
 479 646 a 479 646 a
SDict begin 13 H.A end
 479 646 a 479
646 a
SDict begin [/View [/XYZ H.V]/Dest (0:5245) cvn /DEST pdfmark end
 479 646 a Ff(Disco)o(very)h Fk(-)f(ho)n(w)g(do)g(we)g(learn)g
(about)f(other)g(nodes)h(on)g(the)g(netw)o(ork?)f(Do)h(we)h(use)f(a)h
(disco)o(v)o(ery)d(service,)479 754 y(centralized)h(mediation,)g(or)h
(some)g(kind)f(of)h(broadcast)f(beacon?)-2 766 y
SDict begin H.S end
 -2 766
a -2 766 a
SDict begin 13 H.A end
 -2 766 a -2 766 a
SDict begin [/View [/XYZ H.V]/Dest (0:5246) cvn /DEST pdfmark end
 -2 766 a Black 396 904 a
Fj(\225)p Black 479 904 a
SDict begin H.S end
 479 904 a 479 904 a
SDict begin 13 H.A end
 479 904
a 479 904 a
SDict begin [/View [/XYZ H.V]/Dest (0:5247) cvn /DEST pdfmark end
 479 904 a 479 904 a
SDict begin H.S end
 479 904 a 479 904 a
SDict begin 13 H.A end
 479
904 a 479 904 a
SDict begin [/View [/XYZ H.V]/Dest (0:5248) cvn /DEST pdfmark end
 479 904 a Ff(Pr)m(esence)h Fk(-)h(ho)n(w)e(do)h(we)h
(track)e(when)h(other)f(nodes)h(come)f(and)h(go?)g(Do)g(we)g(use)h
(some)f(kind)f(of)h(central)479 1012 y(re)o(gistration)f(service,)h(or)
f(heartbeating)g(or)h(beacons?)-2 1029 y
SDict begin H.S end
 -2 1029 a -2
1029 a
SDict begin 13 H.A end
 -2 1029 a -2 1029 a
SDict begin [/View [/XYZ H.V]/Dest (0:5249) cvn /DEST pdfmark end
 -2 1029 a Black 396 1161 a
Fj(\225)p Black 479 1161 a
SDict begin H.S end
 479 1161 a 479 1161 a
SDict begin 13 H.A end
 479
1161 a 479 1161 a
SDict begin [/View [/XYZ H.V]/Dest (0:5250) cvn /DEST pdfmark end
 479 1161 a 479 1161 a
SDict begin H.S end
 479 1161 a 479
1161 a
SDict begin 13 H.A end
 479 1161 a 479 1161 a
SDict begin [/View [/XYZ H.V]/Dest (0:5251) cvn /DEST pdfmark end
 479 1161 a Ff(Connectivity)g
Fk(-)g(ho)n(w)g(do)g(we)g(actually)g(connect)f(one)g(node)g(to)i
(another?)d(Do)j(we)f(use)h(local)f(netw)o(orking,)479
1269 y(wide-area)f(netw)o(orking,)f(or)i(do)g(we)g(use)h(a)f(central)g
(message)g(brok)o(er)f(to)h(do)g(the)g(forw)o(arding?)-2
1287 y
SDict begin H.S end
 -2 1287 a -2 1287 a
SDict begin 13 H.A end
 -2 1287 a -2 1287 a
SDict begin [/View [/XYZ H.V]/Dest (0:5252) cvn /DEST pdfmark end
 -2 1287
a Black 396 1418 a Fj(\225)p Black 479 1418 a
SDict begin H.S end
 479 1418
a 479 1418 a
SDict begin 13 H.A end
 479 1418 a 479 1418 a
SDict begin [/View [/XYZ H.V]/Dest (0:5253) cvn /DEST pdfmark end
 479 1418 a 479 1418
a
SDict begin H.S end
 479 1418 a 479 1418 a
SDict begin 13 H.A end
 479 1418 a 479 1418 a
SDict begin [/View [/XYZ H.V]/Dest (0:5254) cvn /DEST pdfmark end
 479 1418
a Ff(Security)g Fk(-)h(ho)n(w)e(do)h(we)g(protect)g(the)g
(con\002dentiality)e(of)i(information,)e(and)i(mak)o(e)f(sure)h(people)
f(are)i(who)e(the)o(y)479 1526 y(claim)i(to)f(be?)g(Do)g(we)h(use)f(a)h
(centralised)e(trust)h(netw)o(ork,)f(or)h(do)g(we)g(use)h(use)f(some)g
(kind)g(of)g(distrib)n(uted)f(k)o(e)o(y)479 1634 y(management?)-2
1652 y
SDict begin H.S end
 -2 1652 a -2 1652 a
SDict begin 13 H.A end
 -2 1652 a -2 1652 a
SDict begin [/View [/XYZ H.V]/Dest (0:5255) cvn /DEST pdfmark end
 -2 1652
a Black 396 1784 a Fj(\225)p Black 479 1784 a
SDict begin H.S end
 479 1784
a 479 1784 a
SDict begin 13 H.A end
 479 1784 a 479 1784 a
SDict begin [/View [/XYZ H.V]/Dest (0:5256) cvn /DEST pdfmark end
 479 1784 a 479 1784
a
SDict begin H.S end
 479 1784 a 479 1784 a
SDict begin 13 H.A end
 479 1784 a 479 1784 a
SDict begin [/View [/XYZ H.V]/Dest (0:5257) cvn /DEST pdfmark end
 479 1784
a Ff(Unicast)h(messa)o(ging)g Fk(-)g(ho)n(w)g(do)g(we)g(send)g(a)h
(message)f(from)f(one)h(node)f(to)h(another?)f(Do)h(we)g(send)g(this)h
(to)f(the)479 1892 y(node')-5 b(s)20 b(netw)o(ork)f(address,)g(or)h(do)
g(we)h(use)f(some)g(indirect)f(addressing)g(via)h(a)h(centralied)e
(message)h(brok)o(er?)-2 1910 y
SDict begin H.S end
 -2 1910 a -2 1910 a
SDict begin 13 H.A end
 -2
1910 a -2 1910 a
SDict begin [/View [/XYZ H.V]/Dest (0:5258) cvn /DEST pdfmark end
 -2 1910 a Black 396 2041 a Fj(\225)p
Black 479 2041 a
SDict begin H.S end
 479 2041 a 479 2041 a
SDict begin 13 H.A end
 479 2041 a 479
2041 a
SDict begin [/View [/XYZ H.V]/Dest (0:5259) cvn /DEST pdfmark end
 479 2041 a 479 2041 a
SDict begin H.S end
 479 2041 a 479 2041 a
SDict begin 13 H.A end
 479
2041 a 479 2041 a
SDict begin [/View [/XYZ H.V]/Dest (0:5260) cvn /DEST pdfmark end
 479 2041 a Ff(Multicast)g(messa)o(ging)f
Fk(-)h(ho)n(w)f(do)h(we)g(send)f(a)h(message)g(from)f(one)g(node)f(to)i
(a)g(group)e(of)i(others?)f(Do)h(we)g(w)o(ork)f(via)479
2149 y(centralized)g(message)h(brok)o(er)m(,)e(or)i(do)g(we)h(use)f(a)h
(publish-subscribe)c(model)i(lik)o(e)i(\330MQ?)-2 2167
y
SDict begin H.S end
 -2 2167 a -2 2167 a
SDict begin 13 H.A end
 -2 2167 a -2 2167 a
SDict begin [/View [/XYZ H.V]/Dest (0:5261) cvn /DEST pdfmark end
 -2 2167 a Black
396 2298 a Fj(\225)p Black 479 2298 a
SDict begin H.S end
 479 2298 a 479
2298 a
SDict begin 13 H.A end
 479 2298 a 479 2298 a
SDict begin [/View [/XYZ H.V]/Dest (0:5262) cvn /DEST pdfmark end
 479 2298 a 479 2298 a
SDict begin H.S end
 479
2298 a 479 2298 a
SDict begin 13 H.A end
 479 2298 a 479 2298 a
SDict begin [/View [/XYZ H.V]/Dest (0:5263) cvn /DEST pdfmark end
 479 2298 a Ff(F)l(ile)g(tr)o
(ansfer)h Fk(-)f(ho)n(w)e(do)h(we)h(send)f(\002les)h(from)e(one)h(node)
f(to)h(another?)f(Do)h(we)h(centralised)e(protocols)g(lik)o(e)h(FTP)479
2406 y(or)g(HTTP)-9 b(,)20 b(or)g(do)g(we)g(use)h(decentralized)d
(protocols)h(lik)o(e)h(FILEMQ?)-2 2424 y
SDict begin H.S end
 -2 2424 a -2
2424 a
SDict begin 13 H.A end
 -2 2424 a -2 2424 a
SDict begin [/View [/XYZ H.V]/Dest (0:5264) cvn /DEST pdfmark end
 -2 2424 a Black 396 2556 a
Fj(\225)p Black 479 2556 a
SDict begin H.S end
 479 2556 a 479 2556 a
SDict begin 13 H.A end
 479
2556 a 479 2556 a
SDict begin [/View [/XYZ H.V]/Dest (0:5265) cvn /DEST pdfmark end
 479 2556 a 479 2556 a
SDict begin H.S end
 479 2556 a 479
2556 a
SDict begin 13 H.A end
 479 2556 a 479 2556 a
SDict begin [/View [/XYZ H.V]/Dest (0:5266) cvn /DEST pdfmark end
 479 2556 a Ff(Event)g(sync)o(hr)l
(onization)e Fk(-)j(ho)n(w)e(do)h(we)h(ensure)e(that)h(man)o(y)f(nodes)
h(recei)n(v)o(e)f(the)h(same)h(unique)d(stream)i(of)g(e)n(v)o(ents?)479
2664 y(Do)g(we)h(send)f(e)n(v)o(ents)g(via)g(single)g(central)f(point,)
h(or)g(do)f(we)i(use)f(a)h(distrib)n(uted)e(e)n(v)o(entually)g
(consistent)g(model?)-2 2682 y
SDict begin H.S end
 -2 2682 a -2 2682 a
SDict begin 13 H.A end
 -2
2682 a -2 2682 a
SDict begin [/View [/XYZ H.V]/Dest (0:5267) cvn /DEST pdfmark end
 -2 2682 a Black 396 2813 a Fj(\225)p
Black 479 2813 a
SDict begin H.S end
 479 2813 a 479 2813 a
SDict begin 13 H.A end
 479 2813 a 479
2813 a
SDict begin [/View [/XYZ H.V]/Dest (0:5268) cvn /DEST pdfmark end
 479 2813 a 479 2813 a
SDict begin H.S end
 479 2813 a 479 2813 a
SDict begin 13 H.A end
 479
2813 a 479 2813 a
SDict begin [/View [/XYZ H.V]/Dest (0:5269) cvn /DEST pdfmark end
 479 2813 a Ff(Reliability)g Fk(-)h(ho)n(w)f(do)g(we)h
(reco)o(v)o(er)e(from)g(netw)o(ork)h(f)o(ailures)g(that)h(cause)f
(messages)h(to)f(be)h(dropped?)d(Do)j(we)g(use)f(a)479
2921 y(central)h(message)g(serv)o(er)f(with)i(proper)d(transactions,)h
(or)h(do)g(we)g(allo)n(w)h(nodes)e(to)h(reco)o(v)o(er)f(from)g(each)h
(other?)-2 2939 y
SDict begin H.S end
 -2 2939 a -2 2939 a
SDict begin 13 H.A end
 -2 2939 a -2 2939
a
SDict begin [/View [/XYZ H.V]/Dest (0:5270) cvn /DEST pdfmark end
 -2 2939 a Black 396 3070 a Fj(\225)p Black 479 3070
a
SDict begin H.S end
 479 3070 a 479 3070 a
SDict begin 13 H.A end
 479 3070 a 479 3070 a
SDict begin [/View [/XYZ H.V]/Dest (0:5271) cvn /DEST pdfmark end
 479 3070
a 479 3070 a
SDict begin H.S end
 479 3070 a 479 3070 a
SDict begin 13 H.A end
 479 3070 a 479 3070
a
SDict begin [/View [/XYZ H.V]/Dest (0:5272) cvn /DEST pdfmark end
 479 3070 a Ff(Bridging)f Fk(-)i(ho)n(w)e(do)h(we)h(connect)e(our)g
(netw)o(orks)g(across)i(the)f(Internet?)f(Do)h(we)g(use)h(the)f(cloud)f
(as)i(our)f(central)479 3178 y(point)g(for)f(all)i(messaging)e(or)h(do)
g(we)h(create)f(bridges)f(that)h(join)g(groups)f(to)h(other)f(groups?)
-2 3196 y
SDict begin H.S end
 -2 3196 a -2 3196 a
SDict begin 13 H.A end
 -2 3196 a -2 3196 a
SDict begin [/View [/XYZ H.V]/Dest (0:5273) cvn /DEST pdfmark end
 -2
3196 a Black 396 3328 a Fj(\225)p Black 479 3328 a
SDict begin H.S end
 479
3328 a 479 3328 a
SDict begin 13 H.A end
 479 3328 a 479 3328 a
SDict begin [/View [/XYZ H.V]/Dest (0:5274) cvn /DEST pdfmark end
 479 3328 a 479
3328 a
SDict begin H.S end
 479 3328 a 479 3328 a
SDict begin 13 H.A end
 479 3328 a 479 3328 a
SDict begin [/View [/XYZ H.V]/Dest (0:5275) cvn /DEST pdfmark end
 479
3328 a Ff(Lo)o(g)o(ging)g Fk(-)i(ho)n(w)e(do)h(we)h(track)e(what)h
(this)h(cloud)e(of)h(nodes)g(is)h(doing)e(so)h(we)h(can)f(detect)g
(performance)d(problems)479 3436 y(and)j(f)o(ailures?)g(Do)g(we)g
(create)g(a)h(centralized)e(logging)f(service,)i(or)g(do)g(we)g(allo)n
(w)g(e)n(v)o(ery)f(de)n(vice)h(to)g(log)g(the)g(w)o(orld)479
3544 y(around)f(it?)-2 3545 y
SDict begin H.S end
 -2 3545 a -2 3545 a
SDict begin 13 H.A end
 -2
3545 a -2 3545 a
SDict begin [/View [/XYZ H.V]/Dest (0:5276) cvn /DEST pdfmark end
 -2 3545 a Black 396 3693 a Fj(\225)p
Black 479 3693 a
SDict begin H.S end
 479 3693 a 479 3693 a
SDict begin 13 H.A end
 479 3693 a 479
3693 a
SDict begin [/View [/XYZ H.V]/Dest (0:5277) cvn /DEST pdfmark end
 479 3693 a 479 3693 a
SDict begin H.S end
 479 3693 a 479 3693 a
SDict begin 13 H.A end
 479
3693 a 479 3693 a
SDict begin [/View [/XYZ H.V]/Dest (0:5278) cvn /DEST pdfmark end
 479 3693 a Ff(Simulation)g Fk(-)h(ho)n(w)g(do)g(we)g
(simulate)g(lar)o(ge)g(numbers)e(of)i(nodes)g(so)g(we)h(can)f(test)h
(performance)c(properly?)h(Do)i(we)479 3801 y(ha)n(v)o(e)g(to)g(b)n(uy)
g(tw)o(o)g(dozen)f(Android)g(tablets,)h(or)g(can)g(we)h(use)f(pure)f
(softw)o(are)h(simulation?)-2 3985 y
SDict begin H.S end
 -2 3985 a -2 3985
a
SDict begin 13 H.A end
 -2 3985 a -2 3985 a
SDict begin [/View [/XYZ H.V]/Dest (0:5279) cvn /DEST pdfmark end
 -2 3985 a 396 4075 a Fk(If)g(we)h(can)f(solv)o(e)
g(these)g(dozen)f(problems)g(reasonably)f(well,)j(we)f(get)g(something)
f(lik)o(e)i(a)f(frame)n(w)o(ork)e(for)i(what)g(I)396
4183 y(might)g(call)g("Really)h(Cool)f(Distrib)n(uted)g(Applications",)
e(or)i(as)h(my)f(grandkids)e(call)j(it,)g("the)f(softw)o(are)f(our)h(w)
o(orld)396 4291 y(runs)g(on".)-2 4458 y
SDict begin H.S end
 -2 4458 a -2
4458 a
SDict begin 13 H.A end
 -2 4458 a -2 4458 a
SDict begin [/View [/XYZ H.V]/Dest (0:5280) cvn /DEST pdfmark end
 -2 4458 a 396 4565 a Fk(Y)-9
b(ou)20 b(should)f(ha)n(v)o(e)h(guessed)f(from)g(my)h(rhetorical)f
(questions)h(that)g(there)g(are)g(tw)o(o)g(broad)f(directions)g(we)i
(can)f(go.)396 4673 y(One)g(is)g(to)g(centralize)e(e)n(v)o(erything.)f
(The)i(other)g(is)h(to)g(distrib)n(ute)f(e)n(v)o(erything.)d(I'm)j
(going)f(to)i(bet)f(on)g(decentralization.)396 4781 y(If)h(you)g(w)o
(ant)g(centralization,)e(you)i(don')o(t)e(really)i(need)f(\330MQ;)i
(there)f(are)g(other)f(options)g(you)h(can)g(use.)-2
4965 y
SDict begin H.S end
 -2 4965 a -2 4965 a
SDict begin 13 H.A end
 -2 4965 a -2 4965 a
SDict begin [/View [/XYZ H.V]/Dest (0:5281) cvn /DEST pdfmark end
 -2 4965
a 396 5055 a Fk(So)h(v)o(ery)e(roughly)-5 b(,)17 b(here')-5
b(s)20 b(the)g(story)-5 b(.)20 b(One,)f(the)i(number)d(of)i(mo)o(ving)e
(pieces)i(increases)g(e)o(xponentially)e(o)o(v)o(er)h(time)396
5163 y(\(doubles)g(e)n(v)o(ery)g(24)h(months\).)e(T)-7
b(w)o(o,)20 b(these)h(pieces)f(stop)g(using)g(wires)g(since)h(dragging)
d(cables)i(e)n(v)o(erywhere)e(gets)p Black 3759 5569
a Ff(412)p Black eop end
%%Page: 413 426
TeXDict begin 413 425 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.413) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a
SDict begin H.S end
 396 72 a 396 72 a
SDict begin 13 H.A end
 396
72 a 396 72 a
SDict begin [/View [/XYZ H.V]/Dest (0:5282) cvn /DEST pdfmark end
 396 72 a Ff(r)m(eally)h Fk(boring.)d(Three,)h(future)g
(applications)g(run)g(across)i(clusters)f(of)g(these)g(pieces)h(using)e
(the)h(Bene)n(v)n(olent)g(T)-7 b(yrant)396 180 y(pattern)20
b(from)f(Chapter)g(7.)h(F)o(our)m(,)f(today)g(it')-5
b(s)22 b(really)d(dif)n(\002cult,)h(nay)f(still)j(rather)d(impossible,)
g(to)i(b)n(uild)f(such)396 288 y(applications.)f(Fi)n(v)o(e,)h(let')-5
b(s)21 b(mak)o(e)f(it)h(cheap)e(and)h(easy)g(using)g(all)g(the)h
(techniques)d(and)i(tools)g(we')l(v)o(e)f(b)n(uilt)i(up.)e(Six,)396
396 y(partay!)-2 425 y
SDict begin H.S end
 -2 425 a -2 425 a
SDict begin 13 H.A end
 -2 425 a -2
425 a
SDict begin [/View [/XYZ H.V]/Dest (0:5283) cvn /DEST pdfmark end
 -2 425 a 359 x Fn(8.2.)39 b(The)g(Secret)f(Lif)o(e)h(of)g(WiFi)
1822 784 y
SDict begin H.S end
 1822 784 a 1822 784 a
SDict begin 22.464 H.A end
 1822 784 a 1822 784
a
SDict begin [/View [/XYZ H.V]/Dest (13.98.1) cvn /DEST pdfmark end
 1822 784 a -2 952 a
SDict begin H.S end
 -2 952 a -2 952 a
SDict begin 13 H.A end
 -2 952 a -2 952
a
SDict begin [/View [/XYZ H.V]/Dest (0:5285) cvn /DEST pdfmark end
 -2 952 a 396 1058 a Fk(The)20 b(future)f(is)i(clearly)f(wireless,)g
(and)g(while)g(man)o(y)f(big)h(b)n(usinesses)h(li)n(v)o(e)f(by)g
(concentrating)d(data)j(in)h(their)f(clouds,)396 1166
y(the)g(future)f(doesn')o(t)g(look)h(quite)f(so)i(centralized.)e(The)g
(de)n(vices)h(at)h(the)f(edges)g(of)g(our)f(netw)o(orks)g(get)i
(smarter)e(e)n(v)o(ery)396 1274 y(year)m(,)g(not)h(dumber)-5
b(.)19 b(The)o(y')l(re)f(hungry)g(for)h(w)o(ork)h(and)g(information)d
(to)k(digest)f(and)f(pro\002t)h(from.)f(And)h(the)o(y)f(don')o(t)396
1382 y(drag)h(cables)g(around,)e(e)o(xcept)h(once)h(a)g(night)g(for)f
(po)n(wer)-5 b(.)19 b(It')-5 b(s)21 b(all)g(wireless,)g(and)e(more)h
(and)f(more,)g(802.11-branded)396 1489 y(W)m(iFi)i(of)f(dif)n(ferent)f
(alphabetical)g(\003a)n(v)n(ors.)-2 1507 y
SDict begin H.S end
 -2 1507 a
-2 1507 a
SDict begin 13 H.A end
 -2 1507 a -2 1507 a
SDict begin [/View [/XYZ H.V]/Dest (0:5286) cvn /DEST pdfmark end
 -2 1507 a 396 1818 a Fb(8.2.1.)36
b(Wh)n(y)d(Mesh)h(isn't)g(Here)g(Y)-10 b(et)2105 1818
y
SDict begin H.S end
 2105 1818 a 2105 1818 a
SDict begin 18.72 H.A end
 2105 1818 a 2105 1818 a
SDict begin [/View [/XYZ H.V]/Dest (13.98.101.2) cvn /DEST pdfmark
end
 2105
1818 a -2 2008 a
SDict begin H.S end
 -2 2008 a -2 2008 a
SDict begin 13 H.A end
 -2 2008 a -2 2008
a
SDict begin [/View [/XYZ H.V]/Dest (0:5288) cvn /DEST pdfmark end
 -2 2008 a 396 2092 a Fk(As)21 b(such)f(a)h(vital)f(part)g(of)g(our)f
(future,)g(W)m(iFi)i(has)g(a)f(big)g(problem)f(that')-5
b(s)20 b(not)g(often)f(discussed)h(b)n(ut)h(which)e(an)o(yone)396
2199 y(betting)h(on)f(it)i(needs)f(to)g(be)h(a)o(w)o(are)e(of.)h(The)g
(phone)f(companies)f(of)i(the)h(w)o(orld)e(ha)n(v)o(e)h(b)n(uilt)g
(themselv)o(es)g(nice)396 2307 y(pro\002table)f(mobile)h(phone)e
(cartels)j(in)f(nearly)f(e)n(v)o(ery)g(country)g(with)h(a)g
(functioning)e(go)o(v)o(ernment,)f(based)i(on)396 2415
y(con)m(vincing)f(go)o(v)o(ernments)f(that)j(without)g(monopoly)d
(rights)j(to)g(airw)o(a)n(v)o(es)g(and)g(ideas,)g(the)g(w)o(orld)g(w)o
(ould)f(f)o(all)i(apart.)396 2523 y(T)-6 b(echnically)h(,)19
b(we)h(call)h(this)f("re)o(gulatory)e(capture")h(and)h("patents",)f(b)n
(ut)h(in)h(f)o(act)f(it')-5 b(s)21 b(just)g(a)g(form)e(of)h(blackmail)f
(and)396 2631 y(corruption.)f(If)i(you,)f(the)h(state,)h(gi)n(v)o(e)e
(me,)h(a)h(b)n(usiness,)f(the)g(right)g(to)g(o)o(v)o(erchar)o(ge)d(and)
i(tax)h(the)h(mark)o(et,)e(and)g(ban)h(all)396 2739 y(real)g
(competitors,)f(I')o(ll)h(gi)n(v)o(e)g(you)f(5\045.)h(Not)h(enough?)d
(Ho)n(w)i(about)f(10\045?)h(OK,)g(15\045)g(plus)g(snacks.)g(If)g(you)f
(refuse,)396 2847 y(we)i(pull)f(service.)-2 3031 y
SDict begin H.S end
 -2
3031 a -2 3031 a
SDict begin 13 H.A end
 -2 3031 a -2 3031 a
SDict begin [/View [/XYZ H.V]/Dest (0:5289) cvn /DEST pdfmark end
 -2 3031 a 396 3121
a Fk(But)h(W)m(iFi)g(snuck)f(past)g(this,)h(borro)n(wing)c(unlicensed)i
(airspace)h(and)f(riding)g(on)h(the)g(back)g(of)g(the)g(open)f(and)396
3229 y(unpatented)f(and)i(remarkably)e(inno)o(v)n(ati)n(v)o(e)f
(Internet)i(protocol)g(stack.)h(So)g(today)g(we)g(ha)n(v)o(e)g(the)g
(curious)f(situation)396 3337 y(where)h(it)h(costs)g(me)f(se)n(v)o
(eral)f(Euro)g(a)i(minute)e(to)i(call)f(from)g(Seoul)f(to)i(Brussels)g
(if)f(I)h(use)f(the)g(state-back)o(ed)396 3445 y(infrastructure)e(that)
j(we')l(v)o(e)e(subsidized)g(o)o(v)o(er)g(decades,)g(b)n(ut)h(nothing)f
(at)h(all)h(if)g(I)f(can)g(\002nd)g(an)g(unre)o(gulated)e(W)m(iFi)396
3553 y(access)i(point.)f(Oh,)g(and)g(I)g(can)h(do)f(video,)f(and)h
(send)g(\002les,)h(and)f(photos,)f(and)h(do)n(wnload)e(entire)i(home)g
(mo)o(vies)f(all)i(for)396 3661 y(the)g(same)h(amazing)e(price)g(point)
h(of)g(precisely)f(zero)h(point)f(zero)h(zero)g(\(in)g(an)o(y)f
(currenc)o(y)f(you)h(lik)o(e\).)h(God)g(help)f(me)h(if)396
3769 y(I)h(try)f(to)g(send)g(just)h(one)e(photo)g(home)g(using)h(the)g
(service)g(I)h(actually)e(pay)h(for)-5 b(.)20 b(That)f(w)o(ould)h(cost)
g(me)h(more)e(than)h(the)396 3876 y(camera)g(I)g(took)f(it)i(on.)-2
4043 y
SDict begin H.S end
 -2 4043 a -2 4043 a
SDict begin 13 H.A end
 -2 4043 a -2 4043 a
SDict begin [/View [/XYZ H.V]/Dest (0:5290) cvn /DEST pdfmark end
 -2 4043
a 396 4150 a Fk(It)g(is)g(the)f(price)g(we)g(pay)g(for)g(ha)n(ving)f
(tolerated)g(the)h("trust)g(us,)h(we')l(re)e(the)h(e)o(xperts")g
(patent)f(system)i(for)e(so)i(long.)e(But)396 4258 y(more)h(than)f
(that,)h(it')-5 b(s)22 b(a)e(massi)n(v)o(e)g(economic)f(incenti)n(v)o
(e)g(to)h(chunks)f(of)h(the)g(technology)e(sector)i(--)g(and)f
(especially)396 4366 y(chipset)h(mak)o(ers)f(who)h(o)n(wn)f(patents)h
(on)f(the)h(anti-Internet)e(GSM,)i(GPRS,)h(3G,)f(and)f(L)-8
b(TE)20 b(stacks,)g(and)f(who)h(treat)g(the)396 4474
y(telcos)h(as)g(prime)e(clients)i(--)f(to)g(acti)n(v)o(ely)f(throttle)h
(W)m(iFi)h(de)n(v)o(elopment.)c(And)j(of)g(course)f(it')-5
b(s)21 b(these)g(\002rms)f(that)h(b)n(ulk)396 4582 y(out)f(the)g(IEEE)g
(committees)f(that)i(de\002ne)e(W)m(iFi.)-2 4749 y
SDict begin H.S end
 -2
4749 a -2 4749 a
SDict begin 13 H.A end
 -2 4749 a -2 4749 a
SDict begin [/View [/XYZ H.V]/Dest (0:5291) cvn /DEST pdfmark end
 -2 4749 a 396 4856
a Fk(The)h(reason)g(for)f(this)i(rant)f(against)f(la)o(wyer)n(-dri)n(v)
o(en)e("inno)o(v)n(ation")h(is)j(to)f(steer)h(your)e(thinking)f(into)i
("what)g(if)h(W)m(iFi)396 4964 y(w)o(as)g(really)f(free?")g(Because)g
(this)h(will)g(happen)d(one)i(day)-5 b(,)19 b(not)h(too)f(f)o(ar)i(of)n
(f,)e(and)g(it')-5 b(s)22 b(w)o(orth)d(betting)h(on.)f(W)-7
b(e')o(ll)22 b(see)396 5072 y(se)n(v)o(eral)e(things)g(happen.)e
(First,)j(much)e(more)g(aggressi)n(v)o(e)g(use)h(of)g(airspace)g
(especially)g(for)f(near)n(-distance)p Black 3759 5569
a Ff(413)p Black eop end
%%Page: 414 427
TeXDict begin 414 426 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.414) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fk(communications)e(where)h(there)h(is)
h(no)f(risk)g(of)g(interference.)e(Secondly)-5 b(,)18
b(big)i(capacity)g(impro)o(v)o(ements)d(as)k(we)f(learn)396
180 y(to)h(use)f(more)f(airspace)h(in)g(parallel.)g(Thirdly)-5
b(,)18 b(acceleration)h(of)h(the)g(standardization)e(process.)i(Lastly)
-5 b(,)19 b(broader)396 288 y(support)g(in)h(de)n(vices)g(for)g(really)
f(interesting)h(connecti)n(vity)-5 b(.)-2 472 y
SDict begin H.S end
 -2 472
a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:5292) cvn /DEST pdfmark end
 -2 472 a 396 562 a Fk(Right)21
b(no)n(w)e(streaming)g(a)i(mo)o(vie)e(from)g(your)g(phone)g(to)h(your)f
(TV)i(is)g(considered)d("leading)h(edge".)g(This)i(is)396
670 y(ridiculous.)e(Let')-5 b(s)21 b(get)f(truly)f(ambitious.)g(Ho)n(w)
i(about)e(a)h(stadium)g(of)g(people)f(w)o(atching)g(a)i(game,)e
(sharing)g(photos)396 778 y(and)h(HD)h(video)e(with)h(each)g(other)f
(in)i(real)f(time,)g(creating)f(an)h(ad-hoc)f(e)n(v)o(ent)g(that)i
(literally)f(saturates)g(the)g(airspace)396 886 y(with)h(a)f(digital)g
(frenzy)-5 b(.)18 b(I)j(should)e(be)h(able)g(to)g(collect)h(terabytes)e
(of)h(imagery)f(from)g(those)h(around)e(me,)i(in)h(an)f(hour)-5
b(.)396 994 y(Why)20 b(does)g(this)h(ha)n(v)o(e)e(to)i(go)e(through)f
(T)-7 b(witter)21 b(or)f(F)o(acebook)e(and)i(that)g(tin)o(y)g(e)o
(xpensi)n(v)o(e)e(mobile)h(data)h(connection?)396 1102
y(Ho)n(w)g(about)g(a)g(home)f(with)i(hundreds)d(of)i(de)n(vices)f(all)i
(talking)f(to)g(each)g(other)f(o)o(v)o(er)g(mesh,)h(so)g(when)g
(someone)f(rings)396 1210 y(the)h(doorbell,)d(the)j(porch)e(lights)i
(stream)f(video)g(through)e(to)j(your)e(phone)g(or)h(TV?)h(Ho)n(w)f
(about)g(a)h(car)f(that)h(can)f(talk)h(to)396 1318 y(your)f(phone)g
(and)g(play)h(your)f(dubstep)g(playlist)1814 1318 y
SDict begin H.S end
 1814
1318 a 1814 1318 a
SDict begin 13 H.A end
 1814 1318 a 1814 1318 a
SDict begin [/View [/XYZ H.V]/Dest (0:5293) cvn /DEST pdfmark end
 1814 1318
a Ff(without)h(you)g(plug)o(ging)e(in)i(wir)m(es)p Fk(.)-2
1502 y
SDict begin H.S end
 -2 1502 a -2 1502 a
SDict begin 13 H.A end
 -2 1502 a -2 1502 a
SDict begin [/View [/XYZ H.V]/Dest (0:5294) cvn /DEST pdfmark end
 -2 1502
a 396 1592 a Fk(Why)-5 b(,)19 b(in)i(2012,)d(and)i(to)g(get)g(more)g
(serious,)g(is)h(our)e(digital)h(society)g(in)g(the)h(hands)e(of)h
(central)g(points)f(that)i(are)396 1700 y(monitored,)d(censored,)h
(logged,)f(used)i(to)g(track)g(who)g(we)g(talk)h(to,)f(collect)g(e)n
(vidence)f(against)g(us,)h(and)g(then)g(shut)396 1808
y(do)n(wn)f(when)h(the)g(authorities)f(decide)h(we)g(ha)n(v)o(e)g(too)g
(much)f(free)h(speech?)f(The)h(loss)h(of)f(pri)n(v)n(ac)o(y)e(we')l(re)
i(li)n(ving)396 1916 y(through)e(is)i(only)f(a)h(problem)e(when)h(it')
-5 b(s)21 b(one-sided,)d(b)n(ut)i(then)f(the)g(problem)f(is)j
(calamitous.)e(A)h(truly)f(wireless)h(w)o(orld)396 2023
y(w)o(ould)g(bypass)f(all)i(central)f(censorship.)f(It')-5
b(s)20 b(ho)n(w)g(the)g(Internet)f(w)o(as)i(designed,)e(and)g(it')-5
b(s)22 b(quite)e(feasible.)396 2131 y(T)-6 b(echnically)h(.)-2
2160 y
SDict begin H.S end
 -2 2160 a -2 2160 a
SDict begin 13 H.A end
 -2 2160 a -2 2160 a
SDict begin [/View [/XYZ H.V]/Dest (0:5295) cvn /DEST pdfmark end
 -2 2160
a 396 2470 a Fb(8.2.2.)36 b(Some)d(Ph)n(ysics)1535 2470
y
SDict begin H.S end
 1535 2470 a 1535 2470 a
SDict begin 18.72 H.A end
 1535 2470 a 1535 2470 a
SDict begin [/View [/XYZ H.V]/Dest (13.98.102.2) cvn /DEST pdfmark
end
 1535
2470 a -2 2661 a
SDict begin H.S end
 -2 2661 a -2 2661 a
SDict begin 13 H.A end
 -2 2661 a -2 2661
a
SDict begin [/View [/XYZ H.V]/Dest (0:5297) cvn /DEST pdfmark end
 -2 2661 a 396 2744 a Fk(Nai)n(v)o(e)20 b(de)n(v)o(elopers)e(of)i
(distrib)n(uted)f(softw)o(are)h(treat)g(the)g(netw)o(ork)f(as)i
(in\002nitely)f(f)o(ast)h(and)e(perfectly)g(reliable.)h(While)396
2852 y(this)h(is)g(approximately)c(true)j(for)g(simple)g(applications)f
(o)o(v)o(er)g(Ethernet,)g(W)m(iFi)i(rapidly)e(pro)o(v)o(es)f(the)j(dif)
n(ference)396 2960 y(between)f(magical)f(thinking)g(and)g(science.)h
(That)g(is,)h(W)m(iFi)g(breaks)f(so)g(easily)h(and)e(dramatically)g
(under)g(stress)i(that)f(I)396 3068 y(sometimes)g(w)o(onder)f(ho)n(w)h
(an)o(yone)e(w)o(ould)h(dare)h(use)h(it)f(for)g(real)g(w)o(ork.)g(The)f
(ceiling)h(mo)o(v)o(es)f(up,)h(as)h(W)m(iFi)g(gets)396
3176 y(better)m(,)e(b)n(ut)i(ne)n(v)o(er)e(f)o(ast)h(enough)e(to)j
(stop)f(us)h(hitting)e(it.)-2 3360 y
SDict begin H.S end
 -2 3360 a -2 3360
a
SDict begin 13 H.A end
 -2 3360 a -2 3360 a
SDict begin [/View [/XYZ H.V]/Dest (0:5298) cvn /DEST pdfmark end
 -2 3360 a 396 3450 a Fk(T)-7 b(o)21
b(understand)d(ho)n(w)h(W)m(iFi)i(performs)e(technically)g(you)g(need)h
(to)g(understand)e(a)j(basic)f(la)o(w)h(of)e(physics:)h(the)g(po)n(wer)
396 3557 y(required)f(to)h(connect)f(tw)o(o)h(points)g(increases)g
(according)e(to)j(the)f(square)f(of)h(the)g(distance.)g(People)g(who)f
(gro)n(w)h(up)f(in)396 3665 y(lar)o(ger)g(houses)h(ha)n(v)o(e)f(louder)
g(v)n(oices,)g(as)i(I)f(learned)f(in)i(Dallas.)f(F)o(or)g(a)g(W)m(iFi)h
(netw)o(ork)e(this)h(means)g(that)g(as)h(tw)o(o)f(radios)396
3773 y(get)g(further)f(apart,)h(the)o(y)f(ha)n(v)o(e)h(to)g(either)g
(use)g(more)g(po)n(wer)m(,)e(or)i(lo)n(wer)g(their)g(signal)g(rate.)-2
3957 y
SDict begin H.S end
 -2 3957 a -2 3957 a
SDict begin 13 H.A end
 -2 3957 a -2 3957 a
SDict begin [/View [/XYZ H.V]/Dest (0:5299) cvn /DEST pdfmark end
 -2 3957
a 396 4047 a Fk(There')-5 b(s)20 b(only)f(so)i(much)e(po)n(wer)g(you)h
(can)g(pull)g(out)f(of)h(a)h(battery)e(before)g(users)h(treat)h(the)f
(de)n(vice)f(as)i(hopelessly)396 4155 y(brok)o(en.)d(So)j(though)d(a)j
(W)m(iFi)g(netw)o(ork)e(may)h(be)g(rated)g(at)g(some)g(speed,)g(the)g
(real)g(bit)h(rate)f(between)f(the)h(access)h(point)396
4263 y(\(AP\))f(and)g(a)h(client)f(depends)f(on)g(ho)n(w)h(f)o(ar)g
(apart)g(the)g(tw)o(o)h(are.)e(As)i(you)f(mo)o(v)o(e)e(your)h(W)m
(iFi-enabled)g(phone)g(a)o(w)o(ay)396 4371 y(from)g(the)i(AP)-9
b(,)20 b(the)g(tw)o(o)h(radios)e(trying)g(to)i(talk)f(to)g(each)g
(other)g(will)h(\002rst)f(increase)g(their)g(po)n(wer)f(b)n(ut)i(then)e
(reduce)396 4479 y(their)h(bit)h(rate.)-2 4646 y
SDict begin H.S end
 -2 4646
a -2 4646 a
SDict begin 13 H.A end
 -2 4646 a -2 4646 a
SDict begin [/View [/XYZ H.V]/Dest (0:5300) cvn /DEST pdfmark end
 -2 4646 a 396 4753 a
Fk(This)g(ef)n(fect)e(has)i(some)f(consequences)e(we)i(need)g(to)g(be)g
(a)o(w)o(are)g(of)g(if)h(we)f(w)o(ant)h(to)f(b)n(uild)g(rob)n(ust)f
(distrib)n(uted)396 4861 y(applications)g(that)i(don')o(t)d(dangle)h
(wires)i(behind)d(them)i(lik)o(e)h(puppets:)-2 4879 y
SDict begin H.S end

-2 4879 a -2 4879 a
SDict begin 13 H.A end
 -2 4879 a -2 4879 a
SDict begin [/View [/XYZ H.V]/Dest (0:5301) cvn /DEST pdfmark end
 -2 4879 a -2
4889 a
SDict begin H.S end
 -2 4889 a -2 4889 a
SDict begin 13 H.A end
 -2 4889 a -2 4889 a
SDict begin [/View [/XYZ H.V]/Dest (0:5302) cvn /DEST pdfmark end
 -2 4889
a Black 396 5031 a Fj(\225)p Black 479 5031 a
SDict begin H.S end
 479 5031
a 479 5031 a
SDict begin 13 H.A end
 479 5031 a 479 5031 a
SDict begin [/View [/XYZ H.V]/Dest (0:5303) cvn /DEST pdfmark end
 479 5031 a Fk(If)f(you)g(ha)n(v)o(e)
f(a)i(group)d(of)i(de)n(vices)g(talking)f(to)i(an)f(AP)-9
b(,)20 b(when)g(the)g(AP)h(is)g(talking)e(to)i(the)f(slo)n(west)h(de)n
(vice,)e(the)479 5139 y
SDict begin H.S end
 479 5139 a 479 5139 a
SDict begin 13 H.A end
 479 5139
a 479 5139 a
SDict begin [/View [/XYZ H.V]/Dest (0:5304) cvn /DEST pdfmark end
 479 5139 a Ff(whole)h(network)h(has)f(to)g(wait)q
Fk(.)h(It')-5 b(s)21 b(lik)o(e)f(ha)n(ving)f(to)i(repeat)e(a)i(jok)o(e)
f(at)h(a)f(party)g(to)g(the)g(designated)f(dri)n(v)o(er)m(,)f(who)i
(has)p Black 3759 5569 a Ff(414)p Black eop end
%%Page: 415 428
TeXDict begin 415 427 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.415) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 479 72 a Fk(no)g(sense)h(of)f(humor)m(,)e(is)j
(still)g(fully)f(and)f(tragically)h(sober)m(,)f(and)g(has)i(in)f(an)o
(y)f(case)i(a)g(poor)e(grasp)g(of)h(the)g(language.)-2
90 y
SDict begin H.S end
 -2 90 a -2 90 a
SDict begin 13 H.A end
 -2 90 a -2 90 a
SDict begin [/View [/XYZ H.V]/Dest (0:5305) cvn /DEST pdfmark end
 -2 90 a Black 396
222 a Fj(\225)p Black 479 222 a
SDict begin H.S end
 479 222 a 479 222 a
SDict begin 13 H.A end
 479
222 a 479 222 a
SDict begin [/View [/XYZ H.V]/Dest (0:5306) cvn /DEST pdfmark end
 479 222 a Fk(If)g(you)g(use)g(unicast)g(TCP)h(and)f
(send)g(a)g(message)g(to)h(multiple)e(de)n(vices,)h(the)g(AP)h(must)f
(send)g(the)g(pack)o(ets)g(to)g(each)479 330 y(de)n(vice)g(separately)
-5 b(,)18 b(Y)-8 b(es,)21 b(you)e(kne)n(w)g(this,)i(it')-5
b(s)21 b(also)g(ho)n(w)e(Ethernet)g(w)o(orks.)h(But)h(no)n(w)e
(understand)f(that)j(one)479 438 y(distant)f(\(or)g(lo)n(w-po)n
(wered\))d(de)n(vice)j(means)g(e)n(v)o(erything)d(w)o(aits)k(for)f
(that)g(slo)n(west)h(de)n(vice)e(to)i(catch)e(up.)-2
456 y
SDict begin H.S end
 -2 456 a -2 456 a
SDict begin 13 H.A end
 -2 456 a -2 456 a
SDict begin [/View [/XYZ H.V]/Dest (0:5307) cvn /DEST pdfmark end
 -2 456 a Black
396 587 a Fj(\225)p Black 479 587 a
SDict begin H.S end
 479 587 a 479 587
a
SDict begin 13 H.A end
 479 587 a 479 587 a
SDict begin [/View [/XYZ H.V]/Dest (0:5308) cvn /DEST pdfmark end
 479 587 a Fk(If)h(you)g(use)g(multicast)g(or)g
(broadcast)f(\(which)g(w)o(ork)h(the)g(same,)g(in)h(most)f(cases\),)g
(the)g(AP)h(will)g(send)f(single)479 695 y(pack)o(ets)g(to)h(the)f
(whole)f(netw)o(ork)g(at)i(once,)e(which)h(is)h(a)o(wesome,)e(b)n(ut)i
(it)f(will)h(do)f(it)h(at)g(the)f(slo)n(west)h(possible)f(bit)479
803 y(rate)g(\(usually)g(1Mbps\).)f(Y)-9 b(ou)19 b(can)h(adjust)g(this)
h(rate)f(manually)f(in)h(some)g(APs.)h(That)f(just)h(reduces)e(the)h
(reach)g(of)479 911 y(your)f(AP)-9 b(.)21 b(Y)-9 b(ou)19
b(can)h(also)h(b)n(uy)e(more)h(e)o(xpensi)n(v)o(e)e(APs)j(that)f(ha)n
(v)o(e)g(a)h(little)g(more)e(intelligence)g(and)h(will)h(\002gure)e
(out)479 1019 y(the)h(highest)g(bit)h(rate)f(the)o(y)f(can)h(safely)g
(use.)g(Y)-9 b(ou)20 b(can)g(also)g(use)h(enterprise)e(APs)i(with)f
(IGMP)h(\(Internet)d(Group)479 1127 y(Management)g(Protocol\))h
(support)g(and)h(\330MQ')-5 b(s)21 b(PGM)f(transport)f(to)h(send)g
(only)g(to)g(subscribed)f(clients.)h(I')l(d)g(not)479
1235 y(ho)n(we)n(v)o(er)e(bet)j(on)e(such)h(APs)i(being)d(widely)h(a)n
(v)n(ailable,)f(e)n(v)o(er)-5 b(.)-2 1419 y
SDict begin H.S end
 -2 1419 a
-2 1419 a
SDict begin 13 H.A end
 -2 1419 a -2 1419 a
SDict begin [/View [/XYZ H.V]/Dest (0:5309) cvn /DEST pdfmark end
 -2 1419 a 396 1509 a Fk(As)21
b(you)f(try)g(to)g(put)g(more)f(de)n(vices)h(onto)f(an)h(AP)-9
b(,)21 b(performance)c(rapidly)i(gets)h(w)o(orse)h(to)f(the)g(point)g
(where)f(adding)396 1617 y(one)h(more)f(de)n(vice)h(can)g(break)f(the)h
(whole)g(netw)o(ork,)e(for)i(e)n(v)o(eryone.)d(Man)o(y)j(APs)h(solv)o
(e)f(this)g(by)g(randomly)396 1725 y(disconnecting)e(clients)j(when)e
(the)o(y)h(reach)f(some)h(limit,)h(four)e(to)h(eight)g(de)n(vices)g
(for)f(a)i(mobile)e(hotspot,)g(30-50)396 1833 y(de)n(vices)h(for)f(a)i
(consumer)e(AP)-9 b(,)20 b(perhaps)f(100)g(de)n(vices)h(for)f(an)i
(enterprise)e(AP)-9 b(.)-2 1861 y
SDict begin H.S end
 -2 1861 a -2 1861 a
SDict begin 13 H.A end

-2 1861 a -2 1861 a
SDict begin [/View [/XYZ H.V]/Dest (0:5310) cvn /DEST pdfmark end
 -2 1861 a 396 2171 a Fb(8.2.3.)36
b(What')-7 b(s)34 b(the)f(Current)g(Status?)2262 2171
y
SDict begin H.S end
 2262 2171 a 2262 2171 a
SDict begin 18.72 H.A end
 2262 2171 a 2262 2171 a
SDict begin [/View [/XYZ H.V]/Dest (13.98.103.2) cvn /DEST pdfmark
end
 2262
2171 a -2 2339 a
SDict begin H.S end
 -2 2339 a -2 2339 a
SDict begin 13 H.A end
 -2 2339 a -2 2339
a
SDict begin [/View [/XYZ H.V]/Dest (0:5312) cvn /DEST pdfmark end
 -2 2339 a 396 2445 a Fk(Despite)21 b(its)g(uncomfortable)c(role)j(as)
h(enterprise)e(technology)e(that)k(someho)n(w)e(escaped)g(into)h(the)g
(wild,)g(W)m(iFi)h(is)396 2553 y(already)e(useful)h(for)g(more)f(than)h
(getting)f(a)i(free)e(Sk)o(ype)g(call.)i(It')-5 b(s)21
b(not)f(ideal)g(b)n(ut)g(it)h(w)o(orks)f(well)g(enough)f(to)h(let)h(us)
396 2661 y(solv)o(e)f(some)g(interesting)f(problems.)g(Let)h(me)g(gi)n
(v)o(e)g(you)f(a)i(rapid)e(status)i(report.)-2 2845 y
SDict begin H.S end

-2 2845 a -2 2845 a
SDict begin 13 H.A end
 -2 2845 a -2 2845 a
SDict begin [/View [/XYZ H.V]/Dest (0:5313) cvn /DEST pdfmark end
 -2 2845 a 396
2935 a Fk(First,)g(point-to-point)c(v)o(ersus)j(access)g
(point-to-client.)e(T)m(raditional)h(W)m(iFi)i(is)g(all)g(AP-client.)f
(Ev)o(ery)e(pack)o(et)i(has)g(to)396 3043 y(go)g(from)f(client)h(A)h
(to)f(AP)-9 b(,)21 b(thence)e(to)i(client)f(B.)h(Y)-9
b(ou)19 b(cut)i(your)d(bandwidth)h(by)h(50\045)f(b)n(ut)i(that')-5
b(s)20 b(only)g(half)g(the)396 3151 y(problem.)e(I)j(e)o(xplained)d
(about)h(the)i(in)m(v)o(erse)e(po)n(wer)g(la)o(w)-5 b(.)19
b(If)i(A)f(and)g(B)h(are)f(v)o(ery)f(close)i(together)d(b)n(ut)j(both)e
(f)o(ar)h(from)396 3259 y(the)g(AP)-9 b(,)21 b(the)o(y')o(ll)e(both)h
(be)g(using)f(a)i(lo)n(w)f(bit)h(rate.)f(Imagine)f(your)f(AP)j(is)g(in)
g(the)f(garage,)e(and)i(you')l(re)e(in)j(the)f(li)n(ving)396
3367 y(room)f(trying)g(to)i(stream)f(video)f(from)g(your)g(phone)g(to)h
(your)f(TV)-11 b(.)21 b(Good)e(luck!)-2 3551 y
SDict begin H.S end
 -2 3551
a -2 3551 a
SDict begin 13 H.A end
 -2 3551 a -2 3551 a
SDict begin [/View [/XYZ H.V]/Dest (0:5314) cvn /DEST pdfmark end
 -2 3551 a 396 3641 a
Fk(There)h(is)h(an)f(old)g("ad-hoc")e(mode)h(that)i(lets)g(A)f(and)g(B)
h(talk)f(to)h(each)f(other)f(b)n(ut)h(it')-5 b(s)22 b(w)o(ay)e(too)g
(slo)n(w)g(for)g(an)o(ything)e(fun,)396 3748 y(and)i(of)g(course,)f
(it')-5 b(s)21 b(disabled)f(on)g(all)g(mobile)g(chipsets.)g(Actually)-5
b(,)19 b(it')-5 b(s)21 b(disabled)f(in)g(the)g(top-secret)f(dri)n(v)o
(ers)g(that)h(the)396 3856 y(chipset)g(mak)o(ers)g(kindly)f(pro)o(vide)
f(to)i(hardw)o(are)f(mak)o(ers.)h(There)f(is)i(a)g(ne)n(w)f("5G")g(W)m
(iFi)h(standard)e(\(it')-5 b(s)21 b(a)f(mark)o(eting)396
3964 y(term,)g(so)h(goes)e(in)i(quotes\))e(that)h(some)g(\002rms)h(are)
f(pushing:)f(that)h(still)h(needs)f(an)g(AP)h(for)f(disco)o(v)o(ery)e
(b)n(ut)i(does)g(do)g(real)396 4072 y(point-to-point)d(communications.)
h(I)i(assume)g(it')o(ll)h(be)f(restricted)g(in)g(v)n(arious)f(w)o(ays)i
(so)f(as)h(to)g(placate)f(the)g(telcos.)-2 4256 y
SDict begin H.S end
 -2
4256 a -2 4256 a
SDict begin 13 H.A end
 -2 4256 a -2 4256 a
SDict begin [/View [/XYZ H.V]/Dest (0:5315) cvn /DEST pdfmark end
 -2 4256 a 396 4346
a Fk(Lastly)-5 b(,)19 b(we)h(sa)o(w)g(standardization)e(of)h(the)h
(802.11s)e(mesh)h(protocol)f(in)i(2012,)e(after)h(a)h(remarkably)e
(speedy)g(ten)i(years)396 4454 y(or)g(so)h(of)f(w)o(ork.)f(Mesh)h(remo)
o(v)o(es)f(the)h(access)h(point)e(completely)-5 b(,)18
b(at)j(least)g(in)f(the)g(imaginary)f(w)o(orld)g(where)h(it)h(e)o
(xists)396 4562 y(and)f(is)h(widely)e(used.)h(De)n(vices)f(talk)i(to)f
(each)f(other)g(directly)-5 b(,)19 b(and)g(maintain)h(little)g(routing)
f(tables)h(of)g(neighbors)e(that)396 4670 y(let)j(them)f(forw)o(ard)f
(pack)o(ets.)g(Imagine)g(the)h(AP)h(softw)o(are)f(embedded)e(into)i(e)n
(v)o(ery)f(de)n(vice)g(b)n(ut)h(smart)g(enough)f(\(it')-5
b(s)396 4778 y(not)20 b(as)h(impressi)n(v)o(e)e(as)i(it)g(sounds\))e
(to)h(do)g(multiple)g(hops.)-2 4962 y
SDict begin H.S end
 -2 4962 a -2 4962
a
SDict begin 13 H.A end
 -2 4962 a -2 4962 a
SDict begin [/View [/XYZ H.V]/Dest (0:5316) cvn /DEST pdfmark end
 -2 4962 a 396 5052 a Fk(No-one)f(who)h(is)h
(making)e(mone)o(y)f(from)h(the)i(mobile)e(data)h(e)o(xtortion)e(rack)o
(et)i(w)o(ants)h(to)f(see)h(802.11s)d(a)n(v)n(ailable,)396
5160 y(because)i(city-wide)f(mesh)h(is)h(such)f(a)h(nightmare,)d(so)j
(it')-5 b(s)21 b(happening)c(as)k(slo)n(wly)f(as)h(possible.)f(The)g
(only)f(lar)o(ge)p Black 3759 5569 a Ff(415)p Black eop
end
%%Page: 416 429
TeXDict begin 416 428 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.416) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fk(or)o(ganization)d(with)k(the)f(po)n
(wer)f(\(and,)g(I)h(assume)g(the)h(surf)o(ace-to-surf)o(ace)c
(missiles\))k(to)f(get)h(mesh)f(technology)d(into)396
180 y(wide)j(use)h(is)g(the)f(US)h(Army)-5 b(.)19 b(But)i(mesh)f(will)h
(emer)o(ge)d(and)i(I')l(d)f(bet)h(on)g(802.11s)e(being)i(widely)f(a)n
(v)n(ailable)h(in)396 288 y(consumer)f(electronics)g(by)h(2020)f(or)h
(so.)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a -2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:5317) cvn /DEST pdfmark end
 -2
472 a 396 562 a Fk(Second,)f(if)i(we)f(don')o(t)f(ha)n(v)o(e)g
(point-to-point,)e(ho)n(w)j(f)o(ar)g(can)g(we)g(trust)h(APs)g(today?)e
(W)-7 b(ell,)21 b(if)g(you)e(go)h(to)g(a)h(Starb)n(ucks)396
670 y(in)g(the)f(USA)h(and)e(try)h(the)g(\330MQ)h(Hello)f(W)-7
b(orld)20 b(e)o(xample)f(using)h(tw)o(o)g(laptops)g(connected)e(via)i
(the)h(free)e(W)m(iFi,)i(you')o(ll)396 778 y(\002nd)e(the)o(y)f(cannot)
g(connect.)f(Why?)h(W)-7 b(ell,)20 b(the)f(answer)g(is)g(in)g(the)g
(name:)f("attwi\002".)i(A)-9 b(T&T)18 b(is)h(a)h(good)d(old)i
(incumbent)396 886 y(telco)h(that)h(hates)f(W)m(iFi)h(and)f(presumably)
e(pro)o(vides)g(the)j(service)e(cheaply)g(to)i(Starb)n(ucks)e(and)h
(others)g(so)g(that)396 994 y(independents)e(can')o(t)h(get)i(into)e
(the)i(mark)o(et.)e(But)i(an)o(y)e(access)i(point)e(you)h(b)n(uy)f
(will)i(support)e(client-to-AP-to-client)396 1102 y(access,)i(and)e
(outside)h(the)g(USA)h(I')l(v)o(e)e(ne)n(v)o(er)g(found)f(a)j(public)e
(AP)i(lock)o(ed-do)n(wn)c(the)k(A)-9 b(T&T)19 b(w)o(ay)-5
b(.)-2 1286 y
SDict begin H.S end
 -2 1286 a -2 1286 a
SDict begin 13 H.A end
 -2 1286 a -2 1286 a
SDict begin [/View [/XYZ H.V]/Dest (0:5318) cvn /DEST pdfmark end

-2 1286 a 396 1376 a Fk(Third,)19 b(performance.)e(The)j(AP)h(is)g
(clearly)f(a)g(bottleneck;)f(you)g(cannot)g(get)i(better)e(than)h
(50\045)g(of)g(its)h(adv)o(ertised)396 1484 y(speed)f(e)n(v)o(en)f(if)i
(you)e(put)h(A)h(and)e(B)i(literally)f(beside)g(the)g(AP)-9
b(.)21 b(W)-7 b(orse,)20 b(if)h(there)f(are)g(other)f(APs)i(in)g(the)f
(same)g(airspace,)396 1592 y(the)o(y')o(ll)g(shout)f(each)h(other)g
(out.)f(In)h(my)g(home,)f(W)m(iFi)i(barely)e(w)o(orks)h(at)h(all)g
(because)e(the)h(neighbor')-5 b(s)19 b(tw)o(o)h(houses)396
1700 y(do)n(wn)f(ha)n(v)o(e)h(an)g(AP)h(which)f(the)o(y')l(v)o(e)e
(ampli\002ed.)h(Ev)o(en)g(on)h(a)g(dif)n(ferent)f(channel)g(it)i
(interferes)e(with)h(our)g(home)f(W)m(iFi.)396 1808 y(In)h(the)g(cafe)g
(where)g(I'm)g(sitting)g(no)n(w)g(there)f(are)h(o)o(v)o(er)f(a)i(dozen)
e(netw)o(orks.)g(Realistically)-5 b(,)20 b(as)h(long)e(as)i(we')l(re)
396 1916 y(dependent)d(on)i(AP-based)g(W)m(iFi,)g(we')l(re)g(subject)g
(to)g(random)f(interference)f(and)i(unpredictable)d(performance.)-2
2100 y
SDict begin H.S end
 -2 2100 a -2 2100 a
SDict begin 13 H.A end
 -2 2100 a -2 2100 a
SDict begin [/View [/XYZ H.V]/Dest (0:5319) cvn /DEST pdfmark end
 -2 2100
a 396 2190 a Fk(F)o(ourth,)i(battery)g(life.)h(There')-5
b(s)20 b(no)g(inherent)f(reason)g(that)h(W)m(iFi)i(is)f(hungrier)d
(than)h(Bluetooth,)h(for)f(e)o(xample.)g(The)o(y)396
2297 y(use)i(the)f(same)g(radios)g(and)g(lo)n(w-le)n(v)o(el)e(framing.)
h(The)h(dif)n(ferent)e(is)j(tuning)e(and)h(in)g(the)g(protocols.)f(F)o
(or)h(wireless)396 2405 y(po)n(wer)n(-sa)n(ving)f(to)h(w)o(ork)f(well,)
i(de)n(vices)f(ha)n(v)o(e)f(to)h(mostly)g(sleep,)g(and)g(beacon)f(out)h
(to)g(other)f(de)n(vices)h(only)g(once)396 2513 y(e)n(v)o(ery)f(so)i
(often.)e(F)o(or)h(this)g(to)h(w)o(ork,)e(the)o(y)g(need)h(to)g
(synchronize)e(their)i(clocks.)g(This)g(happens)f(properly)f(for)i(the)
396 2621 y(mobile)g(phone)e(part,)i(which)g(is)h(why)e(my)h(old)g
(\003ip)g(phone)f(can)h(run)f(\002)n(v)o(e)h(days)g(on)g(a)h(char)o
(ge.)d(There')-5 b(s)20 b(no)f(technical)396 2729 y(reason)h(W)m(iFi)h
(has)f(to)h(drain)e(the)h(battery)f(e)o(xcept)h(inef)n(\002cient)f
(beaconing)f(and)i(poor)f(tuning)g(of)g(the)i(stack.)f(T)-7
b(oday)i(,)396 2837 y(ho)n(we)n(v)o(er)m(,)18 b(that')-5
b(s)21 b(what)f(we)g(get)g(in)h(those)f(binary)f(closed-source)f(dri)n
(v)o(ers.)-2 3021 y
SDict begin H.S end
 -2 3021 a -2 3021 a
SDict begin 13 H.A end
 -2 3021 a -2
3021 a
SDict begin [/View [/XYZ H.V]/Dest (0:5320) cvn /DEST pdfmark end
 -2 3021 a 396 3111 a Fk(Lastly)-5 b(,)20 b(mobile)f(access)i
(points.)f(If)g(we)g(can')o(t)f(trust)i(centralized)e(APs,)i(and)e(if)i
(our)e(de)n(vices)h(are)g(smart)g(enough)e(to)j(run)396
3219 y(full)f(operating)f(systems,)h(can')o(t)f(we)i(mak)o(e)f(them)f
(w)o(ork)h(as)h(APs?)g(I'm)2478 3219 y
SDict begin H.S end
 2478 3219 a 2478
3219 a
SDict begin 13 H.A end
 2478 3219 a 2478 3219 a
SDict begin [/View [/XYZ H.V]/Dest (0:5321) cvn /DEST pdfmark end
 2478 3219 a Ff(so)f(glad)i
Fk(you)d(ask)o(ed)h(that)g(question.)f(Y)-8 b(es,)20
b(we)396 3327 y(can,)g(and)g(it)h(w)o(orks)e(quite)h(nicely)-5
b(.)19 b(Especially)h(since)g(you)f(can)h(switch)h(this)g(on)e(and)h
(of)n(f)g(in)g(softw)o(are,)f(on)h(a)h(modern)396 3435
y(OS)g(lik)o(e)g(Android.)d(Again,)h(the)h(villains)g(of)g(the)g(peace)
g(are)g(the)g(US)h(telcos,)f(who)g(mostly)g(detest)g(this)h(feature)e
(and)396 3543 y(kill)i(it)g(or)f(cripple)f(it)i(on)f(the)g(phones)f
(the)o(y)g(control.)g(Smarter)h(telcos)g(realize)g(that)g(it')-5
b(s)22 b(a)e(w)o(ay)g(to)h(amplify)e(their)h("last)396
3651 y(mile")h(and)e(bring)g(higher)n(-v)n(alue)f(products)g(to)j(more)
e(users,)h(b)n(ut)g(crooks)g(don')o(t)e(compete)h(on)h(smarts.)-2
3679 y
SDict begin H.S end
 -2 3679 a -2 3679 a
SDict begin 13 H.A end
 -2 3679 a -2 3679 a
SDict begin [/View [/XYZ H.V]/Dest (0:5322) cvn /DEST pdfmark end
 -2 3679
a 396 3989 a Fb(8.2.4.)36 b(Conc)n(lusions)1442 3989
y
SDict begin H.S end
 1442 3989 a 1442 3989 a
SDict begin 18.72 H.A end
 1442 3989 a 1442 3989 a
SDict begin [/View [/XYZ H.V]/Dest (13.98.104.2) cvn /DEST pdfmark
end
 1442
3989 a -2 4157 a
SDict begin H.S end
 -2 4157 a -2 4157 a
SDict begin 13 H.A end
 -2 4157 a -2 4157
a
SDict begin [/View [/XYZ H.V]/Dest (0:5324) cvn /DEST pdfmark end
 -2 4157 a 396 4263 a Fk(W)m(iFi)21 b(is)h(not)d(Ethernet)g(and)h
(although)e(I)j(belie)n(v)o(e)e(future)g(\330MQ)h(applications)f(will)i
(ha)n(v)o(e)f(a)h(v)o(ery)e(important)396 4371 y(decentralized)g
(wireless)h(presence,)f(it')-5 b(s)22 b(not)d(going)g(to)i(be)f(an)g
(easy)g(road.)f(Much)h(of)g(the)g(basic)g(reliability)g(that)g(you)396
4479 y(e)o(xpect)f(from)h(Ethernet)f(is)i(missing.)f(When)g(you)f(run)g
(a)i(distrib)n(uted)e(application)g(o)o(v)o(er)g(W)m(iFi)i(you)e(ha)n
(v)o(e)h(to)g(allo)n(w)g(for)396 4587 y(frequent)f(timeouts,)g(random)g
(latencies,)h(arbitrary)e(disconnections,)g(whole)i(interf)o(aces)f
(going)g(do)n(wn)g(and)h(coming)396 4695 y(up,)g(and)f(so)i(on.)-2
4879 y
SDict begin H.S end
 -2 4879 a -2 4879 a
SDict begin 13 H.A end
 -2 4879 a -2 4879 a
SDict begin [/View [/XYZ H.V]/Dest (0:5325) cvn /DEST pdfmark end
 -2 4879
a 396 4969 a Fk(The)f(technological)e(e)n(v)n(olution)h(of)h(wireless)h
(netw)o(orking)d(is)j(best)f(described)f(as)i("slo)n(w)f(and)g(jo)o
(yless".)g(Applications)396 5077 y(and)g(frame)n(w)o(orks)e(that)j(try)
f(to)g(e)o(xploit)f(decentralized)f(wireless)j(are)f(absent)g(or)g
(poor)-5 b(.)19 b(But)i(with)f(\330MQ)h(we)f(pro)o(v)o(ed)p
Black 3757 5569 a Ff(416)p Black eop end
%%Page: 417 430
TeXDict begin 417 429 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.417) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fk(that)h(the)f(inertia)g(and)f
(decrepit)g(incompetence)f(of)i(e)o(xisting)g(players)f(w)o(as)i(no)f
(reason)f(for)h(us)h(to)f(sit)h(still.)g(When)f(we)396
180 y(accurately)f(understand)f(problems,)h(we)h(can)g(solv)o(e)g
(them.)g(What)g(we)h(imagine,)e(we)h(can)g(mak)o(e)g(real.)-2
292 y
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:5326) cvn /DEST pdfmark end
 -2 292 a 359
x Fn(8.3.)39 b(Pr)m(omixity-based)d(Netw)m(orking)2211
651 y
SDict begin H.S end
 2211 651 a 2211 651 a
SDict begin 22.464 H.A end
 2211 651 a 2211 651 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.1) cvn /DEST pdfmark end
 2211
651 a -2 849 a
SDict begin H.S end
 -2 849 a -2 849 a
SDict begin 13 H.A end
 -2 849 a -2 849 a
SDict begin [/View [/XYZ H.V]/Dest (0:5328) cvn /DEST pdfmark end
 -2
849 a 396 925 a Fk(One)20 b(of)g(the)g(great)g(things)g(about)f
(short-range)f(wireless)j(is)g(that)f(it)h(maps)f(closely)g(to)g(the)h
(physical)e(space,)h(which)396 1033 y(maps)g(closely)g(to)h(ho)n(w)e
(we)i(naturally)e(or)o(ganize.)e(In)j(f)o(act)g(the)h(Internet)e(is)i
(quite)e(abstract)h(and)g(this)h(confuses)e(a)i(lot)f(of)396
1141 y(people)f(who)h(kind)f(of)h("get")g(it)h(b)n(ut)f(in)h(f)o(act)f
(don')o(t)f(really)-5 b(.)19 b(W)m(ith)h(W)m(iFi)h(we)g(ha)n(v)o(e)f
(technical)f(connecti)n(vity)f(that)i(is)396 1249 y(potentially)f
(super)n(-tangible.)f(Y)-9 b(ou)20 b(see)g(what)h(you)e(get)h(and)g
(you)f(get)h(what)g(you)g(see.)g(T)-7 b(angible)19 b(means)h(easy)h(to)
396 1357 y(understand)d(and)i(that)g(means)g(lo)o(v)o(e)f(from)g(users)
i(instead)f(of)g(the)g(typical)g(frustration)e(and)i(hate.)-2
1541 y
SDict begin H.S end
 -2 1541 a -2 1541 a
SDict begin 13 H.A end
 -2 1541 a -2 1541 a
SDict begin [/View [/XYZ H.V]/Dest (0:5329) cvn /DEST pdfmark end
 -2 1541
a 396 1631 a Fk(Proximity)f(is)i(the)g(k)o(e)o(y)-5 b(.)18
b(W)-7 b(e)22 b(ha)n(v)o(e)d(a)i(b)n(unch)e(of)h(W)m(iFi)h(radios)f(in)
g(room,)f(happily)g(beaconing)f(to)i(each)g(other)-5
b(.)19 b(F)o(or)h(lots)396 1739 y(of)g(applications)f(it)i(mak)o(es)f
(sense)h(that)f(the)o(y)f(can)h(\002nd)g(each)g(other)g(and)f(start)i
(chatting,)e(without)g(an)o(y)h(user)g(input.)396 1846
y(After)g(all,)h(most)f(real)g(w)o(orld)g(data)g(isn')o(t)g(pri)n(v)n
(ate,)f(it')-5 b(s)21 b(just)g(highly)e(localized.)-2
2030 y
SDict begin H.S end
 -2 2030 a -2 2030 a
SDict begin 13 H.A end
 -2 2030 a -2 2030 a
SDict begin [/View [/XYZ H.V]/Dest (0:5330) cvn /DEST pdfmark end
 -2 2030
a 396 2120 a Fk(As)i(a)g(\002rst)g(step)f(to)n(w)o(ards)g(\330MQ-based)
f(proximity)f(netw)o(orking,)g(let')-5 b(s)21 b(look)f(at)g(ho)n(w)g
(to)g(do)g(disco)o(v)o(ery)-5 b(.)18 b(There)h(e)o(xist)396
2228 y(libraries)h(that)g(do)g(this.)h(I)f(don')o(t)f(lik)o(e)h(them.)g
(The)o(y)f(seem)h(too)g(comple)o(x)e(and)i(too)g(speci\002c)g(and)g
(someho)n(w)f(to)h(date)396 2336 y(from)f(a)i(prehistoric)e(era)h
(before)f(people)g(realized)g(that)i(distrib)n(uted)e(computing)f
(could)h(be)3092 2336 y
SDict begin H.S end
 3092 2336 a 3092 2336 a
SDict begin 13 H.A end
 3092
2336 a 3092 2336 a
SDict begin [/View [/XYZ H.V]/Dest (0:5331) cvn /DEST pdfmark end
 3092 2336 a Ff(fundamentally)f(simple)p
Fk(.)-2 2354 y
SDict begin H.S end
 -2 2354 a -2 2354 a
SDict begin 13 H.A end
 -2 2354 a -2 2354
a
SDict begin [/View [/XYZ H.V]/Dest (0:5332) cvn /DEST pdfmark end
 -2 2354 a 396 2664 a Fb(8.3.1.)36 b(Preemptive)e(Disco)n(ver)q(y)i(o)
n(ver)d(Ra)n(w)h(Soc)n(kets)3025 2664 y
SDict begin H.S end
 3025 2664 a 3025
2664 a
SDict begin 18.72 H.A end
 3025 2664 a 3025 2664 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.105.2) cvn /DEST pdfmark
end
 3025 2664 a -2 2855 a
SDict begin H.S end

-2 2855 a -2 2855 a
SDict begin 13 H.A end
 -2 2855 a -2 2855 a
SDict begin [/View [/XYZ H.V]/Dest (0:5334) cvn /DEST pdfmark end
 -2 2855 a 396
2938 a Fk(I'm)20 b(in)g(a)h(hotel)f(room)f(in)h(Gangnam,)e(Seoul,)i
(with)g(a)h(4G)f(wireless)h(hotspot,)e(a)i(Linux)e(laptop,)g(and)g(an)i
(couple)e(of)396 3046 y(Android)g(phones.)f(The)i(phones)f(and)h
(laptop)f(are)h(talking)g(to)g(the)g(hotspot.)f(The)2762
3046 y
SDict begin H.S end
 2762 3046 a 2762 3046 a
SDict begin 13 H.A end
 2762 3046 a 2762 3046
a
SDict begin [/View [/XYZ H.V]/Dest (0:5335) cvn /DEST pdfmark end
 2762 3046 a Fe(ifconfig)h Fk(command)e(says)i(my)g(IP)396
3154 y(address)g(is)h(192.168.1.2.)16 b(Let)k(me)h(try)f(some)1741
3154 y
SDict begin H.S end
 1741 3154 a 1741 3154 a
SDict begin 13 H.A end
 1741 3154 a 1741 3154
a
SDict begin [/View [/XYZ H.V]/Dest (0:5336) cvn /DEST pdfmark end
 1741 3154 a Fe(ping)g Fk(commands.)e(DHCP)j(serv)o(ers)f(tend)f(to)i
(dish)f(out)g(addresses)g(in)396 3262 y(sequence,)f(so)i(my)e(phones)g
(are)i(probably)c(close)k(by)-5 b(,)19 b(numerically)f(speaking:)-2
3363 y
SDict begin H.S end
 -2 3363 a -2 3363 a
SDict begin 11.7 H.A end
 -2 3363 a -2 3363 a
SDict begin [/View [/XYZ H.V]/Dest (0:5337) cvn /DEST pdfmark end
 -2 3363
a 396 3442 a Fe($)45 b(ping)f(192.168.1.1)396 3539 y(PING)g
(192.168.1.1)f(\(192.168.1.1\))g(56\(84\))h(bytes)g(of)g(data.)396
3637 y(64)h(bytes)f(from)g(192.168.1.1:)f(icmp_req=1)g(ttl=64)h
(time=376)f(ms)396 3734 y(64)i(bytes)f(from)g(192.168.1.1:)f
(icmp_req=2)g(ttl=64)h(time=358)f(ms)396 3831 y(64)i(bytes)f(from)g
(192.168.1.1:)f(icmp_req=4)g(ttl=64)h(time=167)f(ms)396
3928 y(^C)396 4025 y(---)i(192.168.1.1)e(ping)h(statistics)f(---)396
4122 y(3)i(packets)f(transmitted,)e(2)j(received,)e(33\045)i(packet)f
(loss,)g(time)g(2001ms)396 4219 y(rtt)h(min/avg/max/mdev)d(=)i
(358.077/367.522/376.967/9.445)c(ms)-2 4397 y
SDict begin H.S end
 -2 4397
a -2 4397 a
SDict begin 13 H.A end
 -2 4397 a -2 4397 a
SDict begin [/View [/XYZ H.V]/Dest (0:5338) cvn /DEST pdfmark end
 -2 4397 a 396 4493 a
Fk(F)o(ound)19 b(one!)g(150-300)f(msec)i(round-trip)e(latenc)o(y)-5
b(...)18 b(that')-5 b(s)20 b(a)h(surprisingly)d(high)i(\002gure,)f
(something)g(to)h(k)o(eep)g(in)396 4601 y(mind)g(for)f(later)-5
b(.)21 b(No)n(w)f(I)g(ping)g(myself,)f(just)i(to)f(try)g(to)g(double)f
(check)h(things:)-2 4702 y
SDict begin H.S end
 -2 4702 a -2 4702 a
SDict begin 11.7 H.A end
 -2 4702
a -2 4702 a
SDict begin [/View [/XYZ H.V]/Dest (0:5339) cvn /DEST pdfmark end
 -2 4702 a 396 4781 a Fe($)45 b(ping)f(192.168.1.2)396
4879 y(PING)g(192.168.1.2)f(\(192.168.1.2\))g(56\(84\))h(bytes)g(of)g
(data.)396 4976 y(64)h(bytes)f(from)g(192.168.1.2:)f(icmp_req=1)g
(ttl=64)h(time=0.054)f(ms)396 5073 y(64)i(bytes)f(from)g(192.168.1.2:)f
(icmp_req=2)g(ttl=64)h(time=0.055)f(ms)396 5170 y(64)i(bytes)f(from)g
(192.168.1.2:)f(icmp_req=3)g(ttl=64)h(time=0.061)f(ms)p
Black 3756 5569 a Ff(417)p Black eop end
%%Page: 418 431
TeXDict begin 418 430 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.418) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fe(^C)396 170 y(---)45
b(192.168.1.2)e(ping)h(statistics)f(---)396 267 y(3)i(packets)f
(transmitted,)e(3)j(received,)e(0\045)i(packet)f(loss,)g(time)g(1998ms)
396 364 y(rtt)h(min/avg/max/mdev)d(=)i(0.054/0.056/0.061/0.009)d(ms)-2
541 y
SDict begin H.S end
 -2 541 a -2 541 a
SDict begin 13 H.A end
 -2 541 a -2 541 a
SDict begin [/View [/XYZ H.V]/Dest (0:5340) cvn /DEST pdfmark end
 -2 541 a 396
638 a Fk(The)20 b(response)f(time)i(is)g(a)f(bit)h(f)o(aster)f(no)n(w)
-5 b(,)19 b(which)h(is)h(what)f(we')l(d)g(e)o(xpect.)f(Let')-5
b(s)20 b(try)g(the)h(ne)o(xt)e(couple)g(of)h(addresses:)-2
739 y
SDict begin H.S end
 -2 739 a -2 739 a
SDict begin 11.7 H.A end
 -2 739 a -2 739 a
SDict begin [/View [/XYZ H.V]/Dest (0:5341) cvn /DEST pdfmark end
 -2 739 a 396
818 a Fe($)45 b(ping)f(192.168.1.3)396 915 y(PING)g(192.168.1.3)f
(\(192.168.1.3\))g(56\(84\))h(bytes)g(of)g(data.)396
1012 y(64)h(bytes)f(from)g(192.168.1.3:)f(icmp_req=1)g(ttl=64)h
(time=291)f(ms)396 1109 y(64)i(bytes)f(from)g(192.168.1.3:)f
(icmp_req=2)g(ttl=64)h(time=271)f(ms)396 1207 y(64)i(bytes)f(from)g
(192.168.1.3:)f(icmp_req=3)g(ttl=64)h(time=132)f(ms)396
1304 y(^C)396 1401 y(---)i(192.168.1.3)e(ping)h(statistics)f(---)396
1498 y(3)i(packets)f(transmitted,)e(3)j(received,)e(0\045)i(packet)f
(loss,)g(time)g(2001ms)396 1595 y(rtt)h(min/avg/max/mdev)d(=)i
(132.781/231.914/291.851/70.609)c(ms)-2 1773 y
SDict begin H.S end
 -2 1773
a -2 1773 a
SDict begin 13 H.A end
 -2 1773 a -2 1773 a
SDict begin [/View [/XYZ H.V]/Dest (0:5342) cvn /DEST pdfmark end
 -2 1773 a 396 1869 a
Fk(That')-5 b(s)21 b(the)f(second)f(phone,)g(with)h(the)g(same)g(kind)g
(of)g(latenc)o(y)f(as)i(the)f(\002rst)h(one.)e(Let')-5
b(s)21 b(continue,)e(see)h(if)h(there)f(are)396 1977
y(an)o(y)g(other)f(de)n(vices)h(connected)e(to)i(the)h(hotspot:)-2
2078 y
SDict begin H.S end
 -2 2078 a -2 2078 a
SDict begin 11.7 H.A end
 -2 2078 a -2 2078 a
SDict begin [/View [/XYZ H.V]/Dest (0:5343) cvn /DEST pdfmark end
 -2 2078
a 396 2157 a Fe($)45 b(ping)f(192.168.1.4)396 2254 y(PING)g
(192.168.1.4)f(\(192.168.1.4\))g(56\(84\))h(bytes)g(of)g(data.)396
2351 y(^C)396 2449 y(---)h(192.168.1.4)e(ping)h(statistics)f(---)396
2546 y(3)i(packets)f(transmitted,)e(0)j(received,)e(100\045)i(packet)e
(loss,)h(time)h(2016ms)-2 2723 y
SDict begin H.S end
 -2 2723 a -2 2723 a
SDict begin 13 H.A end

-2 2723 a -2 2723 a
SDict begin [/View [/XYZ H.V]/Dest (0:5344) cvn /DEST pdfmark end
 -2 2723 a 396 2820 a Fk(And)20 b(that)g(is)h(it.)g
(No)n(w)-5 b(,)1065 2820 y
SDict begin H.S end
 1065 2820 a 1065 2820 a
SDict begin 13 H.A end
 1065
2820 a 1065 2820 a
SDict begin [/View [/XYZ H.V]/Dest (0:5345) cvn /DEST pdfmark end
 1065 2820 a Fe(ping)20 b Fk(uses)g(ra)o(w)g(IP)h
(sock)o(ets)f(to)h(send)e(ICMP_ECHO)i(messages.)f(The)g(useful)f(thing)
h(about)396 2928 y(ICMP_ECHO)h(is)g(that)f(it)h(gets)f(a)h(response)e
(from)g(an)o(y)h(IP)g(stack)h(that)f(has)g(not)g(been)g(deliberately)e
(had)i(echo)396 3036 y(switched)g(of)n(f.)f(That')-5
b(s)21 b(still)g(a)g(common)d(practice)i(on)f(corporate)g(websites)h
(who)g(fear)g(the)g(old)g("ping)f(of)h(death")396 3143
y(e)o(xploit)f(where)h(malformed)e(messages)i(could)g(crash)g(the)g
(machine.)-2 3327 y
SDict begin H.S end
 -2 3327 a -2 3327 a
SDict begin 13 H.A end
 -2 3327 a -2
3327 a
SDict begin [/View [/XYZ H.V]/Dest (0:5346) cvn /DEST pdfmark end
 -2 3327 a 396 3417 a Fk(I)h(call)f(this)726 3417
y
SDict begin H.S end
 726 3417 a 726 3417 a
SDict begin 13 H.A end
 726 3417 a 726 3417 a
SDict begin [/View [/XYZ H.V]/Dest (0:5347) cvn /DEST pdfmark end
 726 3417
a Ff(pr)m(e-emptive)f(disco)o(very)h Fk(since)h(it)g(doesn')o(t)d(tak)o
(e)i(an)o(y)g(cooperation)e(from)h(the)h(de)n(vice.)f(W)-7
b(e)21 b(don')o(t)e(rely)h(on)396 3525 y(an)o(y)g(cooperation)d(from)j
(the)g(phones)f(to)h(see)h(them)f(sitting)g(there;)g(as)h(long)e(as)i
(the)o(y')l(re)d(not)i(acti)n(v)o(ely)g(ignoring)e(us,)i(we)396
3633 y(can)g(see)h(them.)-2 3800 y
SDict begin H.S end
 -2 3800 a -2 3800
a
SDict begin 13 H.A end
 -2 3800 a -2 3800 a
SDict begin [/View [/XYZ H.V]/Dest (0:5348) cvn /DEST pdfmark end
 -2 3800 a 396 3907 a Fk(Y)-9 b(ou)20
b(might)f(ask)i(why)e(this)i(is)g(useful.)e(W)-7 b(e)22
b(don')o(t)c(kno)n(w)h(that)i(the)f(peers)g(responding)e(to)i
(ICMP_ECHO)g(run)g(\330MQ,)396 4015 y(that)h(the)o(y)e(are)h
(interested)g(in)g(talking)f(to)i(us,)f(that)g(the)o(y)g(ha)n(v)o(e)f
(an)o(y)h(services)g(we)h(can)f(use,)g(or)g(e)n(v)o(en)f(what)h(kind)f
(of)396 4123 y(de)n(vice)h(the)o(y)f(are.)h(Ho)n(we)n(v)o(er)m(,)e(kno)
n(wing)g(that)j(there')-5 b(s)1971 4123 y
SDict begin H.S end
 1971 4123 a
1971 4123 a
SDict begin 13 H.A end
 1971 4123 a 1971 4123 a
SDict begin [/View [/XYZ H.V]/Dest (0:5349) cvn /DEST pdfmark end
 1971 4123 a Ff(something)19
b Fk(on)h(address)f(192.168.1.3)d(is)21 b(already)f(useful.)f(W)-7
b(e)396 4231 y(also)21 b(kno)n(w)e(ho)n(w)h(f)o(ar)g(a)o(w)o(ay)f(the)i
(de)n(vice)e(is,)i(relati)n(v)o(ely)-5 b(,)18 b(we)j(kno)n(w)e(ho)n(w)h
(man)o(y)f(de)n(vices)g(are)h(on)g(the)g(netw)o(ork,)f(and)h(we)396
4339 y(kno)n(w)f(the)i(rough)d(state)j(of)f(the)g(netw)o(ork)f(\(as)i
(in,)f(good,)e(poor)m(,)h(or)h(terrible\).)-2 4523 y
SDict begin H.S end

-2 4523 a -2 4523 a
SDict begin 13 H.A end
 -2 4523 a -2 4523 a
SDict begin [/View [/XYZ H.V]/Dest (0:5350) cvn /DEST pdfmark end
 -2 4523 a 396
4613 a Fk(It)h(isn')o(t)f(e)n(v)o(en)f(hard)g(to)h(create)g(ICMP_ECHO)h
(messages)f(and)g(send)f(them.)h(A)h(fe)n(w)f(dozen)f(lines)h(of)g
(code,)g(and)f(we)396 4721 y(could)g(use)i(\330MQ)f(multithreading)e
(to)i(do)g(this)h(in)f(parallel)g(for)g(addresses)f(stretching)h(out)f
(abo)o(v)o(e)g(and)h(belo)n(w)f(our)396 4829 y(o)n(wn)h(IP)g(address.)g
(Could)g(be)g(kind)f(of)h(fun.)p Black 3759 5569 a Ff(418)p
Black eop end
%%Page: 419 432
TeXDict begin 419 431 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.419) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5351) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(Ho)n(we)n(v)o(er)m(,)e(sadly)-5
b(,)20 b(there')-5 b(s)20 b(a)g(f)o(atal)h(\003a)o(w)f(in)h(my)f(idea)g
(of)g(using)f(ICMP_ECHO)h(to)h(disco)o(v)o(er)d(de)n(vices.)i(T)-7
b(o)20 b(open)f(a)i(ra)o(w)396 180 y(IP)g(sock)o(et)f(requires)f(root)h
(pri)n(vile)o(ges)e(on)i(a)h(POSIX)f(box.)f(It)i(stops)f(rogue)f
(programs)f(getting)i(data)g(meant)g(for)f(others.)396
288 y(W)-7 b(e)22 b(can)e(get)g(the)g(po)n(wer)f(to)i(open)e(ra)o(w)h
(sock)o(ets)g(on)g(Linux)f(by)h(gi)n(ving)e(sudo)i(pri)n(vile)o(ges)f
(to)h(our)g(command)e(\(ping)h(has)396 396 y(the)h(stick)o(y)g(bit)h
(set\).)f(On)g(a)h(mobile)e(OS)i(lik)o(e)g(Android,)d(it)j(requires)e
(root)g(access,)i(i.e.)f(rooting)f(the)h(phone)f(or)h(tablet.)396
504 y(That')-5 b(s)21 b(out)e(of)h(the)h(question)e(for)g(most)h
(people)g(and)f(so)i(ICMP_ECHO)f(is)h(out)f(of)g(reach)f(for)h(most)g
(de)n(vices.)-2 688 y
SDict begin H.S end
 -2 688 a -2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688
a
SDict begin [/View [/XYZ H.V]/Dest (0:5352) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(Expleti)n(v)o(e)f(deleted!)g(Let')-5
b(s)21 b(try)f(something)f(in)h(user)g(space.)g(The)g(ne)o(xt)f(step)i
(most)f(people)f(tak)o(e)h(is)h(UDP)g(multicast)f(or)396
886 y(broadcast.)-2 897 y
SDict begin H.S end
 -2 897 a -2 897 a
SDict begin 13 H.A end
 -2 897 a
-2 897 a
SDict begin [/View [/XYZ H.V]/Dest (0:5353) cvn /DEST pdfmark end
 -2 897 a 396 1225 a Fb(8.3.2.)36 b(Cooperative)f(Disco)n(ver)q
(y)g(using)f(UDP)g(Br)n(oadcasts)3341 1225 y
SDict begin H.S end
 3341 1225
a 3341 1225 a
SDict begin 18.72 H.A end
 3341 1225 a 3341 1225 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.106.2) cvn /DEST pdfmark
end
 3341 1225 a -2
1417 a
SDict begin H.S end
 -2 1417 a -2 1417 a
SDict begin 13 H.A end
 -2 1417 a -2 1417 a
SDict begin [/View [/XYZ H.V]/Dest (0:5355) cvn /DEST pdfmark end
 -2 1417
a 396 1499 a Fk(Multicast)21 b(tends)f(to)g(be)g(seen)g(as)h(more)f
(modern)e(and)i("better")f(than)h(broadcast.)f(In)h(IPv6,)f(broadcast)g
(doesn')o(t)f(w)o(ork)396 1606 y(at)j(all:)g(you)e(ha)n(v)o(e)h(to)g
(al)o(w)o(ays)h(use)f(broadcast.)f(Nonetheless,)g(all)i(IPv4)e(local)i
(netw)o(ork)e(disco)o(v)o(ery)f(protocols)g(end)i(up)396
1714 y(using)g(UDP)h(broadcast)e(an)o(yho)n(w)-5 b(.)17
b(The)j(reasons:)g(broadcast)f(and)g(multicast)i(end)e(up)h(w)o(orking)
f(much)g(the)h(same,)396 1822 y(e)o(xcept)f(broadcast)g(is)i(simpler)f
(and)g(less)h(risk)o(y)-5 b(.)19 b(Multicast)i(is)g(seen)f(by)g(netw)o
(ork)f(admins)g(as)i(kind)f(of)g(dangerous,)d(as)396
1930 y(it)k(can)f(leak)g(o)o(v)o(er)f(netw)o(ork)g(se)o(gments.)-2
2114 y
SDict begin H.S end
 -2 2114 a -2 2114 a
SDict begin 13 H.A end
 -2 2114 a -2 2114 a
SDict begin [/View [/XYZ H.V]/Dest (0:5356) cvn /DEST pdfmark end
 -2 2114
a 396 2204 a Fk(If)h(you)g(ne)n(v)o(er)e(used)i(UDP)-9
b(,)21 b(you')o(ll)e(disco)o(v)o(er)g(it')-5 b(s)21 b(quite)f(a)g(nice)
g(protocol.)e(In)i(some)g(w)o(ays)h(it)g(reminds)e(us)i(of)f(\330MQ,)
396 2312 y(sending)f(whole)h(messages)g(to)h(peers)f(using)f(a)i(tw)o
(o)f(dif)n(ferent)f(patterns:)g(one-to-one,)f(and)h(one-to-man)o(y)-5
b(.)16 b(The)k(main)396 2420 y(problems)f(with)h(UDP)h(are)f(that)h
(\(a\))f(the)g(POSIX)g(sock)o(et)g(API)h(w)o(as)g(designed)e(for)g(uni)
n(v)o(ersal)g(\003e)o(xibility)h(not)396 2528 y(simplicity)-5
b(,)20 b(\(b\))f(UDP)i(messages)f(are)g(limited)g(for)g(practical)g
(purposes)e(to)j(about)e(512)g(bytes,)h(and)g(\(c\))g(when)f(you)396
2636 y(start)i(to)f(use)h(UDP)g(for)e(real)h(data,)g(you)f(\002nd)h
(that)h(a)f(lot)h(of)f(messages)g(get)g(dropped,)e(especially)h(as)i
(infrastructure)396 2744 y(tends)f(to)h(f)o(a)n(v)n(or)e(TCP)i(o)o(v)o
(er)e(UDP)-9 b(.)-2 2911 y
SDict begin H.S end
 -2 2911 a -2 2911 a
SDict begin 13 H.A end
 -2 2911
a -2 2911 a
SDict begin [/View [/XYZ H.V]/Dest (0:5357) cvn /DEST pdfmark end
 -2 2911 a 396 3018 a Fk(Here)20 b(is)h(a)g(minimal)f(ping)f
(program)f(that)i(uses)h(UDP)g(instead)f(of)g(ICMP_ECHO:)-2
3036 y
SDict begin H.S end
 -2 3036 a -2 3036 a
SDict begin 13 H.A end
 -2 3036 a -2 3036 a
SDict begin [/View [/XYZ H.V]/Dest (0:udpping1-c) cvn /DEST pdfmark
end
 -2 3036
a 396 3219 a Fg(Example)h(8-1.)e(UDP)h(disco)o(v)o(ery)-5
b(,)20 b(model)h(1)f(\(udpping1.c\))-2 3319 y
SDict begin H.S end
 -2 3319
a -2 3319 a
SDict begin 11.7 H.A end
 -2 3319 a -2 3319 a
SDict begin [/View [/XYZ H.V]/Dest (0:5360) cvn /DEST pdfmark end
 -2 3319 a 396 3399 a
Fe(//)396 3496 y(//)90 b(UDP)44 b(ping)g(command)396
3594 y(//)90 b(Model)44 b(1,)g(does)g(UDP)h(work)f(inline)396
3691 y(//)396 3788 y(#include)g(<czmq.h>)396 3885 y(#define)g
(PING_PORT_NUMBER)e(9999)396 3982 y(#define)i(PING_MSG_SIZE)177
b(1)396 4079 y(#define)44 b(PING_INTERVAL)177 b(1000)89
b(//)g(Once)45 b(per)f(second)396 4274 y(static)g(void)396
4371 y(derp)g(\(char)889 4384 y(*)934 4371 y(s\))396
4468 y({)576 4565 y(perror)f(\(s\);)576 4662 y(exit)h(\(1\);)396
4759 y(})396 4954 y(int)h(main)f(\(void\))396 5051 y({)576
5148 y(zctx_t)889 5161 y(*)934 5148 y(ctx)h(=)f(zctx_new)g(\(\);)p
Black 3759 5569 a Ff(419)p Black eop end
%%Page: 420 433
TeXDict begin 420 432 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.420) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 576 170 a Fe(//)89 b(Create)44
b(UDP)g(socket)576 267 y(int)g(fd;)576 364 y(if)g(\(\(fd)g(=)h(socket)f
(\(AF_INET,)f(SOCK_DGRAM,)g(IPPROTO_UDP\)\))g(==)h(-1\))755
461 y(derp)g(\("socket"\);)576 655 y(//)89 b(Ask)44 b(operating)g
(system)f(to)i(let)f(us)h(do)f(broadcasts)f(from)i(socket)576
752 y(int)f(on)g(=)h(1;)576 850 y(if)f(\(setsockopt)f(\(fd,)h
(SOL_SOCKET,)f(SO_BROADCAST,)g(&on,)h(sizeof)g(\(on\)\))g(==)g(-1\))755
947 y(derp)g(\("setsockopt)f(\(SO_BROADCAST\)"\);)576
1141 y(//)89 b(Bind)44 b(UDP)g(socket)g(to)h(local)f(port)g(so)g(we)h
(can)f(receive)g(pings)576 1238 y(struct)f(sockaddr_in)g(si_this)h(=)h
({)f(0)h(};)576 1335 y(si_this.sin_family)c(=)k(AF_INET;)576
1432 y(si_this.sin_port)d(=)i(htons)g(\(PING_PORT_NUMBER\);)576
1530 y(si_this.sin_addr.s_addr)d(=)j(htonl)g(\(INADDR_ANY\);)576
1627 y(if)g(\(bind)g(\(fd,)g(&si_this,)g(sizeof)f(\(si_this\)\))h(==)g
(-1\))755 1724 y(derp)g(\("bind"\);)576 1918 y(byte)g(buffer)g
([PING_MSG_SIZE];)-2 2181 y
SDict begin H.S end
 -2 2181 a -2 2181 a
SDict begin 13 H.A end
 -2 2181
a -2 2181 a
SDict begin [/View [/XYZ H.V]/Dest (0:5361) cvn /DEST pdfmark end
 -2 2181 a 396 2289 a Fk(W)-7 b(e)22 b(use)e(zmq_poll)e(to)j
(w)o(ait)g(for)e(acti)n(vity)h(on)g(the)g(UDP)h(sock)o(et,)f(since)g
(this)h(function)d(w)o(orks)i(on)g(non-\330MQ)e(\002le)396
2397 y(handles.)h(W)-7 b(e)22 b(send)e(a)g(beacon)f(once)h(a)g(second,)
f(and)h(we)h(collect)f(and)f(report)g(beacons)g(that)i(come)e(in)i
(from)e(other)396 2505 y(nodes:)-2 2506 y
SDict begin H.S end
 -2 2506 a -2
2506 a
SDict begin 13 H.A end
 -2 2506 a -2 2506 a
SDict begin [/View [/XYZ H.V]/Dest (0:udpping1-c-1) cvn /DEST pdfmark
end
 -2 2506 a 396 2706 a Fg(Example)i(8-2.)e
(UDP)h(disco)o(v)o(ery)-5 b(,)20 b(model)h(1)f(\(udpping1.c\))g(-)g
(main)h(ping)f(loop)-2 2806 y
SDict begin H.S end
 -2 2806 a -2 2806 a
SDict begin 11.7 H.A end
 -2
2806 a -2 2806 a
SDict begin [/View [/XYZ H.V]/Dest (0:5364) cvn /DEST pdfmark end
 -2 2806 a 576 2887 a Fe(zmq_pollitem_t)42
b(pollitems)h([])i(=)g({{)f(NULL,)g(fd,)g(ZMQ_POLLIN,)f(0)i(}};)576
2984 y(//)89 b(Send)44 b(first)g(ping)g(right)g(away)576
3081 y(uint64_t)f(ping_at)h(=)g(zclock_time)f(\(\);)576
3275 y(while)h(\(!zctx_interrupted\))d({)755 3372 y(long)j(timeout)g(=)
g(\(long\))g(\(ping_at)g(-)g(zclock_time)f(\(\)\);)755
3469 y(if)h(\(timeout)g(<)h(0\))934 3566 y(timeout)f(=)h(0;)755
3664 y(if)f(\(zmq_poll)g(\(pollitems,)f(1,)h(timeout)2369
3677 y(*)2459 3664 y(ZMQ_POLL_MSEC\))e(==)j(-1\))934
3761 y(break;)627 b(//)89 b(Interrupted)755 3955 y(//)g(Someone)44
b(answered)f(our)i(ping)755 4052 y(if)f(\(pollitems)g([0].revents)f(&)h
(ZMQ_POLLIN\))f({)934 4149 y(struct)h(sockaddr_in)f(si_that;)934
4246 y(socklen_t)h(si_len;)934 4344 y(ssize_t)g(size)g(=)h(recvfrom)e
(\(fd,)h(buffer,)g(PING_MSG_SIZE,)f(0,)h(&si_that,)f(&si_len\);)934
4441 y(if)i(\(size)f(==)g(-1\))1114 4538 y(derp)g(\("recvfrom"\);)934
4635 y(printf)g(\("Found)g(peer)g(\045s:\045d\\n",)1114
4732 y(inet_ntoa)f(\(si_that.sin_addr\),)f(ntohs)i
(\(si_that.sin_port\)\);)755 4829 y(})755 4926 y(if)g(\(zclock_time)f
(\(\))i(>=)f(ping_at\))g({)934 5023 y(//)90 b(Broadcast)43
b(our)h(beacon)934 5121 y(puts)g(\("Pinging)g(peers..."\);)p
Black 3759 5569 a Ff(420)p Black eop end
%%Page: 421 434
TeXDict begin 421 433 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.421) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 934 72 a Fe(buffer)44 b([0])g(=)h('!';)934
170 y(struct)f(sockaddr_in)f(si_that)h(=)g(si_this;)934
267 y(inet_aton)g(\("255.255.255.255",)d(&si_that.sin_addr\);)934
364 y(if)k(\(sendto)e(\(fd,)i(buffer,)e(PING_MSG_SIZE,)g(0,)h
(&si_that,)g(sizeof)f(\(struct)h(sockaddr_in\)\))f(==)h(-1\))1114
461 y(derp)g(\("sendto"\);)934 558 y(ping_at)g(=)h(zclock_time)e(\(\))h
(+)h(PING_INTERVAL;)755 655 y(})576 752 y(})576 850 y(close)f(\(fd\);)
576 947 y(zctx_destroy)e(\(&ctx\);)576 1044 y(return)h(0;)396
1141 y(})-2 1315 y
SDict begin H.S end
 -2 1315 a -2 1315 a
SDict begin 13 H.A end
 -2 1315 a -2 1315
a
SDict begin [/View [/XYZ H.V]/Dest (0:5365) cvn /DEST pdfmark end
 -2 1315 a 396 1415 a Fk(This)21 b(code)e(uses)i(a)f(single)h(sock)o
(et)f(to)g(broadcast)f(1-byte)g(messages)h(and)g(recei)n(v)o(e)f(an)o
(ything)f(that)i(other)g(nodes)f(are)396 1523 y(broadcasting.)f(When)i
(I)g(run)g(it,)h(it)f(sho)n(ws)h(just)f(one)g(node,)f(which)h(is)h
(itself:)-2 1624 y
SDict begin H.S end
 -2 1624 a -2 1624 a
SDict begin 11.7 H.A end
 -2 1624 a -2 1624
a
SDict begin [/View [/XYZ H.V]/Dest (0:5366) cvn /DEST pdfmark end
 -2 1624 a 396 1703 a Fe(Pinging)44 b(peers...)396 1800
y(Found)g(peer)g(192.168.1.2:9999)396 1897 y(Pinging)g(peers...)396
1994 y(Found)g(peer)g(192.168.1.2:9999)-2 2172 y
SDict begin H.S end
 -2 2172
a -2 2172 a
SDict begin 13 H.A end
 -2 2172 a -2 2172 a
SDict begin [/View [/XYZ H.V]/Dest (0:5367) cvn /DEST pdfmark end
 -2 2172 a 396 2268 a
Fk(If)20 b(I)h(switch)f(of)n(f)g(all)g(netw)o(orking)f(and)g(try)h
(again,)f(sending)g(a)i(message)f(f)o(ails,)g(as)h(I')l(d)f(e)o(xpect:)
-2 2369 y
SDict begin H.S end
 -2 2369 a -2 2369 a
SDict begin 11.7 H.A end
 -2 2369 a -2 2369 a
SDict begin [/View [/XYZ H.V]/Dest (0:5368) cvn /DEST pdfmark end
 -2
2369 a 396 2449 a Fe(Pinging)44 b(peers...)396 2546 y(sendto:)g
(Network)g(is)g(unreachable)-2 2713 y
SDict begin H.S end
 -2 2713 a -2 2713
a
SDict begin 13 H.A end
 -2 2713 a -2 2713 a
SDict begin [/View [/XYZ H.V]/Dest (0:5369) cvn /DEST pdfmark end
 -2 2713 a 396 2820 a Fk(W)-7 b(orking)20
b(on)f(the)i(basis)f(of)1208 2820 y
SDict begin H.S end
 1208 2820 a 1208
2820 a
SDict begin 13 H.A end
 1208 2820 a 1208 2820 a
SDict begin [/View [/XYZ H.V]/Dest (0:5370) cvn /DEST pdfmark end
 1208 2820 a Ff(solve)h(the)f(pr)l
(oblems)g(curr)m(ently)g(aiming)f(at)i(your)f(thr)l(oat)q
Fk(,)g(let')-5 b(s)21 b(\002x)f(the)h(most)f(ur)o(gent)396
2928 y(issues)h(in)g(this)f(\002rst)h(model.)e(These)h(issues)i(are:)-2
2929 y
SDict begin H.S end
 -2 2929 a -2 2929 a
SDict begin 13 H.A end
 -2 2929 a -2 2929 a
SDict begin [/View [/XYZ H.V]/Dest (0:5371) cvn /DEST pdfmark end
 -2 2929
a -2 2939 a
SDict begin H.S end
 -2 2939 a -2 2939 a
SDict begin 13 H.A end
 -2 2939 a -2 2939 a
SDict begin [/View [/XYZ H.V]/Dest (0:5372) cvn /DEST pdfmark end
 -2
2939 a Black 396 3098 a Fj(\225)p Black 479 3098 a
SDict begin H.S end
 479
3098 a 479 3098 a
SDict begin 13 H.A end
 479 3098 a 479 3098 a
SDict begin [/View [/XYZ H.V]/Dest (0:5373) cvn /DEST pdfmark end
 479 3098 a Fk(Using)e(the)h
(255.255.255.25)o(5)15 b(broadcast)k(address)g(is)i(a)g(bit)g(dubious.)
d(On)i(the)g(one)g(hand,)f(this)i(broadcast)e(address)479
3206 y(means)h(precisely)g("send)f(to)i(all)g(nodes)e(on)h(the)g(local)
g(netw)o(ork,)f(and)h(don')o(t)e(forw)o(ard".)g(Ho)n(we)n(v)o(er)m(,)g
(if)j(you)e(ha)n(v)o(e)479 3314 y(se)n(v)o(eral)h(interf)o(aces)f
(\(wired)h(Ethernet,)f(W)m(iFi\))h(then)g(broadcasts)f(will)i(go)f(out)
g(on)g(your)f(def)o(ault)g(route)g(only)-5 b(,)19 b(and)479
3422 y(via)h(just)h(one)f(interf)o(ace.)f(What)i(we)f(w)o(ant)g(to)h
(do)f(is)h(either)e(send)h(our)g(broadcast)f(on)g(each)h(interf)o(ace')
-5 b(s)20 b(broadcast)479 3530 y(address,)g(or)g(\002nd)g(the)g(W)m
(iFi)h(interf)o(ace)e(and)h(its)h(broadcast)e(address.)-2
3542 y
SDict begin H.S end
 -2 3542 a -2 3542 a
SDict begin 13 H.A end
 -2 3542 a -2 3542 a
SDict begin [/View [/XYZ H.V]/Dest (0:5374) cvn /DEST pdfmark end
 -2 3542
a Black 396 3679 a Fj(\225)p Black 479 3679 a
SDict begin H.S end
 479 3679
a 479 3679 a
SDict begin 13 H.A end
 479 3679 a 479 3679 a
SDict begin [/View [/XYZ H.V]/Dest (0:5375) cvn /DEST pdfmark end
 479 3679 a Fk(Lik)o(e)h(man)o(y)f
(aspects)i(of)f(sock)o(et)g(programming,)c(getting)k(information)d(on)j
(netw)o(ork)f(interf)o(aces)h(is)h(not)f(portable.)479
3787 y(Do)g(we)h(w)o(ant)f(to)h(write)f(non-portable)d(code)j(in)g(our)
f(applications?)g(No,)h(this)h(is)g(better)f(hidden)f(in)h(a)h(library)
-5 b(.)-2 3805 y
SDict begin H.S end
 -2 3805 a -2 3805 a
SDict begin 13 H.A end
 -2 3805 a -2 3805
a
SDict begin [/View [/XYZ H.V]/Dest (0:5376) cvn /DEST pdfmark end
 -2 3805 a Black 396 3936 a Fj(\225)p Black 479 3936
a
SDict begin H.S end
 479 3936 a 479 3936 a
SDict begin 13 H.A end
 479 3936 a 479 3936 a
SDict begin [/View [/XYZ H.V]/Dest (0:5377) cvn /DEST pdfmark end
 479 3936
a Fk(There')g(s)20 b(no)g(handling)e(for)i(errors)f(e)o(xcept)g
("abort",)g(which)h(is)h(too)f(brutal)f(for)h(transient)f(problems)g
(lik)o(e)i("your)479 4044 y(W)m(iFi)g(is)h(switched)d(of)n(f".)h(The)f
(code)h(should)f(distinguish)g(between)h(soft)g(errors)f(\(ignore)g
(and)g(retry\))h(and)f(hard)479 4152 y(errors)h(\(assert\).)-2
4167 y
SDict begin H.S end
 -2 4167 a -2 4167 a
SDict begin 13 H.A end
 -2 4167 a -2 4167 a
SDict begin [/View [/XYZ H.V]/Dest (0:5378) cvn /DEST pdfmark end
 -2 4167
a Black 396 4302 a Fj(\225)p Black 479 4302 a
SDict begin H.S end
 479 4302
a 479 4302 a
SDict begin 13 H.A end
 479 4302 a 479 4302 a
SDict begin [/View [/XYZ H.V]/Dest (0:5379) cvn /DEST pdfmark end
 479 4302 a Fk(The)g(code)g(needs)f
(to)i(kno)n(w)e(its)i(o)n(wn)f(IP)g(address)g(and)g(ignore)f(beacons)g
(that)h(it)h(sent)f(out.)g(Lik)o(e)g(\002nding)f(the)479
4410 y(broadcast)g(address,)h(this)g(requires)g(inspecting)f(the)h(a)n
(v)n(ailable)g(interf)o(aces.)-2 4594 y
SDict begin H.S end
 -2 4594 a -2
4594 a
SDict begin 13 H.A end
 -2 4594 a -2 4594 a
SDict begin [/View [/XYZ H.V]/Dest (0:5380) cvn /DEST pdfmark end
 -2 4594 a 396 4684 a Fk(The)g(simplest)h
(answer)f(to)g(these)g(issues)h(is)g(to)g(push)e(the)i(UDP)f(code)g
(into)g(a)g(separate)g(library)f(that)i(pro)o(vided)c(a)k(clean)396
4791 y(API,)g(lik)o(e)f(this:)-2 4886 y
SDict begin H.S end
 -2 4886 a -2
4886 a
SDict begin 11.7 H.A end
 -2 4886 a -2 4886 a
SDict begin [/View [/XYZ H.V]/Dest (0:5381) cvn /DEST pdfmark end
 -2 4886 a 396 4972 a Fe(//)90
b(Constructor)396 5069 y(static)44 b(udp_t)979 5082 y(*)576
5166 y(udp_new)f(\(int)h(port_nbr\);)p Black 3759 5569
a Ff(421)p Black eop end
%%Page: 422 435
TeXDict begin 422 434 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.422) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 170 a Fe(//)90 b(Destructor)396
267 y(static)44 b(void)576 364 y(udp_destroy)f(\(udp_t)1427
377 y(**)1517 364 y(self_p\);)396 558 y(//)90 b(Returns)43
b(UDP)i(socket)e(handle)396 655 y(static)h(int)576 752
y(udp_handle)f(\(udp_t)1383 765 y(*)1428 752 y(self\);)396
947 y(//)90 b(Send)44 b(message)f(using)h(UDP)h(broadcast)396
1044 y(static)f(void)576 1141 y(udp_send)f(\(udp_t)1293
1154 y(*)1338 1141 y(self,)h(byte)1831 1154 y(*)1876
1141 y(buffer,)f(size_t)h(length\);)396 1335 y(//)90
b(Receive)43 b(message)h(from)g(UDP)g(broadcast)396 1432
y(static)g(ssize_t)576 1530 y(udp_recv)f(\(udp_t)1293
1543 y(*)1338 1530 y(self,)h(byte)1831 1543 y(*)1876
1530 y(buffer,)f(size_t)h(length\);)-2 1707 y
SDict begin H.S end
 -2 1707
a -2 1707 a
SDict begin 13 H.A end
 -2 1707 a -2 1707 a
SDict begin [/View [/XYZ H.V]/Dest (0:5382) cvn /DEST pdfmark end
 -2 1707 a 396 1803 a
Fk(Here)20 b(is)h(the)g(ref)o(actored)d(UDP)j(ping)e(program)f(that)j
(calls)f(this)h(library)-5 b(,)19 b(which)g(is)i(much)f(cleaner)f(and)h
(nicer:)-2 1821 y
SDict begin H.S end
 -2 1821 a -2 1821 a
SDict begin 13 H.A end
 -2 1821 a -2 1821
a
SDict begin [/View [/XYZ H.V]/Dest (0:udpping2-c) cvn /DEST pdfmark
end
 -2 1821 a 396 2005 a Fg(Example)h(8-3.)e(UDP)h(disco)o(v)o(ery)-5
b(,)20 b(model)h(2)f(\(udpping2.c\))-2 2105 y
SDict begin H.S end
 -2 2105
a -2 2105 a
SDict begin 11.7 H.A end
 -2 2105 a -2 2105 a
SDict begin [/View [/XYZ H.V]/Dest (0:5385) cvn /DEST pdfmark end
 -2 2105 a 396 2185 a
Fe(//)396 2282 y(//)90 b(UDP)44 b(ping)g(command)396
2379 y(//)90 b(Model)44 b(2,)g(uses)g(separate)g(UDP)g(library)396
2476 y(//)396 2574 y(#include)g(<czmq.h>)396 2671 y(#include)g
("udplib.c")396 2865 y(#define)g(PING_PORT_NUMBER)e(9999)396
2962 y(#define)i(PING_MSG_SIZE)177 b(1)396 3059 y(#define)44
b(PING_INTERVAL)177 b(1000)89 b(//)g(Once)45 b(per)f(second)396
3253 y(int)h(main)f(\(void\))396 3351 y({)576 3448 y(zctx_t)889
3461 y(*)934 3448 y(ctx)h(=)f(zctx_new)g(\(\);)576 3545
y(udp_t)845 3558 y(*)890 3545 y(udp)g(=)g(udp_new)g
(\(PING_PORT_NUMBER\);)576 3739 y(byte)g(buffer)g([PING_MSG_SIZE];)576
3836 y(zmq_pollitem_t)e(pollitems)h([])i(=)g({{)f(NULL,)g(udp_handle)f
(\(udp\),)h(ZMQ_POLLIN,)f(0)i(}};)576 4031 y(//)89 b(Send)44
b(first)g(ping)g(right)g(away)576 4128 y(uint64_t)f(ping_at)h(=)g
(zclock_time)f(\(\);)576 4322 y(while)h(\(!zctx_interrupted\))d({)755
4419 y(long)j(timeout)g(=)g(\(long\))g(\(ping_at)g(-)g(zclock_time)f
(\(\)\);)755 4516 y(if)h(\(timeout)g(<)h(0\))934 4613
y(timeout)f(=)h(0;)755 4711 y(if)f(\(zmq_poll)g(\(pollitems,)f(1,)h
(timeout)2369 4724 y(*)2459 4711 y(ZMQ_POLL_MSEC\))e(==)j(-1\))934
4808 y(break;)627 b(//)89 b(Interrupted)755 5002 y(//)g(Someone)44
b(answered)f(our)i(ping)755 5099 y(if)f(\(pollitems)g([0].revents)f(&)h
(ZMQ_POLLIN\))p Black 3759 5569 a Ff(422)p Black eop
end
%%Page: 423 436
TeXDict begin 423 435 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.423) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 934 72 a Fe(udp_recv)44 b(\(udp,)g(buffer,)f
(PING_MSG_SIZE\);)755 267 y(if)h(\(zclock_time)f(\(\))i(>=)f(ping_at\))
g({)934 364 y(puts)g(\("Pinging)g(peers..."\);)934 461
y(buffer)g([0])g(=)h('!';)934 558 y(udp_send)f(\(udp,)g(buffer,)f
(PING_MSG_SIZE\);)934 655 y(ping_at)h(=)h(zclock_time)e(\(\))h(+)h
(PING_INTERVAL;)755 752 y(})576 850 y(})576 947 y(udp_destroy)e
(\(&udp\);)576 1044 y(zctx_destroy)f(\(&ctx\);)576 1141
y(return)h(0;)396 1238 y(})-2 1412 y
SDict begin H.S end
 -2 1412 a -2 1412
a
SDict begin 13 H.A end
 -2 1412 a -2 1412 a
SDict begin [/View [/XYZ H.V]/Dest (0:5386) cvn /DEST pdfmark end
 -2 1412 a 396 1512 a Fk(The)20
b(library)-5 b(,)19 b(udplib,)f(hides)i(a)h(lot)f(of)g(the)g
(unpleasant)f(code)h(\(which)f(will)i(become)e(uglier)g(we)i(mak)o(e)f
(this)g(w)o(ork)g(on)396 1620 y(more)g(systems\).)g(I'm)f(not)h(going)f
(to)h(print)g(that)g(code)g(here.)f(Y)-9 b(ou)20 b(can)g(read)f(it)i
(in)g(the)f(repository)-5 b(.)-2 1804 y
SDict begin H.S end
 -2 1804 a -2
1804 a
SDict begin 13 H.A end
 -2 1804 a -2 1804 a
SDict begin [/View [/XYZ H.V]/Dest (0:5387) cvn /DEST pdfmark end
 -2 1804 a 396 1894 a Fk(No)n(w)g(,)20
b(there)f(are)i(more)e(problems)g(sizing)h(us)g(up)g(and)g(w)o
(ondering)e(if)i(the)o(y)g(can)g(mak)o(e)f(lunch)h(out)g(of)f(us.)i
(First,)g(IPv4)396 2002 y(v)o(ersus)f(IPv6)f(and)h(multicast)g(vs.)h
(broadcast.)d(In)i(IPv6,)g(broadcast)e(doesn')o(t)h(e)o(xist)h(at)h
(all;)g(one)f(uses)g(multicast.)g(From)396 2110 y(my)g(e)o(xperience)e
(with)j(W)m(iFi,)f(IPv4)g(multicast)g(and)g(broadcast)f(w)o(ork)g
(identically)h(e)o(xcept)f(that)h(multicast)g(breaks)g(in)396
2218 y(some)g(situations)g(where)g(broadcast)f(w)o(orks)h(\002ne.)g
(Some)g(access)g(points)g(do)g(not)g(forw)o(ard)e(multicast)j(pack)o
(ets.)e(When)396 2326 y(you)h(ha)n(v)o(e)f(a)i(de)n(vice)e(\(e.g.)g(a)i
(tablet\))f(that)g(acts)h(as)g(a)g(mobile)e(AP)-9 b(,)20
b(then)g(it')-5 b(s)21 b(possible)f(it)h(w)o(on')o(t)e(get)i(multicast)
f(pack)o(ets.)396 2434 y(Meaning,)f(it)i(w)o(on')o(t)e(see)i(other)e
(peers)h(on)g(the)g(netw)o(ork.)-2 2618 y
SDict begin H.S end
 -2 2618 a -2
2618 a
SDict begin 13 H.A end
 -2 2618 a -2 2618 a
SDict begin [/View [/XYZ H.V]/Dest (0:5388) cvn /DEST pdfmark end
 -2 2618 a 396 2708 a Fk(The)g(simplest)h
(plausible)e(solution)h(is)h(simply)e(to)i(ignore)e(IPv6)g(for)h(no)n
(w)-5 b(,)19 b(and)g(use)i(broadcast.)e(A)h(perhaps)f(smarter)396
2816 y(solution)h(w)o(ould)f(be)h(to)h(use)f(multicast,)g(and)g(deal)g
(with)g(asymmetric)f(beacons)g(if)i(the)o(y)e(happen.)-2
3000 y
SDict begin H.S end
 -2 3000 a -2 3000 a
SDict begin 13 H.A end
 -2 3000 a -2 3000 a
SDict begin [/View [/XYZ H.V]/Dest (0:5389) cvn /DEST pdfmark end
 -2 3000
a 396 3089 a Fk(W)-7 b(e')o(ll)22 b(stick)e(with)h(stupid)e(and)h
(simple)g(for)g(no)n(w)-5 b(.)19 b(There')-5 b(s)19 b(al)o(w)o(ays)i
(time)f(to)h(mak)o(e)e(it)i(more)f(comple)o(x.)-2 3118
y
SDict begin H.S end
 -2 3118 a -2 3118 a
SDict begin 13 H.A end
 -2 3118 a -2 3118 a
SDict begin [/View [/XYZ H.V]/Dest (0:5390) cvn /DEST pdfmark end
 -2 3118 a 396
3428 a Fb(8.3.3.)36 b(Multiple)e(Nodes)g(on)f(One)h(De)n(vice)2438
3428 y
SDict begin H.S end
 2438 3428 a 2438 3428 a
SDict begin 18.72 H.A end
 2438 3428 a 2438 3428
a
SDict begin [/View [/XYZ H.V]/Dest (13.99.107.2) cvn /DEST pdfmark
end
 2438 3428 a -2 3619 a
SDict begin H.S end
 -2 3619 a -2 3619 a
SDict begin 13 H.A end
 -2 3619 a
-2 3619 a
SDict begin [/View [/XYZ H.V]/Dest (0:5392) cvn /DEST pdfmark end
 -2 3619 a 396 3702 a Fk(So)20 b(we)g(can)g(disco)o(v)o(er)e
(nodes)h(on)g(the)h(W)m(iFi)h(netw)o(ork,)d(as)i(long)f(as)i(the)o(y')l
(re)d(sending)g(out)i(beacons)f(as)h(we)g(e)o(xpect.)f(So)h(I)396
3810 y(try)g(to)h(test)g(with)f(tw)o(o)g(processes.)g(But)h(when)e(I)i
(run)e(udpping2)f(twice,)i(the)g(second)g(instance)f(complains)g
("'Address)396 3918 y(already)g(in)i(use')f(on)g(bind")f(and)g(e)o
(xits.)i(Oh,)e(right.)h(UDP)h(and)e(TCP)i(both)f(return)f(an)h(error)f
(if)h(you)g(try)g(to)g(bind)f(tw)o(o)396 4026 y(dif)n(ferent)g(sock)o
(ets)h(to)g(the)h(same)f(port.)f(This)i(is)g(right.)e(The)h(semantics)g
(of)g(tw)o(o)h(readers)e(on)h(one)f(sock)o(et)h(w)o(ould)g(be)396
4134 y(weird)g(to)g(say)h(the)f(least.)h(Odd/e)n(v)o(en)d(bytes?)i(Y)-9
b(ou)19 b(get)i(all)f(the)h(1s,)f(I)g(get)h(all)f(the)h(0')-5
b(s?)-2 4318 y
SDict begin H.S end
 -2 4318 a -2 4318 a
SDict begin 13 H.A end
 -2 4318 a -2 4318
a
SDict begin [/View [/XYZ H.V]/Dest (0:5393) cvn /DEST pdfmark end
 -2 4318 a 396 4408 a Fk(Ho)n(we)n(v)o(er)m(,)18 b(a)i(quick)e(check)h
(of)g(stack)o(o)o(v)o(er\003o)n(w)e(and)i(some)h(memory)d(of)j(a)g
(sock)o(et)f(option)f(called)h(SO_REUSEADDR)396 4516
y(turns)h(up)g(gold.)f(If)h(I)g(use)h(that,)f(I)g(can)g(bind)g(se)n(v)o
(eral)f(processes)h(to)g(the)h(same)f(UDP)h(port,)e(and)h(the)o(y)f
(will)i(all)g(recei)n(v)o(e)396 4623 y(an)o(y)f(message)g(arri)n(ving)e
(on)i(that)g(port.)g(It')-5 b(s)20 b(almost)h(as)f(if)h(the)f(guys)g
(who)f(designed)g(this)i(were)f(reading)f(my)h(mind!)396
4731 y(\(That')-5 b(s)20 b(w)o(ay)g(more)g(plausible)f(than)h(maybe)f
(I'm)h(rein)m(v)o(enting)d(the)j(wheel.\))-2 4915 y
SDict begin H.S end
 -2
4915 a -2 4915 a
SDict begin 13 H.A end
 -2 4915 a -2 4915 a
SDict begin [/View [/XYZ H.V]/Dest (0:5394) cvn /DEST pdfmark end
 -2 4915 a 396 5005
a Fk(Quick)g(test,)h(and)e(SO_REUSADDR)i(w)o(orks)f(as)h(promised.)d
(This)j(is)g(great)f(because)f(the)h(ne)o(xt)g(thing)f(I)i(w)o(ant)f
(to)g(do)g(is)396 5113 y(design)g(an)f(API)i(and)e(then)g(start)i
(dozens)e(or)g(hundreds)f(of)i(nodes)f(to)h(see)h(them)e(disco)o(v)o
(ering)f(each)h(other)-5 b(.)19 b(It)i(w)o(ould)e(be)p
Black 3759 5569 a Ff(423)p Black eop end
%%Page: 424 437
TeXDict begin 424 436 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.424) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:5408) cvn /DEST pdfmark end
 -2 -201 a 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)
o(ving)g(Pieces)p Black 396 72 a Fk(really)g(cumbersome)e(to)i(ha)n(v)o
(e)g(to)g(test)h(each)f(node)f(on)h(a)h(separate)f(de)n(vice.)f(And)g
(when)h(we)h(get)f(to)g(testing)g(ho)n(w)g(real)396 180
y(traf)n(\002c)g(beha)n(v)o(es)f(on)h(a)h(lar)o(ge,)e(\003ak)o(y)g
(netw)o(ork,)g(the)h(tw)o(o)h(alternati)n(v)o(es)e(are)h(simulation)f
(or)h(temporary)e(insanity)-5 b(.)-2 364 y
SDict begin H.S end
 -2 364 a -2
364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:5395) cvn /DEST pdfmark end
 -2 364 a 396 454 a Fk(And)20
b(I)g(speak)g(from)f(e)o(xperience:)f(we)j(were,)f(this)h(summer)m(,)d
(testing)i(on)g(dozens)g(of)f(de)n(vices)h(at)h(once.)e(It)i(tak)o(es)f
(about)396 562 y(an)g(hour)f(to)i(set-up)e(a)i(full)f(test)h(run,)e
(and)h(you)f(need)h(a)g(space)g(shielded)g(from)f(W)m(iFi)i
(interference)d(if)j(you)e(w)o(ant)h(an)o(y)396 670 y(kind)g(of)g
(reproducibility)d(\(unless)j(your)f(test)i(case)f(is)h("pro)o(v)o(e)e
(that)h(interference)e(kills)j(W)m(iFi)g(netw)o(orks)e(f)o(aster)i
(than)396 778 y(Orv)n(al)f(can)g(kill)g(a)h(thirst".)-2
945 y
SDict begin H.S end
 -2 945 a -2 945 a
SDict begin 13 H.A end
 -2 945 a -2 945 a
SDict begin [/View [/XYZ H.V]/Dest (0:5396) cvn /DEST pdfmark end
 -2 945 a 396
1052 a Fk(If)f(I)h(w)o(as)g(a)f(wizz)h(Android)d(de)n(v)o(eloper)g
(with)i(a)h(free)f(week)o(end)f(I')l(d)g(immediately)g(\(as)i(in,)f(it)
h(w)o(ould)e(tak)o(e)h(me)h(tw)o(o)396 1160 y(days\))f(port)f(this)i
(code)f(to)g(my)g(phone)e(and)i(get)g(it)h(sending)e(beacons)g(to)i(my)
f(PC.)h(But)f(sometimes)g(lazy)g(is)h(more)396 1268 y(pro\002table.)e
(I)804 1268 y
SDict begin H.S end
 804 1268 a 804 1268 a
SDict begin 13 H.A end
 804 1268 a 804 1268
a
SDict begin [/View [/XYZ H.V]/Dest (0:5397) cvn /DEST pdfmark end
 804 1268 a Ff(lik)o(e)i Fk(my)f(Linux)f(laptop.)g(I)i(lik)o(e)f
(being)f(able)h(to)h(start)f(a)h(dozen)e(threads)h(from)f(one)g
(process,)h(and)f(ha)n(v)o(e)396 1376 y(each)h(thread)f(acting)h(lik)o
(e)g(an)h(independent)c(node.)i(I)h(lik)o(e)h(not)f(ha)n(ving)f(to)h(w)
o(ork)g(in)g(a)h(real)f(F)o(araday)f(cage)h(when)f(I)i(can)396
1484 y(simulate)f(one)g(on)g(my)g(laptop.)-2 1512 y
SDict begin H.S end
 -2
1512 a -2 1512 a
SDict begin 13 H.A end
 -2 1512 a -2 1512 a
SDict begin [/View [/XYZ H.V]/Dest (0:5398) cvn /DEST pdfmark end
 -2 1512 a 396 1822
a Fb(8.3.4.)36 b(Designing)f(the)e(API)1751 1822 y
SDict begin H.S end
 1751
1822 a 1751 1822 a
SDict begin 18.72 H.A end
 1751 1822 a 1751 1822 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.108.2) cvn /DEST pdfmark
end
 1751 1822
a -2 2015 a
SDict begin H.S end
 -2 2015 a -2 2015 a
SDict begin 13 H.A end
 -2 2015 a -2 2015 a
SDict begin [/View [/XYZ H.V]/Dest (0:5400) cvn /DEST pdfmark end
 -2
2015 a 396 2096 a Fk(I'm)20 b(going)f(to)h(run)g(N)g(nodes)g(on)f(a)i
(de)n(vice,)e(and)h(the)o(y)f(are)h(going)f(to)i(ha)n(v)o(e)e(to)i
(disco)o(v)o(er)d(each)i(other)m(,)f(and)g(also)396 2204
y(disco)o(v)o(er)g(a)h(b)n(unch)f(of)h(other)g(nodes)f(out)h(there)g
(on)f(the)i(local)f(netw)o(ork.)f(I)h(can)g(use)g(UDP)h(for)f(local)g
(disco)o(v)o(ery)e(as)j(well)396 2312 y(as)g(remote)e(disco)o(v)o(ery)
-5 b(.)18 b(It')-5 b(s)21 b(ar)o(guably)d(not)h(as)i(ef)n(\002cient)f
(as)h(using,)e(e.g.,)h(the)g(\330MQ)g(inproc://)f(transport,)g(b)n(ut)h
(has)h(the)396 2420 y(great)f(adv)n(antage)e(that)j(the)f(e)o(xact)f
(same)i(code)e(will)i(w)o(ork)f(in)g(simulation)f(and)h(in)g(real)h
(deplo)o(yment.)-2 2604 y
SDict begin H.S end
 -2 2604 a -2 2604 a
SDict begin 13 H.A end
 -2 2604
a -2 2604 a
SDict begin [/View [/XYZ H.V]/Dest (0:5401) cvn /DEST pdfmark end
 -2 2604 a 396 2694 a Fk(If)f(I)h(ha)n(v)o(e)e(multiple)h
(nodes)f(on)h(one)g(de)n(vice,)f(we)h(clearly)g(can')o(t)f(use)i(the)f
(IP)g(address)g(and)g(port)f(number)g(as)i(node)396 2802
y(address.)f(I)g(need)g(some)g(logical)f(node)h(identi\002er)-5
b(.)19 b(Ar)o(guably)-5 b(,)17 b(the)k(node)e(identi\002er)g(only)h
(has)g(to)h(be)f(unique)e(within)396 2910 y(the)i(conte)o(xt)f(of)h
(the)h(de)n(vice.)e(My)h(mind)f(\002lls)j(with)e(comple)o(x)e(stuf)n(f)
i(I)h(could)e(mak)o(e,)g(lik)o(e)i(supernodes)d(that)i(sit)i(on)d(real)
396 3018 y(UDP)i(ports)f(and)f(forw)o(ard)g(messages)i(to)f(internal)f
(nodes.)g(I)i(hit)f(my)g(head)g(on)f(the)i(table)f(until)g(the)g(idea)g
(of)3536 3018 y
SDict begin H.S end
 3536 3018 a 3536 3018 a
SDict begin 13 H.A end
 3536 3018 a 3536
3018 a
SDict begin [/View [/XYZ H.V]/Dest (0:5402) cvn /DEST pdfmark end
 3536 3018 a Ff(in)m(venting)396 3126 y(ne)o(w)h(concepts)e
Fk(lea)n(v)o(es)h(it.)-2 3309 y
SDict begin H.S end
 -2 3309 a -2 3309 a
SDict begin 13 H.A end
 -2
3309 a -2 3309 a
SDict begin [/View [/XYZ H.V]/Dest (0:5403) cvn /DEST pdfmark end
 -2 3309 a 396 3400 a Fk(Experience)e(tells)k(us)e
(that)g(W)m(iFi)i(does)e(things)f(lik)o(e)1919 3400 y
SDict begin H.S end

1919 3400 a 1919 3400 a
SDict begin 13 H.A end
 1919 3400 a 1919 3400 a
SDict begin [/View [/XYZ H.V]/Dest (0:5404) cvn /DEST pdfmark end
 1919
3400 a Ff(appear)i Fk(and)2317 3400 y
SDict begin H.S end
 2317 3400 a 2317
3400 a
SDict begin 13 H.A end
 2317 3400 a 2317 3400 a
SDict begin [/View [/XYZ H.V]/Dest (0:5405) cvn /DEST pdfmark end
 2317 3400 a Ff(disappear)g
Fk(while)f(applications)f(are)h(running.)396 3508 y(Which)g(does)g
(interesting)g(things)f(lik)o(e)i(change)e(IP)h(address)g(halfw)o(ay)f
(through)f(a)j(session.)f(F)o(or)g(simplicity)g(let')-5
b(s)21 b(gi)n(v)o(e)396 3616 y(e)n(v)o(ery)e(node)g(a)i(UUID,)f(and)f
(say)i(that)f(nodes,)f(represented)g(by)h(their)f(UUIDs,)i(can)f
(appear)f(or)h(reappear)e(at)j(certain)f(IP)396 3724
y(address:port)f(endpoints,)f(and)i(then)g(disappear)e(again.)h(A)i
(UUID)f(is)h(16)f(bytes.)g(So)g(if)h(I)f(ha)n(v)o(e)g(100)f(nodes)h(on)
f(a)i(W)m(iFi)396 3831 y(netw)o(ork)e(that')-5 b(s)21
b(\(double)d(it)j(for)f(other)f(random)g(stuf)n(f\))g(3,200)g(bytes)h
(a)g(second)g(of)f(beacon)g(data)h(that)h(the)f(air)g(has)h(to)396
3939 y(carry)f(just)g(for)g(disco)o(v)o(ery)e(and)i(presence.)e(Seems)j
(acceptable.)-2 4123 y
SDict begin H.S end
 -2 4123 a -2 4123 a
SDict begin 13 H.A end
 -2 4123 a
-2 4123 a
SDict begin [/View [/XYZ H.V]/Dest (0:5406) cvn /DEST pdfmark end
 -2 4123 a 396 4213 a Fk(Back)g(to)f(concepts.)f(W)-7
b(e)21 b(do)f(need)g(some)g(names)f(for)h(our)f(API.)i(At)g(the)f
(least)h(we)f(need)g(a)g(w)o(ay)h(to)f(distinguish)396
4321 y(between)g(the)g(node)f(object)h(that)g(is)h("us",)f(and)g(node)f
(objects)h(that)g(are)g(our)g(peers.)f(W)-7 b(e')o(ll)22
b(be)e(doing)f(things)g(lik)o(e)396 4429 y(creating)g(an)i("us")f(and)g
(then)f(asking)h(it)h(ho)n(w)e(man)o(y)g(peers)h(it)h(kno)n(ws)f(about)
f(and)g(who)h(the)o(y)g(are.)g(The)f(term)h("peer")g(is)396
4537 y(clear)g(enough.)-2 4721 y
SDict begin H.S end
 -2 4721 a -2 4721 a
SDict begin 13 H.A end

-2 4721 a -2 4721 a
SDict begin [/View [/XYZ H.V]/Dest (0:5407) cvn /DEST pdfmark end
 -2 4721 a 396 4811 a Fk(From)g(the)g(de)n(v)o
(eloper)e(point)h(of)h(vie)n(w)-5 b(,)20 b(a)g(node)f(\(the)h
(application\))f(needs)g(a)i(w)o(ay)f(to)h(talk)f(to)g(the)h(outside)e
(w)o(orld.)g(Let')-5 b(s)396 4919 y(borro)n(w)19 b(a)h(term)g(from)f
(netw)o(orking)f(and)i(call)h(this)f(an)h("interf)o(ace".)d(The)i
(interf)o(ace)g(represents)f(us)i(to)f(the)g(rest)h(of)f(the)396
5027 y(w)o(orld)g(and)g(presents)f(the)i(rest)f(of)g(the)g(w)o(orld)g
(to)g(us,)h(as)f(a)h(set)g(of)f(other)f(peers.)h(It)h(automatically)d
(does)i(whate)n(v)o(er)p Black 3759 5569 a Ff(424)p Black
eop end
%%Page: 425 438
TeXDict begin 425 437 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.425) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fk(disco)o(v)o(ery)e(it)j(has)g(to.)f
(When)g(we)g(w)o(ant)h(to)f(talk)g(to)h(a)f(peer)m(,)f(we)i(get)f(the)g
(interf)o(ace)g(to)g(do)g(that)g(for)g(us.)g(And)g(when)f(a)396
180 y(peer)h(talks)g(to)h(us,)f(it')-5 b(s)21 b(the)g(interf)o(ace)e
(that)h(deli)n(v)o(ers)g(us)g(the)g(message.)396 454
y(This)h(seems)f(lik)o(e)h(a)f(clean)g(API)h(design.)e(Ho)n(w)h(about)f
(the)i(internals?)-2 472 y
SDict begin H.S end
 -2 472 a -2 472 a
SDict begin 13 H.A end
 -2 472 a
-2 472 a
SDict begin [/View [/XYZ H.V]/Dest (0:5409) cvn /DEST pdfmark end
 -2 472 a -2 482 a
SDict begin H.S end
 -2 482 a -2 482 a
SDict begin 13 H.A end
 -2 482 a
-2 482 a
SDict begin [/View [/XYZ H.V]/Dest (0:5410) cvn /DEST pdfmark end
 -2 482 a Black 396 625 a Fj(\225)p Black 479
625 a
SDict begin H.S end
 479 625 a 479 625 a
SDict begin 13 H.A end
 479 625 a 479 625 a
SDict begin [/View [/XYZ H.V]/Dest (0:5411) cvn /DEST pdfmark end
 479 625
a Fk(The)f(interf)o(ace)f(has)i(to)f(be)g(multithreaded,)e(so)j(that)f
(one)g(thread)f(can)h(do)g(I/O)g(in)g(the)h(background,)16
b(while)k(the)479 733 y(fore)o(ground)d(API)j(talks)h(to)f(the)g
(application.)f(W)-7 b(e)21 b(used)f(this)h(design)e(in)i(the)f(Clone)g
(and)g(Freelance)f(client)h(APIs.)-2 750 y
SDict begin H.S end
 -2 750 a -2
750 a
SDict begin 13 H.A end
 -2 750 a -2 750 a
SDict begin [/View [/XYZ H.V]/Dest (0:5412) cvn /DEST pdfmark end
 -2 750 a Black 396 882 a Fj(\225)p
Black 479 882 a
SDict begin H.S end
 479 882 a 479 882 a
SDict begin 13 H.A end
 479 882 a 479 882
a
SDict begin [/View [/XYZ H.V]/Dest (0:5413) cvn /DEST pdfmark end
 479 882 a Fk(The)g(interf)o(ace)f(background)e(thread)i(does)h(the)h
(disco)o(v)o(ery)d(b)n(usiness;)i(bind)f(to)i(the)f(UDP)h(port,)e(send)
h(out)g(UDP)479 990 y(beacons,)f(and)h(recei)n(v)o(e)f(beacons.)-2
1002 y
SDict begin H.S end
 -2 1002 a -2 1002 a
SDict begin 13 H.A end
 -2 1002 a -2 1002 a
SDict begin [/View [/XYZ H.V]/Dest (0:5414) cvn /DEST pdfmark end
 -2 1002
a Black 396 1139 a Fj(\225)p Black 479 1139 a
SDict begin H.S end
 479 1139
a 479 1139 a
SDict begin 13 H.A end
 479 1139 a 479 1139 a
SDict begin [/View [/XYZ H.V]/Dest (0:5415) cvn /DEST pdfmark end
 479 1139 a Fk(W)-7
b(e)22 b(need)d(to)h(at)h(least)g(send)f(UUIDs)h(in)f(the)g(beacon)f
(message)h(so)h(that)f(we)g(can)g(distinguish)g(our)f(o)n(wn)h(beacons)
479 1247 y(from)f(those)h(of)g(our)g(peers.)-2 1265 y
SDict begin H.S end

-2 1265 a -2 1265 a
SDict begin 13 H.A end
 -2 1265 a -2 1265 a
SDict begin [/View [/XYZ H.V]/Dest (0:5416) cvn /DEST pdfmark end
 -2 1265 a Black
396 1397 a Fj(\225)p Black 479 1397 a
SDict begin H.S end
 479 1397 a 479
1397 a
SDict begin 13 H.A end
 479 1397 a 479 1397 a
SDict begin [/View [/XYZ H.V]/Dest (0:5417) cvn /DEST pdfmark end
 479 1397 a Fk(W)-7 b(e)22
b(need)d(to)h(track)g(peers)g(that)g(appear)m(,)f(and)g(that)i
(disappear)-5 b(.)19 b(F)o(or)h(this)g(I')o(ll)h(use)f(a)h(hash)f
(table)g(that)g(stores)h(all)479 1505 y(kno)n(wn)e(peers,)h(and)f(e)o
(xpire)g(peers)h(after)g(some)g(timeout.)-2 1523 y
SDict begin H.S end
 -2
1523 a -2 1523 a
SDict begin 13 H.A end
 -2 1523 a -2 1523 a
SDict begin [/View [/XYZ H.V]/Dest (0:5418) cvn /DEST pdfmark end
 -2 1523 a Black
396 1654 a Fj(\225)p Black 479 1654 a
SDict begin H.S end
 479 1654 a 479
1654 a
SDict begin 13 H.A end
 479 1654 a 479 1654 a
SDict begin [/View [/XYZ H.V]/Dest (0:5419) cvn /DEST pdfmark end
 479 1654 a Fk(W)-7 b(e)22
b(need)d(a)i(w)o(ay)f(to)g(report)f(peers)h(and)g(e)n(v)o(ents)f(to)i
(the)f(caller)-5 b(.)20 b(Here)g(we)h(get)f(into)g(a)h(juic)o(y)e
(question.)g(Ho)n(w)h(does)g(a)479 1762 y(background)d(I/O)j(thread)g
(tell)g(a)h(fore)o(ground)16 b(API)21 b(thread)e(that)h(stuf)n(f)g(is)h
(happening?)d(Callbacks)i(maybe?)f(Heck)479 1870 y(no.)h(W)-7
b(e')o(ll)21 b(use)g(\330MQ)f(messages,)g(of)g(course.)-2
2054 y
SDict begin H.S end
 -2 2054 a -2 2054 a
SDict begin 13 H.A end
 -2 2054 a -2 2054 a
SDict begin [/View [/XYZ H.V]/Dest (0:5420) cvn /DEST pdfmark end
 -2 2054
a 396 2144 a Fk(The)g(third)g(iteration)f(of)h(the)g(UDP)h(ping)e
(program)f(is)k(e)n(v)o(en)d(simpler)h(and)f(more)h(beautiful)f(than)g
(the)h(second.)f(The)396 2252 y(main)h(body)-5 b(,)18
b(in)j(C,)f(is)i(just)e(nine)g(lines)h(of)f(code.)-2
2270 y
SDict begin H.S end
 -2 2270 a -2 2270 a
SDict begin 13 H.A end
 -2 2270 a -2 2270 a
SDict begin [/View [/XYZ H.V]/Dest (0:udpping3-c) cvn /DEST pdfmark
end
 -2 2270
a 396 2453 a Fg(Example)h(8-4.)e(UDP)h(disco)o(v)o(ery)-5
b(,)20 b(model)h(3)f(\(udpping3.c\))-2 2553 y
SDict begin H.S end
 -2 2553
a -2 2553 a
SDict begin 11.7 H.A end
 -2 2553 a -2 2553 a
SDict begin [/View [/XYZ H.V]/Dest (0:5423) cvn /DEST pdfmark end
 -2 2553 a 396 2633 a
Fe(//)396 2730 y(//)90 b(UDP)44 b(ping)g(command)396
2828 y(//)90 b(Model)44 b(3,)g(uses)g(abstract)g(network)f(interface)
396 2925 y(//)396 3022 y(#include)h(<czmq.h>)396 3119
y(#include)g("interface.c")396 3313 y(int)h(main)f(\(void\))396
3410 y({)576 3508 y(interface_t)1114 3521 y(*)1159 3508
y(interface)f(=)h(interface_new)f(\(\);)576 3605 y(while)h(\(true\))f
({)755 3702 y(zmsg_t)1069 3715 y(*)1114 3702 y(msg)h(=)h
(interface_recv)d(\(interface\);)755 3799 y(if)i(\(!msg\))934
3896 y(break;)627 b(//)89 b(Interrupted)755 3993 y(zmsg_dump)43
b(\(msg\);)576 4090 y(})576 4187 y(interface_destroy)f(\(&interface\);)
576 4285 y(return)h(0;)396 4382 y(})-2 4556 y
SDict begin H.S end
 -2 4556
a -2 4556 a
SDict begin 13 H.A end
 -2 4556 a -2 4556 a
SDict begin [/View [/XYZ H.V]/Dest (0:5424) cvn /DEST pdfmark end
 -2 4556 a 396 4656 a
Fk(The)20 b(interf)o(ace)f(code)h(should)f(be)h(f)o(amiliar)g(if)g
(you')l(v)o(e)e(studied)i(ho)n(w)g(we)g(mak)o(e)g(multithreaded)e(API)i
(classes:)-2 4674 y
SDict begin H.S end
 -2 4674 a -2 4674 a
SDict begin 13 H.A end
 -2 4674 a -2
4674 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c) cvn /DEST pdfmark
end
 -2 4674 a Black 3759 5569 a Ff(425)p Black eop
end
%%Page: 426 439
TeXDict begin 426 438 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.426) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fg(Example)h(8-5.)e(UDP)h(ping)h
(interface)e(\(interface.c\))-2 172 y
SDict begin H.S end
 -2 172 a -2 172
a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:5427) cvn /DEST pdfmark end
 -2 172 a 396 253 a Fe(//)90 b(Interface)43
b(class)h(for)g(Chapter)g(8)396 350 y(//)90 b(This)44
b(implements)f(an)h("interface")f(to)i(our)f(network)g(of)g(nodes)396
544 y(#include)g(<czmq.h>)396 641 y(#include)g(<uuid/uuid.h>)396
738 y(#include)g("udplib.c")396 1030 y(//)90 b
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)396 1127 y(//)g(Synchronous)43
b(part,)h(works)g(in)g(our)g(application)f(thread)396
1321 y(//)90 b(-------------------------------------)o(------)o(------)
o(------)o(------)o(-----)o(---)396 1418 y(//)g(Structure)43
b(of)h(our)h(class)396 1613 y(typedef)f(struct)g({)576
1710 y(zctx_t)889 1723 y(*)934 1710 y(ctx;)717 b(//)89
b(Our)45 b(context)e(wrapper)576 1807 y(void)800 1820
y(*)845 1807 y(pipe;)761 b(//)89 b(Pipe)44 b(through)g(to)h(agent)396
1904 y(})g(interface_t;)396 2098 y(//)90 b(This)44 b(is)g(the)h(thread)
e(that)i(handles)e(our)i(real)f(interface)f(class)396
2195 y(static)h(void)576 2292 y(interface_agent)e(\(void)1562
2305 y(*)1607 2292 y(args,)i(zctx_t)2190 2305 y(*)2235
2292 y(ctx,)g(void)2683 2305 y(*)2728 2292 y(pipe\);)-2
2470 y
SDict begin H.S end
 -2 2470 a -2 2470 a
SDict begin 13 H.A end
 -2 2470 a -2 2470 a
SDict begin [/View [/XYZ H.V]/Dest (0:5428) cvn /DEST pdfmark end
 -2 2470
a 396 2566 a Fk(Constructor)19 b(and)h(destructor)e(for)i(the)g(interf)
o(ace)g(class.)g(Note)h(that)f(the)g(class)h(has)g(barely)e(an)o(y)g
(properties,)g(it)i(is)g(just)396 2674 y(an)f(e)o(xcuse)g(to)g(start)h
(the)f(background)d(thread,)i(and)g(a)i(wrapper)e(around)f
(zmsg_recv\(\):)-2 2692 y
SDict begin H.S end
 -2 2692 a -2 2692 a
SDict begin 13 H.A end
 -2 2692
a -2 2692 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-1) cvn /DEST pdfmark
end
 -2 2692 a 396 2876 a Fg(Example)j(8-6.)e(UDP)h(ping)h
(interface)e(\(interface.c\))f(-)j(constructor)e(and)h(destructor)-2
2976 y
SDict begin H.S end
 -2 2976 a -2 2976 a
SDict begin 11.7 H.A end
 -2 2976 a -2 2976 a
SDict begin [/View [/XYZ H.V]/Dest (0:5431) cvn /DEST pdfmark end
 -2 2976
a 396 3153 a Fe(interface_t)934 3166 y(*)396 3250 y(interface_new)43
b(\(void\))396 3347 y({)576 3444 y(interface_t)755 3555
y(*)800 3542 y(self;)576 3736 y(self)h(=)g(\(interface_t)1472
3749 y(*)1517 3736 y(\))h(zmalloc)e(\(sizeof)h(\(interface_t\)\);)576
3833 y(self->ctx)f(=)i(zctx_new)e(\(\);)576 3930 y(self->pipe)g(=)h
(zthread_fork)f(\(self->ctx,)g(interface_agent,)f(NULL\);)576
4027 y(return)h(self;)396 4124 y(})396 4319 y(void)396
4416 y(interface_destroy)f(\(interface_t)1786 4429 y(**)1876
4416 y(self_p\))396 4513 y({)576 4610 y(assert)h(\(self_p\);)576
4707 y(if)h(\()755 4720 y(*)800 4707 y(self_p\))f({)755
4804 y(interface_t)1293 4817 y(*)1338 4804 y(self)h(=)1652
4817 y(*)1697 4804 y(self_p;)755 4901 y(zctx_destroy)f(\(&self->ctx\);)
755 4999 y(free)h(\(self\);)755 5109 y(*)800 5096 y(self_p)g(=)g(NULL;)
p Black 3757 5569 a Ff(426)p Black eop end
%%Page: 427 440
TeXDict begin 427 439 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.427) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 576 72 a Fe(})396 170 y(})-2 344
y
SDict begin H.S end
 -2 344 a -2 344 a
SDict begin 13 H.A end
 -2 344 a -2 344 a
SDict begin [/View [/XYZ H.V]/Dest (0:5432) cvn /DEST pdfmark end
 -2 344 a 396 444
a Fk(Here)g(we)h(w)o(ait)g(for)e(a)i(message)f(from)f(the)h(interf)o
(ace.)f(This)i(returns)e(us)i(a)f(zmsg_t)g(object,)f(or)h(NULL)g(if)h
(interrupted:)-2 462 y
SDict begin H.S end
 -2 462 a -2 462 a
SDict begin 13 H.A end
 -2 462 a -2
462 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-2) cvn /DEST pdfmark
end
 -2 462 a 396 645 a Fg(Example)g(8-7.)e(UDP)h(ping)h(interface)e
(\(interface.c\))f(-)j(r)o(ecei)o(v)o(e)e(message)-2
745 y
SDict begin H.S end
 -2 745 a -2 745 a
SDict begin 11.7 H.A end
 -2 745 a -2 745 a
SDict begin [/View [/XYZ H.V]/Dest (0:5435) cvn /DEST pdfmark end
 -2 745 a 396
922 a Fe(static)44 b(zmsg_t)1024 935 y(*)396 1019 y(interface_recv)f
(\(interface_t)1652 1032 y(*)1697 1019 y(self\))396 1116
y({)576 1214 y(assert)g(\(self\);)576 1311 y(zmsg_t)889
1324 y(*)934 1311 y(msg)i(=)f(zmsg_recv)g(\(self->pipe\);)576
1408 y(return)f(msg;)396 1505 y(})396 1796 y(//)90 b
(=====================================)o(======)o(======)o(======)o
(======)o(=====)o(===)396 1894 y(//)g(Asynchronous)42
b(part,)i(works)g(in)h(the)f(background)-2 2071 y
SDict begin H.S end
 -2
2071 a -2 2071 a
SDict begin 13 H.A end
 -2 2071 a -2 2071 a
SDict begin [/View [/XYZ H.V]/Dest (0:5436) cvn /DEST pdfmark end
 -2 2071 a 396 2168
a Fk(This)21 b(structure)e(de\002nes)h(each)g(peer)f(that)i(we)f(disco)
o(v)o(er)f(and)g(track:)-2 2186 y
SDict begin H.S end
 -2 2186 a -2 2186 a
SDict begin 13 H.A end

-2 2186 a -2 2186 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-3) cvn /DEST pdfmark
end
 -2 2186 a 396 2369 a Fg(Example)i(8-8.)e(UDP)h
(ping)h(interface)e(\(interface.c\))f(-)j(peer)f(class)-2
2469 y
SDict begin H.S end
 -2 2469 a -2 2469 a
SDict begin 11.7 H.A end
 -2 2469 a -2 2469 a
SDict begin [/View [/XYZ H.V]/Dest (0:5439) cvn /DEST pdfmark end
 -2 2469
a 396 2646 a Fe(typedef)44 b(struct)g({)576 2743 y(uuid_t)f(uuid;)717
b(//)89 b(Peer's)44 b(UUID)g(as)h(binary)f(blob)576 2840
y(char)800 2853 y(*)845 2840 y(uuid_str;)581 b(//)89
b(UUID)44 b(as)h(printable)e(string)576 2938 y(uint64_t)g(expires_at;)
396 3035 y(})i(peer_t;)396 3229 y(#define)f(PING_PORT_NUMBER)e(9999)396
3326 y(#define)i(PING_INTERVAL)177 b(1000)89 b(//)g(Once)45
b(per)f(second)396 3423 y(#define)g(PEER_EXPIRY)267 b(5000)89
b(//)g(Five)45 b(seconds)e(and)i(it's)f(gone)396 3618
y(//)90 b(Convert)43 b(binary)h(UUID)g(to)h(freshly)e(allocated)h
(string)396 3812 y(static)g(char)934 3825 y(*)396 3909
y(s_uuid_str)f(\(uuid_t)h(uuid\))396 4006 y({)576 4103
y(char)g(hex_char)f([])i(=)f("0123456789ABCDEF";)576
4200 y(char)800 4213 y(*)845 4200 y(string)f(=)i(zmalloc)f(\(sizeof)f
(\(uuid_t\))2369 4213 y(*)2459 4200 y(2)h(+)h(1\);)576
4297 y(int)f(byte_nbr;)576 4395 y(for)g(\(byte_nbr)f(=)i(0;)f(byte_nbr)
g(<)h(sizeof)e(\(uuid_t\);)h(byte_nbr++\))f({)755 4492
y(string)h([byte_nbr)1517 4505 y(*)1607 4492 y(2)g(+)h(0])g(=)f
(hex_char)g([uuid)g([byte_nbr])f(>>)h(4];)755 4589 y(string)g
([byte_nbr)1517 4602 y(*)1607 4589 y(2)g(+)h(1])g(=)f(hex_char)g([uuid)
g([byte_nbr])f(&)i(15];)576 4686 y(})576 4783 y(return)e(string;)396
4880 y(})-2 5055 y
SDict begin H.S end
 -2 5055 a -2 5055 a
SDict begin 13 H.A end
 -2 5055 a -2 5055
a
SDict begin [/View [/XYZ H.V]/Dest (0:5440) cvn /DEST pdfmark end
 -2 5055 a 396 5154 a Fk(Constructor)19 b(and)h(destructor)e(for)i
(the)g(peer)g(class:)-2 5172 y
SDict begin H.S end
 -2 5172 a -2 5172 a
SDict begin 13 H.A end
 -2
5172 a -2 5172 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-4) cvn /DEST pdfmark
end
 -2 5172 a Black 3756 5569 a Ff(427)p
Black eop end
%%Page: 428 441
TeXDict begin 428 440 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.428) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fg(Example)h(8-9.)e(UDP)h(ping)h
(interface)e(\(interface.c\))f(-)j(peer)f(constructor)f(and)i
(destructor)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172
a
SDict begin [/View [/XYZ H.V]/Dest (0:5443) cvn /DEST pdfmark end
 -2 172 a 396 350 a Fe(static)44 b(peer_t)1024 363 y(*)396
447 y(peer_new)g(\(uuid_t)f(uuid\))396 544 y({)576 641
y(peer_t)889 654 y(*)934 641 y(self)h(=)h(\(peer_t)1607
654 y(*)1652 641 y(\))f(zmalloc)g(\(sizeof)g(\(peer_t\)\);)576
738 y(memcpy)f(\(self->uuid,)g(uuid,)h(sizeof)g(\(uuid_t\)\);)576
835 y(self->uuid_str)e(=)j(s_uuid_str)e(\(self->uuid\);)576
933 y(return)g(self;)396 1030 y(})396 1224 y(//)90 b(Destroy)43
b(peer)h(object)396 1418 y(static)g(void)396 1515 y(peer_destroy)f
(\(peer_t)1338 1528 y(**)1428 1515 y(self_p\))396 1613
y({)576 1710 y(assert)g(\(self_p\);)576 1807 y(if)h(\()755
1820 y(*)800 1807 y(self_p\))f({)755 1904 y(peer_t)1069
1917 y(*)1114 1904 y(self)h(=)1427 1917 y(*)1472 1904
y(self_p;)755 2001 y(free)g(\(self->uuid_str\);)755 2098
y(free)g(\(self\);)755 2208 y(*)800 2195 y(self_p)g(=)g(NULL;)576
2292 y(})396 2390 y(})-2 2564 y
SDict begin H.S end
 -2 2564 a -2 2564 a
SDict begin 13 H.A end
 -2
2564 a -2 2564 a
SDict begin [/View [/XYZ H.V]/Dest (0:5444) cvn /DEST pdfmark end
 -2 2564 a 396 2664 a Fk(These)20 b(methods)f(return)g
(the)i(peer')-5 b(s)20 b(UUID)g(in)g(binary)f(format)g(or)h(as)h(a)g
(printable)d(string:)-2 2682 y
SDict begin H.S end
 -2 2682 a -2 2682 a
SDict begin 13 H.A end
 -2
2682 a -2 2682 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-5) cvn /DEST pdfmark
end
 -2 2682 a 396 2865 a Fg(Example)j(8-10.)d(UDP)j(ping)f
(interface)g(\(interface.c\))e(-)i(peer)h(methods)-2
2965 y
SDict begin H.S end
 -2 2965 a -2 2965 a
SDict begin 11.7 H.A end
 -2 2965 a -2 2965 a
SDict begin [/View [/XYZ H.V]/Dest (0:5447) cvn /DEST pdfmark end
 -2 2965
a 396 3142 a Fe(static)44 b(byte)934 3155 y(*)396 3239
y(peer_uuid)g(\(peer_t)1203 3252 y(*)1248 3239 y(self\))396
3336 y({)576 3434 y(assert)f(\(self\);)576 3531 y(return)g(self->uuid;)
396 3628 y(})396 3822 y(static)h(char)934 3835 y(*)396
3919 y(peer_uuid_str)f(\(peer_t)1383 3932 y(*)1428 3919
y(self\))396 4016 y({)576 4114 y(assert)g(\(self\);)576
4211 y(return)g(self->uuid_str;)396 4308 y(})396 4502
y(//)90 b(Just)44 b(resets)g(the)g(peers)g(expiry)g(time;)g(we)g(call)g
(this)h(method)396 4599 y(//)90 b(whenever)43 b(we)i(get)f(any)g
(activity)g(from)g(a)h(peer.)396 4794 y(static)f(void)396
4891 y(peer_is_alive)f(\(peer_t)1383 4904 y(*)1428 4891
y(self\))396 4988 y({)576 5085 y(assert)g(\(self\);)p
Black 3759 5569 a Ff(428)p Black eop end
%%Page: 429 442
TeXDict begin 429 441 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.429) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 576 72 a Fe(self->expires_at)42
b(=)i(zclock_time)f(\(\))i(+)g(PEER_EXPIRY;)396 170 y(})396
364 y(//)90 b(Peer)44 b(hash)g(calls)g(this)g(handler)g(automatically)e
(whenever)i(we)g(delete)396 461 y(//)90 b(peer)44 b(from)g(agent)g
(peers,)g(or)g(destroy)g(that)g(hash)g(table.)396 655
y(static)g(void)396 752 y(peer_freefn)f(\(void)1203 765
y(*)1248 752 y(argument\))396 850 y({)576 947 y(peer_t)889
960 y(*)934 947 y(peer)h(=)h(\(peer_t)1607 960 y(*)1652
947 y(\))f(argument;)576 1044 y(peer_destroy)e(\(&peer\);)396
1141 y(})-2 1315 y
SDict begin H.S end
 -2 1315 a -2 1315 a
SDict begin 13 H.A end
 -2 1315 a -2 1315
a
SDict begin [/View [/XYZ H.V]/Dest (0:5448) cvn /DEST pdfmark end
 -2 1315 a 396 1415 a Fk(This)21 b(structure)e(holds)h(the)g(conte)o
(xt)f(for)g(our)h(agent,)f(so)i(we)f(can)g(pass)h(that)f(around)e
(cleanly)i(to)g(methods)f(which)h(need)396 1523 y(it:)-2
1524 y
SDict begin H.S end
 -2 1524 a -2 1524 a
SDict begin 13 H.A end
 -2 1524 a -2 1524 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-6) cvn /DEST pdfmark
end
 -2 1524
a 396 1724 a Fg(Example)h(8-11.)d(UDP)j(ping)f(interface)g
(\(interface.c\))e(-)i(agent)g(class)-2 1824 y
SDict begin H.S end
 -2 1824
a -2 1824 a
SDict begin 11.7 H.A end
 -2 1824 a -2 1824 a
SDict begin [/View [/XYZ H.V]/Dest (0:5451) cvn /DEST pdfmark end
 -2 1824 a 396 2001 a
Fe(typedef)44 b(struct)g({)576 2099 y(zctx_t)889 2112
y(*)934 2099 y(ctx;)717 b(//)89 b(CZMQ)44 b(context)576
2196 y(void)800 2209 y(*)845 2196 y(pipe;)761 b(//)89
b(Pipe)44 b(back)h(to)f(application)576 2293 y(udp_t)845
2306 y(*)890 2293 y(udp;)761 b(//)89 b(UDP)45 b(object)576
2390 y(uuid_t)e(uuid;)717 b(//)89 b(Our)45 b(UUID)f(as)g(binary)g(blob)
576 2487 y(zhash_t)934 2500 y(*)979 2487 y(peers;)582
b(//)89 b(Hash)44 b(of)h(known)f(peers,)g(fast)g(lookup)396
2584 y(})h(agent_t;)-2 2762 y
SDict begin H.S end
 -2 2762 a -2 2762 a
SDict begin 13 H.A end
 -2
2762 a -2 2762 a
SDict begin [/View [/XYZ H.V]/Dest (0:5452) cvn /DEST pdfmark end
 -2 2762 a 396 2858 a Fk(Constructor)19
b(and)h(destructor)e(for)i(agent.)f(Each)h(interf)o(ace)f(has)i(one)e
(agent)h(object,)f(which)h(implements)f(its)396 2966
y(background)e(thread:)-2 2984 y
SDict begin H.S end
 -2 2984 a -2 2984 a
SDict begin 13 H.A end

-2 2984 a -2 2984 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-7) cvn /DEST pdfmark
end
 -2 2984 a 396 3168 a Fg(Example)k(8-12.)d(UDP)j
(ping)f(interface)g(\(interface.c\))e(-)i(agent)g(constructor)f(and)h
(destructor)-2 3267 y
SDict begin H.S end
 -2 3267 a -2 3267 a
SDict begin 11.7 H.A end
 -2 3267 a -2
3267 a
SDict begin [/View [/XYZ H.V]/Dest (0:5455) cvn /DEST pdfmark end
 -2 3267 a 396 3445 a Fe(static)44 b(agent_t)1069
3458 y(*)396 3542 y(agent_new)g(\(zctx_t)1203 3555 y(*)1248
3542 y(ctx,)g(void)1696 3555 y(*)1741 3542 y(pipe\))396
3639 y({)576 3736 y(agent_t)934 3749 y(*)979 3736 y(self)g(=)h
(\(agent_t)1696 3749 y(*)1741 3736 y(\))g(zmalloc)f(\(sizeof)f
(\(agent_t\)\);)576 3833 y(self->ctx)g(=)i(ctx;)576 3931
y(self->pipe)e(=)h(pipe;)576 4028 y(self->udp)f(=)i(udp_new)e
(\(PING_PORT_NUMBER\);)576 4125 y(self->peers)g(=)h(zhash_new)g(\(\);)
576 4222 y(uuid_generate)e(\(self->uuid\);)576 4319 y(return)h(self;)
396 4416 y(})396 4610 y(static)h(void)396 4708 y(agent_destroy)f
(\(agent_t)1427 4721 y(**)1517 4708 y(self_p\))396 4805
y({)576 4902 y(assert)g(\(self_p\);)576 4999 y(if)h(\()755
5012 y(*)800 4999 y(self_p\))f({)755 5096 y(agent_t)1114
5109 y(*)1159 5096 y(self)h(=)1472 5109 y(*)1517 5096
y(self_p;)p Black 3759 5569 a Ff(429)p Black eop end
%%Page: 430 443
TeXDict begin 430 442 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.430) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 755 72 a Fe(zhash_destroy)43 b
(\(&self->peers\);)755 170 y(udp_destroy)g(\(&self->udp\);)755
267 y(free)h(\(self\);)755 377 y(*)800 364 y(self_p)g(=)g(NULL;)576
461 y(})396 558 y(})396 655 y(...)-2 822 y
SDict begin H.S end
 -2 822 a -2
822 a
SDict begin 13 H.A end
 -2 822 a -2 822 a
SDict begin [/View [/XYZ H.V]/Dest (0:5456) cvn /DEST pdfmark end
 -2 822 a 396 929 a Fk(Handle)20
b(beacon)f(coming)f(into)i(UDP)h(sock)o(et;)f(this)h(may)f(be)g(from)f
(other)g(peers)h(or)g(an)g(echo)g(of)g(our)f(o)n(wn)h(broadcast)396
1037 y(beacon:)-2 1038 y
SDict begin H.S end
 -2 1038 a -2 1038 a
SDict begin 13 H.A end
 -2 1038
a -2 1038 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-8) cvn /DEST pdfmark
end
 -2 1038 a 396 1239 a Fg(Example)h(8-13.)d(UDP)j(ping)f
(interface)g(\(interface.c\))e(-)i(handle)h(beacon)-2
1338 y
SDict begin H.S end
 -2 1338 a -2 1338 a
SDict begin 11.7 H.A end
 -2 1338 a -2 1338 a
SDict begin [/View [/XYZ H.V]/Dest (0:5459) cvn /DEST pdfmark end
 -2 1338
a 396 1613 a Fe(static)44 b(int)396 1710 y(agent_handle_beacon)e
(\(agent_t)1696 1723 y(*)1741 1710 y(self\))396 1807
y({)576 1904 y(uuid_t)h(uuid;)576 2001 y(ssize_t)g(size)h(=)h(udp_recv)
f(\(self->udp,)f(uuid,)h(sizeof)f(\(uuid_t\)\);)576 2196
y(//)89 b(If)44 b(we)h(got)f(a)h(UUID)f(and)g(it's)h(not)f(our)g(own)h
(beacon,)e(we)i(have)f(a)h(peer)576 2293 y(if)f(\(size)g(==)h(sizeof)e
(\(uuid_t\))576 2390 y(&&)89 b(memcmp)44 b(\(uuid,)g(self->uuid,)f
(sizeof)g(\(uuid\)\)\))h({)755 2487 y(char)979 2500 y(*)1024
2487 y(uuid_str)f(=)i(s_uuid_str)e(\(uuid\);)755 2681
y(//)89 b(Find)44 b(or)h(create)f(peer)g(via)g(its)h(UUID)f(string)755
2779 y(peer_t)1069 2792 y(*)1114 2779 y(peer)g(=)g(\(peer_t)1786
2792 y(*)1831 2779 y(\))h(zhash_lookup)d(\(self->peers,)h(uuid_str\);)
755 2876 y(if)h(\(peer)g(==)h(NULL\))f({)934 2973 y(peer)g(=)h
(peer_new)f(\(uuid\);)934 3070 y(zhash_insert)f(\(self->peers,)g
(uuid_str,)g(peer\);)934 3167 y(zhash_freefn)g(\(self->peers,)g
(uuid_str,)g(peer_freefn\);)934 3361 y(//)90 b(Report)43
b(peer)i(joined)e(the)i(network)934 3459 y(zstr_sendm)e(\(self->pipe,)g
("JOINED"\);)934 3556 y(zstr_send)h(\(self->pipe,)e(uuid_str\);)755
3653 y(})755 3750 y(//)89 b(Any)45 b(activity)e(from)h(the)h(peer)f
(means)g(it's)g(alive)755 3847 y(peer_is_alive)f(\(peer\);)755
3944 y(free)h(\(uuid_str\);)576 4041 y(})576 4138 y(return)f(0;)396
4236 y(})-2 4410 y
SDict begin H.S end
 -2 4410 a -2 4410 a
SDict begin 13 H.A end
 -2 4410 a -2 4410
a
SDict begin [/View [/XYZ H.V]/Dest (0:5460) cvn /DEST pdfmark end
 -2 4410 a 396 4510 a Fk(This)21 b(method)d(checks)i(one)g(peer)f
(item)i(for)e(e)o(xpiry;)g(if)h(the)h(peer)e(hasn')o(t)h(sent)g(us)h
(an)o(ything)d(by)h(no)n(w)-5 b(,)19 b(it')-5 b(s)22
b(')l(dead')c(and)396 4618 y(we)j(can)f(delete)g(it:)-2
4619 y
SDict begin H.S end
 -2 4619 a -2 4619 a
SDict begin 13 H.A end
 -2 4619 a -2 4619 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-9) cvn /DEST pdfmark
end
 -2 4619
a Black 3759 5569 a Ff(430)p Black eop end
%%Page: 431 444
TeXDict begin 431 443 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.431) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fg(Example)h(8-14.)d(UDP)j(ping)f
(interface)g(\(interface.c\))e(-)i(r)o(eap)g(peers)-2
172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 11.7 H.A end
 -2 172 a -2 172 a
SDict begin [/View [/XYZ H.V]/Dest (0:5463) cvn /DEST pdfmark end
 -2 172 a 396
350 a Fe(static)44 b(int)396 447 y(agent_reap_peer)f(\(const)g(char)
1652 460 y(*)1697 447 y(key,)h(void)2145 460 y(*)2190
447 y(item,)g(void)2683 460 y(*)2728 447 y(argument\))396
544 y({)576 641 y(agent_t)934 654 y(*)979 641 y(self)g(=)h(\(agent_t)
1696 654 y(*)1741 641 y(\))g(argument;)576 738 y(peer_t)889
751 y(*)934 738 y(peer)f(=)h(\(peer_t)1607 751 y(*)1652
738 y(\))f(item;)576 835 y(if)g(\(zclock_time)f(\(\))h(>=)h
(peer->expires_at\))d({)755 933 y(//)89 b(Report)44 b(peer)g(left)g
(the)h(network)755 1030 y(zstr_sendm)e(\(self->pipe,)g("LEFT"\);)755
1127 y(zstr_send)g(\(self->pipe,)g(peer_uuid_str)g(\(peer\)\);)755
1224 y(zhash_delete)g(\(self->peers,)f(peer_uuid_str)h(\(peer\)\);)576
1321 y(})576 1418 y(return)g(0;)396 1515 y(})-2 1690
y
SDict begin H.S end
 -2 1690 a -2 1690 a
SDict begin 13 H.A end
 -2 1690 a -2 1690 a
SDict begin [/View [/XYZ H.V]/Dest (0:5464) cvn /DEST pdfmark end
 -2 1690 a 396
1789 a Fk(This)21 b(is)g(the)f(main)g(loop)f(for)h(the)g(background)d
(agent.)i(It)h(uses)h(zmq_poll)e(to)h(monitor)f(the)h(front-end)d(pipe)
396 1897 y(\(commands)h(from)i(the)g(API\))g(and)g(the)g(back-end)e
(UDP)j(handle)e(\(beacons\):)-2 1912 y
SDict begin H.S end
 -2 1912 a -2 1912
a
SDict begin 13 H.A end
 -2 1912 a -2 1912 a
SDict begin [/View [/XYZ H.V]/Dest (0:interface-c-10) cvn /DEST pdfmark
end
 -2 1912 a 396 2099 a Fg(Example)i(8-15.)d(UDP)j
(ping)f(interface)g(\(interface.c\))e(-)i(agent)g(main)g(loop)-2
2199 y
SDict begin H.S end
 -2 2199 a -2 2199 a
SDict begin 11.7 H.A end
 -2 2199 a -2 2199 a
SDict begin [/View [/XYZ H.V]/Dest (0:5467) cvn /DEST pdfmark end
 -2 2199
a 396 2376 a Fe(static)44 b(void)396 2473 y(interface_agent)f(\(void)
1383 2486 y(*)1428 2473 y(args,)g(zctx_t)2010 2486 y(*)2055
2473 y(ctx,)h(void)2503 2486 y(*)2548 2473 y(pipe\))396
2570 y({)576 2667 y(//)89 b(Create)44 b(agent)g(instance)f(to)i(pass)f
(around)576 2764 y(agent_t)934 2777 y(*)979 2764 y(self)g(=)h
(agent_new)e(\(ctx,)h(pipe\);)576 2959 y(//)89 b(Send)44
b(first)g(beacon)g(immediately)576 3056 y(uint64_t)f(ping_at)h(=)g
(zclock_time)f(\(\);)576 3153 y(zmq_pollitem_t)f(pollitems)h([])i(=)g
({)755 3250 y({)g(self->pipe,)e(0,)h(ZMQ_POLLIN,)f(0)i(},)755
3347 y({)g(0,)f(udp_handle)f(\(self->udp\),)g(ZMQ_POLLIN,)g(0)i(})576
3444 y(};)576 3639 y(while)f(\(!zctx_interrupted\))d({)755
3736 y(long)j(timeout)g(=)g(\(long\))g(\(ping_at)g(-)g(zclock_time)f
(\(\)\);)755 3833 y(if)h(\(timeout)g(<)h(0\))934 3930
y(timeout)f(=)h(0;)755 4027 y(if)f(\(zmq_poll)g(\(pollitems,)f(2,)h
(timeout)2369 4040 y(*)2459 4027 y(ZMQ_POLL_MSEC\))e(==)j(-1\))934
4124 y(break;)627 b(//)89 b(Interrupted)755 4319 y(//)g(If)45
b(we)f(had)h(activity)e(on)i(the)f(pipe,)g(go)g(handle)g(the)h(control)
755 4416 y(//)89 b(message.)44 b(Current)f(code)i(never)f(sends)g
(control)f(messages.)755 4513 y(if)h(\(pollitems)g([0].revents)f(&)h
(ZMQ_POLLIN\))934 4610 y(agent_control_message)e(\(self\);)755
4804 y(//)89 b(If)45 b(we)f(had)h(input)f(on)g(the)g(UDP)h(socket,)e
(go)i(process)f(that)755 4901 y(if)g(\(pollitems)g([1].revents)f(&)h
(ZMQ_POLLIN\))934 4999 y(agent_handle_beacon)e(\(self\);)p
Black 3759 5569 a Ff(431)p Black eop end
%%Page: 432 445
TeXDict begin 432 444 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.432) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 755 72 a Fe(//)89 b(If)45 b(we)f(passed)g(the)g
(1-second)g(mark,)g(broadcast)f(our)i(beacon)755 170
y(if)f(\(zclock_time)f(\(\))i(>=)f(ping_at\))g({)934
267 y(udp_send)g(\(self->udp,)f(self->uuid,)g(sizeof)h(\(uuid_t\)\);)
934 364 y(ping_at)g(=)h(zclock_time)e(\(\))h(+)h(PING_INTERVAL;)755
461 y(})755 558 y(//)89 b(Delete)44 b(and)g(report)g(any)h(expired)e
(peers)755 655 y(zhash_foreach)g(\(self->peers,)f(agent_reap_peer,)g
(self\);)576 752 y(})576 850 y(agent_destroy)g(\(&self\);)396
947 y(})-2 1121 y
SDict begin H.S end
 -2 1121 a -2 1121 a
SDict begin 13 H.A end
 -2 1121 a -2 1121
a
SDict begin [/View [/XYZ H.V]/Dest (0:5468) cvn /DEST pdfmark end
 -2 1121 a 396 1221 a Fk(When)20 b(I)h(run)e(this)i(in)f(tw)o(o)h
(windo)n(ws,)e(it)i(reports)e(one)h(peer)f(joining)g(the)i(netw)o(ork.)
d(I)j(kill)f(that)h(peer)e(and)h(a)g(fe)n(w)396 1329
y(seconds)g(later)g(it)h(tells)g(me)f(the)h(peer)e(left:)-2
1430 y
SDict begin H.S end
 -2 1430 a -2 1430 a
SDict begin 11.7 H.A end
 -2 1430 a -2 1430 a
SDict begin [/View [/XYZ H.V]/Dest (0:5469) cvn /DEST pdfmark end
 -2 1430
a 396 1509 a Fe(--------------------------------------)396
1606 y([006])44 b(JOINED)396 1703 y([032])g
(418E98D4B7184844B7D5E0EE5691084C)396 1800 y
(--------------------------------------)396 1897 y([004])g(LEFT)396
1994 y([032])g(418E98D4B7184844B7D5E0EE5691084C)-2 2169
y
SDict begin H.S end
 -2 2169 a -2 2169 a
SDict begin 13 H.A end
 -2 2169 a -2 2169 a
SDict begin [/View [/XYZ H.V]/Dest (0:5470) cvn /DEST pdfmark end
 -2 2169 a 396
2268 a Fk(What')-5 b(s)21 b(nice)e(about)g(a)h(\330MQ-message)f(based)g
(API)h(is)g(that)g(I)g(can)f(wrap)g(this)h(an)o(y)f(w)o(ay)h(I)g(lik)o
(e.)f(F)o(or)g(instance,)g(turning)396 2376 y(it)i(into)f(callbacks)g
(if)g(I)h(really)e(w)o(ant)i(those.)f(I)g(can)g(also)g(trace)h(all)f
(acti)n(vity)g(on)g(the)g(API)h(v)o(ery)e(easily)-5 b(.)-2
2560 y
SDict begin H.S end
 -2 2560 a -2 2560 a
SDict begin 13 H.A end
 -2 2560 a -2 2560 a
SDict begin [/View [/XYZ H.V]/Dest (0:5471) cvn /DEST pdfmark end
 -2 2560
a 396 2650 a Fk(Some)20 b(notes)g(about)f(tuning.)g(On)h(Ethernet,)f
(\002)n(v)o(e)h(seconds)g(\(the)g(e)o(xpiry)e(time)j(I)f(used)g(in)g
(this)h(code\))e(seems)i(lik)o(e)f(a)h(lot.)396 2758
y(On)f(a)h(badly)e(stressed)i(W)m(iFi)g(netw)o(ork)e(you)g(can)h(get)h
(ping)e(latencies)h(of)g(30)g(seconds)f(or)h(more.)f(If)h(you)g(use)g
(a)396 2866 y(too-aggressi)n(v)o(e)e(v)n(alue)h(for)h(the)g(e)o(xpiry)
-5 b(,)18 b(you')o(ll)h(disconnect)g(nodes)h(that)g(are)g(still)h
(there.)f(On)g(the)g(other)g(side,)g(end)396 2974 y(user)g
(applications)f(e)o(xpect)h(a)g(certain)g(li)n(v)o(eliness.)g(If)g(it)h
(tak)o(es)f(30)g(seconds)g(to)g(report)f(that)h(a)h(node)e(has)h(gone,)
f(users)396 3082 y(will)i(get)f(anno)o(yed.)-2 3266 y
SDict begin H.S end

-2 3266 a -2 3266 a
SDict begin 13 H.A end
 -2 3266 a -2 3266 a
SDict begin [/View [/XYZ H.V]/Dest (0:5472) cvn /DEST pdfmark end
 -2 3266 a 396
3356 a Fk(A)h(decent)e(strate)o(gy)h(is)h(to)f(detect)g(and)g(report)f
(disappeared)f(nodes)i(rapidly)-5 b(,)18 b(b)n(ut)i(only)f(delete)h
(them)g(after)g(a)h(longer)396 3464 y(interv)n(al.)e(V)-5
b(isually)g(,)20 b(a)g(node)g(w)o(ould)f(be)h(green)f(when)h(it')-5
b(s)21 b(ali)n(v)o(e,)f(then)g(gray)f(for)g(a)i(while)f(as)h(it)g(went)
f(out)g(of)g(reach,)396 3572 y(then)g(\002nally)g(disappear)-5
b(.)19 b(W)-7 b(e')l(re)20 b(not)g(doing)f(this)i(no)n(w)-5
b(,)19 b(b)n(ut)h(will)h(do)f(it)h(in)f(the)g(real)g(implementation)e
(of)i(the)396 3680 y(as-yet-unnamed)d(frame)n(w)o(ork)h(we')l(re)i
(making.)-2 3864 y
SDict begin H.S end
 -2 3864 a -2 3864 a
SDict begin 13 H.A end
 -2 3864 a -2 3864
a
SDict begin [/View [/XYZ H.V]/Dest (0:5473) cvn /DEST pdfmark end
 -2 3864 a 396 3954 a Fk(As)h(we)g(will)g(also)f(see)h(later)m(,)f(we)
g(ha)n(v)o(e)g(to)g(treat)h(an)o(y)e(input)g(from)h(a)g(node,)f(not)h
(just)h(UDP)f(beacons,)f(as)i(a)g(sign)f(of)g(life.)396
4062 y(UDP)h(may)f(get)g(squashed)f(when)g(there')-5
b(s)20 b(a)g(lot)h(of)f(TCP)g(traf)n(\002c.)g(This)g(is)h(perhaps)e
(the)h(main)g(reason)f(we')l(re)h(not)f(using)396 4170
y(an)h(e)o(xisting)g(UDP)h(disco)o(v)o(ery)d(library:)h(we)h(ha)n(v)o
(e)g(to)g(inte)o(grate)f(this)i(tightly)f(with)g(our)f(\330MQ)i
(messaging)e(for)h(it)h(to)396 4278 y(w)o(ork.)-2 4289
y
SDict begin H.S end
 -2 4289 a -2 4289 a
SDict begin 13 H.A end
 -2 4289 a -2 4289 a
SDict begin [/View [/XYZ H.V]/Dest (0:5474) cvn /DEST pdfmark end
 -2 4289 a 396
4616 a Fb(8.3.5.)36 b(More)c(about)i(UDP)1658 4616 y
SDict begin H.S end

1658 4616 a 1658 4616 a
SDict begin 18.72 H.A end
 1658 4616 a 1658 4616 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.109.2) cvn /DEST pdfmark
end
 1658
4616 a -2 4784 a
SDict begin H.S end
 -2 4784 a -2 4784 a
SDict begin 13 H.A end
 -2 4784 a -2 4784
a
SDict begin [/View [/XYZ H.V]/Dest (0:5476) cvn /DEST pdfmark end
 -2 4784 a 396 4890 a Fk(So)21 b(we)f(ha)n(v)o(e)g(disco)o(v)o(ery)e
(and)i(presence)f(w)o(orking)f(o)o(v)o(er)h(UDP)i(IPv4)f(broadcasts.)e
(It')-5 b(s)21 b(not)f(ideal,)g(b)n(ut)g(it)h(w)o(orks)f(for)396
4998 y(the)g(local)h(netw)o(orks)e(we)h(ha)n(v)o(e)g(today)-5
b(.)19 b(Ho)n(we)n(v)o(er)f(we)j(can')o(t)e(use)h(UDP)h(for)f(real)g(w)
o(ork,)f(not)h(without)g(additional)e(w)o(ork)396 5106
y(to)j(mak)o(e)e(it)i(reliable.)f(There')-5 b(s)19 b(a)i(jok)o(e)f
(about)f(UDP)i(b)n(ut)f(sometimes)g(you)f(get)i(it,)f(and)g(sometimes)g
(you)f(don')o(t.)p Black 3759 5569 a Ff(432)p Black eop
end
%%Page: 433 446
TeXDict begin 433 445 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.433) cvn /DEST pdfmark end
 -611 -810 a Black
Black -2 -201 a
SDict begin H.S end
 -2 -201 a -2 -201 a
SDict begin 13 H.A end
 -2 -201 a -2 -201
a
SDict begin [/View [/XYZ H.V]/Dest (0:5499) cvn /DEST pdfmark end
 -2 -201 a 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)
o(ving)g(Pieces)p Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2
-11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5477) cvn /DEST pdfmark end
 -2 -11 a 396 72 a Fk(W)-7 b(e')o(ll)22
b(stick)e(to)h(TCP)g(for)e(all)i(one-to-one)c(messaging.)i(There)h(is)h
(one)e(more)h(use-case)g(for)f(UDP)i(after)f(disco)o(v)o(ery)-5
b(,)396 180 y(which)20 b(is)g(multicast)g(\002le)h(distrib)n(ution.)d
(I')o(ll)i(e)o(xplain)f(why)g(and)g(ho)n(w)-5 b(,)19
b(then)g(shelv)o(e)g(that)h(for)f(another)g(day)-5 b(.)18
b(The)i(why)f(is)396 288 y(simple:)i(what)f(we)g(call)h("social)f(netw)
o(orks")f(is)i(just)g(augmented)d(culture.)h(W)-7 b(e)22
b(create)e(culture)f(by)h(sharing,)f(and)g(this)396 396
y(means)h(more)g(and)f(more,)g(sharing)g(w)o(orks)h(that)h(we)f(mak)o
(e)g(or)g(remix.)f(Photos,)h(documents,)e(contracts,)h(tweets.)i(The)
396 504 y(clouds)f(of)g(de)n(vices)f(we')l(re)h(aiming)f(to)n(w)o(ards)
h(do)g(more)f(of)h(this,)h(not)e(less.)-2 688 y
SDict begin H.S end
 -2 688
a -2 688 a
SDict begin 13 H.A end
 -2 688 a -2 688 a
SDict begin [/View [/XYZ H.V]/Dest (0:5478) cvn /DEST pdfmark end
 -2 688 a 396 778 a Fk(No)n(w)-5
b(,)20 b(there)f(are)i(tw)o(o)f(principal)f(patterns)g(for)h(sharing)f
(content.)g(One)h(is)h(the)g("pubsub")d(pattern)h(where)h(one)f(node)
396 886 y(sends)h(out)g(content)g(to)g(a)g(set)h(of)f(other)g(nodes,)f
(at)i(the)f(same)g(time.)g(Second)g(is)h(the)f("late)g(joiner")g
(pattern,)f(where)g(a)396 994 y(node)g(arri)n(v)o(es)h(some)n(what)f
(later)h(and)g(w)o(ants)h(to)f(catch)g(up)g(to)g(the)g(con)m(v)o
(ersation.)d(W)-7 b(e)22 b(can)e(deal)g(with)g(the)g(late)h(joiner)396
1102 y(using)f(TCP)h(unicast.)e(But)i(doing)e(TCP)h(unicast)g(to)h(a)f
(group)e(of)i(clients)g(at)h(the)f(same)g(time)h(has)f(some)g(disadv)n
(antages.)396 1210 y(First,)h(it)g(can)f(be)g(slo)n(wer)g(than)g
(multicast.)g(Second,)f(it')-5 b(s)21 b(unf)o(air)e(since)i(some)f
(will)g(get)h(the)f(content)f(before)g(others.)-2 1394
y
SDict begin H.S end
 -2 1394 a -2 1394 a
SDict begin 13 H.A end
 -2 1394 a -2 1394 a
SDict begin [/View [/XYZ H.V]/Dest (0:5479) cvn /DEST pdfmark end
 -2 1394 a 396
1484 a Fk(Before)h(you)f(jump)h(of)n(f)f(to)h(design)g(a)h(UDP)f
(multicast)h(protocol,)d(realize)i(that)g(it')-5 b(s)21
b(not)f(a)h(simple)f(calculation.)f(When)396 1592 y(you)h(send)f(a)i
(multicast)f(pack)o(et,)g(the)g(W)m(iFi)h(access)g(point)e(uses)i(a)g
(lo)n(w)f(bit)g(rate,)g(to)h(ensure)e(that)h(e)n(v)o(en)f(the)i
(furthest)396 1700 y(de)n(vices)f(will)h(get)f(it)h(safely)-5
b(.)19 b(Most)i(normal)e(APs)i(don')o(t)d(do)i(the)g(ob)o(vious)f
(optimization,)f(which)i(is)h(to)f(measure)g(the)396
1808 y(distance)g(of)g(the)g(furthest)g(de)n(vice)f(and)h(use)g(that)g
(bit)h(rate.)f(Instead)f(the)o(y)h(just)g(use)h(a)f(\002x)o(ed)g(v)n
(alue.)f(So)i(if)f(you)f(ha)n(v)o(e)h(a)396 1916 y(fe)n(w)g(de)n
(vices,)g(close)g(to)h(the)f(AP)-9 b(,)20 b(multicast)g(will)h(be)f
(insanely)g(slo)n(w)-5 b(.)20 b(But)g(if)h(you)e(ha)n(v)o(e)h(a)g
(roomful)f(of)h(de)n(vices)f(which)396 2023 y(all)i(w)o(ant)f(to)h(get)
f(the)g(ne)o(xt)g(chapter)f(of)h(the)g(te)o(xtbook,)e(multicast)i(can)g
(be)g(insanely)f(ef)n(fecti)n(v)o(e.)-2 2208 y
SDict begin H.S end
 -2 2208
a -2 2208 a
SDict begin 13 H.A end
 -2 2208 a -2 2208 a
SDict begin [/View [/XYZ H.V]/Dest (0:5480) cvn /DEST pdfmark end
 -2 2208 a 396 2297 a
Fk(The)h(curv)o(es)f(cross)i(around)d(6-12)h(de)n(vices)g(depending)f
(on)i(the)g(netw)o(ork.)e(Y)-9 b(ou)20 b(could)f(in)h(theory)f(measure)
h(the)g(curv)o(es)396 2405 y(in)h(real-time)e(and)h(create)g(an)g
(adapti)n(v)o(e)e(protocol.)h(That)h(w)o(ould)f(be)h(cool)g(b)n(ut)g
(probably)e(too)i(hard)f(for)h(e)n(v)o(en)f(the)396 2513
y(smartest)i(of)f(us.)-2 2680 y
SDict begin H.S end
 -2 2680 a -2 2680 a
SDict begin 13 H.A end
 -2
2680 a -2 2680 a
SDict begin [/View [/XYZ H.V]/Dest (0:5481) cvn /DEST pdfmark end
 -2 2680 a 396 2787 a Fk(If)g(you)g(do)f(sit)j(do)n(wn)
d(and)g(sk)o(etch)h(out)g(a)h(UDP)g(multicast)f(protocol,)e(realize)i
(that)g(you)g(need)f(a)i(channel)e(for)g(reco)o(v)o(ery)-5
b(,)396 2895 y(to)21 b(get)f(lost)h(pack)o(ets.)e(Y)-9
b(ou')l(d)19 b(probably)f(w)o(ant)i(to)g(do)g(this)h(o)o(v)o(er)e(TCP)
-9 b(,)20 b(using)g(\330MQ.)g(F)o(or)g(no)n(w)-5 b(,)19
b(ho)n(we)n(v)o(er)m(,)f(we')o(ll)396 3003 y(assume)i(all)h(traf)n
(\002c)f(goes)g(o)o(v)o(er)f(TCP)-9 b(.)-2 3032 y
SDict begin H.S end
 -2
3032 a -2 3032 a
SDict begin 13 H.A end
 -2 3032 a -2 3032 a
SDict begin [/View [/XYZ H.V]/Dest (0:5482) cvn /DEST pdfmark end
 -2 3032 a 396 3342
a Fb(8.3.6.)36 b(Designing)f(the)e(T)-10 b(opology)35
b(La)n(y)o(er)2429 3342 y
SDict begin H.S end
 2429 3342 a 2429 3342 a
SDict begin 18.72 H.A end
 2429
3342 a 2429 3342 a
SDict begin [/View [/XYZ H.V]/Dest (13.99.110.2) cvn /DEST pdfmark
end
 2429 3342 a -2 3534 a
SDict begin H.S end
 -2 3534 a -2
3534 a
SDict begin 13 H.A end
 -2 3534 a -2 3534 a
SDict begin [/View [/XYZ H.V]/Dest (0:5484) cvn /DEST pdfmark end
 -2 3534 a 396 3616 a Fk(Sending)19
b(UUIDs)i(across)f(the)g(netw)o(ork)f(is)i(the)f(bare)g(minimum)f(for)g
(a)i(logical)f(addressing)f(scheme.)g(Ho)n(we)n(v)o(er)g(we)396
3724 y(ha)n(v)o(e)h(a)g(fe)n(w)h(more)e(problems)g(to)h(solv)o(e)g
(before)f(this)h(will)h(w)o(ork)f(in)g(real)g(use:)-2
3742 y
SDict begin H.S end
 -2 3742 a -2 3742 a
SDict begin 13 H.A end
 -2 3742 a -2 3742 a
SDict begin [/View [/XYZ H.V]/Dest (0:5485) cvn /DEST pdfmark end
 -2 3742
a -2 3752 a
SDict begin H.S end
 -2 3752 a -2 3752 a
SDict begin 13 H.A end
 -2 3752 a -2 3752 a
SDict begin [/View [/XYZ H.V]/Dest (0:5486) cvn /DEST pdfmark end
 -2
3752 a Black 396 3894 a Fj(\225)p Black 479 3894 a
SDict begin H.S end
 479
3894 a 479 3894 a
SDict begin 13 H.A end
 479 3894 a 479 3894 a
SDict begin [/View [/XYZ H.V]/Dest (0:5487) cvn /DEST pdfmark end
 479 3894 a Fk(W)-7
b(e)22 b(need)d(some)h(protocol)f(identi\002cation)g(so)h(that)g(we)h
(can)f(check)f(for)m(,)g(and)h(reject)g(in)m(v)n(alid)f(pack)o(ets.)-2
3912 y
SDict begin H.S end
 -2 3912 a -2 3912 a
SDict begin 13 H.A end
 -2 3912 a -2 3912 a
SDict begin [/View [/XYZ H.V]/Dest (0:5488) cvn /DEST pdfmark end
 -2 3912
a Black 396 4043 a Fj(\225)p Black 479 4043 a
SDict begin H.S end
 479 4043
a 479 4043 a
SDict begin 13 H.A end
 479 4043 a 479 4043 a
SDict begin [/View [/XYZ H.V]/Dest (0:5489) cvn /DEST pdfmark end
 479 4043 a Fk(W)-7
b(e)22 b(need)d(some)h(v)o(ersion)f(information)f(so)i(that)h(we)f(can)
g(change)f(this)i(protocol)d(o)o(v)o(er)h(time.)-2 4061
y
SDict begin H.S end
 -2 4061 a -2 4061 a
SDict begin 13 H.A end
 -2 4061 a -2 4061 a
SDict begin [/View [/XYZ H.V]/Dest (0:5490) cvn /DEST pdfmark end
 -2 4061 a Black
396 4193 a Fj(\225)p Black 479 4193 a
SDict begin H.S end
 479 4193 a 479
4193 a
SDict begin 13 H.A end
 479 4193 a 479 4193 a
SDict begin [/View [/XYZ H.V]/Dest (0:5491) cvn /DEST pdfmark end
 479 4193 a Fk(W)-7 b(e)22
b(need)d(to)h(tell)h(other)f(nodes)f(ho)n(w)h(to)g(reach)g(us)g(via)g
(TCP)-9 b(,)21 b(i.e.)f(a)h(\330MQ)f(port)g(the)o(y)f(can)h(talk)g(to)h
(us)f(on.)-2 4377 y
SDict begin H.S end
 -2 4377 a -2 4377 a
SDict begin 13 H.A end
 -2 4377 a -2
4377 a
SDict begin [/View [/XYZ H.V]/Dest (0:5492) cvn /DEST pdfmark end
 -2 4377 a 396 4467 a Fk(Let')-5 b(s)21 b(start)g(with)f(the)g
(beacon)f(message)h(format.)f(W)-7 b(e)21 b(probably)d(w)o(ant)j(a)f
(\002x)o(ed)g(protocol)e(header)h(that)i(will)g(ne)n(v)o(er)396
4575 y(change)e(in)h(future)f(v)o(ersions,)g(and)h(a)h(body)e(that)h
(depends)f(on)g(the)i(v)o(ersion.)d(W)-7 b(e)22 b(need)d(a)i(name)e
(for)h(the)g(protocol,)e(so)396 4682 y(\(digs)i(in)g(pock)o(et)g(for)f
(some)h(backron)o(yms\))d(perhaps)i("ZeroMQ)g(Real-time)h
(Experience"\()p 0 TeXcolorgray 3086 4682 a
SDict begin H.S end
 3086 4682
a Fk(Figure)d(8-1)3433 4682 y
SDict begin 13 H.L end
 3433 4682 a 3433 4682 a
SDict begin [/Subtype /Link/Dest (0:figure-73) cvn/H /I/Border [0 0
0]BorderArrayPatch/Color [1 0 0] H.B /ANN pdfmark end

3433 4682 a Black -1 w Fk(\).)-2 4700 y
SDict begin H.S end
 -2 4700 a -2
4700 a
SDict begin 13 H.A end
 -2 4700 a -2 4700 a
SDict begin [/View [/XYZ H.V]/Dest (0:figure-73) cvn /DEST pdfmark
end
 -2 4700 a Black 3759 5569
a Ff(433)p Black eop end
%%Page: 434 447
TeXDict begin 434 446 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.434) cvn /DEST pdfmark end
 -611 -810 a Black
Black 2541 -132 a Ff(Chapter)19 b(8.)h(A)h(Univer)o(se)g(of)f(Mo)o
(ving)g(Pieces)p Black 396 72 a Fg(Figur)o(e)g(8-1.)f(ZRE)i(disco)o(v)o
(ery)f(message)-2 172 y
SDict begin H.S end
 -2 172 a -2 172 a
SDict begin 13 H.A end
 -2 172 a -2
172 a
SDict begin [/View [/XYZ H.V]/Dest (0:5496) cvn /DEST pdfmark end
 -2 172 a 396 1189 a
 currentpoint currentpoint translate 1 1 scale neg exch neg exch translate
 396 1189 a @beginspecial 0
@llx -117 @lly 405 @urx 0 @ury 4050 @rwi @setspecial
%%BeginDocument: images/fig73.eps
%!PS-Adobe-3.0 EPSF-3.0
%%BoundingBox: 0 -117 405 0
%%HiResBoundingBox: 0.0 -117.0 405.0 0.0
%%Creator: DitaaEps
%%EndComments
%%BeginProlog
%%EndProlog
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
24.70026969909668 -34.70027160644531 moveto
24.70026969909668 -60.70027160644531 lineto
58.70027160644531 -60.70027160644531 lineto
58.70027160644531 -34.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
61.70027160644531 -34.70027160644531 moveto
61.70027160644531 -60.70027160644531 lineto
94.70027160644531 -60.70027160644531 lineto
94.70027160644531 -34.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
97.70027160644531 -34.70027160644531 moveto
97.70027160644531 -60.70027160644531 lineto
130.7002716064453 -60.70027160644531 lineto
130.7002716064453 -34.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
133.7002716064453 -34.70027160644531 moveto
133.7002716064453 -60.70027160644531 lineto
195.7002716064453 -60.70027160644531 lineto
195.7002716064453 -34.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
222.7002716064453 -34.70027160644531 moveto
222.7002716064453 -60.70027160644531 lineto
283.70025634765625 -60.70027160644531 lineto
283.70025634765625 -34.70027160644531 lineto
closepath
fill
0.5882352941176471 0.5882352941176471 0.5882352941176471 setrgbcolor
newpath
286.70025634765625 -34.70027160644531 moveto
286.70025634765625 -60.70027160644531 lineto
384.70025634765625 -60.70027160644531 lineto
384.70025634765625 -34.70027160644531 lineto
closepath
fill
1.0 1.0 1.0 setrgbcolor
newpath
22.0 -32.0 moveto
22.0 -58.0 lineto
56.0 -58.0 lineto
56.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
0.9 setlinewidth
1 setlinecap
[] 0 setdash
newpath
22.0 -32.0 moveto
22.0 -58.0 lineto
56.0 -58.0 lineto
56.0 -32.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
59.0 -32.0 moveto
59.0 -58.0 lineto
92.0 -58.0 lineto
92.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
59.0 -32.0 moveto
59.0 -58.0 lineto
92.0 -58.0 lineto
92.0 -32.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
95.0 -32.0 moveto
95.0 -58.0 lineto
128.0 -58.0 lineto
128.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
95.0 -32.0 moveto
95.0 -58.0 lineto
128.0 -58.0 lineto
128.0 -32.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
131.0 -32.0 moveto
131.0 -58.0 lineto
193.0 -58.0 lineto
193.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
131.0 -32.0 moveto
131.0 -58.0 lineto
193.0 -58.0 lineto
193.0 -32.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
220.0 -32.0 moveto
220.0 -58.0 lineto
281.0 -58.0 lineto
281.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
220.0 -32.0 moveto
220.0 -58.0 lineto
281.0 -58.0 lineto
281.0 -32.0 lineto
closepath
stroke
1.0 1.0 1.0 setrgbcolor
newpath
284.0 -32.0 moveto
284.0 -58.0 lineto
382.0 -58.0 lineto
382.0 -32.0 lineto
closepath
fill
0.0 0.0 0.0 setrgbcolor
newpath
284.0 -32.0 moveto
284.0 -58.0 lineto
382.0 -58.0 lineto
382.0 -32.0 lineto
closepath
stroke
/Helvetica findfont
14 scalefont setfont
37.0 -51.0 moveto
(Z ) show
74.0 -51.0 moveto
(R ) show
110.0 -51.0 moveto
(E ) show
145.0 -50.0 moveto
(%x01) show
235.0 -51.0 moveto
(UUID) show
298.0 -51.0 moveto
(endpoint) show
81.0 -90.0 moveto
(Header) show
280.0 -89.0 moveto
(Body) show
showpage
%%Trailer
%%EOF

%%EndDocument
 @endspecial 396 1189 a
 currentpoint currentpoint translate 1 1 div 1 1 div scale neg exch
neg exch translate
 396 1189 a 274 x Fk(The)g(v)o(ersion)f(can)g
(be)h(a)h(1-byte)d(counter)h(starting)g(at)i(1.)f(The)f(UUID)h(is)h(16)
f(bytes,)f(and)g(the)h(endpoint)f(is)h(a)h(2-byte)d(port)396
1571 y(number)m(,)g(since)i(UDP)h(nicely)f(tells)h(us)g(the)f(sender')
-5 b(s)20 b(IP)g(address)g(for)f(e)n(v)o(ery)g(message)h(we)h(recei)n
(v)o(e.)e(This)h(gi)n(v)o(es)g(us)g(a)396 1679 y(22-byte)f(frame.)-2
1863 y
SDict begin H.S end
 -2 1863 a -2 1863 a
SDict begin 13 H.A end
 -2 1863 a -2 1863 a
SDict begin [/View [/XYZ H.V]/Dest (0:5500) cvn /DEST pdfmark end
 -2 1863
a 396 1953 a Fk(What)i(kind)e(of)h(sock)o(et)g(do)g(we)h(w)o(ant)f(for)
f(the)i(endpoint?)d(This)i(question)f(comes)h(up)g(on)g(the)3111
1953 y
SDict begin H.S end
 3111 1953 a 3111 1953 a
SDict begin 13 H.A end
 3111 1953 a 3111 1953
a
SDict begin [/View [/XYZ H.V]/Dest (0:5501) cvn /DEST pdfmark end
 3111 1953 a Fe(zeromq-dev)f Fk(mailing)396 2061 y(list)j(from)d(time)
h(to)g(time:)h(ho)n(w)e(to)i(interconnect)d(peers)i(where)f(there')-5
b(s)21 b(no)e(serv)o(er)h(or)g(client.)g(People)f(often)h(try)g(to)g
(use)396 2169 y(R)m(OUTER)h(sock)o(ets.)f(I)g(usually)g(tell)h(them)f
(that')-5 b(s)20 b(hard)f(to)i(w)o(ork)e(with,)h(because)g(R)m(OUTER)h
(sock)o(ets)f(need)f(some)396 2276 y(kind)h(of)g(address)f
(bootstrapping;)f(you)h(can')o(t)g(send)h(a)h(message)f(until)g(you)f
(kno)n(w)g(the)h(identity)g(of)g(the)g(peer)m(,)f(which)396
2384 y(you)h(only)f(learn)h(when)f(you)h(get)g(a)g(message)g(from)g
(them.)f(So)h(usually)g(the)g(answer)g(is)h(a)g(DEALER-R)m(OUTER)f(mix)
396 2492 y(where)g(each)g(peer)f(has)i(tw)o(o)f(sock)o(ets;)h(DEALER)f
(to)g(recei)n(v)o(e)f(messages)i(and)e(R)m(OUTER)i(to)f(send)g(them.)-2
2676 y
SDict begin H.S end
 -2 2676 a -2 2676 a
SDict begin 13 H.A end
 -2 2676 a -2 2676 a
SDict begin [/View [/XYZ H.V]/Dest (0:5502) cvn /DEST pdfmark end
 -2 2676
a 396 2766 a Fk(Ho)n(we)n(v)o(er)m(,)e(we)851 2766 y
SDict begin H.S end

851 2766 a 851 2766 a
SDict begin 13 H.A end
 851 2766 a 851 2766 a
SDict begin [/View [/XYZ H.V]/Dest (0:5503) cvn /DEST pdfmark end
 851 2766
a Ff(do)i Fk(ha)n(v)o(e)f(a)i(w)o(ay)f(to)g(bootstrap,)f(since)h(e)n(v)
o(ery)f(node)g(has)i(its)g(o)n(wn)f(UUID)g(and)f(this)i(is)g
(compatible)e(with)396 2874 y(R)m(OUTER)i(addressing.)d(What)j(we)g(ha)
n(v)o(e)e(to)h(do)g(is)h(use)g(the)f(ZMQ_IDENTITY)e(setting)i(on)g(our)
f(o)n(wn)h(R)m(OUTER)396 2982 y(sock)o(et)g(using)g(our)f(o)n(wn)h
(UUID.)g(So,)g(let')-5 b(s)21 b(try)f(to)h(use)f(a)h(single)f(R)m
(OUTER)g(for)g(all)h(input)e(and)h(all)h(output)d(and)i(see)h(if)396
3090 y(this)g(w)o(orks.)-2 3257 y
SDict begin H.S end
 -2 3257 a -2 3257 a
SDict begin 13 H.A end

-2 3257 a -2 3257 a
SDict begin [/View [/XYZ H.V]/Dest (0:5504) cvn /DEST pdfmark end
 -2 3257 a 396 3364 a Fk(\(More)e(coming)g(soon...)g
(@hintjens)h(on)g(T)-7 b(witter\))p Black 3759 5569 a
Ff(434)p Black eop end
%%Page: 435 448
TeXDict begin 435 447 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.435) cvn /DEST pdfmark end
 -611 -810 a Black
Black Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11
a
SDict begin [/View [/XYZ H.V]/Dest (0:5505) cvn /DEST pdfmark end
 -2 -11 a 126 x Fh(Chapter)48 b(9.)f(P)-7 b(ostface)1598
115 y
SDict begin H.S end
 1598 115 a 1598 115 a
SDict begin 26.957 H.A end
 1598 115 a 1598 115 a
SDict begin [/View [/XYZ H.V]/Dest (14.0) cvn /DEST pdfmark end
 1598
115 a -2 204 a
SDict begin H.S end
 -2 204 a -2 204 a
SDict begin 13 H.A end
 -2 204 a -2 204 a
SDict begin [/View [/XYZ H.V]/Dest (0:5507) cvn /DEST pdfmark end
 -2
204 a 342 x Fn(9.1.)39 b(T)-11 b(ales)38 b(fr)m(om)h(Out)g(There)1707
546 y
SDict begin H.S end
 1707 546 a 1707 546 a
SDict begin 22.464 H.A end
 1707 546 a 1707 546 a
SDict begin [/View [/XYZ H.V]/Dest (14.100.1) cvn /DEST pdfmark end
 1707
546 a -2 714 a
SDict begin H.S end
 -2 714 a -2 714 a
SDict begin 13 H.A end
 -2 714 a -2 714 a
SDict begin [/View [/XYZ H.V]/Dest (0:5509) cvn /DEST pdfmark end
 -2
714 a 396 820 a Fk(I)21 b(ask)o(ed)f(some)g(of)g(the)g(contrib)n(utors)
e(to)i(the)h(Guide)e(to)i(tell)g(us)f(what)g(the)o(y)g(were)g(doing)f
(with)h(\330MQ.)g(Here)g(are)g(their)396 928 y(stories.)-2
929 y
SDict begin H.S end
 -2 929 a -2 929 a
SDict begin 13 H.A end
 -2 929 a -2 929 a
SDict begin [/View [/XYZ H.V]/Dest (0:5510) cvn /DEST pdfmark end
 -2 929 a 396
1256 a Fb(9.1.1.)36 b(Rob)d(Ga)o(gnon')-7 b(s)34 b(Stor)q(y)1877
1256 y
SDict begin H.S end
 1877 1256 a 1877 1256 a
SDict begin 18.72 H.A end
 1877 1256 a 1877 1256
a
SDict begin [/View [/XYZ H.V]/Dest (14.100.111.2) cvn /DEST pdfmark
end
 1877 1256 a -2 1449 a
SDict begin H.S end
 -2 1449 a -2 1449 a
SDict begin 13 H.A end
 -2 1449 a
-2 1449 a
SDict begin [/View [/XYZ H.V]/Dest (0:5512) cvn /DEST pdfmark end
 -2 1449 a 396 1530 a Fk("W)-7 b(e)21 b(use)g(\330MQ)f(to)h
(assist)g(in)g(aggre)o(gating)c(thousands)i(of)g(e)n(v)o(ents)h
(occurring)e(e)n(v)o(ery)h(minute)g(across)h(our)g(global)396
1638 y(netw)o(ork)f(of)h(telecommunications)e(serv)o(ers)h(so)i(that)f
(we)h(can)f(accurately)f(report)g(and)g(monitor)g(for)g(situations)i
(that)396 1746 y(require)e(our)h(attention.)f(\330MQ)h(made)g(the)g(de)
n(v)o(elopment)d(of)j(the)g(system)h(not)f(only)f(easier)m(,)h(b)n(ut)g
(f)o(aster)g(to)h(de)n(v)o(elop,)396 1854 y(and)f(more)f(rob)n(ust)h
(and)g(f)o(ault-tolerant)e(than)i(we)g(had)g(originally)e(planned)h(in)
h(our)g(original)f(design.)-2 2038 y
SDict begin H.S end
 -2 2038 a -2 2038
a
SDict begin 13 H.A end
 -2 2038 a -2 2038 a
SDict begin [/View [/XYZ H.V]/Dest (0:5513) cvn /DEST pdfmark end
 -2 2038 a 396 2128 a Fk("W)-7 b(e')l(re)20
b(able)h(to)f(easily)g(add)g(and)g(remo)o(v)o(e)e(clients)i(from)g(the)
g(netw)o(ork)f(without)g(the)h(loss)h(of)f(an)o(y)g(message.)f(If)h(we)
396 2236 y(need)g(to)g(enhance)f(the)h(serv)o(er)f(portion)g(of)h(our)f
(system,)h(we)h(can)f(stop)g(and)g(restart)g(it)h(as)g(well,)f(without)
g(ha)n(ving)f(to)396 2344 y(w)o(orry)g(about)h(stopping)e(all)j(of)f
(the)g(clients)h(\002rst.)g(The)e(b)n(uilt-in)h(b)n(uf)n(fering)e(of)i
(\330MQ)g(mak)o(es)g(this)h(all)g(possible.")-2 2372
y
SDict begin H.S end
 -2 2372 a -2 2372 a
SDict begin 13 H.A end
 -2 2372 a -2 2372 a
SDict begin [/View [/XYZ H.V]/Dest (0:5514) cvn /DEST pdfmark end
 -2 2372 a 396
2682 a Fb(9.1.2.)36 b(T)-10 b(om)34 b(v)n(an)f(Leeuwen')-7
b(s)36 b(Stor)q(y)2186 2682 y
SDict begin H.S end
 2186 2682 a 2186 2682 a
SDict begin 18.72 H.A end

2186 2682 a 2186 2682 a
SDict begin [/View [/XYZ H.V]/Dest (14.100.112.2) cvn /DEST pdfmark
end
 2186 2682 a -2 2873 a
SDict begin H.S end
 -2 2873
a -2 2873 a
SDict begin 13 H.A end
 -2 2873 a -2 2873 a
SDict begin [/View [/XYZ H.V]/Dest (0:5516) cvn /DEST pdfmark end
 -2 2873 a 396 2956 a
Fk("I)21 b(w)o(as)g(looking)d(for)i(creating)f(some)h(kind)f(of)h
(service)g(b)n(us)g(connecting)e(all)j(kinds)f(of)g(services)g
(together)-5 b(.)19 b(There)396 3064 y(were)h(already)f(some)h
(products)f(that)h(implemented)f(a)h(brok)o(er)m(,)e(b)n(ut)j(the)o(y)e
(did)h(not)g(ha)n(v)o(e)f(the)i(functionality)d(I)396
3172 y(w)o(anted/needed.)g(By)i(accident)f(I)h(stumbled)f(upon)f
(\330MQ)i(which)f(is)i(a)o(wesome.)e(It')-5 b(s)20 b(v)o(ery)f
(lightweight,)f(lean,)i(simple)396 3280 y(and)g(easy)g(to)h(follo)n(w)e
(since)h(the)h(zguide)e(is)i(v)o(ery)e(complete)g(and)h(reads)f(v)o
(ery)h(well.)g(I')l(v)o(e)f(actually)h(implemented)e(the)396
3388 y(T)m(itanic)i(pattern)f(and)g(the)g(Majordomo)f(brok)o(er)g(with)
i(some)f(additions)g(\(client/w)o(ork)o(er)f(authentication)f(and)i(w)o
(ork)o(ers)396 3496 y(sending)g(a)i(catalog)e(e)o(xplaining)f(what)j
(the)o(y)e(pro)o(vide)f(and)i(ho)n(w)g(the)o(y)f(should)g(be)h
(addressed\).)-2 3680 y
SDict begin H.S end
 -2 3680 a -2 3680 a
SDict begin 13 H.A end
 -2 3680 a
-2 3680 a
SDict begin [/View [/XYZ H.V]/Dest (0:5517) cvn /DEST pdfmark end
 -2 3680 a 396 3770 a Fk("The)g(beautiful)f(thing)g(about)h
(\330MQ)g(is)h(the)f(f)o(act)h(that)f(it)h(is)g(a)g(library)e(and)g
(not)h(an)g(application.)f(Y)-9 b(ou)19 b(can)h(mold)g(it)396
3878 y(ho)n(we)n(v)o(er)e(you)i(lik)o(e)g(and)g(it)h(simply)f(puts)g
(boring)e(things)i(lik)o(e)g(queuing,)e(reconnecting,)g(tcp)i(sock)o
(ets)g(and)g(such)g(to)g(the)396 3985 y(background,)d(making)i(sure)h
(you)f(can)h(concentrate)e(on)i(what)g(is)h(important)e(for)h(you.)f
(I')l(v)o(e)g(implemented)f(all)j(kinds)396 4093 y(of)f(w)o(ork)o
(ers/clients)f(and)h(the)g(brok)o(er)e(in)i(Ruby)-5 b(,)19
b(because)h(that)g(is)h(the)f(main)f(language)g(we)h(use)g(for)g(de)n
(v)o(elopment,)d(b)n(ut)396 4201 y(also)k(some)f(php)f(clients)i(to)f
(connect)f(to)h(the)g(b)n(us)h(from)e(e)o(xisting)g(php)h(webapps.)f(W)
-7 b(e)21 b(use)f(this)h(service)f(b)n(us)h(for)e(cloud)396
4309 y(services)h(connecting)e(all)j(kinds)f(of)g(platform)f(de)n
(vices)g(to)i(a)f(service)g(b)n(us)g(e)o(xposing)f(functionality)f(for)
h(automation.)-2 4493 y
SDict begin H.S end
 -2 4493 a -2 4493 a
SDict begin 13 H.A end
 -2 4493 a
-2 4493 a
SDict begin [/View [/XYZ H.V]/Dest (0:5518) cvn /DEST pdfmark end
 -2 4493 a 396 4583 a Fk("\330MQ)i(is)g(v)o(ery)e(easy)h(to)g
(understand)e(and)i(if)h(you)e(spend)g(a)i(day)f(in)g(the)g(zguide,)f
(you')o(ll)g(ha)n(v)o(e)h(good)f(kno)n(wledge)f(of)396
4691 y(ho)n(w)i(it)h(w)o(orks.)e(I'm)h(a)h(netw)o(ork)e(engineer)m(,)f
(not)i(a)g(softw)o(are)g(de)n(v)o(eloper)m(,)d(b)n(ut)j(managed)f(to)h
(create)g(a)h(v)o(ery)e(nice)396 4799 y(solution)h(for)f(our)h
(automation)e(needs!)h(\330MQ:)i(Thank)e(you)g(v)o(ery)g(much!")-2
4827 y
SDict begin H.S end
 -2 4827 a -2 4827 a
SDict begin 13 H.A end
 -2 4827 a -2 4827 a
SDict begin [/View [/XYZ H.V]/Dest (0:5519) cvn /DEST pdfmark end
 -2 4827
a Black 3759 5569 a Ff(435)p Black eop end
%%Page: 436 449
TeXDict begin 436 448 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.436) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3228 -132 a Ff(Chapter)20 b(9.)g(P)-7 b(ostface)p
Black 396 77 a Fb(9.1.3.)36 b(Mic)o(hael)e(Jakl')-7 b(s)36
b(Stor)q(y)1865 77 y
SDict begin H.S end
 1865 77 a 1865 77 a
SDict begin 18.72 H.A end
 1865 77 a 1865
77 a
SDict begin [/View [/XYZ H.V]/Dest (14.100.113.2) cvn /DEST pdfmark
end
 1865 77 a -2 267 a
SDict begin H.S end
 -2 267 a -2 267 a
SDict begin 13 H.A end
 -2 267 a -2
267 a
SDict begin [/View [/XYZ H.V]/Dest (0:5521) cvn /DEST pdfmark end
 -2 267 a 396 351 a Fk("W)-7 b(e)21 b(use)g(\330MQ)f(for)g
(distrib)n(uting)f(millions)h(of)g(documents)e(per)i(day)g(in)g(our)f
(distrib)n(uted)h(processing)f(pipeline.)g(W)-7 b(e)396
459 y(started)20 b(out)g(with)h(big)e(message)h(queuing)f(brok)o(ers)g
(that)h(had)g(their)f(o)n(wn)h(respecti)n(v)o(e)f(issues)i(and)f
(problems.)e(In)i(the)396 566 y(quest)g(of)g(simplifying)f(our)g
(architecture,)g(we)h(chose)g(\330MQ)g(to)h(do)f(the)g(wiring.)f(So)h
(f)o(ar)h(it)f(had)g(a)h(huge)e(impact)h(in)396 674 y(ho)n(w)g(our)f
(architecture)g(scales)i(and)f(ho)n(w)f(easy)i(it)f(is)i(to)e
(change/mo)o(v)o(e)d(the)j(components.)e(The)i(plethora)e(of)i
(language)396 782 y(bindings)f(lets)i(us)g(choose)e(the)h(right)g(tool)
g(for)f(the)h(job)g(without)g(sacri\002cing)f(interoperability)f(in)i
(our)g(system.)g(W)-7 b(e)396 890 y(don')o(t)19 b(use)h(a)h(lot)f(of)g
(sock)o(ets)g(\(less)h(than)f(10)g(in)g(our)g(whole)f(application\),)f
(b)n(ut)j(that')-5 b(s)20 b(all)h(we)g(needed)e(to)h(split)h(a)f(huge)
396 998 y(monolithic)f(application)g(into)g(small)i(independent)d
(parts.)-2 1182 y
SDict begin H.S end
 -2 1182 a -2 1182 a
SDict begin 13 H.A end
 -2 1182 a -2 1182
a
SDict begin [/View [/XYZ H.V]/Dest (0:5522) cvn /DEST pdfmark end
 -2 1182 a 396 1272 a Fk("All)j(in)f(all,)h(\330MQ)f(lets)h(me)g(k)o
(eep)e(my)h(sanity)g(and)g(helps)g(my)g(customers)f(to)h(stay)h(within)
f(b)n(udget.")-2 1301 y
SDict begin H.S end
 -2 1301 a -2 1301 a
SDict begin 13 H.A end
 -2 1301 a
-2 1301 a
SDict begin [/View [/XYZ H.V]/Dest (0:5523) cvn /DEST pdfmark end
 -2 1301 a 396 1611 a Fb(9.1.4.)36 b(V)-7 b(adim)33
b(Shalts')-7 b(s)35 b(Stor)q(y)1905 1611 y
SDict begin H.S end
 1905 1611
a 1905 1611 a
SDict begin 18.72 H.A end
 1905 1611 a 1905 1611 a
SDict begin [/View [/XYZ H.V]/Dest (14.100.114.2) cvn /DEST pdfmark
end
 1905 1611 a -2
1801 a
SDict begin H.S end
 -2 1801 a -2 1801 a
SDict begin 13 H.A end
 -2 1801 a -2 1801 a
SDict begin [/View [/XYZ H.V]/Dest (0:5525) cvn /DEST pdfmark end
 -2 1801
a 396 1885 a Fk("I)21 b(am)f(team)g(leader)f(in)i(the)f(compan)o(y)e
(ActF)o(ore)o(x,)g(which)i(de)n(v)o(elops)f(softw)o(are)g(for)h
(\002nancial)g(mark)o(ets.)f(Due)h(to)h(the)396 1993
y(nature)e(of)h(our)g(domain,)e(we)j(need)e(to)i(process)f(lar)o(ge)f
(v)n(olumes)g(of)h(prices)g(quickly)-5 b(.)18 b(In)i(addition,)f(it')-5
b(s)21 b(e)o(xtremely)396 2100 y(critical)g(to)f(minimize)f(latenc)o(y)
h(in)g(processing)f(orders)g(and)h(prices.)f(Achie)n(v)o(e)g(a)i(high)e
(throughput)f(is)j(not)f(enough.)396 2208 y(Ev)o(erything)e(must)i(be)g
(handled)f(in)h(a)h(soft)f(real-time)f(with)i(a)f(predictable)f(ultra)h
(lo)n(w)g(latenc)o(y)f(per)h(price.)g(The)g(system)396
2316 y(consists)h(of)f(multiple)f(components)f(which)i(e)o(xchanging)d
(messages.)j(Each)g(price)g(can)g(tak)o(e)g(a)h(lot)f(of)g(processing)
396 2424 y(stages,)h(each)f(of)f(which)h(increases)g(total)g(latenc)o
(y)-5 b(.)19 b(As)i(a)g(consequence,)c(lo)n(w)k(and)e(predictable)g
(latenc)o(y)g(of)396 2532 y(messaging)h(between)f(components)f(becomes)
h(a)i(k)o(e)o(y)e(f)o(actor)h(of)g(our)f(architecture.)-2
2716 y
SDict begin H.S end
 -2 2716 a -2 2716 a
SDict begin 13 H.A end
 -2 2716 a -2 2716 a
SDict begin [/View [/XYZ H.V]/Dest (0:5526) cvn /DEST pdfmark end
 -2 2716
a 396 2806 a Fk("W)-7 b(e)21 b(in)m(v)o(estigated)e(dif)n(ferent)f
(solutions)i(to)g(\002nd)g(suitable)g(for)g(our)f(needs.)g(W)-7
b(e)22 b(tried)e(dif)n(ferent)e(message)i(brok)o(ers)396
2914 y(\(RabbitMQ,)g(Acti)n(v)o(eMQ)f(Apollo,)g(Kafka\),)g(b)n(ut)h(f)o
(ailed)g(to)h(reach)e(a)i(lo)n(w)f(and)g(predictable)e(latenc)o(y)i
(with)g(an)o(y)f(of)396 3022 y(them.)h(In)g(the)g(end,)f(we)i(ha)n(v)o
(e)e(chosen)h(ZeroMQ)f(used)h(in)g(conjunction)e(with)i(ZooK)n(eeper)f
(for)g(service)h(disco)o(v)o(ery)-5 b(.)396 3130 y(Comple)o(x)19
b(coordination)f(with)i(ZeroMQ)f(requires)g(a)i(relati)n(v)o(ely)e(lar)
o(ge)g(ef)n(fort)g(and)h(a)h(good)d(understanding,)f(as)k(a)396
3238 y(result)f(of)g(the)g(natural)g(comple)o(xity)e(of)h
(multi-threading.)e(W)-7 b(e)22 b(found)c(that)i(e)o(xternal)f(agent)h
(lik)o(e)g(ZooK)n(eeper)e(is)j(better)396 3346 y(choice)f(for)f
(service)h(disco)o(v)o(ery)e(and)i(coordination)d(while)j(ZeroMQ)g(can)
g(be)g(used)g(primary)e(for)i(simple)g(messaging.)396
3454 y(ZeroMQ)g(perfectly)e(\002t)j(into)f(our)g(architecture.)e(It)j
(allo)n(wed)e(us)i(to)f(achie)n(v)o(e)f(the)h(desired)g(latenc)o(y)f
(using)h(minimal)396 3562 y(ef)n(forts.)f(It)i(sa)n(v)o(ed)e(us)i(from)
e(a)h(bottleneck)f(in)h(the)g(processing)f(of)h(messages)g(and)f(made)h
(processing)e(time)j(v)o(ery)e(stable)396 3670 y(and)h(predictable.)-2
3854 y
SDict begin H.S end
 -2 3854 a -2 3854 a
SDict begin 13 H.A end
 -2 3854 a -2 3854 a
SDict begin [/View [/XYZ H.V]/Dest (0:5527) cvn /DEST pdfmark end
 -2 3854
a 396 3944 a Fk("I)h(can)f(decidedly)e(recommend)g(ZeroMQ)h(for)h
(solutions)f(where)h(lo)n(w)g(latenc)o(y)f(is)i(important.")-2
4055 y
SDict begin H.S end
 -2 4055 a -2 4055 a
SDict begin 13 H.A end
 -2 4055 a -2 4055 a
SDict begin [/View [/XYZ H.V]/Dest (0:5528) cvn /DEST pdfmark end
 -2 4055
a 359 x Fn(9.2.)39 b(Ho)n(w)g(the)g(Guide)f(Happened)2015
4414 y
SDict begin H.S end
 2015 4414 a 2015 4414 a
SDict begin 22.464 H.A end
 2015 4414 a 2015 4414
a
SDict begin [/View [/XYZ H.V]/Dest (14.101.1) cvn /DEST pdfmark end
 2015 4414 a -2 4610 a
SDict begin H.S end
 -2 4610 a -2 4610 a
SDict begin 13 H.A end
 -2 4610 a
-2 4610 a
SDict begin [/View [/XYZ H.V]/Dest (0:5530) cvn /DEST pdfmark end
 -2 4610 a 396 4688 a Fk(When)20 b(I)h(set)g(out)f(to)g(write)
g(the)g(Guide,)g(we)g(were)g(still)i(debating)d(the)h(pros)f(and)h
(cons)g(of)g(forks)f(and)h(pull)g(requests)g(in)396 4796
y(the)g(\330MQ)h(community)-5 b(.)17 b(T)-7 b(oday)i(,)19
b(for)g(what)i(it')-5 b(s)21 b(w)o(orth,)e(this)i(ar)o(gument)d(seems)i
(settled:)h(the)f("liberal")g(polic)o(y)f(which)396 4904
y(we)i(adopted)d(for)i(libzmq)f(in)i(early)e(2012)g(brok)o(e)g(our)h
(dependenc)o(y)d(on)i(a)i(single)f(prime)g(author)m(,)e(and)i(opened)e
(the)396 5012 y(\003oor)i(to)g(dozens)f(of)h(ne)n(w)g(contrib)n(utors.)
e(More)i(profoundly)-5 b(,)16 b(it)21 b(allo)n(wed)f(us)g(to)g(mo)o(v)o
(e)f(to)i(a)f(gently)f(or)o(ganic)396 5120 y(e)n(v)n(olutionary)f
(model,)h(v)o(ery)g(dif)n(ferent)g(from)g(the)h(older)f(forced-march)e
(model.)p Black 3757 5569 a Ff(436)p Black eop end
%%Page: 437 450
TeXDict begin 437 449 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.437) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3228 -132 a Ff(Chapter)20 b(9.)g(P)-7 b(ostface)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 13 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5531) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fk(The)20 b(reason)g(I)g(w)o(as)h(con\002dent)e(this)h
(w)o(ould)g(w)o(ork)f(w)o(as)j(that)e(our)f(w)o(ork)h(on)g(the)g(Guide)
f(had,)h(for)f(a)i(year)f(or)g(more,)396 180 y(sho)n(wn)g(the)g(w)o(ay)
-5 b(.)20 b(T)m(rue,)f(the)h(te)o(xt)g(is)h(my)f(o)n(wn)g(w)o(ork,)f
(which)h(is)h(perhaps)e(as)i(it)g(should)e(be.)h(Writing)g(is)h(not)396
288 y(programming.)c(When)j(we)g(write,)g(we)h(tell)g(a)f(story)g(and)g
(one)g(doesn')o(t)e(w)o(ant)j(dif)n(ferent)d(v)n(oices)i(telling)g(one)
g(tale,)g(it)396 396 y(feels)h(strange.)-2 580 y
SDict begin H.S end
 -2 580
a -2 580 a
SDict begin 13 H.A end
 -2 580 a -2 580 a
SDict begin [/View [/XYZ H.V]/Dest (0:5532) cvn /DEST pdfmark end
 -2 580 a 396 670 a Fk(F)o(or)f(me)g(the)h
(real)f(long-term)e(v)n(alue)h(of)h(the)h(Guide)e(is)i(the)g
(repository)d(of)i(e)o(xamples:)f(about)g(65,000)f(lines)j(of)f(code)f
(in)396 778 y(24)h(dif)n(ferent)f(languages.)f(It')-5
b(s)21 b(partly)e(about)h(making)e(\330MQ)j(accessible)f(to)h(more)e
(people.)g(People)g(already)h(refer)f(to)396 886 y(the)h(Python)g(and)f
(PHP)i(e)o(xample)e(repositories)g(--)h(tw)o(o)h(of)e(the)i(most)f
(complete)f(--)h(when)g(the)o(y)f(w)o(ant)h(to)h(tell)g(others)396
994 y(ho)n(w)f(to)g(learn)g(\330MQ.)g(But)h(it')-5 b(s)21
b(also)g(about)e(learning)g(programming)d(languages.)-2
1178 y
SDict begin H.S end
 -2 1178 a -2 1178 a
SDict begin 13 H.A end
 -2 1178 a -2 1178 a
SDict begin [/View [/XYZ H.V]/Dest (0:5533) cvn /DEST pdfmark end
 -2 1178
a 396 1268 a Fk(Here')-5 b(s)21 b(a)f(loop)g(of)g(code)f(in)h(Tcl:)-2
1369 y
SDict begin H.S end
 -2 1369 a -2 1369 a
SDict begin 11.7 H.A end
 -2 1369 a -2 1369 a
SDict begin [/View [/XYZ H.V]/Dest (0:5534) cvn /DEST pdfmark end
 -2 1369
a 396 1448 a Fe(while)44 b({1})h({)576 1545 y(#)f(Process)g(all)g
(parts)g(of)h(the)f(message)576 1642 y(zmq)g(message)g(message)576
1740 y(frontend)f(recv_msg)h(message)576 1837 y(set)g(more)g([frontend)
f(getsockopt)h(RCVMORE])576 1934 y(backend)f(send_msg)h(message)f
([expr)h({$more?"SNDMORE":""}])576 2031 y(message)f(close)576
2128 y(if)h({!$more})g({)755 2225 y(break)g(;)h(#)f(Last)g(message)g
(part)576 2322 y(})396 2420 y(})-2 2594 y
SDict begin H.S end
 -2 2594 a -2
2594 a
SDict begin 13 H.A end
 -2 2594 a -2 2594 a
SDict begin [/View [/XYZ H.V]/Dest (0:5535) cvn /DEST pdfmark end
 -2 2594 a 396 2693 a Fk(And)20
b(the)g(same)h(loop)e(in)h(Lua:)-2 2794 y
SDict begin H.S end
 -2 2794 a -2
2794 a
SDict begin 11.7 H.A end
 -2 2794 a -2 2794 a
SDict begin [/View [/XYZ H.V]/Dest (0:5536) cvn /DEST pdfmark end
 -2 2794 a 396 2874 a Fe(while)44
b(true)g(do)576 2971 y(--)89 b(Process)44 b(all)g(parts)g(of)g(the)h
(message)576 3068 y(local)f(msg)g(=)h(frontend:recv\(\))576
3165 y(if)f(\(frontend:getopt\(zmq.RCVMORE\))c(==)45
b(1\))f(then)755 3262 y(backend:send\(msg,)e(zmq.SNDMORE\))576
3359 y(else)755 3456 y(backend:send\(msg,)g(0\))755 3554
y(break;)268 b(--)89 b(Last)44 b(message)g(part)576 3651
y(end)396 3748 y(end)-2 3915 y
SDict begin H.S end
 -2 3915 a -2 3915 a
SDict begin 13 H.A end
 -2
3915 a -2 3915 a
SDict begin [/View [/XYZ H.V]/Dest (0:5537) cvn /DEST pdfmark end
 -2 3915 a 396 4022 a Fk(And)20 b(this)h(particular)e
(e)o(xample)f(\(rrbrok)o(er\))g(is)j(in)f(C#,)g(C++,)h(CL,)g(Clojure,)e
(Erlang,)g(F#,)h(Go,)g(Hask)o(ell,)g(Hax)o(e,)g(Ja)n(v)n(a,)396
4130 y(Lua,)g(Node.js,)f(Perl,)i(PHP)-9 b(,)20 b(Python,)f(Ruby)-5
b(,)19 b(Scala,)h(Tcl,)g(and)g(of)g(course)f(C.)i(This)g(code)e(base,)h
(all)h(licensed)f(as)h(open)396 4238 y(source)f(under)f(the)h(MIT/X11,)
e(may)i(form)f(the)i(basis)f(for)g(other)f(books,)g(or)h(projects.)-2
4422 y
SDict begin H.S end
 -2 4422 a -2 4422 a
SDict begin 13 H.A end
 -2 4422 a -2 4422 a
SDict begin [/View [/XYZ H.V]/Dest (0:5538) cvn /DEST pdfmark end
 -2 4422
a 396 4512 a Fk(But)h(what)f(this)h(collection)e(of)h(translations)g
(says)g(most)g(profoundly)d(is)k(this:)g(the)f(language)f(you)g(choose)
g(is)i(a)g(detail,)396 4620 y(e)n(v)o(en)e(a)i(distraction.)e(The)h(po)
n(wer)f(of)h(\330MQ)g(lies)i(in)e(the)g(patterns)g(it)h(gi)n(v)o(es)e
(you)h(and)f(lets)i(you)f(b)n(uild,)f(and)h(these)396
4728 y(transcend)f(the)h(comings)f(and)h(goings)f(of)h(languages.)f(My)
h(goal)g(as)g(a)h(softw)o(are)f(and)f(social)i(architect)e(is)j(to)e(b)
n(uild)396 4835 y(structures)g(that)g(can)g(last)h(generations.)d
(There)i(seems)g(no)g(point)g(in)g(aiming)f(for)h(mere)g(decades.)-2
4864 y
SDict begin H.S end
 -2 4864 a -2 4864 a
SDict begin 13 H.A end
 -2 4864 a -2 4864 a
SDict begin [/View [/XYZ H.V]/Dest (0:5539) cvn /DEST pdfmark end
 -2 4864
a Black 3756 5569 a Ff(437)p Black eop end
%%Page: 438 451
TeXDict begin 438 450 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.438) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3228 -132 a Ff(Chapter)20 b(9.)g(P)-7 b(ostface)p
Black -2 94 a Fn(9.3.)39 b(Remo)m(ving)e(Friction)1535
94 y
SDict begin H.S end
 1535 94 a 1535 94 a
SDict begin 22.464 H.A end
 1535 94 a 1535 94 a
SDict begin [/View [/XYZ H.V]/Dest (14.102.1) cvn /DEST pdfmark end
 1535 94
a -2 292 a
SDict begin H.S end
 -2 292 a -2 292 a
SDict begin 13 H.A end
 -2 292 a -2 292 a
SDict begin [/View [/XYZ H.V]/Dest (0:5541) cvn /DEST pdfmark end
 -2 292
a 396 368 a Fk(I')o(ll)21 b(e)o(xplain)e(the)h(technical)f(tool)h
(chain)g(we)g(used)g(in)h(terms)f(of)g(the)g(friction)f(we)i(remo)o(v)o
(ed.)c(W)m(ith)k(the)f(Guide)g(we')l(re)396 476 y(telling)g(a)h(story)f
(and)f(the)h(goal)g(is)h(to)g(reach)e(as)i(man)o(y)e(people)g(as)i
(possible,)f(as)h(cheaply)e(and)g(smoothly)g(as)i(we)g(can.)-2
660 y
SDict begin H.S end
 -2 660 a -2 660 a
SDict begin 13 H.A end
 -2 660 a -2 660 a
SDict begin [/View [/XYZ H.V]/Dest (0:5542) cvn /DEST pdfmark end
 -2 660 a 396
750 a Fk(The)f(core)g(idea)g(w)o(as)h(to)f(host)g(the)h(Guide)e(on)h
(github)f(and)h(mak)o(e)f(it)i(easy)g(for)e(an)o(yone)f(to)j(contrib)n
(ute.)d(It)j(turned)e(out)g(to)396 858 y(be)h(more)g(comple)o(x)e(than)
i(that,)g(ho)n(we)n(v)o(er)-5 b(.)-2 1042 y
SDict begin H.S end
 -2 1042 a
-2 1042 a
SDict begin 13 H.A end
 -2 1042 a -2 1042 a
SDict begin [/View [/XYZ H.V]/Dest (0:5543) cvn /DEST pdfmark end
 -2 1042 a 396 1132 a Fk(Let')g(s)21
b(start)g(with)f(the)g(di)n(vision)g(of)g(labor)-5 b(.)19
b(I'm)h(a)g(good)f(writer)h(and)g(can)g(produce)e(endless)i(amounts)f
(of)h(decent)g(te)o(xt)396 1240 y(quickly)-5 b(.)18 b(But)j(what)f(w)o
(as)h(impossible)f(for)f(me)i(w)o(as)g(to)f(pro)o(vide)e(the)i(e)o
(xamples)f(in)i(other)e(languages.)g(Since)h(the)g(core)396
1348 y(\330MQ)h(API)f(is)h(in)g(C,)g(it)f(seemed)g(logical)g(to)g
(write)h(the)f(original)f(e)o(xamples)g(in)h(C.)h(Also,)g(C)g(is)g(a)f
(neutral)g(choice;)f(it')-5 b(s)396 1456 y(perhaps)19
b(the)h(only)g(language)e(that)j(doesn')o(t)d(create)i(strong)f
(emotions.)-2 1640 y
SDict begin H.S end
 -2 1640 a -2 1640 a
SDict begin 13 H.A end
 -2 1640 a -2
1640 a
SDict begin [/View [/XYZ H.V]/Dest (0:5544) cvn /DEST pdfmark end
 -2 1640 a 396 1730 a Fk(Ho)n(w)h(to)h(encourage)d(people)h(to)h
(mak)o(e)g(translations)f(of)h(the)g(e)o(xamples?)f(W)-7
b(e)22 b(tried)e(a)g(fe)n(w)g(approaches)f(and)g(\002nally)396
1838 y(what)h(w)o(ork)o(ed)f(best)i(w)o(as)g(to)f(of)n(fer)f(a)i
("choose)e(your)g(language")f(link)i(on)g(e)n(v)o(ery)f(single)h(e)o
(xample,)f(in)h(the)g(te)o(xt,)g(which)396 1946 y(took)g(people)f
(either)h(to)g(the)g(translation,)f(or)h(to)g(a)h(page)e(e)o(xplaining)
f(ho)n(w)i(the)o(y)g(could)f(contrib)n(ute.)f(The)i(w)o(ay)g(it)396
2053 y(usually)g(w)o(orks)g(is)h(that)f(as)h(people)e(learn)h(\330MQ)g
(in)h(their)f(preferred)d(language,)i(the)o(y)g(contrib)n(ute)g(a)i
(handful)d(of)396 2161 y(translations,)i(or)f(\002x)o(es)i(to)f(the)g
(e)o(xisting)g(ones.)-2 2345 y
SDict begin H.S end
 -2 2345 a -2 2345 a
SDict begin 13 H.A end
 -2
2345 a -2 2345 a
SDict begin [/View [/XYZ H.V]/Dest (0:5545) cvn /DEST pdfmark end
 -2 2345 a 396 2435 a Fk(At)h(the)f(same)h(time)f(I)g
(noticed)g(a)g(fe)n(w)g(people)f(quite)h(determinedly)e(translating)
2755 2435 y
SDict begin H.S end
 2755 2435 a 2755 2435 a
SDict begin 13 H.A end
 2755 2435 a 2755
2435 a
SDict begin [/View [/XYZ H.V]/Dest (0:5546) cvn /DEST pdfmark end
 2755 2435 a Ff(e)o(very)j(single)f Fk(e)o(xample.)e(This)j(w)o
(as)396 2543 y(mainly)f(binding)e(authors)h(who)h(realized)g(that)g
(the)g(e)o(xamples)f(were)h(a)h(great)e(w)o(ay)i(to)f(encourage)e
(people)h(to)h(use)h(their)396 2651 y(bindings.)e(F)o(or)h(their)g(ef)n
(forts,)f(I)h(e)o(xtended)e(the)i(scripts)h(to)f(produce)f
(language-speci\002c)e(v)o(ersions)i(of)h(the)h(Guide.)396
2759 y(Instead)f(of)g(including)e(the)i(C)h(code,)f(we')l(d)f(include)g
(the)i(Python,)d(or)i(PHP)h(code.)f(Lua)f(and)h(Hax)o(e)g(also)g(got)g
(their)396 2867 y(dedicated)f(Guides.)-2 3034 y
SDict begin H.S end
 -2 3034
a -2 3034 a
SDict begin 13 H.A end
 -2 3034 a -2 3034 a
SDict begin [/View [/XYZ H.V]/Dest (0:5547) cvn /DEST pdfmark end
 -2 3034 a 396 3141 a
Fk(Once)h(we)h(ha)n(v)o(e)e(an)h(idea)h(of)e(who)h(w)o(orks)g(on)g
(what,)g(we)g(kno)n(w)f(ho)n(w)h(to)g(structure)g(the)g(w)o(ork)f
(itself.)i(It')-5 b(s)21 b(clear)f(that)g(to)396 3249
y(write)g(and)g(test)g(an)g(e)o(xample,)e(what)i(you)f(w)o(ant)h(to)g
(w)o(ork)f(on)g(is)2245 3249 y
SDict begin H.S end
 2245 3249 a 2245 3249
a
SDict begin 13 H.A end
 2245 3249 a 2245 3249 a
SDict begin [/View [/XYZ H.V]/Dest (0:5548) cvn /DEST pdfmark end
 2245 3249 a Ff(sour)m(ce)h(code)p
Fk(.)f(So)h(we)g(import)f(this)h(source)f(code)g(when)396
3357 y(we)i(b)n(uild)f(the)g(Guide,)f(and)h(that')-5
b(s)21 b(ho)n(w)e(we)i(mak)o(e)e(language-speci\002c)f(v)o(ersions.)-2
3541 y
SDict begin H.S end
 -2 3541 a -2 3541 a
SDict begin 13 H.A end
 -2 3541 a -2 3541 a
SDict begin [/View [/XYZ H.V]/Dest (0:5549) cvn /DEST pdfmark end
 -2 3541
a 396 3631 a Fk(I)j(lik)o(e)f(to)g(write)h(in)f(a)h(plain)f(te)o(xt)g
(format.)e(It')-5 b(s)21 b(f)o(ast)g(and)f(w)o(orks)g(well)g(with)h
(source)e(control)g(systems)i(lik)o(e)f(git.)g(Since)396
3739 y(the)g(main)g(platform)f(for)h(our)f(websites)i(is)g(W)m(ikidot,)
e(I)h(write)h(using)e(W)m(ikidot')-5 b(s)20 b(v)o(ery)f(readable)g
(markup)g(format.)-2 3923 y
SDict begin H.S end
 -2 3923 a -2 3923 a
SDict begin 13 H.A end
 -2 3923
a -2 3923 a
SDict begin [/View [/XYZ H.V]/Dest (0:5550) cvn /DEST pdfmark end
 -2 3923 a 396 4013 a Fk(At)i(least)g(in)f(the)h(\002rst)f
(chapters,)g(it)h(w)o(as)g(important)d(to)j(dra)o(w)e(pictures)h(to)g
(e)o(xplain)f(the)h(\003o)n(w)g(of)g(messages)h(between)396
4121 y(peers.)f(I)g(found)f(Ditaa,)h(a)h(lo)o(v)o(ely)e(tool)h(that)g
(che)n(ws)g(up)g(line-dra)o(wings)e(and)h(spits)i(out)f(ele)o(gant)f
(graphics.)g(Ha)n(ving)g(the)396 4229 y(graphics)g(in)i(the)f(te)o(xt,)
g(as)h(te)o(xt,)e(mak)o(es)h(it)h(remarkably)d(easy)i(to)h(w)o(ork.)-2
4413 y
SDict begin H.S end
 -2 4413 a -2 4413 a
SDict begin 13 H.A end
 -2 4413 a -2 4413 a
SDict begin [/View [/XYZ H.V]/Dest (0:5551) cvn /DEST pdfmark end
 -2 4413
a 396 4503 a Fk(By)g(no)n(w)f(you')o(ll)f(realize)h(that)g(the)g
(toolchain)f(is)i(highly)e(customized,)g(though)f(it)j(uses)g(a)f(lot)h
(of)f(e)o(xternal)f(tools.)h(All)396 4611 y(are)g(a)n(v)n(ailable)f(on)
g(Ub)n(untu,)f(which)h(is)i(a)e(small)h(merc)o(y)-5 b(,)18
b(and)h(the)h(whole)f(toolchain)f(is)i(in)g(the)f(Guide)g(repository)f
(in)i(the)396 4718 y(bin)g(subdirectory)-5 b(.)-2 4902
y
SDict begin H.S end
 -2 4902 a -2 4902 a
SDict begin 13 H.A end
 -2 4902 a -2 4902 a
SDict begin [/View [/XYZ H.V]/Dest (0:5552) cvn /DEST pdfmark end
 -2 4902 a 396
4992 a Fk(Let')g(s)21 b(w)o(alk)f(through)e(the)j(editing)e(and)h
(publishing)e(process.)h(Here)i(is)g(ho)n(w)e(we)i(produce)d(the)i
(online)g(v)o(ersion:)p Black 3759 5569 a Ff(438)p Black
eop end
%%Page: 439 452
TeXDict begin 439 451 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.439) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3228 -132 a Ff(Chapter)20 b(9.)g(P)-7 b(ostface)p
Black -2 -11 a
SDict begin H.S end
 -2 -11 a -2 -11 a
SDict begin 11.7 H.A end
 -2 -11 a -2 -11 a
SDict begin [/View [/XYZ H.V]/Dest (0:5553) cvn /DEST pdfmark end
 -2
-11 a 396 72 a Fe(bin/mkguide)-2 250 y
SDict begin H.S end
 -2 250 a -2 250
a
SDict begin 13 H.A end
 -2 250 a -2 250 a
SDict begin [/View [/XYZ H.V]/Dest (0:5554) cvn /DEST pdfmark end
 -2 250 a 396 346 a Fk(Which)20 b(w)o(orks)g(as)h
(follo)n(ws:)-2 347 y
SDict begin H.S end
 -2 347 a -2 347 a
SDict begin 13 H.A end
 -2 347 a -2 347
a
SDict begin [/View [/XYZ H.V]/Dest (0:5555) cvn /DEST pdfmark end
 -2 347 a -2 357 a
SDict begin H.S end
 -2 357 a -2 357 a
SDict begin 13 H.A end
 -2 357 a -2 357
a
SDict begin [/View [/XYZ H.V]/Dest (0:5556) cvn /DEST pdfmark end
 -2 357 a Black 396 517 a Fj(\225)p Black 479 517 a
SDict begin H.S end

479 517 a 479 517 a
SDict begin 13 H.A end
 479 517 a 479 517 a
SDict begin [/View [/XYZ H.V]/Dest (0:5557) cvn /DEST pdfmark end
 479 517 a Fk(The)f(original)f
(te)o(xt)h(sits)i(in)e(a)h(series)f(of)g(te)o(xt)g(\002les)i(\(one)d
(per)h(chapter\).)-2 535 y
SDict begin H.S end
 -2 535 a -2 535 a
SDict begin 13 H.A end
 -2 535 a
-2 535 a
SDict begin [/View [/XYZ H.V]/Dest (0:5558) cvn /DEST pdfmark end
 -2 535 a Black 396 666 a Fj(\225)p Black 479
666 a
SDict begin H.S end
 479 666 a 479 666 a
SDict begin 13 H.A end
 479 666 a 479 666 a
SDict begin [/View [/XYZ H.V]/Dest (0:5559) cvn /DEST pdfmark end
 479 666
a Fk(The)g(e)o(xamples)f(sit)i(in)g(the)f(e)o(xamples)f(subdirectory)-5
b(,)17 b(classi\002ed)k(per)f(language.)-2 684 y
SDict begin H.S end
 -2 684
a -2 684 a
SDict begin 13 H.A end
 -2 684 a -2 684 a
SDict begin [/View [/XYZ H.V]/Dest (0:5560) cvn /DEST pdfmark end
 -2 684 a Black 396 816 a
Fj(\225)p Black 479 816 a
SDict begin H.S end
 479 816 a 479 816 a
SDict begin 13 H.A end
 479 816
a 479 816 a
SDict begin [/View [/XYZ H.V]/Dest (0:5561) cvn /DEST pdfmark end
 479 816 a Fk(W)-7 b(e)22 b(tak)o(e)e(the)g(te)o(xt,)g(and)g
(processes)f(this)i(into)f(a)h(set)g(of)f(W)m(ikidot-ready)d(\002les.)k
(It)g(does)f(this)g(for)g(each)g(of)g(the)479 923 y(languages)f(that)h
(get)h(their)e(o)n(wn)h(Guide)g(v)o(ersion.)-2 941 y
SDict begin H.S end

-2 941 a -2 941 a
SDict begin 13 H.A end
 -2 941 a -2 941 a
SDict begin [/View [/XYZ H.V]/Dest (0:5562) cvn /DEST pdfmark end
 -2 941 a Black 396
1073 a Fj(\225)p Black 479 1073 a
SDict begin H.S end
 479 1073 a 479 1073
a
SDict begin 13 H.A end
 479 1073 a 479 1073 a
SDict begin [/View [/XYZ H.V]/Dest (0:5563) cvn /DEST pdfmark end
 479 1073 a Fk(W)-7 b(e)22 b(e)o(xtract)d(the)h
(graphics)f(and)h(calls)h(Ditaa)f(on)g(each)g(one)g(to)g(produce)e
(image)i(\002les,)h(which)e(it)i(stores)g(in)f(the)479
1181 y(images)g(subdirectory)-5 b(.)-2 1199 y
SDict begin H.S end
 -2 1199
a -2 1199 a
SDict begin 13 H.A end
 -2 1199 a -2 1199 a
SDict begin [/View [/XYZ H.V]/Dest (0:5564) cvn /DEST pdfmark end
 -2 1199 a Black 396 1330
a Fj(\225)p Black 479 1330 a
SDict begin H.S end
 479 1330 a 479 1330 a
SDict begin 13 H.A end
 479
1330 a 479 1330 a
SDict begin [/View [/XYZ H.V]/Dest (0:5565) cvn /DEST pdfmark end
 479 1330 a Fk(W)e(e)22 b(e)o(xtract)d(inline)h
(listings)h(\(which)e(are)h(not)g(translated\))f(and)h(stores)g(these)h
(in)f(the)g(listings)h(subdirectory)-5 b(.)-2 1348 y
SDict begin H.S end

-2 1348 a -2 1348 a
SDict begin 13 H.A end
 -2 1348 a -2 1348 a
SDict begin [/View [/XYZ H.V]/Dest (0:5566) cvn /DEST pdfmark end
 -2 1348 a Black
396 1480 a Fj(\225)p Black 479 1480 a
SDict begin H.S end
 479 1480 a 479
1480 a
SDict begin 13 H.A end
 479 1480 a 479 1480 a
SDict begin [/View [/XYZ H.V]/Dest (0:5567) cvn /DEST pdfmark end
 479 1480 a Fk(W)e(e)22 b(use)e(p)o
(ygmentize)e(on)i(each)g(e)o(xample)f(and)g(listing)i(to)f(create)g(a)h
(mark)o(ed-up)c(page)j(in)g(W)m(ikidot)g(format.)-2 1498
y
SDict begin H.S end
 -2 1498 a -2 1498 a
SDict begin 13 H.A end
 -2 1498 a -2 1498 a
SDict begin [/View [/XYZ H.V]/Dest (0:5568) cvn /DEST pdfmark end
 -2 1498 a Black
396 1629 a Fj(\225)p Black 479 1629 a
SDict begin H.S end
 479 1629 a 479
1629 a
SDict begin 13 H.A end
 479 1629 a 479 1629 a
SDict begin [/View [/XYZ H.V]/Dest (0:5569) cvn /DEST pdfmark end
 479 1629 a Fk(W)-7 b(e)22
b(upload)c(all)j(changed)e(\002les)i(to)f(the)g(Guide)g(website)g(on)g
(W)m(ikidot.)-2 1813 y
SDict begin H.S end
 -2 1813 a -2 1813 a
SDict begin 13 H.A end
 -2 1813 a
-2 1813 a
SDict begin [/View [/XYZ H.V]/Dest (0:5570) cvn /DEST pdfmark end
 -2 1813 a 396 1903 a Fk(Doing)g(this)g(from)f(scratch)h(tak)o
(es)h(a)f(while.)g(So)h(we)f(store)h(the)f(SHA1)g(signatures)f(of)h(e)n
(v)o(ery)f(image,)h(listing,)g(e)o(xample,)396 2011 y(and)g(te)o(xt)g
(\002le,)h(and)e(only)h(process)f(and)h(upload)f(changes,)g(and)g(that)
i(mak)o(es)f(it)g(easy)h(to)f(publish)f(a)i(ne)n(w)f(v)o(ersion)f(of)h
(the)396 2119 y(Guide)g(when)g(people)f(mak)o(e)g(ne)n(w)h(contrib)n
(utions.)-2 2303 y
SDict begin H.S end
 -2 2303 a -2 2303 a
SDict begin 13 H.A end
 -2 2303 a -2 2303
a
SDict begin [/View [/XYZ H.V]/Dest (0:5571) cvn /DEST pdfmark end
 -2 2303 a 396 2393 a Fk(T)-7 b(o)21 b(produce)d(the)i(PDF)h(and)f
(Epub)f(formats)g(we)i(do)e(this:)-2 2494 y
SDict begin H.S end
 -2 2494 a
-2 2494 a
SDict begin 11.7 H.A end
 -2 2494 a -2 2494 a
SDict begin [/View [/XYZ H.V]/Dest (0:5572) cvn /DEST pdfmark end
 -2 2494 a 396 2573 a Fe(bin/mkpdfs)-2
2751 y
SDict begin H.S end
 -2 2751 a -2 2751 a
SDict begin 13 H.A end
 -2 2751 a -2 2751 a
SDict begin [/View [/XYZ H.V]/Dest (0:5573) cvn /DEST pdfmark end
 -2 2751
a 396 2847 a Fk(Which)h(w)o(orks)g(as)h(follo)n(ws:)-2
2848 y
SDict begin H.S end
 -2 2848 a -2 2848 a
SDict begin 13 H.A end
 -2 2848 a -2 2848 a
SDict begin [/View [/XYZ H.V]/Dest (0:5574) cvn /DEST pdfmark end
 -2 2848
a -2 2858 a
SDict begin H.S end
 -2 2858 a -2 2858 a
SDict begin 13 H.A end
 -2 2858 a -2 2858 a
SDict begin [/View [/XYZ H.V]/Dest (0:5575) cvn /DEST pdfmark end
 -2
2858 a Black 396 3017 a Fj(\225)p Black 479 3017 a
SDict begin H.S end
 479
3017 a 479 3017 a
SDict begin 13 H.A end
 479 3017 a 479 3017 a
SDict begin [/View [/XYZ H.V]/Dest (0:5576) cvn /DEST pdfmark end
 479 3017 a Fk(W)-7
b(e)22 b(use)e(the)g(mkbook)e(script)i(on)g(all)h(the)f(input)g
(\002les)h(to)f(produce)e(a)j(DocBook)e(output.)-2 3035
y
SDict begin H.S end
 -2 3035 a -2 3035 a
SDict begin 13 H.A end
 -2 3035 a -2 3035 a
SDict begin [/View [/XYZ H.V]/Dest (0:5577) cvn /DEST pdfmark end
 -2 3035 a Black
396 3167 a Fj(\225)p Black 479 3167 a
SDict begin H.S end
 479 3167 a 479
3167 a
SDict begin 13 H.A end
 479 3167 a 479 3167 a
SDict begin [/View [/XYZ H.V]/Dest (0:5578) cvn /DEST pdfmark end
 479 3167 a Fk(W)-7 b(e)22
b(push)d(the)h(DocBook)f(format)g(through)g(docbook2ps)e(and)i(ps2pdf)g
(to)h(create)g(clean)g(PDFs,)h(in)g(each)e(language.)-2
3185 y
SDict begin H.S end
 -2 3185 a -2 3185 a
SDict begin 13 H.A end
 -2 3185 a -2 3185 a
SDict begin [/View [/XYZ H.V]/Dest (0:5579) cvn /DEST pdfmark end
 -2 3185
a Black 396 3316 a Fj(\225)p Black 479 3316 a
SDict begin H.S end
 479 3316
a 479 3316 a
SDict begin 13 H.A end
 479 3316 a 479 3316 a
SDict begin [/View [/XYZ H.V]/Dest (0:5580) cvn /DEST pdfmark end
 479 3316 a Fk(W)-7
b(e)22 b(push)d(the)h(DocBook)f(format)g(though)g(db2epub)f(to)i
(create)g(Epub)f(books,)g(and)g(in)i(each)f(language.)-2
3500 y
SDict begin H.S end
 -2 3500 a -2 3500 a
SDict begin 13 H.A end
 -2 3500 a -2 3500 a
SDict begin [/View [/XYZ H.V]/Dest (0:5581) cvn /DEST pdfmark end
 -2 3500
a 396 3590 a Fk(It')-5 b(s)21 b(important,)d(when)i(you)f(create)h(a)h
(community)d(project,)h(to)h(lo)n(wer)g(the)g("change)f(latenc)o(y",)g
(i.e.)h(the)g(time)h(it)g(tak)o(es)396 3698 y(for)f(people)f(to)h(see)h
(their)f(w)o(ork)f(li)n(v)o(e.)h(Or)h(at)f(least,)h(to)f(see)h(that)f
(you')l(v)o(e)e(accepted)h(their)h(pull)g(request.)g(If)g(that)g(is)h
(more)396 3806 y(than)f(a)h(day)e(or)h(tw)o(o,)g(you')l(v)o(e)e(often)i
(lost)g(your)f(contrib)n(utor)-5 b(.)-2 3834 y
SDict begin H.S end
 -2 3834
a -2 3834 a
SDict begin 13 H.A end
 -2 3834 a -2 3834 a
SDict begin [/View [/XYZ H.V]/Dest (0:5582) cvn /DEST pdfmark end
 -2 3834 a 359 x Fn(9.4.)39
b(Licensing)949 4193 y
SDict begin H.S end
 949 4193 a 949 4193 a
SDict begin 22.464 H.A end
 949 4193
a 949 4193 a
SDict begin [/View [/XYZ H.V]/Dest (14.103.1) cvn /DEST pdfmark end
 949 4193 a -2 4391 a
SDict begin H.S end
 -2 4391 a -2 4391 a
SDict begin 13 H.A end

-2 4391 a -2 4391 a
SDict begin [/View [/XYZ H.V]/Dest (0:5584) cvn /DEST pdfmark end
 -2 4391 a 396 4467 a Fk(I)21 b(w)o(ant)f(people)f
(to)h(reuse)g(the)h(Guide)e(in)i(their)e(o)n(wn)h(w)o(ork:)g(in)g
(presentations,)f(articles,)h(and)g(e)n(v)o(en)f(other)g(books.)396
4575 y(Ho)n(we)n(v)o(er)m(,)f(the)j(deal)f(is)h(that)f(if)h(the)o(y)e
(remix)g(my)h(w)o(ork,)g(others)f(can)h(remix)g(theirs.)g(I')l(d)f(lik)
o(e)i(credit,)e(and)h(ha)n(v)o(e)f(no)396 4683 y(ar)o(gument)f(against)
i(others)f(making)g(mone)o(y)g(from)g(their)h(remix)o(es.)f(Thus,)g
(the)i(Guide)e(is)i(licensed)f(under)f(cc-by-sa.)-2 4867
y
SDict begin H.S end
 -2 4867 a -2 4867 a
SDict begin 13 H.A end
 -2 4867 a -2 4867 a
SDict begin [/View [/XYZ H.V]/Dest (0:5585) cvn /DEST pdfmark end
 -2 4867 a 396
4957 a Fk(F)o(or)h(the)g(e)o(xamples,)f(we)i(started)f(with)g(GPL,)g(b)
n(ut)h(it)g(rapidly)e(became)g(clear)h(this)h(w)o(asn')o(t)e(w)o
(orkable.)g(The)h(point)f(of)396 5065 y(e)o(xamples)g(is)i(to)g(gi)n(v)
o(e)e(people)g(reusable)h(code)f(fragments)g(so)i(the)o(y)e(will)i(use)
f(\330MQ)h(more)e(widely)-5 b(,)19 b(and)h(if)g(these)h(are)p
Black 3759 5569 a Ff(439)p Black eop end
%%Page: 440 453
TeXDict begin 440 452 bop -600 -600 a
SDict begin /product where{pop product(Distiller)search{pop pop pop
version(.)search{exch pop exch pop(3011)eq{gsave newpath 0 0 moveto
closepath clip/Courier findfont 10 scalefont setfont 72 72 moveto(.)show
grestore}if}{pop}ifelse}{pop}ifelse}if end
 -600 -600 a 0 TeXcolorgray
-611 -810 a
SDict begin H.S end
 -611 -810 a 0 TeXcolorgray 0 TeXcolorgray
-611 -810 a
SDict begin H.R end
 -611 -810 a -611 -810 a
SDict begin [/View [/XYZ H.V]/Dest (page.440) cvn /DEST pdfmark end
 -611 -810 a Black
Black 3228 -132 a Ff(Chapter)20 b(9.)g(P)-7 b(ostface)p
Black 396 72 a Fk(GPL)21 b(that)f(w)o(on')o(t)f(happen.)g(W)-7
b(e)21 b(switched)f(to)g(MIT/X11,)f(e)n(v)o(en)g(for)h(the)g(lar)o(ger)
f(and)g(more)h(comple)o(x)e(e)o(xamples)h(that)396 180
y(concei)n(v)n(ably)f(w)o(ould)i(w)o(ork)f(as)i(LGPL.)-2
364 y
SDict begin H.S end
 -2 364 a -2 364 a
SDict begin 13 H.A end
 -2 364 a -2 364 a
SDict begin [/View [/XYZ H.V]/Dest (0:5586) cvn /DEST pdfmark end
 -2 364 a 396
454 a Fk(Ho)n(we)n(v)o(er)e(when)g(we)i(started)f(turning)f(the)h(e)o
(xamples)f(into)h(stand-alone)e(projects)i(\(as)h(with)f(Majordomo\),)d
(we)k(used)396 562 y(the)f(LGPL.)h(Again,)e(remixability)f(trumps)i
(dissemination.)e(Licenses)j(are)f(tools,)g(use)g(them)g(with)g
(intent,)g(not)396 670 y(ideology)-5 b(.)p Black 3759
5569 a Ff(440)p Black eop end
%%Trailer

userdict /end-hook known{end-hook}if
%%EOF
